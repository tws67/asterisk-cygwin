<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:19:40 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_afe38fc0ccf2e9eefca5d5c6b03503d9.html">main</a>
  </div>
</div>
<div class="contents">
<h1>bridging.c File Reference</h1>
<p>Channel Bridging API.  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="asterisk_8h_source.html">asterisk.h</a>&quot;</code><br/>
<code>#include &lt;signal.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="logger_8h_source.html">asterisk/logger.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="channel_8h_source.html">asterisk/channel.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="options_8h_source.html">asterisk/options.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="utils_8h_source.html">asterisk/utils.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="lock_8h_source.html">asterisk/lock.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="linkedlists_8h_source.html">asterisk/linkedlists.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bridging_8h_source.html">asterisk/bridging.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="bridging__technology_8h_source.html">asterisk/bridging_technology.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="app_8h_source.html">asterisk/app.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="file_8h_source.html">asterisk/file.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="module_8h_source.html">asterisk/module.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="astobj2_8h_source.html">asterisk/astobj2.h</a>&quot;</code><br/>

<p><a href="bridging_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structbridge__technologies.html">bridge_technologies</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#a2bb5c159af5ed3ac286e5129999b351b">BRIDGE_ARRAY_GROW</a>&nbsp;&nbsp;&nbsp;32</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#a19adb1771f07f8371b7ae604b54b4752">BRIDGE_ARRAY_START</a>&nbsp;&nbsp;&nbsp;128</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#ad28289949f5625726a53e10379eea032">__ast_bridge_technology_register</a> (struct <a class="el" href="structast__bridge__technology.html">ast_bridge_technology</a> *technology, struct <a class="el" href="structast__module.html">ast_module</a> *module)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Register a bridge technology for use.  <a href="#ad28289949f5625726a53e10379eea032"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#a03cde0e9535440a4f9f24ab921bea771">ast_bridge_change_state</a> (struct <a class="el" href="structast__bridge__channel.html">ast_bridge_channel</a> *bridge_channel, enum <a class="el" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7">ast_bridge_channel_state</a> new_state)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Change the <a class="el" href="structstate.html">state</a> of a bridged channel.  <a href="#a03cde0e9535440a4f9f24ab921bea771"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#a1ae174d74e40569be246998a5e661a84">ast_bridge_check</a> (int <a class="el" href="res__jabber_8c.html#aa7afd7ba4814dbf49b1867019891fd14">capabilities</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">See if it is possible to create a bridge.  <a href="#a1ae174d74e40569be246998a5e661a84"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#a2b432942317147cc6c42d1f0c0730393">ast_bridge_depart</a> (struct <a class="el" href="structast__bridge.html">ast_bridge</a> *bridge, struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Depart a channel from a bridge.  <a href="#a2b432942317147cc6c42d1f0c0730393"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#a523fcc8aa1338afe507a3de9db0b84c3">ast_bridge_destroy</a> (struct <a class="el" href="structast__bridge.html">ast_bridge</a> *bridge)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Destroy a bridge.  <a href="#a523fcc8aa1338afe507a3de9db0b84c3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#aa60bc7df6be7b53bbb572ab5fcecb5aa">ast_bridge_dtmf_stream</a> (struct <a class="el" href="structast__bridge.html">ast_bridge</a> *bridge, const char *dtmf, struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Play a DTMF stream into a bridge, optionally not to a given channel.  <a href="#aa60bc7df6be7b53bbb572ab5fcecb5aa"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#acd324df24035097d55e7ecf1f214fab3">ast_bridge_features_cleanup</a> (struct <a class="el" href="structast__bridge__features.html">ast_bridge_features</a> *features)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Clean up the contents of a bridge features structure.  <a href="#acd324df24035097d55e7ecf1f214fab3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#adb1bd9496b6c67609e6d909ccd70e5ae">ast_bridge_features_enable</a> (struct <a class="el" href="structast__bridge__features.html">ast_bridge_features</a> *features, enum <a class="el" href="bridging__features_8h.html#a59c3a69424e1d3c627ece7aeb5f0bdb3">ast_bridge_builtin_feature</a> feature, const char *dtmf, void *<a class="el" href="pbx__lua_8c.html#a74bb62276efdf39dd94048e007fca05b">config</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Enable a built in feature on a bridge features structure.  <a href="#adb1bd9496b6c67609e6d909ccd70e5ae"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#a2febee2c3ae0c31d248278818ca5edf7">ast_bridge_features_hook</a> (struct <a class="el" href="structast__bridge__features.html">ast_bridge_features</a> *features, const char *dtmf, <a class="el" href="bridging__features_8h.html#a6d066da82427624671f418f4f64c5797">ast_bridge_features_hook_callback</a> callback, void *hook_pvt)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Attach a custom hook to a bridge features structure.  <a href="#a2febee2c3ae0c31d248278818ca5edf7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#a3128b52009fb3dd764dce90ea377fce1">ast_bridge_features_init</a> (struct <a class="el" href="structast__bridge__features.html">ast_bridge_features</a> *features)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize bridge features structure.  <a href="#a3128b52009fb3dd764dce90ea377fce1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#ad47b9c636ec2afadb2c98335967a4125">ast_bridge_features_register</a> (enum <a class="el" href="bridging__features_8h.html#a59c3a69424e1d3c627ece7aeb5f0bdb3">ast_bridge_builtin_feature</a> feature, <a class="el" href="bridging__features_8h.html#a6d066da82427624671f418f4f64c5797">ast_bridge_features_hook_callback</a> callback, const char *dtmf)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Register a handler for a built in feature.  <a href="#ad47b9c636ec2afadb2c98335967a4125"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#a3a82a984ac979d8c180e80e3ac06c818">ast_bridge_features_set_flag</a> (struct <a class="el" href="structast__bridge__features.html">ast_bridge_features</a> *features, enum <a class="el" href="bridging__features_8h.html#a65c2644d2eadb31bcec0aaeb41cb3444">ast_bridge_feature_flags</a> flag)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set a flag on a bridge features structure.  <a href="#a3a82a984ac979d8c180e80e3ac06c818"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#a395272994b2af7bd55f871b02d2d42e4">ast_bridge_features_unregister</a> (enum <a class="el" href="bridging__features_8h.html#a59c3a69424e1d3c627ece7aeb5f0bdb3">ast_bridge_builtin_feature</a> feature)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Unregister a handler for a built in feature.  <a href="#a395272994b2af7bd55f871b02d2d42e4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#ab01e4cd0a5b35dda072677f415b5f32a">ast_bridge_handle_trip</a> (struct <a class="el" href="structast__bridge.html">ast_bridge</a> *bridge, struct <a class="el" href="structast__bridge__channel.html">ast_bridge_channel</a> *bridge_channel, struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, int outfd)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Feed notification that a frame is waiting on a channel into the bridging core.  <a href="#ab01e4cd0a5b35dda072677f415b5f32a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#a25866ef7f32ed6b8f49bd4bf8a8721d7">ast_bridge_impart</a> (struct <a class="el" href="structast__bridge.html">ast_bridge</a> *bridge, struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structast__channel.html">ast_channel</a> *swap, struct <a class="el" href="structast__bridge__features.html">ast_bridge_features</a> *features)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Impart (non-blocking) a channel on a bridge.  <a href="#a25866ef7f32ed6b8f49bd4bf8a8721d7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7">ast_bridge_channel_state</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#adf7e5e313d2ed7e7b9dfd24891d38690">ast_bridge_join</a> (struct <a class="el" href="structast__bridge.html">ast_bridge</a> *bridge, struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structast__channel.html">ast_channel</a> *swap, struct <a class="el" href="structast__bridge__features.html">ast_bridge_features</a> *features)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Join (blocking) a channel to a bridge.  <a href="#adf7e5e313d2ed7e7b9dfd24891d38690"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#a38e5df0378d15d71b0ec921608221041">ast_bridge_merge</a> (struct <a class="el" href="structast__bridge.html">ast_bridge</a> *bridge0, struct <a class="el" href="structast__bridge.html">ast_bridge</a> *bridge1)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Merge two bridges together.  <a href="#a38e5df0378d15d71b0ec921608221041"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__bridge.html">ast_bridge</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#ab9ac166bd85c7c76b5e13170d3a2f047">ast_bridge_new</a> (int <a class="el" href="res__jabber_8c.html#aa7afd7ba4814dbf49b1867019891fd14">capabilities</a>, int flags)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create a new bridge.  <a href="#ab9ac166bd85c7c76b5e13170d3a2f047"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#a66d6a521530f4fb208eb8ee33e257b6c">ast_bridge_remove</a> (struct <a class="el" href="structast__bridge.html">ast_bridge</a> *bridge, struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Remove a channel from a bridge.  <a href="#a66d6a521530f4fb208eb8ee33e257b6c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#a85bc0d4138ac2af7b207d8f1325f051a">ast_bridge_suspend</a> (struct <a class="el" href="structast__bridge.html">ast_bridge</a> *bridge, struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Suspend a channel temporarily from a bridge.  <a href="#a85bc0d4138ac2af7b207d8f1325f051a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#acd557b9305cf531bd1d66acbe39d12ee">ast_bridge_technology_suspend</a> (struct <a class="el" href="structast__bridge__technology.html">ast_bridge_technology</a> *technology)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Suspend a bridge technology from consideration.  <a href="#acd557b9305cf531bd1d66acbe39d12ee"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#ac74018e91ff4fc7374f6137dd76c40f5">ast_bridge_technology_unregister</a> (struct <a class="el" href="structast__bridge__technology.html">ast_bridge_technology</a> *technology)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Unregister a bridge technology from use.  <a href="#ac74018e91ff4fc7374f6137dd76c40f5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#a24bb22d467a5f840fe8c954f9c7624d1">ast_bridge_technology_unsuspend</a> (struct <a class="el" href="structast__bridge__technology.html">ast_bridge_technology</a> *technology)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Unsuspend a bridge technology.  <a href="#a24bb22d467a5f840fe8c954f9c7624d1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#aab4cd1153d39a6744eca6a84d5255820">ast_bridge_unsuspend</a> (struct <a class="el" href="structast__bridge.html">ast_bridge</a> *bridge, struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Unsuspend a channel from a bridge.  <a href="#aab4cd1153d39a6744eca6a84d5255820"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#af41fa7f06745400ef9a05e5ad821c951">bridge_array_add</a> (struct <a class="el" href="structast__bridge.html">ast_bridge</a> *bridge, struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Helper function to add a channel to the bridge array.  <a href="#af41fa7f06745400ef9a05e5ad821c951"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#a5ac27d55678ac62f4323954cea6adfb8">bridge_array_remove</a> (struct <a class="el" href="structast__bridge.html">ast_bridge</a> *bridge, struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Helper function to remove a channel from the bridge array.  <a href="#a5ac27d55678ac62f4323954cea6adfb8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#a4804095baaf47eea8ad5f67f98588ad2">bridge_channel_dtmf_stream</a> (struct <a class="el" href="structast__bridge.html">ast_bridge</a> *bridge, struct <a class="el" href="structast__bridge__channel.html">ast_bridge_channel</a> *bridge_channel)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Internal function that plays back DTMF on a bridge channel.  <a href="#a4804095baaf47eea8ad5f67f98588ad2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#a372ceb5c3b7e76beb174da7fa59f84dc">bridge_channel_feature</a> (struct <a class="el" href="structast__bridge.html">ast_bridge</a> *bridge, struct <a class="el" href="structast__bridge__channel.html">ast_bridge_channel</a> *bridge_channel)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Internal function that executes a feature on a bridge channel.  <a href="#a372ceb5c3b7e76beb174da7fa59f84dc"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static enum <br class="typebreak"/>
<a class="el" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7">ast_bridge_channel_state</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#a63538fa2bdf0d9aa20742f12ee86bef1">bridge_channel_join</a> (struct <a class="el" href="structast__bridge__channel.html">ast_bridge_channel</a> *bridge_channel)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Join a channel to a bridge and handle anything the bridge may want us to do.  <a href="#a63538fa2bdf0d9aa20742f12ee86bef1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static enum <br class="typebreak"/>
<a class="el" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7">ast_bridge_channel_state</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#acaf943a7185049ddf957fa1a26cdd93a">bridge_channel_join_multithreaded</a> (struct <a class="el" href="structast__bridge__channel.html">ast_bridge_channel</a> *bridge_channel)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Run in a multithreaded model. Each joined channel does writing/reading in their own thread. TODO: Improve.  <a href="#acaf943a7185049ddf957fa1a26cdd93a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static enum <br class="typebreak"/>
<a class="el" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7">ast_bridge_channel_state</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#aa43d77daa36c4dacb3794ec08ca12cbf">bridge_channel_join_singlethreaded</a> (struct <a class="el" href="structast__bridge__channel.html">ast_bridge_channel</a> *bridge_channel)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Run in a singlethreaded model. Each joined channel yields itself to the main bridge thread. TODO: Improve.  <a href="#aa43d77daa36c4dacb3794ec08ca12cbf"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#a3a1111dba6ca9870165bccb229348b01">bridge_channel_suspend</a> (struct <a class="el" href="structast__bridge.html">ast_bridge</a> *bridge, struct <a class="el" href="structast__bridge__channel.html">ast_bridge_channel</a> *bridge_channel)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Internal function that suspends a channel from a bridge.  <a href="#a3a1111dba6ca9870165bccb229348b01"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#a47f049f2c263a70b056e02549ff7d561">bridge_channel_thread</a> (void *data)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Thread responsible for imparted bridged <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>.  <a href="#a47f049f2c263a70b056e02549ff7d561"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#a761e80878d0be1580c163dda4553dc37">bridge_channel_unsuspend</a> (struct <a class="el" href="structast__bridge.html">ast_bridge</a> *bridge, struct <a class="el" href="structast__bridge__channel.html">ast_bridge_channel</a> *bridge_channel)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Internal function that unsuspends a channel from a bridge.  <a href="#a761e80878d0be1580c163dda4553dc37"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#ab00741ef59ddce4434e47d71fe39646b">bridge_check_dissolve</a> (struct <a class="el" href="structast__bridge.html">ast_bridge</a> *bridge, struct <a class="el" href="structast__bridge__channel.html">ast_bridge_channel</a> *bridge_channel)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Internal function to see whether a bridge should dissolve, and if so do it.  <a href="#ab00741ef59ddce4434e47d71fe39646b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#a3a161f839c1d924a38b385ca8f5ed28f">bridge_drop_control_frame</a> (int subclass)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Internal function used to determine whether a control frame should be dropped or not.  <a href="#a3a161f839c1d924a38b385ca8f5ed28f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#a528e3f3afe8699fd772b60dd7fa91194">bridge_handle_dtmf</a> (struct <a class="el" href="structast__bridge.html">ast_bridge</a> *bridge, struct <a class="el" href="structast__bridge__channel.html">ast_bridge_channel</a> *bridge_channel, struct <a class="el" href="structast__frame.html">ast_frame</a> *frame)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Internal function to handle DTMF from a channel.  <a href="#a528e3f3afe8699fd772b60dd7fa91194"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#ae87cc33842c5acf5477d40f83c7e6a24">bridge_make_compatible</a> (struct <a class="el" href="structast__bridge.html">ast_bridge</a> *bridge, struct <a class="el" href="structast__bridge__channel.html">ast_bridge_channel</a> *bridge_channel)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#a57c77ab33579cf3f1ddb054b758a826c">bridge_poke</a> (struct <a class="el" href="structast__bridge.html">ast_bridge</a> *bridge)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Helper function to poke the bridge thread.  <a href="#a57c77ab33579cf3f1ddb054b758a826c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#a82dad941a0e25bf3f0b18759ae4ce667">bridge_thread</a> (void *data)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Bridge thread function.  <a href="#a82dad941a0e25bf3f0b18759ae4ce667"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#a99f699e128b44c627baa3587d99a0661">destroy_bridge</a> (void *obj)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <br class="typebreak"/>
<a class="el" href="structast__bridge__technology.html">ast_bridge_technology</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#a309ea60a7b664058b0f508c86079958e">find_best_technology</a> (int <a class="el" href="res__jabber_8c.html#aa7afd7ba4814dbf49b1867019891fd14">capabilities</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Helper function used to find the "best" bridge technology given a specified capabilities.  <a href="#a309ea60a7b664058b0f508c86079958e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__bridge__channel.html">ast_bridge_channel</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#af76003eaee352a6e71c4411b99c87eb1">find_bridge_channel</a> (struct <a class="el" href="structast__bridge.html">ast_bridge</a> *bridge, struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Helper function to find a bridge channel given a channel.  <a href="#af76003eaee352a6e71c4411b99c87eb1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#af73f5c8be78beef93b9098235115174a">generic_thread_loop</a> (struct <a class="el" href="structast__bridge.html">ast_bridge</a> *bridge)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Generic thread loop, TODO: Rethink this/improve it.  <a href="#af73f5c8be78beef93b9098235115174a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#a343a22dfa2196b0b3f6702a057ab07a4">smart_bridge_operation</a> (struct <a class="el" href="structast__bridge.html">ast_bridge</a> *bridge, struct <a class="el" href="structast__bridge__channel.html">ast_bridge_channel</a> *bridge_channel, int count)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Perform the smart bridge operation. Basically sees if a new bridge technology should be used instead of the current one.  <a href="#a343a22dfa2196b0b3f6702a057ab07a4"></a><br/></td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#a2df991cc86ea9bb473f730f2af4b2649">builtin_features_dtmf</a> [AST_BRIDGE_BUILTIN_END][MAXIMUM_DTMF_FEATURE_STRING]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8c.html#af4095d93586f95dd08ef1ad461bc3b80">builtin_features_handlers</a> [AST_BRIDGE_BUILTIN_END]</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Channel Bridging API. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Joshua Colp &lt;<a href="mailto:jcolp@digium.com">jcolp@digium.com</a>&gt; </dd></dl>

<p>Definition in file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a2bb5c159af5ed3ac286e5129999b351b"></a><!-- doxytag: member="bridging.c::BRIDGE_ARRAY_GROW" ref="a2bb5c159af5ed3ac286e5129999b351b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BRIDGE_ARRAY_GROW&nbsp;&nbsp;&nbsp;32</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bridging_8c_source.html#l00051">51</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>Referenced by <a class="el" href="bridging_8c_source.html#l00149">bridge_array_add()</a>.</p>

</div>
</div>
<a class="anchor" id="a19adb1771f07f8371b7ae604b54b4752"></a><!-- doxytag: member="bridging.c::BRIDGE_ARRAY_START" ref="a19adb1771f07f8371b7ae604b54b4752" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BRIDGE_ARRAY_START&nbsp;&nbsp;&nbsp;128</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bridging_8c_source.html#l00048">48</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>Referenced by <a class="el" href="bridging_8c_source.html#l00448">ast_bridge_new()</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ad28289949f5625726a53e10379eea032"></a><!-- doxytag: member="bridging.c::__ast_bridge_technology_register" ref="ad28289949f5625726a53e10379eea032" args="(struct ast_bridge_technology *technology, struct ast_module *module)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int __ast_bridge_technology_register </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge__technology.html">ast_bridge_technology</a> *&nbsp;</td>
          <td class="paramname"> <em>technology</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__module.html">ast_module</a> *&nbsp;</td>
          <td class="paramname"> <em>mod</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Register a bridge technology for use. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>technology</em>&nbsp;</td><td>The bridge technology to register </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>module</em>&nbsp;</td><td>The module that is registering the bridge technology</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure</td></tr>
  </table>
  </dd>
</dl>
<p>Example usage:</p>
<div class="fragment"><pre class="fragment"> <a class="code" href="bridging__technology_8h.html#ac2da6e2d9c71311ada917906641e8f9f" title="See __ast_bridge_technology_register().">ast_bridge_technology_register</a>(&amp;simple_bridge_tech);
</pre></div><p>This registers a bridge technology declared as the structure simple_bridge_tech with the bridging core and makes it available for use when creating bridges. </p>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l00059">59</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="linkedlists_8h_source.html#l00725">AST_RWLIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h_source.html#l00493">AST_RWLIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="logger_8h_source.html#l00079">ast_verbose</a>, <a class="el" href="bridging__technology_8h_source.html#l00048">ast_bridge_technology::capabilities</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="bridging__technology_8h_source.html#l00078">ast_bridge_technology::mod</a>, <a class="el" href="bridging__technology_8h_source.html#l00046">ast_bridge_technology::name</a>, <a class="el" href="asterisk_8c_source.html#l00174">option_verbose</a>, <a class="el" href="logger_8h_source.html#l00042">VERBOSE_PREFIX_2</a>, and <a class="el" href="structast__bridge__technology.html#ae9e71d53f73d5c415a5a15c2334ade8f">ast_bridge_technology::write</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00060"></a>00060 {
<a name="l00061"></a>00061    <span class="keyword">struct </span><a class="code" href="structast__bridge__technology.html" title="Structure that is the essence of a bridge technology.">ast_bridge_technology</a> *current = NULL;
<a name="l00062"></a>00062 
<a name="l00063"></a>00063    <span class="comment">/* Perform a sanity check to make sure the bridge technology conforms to our needed requirements */</span>
<a name="l00064"></a>00064    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(technology-&gt;<a class="code" href="structast__bridge__technology.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>) || !technology-&gt;<a class="code" href="structast__bridge__technology.html#a9461ee266923070466f95a76158f65cd">capabilities</a> || !technology-&gt;<a class="code" href="structast__bridge__technology.html#ae9e71d53f73d5c415a5a15c2334ade8f">write</a>) {
<a name="l00065"></a>00065       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Bridge technology %s failed registration sanity check.\n&quot;</span>, technology-&gt;<a class="code" href="structast__bridge__technology.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);
<a name="l00066"></a>00066       <span class="keywordflow">return</span> -1;
<a name="l00067"></a>00067    }
<a name="l00068"></a>00068 
<a name="l00069"></a>00069    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structbridge__technologies.html">bridge_technologies</a>);
<a name="l00070"></a>00070 
<a name="l00071"></a>00071    <span class="comment">/* Look for duplicate bridge technology already using this name, or already registered */</span>
<a name="l00072"></a>00072    <a class="code" href="linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;<a class="code" href="structbridge__technologies.html">bridge_technologies</a>, current, entry) {
<a name="l00073"></a>00073       <span class="keywordflow">if</span> ((!strcasecmp(current-&gt;<a class="code" href="structast__bridge__technology.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, technology-&gt;<a class="code" href="structast__bridge__technology.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)) || (current == technology)) {
<a name="l00074"></a>00074          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;A bridge technology of %s already claims to exist in our world.\n&quot;</span>, technology-&gt;<a class="code" href="structast__bridge__technology.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);
<a name="l00075"></a>00075          <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structbridge__technologies.html">bridge_technologies</a>);
<a name="l00076"></a>00076          <span class="keywordflow">return</span> -1;
<a name="l00077"></a>00077       }
<a name="l00078"></a>00078    }
<a name="l00079"></a>00079 
<a name="l00080"></a>00080    <span class="comment">/* Copy module pointer so reference counting can keep the module from unloading */</span>
<a name="l00081"></a>00081    technology-&gt;<a class="code" href="structast__bridge__technology.html#a782aff512368932b8d71b3633f88cb04">mod</a> = module;
<a name="l00082"></a>00082 
<a name="l00083"></a>00083    <span class="comment">/* Insert our new bridge technology into the list and print out a pretty message */</span>
<a name="l00084"></a>00084    <a class="code" href="linkedlists_8h.html#aadda916488b2d151af4426e2f06ad332">AST_RWLIST_INSERT_TAIL</a>(&amp;<a class="code" href="structbridge__technologies.html">bridge_technologies</a>, technology, entry);
<a name="l00085"></a>00085 
<a name="l00086"></a>00086    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structbridge__technologies.html">bridge_technologies</a>);
<a name="l00087"></a>00087 
<a name="l00088"></a>00088    <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#gaa294d0efa6a89c1a3d162787cac4fff5">option_verbose</a> &gt; 1) {
<a name="l00089"></a>00089       <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<a class="code" href="logger_8h.html#a5623b2747e49964e0eae2795057bc92e">VERBOSE_PREFIX_2</a> <span class="stringliteral">&quot;Registered bridge technology %s\n&quot;</span>, technology-&gt;<a class="code" href="structast__bridge__technology.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);
<a name="l00090"></a>00090    }
<a name="l00091"></a>00091 
<a name="l00092"></a>00092    <span class="keywordflow">return</span> 0;
<a name="l00093"></a>00093 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a03cde0e9535440a4f9f24ab921bea771"></a><!-- doxytag: member="bridging.c::ast_bridge_change_state" ref="a03cde0e9535440a4f9f24ab921bea771" args="(struct ast_bridge_channel *bridge_channel, enum ast_bridge_channel_state new_state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_bridge_change_state </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge__channel.html">ast_bridge_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge_channel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7">ast_bridge_channel_state</a>&nbsp;</td>
          <td class="paramname"> <em>new_state</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Change the <a class="el" href="structstate.html">state</a> of a bridged channel. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>bridge_channel</em>&nbsp;</td><td>Channel to change the <a class="el" href="structstate.html">state</a> on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>new_state</em>&nbsp;</td><td>The new <a class="el" href="structstate.html">state</a> to place the channel into</td></tr>
  </table>
  </dd>
</dl>
<p>Example usage:</p>
<div class="fragment"><pre class="fragment"> <a class="code" href="bridging_8h.html#a03cde0e9535440a4f9f24ab921bea771" title="Change the state of a bridged channel.">ast_bridge_change_state</a>(bridge_channel, <a class="code" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7a82e437d5aa10df5114a21ae794bce625">AST_BRIDGE_CHANNEL_STATE_WAIT</a>);
</pre></div><p>This places the channel pointed to by bridge_channel into the <a class="el" href="structstate.html">state</a> AST_BRIDGE_CHANNEL_STATE_WAIT.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>This API call is only meant to be used in feature hook callbacks to make sure the channel either hangs up or returns to the bridge. </dd></dl>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l00118">118</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l01734">ast_cond_signal()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="bridging_8h_source.html#l00121">ast_bridge_channel::cond</a>, <a class="el" href="bridging_8h_source.html#l00119">ast_bridge_channel::lock</a>, <a class="el" href="bridging_8h_source.html#l00123">ast_bridge_channel::state</a>, and <a class="el" href="bridging_8h_source.html#l00133">ast_bridge_channel::thread</a>.</p>

<p>Referenced by <a class="el" href="bridging_8c_source.html#l01064">ast_bridge_depart()</a>, <a class="el" href="bridging_8c_source.html#l00514">ast_bridge_destroy()</a>, <a class="el" href="bridging_8c_source.html#l01332">ast_bridge_dtmf_stream()</a>, <a class="el" href="bridging_8c_source.html#l00276">ast_bridge_handle_trip()</a>, <a class="el" href="bridging_8c_source.html#l01087">ast_bridge_remove()</a>, <a class="el" href="bridge__builtin__features_8c_source.html#l00131">attended_abort_transfer()</a>, <a class="el" href="bridge__builtin__features_8c_source.html#l00123">attended_threeway_transfer()</a>, <a class="el" href="bridging_8c_source.html#l00844">bridge_channel_dtmf_stream()</a>, <a class="el" href="bridging_8c_source.html#l00778">bridge_channel_feature()</a>, <a class="el" href="bridging_8c_source.html#l00860">bridge_channel_join()</a>, <a class="el" href="bridging_8c_source.html#l00218">bridge_check_dissolve()</a>, <a class="el" href="bridging_8c_source.html#l00241">bridge_handle_dtmf()</a>, <a class="el" href="bridge__builtin__features_8c_source.html#l00157">feature_attended_transfer()</a>, <a class="el" href="bridge__builtin__features_8c_source.html#l00095">feature_blind_transfer()</a>, and <a class="el" href="bridge__builtin__features_8c_source.html#l00233">feature_hangup()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00119"></a>00119 {
<a name="l00120"></a>00120    <span class="comment">/* Change the state on the bridge channel */</span>
<a name="l00121"></a>00121    bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a5a8dce45720cd4222feb34abbdaa2c40">state</a> = new_state;
<a name="l00122"></a>00122 
<a name="l00123"></a>00123    <span class="comment">/* Only poke the channel&apos;s thread if it is not us */</span>
<a name="l00124"></a>00124    <span class="keywordflow">if</span> (!pthread_equal(pthread_self(), bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a01f75a9ad916f63a94e06a27635ba278">thread</a>)) {
<a name="l00125"></a>00125       pthread_kill(bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a01f75a9ad916f63a94e06a27635ba278">thread</a>, SIGURG);
<a name="l00126"></a>00126       <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00127"></a>00127       <a class="code" href="lock_8h.html#a02a91e30acdea6d13208d23636d37c87">ast_cond_signal</a>(&amp;bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>);
<a name="l00128"></a>00128       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00129"></a>00129    }
<a name="l00130"></a>00130 
<a name="l00131"></a>00131    <span class="keywordflow">return</span>;
<a name="l00132"></a>00132 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1ae174d74e40569be246998a5e661a84"></a><!-- doxytag: member="bridging.c::ast_bridge_check" ref="a1ae174d74e40569be246998a5e661a84" args="(int capabilities)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_bridge_check </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>capabilities</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>See if it is possible to create a bridge. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>capabilities</em>&nbsp;</td><td>The capabilities that the bridge will use</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>1</em>&nbsp;</td><td>if possible </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if not possible</td></tr>
  </table>
  </dd>
</dl>
<p>Example usage:</p>
<div class="fragment"><pre class="fragment"> <span class="keywordtype">int</span> possible = <a class="code" href="bridging_8h.html#a1ae174d74e40569be246998a5e661a84" title="See if it is possible to create a bridge.">ast_bridge_check</a>(<a class="code" href="bridging_8h.html#a815c9b3e933dfd4b8f523cf55caa5bbfaf483c951b835fcc35da807b6a4b12509">AST_BRIDGE_CAPABILITY_1TO1MIX</a>);
</pre></div><p>This sees if it is possible to create a bridge capable of bridging two <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> together. </p>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l00501">501</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="loader_8c_source.html#l01171">ast_module_unref()</a>, <a class="el" href="bridging_8c_source.html#l00385">find_best_technology()</a>, and <a class="el" href="bridging__technology_8h_source.html#l00078">ast_bridge_technology::mod</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00502"></a>00502 {
<a name="l00503"></a>00503    <span class="keyword">struct </span><a class="code" href="structast__bridge__technology.html" title="Structure that is the essence of a bridge technology.">ast_bridge_technology</a> *bridge_technology = NULL;
<a name="l00504"></a>00504 
<a name="l00505"></a>00505    <span class="keywordflow">if</span> (!(bridge_technology = <a class="code" href="bridging_8c.html#a309ea60a7b664058b0f508c86079958e" title="Helper function used to find the &amp;quot;best&amp;quot; bridge technology given a specified...">find_best_technology</a>(<a class="code" href="res__jabber_8c.html#aa7afd7ba4814dbf49b1867019891fd14">capabilities</a>))) {
<a name="l00506"></a>00506       <span class="keywordflow">return</span> 0;
<a name="l00507"></a>00507    }
<a name="l00508"></a>00508 
<a name="l00509"></a>00509    <a class="code" href="module_8h.html#ac65fa15b16dbc563a2424af744ab003d">ast_module_unref</a>(bridge_technology-&gt;<a class="code" href="structast__bridge__technology.html#a782aff512368932b8d71b3633f88cb04">mod</a>);
<a name="l00510"></a>00510 
<a name="l00511"></a>00511    <span class="keywordflow">return</span> 1;
<a name="l00512"></a>00512 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2b432942317147cc6c42d1f0c0730393"></a><!-- doxytag: member="bridging.c::ast_bridge_depart" ref="a2b432942317147cc6c42d1f0c0730393" args="(struct ast_bridge *bridge, struct ast_channel *chan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_bridge_depart </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge.html">ast_bridge</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Depart a channel from a bridge. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>bridge</em>&nbsp;</td><td>Bridge to depart from </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel to depart</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure</td></tr>
  </table>
  </dd>
</dl>
<p>Example usage:</p>
<div class="fragment"><pre class="fragment"> <a class="code" href="bridging_8h.html#a2b432942317147cc6c42d1f0c0730393" title="Depart a channel from a bridge.">ast_bridge_depart</a>(bridge, <a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>);
</pre></div><p>This removes the channel pointed to by the chan pointer from the bridge pointed to by the bridge pointer and gives control to the calling thread. This does not hang up the channel.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>This API call can only be used on <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> that were added to the bridge using the ast_bridge_impart API call. </dd></dl>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l01064">1064</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="astobj2_8c_source.html#l00147">ao2_lock()</a>, <a class="el" href="astobj2_8c_source.html#l00169">ao2_unlock()</a>, <a class="el" href="bridging_8c_source.html#l00118">ast_bridge_change_state()</a>, <a class="el" href="bridging_8h_source.html#l00094">AST_BRIDGE_CHANNEL_STATE_DEPART</a>, <a class="el" href="bridging_8c_source.html#l00204">find_bridge_channel()</a>, <a class="el" href="bridging_8h_source.html#l00133">ast_bridge_channel::thread</a>, and <a class="el" href="app__meetme_8c_source.html#l00840">thread</a>.</p>

<p>Referenced by <a class="el" href="bridge__builtin__features_8c_source.html#l00157">feature_attended_transfer()</a>, and <a class="el" href="app__confbridge_8c_source.html#l00554">play_sound_file()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01065"></a>01065 {
<a name="l01066"></a>01066    <span class="keyword">struct </span><a class="code" href="structast__bridge__channel.html" title="Structure that contains information regarding a channel in a bridge.">ast_bridge_channel</a> *bridge_channel = NULL;
<a name="l01067"></a>01067    pthread_t <a class="code" href="app__meetme_8c.html#a01f75a9ad916f63a94e06a27635ba278">thread</a>;
<a name="l01068"></a>01068 
<a name="l01069"></a>01069    <a class="code" href="astobj2_8h.html#a3077056d07f6f9e348a54a743769bad5" title="Lock an object.">ao2_lock</a>(bridge);
<a name="l01070"></a>01070 
<a name="l01071"></a>01071    <span class="comment">/* Try to find the channel that we want to depart */</span>
<a name="l01072"></a>01072    <span class="keywordflow">if</span> (!(bridge_channel = <a class="code" href="bridging_8c.html#af76003eaee352a6e71c4411b99c87eb1" title="Helper function to find a bridge channel given a channel.">find_bridge_channel</a>(bridge, chan))) {
<a name="l01073"></a>01073       <a class="code" href="astobj2_8h.html#a379cc936a320f2179f7beb422dc15230" title="Unlock an object.">ao2_unlock</a>(bridge);
<a name="l01074"></a>01074       <span class="keywordflow">return</span> -1;
<a name="l01075"></a>01075    }
<a name="l01076"></a>01076 
<a name="l01077"></a>01077    <a class="code" href="bridging_8h.html#a03cde0e9535440a4f9f24ab921bea771" title="Change the state of a bridged channel.">ast_bridge_change_state</a>(bridge_channel, <a class="code" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7a0160065122a1729d07ed010b3369a49c">AST_BRIDGE_CHANNEL_STATE_DEPART</a>);
<a name="l01078"></a>01078    thread = bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a01f75a9ad916f63a94e06a27635ba278">thread</a>;
<a name="l01079"></a>01079 
<a name="l01080"></a>01080    <a class="code" href="astobj2_8h.html#a379cc936a320f2179f7beb422dc15230" title="Unlock an object.">ao2_unlock</a>(bridge);
<a name="l01081"></a>01081 
<a name="l01082"></a>01082    pthread_join(thread, NULL);
<a name="l01083"></a>01083 
<a name="l01084"></a>01084    <span class="keywordflow">return</span> 0;
<a name="l01085"></a>01085 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a523fcc8aa1338afe507a3de9db0b84c3"></a><!-- doxytag: member="bridging.c::ast_bridge_destroy" ref="a523fcc8aa1338afe507a3de9db0b84c3" args="(struct ast_bridge *bridge)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_bridge_destroy </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge.html">ast_bridge</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Destroy a bridge. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>bridge</em>&nbsp;</td><td>Bridge to destroy</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure</td></tr>
  </table>
  </dd>
</dl>
<p>Example usage:</p>
<div class="fragment"><pre class="fragment"> <a class="code" href="bridging_8h.html#a523fcc8aa1338afe507a3de9db0b84c3" title="Destroy a bridge.">ast_bridge_destroy</a>(bridge);
</pre></div><p>This destroys a bridge that was previously created using ast_bridge_new. </p>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l00514">514</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="astobj2_8c_source.html#l00147">ao2_lock()</a>, <a class="el" href="astobj2_8h_source.html#l00459">ao2_ref</a>, <a class="el" href="astobj2_8c_source.html#l00169">ao2_unlock()</a>, <a class="el" href="bridging_8c_source.html#l00118">ast_bridge_change_state()</a>, <a class="el" href="bridging_8h_source.html#l00090">AST_BRIDGE_CHANNEL_STATE_END</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="bridging_8c_source.html#l00135">bridge_poke()</a>, and <a class="el" href="bridging_8h_source.html#l00155">ast_bridge::stop</a>.</p>

<p>Referenced by <a class="el" href="bridging_8c_source.html#l00448">ast_bridge_new()</a>, <a class="el" href="app__confbridge_8c_source.html#l00364">destroy_conference_bridge()</a>, and <a class="el" href="bridge__builtin__features_8c_source.html#l00157">feature_attended_transfer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00515"></a>00515 {
<a name="l00516"></a>00516    <span class="keyword">struct </span><a class="code" href="structast__bridge__channel.html" title="Structure that contains information regarding a channel in a bridge.">ast_bridge_channel</a> *bridge_channel = NULL;
<a name="l00517"></a>00517 
<a name="l00518"></a>00518    <a class="code" href="astobj2_8h.html#a3077056d07f6f9e348a54a743769bad5" title="Lock an object.">ao2_lock</a>(bridge);
<a name="l00519"></a>00519 
<a name="l00520"></a>00520    bridge-&gt;<a class="code" href="structast__bridge.html#a111277a0849f92b793ed6aa1efe54462">stop</a> = 1;
<a name="l00521"></a>00521 
<a name="l00522"></a>00522    <a class="code" href="bridging_8c.html#a57c77ab33579cf3f1ddb054b758a826c" title="Helper function to poke the bridge thread.">bridge_poke</a>(bridge);
<a name="l00523"></a>00523 
<a name="l00524"></a>00524    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Telling all channels in bridge %p to end and leave the party\n&quot;</span>, bridge);
<a name="l00525"></a>00525 
<a name="l00526"></a>00526    <span class="comment">/* Drop every bridged channel, the last one will cause the bridge thread (if it exists) to exit */</span>
<a name="l00527"></a>00527    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;bridge-&gt;channels, bridge_channel, entry) {
<a name="l00528"></a>00528       <a class="code" href="bridging_8h.html#a03cde0e9535440a4f9f24ab921bea771" title="Change the state of a bridged channel.">ast_bridge_change_state</a>(bridge_channel, <a class="code" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7a70362e0b60c71e30a1166be6d13ac8a3">AST_BRIDGE_CHANNEL_STATE_END</a>);
<a name="l00529"></a>00529    }
<a name="l00530"></a>00530 
<a name="l00531"></a>00531    <a class="code" href="astobj2_8h.html#a379cc936a320f2179f7beb422dc15230" title="Unlock an object.">ao2_unlock</a>(bridge);
<a name="l00532"></a>00532 
<a name="l00533"></a>00533    <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(bridge, -1);
<a name="l00534"></a>00534 
<a name="l00535"></a>00535    <span class="keywordflow">return</span> 0;
<a name="l00536"></a>00536 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa60bc7df6be7b53bbb572ab5fcecb5aa"></a><!-- doxytag: member="bridging.c::ast_bridge_dtmf_stream" ref="aa60bc7df6be7b53bbb572ab5fcecb5aa" args="(struct ast_bridge *bridge, const char *dtmf, struct ast_channel *chan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_bridge_dtmf_stream </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge.html">ast_bridge</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>dtmf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Play a DTMF stream into a bridge, optionally not to a given channel. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>bridge</em>&nbsp;</td><td>Bridge to play stream into </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dtmf</em>&nbsp;</td><td>DTMF to play </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel to optionally not play to</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure</td></tr>
  </table>
  </dd>
</dl>
<p>Example usage:</p>
<div class="fragment"><pre class="fragment"> <a class="code" href="bridging__features_8h.html#aa60bc7df6be7b53bbb572ab5fcecb5aa" title="Play a DTMF stream into a bridge, optionally not to a given channel.">ast_bridge_dtmf_stream</a>(bridge, <span class="stringliteral">&quot;0123456789&quot;</span>, NULL);
</pre></div><p>This sends the DTMF digits '0123456789' to all <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> in the bridge pointed to by the bridge pointer. Optionally a channel may be excluded by passing it's channel pointer using the chan parameter. </p>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l01332">1332</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="astobj2_8c_source.html#l00147">ao2_lock()</a>, <a class="el" href="astobj2_8c_source.html#l00169">ao2_unlock()</a>, <a class="el" href="bridging_8c_source.html#l00118">ast_bridge_change_state()</a>, <a class="el" href="bridging_8h_source.html#l00098">AST_BRIDGE_CHANNEL_STATE_DTMF</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="bridging_8h_source.html#l00125">ast_bridge_channel::chan</a>, and <a class="el" href="bridging_8h_source.html#l00141">ast_bridge_channel::dtmf_stream_q</a>.</p>

<p>Referenced by <a class="el" href="bridging_8c_source.html#l00778">bridge_channel_feature()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01333"></a>01333 {
<a name="l01334"></a>01334    <span class="keyword">struct </span><a class="code" href="structast__bridge__channel.html" title="Structure that contains information regarding a channel in a bridge.">ast_bridge_channel</a> *bridge_channel = NULL;
<a name="l01335"></a>01335 
<a name="l01336"></a>01336    <a class="code" href="astobj2_8h.html#a3077056d07f6f9e348a54a743769bad5" title="Lock an object.">ao2_lock</a>(bridge);
<a name="l01337"></a>01337 
<a name="l01338"></a>01338    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;bridge-&gt;channels, bridge_channel, entry) {
<a name="l01339"></a>01339       <span class="keywordflow">if</span> (bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a84d1435c5b8d387806714ea7079304b7">chan</a> == chan) {
<a name="l01340"></a>01340          <span class="keywordflow">continue</span>;
<a name="l01341"></a>01341       }
<a name="l01342"></a>01342       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#ab17441f7a62e1f44132a5c2a5bb69d27">dtmf_stream_q</a>, dtmf, <span class="keyword">sizeof</span>(bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#ab17441f7a62e1f44132a5c2a5bb69d27">dtmf_stream_q</a>));
<a name="l01343"></a>01343       <a class="code" href="bridging_8h.html#a03cde0e9535440a4f9f24ab921bea771" title="Change the state of a bridged channel.">ast_bridge_change_state</a>(bridge_channel, <a class="code" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7a5242791d651ccb03b7426b626dca9dbd">AST_BRIDGE_CHANNEL_STATE_DTMF</a>);
<a name="l01344"></a>01344    }
<a name="l01345"></a>01345 
<a name="l01346"></a>01346    <a class="code" href="astobj2_8h.html#a379cc936a320f2179f7beb422dc15230" title="Unlock an object.">ao2_unlock</a>(bridge);
<a name="l01347"></a>01347 
<a name="l01348"></a>01348    <span class="keywordflow">return</span> 0;
<a name="l01349"></a>01349 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="acd324df24035097d55e7ecf1f214fab3"></a><!-- doxytag: member="bridging.c::ast_bridge_features_cleanup" ref="acd324df24035097d55e7ecf1f214fab3" args="(struct ast_bridge_features *features)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_bridge_features_cleanup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge__features.html">ast_bridge_features</a> *&nbsp;</td>
          <td class="paramname"> <em>features</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Clean up the contents of a bridge features structure. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>features</em>&nbsp;</td><td>Bridge features structure</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure</td></tr>
  </table>
  </dd>
</dl>
<p>Example usage:</p>
<div class="fragment"><pre class="fragment"> <span class="keyword">struct </span><a class="code" href="structast__bridge__features.html" title="Structure that contains features information.">ast_bridge_features</a> features;
 <a class="code" href="bridging__features_8h.html#a3128b52009fb3dd764dce90ea377fce1" title="Initialize bridge features structure.">ast_bridge_features_init</a>(&amp;features);
 <a class="code" href="bridging__features_8h.html#acd324df24035097d55e7ecf1f214fab3" title="Clean up the contents of a bridge features structure.">ast_bridge_features_cleanup</a>(&amp;features);
</pre></div><p>This cleans up the feature structure 'features'.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>This MUST be called after the features structure is done being used or a memory leak may occur. </dd></dl>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l01320">1320</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, and <a class="el" href="linkedlists_8h_source.html#l00817">AST_LIST_REMOVE_HEAD</a>.</p>

<p>Referenced by <a class="el" href="app__confbridge_8c_source.html#l00687">confbridge_exec()</a>, <a class="el" href="bridging_8c_source.html#l00420">destroy_bridge()</a>, and <a class="el" href="bridge__builtin__features_8c_source.html#l00157">feature_attended_transfer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01321"></a>01321 {
<a name="l01322"></a>01322    <span class="keyword">struct </span><a class="code" href="structast__bridge__features__hook.html" title="Structure that is the essence of a features hook.">ast_bridge_features_hook</a> *hook = NULL;
<a name="l01323"></a>01323 
<a name="l01324"></a>01324    <span class="comment">/* This is relatively simple, hooks are kept as a list on the features structure so we just pop them off and free them */</span>
<a name="l01325"></a>01325    <span class="keywordflow">while</span> ((hook = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;features-&gt;hooks, entry))) {
<a name="l01326"></a>01326       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(hook);
<a name="l01327"></a>01327    }
<a name="l01328"></a>01328 
<a name="l01329"></a>01329    <span class="keywordflow">return</span> 0;
<a name="l01330"></a>01330 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="adb1bd9496b6c67609e6d909ccd70e5ae"></a><!-- doxytag: member="bridging.c::ast_bridge_features_enable" ref="adb1bd9496b6c67609e6d909ccd70e5ae" args="(struct ast_bridge_features *features, enum ast_bridge_builtin_feature feature, const char *dtmf, void *config)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_bridge_features_enable </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge__features.html">ast_bridge_features</a> *&nbsp;</td>
          <td class="paramname"> <em>features</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="bridging__features_8h.html#a59c3a69424e1d3c627ece7aeb5f0bdb3">ast_bridge_builtin_feature</a>&nbsp;</td>
          <td class="paramname"> <em>feature</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>dtmf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>config</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Enable a built in feature on a bridge features structure. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>features</em>&nbsp;</td><td>Bridge features structure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>feature</em>&nbsp;</td><td>Feature to enable </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dtmf</em>&nbsp;</td><td>Optionally the DTMF stream to trigger the feature, if not specified it will be the default </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>config</em>&nbsp;</td><td>Configuration structure unique to the built in type</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure</td></tr>
  </table>
  </dd>
</dl>
<p>Example usage:</p>
<div class="fragment"><pre class="fragment"> <span class="keyword">struct </span><a class="code" href="structast__bridge__features.html" title="Structure that contains features information.">ast_bridge_features</a> features;
 <a class="code" href="bridging__features_8h.html#a3128b52009fb3dd764dce90ea377fce1" title="Initialize bridge features structure.">ast_bridge_features_init</a>(&amp;features);
 <a class="code" href="bridging__features_8h.html#adb1bd9496b6c67609e6d909ccd70e5ae" title="Enable a built in feature on a bridge features structure.">ast_bridge_features_enable</a>(&amp;features, <a class="code" href="bridging__features_8h.html#a59c3a69424e1d3c627ece7aeb5f0bdb3a914956d3505768cc223eb23ce407c691">AST_BRIDGE_BUILTIN_ATTENDEDTRANSFER</a>, NULL);
</pre></div><p>This enables the attended transfer DTMF option using the default DTMF string. An alternate string may be provided using the dtmf parameter. Internally this is simply setting up a hook to a built in feature callback function. </p>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l01282">1282</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="bridging_8c_source.html#l01261">ast_bridge_features_hook()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, and <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>.</p>

<p>Referenced by <a class="el" href="bridge__builtin__features_8c_source.html#l00157">feature_attended_transfer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01283"></a>01283 {
<a name="l01284"></a>01284    <span class="comment">/* If no alternate DTMF stream was provided use the default one */</span>
<a name="l01285"></a>01285    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(dtmf)) {
<a name="l01286"></a>01286       dtmf = <a class="code" href="bridging_8c.html#a2df991cc86ea9bb473f730f2af4b2649">builtin_features_dtmf</a>[feature];
<a name="l01287"></a>01287       <span class="comment">/* If no DTMF is still available (ie: it has been disabled) then error out now */</span>
<a name="l01288"></a>01288       <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(dtmf)) {
<a name="l01289"></a>01289          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Failed to enable built in feature %d on %p, no DTMF string is available for it.\n&quot;</span>, feature, features);
<a name="l01290"></a>01290          <span class="keywordflow">return</span> -1;
<a name="l01291"></a>01291       }
<a name="l01292"></a>01292    }
<a name="l01293"></a>01293 
<a name="l01294"></a>01294    <span class="keywordflow">if</span> (!<a class="code" href="bridging_8c.html#af4095d93586f95dd08ef1ad461bc3b80">builtin_features_handlers</a>[feature]) {
<a name="l01295"></a>01295       <span class="keywordflow">return</span> -1;
<a name="l01296"></a>01296    }
<a name="l01297"></a>01297 
<a name="l01298"></a>01298    <span class="comment">/* The rest is basically pretty easy. We create another hook using the built in feature&apos;s callback and DTMF, easy as pie. */</span>
<a name="l01299"></a>01299    <span class="keywordflow">return</span> <a class="code" href="bridging__features_8h.html#a2febee2c3ae0c31d248278818ca5edf7" title="Attach a custom hook to a bridge features structure.">ast_bridge_features_hook</a>(features, dtmf, <a class="code" href="bridging_8c.html#af4095d93586f95dd08ef1ad461bc3b80">builtin_features_handlers</a>[feature], <a class="code" href="cdr__csv_8c.html#a74bb62276efdf39dd94048e007fca05b">config</a>);
<a name="l01300"></a>01300 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2febee2c3ae0c31d248278818ca5edf7"></a><!-- doxytag: member="bridging.c::ast_bridge_features_hook" ref="a2febee2c3ae0c31d248278818ca5edf7" args="(struct ast_bridge_features *features, const char *dtmf, ast_bridge_features_hook_callback callback, void *hook_pvt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="structast__bridge__features__hook.html">ast_bridge_features_hook</a> </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge__features.html">ast_bridge_features</a> *&nbsp;</td>
          <td class="paramname"> <em>features</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>dtmf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="bridging__features_8h.html#a6d066da82427624671f418f4f64c5797">ast_bridge_features_hook_callback</a>&nbsp;</td>
          <td class="paramname"> <em>callback</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>hook_pvt</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Attach a custom hook to a bridge features structure. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>features</em>&nbsp;</td><td>Bridge features structure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dtmf</em>&nbsp;</td><td>DTMF string to be activated upon </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>callback</em>&nbsp;</td><td>Function to execute upon activation </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>hook_pvt</em>&nbsp;</td><td>Unique data</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure</td></tr>
  </table>
  </dd>
</dl>
<p>Example usage:</p>
<div class="fragment"><pre class="fragment"> <span class="keyword">struct </span><a class="code" href="structast__bridge__features.html" title="Structure that contains features information.">ast_bridge_features</a> features;
 <a class="code" href="bridging__features_8h.html#a3128b52009fb3dd764dce90ea377fce1" title="Initialize bridge features structure.">ast_bridge_features_init</a>(&amp;features);
 <a class="code" href="bridging__features_8h.html#a2febee2c3ae0c31d248278818ca5edf7" title="Attach a custom hook to a bridge features structure.">ast_bridge_features_hook</a>(&amp;features, <span class="stringliteral">&quot;#&quot;</span>, pound_callback, NULL);
</pre></div><p>This makes the bridging core call pound_callback if a channel that has this feature structure inputs the DTMF string '#'. A pointer to useful data may be provided to the hook_pvt parameter.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>It is important that the callback set the bridge channel <a class="el" href="structstate.html">state</a> back to AST_BRIDGE_CHANNEL_STATE_WAIT or the bridge thread will not service the channel. </dd></dl>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l01261">1261</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="linkedlists_8h_source.html#l00715">AST_LIST_INSERT_TAIL</a>, <a class="el" href="bridging__features_8h_source.html#l00078">ast_bridge_features_hook::callback</a>, <a class="el" href="bridging__features_8h_source.html#l00076">ast_bridge_features_hook::dtmf</a>, <a class="el" href="bridging__features_8h_source.html#l00080">ast_bridge_features_hook::hook_pvt</a>, and <a class="el" href="bridging__features_8h_source.html#l00094">ast_bridge_features::usable</a>.</p>

<p>Referenced by <a class="el" href="bridging_8c_source.html#l01282">ast_bridge_features_enable()</a>, <a class="el" href="app__confbridge_8c_source.html#l00687">confbridge_exec()</a>, and <a class="el" href="bridge__builtin__features_8c_source.html#l00157">feature_attended_transfer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01262"></a>01262 {
<a name="l01263"></a>01263    <span class="keyword">struct </span><a class="code" href="structast__bridge__features__hook.html" title="Structure that is the essence of a features hook.">ast_bridge_features_hook</a> *hook = NULL;
<a name="l01264"></a>01264 
<a name="l01265"></a>01265    <span class="comment">/* Allocate new memory and setup it&apos;s various variables */</span>
<a name="l01266"></a>01266    <span class="keywordflow">if</span> (!(hook = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*hook)))) {
<a name="l01267"></a>01267       <span class="keywordflow">return</span> -1;
<a name="l01268"></a>01268    }
<a name="l01269"></a>01269 
<a name="l01270"></a>01270    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(hook-&gt;<a class="code" href="structast__bridge__features__hook.html#a33464dba524e69ccf4c908b486d8301e">dtmf</a>, <a class="code" href="structast__bridge__features__hook.html#a33464dba524e69ccf4c908b486d8301e">dtmf</a>, <span class="keyword">sizeof</span>(hook-&gt;<a class="code" href="structast__bridge__features__hook.html#a33464dba524e69ccf4c908b486d8301e">dtmf</a>));
<a name="l01271"></a>01271    hook-&gt;<a class="code" href="structast__bridge__features__hook.html#ad69a4c6a493af02d5203d747834cb329">callback</a> = <a class="code" href="structast__bridge__features__hook.html#ad69a4c6a493af02d5203d747834cb329">callback</a>;
<a name="l01272"></a>01272    hook-&gt;<a class="code" href="structast__bridge__features__hook.html#ad6640f8898b13ff6d292522ee3d4973f">hook_pvt</a> = <a class="code" href="structast__bridge__features__hook.html#ad6640f8898b13ff6d292522ee3d4973f">hook_pvt</a>;
<a name="l01273"></a>01273 
<a name="l01274"></a>01274    <span class="comment">/* Once done we add it onto the list. Now it will be picked up when DTMF is used */</span>
<a name="l01275"></a>01275    <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(&amp;features-&gt;hooks, hook, entry);
<a name="l01276"></a>01276 
<a name="l01277"></a>01277    features-&gt;<a class="code" href="structast__bridge__features.html#a080125973deec97104866dd31867e3ce">usable</a> = 1;
<a name="l01278"></a>01278 
<a name="l01279"></a>01279    <span class="keywordflow">return</span> 0;
<a name="l01280"></a>01280 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3128b52009fb3dd764dce90ea377fce1"></a><!-- doxytag: member="bridging.c::ast_bridge_features_init" ref="a3128b52009fb3dd764dce90ea377fce1" args="(struct ast_bridge_features *features)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_bridge_features_init </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge__features.html">ast_bridge_features</a> *&nbsp;</td>
          <td class="paramname"> <em>features</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize bridge features structure. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>features</em>&nbsp;</td><td>Bridge featues structure</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure</td></tr>
  </table>
  </dd>
</dl>
<p>Example usage:</p>
<div class="fragment"><pre class="fragment"> <span class="keyword">struct </span><a class="code" href="structast__bridge__features.html" title="Structure that contains features information.">ast_bridge_features</a> features;
 <a class="code" href="bridging__features_8h.html#a3128b52009fb3dd764dce90ea377fce1" title="Initialize bridge features structure.">ast_bridge_features_init</a>(&amp;features);
</pre></div><p>This initializes the feature structure 'features' to have nothing enabled.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>This MUST be called before enabling features or flags. Failure to do so may result in a crash. </dd></dl>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l01309">1309</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00665">AST_LIST_HEAD_INIT_NOLOCK</a>.</p>

<p>Referenced by <a class="el" href="app__confbridge_8c_source.html#l00687">confbridge_exec()</a>, and <a class="el" href="bridge__builtin__features_8c_source.html#l00157">feature_attended_transfer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01310"></a>01310 {
<a name="l01311"></a>01311    <span class="comment">/* Zero out the structure */</span>
<a name="l01312"></a>01312    memset(features, 0, <span class="keyword">sizeof</span>(*features));
<a name="l01313"></a>01313 
<a name="l01314"></a>01314    <span class="comment">/* Initialize the hooks list, just in case */</span>
<a name="l01315"></a>01315    <a class="code" href="linkedlists_8h.html#a0d1f922e093ac18824a7863fe3f5fa27" title="Initializes a list head structure.">AST_LIST_HEAD_INIT_NOLOCK</a>(&amp;features-&gt;hooks);
<a name="l01316"></a>01316 
<a name="l01317"></a>01317    <span class="keywordflow">return</span> 0;
<a name="l01318"></a>01318 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad47b9c636ec2afadb2c98335967a4125"></a><!-- doxytag: member="bridging.c::ast_bridge_features_register" ref="ad47b9c636ec2afadb2c98335967a4125" args="(enum ast_bridge_builtin_feature feature, ast_bridge_features_hook_callback callback, const char *dtmf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_bridge_features_register </td>
          <td>(</td>
          <td class="paramtype">enum <a class="el" href="bridging__features_8h.html#a59c3a69424e1d3c627ece7aeb5f0bdb3">ast_bridge_builtin_feature</a>&nbsp;</td>
          <td class="paramname"> <em>feature</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="bridging__features_8h.html#a6d066da82427624671f418f4f64c5797">ast_bridge_features_hook_callback</a>&nbsp;</td>
          <td class="paramname"> <em>callback</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>dtmf</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Register a handler for a built in feature. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>feature</em>&nbsp;</td><td>The feature that the handler will be responsible for </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>callback</em>&nbsp;</td><td>The callback function that will handle it </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dtmf</em>&nbsp;</td><td>Default DTMF string used to activate the feature</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure</td></tr>
  </table>
  </dd>
</dl>
<p>Example usage:</p>
<div class="fragment"><pre class="fragment"> <a class="code" href="bridging__features_8h.html#ad47b9c636ec2afadb2c98335967a4125" title="Register a handler for a built in feature.">ast_bridge_features_register</a>(AST_BRIDGE_BUILTIN_ATTENDED_TRANSFER, bridge_builtin_attended_transfer, <span class="stringliteral">&quot;*1&quot;</span>);
</pre></div><p>This registers the function bridge_builtin_attended_transfer as the function responsible for the built in attended transfer feature. </p>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l01235">1235</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, and <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>.</p>

<p>Referenced by <a class="el" href="bridge__builtin__features_8c_source.html#l00245">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01236"></a>01236 {
<a name="l01237"></a>01237    <span class="keywordflow">if</span> (<a class="code" href="bridging_8c.html#af4095d93586f95dd08ef1ad461bc3b80">builtin_features_handlers</a>[feature]) {
<a name="l01238"></a>01238       <span class="keywordflow">return</span> -1;
<a name="l01239"></a>01239    }
<a name="l01240"></a>01240 
<a name="l01241"></a>01241    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(dtmf)) {
<a name="l01242"></a>01242       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="bridging_8c.html#a2df991cc86ea9bb473f730f2af4b2649">builtin_features_dtmf</a>[feature], dtmf, <span class="keyword">sizeof</span>(<a class="code" href="bridging_8c.html#a2df991cc86ea9bb473f730f2af4b2649">builtin_features_dtmf</a>[feature]));
<a name="l01243"></a>01243    }
<a name="l01244"></a>01244 
<a name="l01245"></a>01245    <a class="code" href="bridging_8c.html#af4095d93586f95dd08ef1ad461bc3b80">builtin_features_handlers</a>[feature] = callback;
<a name="l01246"></a>01246 
<a name="l01247"></a>01247    <span class="keywordflow">return</span> 0;
<a name="l01248"></a>01248 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3a82a984ac979d8c180e80e3ac06c818"></a><!-- doxytag: member="bridging.c::ast_bridge_features_set_flag" ref="a3a82a984ac979d8c180e80e3ac06c818" args="(struct ast_bridge_features *features, enum ast_bridge_feature_flags flag)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_bridge_features_set_flag </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge__features.html">ast_bridge_features</a> *&nbsp;</td>
          <td class="paramname"> <em>features</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="bridging__features_8h.html#a65c2644d2eadb31bcec0aaeb41cb3444">ast_bridge_feature_flags</a>&nbsp;</td>
          <td class="paramname"> <em>flag</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set a flag on a bridge features structure. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>features</em>&nbsp;</td><td>Bridge features structure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>flag</em>&nbsp;</td><td>Flag to enable</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure</td></tr>
  </table>
  </dd>
</dl>
<p>Example usage:</p>
<div class="fragment"><pre class="fragment"> <span class="keyword">struct </span><a class="code" href="structast__bridge__features.html" title="Structure that contains features information.">ast_bridge_features</a> features;
 <a class="code" href="bridging__features_8h.html#a3128b52009fb3dd764dce90ea377fce1" title="Initialize bridge features structure.">ast_bridge_features_init</a>(&amp;features);
 <a class="code" href="bridging__features_8h.html#a3a82a984ac979d8c180e80e3ac06c818" title="Set a flag on a bridge features structure.">ast_bridge_features_set_flag</a>(&amp;features, <a class="code" href="bridging__features_8h.html#a65c2644d2eadb31bcec0aaeb41cb3444ae2c21ce82d946116c6488e97faedcd3d">AST_BRIDGE_FLAG_DISSOLVE</a>);
</pre></div><p>This sets the AST_BRIDGE_FLAG_DISSOLVE feature to be enabled on the features structure 'features'. </p>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l01302">1302</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="utils_8h_source.html#l00068">ast_set_flag</a>, <a class="el" href="bridging__features_8h_source.html#l00092">ast_bridge_features::feature_flags</a>, and <a class="el" href="bridging__features_8h_source.html#l00094">ast_bridge_features::usable</a>.</p>

<p>Referenced by <a class="el" href="bridge__builtin__features_8c_source.html#l00157">feature_attended_transfer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01303"></a>01303 {
<a name="l01304"></a>01304    <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(&amp;features-&gt;<a class="code" href="structast__bridge__features.html#af15c2e8b6df8ce0bf570af18aa890deb">feature_flags</a>, flag);
<a name="l01305"></a>01305    features-&gt;<a class="code" href="structast__bridge__features.html#a080125973deec97104866dd31867e3ce">usable</a> = 1;
<a name="l01306"></a>01306    <span class="keywordflow">return</span> 0;
<a name="l01307"></a>01307 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a395272994b2af7bd55f871b02d2d42e4"></a><!-- doxytag: member="bridging.c::ast_bridge_features_unregister" ref="a395272994b2af7bd55f871b02d2d42e4" args="(enum ast_bridge_builtin_feature feature)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_bridge_features_unregister </td>
          <td>(</td>
          <td class="paramtype">enum <a class="el" href="bridging__features_8h.html#a59c3a69424e1d3c627ece7aeb5f0bdb3">ast_bridge_builtin_feature</a>&nbsp;</td>
          <td class="paramname"> <em>feature</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Unregister a handler for a built in feature. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>feature</em>&nbsp;</td><td>The feature to unregister</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure</td></tr>
  </table>
  </dd>
</dl>
<p>Example usage:</p>
<div class="fragment"><pre class="fragment"> <a class="code" href="bridging__features_8h.html#a395272994b2af7bd55f871b02d2d42e4" title="Unregister a handler for a built in feature.">ast_bridge_features_unregister</a>(AST_BRIDGE_BUILTIN_ATTENDED_TRANSFER);
</pre></div><p>This unregisters the function that is handling the built in attended transfer feature. </p>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l01250">1250</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01251"></a>01251 {
<a name="l01252"></a>01252    <span class="keywordflow">if</span> (!<a class="code" href="bridging_8c.html#af4095d93586f95dd08ef1ad461bc3b80">builtin_features_handlers</a>[feature]) {
<a name="l01253"></a>01253       <span class="keywordflow">return</span> -1;
<a name="l01254"></a>01254    }
<a name="l01255"></a>01255 
<a name="l01256"></a>01256    <a class="code" href="bridging_8c.html#af4095d93586f95dd08ef1ad461bc3b80">builtin_features_handlers</a>[feature] = NULL;
<a name="l01257"></a>01257 
<a name="l01258"></a>01258    <span class="keywordflow">return</span> 0;
<a name="l01259"></a>01259 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab01e4cd0a5b35dda072677f415b5f32a"></a><!-- doxytag: member="bridging.c::ast_bridge_handle_trip" ref="ab01e4cd0a5b35dda072677f415b5f32a" args="(struct ast_bridge *bridge, struct ast_bridge_channel *bridge_channel, struct ast_channel *chan, int outfd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_bridge_handle_trip </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge.html">ast_bridge</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__bridge__channel.html">ast_bridge_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge_channel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>outfd</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Feed notification that a frame is waiting on a channel into the bridging core. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>bridge</em>&nbsp;</td><td>The bridge that the notification should influence </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>bridge_channel</em>&nbsp;</td><td>Bridge channel the notification was received on (if known) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel the notification was received on (if known) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>outfd</em>&nbsp;</td><td>File descriptor that the notification was received on (if known)</td></tr>
  </table>
  </dd>
</dl>
<p>Example usage:</p>
<div class="fragment"><pre class="fragment"> <a class="code" href="bridging__technology_8h.html#ab01e4cd0a5b35dda072677f415b5f32a" title="Feed notification that a frame is waiting on a channel into the bridging core.">ast_bridge_handle_trip</a>(bridge, NULL, <a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, -1);
</pre></div><p>This tells the bridging core that a frame has been received on the channel pointed to by chan and that it should be read and handled.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>This should only be used by bridging technologies. </dd></dl>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l00276">276</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="bridging_8c_source.html#l00118">ast_bridge_change_state()</a>, <a class="el" href="bridging_8h_source.html#l00090">AST_BRIDGE_CHANNEL_STATE_END</a>, <a class="el" href="frame_8h_source.html#l00298">AST_CONTROL_HANGUP</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="frame_8h_source.html#l00105">AST_FRAME_CONTROL</a>, <a class="el" href="frame_8h_source.html#l00122">AST_FRAME_DTMF_BEGIN</a>, <a class="el" href="frame_8h_source.html#l00462">ast_frfree</a>, <a class="el" href="channel_8c_source.html#l03100">ast_read()</a>, <a class="el" href="channel_8c_source.html#l03105">ast_read_noaudio()</a>, <a class="el" href="bridging_8c_source.html#l00265">bridge_drop_control_frame()</a>, <a class="el" href="bridging_8c_source.html#l00241">bridge_handle_dtmf()</a>, <a class="el" href="structast__bridge__technology.html#aa021c0c9ab12c7ca3bd62980a6aaccc9">ast_bridge_technology::fd</a>, <a class="el" href="bridging_8h_source.html#l00139">ast_bridge_channel::features</a>, <a class="el" href="bridging_8h_source.html#l00167">ast_bridge::features</a>, <a class="el" href="bridging_8c_source.html#l00204">find_bridge_channel()</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="bridging__features_8h_source.html#l00096">ast_bridge_features::mute</a>, <a class="el" href="structast__bridge__technology.html#a8e711c0bdb19529df16903d1cdf89525">ast_bridge_technology::poke</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, <a class="el" href="bridging_8h_source.html#l00161">ast_bridge::technology</a>, and <a class="el" href="structast__bridge__technology.html#ae9e71d53f73d5c415a5a15c2334ade8f">ast_bridge_technology::write</a>.</p>

<p>Referenced by <a class="el" href="bridging_8c_source.html#l00698">bridge_channel_join_multithreaded()</a>, <a class="el" href="bridging_8c_source.html#l00325">generic_thread_loop()</a>, and <a class="el" href="bridge__multiplexed_8c_source.html#l00200">multiplexed_thread_function()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00277"></a>00277 {
<a name="l00278"></a>00278    <span class="comment">/* If no bridge channel has been provided and the actual channel has been provided find it */</span>
<a name="l00279"></a>00279    <span class="keywordflow">if</span> (chan &amp;&amp; !bridge_channel) {
<a name="l00280"></a>00280       bridge_channel = <a class="code" href="bridging_8c.html#af76003eaee352a6e71c4411b99c87eb1" title="Helper function to find a bridge channel given a channel.">find_bridge_channel</a>(bridge, chan);
<a name="l00281"></a>00281    }
<a name="l00282"></a>00282 
<a name="l00283"></a>00283    <span class="comment">/* If a bridge channel with actual channel is present read a frame and handle it */</span>
<a name="l00284"></a>00284    <span class="keywordflow">if</span> (chan &amp;&amp; bridge_channel) {
<a name="l00285"></a>00285       <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *frame = (((bridge-&gt;<a class="code" href="structast__bridge.html#aa5f7287d4bbab0f62a1bae18af89171d">features</a>.<a class="code" href="structast__bridge__features.html#aa09e22acd94cd548a204c100e11fd612">mute</a>) || (bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a65633fdc6178dc8d9f754fda0166d16e">features</a> &amp;&amp; bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a65633fdc6178dc8d9f754fda0166d16e">features</a>-&gt;<a class="code" href="structast__bridge__features.html#aa09e22acd94cd548a204c100e11fd612">mute</a>)) ? <a class="code" href="channel_8h.html#a1950f7fe77c02d233de02d299bab8c15" title="Reads a frame, returning AST_FRAME_NULL frame if audio.">ast_read_noaudio</a>(chan) : <a class="code" href="channel_8h.html#a7ef6737309dc9e8b6c4a7cb4800638b1" title="Reads a frame.">ast_read</a>(chan));
<a name="l00286"></a>00286 
<a name="l00287"></a>00287       <span class="comment">/* This is pretty simple... see if they hung up */</span>
<a name="l00288"></a>00288       <span class="keywordflow">if</span> (!frame || (frame-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a> &amp;&amp; frame-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> == <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa7dac1c1896ab418c2ff351aae707fba">AST_CONTROL_HANGUP</a>)) {
<a name="l00289"></a>00289          <span class="comment">/* Signal the thread that is handling the bridged channel that it should be ended */</span>
<a name="l00290"></a>00290          <a class="code" href="bridging_8h.html#a03cde0e9535440a4f9f24ab921bea771" title="Change the state of a bridged channel.">ast_bridge_change_state</a>(bridge_channel, <a class="code" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7a70362e0b60c71e30a1166be6d13ac8a3">AST_BRIDGE_CHANNEL_STATE_END</a>);
<a name="l00291"></a>00291       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (frame-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a> &amp;&amp; <a class="code" href="bridging_8c.html#a3a161f839c1d924a38b385ca8f5ed28f" title="Internal function used to determine whether a control frame should be dropped or...">bridge_drop_control_frame</a>(frame-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>)) {
<a name="l00292"></a>00292          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Dropping control frame from bridge channel %p\n&quot;</span>, bridge_channel);
<a name="l00293"></a>00293       } <span class="keywordflow">else</span> {
<a name="l00294"></a>00294          <span class="keywordflow">if</span> (frame-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a9b350360a64b55c7590f1ec03db480be">AST_FRAME_DTMF_BEGIN</a>) {
<a name="l00295"></a>00295             frame = <a class="code" href="bridging_8c.html#a528e3f3afe8699fd772b60dd7fa91194" title="Internal function to handle DTMF from a channel.">bridge_handle_dtmf</a>(bridge, bridge_channel, frame);
<a name="l00296"></a>00296          }
<a name="l00297"></a>00297          <span class="comment">/* Simply write the frame out to the bridge technology if it still exists */</span>
<a name="l00298"></a>00298          <span class="keywordflow">if</span> (frame) {
<a name="l00299"></a>00299             bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#ae9e71d53f73d5c415a5a15c2334ade8f">write</a>(bridge, bridge_channel, frame);
<a name="l00300"></a>00300          }
<a name="l00301"></a>00301       }
<a name="l00302"></a>00302 
<a name="l00303"></a>00303       <span class="keywordflow">if</span> (frame) {
<a name="l00304"></a>00304          <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(frame);
<a name="l00305"></a>00305       }
<a name="l00306"></a>00306       <span class="keywordflow">return</span>;
<a name="l00307"></a>00307    }
<a name="l00308"></a>00308 
<a name="l00309"></a>00309    <span class="comment">/* If a file descriptor actually tripped pass it off to the bridge technology */</span>
<a name="l00310"></a>00310    <span class="keywordflow">if</span> (outfd &gt; -1 &amp;&amp; bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#aa021c0c9ab12c7ca3bd62980a6aaccc9">fd</a>) {
<a name="l00311"></a>00311       bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#aa021c0c9ab12c7ca3bd62980a6aaccc9">fd</a>(bridge, bridge_channel, outfd);
<a name="l00312"></a>00312       <span class="keywordflow">return</span>;
<a name="l00313"></a>00313    }
<a name="l00314"></a>00314 
<a name="l00315"></a>00315    <span class="comment">/* If all else fails just poke the bridge */</span>
<a name="l00316"></a>00316    <span class="keywordflow">if</span> (bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a8e711c0bdb19529df16903d1cdf89525">poke</a> &amp;&amp; bridge_channel) {
<a name="l00317"></a>00317       bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a8e711c0bdb19529df16903d1cdf89525">poke</a>(bridge, bridge_channel);
<a name="l00318"></a>00318       <span class="keywordflow">return</span>;
<a name="l00319"></a>00319    }
<a name="l00320"></a>00320 
<a name="l00321"></a>00321    <span class="keywordflow">return</span>;
<a name="l00322"></a>00322 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a25866ef7f32ed6b8f49bd4bf8a8721d7"></a><!-- doxytag: member="bridging.c::ast_bridge_impart" ref="a25866ef7f32ed6b8f49bd4bf8a8721d7" args="(struct ast_bridge *bridge, struct ast_channel *chan, struct ast_channel *swap, struct ast_bridge_features *features)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_bridge_impart </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge.html">ast_bridge</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>swap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__bridge__features.html">ast_bridge_features</a> *&nbsp;</td>
          <td class="paramname"> <em>features</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Impart (non-blocking) a channel on a bridge. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>bridge</em>&nbsp;</td><td>Bridge to impart on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel to impart </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>swap</em>&nbsp;</td><td>Channel to swap out if swapping </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>features</em>&nbsp;</td><td>Bridge features structure</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure</td></tr>
  </table>
  </dd>
</dl>
<p>Example usage:</p>
<div class="fragment"><pre class="fragment"> <a class="code" href="bridging_8h.html#a25866ef7f32ed6b8f49bd4bf8a8721d7" title="Impart (non-blocking) a channel on a bridge.">ast_bridge_impart</a>(bridge, chan, NULL, NULL);
</pre></div><p>This adds a channel pointed to by the chan pointer to the bridge pointed to by the bridge pointer. This function will return immediately and will not wait until the channel is no longer part of the bridge.</p>
<p>If this channel will be replacing another channel the other channel can be specified in the swap parameter. The other channel will be thrown out of the bridge in an atomic fashion.</p>
<p>If channel specific features are enabled a pointer to the features structure can be specified in the features parameter. </p>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l01030">1030</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00459">ao2_ref</a>, <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="lock_8h_source.html#l01744">ast_cond_destroy()</a>, <a class="el" href="lock_8h_source.html#l01729">ast_cond_init()</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="lock_8h_source.html#l01712">ast_mutex_destroy()</a>, <a class="el" href="lock_8h_source.html#l01692">ast_mutex_init()</a>, <a class="el" href="utils_8h_source.html#l00376">ast_pthread_create</a>, <a class="el" href="bridging_8h_source.html#l00129">ast_bridge_channel::bridge</a>, <a class="el" href="bridging_8c_source.html#l01008">bridge_channel_thread()</a>, <a class="el" href="bridging_8h_source.html#l00125">ast_bridge_channel::chan</a>, <a class="el" href="bridging_8h_source.html#l00121">ast_bridge_channel::cond</a>, <a class="el" href="bridging_8h_source.html#l00139">ast_bridge_channel::features</a>, <a class="el" href="bridging_8h_source.html#l00119">ast_bridge_channel::lock</a>, <a class="el" href="bridging_8h_source.html#l00127">ast_bridge_channel::swap</a>, and <a class="el" href="bridging_8h_source.html#l00133">ast_bridge_channel::thread</a>.</p>

<p>Referenced by <a class="el" href="chan__bridge_8c_source.html#l00120">bridge_call()</a>, <a class="el" href="bridge__builtin__features_8c_source.html#l00157">feature_attended_transfer()</a>, <a class="el" href="bridge__builtin__features_8c_source.html#l00095">feature_blind_transfer()</a>, and <a class="el" href="app__confbridge_8c_source.html#l00554">play_sound_file()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01031"></a>01031 {
<a name="l01032"></a>01032    <span class="keyword">struct </span><a class="code" href="structast__bridge__channel.html" title="Structure that contains information regarding a channel in a bridge.">ast_bridge_channel</a> *bridge_channel = NULL;
<a name="l01033"></a>01033 
<a name="l01034"></a>01034    <span class="comment">/* Try to allocate a structure for the bridge channel */</span>
<a name="l01035"></a>01035    <span class="keywordflow">if</span> (!(bridge_channel = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*bridge_channel)))) {
<a name="l01036"></a>01036       <span class="keywordflow">return</span> -1;
<a name="l01037"></a>01037    }
<a name="l01038"></a>01038 
<a name="l01039"></a>01039    <span class="comment">/* Setup various parameters */</span>
<a name="l01040"></a>01040    bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a84d1435c5b8d387806714ea7079304b7">chan</a> = chan;
<a name="l01041"></a>01041    bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a3bf3c4e34892d0033814ab5fec0e006f">swap</a> = swap;
<a name="l01042"></a>01042    bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a> = bridge;
<a name="l01043"></a>01043    bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a65633fdc6178dc8d9f754fda0166d16e">features</a> = features;
<a name="l01044"></a>01044 
<a name="l01045"></a>01045    <span class="comment">/* Initialize our mutex lock and condition */</span>
<a name="l01046"></a>01046    <a class="code" href="lock_8h.html#a5dc895fe6e8c089175159fc22e33fc3b">ast_mutex_init</a>(&amp;bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01047"></a>01047    <a class="code" href="lock_8h.html#a21f75f462115427718d78aa66cc61f9b">ast_cond_init</a>(&amp;bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>, NULL);
<a name="l01048"></a>01048 
<a name="l01049"></a>01049    <span class="comment">/* Bump up the reference count on the bridge, it&apos;ll get decremented later */</span>
<a name="l01050"></a>01050    <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(bridge, +1);
<a name="l01051"></a>01051 
<a name="l01052"></a>01052    <span class="comment">/* Actually create the thread that will handle the channel */</span>
<a name="l01053"></a>01053    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a4781fd54a4ca8c7f0f8a32a6cce503c0">ast_pthread_create</a>(&amp;bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a01f75a9ad916f63a94e06a27635ba278">thread</a>, NULL, <a class="code" href="bridging_8c.html#a47f049f2c263a70b056e02549ff7d561" title="Thread responsible for imparted bridged channels.">bridge_channel_thread</a>, bridge_channel)) {
<a name="l01054"></a>01054       <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(bridge, -1);
<a name="l01055"></a>01055       <a class="code" href="lock_8h.html#a7752bcadc38f1d7a7a8528c538569115">ast_cond_destroy</a>(&amp;bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>);
<a name="l01056"></a>01056       <a class="code" href="lock_8h.html#ab237e70b569019bfb490ab0c3c09b8c5">ast_mutex_destroy</a>(&amp;bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01057"></a>01057       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(bridge_channel);
<a name="l01058"></a>01058       <span class="keywordflow">return</span> -1;
<a name="l01059"></a>01059    }
<a name="l01060"></a>01060 
<a name="l01061"></a>01061    <span class="keywordflow">return</span> 0;
<a name="l01062"></a>01062 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="adf7e5e313d2ed7e7b9dfd24891d38690"></a><!-- doxytag: member="bridging.c::ast_bridge_join" ref="adf7e5e313d2ed7e7b9dfd24891d38690" args="(struct ast_bridge *bridge, struct ast_channel *chan, struct ast_channel *swap, struct ast_bridge_features *features)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7">ast_bridge_channel_state</a> ast_bridge_join </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge.html">ast_bridge</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>swap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__bridge__features.html">ast_bridge_features</a> *&nbsp;</td>
          <td class="paramname"> <em>features</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Join (blocking) a channel to a bridge. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>bridge</em>&nbsp;</td><td>Bridge to join </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel to join </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>swap</em>&nbsp;</td><td>Channel to swap out if swapping </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>features</em>&nbsp;</td><td>Bridge features structure</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structstate.html">state</a></em>&nbsp;</td><td>that channel exited the bridge with</td></tr>
  </table>
  </dd>
</dl>
<p>Example usage:</p>
<div class="fragment"><pre class="fragment"> <a class="code" href="bridging_8h.html#adf7e5e313d2ed7e7b9dfd24891d38690" title="Join (blocking) a channel to a bridge.">ast_bridge_join</a>(bridge, chan, NULL, NULL);
</pre></div><p>This adds a channel pointed to by the chan pointer to the bridge pointed to by the bridge pointer. This function will not return until the channel has been removed from the bridge, swapped out for another channel, or has hung up.</p>
<p>If this channel will be replacing another channel the other channel can be specified in the swap parameter. The other channel will be thrown out of the bridge in an atomic fashion.</p>
<p>If channel specific features are enabled a pointer to the features structure can be specified in the features parameter. </p>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l00980">980</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00459">ao2_ref</a>, <a class="el" href="lock_8h_source.html#l01744">ast_cond_destroy()</a>, <a class="el" href="lock_8h_source.html#l01729">ast_cond_init()</a>, <a class="el" href="lock_8h_source.html#l01712">ast_mutex_destroy()</a>, <a class="el" href="lock_8h_source.html#l01692">ast_mutex_init()</a>, <a class="el" href="bridging_8h_source.html#l00129">ast_bridge_channel::bridge</a>, <a class="el" href="channel_8h_source.html#l00498">ast_channel::bridge</a>, <a class="el" href="bridging_8c_source.html#l00860">bridge_channel_join()</a>, <a class="el" href="bridging_8h_source.html#l00125">ast_bridge_channel::chan</a>, <a class="el" href="bridging_8h_source.html#l00121">ast_bridge_channel::cond</a>, <a class="el" href="bridging_8h_source.html#l00167">ast_bridge::features</a>, and <a class="el" href="bridging_8h_source.html#l00119">ast_bridge_channel::lock</a>.</p>

<p>Referenced by <a class="el" href="app__confbridge_8c_source.html#l00687">confbridge_exec()</a>, and <a class="el" href="bridge__builtin__features_8c_source.html#l00157">feature_attended_transfer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00981"></a>00981 {
<a name="l00982"></a>00982    <span class="keyword">struct </span><a class="code" href="structast__bridge__channel.html" title="Structure that contains information regarding a channel in a bridge.">ast_bridge_channel</a> bridge_channel = {
<a name="l00983"></a>00983       .chan = chan,
<a name="l00984"></a>00984       .swap = swap,
<a name="l00985"></a>00985       .<a class="code" href="structast__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a> = bridge,
<a name="l00986"></a>00986       .<a class="code" href="structast__bridge.html#aa5f7287d4bbab0f62a1bae18af89171d">features</a> = features,
<a name="l00987"></a>00987    };
<a name="l00988"></a>00988    <span class="keyword">enum</span> <a class="code" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7" title="State information about a bridged channel.">ast_bridge_channel_state</a> <a class="code" href="structstate.html">state</a>;
<a name="l00989"></a>00989 
<a name="l00990"></a>00990    <span class="comment">/* Initialize various other elements of the bridge channel structure that we can&apos;t do above */</span>
<a name="l00991"></a>00991    <a class="code" href="lock_8h.html#a5dc895fe6e8c089175159fc22e33fc3b">ast_mutex_init</a>(&amp;bridge_channel.<a class="code" href="structast__bridge__channel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00992"></a>00992    <a class="code" href="lock_8h.html#a21f75f462115427718d78aa66cc61f9b">ast_cond_init</a>(&amp;bridge_channel.<a class="code" href="structast__bridge__channel.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>, NULL);
<a name="l00993"></a>00993 
<a name="l00994"></a>00994    <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(bridge_channel.<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>, +1);
<a name="l00995"></a>00995 
<a name="l00996"></a>00996    state = <a class="code" href="bridging_8c.html#a63538fa2bdf0d9aa20742f12ee86bef1" title="Join a channel to a bridge and handle anything the bridge may want us to do.">bridge_channel_join</a>(&amp;bridge_channel);
<a name="l00997"></a>00997 
<a name="l00998"></a>00998    <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(bridge_channel.<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>, -1);
<a name="l00999"></a>00999 
<a name="l01000"></a>01000    <span class="comment">/* Destroy some elements of the bridge channel structure above */</span>
<a name="l01001"></a>01001    <a class="code" href="lock_8h.html#ab237e70b569019bfb490ab0c3c09b8c5">ast_mutex_destroy</a>(&amp;bridge_channel.<a class="code" href="structast__bridge__channel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01002"></a>01002    <a class="code" href="lock_8h.html#a7752bcadc38f1d7a7a8528c538569115">ast_cond_destroy</a>(&amp;bridge_channel.<a class="code" href="structast__bridge__channel.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>);
<a name="l01003"></a>01003 
<a name="l01004"></a>01004    <span class="keywordflow">return</span> state;
<a name="l01005"></a>01005 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a38e5df0378d15d71b0ec921608221041"></a><!-- doxytag: member="bridging.c::ast_bridge_merge" ref="a38e5df0378d15d71b0ec921608221041" args="(struct ast_bridge *bridge0, struct ast_bridge *bridge1)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_bridge_merge </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge.html">ast_bridge</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__bridge.html">ast_bridge</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge1</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Merge two bridges together. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>bridge0</em>&nbsp;</td><td>First bridge </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>bridge1</em>&nbsp;</td><td>Second bridge</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure</td></tr>
  </table>
  </dd>
</dl>
<p>Example usage:</p>
<div class="fragment"><pre class="fragment"> <a class="code" href="bridging_8h.html#a38e5df0378d15d71b0ec921608221041" title="Merge two bridges together.">ast_bridge_merge</a>(bridge0, bridge1);
</pre></div><p>This merges the bridge pointed to by bridge1 with the bridge pointed to by bridge0. In reality all of the <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> in bridge1 are simply moved to bridge0.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>The second bridge specified is not destroyed when this operation is completed. </dd></dl>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l01106">1106</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="astobj2_8c_source.html#l00147">ao2_lock()</a>, <a class="el" href="astobj2_8h_source.html#l00459">ao2_ref</a>, <a class="el" href="astobj2_8c_source.html#l00169">ao2_unlock()</a>, <a class="el" href="bridging_8h_source.html#l00072">AST_BRIDGE_CAPABILITY_MULTIMIX</a>, <a class="el" href="bridging__features_8h_source.html#l00036">AST_BRIDGE_FLAG_SMART</a>, <a class="el" href="lock_8h_source.html#l01734">ast_cond_signal()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="linkedlists_8h_source.html#l00715">AST_LIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h_source.html#l00817">AST_LIST_REMOVE_HEAD</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="lock_8h_source.html#l00083">AST_PTHREADT_STOP</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="bridging_8h_source.html#l00129">ast_bridge_channel::bridge</a>, <a class="el" href="bridging_8c_source.html#l00149">bridge_array_add()</a>, <a class="el" href="bridging_8c_source.html#l00180">bridge_array_remove()</a>, <a class="el" href="bridging_8c_source.html#l00538">bridge_make_compatible()</a>, <a class="el" href="bridging__technology_8h_source.html#l00048">ast_bridge_technology::capabilities</a>, <a class="el" href="bridging_8h_source.html#l00125">ast_bridge_channel::chan</a>, <a class="el" href="bridging_8h_source.html#l00121">ast_bridge_channel::cond</a>, <a class="el" href="bridging_8h_source.html#l00159">ast_bridge::feature_flags</a>, <a class="el" href="structast__bridge__technology.html#a8b369fed84f7c637d98be4861971590b">ast_bridge_technology::join</a>, <a class="el" href="structast__bridge__technology.html#ae453b9a1154d7db567f2f11c6adc5bc1">ast_bridge_technology::leave</a>, <a class="el" href="bridging_8h_source.html#l00119">ast_bridge_channel::lock</a>, <a class="el" href="bridging__technology_8h_source.html#l00046">ast_bridge_technology::name</a>, <a class="el" href="bridging_8h_source.html#l00151">ast_bridge::num</a>, <a class="el" href="bridging_8c_source.html#l00585">smart_bridge_operation()</a>, <a class="el" href="bridging_8h_source.html#l00161">ast_bridge::technology</a>, <a class="el" href="bridging_8h_source.html#l00133">ast_bridge_channel::thread</a>, and <a class="el" href="bridging_8h_source.html#l00165">ast_bridge::thread</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01107"></a>01107 {
<a name="l01108"></a>01108    <span class="keyword">struct </span><a class="code" href="structast__bridge__channel.html" title="Structure that contains information regarding a channel in a bridge.">ast_bridge_channel</a> *bridge_channel = NULL;
<a name="l01109"></a>01109 
<a name="l01110"></a>01110    <a class="code" href="astobj2_8h.html#a3077056d07f6f9e348a54a743769bad5" title="Lock an object.">ao2_lock</a>(bridge0);
<a name="l01111"></a>01111    <a class="code" href="astobj2_8h.html#a3077056d07f6f9e348a54a743769bad5" title="Lock an object.">ao2_lock</a>(bridge1);
<a name="l01112"></a>01112 
<a name="l01113"></a>01113    <span class="comment">/* If the first bridge currently has 2 channels and is not capable of becoming a multimixing bridge we can not merge */</span>
<a name="l01114"></a>01114    <span class="keywordflow">if</span> ((bridge0-&gt;<a class="code" href="structast__bridge.html#a86cf672daa4e0ad11ad10efc894d19c8">num</a> + bridge1-&gt;<a class="code" href="structast__bridge.html#a86cf672daa4e0ad11ad10efc894d19c8">num</a>) &gt; 2 &amp;&amp; (!(bridge0-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a9461ee266923070466f95a76158f65cd">capabilities</a> &amp; <a class="code" href="bridging_8h.html#a815c9b3e933dfd4b8f523cf55caa5bbfabd40da8a498f3027c44dfa2e92d5f4ac">AST_BRIDGE_CAPABILITY_MULTIMIX</a>) &amp;&amp; !<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;bridge0-&gt;<a class="code" href="structast__bridge.html#af15c2e8b6df8ce0bf570af18aa890deb">feature_flags</a>, <a class="code" href="bridging__features_8h.html#a65c2644d2eadb31bcec0aaeb41cb3444a8f8162f42b84a7eba37bfb551c31743b">AST_BRIDGE_FLAG_SMART</a>))) {
<a name="l01115"></a>01115       <a class="code" href="astobj2_8h.html#a379cc936a320f2179f7beb422dc15230" title="Unlock an object.">ao2_unlock</a>(bridge1);
<a name="l01116"></a>01116       <a class="code" href="astobj2_8h.html#a379cc936a320f2179f7beb422dc15230" title="Unlock an object.">ao2_unlock</a>(bridge0);
<a name="l01117"></a>01117       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Can&apos;t merge bridge %p into bridge %p, multimix is needed and it could not be acquired.\n&quot;</span>, bridge1, bridge0);
<a name="l01118"></a>01118       <span class="keywordflow">return</span> -1;
<a name="l01119"></a>01119    }
<a name="l01120"></a>01120 
<a name="l01121"></a>01121    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Merging channels from bridge %p into bridge %p\n&quot;</span>, bridge1, bridge0);
<a name="l01122"></a>01122 
<a name="l01123"></a>01123    <span class="comment">/* Perform smart bridge operation on bridge we are merging into so it can change bridge technology if needed */</span>
<a name="l01124"></a>01124    <span class="keywordflow">if</span> (<a class="code" href="bridging_8c.html#a343a22dfa2196b0b3f6702a057ab07a4" title="Perform the smart bridge operation. Basically sees if a new bridge technology should...">smart_bridge_operation</a>(bridge0, NULL, bridge0-&gt;<a class="code" href="structast__bridge.html#a86cf672daa4e0ad11ad10efc894d19c8">num</a> + bridge1-&gt;<a class="code" href="structast__bridge.html#a86cf672daa4e0ad11ad10efc894d19c8">num</a>)) {
<a name="l01125"></a>01125       <a class="code" href="astobj2_8h.html#a379cc936a320f2179f7beb422dc15230" title="Unlock an object.">ao2_unlock</a>(bridge1);
<a name="l01126"></a>01126       <a class="code" href="astobj2_8h.html#a379cc936a320f2179f7beb422dc15230" title="Unlock an object.">ao2_unlock</a>(bridge0);
<a name="l01127"></a>01127       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Can&apos;t merge bridge %p into bridge %p, tried to perform smart bridge operation and failed.\n&quot;</span>, bridge1, bridge0);
<a name="l01128"></a>01128       <span class="keywordflow">return</span> -1;
<a name="l01129"></a>01129    }
<a name="l01130"></a>01130 
<a name="l01131"></a>01131    <span class="comment">/* If a thread is currently executing on bridge1 tell it to stop */</span>
<a name="l01132"></a>01132    <span class="keywordflow">if</span> (bridge1-&gt;<a class="code" href="structast__bridge.html#a01f75a9ad916f63a94e06a27635ba278">thread</a>) {
<a name="l01133"></a>01133       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Telling bridge thread on bridge %p to stop as it is being merged into %p\n&quot;</span>, bridge1, bridge0);
<a name="l01134"></a>01134       bridge1-&gt;<a class="code" href="structast__bridge.html#a01f75a9ad916f63a94e06a27635ba278">thread</a> = <a class="code" href="lock_8h.html#a873a83eb8196323194aac2bea23d794e">AST_PTHREADT_STOP</a>;
<a name="l01135"></a>01135    }
<a name="l01136"></a>01136 
<a name="l01137"></a>01137    <span class="comment">/* Move channels from bridge1 over to bridge0 */</span>
<a name="l01138"></a>01138    <span class="keywordflow">while</span> ((bridge_channel = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;bridge1-&gt;channels, entry))) {
<a name="l01139"></a>01139       <span class="comment">/* Tell the technology handling bridge1 that the bridge channel is leaving */</span>
<a name="l01140"></a>01140       <span class="keywordflow">if</span> (bridge1-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#ae453b9a1154d7db567f2f11c6adc5bc1">leave</a>) {
<a name="l01141"></a>01141          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Giving bridge technology %s notification that %p is leaving bridge %p\n&quot;</span>, bridge1-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, bridge_channel, bridge1);
<a name="l01142"></a>01142          <span class="keywordflow">if</span> (bridge1-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#ae453b9a1154d7db567f2f11c6adc5bc1">leave</a>(bridge1, bridge_channel)) {
<a name="l01143"></a>01143             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Bridge technology %s failed to allow %p to leave bridge %p\n&quot;</span>, bridge1-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, bridge_channel, bridge1);
<a name="l01144"></a>01144          }
<a name="l01145"></a>01145       }
<a name="l01146"></a>01146 
<a name="l01147"></a>01147       <span class="comment">/* Drop channel count and reference count on the bridge they are leaving */</span>
<a name="l01148"></a>01148       bridge1-&gt;<a class="code" href="structast__bridge.html#a86cf672daa4e0ad11ad10efc894d19c8">num</a>--;
<a name="l01149"></a>01149       <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(bridge1, -1);
<a name="l01150"></a>01150 
<a name="l01151"></a>01151       <a class="code" href="bridging_8c.html#a5ac27d55678ac62f4323954cea6adfb8" title="Helper function to remove a channel from the bridge array.">bridge_array_remove</a>(bridge1, bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a84d1435c5b8d387806714ea7079304b7">chan</a>);
<a name="l01152"></a>01152 
<a name="l01153"></a>01153       <span class="comment">/* Now add them into the bridge they are joining, increase channel count, and bump up reference count */</span>
<a name="l01154"></a>01154       bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a> = bridge0;
<a name="l01155"></a>01155       <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(&amp;bridge0-&gt;channels, bridge_channel, entry);
<a name="l01156"></a>01156       bridge0-&gt;<a class="code" href="structast__bridge.html#a86cf672daa4e0ad11ad10efc894d19c8">num</a>++;
<a name="l01157"></a>01157       <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(bridge0, +1);
<a name="l01158"></a>01158 
<a name="l01159"></a>01159       <a class="code" href="bridging_8c.html#af41fa7f06745400ef9a05e5ad821c951" title="Helper function to add a channel to the bridge array.">bridge_array_add</a>(bridge0, bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a84d1435c5b8d387806714ea7079304b7">chan</a>);
<a name="l01160"></a>01160 
<a name="l01161"></a>01161       <span class="comment">/* Make the channel compatible with the new bridge it is joining or else formats would go amuck */</span>
<a name="l01162"></a>01162       <a class="code" href="bridging_8c.html#ae87cc33842c5acf5477d40f83c7e6a24">bridge_make_compatible</a>(bridge0, bridge_channel);
<a name="l01163"></a>01163 
<a name="l01164"></a>01164       <span class="comment">/* Tell the technology handling bridge0 that the bridge channel is joining */</span>
<a name="l01165"></a>01165       <span class="keywordflow">if</span> (bridge0-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a8b369fed84f7c637d98be4861971590b">join</a>) {
<a name="l01166"></a>01166          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Giving bridge technology %s notification that %p is joining bridge %p\n&quot;</span>, bridge0-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, bridge_channel, bridge0);
<a name="l01167"></a>01167          <span class="keywordflow">if</span> (bridge0-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a8b369fed84f7c637d98be4861971590b">join</a>(bridge0, bridge_channel)) {
<a name="l01168"></a>01168             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Bridge technology %s failed to join %p to bridge %p\n&quot;</span>, bridge0-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, bridge_channel, bridge0);
<a name="l01169"></a>01169          }
<a name="l01170"></a>01170       }
<a name="l01171"></a>01171 
<a name="l01172"></a>01172       <span class="comment">/* Poke the bridge channel, this will cause it to wake up and execute the proper threading model for the new bridge it is in */</span>
<a name="l01173"></a>01173       pthread_kill(bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a01f75a9ad916f63a94e06a27635ba278">thread</a>, SIGURG);
<a name="l01174"></a>01174       <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01175"></a>01175       <a class="code" href="lock_8h.html#a02a91e30acdea6d13208d23636d37c87">ast_cond_signal</a>(&amp;bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>);
<a name="l01176"></a>01176       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01177"></a>01177    }
<a name="l01178"></a>01178 
<a name="l01179"></a>01179    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Merged channels from bridge %p into bridge %p\n&quot;</span>, bridge1, bridge0);
<a name="l01180"></a>01180 
<a name="l01181"></a>01181    <a class="code" href="astobj2_8h.html#a379cc936a320f2179f7beb422dc15230" title="Unlock an object.">ao2_unlock</a>(bridge1);
<a name="l01182"></a>01182    <a class="code" href="astobj2_8h.html#a379cc936a320f2179f7beb422dc15230" title="Unlock an object.">ao2_unlock</a>(bridge0);
<a name="l01183"></a>01183 
<a name="l01184"></a>01184    <span class="keywordflow">return</span> 0;
<a name="l01185"></a>01185 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab9ac166bd85c7c76b5e13170d3a2f047"></a><!-- doxytag: member="bridging.c::ast_bridge_new" ref="ab9ac166bd85c7c76b5e13170d3a2f047" args="(int capabilities, int flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__bridge.html">ast_bridge</a>* ast_bridge_new </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>capabilities</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Create a new bridge. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>capabilities</em>&nbsp;</td><td>The capabilities that we require to be used on the bridge </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>flags</em>&nbsp;</td><td>Flags that will alter the behavior of the bridge</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>a</em>&nbsp;</td><td>pointer to a new bridge on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>NULL</em>&nbsp;</td><td>on failure</td></tr>
  </table>
  </dd>
</dl>
<p>Example usage:</p>
<div class="fragment"><pre class="fragment"> <span class="keyword">struct </span><a class="code" href="structast__bridge.html" title="Structure that contains information about a bridge.">ast_bridge</a> *bridge;
 bridge = <a class="code" href="bridging_8h.html#ab9ac166bd85c7c76b5e13170d3a2f047" title="Create a new bridge.">ast_bridge_new</a>(<a class="code" href="bridging_8h.html#a815c9b3e933dfd4b8f523cf55caa5bbfaf483c951b835fcc35da807b6a4b12509">AST_BRIDGE_CAPABILITY_1TO1MIX</a>, <a class="code" href="bridging__features_8h.html#a65c2644d2eadb31bcec0aaeb41cb3444ae2c21ce82d946116c6488e97faedcd3d">AST_BRIDGE_FLAG_DISSOLVE</a>);
</pre></div><p>This creates a simple two party bridge that will be destroyed once one of the <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> hangs up. </p>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l00448">448</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00413">ao2_alloc</a>, <a class="el" href="astobj2_8h_source.html#l00459">ao2_ref</a>, <a class="el" href="bridging_8h_source.html#l00169">ast_bridge::array</a>, <a class="el" href="bridging_8h_source.html#l00173">ast_bridge::array_size</a>, <a class="el" href="bridging_8h_source.html#l00070">AST_BRIDGE_CAPABILITY_1TO1MIX</a>, <a class="el" href="bridging_8h_source.html#l00072">AST_BRIDGE_CAPABILITY_MULTIMIX</a>, <a class="el" href="bridging_8c_source.html#l00514">ast_bridge_destroy()</a>, <a class="el" href="bridging__features_8h_source.html#l00036">AST_BRIDGE_FLAG_SMART</a>, <a class="el" href="bridging_8c_source.html#l00448">ast_bridge_new()</a>, <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="lock_8h_source.html#l00082">AST_PTHREADT_NULL</a>, <a class="el" href="utils_8h_source.html#l00068">ast_set_flag</a>, <a class="el" href="bridging_8c_source.html#l00048">BRIDGE_ARRAY_START</a>, <a class="el" href="structast__bridge__technology.html#a4c02331d19c7cdb01704c544961130a1">ast_bridge_technology::create</a>, <a class="el" href="bridging_8c_source.html#l00420">destroy_bridge()</a>, <a class="el" href="bridging_8h_source.html#l00159">ast_bridge::feature_flags</a>, <a class="el" href="bridging_8c_source.html#l00385">find_best_technology()</a>, <a class="el" href="bridging__technology_8h_source.html#l00046">ast_bridge_technology::name</a>, <a class="el" href="bridging_8h_source.html#l00161">ast_bridge::technology</a>, and <a class="el" href="bridging_8h_source.html#l00165">ast_bridge::thread</a>.</p>

<p>Referenced by <a class="el" href="bridging_8c_source.html#l00448">ast_bridge_new()</a>, <a class="el" href="bridge__builtin__features_8c_source.html#l00157">feature_attended_transfer()</a>, and <a class="el" href="app__confbridge_8c_source.html#l00394">join_conference_bridge()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00449"></a>00449 {
<a name="l00450"></a>00450    <span class="keyword">struct </span><a class="code" href="structast__bridge.html" title="Structure that contains information about a bridge.">ast_bridge</a> *bridge = NULL;
<a name="l00451"></a>00451    <span class="keyword">struct </span><a class="code" href="structast__bridge__technology.html" title="Structure that is the essence of a bridge technology.">ast_bridge_technology</a> *bridge_technology = NULL;
<a name="l00452"></a>00452 
<a name="l00453"></a>00453    <span class="comment">/* If we need to be a smart bridge see if we can move between 1to1 and multimix bridges */</span>
<a name="l00454"></a>00454    <span class="keywordflow">if</span> (flags &amp; <a class="code" href="bridging__features_8h.html#a65c2644d2eadb31bcec0aaeb41cb3444a8f8162f42b84a7eba37bfb551c31743b">AST_BRIDGE_FLAG_SMART</a>) {
<a name="l00455"></a>00455       <span class="keyword">struct </span><a class="code" href="structast__bridge.html" title="Structure that contains information about a bridge.">ast_bridge</a> *other_bridge;
<a name="l00456"></a>00456 
<a name="l00457"></a>00457       <span class="keywordflow">if</span> (!(other_bridge = <a class="code" href="bridging_8h.html#ab9ac166bd85c7c76b5e13170d3a2f047" title="Create a new bridge.">ast_bridge_new</a>((<a class="code" href="res__jabber_8c.html#aa7afd7ba4814dbf49b1867019891fd14">capabilities</a> &amp; <a class="code" href="bridging_8h.html#a815c9b3e933dfd4b8f523cf55caa5bbfaf483c951b835fcc35da807b6a4b12509">AST_BRIDGE_CAPABILITY_1TO1MIX</a>) ? <a class="code" href="bridging_8h.html#a815c9b3e933dfd4b8f523cf55caa5bbfabd40da8a498f3027c44dfa2e92d5f4ac">AST_BRIDGE_CAPABILITY_MULTIMIX</a> : AST_BRIDGE_CAPABILITY_1TO1MIX, 0))) {
<a name="l00458"></a>00458          <span class="keywordflow">return</span> NULL;
<a name="l00459"></a>00459       }
<a name="l00460"></a>00460 
<a name="l00461"></a>00461       <a class="code" href="bridging_8h.html#a523fcc8aa1338afe507a3de9db0b84c3" title="Destroy a bridge.">ast_bridge_destroy</a>(other_bridge);
<a name="l00462"></a>00462    }
<a name="l00463"></a>00463 
<a name="l00464"></a>00464    <span class="comment">/* If capabilities were provided use our helper function to find the &quot;best&quot; bridge technology, otherwise we can</span>
<a name="l00465"></a>00465 <span class="comment">    * just look for the most basic capability needed, single 1to1 mixing. */</span>
<a name="l00466"></a>00466    bridge_technology = (<a class="code" href="res__jabber_8c.html#aa7afd7ba4814dbf49b1867019891fd14">capabilities</a> ? <a class="code" href="bridging_8c.html#a309ea60a7b664058b0f508c86079958e" title="Helper function used to find the &amp;quot;best&amp;quot; bridge technology given a specified...">find_best_technology</a>(<a class="code" href="res__jabber_8c.html#aa7afd7ba4814dbf49b1867019891fd14">capabilities</a>) : find_best_technology(<a class="code" href="bridging_8h.html#a815c9b3e933dfd4b8f523cf55caa5bbfaf483c951b835fcc35da807b6a4b12509">AST_BRIDGE_CAPABILITY_1TO1MIX</a>));
<a name="l00467"></a>00467 
<a name="l00468"></a>00468    <span class="comment">/* If no bridge technology was found we can&apos;t possibly do bridging so fail creation of the bridge */</span>
<a name="l00469"></a>00469    <span class="keywordflow">if</span> (!bridge_technology) {
<a name="l00470"></a>00470       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Failed to find a bridge technology to satisfy capabilities %d\n&quot;</span>, <a class="code" href="res__jabber_8c.html#aa7afd7ba4814dbf49b1867019891fd14">capabilities</a>);
<a name="l00471"></a>00471       <span class="keywordflow">return</span> NULL;
<a name="l00472"></a>00472    }
<a name="l00473"></a>00473 
<a name="l00474"></a>00474    <span class="comment">/* We have everything we need to create this bridge... so allocate the memory, link things together, and fire her up! */</span>
<a name="l00475"></a>00475    <span class="keywordflow">if</span> (!(bridge = <a class="code" href="astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*bridge), <a class="code" href="bridging_8c.html#a99f699e128b44c627baa3587d99a0661">destroy_bridge</a>))) {
<a name="l00476"></a>00476       <span class="keywordflow">return</span> NULL;
<a name="l00477"></a>00477    }
<a name="l00478"></a>00478 
<a name="l00479"></a>00479    bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a> = bridge_technology;
<a name="l00480"></a>00480    bridge-&gt;<a class="code" href="structast__bridge.html#a01f75a9ad916f63a94e06a27635ba278">thread</a> = <a class="code" href="lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>;
<a name="l00481"></a>00481 
<a name="l00482"></a>00482    <span class="comment">/* Create an array of pointers for the channels that will be joining us */</span>
<a name="l00483"></a>00483    bridge-&gt;<a class="code" href="structast__bridge.html#a740283531a557dc86a34a57ea220fb79">array</a> = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(<a class="code" href="bridging_8c.html#a19adb1771f07f8371b7ae604b54b4752">BRIDGE_ARRAY_START</a>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a>*));
<a name="l00484"></a>00484    bridge-&gt;<a class="code" href="structast__bridge.html#ae79741378b1094486dc2671c8bc861ef">array_size</a> = <a class="code" href="bridging_8c.html#a19adb1771f07f8371b7ae604b54b4752">BRIDGE_ARRAY_START</a>;
<a name="l00485"></a>00485 
<a name="l00486"></a>00486    <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(&amp;bridge-&gt;<a class="code" href="structast__bridge.html#af15c2e8b6df8ce0bf570af18aa890deb">feature_flags</a>, flags);
<a name="l00487"></a>00487 
<a name="l00488"></a>00488    <span class="comment">/* Pass off the bridge to the technology to manipulate if needed */</span>
<a name="l00489"></a>00489    <span class="keywordflow">if</span> (bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a4c02331d19c7cdb01704c544961130a1">create</a>) {
<a name="l00490"></a>00490       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Giving bridge technology %s the bridge structure %p to setup\n&quot;</span>, bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, bridge);
<a name="l00491"></a>00491       <span class="keywordflow">if</span> (bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a4c02331d19c7cdb01704c544961130a1">create</a>(bridge)) {
<a name="l00492"></a>00492          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Bridge technology %s failed to setup bridge structure %p\n&quot;</span>, bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, bridge);
<a name="l00493"></a>00493          <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(bridge, -1);
<a name="l00494"></a>00494          bridge = NULL;
<a name="l00495"></a>00495       }
<a name="l00496"></a>00496    }
<a name="l00497"></a>00497 
<a name="l00498"></a>00498    <span class="keywordflow">return</span> bridge;
<a name="l00499"></a>00499 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a66d6a521530f4fb208eb8ee33e257b6c"></a><!-- doxytag: member="bridging.c::ast_bridge_remove" ref="a66d6a521530f4fb208eb8ee33e257b6c" args="(struct ast_bridge *bridge, struct ast_channel *chan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_bridge_remove </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge.html">ast_bridge</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Remove a channel from a bridge. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>bridge</em>&nbsp;</td><td>Bridge that the channel is to be removed from </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel to remove</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure</td></tr>
  </table>
  </dd>
</dl>
<p>Example usage:</p>
<div class="fragment"><pre class="fragment"> <a class="code" href="bridging_8h.html#a66d6a521530f4fb208eb8ee33e257b6c" title="Remove a channel from a bridge.">ast_bridge_remove</a>(bridge, <a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>);
</pre></div><p>This removes the channel pointed to by the chan pointer from the bridge pointed to by the bridge pointer and <a class="el" href="structrequests.html">requests</a> that it be hung up. Control over the channel will NOT be given to the calling thread.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>This API call can be used on <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> that were added to the bridge using both ast_bridge_join and ast_bridge_impart. </dd></dl>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l01087">1087</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="astobj2_8c_source.html#l00147">ao2_lock()</a>, <a class="el" href="astobj2_8c_source.html#l00169">ao2_unlock()</a>, <a class="el" href="bridging_8c_source.html#l00118">ast_bridge_change_state()</a>, <a class="el" href="bridging_8h_source.html#l00092">AST_BRIDGE_CHANNEL_STATE_HANGUP</a>, and <a class="el" href="bridging_8c_source.html#l00204">find_bridge_channel()</a>.</p>

<p>Referenced by <a class="el" href="app__confbridge_8c_source.html#l00607">menu_callback()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01088"></a>01088 {
<a name="l01089"></a>01089    <span class="keyword">struct </span><a class="code" href="structast__bridge__channel.html" title="Structure that contains information regarding a channel in a bridge.">ast_bridge_channel</a> *bridge_channel = NULL;
<a name="l01090"></a>01090 
<a name="l01091"></a>01091    <a class="code" href="astobj2_8h.html#a3077056d07f6f9e348a54a743769bad5" title="Lock an object.">ao2_lock</a>(bridge);
<a name="l01092"></a>01092 
<a name="l01093"></a>01093    <span class="comment">/* Try to find the channel that we want to remove */</span>
<a name="l01094"></a>01094    <span class="keywordflow">if</span> (!(bridge_channel = <a class="code" href="bridging_8c.html#af76003eaee352a6e71c4411b99c87eb1" title="Helper function to find a bridge channel given a channel.">find_bridge_channel</a>(bridge, chan))) {
<a name="l01095"></a>01095       <a class="code" href="astobj2_8h.html#a379cc936a320f2179f7beb422dc15230" title="Unlock an object.">ao2_unlock</a>(bridge);
<a name="l01096"></a>01096       <span class="keywordflow">return</span> -1;
<a name="l01097"></a>01097    }
<a name="l01098"></a>01098 
<a name="l01099"></a>01099    <a class="code" href="bridging_8h.html#a03cde0e9535440a4f9f24ab921bea771" title="Change the state of a bridged channel.">ast_bridge_change_state</a>(bridge_channel, <a class="code" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7aeabb6e67917f26042d385634268af296">AST_BRIDGE_CHANNEL_STATE_HANGUP</a>);
<a name="l01100"></a>01100 
<a name="l01101"></a>01101    <a class="code" href="astobj2_8h.html#a379cc936a320f2179f7beb422dc15230" title="Unlock an object.">ao2_unlock</a>(bridge);
<a name="l01102"></a>01102 
<a name="l01103"></a>01103    <span class="keywordflow">return</span> 0;
<a name="l01104"></a>01104 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a85bc0d4138ac2af7b207d8f1325f051a"></a><!-- doxytag: member="bridging.c::ast_bridge_suspend" ref="a85bc0d4138ac2af7b207d8f1325f051a" args="(struct ast_bridge *bridge, struct ast_channel *chan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_bridge_suspend </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge.html">ast_bridge</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Suspend a channel temporarily from a bridge. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>bridge</em>&nbsp;</td><td>Bridge to suspend the channel from </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel to suspend</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure</td></tr>
  </table>
  </dd>
</dl>
<p>Example usage:</p>
<div class="fragment"><pre class="fragment"> <a class="code" href="bridging_8h.html#a85bc0d4138ac2af7b207d8f1325f051a" title="Suspend a channel temporarily from a bridge.">ast_bridge_suspend</a>(bridge, chan);
</pre></div><p>This suspends the channel pointed to by chan from the bridge pointed to by bridge temporarily. Control of the channel is given to the calling thread. This differs from ast_bridge_depart as the channel will not be removed from the bridge.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>This API call can be used on <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> that were added to the bridge using both ast_bridge_join and ast_bridge_impart. </dd></dl>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l01187">1187</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="astobj2_8c_source.html#l00147">ao2_lock()</a>, <a class="el" href="astobj2_8c_source.html#l00169">ao2_unlock()</a>, <a class="el" href="bridging_8c_source.html#l00750">bridge_channel_suspend()</a>, and <a class="el" href="bridging_8c_source.html#l00204">find_bridge_channel()</a>.</p>

<p>Referenced by <a class="el" href="app__confbridge_8c_source.html#l00485">leave_conference_bridge()</a>, <a class="el" href="app__confbridge_8c_source.html#l00253">post_join_marked()</a>, and <a class="el" href="app__confbridge_8c_source.html#l00320">post_join_unmarked()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01188"></a>01188 {
<a name="l01189"></a>01189    <span class="keyword">struct </span><a class="code" href="structast__bridge__channel.html" title="Structure that contains information regarding a channel in a bridge.">ast_bridge_channel</a> *bridge_channel;
<a name="l01190"></a>01190 
<a name="l01191"></a>01191    <a class="code" href="astobj2_8h.html#a3077056d07f6f9e348a54a743769bad5" title="Lock an object.">ao2_lock</a>(bridge);
<a name="l01192"></a>01192 
<a name="l01193"></a>01193    <span class="keywordflow">if</span> (!(bridge_channel = <a class="code" href="bridging_8c.html#af76003eaee352a6e71c4411b99c87eb1" title="Helper function to find a bridge channel given a channel.">find_bridge_channel</a>(bridge, chan))) {
<a name="l01194"></a>01194       <a class="code" href="astobj2_8h.html#a379cc936a320f2179f7beb422dc15230" title="Unlock an object.">ao2_unlock</a>(bridge);
<a name="l01195"></a>01195       <span class="keywordflow">return</span> -1;
<a name="l01196"></a>01196    }
<a name="l01197"></a>01197 
<a name="l01198"></a>01198    <a class="code" href="bridging_8c.html#a3a1111dba6ca9870165bccb229348b01" title="Internal function that suspends a channel from a bridge.">bridge_channel_suspend</a>(bridge, bridge_channel);
<a name="l01199"></a>01199 
<a name="l01200"></a>01200    <a class="code" href="astobj2_8h.html#a379cc936a320f2179f7beb422dc15230" title="Unlock an object.">ao2_unlock</a>(bridge);
<a name="l01201"></a>01201 
<a name="l01202"></a>01202    <span class="keywordflow">return</span> 0;
<a name="l01203"></a>01203 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="acd557b9305cf531bd1d66acbe39d12ee"></a><!-- doxytag: member="bridging.c::ast_bridge_technology_suspend" ref="acd557b9305cf531bd1d66acbe39d12ee" args="(struct ast_bridge_technology *technology)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_bridge_technology_suspend </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge__technology.html">ast_bridge_technology</a> *&nbsp;</td>
          <td class="paramname"> <em>technology</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Suspend a bridge technology from consideration. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>technology</em>&nbsp;</td><td>The bridge technology to suspend</td></tr>
  </table>
  </dd>
</dl>
<p>Example usage:</p>
<div class="fragment"><pre class="fragment"> <a class="code" href="bridging__technology_8h.html#acd557b9305cf531bd1d66acbe39d12ee" title="Suspend a bridge technology from consideration.">ast_bridge_technology_suspend</a>(&amp;simple_bridge_tech);
</pre></div><p>This suspends the bridge technology simple_bridge_tech from being considered when creating a new bridge. Existing bridges using the bridge technology are not affected. </p>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l01223">1223</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="bridging__technology_8h_source.html#l00076">ast_bridge_technology::suspended</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01224"></a>01224 {
<a name="l01225"></a>01225    technology-&gt;<a class="code" href="structast__bridge__technology.html#a2862ffde11c780129862e5549415a6f6">suspended</a> = 1;
<a name="l01226"></a>01226    <span class="keywordflow">return</span>;
<a name="l01227"></a>01227 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac74018e91ff4fc7374f6137dd76c40f5"></a><!-- doxytag: member="bridging.c::ast_bridge_technology_unregister" ref="ac74018e91ff4fc7374f6137dd76c40f5" args="(struct ast_bridge_technology *technology)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_bridge_technology_unregister </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge__technology.html">ast_bridge_technology</a> *&nbsp;</td>
          <td class="paramname"> <em>technology</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Unregister a bridge technology from use. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>technology</em>&nbsp;</td><td>The bridge technology to unregister</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure</td></tr>
  </table>
  </dd>
</dl>
<p>Example usage:</p>
<div class="fragment"><pre class="fragment"> <a class="code" href="bridging__technology_8h.html#ac74018e91ff4fc7374f6137dd76c40f5" title="Unregister a bridge technology from use.">ast_bridge_technology_unregister</a>(&amp;simple_bridge_tech);
</pre></div><p>This unregisters a bridge technlogy declared as the structure simple_bridge_tech with the bridging core. It will no longer be considered when creating a new bridge. </p>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l00095">95</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00564">AST_RWLIST_REMOVE_CURRENT</a>, <a class="el" href="linkedlists_8h_source.html#l00541">AST_RWLIST_TRAVERSE_SAFE_BEGIN</a>, <a class="el" href="linkedlists_8h_source.html#l00601">AST_RWLIST_TRAVERSE_SAFE_END</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, <a class="el" href="logger_8h_source.html#l00079">ast_verbose</a>, <a class="el" href="bridging__technology_8h_source.html#l00046">ast_bridge_technology::name</a>, <a class="el" href="asterisk_8c_source.html#l00174">option_verbose</a>, and <a class="el" href="logger_8h_source.html#l00042">VERBOSE_PREFIX_2</a>.</p>

<p>Referenced by <a class="el" href="bridge__multiplexed_8c_source.html#l00386">unload_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00096"></a>00096 {
<a name="l00097"></a>00097    <span class="keyword">struct </span><a class="code" href="structast__bridge__technology.html" title="Structure that is the essence of a bridge technology.">ast_bridge_technology</a> *current = NULL;
<a name="l00098"></a>00098 
<a name="l00099"></a>00099    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structbridge__technologies.html">bridge_technologies</a>);
<a name="l00100"></a>00100 
<a name="l00101"></a>00101    <span class="comment">/* Ensure the bridge technology is registered before removing it */</span>
<a name="l00102"></a>00102    <a class="code" href="linkedlists_8h.html#a21be6da4b2146b04b4868c2be5cae750">AST_RWLIST_TRAVERSE_SAFE_BEGIN</a>(&amp;<a class="code" href="structbridge__technologies.html">bridge_technologies</a>, current, entry) {
<a name="l00103"></a>00103       <span class="keywordflow">if</span> (current == technology) {
<a name="l00104"></a>00104          <a class="code" href="linkedlists_8h.html#a02212548652c9eb0f3db38dc4e4bd285">AST_RWLIST_REMOVE_CURRENT</a>(entry);
<a name="l00105"></a>00105          <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#gaa294d0efa6a89c1a3d162787cac4fff5">option_verbose</a> &gt; 1) {
<a name="l00106"></a>00106             <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<a class="code" href="logger_8h.html#a5623b2747e49964e0eae2795057bc92e">VERBOSE_PREFIX_2</a> <span class="stringliteral">&quot;Unregistered bridge technology %s\n&quot;</span>, technology-&gt;<a class="code" href="structast__bridge__technology.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);
<a name="l00107"></a>00107          }
<a name="l00108"></a>00108          <span class="keywordflow">break</span>;
<a name="l00109"></a>00109       }
<a name="l00110"></a>00110    }
<a name="l00111"></a>00111    <a class="code" href="linkedlists_8h.html#a6bf0e81cb6ef01532ddebaba68f6de28">AST_RWLIST_TRAVERSE_SAFE_END</a>;
<a name="l00112"></a>00112 
<a name="l00113"></a>00113    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structbridge__technologies.html">bridge_technologies</a>);
<a name="l00114"></a>00114 
<a name="l00115"></a>00115    <span class="keywordflow">return</span> current ? 0 : -1;
<a name="l00116"></a>00116 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a24bb22d467a5f840fe8c954f9c7624d1"></a><!-- doxytag: member="bridging.c::ast_bridge_technology_unsuspend" ref="a24bb22d467a5f840fe8c954f9c7624d1" args="(struct ast_bridge_technology *technology)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_bridge_technology_unsuspend </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge__technology.html">ast_bridge_technology</a> *&nbsp;</td>
          <td class="paramname"> <em>technology</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Unsuspend a bridge technology. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>technology</em>&nbsp;</td><td>The bridge technology to unsuspend</td></tr>
  </table>
  </dd>
</dl>
<p>Example usage:</p>
<div class="fragment"><pre class="fragment"> <a class="code" href="bridging__technology_8h.html#a24bb22d467a5f840fe8c954f9c7624d1" title="Unsuspend a bridge technology.">ast_bridge_technology_unsuspend</a>(&amp;simple_bridge_tech);
</pre></div><p>This makes the bridge technology simple_bridge_tech considered when creating a new bridge again. </p>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l01229">1229</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="bridging__technology_8h_source.html#l00076">ast_bridge_technology::suspended</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01230"></a>01230 {
<a name="l01231"></a>01231    technology-&gt;<a class="code" href="structast__bridge__technology.html#a2862ffde11c780129862e5549415a6f6">suspended</a> = 0;
<a name="l01232"></a>01232    <span class="keywordflow">return</span>;
<a name="l01233"></a>01233 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aab4cd1153d39a6744eca6a84d5255820"></a><!-- doxytag: member="bridging.c::ast_bridge_unsuspend" ref="aab4cd1153d39a6744eca6a84d5255820" args="(struct ast_bridge *bridge, struct ast_channel *chan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_bridge_unsuspend </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge.html">ast_bridge</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Unsuspend a channel from a bridge. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>bridge</em>&nbsp;</td><td>Bridge to unsuspend the channel from </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel to unsuspend</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure</td></tr>
  </table>
  </dd>
</dl>
<p>Example usage:</p>
<div class="fragment"><pre class="fragment"> <a class="code" href="bridging_8h.html#aab4cd1153d39a6744eca6a84d5255820" title="Unsuspend a channel from a bridge.">ast_bridge_unsuspend</a>(bridge, <a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>);
</pre></div><p>This unsuspends the channel pointed to by chan from the bridge pointed to by bridge. The bridge will go back to handling the channel once this function returns.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>You must not mess with the channel once this function returns. Doing so may result in bad things happening. </dd></dl>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l01205">1205</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="astobj2_8c_source.html#l00147">ao2_lock()</a>, <a class="el" href="astobj2_8c_source.html#l00169">ao2_unlock()</a>, <a class="el" href="bridging_8c_source.html#l00764">bridge_channel_unsuspend()</a>, and <a class="el" href="bridging_8c_source.html#l00204">find_bridge_channel()</a>.</p>

<p>Referenced by <a class="el" href="app__confbridge_8c_source.html#l00485">leave_conference_bridge()</a>, <a class="el" href="app__confbridge_8c_source.html#l00253">post_join_marked()</a>, and <a class="el" href="app__confbridge_8c_source.html#l00320">post_join_unmarked()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01206"></a>01206 {
<a name="l01207"></a>01207    <span class="keyword">struct </span><a class="code" href="structast__bridge__channel.html" title="Structure that contains information regarding a channel in a bridge.">ast_bridge_channel</a> *bridge_channel;
<a name="l01208"></a>01208 
<a name="l01209"></a>01209    <a class="code" href="astobj2_8h.html#a3077056d07f6f9e348a54a743769bad5" title="Lock an object.">ao2_lock</a>(bridge);
<a name="l01210"></a>01210 
<a name="l01211"></a>01211    <span class="keywordflow">if</span> (!(bridge_channel = <a class="code" href="bridging_8c.html#af76003eaee352a6e71c4411b99c87eb1" title="Helper function to find a bridge channel given a channel.">find_bridge_channel</a>(bridge, chan))) {
<a name="l01212"></a>01212       <a class="code" href="astobj2_8h.html#a379cc936a320f2179f7beb422dc15230" title="Unlock an object.">ao2_unlock</a>(bridge);
<a name="l01213"></a>01213       <span class="keywordflow">return</span> -1;
<a name="l01214"></a>01214    }
<a name="l01215"></a>01215 
<a name="l01216"></a>01216    <a class="code" href="bridging_8c.html#a761e80878d0be1580c163dda4553dc37" title="Internal function that unsuspends a channel from a bridge.">bridge_channel_unsuspend</a>(bridge, bridge_channel);
<a name="l01217"></a>01217 
<a name="l01218"></a>01218    <a class="code" href="astobj2_8h.html#a379cc936a320f2179f7beb422dc15230" title="Unlock an object.">ao2_unlock</a>(bridge);
<a name="l01219"></a>01219 
<a name="l01220"></a>01220    <span class="keywordflow">return</span> 0;
<a name="l01221"></a>01221 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af41fa7f06745400ef9a05e5ad821c951"></a><!-- doxytag: member="bridging.c::bridge_array_add" ref="af41fa7f06745400ef9a05e5ad821c951" args="(struct ast_bridge *bridge, struct ast_channel *chan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bridge_array_add </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge.html">ast_bridge</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Helper function to add a channel to the bridge array. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>This function assumes the bridge is locked. </dd></dl>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l00149">149</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="bridging_8h_source.html#l00169">ast_bridge::array</a>, <a class="el" href="bridging_8h_source.html#l00171">ast_bridge::array_num</a>, <a class="el" href="bridging_8h_source.html#l00173">ast_bridge::array_size</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="astmm_8h_source.html#l00093">ast_realloc</a>, <a class="el" href="bridging_8c_source.html#l00051">BRIDGE_ARRAY_GROW</a>, <a class="el" href="bridging_8c_source.html#l00135">bridge_poke()</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, and <a class="el" href="bridging_8h_source.html#l00153">ast_bridge::waiting</a>.</p>

<p>Referenced by <a class="el" href="bridging_8c_source.html#l01106">ast_bridge_merge()</a>, <a class="el" href="bridging_8c_source.html#l00860">bridge_channel_join()</a>, and <a class="el" href="bridging_8c_source.html#l00764">bridge_channel_unsuspend()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00150"></a>00150 {
<a name="l00151"></a>00151    <span class="comment">/* We have to make sure the bridge thread is not using the bridge array before messing with it */</span>
<a name="l00152"></a>00152    <span class="keywordflow">while</span> (bridge-&gt;<a class="code" href="structast__bridge.html#a4227e2fa9e7151f8c1339021e54dee10">waiting</a>) {
<a name="l00153"></a>00153       <a class="code" href="bridging_8c.html#a57c77ab33579cf3f1ddb054b758a826c" title="Helper function to poke the bridge thread.">bridge_poke</a>(bridge);
<a name="l00154"></a>00154       sched_yield();
<a name="l00155"></a>00155    }
<a name="l00156"></a>00156 
<a name="l00157"></a>00157    bridge-&gt;<a class="code" href="structast__bridge.html#a740283531a557dc86a34a57ea220fb79">array</a>[bridge-&gt;<a class="code" href="structast__bridge.html#af2be787f5565bf34958c3453f93886ce">array_num</a>++] = chan;
<a name="l00158"></a>00158 
<a name="l00159"></a>00159    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Added channel %s(%p) to bridge array on %p, new count is %d\n&quot;</span>, chan-&gt;name, chan, bridge, (<span class="keywordtype">int</span>)bridge-&gt;<a class="code" href="structast__bridge.html#af2be787f5565bf34958c3453f93886ce">array_num</a>);
<a name="l00160"></a>00160 
<a name="l00161"></a>00161    <span class="comment">/* If the next addition of a channel will exceed our array size grow it out */</span>
<a name="l00162"></a>00162    <span class="keywordflow">if</span> (bridge-&gt;<a class="code" href="structast__bridge.html#af2be787f5565bf34958c3453f93886ce">array_num</a> == bridge-&gt;<a class="code" href="structast__bridge.html#ae79741378b1094486dc2671c8bc861ef">array_size</a>) {
<a name="l00163"></a>00163       <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> **tmp;
<a name="l00164"></a>00164       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Growing bridge array on %p from %d to %d\n&quot;</span>, bridge, (<span class="keywordtype">int</span>)bridge-&gt;<a class="code" href="structast__bridge.html#ae79741378b1094486dc2671c8bc861ef">array_size</a>, (<span class="keywordtype">int</span>)bridge-&gt;<a class="code" href="structast__bridge.html#ae79741378b1094486dc2671c8bc861ef">array_size</a> + <a class="code" href="bridging_8c.html#a2bb5c159af5ed3ac286e5129999b351b">BRIDGE_ARRAY_GROW</a>);
<a name="l00165"></a>00165       <span class="keywordflow">if</span> (!(tmp = <a class="code" href="astmm_8h.html#aa852314efa0cfeecee97ffc51b649734">ast_realloc</a>(bridge-&gt;<a class="code" href="structast__bridge.html#a740283531a557dc86a34a57ea220fb79">array</a>, (bridge-&gt;<a class="code" href="structast__bridge.html#ae79741378b1094486dc2671c8bc861ef">array_size</a> + <a class="code" href="bridging_8c.html#a2bb5c159af5ed3ac286e5129999b351b">BRIDGE_ARRAY_GROW</a>) * <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *)))) {
<a name="l00166"></a>00166          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to allocate more space for another channel on bridge &apos;%p&apos;, this is not going to end well\n&quot;</span>, bridge);
<a name="l00167"></a>00167          <span class="keywordflow">return</span>;
<a name="l00168"></a>00168       }
<a name="l00169"></a>00169       bridge-&gt;<a class="code" href="structast__bridge.html#a740283531a557dc86a34a57ea220fb79">array</a> = tmp;
<a name="l00170"></a>00170       bridge-&gt;<a class="code" href="structast__bridge.html#ae79741378b1094486dc2671c8bc861ef">array_size</a> += <a class="code" href="bridging_8c.html#a2bb5c159af5ed3ac286e5129999b351b">BRIDGE_ARRAY_GROW</a>;
<a name="l00171"></a>00171    }
<a name="l00172"></a>00172 
<a name="l00173"></a>00173    <span class="keywordflow">return</span>;
<a name="l00174"></a>00174 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5ac27d55678ac62f4323954cea6adfb8"></a><!-- doxytag: member="bridging.c::bridge_array_remove" ref="a5ac27d55678ac62f4323954cea6adfb8" args="(struct ast_bridge *bridge, struct ast_channel *chan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bridge_array_remove </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge.html">ast_bridge</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Helper function to remove a channel from the bridge array. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>This function assumes the bridge is locked. </dd></dl>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l00180">180</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="bridging_8h_source.html#l00169">ast_bridge::array</a>, <a class="el" href="bridging_8h_source.html#l00171">ast_bridge::array_num</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="bridging_8c_source.html#l00135">bridge_poke()</a>, and <a class="el" href="bridging_8h_source.html#l00153">ast_bridge::waiting</a>.</p>

<p>Referenced by <a class="el" href="bridging_8c_source.html#l01106">ast_bridge_merge()</a>, <a class="el" href="bridging_8c_source.html#l00860">bridge_channel_join()</a>, and <a class="el" href="bridging_8c_source.html#l00750">bridge_channel_suspend()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00181"></a>00181 {
<a name="l00182"></a>00182    <span class="keywordtype">int</span> i;
<a name="l00183"></a>00183 
<a name="l00184"></a>00184    <span class="comment">/* We have to make sure the bridge thread is not using the bridge array before messing with it */</span>
<a name="l00185"></a>00185    <span class="keywordflow">while</span> (bridge-&gt;<a class="code" href="structast__bridge.html#a4227e2fa9e7151f8c1339021e54dee10">waiting</a>) {
<a name="l00186"></a>00186       <a class="code" href="bridging_8c.html#a57c77ab33579cf3f1ddb054b758a826c" title="Helper function to poke the bridge thread.">bridge_poke</a>(bridge);
<a name="l00187"></a>00187       sched_yield();
<a name="l00188"></a>00188    }
<a name="l00189"></a>00189 
<a name="l00190"></a>00190    <span class="keywordflow">for</span> (i = 0; i &lt; bridge-&gt;<a class="code" href="structast__bridge.html#af2be787f5565bf34958c3453f93886ce">array_num</a>; i++) {
<a name="l00191"></a>00191       <span class="keywordflow">if</span> (bridge-&gt;<a class="code" href="structast__bridge.html#a740283531a557dc86a34a57ea220fb79">array</a>[i] == chan) {
<a name="l00192"></a>00192          bridge-&gt;<a class="code" href="structast__bridge.html#a740283531a557dc86a34a57ea220fb79">array</a>[i] = (bridge-&gt;<a class="code" href="structast__bridge.html#a740283531a557dc86a34a57ea220fb79">array</a>[(bridge-&gt;<a class="code" href="structast__bridge.html#af2be787f5565bf34958c3453f93886ce">array_num</a> - 1)] != chan ? bridge-&gt;<a class="code" href="structast__bridge.html#a740283531a557dc86a34a57ea220fb79">array</a>[(bridge-&gt;<a class="code" href="structast__bridge.html#af2be787f5565bf34958c3453f93886ce">array_num</a> - 1)] : NULL);
<a name="l00193"></a>00193          bridge-&gt;<a class="code" href="structast__bridge.html#a740283531a557dc86a34a57ea220fb79">array</a>[(bridge-&gt;<a class="code" href="structast__bridge.html#af2be787f5565bf34958c3453f93886ce">array_num</a> - 1)] = NULL;
<a name="l00194"></a>00194          bridge-&gt;<a class="code" href="structast__bridge.html#af2be787f5565bf34958c3453f93886ce">array_num</a>--;
<a name="l00195"></a>00195          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Removed channel %p from bridge array on %p, new count is %d\n&quot;</span>, chan, bridge, (<span class="keywordtype">int</span>)bridge-&gt;<a class="code" href="structast__bridge.html#af2be787f5565bf34958c3453f93886ce">array_num</a>);
<a name="l00196"></a>00196          <span class="keywordflow">break</span>;
<a name="l00197"></a>00197       }
<a name="l00198"></a>00198    }
<a name="l00199"></a>00199 
<a name="l00200"></a>00200    <span class="keywordflow">return</span>;
<a name="l00201"></a>00201 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4804095baaf47eea8ad5f67f98588ad2"></a><!-- doxytag: member="bridging.c::bridge_channel_dtmf_stream" ref="a4804095baaf47eea8ad5f67f98588ad2" args="(struct ast_bridge *bridge, struct ast_bridge_channel *bridge_channel)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bridge_channel_dtmf_stream </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge.html">ast_bridge</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__bridge__channel.html">ast_bridge_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge_channel</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Internal function that plays back DTMF on a bridge channel. </p>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l00844">844</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="bridging_8c_source.html#l00118">ast_bridge_change_state()</a>, <a class="el" href="bridging_8h_source.html#l00088">AST_BRIDGE_CHANNEL_STATE_WAIT</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="app_8c_source.html#l00314">ast_dtmf_stream()</a>, <a class="el" href="bridging_8h_source.html#l00125">ast_bridge_channel::chan</a>, and <a class="el" href="bridging_8h_source.html#l00141">ast_bridge_channel::dtmf_stream_q</a>.</p>

<p>Referenced by <a class="el" href="bridging_8c_source.html#l00860">bridge_channel_join()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00845"></a>00845 {
<a name="l00846"></a>00846    <span class="keywordtype">char</span> dtmf_q[8] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00847"></a>00847 
<a name="l00848"></a>00848    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(dtmf_q, bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#ab17441f7a62e1f44132a5c2a5bb69d27">dtmf_stream_q</a>, <span class="keyword">sizeof</span>(dtmf_q));
<a name="l00849"></a>00849    bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#ab17441f7a62e1f44132a5c2a5bb69d27">dtmf_stream_q</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00850"></a>00850 
<a name="l00851"></a>00851    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Playing DTMF stream &apos;%s&apos; out to bridge channel %p\n&quot;</span>, dtmf_q, bridge_channel);
<a name="l00852"></a>00852    <a class="code" href="app_8h.html#af20b8ac2e28e659be352bbaecdf0ab03" title="Send DTMF to a channel.">ast_dtmf_stream</a>(bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, NULL, dtmf_q, 250, 0);
<a name="l00853"></a>00853 
<a name="l00854"></a>00854    <a class="code" href="bridging_8h.html#a03cde0e9535440a4f9f24ab921bea771" title="Change the state of a bridged channel.">ast_bridge_change_state</a>(bridge_channel, <a class="code" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7a82e437d5aa10df5114a21ae794bce625">AST_BRIDGE_CHANNEL_STATE_WAIT</a>);
<a name="l00855"></a>00855 
<a name="l00856"></a>00856    <span class="keywordflow">return</span>;
<a name="l00857"></a>00857 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a372ceb5c3b7e76beb174da7fa59f84dc"></a><!-- doxytag: member="bridging.c::bridge_channel_feature" ref="a372ceb5c3b7e76beb174da7fa59f84dc" args="(struct ast_bridge *bridge, struct ast_bridge_channel *bridge_channel)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bridge_channel_feature </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge.html">ast_bridge</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__bridge__channel.html">ast_bridge_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge_channel</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Internal function that executes a feature on a bridge channel. </p>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l00778">778</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="bridging_8c_source.html#l00118">ast_bridge_change_state()</a>, <a class="el" href="bridging_8h_source.html#l00088">AST_BRIDGE_CHANNEL_STATE_WAIT</a>, <a class="el" href="bridging_8c_source.html#l01332">ast_bridge_dtmf_stream()</a>, <a class="el" href="utils_8h_source.html#l00075">ast_clear_flag</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="channel_8h_source.html#l00551">AST_FLAG_END_DTMF_ONLY</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="utils_8h_source.html#l00068">ast_set_flag</a>, <a class="el" href="channel_8c_source.html#l02400">ast_waitfordigit()</a>, <a class="el" href="bridging__features_8h_source.html#l00078">ast_bridge_features_hook::callback</a>, <a class="el" href="bridging_8h_source.html#l00125">ast_bridge_channel::chan</a>, <a class="el" href="bridging__features_8h_source.html#l00076">ast_bridge_features_hook::dtmf</a>, <a class="el" href="bridging_8h_source.html#l00167">ast_bridge::features</a>, <a class="el" href="bridging_8h_source.html#l00139">ast_bridge_channel::features</a>, <a class="el" href="bridging__features_8h_source.html#l00080">ast_bridge_features_hook::hook_pvt</a>, and <a class="el" href="bridging__features_8h_source.html#l00069">MAXIMUM_DTMF_FEATURE_STRING</a>.</p>

<p>Referenced by <a class="el" href="bridging_8c_source.html#l00860">bridge_channel_join()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00779"></a>00779 {
<a name="l00780"></a>00780    <span class="keyword">struct </span><a class="code" href="structast__bridge__features.html" title="Structure that contains features information.">ast_bridge_features</a> *features = (bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a65633fdc6178dc8d9f754fda0166d16e">features</a> ? bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a65633fdc6178dc8d9f754fda0166d16e">features</a> : &amp;bridge-&gt;<a class="code" href="structast__bridge.html#aa5f7287d4bbab0f62a1bae18af89171d">features</a>);
<a name="l00781"></a>00781    <span class="keyword">struct </span><a class="code" href="structast__bridge__features__hook.html" title="Structure that is the essence of a features hook.">ast_bridge_features_hook</a> *hook = NULL;
<a name="l00782"></a>00782    <span class="keywordtype">char</span> <a class="code" href="structast__bridge__features__hook.html#a33464dba524e69ccf4c908b486d8301e">dtmf</a>[<a class="code" href="bridging__features_8h.html#a8f882f130b89dd63d656d176884095a1" title="Maximum length of a DTMF feature string.">MAXIMUM_DTMF_FEATURE_STRING</a>] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00783"></a>00783    <span class="keywordtype">int</span> look_for_dtmf = 1, dtmf_len = 0;
<a name="l00784"></a>00784 
<a name="l00785"></a>00785    <span class="comment">/* The channel is now under our control and we don&apos;t really want any begin frames to do our DTMF matching so disable &apos;em at the core level */</span>
<a name="l00786"></a>00786    <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a668ac945c84f50becaca2a6134e64058">AST_FLAG_END_DTMF_ONLY</a>);
<a name="l00787"></a>00787 
<a name="l00788"></a>00788    <span class="comment">/* Wait for DTMF on the channel and put it into a buffer. If the buffer matches any feature hook execute the hook. */</span>
<a name="l00789"></a>00789    <span class="keywordflow">while</span> (look_for_dtmf) {
<a name="l00790"></a>00790       <span class="keywordtype">int</span> res = <a class="code" href="channel_8h.html#a050bec9a4abc1a599b6573a6091b080c" title="Waits for a digit.">ast_waitfordigit</a>(bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, 3000);
<a name="l00791"></a>00791 
<a name="l00792"></a>00792       <span class="comment">/* If the above timed out simply exit */</span>
<a name="l00793"></a>00793       <span class="keywordflow">if</span> (!res) {
<a name="l00794"></a>00794          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;DTMF feature string collection on bridge channel %p timed out\n&quot;</span>, bridge_channel);
<a name="l00795"></a>00795          <span class="keywordflow">break</span>;
<a name="l00796"></a>00796       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l00797"></a>00797          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;DTMF feature string collection failed on bridge channel %p for some reason\n&quot;</span>, bridge_channel);
<a name="l00798"></a>00798          <span class="keywordflow">break</span>;
<a name="l00799"></a>00799       }
<a name="l00800"></a>00800 
<a name="l00801"></a>00801       <span class="comment">/* Add the above DTMF into the DTMF string so we can do our matching */</span>
<a name="l00802"></a>00802       dtmf[dtmf_len++] = res;
<a name="l00803"></a>00803 
<a name="l00804"></a>00804       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;DTMF feature string on bridge channel %p is now &apos;%s&apos;\n&quot;</span>, bridge_channel, dtmf);
<a name="l00805"></a>00805 
<a name="l00806"></a>00806       <span class="comment">/* Assume that we do not want to look for DTMF any longer */</span>
<a name="l00807"></a>00807       look_for_dtmf = 0;
<a name="l00808"></a>00808 
<a name="l00809"></a>00809       <span class="comment">/* See if a DTMF feature hook matches or can match */</span>
<a name="l00810"></a>00810       <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;features-&gt;hooks, hook, entry) {
<a name="l00811"></a>00811          <span class="comment">/* If this hook matches just break out now */</span>
<a name="l00812"></a>00812          <span class="keywordflow">if</span> (!strcmp(hook-&gt;<a class="code" href="structast__bridge__features__hook.html#a33464dba524e69ccf4c908b486d8301e">dtmf</a>, dtmf)) {
<a name="l00813"></a>00813             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;DTMF feature hook %p matched DTMF string &apos;%s&apos; on bridge channel %p\n&quot;</span>, hook, dtmf, bridge_channel);
<a name="l00814"></a>00814             <span class="keywordflow">break</span>;
<a name="l00815"></a>00815          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strncmp(hook-&gt;<a class="code" href="structast__bridge__features__hook.html#a33464dba524e69ccf4c908b486d8301e">dtmf</a>, dtmf, dtmf_len)) {
<a name="l00816"></a>00816             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;DTMF feature hook %p can match DTMF string &apos;%s&apos;, it wants &apos;%s&apos;, on bridge channel %p\n&quot;</span>, hook, dtmf, hook-&gt;<a class="code" href="structast__bridge__features__hook.html#a33464dba524e69ccf4c908b486d8301e">dtmf</a>, bridge_channel);
<a name="l00817"></a>00817             look_for_dtmf = 1;
<a name="l00818"></a>00818          } <span class="keywordflow">else</span> {
<a name="l00819"></a>00819             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;DTMF feature hook %p does not match DTMF string &apos;%s&apos;, it wants &apos;%s&apos;, on bridge channel %p\n&quot;</span>, hook, dtmf, hook-&gt;<a class="code" href="structast__bridge__features__hook.html#a33464dba524e69ccf4c908b486d8301e">dtmf</a>, bridge_channel);
<a name="l00820"></a>00820          }
<a name="l00821"></a>00821       }
<a name="l00822"></a>00822 
<a name="l00823"></a>00823       <span class="comment">/* If we have reached the maximum length of a DTMF feature string bail out */</span>
<a name="l00824"></a>00824       <span class="keywordflow">if</span> (dtmf_len == <a class="code" href="bridging__features_8h.html#a8f882f130b89dd63d656d176884095a1" title="Maximum length of a DTMF feature string.">MAXIMUM_DTMF_FEATURE_STRING</a>) {
<a name="l00825"></a>00825          <span class="keywordflow">break</span>;
<a name="l00826"></a>00826       }
<a name="l00827"></a>00827    }
<a name="l00828"></a>00828 
<a name="l00829"></a>00829    <span class="comment">/* Since we are done bringing DTMF in return to using both begin and end frames */</span>
<a name="l00830"></a>00830    <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a668ac945c84f50becaca2a6134e64058">AST_FLAG_END_DTMF_ONLY</a>);
<a name="l00831"></a>00831 
<a name="l00832"></a>00832    <span class="comment">/* If a hook was actually matched execute it on this channel, otherwise stream up the DTMF to the other channels */</span>
<a name="l00833"></a>00833    <span class="keywordflow">if</span> (hook) {
<a name="l00834"></a>00834       hook-&gt;<a class="code" href="structast__bridge__features__hook.html#ad69a4c6a493af02d5203d747834cb329">callback</a>(bridge, bridge_channel, hook-&gt;<a class="code" href="structast__bridge__features__hook.html#ad6640f8898b13ff6d292522ee3d4973f">hook_pvt</a>);
<a name="l00835"></a>00835    } <span class="keywordflow">else</span> {
<a name="l00836"></a>00836       <a class="code" href="bridging__features_8h.html#aa60bc7df6be7b53bbb572ab5fcecb5aa" title="Play a DTMF stream into a bridge, optionally not to a given channel.">ast_bridge_dtmf_stream</a>(bridge, dtmf, bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a84d1435c5b8d387806714ea7079304b7">chan</a>);
<a name="l00837"></a>00837       <a class="code" href="bridging_8h.html#a03cde0e9535440a4f9f24ab921bea771" title="Change the state of a bridged channel.">ast_bridge_change_state</a>(bridge_channel, <a class="code" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7a82e437d5aa10df5114a21ae794bce625">AST_BRIDGE_CHANNEL_STATE_WAIT</a>);
<a name="l00838"></a>00838    }
<a name="l00839"></a>00839 
<a name="l00840"></a>00840    <span class="keywordflow">return</span>;
<a name="l00841"></a>00841 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a63538fa2bdf0d9aa20742f12ee86bef1"></a><!-- doxytag: member="bridging.c::bridge_channel_join" ref="a63538fa2bdf0d9aa20742f12ee86bef1" args="(struct ast_bridge_channel *bridge_channel)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7">ast_bridge_channel_state</a> bridge_channel_join </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge__channel.html">ast_bridge_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge_channel</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Join a channel to a bridge and handle anything the bridge may want us to do. </p>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l00860">860</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="astobj2_8c_source.html#l00147">ao2_lock()</a>, <a class="el" href="astobj2_8h_source.html#l00459">ao2_ref</a>, <a class="el" href="astobj2_8c_source.html#l00169">ao2_unlock()</a>, <a class="el" href="bridging_8h_source.html#l00076">AST_BRIDGE_CAPABILITY_MULTITHREADED</a>, <a class="el" href="bridging_8h_source.html#l00078">AST_BRIDGE_CAPABILITY_THREAD</a>, <a class="el" href="bridging_8c_source.html#l00118">ast_bridge_change_state()</a>, <a class="el" href="bridging_8h_source.html#l00098">AST_BRIDGE_CHANNEL_STATE_DTMF</a>, <a class="el" href="bridging_8h_source.html#l00090">AST_BRIDGE_CHANNEL_STATE_END</a>, <a class="el" href="bridging_8h_source.html#l00096">AST_BRIDGE_CHANNEL_STATE_FEATURE</a>, <a class="el" href="bridging_8h_source.html#l00092">AST_BRIDGE_CHANNEL_STATE_HANGUP</a>, <a class="el" href="bridging_8h_source.html#l00088">AST_BRIDGE_CHANNEL_STATE_WAIT</a>, <a class="el" href="bridging__features_8h_source.html#l00036">AST_BRIDGE_FLAG_SMART</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="frame_8c_source.html#l00573">ast_getformatname()</a>, <a class="el" href="linkedlists_8h_source.html#l00715">AST_LIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h_source.html#l00838">AST_LIST_REMOVE</a>, <a class="el" href="utils_8h_source.html#l00376">ast_pthread_create</a>, <a class="el" href="lock_8h_source.html#l00082">AST_PTHREADT_NULL</a>, <a class="el" href="channel_8c_source.html#l03731">ast_set_read_format()</a>, <a class="el" href="channel_8c_source.html#l03737">ast_set_write_format()</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="channel_8h_source.html#l00498">ast_channel::bridge</a>, <a class="el" href="bridging_8h_source.html#l00129">ast_bridge_channel::bridge</a>, <a class="el" href="bridging_8c_source.html#l00149">bridge_array_add()</a>, <a class="el" href="bridging_8c_source.html#l00180">bridge_array_remove()</a>, <a class="el" href="bridging_8c_source.html#l00844">bridge_channel_dtmf_stream()</a>, <a class="el" href="bridging_8c_source.html#l00778">bridge_channel_feature()</a>, <a class="el" href="bridging_8c_source.html#l00698">bridge_channel_join_multithreaded()</a>, <a class="el" href="bridging_8c_source.html#l00735">bridge_channel_join_singlethreaded()</a>, <a class="el" href="bridging_8c_source.html#l00750">bridge_channel_suspend()</a>, <a class="el" href="bridging_8c_source.html#l00764">bridge_channel_unsuspend()</a>, <a class="el" href="bridging_8c_source.html#l00218">bridge_check_dissolve()</a>, <a class="el" href="bridging_8c_source.html#l00538">bridge_make_compatible()</a>, <a class="el" href="bridging_8c_source.html#l00353">bridge_thread()</a>, <a class="el" href="bridging__technology_8h_source.html#l00048">ast_bridge_technology::capabilities</a>, <a class="el" href="bridging_8h_source.html#l00125">ast_bridge_channel::chan</a>, <a class="el" href="bridging_8h_source.html#l00159">ast_bridge::feature_flags</a>, <a class="el" href="bridging_8c_source.html#l00204">find_bridge_channel()</a>, <a class="el" href="structast__bridge__technology.html#a8b369fed84f7c637d98be4861971590b">ast_bridge_technology::join</a>, <a class="el" href="structast__bridge__technology.html#ae453b9a1154d7db567f2f11c6adc5bc1">ast_bridge_technology::leave</a>, <a class="el" href="bridging__technology_8h_source.html#l00046">ast_bridge_technology::name</a>, <a class="el" href="bridging_8h_source.html#l00151">ast_bridge::num</a>, <a class="el" href="channel_8h_source.html#l00483">ast_channel::readformat</a>, <a class="el" href="bridging_8c_source.html#l00585">smart_bridge_operation()</a>, <a class="el" href="bridging_8h_source.html#l00123">ast_bridge_channel::state</a>, <a class="el" href="bridging_8h_source.html#l00155">ast_bridge::stop</a>, <a class="el" href="bridging_8h_source.html#l00127">ast_bridge_channel::swap</a>, <a class="el" href="bridging_8h_source.html#l00161">ast_bridge::technology</a>, <a class="el" href="bridging_8h_source.html#l00165">ast_bridge::thread</a>, <a class="el" href="bridging_8h_source.html#l00133">ast_bridge_channel::thread</a>, and <a class="el" href="channel_8h_source.html#l00484">ast_channel::writeformat</a>.</p>

<p>Referenced by <a class="el" href="bridging_8c_source.html#l00980">ast_bridge_join()</a>, and <a class="el" href="bridging_8c_source.html#l01008">bridge_channel_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00861"></a>00861 {
<a name="l00862"></a>00862    <span class="keywordtype">int</span> <a class="code" href="structformats.html">formats</a>[2] = { bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#ab7786a0f5b9a9ebf83daed87be4f3868">readformat</a>, bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#a00f5ce2ad53ff8523f8e46ea5aceba48">writeformat</a> };
<a name="l00863"></a>00863    <span class="keyword">enum</span> <a class="code" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7" title="State information about a bridged channel.">ast_bridge_channel_state</a> <a class="code" href="structstate.html">state</a>;
<a name="l00864"></a>00864 
<a name="l00865"></a>00865    <span class="comment">/* Record the thread that will be the owner of us */</span>
<a name="l00866"></a>00866    bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a01f75a9ad916f63a94e06a27635ba278">thread</a> = pthread_self();
<a name="l00867"></a>00867 
<a name="l00868"></a>00868    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Joining bridge channel %p to bridge %p\n&quot;</span>, bridge_channel, bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>);
<a name="l00869"></a>00869 
<a name="l00870"></a>00870    <a class="code" href="astobj2_8h.html#a3077056d07f6f9e348a54a743769bad5" title="Lock an object.">ao2_lock</a>(bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>);
<a name="l00871"></a>00871 
<a name="l00872"></a>00872    state = bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a5a8dce45720cd4222feb34abbdaa2c40">state</a>;
<a name="l00873"></a>00873 
<a name="l00874"></a>00874    <span class="comment">/* Add channel into the bridge */</span>
<a name="l00875"></a>00875    <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(&amp;bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>-&gt;channels, bridge_channel, entry);
<a name="l00876"></a>00876    bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>-&gt;<a class="code" href="structast__bridge.html#a86cf672daa4e0ad11ad10efc894d19c8">num</a>++;
<a name="l00877"></a>00877 
<a name="l00878"></a>00878    <a class="code" href="bridging_8c.html#af41fa7f06745400ef9a05e5ad821c951" title="Helper function to add a channel to the bridge array.">bridge_array_add</a>(bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>, bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a84d1435c5b8d387806714ea7079304b7">chan</a>);
<a name="l00879"></a>00879 
<a name="l00880"></a>00880    <span class="keywordflow">if</span> (bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a3bf3c4e34892d0033814ab5fec0e006f">swap</a>) {
<a name="l00881"></a>00881       <span class="keyword">struct </span><a class="code" href="structast__bridge__channel.html" title="Structure that contains information regarding a channel in a bridge.">ast_bridge_channel</a> *bridge_channel2 = NULL;
<a name="l00882"></a>00882 
<a name="l00883"></a>00883       <span class="comment">/* If we are performing a swap operation we do not need to execute the smart bridge operation as the actual number of channels involved will not have changed, we just need to tell the other channel to leave */</span>
<a name="l00884"></a>00884       <span class="keywordflow">if</span> ((bridge_channel2 = <a class="code" href="bridging_8c.html#af76003eaee352a6e71c4411b99c87eb1" title="Helper function to find a bridge channel given a channel.">find_bridge_channel</a>(bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>, bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a3bf3c4e34892d0033814ab5fec0e006f">swap</a>))) {
<a name="l00885"></a>00885          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Swapping bridge channel %p out from bridge %p so bridge channel %p can slip in\n&quot;</span>, bridge_channel2, bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>, bridge_channel);
<a name="l00886"></a>00886          <a class="code" href="bridging_8h.html#a03cde0e9535440a4f9f24ab921bea771" title="Change the state of a bridged channel.">ast_bridge_change_state</a>(bridge_channel2, <a class="code" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7aeabb6e67917f26042d385634268af296">AST_BRIDGE_CHANNEL_STATE_HANGUP</a>);
<a name="l00887"></a>00887       }
<a name="l00888"></a>00888 
<a name="l00889"></a>00889       bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a3bf3c4e34892d0033814ab5fec0e006f">swap</a> = NULL;
<a name="l00890"></a>00890    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>-&gt;<a class="code" href="structast__bridge.html#af15c2e8b6df8ce0bf570af18aa890deb">feature_flags</a>, <a class="code" href="bridging__features_8h.html#a65c2644d2eadb31bcec0aaeb41cb3444a8f8162f42b84a7eba37bfb551c31743b">AST_BRIDGE_FLAG_SMART</a>)) {
<a name="l00891"></a>00891       <span class="comment">/* Perform the smart bridge operation, basically see if we need to move around between technologies */</span>
<a name="l00892"></a>00892       <a class="code" href="bridging_8c.html#a343a22dfa2196b0b3f6702a057ab07a4" title="Perform the smart bridge operation. Basically sees if a new bridge technology should...">smart_bridge_operation</a>(bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>, bridge_channel, bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>-&gt;<a class="code" href="structast__bridge.html#a86cf672daa4e0ad11ad10efc894d19c8">num</a>);
<a name="l00893"></a>00893    }
<a name="l00894"></a>00894 
<a name="l00895"></a>00895    <span class="comment">/* Make the channel compatible with the bridge */</span>
<a name="l00896"></a>00896    <a class="code" href="bridging_8c.html#ae87cc33842c5acf5477d40f83c7e6a24">bridge_make_compatible</a>(bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>, bridge_channel);
<a name="l00897"></a>00897 
<a name="l00898"></a>00898    <span class="comment">/* Tell the bridge technology we are joining so they set us up */</span>
<a name="l00899"></a>00899    <span class="keywordflow">if</span> (bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a8b369fed84f7c637d98be4861971590b">join</a>) {
<a name="l00900"></a>00900       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Giving bridge technology %s notification that %p is joining bridge %p\n&quot;</span>, bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, bridge_channel, bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>);
<a name="l00901"></a>00901       <span class="keywordflow">if</span> (bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a8b369fed84f7c637d98be4861971590b">join</a>(bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>, bridge_channel)) {
<a name="l00902"></a>00902          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Bridge technology %s failed to join %p to bridge %p\n&quot;</span>, bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, bridge_channel, bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>);
<a name="l00903"></a>00903       }
<a name="l00904"></a>00904    }
<a name="l00905"></a>00905 
<a name="l00906"></a>00906    <span class="comment">/* Actually execute the respective threading model, and keep our bridge thread alive */</span>
<a name="l00907"></a>00907    <span class="keywordflow">while</span> (bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a5a8dce45720cd4222feb34abbdaa2c40">state</a> == <a class="code" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7a82e437d5aa10df5114a21ae794bce625">AST_BRIDGE_CHANNEL_STATE_WAIT</a>) {
<a name="l00908"></a>00908       <span class="comment">/* Update bridge pointer on channel */</span>
<a name="l00909"></a>00909       bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a> = bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>;
<a name="l00910"></a>00910       <span class="comment">/* If the technology requires a thread and one is not running, start it up */</span>
<a name="l00911"></a>00911       <span class="keywordflow">if</span> (bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>-&gt;<a class="code" href="structast__bridge.html#a01f75a9ad916f63a94e06a27635ba278">thread</a> == <a class="code" href="lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a> &amp;&amp; (bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a9461ee266923070466f95a76158f65cd">capabilities</a> &amp; <a class="code" href="bridging_8h.html#a815c9b3e933dfd4b8f523cf55caa5bbfaa03170187c779ad77c3c724255140d56">AST_BRIDGE_CAPABILITY_THREAD</a>)) {
<a name="l00912"></a>00912          bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>-&gt;<a class="code" href="structast__bridge.html#a111277a0849f92b793ed6aa1efe54462">stop</a> = 0;
<a name="l00913"></a>00913          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Starting a bridge thread for bridge %p\n&quot;</span>, bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>);
<a name="l00914"></a>00914          <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>, +1);
<a name="l00915"></a>00915          <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a4781fd54a4ca8c7f0f8a32a6cce503c0">ast_pthread_create</a>(&amp;bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>-&gt;<a class="code" href="structast__bridge.html#a01f75a9ad916f63a94e06a27635ba278">thread</a>, NULL, <a class="code" href="bridging_8c.html#a82dad941a0e25bf3f0b18759ae4ce667" title="Bridge thread function.">bridge_thread</a>, bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>)) {
<a name="l00916"></a>00916             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Failed to create a bridge thread for bridge %p, giving it another go.\n&quot;</span>, bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>);
<a name="l00917"></a>00917             <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>, -1);
<a name="l00918"></a>00918             <span class="keywordflow">continue</span>;
<a name="l00919"></a>00919          }
<a name="l00920"></a>00920       }
<a name="l00921"></a>00921       <span class="comment">/* Execute the threading model */</span>
<a name="l00922"></a>00922       state = (bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a9461ee266923070466f95a76158f65cd">capabilities</a> &amp; <a class="code" href="bridging_8h.html#a815c9b3e933dfd4b8f523cf55caa5bbfa6a2f6021508eaa795c8405c5b753cf41">AST_BRIDGE_CAPABILITY_MULTITHREADED</a> ? <a class="code" href="bridging_8c.html#acaf943a7185049ddf957fa1a26cdd93a" title="Run in a multithreaded model. Each joined channel does writing/reading in their own...">bridge_channel_join_multithreaded</a>(bridge_channel) : <a class="code" href="bridging_8c.html#aa43d77daa36c4dacb3794ec08ca12cbf" title="Run in a singlethreaded model. Each joined channel yields itself to the main bridge...">bridge_channel_join_singlethreaded</a>(bridge_channel));
<a name="l00923"></a>00923       <span class="comment">/* Depending on the above state see what we need to do */</span>
<a name="l00924"></a>00924       <span class="keywordflow">if</span> (state == <a class="code" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7a35a97f491c00d69b863f3656af8b4d4f">AST_BRIDGE_CHANNEL_STATE_FEATURE</a>) {
<a name="l00925"></a>00925          <a class="code" href="bridging_8c.html#a3a1111dba6ca9870165bccb229348b01" title="Internal function that suspends a channel from a bridge.">bridge_channel_suspend</a>(bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>, bridge_channel);
<a name="l00926"></a>00926          <a class="code" href="bridging_8c.html#a372ceb5c3b7e76beb174da7fa59f84dc" title="Internal function that executes a feature on a bridge channel.">bridge_channel_feature</a>(bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>, bridge_channel);
<a name="l00927"></a>00927          <a class="code" href="bridging_8c.html#a761e80878d0be1580c163dda4553dc37" title="Internal function that unsuspends a channel from a bridge.">bridge_channel_unsuspend</a>(bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>, bridge_channel);
<a name="l00928"></a>00928       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (state == <a class="code" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7a5242791d651ccb03b7426b626dca9dbd">AST_BRIDGE_CHANNEL_STATE_DTMF</a>) {
<a name="l00929"></a>00929          <a class="code" href="bridging_8c.html#a3a1111dba6ca9870165bccb229348b01" title="Internal function that suspends a channel from a bridge.">bridge_channel_suspend</a>(bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>, bridge_channel);
<a name="l00930"></a>00930          <a class="code" href="bridging_8c.html#a4804095baaf47eea8ad5f67f98588ad2" title="Internal function that plays back DTMF on a bridge channel.">bridge_channel_dtmf_stream</a>(bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>, bridge_channel);
<a name="l00931"></a>00931          <a class="code" href="bridging_8c.html#a761e80878d0be1580c163dda4553dc37" title="Internal function that unsuspends a channel from a bridge.">bridge_channel_unsuspend</a>(bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>, bridge_channel);
<a name="l00932"></a>00932       }
<a name="l00933"></a>00933    }
<a name="l00934"></a>00934 
<a name="l00935"></a>00935    bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a> = NULL;
<a name="l00936"></a>00936 
<a name="l00937"></a>00937    <span class="comment">/* See if we need to dissolve the bridge itself if they hung up */</span>
<a name="l00938"></a>00938    <span class="keywordflow">if</span> (bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a5a8dce45720cd4222feb34abbdaa2c40">state</a> == <a class="code" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7a70362e0b60c71e30a1166be6d13ac8a3">AST_BRIDGE_CHANNEL_STATE_END</a>) {
<a name="l00939"></a>00939       <a class="code" href="bridging_8c.html#ab00741ef59ddce4434e47d71fe39646b" title="Internal function to see whether a bridge should dissolve, and if so do it.">bridge_check_dissolve</a>(bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>, bridge_channel);
<a name="l00940"></a>00940    }
<a name="l00941"></a>00941 
<a name="l00942"></a>00942    <span class="comment">/* Tell the bridge technology we are leaving so they tear us down */</span>
<a name="l00943"></a>00943    <span class="keywordflow">if</span> (bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#ae453b9a1154d7db567f2f11c6adc5bc1">leave</a>) {
<a name="l00944"></a>00944       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Giving bridge technology %s notification that %p is leaving bridge %p\n&quot;</span>, bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, bridge_channel, bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>);
<a name="l00945"></a>00945       <span class="keywordflow">if</span> (bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#ae453b9a1154d7db567f2f11c6adc5bc1">leave</a>(bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>, bridge_channel)) {
<a name="l00946"></a>00946          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Bridge technology %s failed to leave %p from bridge %p\n&quot;</span>, bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, bridge_channel, bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>);
<a name="l00947"></a>00947       }
<a name="l00948"></a>00948    }
<a name="l00949"></a>00949 
<a name="l00950"></a>00950    <span class="comment">/* Remove channel from the bridge */</span>
<a name="l00951"></a>00951    bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>-&gt;<a class="code" href="structast__bridge.html#a86cf672daa4e0ad11ad10efc894d19c8">num</a>--;
<a name="l00952"></a>00952    <a class="code" href="linkedlists_8h.html#aa36e72b77f1b80881cd0a9fcca66ce19" title="Removes a specific entry from a list.">AST_LIST_REMOVE</a>(&amp;bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>-&gt;channels, bridge_channel, entry);
<a name="l00953"></a>00953 
<a name="l00954"></a>00954    <a class="code" href="bridging_8c.html#a5ac27d55678ac62f4323954cea6adfb8" title="Helper function to remove a channel from the bridge array.">bridge_array_remove</a>(bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>, bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a84d1435c5b8d387806714ea7079304b7">chan</a>);
<a name="l00955"></a>00955 
<a name="l00956"></a>00956    <span class="comment">/* Perform the smart bridge operation if needed since a channel has left */</span>
<a name="l00957"></a>00957    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>-&gt;<a class="code" href="structast__bridge.html#af15c2e8b6df8ce0bf570af18aa890deb">feature_flags</a>, <a class="code" href="bridging__features_8h.html#a65c2644d2eadb31bcec0aaeb41cb3444a8f8162f42b84a7eba37bfb551c31743b">AST_BRIDGE_FLAG_SMART</a>)) {
<a name="l00958"></a>00958       <a class="code" href="bridging_8c.html#a343a22dfa2196b0b3f6702a057ab07a4" title="Perform the smart bridge operation. Basically sees if a new bridge technology should...">smart_bridge_operation</a>(bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>, NULL, bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>-&gt;<a class="code" href="structast__bridge.html#a86cf672daa4e0ad11ad10efc894d19c8">num</a>);
<a name="l00959"></a>00959    }
<a name="l00960"></a>00960 
<a name="l00961"></a>00961    <a class="code" href="astobj2_8h.html#a379cc936a320f2179f7beb422dc15230" title="Unlock an object.">ao2_unlock</a>(bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>);
<a name="l00962"></a>00962 
<a name="l00963"></a>00963    <span class="comment">/* Restore original formats of the channel as they came in */</span>
<a name="l00964"></a>00964    <span class="keywordflow">if</span> (bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#ab7786a0f5b9a9ebf83daed87be4f3868">readformat</a> != formats[0]) {
<a name="l00965"></a>00965       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Bridge is returning %p to read format %s(%d)\n&quot;</span>, bridge_channel, <a class="code" href="frame_8h.html#afe8f690984f8ba95cd01a431198c10bf" title="Get the name of a format.">ast_getformatname</a>(formats[0]), formats[0]);
<a name="l00966"></a>00966       <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a72d53065c6bc2b6092fa41eefa03f1ad" title="Sets read format on channel chan Set read format for channel to whichever component...">ast_set_read_format</a>(bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, formats[0])) {
<a name="l00967"></a>00967          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Bridge failed to return channel %p to read format %s(%d)\n&quot;</span>, bridge_channel, <a class="code" href="frame_8h.html#afe8f690984f8ba95cd01a431198c10bf" title="Get the name of a format.">ast_getformatname</a>(formats[0]), formats[0]);
<a name="l00968"></a>00968       }
<a name="l00969"></a>00969    }
<a name="l00970"></a>00970    <span class="keywordflow">if</span> (bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#a00f5ce2ad53ff8523f8e46ea5aceba48">writeformat</a> != formats[1]) {
<a name="l00971"></a>00971       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Bridge is returning %p to write format %s(%d)\n&quot;</span>, bridge_channel, <a class="code" href="frame_8h.html#afe8f690984f8ba95cd01a431198c10bf" title="Get the name of a format.">ast_getformatname</a>(formats[1]), formats[1]);
<a name="l00972"></a>00972       <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a978161a52d98fdaee374d1f6e1359544" title="Sets write format on channel chan Set write format for channel to whichever component...">ast_set_write_format</a>(bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, formats[1])) {
<a name="l00973"></a>00973          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Bridge failed to return channel %p to write format %s(%d)\n&quot;</span>, bridge_channel, <a class="code" href="frame_8h.html#afe8f690984f8ba95cd01a431198c10bf" title="Get the name of a format.">ast_getformatname</a>(formats[1]), formats[1]);
<a name="l00974"></a>00974       }
<a name="l00975"></a>00975    }
<a name="l00976"></a>00976 
<a name="l00977"></a>00977    <span class="keywordflow">return</span> bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a5a8dce45720cd4222feb34abbdaa2c40">state</a>;
<a name="l00978"></a>00978 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="acaf943a7185049ddf957fa1a26cdd93a"></a><!-- doxytag: member="bridging.c::bridge_channel_join_multithreaded" ref="acaf943a7185049ddf957fa1a26cdd93a" args="(struct ast_bridge_channel *bridge_channel)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7">ast_bridge_channel_state</a> bridge_channel_join_multithreaded </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge__channel.html">ast_bridge_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge_channel</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Run in a multithreaded model. Each joined channel does writing/reading in their own thread. TODO: Improve. </p>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l00698">698</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="astobj2_8c_source.html#l00147">ao2_lock()</a>, <a class="el" href="astobj2_8c_source.html#l00169">ao2_unlock()</a>, <a class="el" href="bridging_8c_source.html#l00276">ast_bridge_handle_trip()</a>, <a class="el" href="lock_8h_source.html#l01749">ast_cond_wait()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="channel_8c_source.html#l02041">ast_waitfor_nandfds()</a>, <a class="el" href="bridging_8h_source.html#l00129">ast_bridge_channel::bridge</a>, <a class="el" href="bridging_8h_source.html#l00125">ast_bridge_channel::chan</a>, <a class="el" href="adsistub_8c_source.html#l00049">chan</a>, <a class="el" href="bridging_8h_source.html#l00121">ast_bridge_channel::cond</a>, <a class="el" href="structast__bridge__technology.html#aa021c0c9ab12c7ca3bd62980a6aaccc9">ast_bridge_technology::fd</a>, <a class="el" href="bridging_8h_source.html#l00135">ast_bridge_channel::fds</a>, <a class="el" href="bridging_8h_source.html#l00119">ast_bridge_channel::lock</a>, <a class="el" href="bridging_8h_source.html#l00123">ast_bridge_channel::state</a>, <a class="el" href="bridging_8h_source.html#l00137">ast_bridge_channel::suspended</a>, and <a class="el" href="bridging_8h_source.html#l00161">ast_bridge::technology</a>.</p>

<p>Referenced by <a class="el" href="bridging_8c_source.html#l00860">bridge_channel_join()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00699"></a>00699 {
<a name="l00700"></a>00700    <span class="keywordtype">int</span> <a class="code" href="structast__bridge__channel.html#a67f55c5496a50a31a1f31caa99aae080">fds</a>[4] = { -1, }, nfds = 0, i = 0, outfd = -1, ms = -1;
<a name="l00701"></a>00701    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a> = NULL;
<a name="l00702"></a>00702 
<a name="l00703"></a>00703    <span class="comment">/* Add any file descriptors we may want to monitor */</span>
<a name="l00704"></a>00704    <span class="keywordflow">if</span> (bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#aa021c0c9ab12c7ca3bd62980a6aaccc9">fd</a>) {
<a name="l00705"></a>00705       <span class="keywordflow">for</span> (i = 0; i &lt; 4; i ++) {
<a name="l00706"></a>00706          <span class="keywordflow">if</span> (bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a67f55c5496a50a31a1f31caa99aae080">fds</a>[i] &gt;= 0) {
<a name="l00707"></a>00707             fds[nfds++] = bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a67f55c5496a50a31a1f31caa99aae080">fds</a>[i];
<a name="l00708"></a>00708          }
<a name="l00709"></a>00709       }
<a name="l00710"></a>00710    }
<a name="l00711"></a>00711 
<a name="l00712"></a>00712    <a class="code" href="astobj2_8h.html#a379cc936a320f2179f7beb422dc15230" title="Unlock an object.">ao2_unlock</a>(bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>);
<a name="l00713"></a>00713 
<a name="l00714"></a>00714    <span class="comment">/* Wait for data to either come from the channel or us to be signalled */</span>
<a name="l00715"></a>00715    <span class="keywordflow">if</span> (!bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a2862ffde11c780129862e5549415a6f6">suspended</a>) {
<a name="l00716"></a>00716       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Going into a multithreaded waitfor for bridge channel %p of bridge %p\n&quot;</span>, bridge_channel, bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>);
<a name="l00717"></a>00717       chan = <a class="code" href="channel_8h.html#a5e62602ca9e229304f60ab5c2b32e13b" title="Waits for activity on a group of channels.">ast_waitfor_nandfds</a>(&amp;bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, 1, fds, nfds, NULL, &amp;outfd, &amp;ms);
<a name="l00718"></a>00718    } <span class="keywordflow">else</span> {
<a name="l00719"></a>00719       <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00720"></a>00720       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Going into a multithreaded signal wait for bridge channel %p of bridge %p\n&quot;</span>, bridge_channel, bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>);
<a name="l00721"></a>00721       <a class="code" href="lock_8h.html#ae454b1ebfb5f5e9948876d470865d9dc">ast_cond_wait</a>(&amp;bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>, &amp;bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00722"></a>00722       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00723"></a>00723    }
<a name="l00724"></a>00724 
<a name="l00725"></a>00725    <a class="code" href="astobj2_8h.html#a3077056d07f6f9e348a54a743769bad5" title="Lock an object.">ao2_lock</a>(bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>);
<a name="l00726"></a>00726 
<a name="l00727"></a>00727    <span class="keywordflow">if</span> (!bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a2862ffde11c780129862e5549415a6f6">suspended</a>) {
<a name="l00728"></a>00728       <a class="code" href="bridging__technology_8h.html#ab01e4cd0a5b35dda072677f415b5f32a" title="Feed notification that a frame is waiting on a channel into the bridging core.">ast_bridge_handle_trip</a>(bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>, bridge_channel, chan, outfd);
<a name="l00729"></a>00729    }
<a name="l00730"></a>00730 
<a name="l00731"></a>00731    <span class="keywordflow">return</span> bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a5a8dce45720cd4222feb34abbdaa2c40">state</a>;
<a name="l00732"></a>00732 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa43d77daa36c4dacb3794ec08ca12cbf"></a><!-- doxytag: member="bridging.c::bridge_channel_join_singlethreaded" ref="aa43d77daa36c4dacb3794ec08ca12cbf" args="(struct ast_bridge_channel *bridge_channel)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7">ast_bridge_channel_state</a> bridge_channel_join_singlethreaded </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge__channel.html">ast_bridge_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge_channel</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Run in a singlethreaded model. Each joined channel yields itself to the main bridge thread. TODO: Improve. </p>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l00735">735</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="astobj2_8c_source.html#l00147">ao2_lock()</a>, <a class="el" href="astobj2_8c_source.html#l00169">ao2_unlock()</a>, <a class="el" href="bridging_8h_source.html#l00088">AST_BRIDGE_CHANNEL_STATE_WAIT</a>, <a class="el" href="lock_8h_source.html#l01749">ast_cond_wait()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="bridging_8h_source.html#l00129">ast_bridge_channel::bridge</a>, <a class="el" href="bridging_8h_source.html#l00121">ast_bridge_channel::cond</a>, <a class="el" href="bridging_8h_source.html#l00119">ast_bridge_channel::lock</a>, and <a class="el" href="bridging_8h_source.html#l00123">ast_bridge_channel::state</a>.</p>

<p>Referenced by <a class="el" href="bridging_8c_source.html#l00860">bridge_channel_join()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00736"></a>00736 {
<a name="l00737"></a>00737    <a class="code" href="astobj2_8h.html#a379cc936a320f2179f7beb422dc15230" title="Unlock an object.">ao2_unlock</a>(bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>);
<a name="l00738"></a>00738    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00739"></a>00739    <span class="keywordflow">if</span> (bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a5a8dce45720cd4222feb34abbdaa2c40">state</a> == <a class="code" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7a82e437d5aa10df5114a21ae794bce625">AST_BRIDGE_CHANNEL_STATE_WAIT</a>) {
<a name="l00740"></a>00740       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Going into a single threaded signal wait for bridge channel %p of bridge %p\n&quot;</span>, bridge_channel, bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>);
<a name="l00741"></a>00741       <a class="code" href="lock_8h.html#ae454b1ebfb5f5e9948876d470865d9dc">ast_cond_wait</a>(&amp;bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>, &amp;bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00742"></a>00742    }
<a name="l00743"></a>00743    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00744"></a>00744    <a class="code" href="astobj2_8h.html#a3077056d07f6f9e348a54a743769bad5" title="Lock an object.">ao2_lock</a>(bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>);
<a name="l00745"></a>00745 
<a name="l00746"></a>00746    <span class="keywordflow">return</span> bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a5a8dce45720cd4222feb34abbdaa2c40">state</a>;
<a name="l00747"></a>00747 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3a1111dba6ca9870165bccb229348b01"></a><!-- doxytag: member="bridging.c::bridge_channel_suspend" ref="a3a1111dba6ca9870165bccb229348b01" args="(struct ast_bridge *bridge, struct ast_bridge_channel *bridge_channel)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bridge_channel_suspend </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge.html">ast_bridge</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__bridge__channel.html">ast_bridge_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge_channel</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Internal function that suspends a channel from a bridge. </p>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l00750">750</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="bridging_8c_source.html#l00180">bridge_array_remove()</a>, <a class="el" href="bridging_8h_source.html#l00125">ast_bridge_channel::chan</a>, <a class="el" href="structast__bridge__technology.html#ae3db82c17a0cdbf28b98a9cde2d4ddc0">ast_bridge_technology::suspend</a>, <a class="el" href="bridging_8h_source.html#l00137">ast_bridge_channel::suspended</a>, and <a class="el" href="bridging_8h_source.html#l00161">ast_bridge::technology</a>.</p>

<p>Referenced by <a class="el" href="bridging_8c_source.html#l01187">ast_bridge_suspend()</a>, and <a class="el" href="bridging_8c_source.html#l00860">bridge_channel_join()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00751"></a>00751 {
<a name="l00752"></a>00752    bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a2862ffde11c780129862e5549415a6f6">suspended</a> = 1;
<a name="l00753"></a>00753 
<a name="l00754"></a>00754    <a class="code" href="bridging_8c.html#a5ac27d55678ac62f4323954cea6adfb8" title="Helper function to remove a channel from the bridge array.">bridge_array_remove</a>(bridge, bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a84d1435c5b8d387806714ea7079304b7">chan</a>);
<a name="l00755"></a>00755 
<a name="l00756"></a>00756    <span class="keywordflow">if</span> (bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#ae3db82c17a0cdbf28b98a9cde2d4ddc0">suspend</a>) {
<a name="l00757"></a>00757       bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#ae3db82c17a0cdbf28b98a9cde2d4ddc0">suspend</a>(bridge, bridge_channel);
<a name="l00758"></a>00758    }
<a name="l00759"></a>00759 
<a name="l00760"></a>00760    <span class="keywordflow">return</span>;
<a name="l00761"></a>00761 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a47f049f2c263a70b056e02549ff7d561"></a><!-- doxytag: member="bridging.c::bridge_channel_thread" ref="a47f049f2c263a70b056e02549ff7d561" args="(void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void* bridge_channel_thread </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Thread responsible for imparted bridged <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>. </p>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l01008">1008</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00459">ao2_ref</a>, <a class="el" href="bridging_8h_source.html#l00090">AST_BRIDGE_CHANNEL_STATE_END</a>, <a class="el" href="bridging_8h_source.html#l00092">AST_BRIDGE_CHANNEL_STATE_HANGUP</a>, <a class="el" href="lock_8h_source.html#l01744">ast_cond_destroy()</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="channel_8c_source.html#l01690">ast_hangup()</a>, <a class="el" href="lock_8h_source.html#l01712">ast_mutex_destroy()</a>, <a class="el" href="bridging_8h_source.html#l00129">ast_bridge_channel::bridge</a>, <a class="el" href="bridging_8c_source.html#l00860">bridge_channel_join()</a>, <a class="el" href="bridging_8h_source.html#l00125">ast_bridge_channel::chan</a>, <a class="el" href="bridging_8h_source.html#l00121">ast_bridge_channel::cond</a>, and <a class="el" href="bridging_8h_source.html#l00119">ast_bridge_channel::lock</a>.</p>

<p>Referenced by <a class="el" href="bridging_8c_source.html#l01030">ast_bridge_impart()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01009"></a>01009 {
<a name="l01010"></a>01010    <span class="keyword">struct </span><a class="code" href="structast__bridge__channel.html" title="Structure that contains information regarding a channel in a bridge.">ast_bridge_channel</a> *bridge_channel = data;
<a name="l01011"></a>01011    <span class="keyword">enum</span> <a class="code" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7" title="State information about a bridged channel.">ast_bridge_channel_state</a> <a class="code" href="structstate.html">state</a>;
<a name="l01012"></a>01012 
<a name="l01013"></a>01013    state = <a class="code" href="bridging_8c.html#a63538fa2bdf0d9aa20742f12ee86bef1" title="Join a channel to a bridge and handle anything the bridge may want us to do.">bridge_channel_join</a>(bridge_channel);
<a name="l01014"></a>01014 
<a name="l01015"></a>01015    <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>, -1);
<a name="l01016"></a>01016 
<a name="l01017"></a>01017    <span class="comment">/* If no other thread is going to take the channel then hang it up, or else we would have to service it until something else came along */</span>
<a name="l01018"></a>01018    <span class="keywordflow">if</span> (state == <a class="code" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7a70362e0b60c71e30a1166be6d13ac8a3">AST_BRIDGE_CHANNEL_STATE_END</a> || state == <a class="code" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7aeabb6e67917f26042d385634268af296">AST_BRIDGE_CHANNEL_STATE_HANGUP</a>) {
<a name="l01019"></a>01019       <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a84d1435c5b8d387806714ea7079304b7">chan</a>);
<a name="l01020"></a>01020    }
<a name="l01021"></a>01021 
<a name="l01022"></a>01022    <span class="comment">/* Destroy elements of the bridge channel structure and the bridge channel structure itself */</span>
<a name="l01023"></a>01023    <a class="code" href="lock_8h.html#ab237e70b569019bfb490ab0c3c09b8c5">ast_mutex_destroy</a>(&amp;bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01024"></a>01024    <a class="code" href="lock_8h.html#a7752bcadc38f1d7a7a8528c538569115">ast_cond_destroy</a>(&amp;bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>);
<a name="l01025"></a>01025    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(bridge_channel);
<a name="l01026"></a>01026 
<a name="l01027"></a>01027    <span class="keywordflow">return</span> NULL;
<a name="l01028"></a>01028 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a761e80878d0be1580c163dda4553dc37"></a><!-- doxytag: member="bridging.c::bridge_channel_unsuspend" ref="a761e80878d0be1580c163dda4553dc37" args="(struct ast_bridge *bridge, struct ast_bridge_channel *bridge_channel)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bridge_channel_unsuspend </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge.html">ast_bridge</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__bridge__channel.html">ast_bridge_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge_channel</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Internal function that unsuspends a channel from a bridge. </p>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l00764">764</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="bridging_8c_source.html#l00149">bridge_array_add()</a>, <a class="el" href="bridging_8h_source.html#l00125">ast_bridge_channel::chan</a>, <a class="el" href="bridging_8h_source.html#l00137">ast_bridge_channel::suspended</a>, <a class="el" href="bridging_8h_source.html#l00161">ast_bridge::technology</a>, and <a class="el" href="structast__bridge__technology.html#a123270015f41d8b15343ef12cf86c842">ast_bridge_technology::unsuspend</a>.</p>

<p>Referenced by <a class="el" href="bridging_8c_source.html#l01205">ast_bridge_unsuspend()</a>, and <a class="el" href="bridging_8c_source.html#l00860">bridge_channel_join()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00765"></a>00765 {
<a name="l00766"></a>00766    bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a2862ffde11c780129862e5549415a6f6">suspended</a> =0;
<a name="l00767"></a>00767 
<a name="l00768"></a>00768    <a class="code" href="bridging_8c.html#af41fa7f06745400ef9a05e5ad821c951" title="Helper function to add a channel to the bridge array.">bridge_array_add</a>(bridge, bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a84d1435c5b8d387806714ea7079304b7">chan</a>);
<a name="l00769"></a>00769 
<a name="l00770"></a>00770    <span class="keywordflow">if</span> (bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a123270015f41d8b15343ef12cf86c842">unsuspend</a>) {
<a name="l00771"></a>00771       bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a123270015f41d8b15343ef12cf86c842">unsuspend</a>(bridge, bridge_channel);
<a name="l00772"></a>00772    }
<a name="l00773"></a>00773 
<a name="l00774"></a>00774    <span class="keywordflow">return</span>;
<a name="l00775"></a>00775 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab00741ef59ddce4434e47d71fe39646b"></a><!-- doxytag: member="bridging.c::bridge_check_dissolve" ref="ab00741ef59ddce4434e47d71fe39646b" args="(struct ast_bridge *bridge, struct ast_bridge_channel *bridge_channel)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bridge_check_dissolve </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge.html">ast_bridge</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__bridge__channel.html">ast_bridge_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge_channel</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Internal function to see whether a bridge should dissolve, and if so do it. </p>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l00218">218</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="bridging_8c_source.html#l00118">ast_bridge_change_state()</a>, <a class="el" href="bridging_8h_source.html#l00094">AST_BRIDGE_CHANNEL_STATE_DEPART</a>, <a class="el" href="bridging_8h_source.html#l00090">AST_BRIDGE_CHANNEL_STATE_END</a>, <a class="el" href="bridging_8h_source.html#l00092">AST_BRIDGE_CHANNEL_STATE_HANGUP</a>, <a class="el" href="bridging__features_8h_source.html#l00034">AST_BRIDGE_FLAG_DISSOLVE</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="bridging__features_8h_source.html#l00092">ast_bridge_features::feature_flags</a>, <a class="el" href="bridging_8h_source.html#l00159">ast_bridge::feature_flags</a>, <a class="el" href="bridging_8h_source.html#l00139">ast_bridge_channel::features</a>, <a class="el" href="bridging_8h_source.html#l00123">ast_bridge_channel::state</a>, <a class="el" href="bridging_8h_source.html#l00155">ast_bridge::stop</a>, and <a class="el" href="bridging__features_8h_source.html#l00094">ast_bridge_features::usable</a>.</p>

<p>Referenced by <a class="el" href="bridging_8c_source.html#l00860">bridge_channel_join()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00219"></a>00219 {
<a name="l00220"></a>00220    <span class="keyword">struct </span><a class="code" href="structast__bridge__channel.html" title="Structure that contains information regarding a channel in a bridge.">ast_bridge_channel</a> *bridge_channel2 = NULL;
<a name="l00221"></a>00221 
<a name="l00222"></a>00222    <span class="keywordflow">if</span> (!<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;bridge-&gt;<a class="code" href="structast__bridge.html#af15c2e8b6df8ce0bf570af18aa890deb">feature_flags</a>, <a class="code" href="bridging__features_8h.html#a65c2644d2eadb31bcec0aaeb41cb3444ae2c21ce82d946116c6488e97faedcd3d">AST_BRIDGE_FLAG_DISSOLVE</a>) &amp;&amp; (!bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a65633fdc6178dc8d9f754fda0166d16e">features</a> || !bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a65633fdc6178dc8d9f754fda0166d16e">features</a>-&gt;<a class="code" href="structast__bridge__features.html#a080125973deec97104866dd31867e3ce">usable</a> || !<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a65633fdc6178dc8d9f754fda0166d16e">features</a>-&gt;<a class="code" href="structast__bridge__features.html#af15c2e8b6df8ce0bf570af18aa890deb">feature_flags</a>, <a class="code" href="bridging__features_8h.html#a65c2644d2eadb31bcec0aaeb41cb3444ae2c21ce82d946116c6488e97faedcd3d">AST_BRIDGE_FLAG_DISSOLVE</a>))) {
<a name="l00223"></a>00223       <span class="keywordflow">return</span>;
<a name="l00224"></a>00224    }
<a name="l00225"></a>00225 
<a name="l00226"></a>00226    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Dissolving bridge %p\n&quot;</span>, bridge);
<a name="l00227"></a>00227 
<a name="l00228"></a>00228    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;bridge-&gt;channels, bridge_channel2, entry) {
<a name="l00229"></a>00229       <span class="keywordflow">if</span> (bridge_channel2-&gt;<a class="code" href="structast__bridge__channel.html#a5a8dce45720cd4222feb34abbdaa2c40">state</a> != <a class="code" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7a70362e0b60c71e30a1166be6d13ac8a3">AST_BRIDGE_CHANNEL_STATE_END</a> &amp;&amp; bridge_channel2-&gt;<a class="code" href="structast__bridge__channel.html#a5a8dce45720cd4222feb34abbdaa2c40">state</a> != <a class="code" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7a0160065122a1729d07ed010b3369a49c">AST_BRIDGE_CHANNEL_STATE_DEPART</a>) {
<a name="l00230"></a>00230          <a class="code" href="bridging_8h.html#a03cde0e9535440a4f9f24ab921bea771" title="Change the state of a bridged channel.">ast_bridge_change_state</a>(bridge_channel2, <a class="code" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7aeabb6e67917f26042d385634268af296">AST_BRIDGE_CHANNEL_STATE_HANGUP</a>);
<a name="l00231"></a>00231       }
<a name="l00232"></a>00232    }
<a name="l00233"></a>00233 
<a name="l00234"></a>00234    <span class="comment">/* Since all the channels are going away let&apos;s go ahead and stop our on thread */</span>
<a name="l00235"></a>00235    bridge-&gt;<a class="code" href="structast__bridge.html#a111277a0849f92b793ed6aa1efe54462">stop</a> = 1;
<a name="l00236"></a>00236 
<a name="l00237"></a>00237    <span class="keywordflow">return</span>;
<a name="l00238"></a>00238 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3a161f839c1d924a38b385ca8f5ed28f"></a><!-- doxytag: member="bridging.c::bridge_drop_control_frame" ref="a3a161f839c1d924a38b385ca8f5ed28f" args="(int subclass)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bridge_drop_control_frame </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>subclass</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Internal function used to determine whether a control frame should be dropped or not. </p>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l00265">265</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="frame_8h_source.html#l00301">AST_CONTROL_ANSWER</a>.</p>

<p>Referenced by <a class="el" href="bridging_8c_source.html#l00276">ast_bridge_handle_trip()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00266"></a>00266 {
<a name="l00267"></a>00267    <span class="keywordflow">switch</span> (subclass) {
<a name="l00268"></a>00268    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe">AST_CONTROL_ANSWER</a>:
<a name="l00269"></a>00269    <span class="keywordflow">case</span> -1:
<a name="l00270"></a>00270       <span class="keywordflow">return</span> 1;
<a name="l00271"></a>00271    <span class="keywordflow">default</span>:
<a name="l00272"></a>00272       <span class="keywordflow">return</span> 0;
<a name="l00273"></a>00273    }
<a name="l00274"></a>00274 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a528e3f3afe8699fd772b60dd7fa91194"></a><!-- doxytag: member="bridging.c::bridge_handle_dtmf" ref="a528e3f3afe8699fd772b60dd7fa91194" args="(struct ast_bridge *bridge, struct ast_bridge_channel *bridge_channel, struct ast_frame *frame)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__frame.html">ast_frame</a>* bridge_handle_dtmf </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge.html">ast_bridge</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__bridge__channel.html">ast_bridge_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge_channel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td>
          <td class="paramname"> <em>frame</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Internal function to handle DTMF from a channel. </p>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l00241">241</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="bridging_8c_source.html#l00118">ast_bridge_change_state()</a>, <a class="el" href="bridging_8h_source.html#l00096">AST_BRIDGE_CHANNEL_STATE_FEATURE</a>, <a class="el" href="frame_8h_source.html#l00462">ast_frfree</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="bridging__features_8h_source.html#l00076">ast_bridge_features_hook::dtmf</a>, <a class="el" href="bridging_8h_source.html#l00167">ast_bridge::features</a>, <a class="el" href="bridging_8h_source.html#l00139">ast_bridge_channel::features</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, and <a class="el" href="bridging__features_8h_source.html#l00094">ast_bridge_features::usable</a>.</p>

<p>Referenced by <a class="el" href="bridging_8c_source.html#l00276">ast_bridge_handle_trip()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00242"></a>00242 {
<a name="l00243"></a>00243    <span class="keyword">struct </span><a class="code" href="structast__bridge__features.html" title="Structure that contains features information.">ast_bridge_features</a> *features = (bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a65633fdc6178dc8d9f754fda0166d16e">features</a> ? bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a65633fdc6178dc8d9f754fda0166d16e">features</a> : &amp;bridge-&gt;<a class="code" href="structast__bridge.html#aa5f7287d4bbab0f62a1bae18af89171d">features</a>);
<a name="l00244"></a>00244    <span class="keyword">struct </span><a class="code" href="structast__bridge__features__hook.html" title="Structure that is the essence of a features hook.">ast_bridge_features_hook</a> *hook = NULL;
<a name="l00245"></a>00245 
<a name="l00246"></a>00246    <span class="comment">/* If the features structure we grabbed is not usable immediately return the frame */</span>
<a name="l00247"></a>00247    <span class="keywordflow">if</span> (!features-&gt;<a class="code" href="structast__bridge__features.html#a080125973deec97104866dd31867e3ce">usable</a>) {
<a name="l00248"></a>00248       <span class="keywordflow">return</span> frame;
<a name="l00249"></a>00249    }
<a name="l00250"></a>00250 
<a name="l00251"></a>00251    <span class="comment">/* See if this DTMF matches the beginnings of any feature hooks, if so we switch to the feature state to either execute the feature or collect more DTMF */</span>
<a name="l00252"></a>00252    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;features-&gt;hooks, hook, entry) {
<a name="l00253"></a>00253       <span class="keywordflow">if</span> (hook-&gt;<a class="code" href="structast__bridge__features__hook.html#a33464dba524e69ccf4c908b486d8301e">dtmf</a>[0] == frame-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>) {
<a name="l00254"></a>00254          <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(frame);
<a name="l00255"></a>00255          frame = NULL;
<a name="l00256"></a>00256          <a class="code" href="bridging_8h.html#a03cde0e9535440a4f9f24ab921bea771" title="Change the state of a bridged channel.">ast_bridge_change_state</a>(bridge_channel, <a class="code" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7a35a97f491c00d69b863f3656af8b4d4f">AST_BRIDGE_CHANNEL_STATE_FEATURE</a>);
<a name="l00257"></a>00257          <span class="keywordflow">break</span>;
<a name="l00258"></a>00258       }
<a name="l00259"></a>00259    }
<a name="l00260"></a>00260 
<a name="l00261"></a>00261    <span class="keywordflow">return</span> frame;
<a name="l00262"></a>00262 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae87cc33842c5acf5477d40f83c7e6a24"></a><!-- doxytag: member="bridging.c::bridge_make_compatible" ref="ae87cc33842c5acf5477d40f83c7e6a24" args="(struct ast_bridge *bridge, struct ast_bridge_channel *bridge_channel)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bridge_make_compatible </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge.html">ast_bridge</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__bridge__channel.html">ast_bridge_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge_channel</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bridging_8c_source.html#l00538">538</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l00711">ast_best_codec()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="frame_8c_source.html#l00573">ast_getformatname()</a>, <a class="el" href="frame_8c_source.html#l00586">ast_getformatname_multiple()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8c_source.html#l03731">ast_set_read_format()</a>, <a class="el" href="channel_8c_source.html#l03737">ast_set_write_format()</a>, <a class="el" href="bridging_8h_source.html#l00125">ast_bridge_channel::chan</a>, <a class="el" href="bridging__technology_8h_source.html#l00074">ast_bridge_technology::formats</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="bridging__technology_8h_source.html#l00046">ast_bridge_technology::name</a>, <a class="el" href="asterisk_8c_source.html#l00175">option_debug</a>, <a class="el" href="channel_8h_source.html#l00483">ast_channel::readformat</a>, <a class="el" href="bridging_8h_source.html#l00161">ast_bridge::technology</a>, and <a class="el" href="channel_8h_source.html#l00484">ast_channel::writeformat</a>.</p>

<p>Referenced by <a class="el" href="bridging_8c_source.html#l01106">ast_bridge_merge()</a>, <a class="el" href="bridging_8c_source.html#l00860">bridge_channel_join()</a>, and <a class="el" href="bridging_8c_source.html#l00585">smart_bridge_operation()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00539"></a>00539 {
<a name="l00540"></a>00540    <span class="keywordtype">int</span> <a class="code" href="structformats.html">formats</a>[2] = {bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#ab7786a0f5b9a9ebf83daed87be4f3868">readformat</a>, bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#a00f5ce2ad53ff8523f8e46ea5aceba48">writeformat</a>};
<a name="l00541"></a>00541 
<a name="l00542"></a>00542    <span class="comment">/* Are the formats currently in use something ths bridge can handle? */</span>
<a name="l00543"></a>00543    <span class="keywordflow">if</span> (!(bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#abec2f9ddc3eb615d8e6c80e356f57043">formats</a> &amp; bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#ab7786a0f5b9a9ebf83daed87be4f3868">readformat</a>)) {
<a name="l00544"></a>00544       <span class="keywordtype">int</span> best_format = <a class="code" href="channel_8h.html#a4d78194779a26341c3ec7298b450b9ed" title="Pick the best audio codec.">ast_best_codec</a>(bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#abec2f9ddc3eb615d8e6c80e356f57043">formats</a>);
<a name="l00545"></a>00545 
<a name="l00546"></a>00546       <span class="comment">/* Read format is a no go... */</span>
<a name="l00547"></a>00547       <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#ga40f8fb2e731031d99f732f515cec680f">option_debug</a>) {
<a name="l00548"></a>00548          <span class="keywordtype">char</span> codec_buf[512];
<a name="l00549"></a>00549          <a class="code" href="frame_8h.html#a37cdc7e78686b0bfa4e47e645f782b30" title="Get the names of a set of formats.">ast_getformatname_multiple</a>(codec_buf, <span class="keyword">sizeof</span>(codec_buf), bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#abec2f9ddc3eb615d8e6c80e356f57043">formats</a>);
<a name="l00550"></a>00550          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Bridge technology %s wants to read any of formats %s(%d) but channel has %s(%d)\n&quot;</span>, bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, codec_buf, bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#abec2f9ddc3eb615d8e6c80e356f57043">formats</a>, <a class="code" href="frame_8h.html#afe8f690984f8ba95cd01a431198c10bf" title="Get the name of a format.">ast_getformatname</a>(formats[0]), formats[0]);
<a name="l00551"></a>00551       }
<a name="l00552"></a>00552       <span class="comment">/* Switch read format to the best one chosen */</span>
<a name="l00553"></a>00553       <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a72d53065c6bc2b6092fa41eefa03f1ad" title="Sets read format on channel chan Set read format for channel to whichever component...">ast_set_read_format</a>(bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, best_format)) {
<a name="l00554"></a>00554          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to set channel %s to read format %s(%d)\n&quot;</span>, bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;name, <a class="code" href="frame_8h.html#afe8f690984f8ba95cd01a431198c10bf" title="Get the name of a format.">ast_getformatname</a>(best_format), best_format);
<a name="l00555"></a>00555          <span class="keywordflow">return</span> -1;
<a name="l00556"></a>00556       }
<a name="l00557"></a>00557       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Bridge %p put channel %s into read format %s(%d)\n&quot;</span>, bridge, bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;name, <a class="code" href="frame_8h.html#afe8f690984f8ba95cd01a431198c10bf" title="Get the name of a format.">ast_getformatname</a>(best_format), best_format);
<a name="l00558"></a>00558    } <span class="keywordflow">else</span> {
<a name="l00559"></a>00559       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Bridge %p is happy that channel %s already has read format %s(%d)\n&quot;</span>, bridge, bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;name, <a class="code" href="frame_8h.html#afe8f690984f8ba95cd01a431198c10bf" title="Get the name of a format.">ast_getformatname</a>(formats[0]), formats[0]);
<a name="l00560"></a>00560    }
<a name="l00561"></a>00561 
<a name="l00562"></a>00562    <span class="keywordflow">if</span> (!(bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#abec2f9ddc3eb615d8e6c80e356f57043">formats</a> &amp; formats[1])) {
<a name="l00563"></a>00563       <span class="keywordtype">int</span> best_format = <a class="code" href="channel_8h.html#a4d78194779a26341c3ec7298b450b9ed" title="Pick the best audio codec.">ast_best_codec</a>(bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#abec2f9ddc3eb615d8e6c80e356f57043">formats</a>);
<a name="l00564"></a>00564 
<a name="l00565"></a>00565       <span class="comment">/* Write format is a no go... */</span>
<a name="l00566"></a>00566       <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#ga40f8fb2e731031d99f732f515cec680f">option_debug</a>) {
<a name="l00567"></a>00567          <span class="keywordtype">char</span> codec_buf[512];
<a name="l00568"></a>00568          <a class="code" href="frame_8h.html#a37cdc7e78686b0bfa4e47e645f782b30" title="Get the names of a set of formats.">ast_getformatname_multiple</a>(codec_buf, <span class="keyword">sizeof</span>(codec_buf), bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#abec2f9ddc3eb615d8e6c80e356f57043">formats</a>);
<a name="l00569"></a>00569          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Bridge technology %s wants to write any of formats %s(%d) but channel has %s(%d)\n&quot;</span>, bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, codec_buf, bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#abec2f9ddc3eb615d8e6c80e356f57043">formats</a>, <a class="code" href="frame_8h.html#afe8f690984f8ba95cd01a431198c10bf" title="Get the name of a format.">ast_getformatname</a>(formats[1]), formats[1]);
<a name="l00570"></a>00570       }
<a name="l00571"></a>00571       <span class="comment">/* Switch write format to the best one chosen */</span>
<a name="l00572"></a>00572       <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a978161a52d98fdaee374d1f6e1359544" title="Sets write format on channel chan Set write format for channel to whichever component...">ast_set_write_format</a>(bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, best_format)) {
<a name="l00573"></a>00573          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to set channel %s to write format %s(%d)\n&quot;</span>, bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;name, <a class="code" href="frame_8h.html#afe8f690984f8ba95cd01a431198c10bf" title="Get the name of a format.">ast_getformatname</a>(best_format), best_format);
<a name="l00574"></a>00574          <span class="keywordflow">return</span> -1;
<a name="l00575"></a>00575       }
<a name="l00576"></a>00576       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Bridge %p put channel %s into write format %s(%d)\n&quot;</span>, bridge, bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;name, <a class="code" href="frame_8h.html#afe8f690984f8ba95cd01a431198c10bf" title="Get the name of a format.">ast_getformatname</a>(best_format), best_format);
<a name="l00577"></a>00577    } <span class="keywordflow">else</span> {
<a name="l00578"></a>00578       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Bridge %p is happy that channel %s already has write format %s(%d)\n&quot;</span>, bridge, bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;name, <a class="code" href="frame_8h.html#afe8f690984f8ba95cd01a431198c10bf" title="Get the name of a format.">ast_getformatname</a>(formats[1]), formats[1]);
<a name="l00579"></a>00579    }
<a name="l00580"></a>00580 
<a name="l00581"></a>00581    <span class="keywordflow">return</span> 0;
<a name="l00582"></a>00582 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a57c77ab33579cf3f1ddb054b758a826c"></a><!-- doxytag: member="bridging.c::bridge_poke" ref="a57c77ab33579cf3f1ddb054b758a826c" args="(struct ast_bridge *bridge)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void bridge_poke </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge.html">ast_bridge</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Helper function to poke the bridge thread. </p>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l00135">135</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l00082">AST_PTHREADT_NULL</a>, <a class="el" href="lock_8h_source.html#l00083">AST_PTHREADT_STOP</a>, and <a class="el" href="bridging_8h_source.html#l00165">ast_bridge::thread</a>.</p>

<p>Referenced by <a class="el" href="bridging_8c_source.html#l00514">ast_bridge_destroy()</a>, <a class="el" href="bridging_8c_source.html#l00149">bridge_array_add()</a>, <a class="el" href="bridging_8c_source.html#l00180">bridge_array_remove()</a>, and <a class="el" href="bridging_8c_source.html#l00585">smart_bridge_operation()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00136"></a>00136 {
<a name="l00137"></a>00137    <span class="comment">/* Poke the thread just in case */</span>
<a name="l00138"></a>00138    <span class="keywordflow">if</span> (bridge-&gt;<a class="code" href="structast__bridge.html#a01f75a9ad916f63a94e06a27635ba278">thread</a> != <a class="code" href="lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a> &amp;&amp; bridge-&gt;<a class="code" href="structast__bridge.html#a01f75a9ad916f63a94e06a27635ba278">thread</a> != <a class="code" href="lock_8h.html#a873a83eb8196323194aac2bea23d794e">AST_PTHREADT_STOP</a>) {
<a name="l00139"></a>00139       pthread_kill(bridge-&gt;<a class="code" href="structast__bridge.html#a01f75a9ad916f63a94e06a27635ba278">thread</a>, SIGURG);
<a name="l00140"></a>00140    }
<a name="l00141"></a>00141 
<a name="l00142"></a>00142    <span class="keywordflow">return</span>;
<a name="l00143"></a>00143 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a82dad941a0e25bf3f0b18759ae4ce667"></a><!-- doxytag: member="bridging.c::bridge_thread" ref="a82dad941a0e25bf3f0b18759ae4ce667" args="(void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void* bridge_thread </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Bridge thread function. </p>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l00353">353</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="astobj2_8c_source.html#l00147">ao2_lock()</a>, <a class="el" href="astobj2_8h_source.html#l00459">ao2_ref</a>, <a class="el" href="astobj2_8c_source.html#l00169">ao2_unlock()</a>, <a class="el" href="bridging_8h_source.html#l00171">ast_bridge::array_num</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="lock_8h_source.html#l00082">AST_PTHREADT_NULL</a>, <a class="el" href="bridging_8c_source.html#l00325">generic_thread_loop()</a>, <a class="el" href="bridging_8h_source.html#l00157">ast_bridge::refresh</a>, <a class="el" href="bridging_8h_source.html#l00155">ast_bridge::stop</a>, <a class="el" href="bridging_8h_source.html#l00161">ast_bridge::technology</a>, <a class="el" href="bridging_8h_source.html#l00165">ast_bridge::thread</a>, and <a class="el" href="structast__bridge__technology.html#a9c92063394ef5d0c7d22c8f4d4289f4c">ast_bridge_technology::thread</a>.</p>

<p>Referenced by <a class="el" href="bridging_8c_source.html#l00860">bridge_channel_join()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00354"></a>00354 {
<a name="l00355"></a>00355    <span class="keyword">struct </span><a class="code" href="structast__bridge.html" title="Structure that contains information about a bridge.">ast_bridge</a> *bridge = data;
<a name="l00356"></a>00356    <span class="keywordtype">int</span> res = 0;
<a name="l00357"></a>00357 
<a name="l00358"></a>00358    <a class="code" href="astobj2_8h.html#a3077056d07f6f9e348a54a743769bad5" title="Lock an object.">ao2_lock</a>(bridge);
<a name="l00359"></a>00359 
<a name="l00360"></a>00360    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Started bridge thread for %p\n&quot;</span>, bridge);
<a name="l00361"></a>00361 
<a name="l00362"></a>00362    <span class="comment">/* Loop around until we are told to stop */</span>
<a name="l00363"></a>00363    <span class="keywordflow">while</span> (!bridge-&gt;<a class="code" href="structast__bridge.html#a111277a0849f92b793ed6aa1efe54462">stop</a> &amp;&amp; bridge-&gt;<a class="code" href="structast__bridge.html#af2be787f5565bf34958c3453f93886ce">array_num</a> &amp;&amp; !res) {
<a name="l00364"></a>00364       <span class="comment">/* In case the refresh bit was set simply set it back to off */</span>
<a name="l00365"></a>00365       bridge-&gt;<a class="code" href="structast__bridge.html#abe8cd601789a09864cb8e795bdbf5b6b">refresh</a> = 0;
<a name="l00366"></a>00366 
<a name="l00367"></a>00367       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Launching bridge thread function %p for bridge %p\n&quot;</span>, (bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a9c92063394ef5d0c7d22c8f4d4289f4c">thread</a> ? bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a9c92063394ef5d0c7d22c8f4d4289f4c">thread</a> : &amp;<a class="code" href="bridging_8c.html#af73f5c8be78beef93b9098235115174a" title="Generic thread loop, TODO: Rethink this/improve it.">generic_thread_loop</a>), bridge);
<a name="l00368"></a>00368 
<a name="l00369"></a>00369       <span class="comment">/* Execute the appropriate thread function. If the technology does not provide one we use the generic one */</span>
<a name="l00370"></a>00370       res = (bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a9c92063394ef5d0c7d22c8f4d4289f4c">thread</a> ? bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a9c92063394ef5d0c7d22c8f4d4289f4c">thread</a>(bridge) : <a class="code" href="bridging_8c.html#af73f5c8be78beef93b9098235115174a" title="Generic thread loop, TODO: Rethink this/improve it.">generic_thread_loop</a>(bridge));
<a name="l00371"></a>00371    }
<a name="l00372"></a>00372 
<a name="l00373"></a>00373    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Ending bridge thread for %p\n&quot;</span>, bridge);
<a name="l00374"></a>00374 
<a name="l00375"></a>00375    <span class="comment">/* Indicate the bridge thread is no longer active */</span>
<a name="l00376"></a>00376    bridge-&gt;<a class="code" href="structast__bridge.html#a01f75a9ad916f63a94e06a27635ba278">thread</a> = <a class="code" href="lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>;
<a name="l00377"></a>00377    <a class="code" href="astobj2_8h.html#a379cc936a320f2179f7beb422dc15230" title="Unlock an object.">ao2_unlock</a>(bridge);
<a name="l00378"></a>00378 
<a name="l00379"></a>00379    <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(bridge, -1);
<a name="l00380"></a>00380 
<a name="l00381"></a>00381    <span class="keywordflow">return</span> NULL;
<a name="l00382"></a>00382 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a99f699e128b44c627baa3587d99a0661"></a><!-- doxytag: member="bridging.c::destroy_bridge" ref="a99f699e128b44c627baa3587d99a0661" args="(void *obj)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void destroy_bridge </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>obj</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="bridging_8c_source.html#l00420">420</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="bridging_8h_source.html#l00169">ast_bridge::array</a>, <a class="el" href="bridging_8c_source.html#l01320">ast_bridge_features_cleanup()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="loader_8c_source.html#l01171">ast_module_unref()</a>, <a class="el" href="structast__bridge__technology.html#a6b25531ea9ce6fd2d7a2f991b491846d">ast_bridge_technology::destroy</a>, <a class="el" href="bridging_8h_source.html#l00167">ast_bridge::features</a>, <a class="el" href="bridging__technology_8h_source.html#l00078">ast_bridge_technology::mod</a>, <a class="el" href="bridging__technology_8h_source.html#l00046">ast_bridge_technology::name</a>, and <a class="el" href="bridging_8h_source.html#l00161">ast_bridge::technology</a>.</p>

<p>Referenced by <a class="el" href="bridging_8c_source.html#l00448">ast_bridge_new()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00421"></a>00421 {
<a name="l00422"></a>00422    <span class="keyword">struct </span><a class="code" href="structast__bridge.html" title="Structure that contains information about a bridge.">ast_bridge</a> *bridge = obj;
<a name="l00423"></a>00423 
<a name="l00424"></a>00424    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Actually destroying bridge %p, nobody wants it anymore\n&quot;</span>, bridge);
<a name="l00425"></a>00425 
<a name="l00426"></a>00426    <span class="comment">/* Pass off the bridge to the technology to destroy if needed */</span>
<a name="l00427"></a>00427    <span class="keywordflow">if</span> (bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a6b25531ea9ce6fd2d7a2f991b491846d">destroy</a>) {
<a name="l00428"></a>00428       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Giving bridge technology %s the bridge structure %p to destroy\n&quot;</span>, bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, bridge);
<a name="l00429"></a>00429       <span class="keywordflow">if</span> (bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a6b25531ea9ce6fd2d7a2f991b491846d">destroy</a>(bridge)) {
<a name="l00430"></a>00430          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Bridge technology %s failed to destroy bridge structure %p... trying our best\n&quot;</span>, bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, bridge);
<a name="l00431"></a>00431       }
<a name="l00432"></a>00432    }
<a name="l00433"></a>00433 
<a name="l00434"></a>00434    <span class="comment">/* We are no longer using the bridge technology so decrement the module reference count on it */</span>
<a name="l00435"></a>00435    <span class="keywordflow">if</span> (bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a782aff512368932b8d71b3633f88cb04">mod</a>) {
<a name="l00436"></a>00436       <a class="code" href="module_8h.html#ac65fa15b16dbc563a2424af744ab003d">ast_module_unref</a>(bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a782aff512368932b8d71b3633f88cb04">mod</a>);
<a name="l00437"></a>00437    }
<a name="l00438"></a>00438 
<a name="l00439"></a>00439    <span class="comment">/* Last but not least clean up the features configuration */</span>
<a name="l00440"></a>00440    <a class="code" href="bridging__features_8h.html#acd324df24035097d55e7ecf1f214fab3" title="Clean up the contents of a bridge features structure.">ast_bridge_features_cleanup</a>(&amp;bridge-&gt;<a class="code" href="structast__bridge.html#aa5f7287d4bbab0f62a1bae18af89171d">features</a>);
<a name="l00441"></a>00441 
<a name="l00442"></a>00442    <span class="comment">/* Drop the array of channels */</span>
<a name="l00443"></a>00443    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(bridge-&gt;<a class="code" href="structast__bridge.html#a740283531a557dc86a34a57ea220fb79">array</a>);
<a name="l00444"></a>00444 
<a name="l00445"></a>00445    <span class="keywordflow">return</span>;
<a name="l00446"></a>00446 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a309ea60a7b664058b0f508c86079958e"></a><!-- doxytag: member="bridging.c::find_best_technology" ref="a309ea60a7b664058b0f508c86079958e" args="(int capabilities)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__bridge__technology.html">ast_bridge_technology</a>* find_best_technology </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>capabilities</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Helper function used to find the "best" bridge technology given a specified capabilities. </p>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l00385">385</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="loader_8c_source.html#l01163">ast_module_ref()</a>, <a class="el" href="linkedlists_8h_source.html#l00077">AST_RWLIST_RDLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00493">AST_RWLIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="bridging__technology_8h_source.html#l00048">ast_bridge_technology::capabilities</a>, <a class="el" href="bridging__technology_8h_source.html#l00046">ast_bridge_technology::name</a>, <a class="el" href="bridging__technology_8h_source.html#l00050">ast_bridge_technology::preference</a>, and <a class="el" href="bridging__technology_8h_source.html#l00076">ast_bridge_technology::suspended</a>.</p>

<p>Referenced by <a class="el" href="bridging_8c_source.html#l00501">ast_bridge_check()</a>, <a class="el" href="bridging_8c_source.html#l00448">ast_bridge_new()</a>, and <a class="el" href="bridging_8c_source.html#l00585">smart_bridge_operation()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00386"></a>00386 {
<a name="l00387"></a>00387    <span class="keyword">struct </span><a class="code" href="structast__bridge__technology.html" title="Structure that is the essence of a bridge technology.">ast_bridge_technology</a> *current = NULL, *best = NULL;
<a name="l00388"></a>00388 
<a name="l00389"></a>00389    <a class="code" href="linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc" title="Read locks a list.">AST_RWLIST_RDLOCK</a>(&amp;<a class="code" href="structbridge__technologies.html">bridge_technologies</a>);
<a name="l00390"></a>00390    <a class="code" href="linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;<a class="code" href="structbridge__technologies.html">bridge_technologies</a>, current, entry) {
<a name="l00391"></a>00391       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Bridge technology %s has capabilities %d and we want %d\n&quot;</span>, current-&gt;<a class="code" href="structast__bridge__technology.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, current-&gt;<a class="code" href="structast__bridge__technology.html#a9461ee266923070466f95a76158f65cd">capabilities</a>, <a class="code" href="res__jabber_8c.html#aa7afd7ba4814dbf49b1867019891fd14">capabilities</a>);
<a name="l00392"></a>00392       <span class="keywordflow">if</span> (current-&gt;<a class="code" href="structast__bridge__technology.html#a2862ffde11c780129862e5549415a6f6">suspended</a>) {
<a name="l00393"></a>00393          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Bridge technology %s is suspended. Skipping.\n&quot;</span>, current-&gt;<a class="code" href="structast__bridge__technology.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);
<a name="l00394"></a>00394          <span class="keywordflow">continue</span>;
<a name="l00395"></a>00395       }
<a name="l00396"></a>00396       <span class="keywordflow">if</span> (!(current-&gt;<a class="code" href="structast__bridge__technology.html#a9461ee266923070466f95a76158f65cd">capabilities</a> &amp; <a class="code" href="res__jabber_8c.html#aa7afd7ba4814dbf49b1867019891fd14">capabilities</a>)) {
<a name="l00397"></a>00397          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Bridge technology %s does not have the capabilities we need.\n&quot;</span>, current-&gt;<a class="code" href="structast__bridge__technology.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);
<a name="l00398"></a>00398          <span class="keywordflow">continue</span>;
<a name="l00399"></a>00399       }
<a name="l00400"></a>00400       <span class="keywordflow">if</span> (best &amp;&amp; best-&gt;preference &lt; current-&gt;<a class="code" href="structast__bridge__technology.html#afd6ff339b48e5945cea37601655f2e35">preference</a>) {
<a name="l00401"></a>00401          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Bridge technology %s has preference %d while %s has preference %d. Skipping.\n&quot;</span>, current-&gt;<a class="code" href="structast__bridge__technology.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, current-&gt;<a class="code" href="structast__bridge__technology.html#afd6ff339b48e5945cea37601655f2e35">preference</a>, best-&gt;name, best-&gt;preference);
<a name="l00402"></a>00402          <span class="keywordflow">continue</span>;
<a name="l00403"></a>00403       }
<a name="l00404"></a>00404       best = current;
<a name="l00405"></a>00405    }
<a name="l00406"></a>00406 
<a name="l00407"></a>00407    <span class="keywordflow">if</span> (best) {
<a name="l00408"></a>00408       <span class="comment">/* Increment it&apos;s module reference count if present so it does not get unloaded while in use */</span>
<a name="l00409"></a>00409       <span class="keywordflow">if</span> (best-&gt;mod) {
<a name="l00410"></a>00410          <a class="code" href="module_8h.html#aa08fcee0b390e15532dd03803c8728c4">ast_module_ref</a>(best-&gt;mod);
<a name="l00411"></a>00411       }
<a name="l00412"></a>00412       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Chose bridge technology %s\n&quot;</span>, best-&gt;name);
<a name="l00413"></a>00413    }
<a name="l00414"></a>00414 
<a name="l00415"></a>00415    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structbridge__technologies.html">bridge_technologies</a>);
<a name="l00416"></a>00416 
<a name="l00417"></a>00417    <span class="keywordflow">return</span> best;
<a name="l00418"></a>00418 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af76003eaee352a6e71c4411b99c87eb1"></a><!-- doxytag: member="bridging.c::find_bridge_channel" ref="af76003eaee352a6e71c4411b99c87eb1" args="(struct ast_bridge *bridge, struct ast_channel *chan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__bridge__channel.html">ast_bridge_channel</a>* find_bridge_channel </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge.html">ast_bridge</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Helper function to find a bridge channel given a channel. </p>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l00204">204</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, and <a class="el" href="bridging_8h_source.html#l00125">ast_bridge_channel::chan</a>.</p>

<p>Referenced by <a class="el" href="bridging_8c_source.html#l01064">ast_bridge_depart()</a>, <a class="el" href="bridging_8c_source.html#l00276">ast_bridge_handle_trip()</a>, <a class="el" href="bridging_8c_source.html#l01087">ast_bridge_remove()</a>, <a class="el" href="bridging_8c_source.html#l01187">ast_bridge_suspend()</a>, <a class="el" href="bridging_8c_source.html#l01205">ast_bridge_unsuspend()</a>, and <a class="el" href="bridging_8c_source.html#l00860">bridge_channel_join()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00205"></a>00205 {
<a name="l00206"></a>00206    <span class="keyword">struct </span><a class="code" href="structast__bridge__channel.html" title="Structure that contains information regarding a channel in a bridge.">ast_bridge_channel</a> *bridge_channel = NULL;
<a name="l00207"></a>00207 
<a name="l00208"></a>00208    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;bridge-&gt;channels, bridge_channel, entry) {
<a name="l00209"></a>00209       <span class="keywordflow">if</span> (bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a84d1435c5b8d387806714ea7079304b7">chan</a> == chan) {
<a name="l00210"></a>00210          <span class="keywordflow">break</span>;
<a name="l00211"></a>00211       }
<a name="l00212"></a>00212    }
<a name="l00213"></a>00213 
<a name="l00214"></a>00214    <span class="keywordflow">return</span> bridge_channel;
<a name="l00215"></a>00215 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af73f5c8be78beef93b9098235115174a"></a><!-- doxytag: member="bridging.c::generic_thread_loop" ref="af73f5c8be78beef93b9098235115174a" args="(struct ast_bridge *bridge)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int generic_thread_loop </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge.html">ast_bridge</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Generic thread loop, TODO: Rethink this/improve it. </p>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l00325">325</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="astobj2_8c_source.html#l00147">ao2_lock()</a>, <a class="el" href="astobj2_8c_source.html#l00169">ao2_unlock()</a>, <a class="el" href="bridging_8h_source.html#l00169">ast_bridge::array</a>, <a class="el" href="bridging_8h_source.html#l00171">ast_bridge::array_num</a>, <a class="el" href="bridging_8c_source.html#l00276">ast_bridge_handle_trip()</a>, <a class="el" href="channel_8c_source.html#l02384">ast_waitfor_n()</a>, <a class="el" href="devicestate_8c_source.html#l00198">first</a>, <a class="el" href="bridging_8h_source.html#l00157">ast_bridge::refresh</a>, <a class="el" href="bridging_8h_source.html#l00155">ast_bridge::stop</a>, and <a class="el" href="bridging_8h_source.html#l00153">ast_bridge::waiting</a>.</p>

<p>Referenced by <a class="el" href="bridging_8c_source.html#l00353">bridge_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00326"></a>00326 {
<a name="l00327"></a>00327    <span class="keywordflow">while</span> (!bridge-&gt;<a class="code" href="structast__bridge.html#a111277a0849f92b793ed6aa1efe54462">stop</a> &amp;&amp; !bridge-&gt;<a class="code" href="structast__bridge.html#abe8cd601789a09864cb8e795bdbf5b6b">refresh</a> &amp;&amp; bridge-&gt;<a class="code" href="structast__bridge.html#af2be787f5565bf34958c3453f93886ce">array_num</a>) {
<a name="l00328"></a>00328       <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *winner = NULL;
<a name="l00329"></a>00329       <span class="keywordtype">int</span> to = -1;
<a name="l00330"></a>00330 
<a name="l00331"></a>00331       <span class="comment">/* Move channels around for priority reasons if we have more than one channel in our array */</span>
<a name="l00332"></a>00332       <span class="keywordflow">if</span> (bridge-&gt;<a class="code" href="structast__bridge.html#af2be787f5565bf34958c3453f93886ce">array_num</a> &gt; 1) {
<a name="l00333"></a>00333          <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="devicestate_8c.html#abd2135e6f8a41bc900933b1985d97165">first</a> = bridge-&gt;<a class="code" href="structast__bridge.html#a740283531a557dc86a34a57ea220fb79">array</a>[0];
<a name="l00334"></a>00334          memmove(bridge-&gt;<a class="code" href="structast__bridge.html#a740283531a557dc86a34a57ea220fb79">array</a>, bridge-&gt;<a class="code" href="structast__bridge.html#a740283531a557dc86a34a57ea220fb79">array</a> + 1, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *) * (bridge-&gt;<a class="code" href="structast__bridge.html#af2be787f5565bf34958c3453f93886ce">array_num</a> - 1));
<a name="l00335"></a>00335          bridge-&gt;<a class="code" href="structast__bridge.html#a740283531a557dc86a34a57ea220fb79">array</a>[(bridge-&gt;<a class="code" href="structast__bridge.html#af2be787f5565bf34958c3453f93886ce">array_num</a> - 1)] = first;
<a name="l00336"></a>00336       }
<a name="l00337"></a>00337 
<a name="l00338"></a>00338       <span class="comment">/* Wait on the channels */</span>
<a name="l00339"></a>00339       bridge-&gt;<a class="code" href="structast__bridge.html#a4227e2fa9e7151f8c1339021e54dee10">waiting</a> = 1;
<a name="l00340"></a>00340       <a class="code" href="astobj2_8h.html#a379cc936a320f2179f7beb422dc15230" title="Unlock an object.">ao2_unlock</a>(bridge);
<a name="l00341"></a>00341       winner = <a class="code" href="channel_8h.html#aec8ce59b78afbd3651f3de011f13290a" title="Waits for input on a group of channels Wait for input on an array of channels for...">ast_waitfor_n</a>(bridge-&gt;<a class="code" href="structast__bridge.html#a740283531a557dc86a34a57ea220fb79">array</a>, (<span class="keywordtype">int</span>)bridge-&gt;<a class="code" href="structast__bridge.html#af2be787f5565bf34958c3453f93886ce">array_num</a>, &amp;to);
<a name="l00342"></a>00342       bridge-&gt;<a class="code" href="structast__bridge.html#a4227e2fa9e7151f8c1339021e54dee10">waiting</a> = 0;
<a name="l00343"></a>00343       <a class="code" href="astobj2_8h.html#a3077056d07f6f9e348a54a743769bad5" title="Lock an object.">ao2_lock</a>(bridge);
<a name="l00344"></a>00344 
<a name="l00345"></a>00345       <span class="comment">/* Process whatever they did */</span>
<a name="l00346"></a>00346       <a class="code" href="bridging__technology_8h.html#ab01e4cd0a5b35dda072677f415b5f32a" title="Feed notification that a frame is waiting on a channel into the bridging core.">ast_bridge_handle_trip</a>(bridge, NULL, winner, -1);
<a name="l00347"></a>00347    }
<a name="l00348"></a>00348 
<a name="l00349"></a>00349    <span class="keywordflow">return</span> 0;
<a name="l00350"></a>00350 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a343a22dfa2196b0b3f6702a057ab07a4"></a><!-- doxytag: member="bridging.c::smart_bridge_operation" ref="a343a22dfa2196b0b3f6702a057ab07a4" args="(struct ast_bridge *bridge, struct ast_bridge_channel *bridge_channel, int count)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int smart_bridge_operation </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge.html">ast_bridge</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__bridge__channel.html">ast_bridge_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge_channel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>count</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Perform the smart bridge operation. Basically sees if a new bridge technology should be used instead of the current one. </p>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l00585">585</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="bridging_8h_source.html#l00070">AST_BRIDGE_CAPABILITY_1TO1MIX</a>, <a class="el" href="bridging_8h_source.html#l00072">AST_BRIDGE_CAPABILITY_MULTIMIX</a>, <a class="el" href="bridging_8h_source.html#l00078">AST_BRIDGE_CAPABILITY_THREAD</a>, <a class="el" href="lock_8h_source.html#l01734">ast_cond_signal()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="loader_8c_source.html#l01171">ast_module_unref()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="lock_8h_source.html#l00082">AST_PTHREADT_NULL</a>, <a class="el" href="bridging_8c_source.html#l00538">bridge_make_compatible()</a>, <a class="el" href="bridging_8c_source.html#l00135">bridge_poke()</a>, <a class="el" href="bridging_8h_source.html#l00163">ast_bridge::bridge_pvt</a>, <a class="el" href="bridging__technology_8h_source.html#l00048">ast_bridge_technology::capabilities</a>, <a class="el" href="bridging_8h_source.html#l00121">ast_bridge_channel::cond</a>, <a class="el" href="structast__bridge__technology.html#a4c02331d19c7cdb01704c544961130a1">ast_bridge_technology::create</a>, <a class="el" href="bridging_8c_source.html#l00385">find_best_technology()</a>, <a class="el" href="structast__bridge__technology.html#a8b369fed84f7c637d98be4861971590b">ast_bridge_technology::join</a>, <a class="el" href="bridging_8h_source.html#l00119">ast_bridge_channel::lock</a>, <a class="el" href="bridging__technology_8h_source.html#l00046">ast_bridge_technology::name</a>, <a class="el" href="bridging_8h_source.html#l00157">ast_bridge::refresh</a>, <a class="el" href="bridging_8h_source.html#l00155">ast_bridge::stop</a>, <a class="el" href="bridging_8h_source.html#l00161">ast_bridge::technology</a>, <a class="el" href="bridging_8h_source.html#l00133">ast_bridge_channel::thread</a>, and <a class="el" href="bridging_8h_source.html#l00165">ast_bridge::thread</a>.</p>

<p>Referenced by <a class="el" href="bridging_8c_source.html#l01106">ast_bridge_merge()</a>, and <a class="el" href="bridging_8c_source.html#l00860">bridge_channel_join()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00586"></a>00586 {
<a name="l00587"></a>00587    <span class="keywordtype">int</span> new_capabilities = 0;
<a name="l00588"></a>00588    <span class="keyword">struct </span><a class="code" href="structast__bridge__technology.html" title="Structure that is the essence of a bridge technology.">ast_bridge_technology</a> *new_technology = NULL, *old_technology = bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>;
<a name="l00589"></a>00589    <span class="keyword">struct </span><a class="code" href="structast__bridge.html" title="Structure that contains information about a bridge.">ast_bridge</a> temp_bridge = {
<a name="l00590"></a>00590       .technology = bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>,
<a name="l00591"></a>00591       .bridge_pvt = bridge-&gt;<a class="code" href="structast__bridge.html#a1b4d2c720e6b4a8832d32b97eb37ae54">bridge_pvt</a>,
<a name="l00592"></a>00592    };
<a name="l00593"></a>00593    <span class="keyword">struct </span><a class="code" href="structast__bridge__channel.html" title="Structure that contains information regarding a channel in a bridge.">ast_bridge_channel</a> *bridge_channel2 = NULL;
<a name="l00594"></a>00594 
<a name="l00595"></a>00595    <span class="comment">/* Based on current feature determine whether we want to change bridge technologies or not */</span>
<a name="l00596"></a>00596    <span class="keywordflow">if</span> (bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a9461ee266923070466f95a76158f65cd">capabilities</a> &amp; <a class="code" href="bridging_8h.html#a815c9b3e933dfd4b8f523cf55caa5bbfaf483c951b835fcc35da807b6a4b12509">AST_BRIDGE_CAPABILITY_1TO1MIX</a>) {
<a name="l00597"></a>00597       <span class="keywordflow">if</span> (count &lt;= 2) {
<a name="l00598"></a>00598          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Bridge %p channel count (%d) is within limits for bridge technology %s, not performing smart bridge operation.\n&quot;</span>, bridge, count, bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);
<a name="l00599"></a>00599          <span class="keywordflow">return</span> 0;
<a name="l00600"></a>00600       }
<a name="l00601"></a>00601       new_capabilities = <a class="code" href="bridging_8h.html#a815c9b3e933dfd4b8f523cf55caa5bbfabd40da8a498f3027c44dfa2e92d5f4ac">AST_BRIDGE_CAPABILITY_MULTIMIX</a>;
<a name="l00602"></a>00602    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a9461ee266923070466f95a76158f65cd">capabilities</a> &amp; <a class="code" href="bridging_8h.html#a815c9b3e933dfd4b8f523cf55caa5bbfabd40da8a498f3027c44dfa2e92d5f4ac">AST_BRIDGE_CAPABILITY_MULTIMIX</a>) {
<a name="l00603"></a>00603       <span class="keywordflow">if</span> (count &gt; 2) {
<a name="l00604"></a>00604          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Bridge %p channel count (%d) is within limits for bridge technology %s, not performing smart bridge operation.\n&quot;</span>, bridge, count, bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);
<a name="l00605"></a>00605          <span class="keywordflow">return</span> 0;
<a name="l00606"></a>00606       }
<a name="l00607"></a>00607       new_capabilities = <a class="code" href="bridging_8h.html#a815c9b3e933dfd4b8f523cf55caa5bbfaf483c951b835fcc35da807b6a4b12509">AST_BRIDGE_CAPABILITY_1TO1MIX</a>;
<a name="l00608"></a>00608    }
<a name="l00609"></a>00609 
<a name="l00610"></a>00610    <span class="keywordflow">if</span> (!new_capabilities) {
<a name="l00611"></a>00611       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Bridge &apos;%p&apos; has no new capabilities, not performing smart bridge operation.\n&quot;</span>, bridge);
<a name="l00612"></a>00612       <span class="keywordflow">return</span> 0;
<a name="l00613"></a>00613    }
<a name="l00614"></a>00614 
<a name="l00615"></a>00615    <span class="comment">/* Attempt to find a new bridge technology to satisfy the capabilities */</span>
<a name="l00616"></a>00616    <span class="keywordflow">if</span> (!(new_technology = <a class="code" href="bridging_8c.html#a309ea60a7b664058b0f508c86079958e" title="Helper function used to find the &amp;quot;best&amp;quot; bridge technology given a specified...">find_best_technology</a>(new_capabilities))) {
<a name="l00617"></a>00617       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Smart bridge operation was unable to find new bridge technology with capabilities %d to satisfy bridge %p\n&quot;</span>, new_capabilities, bridge);
<a name="l00618"></a>00618       <span class="keywordflow">return</span> -1;
<a name="l00619"></a>00619    }
<a name="l00620"></a>00620 
<a name="l00621"></a>00621    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Performing smart bridge operation on bridge %p, moving from bridge technology %s to %s\n&quot;</span>, bridge, old_technology-&gt;name, new_technology-&gt;<a class="code" href="structast__bridge__technology.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);
<a name="l00622"></a>00622 
<a name="l00623"></a>00623    <span class="comment">/* If a thread is currently executing for the current technology tell it to stop */</span>
<a name="l00624"></a>00624    <span class="keywordflow">if</span> (bridge-&gt;<a class="code" href="structast__bridge.html#a01f75a9ad916f63a94e06a27635ba278">thread</a> != <a class="code" href="lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>) {
<a name="l00625"></a>00625       <span class="comment">/* If the new bridge technology also needs a thread simply tell the bridge thread to refresh itself. This has the benefit of not incurring the cost/time of tearing down and bringing up a new thread. */</span>
<a name="l00626"></a>00626       <span class="keywordflow">if</span> (new_technology-&gt;<a class="code" href="structast__bridge__technology.html#a9461ee266923070466f95a76158f65cd">capabilities</a> &amp; <a class="code" href="bridging_8h.html#a815c9b3e933dfd4b8f523cf55caa5bbfaa03170187c779ad77c3c724255140d56">AST_BRIDGE_CAPABILITY_THREAD</a>) {
<a name="l00627"></a>00627          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Telling current bridge thread for bridge %p to refresh\n&quot;</span>, bridge);
<a name="l00628"></a>00628          bridge-&gt;<a class="code" href="structast__bridge.html#abe8cd601789a09864cb8e795bdbf5b6b">refresh</a> = 1;
<a name="l00629"></a>00629       } <span class="keywordflow">else</span> {
<a name="l00630"></a>00630          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Telling current bridge thread for bridge %p to stop\n&quot;</span>, bridge);
<a name="l00631"></a>00631          bridge-&gt;<a class="code" href="structast__bridge.html#a111277a0849f92b793ed6aa1efe54462">stop</a> = 1;
<a name="l00632"></a>00632       }
<a name="l00633"></a>00633       <a class="code" href="bridging_8c.html#a57c77ab33579cf3f1ddb054b758a826c" title="Helper function to poke the bridge thread.">bridge_poke</a>(bridge);
<a name="l00634"></a>00634    }
<a name="l00635"></a>00635 
<a name="l00636"></a>00636    <span class="comment">/* Since we are soon going to pass this bridge to a new technology we need to NULL out the bridge_pvt pointer but don&apos;t worry as it still exists in temp_bridge, ditto for the old technology */</span>
<a name="l00637"></a>00637    bridge-&gt;<a class="code" href="structast__bridge.html#a1b4d2c720e6b4a8832d32b97eb37ae54">bridge_pvt</a> = NULL;
<a name="l00638"></a>00638    bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a> = new_technology;
<a name="l00639"></a>00639 
<a name="l00640"></a>00640    <span class="comment">/* Pass the bridge to the new bridge technology so it can set it up */</span>
<a name="l00641"></a>00641    <span class="keywordflow">if</span> (new_technology-&gt;<a class="code" href="structast__bridge__technology.html#a4c02331d19c7cdb01704c544961130a1">create</a>) {
<a name="l00642"></a>00642       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Giving bridge technology %s the bridge structure %p to setup\n&quot;</span>, new_technology-&gt;<a class="code" href="structast__bridge__technology.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, bridge);
<a name="l00643"></a>00643       <span class="keywordflow">if</span> (new_technology-&gt;<a class="code" href="structast__bridge__technology.html#a4c02331d19c7cdb01704c544961130a1">create</a>(bridge)) {
<a name="l00644"></a>00644          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Bridge technology %s failed to setup bridge structure %p\n&quot;</span>, new_technology-&gt;<a class="code" href="structast__bridge__technology.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, bridge);
<a name="l00645"></a>00645       }
<a name="l00646"></a>00646    }
<a name="l00647"></a>00647 
<a name="l00648"></a>00648    <span class="comment">/* Move existing channels over to the new technology, while taking them away from the old one */</span>
<a name="l00649"></a>00649    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;bridge-&gt;channels, bridge_channel2, entry) {
<a name="l00650"></a>00650       <span class="comment">/* Skip over channel that initiated the smart bridge operation */</span>
<a name="l00651"></a>00651       <span class="keywordflow">if</span> (bridge_channel == bridge_channel2) {
<a name="l00652"></a>00652          <span class="keywordflow">continue</span>;
<a name="l00653"></a>00653       }
<a name="l00654"></a>00654 
<a name="l00655"></a>00655       <span class="comment">/* First we part them from the old technology */</span>
<a name="l00656"></a>00656       <span class="keywordflow">if</span> (old_technology-&gt;leave) {
<a name="l00657"></a>00657          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Giving bridge technology %s notification that %p is leaving bridge %p (really %p)\n&quot;</span>, old_technology-&gt;name, bridge_channel2, &amp;temp_bridge, bridge);
<a name="l00658"></a>00658          <span class="keywordflow">if</span> (old_technology-&gt;leave(&amp;temp_bridge, bridge_channel2)) {
<a name="l00659"></a>00659             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Bridge technology %s failed to allow %p (really %p) to leave bridge %p\n&quot;</span>, old_technology-&gt;name, bridge_channel2, &amp;temp_bridge, bridge);
<a name="l00660"></a>00660          }
<a name="l00661"></a>00661       }
<a name="l00662"></a>00662 
<a name="l00663"></a>00663       <span class="comment">/* Second we make them compatible again with the bridge */</span>
<a name="l00664"></a>00664       <a class="code" href="bridging_8c.html#ae87cc33842c5acf5477d40f83c7e6a24">bridge_make_compatible</a>(bridge, bridge_channel2);
<a name="l00665"></a>00665 
<a name="l00666"></a>00666       <span class="comment">/* Third we join them to the new technology */</span>
<a name="l00667"></a>00667       <span class="keywordflow">if</span> (new_technology-&gt;<a class="code" href="structast__bridge__technology.html#a8b369fed84f7c637d98be4861971590b">join</a>) {
<a name="l00668"></a>00668          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Giving bridge technology %s notification that %p is joining bridge %p\n&quot;</span>, new_technology-&gt;<a class="code" href="structast__bridge__technology.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, bridge_channel2, bridge);
<a name="l00669"></a>00669          <span class="keywordflow">if</span> (new_technology-&gt;<a class="code" href="structast__bridge__technology.html#a8b369fed84f7c637d98be4861971590b">join</a>(bridge, bridge_channel2)) {
<a name="l00670"></a>00670             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Bridge technology %s failed to join %p to bridge %p\n&quot;</span>, new_technology-&gt;<a class="code" href="structast__bridge__technology.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, bridge_channel2, bridge);
<a name="l00671"></a>00671          }
<a name="l00672"></a>00672       }
<a name="l00673"></a>00673 
<a name="l00674"></a>00674       <span class="comment">/* Fourth we tell them to wake up so they become aware that they above has happened */</span>
<a name="l00675"></a>00675       pthread_kill(bridge_channel2-&gt;<a class="code" href="structast__bridge__channel.html#a01f75a9ad916f63a94e06a27635ba278">thread</a>, SIGURG);
<a name="l00676"></a>00676       <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;bridge_channel2-&gt;<a class="code" href="structast__bridge__channel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00677"></a>00677       <a class="code" href="lock_8h.html#a02a91e30acdea6d13208d23636d37c87">ast_cond_signal</a>(&amp;bridge_channel2-&gt;<a class="code" href="structast__bridge__channel.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>);
<a name="l00678"></a>00678       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;bridge_channel2-&gt;<a class="code" href="structast__bridge__channel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00679"></a>00679    }
<a name="l00680"></a>00680 
<a name="l00681"></a>00681    <span class="comment">/* Now that all the channels have been moved over we need to get rid of all the information the old technology may have left around */</span>
<a name="l00682"></a>00682    <span class="keywordflow">if</span> (old_technology-&gt;destroy) {
<a name="l00683"></a>00683       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Giving bridge technology %s the bridge structure %p (really %p) to destroy\n&quot;</span>, old_technology-&gt;name, &amp;temp_bridge, bridge);
<a name="l00684"></a>00684       <span class="keywordflow">if</span> (old_technology-&gt;destroy(&amp;temp_bridge)) {
<a name="l00685"></a>00685          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Bridge technology %s failed to destroy bridge structure %p (really %p)... some memory may have leaked\n&quot;</span>, old_technology-&gt;name, &amp;temp_bridge, bridge);
<a name="l00686"></a>00686       }
<a name="l00687"></a>00687    }
<a name="l00688"></a>00688 
<a name="l00689"></a>00689    <span class="comment">/* Finally if the old technology has module referencing remove our reference, we are no longer going to use it */</span>
<a name="l00690"></a>00690    <span class="keywordflow">if</span> (old_technology-&gt;mod) {
<a name="l00691"></a>00691       <a class="code" href="module_8h.html#ac65fa15b16dbc563a2424af744ab003d">ast_module_unref</a>(old_technology-&gt;mod);
<a name="l00692"></a>00692    }
<a name="l00693"></a>00693 
<a name="l00694"></a>00694    <span class="keywordflow">return</span> 0;
<a name="l00695"></a>00695 }
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a2df991cc86ea9bb473f730f2af4b2649"></a><!-- doxytag: member="bridging.c::builtin_features_dtmf" ref="a2df991cc86ea9bb473f730f2af4b2649" args="[AST_BRIDGE_BUILTIN_END][MAXIMUM_DTMF_FEATURE_STRING]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="bridging_8c.html#a2df991cc86ea9bb473f730f2af4b2649">builtin_features_dtmf</a>[AST_BRIDGE_BUILTIN_END][MAXIMUM_DTMF_FEATURE_STRING]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Default DTMF <a class="el" href="structkeys.html">keys</a> for built in features </p>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l00054">54</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

</div>
</div>
<a class="anchor" id="af4095d93586f95dd08ef1ad461bc3b80"></a><!-- doxytag: member="bridging.c::builtin_features_handlers" ref="af4095d93586f95dd08ef1ad461bc3b80" args="[AST_BRIDGE_BUILTIN_END]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* <a class="el" href="bridging_8c.html#af4095d93586f95dd08ef1ad461bc3b80">builtin_features_handlers</a>[AST_BRIDGE_BUILTIN_END]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Function handlers for the built in features </p>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l00057">57</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:19:41 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
