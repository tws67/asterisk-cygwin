<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:18:38 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_afe38fc0ccf2e9eefca5d5c6b03503d9.html">main</a>
  </div>
</div>
<div class="contents">
<h1>config.c</h1><a href="config_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Asterisk -- An open source telephony toolkit.</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * Copyright (C) 1999 - 2005, Digium, Inc.</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * Mark Spencer &lt;markster@digium.com&gt;</span>
<a name="l00007"></a>00007 <span class="comment"> *</span>
<a name="l00008"></a>00008 <span class="comment"> * See http://www.asterisk.org for more information about</span>
<a name="l00009"></a>00009 <span class="comment"> * the Asterisk project. Please do not directly contact</span>
<a name="l00010"></a>00010 <span class="comment"> * any of the maintainers of this project for assistance;</span>
<a name="l00011"></a>00011 <span class="comment"> * the project provides a web site, mailing lists and IRC</span>
<a name="l00012"></a>00012 <span class="comment"> * channels for your use.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * This program is free software, distributed under the terms of</span>
<a name="l00015"></a>00015 <span class="comment"> * the GNU General Public License Version 2. See the LICENSE file</span>
<a name="l00016"></a>00016 <span class="comment"> * at the top of the source tree.</span>
<a name="l00017"></a>00017 <span class="comment"> */</span>
<a name="l00018"></a>00018 <span class="comment"></span>
<a name="l00019"></a>00019 <span class="comment">/*! \file</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * \brief Configuration File Parser</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * \author Mark Spencer &lt;markster@digium.com&gt;</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> * Includes the Asterisk Realtime API - ARA</span>
<a name="l00026"></a>00026 <span class="comment"> * See doc/realtime.txt and doc/extconfig.txt</span>
<a name="l00027"></a>00027 <span class="comment"> */</span>
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;<a class="code" href="asterisk_8h.html" title="Asterisk main include file. File version handling, generic pbx functions.">asterisk.h</a>&quot;</span>
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <a class="code" href="asterisk_8h.html#ab0390be60f8c539a2662df2faf9985c7" title="Register/unregister a source code file with the core.">ASTERISK_FILE_VERSION</a>(__FILE__, <span class="stringliteral">&quot;$Revision: 241019 $&quot;</span>)
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;asterisk/paths.h&quot;   </span><span class="comment">/* use ast_config_AST_CONFIG_DIR */</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="network_8h.html" title="Wrapper for network related headers, masking differences between various operating...">asterisk/network.h</a>&quot;</span> <span class="comment">/* we do some sockaddr manipulation here */</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;<a class="code" href="time_8h.html" title="Time-related functions and macros.">time.h</a>&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;sys/stat.h&gt;</span>
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;math.h&gt;</span> <span class="comment">/* HUGE_VAL */</span>
<a name="l00039"></a>00039 
<a name="l00040"></a><a class="code" href="config_8c.html#ab9e2be369865ccdfe6b3d4a0daa06f48">00040</a> <span class="preprocessor">#define AST_INCLUDE_GLOB 1</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="config_8h.html" title="Configuration File Parser.">asterisk/config.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="cli_8h.html" title="Standard Command Line Interface.">asterisk/cli.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="lock_8h.html" title="Asterisk locking-related definitions:ast_mutext_t, ast_rwlock_t and related functions;atomic...">asterisk/lock.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="utils_8h.html" title="Utility functions.">asterisk/utils.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="channel_8h.html" title="General Asterisk PBX channel definitions.">asterisk/channel.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="app_8h.html" title="Application convenience functions, designed to give consistent look and feel to Asterisk...">asterisk/app.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="astobj2_8h.html">asterisk/astobj2.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="strings_8h.html" title="String manipulation functions.">asterisk/strings.h</a>&quot;</span> <span class="comment">/* for the ast_str_*() API */</span>
<a name="l00050"></a>00050 
<a name="l00051"></a><a class="code" href="config_8c.html#a10b55e9c454317681d0f02637b7d5d5f">00051</a> <span class="preprocessor">#define MAX_NESTED_COMMENTS 128</span>
<a name="l00052"></a><a class="code" href="config_8c.html#ad967b5a0284a82dd5b016acba9f79b49">00052</a> <span class="preprocessor"></span><span class="preprocessor">#define COMMENT_START &quot;;--&quot;</span>
<a name="l00053"></a><a class="code" href="config_8c.html#a3d6ac4849211be6ae3a2f1d69af2fa32">00053</a> <span class="preprocessor"></span><span class="preprocessor">#define COMMENT_END &quot;--;&quot;</span>
<a name="l00054"></a><a class="code" href="config_8c.html#aaf9102a2769ad8474a6819249647e87e">00054</a> <span class="preprocessor"></span><span class="preprocessor">#define COMMENT_META &apos;;&apos;</span>
<a name="l00055"></a><a class="code" href="config_8c.html#a52406a72fd0a2b4c0ea8e21e64083e3c">00055</a> <span class="preprocessor"></span><span class="preprocessor">#define COMMENT_TAG &apos;-&apos;</span>
<a name="l00056"></a>00056 <span class="preprocessor"></span>
<a name="l00057"></a><a class="code" href="config_8c.html#ad7d518478e64aef37f9e57f74a0ec12a">00057</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="config_8c.html#ad7d518478e64aef37f9e57f74a0ec12a">extconfig_conf</a> = <span class="stringliteral">&quot;extconfig.conf&quot;</span>;
<a name="l00058"></a>00058 
<a name="l00059"></a>00059 <span class="comment"></span>
<a name="l00060"></a>00060 <span class="comment">/*! \brief Structure to keep comments for rewriting configuration files */</span>
<a name="l00061"></a><a class="code" href="structast__comment.html">00061</a> <span class="keyword">struct </span><a class="code" href="structast__comment.html" title="Structure to keep comments for rewriting configuration files.">ast_comment</a> {
<a name="l00062"></a><a class="code" href="structast__comment.html#adab84eadfeb3d2c35ac0a185b9345e8f">00062</a>    <span class="keyword">struct </span><a class="code" href="structast__comment.html" title="Structure to keep comments for rewriting configuration files.">ast_comment</a> *<a class="code" href="structast__comment.html#adab84eadfeb3d2c35ac0a185b9345e8f">next</a>;
<a name="l00063"></a><a class="code" href="structast__comment.html#adfc7bf9f42a9a3b2a61d704e97853ba6">00063</a>    <span class="keywordtype">char</span> <a class="code" href="structast__comment.html#adfc7bf9f42a9a3b2a61d704e97853ba6">cmt</a>[0];
<a name="l00064"></a>00064 };
<a name="l00065"></a>00065 <span class="comment"></span>
<a name="l00066"></a>00066 <span class="comment">/*! \brief Hold the mtime for config files, so if we don&apos;t need to reread our config, don&apos;t. */</span>
<a name="l00067"></a><a class="code" href="structcache__file__include.html">00067</a> <span class="keyword">struct </span><a class="code" href="structcache__file__include.html" title="Hold the mtime for config files, so if we don&amp;#39;t need to reread our config, don&amp;#39;t...">cache_file_include</a> {
<a name="l00068"></a><a class="code" href="structcache__file__include.html#a17253bfca1ae38a3e1d2ff2bf5755fb5">00068</a>    <a class="code" href="linkedlists_8h.html#a67508a613c8f337732e35d9367b43ae7" title="Declare a forward link structure inside a list entry.">AST_LIST_ENTRY</a>(<a class="code" href="structcache__file__include.html" title="Hold the mtime for config files, so if we don&amp;#39;t need to reread our config, don&amp;#39;t...">cache_file_include</a>) <a class="code" href="structcache__file__include.html#a04713779b868fec14894a2aee75241ef">list</a>;
<a name="l00069"></a><a class="code" href="structcache__file__include.html#abdbb2af142a7c931ec450a5224e6fd76">00069</a>    <span class="keywordtype">char</span> <a class="code" href="structcache__file__include.html#abdbb2af142a7c931ec450a5224e6fd76">include</a>[0];
<a name="l00070"></a>00070 };
<a name="l00071"></a>00071 
<a name="l00072"></a><a class="code" href="structcache__file__mtime.html">00072</a> struct <a class="code" href="structcache__file__mtime.html">cache_file_mtime</a> {
<a name="l00073"></a><a class="code" href="structcache__file__mtime.html#a5d5a599b0eccaad96b2efc33fe4b2614">00073</a>    <a class="code" href="linkedlists_8h.html#a67508a613c8f337732e35d9367b43ae7" title="Declare a forward link structure inside a list entry.">AST_LIST_ENTRY</a>(cache_file_mtime) list;
<a name="l00074"></a><a class="code" href="structcache__file__mtime_1_1includes.html#adf04f66344e3fb0a6f6a69bf39d19902">00074</a>    <a class="code" href="linkedlists_8h.html#acdb4f56da6b3071d02dcce20072852b0" title="Defines a structure to be used to hold a list of specified type.">AST_LIST_HEAD</a>(<a class="code" href="structcache__file__mtime_1_1includes.html">includes</a>, <a class="code" href="structcache__file__include.html" title="Hold the mtime for config files, so if we don&amp;#39;t need to reread our config, don&amp;#39;t...">cache_file_include</a>) includes;
<a name="l00075"></a><a class="code" href="structcache__file__mtime.html#a71b2199618baf99c5320948cd63ca39a">00075</a>    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> has_exec:1;
<a name="l00076"></a><a class="code" href="structcache__file__mtime.html#a4a2d3a53446ef3217564ced73636f9bf">00076</a>    time_t mtime;
<a name="l00077"></a><a class="code" href="structcache__file__mtime.html#ac1a3dfe5c9e5cf85abc41b8ca002ef7f">00077</a>    <span class="keywordtype">char</span> *who_asked;
<a name="l00078"></a><a class="code" href="structcache__file__mtime.html#afae8c108f5d360038fa8b099eb4ab2f3">00078</a>    <span class="keywordtype">char</span> filename[0];
<a name="l00079"></a>00079 };
<a name="l00080"></a>00080 
<a name="l00081"></a><a class="code" href="structcfmtime__head.html#adf04f66344e3fb0a6f6a69bf39d19902">00081</a> static <a class="code" href="linkedlists_8h.html#a10f9ed9242a397abf76de1ed1fa33c3b" title="Defines a structure to be used to hold a list of specified type, statically initialized...">AST_LIST_HEAD_STATIC</a>(<a class="code" href="structcfmtime__head.html">cfmtime_head</a>, cache_file_mtime);
<a name="l00082"></a>00082 
<a name="l00083"></a><a class="code" href="config_8c.html#a63a339c94358f0e36d47bc0f6c4a1138">00083</a> static <span class="keywordtype">int</span> <a class="code" href="config_8c.html#a63a339c94358f0e36d47bc0f6c4a1138">init_appendbuf</a>(<span class="keywordtype">void</span> *data)
<a name="l00084"></a>00084 {
<a name="l00085"></a>00085    <span class="keyword">struct </span><a class="code" href="structast__str.html" title="The descriptor of a dynamic string XXX storage will be optimized later if needed...">ast_str</a> **<a class="code" href="app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a> = data;
<a name="l00086"></a>00086    *str = <a class="code" href="strings_8h.html#a8ec37e4acb6ecb20eb6f6edd1141cd76" title="Create a malloc&amp;#39;ed dynamic length string.">ast_str_create</a>(16);
<a name="l00087"></a>00087    <span class="keywordflow">return</span> *str ? 0 : -1;
<a name="l00088"></a>00088 }
<a name="l00089"></a>00089 
<a name="l00090"></a><a class="code" href="config_8c.html#a9ac5c88e7facdcd3515f5ca81b39f7ce">00090</a> <a class="code" href="threadstorage_8h.html#a3fb5391416c5bf7a18d5f7f7b84c4b81" title="Define a thread storage variable, with custom initialization and cleanup.">AST_THREADSTORAGE_CUSTOM</a>(<a class="code" href="config_8c.html#a9ac5c88e7facdcd3515f5ca81b39f7ce">appendbuf</a>, <a class="code" href="config_8c.html#a63a339c94358f0e36d47bc0f6c4a1138">init_appendbuf</a>, <a class="code" href="utils_8h.html#a4e6aceb50eca868b7c38064c6c1a4789" title="free() wrapper">ast_free_ptr</a>);
<a name="l00091"></a>00091 
<a name="l00092"></a>00092 <span class="comment">/* comment buffers are better implemented using the ast_str_*() API */</span>
<a name="l00093"></a><a class="code" href="config_8c.html#a4747dd52513b0f70eb469de949ac8e9a">00093</a> <span class="preprocessor">#define CB_SIZE 250  </span><span class="comment">/* initial size of comment buffers */</span>
<a name="l00094"></a>00094 
<a name="l00095"></a><a class="code" href="config_8c.html#afcda43b41847d0c455e05a9fdc0f76c5">00095</a> <span class="keyword">static</span> <span class="keywordtype">void</span>  <a class="code" href="config_8c.html#afcda43b41847d0c455e05a9fdc0f76c5">CB_ADD</a>(<span class="keyword">struct</span> <a class="code" href="structast__str.html" title="The descriptor of a dynamic string XXX storage will be optimized later if needed...">ast_str</a> **cb, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>)
<a name="l00096"></a>00096 {
<a name="l00097"></a>00097    <a class="code" href="strings_8h.html#a85cd5a8ef499e39d22b4bfeb8b9a64f7" title="Append to a thread local dynamic string.">ast_str_append</a>(cb, 0, <span class="stringliteral">&quot;%s&quot;</span>, str);
<a name="l00098"></a>00098 }
<a name="l00099"></a>00099 
<a name="l00100"></a><a class="code" href="config_8c.html#ac9549309749e5a9acd3a68f1e8ab02bc">00100</a> <span class="keyword">static</span> <span class="keywordtype">void</span>  <a class="code" href="config_8c.html#ac9549309749e5a9acd3a68f1e8ab02bc">CB_ADD_LEN</a>(<span class="keyword">struct</span> <a class="code" href="structast__str.html" title="The descriptor of a dynamic string XXX storage will be optimized later if needed...">ast_str</a> **cb, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>, <span class="keywordtype">int</span> <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>)
<a name="l00101"></a>00101 {
<a name="l00102"></a>00102    <span class="keywordtype">char</span> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a> = alloca(len + 1);
<a name="l00103"></a>00103    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(s, str, len);
<a name="l00104"></a>00104    <a class="code" href="strings_8h.html#a85cd5a8ef499e39d22b4bfeb8b9a64f7" title="Append to a thread local dynamic string.">ast_str_append</a>(cb, 0, <span class="stringliteral">&quot;%s&quot;</span>, str);
<a name="l00105"></a>00105 }
<a name="l00106"></a>00106 
<a name="l00107"></a><a class="code" href="config_8c.html#a9dbb0c1c6f38088927df54ba55454a1b">00107</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="config_8c.html#a9dbb0c1c6f38088927df54ba55454a1b">CB_RESET</a>(<span class="keyword">struct</span> <a class="code" href="structast__str.html" title="The descriptor of a dynamic string XXX storage will be optimized later if needed...">ast_str</a> *cb, <span class="keyword">struct</span> <a class="code" href="structast__str.html" title="The descriptor of a dynamic string XXX storage will be optimized later if needed...">ast_str</a> *llb)  
<a name="l00108"></a>00108 { 
<a name="l00109"></a>00109    <span class="keywordflow">if</span> (cb) {
<a name="l00110"></a>00110       <a class="code" href="strings_8h.html#a7820deea616cbb2e28f16d518de91c80" title="Reset the content of a dynamic string. Useful before a series of ast_str_append.">ast_str_reset</a>(cb);
<a name="l00111"></a>00111    }
<a name="l00112"></a>00112    <span class="keywordflow">if</span> (llb) {
<a name="l00113"></a>00113       <a class="code" href="strings_8h.html#a7820deea616cbb2e28f16d518de91c80" title="Reset the content of a dynamic string. Useful before a series of ast_str_append.">ast_str_reset</a>(llb);
<a name="l00114"></a>00114    }
<a name="l00115"></a>00115 }
<a name="l00116"></a>00116 
<a name="l00117"></a><a class="code" href="config_8c.html#a8131ec339c40205a5fae190516e347e1">00117</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structast__comment.html" title="Structure to keep comments for rewriting configuration files.">ast_comment</a> *<a class="code" href="config_8c.html#a8131ec339c40205a5fae190516e347e1">ALLOC_COMMENT</a>(<span class="keyword">struct</span> <a class="code" href="structast__str.html" title="The descriptor of a dynamic string XXX storage will be optimized later if needed...">ast_str</a> *buffer)
<a name="l00118"></a>00118 { 
<a name="l00119"></a>00119    <span class="keyword">struct </span><a class="code" href="structast__comment.html" title="Structure to keep comments for rewriting configuration files.">ast_comment</a> *x = NULL;
<a name="l00120"></a>00120    <span class="keywordflow">if</span> (!buffer || !<a class="code" href="strings_8h.html#a99409c17a1d20e1c3dc00039b7925a2d" title="Returns the current length of the string stored within buf.">ast_str_strlen</a>(buffer)) {
<a name="l00121"></a>00121       <span class="keywordflow">return</span> NULL;
<a name="l00122"></a>00122    }
<a name="l00123"></a>00123    <span class="keywordflow">if</span> ((x = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*x) + <a class="code" href="strings_8h.html#a99409c17a1d20e1c3dc00039b7925a2d" title="Returns the current length of the string stored within buf.">ast_str_strlen</a>(buffer) + 1))) {
<a name="l00124"></a>00124       strcpy(x-&gt;<a class="code" href="structast__comment.html#adfc7bf9f42a9a3b2a61d704e97853ba6">cmt</a>, <a class="code" href="strings_8h.html#a053bdfc229997a75f112bdd7b995e00b" title="Returns the string buffer within the ast_str buf.">ast_str_buffer</a>(buffer)); <span class="comment">/* SAFE */</span>
<a name="l00125"></a>00125    }
<a name="l00126"></a>00126    <span class="keywordflow">return</span> x;
<a name="l00127"></a>00127 }
<a name="l00128"></a>00128 
<a name="l00129"></a>00129 <span class="comment">/* I need to keep track of each config file, and all its inclusions,</span>
<a name="l00130"></a>00130 <span class="comment">   so that we can track blank lines in each */</span>
<a name="l00131"></a>00131 
<a name="l00132"></a><a class="code" href="structinclfile.html">00132</a> <span class="keyword">struct </span><a class="code" href="structinclfile.html">inclfile</a> {
<a name="l00133"></a><a class="code" href="structinclfile.html#ae96bbe3347b319ee7bdbd1f2e2ba9f5b">00133</a>    <span class="keywordtype">char</span> *fname;
<a name="l00134"></a><a class="code" href="structinclfile.html#a501b314f49b3a9ff6e7be599d94686ee">00134</a>    <span class="keywordtype">int</span> lineno;
<a name="l00135"></a>00135 };
<a name="l00136"></a>00136 
<a name="l00137"></a><a class="code" href="config_8c.html#aad5ce0e28669396c43aae46f17a3453a">00137</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="config_8c.html#aad5ce0e28669396c43aae46f17a3453a">hash_string</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *obj, <span class="keyword">const</span> <span class="keywordtype">int</span> flags)
<a name="l00138"></a>00138 {
<a name="l00139"></a>00139    <span class="keywordtype">char</span> *<a class="code" href="app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a> = ((<span class="keyword">struct </span><a class="code" href="structinclfile.html">inclfile</a> *) obj)-&gt;fname;
<a name="l00140"></a>00140    <span class="keywordtype">int</span> <a class="code" href="res__adsi_8c.html#ac7af894858cf396a219d632f40afdc8d">total</a>;
<a name="l00141"></a>00141 
<a name="l00142"></a>00142    <span class="keywordflow">for</span> (total = 0; *str; str++) {
<a name="l00143"></a>00143       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tmp = total;
<a name="l00144"></a>00144       total &lt;&lt;= 1; <span class="comment">/* multiply by 2 */</span>
<a name="l00145"></a>00145       total += tmp; <span class="comment">/* multiply by 3 */</span>
<a name="l00146"></a>00146       total &lt;&lt;= 2; <span class="comment">/* multiply by 12 */</span>
<a name="l00147"></a>00147       total += tmp; <span class="comment">/* multiply by 13 */</span>
<a name="l00148"></a>00148 
<a name="l00149"></a>00149       total += ((<span class="keywordtype">unsigned</span> int) (*str));
<a name="l00150"></a>00150    }
<a name="l00151"></a>00151    <span class="keywordflow">if</span> (total &lt; 0) {
<a name="l00152"></a>00152       total = -total;
<a name="l00153"></a>00153    }
<a name="l00154"></a>00154    <span class="keywordflow">return</span> total;
<a name="l00155"></a>00155 }
<a name="l00156"></a>00156 
<a name="l00157"></a><a class="code" href="config_8c.html#a6da577f4b98c9ab78c60c829375acaa1">00157</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="config_8c.html#a6da577f4b98c9ab78c60c829375acaa1">hashtab_compare_strings</a>(<span class="keywordtype">void</span> *a, <span class="keywordtype">void</span> *b, <span class="keywordtype">int</span> flags)
<a name="l00158"></a>00158 {
<a name="l00159"></a>00159    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structinclfile.html">inclfile</a> *ae = a, *be = b;
<a name="l00160"></a>00160    <span class="keywordflow">return</span> !strcmp(ae-&gt;<a class="code" href="structinclfile.html#ae96bbe3347b319ee7bdbd1f2e2ba9f5b">fname</a>, be-&gt;fname) ? <a class="code" href="astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a> | <a class="code" href="astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df">CMP_STOP</a> : 0;
<a name="l00161"></a>00161 }
<a name="l00162"></a>00162 
<a name="l00163"></a><a class="code" href="structast__config__map.html">00163</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structast__config__map.html">ast_config_map</a> {
<a name="l00164"></a><a class="code" href="structast__config__map.html#a116d426c4bbd073eec3caf2455b6c576">00164</a>    <span class="keyword">struct </span><a class="code" href="structast__config__map.html">ast_config_map</a> *<a class="code" href="structcache__file__include.html#a17253bfca1ae38a3e1d2ff2bf5755fb5">next</a>;
<a name="l00165"></a><a class="code" href="structast__config__map.html#a5ac083a645d964373f022d03df4849c8">00165</a>    <span class="keywordtype">char</span> *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>;
<a name="l00166"></a><a class="code" href="structast__config__map.html#a129a7813daee3387f3932182eb7dc3f7">00166</a>    <span class="keywordtype">char</span> *<a class="code" href="structast__config__map.html#a129a7813daee3387f3932182eb7dc3f7">driver</a>;
<a name="l00167"></a><a class="code" href="structast__config__map.html#a8a48a6504d4d5a43bd3ab452ee0e8cb4">00167</a>    <span class="keywordtype">char</span> *<a class="code" href="structast__config__map.html#a8a48a6504d4d5a43bd3ab452ee0e8cb4">database</a>;
<a name="l00168"></a><a class="code" href="structast__config__map.html#abc4810aa7718733bfc48b1973f4c92f8">00168</a>    <span class="keywordtype">char</span> *<a class="code" href="cdr__odbc_8c.html#a68d1e6e752f2cf81551fac543cae108a">table</a>;
<a name="l00169"></a><a class="code" href="structast__config__map.html#a7af2365ea6fa5bbbf507c1666e946824">00169</a>    <span class="keywordtype">char</span> <a class="code" href="structast__config__map.html#a7af2365ea6fa5bbbf507c1666e946824">stuff</a>[0];
<a name="l00170"></a>00170 } *<a class="code" href="config_8c.html#aac242c96b19f1c7a0ecfb2c6c45cac4f">config_maps</a> = NULL;
<a name="l00171"></a>00171 
<a name="l00172"></a><a class="code" href="config_8c.html#a502fc4d80b1f4d10bc516dbd85f9bd93">00172</a> <a class="code" href="lock_8h.html#ac840092853644cea0a186efdc58985f5">AST_MUTEX_DEFINE_STATIC</a>(<a class="code" href="config_8c.html#a502fc4d80b1f4d10bc516dbd85f9bd93">config_lock</a>);
<a name="l00173"></a><a class="code" href="config_8c.html#ae180c3d9beab00be39309fe36c32aebb">00173</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structast__config__engine.html" title="Configuration engine structure, used to define realtime drivers.">ast_config_engine</a> *<a class="code" href="config_8c.html#ae180c3d9beab00be39309fe36c32aebb">config_engine_list</a>;
<a name="l00174"></a>00174 
<a name="l00175"></a><a class="code" href="config_8c.html#aafe4bba8deb3c1d5d016032a4c1abc14">00175</a> <span class="preprocessor">#define MAX_INCLUDE_LEVEL 10</span>
<a name="l00176"></a>00176 <span class="preprocessor"></span>
<a name="l00177"></a><a class="code" href="structast__category__template__instance.html">00177</a> <span class="keyword">struct </span><a class="code" href="structast__category__template__instance.html">ast_category_template_instance</a> {
<a name="l00178"></a><a class="code" href="structast__category__template__instance.html#a3777dbae63a15da001b2baa317a25149">00178</a>    <span class="keywordtype">char</span> <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>[80]; <span class="comment">/* redundant? */</span>
<a name="l00179"></a><a class="code" href="structast__category__template__instance.html#a4a795962dfc694a64a8c88bcb097b282">00179</a>    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structast__category.html">ast_category</a> *inst;
<a name="l00180"></a><a class="code" href="structast__category__template__instance.html#ae8ee399f9e4434148eedc7de9c63bf18">00180</a>    <a class="code" href="linkedlists_8h.html#a67508a613c8f337732e35d9367b43ae7" title="Declare a forward link structure inside a list entry.">AST_LIST_ENTRY</a>(<a class="code" href="structast__category__template__instance.html">ast_category_template_instance</a>) <a class="code" href="structcache__file__include.html#a17253bfca1ae38a3e1d2ff2bf5755fb5">next</a>;
<a name="l00181"></a>00181 };
<a name="l00182"></a>00182 
<a name="l00183"></a><a class="code" href="structast__category.html">00183</a> struct <a class="code" href="structast__category.html">ast_category</a> {
<a name="l00184"></a><a class="code" href="structast__category.html#a3777dbae63a15da001b2baa317a25149">00184</a>    <span class="keywordtype">char</span> <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>[80];
<a name="l00185"></a><a class="code" href="structast__category.html#a973274447fb1c6eb9b27c5a54505bb69">00185</a>    <span class="keywordtype">int</span> <a class="code" href="structast__category.html#a973274447fb1c6eb9b27c5a54505bb69">ignored</a>;         <span class="comment">/*!&lt; do not let user of the config see this category -- set by (!) after the category decl; a template */</span>
<a name="l00186"></a><a class="code" href="structast__category.html#a9889e4b9ce57e4055f9c11bacf89e50a">00186</a>    <span class="keywordtype">int</span> <a class="code" href="structast__category.html#a9889e4b9ce57e4055f9c11bacf89e50a">include_level</a>;
<a name="l00187"></a><a class="code" href="structast__category.html#adf16cd437526a5c5e0e0af87745acbb8">00187</a>    <span class="keywordtype">char</span> *<a class="code" href="structast__category.html#adf16cd437526a5c5e0e0af87745acbb8">file</a>;            <span class="comment">/*!&lt; the file name from whence this declaration was read */</span>
<a name="l00188"></a><a class="code" href="structast__category.html#a501b314f49b3a9ff6e7be599d94686ee">00188</a>    <span class="keywordtype">int</span> <a class="code" href="structast__category.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>;
<a name="l00189"></a><a class="code" href="structast__category_1_1template__instance__list.html#ab20dbb1dcfe88f463af63159889bb307">00189</a>    <a class="code" href="linkedlists_8h.html#a117cbef6a40010cd3c84a16fd9ef4ca6" title="Defines a structure to be used to hold a list of specified type (with no lock).">AST_LIST_HEAD_NOLOCK</a>(<a class="code" href="structast__category_1_1template__instance__list.html">template_instance_list</a>, <a class="code" href="structast__category__template__instance.html">ast_category_template_instance</a>) <a class="code" href="structast__category.html#aae97cd31a5d99cca5025058686aac6d7">template_instances</a>;
<a name="l00190"></a><a class="code" href="structast__category.html#a80bf10e9bcb9c00a7a59051a77a620cf">00190</a>    struct <a class="code" href="structast__comment.html" title="Structure to keep comments for rewriting configuration files.">ast_comment</a> *<a class="code" href="structast__category.html#a80bf10e9bcb9c00a7a59051a77a620cf">precomments</a>;
<a name="l00191"></a><a class="code" href="structast__category.html#a6e4312227f9a7570709abf7f686f1cfe">00191</a>    struct <a class="code" href="structast__comment.html" title="Structure to keep comments for rewriting configuration files.">ast_comment</a> *<a class="code" href="structast__category.html#a6e4312227f9a7570709abf7f686f1cfe">sameline</a>;
<a name="l00192"></a><a class="code" href="structast__category.html#ab09dbd177767543015efa3ba28fab03a">00192</a>    struct <a class="code" href="structast__comment.html" title="Structure to keep comments for rewriting configuration files.">ast_comment</a> *<a class="code" href="structast__category.html#ab09dbd177767543015efa3ba28fab03a">trailing</a>; <span class="comment">/*!&lt; the last object in the list will get assigned any trailing comments when EOF is hit */</span>
<a name="l00193"></a><a class="code" href="structast__category.html#a6f86d2cb07f9a779a13a854d21b40728">00193</a>    struct <a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *<a class="code" href="structast__category.html#a6f86d2cb07f9a779a13a854d21b40728">root</a>;
<a name="l00194"></a><a class="code" href="structast__category.html#ac6bc41916ca996a56407db9d13e2e734">00194</a>    struct <a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *<a class="code" href="devicestate_8c.html#a43a8def62ee15449794285cbbc0f79af">last</a>;
<a name="l00195"></a><a class="code" href="structast__category.html#a0a4a1c6e5b4ed640d4bb7c697df91212">00195</a>    struct ast_category *next;
<a name="l00196"></a>00196 };
<a name="l00197"></a>00197 
<a name="l00198"></a><a class="code" href="structast__config.html">00198</a> struct <a class="code" href="structast__config.html">ast_config</a> {
<a name="l00199"></a><a class="code" href="structast__config.html#a1d069527a476fcfd5e93263cda8099dd">00199</a>    <span class="keyword">struct </span>ast_category *root;
<a name="l00200"></a><a class="code" href="structast__config.html#a3419d1f39268adeeb95610eaf215952d">00200</a>    <span class="keyword">struct </span>ast_category *last;
<a name="l00201"></a><a class="code" href="structast__config.html#a204ede9a191a91abc1968f94973de556">00201</a>    <span class="keyword">struct </span>ast_category *current;
<a name="l00202"></a><a class="code" href="structast__config.html#acd249676fca8f438f6762b26fb92f712">00202</a>    <span class="keyword">struct </span>ast_category *last_browse;     <span class="comment">/*!&lt; used to cache the last category supplied via category_browse */</span>
<a name="l00203"></a><a class="code" href="structast__config.html#a9889e4b9ce57e4055f9c11bacf89e50a">00203</a>    <span class="keywordtype">int</span> include_level;
<a name="l00204"></a><a class="code" href="structast__config.html#a98a1a362d95d774ba9bf42efd1706700">00204</a>    <span class="keywordtype">int</span> max_include_level;
<a name="l00205"></a><a class="code" href="structast__config.html#acb049f8b410c47aebfde624a7de10819">00205</a>    <span class="keyword">struct </span><a class="code" href="structast__config__include.html">ast_config_include</a> *includes;  <span class="comment">/*!&lt; a list of inclusions, which should describe the entire tree */</span>
<a name="l00206"></a>00206 };
<a name="l00207"></a>00207 
<a name="l00208"></a><a class="code" href="structast__config__include.html">00208</a> <span class="keyword">struct </span><a class="code" href="structast__config__include.html">ast_config_include</a> {
<a name="l00209"></a><a class="code" href="structast__config__include.html#ad2a400871412e45079d5b0b09dbe34be">00209</a>    <span class="keywordtype">char</span> *include_location_file;     <span class="comment">/*!&lt; file name in which the include occurs */</span>
<a name="l00210"></a><a class="code" href="structast__config__include.html#ae2135f6bf6382a1e687d07ccdf811d64">00210</a>    <span class="keywordtype">int</span>  include_location_lineno;    <span class="comment">/*!&lt; lineno where include occurred */</span>
<a name="l00211"></a><a class="code" href="structast__config__include.html#a4fb0f078574c9bdeeaee433d411298c9">00211</a>    <span class="keywordtype">int</span>  <a class="code" href="pbx__lua_8c.html#a0ea9753b753253d4c74b215c6d290e52">exec</a>;                       <span class="comment">/*!&lt; set to non-zero if itsa #exec statement */</span>
<a name="l00212"></a><a class="code" href="structast__config__include.html#ac06a64b674f41fa8d0d3c86b9dffa3c4">00212</a>    <span class="keywordtype">char</span> *exec_file;                 <span class="comment">/*!&lt; if it&apos;s an exec, you&apos;ll have both the /var/tmp to read, and the original script */</span>
<a name="l00213"></a><a class="code" href="structast__config__include.html#a5d894d3ac3a63ddbe13305c29b0aceb8">00213</a>    <span class="keywordtype">char</span> *included_file;             <span class="comment">/*!&lt; file name included */</span>
<a name="l00214"></a><a class="code" href="structast__config__include.html#a2ff205bf57ceb7d5d2baf12d2411bb4c">00214</a>    <span class="keywordtype">int</span> inclusion_count;             <span class="comment">/*!&lt; if the file is included more than once, a running count thereof -- but, worry not,</span>
<a name="l00215"></a>00215 <span class="comment">                                         we explode the instances and will include those-- so all entries will be unique */</span>
<a name="l00216"></a><a class="code" href="structast__config__include.html#a76a055a540e12c7206a5004afea1f66e">00216</a>    <span class="keywordtype">int</span> output;                      <span class="comment">/*!&lt; a flag to indicate if the inclusion has been output */</span>
<a name="l00217"></a><a class="code" href="structast__config__include.html#ae2104fb51ee9f10eb0006df77fb8d504">00217</a>    <span class="keyword">struct </span><a class="code" href="structast__config__include.html">ast_config_include</a> *next; <span class="comment">/*!&lt; ptr to next inclusion in the list */</span>
<a name="l00218"></a>00218 };
<a name="l00219"></a>00219 
<a name="l00220"></a>00220 <span class="preprocessor">#ifdef MALLOC_DEBUG</span>
<a name="l00221"></a>00221 <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *_ast_variable_new(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *filename, <span class="keyword">const</span> <span class="keywordtype">char</span> *file, <span class="keyword">const</span> <span class="keywordtype">char</span> *func, <span class="keywordtype">int</span> lineno) 
<a name="l00222"></a>00222 <span class="preprocessor">#else</span>
<a name="l00223"></a><a class="code" href="config_8c.html#a08e94d96f459e7301a74daf32035423b">00223</a> <span class="preprocessor"></span><span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *<a class="code" href="config_8h.html#a08e94d96f459e7301a74daf32035423b">ast_variable_new</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keyword">const</span> <span class="keywordtype">char</span> *value, <span class="keyword">const</span> <span class="keywordtype">char</span> *filename) 
<a name="l00224"></a>00224 <span class="preprocessor">#endif</span>
<a name="l00225"></a>00225 <span class="preprocessor"></span>{
<a name="l00226"></a>00226    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *variable;
<a name="l00227"></a>00227    <span class="keywordtype">int</span> name_len = strlen(name) + 1; 
<a name="l00228"></a>00228    <span class="keywordtype">int</span> val_len = strlen(value) + 1; 
<a name="l00229"></a>00229    <span class="keywordtype">int</span> fn_len = strlen(filename) + 1;  
<a name="l00230"></a>00230 
<a name="l00231"></a>00231 <span class="preprocessor">#ifdef MALLOC_DEBUG</span>
<a name="l00232"></a>00232 <span class="preprocessor"></span>   <span class="keywordflow">if</span> ((variable = <a class="code" href="astmm_8h.html#ad800d5c993a0c605f6e061bdef1b524c">__ast_calloc</a>(1, name_len + val_len + fn_len + <span class="keyword">sizeof</span>(*variable), file, lineno, func))) {
<a name="l00233"></a>00233 <span class="preprocessor">#else</span>
<a name="l00234"></a>00234 <span class="preprocessor"></span>   <span class="keywordflow">if</span> ((variable = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, name_len + val_len + fn_len + <span class="keyword">sizeof</span>(*variable)))) {
<a name="l00235"></a>00235 <span class="preprocessor">#endif</span>
<a name="l00236"></a>00236 <span class="preprocessor"></span>      <span class="keywordtype">char</span> *dst = variable-&gt;<a class="code" href="structast__variable.html#a7af2365ea6fa5bbbf507c1666e946824">stuff</a>;  <span class="comment">/* writable space starts here */</span>
<a name="l00237"></a>00237       variable-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = strcpy(dst, name);
<a name="l00238"></a>00238       dst += name_len;
<a name="l00239"></a>00239       variable-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a> = strcpy(dst, value);
<a name="l00240"></a>00240       dst += val_len;
<a name="l00241"></a>00241       variable-&gt;<a class="code" href="structast__variable.html#adf16cd437526a5c5e0e0af87745acbb8">file</a> = strcpy(dst, filename);
<a name="l00242"></a>00242    }
<a name="l00243"></a>00243    <span class="keywordflow">return</span> variable;
<a name="l00244"></a>00244 }
<a name="l00245"></a>00245 
<a name="l00246"></a><a class="code" href="config_8c.html#ada3b4df6e8ca0a7408e66bd9761a1339">00246</a> <span class="keyword">struct </span><a class="code" href="structast__config__include.html">ast_config_include</a> *<a class="code" href="config_8h.html#ada3b4df6e8ca0a7408e66bd9761a1339">ast_include_new</a>(<span class="keyword">struct</span> <a class="code" href="structast__config.html">ast_config</a> *conf, <span class="keyword">const</span> <span class="keywordtype">char</span> *from_file, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structast__config__include.html#a5d894d3ac3a63ddbe13305c29b0aceb8">included_file</a>, <span class="keywordtype">int</span> is_exec, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structast__config__include.html#ac06a64b674f41fa8d0d3c86b9dffa3c4">exec_file</a>, <span class="keywordtype">int</span> from_lineno, <span class="keywordtype">char</span> *real_included_file_name, <span class="keywordtype">int</span> real_included_file_name_size)
<a name="l00247"></a>00247 {
<a name="l00248"></a>00248    <span class="comment">/* a file should be included ONCE. Otherwise, if one of the instances is changed,</span>
<a name="l00249"></a>00249 <span class="comment">    * then all be changed. -- how do we know to include it? -- Handling modified </span>
<a name="l00250"></a>00250 <span class="comment">    * instances is possible, I&apos;d have</span>
<a name="l00251"></a>00251 <span class="comment">    * to create a new master for each instance. */</span>
<a name="l00252"></a>00252    <span class="keyword">struct </span><a class="code" href="structast__config__include.html">ast_config_include</a> *inc;
<a name="l00253"></a>00253    <span class="keyword">struct </span>stat statbuf;
<a name="l00254"></a>00254    
<a name="l00255"></a>00255    inc = <a class="code" href="config_8h.html#a7a653e8d3b6e1696e58f52a0534aff80">ast_include_find</a>(conf, included_file);
<a name="l00256"></a>00256    <span class="keywordflow">if</span> (inc) {
<a name="l00257"></a>00257       <span class="keywordflow">do</span> {
<a name="l00258"></a>00258          inc-&gt;inclusion_count++;
<a name="l00259"></a>00259          snprintf(real_included_file_name, real_included_file_name_size, <span class="stringliteral">&quot;%s~~%d&quot;</span>, included_file, inc-&gt;inclusion_count);
<a name="l00260"></a>00260       } <span class="keywordflow">while</span> (stat(real_included_file_name, &amp;statbuf) == 0);
<a name="l00261"></a>00261       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,<span class="stringliteral">&quot;&apos;%s&apos;, line %d:  Same File included more than once! This data will be saved in %s if saved back to disk.\n&quot;</span>, from_file, from_lineno, real_included_file_name);
<a name="l00262"></a>00262    } <span class="keywordflow">else</span>
<a name="l00263"></a>00263       *real_included_file_name = 0;
<a name="l00264"></a>00264    
<a name="l00265"></a>00265    inc = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1,<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structast__config__include.html">ast_config_include</a>));
<a name="l00266"></a>00266    inc-&gt;include_location_file = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(from_file);
<a name="l00267"></a>00267    inc-&gt;include_location_lineno = from_lineno;
<a name="l00268"></a>00268    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(real_included_file_name))
<a name="l00269"></a>00269       inc-&gt;included_file = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(real_included_file_name);
<a name="l00270"></a>00270    <span class="keywordflow">else</span>
<a name="l00271"></a>00271       inc-&gt;included_file = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(included_file);
<a name="l00272"></a>00272    
<a name="l00273"></a>00273    inc-&gt;exec = is_exec;
<a name="l00274"></a>00274    <span class="keywordflow">if</span> (is_exec)
<a name="l00275"></a>00275       inc-&gt;exec_file = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(exec_file);
<a name="l00276"></a>00276    
<a name="l00277"></a>00277    <span class="comment">/* attach this new struct to the conf struct */</span>
<a name="l00278"></a>00278    inc-&gt;next = conf-&gt;<a class="code" href="structast__config.html#acb049f8b410c47aebfde624a7de10819">includes</a>;
<a name="l00279"></a>00279    conf-&gt;<a class="code" href="structast__config.html#acb049f8b410c47aebfde624a7de10819">includes</a> = inc;
<a name="l00280"></a>00280    
<a name="l00281"></a>00281    <span class="keywordflow">return</span> inc;
<a name="l00282"></a>00282 }
<a name="l00283"></a>00283 
<a name="l00284"></a><a class="code" href="config_8c.html#a008dccc13b0342d21fa91bf5c26bbcba">00284</a> <span class="keywordtype">void</span> <a class="code" href="config_8h.html#a008dccc13b0342d21fa91bf5c26bbcba">ast_include_rename</a>(<span class="keyword">struct</span> <a class="code" href="structast__config.html">ast_config</a> *conf, <span class="keyword">const</span> <span class="keywordtype">char</span> *from_file, <span class="keyword">const</span> <span class="keywordtype">char</span> *to_file)
<a name="l00285"></a>00285 {
<a name="l00286"></a>00286    <span class="keyword">struct </span><a class="code" href="structast__config__include.html">ast_config_include</a> *incl;
<a name="l00287"></a>00287    <span class="keyword">struct </span>ast_category *cat;
<a name="l00288"></a>00288    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *v;
<a name="l00289"></a>00289    
<a name="l00290"></a>00290    <span class="keywordtype">int</span> from_len = strlen(from_file);
<a name="l00291"></a>00291    <span class="keywordtype">int</span> to_len = strlen(to_file);
<a name="l00292"></a>00292    
<a name="l00293"></a>00293    <span class="keywordflow">if</span> (strcmp(from_file, to_file) == 0) <span class="comment">/* no use wasting time if the name is the same */</span>
<a name="l00294"></a>00294       <span class="keywordflow">return</span>;
<a name="l00295"></a>00295    
<a name="l00296"></a>00296    <span class="comment">/* the manager code allows you to read in one config file, then</span>
<a name="l00297"></a>00297 <span class="comment">    * write it back out under a different name. But, the new arrangement</span>
<a name="l00298"></a>00298 <span class="comment">    * ties output lines to the file name. So, before you try to write</span>
<a name="l00299"></a>00299 <span class="comment">    * the config file to disk, better riffle thru the data and make sure</span>
<a name="l00300"></a>00300 <span class="comment">    * the file names are changed.</span>
<a name="l00301"></a>00301 <span class="comment">    */</span>
<a name="l00302"></a>00302    <span class="comment">/* file names are on categories, includes (of course), and on variables. So,</span>
<a name="l00303"></a>00303 <span class="comment">    * traverse all this and swap names */</span>
<a name="l00304"></a>00304 
<a name="l00305"></a>00305    <span class="keywordflow">for</span> (incl = conf-&gt;<a class="code" href="structast__config.html#acb049f8b410c47aebfde624a7de10819">includes</a>; incl; incl=incl-&gt;<a class="code" href="structast__config__include.html#ae2104fb51ee9f10eb0006df77fb8d504">next</a>) {
<a name="l00306"></a>00306       <span class="keywordflow">if</span> (strcmp(incl-&gt;<a class="code" href="structast__config__include.html#ad2a400871412e45079d5b0b09dbe34be">include_location_file</a>,from_file) == 0) {
<a name="l00307"></a>00307          <span class="keywordflow">if</span> (from_len &gt;= to_len)
<a name="l00308"></a>00308             strcpy(incl-&gt;<a class="code" href="structast__config__include.html#ad2a400871412e45079d5b0b09dbe34be">include_location_file</a>, to_file);
<a name="l00309"></a>00309          <span class="keywordflow">else</span> {
<a name="l00310"></a>00310             <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(incl-&gt;<a class="code" href="structast__config__include.html#ad2a400871412e45079d5b0b09dbe34be">include_location_file</a>);
<a name="l00311"></a>00311             incl-&gt;<a class="code" href="structast__config__include.html#ad2a400871412e45079d5b0b09dbe34be">include_location_file</a> = <a class="code" href="astmm_8h.html#a33bc8f85636226ba23bf348f78352aef">strdup</a>(to_file);
<a name="l00312"></a>00312          }
<a name="l00313"></a>00313       }
<a name="l00314"></a>00314    }
<a name="l00315"></a>00315    <span class="keywordflow">for</span> (cat = conf-&gt;<a class="code" href="structast__config.html#a1d069527a476fcfd5e93263cda8099dd">root</a>; cat; cat = cat-&gt;<a class="code" href="structast__category.html#a0a4a1c6e5b4ed640d4bb7c697df91212">next</a>) {
<a name="l00316"></a>00316       <span class="keywordflow">if</span> (strcmp(cat-&gt;<a class="code" href="structast__category.html#adf16cd437526a5c5e0e0af87745acbb8">file</a>,from_file) == 0) {
<a name="l00317"></a>00317          <span class="keywordflow">if</span> (from_len &gt;= to_len)
<a name="l00318"></a>00318             strcpy(cat-&gt;<a class="code" href="structast__category.html#adf16cd437526a5c5e0e0af87745acbb8">file</a>, to_file);
<a name="l00319"></a>00319          <span class="keywordflow">else</span> {
<a name="l00320"></a>00320             <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(cat-&gt;<a class="code" href="structast__category.html#adf16cd437526a5c5e0e0af87745acbb8">file</a>);
<a name="l00321"></a>00321             cat-&gt;<a class="code" href="structast__category.html#adf16cd437526a5c5e0e0af87745acbb8">file</a> = <a class="code" href="astmm_8h.html#a33bc8f85636226ba23bf348f78352aef">strdup</a>(to_file);
<a name="l00322"></a>00322          }
<a name="l00323"></a>00323       }
<a name="l00324"></a>00324       <span class="keywordflow">for</span> (v = cat-&gt;<a class="code" href="structast__category.html#a6f86d2cb07f9a779a13a854d21b40728">root</a>; v; v = v-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l00325"></a>00325          <span class="keywordflow">if</span> (strcmp(v-&gt;<a class="code" href="structast__variable.html#adf16cd437526a5c5e0e0af87745acbb8">file</a>,from_file) == 0) {
<a name="l00326"></a>00326             <span class="keywordflow">if</span> (from_len &gt;= to_len)
<a name="l00327"></a>00327                strcpy(v-&gt;<a class="code" href="structast__variable.html#adf16cd437526a5c5e0e0af87745acbb8">file</a>, to_file);
<a name="l00328"></a>00328             <span class="keywordflow">else</span> {
<a name="l00329"></a>00329                <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(v-&gt;<a class="code" href="structast__variable.html#adf16cd437526a5c5e0e0af87745acbb8">file</a>);
<a name="l00330"></a>00330                v-&gt;<a class="code" href="structast__variable.html#adf16cd437526a5c5e0e0af87745acbb8">file</a> = <a class="code" href="astmm_8h.html#a33bc8f85636226ba23bf348f78352aef">strdup</a>(to_file);
<a name="l00331"></a>00331             }
<a name="l00332"></a>00332          }
<a name="l00333"></a>00333       }
<a name="l00334"></a>00334    }
<a name="l00335"></a>00335 }
<a name="l00336"></a>00336 
<a name="l00337"></a><a class="code" href="config_8c.html#a7a653e8d3b6e1696e58f52a0534aff80">00337</a> <span class="keyword">struct </span><a class="code" href="structast__config__include.html">ast_config_include</a> *<a class="code" href="config_8h.html#a7a653e8d3b6e1696e58f52a0534aff80">ast_include_find</a>(<span class="keyword">struct</span> <a class="code" href="structast__config.html">ast_config</a> *conf, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structast__config__include.html#a5d894d3ac3a63ddbe13305c29b0aceb8">included_file</a>)
<a name="l00338"></a>00338 {
<a name="l00339"></a>00339    <span class="keyword">struct </span><a class="code" href="structast__config__include.html">ast_config_include</a> *x;
<a name="l00340"></a>00340    <span class="keywordflow">for</span> (x=conf-&gt;<a class="code" href="structast__config.html#acb049f8b410c47aebfde624a7de10819">includes</a>;x;x=x-&gt;<a class="code" href="structast__config__include.html#ae2104fb51ee9f10eb0006df77fb8d504">next</a>) {
<a name="l00341"></a>00341       <span class="keywordflow">if</span> (strcmp(x-&gt;<a class="code" href="structast__config__include.html#a5d894d3ac3a63ddbe13305c29b0aceb8">included_file</a>,included_file) == 0)
<a name="l00342"></a>00342          <span class="keywordflow">return</span> x;
<a name="l00343"></a>00343    }
<a name="l00344"></a>00344    <span class="keywordflow">return</span> 0;
<a name="l00345"></a>00345 }
<a name="l00346"></a>00346 
<a name="l00347"></a>00347 
<a name="l00348"></a><a class="code" href="config_8c.html#a132ddbd39dd9d26395c410f7647f76db">00348</a> <span class="keywordtype">void</span> <a class="code" href="config_8h.html#a132ddbd39dd9d26395c410f7647f76db">ast_variable_append</a>(<span class="keyword">struct</span> ast_category *category, <span class="keyword">struct</span> <a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *variable)
<a name="l00349"></a>00349 {
<a name="l00350"></a>00350    <span class="keywordflow">if</span> (!variable)
<a name="l00351"></a>00351       <span class="keywordflow">return</span>;
<a name="l00352"></a>00352    <span class="keywordflow">if</span> (category-&gt;<a class="code" href="structast__category.html#ac6bc41916ca996a56407db9d13e2e734">last</a>)
<a name="l00353"></a>00353       category-&gt;<a class="code" href="structast__category.html#ac6bc41916ca996a56407db9d13e2e734">last</a>-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a> = variable;
<a name="l00354"></a>00354    <span class="keywordflow">else</span>
<a name="l00355"></a>00355       category-&gt;<a class="code" href="structast__category.html#a6f86d2cb07f9a779a13a854d21b40728">root</a> = variable;
<a name="l00356"></a>00356    category-&gt;<a class="code" href="structast__category.html#ac6bc41916ca996a56407db9d13e2e734">last</a> = variable;
<a name="l00357"></a>00357    <span class="keywordflow">while</span> (category-&gt;<a class="code" href="structast__category.html#ac6bc41916ca996a56407db9d13e2e734">last</a>-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>)
<a name="l00358"></a>00358       category-&gt;<a class="code" href="structast__category.html#ac6bc41916ca996a56407db9d13e2e734">last</a> = category-&gt;<a class="code" href="structast__category.html#ac6bc41916ca996a56407db9d13e2e734">last</a>-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>;
<a name="l00359"></a>00359 }
<a name="l00360"></a>00360 
<a name="l00361"></a><a class="code" href="config_8c.html#ad12cd7f4f5efe4a460c1aaed0ac488d5">00361</a> <span class="keywordtype">void</span> <a class="code" href="config_8h.html#ad12cd7f4f5efe4a460c1aaed0ac488d5">ast_variable_insert</a>(<span class="keyword">struct</span> ast_category *category, <span class="keyword">struct</span> <a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *variable, <span class="keyword">const</span> <span class="keywordtype">char</span> *line)
<a name="l00362"></a>00362 {
<a name="l00363"></a>00363    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *cur = category-&gt;<a class="code" href="structast__category.html#a6f86d2cb07f9a779a13a854d21b40728">root</a>;
<a name="l00364"></a>00364    <span class="keywordtype">int</span> lineno;
<a name="l00365"></a>00365    <span class="keywordtype">int</span> insertline;
<a name="l00366"></a>00366 
<a name="l00367"></a>00367    <span class="keywordflow">if</span> (!variable || sscanf(line, <span class="stringliteral">&quot;%30d&quot;</span>, &amp;insertline) != 1) {
<a name="l00368"></a>00368       <span class="keywordflow">return</span>;
<a name="l00369"></a>00369    }
<a name="l00370"></a>00370    <span class="keywordflow">if</span> (!insertline) {
<a name="l00371"></a>00371       variable-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a> = category-&gt;<a class="code" href="structast__category.html#a6f86d2cb07f9a779a13a854d21b40728">root</a>;
<a name="l00372"></a>00372       category-&gt;<a class="code" href="structast__category.html#a6f86d2cb07f9a779a13a854d21b40728">root</a> = variable;
<a name="l00373"></a>00373    } <span class="keywordflow">else</span> {
<a name="l00374"></a>00374       <span class="keywordflow">for</span> (lineno = 1; lineno &lt; insertline; lineno++) {
<a name="l00375"></a>00375          cur = cur-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>;
<a name="l00376"></a>00376          <span class="keywordflow">if</span> (!cur-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l00377"></a>00377             <span class="keywordflow">break</span>;
<a name="l00378"></a>00378          }
<a name="l00379"></a>00379       }
<a name="l00380"></a>00380       variable-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a> = cur-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>;
<a name="l00381"></a>00381       cur-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a> = variable;
<a name="l00382"></a>00382    }
<a name="l00383"></a>00383 }
<a name="l00384"></a>00384 
<a name="l00385"></a><a class="code" href="config_8c.html#aa1eb8eebadbdaf6ffacdd744a5686aa6">00385</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="config_8c.html#aa1eb8eebadbdaf6ffacdd744a5686aa6">ast_comment_destroy</a>(<span class="keyword">struct</span> <a class="code" href="structast__comment.html" title="Structure to keep comments for rewriting configuration files.">ast_comment</a> **<a class="code" href="ael__lex_8c.html#a43be22b7a1b528eaf759e034ec581543">comment</a>)
<a name="l00386"></a>00386 {
<a name="l00387"></a>00387    <span class="keyword">struct </span><a class="code" href="structast__comment.html" title="Structure to keep comments for rewriting configuration files.">ast_comment</a> *n, *p;
<a name="l00388"></a>00388 
<a name="l00389"></a>00389    <span class="keywordflow">for</span> (p = *comment; p; p = n) {
<a name="l00390"></a>00390       n = p-&gt;<a class="code" href="structast__comment.html#adab84eadfeb3d2c35ac0a185b9345e8f">next</a>;
<a name="l00391"></a>00391       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(p);
<a name="l00392"></a>00392    }
<a name="l00393"></a>00393 
<a name="l00394"></a>00394    *comment = NULL;
<a name="l00395"></a>00395 }
<a name="l00396"></a>00396 
<a name="l00397"></a><a class="code" href="config_8c.html#ab7a5df9fe3cc9eaf5f5c93b84a2f4427">00397</a> <span class="keywordtype">void</span> <a class="code" href="config_8h.html#ad3d8122172af6f13687a07840411d65d" title="Free variable list.">ast_variables_destroy</a>(<span class="keyword">struct</span> <a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *v)
<a name="l00398"></a>00398 {
<a name="l00399"></a>00399    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *vn;
<a name="l00400"></a>00400 
<a name="l00401"></a>00401    <span class="keywordflow">while</span> (v) {
<a name="l00402"></a>00402       vn = v;
<a name="l00403"></a>00403       v = v-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>;
<a name="l00404"></a>00404       <a class="code" href="config_8c.html#aa1eb8eebadbdaf6ffacdd744a5686aa6">ast_comment_destroy</a>(&amp;vn-&gt;<a class="code" href="structast__variable.html#a80bf10e9bcb9c00a7a59051a77a620cf">precomments</a>);
<a name="l00405"></a>00405       <a class="code" href="config_8c.html#aa1eb8eebadbdaf6ffacdd744a5686aa6">ast_comment_destroy</a>(&amp;vn-&gt;<a class="code" href="structast__variable.html#a6e4312227f9a7570709abf7f686f1cfe">sameline</a>);
<a name="l00406"></a>00406       <a class="code" href="config_8c.html#aa1eb8eebadbdaf6ffacdd744a5686aa6">ast_comment_destroy</a>(&amp;vn-&gt;<a class="code" href="structast__variable.html#ab09dbd177767543015efa3ba28fab03a">trailing</a>);
<a name="l00407"></a>00407       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(vn);
<a name="l00408"></a>00408    }
<a name="l00409"></a>00409 }
<a name="l00410"></a>00410 
<a name="l00411"></a><a class="code" href="config_8c.html#a935ccfa153100ddd320c8918bd6e941b">00411</a> <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *<a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structast__config.html">ast_config</a> *<a class="code" href="cdr__csv_8c.html#a74bb62276efdf39dd94048e007fca05b">config</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *category)
<a name="l00412"></a>00412 {
<a name="l00413"></a>00413    <span class="keyword">struct </span>ast_category *cat = NULL;
<a name="l00414"></a>00414 
<a name="l00415"></a>00415    <span class="keywordflow">if</span> (category &amp;&amp; config-&gt;<a class="code" href="structast__config.html#acd249676fca8f438f6762b26fb92f712">last_browse</a> &amp;&amp; (config-&gt;<a class="code" href="structast__config.html#acd249676fca8f438f6762b26fb92f712">last_browse</a>-&gt;<a class="code" href="structast__category.html#a3777dbae63a15da001b2baa317a25149">name</a> == category)) {
<a name="l00416"></a>00416       cat = config-&gt;<a class="code" href="structast__config.html#acd249676fca8f438f6762b26fb92f712">last_browse</a>;
<a name="l00417"></a>00417    } <span class="keywordflow">else</span> {
<a name="l00418"></a>00418       cat = <a class="code" href="config_8h.html#a0c2db6370e5051f282b2926f5893b2ea" title="Retrieve a category if it exists.">ast_category_get</a>(config, category);
<a name="l00419"></a>00419    }
<a name="l00420"></a>00420 
<a name="l00421"></a>00421    <span class="keywordflow">return</span> (cat) ? cat-&gt;<a class="code" href="structast__category.html#a6f86d2cb07f9a779a13a854d21b40728">root</a> : NULL;
<a name="l00422"></a>00422 }
<a name="l00423"></a>00423 
<a name="l00424"></a><a class="code" href="config_8c.html#ad9fd2625614158b152434e45acf1d78b">00424</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="config_8h.html#ad9fd2625614158b152434e45acf1d78b" title="Retrieve a configuration variable within the configuration set. Retrieves the named...">ast_config_option</a>(<span class="keyword">struct</span> <a class="code" href="structast__config.html">ast_config</a> *cfg, <span class="keyword">const</span> <span class="keywordtype">char</span> *cat, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>)
<a name="l00425"></a>00425 {
<a name="l00426"></a>00426    <span class="keyword">const</span> <span class="keywordtype">char</span> *tmp;
<a name="l00427"></a>00427    tmp = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, cat, var);
<a name="l00428"></a>00428    <span class="keywordflow">if</span> (!tmp) {
<a name="l00429"></a>00429       tmp = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>, var);
<a name="l00430"></a>00430    }
<a name="l00431"></a>00431    <span class="keywordflow">return</span> tmp;
<a name="l00432"></a>00432 }
<a name="l00433"></a>00433 
<a name="l00434"></a>00434 
<a name="l00435"></a><a class="code" href="config_8c.html#ab87fa38c79226e5a0105ad9d2e2e9ae5">00435</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structast__config.html">ast_config</a> *<a class="code" href="cdr__csv_8c.html#a74bb62276efdf39dd94048e007fca05b">config</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *category, <span class="keyword">const</span> <span class="keywordtype">char</span> *variable)
<a name="l00436"></a>00436 {
<a name="l00437"></a>00437    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *v;
<a name="l00438"></a>00438 
<a name="l00439"></a>00439    <span class="keywordflow">if</span> (category) {
<a name="l00440"></a>00440       <span class="keywordflow">for</span> (v = <a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(config, category); v; v = v-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l00441"></a>00441          <span class="keywordflow">if</span> (!strcasecmp(variable, v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)) {
<a name="l00442"></a>00442             <span class="keywordflow">return</span> v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>;
<a name="l00443"></a>00443          }
<a name="l00444"></a>00444       }
<a name="l00445"></a>00445    } <span class="keywordflow">else</span> {
<a name="l00446"></a>00446       <span class="keyword">struct </span>ast_category *cat;
<a name="l00447"></a>00447 
<a name="l00448"></a>00448       <span class="keywordflow">for</span> (cat = config-&gt;<a class="code" href="structast__config.html#a1d069527a476fcfd5e93263cda8099dd">root</a>; cat; cat = cat-&gt;<a class="code" href="structast__category.html#a0a4a1c6e5b4ed640d4bb7c697df91212">next</a>) {
<a name="l00449"></a>00449          <span class="keywordflow">for</span> (v = cat-&gt;<a class="code" href="structast__category.html#a6f86d2cb07f9a779a13a854d21b40728">root</a>; v; v = v-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l00450"></a>00450             <span class="keywordflow">if</span> (!strcasecmp(variable, v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)) {
<a name="l00451"></a>00451                <span class="keywordflow">return</span> v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>;
<a name="l00452"></a>00452             }
<a name="l00453"></a>00453          }
<a name="l00454"></a>00454       }
<a name="l00455"></a>00455    }
<a name="l00456"></a>00456 
<a name="l00457"></a>00457    <span class="keywordflow">return</span> NULL;
<a name="l00458"></a>00458 }
<a name="l00459"></a>00459 
<a name="l00460"></a><a class="code" href="config_8c.html#a63722d8861bd8bdb8d16cfae4b3ff818">00460</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *<a class="code" href="config_8c.html#a63722d8861bd8bdb8d16cfae4b3ff818">variable_clone</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *old)
<a name="l00461"></a>00461 {
<a name="l00462"></a>00462    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *<span class="keyword">new</span> = <a class="code" href="config_8h.html#a08e94d96f459e7301a74daf32035423b">ast_variable_new</a>(old-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, old-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, old-&gt;<a class="code" href="structast__variable.html#adf16cd437526a5c5e0e0af87745acbb8">file</a>);
<a name="l00463"></a>00463 
<a name="l00464"></a>00464    <span class="keywordflow">if</span> (<span class="keyword">new</span>) {
<a name="l00465"></a>00465       <span class="keyword">new</span>-&gt;lineno = old-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>;
<a name="l00466"></a>00466       <span class="keyword">new</span>-&gt;object = old-&gt;<a class="code" href="structast__variable.html#a328cd221e75f4bd92e3ccf406f0d0441">object</a>;
<a name="l00467"></a>00467       <span class="keyword">new</span>-&gt;blanklines = old-&gt;<a class="code" href="structast__variable.html#ade071f6f4a7bc0deb43008bd448ac46e">blanklines</a>;
<a name="l00468"></a>00468       <span class="comment">/* TODO: clone comments? */</span>
<a name="l00469"></a>00469    }
<a name="l00470"></a>00470 
<a name="l00471"></a>00471    <span class="keywordflow">return</span> <span class="keyword">new</span>;
<a name="l00472"></a>00472 }
<a name="l00473"></a>00473  
<a name="l00474"></a><a class="code" href="config_8c.html#a843cd90974137daed3619bf004db5769">00474</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="config_8c.html#a843cd90974137daed3619bf004db5769">move_variables</a>(<span class="keyword">struct</span> ast_category *old, <span class="keyword">struct</span> ast_category *<span class="keyword">new</span>)
<a name="l00475"></a>00475 {
<a name="l00476"></a>00476    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a> = old-&gt;<a class="code" href="structast__category.html#a6f86d2cb07f9a779a13a854d21b40728">root</a>;
<a name="l00477"></a>00477 
<a name="l00478"></a>00478    old-&gt;<a class="code" href="structast__category.html#a6f86d2cb07f9a779a13a854d21b40728">root</a> = NULL;
<a name="l00479"></a>00479    <span class="comment">/* we can just move the entire list in a single op */</span>
<a name="l00480"></a>00480    <a class="code" href="config_8h.html#a132ddbd39dd9d26395c410f7647f76db">ast_variable_append</a>(<span class="keyword">new</span>, var);
<a name="l00481"></a>00481 }
<a name="l00482"></a>00482 
<a name="l00483"></a><a class="code" href="config_8c.html#affebac76d69639677b677037d9871e29">00483</a> <span class="keyword">struct </span>ast_category *<a class="code" href="config_8h.html#affebac76d69639677b677037d9871e29" title="Create a category structure.">ast_category_new</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keyword">const</span> <span class="keywordtype">char</span> *in_file, <span class="keywordtype">int</span> lineno) 
<a name="l00484"></a>00484 {
<a name="l00485"></a>00485    <span class="keyword">struct </span>ast_category *category;
<a name="l00486"></a>00486 
<a name="l00487"></a>00487    <span class="keywordflow">if</span> ((category = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*category))))
<a name="l00488"></a>00488       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(category-&gt;<a class="code" href="structast__category.html#a3777dbae63a15da001b2baa317a25149">name</a>, name, <span class="keyword">sizeof</span>(category-&gt;<a class="code" href="structast__category.html#a3777dbae63a15da001b2baa317a25149">name</a>));
<a name="l00489"></a>00489    category-&gt;<a class="code" href="structast__category.html#adf16cd437526a5c5e0e0af87745acbb8">file</a> = <a class="code" href="astmm_8h.html#a33bc8f85636226ba23bf348f78352aef">strdup</a>(in_file);
<a name="l00490"></a>00490    category-&gt;<a class="code" href="structast__category.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a> = lineno; <span class="comment">/* if you don&apos;t know the lineno, set it to 999999 or something real big */</span>
<a name="l00491"></a>00491    <span class="keywordflow">return</span> category;
<a name="l00492"></a>00492 }
<a name="l00493"></a>00493 
<a name="l00494"></a><a class="code" href="config_8c.html#a4aaa75745aa4cf044419763d53bbb4a8">00494</a> <span class="keyword">static</span> <span class="keyword">struct </span>ast_category *<a class="code" href="config_8c.html#a4aaa75745aa4cf044419763d53bbb4a8">category_get</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structast__config.html">ast_config</a> *<a class="code" href="cdr__csv_8c.html#a74bb62276efdf39dd94048e007fca05b">config</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *category_name, <span class="keywordtype">int</span> ignored)
<a name="l00495"></a>00495 {
<a name="l00496"></a>00496    <span class="keyword">struct </span>ast_category *cat;
<a name="l00497"></a>00497 
<a name="l00498"></a>00498    <span class="comment">/* try exact match first, then case-insensitive match */</span>
<a name="l00499"></a>00499    <span class="keywordflow">for</span> (cat = config-&gt;<a class="code" href="structast__config.html#a1d069527a476fcfd5e93263cda8099dd">root</a>; cat; cat = cat-&gt;<a class="code" href="structast__category.html#a0a4a1c6e5b4ed640d4bb7c697df91212">next</a>) {
<a name="l00500"></a>00500       <span class="keywordflow">if</span> (cat-&gt;<a class="code" href="structast__category.html#a3777dbae63a15da001b2baa317a25149">name</a> == category_name &amp;&amp; (ignored || !cat-&gt;<a class="code" href="structast__category.html#a973274447fb1c6eb9b27c5a54505bb69">ignored</a>))
<a name="l00501"></a>00501          <span class="keywordflow">return</span> cat;
<a name="l00502"></a>00502    }
<a name="l00503"></a>00503 
<a name="l00504"></a>00504    <span class="keywordflow">for</span> (cat = config-&gt;<a class="code" href="structast__config.html#a1d069527a476fcfd5e93263cda8099dd">root</a>; cat; cat = cat-&gt;<a class="code" href="structast__category.html#a0a4a1c6e5b4ed640d4bb7c697df91212">next</a>) {
<a name="l00505"></a>00505       <span class="keywordflow">if</span> (!strcasecmp(cat-&gt;<a class="code" href="structast__category.html#a3777dbae63a15da001b2baa317a25149">name</a>, category_name) &amp;&amp; (ignored || !cat-&gt;<a class="code" href="structast__category.html#a973274447fb1c6eb9b27c5a54505bb69">ignored</a>))
<a name="l00506"></a>00506          <span class="keywordflow">return</span> cat;
<a name="l00507"></a>00507    }
<a name="l00508"></a>00508 
<a name="l00509"></a>00509    <span class="keywordflow">return</span> NULL;
<a name="l00510"></a>00510 }
<a name="l00511"></a>00511 
<a name="l00512"></a><a class="code" href="config_8c.html#a0c2db6370e5051f282b2926f5893b2ea">00512</a> <span class="keyword">struct </span>ast_category *<a class="code" href="config_8h.html#a0c2db6370e5051f282b2926f5893b2ea" title="Retrieve a category if it exists.">ast_category_get</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structast__config.html">ast_config</a> *<a class="code" href="cdr__csv_8c.html#a74bb62276efdf39dd94048e007fca05b">config</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *category_name)
<a name="l00513"></a>00513 {
<a name="l00514"></a>00514    <span class="keywordflow">return</span> <a class="code" href="config_8c.html#a4aaa75745aa4cf044419763d53bbb4a8">category_get</a>(config, category_name, 0);
<a name="l00515"></a>00515 }
<a name="l00516"></a>00516 
<a name="l00517"></a><a class="code" href="config_8c.html#a66f428286e5357f6e7fd5237b03ec174">00517</a> <span class="keywordtype">int</span> <a class="code" href="config_8h.html#a66f428286e5357f6e7fd5237b03ec174" title="Check for category duplicates.">ast_category_exist</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structast__config.html">ast_config</a> *<a class="code" href="cdr__csv_8c.html#a74bb62276efdf39dd94048e007fca05b">config</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *category_name)
<a name="l00518"></a>00518 {
<a name="l00519"></a>00519    <span class="keywordflow">return</span> !!<a class="code" href="config_8h.html#a0c2db6370e5051f282b2926f5893b2ea" title="Retrieve a category if it exists.">ast_category_get</a>(config, category_name);
<a name="l00520"></a>00520 }
<a name="l00521"></a>00521 
<a name="l00522"></a><a class="code" href="config_8c.html#a8fe6fe2cacf32240f60a554bc15c4d25">00522</a> <span class="keywordtype">void</span> <a class="code" href="config_8h.html#ab7b56ec66b058952423f313752c734e7">ast_category_append</a>(<span class="keyword">struct</span> <a class="code" href="structast__config.html">ast_config</a> *<a class="code" href="cdr__csv_8c.html#a74bb62276efdf39dd94048e007fca05b">config</a>, <span class="keyword">struct</span> ast_category *category)
<a name="l00523"></a>00523 {
<a name="l00524"></a>00524    <span class="keywordflow">if</span> (config-&gt;<a class="code" href="structast__config.html#a3419d1f39268adeeb95610eaf215952d">last</a>)
<a name="l00525"></a>00525       config-&gt;<a class="code" href="structast__config.html#a3419d1f39268adeeb95610eaf215952d">last</a>-&gt;<a class="code" href="structast__category.html#a0a4a1c6e5b4ed640d4bb7c697df91212">next</a> = category;
<a name="l00526"></a>00526    <span class="keywordflow">else</span>
<a name="l00527"></a>00527       config-&gt;<a class="code" href="structast__config.html#a1d069527a476fcfd5e93263cda8099dd">root</a> = category;
<a name="l00528"></a>00528    category-&gt;<a class="code" href="structast__category.html#a9889e4b9ce57e4055f9c11bacf89e50a">include_level</a> = config-&gt;<a class="code" href="structast__config.html#a9889e4b9ce57e4055f9c11bacf89e50a">include_level</a>;
<a name="l00529"></a>00529    config-&gt;<a class="code" href="structast__config.html#a3419d1f39268adeeb95610eaf215952d">last</a> = category;
<a name="l00530"></a>00530    config-&gt;<a class="code" href="structast__config.html#a204ede9a191a91abc1968f94973de556">current</a> = category;
<a name="l00531"></a>00531 }
<a name="l00532"></a>00532 
<a name="l00533"></a><a class="code" href="config_8c.html#a6d12616b69bc21fea2c20a0da5ad4f20">00533</a> <span class="keywordtype">void</span> <a class="code" href="config_8h.html#a6d12616b69bc21fea2c20a0da5ad4f20" title="Inserts new category.">ast_category_insert</a>(<span class="keyword">struct</span> <a class="code" href="structast__config.html">ast_config</a> *<a class="code" href="cdr__csv_8c.html#a74bb62276efdf39dd94048e007fca05b">config</a>, <span class="keyword">struct</span> ast_category *cat, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="chan__iax2_8c.html#aa27930d6214f6421994d6bef51efb7aa">match</a>)
<a name="l00534"></a>00534 {
<a name="l00535"></a>00535    <span class="keyword">struct </span>ast_category *cur_category;
<a name="l00536"></a>00536 
<a name="l00537"></a>00537    <span class="keywordflow">if</span> (!cat || !match)
<a name="l00538"></a>00538       <span class="keywordflow">return</span>;
<a name="l00539"></a>00539    <span class="keywordflow">if</span> (!strcasecmp(config-&gt;<a class="code" href="structast__config.html#a1d069527a476fcfd5e93263cda8099dd">root</a>-&gt;<a class="code" href="structast__category.html#a3777dbae63a15da001b2baa317a25149">name</a>, match)) {
<a name="l00540"></a>00540       cat-&gt;<a class="code" href="structast__category.html#a0a4a1c6e5b4ed640d4bb7c697df91212">next</a> = config-&gt;<a class="code" href="structast__config.html#a1d069527a476fcfd5e93263cda8099dd">root</a>;
<a name="l00541"></a>00541       config-&gt;<a class="code" href="structast__config.html#a1d069527a476fcfd5e93263cda8099dd">root</a> = cat;
<a name="l00542"></a>00542       <span class="keywordflow">return</span>;
<a name="l00543"></a>00543    } 
<a name="l00544"></a>00544    <span class="keywordflow">for</span> (cur_category = config-&gt;<a class="code" href="structast__config.html#a1d069527a476fcfd5e93263cda8099dd">root</a>; cur_category; cur_category = cur_category-&gt;<a class="code" href="structast__category.html#a0a4a1c6e5b4ed640d4bb7c697df91212">next</a>) {
<a name="l00545"></a>00545       <span class="keywordflow">if</span> (!strcasecmp(cur_category-&gt;<a class="code" href="structast__category.html#a0a4a1c6e5b4ed640d4bb7c697df91212">next</a>-&gt;<a class="code" href="structast__category.html#a3777dbae63a15da001b2baa317a25149">name</a>, match)) {
<a name="l00546"></a>00546          cat-&gt;<a class="code" href="structast__category.html#a0a4a1c6e5b4ed640d4bb7c697df91212">next</a> = cur_category-&gt;<a class="code" href="structast__category.html#a0a4a1c6e5b4ed640d4bb7c697df91212">next</a>;
<a name="l00547"></a>00547          cur_category-&gt;<a class="code" href="structast__category.html#a0a4a1c6e5b4ed640d4bb7c697df91212">next</a> = cat;
<a name="l00548"></a>00548          <span class="keywordflow">break</span>;
<a name="l00549"></a>00549       }
<a name="l00550"></a>00550    }
<a name="l00551"></a>00551 }
<a name="l00552"></a>00552 
<a name="l00553"></a><a class="code" href="config_8c.html#a8bb6ada632d03a8b632dd6e6ad8178d0">00553</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="config_8c.html#a8bb6ada632d03a8b632dd6e6ad8178d0">ast_destroy_template_list</a>(<span class="keyword">struct</span> ast_category *cat)
<a name="l00554"></a>00554 {
<a name="l00555"></a>00555    <span class="keyword">struct </span><a class="code" href="structast__category__template__instance.html">ast_category_template_instance</a> *x;
<a name="l00556"></a>00556 
<a name="l00557"></a>00557    <span class="keywordflow">while</span> ((x = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;cat-&gt;<a class="code" href="structast__category.html#aae97cd31a5d99cca5025058686aac6d7">template_instances</a>, next)))
<a name="l00558"></a>00558       <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(x);
<a name="l00559"></a>00559 }
<a name="l00560"></a>00560 
<a name="l00561"></a><a class="code" href="config_8c.html#abd17f201d0e7c31c124dc0cd3a0d073b">00561</a> <span class="keywordtype">void</span> <a class="code" href="config_8h.html#abd17f201d0e7c31c124dc0cd3a0d073b">ast_category_destroy</a>(<span class="keyword">struct</span> ast_category *cat)
<a name="l00562"></a>00562 {
<a name="l00563"></a>00563    <a class="code" href="config_8h.html#ad3d8122172af6f13687a07840411d65d" title="Free variable list.">ast_variables_destroy</a>(cat-&gt;<a class="code" href="structast__category.html#a6f86d2cb07f9a779a13a854d21b40728">root</a>);
<a name="l00564"></a>00564    <span class="keywordflow">if</span> (cat-&gt;<a class="code" href="structast__category.html#adf16cd437526a5c5e0e0af87745acbb8">file</a>) {
<a name="l00565"></a>00565       <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(cat-&gt;<a class="code" href="structast__category.html#adf16cd437526a5c5e0e0af87745acbb8">file</a>);
<a name="l00566"></a>00566       cat-&gt;<a class="code" href="structast__category.html#adf16cd437526a5c5e0e0af87745acbb8">file</a> = 0;
<a name="l00567"></a>00567    }
<a name="l00568"></a>00568    <a class="code" href="config_8c.html#aa1eb8eebadbdaf6ffacdd744a5686aa6">ast_comment_destroy</a>(&amp;cat-&gt;<a class="code" href="structast__category.html#a80bf10e9bcb9c00a7a59051a77a620cf">precomments</a>);
<a name="l00569"></a>00569    <a class="code" href="config_8c.html#aa1eb8eebadbdaf6ffacdd744a5686aa6">ast_comment_destroy</a>(&amp;cat-&gt;<a class="code" href="structast__category.html#a6e4312227f9a7570709abf7f686f1cfe">sameline</a>);
<a name="l00570"></a>00570    <a class="code" href="config_8c.html#aa1eb8eebadbdaf6ffacdd744a5686aa6">ast_comment_destroy</a>(&amp;cat-&gt;<a class="code" href="structast__category.html#ab09dbd177767543015efa3ba28fab03a">trailing</a>);
<a name="l00571"></a>00571    <a class="code" href="config_8c.html#a8bb6ada632d03a8b632dd6e6ad8178d0">ast_destroy_template_list</a>(cat);
<a name="l00572"></a>00572    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(cat);
<a name="l00573"></a>00573 }
<a name="l00574"></a>00574 
<a name="l00575"></a><a class="code" href="config_8c.html#a17aa91aa71dc55b7e95bab4bc8e4cb49">00575</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="config_8c.html#a17aa91aa71dc55b7e95bab4bc8e4cb49">ast_includes_destroy</a>(<span class="keyword">struct</span> <a class="code" href="structast__config__include.html">ast_config_include</a> *incls)
<a name="l00576"></a>00576 {
<a name="l00577"></a>00577    <span class="keyword">struct </span><a class="code" href="structast__config__include.html">ast_config_include</a> *incl,*inclnext;
<a name="l00578"></a>00578    
<a name="l00579"></a>00579    <span class="keywordflow">for</span> (incl=incls; incl; incl = inclnext) {
<a name="l00580"></a>00580       inclnext = incl-&gt;<a class="code" href="structast__config__include.html#ae2104fb51ee9f10eb0006df77fb8d504">next</a>;
<a name="l00581"></a>00581       <span class="keywordflow">if</span> (incl-&gt;<a class="code" href="structast__config__include.html#ad2a400871412e45079d5b0b09dbe34be">include_location_file</a>)
<a name="l00582"></a>00582          <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(incl-&gt;<a class="code" href="structast__config__include.html#ad2a400871412e45079d5b0b09dbe34be">include_location_file</a>);
<a name="l00583"></a>00583       <span class="keywordflow">if</span> (incl-&gt;<a class="code" href="structast__config__include.html#ac06a64b674f41fa8d0d3c86b9dffa3c4">exec_file</a>)
<a name="l00584"></a>00584          <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(incl-&gt;<a class="code" href="structast__config__include.html#ac06a64b674f41fa8d0d3c86b9dffa3c4">exec_file</a>);
<a name="l00585"></a>00585       <span class="keywordflow">if</span> (incl-&gt;<a class="code" href="structast__config__include.html#a5d894d3ac3a63ddbe13305c29b0aceb8">included_file</a>)
<a name="l00586"></a>00586          <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(incl-&gt;<a class="code" href="structast__config__include.html#a5d894d3ac3a63ddbe13305c29b0aceb8">included_file</a>);
<a name="l00587"></a>00587       <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(incl);
<a name="l00588"></a>00588    }
<a name="l00589"></a>00589 }
<a name="l00590"></a>00590 
<a name="l00591"></a><a class="code" href="config_8c.html#ade468175b713e3cb13443b97f3d5b4c6">00591</a> <span class="keyword">static</span> <span class="keyword">struct </span>ast_category *<a class="code" href="config_8c.html#ade468175b713e3cb13443b97f3d5b4c6">next_available_category</a>(<span class="keyword">struct</span> ast_category *cat)
<a name="l00592"></a>00592 {
<a name="l00593"></a>00593    <span class="keywordflow">for</span> (; cat &amp;&amp; cat-&gt;<a class="code" href="structast__category.html#a973274447fb1c6eb9b27c5a54505bb69">ignored</a>; cat = cat-&gt;<a class="code" href="structast__category.html#a0a4a1c6e5b4ed640d4bb7c697df91212">next</a>);
<a name="l00594"></a>00594 
<a name="l00595"></a>00595    <span class="keywordflow">return</span> cat;
<a name="l00596"></a>00596 }
<a name="l00597"></a>00597 <span class="comment"></span>
<a name="l00598"></a>00598 <span class="comment">/*! return the first var of a category */</span>
<a name="l00599"></a><a class="code" href="config_8c.html#a39040e0fe9c0bac870c10ad32afbfb17">00599</a> <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *<a class="code" href="config_8h.html#a39040e0fe9c0bac870c10ad32afbfb17" title="given a pointer to a category, return the root variable. This is equivalent to ast_variable_browse()...">ast_category_first</a>(<span class="keyword">struct</span> ast_category *cat)
<a name="l00600"></a>00600 {
<a name="l00601"></a>00601    <span class="keywordflow">return</span> (cat) ? cat-&gt;<a class="code" href="structast__category.html#a6f86d2cb07f9a779a13a854d21b40728">root</a> : NULL;
<a name="l00602"></a>00602 }
<a name="l00603"></a>00603 
<a name="l00604"></a><a class="code" href="config_8c.html#a3ac58442160597e19cb6f3775dbb0029">00604</a> <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *<a class="code" href="config_8h.html#a3ac58442160597e19cb6f3775dbb0029" title="returns the root ast_variable of a config">ast_category_root</a>(<span class="keyword">struct</span> <a class="code" href="structast__config.html">ast_config</a> *<a class="code" href="cdr__csv_8c.html#a74bb62276efdf39dd94048e007fca05b">config</a>, <span class="keywordtype">char</span> *cat)
<a name="l00605"></a>00605 {
<a name="l00606"></a>00606    <span class="keyword">struct </span>ast_category *category = <a class="code" href="config_8h.html#a0c2db6370e5051f282b2926f5893b2ea" title="Retrieve a category if it exists.">ast_category_get</a>(config, cat);
<a name="l00607"></a>00607 
<a name="l00608"></a>00608    <span class="keywordflow">if</span> (category)
<a name="l00609"></a>00609       <span class="keywordflow">return</span> category-&gt;<a class="code" href="structast__category.html#a6f86d2cb07f9a779a13a854d21b40728">root</a>;
<a name="l00610"></a>00610    <span class="keywordflow">return</span> NULL;
<a name="l00611"></a>00611 }
<a name="l00612"></a>00612 
<a name="l00613"></a><a class="code" href="config_8c.html#a611776300f941a63266cb220ac62b4db">00613</a> <span class="keywordtype">char</span> *<a class="code" href="config_8h.html#a611776300f941a63266cb220ac62b4db" title="Goes through categories.">ast_category_browse</a>(<span class="keyword">struct</span> <a class="code" href="structast__config.html">ast_config</a> *<a class="code" href="cdr__csv_8c.html#a74bb62276efdf39dd94048e007fca05b">config</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *prev)
<a name="l00614"></a>00614 {  
<a name="l00615"></a>00615    <span class="keyword">struct </span>ast_category *cat = NULL;
<a name="l00616"></a>00616 
<a name="l00617"></a>00617    <span class="keywordflow">if</span> (prev &amp;&amp; config-&gt;<a class="code" href="structast__config.html#acd249676fca8f438f6762b26fb92f712">last_browse</a> &amp;&amp; (config-&gt;<a class="code" href="structast__config.html#acd249676fca8f438f6762b26fb92f712">last_browse</a>-&gt;<a class="code" href="structast__category.html#a3777dbae63a15da001b2baa317a25149">name</a> == prev))
<a name="l00618"></a>00618       cat = config-&gt;<a class="code" href="structast__config.html#acd249676fca8f438f6762b26fb92f712">last_browse</a>-&gt;<a class="code" href="structast__category.html#a0a4a1c6e5b4ed640d4bb7c697df91212">next</a>;
<a name="l00619"></a>00619    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!prev &amp;&amp; config-&gt;<a class="code" href="structast__config.html#a1d069527a476fcfd5e93263cda8099dd">root</a>)
<a name="l00620"></a>00620       cat = config-&gt;<a class="code" href="structast__config.html#a1d069527a476fcfd5e93263cda8099dd">root</a>;
<a name="l00621"></a>00621    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (prev) {
<a name="l00622"></a>00622       <span class="keywordflow">for</span> (cat = config-&gt;<a class="code" href="structast__config.html#a1d069527a476fcfd5e93263cda8099dd">root</a>; cat; cat = cat-&gt;<a class="code" href="structast__category.html#a0a4a1c6e5b4ed640d4bb7c697df91212">next</a>) {
<a name="l00623"></a>00623          <span class="keywordflow">if</span> (cat-&gt;<a class="code" href="structast__category.html#a3777dbae63a15da001b2baa317a25149">name</a> == prev) {
<a name="l00624"></a>00624             cat = cat-&gt;<a class="code" href="structast__category.html#a0a4a1c6e5b4ed640d4bb7c697df91212">next</a>;
<a name="l00625"></a>00625             <span class="keywordflow">break</span>;
<a name="l00626"></a>00626          }
<a name="l00627"></a>00627       }
<a name="l00628"></a>00628       <span class="keywordflow">if</span> (!cat) {
<a name="l00629"></a>00629          <span class="keywordflow">for</span> (cat = config-&gt;<a class="code" href="structast__config.html#a1d069527a476fcfd5e93263cda8099dd">root</a>; cat; cat = cat-&gt;<a class="code" href="structast__category.html#a0a4a1c6e5b4ed640d4bb7c697df91212">next</a>) {
<a name="l00630"></a>00630             <span class="keywordflow">if</span> (!strcasecmp(cat-&gt;<a class="code" href="structast__category.html#a3777dbae63a15da001b2baa317a25149">name</a>, prev)) {
<a name="l00631"></a>00631                cat = cat-&gt;<a class="code" href="structast__category.html#a0a4a1c6e5b4ed640d4bb7c697df91212">next</a>;
<a name="l00632"></a>00632                <span class="keywordflow">break</span>;
<a name="l00633"></a>00633             }
<a name="l00634"></a>00634          }
<a name="l00635"></a>00635       }
<a name="l00636"></a>00636    }
<a name="l00637"></a>00637    
<a name="l00638"></a>00638    <span class="keywordflow">if</span> (cat)
<a name="l00639"></a>00639       cat = <a class="code" href="config_8c.html#ade468175b713e3cb13443b97f3d5b4c6">next_available_category</a>(cat);
<a name="l00640"></a>00640 
<a name="l00641"></a>00641    config-&gt;<a class="code" href="structast__config.html#acd249676fca8f438f6762b26fb92f712">last_browse</a> = cat;
<a name="l00642"></a>00642    <span class="keywordflow">return</span> (cat) ? cat-&gt;<a class="code" href="structast__category.html#a3777dbae63a15da001b2baa317a25149">name</a> : NULL;
<a name="l00643"></a>00643 }
<a name="l00644"></a>00644 
<a name="l00645"></a><a class="code" href="config_8c.html#a1b467acf627f98175f01061b31520616">00645</a> <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *<a class="code" href="config_8h.html#a1b467acf627f98175f01061b31520616">ast_category_detach_variables</a>(<span class="keyword">struct</span> ast_category *cat)
<a name="l00646"></a>00646 {
<a name="l00647"></a>00647    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *v;
<a name="l00648"></a>00648 
<a name="l00649"></a>00649    v = cat-&gt;<a class="code" href="structast__category.html#a6f86d2cb07f9a779a13a854d21b40728">root</a>;
<a name="l00650"></a>00650    cat-&gt;<a class="code" href="structast__category.html#a6f86d2cb07f9a779a13a854d21b40728">root</a> = NULL;
<a name="l00651"></a>00651    cat-&gt;<a class="code" href="structast__category.html#ac6bc41916ca996a56407db9d13e2e734">last</a> = NULL;
<a name="l00652"></a>00652 
<a name="l00653"></a>00653    <span class="keywordflow">return</span> v;
<a name="l00654"></a>00654 }
<a name="l00655"></a>00655 
<a name="l00656"></a><a class="code" href="config_8c.html#a2a5612ff8eb3595c1be1df75be4d870f">00656</a> <span class="keywordtype">void</span> <a class="code" href="config_8h.html#a2a5612ff8eb3595c1be1df75be4d870f">ast_category_rename</a>(<span class="keyword">struct</span> ast_category *cat, <span class="keyword">const</span> <span class="keywordtype">char</span> *name)
<a name="l00657"></a>00657 {
<a name="l00658"></a>00658    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(cat-&gt;<a class="code" href="structast__category.html#a3777dbae63a15da001b2baa317a25149">name</a>, name, <span class="keyword">sizeof</span>(cat-&gt;<a class="code" href="structast__category.html#a3777dbae63a15da001b2baa317a25149">name</a>));
<a name="l00659"></a>00659 }
<a name="l00660"></a>00660 
<a name="l00661"></a><a class="code" href="config_8c.html#a480bce4d76a07faf62beb72c7cd92f4b">00661</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="config_8c.html#a480bce4d76a07faf62beb72c7cd92f4b">inherit_category</a>(<span class="keyword">struct</span> ast_category *<span class="keyword">new</span>, <span class="keyword">const</span> <span class="keyword">struct</span> ast_category *base)
<a name="l00662"></a>00662 {
<a name="l00663"></a>00663    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>;
<a name="l00664"></a>00664    <span class="keyword">struct </span><a class="code" href="structast__category__template__instance.html">ast_category_template_instance</a> *x = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1,<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structast__category__template__instance.html">ast_category_template_instance</a>));
<a name="l00665"></a>00665 
<a name="l00666"></a>00666    strcpy(x-&gt;<a class="code" href="structast__category__template__instance.html#a3777dbae63a15da001b2baa317a25149">name</a>, base-&gt;<a class="code" href="structast__category.html#a3777dbae63a15da001b2baa317a25149">name</a>);
<a name="l00667"></a>00667    x-&gt;<a class="code" href="structast__category__template__instance.html#a4a795962dfc694a64a8c88bcb097b282">inst</a> = base;
<a name="l00668"></a>00668    <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(&amp;new-&gt;template_instances, x, next);
<a name="l00669"></a>00669    <span class="keywordflow">for</span> (var = base-&gt;<a class="code" href="structast__category.html#a6f86d2cb07f9a779a13a854d21b40728">root</a>; var; var = var-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>)
<a name="l00670"></a>00670       <a class="code" href="config_8h.html#a132ddbd39dd9d26395c410f7647f76db">ast_variable_append</a>(<span class="keyword">new</span>, <a class="code" href="config_8c.html#a63722d8861bd8bdb8d16cfae4b3ff818">variable_clone</a>(var));
<a name="l00671"></a>00671 }
<a name="l00672"></a>00672 
<a name="l00673"></a><a class="code" href="config_8c.html#a45e1a284d7d84c4b4a316764fbb887fb">00673</a> <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *<a class="code" href="config_8h.html#a45e1a284d7d84c4b4a316764fbb887fb" title="Create a new base configuration structure.">ast_config_new</a>(<span class="keywordtype">void</span>) 
<a name="l00674"></a>00674 {
<a name="l00675"></a>00675    <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *<a class="code" href="cdr__csv_8c.html#a74bb62276efdf39dd94048e007fca05b">config</a>;
<a name="l00676"></a>00676 
<a name="l00677"></a>00677    <span class="keywordflow">if</span> ((config = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*config))))
<a name="l00678"></a>00678       config-&gt;<a class="code" href="structast__config.html#a98a1a362d95d774ba9bf42efd1706700">max_include_level</a> = <a class="code" href="config_8c.html#aafe4bba8deb3c1d5d016032a4c1abc14">MAX_INCLUDE_LEVEL</a>;
<a name="l00679"></a>00679    <span class="keywordflow">return</span> config;
<a name="l00680"></a>00680 }
<a name="l00681"></a>00681 
<a name="l00682"></a><a class="code" href="config_8c.html#a387af9887266a55f3dcbbf3c12d4ccba">00682</a> <span class="keywordtype">int</span> <a class="code" href="config_8h.html#a387af9887266a55f3dcbbf3c12d4ccba">ast_variable_delete</a>(<span class="keyword">struct</span> ast_category *category, <span class="keyword">const</span> <span class="keywordtype">char</span> *variable, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="chan__iax2_8c.html#aa27930d6214f6421994d6bef51efb7aa">match</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *line)
<a name="l00683"></a>00683 {
<a name="l00684"></a>00684    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *cur, *prev=NULL, *curn;
<a name="l00685"></a>00685    <span class="keywordtype">int</span> res = -1;
<a name="l00686"></a>00686    <span class="keywordtype">int</span> lineno = 0;
<a name="l00687"></a>00687 
<a name="l00688"></a>00688    cur = category-&gt;<a class="code" href="structast__category.html#a6f86d2cb07f9a779a13a854d21b40728">root</a>;
<a name="l00689"></a>00689    <span class="keywordflow">while</span> (cur) {
<a name="l00690"></a>00690       <span class="keywordflow">if</span> (cur-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> == variable) {
<a name="l00691"></a>00691          <span class="keywordflow">if</span> (prev) {
<a name="l00692"></a>00692             prev-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a> = cur-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>;
<a name="l00693"></a>00693             <span class="keywordflow">if</span> (cur == category-&gt;<a class="code" href="structast__category.html#ac6bc41916ca996a56407db9d13e2e734">last</a>)
<a name="l00694"></a>00694                category-&gt;<a class="code" href="structast__category.html#ac6bc41916ca996a56407db9d13e2e734">last</a> = prev;
<a name="l00695"></a>00695          } <span class="keywordflow">else</span> {
<a name="l00696"></a>00696             category-&gt;<a class="code" href="structast__category.html#a6f86d2cb07f9a779a13a854d21b40728">root</a> = cur-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>;
<a name="l00697"></a>00697             <span class="keywordflow">if</span> (cur == category-&gt;<a class="code" href="structast__category.html#ac6bc41916ca996a56407db9d13e2e734">last</a>)
<a name="l00698"></a>00698                category-&gt;<a class="code" href="structast__category.html#ac6bc41916ca996a56407db9d13e2e734">last</a> = NULL;
<a name="l00699"></a>00699          }
<a name="l00700"></a>00700          cur-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a> = NULL;
<a name="l00701"></a>00701          <a class="code" href="config_8h.html#ad3d8122172af6f13687a07840411d65d" title="Free variable list.">ast_variables_destroy</a>(cur);
<a name="l00702"></a>00702          <span class="keywordflow">return</span> 0;
<a name="l00703"></a>00703       }
<a name="l00704"></a>00704       prev = cur;
<a name="l00705"></a>00705       cur = cur-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>;
<a name="l00706"></a>00706    }
<a name="l00707"></a>00707 
<a name="l00708"></a>00708    prev = NULL;
<a name="l00709"></a>00709    cur = category-&gt;<a class="code" href="structast__category.html#a6f86d2cb07f9a779a13a854d21b40728">root</a>;
<a name="l00710"></a>00710    <span class="keywordflow">while</span> (cur) {
<a name="l00711"></a>00711       curn = cur-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>;
<a name="l00712"></a>00712       <span class="keywordflow">if</span> ((!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(line) &amp;&amp; lineno == atoi(line)) || (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(line) &amp;&amp; !strcasecmp(cur-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, variable) &amp;&amp; (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(match) || !strcasecmp(cur-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, match)))) {
<a name="l00713"></a>00713          <span class="keywordflow">if</span> (prev) {
<a name="l00714"></a>00714             prev-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a> = cur-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>;
<a name="l00715"></a>00715             <span class="keywordflow">if</span> (cur == category-&gt;<a class="code" href="structast__category.html#ac6bc41916ca996a56407db9d13e2e734">last</a>)
<a name="l00716"></a>00716                category-&gt;<a class="code" href="structast__category.html#ac6bc41916ca996a56407db9d13e2e734">last</a> = prev;
<a name="l00717"></a>00717          } <span class="keywordflow">else</span> {
<a name="l00718"></a>00718             category-&gt;<a class="code" href="structast__category.html#a6f86d2cb07f9a779a13a854d21b40728">root</a> = cur-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>;
<a name="l00719"></a>00719             <span class="keywordflow">if</span> (cur == category-&gt;<a class="code" href="structast__category.html#ac6bc41916ca996a56407db9d13e2e734">last</a>)
<a name="l00720"></a>00720                category-&gt;<a class="code" href="structast__category.html#ac6bc41916ca996a56407db9d13e2e734">last</a> = NULL;
<a name="l00721"></a>00721          }
<a name="l00722"></a>00722          cur-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a> = NULL;
<a name="l00723"></a>00723          <a class="code" href="config_8h.html#ad3d8122172af6f13687a07840411d65d" title="Free variable list.">ast_variables_destroy</a>(cur);
<a name="l00724"></a>00724          res = 0;
<a name="l00725"></a>00725       } <span class="keywordflow">else</span>
<a name="l00726"></a>00726          prev = cur;
<a name="l00727"></a>00727 
<a name="l00728"></a>00728       cur = curn;
<a name="l00729"></a>00729       lineno++;
<a name="l00730"></a>00730    }
<a name="l00731"></a>00731    <span class="keywordflow">return</span> res;
<a name="l00732"></a>00732 }
<a name="l00733"></a>00733 
<a name="l00734"></a><a class="code" href="config_8c.html#a61b77e9b543a66af82d7ac7d4d6b4ac8">00734</a> <span class="keywordtype">int</span> <a class="code" href="config_8h.html#a61b77e9b543a66af82d7ac7d4d6b4ac8" title="Update variable value within a config.">ast_variable_update</a>(<span class="keyword">struct</span> ast_category *category, <span class="keyword">const</span> <span class="keywordtype">char</span> *variable, 
<a name="l00735"></a>00735                   <span class="keyword">const</span> <span class="keywordtype">char</span> *value, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="chan__iax2_8c.html#aa27930d6214f6421994d6bef51efb7aa">match</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <span class="keywordtype">object</span>)
<a name="l00736"></a>00736 {
<a name="l00737"></a>00737    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *cur, *prev=NULL, *newer=NULL;
<a name="l00738"></a>00738 
<a name="l00739"></a>00739    <span class="keywordflow">for</span> (cur = category-&gt;<a class="code" href="structast__category.html#a6f86d2cb07f9a779a13a854d21b40728">root</a>; cur; prev = cur, cur = cur-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l00740"></a>00740       <span class="keywordflow">if</span> (strcasecmp(cur-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, variable) ||
<a name="l00741"></a>00741          (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(match) &amp;&amp; strcasecmp(cur-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, match)))
<a name="l00742"></a>00742          <span class="keywordflow">continue</span>;
<a name="l00743"></a>00743 
<a name="l00744"></a>00744       <span class="keywordflow">if</span> (!(newer = <a class="code" href="config_8h.html#a08e94d96f459e7301a74daf32035423b">ast_variable_new</a>(variable, value, cur-&gt;<a class="code" href="structast__variable.html#adf16cd437526a5c5e0e0af87745acbb8">file</a>)))
<a name="l00745"></a>00745          <span class="keywordflow">return</span> -1;
<a name="l00746"></a>00746    
<a name="l00747"></a>00747       newer-&gt;next = cur-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>;
<a name="l00748"></a>00748       newer-&gt;<a class="code" href="structast__variable.html#a328cd221e75f4bd92e3ccf406f0d0441">object</a> = cur-&gt;<a class="code" href="structast__variable.html#a328cd221e75f4bd92e3ccf406f0d0441">object</a> || object;
<a name="l00749"></a>00749       <span class="keywordflow">if</span> (prev)
<a name="l00750"></a>00750          prev-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a> = newer;
<a name="l00751"></a>00751       <span class="keywordflow">else</span>
<a name="l00752"></a>00752          category-&gt;<a class="code" href="structast__category.html#a6f86d2cb07f9a779a13a854d21b40728">root</a> = newer;
<a name="l00753"></a>00753       <span class="keywordflow">if</span> (category-&gt;<a class="code" href="structast__category.html#ac6bc41916ca996a56407db9d13e2e734">last</a> == cur)
<a name="l00754"></a>00754          category-&gt;<a class="code" href="structast__category.html#ac6bc41916ca996a56407db9d13e2e734">last</a> = newer;
<a name="l00755"></a>00755 
<a name="l00756"></a>00756       cur-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a> = NULL;
<a name="l00757"></a>00757       <a class="code" href="config_8h.html#ad3d8122172af6f13687a07840411d65d" title="Free variable list.">ast_variables_destroy</a>(cur);
<a name="l00758"></a>00758 
<a name="l00759"></a>00759       <span class="keywordflow">return</span> 0;
<a name="l00760"></a>00760    }
<a name="l00761"></a>00761 
<a name="l00762"></a>00762    <span class="comment">/* Could not find variable to update */</span>
<a name="l00763"></a>00763    <span class="keywordflow">return</span> -1;
<a name="l00764"></a>00764 }
<a name="l00765"></a>00765 
<a name="l00766"></a><a class="code" href="config_8c.html#ab4ab35927c1fb4ee1bddf30edf6419e3">00766</a> <span class="keywordtype">int</span> <a class="code" href="config_8h.html#ab4ab35927c1fb4ee1bddf30edf6419e3">ast_category_delete</a>(<span class="keyword">struct</span> <a class="code" href="structast__config.html">ast_config</a> *cfg, <span class="keyword">const</span> <span class="keywordtype">char</span> *category)
<a name="l00767"></a>00767 {
<a name="l00768"></a>00768    <span class="keyword">struct </span>ast_category *prev=NULL, *cat;
<a name="l00769"></a>00769 
<a name="l00770"></a>00770    cat = cfg-&gt;<a class="code" href="structast__config.html#a1d069527a476fcfd5e93263cda8099dd">root</a>;
<a name="l00771"></a>00771    <span class="keywordflow">while</span> (cat) {
<a name="l00772"></a>00772       <span class="keywordflow">if</span> (cat-&gt;name == category) {
<a name="l00773"></a>00773          <span class="keywordflow">if</span> (prev) {
<a name="l00774"></a>00774             prev-&gt;<a class="code" href="structast__category.html#a0a4a1c6e5b4ed640d4bb7c697df91212">next</a> = cat-&gt;<a class="code" href="structast__category.html#a0a4a1c6e5b4ed640d4bb7c697df91212">next</a>;
<a name="l00775"></a>00775             <span class="keywordflow">if</span> (cat == cfg-&gt;<a class="code" href="structast__config.html#a3419d1f39268adeeb95610eaf215952d">last</a>)
<a name="l00776"></a>00776                cfg-&gt;<a class="code" href="structast__config.html#a3419d1f39268adeeb95610eaf215952d">last</a> = prev;
<a name="l00777"></a>00777          } <span class="keywordflow">else</span> {
<a name="l00778"></a>00778             cfg-&gt;<a class="code" href="structast__config.html#a1d069527a476fcfd5e93263cda8099dd">root</a> = cat-&gt;<a class="code" href="structast__category.html#a0a4a1c6e5b4ed640d4bb7c697df91212">next</a>;
<a name="l00779"></a>00779             <span class="keywordflow">if</span> (cat == cfg-&gt;<a class="code" href="structast__config.html#a3419d1f39268adeeb95610eaf215952d">last</a>)
<a name="l00780"></a>00780                cfg-&gt;<a class="code" href="structast__config.html#a3419d1f39268adeeb95610eaf215952d">last</a> = NULL;
<a name="l00781"></a>00781          }
<a name="l00782"></a>00782          <a class="code" href="config_8h.html#abd17f201d0e7c31c124dc0cd3a0d073b">ast_category_destroy</a>(cat);
<a name="l00783"></a>00783          <span class="keywordflow">return</span> 0;
<a name="l00784"></a>00784       }
<a name="l00785"></a>00785       prev = cat;
<a name="l00786"></a>00786       cat = cat-&gt;<a class="code" href="structast__category.html#a0a4a1c6e5b4ed640d4bb7c697df91212">next</a>;
<a name="l00787"></a>00787    }
<a name="l00788"></a>00788 
<a name="l00789"></a>00789    prev = NULL;
<a name="l00790"></a>00790    cat = cfg-&gt;<a class="code" href="structast__config.html#a1d069527a476fcfd5e93263cda8099dd">root</a>;
<a name="l00791"></a>00791    <span class="keywordflow">while</span> (cat) {
<a name="l00792"></a>00792       <span class="keywordflow">if</span> (!strcasecmp(cat-&gt;name, category)) {
<a name="l00793"></a>00793          <span class="keywordflow">if</span> (prev) {
<a name="l00794"></a>00794             prev-&gt;<a class="code" href="structast__category.html#a0a4a1c6e5b4ed640d4bb7c697df91212">next</a> = cat-&gt;<a class="code" href="structast__category.html#a0a4a1c6e5b4ed640d4bb7c697df91212">next</a>;
<a name="l00795"></a>00795             <span class="keywordflow">if</span> (cat == cfg-&gt;<a class="code" href="structast__config.html#a3419d1f39268adeeb95610eaf215952d">last</a>)
<a name="l00796"></a>00796                cfg-&gt;<a class="code" href="structast__config.html#a3419d1f39268adeeb95610eaf215952d">last</a> = prev;
<a name="l00797"></a>00797          } <span class="keywordflow">else</span> {
<a name="l00798"></a>00798             cfg-&gt;<a class="code" href="structast__config.html#a1d069527a476fcfd5e93263cda8099dd">root</a> = cat-&gt;<a class="code" href="structast__category.html#a0a4a1c6e5b4ed640d4bb7c697df91212">next</a>;
<a name="l00799"></a>00799             <span class="keywordflow">if</span> (cat == cfg-&gt;<a class="code" href="structast__config.html#a3419d1f39268adeeb95610eaf215952d">last</a>)
<a name="l00800"></a>00800                cfg-&gt;<a class="code" href="structast__config.html#a3419d1f39268adeeb95610eaf215952d">last</a> = NULL;
<a name="l00801"></a>00801          }
<a name="l00802"></a>00802          <a class="code" href="config_8h.html#abd17f201d0e7c31c124dc0cd3a0d073b">ast_category_destroy</a>(cat);
<a name="l00803"></a>00803          <span class="keywordflow">return</span> 0;
<a name="l00804"></a>00804       }
<a name="l00805"></a>00805       prev = cat;
<a name="l00806"></a>00806       cat = cat-&gt;<a class="code" href="structast__category.html#a0a4a1c6e5b4ed640d4bb7c697df91212">next</a>;
<a name="l00807"></a>00807    }
<a name="l00808"></a>00808    <span class="keywordflow">return</span> -1;
<a name="l00809"></a>00809 }
<a name="l00810"></a>00810 
<a name="l00811"></a><a class="code" href="config_8c.html#ae8eb938b00e489b467a33f836ff7d77e">00811</a> <span class="keywordtype">int</span> <a class="code" href="config_8h.html#ae8eb938b00e489b467a33f836ff7d77e" title="Removes and destroys all variables within a category.">ast_category_empty</a>(<span class="keyword">struct</span> <a class="code" href="structast__config.html">ast_config</a> *cfg, <span class="keyword">const</span> <span class="keywordtype">char</span> *category)
<a name="l00812"></a>00812 {
<a name="l00813"></a>00813    <span class="keyword">struct </span>ast_category *cat;
<a name="l00814"></a>00814 
<a name="l00815"></a>00815    <span class="keywordflow">for</span> (cat = cfg-&gt;<a class="code" href="structast__config.html#a1d069527a476fcfd5e93263cda8099dd">root</a>; cat; cat = cat-&gt;<a class="code" href="structast__category.html#a0a4a1c6e5b4ed640d4bb7c697df91212">next</a>) {
<a name="l00816"></a>00816       <span class="keywordflow">if</span> (!strcasecmp(cat-&gt;<a class="code" href="structast__category.html#a3777dbae63a15da001b2baa317a25149">name</a>, category))
<a name="l00817"></a>00817          <span class="keywordflow">continue</span>;
<a name="l00818"></a>00818       <a class="code" href="config_8h.html#ad3d8122172af6f13687a07840411d65d" title="Free variable list.">ast_variables_destroy</a>(cat-&gt;<a class="code" href="structast__category.html#a6f86d2cb07f9a779a13a854d21b40728">root</a>);
<a name="l00819"></a>00819       cat-&gt;<a class="code" href="structast__category.html#a6f86d2cb07f9a779a13a854d21b40728">root</a> = NULL;
<a name="l00820"></a>00820       cat-&gt;<a class="code" href="structast__category.html#ac6bc41916ca996a56407db9d13e2e734">last</a> = NULL;
<a name="l00821"></a>00821       <span class="keywordflow">return</span> 0;
<a name="l00822"></a>00822    }
<a name="l00823"></a>00823 
<a name="l00824"></a>00824    <span class="keywordflow">return</span> -1;
<a name="l00825"></a>00825 }
<a name="l00826"></a>00826 
<a name="l00827"></a><a class="code" href="config_8c.html#a449ae55fa16c41b1e915d4601a8db06a">00827</a> <span class="keywordtype">void</span> <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(<span class="keyword">struct</span> <a class="code" href="structast__config.html">ast_config</a> *cfg)
<a name="l00828"></a>00828 {
<a name="l00829"></a>00829    <span class="keyword">struct </span>ast_category *cat, *catn;
<a name="l00830"></a>00830 
<a name="l00831"></a>00831    <span class="keywordflow">if</span> (!cfg)
<a name="l00832"></a>00832       <span class="keywordflow">return</span>;
<a name="l00833"></a>00833 
<a name="l00834"></a>00834    <a class="code" href="config_8c.html#a17aa91aa71dc55b7e95bab4bc8e4cb49">ast_includes_destroy</a>(cfg-&gt;<a class="code" href="structast__config.html#acb049f8b410c47aebfde624a7de10819">includes</a>);
<a name="l00835"></a>00835 
<a name="l00836"></a>00836    cat = cfg-&gt;<a class="code" href="structast__config.html#a1d069527a476fcfd5e93263cda8099dd">root</a>;
<a name="l00837"></a>00837    <span class="keywordflow">while</span> (cat) {
<a name="l00838"></a>00838       catn = cat;
<a name="l00839"></a>00839       cat = cat-&gt;<a class="code" href="structast__category.html#a0a4a1c6e5b4ed640d4bb7c697df91212">next</a>;
<a name="l00840"></a>00840       <a class="code" href="config_8h.html#abd17f201d0e7c31c124dc0cd3a0d073b">ast_category_destroy</a>(catn);
<a name="l00841"></a>00841    }
<a name="l00842"></a>00842    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(cfg);
<a name="l00843"></a>00843 }
<a name="l00844"></a>00844 
<a name="l00845"></a><a class="code" href="config_8c.html#a6884d439424ba2be31ef259213da4e8b">00845</a> <span class="keyword">struct </span>ast_category *<a class="code" href="config_8h.html#a6884d439424ba2be31ef259213da4e8b" title="Retrieve the current category name being built. API for backend configuration engines...">ast_config_get_current_category</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structast__config.html">ast_config</a> *cfg)
<a name="l00846"></a>00846 {
<a name="l00847"></a>00847    <span class="keywordflow">return</span> cfg-&gt;<a class="code" href="structast__config.html#a204ede9a191a91abc1968f94973de556">current</a>;
<a name="l00848"></a>00848 }
<a name="l00849"></a>00849 
<a name="l00850"></a><a class="code" href="config_8c.html#a781df2d99cdb5c37b7028be1bea7c3bf">00850</a> <span class="keywordtype">void</span> <a class="code" href="config_8h.html#a781df2d99cdb5c37b7028be1bea7c3bf" title="Set the category within the configuration as being current. API for backend configuration...">ast_config_set_current_category</a>(<span class="keyword">struct</span> <a class="code" href="structast__config.html">ast_config</a> *cfg, <span class="keyword">const</span> <span class="keyword">struct</span> ast_category *cat)
<a name="l00851"></a>00851 {
<a name="l00852"></a>00852    <span class="comment">/* cast below is just to silence compiler warning about dropping &quot;const&quot; */</span>
<a name="l00853"></a>00853    cfg-&gt;<a class="code" href="structast__config.html#a204ede9a191a91abc1968f94973de556">current</a> = (<span class="keyword">struct </span>ast_category *) cat;
<a name="l00854"></a>00854 }
<a name="l00855"></a>00855 
<a name="l00856"></a><a class="code" href="config_8c.html#a6f6fe1fec746762842e740f4c7343d06">00856</a> <span class="keyword">enum</span> <a class="code" href="config_8c.html#a6f6fe1fec746762842e740f4c7343d06">config_cache_attribute_enum</a> {
<a name="l00857"></a><a class="code" href="config_8c.html#a6f6fe1fec746762842e740f4c7343d06afed88e6b3db380fd93dd724d1c90e3ce">00857</a>    <a class="code" href="config_8c.html#a6f6fe1fec746762842e740f4c7343d06afed88e6b3db380fd93dd724d1c90e3ce">ATTRIBUTE_INCLUDE</a> = 0,
<a name="l00858"></a><a class="code" href="config_8c.html#a6f6fe1fec746762842e740f4c7343d06a0d802cfa3be17ea433d35aab916b96e7">00858</a>    <a class="code" href="config_8c.html#a6f6fe1fec746762842e740f4c7343d06a0d802cfa3be17ea433d35aab916b96e7">ATTRIBUTE_EXEC</a> = 1,
<a name="l00859"></a>00859 };
<a name="l00860"></a>00860 
<a name="l00861"></a><a class="code" href="config_8c.html#a338df845b28007ea97c17c204fdf889c">00861</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="config_8c.html#a338df845b28007ea97c17c204fdf889c">config_cache_attribute</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *configfile, <span class="keyword">enum</span> <a class="code" href="config_8c.html#a6f6fe1fec746762842e740f4c7343d06">config_cache_attribute_enum</a> attrtype, <span class="keyword">const</span> <span class="keywordtype">char</span> *filename, <span class="keyword">const</span> <span class="keywordtype">char</span> *who_asked)
<a name="l00862"></a>00862 {
<a name="l00863"></a>00863    <span class="keyword">struct </span>cache_file_mtime *cfmtime;
<a name="l00864"></a>00864    <span class="keyword">struct </span><a class="code" href="structcache__file__include.html" title="Hold the mtime for config files, so if we don&amp;#39;t need to reread our config, don&amp;#39;t...">cache_file_include</a> *cfinclude;
<a name="l00865"></a>00865    <span class="keyword">struct </span>stat statbuf = { 0, };
<a name="l00866"></a>00866 
<a name="l00867"></a>00867    <span class="comment">/* Find our cached entry for this configuration file */</span>
<a name="l00868"></a>00868    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;<a class="code" href="structcfmtime__head.html">cfmtime_head</a>);
<a name="l00869"></a>00869    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="structcfmtime__head.html">cfmtime_head</a>, cfmtime, list) {
<a name="l00870"></a>00870       <span class="keywordflow">if</span> (!strcmp(cfmtime-&gt;<a class="code" href="structcache__file__mtime.html#afae8c108f5d360038fa8b099eb4ab2f3">filename</a>, configfile) &amp;&amp; !strcmp(cfmtime-&gt;<a class="code" href="structcache__file__mtime.html#ac1a3dfe5c9e5cf85abc41b8ca002ef7f">who_asked</a>, who_asked))
<a name="l00871"></a>00871          <span class="keywordflow">break</span>;
<a name="l00872"></a>00872    }
<a name="l00873"></a>00873    <span class="keywordflow">if</span> (!cfmtime) {
<a name="l00874"></a>00874       cfmtime = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*cfmtime) + strlen(configfile) + 1 + strlen(who_asked) + 1);
<a name="l00875"></a>00875       <span class="keywordflow">if</span> (!cfmtime) {
<a name="l00876"></a>00876          <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="structcfmtime__head.html">cfmtime_head</a>);
<a name="l00877"></a>00877          <span class="keywordflow">return</span>;
<a name="l00878"></a>00878       }
<a name="l00879"></a>00879       <a class="code" href="linkedlists_8h.html#a6f42d3bf45cc9af6f794d9d1cf8c45ca" title="Initializes a list head structure.">AST_LIST_HEAD_INIT</a>(&amp;cfmtime-&gt;<a class="code" href="structcache__file__mtime.html#ad9a9f7cdb9041a1f0ae0c2babece8142">includes</a>);
<a name="l00880"></a>00880       strcpy(cfmtime-&gt;<a class="code" href="structcache__file__mtime.html#afae8c108f5d360038fa8b099eb4ab2f3">filename</a>, configfile);
<a name="l00881"></a>00881       cfmtime-&gt;<a class="code" href="structcache__file__mtime.html#ac1a3dfe5c9e5cf85abc41b8ca002ef7f">who_asked</a> = cfmtime-&gt;<a class="code" href="structcache__file__mtime.html#afae8c108f5d360038fa8b099eb4ab2f3">filename</a> + strlen(configfile) + 1;
<a name="l00882"></a>00882       strcpy(cfmtime-&gt;<a class="code" href="structcache__file__mtime.html#ac1a3dfe5c9e5cf85abc41b8ca002ef7f">who_asked</a>, who_asked);
<a name="l00883"></a>00883       <span class="comment">/* Note that the file mtime is initialized to 0, i.e. 1970 */</span>
<a name="l00884"></a>00884       <a class="code" href="linkedlists_8h.html#a17c99b4db7d6477c4a8e109617129218" title="Inserts a list entry into a alphabetically sorted list.">AST_LIST_INSERT_SORTALPHA</a>(&amp;<a class="code" href="structcfmtime__head.html">cfmtime_head</a>, cfmtime, list, filename);
<a name="l00885"></a>00885    }
<a name="l00886"></a>00886 
<a name="l00887"></a>00887    <span class="keywordflow">if</span> (!stat(configfile, &amp;statbuf))
<a name="l00888"></a>00888       cfmtime-&gt;<a class="code" href="structcache__file__mtime.html#a4a2d3a53446ef3217564ced73636f9bf">mtime</a> = 0;
<a name="l00889"></a>00889    <span class="keywordflow">else</span>
<a name="l00890"></a>00890       cfmtime-&gt;<a class="code" href="structcache__file__mtime.html#a4a2d3a53446ef3217564ced73636f9bf">mtime</a> = statbuf.st_mtime;
<a name="l00891"></a>00891 
<a name="l00892"></a>00892    <span class="keywordflow">switch</span> (attrtype) {
<a name="l00893"></a>00893    <span class="keywordflow">case</span> <a class="code" href="config_8c.html#a6f6fe1fec746762842e740f4c7343d06afed88e6b3db380fd93dd724d1c90e3ce">ATTRIBUTE_INCLUDE</a>:
<a name="l00894"></a>00894       <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;cfmtime-&gt;<a class="code" href="structcache__file__mtime.html#ad9a9f7cdb9041a1f0ae0c2babece8142">includes</a>, cfinclude, list) {
<a name="l00895"></a>00895          <span class="keywordflow">if</span> (!strcmp(cfinclude-&gt;<a class="code" href="structcache__file__include.html#abdbb2af142a7c931ec450a5224e6fd76">include</a>, filename)) {
<a name="l00896"></a>00896             <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="structcfmtime__head.html">cfmtime_head</a>);
<a name="l00897"></a>00897             <span class="keywordflow">return</span>;
<a name="l00898"></a>00898          }
<a name="l00899"></a>00899       }
<a name="l00900"></a>00900       cfinclude = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*cfinclude) + strlen(filename) + 1);
<a name="l00901"></a>00901       <span class="keywordflow">if</span> (!cfinclude) {
<a name="l00902"></a>00902          <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="structcfmtime__head.html">cfmtime_head</a>);
<a name="l00903"></a>00903          <span class="keywordflow">return</span>;
<a name="l00904"></a>00904       }
<a name="l00905"></a>00905       strcpy(cfinclude-&gt;<a class="code" href="structcache__file__include.html#abdbb2af142a7c931ec450a5224e6fd76">include</a>, filename);
<a name="l00906"></a>00906       <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(&amp;cfmtime-&gt;<a class="code" href="structcache__file__mtime.html#ad9a9f7cdb9041a1f0ae0c2babece8142">includes</a>, cfinclude, list);
<a name="l00907"></a>00907       <span class="keywordflow">break</span>;
<a name="l00908"></a>00908    <span class="keywordflow">case</span> <a class="code" href="config_8c.html#a6f6fe1fec746762842e740f4c7343d06a0d802cfa3be17ea433d35aab916b96e7">ATTRIBUTE_EXEC</a>:
<a name="l00909"></a>00909       cfmtime-&gt;<a class="code" href="structcache__file__mtime.html#a71b2199618baf99c5320948cd63ca39a">has_exec</a> = 1;
<a name="l00910"></a>00910       <span class="keywordflow">break</span>;
<a name="l00911"></a>00911    }
<a name="l00912"></a>00912    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="structcfmtime__head.html">cfmtime_head</a>);
<a name="l00913"></a>00913 }
<a name="l00914"></a>00914 <span class="comment"></span>
<a name="l00915"></a>00915 <span class="comment">/*! \brief parse one line in the configuration.</span>
<a name="l00916"></a>00916 <span class="comment"> * \verbatim</span>
<a name="l00917"></a>00917 <span class="comment"> * We can have a category header [foo](...)</span>
<a name="l00918"></a>00918 <span class="comment"> * a directive          #include / #exec</span>
<a name="l00919"></a>00919 <span class="comment"> * or a regular line       name = value</span>
<a name="l00920"></a>00920 <span class="comment"> * \endverbatim</span>
<a name="l00921"></a>00921 <span class="comment"> */</span>
<a name="l00922"></a><a class="code" href="config_8c.html#ab8e1da65b4704abbb80387744cc712ae">00922</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="config_8c.html#ab8e1da65b4704abbb80387744cc712ae" title="parse one line in the configuration.">process_text_line</a>(<span class="keyword">struct</span> <a class="code" href="structast__config.html">ast_config</a> *cfg, <span class="keyword">struct</span> ast_category **cat,
<a name="l00923"></a>00923    <span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <span class="keywordtype">int</span> lineno, <span class="keyword">const</span> <span class="keywordtype">char</span> *configfile, <span class="keyword">struct</span> <a class="code" href="structast__flags.html" title="Structure used to handle boolean flags.">ast_flags</a> flags,
<a name="l00924"></a>00924    <span class="keyword">struct</span> <a class="code" href="structast__str.html" title="The descriptor of a dynamic string XXX storage will be optimized later if needed...">ast_str</a> *comment_buffer,
<a name="l00925"></a>00925    <span class="keyword">struct</span> <a class="code" href="structast__str.html" title="The descriptor of a dynamic string XXX storage will be optimized later if needed...">ast_str</a> *lline_buffer,
<a name="l00926"></a>00926    <span class="keyword">const</span> <span class="keywordtype">char</span> *suggested_include_file,
<a name="l00927"></a>00927    <span class="keyword">struct</span> ast_category **last_cat, <span class="keyword">struct</span> <a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> **last_var, <span class="keyword">const</span> <span class="keywordtype">char</span> *who_asked)
<a name="l00928"></a>00928 {
<a name="l00929"></a>00929    <span class="keywordtype">char</span> *c;
<a name="l00930"></a>00930    <span class="keywordtype">char</span> *cur = buf;
<a name="l00931"></a>00931    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *v;
<a name="l00932"></a>00932    <span class="keywordtype">char</span> cmd[512], exec_file[512];
<a name="l00933"></a>00933 
<a name="l00934"></a>00934    <span class="comment">/* Actually parse the entry */</span>
<a name="l00935"></a>00935    <span class="keywordflow">if</span> (cur[0] == <span class="charliteral">&apos;[&apos;</span>) { <span class="comment">/* A category header */</span>
<a name="l00936"></a>00936       <span class="comment">/* format is one of the following:</span>
<a name="l00937"></a>00937 <span class="comment">       * [foo] define a new category named &apos;foo&apos;</span>
<a name="l00938"></a>00938 <span class="comment">       * [foo](!) define a new template category named &apos;foo&apos;</span>
<a name="l00939"></a>00939 <span class="comment">       * [foo](+) append to category &apos;foo&apos;, error if foo does not exist.</span>
<a name="l00940"></a>00940 <span class="comment">       * [foo](a) define a new category and inherit from template a.</span>
<a name="l00941"></a>00941 <span class="comment">       *    You can put a comma-separated list of templates and &apos;!&apos; and &apos;+&apos;</span>
<a name="l00942"></a>00942 <span class="comment">       *    between parentheses, with obvious meaning.</span>
<a name="l00943"></a>00943 <span class="comment">       */</span>
<a name="l00944"></a>00944       <span class="keyword">struct </span>ast_category *newcat = NULL;
<a name="l00945"></a>00945       <span class="keywordtype">char</span> *catname;
<a name="l00946"></a>00946 
<a name="l00947"></a>00947       c = strchr(cur, <span class="charliteral">&apos;]&apos;</span>);
<a name="l00948"></a>00948       <span class="keywordflow">if</span> (!c) {
<a name="l00949"></a>00949          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;parse error: no closing &apos;]&apos;, line %d of %s\n&quot;</span>, lineno, configfile);
<a name="l00950"></a>00950          <span class="keywordflow">return</span> -1;
<a name="l00951"></a>00951       }
<a name="l00952"></a>00952       *c++ = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00953"></a>00953       cur++;
<a name="l00954"></a>00954       <span class="keywordflow">if</span> (*c++ != <span class="charliteral">&apos;(&apos;</span>)
<a name="l00955"></a>00955          c = NULL;
<a name="l00956"></a>00956       catname = cur;
<a name="l00957"></a>00957       <span class="keywordflow">if</span> (!(*cat = newcat = <a class="code" href="config_8h.html#affebac76d69639677b677037d9871e29" title="Create a category structure.">ast_category_new</a>(catname,
<a name="l00958"></a>00958             <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(suggested_include_file, cfg-&gt;<a class="code" href="structast__config.html#a9889e4b9ce57e4055f9c11bacf89e50a">include_level</a> == 1 ? <span class="stringliteral">&quot;&quot;</span> : configfile),
<a name="l00959"></a>00959             lineno))) {
<a name="l00960"></a>00960          <span class="keywordflow">return</span> -1;
<a name="l00961"></a>00961       }
<a name="l00962"></a>00962       (*cat)-&gt;lineno = lineno;
<a name="l00963"></a>00963       *last_var = 0;
<a name="l00964"></a>00964       *last_cat = newcat;
<a name="l00965"></a>00965       
<a name="l00966"></a>00966       <span class="comment">/* add comments */</span>
<a name="l00967"></a>00967       <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="config_8h.html#a2d5492e116eebd5075f247d21fb9db26abc16a274124ae96d43f8e52e344292c3">CONFIG_FLAG_WITHCOMMENTS</a>))
<a name="l00968"></a>00968          newcat-&gt;<a class="code" href="structast__category.html#a80bf10e9bcb9c00a7a59051a77a620cf">precomments</a> = <a class="code" href="config_8c.html#a8131ec339c40205a5fae190516e347e1">ALLOC_COMMENT</a>(comment_buffer);
<a name="l00969"></a>00969       <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="config_8h.html#a2d5492e116eebd5075f247d21fb9db26abc16a274124ae96d43f8e52e344292c3">CONFIG_FLAG_WITHCOMMENTS</a>))
<a name="l00970"></a>00970          newcat-&gt;<a class="code" href="structast__category.html#a6e4312227f9a7570709abf7f686f1cfe">sameline</a> = <a class="code" href="config_8c.html#a8131ec339c40205a5fae190516e347e1">ALLOC_COMMENT</a>(lline_buffer);
<a name="l00971"></a>00971       <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="config_8h.html#a2d5492e116eebd5075f247d21fb9db26abc16a274124ae96d43f8e52e344292c3">CONFIG_FLAG_WITHCOMMENTS</a>))
<a name="l00972"></a>00972          <a class="code" href="config_8c.html#a9dbb0c1c6f38088927df54ba55454a1b">CB_RESET</a>(comment_buffer, lline_buffer);
<a name="l00973"></a>00973       
<a name="l00974"></a>00974       <span class="comment">/* If there are options or categories to inherit from, process them now */</span>
<a name="l00975"></a>00975       <span class="keywordflow">if</span> (c) {
<a name="l00976"></a>00976          <span class="keywordflow">if</span> (!(cur = strchr(c, <span class="charliteral">&apos;)&apos;</span>))) {
<a name="l00977"></a>00977             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;parse error: no closing &apos;)&apos;, line %d of %s\n&quot;</span>, lineno, configfile);
<a name="l00978"></a>00978             <span class="keywordflow">return</span> -1;
<a name="l00979"></a>00979          }
<a name="l00980"></a>00980          *cur = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00981"></a>00981          <span class="keywordflow">while</span> ((cur = <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;c, <span class="stringliteral">&quot;,&quot;</span>))) {
<a name="l00982"></a>00982             <span class="keywordflow">if</span> (!strcasecmp(cur, <span class="stringliteral">&quot;!&quot;</span>)) {
<a name="l00983"></a>00983                (*cat)-&gt;ignored = 1;
<a name="l00984"></a>00984             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(cur, <span class="stringliteral">&quot;+&quot;</span>)) {
<a name="l00985"></a>00985                *cat = <a class="code" href="config_8c.html#a4aaa75745aa4cf044419763d53bbb4a8">category_get</a>(cfg, catname, 1);
<a name="l00986"></a>00986                <span class="keywordflow">if</span> (!(*cat)) {
<a name="l00987"></a>00987                   <span class="keywordflow">if</span> (newcat)
<a name="l00988"></a>00988                      <a class="code" href="config_8h.html#abd17f201d0e7c31c124dc0cd3a0d073b">ast_category_destroy</a>(newcat);
<a name="l00989"></a>00989                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Category addition requested, but category &apos;%s&apos; does not exist, line %d of %s\n&quot;</span>, catname, lineno, configfile);
<a name="l00990"></a>00990                   <span class="keywordflow">return</span> -1;
<a name="l00991"></a>00991                }
<a name="l00992"></a>00992                <span class="keywordflow">if</span> (newcat) {
<a name="l00993"></a>00993                   <a class="code" href="config_8c.html#a843cd90974137daed3619bf004db5769">move_variables</a>(newcat, *cat);
<a name="l00994"></a>00994                   <a class="code" href="config_8h.html#abd17f201d0e7c31c124dc0cd3a0d073b">ast_category_destroy</a>(newcat);
<a name="l00995"></a>00995                   newcat = NULL;
<a name="l00996"></a>00996                }
<a name="l00997"></a>00997             } <span class="keywordflow">else</span> {
<a name="l00998"></a>00998                <span class="keyword">struct </span>ast_category *base;
<a name="l00999"></a>00999             
<a name="l01000"></a>01000                base = <a class="code" href="config_8c.html#a4aaa75745aa4cf044419763d53bbb4a8">category_get</a>(cfg, cur, 1);
<a name="l01001"></a>01001                <span class="keywordflow">if</span> (!base) {
<a name="l01002"></a>01002                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Inheritance requested, but category &apos;%s&apos; does not exist, line %d of %s\n&quot;</span>, cur, lineno, configfile);
<a name="l01003"></a>01003                   <span class="keywordflow">return</span> -1;
<a name="l01004"></a>01004                }
<a name="l01005"></a>01005                <a class="code" href="config_8c.html#a480bce4d76a07faf62beb72c7cd92f4b">inherit_category</a>(*cat, base);
<a name="l01006"></a>01006             }
<a name="l01007"></a>01007          }
<a name="l01008"></a>01008       }
<a name="l01009"></a>01009       <span class="keywordflow">if</span> (newcat)
<a name="l01010"></a>01010          <a class="code" href="config_8h.html#ab7b56ec66b058952423f313752c734e7">ast_category_append</a>(cfg, *cat);
<a name="l01011"></a>01011    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cur[0] == <span class="charliteral">&apos;#&apos;</span>) { <span class="comment">/* A directive - #include or #exec */</span>
<a name="l01012"></a>01012       <span class="keywordtype">char</span> *cur2;
<a name="l01013"></a>01013       <span class="keywordtype">char</span> real_inclusion_name[256];
<a name="l01014"></a>01014       <span class="keyword">struct </span><a class="code" href="structast__config__include.html">ast_config_include</a> *inclu;
<a name="l01015"></a>01015       <span class="keywordtype">int</span> do_include = 0;  <span class="comment">/* otherwise, it is exec */</span>
<a name="l01016"></a>01016 
<a name="l01017"></a>01017       cur++;
<a name="l01018"></a>01018       c = cur;
<a name="l01019"></a>01019       <span class="keywordflow">while</span> (*c &amp;&amp; (*c &gt; 32)) {
<a name="l01020"></a>01020          c++;
<a name="l01021"></a>01021       }
<a name="l01022"></a>01022 
<a name="l01023"></a>01023       <span class="keywordflow">if</span> (*c) {
<a name="l01024"></a>01024          *c = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01025"></a>01025          <span class="comment">/* Find real argument */</span>
<a name="l01026"></a>01026          c = <a class="code" href="strings_8h.html#aba29020090d7b4238027c5746e7ad722" title="Gets a pointer to the first non-whitespace character in a string.">ast_skip_blanks</a>(c + 1);
<a name="l01027"></a>01027          <span class="keywordflow">if</span> (!(*c)) {
<a name="l01028"></a>01028             c = NULL;
<a name="l01029"></a>01029          }
<a name="l01030"></a>01030       } <span class="keywordflow">else</span> 
<a name="l01031"></a>01031          c = NULL;
<a name="l01032"></a>01032       <span class="keywordflow">if</span> (!strcasecmp(cur, <span class="stringliteral">&quot;include&quot;</span>)) {
<a name="l01033"></a>01033          do_include = 1;
<a name="l01034"></a>01034       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(cur, <span class="stringliteral">&quot;exec&quot;</span>)) {
<a name="l01035"></a>01035          <span class="keywordflow">if</span> (!<a class="code" href="options_8h.html#afb51ab63450d25af1ca405607d306811">ast_opt_exec_includes</a>) {
<a name="l01036"></a>01036             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Cannot perform #exec unless execincludes option is enabled in asterisk.conf (options section)!\n&quot;</span>);
<a name="l01037"></a>01037             <span class="keywordflow">return</span> 0;   <span class="comment">/* XXX is this correct ? or we should return -1 ? */</span>
<a name="l01038"></a>01038          }
<a name="l01039"></a>01039       } <span class="keywordflow">else</span> {
<a name="l01040"></a>01040          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unknown directive &apos;#%s&apos; at line %d of %s\n&quot;</span>, cur, lineno, configfile);
<a name="l01041"></a>01041          <span class="keywordflow">return</span> 0;   <span class="comment">/* XXX is this correct ? or we should return -1 ? */</span>
<a name="l01042"></a>01042       }
<a name="l01043"></a>01043 
<a name="l01044"></a>01044       <span class="keywordflow">if</span> (c == NULL) {
<a name="l01045"></a>01045          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Directive &apos;#%s&apos; needs an argument (%s) at line %d of %s\n&quot;</span>, 
<a name="l01046"></a>01046                do_include ? <span class="stringliteral">&quot;include&quot;</span> : <span class="stringliteral">&quot;exec&quot;</span>,
<a name="l01047"></a>01047                do_include ? <span class="stringliteral">&quot;filename&quot;</span> : <span class="stringliteral">&quot;/path/to/executable&quot;</span>,
<a name="l01048"></a>01048                lineno,
<a name="l01049"></a>01049                configfile);
<a name="l01050"></a>01050          <span class="keywordflow">return</span> 0;   <span class="comment">/* XXX is this correct ? or we should return -1 ? */</span>
<a name="l01051"></a>01051       }
<a name="l01052"></a>01052 
<a name="l01053"></a>01053       cur = c;
<a name="l01054"></a>01054       <span class="comment">/* Strip off leading and trailing &quot;&apos;s and &lt;&gt;&apos;s */</span>
<a name="l01055"></a>01055       <span class="keywordflow">if</span> (*c == <span class="charliteral">&apos;&quot;&apos;</span>) {
<a name="l01056"></a>01056          <span class="comment">/* Dequote */</span>
<a name="l01057"></a>01057          <span class="keywordflow">while</span> (*c) {
<a name="l01058"></a>01058             <span class="keywordflow">if</span> (*c == <span class="charliteral">&apos;&quot;&apos;</span>) {
<a name="l01059"></a>01059                strcpy(c, c + 1); <span class="comment">/* SAFE */</span>
<a name="l01060"></a>01060                c--;
<a name="l01061"></a>01061             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*c == <span class="charliteral">&apos;\\&apos;</span>) {
<a name="l01062"></a>01062                strcpy(c, c + 1); <span class="comment">/* SAFE */</span>
<a name="l01063"></a>01063             }
<a name="l01064"></a>01064             c++;
<a name="l01065"></a>01065          }
<a name="l01066"></a>01066       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*c == <span class="charliteral">&apos;&lt;&apos;</span>) {
<a name="l01067"></a>01067          <span class="comment">/* C-style include */</span>
<a name="l01068"></a>01068          <span class="keywordflow">if</span> (*(c + strlen(c) - 1) == <span class="charliteral">&apos;&gt;&apos;</span>) {
<a name="l01069"></a>01069             cur++;
<a name="l01070"></a>01070             *(c + strlen(c) - 1) = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01071"></a>01071          }
<a name="l01072"></a>01072       }
<a name="l01073"></a>01073       cur2 = cur;
<a name="l01074"></a>01074 
<a name="l01075"></a>01075       <span class="comment">/* #exec &lt;/path/to/executable&gt;</span>
<a name="l01076"></a>01076 <span class="comment">         We create a tmp file, then we #include it, then we delete it. */</span>
<a name="l01077"></a>01077       <span class="keywordflow">if</span> (!do_include) {
<a name="l01078"></a>01078          <span class="keyword">struct </span>timeval now = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l01079"></a>01079          <span class="keywordflow">if</span> (!<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="config_8h.html#a2d5492e116eebd5075f247d21fb9db26a3b68640f31a2c5493459c159abee08ee">CONFIG_FLAG_NOCACHE</a>))
<a name="l01080"></a>01080             <a class="code" href="config_8c.html#a338df845b28007ea97c17c204fdf889c">config_cache_attribute</a>(configfile, <a class="code" href="config_8c.html#a6f6fe1fec746762842e740f4c7343d06a0d802cfa3be17ea433d35aab916b96e7">ATTRIBUTE_EXEC</a>, NULL, who_asked);
<a name="l01081"></a>01081          snprintf(exec_file, <span class="keyword">sizeof</span>(exec_file), <span class="stringliteral">&quot;/var/tmp/exec.%d%d.%ld&quot;</span>, (<span class="keywordtype">int</span>)now.tv_sec, (<span class="keywordtype">int</span>)now.tv_usec, (<span class="keywordtype">long</span>)pthread_self());
<a name="l01082"></a>01082          snprintf(cmd, <span class="keyword">sizeof</span>(cmd), <span class="stringliteral">&quot;%s &gt; %s 2&gt;&amp;1&quot;</span>, cur, exec_file);
<a name="l01083"></a>01083          <a class="code" href="app_8h.html#a9fb5cf0385848033ee3e98625e5f9784" title="Safely spawn an external program while closing file descriptors.">ast_safe_system</a>(cmd);
<a name="l01084"></a>01084          cur = exec_file;
<a name="l01085"></a>01085       } <span class="keywordflow">else</span> {
<a name="l01086"></a>01086          <span class="keywordflow">if</span> (!<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="config_8h.html#a2d5492e116eebd5075f247d21fb9db26a3b68640f31a2c5493459c159abee08ee">CONFIG_FLAG_NOCACHE</a>))
<a name="l01087"></a>01087             <a class="code" href="config_8c.html#a338df845b28007ea97c17c204fdf889c">config_cache_attribute</a>(configfile, <a class="code" href="config_8c.html#a6f6fe1fec746762842e740f4c7343d06afed88e6b3db380fd93dd724d1c90e3ce">ATTRIBUTE_INCLUDE</a>, cur, who_asked);
<a name="l01088"></a>01088          exec_file[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01089"></a>01089       }
<a name="l01090"></a>01090       <span class="comment">/* A #include */</span>
<a name="l01091"></a>01091       <span class="comment">/* record this inclusion */</span>
<a name="l01092"></a>01092       inclu = <a class="code" href="config_8h.html#ada3b4df6e8ca0a7408e66bd9761a1339">ast_include_new</a>(cfg, cfg-&gt;<a class="code" href="structast__config.html#a9889e4b9ce57e4055f9c11bacf89e50a">include_level</a> == 1 ? <span class="stringliteral">&quot;&quot;</span> : configfile, cur, !do_include, cur2, lineno, real_inclusion_name, <span class="keyword">sizeof</span>(real_inclusion_name));
<a name="l01093"></a>01093 
<a name="l01094"></a>01094       do_include = <a class="code" href="config_8h.html#a721d5cd60abda2bdd96838336dc09669">ast_config_internal_load</a>(cur, cfg, flags, real_inclusion_name, who_asked) ? 1 : 0;
<a name="l01095"></a>01095       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(exec_file))
<a name="l01096"></a>01096          unlink(exec_file);
<a name="l01097"></a>01097       <span class="keywordflow">if</span> (!do_include) {
<a name="l01098"></a>01098          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;The file &apos;%s&apos; was listed as a #include but it does not exist.\n&quot;</span>, cur);
<a name="l01099"></a>01099          <span class="keywordflow">return</span> -1;
<a name="l01100"></a>01100       }
<a name="l01101"></a>01101       <span class="comment">/* XXX otherwise what ? the default return is 0 anyways */</span>
<a name="l01102"></a>01102 
<a name="l01103"></a>01103    } <span class="keywordflow">else</span> {
<a name="l01104"></a>01104       <span class="comment">/* Just a line (variable = value) */</span>
<a name="l01105"></a>01105       <span class="keywordtype">int</span> <span class="keywordtype">object</span> = 0;
<a name="l01106"></a>01106       <span class="keywordflow">if</span> (!(*cat)) {
<a name="l01107"></a>01107          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,
<a name="l01108"></a>01108             <span class="stringliteral">&quot;parse error: No category context for line %d of %s\n&quot;</span>, lineno, configfile);
<a name="l01109"></a>01109          <span class="keywordflow">return</span> -1;
<a name="l01110"></a>01110       }
<a name="l01111"></a>01111       c = strchr(cur, <span class="charliteral">&apos;=&apos;</span>);
<a name="l01112"></a>01112 
<a name="l01113"></a>01113       <span class="keywordflow">if</span> (c &amp;&amp; c &gt; cur &amp;&amp; (*(c - 1) == <span class="charliteral">&apos;+&apos;</span>)) {
<a name="l01114"></a>01114          <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>, *replace = NULL;
<a name="l01115"></a>01115          <span class="keyword">struct </span><a class="code" href="structast__str.html" title="The descriptor of a dynamic string XXX storage will be optimized later if needed...">ast_str</a> **<a class="code" href="app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a> = <a class="code" href="threadstorage_8h.html#a9153839e218c987b2ae47cbd39ac1ab5" title="Retrieve thread storage.">ast_threadstorage_get</a>(&amp;<a class="code" href="config_8c.html#a9ac5c88e7facdcd3515f5ca81b39f7ce">appendbuf</a>, <span class="keyword">sizeof</span>(*str));
<a name="l01116"></a>01116 
<a name="l01117"></a>01117          <span class="keywordflow">if</span> (!str || !*str) {
<a name="l01118"></a>01118             <span class="keywordflow">return</span> -1;
<a name="l01119"></a>01119          }
<a name="l01120"></a>01120 
<a name="l01121"></a>01121          *(c - 1) = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01122"></a>01122          c++;
<a name="l01123"></a>01123          cur = <a class="code" href="strings_8h.html#aeb1c54e6e100c63176d8e22b0d5ca865" title="Strip leading/trailing whitespace from a string.">ast_strip</a>(cur);
<a name="l01124"></a>01124 
<a name="l01125"></a>01125          <span class="comment">/* Must iterate through category until we find last variable of same name (since there could be multiple) */</span>
<a name="l01126"></a>01126          <span class="keywordflow">for</span> (var = <a class="code" href="config_8h.html#a39040e0fe9c0bac870c10ad32afbfb17" title="given a pointer to a category, return the root variable. This is equivalent to ast_variable_browse()...">ast_category_first</a>(*cat); var; var = var-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l01127"></a>01127             <span class="keywordflow">if</span> (!strcmp(var-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, cur)) {
<a name="l01128"></a>01128                replace = var;
<a name="l01129"></a>01129             }
<a name="l01130"></a>01130          }
<a name="l01131"></a>01131 
<a name="l01132"></a>01132          <span class="keywordflow">if</span> (!replace) {
<a name="l01133"></a>01133             <span class="comment">/* Nothing to replace; just set a variable normally. */</span>
<a name="l01134"></a>01134             <span class="keywordflow">goto</span> set_new_variable;
<a name="l01135"></a>01135          }
<a name="l01136"></a>01136 
<a name="l01137"></a>01137          <a class="code" href="strings_8h.html#a4a3222f04f84c80a1d70f51e2dff00ea" title="Set a dynamic string using variable arguments.">ast_str_set</a>(str, 0, <span class="stringliteral">&quot;%s&quot;</span>, replace-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l01138"></a>01138          <a class="code" href="strings_8h.html#a85cd5a8ef499e39d22b4bfeb8b9a64f7" title="Append to a thread local dynamic string.">ast_str_append</a>(str, 0, <span class="stringliteral">&quot;%s&quot;</span>, c);
<a name="l01139"></a>01139          <a class="code" href="strings_8h.html#ae3e706d91ba9d9c15352733d89750135" title="Trims trailing whitespace characters from an ast_str string.">ast_str_trim_blanks</a>(*str);
<a name="l01140"></a>01140          <a class="code" href="config_8h.html#a61b77e9b543a66af82d7ac7d4d6b4ac8" title="Update variable value within a config.">ast_variable_update</a>(*cat, replace-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <a class="code" href="strings_8h.html#aba29020090d7b4238027c5746e7ad722" title="Gets a pointer to the first non-whitespace character in a string.">ast_skip_blanks</a>(<a class="code" href="strings_8h.html#a053bdfc229997a75f112bdd7b995e00b" title="Returns the string buffer within the ast_str buf.">ast_str_buffer</a>(*str)), replace-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keywordtype">object</span>);
<a name="l01141"></a>01141       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c) {
<a name="l01142"></a>01142          *c = 0;
<a name="l01143"></a>01143          c++;
<a name="l01144"></a>01144          <span class="comment">/* Ignore &gt; in =&gt; */</span>
<a name="l01145"></a>01145          <span class="keywordflow">if</span> (*c== <span class="charliteral">&apos;&gt;&apos;</span>) {
<a name="l01146"></a>01146             <span class="keywordtype">object</span> = 1;
<a name="l01147"></a>01147             c++;
<a name="l01148"></a>01148          }
<a name="l01149"></a>01149 set_new_variable:
<a name="l01150"></a>01150          <span class="keywordflow">if</span> ((v = <a class="code" href="config_8h.html#a08e94d96f459e7301a74daf32035423b">ast_variable_new</a>(<a class="code" href="strings_8h.html#aeb1c54e6e100c63176d8e22b0d5ca865" title="Strip leading/trailing whitespace from a string.">ast_strip</a>(cur), <a class="code" href="strings_8h.html#aeb1c54e6e100c63176d8e22b0d5ca865" title="Strip leading/trailing whitespace from a string.">ast_strip</a>(c), <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(suggested_include_file, cfg-&gt;<a class="code" href="structast__config.html#a9889e4b9ce57e4055f9c11bacf89e50a">include_level</a> == 1 ? <span class="stringliteral">&quot;&quot;</span> : configfile)))) {
<a name="l01151"></a>01151             v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a> = lineno;
<a name="l01152"></a>01152             v-&gt;<a class="code" href="structast__variable.html#a328cd221e75f4bd92e3ccf406f0d0441">object</a> = object;
<a name="l01153"></a>01153             *last_cat = 0;
<a name="l01154"></a>01154             *last_var = v;
<a name="l01155"></a>01155             <span class="comment">/* Put and reset comments */</span>
<a name="l01156"></a>01156             v-&gt;<a class="code" href="structast__variable.html#ade071f6f4a7bc0deb43008bd448ac46e">blanklines</a> = 0;
<a name="l01157"></a>01157             <a class="code" href="config_8h.html#a132ddbd39dd9d26395c410f7647f76db">ast_variable_append</a>(*cat, v);
<a name="l01158"></a>01158             <span class="comment">/* add comments */</span>
<a name="l01159"></a>01159             <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="config_8h.html#a2d5492e116eebd5075f247d21fb9db26abc16a274124ae96d43f8e52e344292c3">CONFIG_FLAG_WITHCOMMENTS</a>))
<a name="l01160"></a>01160                v-&gt;<a class="code" href="structast__variable.html#a80bf10e9bcb9c00a7a59051a77a620cf">precomments</a> = <a class="code" href="config_8c.html#a8131ec339c40205a5fae190516e347e1">ALLOC_COMMENT</a>(comment_buffer);
<a name="l01161"></a>01161             <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="config_8h.html#a2d5492e116eebd5075f247d21fb9db26abc16a274124ae96d43f8e52e344292c3">CONFIG_FLAG_WITHCOMMENTS</a>))
<a name="l01162"></a>01162                v-&gt;<a class="code" href="structast__variable.html#a6e4312227f9a7570709abf7f686f1cfe">sameline</a> = <a class="code" href="config_8c.html#a8131ec339c40205a5fae190516e347e1">ALLOC_COMMENT</a>(lline_buffer);
<a name="l01163"></a>01163             <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="config_8h.html#a2d5492e116eebd5075f247d21fb9db26abc16a274124ae96d43f8e52e344292c3">CONFIG_FLAG_WITHCOMMENTS</a>))
<a name="l01164"></a>01164                <a class="code" href="config_8c.html#a9dbb0c1c6f38088927df54ba55454a1b">CB_RESET</a>(comment_buffer, lline_buffer);
<a name="l01165"></a>01165             
<a name="l01166"></a>01166          } <span class="keywordflow">else</span> {
<a name="l01167"></a>01167             <span class="keywordflow">return</span> -1;
<a name="l01168"></a>01168          }
<a name="l01169"></a>01169       } <span class="keywordflow">else</span> {
<a name="l01170"></a>01170          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No &apos;=&apos; (equal sign) in line %d of %s\n&quot;</span>, lineno, configfile);
<a name="l01171"></a>01171       }
<a name="l01172"></a>01172    }
<a name="l01173"></a>01173    <span class="keywordflow">return</span> 0;
<a name="l01174"></a>01174 }
<a name="l01175"></a>01175 
<a name="l01176"></a><a class="code" href="config_8c.html#a7b05214a60b036caa88e41b843a3854f">01176</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *<a class="code" href="config_8c.html#a7b05214a60b036caa88e41b843a3854f">config_text_file_load</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *database, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="cdr__odbc_8c.html#a68d1e6e752f2cf81551fac543cae108a">table</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *filename, <span class="keyword">struct</span> <a class="code" href="structast__config.html">ast_config</a> *cfg, <span class="keyword">struct</span> <a class="code" href="structast__flags.html" title="Structure used to handle boolean flags.">ast_flags</a> flags, <span class="keyword">const</span> <span class="keywordtype">char</span> *suggested_include_file, <span class="keyword">const</span> <span class="keywordtype">char</span> *who_asked)
<a name="l01177"></a>01177 {
<a name="l01178"></a>01178    <span class="keywordtype">char</span> fn[256];
<a name="l01179"></a>01179 <span class="preprocessor">#if defined(LOW_MEMORY)</span>
<a name="l01180"></a>01180 <span class="preprocessor"></span>   <span class="keywordtype">char</span> <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[512];
<a name="l01181"></a>01181 <span class="preprocessor">#else</span>
<a name="l01182"></a>01182 <span class="preprocessor"></span>   <span class="keywordtype">char</span> buf[8192];
<a name="l01183"></a>01183 <span class="preprocessor">#endif</span>
<a name="l01184"></a>01184 <span class="preprocessor"></span>   <span class="keywordtype">char</span> *new_buf, *comment_p, *process_buf;
<a name="l01185"></a>01185    FILE *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l01186"></a>01186    <span class="keywordtype">int</span> lineno=0;
<a name="l01187"></a>01187    <span class="keywordtype">int</span> <a class="code" href="ael__lex_8c.html#a43be22b7a1b528eaf759e034ec581543">comment</a> = 0, nest[<a class="code" href="config_8c.html#a10b55e9c454317681d0f02637b7d5d5f">MAX_NESTED_COMMENTS</a>];
<a name="l01188"></a>01188    <span class="keyword">struct </span>ast_category *cat = NULL;
<a name="l01189"></a>01189    <span class="keywordtype">int</span> count = 0;
<a name="l01190"></a>01190    <span class="keyword">struct </span>stat statbuf;
<a name="l01191"></a>01191    <span class="keyword">struct </span>cache_file_mtime *cfmtime = NULL;
<a name="l01192"></a>01192    <span class="keyword">struct </span><a class="code" href="structcache__file__include.html" title="Hold the mtime for config files, so if we don&amp;#39;t need to reread our config, don&amp;#39;t...">cache_file_include</a> *cfinclude;
<a name="l01193"></a>01193    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *last_var = 0;
<a name="l01194"></a>01194    <span class="keyword">struct </span>ast_category *last_cat = 0;<span class="comment"></span>
<a name="l01195"></a>01195 <span class="comment">   /*! Growable string buffer */</span>
<a name="l01196"></a>01196    <span class="keyword">struct </span><a class="code" href="structast__str.html" title="The descriptor of a dynamic string XXX storage will be optimized later if needed...">ast_str</a> *comment_buffer = NULL; <span class="comment">/*!&lt; this will be a comment collector.*/</span>
<a name="l01197"></a>01197    <span class="keyword">struct </span><a class="code" href="structast__str.html" title="The descriptor of a dynamic string XXX storage will be optimized later if needed...">ast_str</a> *lline_buffer = NULL;   <span class="comment">/*!&lt; A buffer for stuff behind the ; */</span>
<a name="l01198"></a>01198 
<a name="l01199"></a>01199    <span class="keywordflow">if</span> (cfg)
<a name="l01200"></a>01200       cat = <a class="code" href="config_8h.html#a6884d439424ba2be31ef259213da4e8b" title="Retrieve the current category name being built. API for backend configuration engines...">ast_config_get_current_category</a>(cfg);
<a name="l01201"></a>01201 
<a name="l01202"></a>01202    <span class="keywordflow">if</span> (filename[0] == <span class="charliteral">&apos;/&apos;</span>) {
<a name="l01203"></a>01203       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(fn, filename, <span class="keyword">sizeof</span>(fn));
<a name="l01204"></a>01204    } <span class="keywordflow">else</span> {
<a name="l01205"></a>01205       snprintf(fn, <span class="keyword">sizeof</span>(fn), <span class="stringliteral">&quot;%s/%s&quot;</span>, <a class="code" href="paths_8h.html#a7d3836e5581e433c9f5edd30300cc187">ast_config_AST_CONFIG_DIR</a>, filename);
<a name="l01206"></a>01206    }
<a name="l01207"></a>01207 
<a name="l01208"></a>01208    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="config_8h.html#a2d5492e116eebd5075f247d21fb9db26abc16a274124ae96d43f8e52e344292c3">CONFIG_FLAG_WITHCOMMENTS</a>)) {
<a name="l01209"></a>01209       comment_buffer = <a class="code" href="strings_8h.html#a8ec37e4acb6ecb20eb6f6edd1141cd76" title="Create a malloc&amp;#39;ed dynamic length string.">ast_str_create</a>(<a class="code" href="config_8c.html#a4747dd52513b0f70eb469de949ac8e9a">CB_SIZE</a>);
<a name="l01210"></a>01210       <span class="keywordflow">if</span> (comment_buffer)
<a name="l01211"></a>01211          lline_buffer = <a class="code" href="strings_8h.html#a8ec37e4acb6ecb20eb6f6edd1141cd76" title="Create a malloc&amp;#39;ed dynamic length string.">ast_str_create</a>(<a class="code" href="config_8c.html#a4747dd52513b0f70eb469de949ac8e9a">CB_SIZE</a>);
<a name="l01212"></a>01212       <span class="keywordflow">if</span> (!lline_buffer) {
<a name="l01213"></a>01213          <span class="keywordflow">if</span> (comment_buffer)
<a name="l01214"></a>01214             <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(comment_buffer);
<a name="l01215"></a>01215          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to initialize the comment buffer!\n&quot;</span>);
<a name="l01216"></a>01216          <span class="keywordflow">return</span> NULL;
<a name="l01217"></a>01217       }
<a name="l01218"></a>01218    }
<a name="l01219"></a>01219 <span class="preprocessor">#ifdef AST_INCLUDE_GLOB</span>
<a name="l01220"></a>01220 <span class="preprocessor"></span>   {
<a name="l01221"></a>01221       <span class="keywordtype">int</span> glob_ret;
<a name="l01222"></a>01222       glob_t globbuf;
<a name="l01223"></a>01223       globbuf.gl_offs = 0; <span class="comment">/* initialize it to silence gcc */</span>
<a name="l01224"></a>01224       glob_ret = glob(fn, <a class="code" href="compat_8h.html#aaac7e52043ca7fcf7113eaaf95f6e3b7">MY_GLOB_FLAGS</a>, NULL, &amp;globbuf);
<a name="l01225"></a>01225       <span class="keywordflow">if</span> (glob_ret == GLOB_NOSPACE)
<a name="l01226"></a>01226          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,
<a name="l01227"></a>01227             <span class="stringliteral">&quot;Glob Expansion of pattern &apos;%s&apos; failed: Not enough memory\n&quot;</span>, fn);
<a name="l01228"></a>01228       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (glob_ret  == <a class="code" href="ael__lex_8c.html#ab5de50cedafa21283878657d05fb2ba8">GLOB_ABORTED</a>)
<a name="l01229"></a>01229          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,
<a name="l01230"></a>01230             <span class="stringliteral">&quot;Glob Expansion of pattern &apos;%s&apos; failed: Read error\n&quot;</span>, fn);
<a name="l01231"></a>01231       <span class="keywordflow">else</span>  {
<a name="l01232"></a>01232          <span class="comment">/* loop over expanded files */</span>
<a name="l01233"></a>01233          <span class="keywordtype">int</span> i;
<a name="l01234"></a>01234          <span class="keywordflow">for</span> (i=0; i&lt;globbuf.gl_pathc; i++) {
<a name="l01235"></a>01235             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(fn, globbuf.gl_pathv[i], <span class="keyword">sizeof</span>(fn));
<a name="l01236"></a>01236 <span class="preprocessor">#endif</span>
<a name="l01237"></a>01237 <span class="preprocessor"></span>   <span class="comment">/*</span>
<a name="l01238"></a>01238 <span class="comment">    * The following is not a loop, but just a convenient way to define a block</span>
<a name="l01239"></a>01239 <span class="comment">    * (using do { } while(0) ), and be able to exit from it with &apos;continue&apos;</span>
<a name="l01240"></a>01240 <span class="comment">    * or &apos;break&apos; in case of errors. Nice trick.</span>
<a name="l01241"></a>01241 <span class="comment">    */</span>
<a name="l01242"></a>01242    <span class="keywordflow">do</span> {
<a name="l01243"></a>01243       <span class="keywordflow">if</span> (stat(fn, &amp;statbuf))
<a name="l01244"></a>01244          <span class="keywordflow">continue</span>;
<a name="l01245"></a>01245 
<a name="l01246"></a>01246       <span class="keywordflow">if</span> (!S_ISREG(statbuf.st_mode)) {
<a name="l01247"></a>01247          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;&apos;%s&apos; is not a regular file, ignoring\n&quot;</span>, fn);
<a name="l01248"></a>01248          <span class="keywordflow">continue</span>;
<a name="l01249"></a>01249       }
<a name="l01250"></a>01250 
<a name="l01251"></a>01251       <span class="keywordflow">if</span> (!<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="config_8h.html#a2d5492e116eebd5075f247d21fb9db26a3b68640f31a2c5493459c159abee08ee">CONFIG_FLAG_NOCACHE</a>)) {
<a name="l01252"></a>01252          <span class="comment">/* Find our cached entry for this configuration file */</span>
<a name="l01253"></a>01253          <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;<a class="code" href="structcfmtime__head.html">cfmtime_head</a>);
<a name="l01254"></a>01254          <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="structcfmtime__head.html">cfmtime_head</a>, cfmtime, list) {
<a name="l01255"></a>01255             <span class="keywordflow">if</span> (!strcmp(cfmtime-&gt;<a class="code" href="structcache__file__mtime.html#afae8c108f5d360038fa8b099eb4ab2f3">filename</a>, fn) &amp;&amp; !strcmp(cfmtime-&gt;<a class="code" href="structcache__file__mtime.html#ac1a3dfe5c9e5cf85abc41b8ca002ef7f">who_asked</a>, who_asked))
<a name="l01256"></a>01256                <span class="keywordflow">break</span>;
<a name="l01257"></a>01257          }
<a name="l01258"></a>01258          <span class="keywordflow">if</span> (!cfmtime) {
<a name="l01259"></a>01259             cfmtime = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*cfmtime) + strlen(fn) + 1 + strlen(who_asked) + 1);
<a name="l01260"></a>01260             <span class="keywordflow">if</span> (!cfmtime)
<a name="l01261"></a>01261                <span class="keywordflow">continue</span>;
<a name="l01262"></a>01262             <a class="code" href="linkedlists_8h.html#a6f42d3bf45cc9af6f794d9d1cf8c45ca" title="Initializes a list head structure.">AST_LIST_HEAD_INIT</a>(&amp;cfmtime-&gt;<a class="code" href="structcache__file__mtime.html#ad9a9f7cdb9041a1f0ae0c2babece8142">includes</a>);
<a name="l01263"></a>01263             strcpy(cfmtime-&gt;<a class="code" href="structcache__file__mtime.html#afae8c108f5d360038fa8b099eb4ab2f3">filename</a>, fn);
<a name="l01264"></a>01264             cfmtime-&gt;<a class="code" href="structcache__file__mtime.html#ac1a3dfe5c9e5cf85abc41b8ca002ef7f">who_asked</a> = cfmtime-&gt;<a class="code" href="structcache__file__mtime.html#afae8c108f5d360038fa8b099eb4ab2f3">filename</a> + strlen(fn) + 1;
<a name="l01265"></a>01265             strcpy(cfmtime-&gt;<a class="code" href="structcache__file__mtime.html#ac1a3dfe5c9e5cf85abc41b8ca002ef7f">who_asked</a>, who_asked);
<a name="l01266"></a>01266             <span class="comment">/* Note that the file mtime is initialized to 0, i.e. 1970 */</span>
<a name="l01267"></a>01267             <a class="code" href="linkedlists_8h.html#a17c99b4db7d6477c4a8e109617129218" title="Inserts a list entry into a alphabetically sorted list.">AST_LIST_INSERT_SORTALPHA</a>(&amp;<a class="code" href="structcfmtime__head.html">cfmtime_head</a>, cfmtime, list, filename);
<a name="l01268"></a>01268          }
<a name="l01269"></a>01269       }
<a name="l01270"></a>01270 
<a name="l01271"></a>01271       <span class="keywordflow">if</span> (cfmtime &amp;&amp; (!cfmtime-&gt;<a class="code" href="structcache__file__mtime.html#a71b2199618baf99c5320948cd63ca39a">has_exec</a>) &amp;&amp; (cfmtime-&gt;<a class="code" href="structcache__file__mtime.html#a4a2d3a53446ef3217564ced73636f9bf">mtime</a> == statbuf.st_mtime) &amp;&amp; <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="config_8h.html#a2d5492e116eebd5075f247d21fb9db26afa887389dc380bbdcffb65fec379f037">CONFIG_FLAG_FILEUNCHANGED</a>)) {
<a name="l01272"></a>01272          <span class="comment">/* File is unchanged, what about the (cached) includes (if any)? */</span>
<a name="l01273"></a>01273          <span class="keywordtype">int</span> unchanged = 1;
<a name="l01274"></a>01274          <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;cfmtime-&gt;<a class="code" href="structcache__file__mtime.html#ad9a9f7cdb9041a1f0ae0c2babece8142">includes</a>, cfinclude, list) {
<a name="l01275"></a>01275             <span class="comment">/* We must glob here, because if we did not, then adding a file to globbed directory would</span>
<a name="l01276"></a>01276 <span class="comment">             * incorrectly cause no reload to be necessary. */</span>
<a name="l01277"></a>01277             <span class="keywordtype">char</span> fn2[256];
<a name="l01278"></a>01278 <span class="preprocessor">#ifdef AST_INCLUDE_GLOB</span>
<a name="l01279"></a>01279 <span class="preprocessor"></span>            <span class="keywordtype">int</span> glob_return;
<a name="l01280"></a>01280             glob_t glob_buf = { .gl_offs = 0 };
<a name="l01281"></a>01281             glob_return = glob(cfinclude-&gt;<a class="code" href="structcache__file__include.html#abdbb2af142a7c931ec450a5224e6fd76">include</a>, <a class="code" href="compat_8h.html#aaac7e52043ca7fcf7113eaaf95f6e3b7">MY_GLOB_FLAGS</a>, NULL, &amp;glob_buf);
<a name="l01282"></a>01282             <span class="comment">/* On error, we reparse */</span>
<a name="l01283"></a>01283             <span class="keywordflow">if</span> (glob_return == GLOB_NOSPACE || glob_return  == <a class="code" href="ael__lex_8c.html#ab5de50cedafa21283878657d05fb2ba8">GLOB_ABORTED</a>)
<a name="l01284"></a>01284                unchanged = 0;
<a name="l01285"></a>01285             <span class="keywordflow">else</span>  {
<a name="l01286"></a>01286                <span class="comment">/* loop over expanded files */</span>
<a name="l01287"></a>01287                <span class="keywordtype">int</span> j;
<a name="l01288"></a>01288                <span class="keywordflow">for</span> (j = 0; j &lt; glob_buf.gl_pathc; j++) {
<a name="l01289"></a>01289                   <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(fn2, glob_buf.gl_pathv[j], <span class="keyword">sizeof</span>(fn2));
<a name="l01290"></a>01290 <span class="preprocessor">#else</span>
<a name="l01291"></a>01291 <span class="preprocessor"></span>                  <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(fn2, cfinclude-&gt;<a class="code" href="structcache__file__include.html#abdbb2af142a7c931ec450a5224e6fd76">include</a>);
<a name="l01292"></a>01292 <span class="preprocessor">#endif</span>
<a name="l01293"></a>01293 <span class="preprocessor"></span>                  <span class="keywordflow">if</span> (<a class="code" href="config_8c.html#a7b05214a60b036caa88e41b843a3854f">config_text_file_load</a>(NULL, NULL, fn2, NULL, flags, <span class="stringliteral">&quot;&quot;</span>, who_asked) == NULL) {
<a name="l01294"></a>01294                      <span class="comment">/* that second-to-last field needs to be looked at in this case... TODO */</span>
<a name="l01295"></a>01295                      unchanged = 0;
<a name="l01296"></a>01296                      <span class="comment">/* One change is enough to short-circuit and reload the whole shebang */</span>
<a name="l01297"></a>01297                      <span class="keywordflow">break</span>;
<a name="l01298"></a>01298                   }
<a name="l01299"></a>01299 <span class="preprocessor">#ifdef AST_INCLUDE_GLOB</span>
<a name="l01300"></a>01300 <span class="preprocessor"></span>               }
<a name="l01301"></a>01301             }
<a name="l01302"></a>01302 <span class="preprocessor">#endif</span>
<a name="l01303"></a>01303 <span class="preprocessor"></span>         }
<a name="l01304"></a>01304 
<a name="l01305"></a>01305          <span class="keywordflow">if</span> (unchanged) {
<a name="l01306"></a>01306             <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="structcfmtime__head.html">cfmtime_head</a>);
<a name="l01307"></a>01307             <span class="keywordflow">return</span> <a class="code" href="config_8h.html#a846844eb2c4eb44554445936b3770711">CONFIG_STATUS_FILEUNCHANGED</a>;
<a name="l01308"></a>01308          }
<a name="l01309"></a>01309       }
<a name="l01310"></a>01310       <span class="keywordflow">if</span> (!<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="config_8h.html#a2d5492e116eebd5075f247d21fb9db26a3b68640f31a2c5493459c159abee08ee">CONFIG_FLAG_NOCACHE</a>))
<a name="l01311"></a>01311          <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="structcfmtime__head.html">cfmtime_head</a>);
<a name="l01312"></a>01312 
<a name="l01313"></a>01313       <span class="comment">/* If cfg is NULL, then we just want an answer */</span>
<a name="l01314"></a>01314       <span class="keywordflow">if</span> (cfg == NULL)
<a name="l01315"></a>01315          <span class="keywordflow">return</span> NULL;
<a name="l01316"></a>01316 
<a name="l01317"></a>01317       <span class="keywordflow">if</span> (cfmtime)
<a name="l01318"></a>01318          cfmtime-&gt;<a class="code" href="structcache__file__mtime.html#a4a2d3a53446ef3217564ced73636f9bf">mtime</a> = statbuf.st_mtime;
<a name="l01319"></a>01319 
<a name="l01320"></a>01320       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Parsing &apos;%s&apos;: &quot;</span>, fn);
<a name="l01321"></a>01321          fflush(stdout);
<a name="l01322"></a>01322       <span class="keywordflow">if</span> (!(f = fopen(fn, <span class="stringliteral">&quot;r&quot;</span>))) {
<a name="l01323"></a>01323          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;No file to parse: %s\n&quot;</span>, fn);
<a name="l01324"></a>01324          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Not found (%s)\n&quot;</span>, strerror(<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l01325"></a>01325          <span class="keywordflow">continue</span>;
<a name="l01326"></a>01326       }
<a name="l01327"></a>01327       count++;
<a name="l01328"></a>01328       <span class="comment">/* If we get to this point, then we&apos;re loading regardless */</span>
<a name="l01329"></a>01329       <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(&amp;flags, <a class="code" href="config_8h.html#a2d5492e116eebd5075f247d21fb9db26afa887389dc380bbdcffb65fec379f037">CONFIG_FLAG_FILEUNCHANGED</a>);
<a name="l01330"></a>01330       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Parsing %s\n&quot;</span>, fn);
<a name="l01331"></a>01331       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Found\n&quot;</span>);
<a name="l01332"></a>01332       <span class="keywordflow">while</span> (!feof(f)) {
<a name="l01333"></a>01333          lineno++;
<a name="l01334"></a>01334          <span class="keywordflow">if</span> (fgets(buf, <span class="keyword">sizeof</span>(buf), f)) {
<a name="l01335"></a>01335             <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="config_8h.html#a2d5492e116eebd5075f247d21fb9db26abc16a274124ae96d43f8e52e344292c3">CONFIG_FLAG_WITHCOMMENTS</a>) &amp;&amp; lline_buffer &amp;&amp; <a class="code" href="strings_8h.html#a99409c17a1d20e1c3dc00039b7925a2d" title="Returns the current length of the string stored within buf.">ast_str_strlen</a>(lline_buffer)) {
<a name="l01336"></a>01336                <a class="code" href="config_8c.html#afcda43b41847d0c455e05a9fdc0f76c5">CB_ADD</a>(&amp;comment_buffer, <a class="code" href="strings_8h.html#a053bdfc229997a75f112bdd7b995e00b" title="Returns the string buffer within the ast_str buf.">ast_str_buffer</a>(lline_buffer));       <span class="comment">/* add the current lline buffer to the comment buffer */</span>
<a name="l01337"></a>01337                <a class="code" href="strings_8h.html#a7820deea616cbb2e28f16d518de91c80" title="Reset the content of a dynamic string. Useful before a series of ast_str_append.">ast_str_reset</a>(lline_buffer);        <span class="comment">/* erase the lline buffer */</span>
<a name="l01338"></a>01338             }
<a name="l01339"></a>01339             
<a name="l01340"></a>01340             new_buf = buf;
<a name="l01341"></a>01341             <span class="keywordflow">if</span> (comment) 
<a name="l01342"></a>01342                process_buf = NULL;
<a name="l01343"></a>01343             <span class="keywordflow">else</span>
<a name="l01344"></a>01344                process_buf = buf;
<a name="l01345"></a>01345             
<a name="l01346"></a>01346             <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="config_8h.html#a2d5492e116eebd5075f247d21fb9db26abc16a274124ae96d43f8e52e344292c3">CONFIG_FLAG_WITHCOMMENTS</a>) &amp;&amp; comment_buffer &amp;&amp; <a class="code" href="strings_8h.html#a99409c17a1d20e1c3dc00039b7925a2d" title="Returns the current length of the string stored within buf.">ast_str_strlen</a>(comment_buffer) &amp;&amp; (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(buf) || strlen(buf) == strspn(buf,<span class="stringliteral">&quot; \t\n\r&quot;</span>))) {
<a name="l01347"></a>01347                <span class="comment">/* blank line? really? Can we add it to an existing comment and maybe preserve inter- and post- comment spacing? */</span>
<a name="l01348"></a>01348                <a class="code" href="config_8c.html#afcda43b41847d0c455e05a9fdc0f76c5">CB_ADD</a>(&amp;comment_buffer, <span class="stringliteral">&quot;\n&quot;</span>);       <span class="comment">/* add a newline to the comment buffer */</span>
<a name="l01349"></a>01349                <span class="keywordflow">continue</span>; <span class="comment">/* go get a new line, then */</span>
<a name="l01350"></a>01350             }
<a name="l01351"></a>01351             
<a name="l01352"></a>01352             <span class="keywordflow">while</span> ((comment_p = strchr(new_buf, <a class="code" href="config_8c.html#aaf9102a2769ad8474a6819249647e87e">COMMENT_META</a>))) {
<a name="l01353"></a>01353                <span class="keywordflow">if</span> ((comment_p &gt; new_buf) &amp;&amp; (*(comment_p - 1) == <span class="charliteral">&apos;\\&apos;</span>)) {
<a name="l01354"></a>01354                   <span class="comment">/* Escaped semicolons aren&apos;t comments. */</span>
<a name="l01355"></a>01355                   new_buf = comment_p + 1;
<a name="l01356"></a>01356                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (comment_p[1] == <a class="code" href="config_8c.html#a52406a72fd0a2b4c0ea8e21e64083e3c">COMMENT_TAG</a> &amp;&amp; comment_p[2] == <a class="code" href="config_8c.html#a52406a72fd0a2b4c0ea8e21e64083e3c">COMMENT_TAG</a> &amp;&amp; (comment_p[3] != <span class="charliteral">&apos;-&apos;</span>)) {
<a name="l01357"></a>01357                   <span class="comment">/* Meta-Comment start detected &quot;;--&quot; */</span>
<a name="l01358"></a>01358                   <span class="keywordflow">if</span> (comment &lt; <a class="code" href="config_8c.html#a10b55e9c454317681d0f02637b7d5d5f">MAX_NESTED_COMMENTS</a>) {
<a name="l01359"></a>01359                      *comment_p = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01360"></a>01360                      new_buf = comment_p + 3;
<a name="l01361"></a>01361                      comment++;
<a name="l01362"></a>01362                      nest[comment-1] = lineno;
<a name="l01363"></a>01363                   } <span class="keywordflow">else</span> {
<a name="l01364"></a>01364                      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Maximum nest limit of %d reached.\n&quot;</span>, <a class="code" href="config_8c.html#a10b55e9c454317681d0f02637b7d5d5f">MAX_NESTED_COMMENTS</a>);
<a name="l01365"></a>01365                   }
<a name="l01366"></a>01366                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((comment_p &gt;= new_buf + 2) &amp;&amp;
<a name="l01367"></a>01367                      (*(comment_p - 1) == <a class="code" href="config_8c.html#a52406a72fd0a2b4c0ea8e21e64083e3c">COMMENT_TAG</a>) &amp;&amp;
<a name="l01368"></a>01368                      (*(comment_p - 2) == <a class="code" href="config_8c.html#a52406a72fd0a2b4c0ea8e21e64083e3c">COMMENT_TAG</a>)) {
<a name="l01369"></a>01369                   <span class="comment">/* Meta-Comment end detected */</span>
<a name="l01370"></a>01370                   comment--;
<a name="l01371"></a>01371                   new_buf = comment_p + 1;
<a name="l01372"></a>01372                   <span class="keywordflow">if</span> (!comment) {
<a name="l01373"></a>01373                      <span class="comment">/* Back to non-comment now */</span>
<a name="l01374"></a>01374                      <span class="keywordflow">if</span> (process_buf) {
<a name="l01375"></a>01375                         <span class="comment">/* Actually have to move what&apos;s left over the top, then continue */</span>
<a name="l01376"></a>01376                         <span class="keywordtype">char</span> *oldptr;
<a name="l01377"></a>01377                         oldptr = process_buf + strlen(process_buf);
<a name="l01378"></a>01378                         <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="config_8h.html#a2d5492e116eebd5075f247d21fb9db26abc16a274124ae96d43f8e52e344292c3">CONFIG_FLAG_WITHCOMMENTS</a>)) {
<a name="l01379"></a>01379                            <a class="code" href="config_8c.html#afcda43b41847d0c455e05a9fdc0f76c5">CB_ADD</a>(&amp;comment_buffer, <span class="stringliteral">&quot;;&quot;</span>);
<a name="l01380"></a>01380                            <a class="code" href="config_8c.html#ac9549309749e5a9acd3a68f1e8ab02bc">CB_ADD_LEN</a>(&amp;comment_buffer, oldptr+1, new_buf-oldptr-1);
<a name="l01381"></a>01381                         }
<a name="l01382"></a>01382                         
<a name="l01383"></a>01383                         memmove(oldptr, new_buf, strlen(new_buf) + 1);
<a name="l01384"></a>01384                         new_buf = oldptr;
<a name="l01385"></a>01385                      } <span class="keywordflow">else</span>
<a name="l01386"></a>01386                         process_buf = new_buf;
<a name="l01387"></a>01387                   }
<a name="l01388"></a>01388                } <span class="keywordflow">else</span> {
<a name="l01389"></a>01389                   <span class="keywordflow">if</span> (!comment) {
<a name="l01390"></a>01390                      <span class="comment">/* If ; is found, and we are not nested in a comment, </span>
<a name="l01391"></a>01391 <span class="comment">                        we immediately stop all comment processing */</span>
<a name="l01392"></a>01392                      <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="config_8h.html#a2d5492e116eebd5075f247d21fb9db26abc16a274124ae96d43f8e52e344292c3">CONFIG_FLAG_WITHCOMMENTS</a>)) {
<a name="l01393"></a>01393                         <a class="code" href="config_8c.html#afcda43b41847d0c455e05a9fdc0f76c5">CB_ADD</a>(&amp;lline_buffer, comment_p);
<a name="l01394"></a>01394                      }
<a name="l01395"></a>01395                      *comment_p = <span class="charliteral">&apos;\0&apos;</span>; 
<a name="l01396"></a>01396                      new_buf = comment_p;
<a name="l01397"></a>01397                   } <span class="keywordflow">else</span>
<a name="l01398"></a>01398                      new_buf = comment_p + 1;
<a name="l01399"></a>01399                }
<a name="l01400"></a>01400             }
<a name="l01401"></a>01401             <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="config_8h.html#a2d5492e116eebd5075f247d21fb9db26abc16a274124ae96d43f8e52e344292c3">CONFIG_FLAG_WITHCOMMENTS</a>) &amp;&amp; comment &amp;&amp; !process_buf ) {
<a name="l01402"></a>01402                <a class="code" href="config_8c.html#afcda43b41847d0c455e05a9fdc0f76c5">CB_ADD</a>(&amp;comment_buffer, buf);  <span class="comment">/* the whole line is a comment, store it */</span>
<a name="l01403"></a>01403             }
<a name="l01404"></a>01404             
<a name="l01405"></a>01405             <span class="keywordflow">if</span> (process_buf) {
<a name="l01406"></a>01406                <span class="keywordtype">char</span> *buffer = <a class="code" href="strings_8h.html#aeb1c54e6e100c63176d8e22b0d5ca865" title="Strip leading/trailing whitespace from a string.">ast_strip</a>(process_buf);
<a name="l01407"></a>01407                <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(buffer)) {
<a name="l01408"></a>01408                   <span class="keywordflow">if</span> (<a class="code" href="config_8c.html#ab8e1da65b4704abbb80387744cc712ae" title="parse one line in the configuration.">process_text_line</a>(cfg, &amp;cat, buffer, lineno, fn, flags, comment_buffer, lline_buffer, suggested_include_file, &amp;last_cat, &amp;last_var, who_asked)) {
<a name="l01409"></a>01409                      cfg = <a class="code" href="config_8h.html#a8d1a63cdf2c7aff22a77b6e75d93b377">CONFIG_STATUS_FILEINVALID</a>;
<a name="l01410"></a>01410                      <span class="keywordflow">break</span>;
<a name="l01411"></a>01411                   }
<a name="l01412"></a>01412                }
<a name="l01413"></a>01413             }
<a name="l01414"></a>01414          }
<a name="l01415"></a>01415       }
<a name="l01416"></a>01416       <span class="comment">/* end of file-- anything in a comment buffer? */</span>
<a name="l01417"></a>01417       <span class="keywordflow">if</span> (last_cat) {
<a name="l01418"></a>01418          <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="config_8h.html#a2d5492e116eebd5075f247d21fb9db26abc16a274124ae96d43f8e52e344292c3">CONFIG_FLAG_WITHCOMMENTS</a>) &amp;&amp; comment_buffer &amp;&amp; <a class="code" href="strings_8h.html#a99409c17a1d20e1c3dc00039b7925a2d" title="Returns the current length of the string stored within buf.">ast_str_strlen</a>(comment_buffer)) {
<a name="l01419"></a>01419             <span class="keywordflow">if</span> (lline_buffer &amp;&amp; <a class="code" href="strings_8h.html#a99409c17a1d20e1c3dc00039b7925a2d" title="Returns the current length of the string stored within buf.">ast_str_strlen</a>(lline_buffer)) {
<a name="l01420"></a>01420                <a class="code" href="config_8c.html#afcda43b41847d0c455e05a9fdc0f76c5">CB_ADD</a>(&amp;comment_buffer, <a class="code" href="strings_8h.html#a053bdfc229997a75f112bdd7b995e00b" title="Returns the string buffer within the ast_str buf.">ast_str_buffer</a>(lline_buffer));       <span class="comment">/* add the current lline buffer to the comment buffer */</span>
<a name="l01421"></a>01421                <a class="code" href="strings_8h.html#a7820deea616cbb2e28f16d518de91c80" title="Reset the content of a dynamic string. Useful before a series of ast_str_append.">ast_str_reset</a>(lline_buffer);        <span class="comment">/* erase the lline buffer */</span>
<a name="l01422"></a>01422             }
<a name="l01423"></a>01423             last_cat-&gt;<a class="code" href="structast__category.html#ab09dbd177767543015efa3ba28fab03a">trailing</a> = <a class="code" href="config_8c.html#a8131ec339c40205a5fae190516e347e1">ALLOC_COMMENT</a>(comment_buffer);
<a name="l01424"></a>01424          }
<a name="l01425"></a>01425       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (last_var) {
<a name="l01426"></a>01426          <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="config_8h.html#a2d5492e116eebd5075f247d21fb9db26abc16a274124ae96d43f8e52e344292c3">CONFIG_FLAG_WITHCOMMENTS</a>) &amp;&amp; comment_buffer &amp;&amp; <a class="code" href="strings_8h.html#a99409c17a1d20e1c3dc00039b7925a2d" title="Returns the current length of the string stored within buf.">ast_str_strlen</a>(comment_buffer)) {
<a name="l01427"></a>01427             <span class="keywordflow">if</span> (lline_buffer &amp;&amp; <a class="code" href="strings_8h.html#a99409c17a1d20e1c3dc00039b7925a2d" title="Returns the current length of the string stored within buf.">ast_str_strlen</a>(lline_buffer)) {
<a name="l01428"></a>01428                <a class="code" href="config_8c.html#afcda43b41847d0c455e05a9fdc0f76c5">CB_ADD</a>(&amp;comment_buffer, <a class="code" href="strings_8h.html#a053bdfc229997a75f112bdd7b995e00b" title="Returns the string buffer within the ast_str buf.">ast_str_buffer</a>(lline_buffer));       <span class="comment">/* add the current lline buffer to the comment buffer */</span>
<a name="l01429"></a>01429                <a class="code" href="strings_8h.html#a7820deea616cbb2e28f16d518de91c80" title="Reset the content of a dynamic string. Useful before a series of ast_str_append.">ast_str_reset</a>(lline_buffer);        <span class="comment">/* erase the lline buffer */</span>
<a name="l01430"></a>01430             }
<a name="l01431"></a>01431             last_var-&gt;<a class="code" href="structast__variable.html#ab09dbd177767543015efa3ba28fab03a">trailing</a> = <a class="code" href="config_8c.html#a8131ec339c40205a5fae190516e347e1">ALLOC_COMMENT</a>(comment_buffer);
<a name="l01432"></a>01432          }
<a name="l01433"></a>01433       } <span class="keywordflow">else</span> {
<a name="l01434"></a>01434          <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="config_8h.html#a2d5492e116eebd5075f247d21fb9db26abc16a274124ae96d43f8e52e344292c3">CONFIG_FLAG_WITHCOMMENTS</a>) &amp;&amp; comment_buffer &amp;&amp; <a class="code" href="strings_8h.html#a99409c17a1d20e1c3dc00039b7925a2d" title="Returns the current length of the string stored within buf.">ast_str_strlen</a>(comment_buffer)) {
<a name="l01435"></a>01435             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Nothing to attach comments to, discarded: %s\n&quot;</span>, <a class="code" href="strings_8h.html#a053bdfc229997a75f112bdd7b995e00b" title="Returns the string buffer within the ast_str buf.">ast_str_buffer</a>(comment_buffer));
<a name="l01436"></a>01436          }
<a name="l01437"></a>01437       }
<a name="l01438"></a>01438       <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="config_8h.html#a2d5492e116eebd5075f247d21fb9db26abc16a274124ae96d43f8e52e344292c3">CONFIG_FLAG_WITHCOMMENTS</a>))
<a name="l01439"></a>01439          <a class="code" href="config_8c.html#a9dbb0c1c6f38088927df54ba55454a1b">CB_RESET</a>(comment_buffer, lline_buffer);
<a name="l01440"></a>01440 
<a name="l01441"></a>01441       fclose(f);
<a name="l01442"></a>01442    } <span class="keywordflow">while</span> (0);
<a name="l01443"></a>01443    <span class="keywordflow">if</span> (comment) {
<a name="l01444"></a>01444       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,<span class="stringliteral">&quot;Unterminated comment detected beginning on line %d\n&quot;</span>, nest[comment - 1]);
<a name="l01445"></a>01445    }
<a name="l01446"></a>01446 <span class="preprocessor">#ifdef AST_INCLUDE_GLOB</span>
<a name="l01447"></a>01447 <span class="preprocessor"></span>               <span class="keywordflow">if</span> (cfg == NULL || cfg == <a class="code" href="config_8h.html#a846844eb2c4eb44554445936b3770711">CONFIG_STATUS_FILEUNCHANGED</a> || cfg == <a class="code" href="config_8h.html#a8d1a63cdf2c7aff22a77b6e75d93b377">CONFIG_STATUS_FILEINVALID</a>) {
<a name="l01448"></a>01448                   <span class="keywordflow">break</span>;
<a name="l01449"></a>01449                }
<a name="l01450"></a>01450             }
<a name="l01451"></a>01451             globfree(&amp;globbuf);
<a name="l01452"></a>01452          }
<a name="l01453"></a>01453       }
<a name="l01454"></a>01454 <span class="preprocessor">#endif</span>
<a name="l01455"></a>01455 <span class="preprocessor"></span>
<a name="l01456"></a>01456    <span class="keywordflow">if</span> (cfg &amp;&amp; cfg != <a class="code" href="config_8h.html#a846844eb2c4eb44554445936b3770711">CONFIG_STATUS_FILEUNCHANGED</a> &amp;&amp; cfg != <a class="code" href="config_8h.html#a8d1a63cdf2c7aff22a77b6e75d93b377">CONFIG_STATUS_FILEINVALID</a> &amp;&amp; cfg-&gt;<a class="code" href="structast__config.html#a9889e4b9ce57e4055f9c11bacf89e50a">include_level</a> == 1 &amp;&amp; <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="config_8h.html#a2d5492e116eebd5075f247d21fb9db26abc16a274124ae96d43f8e52e344292c3">CONFIG_FLAG_WITHCOMMENTS</a>)) {
<a name="l01457"></a>01457       <span class="keywordflow">if</span> (comment_buffer)
<a name="l01458"></a>01458          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(comment_buffer);
<a name="l01459"></a>01459       <span class="keywordflow">if</span> (lline_buffer)
<a name="l01460"></a>01460          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(lline_buffer);
<a name="l01461"></a>01461       comment_buffer = NULL;
<a name="l01462"></a>01462       lline_buffer = NULL;
<a name="l01463"></a>01463    }
<a name="l01464"></a>01464    
<a name="l01465"></a>01465    <span class="keywordflow">if</span> (count == 0)
<a name="l01466"></a>01466       <span class="keywordflow">return</span> NULL;
<a name="l01467"></a>01467 
<a name="l01468"></a>01468    <span class="keywordflow">return</span> cfg;
<a name="l01469"></a>01469 }
<a name="l01470"></a>01470 
<a name="l01471"></a>01471 
<a name="l01472"></a>01472 <span class="comment">/* NOTE: categories and variables each have a file and lineno attribute. On a save operation, these are used to determine</span>
<a name="l01473"></a>01473 <span class="comment">   which file and line number to write out to. Thus, an entire hierarchy of config files (via #include statements) can be</span>
<a name="l01474"></a>01474 <span class="comment">   recreated. BUT, care must be taken to make sure that every cat and var has the proper file name stored, or you may</span>
<a name="l01475"></a>01475 <span class="comment">   be shocked and mystified as to why things are not showing up in the files! </span>
<a name="l01476"></a>01476 <span class="comment"></span>
<a name="l01477"></a>01477 <span class="comment">   Also, All #include/#exec statements are recorded in the &quot;includes&quot; LL in the ast_config structure. The file name</span>
<a name="l01478"></a>01478 <span class="comment">   and line number are stored for each include, plus the name of the file included, so that these statements may be</span>
<a name="l01479"></a>01479 <span class="comment">   included in the output files on a file_save operation. </span>
<a name="l01480"></a>01480 <span class="comment"></span>
<a name="l01481"></a>01481 <span class="comment">   The lineno&apos;s are really just for relative placement in the file. There is no attempt to make sure that blank lines</span>
<a name="l01482"></a>01482 <span class="comment">   are included to keep the lineno&apos;s the same between input and output. The lineno fields are used mainly to determine</span>
<a name="l01483"></a>01483 <span class="comment">   the position of the #include and #exec directives. So, blank lines tend to disappear from a read/rewrite operation,</span>
<a name="l01484"></a>01484 <span class="comment">   and a header gets added.</span>
<a name="l01485"></a>01485 <span class="comment"></span>
<a name="l01486"></a>01486 <span class="comment">   vars and category heads are output in the order they are stored in the config file. So, if the software</span>
<a name="l01487"></a>01487 <span class="comment">   shuffles these at all, then the placement of #include directives might get a little mixed up, because the</span>
<a name="l01488"></a>01488 <span class="comment">   file/lineno data probably won&apos;t get changed.</span>
<a name="l01489"></a>01489 <span class="comment"></span>
<a name="l01490"></a>01490 <span class="comment">*/</span>
<a name="l01491"></a>01491 
<a name="l01492"></a><a class="code" href="config_8c.html#a89aa1c2a335e01661693101115778a9a">01492</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="config_8c.html#a89aa1c2a335e01661693101115778a9a">gen_header</a>(FILE *f1, <span class="keyword">const</span> <span class="keywordtype">char</span> *configfile, <span class="keyword">const</span> <span class="keywordtype">char</span> *fn, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="app__fax_8c.html#a36aeb2eb01afb248bad64a309d743636">generator</a>)
<a name="l01493"></a>01493 {
<a name="l01494"></a>01494    <span class="keywordtype">char</span> date[256]=<span class="stringliteral">&quot;&quot;</span>;
<a name="l01495"></a>01495    time_t t;
<a name="l01496"></a>01496 
<a name="l01497"></a>01497    time(&amp;t);
<a name="l01498"></a>01498    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(date, ctime(&amp;t), <span class="keyword">sizeof</span>(date));
<a name="l01499"></a>01499 
<a name="l01500"></a>01500    fprintf(f1, <span class="stringliteral">&quot;;!\n&quot;</span>);
<a name="l01501"></a>01501    fprintf(f1, <span class="stringliteral">&quot;;! Automatically generated configuration file\n&quot;</span>);
<a name="l01502"></a>01502    <span class="keywordflow">if</span> (strcmp(configfile, fn))
<a name="l01503"></a>01503       fprintf(f1, <span class="stringliteral">&quot;;! Filename: %s (%s)\n&quot;</span>, configfile, fn);
<a name="l01504"></a>01504    <span class="keywordflow">else</span>
<a name="l01505"></a>01505       fprintf(f1, <span class="stringliteral">&quot;;! Filename: %s\n&quot;</span>, configfile);
<a name="l01506"></a>01506    fprintf(f1, <span class="stringliteral">&quot;;! Generator: %s\n&quot;</span>, generator);
<a name="l01507"></a>01507    fprintf(f1, <span class="stringliteral">&quot;;! Creation Date: %s&quot;</span>, date);
<a name="l01508"></a>01508    fprintf(f1, <span class="stringliteral">&quot;;!\n&quot;</span>);
<a name="l01509"></a>01509 }
<a name="l01510"></a>01510 
<a name="l01511"></a><a class="code" href="config_8c.html#aed8a8915873f18f02996ad16eaf0b6d7">01511</a> <span class="keyword">static</span> <span class="keywordtype">void</span>   <a class="code" href="config_8c.html#aed8a8915873f18f02996ad16eaf0b6d7">inclfile_destroy</a>(<span class="keywordtype">void</span> *obj)
<a name="l01512"></a>01512 {
<a name="l01513"></a>01513    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structinclfile.html">inclfile</a> *o = obj;
<a name="l01514"></a>01514 
<a name="l01515"></a>01515    <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structinclfile.html#ae96bbe3347b319ee7bdbd1f2e2ba9f5b">fname</a>)
<a name="l01516"></a>01516       <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(o-&gt;<a class="code" href="structinclfile.html#ae96bbe3347b319ee7bdbd1f2e2ba9f5b">fname</a>);
<a name="l01517"></a>01517 }
<a name="l01518"></a>01518 
<a name="l01519"></a>01519 
<a name="l01520"></a><a class="code" href="config_8c.html#ac254b8e1045d65f111e303ccdc14c437">01520</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="config_8c.html#ac254b8e1045d65f111e303ccdc14c437">set_fn</a>(<span class="keywordtype">char</span> *fn, <span class="keywordtype">int</span> fn_size, <span class="keyword">const</span> <span class="keywordtype">char</span> *file, <span class="keyword">const</span> <span class="keywordtype">char</span> *configfile, <span class="keyword">struct</span> <a class="code" href="structao2__container.html">ao2_container</a> *fileset, <span class="keyword">struct</span> <a class="code" href="structinclfile.html">inclfile</a> **fi)
<a name="l01521"></a>01521 {
<a name="l01522"></a>01522    <span class="keyword">struct </span><a class="code" href="structinclfile.html">inclfile</a> lookup;
<a name="l01523"></a>01523    
<a name="l01524"></a>01524    <span class="keywordflow">if</span> (!file || file[0] == 0) {
<a name="l01525"></a>01525       <span class="keywordflow">if</span> (configfile[0] == <span class="charliteral">&apos;/&apos;</span>)
<a name="l01526"></a>01526          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(fn, configfile, fn_size);
<a name="l01527"></a>01527       <span class="keywordflow">else</span>
<a name="l01528"></a>01528          snprintf(fn, fn_size, <span class="stringliteral">&quot;%s/%s&quot;</span>, <a class="code" href="paths_8h.html#a7d3836e5581e433c9f5edd30300cc187">ast_config_AST_CONFIG_DIR</a>, configfile);
<a name="l01529"></a>01529    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (file[0] == <span class="charliteral">&apos;/&apos;</span>) 
<a name="l01530"></a>01530       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(fn, file, fn_size);
<a name="l01531"></a>01531    <span class="keywordflow">else</span>
<a name="l01532"></a>01532       snprintf(fn, fn_size, <span class="stringliteral">&quot;%s/%s&quot;</span>, <a class="code" href="paths_8h.html#a7d3836e5581e433c9f5edd30300cc187">ast_config_AST_CONFIG_DIR</a>, file);
<a name="l01533"></a>01533    lookup.<a class="code" href="structinclfile.html#ae96bbe3347b319ee7bdbd1f2e2ba9f5b">fname</a> = fn;
<a name="l01534"></a>01534    *fi = <a class="code" href="astobj2_8h.html#a618587b42226725315b96db394b13673">ao2_find</a>(fileset, &amp;lookup, <a class="code" href="astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca32d49976aaebc093266f0b080f9c9a73">OBJ_POINTER</a>);
<a name="l01535"></a>01535    <span class="keywordflow">if</span> (!(*fi)) {
<a name="l01536"></a>01536       <span class="comment">/* set up a file scratch pad */</span>
<a name="l01537"></a>01537       <span class="keyword">struct </span><a class="code" href="structinclfile.html">inclfile</a> *fx = <a class="code" href="astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structinclfile.html">inclfile</a>), <a class="code" href="config_8c.html#aed8a8915873f18f02996ad16eaf0b6d7">inclfile_destroy</a>);
<a name="l01538"></a>01538       fx-&gt;<a class="code" href="structinclfile.html#ae96bbe3347b319ee7bdbd1f2e2ba9f5b">fname</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(fn);
<a name="l01539"></a>01539       fx-&gt;<a class="code" href="structinclfile.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a> = 1;
<a name="l01540"></a>01540       *fi = fx;
<a name="l01541"></a>01541       <a class="code" href="astobj2_8h.html#a210544bdcc5afe0601d01d6e529c22d8">ao2_link</a>(fileset, fx);
<a name="l01542"></a>01542    }
<a name="l01543"></a>01543 }
<a name="l01544"></a>01544 
<a name="l01545"></a><a class="code" href="config_8c.html#a87174193e8c5fbdd6f0896c7e8c56065">01545</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="config_8c.html#a87174193e8c5fbdd6f0896c7e8c56065">count_linefeeds</a>(<span class="keywordtype">char</span> *<a class="code" href="app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>)
<a name="l01546"></a>01546 {
<a name="l01547"></a>01547    <span class="keywordtype">int</span> count = 0;
<a name="l01548"></a>01548 
<a name="l01549"></a>01549    <span class="keywordflow">while</span> (*str) {
<a name="l01550"></a>01550       <span class="keywordflow">if</span> (*str ==<span class="charliteral">&apos;\n&apos;</span>)
<a name="l01551"></a>01551          count++;
<a name="l01552"></a>01552       str++;
<a name="l01553"></a>01553    }
<a name="l01554"></a>01554    <span class="keywordflow">return</span> count;
<a name="l01555"></a>01555 }
<a name="l01556"></a>01556 
<a name="l01557"></a><a class="code" href="config_8c.html#a4c45ed93a4f6229f1d339a1372478912">01557</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="config_8c.html#a4c45ed93a4f6229f1d339a1372478912">count_linefeeds_in_comments</a>(<span class="keyword">struct</span> <a class="code" href="structast__comment.html" title="Structure to keep comments for rewriting configuration files.">ast_comment</a> *x)
<a name="l01558"></a>01558 {
<a name="l01559"></a>01559    <span class="keywordtype">int</span> count = 0;
<a name="l01560"></a>01560 
<a name="l01561"></a>01561    <span class="keywordflow">while</span> (x) {
<a name="l01562"></a>01562       count += <a class="code" href="config_8c.html#a87174193e8c5fbdd6f0896c7e8c56065">count_linefeeds</a>(x-&gt;<a class="code" href="structast__comment.html#adfc7bf9f42a9a3b2a61d704e97853ba6">cmt</a>);
<a name="l01563"></a>01563       x = x-&gt;<a class="code" href="structast__comment.html#adab84eadfeb3d2c35ac0a185b9345e8f">next</a>;
<a name="l01564"></a>01564    }
<a name="l01565"></a>01565    <span class="keywordflow">return</span> count;
<a name="l01566"></a>01566 }
<a name="l01567"></a>01567 
<a name="l01568"></a><a class="code" href="config_8c.html#a6cb06877fd5a30e2e1e972b9de02894f">01568</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="config_8c.html#a6cb06877fd5a30e2e1e972b9de02894f">insert_leading_blank_lines</a>(FILE *fp, <span class="keyword">struct</span> <a class="code" href="structinclfile.html">inclfile</a> *fi, <span class="keyword">struct</span> <a class="code" href="structast__comment.html" title="Structure to keep comments for rewriting configuration files.">ast_comment</a> *precomments, <span class="keywordtype">int</span> lineno)
<a name="l01569"></a>01569 {
<a name="l01570"></a>01570    <span class="keywordtype">int</span> precomment_lines = <a class="code" href="config_8c.html#a4c45ed93a4f6229f1d339a1372478912">count_linefeeds_in_comments</a>(precomments);
<a name="l01571"></a>01571    <span class="keywordtype">int</span> i;
<a name="l01572"></a>01572 
<a name="l01573"></a>01573    <span class="comment">/* I don&apos;t have to worry about those ;! comments, they are</span>
<a name="l01574"></a>01574 <span class="comment">      stored in the precomments, but not printed back out.</span>
<a name="l01575"></a>01575 <span class="comment">      I did have to make sure that comments following</span>
<a name="l01576"></a>01576 <span class="comment">      the ;! header comments were not also deleted in the process */</span>
<a name="l01577"></a>01577    <span class="keywordflow">if</span> (lineno - precomment_lines - fi-&gt;<a class="code" href="structinclfile.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a> &lt; 0) { <span class="comment">/* insertions can mess up the line numbering and produce negative numbers that mess things up */</span>
<a name="l01578"></a>01578       <span class="keywordflow">return</span>;
<a name="l01579"></a>01579    }
<a name="l01580"></a>01580    <span class="keywordflow">for</span> (i=fi-&gt;<a class="code" href="structinclfile.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>; i&lt;lineno - precomment_lines; i++) {
<a name="l01581"></a>01581       fprintf(fp,<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01582"></a>01582    }
<a name="l01583"></a>01583    fi-&gt;<a class="code" href="structinclfile.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a> = lineno+1; <span class="comment">/* Advance the file lineno */</span>
<a name="l01584"></a>01584 }
<a name="l01585"></a>01585 
<a name="l01586"></a><a class="code" href="config_8c.html#abde33f89ddfdcd1b81914e114b7fbd4e">01586</a> <span class="keywordtype">int</span> <a class="code" href="config_8h.html#a35ece6ecbe9e41c18e58cc02a0db898a">config_text_file_save</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *configfile, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structast__config.html">ast_config</a> *cfg, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="app__fax_8c.html#a36aeb2eb01afb248bad64a309d743636">generator</a>)
<a name="l01587"></a>01587 {
<a name="l01588"></a>01588    <span class="keywordflow">return</span> <a class="code" href="config_8h.html#a473721b764b20c167c95b99239bc0654">ast_config_text_file_save</a>(configfile, cfg, generator);
<a name="l01589"></a>01589 }
<a name="l01590"></a>01590 
<a name="l01591"></a><a class="code" href="config_8c.html#a29737a7dea0156078d5164dfea18f2d8">01591</a> <span class="keywordtype">int</span> <a class="code" href="config_8h.html#a473721b764b20c167c95b99239bc0654">ast_config_text_file_save</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *configfile, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structast__config.html">ast_config</a> *cfg, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="app__fax_8c.html#a36aeb2eb01afb248bad64a309d743636">generator</a>)
<a name="l01592"></a>01592 {
<a name="l01593"></a>01593    FILE *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l01594"></a>01594    <span class="keywordtype">char</span> fn[256];
<a name="l01595"></a>01595    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>;
<a name="l01596"></a>01596    <span class="keyword">struct </span>ast_category *cat;
<a name="l01597"></a>01597    <span class="keyword">struct </span><a class="code" href="structast__comment.html" title="Structure to keep comments for rewriting configuration files.">ast_comment</a> *<a class="code" href="structast__comment.html#adfc7bf9f42a9a3b2a61d704e97853ba6">cmt</a>;
<a name="l01598"></a>01598    <span class="keyword">struct </span><a class="code" href="structast__config__include.html">ast_config_include</a> *incl;
<a name="l01599"></a>01599    <span class="keywordtype">int</span> blanklines = 0;
<a name="l01600"></a>01600    <span class="keyword">struct </span><a class="code" href="structao2__container.html">ao2_container</a> *fileset = <a class="code" href="astobj2_8h.html#a82534c91be59ec9a3d3318ec85ac5695">ao2_container_alloc</a>(180000, <a class="code" href="config_8c.html#aad5ce0e28669396c43aae46f17a3453a">hash_string</a>, <a class="code" href="config_8c.html#a6da577f4b98c9ab78c60c829375acaa1">hashtab_compare_strings</a>);
<a name="l01601"></a>01601    <span class="keyword">struct </span><a class="code" href="structinclfile.html">inclfile</a> *fi = 0;
<a name="l01602"></a>01602 
<a name="l01603"></a>01603    <span class="comment">/* reset all the output flags, in case this isn&apos;t our first time saving this data */</span>
<a name="l01604"></a>01604 
<a name="l01605"></a>01605    <span class="keywordflow">for</span> (incl=cfg-&gt;<a class="code" href="structast__config.html#acb049f8b410c47aebfde624a7de10819">includes</a>; incl; incl = incl-&gt;<a class="code" href="structast__config__include.html#ae2104fb51ee9f10eb0006df77fb8d504">next</a>)
<a name="l01606"></a>01606       incl-&gt;<a class="code" href="structast__config__include.html#a76a055a540e12c7206a5004afea1f66e">output</a> = 0;
<a name="l01607"></a>01607 
<a name="l01608"></a>01608    <span class="comment">/* go thru all the inclusions and make sure all the files involved (configfile plus all its inclusions)</span>
<a name="l01609"></a>01609 <span class="comment">      are all truncated to zero bytes and have that nice header*/</span>
<a name="l01610"></a>01610 
<a name="l01611"></a>01611    <span class="keywordflow">for</span> (incl=cfg-&gt;<a class="code" href="structast__config.html#acb049f8b410c47aebfde624a7de10819">includes</a>; incl; incl = incl-&gt;<a class="code" href="structast__config__include.html#ae2104fb51ee9f10eb0006df77fb8d504">next</a>)
<a name="l01612"></a>01612    {
<a name="l01613"></a>01613       <span class="keywordflow">if</span> (!incl-&gt;<a class="code" href="structast__config__include.html#a4fb0f078574c9bdeeaee433d411298c9">exec</a>) { <span class="comment">/* leave the execs alone -- we&apos;ll write out the #exec directives, but won&apos;t zero out the include files or exec files*/</span>
<a name="l01614"></a>01614          FILE *f1;
<a name="l01615"></a>01615 
<a name="l01616"></a>01616          <a class="code" href="config_8c.html#ac254b8e1045d65f111e303ccdc14c437">set_fn</a>(fn, <span class="keyword">sizeof</span>(fn), incl-&gt;<a class="code" href="structast__config__include.html#a5d894d3ac3a63ddbe13305c29b0aceb8">included_file</a>, configfile, fileset, &amp;fi); <span class="comment">/* normally, fn is just set to incl-&gt;included_file, prepended with config dir if relative */</span>
<a name="l01617"></a>01617          f1 = fopen(fn,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l01618"></a>01618          <span class="keywordflow">if</span> (f1) {
<a name="l01619"></a>01619             <a class="code" href="config_8c.html#a89aa1c2a335e01661693101115778a9a">gen_header</a>(f1, configfile, fn, generator);
<a name="l01620"></a>01620             fclose(f1); <span class="comment">/* this should zero out the file */</span>
<a name="l01621"></a>01621          } <span class="keywordflow">else</span> {
<a name="l01622"></a>01622             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Unable to open for writing: %s\n&quot;</span>, fn);
<a name="l01623"></a>01623             <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Unable to write %s (%s)&quot;</span>, fn, strerror(<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l01624"></a>01624          }
<a name="l01625"></a>01625          <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(fi,-1); <span class="comment">/* we are giving up this reference to the object ptd to by fi */</span>
<a name="l01626"></a>01626          fi = 0;
<a name="l01627"></a>01627       }
<a name="l01628"></a>01628    }
<a name="l01629"></a>01629 
<a name="l01630"></a>01630    <a class="code" href="config_8c.html#ac254b8e1045d65f111e303ccdc14c437">set_fn</a>(fn, <span class="keyword">sizeof</span>(fn), 0, configfile, fileset, &amp;fi); <span class="comment">/* just set fn to absolute ver of configfile */</span>
<a name="l01631"></a>01631 <span class="preprocessor">#ifdef __CYGWIN__ </span>
<a name="l01632"></a>01632 <span class="preprocessor"></span>   <span class="keywordflow">if</span> ((f = fopen(fn, <span class="stringliteral">&quot;w+&quot;</span>))) {
<a name="l01633"></a>01633 <span class="preprocessor">#else</span>
<a name="l01634"></a>01634 <span class="preprocessor"></span>   <span class="keywordflow">if</span> ((f = fopen(fn, <span class="stringliteral">&quot;w&quot;</span>))) {
<a name="l01635"></a>01635 <span class="preprocessor">#endif       </span>
<a name="l01636"></a>01636 <span class="preprocessor"></span>      <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Saving &apos;%s&apos;: &quot;</span>, fn);
<a name="l01637"></a>01637       <a class="code" href="config_8c.html#a89aa1c2a335e01661693101115778a9a">gen_header</a>(f, configfile, fn, generator);
<a name="l01638"></a>01638       cat = cfg-&gt;<a class="code" href="structast__config.html#a1d069527a476fcfd5e93263cda8099dd">root</a>;
<a name="l01639"></a>01639       fclose(f);
<a name="l01640"></a>01640       <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(fi,-1); <span class="comment">/* we are giving up this reference to the object ptd to by fi */</span>
<a name="l01641"></a>01641       
<a name="l01642"></a>01642       <span class="comment">/* from here out, we open each involved file and concat the stuff we need to add to the end and immediately close... */</span>
<a name="l01643"></a>01643       <span class="comment">/* since each var, cat, and associated comments can come from any file, we have to be </span>
<a name="l01644"></a>01644 <span class="comment">         mobile, and open each file, print, and close it on an entry-by-entry basis */</span>
<a name="l01645"></a>01645 
<a name="l01646"></a>01646       <span class="keywordflow">while</span> (cat) {
<a name="l01647"></a>01647          <a class="code" href="config_8c.html#ac254b8e1045d65f111e303ccdc14c437">set_fn</a>(fn, <span class="keyword">sizeof</span>(fn), cat-&gt;<a class="code" href="structast__category.html#adf16cd437526a5c5e0e0af87745acbb8">file</a>, configfile, fileset, &amp;fi);
<a name="l01648"></a>01648          f = fopen(fn, <span class="stringliteral">&quot;a&quot;</span>);
<a name="l01649"></a>01649          <span class="keywordflow">if</span> (!f)
<a name="l01650"></a>01650          {
<a name="l01651"></a>01651             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Unable to open for writing: %s\n&quot;</span>, fn);
<a name="l01652"></a>01652             <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Unable to write %s (%s)&quot;</span>, fn, strerror(<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l01653"></a>01653             <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(fileset, -1);
<a name="l01654"></a>01654             <span class="keywordflow">return</span> -1;
<a name="l01655"></a>01655          }
<a name="l01656"></a>01656 
<a name="l01657"></a>01657          <span class="comment">/* dump any includes that happen before this category header */</span>
<a name="l01658"></a>01658          <span class="keywordflow">for</span> (incl=cfg-&gt;<a class="code" href="structast__config.html#acb049f8b410c47aebfde624a7de10819">includes</a>; incl; incl = incl-&gt;<a class="code" href="structast__config__include.html#ae2104fb51ee9f10eb0006df77fb8d504">next</a>) {
<a name="l01659"></a>01659             <span class="keywordflow">if</span> (strcmp(incl-&gt;<a class="code" href="structast__config__include.html#ad2a400871412e45079d5b0b09dbe34be">include_location_file</a>, cat-&gt;<a class="code" href="structast__category.html#adf16cd437526a5c5e0e0af87745acbb8">file</a>) == 0){
<a name="l01660"></a>01660                <span class="keywordflow">if</span> (cat-&gt;<a class="code" href="structast__category.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a> &gt; incl-&gt;<a class="code" href="structast__config__include.html#ae2135f6bf6382a1e687d07ccdf811d64">include_location_lineno</a> &amp;&amp; !incl-&gt;<a class="code" href="structast__config__include.html#a76a055a540e12c7206a5004afea1f66e">output</a>) {
<a name="l01661"></a>01661                   <span class="keywordflow">if</span> (incl-&gt;<a class="code" href="structast__config__include.html#a4fb0f078574c9bdeeaee433d411298c9">exec</a>)
<a name="l01662"></a>01662                      fprintf(f,<span class="stringliteral">&quot;#exec \&quot;%s\&quot;\n&quot;</span>, incl-&gt;<a class="code" href="structast__config__include.html#ac06a64b674f41fa8d0d3c86b9dffa3c4">exec_file</a>);
<a name="l01663"></a>01663                   <span class="keywordflow">else</span>
<a name="l01664"></a>01664                      fprintf(f,<span class="stringliteral">&quot;#include \&quot;%s\&quot;\n&quot;</span>, incl-&gt;<a class="code" href="structast__config__include.html#a5d894d3ac3a63ddbe13305c29b0aceb8">included_file</a>);
<a name="l01665"></a>01665                   incl-&gt;<a class="code" href="structast__config__include.html#a76a055a540e12c7206a5004afea1f66e">output</a> = 1;
<a name="l01666"></a>01666                }
<a name="l01667"></a>01667             }
<a name="l01668"></a>01668          }
<a name="l01669"></a>01669 
<a name="l01670"></a>01670          <a class="code" href="config_8c.html#a6cb06877fd5a30e2e1e972b9de02894f">insert_leading_blank_lines</a>(f, fi, cat-&gt;<a class="code" href="structast__category.html#a80bf10e9bcb9c00a7a59051a77a620cf">precomments</a>, cat-&gt;<a class="code" href="structast__category.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l01671"></a>01671          <span class="comment">/* Dump section with any appropriate comment */</span>
<a name="l01672"></a>01672          <span class="keywordflow">for</span> (cmt = cat-&gt;<a class="code" href="structast__category.html#a80bf10e9bcb9c00a7a59051a77a620cf">precomments</a>; cmt; cmt=cmt-&gt;<a class="code" href="structast__comment.html#adab84eadfeb3d2c35ac0a185b9345e8f">next</a>) {
<a name="l01673"></a>01673             <span class="keywordtype">char</span> *cmtp = cmt-&gt;<a class="code" href="structast__comment.html#adfc7bf9f42a9a3b2a61d704e97853ba6">cmt</a>;
<a name="l01674"></a>01674             <span class="keywordflow">while</span> (*cmtp == <span class="charliteral">&apos;;&apos;</span> &amp;&amp; *(cmtp+1) == <span class="charliteral">&apos;!&apos;</span>) {
<a name="l01675"></a>01675                <span class="keywordtype">char</span> *cmtp2 = strchr(cmtp+1, <span class="charliteral">&apos;\n&apos;</span>);
<a name="l01676"></a>01676                <span class="keywordflow">if</span> (cmtp2)
<a name="l01677"></a>01677                   cmtp = cmtp2+1;
<a name="l01678"></a>01678                <span class="keywordflow">else</span> cmtp = 0;
<a name="l01679"></a>01679             }
<a name="l01680"></a>01680             <span class="keywordflow">if</span> (cmtp)
<a name="l01681"></a>01681                fprintf(f,<span class="stringliteral">&quot;%s&quot;</span>, cmtp);
<a name="l01682"></a>01682          }
<a name="l01683"></a>01683          fprintf(f, <span class="stringliteral">&quot;[%s]&quot;</span>, cat-&gt;<a class="code" href="structast__category.html#a3777dbae63a15da001b2baa317a25149">name</a>);
<a name="l01684"></a>01684          <span class="keywordflow">if</span> (cat-&gt;<a class="code" href="structast__category.html#a973274447fb1c6eb9b27c5a54505bb69">ignored</a> || !<a class="code" href="linkedlists_8h.html#a4a1884cde93e53bef32ca85c194a1d05" title="Checks whether the specified list contains any entries.">AST_LIST_EMPTY</a>(&amp;cat-&gt;<a class="code" href="structast__category.html#aae97cd31a5d99cca5025058686aac6d7">template_instances</a>)) {
<a name="l01685"></a>01685             fprintf(f, <span class="stringliteral">&quot;(&quot;</span>);
<a name="l01686"></a>01686             <span class="keywordflow">if</span> (cat-&gt;<a class="code" href="structast__category.html#a973274447fb1c6eb9b27c5a54505bb69">ignored</a>) {
<a name="l01687"></a>01687                fprintf(f, <span class="stringliteral">&quot;!&quot;</span>);
<a name="l01688"></a>01688             }
<a name="l01689"></a>01689             <span class="keywordflow">if</span> (cat-&gt;<a class="code" href="structast__category.html#a973274447fb1c6eb9b27c5a54505bb69">ignored</a> &amp;&amp; !<a class="code" href="linkedlists_8h.html#a4a1884cde93e53bef32ca85c194a1d05" title="Checks whether the specified list contains any entries.">AST_LIST_EMPTY</a>(&amp;cat-&gt;<a class="code" href="structast__category.html#aae97cd31a5d99cca5025058686aac6d7">template_instances</a>)) {
<a name="l01690"></a>01690                fprintf(f, <span class="stringliteral">&quot;,&quot;</span>);
<a name="l01691"></a>01691             }
<a name="l01692"></a>01692             <span class="keywordflow">if</span> (!<a class="code" href="linkedlists_8h.html#a4a1884cde93e53bef32ca85c194a1d05" title="Checks whether the specified list contains any entries.">AST_LIST_EMPTY</a>(&amp;cat-&gt;<a class="code" href="structast__category.html#aae97cd31a5d99cca5025058686aac6d7">template_instances</a>)) {
<a name="l01693"></a>01693                <span class="keyword">struct </span><a class="code" href="structast__category__template__instance.html">ast_category_template_instance</a> *x;
<a name="l01694"></a>01694                <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;cat-&gt;<a class="code" href="structast__category.html#aae97cd31a5d99cca5025058686aac6d7">template_instances</a>, x, next) {
<a name="l01695"></a>01695                   fprintf(f,<span class="stringliteral">&quot;%s&quot;</span>,x-&gt;<a class="code" href="structast__category__template__instance.html#a3777dbae63a15da001b2baa317a25149">name</a>);
<a name="l01696"></a>01696                   <span class="keywordflow">if</span> (x != <a class="code" href="linkedlists_8h.html#a1e37109bb72d95999821eb45f28c261c" title="Returns the last entry contained in a list.">AST_LIST_LAST</a>(&amp;cat-&gt;<a class="code" href="structast__category.html#aae97cd31a5d99cca5025058686aac6d7">template_instances</a>))
<a name="l01697"></a>01697                      fprintf(f,<span class="stringliteral">&quot;,&quot;</span>);
<a name="l01698"></a>01698                }
<a name="l01699"></a>01699             }
<a name="l01700"></a>01700             fprintf(f, <span class="stringliteral">&quot;)&quot;</span>);
<a name="l01701"></a>01701          }
<a name="l01702"></a>01702          <span class="keywordflow">for</span>(cmt = cat-&gt;<a class="code" href="structast__category.html#a6e4312227f9a7570709abf7f686f1cfe">sameline</a>; cmt; cmt=cmt-&gt;<a class="code" href="structast__comment.html#adab84eadfeb3d2c35ac0a185b9345e8f">next</a>)
<a name="l01703"></a>01703          {
<a name="l01704"></a>01704             fprintf(f,<span class="stringliteral">&quot;%s&quot;</span>, cmt-&gt;<a class="code" href="structast__comment.html#adfc7bf9f42a9a3b2a61d704e97853ba6">cmt</a>);
<a name="l01705"></a>01705          }
<a name="l01706"></a>01706          <span class="keywordflow">if</span> (!cat-&gt;<a class="code" href="structast__category.html#a6e4312227f9a7570709abf7f686f1cfe">sameline</a>)
<a name="l01707"></a>01707             fprintf(f,<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01708"></a>01708          <span class="keywordflow">for</span> (cmt = cat-&gt;<a class="code" href="structast__category.html#ab09dbd177767543015efa3ba28fab03a">trailing</a>; cmt; cmt=cmt-&gt;<a class="code" href="structast__comment.html#adab84eadfeb3d2c35ac0a185b9345e8f">next</a>) {
<a name="l01709"></a>01709             <span class="keywordflow">if</span> (cmt-&gt;<a class="code" href="structast__comment.html#adfc7bf9f42a9a3b2a61d704e97853ba6">cmt</a>[0] != <span class="charliteral">&apos;;&apos;</span> || cmt-&gt;<a class="code" href="structast__comment.html#adfc7bf9f42a9a3b2a61d704e97853ba6">cmt</a>[1] != <span class="charliteral">&apos;!&apos;</span>)
<a name="l01710"></a>01710                fprintf(f,<span class="stringliteral">&quot;%s&quot;</span>, cmt-&gt;<a class="code" href="structast__comment.html#adfc7bf9f42a9a3b2a61d704e97853ba6">cmt</a>);
<a name="l01711"></a>01711          }
<a name="l01712"></a>01712          fclose(f);
<a name="l01713"></a>01713          <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(fi,-1); <span class="comment">/* we are giving up this reference to the object ptd to by fi */</span>
<a name="l01714"></a>01714          fi = 0;
<a name="l01715"></a>01715          
<a name="l01716"></a>01716          var = cat-&gt;<a class="code" href="structast__category.html#a6f86d2cb07f9a779a13a854d21b40728">root</a>;
<a name="l01717"></a>01717          <span class="keywordflow">while</span> (var) {
<a name="l01718"></a>01718             <span class="keyword">struct </span><a class="code" href="structast__category__template__instance.html">ast_category_template_instance</a> *x;
<a name="l01719"></a>01719             <span class="keywordtype">int</span> found = 0;
<a name="l01720"></a>01720             <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;cat-&gt;<a class="code" href="structast__category.html#aae97cd31a5d99cca5025058686aac6d7">template_instances</a>, x, next) {
<a name="l01721"></a>01721                <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *v;
<a name="l01722"></a>01722                <span class="keywordflow">for</span> (v = x-&gt;<a class="code" href="structast__category__template__instance.html#a4a795962dfc694a64a8c88bcb097b282">inst</a>-&gt;<a class="code" href="structast__category.html#a6f86d2cb07f9a779a13a854d21b40728">root</a>; v; v = v-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l01723"></a>01723                   <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>) &amp;&amp; !strcmp(var-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>)) {
<a name="l01724"></a>01724                      found = 1;
<a name="l01725"></a>01725                      <span class="keywordflow">break</span>;
<a name="l01726"></a>01726                   }
<a name="l01727"></a>01727                }
<a name="l01728"></a>01728                <span class="keywordflow">if</span> (found)
<a name="l01729"></a>01729                   <span class="keywordflow">break</span>;
<a name="l01730"></a>01730             }
<a name="l01731"></a>01731             <span class="keywordflow">if</span> (found) {
<a name="l01732"></a>01732                var = var-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>;
<a name="l01733"></a>01733                <span class="keywordflow">continue</span>;
<a name="l01734"></a>01734             }
<a name="l01735"></a>01735             <a class="code" href="config_8c.html#ac254b8e1045d65f111e303ccdc14c437">set_fn</a>(fn, <span class="keyword">sizeof</span>(fn), var-&gt;<a class="code" href="structast__variable.html#adf16cd437526a5c5e0e0af87745acbb8">file</a>, configfile, fileset, &amp;fi);
<a name="l01736"></a>01736             f = fopen(fn, <span class="stringliteral">&quot;a&quot;</span>);
<a name="l01737"></a>01737             <span class="keywordflow">if</span> (!f)
<a name="l01738"></a>01738             {
<a name="l01739"></a>01739                <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Unable to open for writing: %s\n&quot;</span>, fn);
<a name="l01740"></a>01740                <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Unable to write %s (%s)&quot;</span>, fn, strerror(<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l01741"></a>01741                <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(fi,-1); <span class="comment">/* we are giving up this reference to the object ptd to by fi */</span>
<a name="l01742"></a>01742                fi = 0;
<a name="l01743"></a>01743                <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(fileset, -1);
<a name="l01744"></a>01744                <span class="keywordflow">return</span> -1;
<a name="l01745"></a>01745             }
<a name="l01746"></a>01746             
<a name="l01747"></a>01747             <span class="comment">/* dump any includes that happen before this category header */</span>
<a name="l01748"></a>01748             <span class="keywordflow">for</span> (incl=cfg-&gt;<a class="code" href="structast__config.html#acb049f8b410c47aebfde624a7de10819">includes</a>; incl; incl = incl-&gt;<a class="code" href="structast__config__include.html#ae2104fb51ee9f10eb0006df77fb8d504">next</a>) {
<a name="l01749"></a>01749                <span class="keywordflow">if</span> (strcmp(incl-&gt;<a class="code" href="structast__config__include.html#ad2a400871412e45079d5b0b09dbe34be">include_location_file</a>, var-&gt;<a class="code" href="structast__variable.html#adf16cd437526a5c5e0e0af87745acbb8">file</a>) == 0){
<a name="l01750"></a>01750                   <span class="keywordflow">if</span> (var-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a> &gt; incl-&gt;<a class="code" href="structast__config__include.html#ae2135f6bf6382a1e687d07ccdf811d64">include_location_lineno</a> &amp;&amp; !incl-&gt;<a class="code" href="structast__config__include.html#a76a055a540e12c7206a5004afea1f66e">output</a>) {
<a name="l01751"></a>01751                      <span class="keywordflow">if</span> (incl-&gt;<a class="code" href="structast__config__include.html#a4fb0f078574c9bdeeaee433d411298c9">exec</a>)
<a name="l01752"></a>01752                         fprintf(f,<span class="stringliteral">&quot;#exec \&quot;%s\&quot;\n&quot;</span>, incl-&gt;<a class="code" href="structast__config__include.html#ac06a64b674f41fa8d0d3c86b9dffa3c4">exec_file</a>);
<a name="l01753"></a>01753                      <span class="keywordflow">else</span>
<a name="l01754"></a>01754                         fprintf(f,<span class="stringliteral">&quot;#include \&quot;%s\&quot;\n&quot;</span>, incl-&gt;<a class="code" href="structast__config__include.html#a5d894d3ac3a63ddbe13305c29b0aceb8">included_file</a>);
<a name="l01755"></a>01755                      incl-&gt;<a class="code" href="structast__config__include.html#a76a055a540e12c7206a5004afea1f66e">output</a> = 1;
<a name="l01756"></a>01756                   }
<a name="l01757"></a>01757                }
<a name="l01758"></a>01758             }
<a name="l01759"></a>01759             
<a name="l01760"></a>01760             <a class="code" href="config_8c.html#a6cb06877fd5a30e2e1e972b9de02894f">insert_leading_blank_lines</a>(f, fi, var-&gt;<a class="code" href="structast__variable.html#a80bf10e9bcb9c00a7a59051a77a620cf">precomments</a>, var-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l01761"></a>01761             <span class="keywordflow">for</span> (cmt = var-&gt;<a class="code" href="structast__variable.html#a80bf10e9bcb9c00a7a59051a77a620cf">precomments</a>; cmt; cmt=cmt-&gt;<a class="code" href="structast__comment.html#adab84eadfeb3d2c35ac0a185b9345e8f">next</a>) {
<a name="l01762"></a>01762                <span class="keywordflow">if</span> (cmt-&gt;<a class="code" href="structast__comment.html#adfc7bf9f42a9a3b2a61d704e97853ba6">cmt</a>[0] != <span class="charliteral">&apos;;&apos;</span> || cmt-&gt;<a class="code" href="structast__comment.html#adfc7bf9f42a9a3b2a61d704e97853ba6">cmt</a>[1] != <span class="charliteral">&apos;!&apos;</span>)
<a name="l01763"></a>01763                   fprintf(f,<span class="stringliteral">&quot;%s&quot;</span>, cmt-&gt;<a class="code" href="structast__comment.html#adfc7bf9f42a9a3b2a61d704e97853ba6">cmt</a>);
<a name="l01764"></a>01764             }
<a name="l01765"></a>01765             <span class="keywordflow">if</span> (var-&gt;<a class="code" href="structast__variable.html#a6e4312227f9a7570709abf7f686f1cfe">sameline</a>) 
<a name="l01766"></a>01766                fprintf(f, <span class="stringliteral">&quot;%s %s %s  %s&quot;</span>, var-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, (var-&gt;<a class="code" href="structast__variable.html#a328cd221e75f4bd92e3ccf406f0d0441">object</a> ? <span class="stringliteral">&quot;=&gt;&quot;</span> : <span class="stringliteral">&quot;=&quot;</span>), var-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, var-&gt;<a class="code" href="structast__variable.html#a6e4312227f9a7570709abf7f686f1cfe">sameline</a>-&gt;<a class="code" href="structast__comment.html#adfc7bf9f42a9a3b2a61d704e97853ba6">cmt</a>);
<a name="l01767"></a>01767             <span class="keywordflow">else</span>  
<a name="l01768"></a>01768                fprintf(f, <span class="stringliteral">&quot;%s %s %s\n&quot;</span>, var-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, (var-&gt;<a class="code" href="structast__variable.html#a328cd221e75f4bd92e3ccf406f0d0441">object</a> ? <span class="stringliteral">&quot;=&gt;&quot;</span> : <span class="stringliteral">&quot;=&quot;</span>), var-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l01769"></a>01769             <span class="keywordflow">for</span> (cmt = var-&gt;<a class="code" href="structast__variable.html#ab09dbd177767543015efa3ba28fab03a">trailing</a>; cmt; cmt=cmt-&gt;<a class="code" href="structast__comment.html#adab84eadfeb3d2c35ac0a185b9345e8f">next</a>) {
<a name="l01770"></a>01770                <span class="keywordflow">if</span> (cmt-&gt;<a class="code" href="structast__comment.html#adfc7bf9f42a9a3b2a61d704e97853ba6">cmt</a>[0] != <span class="charliteral">&apos;;&apos;</span> || cmt-&gt;<a class="code" href="structast__comment.html#adfc7bf9f42a9a3b2a61d704e97853ba6">cmt</a>[1] != <span class="charliteral">&apos;!&apos;</span>)
<a name="l01771"></a>01771                   fprintf(f,<span class="stringliteral">&quot;%s&quot;</span>, cmt-&gt;<a class="code" href="structast__comment.html#adfc7bf9f42a9a3b2a61d704e97853ba6">cmt</a>);
<a name="l01772"></a>01772             }
<a name="l01773"></a>01773             <span class="keywordflow">if</span> (var-&gt;<a class="code" href="structast__variable.html#ade071f6f4a7bc0deb43008bd448ac46e">blanklines</a>) {
<a name="l01774"></a>01774                blanklines = var-&gt;<a class="code" href="structast__variable.html#ade071f6f4a7bc0deb43008bd448ac46e">blanklines</a>;
<a name="l01775"></a>01775                <span class="keywordflow">while</span> (blanklines--)
<a name="l01776"></a>01776                   fprintf(f, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01777"></a>01777             }
<a name="l01778"></a>01778             
<a name="l01779"></a>01779             fclose(f);
<a name="l01780"></a>01780             <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(fi,-1); <span class="comment">/* we are giving up this reference to the object ptd to by fi */</span>
<a name="l01781"></a>01781             fi = 0;
<a name="l01782"></a>01782             
<a name="l01783"></a>01783             var = var-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>;
<a name="l01784"></a>01784          }
<a name="l01785"></a>01785          cat = cat-&gt;<a class="code" href="structast__category.html#a0a4a1c6e5b4ed640d4bb7c697df91212">next</a>;
<a name="l01786"></a>01786       }
<a name="l01787"></a>01787       <span class="keywordflow">if</span> (!<a class="code" href="group__main__options.html#ga40f8fb2e731031d99f732f515cec680f">option_debug</a>)
<a name="l01788"></a>01788          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Saved\n&quot;</span>);
<a name="l01789"></a>01789    } <span class="keywordflow">else</span> {
<a name="l01790"></a>01790       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Unable to open for writing: %s\n&quot;</span>, fn);
<a name="l01791"></a>01791       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Unable to write (%s)&quot;</span>, strerror(<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l01792"></a>01792       <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(fi,-1); <span class="comment">/* we are giving up this reference to the object ptd to by fi */</span>
<a name="l01793"></a>01793       <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(fileset, -1);
<a name="l01794"></a>01794       <span class="keywordflow">return</span> -1;
<a name="l01795"></a>01795    }
<a name="l01796"></a>01796 
<a name="l01797"></a>01797    <span class="comment">/* Now, for files with trailing #include/#exec statements,</span>
<a name="l01798"></a>01798 <span class="comment">      we have to make sure every entry is output */</span>
<a name="l01799"></a>01799 
<a name="l01800"></a>01800    <span class="keywordflow">for</span> (incl=cfg-&gt;<a class="code" href="structast__config.html#acb049f8b410c47aebfde624a7de10819">includes</a>; incl; incl = incl-&gt;<a class="code" href="structast__config__include.html#ae2104fb51ee9f10eb0006df77fb8d504">next</a>) {
<a name="l01801"></a>01801       <span class="keywordflow">if</span> (!incl-&gt;<a class="code" href="structast__config__include.html#a76a055a540e12c7206a5004afea1f66e">output</a>) {
<a name="l01802"></a>01802          <span class="comment">/* open the respective file */</span>
<a name="l01803"></a>01803          <a class="code" href="config_8c.html#ac254b8e1045d65f111e303ccdc14c437">set_fn</a>(fn, <span class="keyword">sizeof</span>(fn), incl-&gt;<a class="code" href="structast__config__include.html#ad2a400871412e45079d5b0b09dbe34be">include_location_file</a>, configfile, fileset, &amp;fi);
<a name="l01804"></a>01804          f = fopen(fn, <span class="stringliteral">&quot;a&quot;</span>);
<a name="l01805"></a>01805          <span class="keywordflow">if</span> (!f)
<a name="l01806"></a>01806          {
<a name="l01807"></a>01807             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Unable to open for writing: %s\n&quot;</span>, fn);
<a name="l01808"></a>01808             <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Unable to write %s (%s)&quot;</span>, fn, strerror(<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l01809"></a>01809             <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(fi,-1); <span class="comment">/* we are giving up this reference to the object ptd to by fi */</span>
<a name="l01810"></a>01810             fi = 0;
<a name="l01811"></a>01811             <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(fileset, -1);
<a name="l01812"></a>01812             <span class="keywordflow">return</span> -1;
<a name="l01813"></a>01813          }
<a name="l01814"></a>01814          
<a name="l01815"></a>01815          <span class="comment">/* output the respective include */</span>
<a name="l01816"></a>01816          <span class="keywordflow">if</span> (incl-&gt;<a class="code" href="structast__config__include.html#a4fb0f078574c9bdeeaee433d411298c9">exec</a>)
<a name="l01817"></a>01817             fprintf(f,<span class="stringliteral">&quot;#exec \&quot;%s\&quot;\n&quot;</span>, incl-&gt;<a class="code" href="structast__config__include.html#ac06a64b674f41fa8d0d3c86b9dffa3c4">exec_file</a>);
<a name="l01818"></a>01818          <span class="keywordflow">else</span>
<a name="l01819"></a>01819             fprintf(f,<span class="stringliteral">&quot;#include \&quot;%s\&quot;\n&quot;</span>, incl-&gt;<a class="code" href="structast__config__include.html#a5d894d3ac3a63ddbe13305c29b0aceb8">included_file</a>);
<a name="l01820"></a>01820          fclose(f);
<a name="l01821"></a>01821          incl-&gt;<a class="code" href="structast__config__include.html#a76a055a540e12c7206a5004afea1f66e">output</a> = 1;
<a name="l01822"></a>01822          <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(fi,-1); <span class="comment">/* we are giving up this reference to the object ptd to by fi */</span>
<a name="l01823"></a>01823          fi = 0;
<a name="l01824"></a>01824       }
<a name="l01825"></a>01825    }
<a name="l01826"></a>01826    <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(fileset, -1); <span class="comment">/* this should destroy the hash container */</span>
<a name="l01827"></a>01827             
<a name="l01828"></a>01828    <span class="keywordflow">return</span> 0;
<a name="l01829"></a>01829 }
<a name="l01830"></a>01830 
<a name="l01831"></a><a class="code" href="config_8c.html#a95ded332420e035d20a10e0be4722f62">01831</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="config_8c.html#a95ded332420e035d20a10e0be4722f62">clear_config_maps</a>(<span class="keywordtype">void</span>) 
<a name="l01832"></a>01832 {
<a name="l01833"></a>01833    <span class="keyword">struct </span><a class="code" href="structast__config__map.html">ast_config_map</a> *<a class="code" href="misdn__config_8c.html#a92a7399cbb76f6349df98d9432ad52c6">map</a>;
<a name="l01834"></a>01834 
<a name="l01835"></a>01835    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;<a class="code" href="config_8c.html#a502fc4d80b1f4d10bc516dbd85f9bd93">config_lock</a>);
<a name="l01836"></a>01836 
<a name="l01837"></a>01837    <span class="keywordflow">while</span> (<a class="code" href="config_8c.html#aac242c96b19f1c7a0ecfb2c6c45cac4f">config_maps</a>) {
<a name="l01838"></a>01838       map = <a class="code" href="config_8c.html#aac242c96b19f1c7a0ecfb2c6c45cac4f">config_maps</a>;
<a name="l01839"></a>01839       <a class="code" href="config_8c.html#aac242c96b19f1c7a0ecfb2c6c45cac4f">config_maps</a> = <a class="code" href="config_8c.html#aac242c96b19f1c7a0ecfb2c6c45cac4f">config_maps</a>-&gt;<a class="code" href="structast__config__map.html#a116d426c4bbd073eec3caf2455b6c576">next</a>;
<a name="l01840"></a>01840       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(map);
<a name="l01841"></a>01841    }
<a name="l01842"></a>01842       
<a name="l01843"></a>01843    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="config_8c.html#a502fc4d80b1f4d10bc516dbd85f9bd93">config_lock</a>);
<a name="l01844"></a>01844 }
<a name="l01845"></a>01845 
<a name="l01846"></a><a class="code" href="config_8c.html#ac64061a3be3eb5639fce12c74a350014">01846</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="config_8c.html#ac64061a3be3eb5639fce12c74a350014">append_mapping</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structast__config__map.html#a129a7813daee3387f3932182eb7dc3f7">driver</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structast__config__map.html#a8a48a6504d4d5a43bd3ab452ee0e8cb4">database</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="cdr__odbc_8c.html#a68d1e6e752f2cf81551fac543cae108a">table</a>)
<a name="l01847"></a>01847 {
<a name="l01848"></a>01848    <span class="keyword">struct </span><a class="code" href="structast__config__map.html">ast_config_map</a> *<a class="code" href="misdn__config_8c.html#a92a7399cbb76f6349df98d9432ad52c6">map</a>;
<a name="l01849"></a>01849    <span class="keywordtype">int</span> length;
<a name="l01850"></a>01850 
<a name="l01851"></a>01851    length = <span class="keyword">sizeof</span>(*map);
<a name="l01852"></a>01852    length += strlen(name) + 1;
<a name="l01853"></a>01853    length += strlen(driver) + 1;
<a name="l01854"></a>01854    length += strlen(database) + 1;
<a name="l01855"></a>01855    <span class="keywordflow">if</span> (table)
<a name="l01856"></a>01856       length += strlen(table) + 1;
<a name="l01857"></a>01857 
<a name="l01858"></a>01858    <span class="keywordflow">if</span> (!(map = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, length)))
<a name="l01859"></a>01859       <span class="keywordflow">return</span> -1;
<a name="l01860"></a>01860 
<a name="l01861"></a>01861    map-&gt;<a class="code" href="structast__config__map.html#a5ac083a645d964373f022d03df4849c8">name</a> = map-&gt;<a class="code" href="structast__config__map.html#a7af2365ea6fa5bbbf507c1666e946824">stuff</a>;
<a name="l01862"></a>01862    strcpy(map-&gt;<a class="code" href="structast__config__map.html#a5ac083a645d964373f022d03df4849c8">name</a>, name);
<a name="l01863"></a>01863    map-&gt;<a class="code" href="structast__config__map.html#a129a7813daee3387f3932182eb7dc3f7">driver</a> = map-&gt;<a class="code" href="structast__config__map.html#a5ac083a645d964373f022d03df4849c8">name</a> + strlen(map-&gt;<a class="code" href="structast__config__map.html#a5ac083a645d964373f022d03df4849c8">name</a>) + 1;
<a name="l01864"></a>01864    strcpy(map-&gt;<a class="code" href="structast__config__map.html#a129a7813daee3387f3932182eb7dc3f7">driver</a>, driver);
<a name="l01865"></a>01865    map-&gt;<a class="code" href="structast__config__map.html#a8a48a6504d4d5a43bd3ab452ee0e8cb4">database</a> = map-&gt;<a class="code" href="structast__config__map.html#a129a7813daee3387f3932182eb7dc3f7">driver</a> + strlen(map-&gt;<a class="code" href="structast__config__map.html#a129a7813daee3387f3932182eb7dc3f7">driver</a>) + 1;
<a name="l01866"></a>01866    strcpy(map-&gt;<a class="code" href="structast__config__map.html#a8a48a6504d4d5a43bd3ab452ee0e8cb4">database</a>, database);
<a name="l01867"></a>01867    <span class="keywordflow">if</span> (table) {
<a name="l01868"></a>01868       map-&gt;<a class="code" href="structast__config__map.html#abc4810aa7718733bfc48b1973f4c92f8">table</a> = map-&gt;<a class="code" href="structast__config__map.html#a8a48a6504d4d5a43bd3ab452ee0e8cb4">database</a> + strlen(map-&gt;<a class="code" href="structast__config__map.html#a8a48a6504d4d5a43bd3ab452ee0e8cb4">database</a>) + 1;
<a name="l01869"></a>01869       strcpy(map-&gt;<a class="code" href="structast__config__map.html#abc4810aa7718733bfc48b1973f4c92f8">table</a>, table);
<a name="l01870"></a>01870    }
<a name="l01871"></a>01871    map-&gt;<a class="code" href="structast__config__map.html#a116d426c4bbd073eec3caf2455b6c576">next</a> = <a class="code" href="config_8c.html#aac242c96b19f1c7a0ecfb2c6c45cac4f">config_maps</a>;
<a name="l01872"></a>01872 
<a name="l01873"></a>01873    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Binding %s to %s/%s/%s\n&quot;</span>, map-&gt;<a class="code" href="structast__config__map.html#a5ac083a645d964373f022d03df4849c8">name</a>, map-&gt;<a class="code" href="structast__config__map.html#a129a7813daee3387f3932182eb7dc3f7">driver</a>, map-&gt;<a class="code" href="structast__config__map.html#a8a48a6504d4d5a43bd3ab452ee0e8cb4">database</a>, map-&gt;<a class="code" href="structast__config__map.html#abc4810aa7718733bfc48b1973f4c92f8">table</a> ? map-&gt;<a class="code" href="structast__config__map.html#abc4810aa7718733bfc48b1973f4c92f8">table</a> : map-&gt;<a class="code" href="structast__config__map.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l01874"></a>01874 
<a name="l01875"></a>01875    <a class="code" href="config_8c.html#aac242c96b19f1c7a0ecfb2c6c45cac4f">config_maps</a> = map;
<a name="l01876"></a>01876    <span class="keywordflow">return</span> 0;
<a name="l01877"></a>01877 }
<a name="l01878"></a>01878 
<a name="l01879"></a><a class="code" href="config_8c.html#a07c61425fd6ef97bb27383e493fdf553">01879</a> <span class="keywordtype">int</span> <a class="code" href="config_8h.html#a07c61425fd6ef97bb27383e493fdf553" title="Exposed re-initialization method for core process This method is intended for use...">read_config_maps</a>(<span class="keywordtype">void</span>) 
<a name="l01880"></a>01880 {
<a name="l01881"></a>01881    <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *<a class="code" href="cdr__csv_8c.html#a74bb62276efdf39dd94048e007fca05b">config</a>, *configtmp;
<a name="l01882"></a>01882    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *v;
<a name="l01883"></a>01883    <span class="keywordtype">char</span> *driver, *<a class="code" href="cdr__odbc_8c.html#a68d1e6e752f2cf81551fac543cae108a">table</a>, *database, *stringp, *tmp;
<a name="l01884"></a>01884    <span class="keyword">struct </span><a class="code" href="structast__flags.html" title="Structure used to handle boolean flags.">ast_flags</a> flags = { 0 };
<a name="l01885"></a>01885 
<a name="l01886"></a>01886    <a class="code" href="config_8c.html#a95ded332420e035d20a10e0be4722f62">clear_config_maps</a>();
<a name="l01887"></a>01887 
<a name="l01888"></a>01888    configtmp = <a class="code" href="config_8h.html#a45e1a284d7d84c4b4a316764fbb887fb" title="Create a new base configuration structure.">ast_config_new</a>();
<a name="l01889"></a>01889    configtmp-&gt;<a class="code" href="structast__config.html#a98a1a362d95d774ba9bf42efd1706700">max_include_level</a> = 1;
<a name="l01890"></a>01890    config = <a class="code" href="config_8h.html#a721d5cd60abda2bdd96838336dc09669">ast_config_internal_load</a>(extconfig_conf, configtmp, flags, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;extconfig&quot;</span>);
<a name="l01891"></a>01891    <span class="keywordflow">if</span> (!config) {
<a name="l01892"></a>01892       <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(configtmp);
<a name="l01893"></a>01893       <span class="keywordflow">return</span> 0;
<a name="l01894"></a>01894    }
<a name="l01895"></a>01895 
<a name="l01896"></a>01896    <span class="keywordflow">for</span> (v = <a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(config, <span class="stringliteral">&quot;settings&quot;</span>); v; v = v-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l01897"></a>01897       <span class="keywordtype">char</span> <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[512];
<a name="l01898"></a>01898       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(buf, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(buf));
<a name="l01899"></a>01899       stringp = buf;
<a name="l01900"></a>01900       driver = <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;stringp, <span class="stringliteral">&quot;,&quot;</span>);
<a name="l01901"></a>01901 
<a name="l01902"></a>01902       <span class="keywordflow">if</span> ((tmp = strchr(stringp, <span class="charliteral">&apos;\&quot;&apos;</span>)))
<a name="l01903"></a>01903          stringp = tmp;
<a name="l01904"></a>01904 
<a name="l01905"></a>01905       <span class="comment">/* check if the database text starts with a double quote */</span>
<a name="l01906"></a>01906       <span class="keywordflow">if</span> (*stringp == <span class="charliteral">&apos;&quot;&apos;</span>) {
<a name="l01907"></a>01907          stringp++;
<a name="l01908"></a>01908          database = <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;stringp, <span class="stringliteral">&quot;\&quot;&quot;</span>);
<a name="l01909"></a>01909          <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;stringp, <span class="stringliteral">&quot;,&quot;</span>);
<a name="l01910"></a>01910       } <span class="keywordflow">else</span> {
<a name="l01911"></a>01911          <span class="comment">/* apparently this text has no quotes */</span>
<a name="l01912"></a>01912          database = <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;stringp, <span class="stringliteral">&quot;,&quot;</span>);
<a name="l01913"></a>01913       }
<a name="l01914"></a>01914 
<a name="l01915"></a>01915       table = <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;stringp, <span class="stringliteral">&quot;,&quot;</span>);
<a name="l01916"></a>01916 
<a name="l01917"></a>01917       <span class="keywordflow">if</span> (!strcmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, extconfig_conf)) {
<a name="l01918"></a>01918          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Cannot bind &apos;%s&apos;!\n&quot;</span>, extconfig_conf);
<a name="l01919"></a>01919          <span class="keywordflow">continue</span>;
<a name="l01920"></a>01920       }
<a name="l01921"></a>01921 
<a name="l01922"></a>01922       <span class="keywordflow">if</span> (!strcmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;asterisk.conf&quot;</span>)) {
<a name="l01923"></a>01923          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Cannot bind &apos;asterisk.conf&apos;!\n&quot;</span>);
<a name="l01924"></a>01924          <span class="keywordflow">continue</span>;
<a name="l01925"></a>01925       }
<a name="l01926"></a>01926 
<a name="l01927"></a>01927       <span class="keywordflow">if</span> (!strcmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;logger.conf&quot;</span>)) {
<a name="l01928"></a>01928          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Cannot bind &apos;logger.conf&apos;!\n&quot;</span>);
<a name="l01929"></a>01929          <span class="keywordflow">continue</span>;
<a name="l01930"></a>01930       }
<a name="l01931"></a>01931 
<a name="l01932"></a>01932       <span class="keywordflow">if</span> (!driver || !database)
<a name="l01933"></a>01933          <span class="keywordflow">continue</span>;
<a name="l01934"></a>01934       <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;sipfriends&quot;</span>)) {
<a name="l01935"></a>01935          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;The &apos;sipfriends&apos; table is obsolete, update your config to use sipusers and sippeers, though they can point to the same table.\n&quot;</span>);
<a name="l01936"></a>01936          <a class="code" href="config_8c.html#ac64061a3be3eb5639fce12c74a350014">append_mapping</a>(<span class="stringliteral">&quot;sipusers&quot;</span>, driver, database, table ? table : <span class="stringliteral">&quot;sipfriends&quot;</span>);
<a name="l01937"></a>01937          <a class="code" href="config_8c.html#ac64061a3be3eb5639fce12c74a350014">append_mapping</a>(<span class="stringliteral">&quot;sippeers&quot;</span>, driver, database, table ? table : <span class="stringliteral">&quot;sipfriends&quot;</span>);
<a name="l01938"></a>01938       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;iaxfriends&quot;</span>)) {
<a name="l01939"></a>01939          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;The &apos;iaxfriends&apos; table is obsolete, update your config to use iaxusers and iaxpeers, though they can point to the same table.\n&quot;</span>);
<a name="l01940"></a>01940          <a class="code" href="config_8c.html#ac64061a3be3eb5639fce12c74a350014">append_mapping</a>(<span class="stringliteral">&quot;iaxusers&quot;</span>, driver, database, table ? table : <span class="stringliteral">&quot;iaxfriends&quot;</span>);
<a name="l01941"></a>01941          <a class="code" href="config_8c.html#ac64061a3be3eb5639fce12c74a350014">append_mapping</a>(<span class="stringliteral">&quot;iaxpeers&quot;</span>, driver, database, table ? table : <span class="stringliteral">&quot;iaxfriends&quot;</span>);
<a name="l01942"></a>01942       } <span class="keywordflow">else</span> 
<a name="l01943"></a>01943          <a class="code" href="config_8c.html#ac64061a3be3eb5639fce12c74a350014">append_mapping</a>(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, driver, database, table);
<a name="l01944"></a>01944    }
<a name="l01945"></a>01945       
<a name="l01946"></a>01946    <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(config);
<a name="l01947"></a>01947    <span class="keywordflow">return</span> 0;
<a name="l01948"></a>01948 }
<a name="l01949"></a>01949 
<a name="l01950"></a><a class="code" href="config_8c.html#a8201e9523f26fba61c6b899aa6c1fdc6">01950</a> <span class="keywordtype">int</span> <a class="code" href="config_8h.html#af15c271e1708b251fc938b30baba18f1" title="Register config engine.">ast_config_engine_register</a>(<span class="keyword">struct</span> <a class="code" href="structast__config__engine.html" title="Configuration engine structure, used to define realtime drivers.">ast_config_engine</a> *<span class="keyword">new</span>) 
<a name="l01951"></a>01951 {
<a name="l01952"></a>01952    <span class="keyword">struct </span><a class="code" href="structast__config__engine.html" title="Configuration engine structure, used to define realtime drivers.">ast_config_engine</a> *ptr;
<a name="l01953"></a>01953 
<a name="l01954"></a>01954    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;<a class="code" href="config_8c.html#a502fc4d80b1f4d10bc516dbd85f9bd93">config_lock</a>);
<a name="l01955"></a>01955 
<a name="l01956"></a>01956    <span class="keywordflow">if</span> (!config_engine_list) {
<a name="l01957"></a>01957       config_engine_list = <span class="keyword">new</span>;
<a name="l01958"></a>01958    } <span class="keywordflow">else</span> {
<a name="l01959"></a>01959       <span class="keywordflow">for</span> (ptr = config_engine_list; ptr-&gt;<a class="code" href="structast__config__engine.html#a2fccbe2a64d67715a7e133fbd4078902">next</a>; ptr=ptr-&gt;<a class="code" href="structast__config__engine.html#a2fccbe2a64d67715a7e133fbd4078902">next</a>);
<a name="l01960"></a>01960       ptr-&gt;<a class="code" href="structast__config__engine.html#a2fccbe2a64d67715a7e133fbd4078902">next</a> = <span class="keyword">new</span>;
<a name="l01961"></a>01961    }
<a name="l01962"></a>01962 
<a name="l01963"></a>01963    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="config_8c.html#a502fc4d80b1f4d10bc516dbd85f9bd93">config_lock</a>);
<a name="l01964"></a>01964    <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;Registered Config Engine %s\n&quot;</span>, new-&gt;name);
<a name="l01965"></a>01965 
<a name="l01966"></a>01966    <span class="keywordflow">return</span> 1;
<a name="l01967"></a>01967 }
<a name="l01968"></a>01968 
<a name="l01969"></a><a class="code" href="config_8c.html#a7028ff4b11d7167ee4030b4d3e123d76">01969</a> <span class="keywordtype">int</span> <a class="code" href="config_8h.html#a7028ff4b11d7167ee4030b4d3e123d76" title="Deregister config engine.">ast_config_engine_deregister</a>(<span class="keyword">struct</span> <a class="code" href="structast__config__engine.html" title="Configuration engine structure, used to define realtime drivers.">ast_config_engine</a> *del) 
<a name="l01970"></a>01970 {
<a name="l01971"></a>01971    <span class="keyword">struct </span><a class="code" href="structast__config__engine.html" title="Configuration engine structure, used to define realtime drivers.">ast_config_engine</a> *ptr, *<a class="code" href="devicestate_8c.html#a43a8def62ee15449794285cbbc0f79af">last</a>=NULL;
<a name="l01972"></a>01972 
<a name="l01973"></a>01973    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;<a class="code" href="config_8c.html#a502fc4d80b1f4d10bc516dbd85f9bd93">config_lock</a>);
<a name="l01974"></a>01974 
<a name="l01975"></a>01975    <span class="keywordflow">for</span> (ptr = config_engine_list; ptr; ptr=ptr-&gt;<a class="code" href="structast__config__engine.html#a2fccbe2a64d67715a7e133fbd4078902">next</a>) {
<a name="l01976"></a>01976       <span class="keywordflow">if</span> (ptr == del) {
<a name="l01977"></a>01977          <span class="keywordflow">if</span> (last)
<a name="l01978"></a>01978             last-&gt;<a class="code" href="structast__config__engine.html#a2fccbe2a64d67715a7e133fbd4078902">next</a> = ptr-&gt;<a class="code" href="structast__config__engine.html#a2fccbe2a64d67715a7e133fbd4078902">next</a>;
<a name="l01979"></a>01979          <span class="keywordflow">else</span>
<a name="l01980"></a>01980             config_engine_list = ptr-&gt;<a class="code" href="structast__config__engine.html#a2fccbe2a64d67715a7e133fbd4078902">next</a>;
<a name="l01981"></a>01981          <span class="keywordflow">break</span>;
<a name="l01982"></a>01982       }
<a name="l01983"></a>01983       last = ptr;
<a name="l01984"></a>01984    }
<a name="l01985"></a>01985 
<a name="l01986"></a>01986    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="config_8c.html#a502fc4d80b1f4d10bc516dbd85f9bd93">config_lock</a>);
<a name="l01987"></a>01987 
<a name="l01988"></a>01988    <span class="keywordflow">return</span> 0;
<a name="l01989"></a>01989 }
<a name="l01990"></a>01990 <span class="comment"></span>
<a name="l01991"></a>01991 <span class="comment">/*! \brief Find realtime engine for realtime family */</span>
<a name="l01992"></a><a class="code" href="config_8c.html#a8cf64b0a69a5440faa7f1c01e6232cfa">01992</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structast__config__engine.html" title="Configuration engine structure, used to define realtime drivers.">ast_config_engine</a> *<a class="code" href="config_8c.html#a8cf64b0a69a5440faa7f1c01e6232cfa" title="Find realtime engine for realtime family.">find_engine</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *family, <span class="keywordtype">char</span> *database, <span class="keywordtype">int</span> dbsiz, <span class="keywordtype">char</span> *<a class="code" href="cdr__odbc_8c.html#a68d1e6e752f2cf81551fac543cae108a">table</a>, <span class="keywordtype">int</span> tabsiz) 
<a name="l01993"></a>01993 {
<a name="l01994"></a>01994    <span class="keyword">struct </span><a class="code" href="structast__config__engine.html" title="Configuration engine structure, used to define realtime drivers.">ast_config_engine</a> *eng, *ret = NULL;
<a name="l01995"></a>01995    <span class="keyword">struct </span><a class="code" href="structast__config__map.html">ast_config_map</a> *<a class="code" href="misdn__config_8c.html#a92a7399cbb76f6349df98d9432ad52c6">map</a>;
<a name="l01996"></a>01996 
<a name="l01997"></a>01997    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;<a class="code" href="config_8c.html#a502fc4d80b1f4d10bc516dbd85f9bd93">config_lock</a>);
<a name="l01998"></a>01998 
<a name="l01999"></a>01999    <span class="keywordflow">for</span> (map = <a class="code" href="config_8c.html#aac242c96b19f1c7a0ecfb2c6c45cac4f">config_maps</a>; map; map = map-&gt;<a class="code" href="structast__config__map.html#a116d426c4bbd073eec3caf2455b6c576">next</a>) {
<a name="l02000"></a>02000       <span class="keywordflow">if</span> (!strcasecmp(family, map-&gt;<a class="code" href="structast__config__map.html#a5ac083a645d964373f022d03df4849c8">name</a>)) {
<a name="l02001"></a>02001          <span class="keywordflow">if</span> (database)
<a name="l02002"></a>02002             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(database, map-&gt;<a class="code" href="structast__config__map.html#a8a48a6504d4d5a43bd3ab452ee0e8cb4">database</a>, dbsiz);
<a name="l02003"></a>02003          <span class="keywordflow">if</span> (table)
<a name="l02004"></a>02004             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(table, map-&gt;<a class="code" href="structast__config__map.html#abc4810aa7718733bfc48b1973f4c92f8">table</a> ? map-&gt;<a class="code" href="structast__config__map.html#abc4810aa7718733bfc48b1973f4c92f8">table</a> : family, tabsiz);
<a name="l02005"></a>02005          <span class="keywordflow">break</span>;
<a name="l02006"></a>02006       }
<a name="l02007"></a>02007    }
<a name="l02008"></a>02008 
<a name="l02009"></a>02009    <span class="comment">/* Check if the required driver (engine) exist */</span>
<a name="l02010"></a>02010    <span class="keywordflow">if</span> (map) {
<a name="l02011"></a>02011       <span class="keywordflow">for</span> (eng = config_engine_list; !ret &amp;&amp; eng; eng = eng-&gt;<a class="code" href="structast__config__engine.html#a2fccbe2a64d67715a7e133fbd4078902">next</a>) {
<a name="l02012"></a>02012          <span class="keywordflow">if</span> (!strcasecmp(eng-&gt;name, map-&gt;<a class="code" href="structast__config__map.html#a129a7813daee3387f3932182eb7dc3f7">driver</a>))
<a name="l02013"></a>02013             ret = eng;
<a name="l02014"></a>02014       }
<a name="l02015"></a>02015    }
<a name="l02016"></a>02016 
<a name="l02017"></a>02017    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="config_8c.html#a502fc4d80b1f4d10bc516dbd85f9bd93">config_lock</a>);
<a name="l02018"></a>02018    
<a name="l02019"></a>02019    <span class="comment">/* if we found a mapping, but the engine is not available, then issue a warning */</span>
<a name="l02020"></a>02020    <span class="keywordflow">if</span> (map &amp;&amp; !ret)
<a name="l02021"></a>02021       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Realtime mapping for &apos;%s&apos; found to engine &apos;%s&apos;, but the engine is not available\n&quot;</span>, map-&gt;<a class="code" href="structast__config__map.html#a5ac083a645d964373f022d03df4849c8">name</a>, map-&gt;<a class="code" href="structast__config__map.html#a129a7813daee3387f3932182eb7dc3f7">driver</a>);
<a name="l02022"></a>02022 
<a name="l02023"></a>02023    <span class="keywordflow">return</span> ret;
<a name="l02024"></a>02024 }
<a name="l02025"></a>02025 
<a name="l02026"></a><a class="code" href="config_8c.html#afbb92ca9cc023bb4f0ffdf3203b7de98">02026</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structast__config__engine.html" title="Configuration engine structure, used to define realtime drivers.">ast_config_engine</a> <a class="code" href="config_8c.html#afbb92ca9cc023bb4f0ffdf3203b7de98">text_file_engine</a> = {
<a name="l02027"></a>02027    .<a class="code" href="structast__config__engine.html#a5ac083a645d964373f022d03df4849c8">name</a> = <span class="stringliteral">&quot;text&quot;</span>,
<a name="l02028"></a>02028    .load_func = <a class="code" href="config_8c.html#a7b05214a60b036caa88e41b843a3854f">config_text_file_load</a>,
<a name="l02029"></a>02029 };
<a name="l02030"></a>02030 
<a name="l02031"></a><a class="code" href="config_8c.html#a1108bcd22a213582ea97e906629da793">02031</a> <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *<a class="code" href="config_8h.html#a721d5cd60abda2bdd96838336dc09669">ast_config_internal_load</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename, <span class="keyword">struct</span> <a class="code" href="structast__config.html">ast_config</a> *cfg, <span class="keyword">struct</span> <a class="code" href="structast__flags.html" title="Structure used to handle boolean flags.">ast_flags</a> flags, <span class="keyword">const</span> <span class="keywordtype">char</span> *suggested_include_file, <span class="keyword">const</span> <span class="keywordtype">char</span> *who_asked)
<a name="l02032"></a>02032 {
<a name="l02033"></a>02033    <span class="keywordtype">char</span> <a class="code" href="cdr__sqlite_8c.html#a082868565d651c0da1d2f0c194cb3248">db</a>[256];
<a name="l02034"></a>02034    <span class="keywordtype">char</span> <a class="code" href="cdr__odbc_8c.html#a68d1e6e752f2cf81551fac543cae108a">table</a>[256];
<a name="l02035"></a>02035    <span class="keyword">struct </span><a class="code" href="structast__config__engine.html" title="Configuration engine structure, used to define realtime drivers.">ast_config_engine</a> *loader = &amp;text_file_engine;
<a name="l02036"></a>02036    <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *result; 
<a name="l02037"></a>02037 
<a name="l02038"></a>02038    <span class="comment">/* The config file itself bumps include_level by 1 */</span>
<a name="l02039"></a>02039    <span class="keywordflow">if</span> (cfg-&gt;<a class="code" href="structast__config.html#a98a1a362d95d774ba9bf42efd1706700">max_include_level</a> &gt; 0 &amp;&amp; cfg-&gt;<a class="code" href="structast__config.html#a9889e4b9ce57e4055f9c11bacf89e50a">include_level</a> == cfg-&gt;<a class="code" href="structast__config.html#a98a1a362d95d774ba9bf42efd1706700">max_include_level</a> + 1) {
<a name="l02040"></a>02040       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Maximum Include level (%d) exceeded\n&quot;</span>, cfg-&gt;<a class="code" href="structast__config.html#a98a1a362d95d774ba9bf42efd1706700">max_include_level</a>);
<a name="l02041"></a>02041       <span class="keywordflow">return</span> NULL;
<a name="l02042"></a>02042    }
<a name="l02043"></a>02043 
<a name="l02044"></a>02044    cfg-&gt;<a class="code" href="structast__config.html#a9889e4b9ce57e4055f9c11bacf89e50a">include_level</a>++;
<a name="l02045"></a>02045 
<a name="l02046"></a>02046    <span class="keywordflow">if</span> (strcmp(filename, extconfig_conf) &amp;&amp; strcmp(filename, <span class="stringliteral">&quot;asterisk.conf&quot;</span>) &amp;&amp; config_engine_list) {
<a name="l02047"></a>02047       <span class="keyword">struct </span><a class="code" href="structast__config__engine.html" title="Configuration engine structure, used to define realtime drivers.">ast_config_engine</a> *eng;
<a name="l02048"></a>02048 
<a name="l02049"></a>02049       eng = <a class="code" href="config_8c.html#a8cf64b0a69a5440faa7f1c01e6232cfa" title="Find realtime engine for realtime family.">find_engine</a>(filename, db, <span class="keyword">sizeof</span>(db), table, <span class="keyword">sizeof</span>(table));
<a name="l02050"></a>02050 
<a name="l02051"></a>02051 
<a name="l02052"></a>02052       <span class="keywordflow">if</span> (eng &amp;&amp; eng-&gt;<a class="code" href="structast__config__engine.html#a23dbd2b9dbb0dae32ee8e4a89674c954">load_func</a>) {
<a name="l02053"></a>02053          loader = eng;
<a name="l02054"></a>02054       } <span class="keywordflow">else</span> {
<a name="l02055"></a>02055          eng = <a class="code" href="config_8c.html#a8cf64b0a69a5440faa7f1c01e6232cfa" title="Find realtime engine for realtime family.">find_engine</a>(<span class="stringliteral">&quot;global&quot;</span>, db, <span class="keyword">sizeof</span>(db), table, <span class="keyword">sizeof</span>(table));
<a name="l02056"></a>02056          <span class="keywordflow">if</span> (eng &amp;&amp; eng-&gt;<a class="code" href="structast__config__engine.html#a23dbd2b9dbb0dae32ee8e4a89674c954">load_func</a>)
<a name="l02057"></a>02057             loader = eng;
<a name="l02058"></a>02058       }
<a name="l02059"></a>02059    }
<a name="l02060"></a>02060 
<a name="l02061"></a>02061    result = loader-&gt;<a class="code" href="structast__config__engine.html#a23dbd2b9dbb0dae32ee8e4a89674c954">load_func</a>(db, table, filename, cfg, flags, suggested_include_file, who_asked);
<a name="l02062"></a>02062 
<a name="l02063"></a>02063    <span class="keywordflow">if</span> (result &amp;&amp; result != <a class="code" href="config_8h.html#a8d1a63cdf2c7aff22a77b6e75d93b377">CONFIG_STATUS_FILEINVALID</a> &amp;&amp; result != <a class="code" href="config_8h.html#a846844eb2c4eb44554445936b3770711">CONFIG_STATUS_FILEUNCHANGED</a>)
<a name="l02064"></a>02064       result-&gt;<a class="code" href="structast__config.html#a9889e4b9ce57e4055f9c11bacf89e50a">include_level</a>--;
<a name="l02065"></a>02065    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (result != <a class="code" href="config_8h.html#a8d1a63cdf2c7aff22a77b6e75d93b377">CONFIG_STATUS_FILEINVALID</a>)
<a name="l02066"></a>02066       cfg-&gt;<a class="code" href="structast__config.html#a9889e4b9ce57e4055f9c11bacf89e50a">include_level</a>--;
<a name="l02067"></a>02067 
<a name="l02068"></a>02068    <span class="keywordflow">return</span> result;
<a name="l02069"></a>02069 }
<a name="l02070"></a>02070 
<a name="l02071"></a><a class="code" href="config_8c.html#aab3eac8fa82a86a93c074deb7b77dbc9">02071</a> <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *<a class="code" href="config_8h.html#aab3eac8fa82a86a93c074deb7b77dbc9" title="Load a config file.">ast_config_load2</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename, <span class="keyword">const</span> <span class="keywordtype">char</span> *who_asked, <span class="keyword">struct</span> <a class="code" href="structast__flags.html" title="Structure used to handle boolean flags.">ast_flags</a> flags)
<a name="l02072"></a>02072 {
<a name="l02073"></a>02073    <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *cfg;
<a name="l02074"></a>02074    <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *result;
<a name="l02075"></a>02075 
<a name="l02076"></a>02076    cfg = <a class="code" href="config_8h.html#a45e1a284d7d84c4b4a316764fbb887fb" title="Create a new base configuration structure.">ast_config_new</a>();
<a name="l02077"></a>02077    <span class="keywordflow">if</span> (!cfg)
<a name="l02078"></a>02078       <span class="keywordflow">return</span> NULL;
<a name="l02079"></a>02079 
<a name="l02080"></a>02080    result = <a class="code" href="config_8h.html#a721d5cd60abda2bdd96838336dc09669">ast_config_internal_load</a>(filename, cfg, flags, <span class="stringliteral">&quot;&quot;</span>, who_asked);
<a name="l02081"></a>02081    <span class="keywordflow">if</span> (!result || result == <a class="code" href="config_8h.html#a846844eb2c4eb44554445936b3770711">CONFIG_STATUS_FILEUNCHANGED</a> || result == <a class="code" href="config_8h.html#a8d1a63cdf2c7aff22a77b6e75d93b377">CONFIG_STATUS_FILEINVALID</a>)
<a name="l02082"></a>02082       <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(cfg);
<a name="l02083"></a>02083 
<a name="l02084"></a>02084    <span class="keywordflow">return</span> result;
<a name="l02085"></a>02085 }
<a name="l02086"></a>02086 
<a name="l02087"></a><a class="code" href="config_8c.html#aa552f9f0bd23b54d35d1f41fff914876">02087</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *<a class="code" href="config_8c.html#aa552f9f0bd23b54d35d1f41fff914876">ast_load_realtime_helper</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *family, va_list ap)
<a name="l02088"></a>02088 {
<a name="l02089"></a>02089    <span class="keyword">struct </span><a class="code" href="structast__config__engine.html" title="Configuration engine structure, used to define realtime drivers.">ast_config_engine</a> *eng;
<a name="l02090"></a>02090    <span class="keywordtype">char</span> <a class="code" href="cdr__sqlite_8c.html#a082868565d651c0da1d2f0c194cb3248">db</a>[256];
<a name="l02091"></a>02091    <span class="keywordtype">char</span> <a class="code" href="cdr__odbc_8c.html#a68d1e6e752f2cf81551fac543cae108a">table</a>[256];
<a name="l02092"></a>02092    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *res=NULL;
<a name="l02093"></a>02093 
<a name="l02094"></a>02094    eng = <a class="code" href="config_8c.html#a8cf64b0a69a5440faa7f1c01e6232cfa" title="Find realtime engine for realtime family.">find_engine</a>(family, db, <span class="keyword">sizeof</span>(db), table, <span class="keyword">sizeof</span>(table));
<a name="l02095"></a>02095    <span class="keywordflow">if</span> (eng &amp;&amp; eng-&gt;<a class="code" href="structast__config__engine.html#a98cce781b437ae27f208601488a06add">realtime_func</a>) 
<a name="l02096"></a>02096       res = eng-&gt;<a class="code" href="structast__config__engine.html#a98cce781b437ae27f208601488a06add">realtime_func</a>(db, table, ap);
<a name="l02097"></a>02097 
<a name="l02098"></a>02098    <span class="keywordflow">return</span> res;
<a name="l02099"></a>02099 }
<a name="l02100"></a>02100 
<a name="l02101"></a><a class="code" href="config_8c.html#a75283c46d9fa6d6fdbe9a8ed2a3d650a">02101</a> <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *<a class="code" href="config_8h.html#a24f08a53aeabb2db90aa2b98dc485691">ast_load_realtime_all</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *family, ...)
<a name="l02102"></a>02102 {
<a name="l02103"></a>02103    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *res;
<a name="l02104"></a>02104    va_list ap;
<a name="l02105"></a>02105 
<a name="l02106"></a>02106    va_start(ap, family);
<a name="l02107"></a>02107    res = <a class="code" href="config_8c.html#aa552f9f0bd23b54d35d1f41fff914876">ast_load_realtime_helper</a>(family, ap);
<a name="l02108"></a>02108    va_end(ap);
<a name="l02109"></a>02109 
<a name="l02110"></a>02110    <span class="keywordflow">return</span> res;
<a name="l02111"></a>02111 }
<a name="l02112"></a>02112 
<a name="l02113"></a><a class="code" href="config_8c.html#a1a4860dafb270dac58bd7b746c9a11f9">02113</a> <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *<a class="code" href="config_8h.html#a1a03993603e2bc2463153857836645bb" title="Retrieve realtime configuration.">ast_load_realtime</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *family, ...)
<a name="l02114"></a>02114 {
<a name="l02115"></a>02115    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *res, *cur, *prev = NULL, *freeme = NULL;
<a name="l02116"></a>02116    va_list ap;
<a name="l02117"></a>02117 
<a name="l02118"></a>02118    va_start(ap, family);
<a name="l02119"></a>02119    res = <a class="code" href="config_8c.html#aa552f9f0bd23b54d35d1f41fff914876">ast_load_realtime_helper</a>(family, ap);
<a name="l02120"></a>02120    va_end(ap);
<a name="l02121"></a>02121 
<a name="l02122"></a>02122    <span class="comment">/* Eliminate blank entries */</span>
<a name="l02123"></a>02123    <span class="keywordflow">for</span> (cur = res; cur; cur = cur-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l02124"></a>02124       <span class="keywordflow">if</span> (freeme) {
<a name="l02125"></a>02125          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(freeme);
<a name="l02126"></a>02126          freeme = NULL;
<a name="l02127"></a>02127       }
<a name="l02128"></a>02128 
<a name="l02129"></a>02129       <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(cur-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>)) {
<a name="l02130"></a>02130          <span class="keywordflow">if</span> (prev)
<a name="l02131"></a>02131             prev-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a> = cur-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>;
<a name="l02132"></a>02132          <span class="keywordflow">else</span>
<a name="l02133"></a>02133             res = cur-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>;
<a name="l02134"></a>02134          freeme = cur;
<a name="l02135"></a>02135       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cur-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>[0] == <span class="charliteral">&apos; &apos;</span> &amp;&amp; cur-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>[1] == <span class="charliteral">&apos;\0&apos;</span>) {
<a name="l02136"></a>02136          <span class="keywordtype">char</span> *vptr = (<span class="keywordtype">char</span> *) cur-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>;
<a name="l02137"></a>02137          vptr[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l02138"></a>02138          prev = cur;
<a name="l02139"></a>02139       } <span class="keywordflow">else</span> {
<a name="l02140"></a>02140          prev = cur;
<a name="l02141"></a>02141       }
<a name="l02142"></a>02142    }
<a name="l02143"></a>02143    <span class="keywordflow">return</span> res;
<a name="l02144"></a>02144 }
<a name="l02145"></a>02145 <span class="comment"></span>
<a name="l02146"></a>02146 <span class="comment">/*! \brief Check if realtime engine is configured for family */</span>
<a name="l02147"></a><a class="code" href="config_8c.html#a910f835a41772603d33e200c956549ff">02147</a> <span class="keywordtype">int</span> <a class="code" href="config_8h.html#a910f835a41772603d33e200c956549ff" title="Check if realtime engine is configured for family.">ast_check_realtime</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *family)
<a name="l02148"></a>02148 {
<a name="l02149"></a>02149    <span class="keyword">struct </span><a class="code" href="structast__config__engine.html" title="Configuration engine structure, used to define realtime drivers.">ast_config_engine</a> *eng;
<a name="l02150"></a>02150    <span class="keywordflow">if</span> (!<a class="code" href="config_8h.html#a6344200b56202a76de8db05af680f3ac" title="Check if there&amp;#39;s any realtime engines loaded.">ast_realtime_enabled</a>()) {
<a name="l02151"></a>02151       <span class="keywordflow">return</span> 0;   <span class="comment">/* There are no engines at all so fail early */</span>
<a name="l02152"></a>02152    }
<a name="l02153"></a>02153 
<a name="l02154"></a>02154    eng = <a class="code" href="config_8c.html#a8cf64b0a69a5440faa7f1c01e6232cfa" title="Find realtime engine for realtime family.">find_engine</a>(family, NULL, 0, NULL, 0);
<a name="l02155"></a>02155    <span class="keywordflow">if</span> (eng)
<a name="l02156"></a>02156       <span class="keywordflow">return</span> 1;
<a name="l02157"></a>02157    <span class="keywordflow">return</span> 0;
<a name="l02158"></a>02158 }
<a name="l02159"></a>02159 <span class="comment"></span>
<a name="l02160"></a>02160 <span class="comment">/*! \brief Check if there&apos;s any realtime engines loaded */</span>
<a name="l02161"></a><a class="code" href="config_8c.html#a84aff52f734d686e6dc3cd5ef0c9d721">02161</a> <span class="keywordtype">int</span> <a class="code" href="config_8h.html#a6344200b56202a76de8db05af680f3ac" title="Check if there&amp;#39;s any realtime engines loaded.">ast_realtime_enabled</a>()
<a name="l02162"></a>02162 {
<a name="l02163"></a>02163    <span class="keywordflow">return</span> <a class="code" href="config_8c.html#aac242c96b19f1c7a0ecfb2c6c45cac4f">config_maps</a> ? 1 : 0;
<a name="l02164"></a>02164 }
<a name="l02165"></a>02165 
<a name="l02166"></a><a class="code" href="config_8c.html#a3a84c749eb82af155785430f9d5ff795">02166</a> <span class="keywordtype">int</span> <a class="code" href="config_8h.html#a403ec8b49645ea204e82cb72bb8cf9f4" title="Inform realtime what fields that may be stored.">ast_realtime_require_field</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *family, ...)
<a name="l02167"></a>02167 {
<a name="l02168"></a>02168    <span class="keyword">struct </span><a class="code" href="structast__config__engine.html" title="Configuration engine structure, used to define realtime drivers.">ast_config_engine</a> *eng;
<a name="l02169"></a>02169    <span class="keywordtype">char</span> <a class="code" href="cdr__sqlite_8c.html#a082868565d651c0da1d2f0c194cb3248">db</a>[256];
<a name="l02170"></a>02170    <span class="keywordtype">char</span> <a class="code" href="cdr__odbc_8c.html#a68d1e6e752f2cf81551fac543cae108a">table</a>[256];
<a name="l02171"></a>02171    va_list ap;
<a name="l02172"></a>02172    <span class="keywordtype">int</span> res = -1;
<a name="l02173"></a>02173 
<a name="l02174"></a>02174    va_start(ap, family);
<a name="l02175"></a>02175    eng = <a class="code" href="config_8c.html#a8cf64b0a69a5440faa7f1c01e6232cfa" title="Find realtime engine for realtime family.">find_engine</a>(family, db, <span class="keyword">sizeof</span>(db), table, <span class="keyword">sizeof</span>(table));
<a name="l02176"></a>02176    <span class="keywordflow">if</span> (eng &amp;&amp; eng-&gt;<a class="code" href="structast__config__engine.html#ae98837b68863176f4e9ead28e5572bb7">require_func</a>) {
<a name="l02177"></a>02177       res = eng-&gt;<a class="code" href="structast__config__engine.html#ae98837b68863176f4e9ead28e5572bb7">require_func</a>(db, table, ap);
<a name="l02178"></a>02178    }
<a name="l02179"></a>02179    va_end(ap);
<a name="l02180"></a>02180 
<a name="l02181"></a>02181    <span class="keywordflow">return</span> res;
<a name="l02182"></a>02182 }
<a name="l02183"></a>02183 
<a name="l02184"></a><a class="code" href="config_8c.html#a66b6af9ceef39cb23b48501efe87219f">02184</a> <span class="keywordtype">int</span> <a class="code" href="config_8h.html#a66b6af9ceef39cb23b48501efe87219f" title="Release any resources cached for a realtime family.">ast_unload_realtime</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *family)
<a name="l02185"></a>02185 {
<a name="l02186"></a>02186    <span class="keyword">struct </span><a class="code" href="structast__config__engine.html" title="Configuration engine structure, used to define realtime drivers.">ast_config_engine</a> *eng;
<a name="l02187"></a>02187    <span class="keywordtype">char</span> <a class="code" href="cdr__sqlite_8c.html#a082868565d651c0da1d2f0c194cb3248">db</a>[256];
<a name="l02188"></a>02188    <span class="keywordtype">char</span> <a class="code" href="cdr__odbc_8c.html#a68d1e6e752f2cf81551fac543cae108a">table</a>[256];
<a name="l02189"></a>02189    <span class="keywordtype">int</span> res = -1;
<a name="l02190"></a>02190 
<a name="l02191"></a>02191    eng = <a class="code" href="config_8c.html#a8cf64b0a69a5440faa7f1c01e6232cfa" title="Find realtime engine for realtime family.">find_engine</a>(family, db, <span class="keyword">sizeof</span>(db), table, <span class="keyword">sizeof</span>(table));
<a name="l02192"></a>02192    <span class="keywordflow">if</span> (eng &amp;&amp; eng-&gt;<a class="code" href="structast__config__engine.html#a8a7912512dca5b2b99fbbe090f64143b">unload_func</a>) {
<a name="l02193"></a>02193       res = eng-&gt;<a class="code" href="structast__config__engine.html#a8a7912512dca5b2b99fbbe090f64143b">unload_func</a>(db, table);
<a name="l02194"></a>02194    }
<a name="l02195"></a>02195    <span class="keywordflow">return</span> res;
<a name="l02196"></a>02196 }
<a name="l02197"></a>02197 
<a name="l02198"></a><a class="code" href="config_8c.html#addf4a684898fcedb78def59c009a3c1c">02198</a> <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *<a class="code" href="config_8h.html#a29ff8cd717c0c0bac60abbd827fec409" title="Retrieve realtime configuration.">ast_load_realtime_multientry</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *family, ...)
<a name="l02199"></a>02199 {
<a name="l02200"></a>02200    <span class="keyword">struct </span><a class="code" href="structast__config__engine.html" title="Configuration engine structure, used to define realtime drivers.">ast_config_engine</a> *eng;
<a name="l02201"></a>02201    <span class="keywordtype">char</span> <a class="code" href="cdr__sqlite_8c.html#a082868565d651c0da1d2f0c194cb3248">db</a>[256];
<a name="l02202"></a>02202    <span class="keywordtype">char</span> <a class="code" href="cdr__odbc_8c.html#a68d1e6e752f2cf81551fac543cae108a">table</a>[256];
<a name="l02203"></a>02203    <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *res = NULL;
<a name="l02204"></a>02204    va_list ap;
<a name="l02205"></a>02205 
<a name="l02206"></a>02206    va_start(ap, family);
<a name="l02207"></a>02207    eng = <a class="code" href="config_8c.html#a8cf64b0a69a5440faa7f1c01e6232cfa" title="Find realtime engine for realtime family.">find_engine</a>(family, db, <span class="keyword">sizeof</span>(db), table, <span class="keyword">sizeof</span>(table));
<a name="l02208"></a>02208    <span class="keywordflow">if</span> (eng &amp;&amp; eng-&gt;<a class="code" href="structast__config__engine.html#abe8a92c4a05c2b7084a8ad89b558b05f">realtime_multi_func</a>) 
<a name="l02209"></a>02209       res = eng-&gt;<a class="code" href="structast__config__engine.html#abe8a92c4a05c2b7084a8ad89b558b05f">realtime_multi_func</a>(db, table, ap);
<a name="l02210"></a>02210    va_end(ap);
<a name="l02211"></a>02211 
<a name="l02212"></a>02212    <span class="keywordflow">return</span> res;
<a name="l02213"></a>02213 }
<a name="l02214"></a>02214 
<a name="l02215"></a><a class="code" href="config_8c.html#a3608ec87518fa6a253b86fda688dab26">02215</a> <span class="keywordtype">int</span> <a class="code" href="config_8h.html#ab845019b2f1bb324ff57e14192d62c39" title="Update realtime configuration.">ast_update_realtime</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *family, <span class="keyword">const</span> <span class="keywordtype">char</span> *keyfield, <span class="keyword">const</span> <span class="keywordtype">char</span> *lookup, ...)
<a name="l02216"></a>02216 {
<a name="l02217"></a>02217    <span class="keyword">struct </span><a class="code" href="structast__config__engine.html" title="Configuration engine structure, used to define realtime drivers.">ast_config_engine</a> *eng;
<a name="l02218"></a>02218    <span class="keywordtype">int</span> res = -1;
<a name="l02219"></a>02219    <span class="keywordtype">char</span> <a class="code" href="cdr__sqlite_8c.html#a082868565d651c0da1d2f0c194cb3248">db</a>[256];
<a name="l02220"></a>02220    <span class="keywordtype">char</span> <a class="code" href="cdr__odbc_8c.html#a68d1e6e752f2cf81551fac543cae108a">table</a>[256];
<a name="l02221"></a>02221    va_list ap;
<a name="l02222"></a>02222 
<a name="l02223"></a>02223    va_start(ap, lookup);
<a name="l02224"></a>02224    eng = <a class="code" href="config_8c.html#a8cf64b0a69a5440faa7f1c01e6232cfa" title="Find realtime engine for realtime family.">find_engine</a>(family, db, <span class="keyword">sizeof</span>(db), table, <span class="keyword">sizeof</span>(table));
<a name="l02225"></a>02225    <span class="keywordflow">if</span> (eng &amp;&amp; eng-&gt;<a class="code" href="structast__config__engine.html#af2a36658af0c127fa1e2c904a0db5276">update_func</a>) 
<a name="l02226"></a>02226       res = eng-&gt;<a class="code" href="structast__config__engine.html#af2a36658af0c127fa1e2c904a0db5276">update_func</a>(db, table, keyfield, lookup, ap);
<a name="l02227"></a>02227    va_end(ap);
<a name="l02228"></a>02228 
<a name="l02229"></a>02229    <span class="keywordflow">return</span> res;
<a name="l02230"></a>02230 }
<a name="l02231"></a>02231 
<a name="l02232"></a><a class="code" href="config_8c.html#a7f7dcb2d6761da9eb55172dd0dd4e7ca">02232</a> <span class="keywordtype">int</span> <a class="code" href="config_8h.html#a30c75d60cfd1f61e41c7275bb30c77f6" title="Update realtime configuration.">ast_update2_realtime</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *family, ...)
<a name="l02233"></a>02233 {
<a name="l02234"></a>02234    <span class="keyword">struct </span><a class="code" href="structast__config__engine.html" title="Configuration engine structure, used to define realtime drivers.">ast_config_engine</a> *eng;
<a name="l02235"></a>02235    <span class="keywordtype">int</span> res = -1;
<a name="l02236"></a>02236    <span class="keywordtype">char</span> <a class="code" href="cdr__sqlite_8c.html#a082868565d651c0da1d2f0c194cb3248">db</a>[256];
<a name="l02237"></a>02237    <span class="keywordtype">char</span> <a class="code" href="cdr__odbc_8c.html#a68d1e6e752f2cf81551fac543cae108a">table</a>[256];
<a name="l02238"></a>02238    va_list ap;
<a name="l02239"></a>02239 
<a name="l02240"></a>02240    va_start(ap, family);
<a name="l02241"></a>02241    eng = <a class="code" href="config_8c.html#a8cf64b0a69a5440faa7f1c01e6232cfa" title="Find realtime engine for realtime family.">find_engine</a>(family, db, <span class="keyword">sizeof</span>(db), table, <span class="keyword">sizeof</span>(table));
<a name="l02242"></a>02242    <span class="keywordflow">if</span> (eng &amp;&amp; eng-&gt;<a class="code" href="structast__config__engine.html#adfcdf27ee2d95c83b0a1e07f77aa8f4a">update2_func</a>) 
<a name="l02243"></a>02243       res = eng-&gt;<a class="code" href="structast__config__engine.html#adfcdf27ee2d95c83b0a1e07f77aa8f4a">update2_func</a>(db, table, ap);
<a name="l02244"></a>02244    va_end(ap);
<a name="l02245"></a>02245 
<a name="l02246"></a>02246    <span class="keywordflow">return</span> res;
<a name="l02247"></a>02247 }
<a name="l02248"></a>02248 
<a name="l02249"></a><a class="code" href="config_8c.html#a1a70d77d0bbb8a0373988b97481dfe40">02249</a> <span class="keywordtype">int</span> <a class="code" href="config_8h.html#abbd9786e26d09dce06c32a53fd3c0cc2" title="Create realtime configuration.">ast_store_realtime</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *family, ...)
<a name="l02250"></a>02250 {
<a name="l02251"></a>02251    <span class="keyword">struct </span><a class="code" href="structast__config__engine.html" title="Configuration engine structure, used to define realtime drivers.">ast_config_engine</a> *eng;
<a name="l02252"></a>02252    <span class="keywordtype">int</span> res = -1;
<a name="l02253"></a>02253    <span class="keywordtype">char</span> <a class="code" href="cdr__sqlite_8c.html#a082868565d651c0da1d2f0c194cb3248">db</a>[256];
<a name="l02254"></a>02254    <span class="keywordtype">char</span> <a class="code" href="cdr__odbc_8c.html#a68d1e6e752f2cf81551fac543cae108a">table</a>[256];
<a name="l02255"></a>02255    va_list ap;
<a name="l02256"></a>02256 
<a name="l02257"></a>02257    va_start(ap, family);
<a name="l02258"></a>02258    eng = <a class="code" href="config_8c.html#a8cf64b0a69a5440faa7f1c01e6232cfa" title="Find realtime engine for realtime family.">find_engine</a>(family, db, <span class="keyword">sizeof</span>(db), table, <span class="keyword">sizeof</span>(table));
<a name="l02259"></a>02259    <span class="keywordflow">if</span> (eng &amp;&amp; eng-&gt;<a class="code" href="structast__config__engine.html#a9b105fbf374b1e80dc1f23755dbae62d">store_func</a>) 
<a name="l02260"></a>02260       res = eng-&gt;<a class="code" href="structast__config__engine.html#a9b105fbf374b1e80dc1f23755dbae62d">store_func</a>(db, table, ap);
<a name="l02261"></a>02261    va_end(ap);
<a name="l02262"></a>02262 
<a name="l02263"></a>02263    <span class="keywordflow">return</span> res;
<a name="l02264"></a>02264 }
<a name="l02265"></a>02265 
<a name="l02266"></a><a class="code" href="config_8c.html#ab68cced6e1c73f006680dc3b8b7d06c6">02266</a> <span class="keywordtype">int</span> <a class="code" href="config_8h.html#a944fdb5d328401dee4c35ebd413d3bc3" title="Destroy realtime configuration.">ast_destroy_realtime</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *family, <span class="keyword">const</span> <span class="keywordtype">char</span> *keyfield, <span class="keyword">const</span> <span class="keywordtype">char</span> *lookup, ...)
<a name="l02267"></a>02267 {
<a name="l02268"></a>02268    <span class="keyword">struct </span><a class="code" href="structast__config__engine.html" title="Configuration engine structure, used to define realtime drivers.">ast_config_engine</a> *eng;
<a name="l02269"></a>02269    <span class="keywordtype">int</span> res = -1;
<a name="l02270"></a>02270    <span class="keywordtype">char</span> <a class="code" href="cdr__sqlite_8c.html#a082868565d651c0da1d2f0c194cb3248">db</a>[256];
<a name="l02271"></a>02271    <span class="keywordtype">char</span> <a class="code" href="cdr__odbc_8c.html#a68d1e6e752f2cf81551fac543cae108a">table</a>[256];
<a name="l02272"></a>02272    va_list ap;
<a name="l02273"></a>02273 
<a name="l02274"></a>02274    va_start(ap, lookup);
<a name="l02275"></a>02275    eng = <a class="code" href="config_8c.html#a8cf64b0a69a5440faa7f1c01e6232cfa" title="Find realtime engine for realtime family.">find_engine</a>(family, db, <span class="keyword">sizeof</span>(db), table, <span class="keyword">sizeof</span>(table));
<a name="l02276"></a>02276    <span class="keywordflow">if</span> (eng &amp;&amp; eng-&gt;<a class="code" href="structast__config__engine.html#a63baed1acfa0e81b3d6fa172055bcb98">destroy_func</a>) 
<a name="l02277"></a>02277       res = eng-&gt;<a class="code" href="structast__config__engine.html#a63baed1acfa0e81b3d6fa172055bcb98">destroy_func</a>(db, table, keyfield, lookup, ap);
<a name="l02278"></a>02278    va_end(ap);
<a name="l02279"></a>02279 
<a name="l02280"></a>02280    <span class="keywordflow">return</span> res;
<a name="l02281"></a>02281 }
<a name="l02282"></a>02282 <span class="comment"></span>
<a name="l02283"></a>02283 <span class="comment">/*! \brief Helper function to parse arguments</span>
<a name="l02284"></a>02284 <span class="comment"> * See documentation in config.h</span>
<a name="l02285"></a>02285 <span class="comment"> */</span>
<a name="l02286"></a><a class="code" href="config_8c.html#a90bd6d8a1a352de176394007aecce2ba">02286</a> <span class="keywordtype">int</span> <a class="code" href="config_8h.html#a7e9aea581abeaae5d3799367d95284ac" title="The argument parsing routine.">ast_parse_arg</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *arg, <span class="keyword">enum</span> <a class="code" href="config_8h.html#ad60d9d8c34b4f61493c1d85ae02d569f" title="Support code to parse config file arguments.">ast_parse_flags</a> flags,
<a name="l02287"></a>02287    <span class="keywordtype">void</span> *p_result, ...)
<a name="l02288"></a>02288 {
<a name="l02289"></a>02289    va_list ap;
<a name="l02290"></a>02290    <span class="keywordtype">int</span> error = 0;
<a name="l02291"></a>02291 
<a name="l02292"></a>02292    va_start(ap, p_result);
<a name="l02293"></a>02293    <span class="keywordflow">switch</span> (flags &amp; <a class="code" href="config_8h.html#ad60d9d8c34b4f61493c1d85ae02d569faa9556ebb6fa5b8ccfc5b4a062070f343">PARSE_TYPE</a>) {
<a name="l02294"></a>02294    <span class="keywordflow">case</span> <a class="code" href="config_8h.html#ad60d9d8c34b4f61493c1d85ae02d569fabac6774d4b76ec6847b57ccce4822738">PARSE_INT32</a>:
<a name="l02295"></a>02295        {
<a name="l02296"></a>02296       int32_t *result = p_result;
<a name="l02297"></a>02297       int32_t x, def = result ? *result : 0,
<a name="l02298"></a>02298          high = (int32_t)0x7fffffff,
<a name="l02299"></a>02299          low  = (int32_t)0x80000000;
<a name="l02300"></a>02300       <span class="comment">/* optional argument: first default value, then range */</span>
<a name="l02301"></a>02301       <span class="keywordflow">if</span> (flags &amp; <a class="code" href="config_8h.html#ad60d9d8c34b4f61493c1d85ae02d569facc865488860e2c25dd9f80e5473cf760">PARSE_DEFAULT</a>)
<a name="l02302"></a>02302          def = va_arg(ap, int32_t);
<a name="l02303"></a>02303       <span class="keywordflow">if</span> (flags &amp; (<a class="code" href="config_8h.html#ad60d9d8c34b4f61493c1d85ae02d569fa37848843c0c65e9ce998148c2f16d585">PARSE_IN_RANGE</a>|<a class="code" href="config_8h.html#ad60d9d8c34b4f61493c1d85ae02d569fa827151da9f1b81f3fc253fc6e5f3c11b">PARSE_OUT_RANGE</a>)) {
<a name="l02304"></a>02304          <span class="comment">/* range requested, update bounds */</span>
<a name="l02305"></a>02305          low = va_arg(ap, int32_t);
<a name="l02306"></a>02306          high = va_arg(ap, int32_t);
<a name="l02307"></a>02307       }
<a name="l02308"></a>02308       x = strtol(arg, NULL, 0);
<a name="l02309"></a>02309       error = (x &lt; low) || (x &gt; high);
<a name="l02310"></a>02310       <span class="keywordflow">if</span> (flags &amp; <a class="code" href="config_8h.html#ad60d9d8c34b4f61493c1d85ae02d569fa827151da9f1b81f3fc253fc6e5f3c11b">PARSE_OUT_RANGE</a>)
<a name="l02311"></a>02311          error = !error;
<a name="l02312"></a>02312       <span class="keywordflow">if</span> (result)
<a name="l02313"></a>02313          *result  = error ? def : x;
<a name="l02314"></a>02314       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(3,
<a name="l02315"></a>02315          <span class="stringliteral">&quot;extract int from [%s] in [%d, %d] gives [%d](%d)\n&quot;</span>,
<a name="l02316"></a>02316          arg, low, high,
<a name="l02317"></a>02317          result ? *result : x, error);
<a name="l02318"></a>02318       <span class="keywordflow">break</span>;
<a name="l02319"></a>02319        }
<a name="l02320"></a>02320 
<a name="l02321"></a>02321    <span class="keywordflow">case</span> <a class="code" href="config_8h.html#ad60d9d8c34b4f61493c1d85ae02d569fadba5c0b0122c30502fe469a55fea3c4b">PARSE_UINT32</a>:
<a name="l02322"></a>02322        {
<a name="l02323"></a>02323       uint32_t *result = p_result;
<a name="l02324"></a>02324       uint32_t x, def = result ? *result : 0,
<a name="l02325"></a>02325          low = 0, high = (uint32_t)~0;
<a name="l02326"></a>02326       <span class="comment">/* optional argument: first default value, then range */</span>
<a name="l02327"></a>02327       <span class="keywordflow">if</span> (flags &amp; <a class="code" href="config_8h.html#ad60d9d8c34b4f61493c1d85ae02d569facc865488860e2c25dd9f80e5473cf760">PARSE_DEFAULT</a>)
<a name="l02328"></a>02328          def = va_arg(ap, uint32_t);
<a name="l02329"></a>02329       <span class="keywordflow">if</span> (flags &amp; (<a class="code" href="config_8h.html#ad60d9d8c34b4f61493c1d85ae02d569fa37848843c0c65e9ce998148c2f16d585">PARSE_IN_RANGE</a>|<a class="code" href="config_8h.html#ad60d9d8c34b4f61493c1d85ae02d569fa827151da9f1b81f3fc253fc6e5f3c11b">PARSE_OUT_RANGE</a>)) {
<a name="l02330"></a>02330          <span class="comment">/* range requested, update bounds */</span>
<a name="l02331"></a>02331          low = va_arg(ap, uint32_t);
<a name="l02332"></a>02332          high = va_arg(ap, uint32_t);
<a name="l02333"></a>02333       }
<a name="l02334"></a>02334       x = strtoul(arg, NULL, 0);
<a name="l02335"></a>02335       error = (x &lt; low) || (x &gt; high);
<a name="l02336"></a>02336       <span class="keywordflow">if</span> (flags &amp; <a class="code" href="config_8h.html#ad60d9d8c34b4f61493c1d85ae02d569fa827151da9f1b81f3fc253fc6e5f3c11b">PARSE_OUT_RANGE</a>)
<a name="l02337"></a>02337          error = !error;
<a name="l02338"></a>02338       <span class="keywordflow">if</span> (result)
<a name="l02339"></a>02339          *result  = error ? def : x;
<a name="l02340"></a>02340       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(3,
<a name="l02341"></a>02341          <span class="stringliteral">&quot;extract uint from [%s] in [%u, %u] gives [%u](%d)\n&quot;</span>,
<a name="l02342"></a>02342          arg, low, high,
<a name="l02343"></a>02343          result ? *result : x, error);
<a name="l02344"></a>02344       <span class="keywordflow">break</span>;
<a name="l02345"></a>02345        }
<a name="l02346"></a>02346 
<a name="l02347"></a>02347    <span class="keywordflow">case</span> <a class="code" href="config_8h.html#ad60d9d8c34b4f61493c1d85ae02d569fa911811e1ef2b6304138896f842ade7a6">PARSE_DOUBLE</a>:
<a name="l02348"></a>02348        {
<a name="l02349"></a>02349       <span class="keywordtype">double</span> *result = p_result;
<a name="l02350"></a>02350       <span class="keywordtype">double</span> x, def = result ? *result : 0,
<a name="l02351"></a>02351          low = -HUGE_VAL, high = HUGE_VAL;
<a name="l02352"></a>02352 
<a name="l02353"></a>02353       <span class="comment">/* optional argument: first default value, then range */</span>
<a name="l02354"></a>02354       <span class="keywordflow">if</span> (flags &amp; <a class="code" href="config_8h.html#ad60d9d8c34b4f61493c1d85ae02d569facc865488860e2c25dd9f80e5473cf760">PARSE_DEFAULT</a>)
<a name="l02355"></a>02355          def = va_arg(ap, <span class="keywordtype">double</span>);
<a name="l02356"></a>02356       <span class="keywordflow">if</span> (flags &amp; (<a class="code" href="config_8h.html#ad60d9d8c34b4f61493c1d85ae02d569fa37848843c0c65e9ce998148c2f16d585">PARSE_IN_RANGE</a>|<a class="code" href="config_8h.html#ad60d9d8c34b4f61493c1d85ae02d569fa827151da9f1b81f3fc253fc6e5f3c11b">PARSE_OUT_RANGE</a>)) {
<a name="l02357"></a>02357          <span class="comment">/* range requested, update bounds */</span>
<a name="l02358"></a>02358          low = va_arg(ap, <span class="keywordtype">double</span>);
<a name="l02359"></a>02359          high = va_arg(ap, <span class="keywordtype">double</span>);
<a name="l02360"></a>02360       }
<a name="l02361"></a>02361       x = strtod(arg, NULL);
<a name="l02362"></a>02362       error = (x &lt; low) || (x &gt; high);
<a name="l02363"></a>02363       <span class="keywordflow">if</span> (flags &amp; <a class="code" href="config_8h.html#ad60d9d8c34b4f61493c1d85ae02d569fa827151da9f1b81f3fc253fc6e5f3c11b">PARSE_OUT_RANGE</a>)
<a name="l02364"></a>02364          error = !error;
<a name="l02365"></a>02365       <span class="keywordflow">if</span> (result)
<a name="l02366"></a>02366          *result  = error ? def : x;
<a name="l02367"></a>02367       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(3,
<a name="l02368"></a>02368          <span class="stringliteral">&quot;extract double from [%s] in [%f, %f] gives [%f](%d)\n&quot;</span>,
<a name="l02369"></a>02369          arg, low, high,
<a name="l02370"></a>02370          result ? *result : x, error);
<a name="l02371"></a>02371       <span class="keywordflow">break</span>;
<a name="l02372"></a>02372        }
<a name="l02373"></a>02373    <span class="keywordflow">case</span> <a class="code" href="config_8h.html#ad60d9d8c34b4f61493c1d85ae02d569fadbbce4323faf5d2131137e15c1da10f1">PARSE_INADDR</a>:
<a name="l02374"></a>02374        {
<a name="l02375"></a>02375       <span class="keywordtype">char</span> *port, *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>;
<a name="l02376"></a>02376       <span class="keyword">struct </span>sockaddr_in _sa_buf;   <span class="comment">/* buffer for the result */</span>
<a name="l02377"></a>02377       <span class="keyword">struct </span>sockaddr_in *sa = p_result ?
<a name="l02378"></a>02378          (<span class="keyword">struct </span>sockaddr_in *)p_result : &amp;_sa_buf;
<a name="l02379"></a>02379       <span class="comment">/* default is either the supplied value or the result itself */</span>
<a name="l02380"></a>02380       <span class="keyword">struct </span>sockaddr_in *def = (flags &amp; <a class="code" href="config_8h.html#ad60d9d8c34b4f61493c1d85ae02d569facc865488860e2c25dd9f80e5473cf760">PARSE_DEFAULT</a>) ?
<a name="l02381"></a>02381          va_arg(ap, <span class="keyword">struct</span> sockaddr_in *) : sa;
<a name="l02382"></a>02382       <span class="keyword">struct </span>hostent *<a class="code" href="chan__skinny_8c.html#aa0f575fa3882aa394cc287edba645a35">hp</a>;
<a name="l02383"></a>02383       <span class="keyword">struct </span><a class="code" href="structast__hostent.html">ast_hostent</a> ahp;
<a name="l02384"></a>02384 
<a name="l02385"></a>02385       memset(&amp;_sa_buf, <span class="charliteral">&apos;\0&apos;</span>, <span class="keyword">sizeof</span>(_sa_buf)); <span class="comment">/* clear buffer */</span>
<a name="l02386"></a>02386       <span class="comment">/* duplicate the string to strip away the :port */</span>
<a name="l02387"></a>02387       port = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(arg);
<a name="l02388"></a>02388       buf = <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;port, <span class="stringliteral">&quot;:&quot;</span>);
<a name="l02389"></a>02389       sa-&gt;sin_family = AF_INET;  <span class="comment">/* assign family */</span>
<a name="l02390"></a>02390       <span class="comment">/*</span>
<a name="l02391"></a>02391 <span class="comment">       * honor the ports flag setting, assign default value</span>
<a name="l02392"></a>02392 <span class="comment">       * in case of errors or field unset.</span>
<a name="l02393"></a>02393 <span class="comment">       */</span>
<a name="l02394"></a>02394       flags &amp;= <a class="code" href="config_8h.html#ad60d9d8c34b4f61493c1d85ae02d569fa5f8a497855d42eba8c324516d21f8998">PARSE_PORT_MASK</a>; <span class="comment">/* the only flags left to process */</span>
<a name="l02395"></a>02395       <span class="keywordflow">if</span> (port) {
<a name="l02396"></a>02396          <span class="keywordflow">if</span> (flags == <a class="code" href="config_8h.html#ad60d9d8c34b4f61493c1d85ae02d569fa42789f26318ec8def793a3df3a35efe3">PARSE_PORT_FORBID</a>) {
<a name="l02397"></a>02397             error = 1;  <span class="comment">/* port was forbidden */</span>
<a name="l02398"></a>02398             sa-&gt;sin_port = def-&gt;sin_port;
<a name="l02399"></a>02399          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (flags == <a class="code" href="config_8h.html#ad60d9d8c34b4f61493c1d85ae02d569fa16f16657d9166eef98393fb8bfa5da8d">PARSE_PORT_IGNORE</a>)
<a name="l02400"></a>02400             sa-&gt;sin_port = def-&gt;sin_port;
<a name="l02401"></a>02401          <span class="keywordflow">else</span> <span class="comment">/* accept or require */</span>
<a name="l02402"></a>02402             sa-&gt;sin_port = htons(strtol(port, NULL, 0));
<a name="l02403"></a>02403       } <span class="keywordflow">else</span> {
<a name="l02404"></a>02404          sa-&gt;sin_port = def-&gt;sin_port;
<a name="l02405"></a>02405          <span class="keywordflow">if</span> (flags == <a class="code" href="config_8h.html#ad60d9d8c34b4f61493c1d85ae02d569faf8734b2de041808f7ad5ce81ce4fcbcb">PARSE_PORT_REQUIRE</a>)
<a name="l02406"></a>02406             error = 1;
<a name="l02407"></a>02407       }
<a name="l02408"></a>02408       <span class="comment">/* Now deal with host part, even if we have errors before. */</span>
<a name="l02409"></a>02409       hp = <a class="code" href="utils_8h.html#ad3b63ee1041593219ef0765b28d70442" title="Thread-safe gethostbyname function to use in Asterisk.">ast_gethostbyname</a>(buf, &amp;ahp);
<a name="l02410"></a>02410       <span class="keywordflow">if</span> (hp)  <span class="comment">/* resolved successfully */</span>
<a name="l02411"></a>02411          memcpy(&amp;sa-&gt;sin_addr, hp-&gt;h_addr, <span class="keyword">sizeof</span>(sa-&gt;sin_addr));
<a name="l02412"></a>02412       <span class="keywordflow">else</span> {
<a name="l02413"></a>02413          error = 1;
<a name="l02414"></a>02414          sa-&gt;sin_addr = def-&gt;sin_addr;
<a name="l02415"></a>02415       }
<a name="l02416"></a>02416       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(3,
<a name="l02417"></a>02417          <span class="stringliteral">&quot;extract inaddr from [%s] gives [%s:%d](%d)\n&quot;</span>,
<a name="l02418"></a>02418          arg, <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(sa-&gt;sin_addr),
<a name="l02419"></a>02419          ntohs(sa-&gt;sin_port), error);
<a name="l02420"></a>02420          <span class="keywordflow">break</span>;
<a name="l02421"></a>02421        }
<a name="l02422"></a>02422    }
<a name="l02423"></a>02423    va_end(ap);
<a name="l02424"></a>02424    <span class="keywordflow">return</span> error;
<a name="l02425"></a>02425 }
<a name="l02426"></a>02426 
<a name="l02427"></a><a class="code" href="config_8c.html#afd0ea5d651eb713a93c9f2e684b86209">02427</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="config_8c.html#afd0ea5d651eb713a93c9f2e684b86209">handle_cli_core_show_config_mappings</a>(<span class="keyword">struct</span> <a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="structast__cli__args.html">ast_cli_args</a> *a)
<a name="l02428"></a>02428 {
<a name="l02429"></a>02429    <span class="keyword">struct </span><a class="code" href="structast__config__engine.html" title="Configuration engine structure, used to define realtime drivers.">ast_config_engine</a> *eng;
<a name="l02430"></a>02430    <span class="keyword">struct </span><a class="code" href="structast__config__map.html">ast_config_map</a> *<a class="code" href="misdn__config_8c.html#a92a7399cbb76f6349df98d9432ad52c6">map</a>;
<a name="l02431"></a>02431 
<a name="l02432"></a>02432    <span class="keywordflow">switch</span> (cmd) {
<a name="l02433"></a>02433    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l02434"></a>02434       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;core show config mappings&quot;</span>;
<a name="l02435"></a>02435       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l02436"></a>02436          <span class="stringliteral">&quot;Usage: core show config mappings\n&quot;</span>
<a name="l02437"></a>02437          <span class="stringliteral">&quot;  Shows the filenames to config engines.\n&quot;</span>;
<a name="l02438"></a>02438       <span class="keywordflow">return</span> NULL;
<a name="l02439"></a>02439    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l02440"></a>02440       <span class="keywordflow">return</span> NULL;
<a name="l02441"></a>02441    }
<a name="l02442"></a>02442    
<a name="l02443"></a>02443    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;<a class="code" href="config_8c.html#a502fc4d80b1f4d10bc516dbd85f9bd93">config_lock</a>);
<a name="l02444"></a>02444 
<a name="l02445"></a>02445    <span class="keywordflow">if</span> (!config_engine_list) {
<a name="l02446"></a>02446       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;No config mappings found.\n&quot;</span>);
<a name="l02447"></a>02447    } <span class="keywordflow">else</span> {
<a name="l02448"></a>02448       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l02449"></a>02449       <span class="keywordflow">for</span> (eng = config_engine_list; eng; eng = eng-&gt;<a class="code" href="structast__config__engine.html#a2fccbe2a64d67715a7e133fbd4078902">next</a>) {
<a name="l02450"></a>02450          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;\nConfig Engine: %s\n&quot;</span>, eng-&gt;<a class="code" href="structast__config__engine.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l02451"></a>02451          <span class="keywordflow">for</span> (map = <a class="code" href="config_8c.html#aac242c96b19f1c7a0ecfb2c6c45cac4f">config_maps</a>; map; map = map-&gt;<a class="code" href="structast__config__map.html#a116d426c4bbd073eec3caf2455b6c576">next</a>) {
<a name="l02452"></a>02452             <span class="keywordflow">if</span> (!strcasecmp(map-&gt;<a class="code" href="structast__config__map.html#a129a7813daee3387f3932182eb7dc3f7">driver</a>, eng-&gt;<a class="code" href="structast__config__engine.html#a5ac083a645d964373f022d03df4849c8">name</a>)) {
<a name="l02453"></a>02453                <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;===&gt; %s (db=%s, table=%s)\n&quot;</span>, map-&gt;<a class="code" href="structast__config__map.html#a5ac083a645d964373f022d03df4849c8">name</a>, map-&gt;<a class="code" href="structast__config__map.html#a8a48a6504d4d5a43bd3ab452ee0e8cb4">database</a>,
<a name="l02454"></a>02454                      map-&gt;<a class="code" href="structast__config__map.html#abc4810aa7718733bfc48b1973f4c92f8">table</a> ? map-&gt;<a class="code" href="structast__config__map.html#abc4810aa7718733bfc48b1973f4c92f8">table</a> : map-&gt;<a class="code" href="structast__config__map.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l02455"></a>02455             }
<a name="l02456"></a>02456          }
<a name="l02457"></a>02457       }
<a name="l02458"></a>02458       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>,<span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l02459"></a>02459    }
<a name="l02460"></a>02460    
<a name="l02461"></a>02461    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="config_8c.html#a502fc4d80b1f4d10bc516dbd85f9bd93">config_lock</a>);
<a name="l02462"></a>02462 
<a name="l02463"></a>02463    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l02464"></a>02464 }
<a name="l02465"></a>02465 
<a name="l02466"></a><a class="code" href="config_8c.html#affc135477227d5ebc7447c88ad74014b">02466</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="config_8c.html#affc135477227d5ebc7447c88ad74014b">handle_cli_config_reload</a>(<span class="keyword">struct</span> <a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="structast__cli__args.html">ast_cli_args</a> *a)
<a name="l02467"></a>02467 {
<a name="l02468"></a>02468    <span class="keyword">struct </span>cache_file_mtime *cfmtime;
<a name="l02469"></a>02469    <span class="keywordtype">char</span> *prev = <span class="stringliteral">&quot;&quot;</span>, *completion_value = NULL;
<a name="l02470"></a>02470    <span class="keywordtype">int</span> wordlen, which = 0;
<a name="l02471"></a>02471 
<a name="l02472"></a>02472    <span class="keywordflow">switch</span> (cmd) {
<a name="l02473"></a>02473    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l02474"></a>02474       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;config reload&quot;</span>;
<a name="l02475"></a>02475       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l02476"></a>02476          <span class="stringliteral">&quot;Usage: config reload &lt;filename.conf&gt;\n&quot;</span>
<a name="l02477"></a>02477          <span class="stringliteral">&quot;   Reloads all modules that reference &lt;filename.conf&gt;\n&quot;</span>;
<a name="l02478"></a>02478       <span class="keywordflow">return</span> NULL;
<a name="l02479"></a>02479    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l02480"></a>02480       <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#a1910d262855b71da353ed0d07a6c7823">pos</a> &gt; 2) {
<a name="l02481"></a>02481          <span class="keywordflow">return</span> NULL;
<a name="l02482"></a>02482       }
<a name="l02483"></a>02483 
<a name="l02484"></a>02484       wordlen = strlen(a-&gt;<a class="code" href="structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">word</a>);
<a name="l02485"></a>02485 
<a name="l02486"></a>02486       <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;<a class="code" href="structcfmtime__head.html">cfmtime_head</a>);
<a name="l02487"></a>02487       <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="structcfmtime__head.html">cfmtime_head</a>, cfmtime, list) {
<a name="l02488"></a>02488          <span class="comment">/* Skip duplicates - this only works because the list is sorted by filename */</span>
<a name="l02489"></a>02489          <span class="keywordflow">if</span> (strcmp(cfmtime-&gt;<a class="code" href="structcache__file__mtime.html#afae8c108f5d360038fa8b099eb4ab2f3">filename</a>, prev) == 0) {
<a name="l02490"></a>02490             <span class="keywordflow">continue</span>;
<a name="l02491"></a>02491          }
<a name="l02492"></a>02492 
<a name="l02493"></a>02493          <span class="comment">/* Core configs cannot be reloaded */</span>
<a name="l02494"></a>02494          <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(cfmtime-&gt;<a class="code" href="structcache__file__mtime.html#ac1a3dfe5c9e5cf85abc41b8ca002ef7f">who_asked</a>)) {
<a name="l02495"></a>02495             <span class="keywordflow">continue</span>;
<a name="l02496"></a>02496          }
<a name="l02497"></a>02497 
<a name="l02498"></a>02498          <span class="keywordflow">if</span> (++which &gt; a-&gt;<a class="code" href="structast__cli__args.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> &amp;&amp; strncmp(cfmtime-&gt;<a class="code" href="structcache__file__mtime.html#afae8c108f5d360038fa8b099eb4ab2f3">filename</a>, a-&gt;<a class="code" href="structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">word</a>, wordlen) == 0) {
<a name="l02499"></a>02499             completion_value = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(cfmtime-&gt;<a class="code" href="structcache__file__mtime.html#afae8c108f5d360038fa8b099eb4ab2f3">filename</a>);
<a name="l02500"></a>02500             <span class="keywordflow">break</span>;
<a name="l02501"></a>02501          }
<a name="l02502"></a>02502 
<a name="l02503"></a>02503          <span class="comment">/* Otherwise save that we&apos;ve seen this filename */</span>
<a name="l02504"></a>02504          prev = cfmtime-&gt;<a class="code" href="structcache__file__mtime.html#afae8c108f5d360038fa8b099eb4ab2f3">filename</a>;
<a name="l02505"></a>02505       }
<a name="l02506"></a>02506       <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="structcfmtime__head.html">cfmtime_head</a>);
<a name="l02507"></a>02507 
<a name="l02508"></a>02508       <span class="keywordflow">return</span> completion_value;
<a name="l02509"></a>02509    }
<a name="l02510"></a>02510 
<a name="l02511"></a>02511    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> != 3) {
<a name="l02512"></a>02512       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l02513"></a>02513    }
<a name="l02514"></a>02514 
<a name="l02515"></a>02515    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;<a class="code" href="structcfmtime__head.html">cfmtime_head</a>);
<a name="l02516"></a>02516    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="structcfmtime__head.html">cfmtime_head</a>, cfmtime, list) {
<a name="l02517"></a>02517       <span class="keywordflow">if</span> (!strcmp(cfmtime-&gt;<a class="code" href="structcache__file__mtime.html#afae8c108f5d360038fa8b099eb4ab2f3">filename</a>, a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[2])) {
<a name="l02518"></a>02518          <span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a> = alloca(strlen(<span class="stringliteral">&quot;module reload &quot;</span>) + strlen(cfmtime-&gt;<a class="code" href="structcache__file__mtime.html#ac1a3dfe5c9e5cf85abc41b8ca002ef7f">who_asked</a>) + 1);
<a name="l02519"></a>02519          sprintf(buf, <span class="stringliteral">&quot;module reload %s&quot;</span>, cfmtime-&gt;<a class="code" href="structcache__file__mtime.html#ac1a3dfe5c9e5cf85abc41b8ca002ef7f">who_asked</a>);
<a name="l02520"></a>02520          <a class="code" href="cli_8h.html#a9c772ebcb8e1a0d2cecbf551f089f58f">ast_cli_command</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, buf);
<a name="l02521"></a>02521       }
<a name="l02522"></a>02522    }
<a name="l02523"></a>02523    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="structcfmtime__head.html">cfmtime_head</a>);
<a name="l02524"></a>02524 
<a name="l02525"></a>02525    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l02526"></a>02526 }
<a name="l02527"></a>02527 
<a name="l02528"></a><a class="code" href="config_8c.html#ade4e3859c29ea21826b5c31c86a7c8b5">02528</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="config_8c.html#ade4e3859c29ea21826b5c31c86a7c8b5">handle_cli_config_list</a>(<span class="keyword">struct</span> <a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="structast__cli__args.html">ast_cli_args</a> *a)
<a name="l02529"></a>02529 {
<a name="l02530"></a>02530    <span class="keyword">struct </span>cache_file_mtime *cfmtime;
<a name="l02531"></a>02531 
<a name="l02532"></a>02532    <span class="keywordflow">switch</span> (cmd) {
<a name="l02533"></a>02533    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l02534"></a>02534       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;config list&quot;</span>;
<a name="l02535"></a>02535       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l02536"></a>02536          <span class="stringliteral">&quot;Usage: config list\n&quot;</span>
<a name="l02537"></a>02537          <span class="stringliteral">&quot;   Show all modules that have loaded a configuration file\n&quot;</span>;
<a name="l02538"></a>02538       <span class="keywordflow">return</span> NULL;
<a name="l02539"></a>02539    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l02540"></a>02540       <span class="keywordflow">return</span> NULL;
<a name="l02541"></a>02541    }
<a name="l02542"></a>02542 
<a name="l02543"></a>02543    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;<a class="code" href="structcfmtime__head.html">cfmtime_head</a>);
<a name="l02544"></a>02544    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="structcfmtime__head.html">cfmtime_head</a>, cfmtime, list) {
<a name="l02545"></a>02545       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;%-20.20s %-50s\n&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(cfmtime-&gt;<a class="code" href="structcache__file__mtime.html#ac1a3dfe5c9e5cf85abc41b8ca002ef7f">who_asked</a>, <span class="stringliteral">&quot;core&quot;</span>), cfmtime-&gt;<a class="code" href="structcache__file__mtime.html#afae8c108f5d360038fa8b099eb4ab2f3">filename</a>);
<a name="l02546"></a>02546    }
<a name="l02547"></a>02547    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="structcfmtime__head.html">cfmtime_head</a>);
<a name="l02548"></a>02548 
<a name="l02549"></a>02549    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l02550"></a>02550 }
<a name="l02551"></a>02551 
<a name="l02552"></a><a class="code" href="config_8c.html#a0ccbda45f056904a7b1b8bc96e58167b">02552</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a> <a class="code" href="config_8c.html#a0ccbda45f056904a7b1b8bc96e58167b">cli_config</a>[] = {
<a name="l02553"></a>02553    <a class="code" href="cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="config_8c.html#afd0ea5d651eb713a93c9f2e684b86209">handle_cli_core_show_config_mappings</a>, <span class="stringliteral">&quot;Display config mappings (file names to config engines)&quot;</span>),
<a name="l02554"></a>02554    <a class="code" href="cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="config_8c.html#affc135477227d5ebc7447c88ad74014b">handle_cli_config_reload</a>, <span class="stringliteral">&quot;Force a reload on modules using a particular configuration file&quot;</span>),
<a name="l02555"></a>02555    <a class="code" href="cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="config_8c.html#ade4e3859c29ea21826b5c31c86a7c8b5">handle_cli_config_list</a>, <span class="stringliteral">&quot;Show all files that have loaded a configuration file&quot;</span>),
<a name="l02556"></a>02556 };
<a name="l02557"></a>02557 
<a name="l02558"></a><a class="code" href="config_8c.html#aa384dd45f5c243bb518d013074e76848">02558</a> <span class="keywordtype">int</span> <a class="code" href="config_8h.html#afd849f1845a148b2ea62cbd92c0112db" title="Exposed initialization method for core process This method is intended for use only...">register_config_cli</a>() 
<a name="l02559"></a>02559 {
<a name="l02560"></a>02560    <a class="code" href="cli_8h.html#aadeef34f3106bb78aeb3414032ad7fb7" title="Register multiple commands.">ast_cli_register_multiple</a>(cli_config, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(cli_config));
<a name="l02561"></a>02561    <span class="keywordflow">return</span> 0;
<a name="l02562"></a>02562 }
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:18:38 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
