<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:22:23 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_1ab815038f534adda65c8b4ae4993449.html">include</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_16d825f1fa9ecca2e70b1a8d9256d0e6.html">asterisk</a>
  </div>
</div>
<div class="contents">
<h1>module.h File Reference</h1>
<p>Asterisk module definitions.  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="utils_8h_source.html">asterisk/utils.h</a>&quot;</code><br/>

<p><a href="module_8h_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__module__info.html">ast_module_info</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="module_8h.html#a009b18dedb8cf41964b4547c67e98182">__MODULE_INFO_GLOBALS</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="module_8h.html#aac8f05a6c1142afc7203882ff4ca7054">__MODULE_INFO_SECTION</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="module_8h.html#a9d567e7b64d402c1d710b9bd47679cd9">AST_MODULE_CONFIG</a>&nbsp;&nbsp;&nbsp;&quot;modules.conf&quot;</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Module configuration file.  <a href="#a9d567e7b64d402c1d710b9bd47679cd9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="module_8h.html#a9f4aa0e21486bdbcef428335268690c9">AST_MODULE_INFO</a>(keystr, flags_to_set, <a class="el" href="channel_8c.html#a710bce51374aba96ab04912897666c35">desc</a>, fields...)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="module_8h.html#a70ea6b2dde349dfaae4d21d93b9a5683">AST_MODULE_INFO_STANDARD</a>(keystr, <a class="el" href="channel_8c.html#a710bce51374aba96ab04912897666c35">desc</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="module_8h.html#ab941a600dc47b469ab225f140bc0973f">ast_module_user_add</a>(<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)&nbsp;&nbsp;&nbsp;__ast_module_user_add(<a class="el" href="structast__module__info.html">ast_module_info</a>-&gt;self, <a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="module_8h.html#a3878a02fd12ea57e75dbb5a0f131fa2d">ast_module_user_hangup_all</a>()&nbsp;&nbsp;&nbsp;__ast_module_user_hangup_all(<a class="el" href="structast__module__info.html">ast_module_info</a>-&gt;self)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="module_8h.html#aac87725d61b6daf4ce7d7b505f1b68c9">ast_module_user_remove</a>(<a class="el" href="structuser.html">user</a>)&nbsp;&nbsp;&nbsp;__ast_module_user_remove(<a class="el" href="structast__module__info.html">ast_module_info</a>-&gt;self, <a class="el" href="structuser.html">user</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="module_8h.html#aa47a7223480d23a864cf83fef0f8585e">ast_register_application</a>(<a class="el" href="res__agi_8c.html#a9e5f57131367eff409b9e0bd7b31aa1a">app</a>, execute, <a class="el" href="res__agi_8c.html#a1539fbb78128c8c72e41d1e9d2c09351">synopsis</a>, <a class="el" href="callerid_8c.html#a68344fa88cf4e86b5079fd69a5c22d57">description</a>)&nbsp;&nbsp;&nbsp;ast_register_application2(<a class="el" href="res__agi_8c.html#a9e5f57131367eff409b9e0bd7b31aa1a">app</a>, execute, <a class="el" href="res__agi_8c.html#a1539fbb78128c8c72e41d1e9d2c09351">synopsis</a>, <a class="el" href="callerid_8c.html#a68344fa88cf4e86b5079fd69a5c22d57">description</a>, <a class="el" href="structast__module__info.html">ast_module_info</a>-&gt;self)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Register an application.  <a href="#aa47a7223480d23a864cf83fef0f8585e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="module_8h.html#afba4eb7a910b10969041ae4cd488729d">ast_register_application_xml</a>(<a class="el" href="res__agi_8c.html#a9e5f57131367eff409b9e0bd7b31aa1a">app</a>, execute)&nbsp;&nbsp;&nbsp;ast_register_application(<a class="el" href="res__agi_8c.html#a9e5f57131367eff409b9e0bd7b31aa1a">app</a>, execute, NULL, NULL)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Register an application using XML documentation.  <a href="#afba4eb7a910b10969041ae4cd488729d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="module_8h.html#aba2c8d4be709a254658b21a834f8294a">ASTERISK_GPL_KEY</a>&nbsp;&nbsp;&nbsp;&quot;This paragraph is copyright (c) 2006 by Digium, Inc. \In order for your module to load, it must return this \key via a function called \&quot;key\&quot;.  Any code which \includes this paragraph must be licensed under the GNU \General Public License <a class="el" href="res__config__pgsql_8c.html#aad880fc4455c253781e8968f2239d56f">version</a> 2 or later (at your \option).  In addition to Digium's general reservations \of rights, Digium expressly reserves the right to \allow other parties to license this paragraph under \different terms. Any use of Digium, Inc. trademarks or \logos (including \&quot;Asterisk\&quot; or \&quot;Digium\&quot;) without \express written <a class="el" href="structpermission.html">permission</a> of Digium, Inc. is prohibited.\n&quot;</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The text the key() function should return.  <a href="#aba2c8d4be709a254658b21a834f8294a"></a><br/></td></tr>
<tr><td colspan="2"><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843">ast_module_flags</a> { <a class="el" href="module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a54af2a9b29d140908cc9dffd0618951b">AST_MODFLAG_DEFAULT</a> =  0, 
<a class="el" href="module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a835b27a90d895a488e4e14cc3d2dee8c">AST_MODFLAG_GLOBAL_SYMBOLS</a> =  (1 &lt;&lt; 0), 
<a class="el" href="module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223">AST_MODFLAG_LOAD_ORDER</a> =  (1 &lt;&lt; 1)
 }</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="module_8h.html#adc09474f0ff557e9925b722ee5b952df">ast_module_load_result</a> { <br/>
&nbsp;&nbsp;<a class="el" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a> =  0, 
<a class="el" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a> =  1, 
<a class="el" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfac899889001b46a5531884315676b103b">AST_MODULE_LOAD_SKIP</a> =  2, 
<a class="el" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfa8704cde6456cff6d774e4013ea5a07a0">AST_MODULE_LOAD_PRIORITY</a> =  3, 
<br/>
&nbsp;&nbsp;<a class="el" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfa8724da3ad620df86524280e760add388">AST_MODULE_LOAD_FAILURE</a> =  -1
<br/>
 }</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="module_8h.html#ac034ec04e9dd255a0d39bdfcb73113b9">ast_module_unload_mode</a> { <a class="el" href="module_8h.html#ac034ec04e9dd255a0d39bdfcb73113b9a10bb7955de423b36c75f645de78d2f39">AST_FORCE_SOFT</a> =  0, 
<a class="el" href="module_8h.html#ac034ec04e9dd255a0d39bdfcb73113b9a8145144df4ddbc9122deba5069de0522">AST_FORCE_FIRM</a> =  1, 
<a class="el" href="module_8h.html#ac034ec04e9dd255a0d39bdfcb73113b9a4fbd520c0fa0b70495fe9dd6aee373b9">AST_FORCE_HARD</a> =  2
 }</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__module__user.html">ast_module_user</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="module_8h.html#ad315d50d0a7d61cb9feac19223fff8c0">__ast_module_user_add</a> (struct <a class="el" href="structast__module.html">ast_module</a> *, struct <a class="el" href="structast__channel.html">ast_channel</a> *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="module_8h.html#afc270b7358ecf057945a5ddbe3a4d750">__ast_module_user_hangup_all</a> (struct <a class="el" href="structast__module.html">ast_module</a> *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="module_8h.html#aee5ac94e279928d1d1f7b6aafb62ec7a">__ast_module_user_remove</a> (struct <a class="el" href="structast__module.html">ast_module</a> *, struct <a class="el" href="structast__module__user.html">ast_module_user</a> *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="module_8h.html#adc09474f0ff557e9925b722ee5b952df">ast_module_load_result</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="module_8h.html#a841766995d4e10ebb3950b10aab97d9e">ast_load_resource</a> (const char *resource_name)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Load a module.  <a href="#a841766995d4e10ebb3950b10aab97d9e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="module_8h.html#a35e5148750fa0ab4ffa54d0fe19c966a">ast_loader_register</a> (int(*updater)(void))</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add a procedure to be run when modules have been updated.  <a href="#a35e5148750fa0ab4ffa54d0fe19c966a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="module_8h.html#a057c6c9c5266071d7a8a09695555ee25">ast_loader_unregister</a> (int(*updater)(void))</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Remove a procedure to be run when modules are updated.  <a href="#a057c6c9c5266071d7a8a09695555ee25"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="module_8h.html#a15f7e2f25f4d0c60de6cca164232a6d4">ast_module_check</a> (const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Check if module with the name given is loaded.  <a href="#a15f7e2f25f4d0c60de6cca164232a6d4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="module_8h.html#a2114c90d58e7c3c3638965d1811301e9">ast_module_helper</a> (const char *line, const char *word, int pos, int <a class="el" href="structstate.html">state</a>, int rpos, int needsreload)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Match modules names for the Asterisk cli.  <a href="#a2114c90d58e7c3c3638965d1811301e9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__module.html">ast_module</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="module_8h.html#aa08fcee0b390e15532dd03803c8728c4">ast_module_ref</a> (struct <a class="el" href="structast__module.html">ast_module</a> *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="module_8h.html#a22b15d5b073cfab9d5b3b204c98865bd">ast_module_register</a> (const struct <a class="el" href="structast__module__info.html">ast_module_info</a> *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="module_8h.html#a6bf911eb6793b87d52a792053fb1ce60">ast_module_shutdown</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Run the unload() callback for all loaded modules.  <a href="#a6bf911eb6793b87d52a792053fb1ce60"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="module_8h.html#ac65fa15b16dbc563a2424af744ab003d">ast_module_unref</a> (struct <a class="el" href="structast__module.html">ast_module</a> *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="module_8h.html#ae98c0eda87d842c390783a4968f6c003">ast_module_unregister</a> (const struct <a class="el" href="structast__module__info.html">ast_module_info</a> *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="module_8h.html#a6814b6d7b0a7d23c41df65124eb77171">ast_register_application2</a> (const char *<a class="el" href="res__agi_8c.html#a9e5f57131367eff409b9e0bd7b31aa1a">app</a>, int(*execute)(struct <a class="el" href="structast__channel.html">ast_channel</a> *, void *), const char *<a class="el" href="res__agi_8c.html#a1539fbb78128c8c72e41d1e9d2c09351">synopsis</a>, const char *<a class="el" href="callerid_8c.html#a68344fa88cf4e86b5079fd69a5c22d57">description</a>, void *mod)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Register an application.  <a href="#a6814b6d7b0a7d23c41df65124eb77171"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="module_8h.html#a52f6615f305951a0d61adc6e61920c34">ast_unload_resource</a> (const char *resource_name, enum <a class="el" href="module_8h.html#ac034ec04e9dd255a0d39bdfcb73113b9">ast_module_unload_mode</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Unload a module.  <a href="#a52f6615f305951a0d61adc6e61920c34"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="module_8h.html#ad2ca15621101154f29748cf1dac3c3cf">ast_unregister_application</a> (const char *<a class="el" href="res__agi_8c.html#a9e5f57131367eff409b9e0bd7b31aa1a">app</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Unregister an application.  <a href="#ad2ca15621101154f29748cf1dac3c3cf"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="module_8h.html#a19adc7caa79fecaf1257325ffb366fe7">ast_update_module_list</a> (int(*modentry)(const char *module, const char *<a class="el" href="callerid_8c.html#a68344fa88cf4e86b5079fd69a5c22d57">description</a>, int <a class="el" href="chan__unistim_8c.html#a2f8d20b887dab5677a21b650895a0dec">usecnt</a>, const char *like), const char *like)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Ask for a list of modules, descriptions, and use counts.  <a href="#a19adc7caa79fecaf1257325ffb366fe7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="module_8h.html#a28b9e8444e0f9b495cc1b10628b816e8">ast_update_use_count</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Notify when usecount has been changed.  <a href="#a28b9e8444e0f9b495cc1b10628b816e8"></a><br/></td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__module__info.html">ast_module_info</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="module_8h.html#ae25b9f3970870610911f8850897e8ead">ast_module_info</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Asterisk module definitions. </p>
<p>This file contains the definitons for functions Asterisk modules should provide and some other module related functions. </p>

<p>Definition in file <a class="el" href="module_8h_source.html">module.h</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a009b18dedb8cf41964b4547c67e98182"></a><!-- doxytag: member="module.h::__MODULE_INFO_GLOBALS" ref="a009b18dedb8cf41964b4547c67e98182" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __MODULE_INFO_GLOBALS</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="module_8h_source.html#l00287">287</a> of file <a class="el" href="module_8h_source.html">module.h</a>.</p>

</div>
</div>
<a class="anchor" id="aac8f05a6c1142afc7203882ff4ca7054"></a><!-- doxytag: member="module.h::__MODULE_INFO_SECTION" ref="aac8f05a6c1142afc7203882ff4ca7054" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __MODULE_INFO_SECTION</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="module_8h_source.html#l00286">286</a> of file <a class="el" href="module_8h_source.html">module.h</a>.</p>

</div>
</div>
<a class="anchor" id="a9d567e7b64d402c1d710b9bd47679cd9"></a><!-- doxytag: member="module.h::AST_MODULE_CONFIG" ref="a9d567e7b64d402c1d710b9bd47679cd9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_MODULE_CONFIG&nbsp;&nbsp;&nbsp;&quot;modules.conf&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Module configuration file. </p>

<p>Definition at line <a class="el" href="module_8h_source.html#l00051">51</a> of file <a class="el" href="module_8h_source.html">module.h</a>.</p>

<p>Referenced by <a class="el" href="loader_8c_source.html#l00941">load_modules()</a>.</p>

</div>
</div>
<a class="anchor" id="a9f4aa0e21486bdbcef428335268690c9"></a><!-- doxytag: member="module.h::AST_MODULE_INFO" ref="a9f4aa0e21486bdbcef428335268690c9" args="(keystr, flags_to_set, desc, fields...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_MODULE_INFO</td>
          <td>(</td>
          <td class="paramtype">keystr, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">flags_to_set, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="channel_8c.html#a710bce51374aba96ab04912897666c35">desc</a>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">fields...&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="module_8h_source.html#l00344">344</a> of file <a class="el" href="module_8h_source.html">module.h</a>.</p>

</div>
</div>
<a class="anchor" id="a70ea6b2dde349dfaae4d21d93b9a5683"></a><!-- doxytag: member="module.h::AST_MODULE_INFO_STANDARD" ref="a70ea6b2dde349dfaae4d21d93b9a5683" args="(keystr, desc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_MODULE_INFO_STANDARD</td>
          <td>(</td>
          <td class="paramtype">keystr, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="channel_8c.html#a710bce51374aba96ab04912897666c35">desc</a>&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment"><a class="code" href="module_8h.html#a9f4aa0e21486bdbcef428335268690c9">AST_MODULE_INFO</a>(keystr, <a class="code" href="module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a54af2a9b29d140908cc9dffd0618951b">AST_MODFLAG_DEFAULT</a>, <a class="code" href="cdr__radius_8c.html#a3aad16fd4bea1b9717f232ea75ad6449">desc</a>, \
         .load = <a class="code" href="app__adsiprog_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a>,       \
         .unload = <a class="code" href="agent_8c.html#a95bac1db604c69a01ef7b3995342cd7a">unload_module</a>,      \
             )
</pre></div>
<p>Definition at line <a class="el" href="module_8h_source.html#l00366">366</a> of file <a class="el" href="module_8h_source.html">module.h</a>.</p>

</div>
</div>
<a class="anchor" id="ab941a600dc47b469ab225f140bc0973f"></a><!-- doxytag: member="module.h::ast_module_user_add" ref="ab941a600dc47b469ab225f140bc0973f" args="(chan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ast_module_user_add</td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;__ast_module_user_add(<a class="el" href="structast__module__info.html">ast_module_info</a>-&gt;self, <a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="module_8h_source.html#l00240">240</a> of file <a class="el" href="module_8h_source.html">module.h</a>.</p>

<p>Referenced by <a class="el" href="pbx__lua_8c_source.html#l01167">canmatch()</a>, <a class="el" href="pbx__dundi_8c_source.html#l03972">dundi_query_read()</a>, <a class="el" href="pbx__dundi_8c_source.html#l04045">dundi_result_read()</a>, <a class="el" href="pbx__dundi_8c_source.html#l03889">dundifunc_read()</a>, <a class="el" href="pbx__lua_8c_source.html#l01214">exec()</a>, <a class="el" href="pbx__lua_8c_source.html#l01144">exists()</a>, <a class="el" href="chan__local_8c_source.html#l00734">local_new()</a>, <a class="el" href="chan__agent_8c_source.html#l01981">login_exec()</a>, <a class="el" href="pbx__lua_8c_source.html#l01190">matchmore()</a>, <a class="el" href="chan__nbs_8c_source.html#l00222">nbs_new()</a>, <a class="el" href="res__smdi_8c_source.html#l01221">smdi_msg_read()</a>, and <a class="el" href="res__smdi_8c_source.html#l01122">smdi_msg_retrieve_read()</a>.</p>

</div>
</div>
<a class="anchor" id="a3878a02fd12ea57e75dbb5a0f131fa2d"></a><!-- doxytag: member="module.h::ast_module_user_hangup_all" ref="a3878a02fd12ea57e75dbb5a0f131fa2d" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ast_module_user_hangup_all</td>
          <td>(</td>
&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;__ast_module_user_hangup_all(<a class="el" href="structast__module__info.html">ast_module_info</a>-&gt;self)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="module_8h_source.html#l00242">242</a> of file <a class="el" href="module_8h_source.html">module.h</a>.</p>

<p>Referenced by <a class="el" href="pbx__dundi_8c_source.html#l04776">unload_module()</a>.</p>

</div>
</div>
<a class="anchor" id="aac87725d61b6daf4ce7d7b505f1b68c9"></a><!-- doxytag: member="module.h::ast_module_user_remove" ref="aac87725d61b6daf4ce7d7b505f1b68c9" args="(user)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ast_module_user_remove</td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structuser.html">user</a>&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;__ast_module_user_remove(<a class="el" href="structast__module__info.html">ast_module_info</a>-&gt;self, <a class="el" href="structuser.html">user</a>)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="module_8h_source.html#l00241">241</a> of file <a class="el" href="module_8h_source.html">module.h</a>.</p>

<p>Referenced by <a class="el" href="pbx__lua_8c_source.html#l01167">canmatch()</a>, <a class="el" href="pbx__dundi_8c_source.html#l03972">dundi_query_read()</a>, <a class="el" href="pbx__dundi_8c_source.html#l04045">dundi_result_read()</a>, <a class="el" href="pbx__dundi_8c_source.html#l03889">dundifunc_read()</a>, <a class="el" href="pbx__lua_8c_source.html#l01214">exec()</a>, <a class="el" href="pbx__lua_8c_source.html#l01144">exists()</a>, <a class="el" href="chan__local_8c_source.html#l00582">local_hangup()</a>, <a class="el" href="chan__agent_8c_source.html#l01981">login_exec()</a>, <a class="el" href="pbx__lua_8c_source.html#l01190">matchmore()</a>, <a class="el" href="chan__nbs_8c_source.html#l00112">nbs_destroy()</a>, <a class="el" href="res__smdi_8c_source.html#l01221">smdi_msg_read()</a>, and <a class="el" href="res__smdi_8c_source.html#l01122">smdi_msg_retrieve_read()</a>.</p>

</div>
</div>
<a class="anchor" id="aa47a7223480d23a864cf83fef0f8585e"></a><!-- doxytag: member="module.h::ast_register_application" ref="aa47a7223480d23a864cf83fef0f8585e" args="(app, execute, synopsis, description)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ast_register_application</td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="res__agi_8c.html#a9e5f57131367eff409b9e0bd7b31aa1a">app</a>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">execute, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="res__agi_8c.html#a1539fbb78128c8c72e41d1e9d2c09351">synopsis</a>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="callerid_8c.html#a68344fa88cf4e86b5079fd69a5c22d57">description</a>&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;ast_register_application2(<a class="el" href="res__agi_8c.html#a9e5f57131367eff409b9e0bd7b31aa1a">app</a>, execute, <a class="el" href="res__agi_8c.html#a1539fbb78128c8c72e41d1e9d2c09351">synopsis</a>, <a class="el" href="callerid_8c.html#a68344fa88cf4e86b5079fd69a5c22d57">description</a>, <a class="el" href="structast__module__info.html">ast_module_info</a>-&gt;self)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Register an application. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>app</em>&nbsp;</td><td>Short name of the application </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>execute</em>&nbsp;</td><td>a function callback to execute the application. It should return non-zero if the channel needs to be hung up. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>synopsis</em>&nbsp;</td><td>a short description (one line synopsis) of the application </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>description</em>&nbsp;</td><td>long description with all of the details about the use of the application</td></tr>
  </table>
  </dd>
</dl>
<p>This registers an application with Asterisk's internal application list. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>The individual applications themselves are responsible for registering and unregistering and unregistering their own CLI commands.</dd></dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>failure. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="module_8h_source.html#l00390">390</a> of file <a class="el" href="module_8h_source.html">module.h</a>.</p>

<p>Referenced by <a class="el" href="app__externalivr_8c_source.html#l00803">load_module()</a>.</p>

</div>
</div>
<a class="anchor" id="afba4eb7a910b10969041ae4cd488729d"></a><!-- doxytag: member="module.h::ast_register_application_xml" ref="afba4eb7a910b10969041ae4cd488729d" args="(app, execute)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ast_register_application_xml</td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="res__agi_8c.html#a9e5f57131367eff409b9e0bd7b31aa1a">app</a>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">execute&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;ast_register_application(<a class="el" href="res__agi_8c.html#a9e5f57131367eff409b9e0bd7b31aa1a">app</a>, execute, NULL, NULL)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Register an application using XML documentation. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>app</em>&nbsp;</td><td>Short name of the application </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>execute</em>&nbsp;</td><td>a function callback to execute the application. It should return non-zero if the channel needs to be hung up.</td></tr>
  </table>
  </dd>
</dl>
<p>This registers an application with Asterisk's internal application list. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>The individual applications themselves are responsible for registering and unregistering and unregistering their own CLI commands.</dd></dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>failure. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="module_8h_source.html#l00406">406</a> of file <a class="el" href="module_8h_source.html">module.h</a>.</p>

<p>Referenced by <a class="el" href="app__adsiprog_8c_source.html#l01587">load_module()</a>.</p>

</div>
</div>
<a class="anchor" id="aba2c8d4be709a254658b21a834f8294a"></a><!-- doxytag: member="module.h::ASTERISK_GPL_KEY" ref="aba2c8d4be709a254658b21a834f8294a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ASTERISK_GPL_KEY&nbsp;&nbsp;&nbsp;&quot;This paragraph is copyright (c) 2006 by Digium, Inc. \In order for your module to load, it must return this \key via a function called \&quot;key\&quot;.  Any code which \includes this paragraph must be licensed under the GNU \General Public License <a class="el" href="res__config__pgsql_8c.html#aad880fc4455c253781e8968f2239d56f">version</a> 2 or later (at your \option).  In addition to Digium's general reservations \of rights, Digium expressly reserves the right to \allow other parties to license this paragraph under \different terms. Any use of Digium, Inc. trademarks or \logos (including \&quot;Asterisk\&quot; or \&quot;Digium\&quot;) without \express written <a class="el" href="structpermission.html">permission</a> of Digium, Inc. is prohibited.\n&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The text the key() function should return. </p>

<p>Definition at line <a class="el" href="module_8h_source.html#l00038">38</a> of file <a class="el" href="module_8h_source.html">module.h</a>.</p>

</div>
</div>
<hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="a155a0df9c59e04e305d4a2fa3e35f843"></a><!-- doxytag: member="module.h::ast_module_flags" ref="a155a0df9c59e04e305d4a2fa3e35f843" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843">ast_module_flags</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a155a0df9c59e04e305d4a2fa3e35f843a54af2a9b29d140908cc9dffd0618951b"></a><!-- doxytag: member="AST_MODFLAG_DEFAULT" ref="a155a0df9c59e04e305d4a2fa3e35f843a54af2a9b29d140908cc9dffd0618951b" args="" -->AST_MODFLAG_DEFAULT</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a155a0df9c59e04e305d4a2fa3e35f843a835b27a90d895a488e4e14cc3d2dee8c"></a><!-- doxytag: member="AST_MODFLAG_GLOBAL_SYMBOLS" ref="a155a0df9c59e04e305d4a2fa3e35f843a835b27a90d895a488e4e14cc3d2dee8c" args="" -->AST_MODFLAG_GLOBAL_SYMBOLS</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223"></a><!-- doxytag: member="AST_MODFLAG_LOAD_ORDER" ref="a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223" args="" -->AST_MODFLAG_LOAD_ORDER</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="module_8h_source.html#l00190">190</a> of file <a class="el" href="module_8h_source.html">module.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00190"></a>00190                       {
<a name="l00191"></a>00191    <a class="code" href="module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a54af2a9b29d140908cc9dffd0618951b">AST_MODFLAG_DEFAULT</a> = 0,
<a name="l00192"></a>00192    <a class="code" href="module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a835b27a90d895a488e4e14cc3d2dee8c">AST_MODFLAG_GLOBAL_SYMBOLS</a> = (1 &lt;&lt; 0),
<a name="l00193"></a>00193    <a class="code" href="module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223">AST_MODFLAG_LOAD_ORDER</a> = (1 &lt;&lt; 1),
<a name="l00194"></a>00194 };
</pre></div></p>

</div>
</div>
<a class="anchor" id="adc09474f0ff557e9925b722ee5b952df"></a><!-- doxytag: member="module.h::ast_module_load_result" ref="adc09474f0ff557e9925b722ee5b952df" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="module_8h.html#adc09474f0ff557e9925b722ee5b952df">ast_module_load_result</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314"></a><!-- doxytag: member="AST_MODULE_LOAD_SUCCESS" ref="adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314" args="" -->AST_MODULE_LOAD_SUCCESS</em>&nbsp;</td><td>
<p>Module loaded and configured </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57"></a><!-- doxytag: member="AST_MODULE_LOAD_DECLINE" ref="adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57" args="" -->AST_MODULE_LOAD_DECLINE</em>&nbsp;</td><td>
<p>Module is not configured </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="adc09474f0ff557e9925b722ee5b952dfac899889001b46a5531884315676b103b"></a><!-- doxytag: member="AST_MODULE_LOAD_SKIP" ref="adc09474f0ff557e9925b722ee5b952dfac899889001b46a5531884315676b103b" args="" -->AST_MODULE_LOAD_SKIP</em>&nbsp;</td><td>
<p>Module was skipped for some reason </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="adc09474f0ff557e9925b722ee5b952dfa8704cde6456cff6d774e4013ea5a07a0"></a><!-- doxytag: member="AST_MODULE_LOAD_PRIORITY" ref="adc09474f0ff557e9925b722ee5b952dfa8704cde6456cff6d774e4013ea5a07a0" args="" -->AST_MODULE_LOAD_PRIORITY</em>&nbsp;</td><td>
<p>Module is not loaded yet, but is added to prioity heap </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="adc09474f0ff557e9925b722ee5b952dfa8724da3ad620df86524280e760add388"></a><!-- doxytag: member="AST_MODULE_LOAD_FAILURE" ref="adc09474f0ff557e9925b722ee5b952dfa8724da3ad620df86524280e760add388" args="" -->AST_MODULE_LOAD_FAILURE</em>&nbsp;</td><td>
<p>Module could not be loaded properly </p>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="module_8h_source.html#l00060">60</a> of file <a class="el" href="module_8h_source.html">module.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00060"></a>00060                             {
<a name="l00061"></a>00061    <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a> = 0,    <span class="comment">/*!&lt; Module loaded and configured */</span>
<a name="l00062"></a>00062    <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a> = 1,    <span class="comment">/*!&lt; Module is not configured */</span>
<a name="l00063"></a>00063    <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfac899889001b46a5531884315676b103b">AST_MODULE_LOAD_SKIP</a> = 2,       <span class="comment">/*!&lt; Module was skipped for some reason */</span>
<a name="l00064"></a>00064    <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfa8704cde6456cff6d774e4013ea5a07a0">AST_MODULE_LOAD_PRIORITY</a> = 3,   <span class="comment">/*!&lt; Module is not loaded yet, but is added to prioity heap */</span>
<a name="l00065"></a>00065    <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfa8724da3ad620df86524280e760add388">AST_MODULE_LOAD_FAILURE</a> = -1,   <span class="comment">/*!&lt; Module could not be loaded properly */</span>
<a name="l00066"></a>00066 };
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac034ec04e9dd255a0d39bdfcb73113b9"></a><!-- doxytag: member="module.h::ast_module_unload_mode" ref="ac034ec04e9dd255a0d39bdfcb73113b9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="module_8h.html#ac034ec04e9dd255a0d39bdfcb73113b9">ast_module_unload_mode</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="ac034ec04e9dd255a0d39bdfcb73113b9a10bb7955de423b36c75f645de78d2f39"></a><!-- doxytag: member="AST_FORCE_SOFT" ref="ac034ec04e9dd255a0d39bdfcb73113b9a10bb7955de423b36c75f645de78d2f39" args="" -->AST_FORCE_SOFT</em>&nbsp;</td><td>
<p>Softly unload a module, only if not in use </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ac034ec04e9dd255a0d39bdfcb73113b9a8145144df4ddbc9122deba5069de0522"></a><!-- doxytag: member="AST_FORCE_FIRM" ref="ac034ec04e9dd255a0d39bdfcb73113b9a8145144df4ddbc9122deba5069de0522" args="" -->AST_FORCE_FIRM</em>&nbsp;</td><td>
<p>Firmly unload a module, even if in use </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ac034ec04e9dd255a0d39bdfcb73113b9a4fbd520c0fa0b70495fe9dd6aee373b9"></a><!-- doxytag: member="AST_FORCE_HARD" ref="ac034ec04e9dd255a0d39bdfcb73113b9a4fbd520c0fa0b70495fe9dd6aee373b9" args="" -->AST_FORCE_HARD</em>&nbsp;</td><td>
<p>as FIRM, plus dlclose() on the module. Not recommended as it may cause crashes </p>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="module_8h_source.html#l00053">53</a> of file <a class="el" href="module_8h_source.html">module.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00053"></a>00053                             {
<a name="l00054"></a>00054    <a class="code" href="module_8h.html#ac034ec04e9dd255a0d39bdfcb73113b9a10bb7955de423b36c75f645de78d2f39">AST_FORCE_SOFT</a> = 0, <span class="comment">/*!&lt; Softly unload a module, only if not in use */</span>
<a name="l00055"></a>00055    <a class="code" href="module_8h.html#ac034ec04e9dd255a0d39bdfcb73113b9a8145144df4ddbc9122deba5069de0522">AST_FORCE_FIRM</a> = 1, <span class="comment">/*!&lt; Firmly unload a module, even if in use */</span>
<a name="l00056"></a>00056    <a class="code" href="module_8h.html#ac034ec04e9dd255a0d39bdfcb73113b9a4fbd520c0fa0b70495fe9dd6aee373b9">AST_FORCE_HARD</a> = 2, <span class="comment">/*!&lt; as FIRM, plus dlclose() on the module. Not recommended</span>
<a name="l00057"></a>00057 <span class="comment">            as it may cause crashes */</span>
<a name="l00058"></a>00058 };
</pre></div></p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ad315d50d0a7d61cb9feac19223fff8c0"></a><!-- doxytag: member="module.h::__ast_module_user_add" ref="ad315d50d0a7d61cb9feac19223fff8c0" args="(struct ast_module *, struct ast_channel *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__module__user.html">ast_module_user</a>* __ast_module_user_add </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__module.html">ast_module</a> *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="loader_8c_source.html#l00195">195</a> of file <a class="el" href="loader_8c_source.html">loader.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l01964">ast_atomic_fetchadd_int()</a>, <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="linkedlists_8h_source.html#l00695">AST_LIST_INSERT_HEAD</a>, <a class="el" href="linkedlists_8h_source.html#l00039">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00139">AST_LIST_UNLOCK</a>, <a class="el" href="loader_8c_source.html#l01085">ast_update_use_count()</a>, <a class="el" href="loader_8c_source.html#l00068">ast_module_user::chan</a>, <a class="el" href="loader_8c_source.html#l00087">ast_module::usecount</a>, and <a class="el" href="loader_8c_source.html#l00088">ast_module::users</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l03356">ast_func_read()</a>, <a class="el" href="pbx_8c_source.html#l03379">ast_func_write()</a>, and <a class="el" href="pbx_8c_source.html#l01322">pbx_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00197"></a>00197 {
<a name="l00198"></a>00198    <span class="keyword">struct </span><a class="code" href="structast__module__user.html">ast_module_user</a> *u = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*u));
<a name="l00199"></a>00199 
<a name="l00200"></a>00200    <span class="keywordflow">if</span> (!u)
<a name="l00201"></a>00201       <span class="keywordflow">return</span> NULL;
<a name="l00202"></a>00202 
<a name="l00203"></a>00203    u-&gt;<a class="code" href="structast__module__user.html#a84d1435c5b8d387806714ea7079304b7">chan</a> = <a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>;
<a name="l00204"></a>00204 
<a name="l00205"></a>00205    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;mod-&gt;users);
<a name="l00206"></a>00206    <a class="code" href="linkedlists_8h.html#aa2ded2af046bb513f77056c27c083307" title="Inserts a list entry at the head of a list.">AST_LIST_INSERT_HEAD</a>(&amp;mod-&gt;users, u, <a class="code" href="structast__module__user.html#a093dfa95a74ea90b0109fa8aed92a6c2">entry</a>);
<a name="l00207"></a>00207    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;mod-&gt;users);
<a name="l00208"></a>00208 
<a name="l00209"></a>00209    <a class="code" href="lock_8h.html#a30df186a6f53f66621e88fae2e7adaf9" title="Atomically add v to *p and return * the previous value of *p. This can be used to...">ast_atomic_fetchadd_int</a>(&amp;mod-&gt;usecount, +1);
<a name="l00210"></a>00210 
<a name="l00211"></a>00211    <a class="code" href="module_8h.html#a28b9e8444e0f9b495cc1b10628b816e8" title="Notify when usecount has been changed.">ast_update_use_count</a>();
<a name="l00212"></a>00212 
<a name="l00213"></a>00213    <span class="keywordflow">return</span> u;
<a name="l00214"></a>00214 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="afc270b7358ecf057945a5ddbe3a4d750"></a><!-- doxytag: member="module.h::__ast_module_user_hangup_all" ref="afc270b7358ecf057945a5ddbe3a4d750" args="(struct ast_module *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void __ast_module_user_hangup_all </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__module.html">ast_module</a> *&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="loader_8c_source.html#l00227">227</a> of file <a class="el" href="loader_8c_source.html">loader.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l01964">ast_atomic_fetchadd_int()</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="linkedlists_8h_source.html#l00039">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00817">AST_LIST_REMOVE_HEAD</a>, <a class="el" href="linkedlists_8h_source.html#l00139">AST_LIST_UNLOCK</a>, <a class="el" href="channel_8c_source.html#l01666">ast_softhangup()</a>, <a class="el" href="channel_8h_source.html#l00638">AST_SOFTHANGUP_APPUNLOAD</a>, <a class="el" href="loader_8c_source.html#l01085">ast_update_use_count()</a>, <a class="el" href="loader_8c_source.html#l00068">ast_module_user::chan</a>, <a class="el" href="loader_8c_source.html#l00087">ast_module::usecount</a>, and <a class="el" href="loader_8c_source.html#l00088">ast_module::users</a>.</p>

<p>Referenced by <a class="el" href="loader_8c_source.html#l00482">ast_unload_resource()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00228"></a>00228 {
<a name="l00229"></a>00229    <span class="keyword">struct </span><a class="code" href="structast__module__user.html">ast_module_user</a> *u;
<a name="l00230"></a>00230 
<a name="l00231"></a>00231    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;mod-&gt;users);
<a name="l00232"></a>00232    <span class="keywordflow">while</span> ((u = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;mod-&gt;users, <a class="code" href="structast__module__user.html#a093dfa95a74ea90b0109fa8aed92a6c2">entry</a>))) {
<a name="l00233"></a>00233       <a class="code" href="channel_8h.html#ac2d6607253f7e8b272d4e845474eaa9b" title="Softly hangup up a channel.">ast_softhangup</a>(u-&gt;<a class="code" href="structast__module__user.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709aeeafae6abd77156800ec76b0ff7d3867">AST_SOFTHANGUP_APPUNLOAD</a>);
<a name="l00234"></a>00234       <a class="code" href="lock_8h.html#a30df186a6f53f66621e88fae2e7adaf9" title="Atomically add v to *p and return * the previous value of *p. This can be used to...">ast_atomic_fetchadd_int</a>(&amp;mod-&gt;usecount, -1);
<a name="l00235"></a>00235       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(u);
<a name="l00236"></a>00236    }
<a name="l00237"></a>00237    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;mod-&gt;users);
<a name="l00238"></a>00238 
<a name="l00239"></a>00239    <a class="code" href="module_8h.html#a28b9e8444e0f9b495cc1b10628b816e8" title="Notify when usecount has been changed.">ast_update_use_count</a>();
<a name="l00240"></a>00240 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aee5ac94e279928d1d1f7b6aafb62ec7a"></a><!-- doxytag: member="module.h::__ast_module_user_remove" ref="aee5ac94e279928d1d1f7b6aafb62ec7a" args="(struct ast_module *, struct ast_module_user *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void __ast_module_user_remove </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__module.html">ast_module</a> *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__module__user.html">ast_module_user</a> *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="loader_8c_source.html#l00216">216</a> of file <a class="el" href="loader_8c_source.html">loader.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l01964">ast_atomic_fetchadd_int()</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="linkedlists_8h_source.html#l00039">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00838">AST_LIST_REMOVE</a>, <a class="el" href="linkedlists_8h_source.html#l00139">AST_LIST_UNLOCK</a>, <a class="el" href="loader_8c_source.html#l01085">ast_update_use_count()</a>, <a class="el" href="loader_8c_source.html#l00087">ast_module::usecount</a>, and <a class="el" href="loader_8c_source.html#l00088">ast_module::users</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l03356">ast_func_read()</a>, <a class="el" href="pbx_8c_source.html#l03379">ast_func_write()</a>, and <a class="el" href="pbx_8c_source.html#l01322">pbx_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00217"></a>00217 {
<a name="l00218"></a>00218    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;mod-&gt;users);
<a name="l00219"></a>00219    <a class="code" href="linkedlists_8h.html#aa36e72b77f1b80881cd0a9fcca66ce19" title="Removes a specific entry from a list.">AST_LIST_REMOVE</a>(&amp;mod-&gt;users, u, <a class="code" href="structast__module__user.html#a093dfa95a74ea90b0109fa8aed92a6c2">entry</a>);
<a name="l00220"></a>00220    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;mod-&gt;users);
<a name="l00221"></a>00221    <a class="code" href="lock_8h.html#a30df186a6f53f66621e88fae2e7adaf9" title="Atomically add v to *p and return * the previous value of *p. This can be used to...">ast_atomic_fetchadd_int</a>(&amp;mod-&gt;usecount, -1);
<a name="l00222"></a>00222    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(u);
<a name="l00223"></a>00223 
<a name="l00224"></a>00224    <a class="code" href="module_8h.html#a28b9e8444e0f9b495cc1b10628b816e8" title="Notify when usecount has been changed.">ast_update_use_count</a>();
<a name="l00225"></a>00225 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a841766995d4e10ebb3950b10aab97d9e"></a><!-- doxytag: member="module.h::ast_load_resource" ref="a841766995d4e10ebb3950b10aab97d9e" args="(const char *resource_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="module_8h.html#adc09474f0ff557e9925b722ee5b952df">ast_module_load_result</a> ast_load_resource </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>resource_name</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Load a module. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>resource_name</em>&nbsp;</td><td>The name of the module to load.</td></tr>
  </table>
  </dd>
</dl>
<p>This function is run by the PBX to load the modules. It performs all loading and initialization tasks. Basically, to load a module, just give it the name of the module and it will do the rest.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>See possible enum <a class="el" href="structvalues.html">values</a> for ast_module_load_result. </dd></dl>

<p>Definition at line <a class="el" href="loader_8c_source.html#l00831">831</a> of file <a class="el" href="loader_8c_source.html">loader.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00039">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00139">AST_LIST_UNLOCK</a>, and <a class="el" href="loader_8c_source.html#l00777">load_resource()</a>.</p>

<p>Referenced by <a class="el" href="pbx__gtkconsole_8c_source.html#l00243">file_ok_sel()</a>, <a class="el" href="cli_8c_source.html#l00244">handle_load()</a>, <a class="el" href="func__curl_8c_source.html#l00552">load_module()</a>, <a class="el" href="manager_8c_source.html#l02938">manager_moduleload()</a>, and <a class="el" href="pbx__gtkconsole_8c_source.html#l00203">reload()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00832"></a>00832 {
<a name="l00833"></a>00833    <span class="keywordtype">int</span> res;
<a name="l00834"></a>00834    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;<a class="code" href="structmodule__list.html">module_list</a>);
<a name="l00835"></a>00835    res = <a class="code" href="loader_8c.html#a7c05632be9a98b1d318519f9ef356b8d">load_resource</a>(resource_name, 0, NULL);
<a name="l00836"></a>00836    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="structmodule__list.html">module_list</a>);
<a name="l00837"></a>00837 
<a name="l00838"></a>00838    <span class="keywordflow">return</span> res;
<a name="l00839"></a>00839 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a35e5148750fa0ab4ffa54d0fe19c966a"></a><!-- doxytag: member="module.h::ast_loader_register" ref="a35e5148750fa0ab4ffa54d0fe19c966a" args="(int(*updater)(void))" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_loader_register </td>
          <td>(</td>
          <td class="paramtype">int(*)(void)&nbsp;</td>
          <td class="paramname"> <em>updater</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add a procedure to be run when modules have been updated. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>updater</em>&nbsp;</td><td>The function to run when modules have been updated.</td></tr>
  </table>
  </dd>
</dl>
<p>This function adds the given function to a linked list of functions to be run when the modules are updated.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="loader_8c_source.html#l01131">1131</a> of file <a class="el" href="loader_8c_source.html">loader.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00695">AST_LIST_INSERT_HEAD</a>, <a class="el" href="linkedlists_8h_source.html#l00039">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00139">AST_LIST_UNLOCK</a>, <a class="el" href="astmm_8h_source.html#l00081">ast_malloc</a>, and <a class="el" href="structloadupdate.html#a4a45824143144324dc8e65241a06fc3a">loadupdate::updater</a>.</p>

<p>Referenced by <a class="el" href="pbx__gtkconsole_8c_source.html#l00358">show_console()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01132"></a>01132 {
<a name="l01133"></a>01133    <span class="keyword">struct </span><a class="code" href="structloadupdate.html">loadupdate</a> *tmp;
<a name="l01134"></a>01134 
<a name="l01135"></a>01135    <span class="keywordflow">if</span> (!(tmp = <a class="code" href="astmm_8h.html#a64a0e7a3ab511a3777ac56f5d43c628e">ast_malloc</a>(<span class="keyword">sizeof</span>(*tmp))))
<a name="l01136"></a>01136       <span class="keywordflow">return</span> -1;
<a name="l01137"></a>01137 
<a name="l01138"></a>01138    tmp-&gt;<a class="code" href="structloadupdate.html#a4a45824143144324dc8e65241a06fc3a">updater</a> = v;
<a name="l01139"></a>01139    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;<a class="code" href="structupdaters.html">updaters</a>);
<a name="l01140"></a>01140    <a class="code" href="linkedlists_8h.html#aa2ded2af046bb513f77056c27c083307" title="Inserts a list entry at the head of a list.">AST_LIST_INSERT_HEAD</a>(&amp;<a class="code" href="structupdaters.html">updaters</a>, tmp, <a class="code" href="structloadupdate.html#a23f79a5c6bb21f2f7c9759f1460fcb4a">entry</a>);
<a name="l01141"></a>01141    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="structupdaters.html">updaters</a>);
<a name="l01142"></a>01142 
<a name="l01143"></a>01143    <span class="keywordflow">return</span> 0;
<a name="l01144"></a>01144 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a057c6c9c5266071d7a8a09695555ee25"></a><!-- doxytag: member="module.h::ast_loader_unregister" ref="a057c6c9c5266071d7a8a09695555ee25" args="(int(*updater)(void))" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_loader_unregister </td>
          <td>(</td>
          <td class="paramtype">int(*)(void)&nbsp;</td>
          <td class="paramname"> <em>updater</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Remove a procedure to be run when modules are updated. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>updater</em>&nbsp;</td><td>The updater function to unregister.</td></tr>
  </table>
  </dd>
</dl>
<p>This removes the given function from the updater list.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="loader_8c_source.html#l01146">1146</a> of file <a class="el" href="loader_8c_source.html">loader.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00039">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00553">AST_LIST_REMOVE_CURRENT</a>, <a class="el" href="linkedlists_8h_source.html#l00528">AST_LIST_TRAVERSE_SAFE_BEGIN</a>, <a class="el" href="linkedlists_8h_source.html#l00599">AST_LIST_TRAVERSE_SAFE_END</a>, <a class="el" href="linkedlists_8h_source.html#l00139">AST_LIST_UNLOCK</a>, and <a class="el" href="structloadupdate.html#a4a45824143144324dc8e65241a06fc3a">loadupdate::updater</a>.</p>

<p>Referenced by <a class="el" href="pbx__gtkconsole_8c_source.html#l00308">exit_now()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01147"></a>01147 {
<a name="l01148"></a>01148    <span class="keyword">struct </span><a class="code" href="structloadupdate.html">loadupdate</a> *cur;
<a name="l01149"></a>01149 
<a name="l01150"></a>01150    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;<a class="code" href="structupdaters.html">updaters</a>);
<a name="l01151"></a>01151    <a class="code" href="linkedlists_8h.html#aa5be52067bf16bdc7e56ca19b5ba858d" title="Loops safely over (traverses) the entries in a list.">AST_LIST_TRAVERSE_SAFE_BEGIN</a>(&amp;<a class="code" href="structupdaters.html">updaters</a>, cur, <a class="code" href="structloadupdate.html#a23f79a5c6bb21f2f7c9759f1460fcb4a">entry</a>) {
<a name="l01152"></a>01152       <span class="keywordflow">if</span> (cur-&gt;<a class="code" href="structloadupdate.html#a4a45824143144324dc8e65241a06fc3a">updater</a> == v)  {
<a name="l01153"></a>01153          <a class="code" href="linkedlists_8h.html#aa8ac496fa9c717d5afb99a02e1e2760c" title="Removes the current entry from a list during a traversal.">AST_LIST_REMOVE_CURRENT</a>(<a class="code" href="structloadupdate.html#a23f79a5c6bb21f2f7c9759f1460fcb4a">entry</a>);
<a name="l01154"></a>01154          <span class="keywordflow">break</span>;
<a name="l01155"></a>01155       }
<a name="l01156"></a>01156    }
<a name="l01157"></a>01157    <a class="code" href="linkedlists_8h.html#a712c04b4493919a7052399cd30ee8fb9" title="Closes a safe loop traversal block.">AST_LIST_TRAVERSE_SAFE_END</a>;
<a name="l01158"></a>01158    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="structupdaters.html">updaters</a>);
<a name="l01159"></a>01159 
<a name="l01160"></a>01160    <span class="keywordflow">return</span> cur ? 0 : -1;
<a name="l01161"></a>01161 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a15f7e2f25f4d0c60de6cca164232a6d4"></a><!-- doxytag: member="module.h::ast_module_check" ref="a15f7e2f25f4d0c60de6cca164232a6d4" args="(const char *name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_module_check </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Check if module with the name given is loaded. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>Module name, like "chan_sip.so" </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>1</em>&nbsp;</td><td>if true </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if false </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="loader_8c_source.html#l01118">1118</a> of file <a class="el" href="loader_8c_source.html">loader.c</a>.</p>

<p>References <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, and <a class="el" href="loader_8c_source.html#l00326">find_resource()</a>.</p>

<p>Referenced by <a class="el" href="func__module_8c_source.html#l00049">ifmodule_read()</a>, <a class="el" href="func__curl_8c_source.html#l00552">load_module()</a>, <a class="el" href="manager_8c_source.html#l02885">manager_modulecheck()</a>, and <a class="el" href="res__curl_8c_source.html#l00041">unload_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01119"></a>01119 {
<a name="l01120"></a>01120    <span class="keyword">struct </span><a class="code" href="structast__module.html">ast_module</a> *cur;
<a name="l01121"></a>01121 
<a name="l01122"></a>01122    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>))
<a name="l01123"></a>01123       <span class="keywordflow">return</span> 0;       <span class="comment">/* FALSE */</span>
<a name="l01124"></a>01124 
<a name="l01125"></a>01125    cur = <a class="code" href="loader_8c.html#abfb73039867fcb82075f230a8bc928cd">find_resource</a>(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, 1);
<a name="l01126"></a>01126 
<a name="l01127"></a>01127    <span class="keywordflow">return</span> (cur != NULL);
<a name="l01128"></a>01128 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2114c90d58e7c3c3638965d1811301e9"></a><!-- doxytag: member="module.h::ast_module_helper" ref="a2114c90d58e7c3c3638965d1811301e9" args="(const char *line, const char *word, int pos, int state, int rpos, int needsreload)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* ast_module_helper </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>line</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>word</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>rpos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>needsreload</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Match modules names for the Asterisk cli. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>line</em>&nbsp;</td><td>Unused by this function, but this should be the line we are matching. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>word</em>&nbsp;</td><td>The partial name to match. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pos</em>&nbsp;</td><td>The position the word we are completing is in. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structstate.html">state</a></em>&nbsp;</td><td>The possible match to return. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>rpos</em>&nbsp;</td><td>The position we should be matching. This should be the same as pos. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>needsreload</em>&nbsp;</td><td>This should be 1 if we need to reload this module and 0 otherwise. This function will only return modules that are reloadble if this is 1.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>A</em>&nbsp;</td><td>possible completion of the partial match. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>NULL</em>&nbsp;</td><td>if no matches were found. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="loader_8c_source.html#l00542">542</a> of file <a class="el" href="loader_8c_source.html">loader.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00039">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00139">AST_LIST_UNLOCK</a>, <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="loader_8c_source.html#l00085">ast_module::info</a>, <a class="el" href="cdr__adaptive__odbc_8c_source.html#l00053">name</a>, <a class="el" href="structast__module__info.html#a6df96c24939202e4f8837ff51c99d078">ast_module_info::reload</a>, and <a class="el" href="loader_8c_source.html#l00094">ast_module::resource</a>.</p>

<p>Referenced by <a class="el" href="cli_8c_source.html#l00696">handle_modlist()</a>, <a class="el" href="cli_8c_source.html#l00269">handle_reload()</a>, <a class="el" href="cli_8c_source.html#l00542">handle_unload()</a>, and <a class="el" href="chan__gtalk_8c_source.html#l02033">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00543"></a>00543 {
<a name="l00544"></a>00544    <span class="keyword">struct </span><a class="code" href="structast__module.html">ast_module</a> *cur;
<a name="l00545"></a>00545    <span class="keywordtype">int</span> i, which=0, l = strlen(<a class="code" href="ael_8tab_8c.html#a836535f59bf515522a395858a8029d42">word</a>);
<a name="l00546"></a>00546    <span class="keywordtype">char</span> *ret = NULL;
<a name="l00547"></a>00547 
<a name="l00548"></a>00548    <span class="keywordflow">if</span> (pos != rpos)
<a name="l00549"></a>00549       <span class="keywordflow">return</span> NULL;
<a name="l00550"></a>00550 
<a name="l00551"></a>00551    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;<a class="code" href="structmodule__list.html">module_list</a>);
<a name="l00552"></a>00552    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="structmodule__list.html">module_list</a>, cur, <a class="code" href="structast__module.html#a9fea691ae9aba6d601e329e598441c1a">entry</a>) {
<a name="l00553"></a>00553       <span class="keywordflow">if</span> (!strncasecmp(<a class="code" href="ael_8tab_8c.html#a836535f59bf515522a395858a8029d42">word</a>, cur-&gt;<a class="code" href="structast__module.html#ac88a22a2e7bf6d75bcc8fcc8ff257e9f">resource</a>, l) &amp;&amp;
<a name="l00554"></a>00554           (cur-&gt;<a class="code" href="structast__module.html#a92b847af7c50bfb3566f2eae3602afb1">info</a>-&gt;<a class="code" href="structast__module__info.html#a6df96c24939202e4f8837ff51c99d078">reload</a> || !needsreload) &amp;&amp;
<a name="l00555"></a>00555           ++which &gt; <a class="code" href="structstate.html">state</a>) {
<a name="l00556"></a>00556          ret = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(cur-&gt;<a class="code" href="structast__module.html#ac88a22a2e7bf6d75bcc8fcc8ff257e9f">resource</a>);
<a name="l00557"></a>00557          <span class="keywordflow">break</span>;
<a name="l00558"></a>00558       }
<a name="l00559"></a>00559    }
<a name="l00560"></a>00560    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="structmodule__list.html">module_list</a>);
<a name="l00561"></a>00561 
<a name="l00562"></a>00562    <span class="keywordflow">if</span> (!ret) {
<a name="l00563"></a>00563       <span class="keywordflow">for</span> (i=0; !ret &amp;&amp; <a class="code" href="structreload__classes.html">reload_classes</a>[i].name; i++) {
<a name="l00564"></a>00564          <span class="keywordflow">if</span> (!strncasecmp(<a class="code" href="ael_8tab_8c.html#a836535f59bf515522a395858a8029d42">word</a>, <a class="code" href="structreload__classes.html">reload_classes</a>[i].<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, l) &amp;&amp; ++which &gt; <a class="code" href="structstate.html">state</a>)
<a name="l00565"></a>00565             ret = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(<a class="code" href="structreload__classes.html">reload_classes</a>[i].name);
<a name="l00566"></a>00566       }
<a name="l00567"></a>00567    }
<a name="l00568"></a>00568 
<a name="l00569"></a>00569    <span class="keywordflow">return</span> ret;
<a name="l00570"></a>00570 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa08fcee0b390e15532dd03803c8728c4"></a><!-- doxytag: member="module.h::ast_module_ref" ref="aa08fcee0b390e15532dd03803c8728c4" args="(struct ast_module *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__module.html">ast_module</a>* ast_module_ref </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__module.html">ast_module</a> *&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="loader_8c_source.html#l01163">1163</a> of file <a class="el" href="loader_8c_source.html">loader.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l01964">ast_atomic_fetchadd_int()</a>, <a class="el" href="loader_8c_source.html#l01085">ast_update_use_count()</a>, and <a class="el" href="loader_8c_source.html#l00087">ast_module::usecount</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l00999">__oh323_new()</a>, <a class="el" href="res__agi_8c_source.html#l02777">agi_handle_command()</a>, <a class="el" href="chan__alsa_8c_source.html#l00536">alsa_new()</a>, <a class="el" href="res__agi_8c_source.html#l02556">ast_agi_register()</a>, <a class="el" href="chan__iax2_8c_source.html#l05415">ast_iax2_new()</a>, <a class="el" href="timing_8c_source.html#l00119">ast_timer_open()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07417">dahdi_new()</a>, <a class="el" href="bridging_8c_source.html#l00385">find_best_technology()</a>, <a class="el" href="file_8c_source.html#l00363">fn_wrapper()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00989">gtalk_new()</a>, <a class="el" href="res__convert_8c_source.html#l00062">handle_cli_file_convert()</a>, <a class="el" href="res__clioriginate_8c_source.html#l00119">handle_orig()</a>, <a class="el" href="bridge__builtin__features_8c_source.html#l00245">load_module()</a>, <a class="el" href="chan__mgcp_8c_source.html#l01470">mgcp_new()</a>, <a class="el" href="res__musiconhold_8c_source.html#l00859">moh_alloc()</a>, <a class="el" href="res__musiconhold_8c_source.html#l00347">moh_files_alloc()</a>, <a class="el" href="translate_8c_source.html#l00093">newpvt()</a>, <a class="el" href="chan__oss_8c_source.html#l00784">oss_new()</a>, <a class="el" href="chan__phone_8c_source.html#l00919">phone_check_exception()</a>, <a class="el" href="chan__phone_8c_source.html#l00846">phone_new()</a>, <a class="el" href="chan__sip_8c_source.html#l06599">sip_new()</a>, <a class="el" href="chan__skinny_8c_source.html#l04268">skinny_new()</a>, <a class="el" href="res__smdi_8c_source.html#l00861">smdi_load()</a>, and <a class="el" href="chan__usbradio_8c_source.html#l02183">usbradio_new()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01164"></a>01164 {
<a name="l01165"></a>01165    <a class="code" href="lock_8h.html#a30df186a6f53f66621e88fae2e7adaf9" title="Atomically add v to *p and return * the previous value of *p. This can be used to...">ast_atomic_fetchadd_int</a>(&amp;mod-&gt;usecount, +1);
<a name="l01166"></a>01166    <a class="code" href="module_8h.html#a28b9e8444e0f9b495cc1b10628b816e8" title="Notify when usecount has been changed.">ast_update_use_count</a>();
<a name="l01167"></a>01167 
<a name="l01168"></a>01168    <span class="keywordflow">return</span> mod;
<a name="l01169"></a>01169 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a22b15d5b073cfab9d5b3b204c98865bd"></a><!-- doxytag: member="module.h::ast_module_register" ref="a22b15d5b073cfab9d5b3b204c98865bd" args="(const struct ast_module_info *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_module_register </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structast__module__info.html">ast_module_info</a> *&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="loader_8c_source.html#l00133">133</a> of file <a class="el" href="loader_8c_source.html">loader.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="linkedlists_8h_source.html#l00610">AST_LIST_HEAD_INIT</a>, <a class="el" href="linkedlists_8h_source.html#l00715">AST_LIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h_source.html#l00039">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00139">AST_LIST_UNLOCK</a>, <a class="el" href="loader_8c_source.html#l00080">embedding</a>, <a class="el" href="loader_8c_source.html#l00085">ast_module::info</a>, <a class="el" href="loader_8c_source.html#l00094">ast_module::resource</a>, and <a class="el" href="loader_8c_source.html#l00088">ast_module::users</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00134"></a>00134 {
<a name="l00135"></a>00135    <span class="keyword">struct </span><a class="code" href="structast__module.html">ast_module</a> *mod;
<a name="l00136"></a>00136 
<a name="l00137"></a>00137    <span class="keywordflow">if</span> (<a class="code" href="loader_8c.html#a79572685332c8840f7c2a8ef83e9b528">embedding</a>) {
<a name="l00138"></a>00138       <span class="keywordflow">if</span> (!(mod = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*mod) + strlen(<a class="code" href="structast__module.html#a92b847af7c50bfb3566f2eae3602afb1">info</a>-&gt;<a class="code" href="structast__module__info.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>) + 1)))
<a name="l00139"></a>00139          <span class="keywordflow">return</span>;
<a name="l00140"></a>00140       strcpy(mod-&gt;<a class="code" href="structast__module.html#ac88a22a2e7bf6d75bcc8fcc8ff257e9f">resource</a>, <a class="code" href="structast__module.html#a92b847af7c50bfb3566f2eae3602afb1">info</a>-&gt;<a class="code" href="structast__module__info.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);
<a name="l00141"></a>00141    } <span class="keywordflow">else</span> {
<a name="l00142"></a>00142       mod = <a class="code" href="loader_8c.html#a11a3bf63986a4001b1bb7bd6daa54644">resource_being_loaded</a>;
<a name="l00143"></a>00143    }
<a name="l00144"></a>00144 
<a name="l00145"></a>00145    mod-&gt;<a class="code" href="structast__module.html#a92b847af7c50bfb3566f2eae3602afb1">info</a> = <a class="code" href="structast__module.html#a92b847af7c50bfb3566f2eae3602afb1">info</a>;
<a name="l00146"></a>00146    <a class="code" href="linkedlists_8h.html#a6f42d3bf45cc9af6f794d9d1cf8c45ca" title="Initializes a list head structure.">AST_LIST_HEAD_INIT</a>(&amp;mod-&gt;<a class="code" href="structast__module.html#a036f5d6b841eb6c93b9e24425c1bff72">users</a>);
<a name="l00147"></a>00147 
<a name="l00148"></a>00148    <span class="comment">/* during startup, before the loader has been initialized,</span>
<a name="l00149"></a>00149 <span class="comment">      there are no threads, so there is no need to take the lock</span>
<a name="l00150"></a>00150 <span class="comment">      on this list to manipulate it. it is also possible that it</span>
<a name="l00151"></a>00151 <span class="comment">      might be unsafe to use the list lock at that point... so</span>
<a name="l00152"></a>00152 <span class="comment">      let&apos;s avoid it altogether</span>
<a name="l00153"></a>00153 <span class="comment">   */</span>
<a name="l00154"></a>00154    <span class="keywordflow">if</span> (<a class="code" href="loader_8c.html#a79572685332c8840f7c2a8ef83e9b528">embedding</a>) {
<a name="l00155"></a>00155       <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(&amp;<a class="code" href="loader_8c.html#a8f35bf1b4933ff38daf3de57967e58b9">embedded_module_list</a>, mod, <a class="code" href="structast__module.html#a9fea691ae9aba6d601e329e598441c1a">entry</a>);
<a name="l00156"></a>00156    } <span class="keywordflow">else</span> {
<a name="l00157"></a>00157       <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;<a class="code" href="structmodule__list.html">module_list</a>);
<a name="l00158"></a>00158       <span class="comment">/* it is paramount that the new entry be placed at the tail of</span>
<a name="l00159"></a>00159 <span class="comment">         the list, otherwise the code that uses dlopen() to load</span>
<a name="l00160"></a>00160 <span class="comment">         dynamic modules won&apos;t be able to find out if the module it</span>
<a name="l00161"></a>00161 <span class="comment">         just opened was registered or failed to load</span>
<a name="l00162"></a>00162 <span class="comment">      */</span>
<a name="l00163"></a>00163       <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(&amp;<a class="code" href="structmodule__list.html">module_list</a>, mod, <a class="code" href="structast__module.html#a9fea691ae9aba6d601e329e598441c1a">entry</a>);
<a name="l00164"></a>00164       <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="structmodule__list.html">module_list</a>);
<a name="l00165"></a>00165    }
<a name="l00166"></a>00166 
<a name="l00167"></a>00167    <span class="comment">/* give the module a copy of its own handle, for later use in registrations and the like */</span>
<a name="l00168"></a>00168    *((<span class="keyword">struct </span><a class="code" href="structast__module.html">ast_module</a> **) &amp;(<a class="code" href="structast__module.html#a92b847af7c50bfb3566f2eae3602afb1">info</a>-&gt;<a class="code" href="structast__module__info.html#a1aff0615d43e1dfa5c72c1c7d1c6d709">self</a>)) = mod;
<a name="l00169"></a>00169 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6bf911eb6793b87d52a792053fb1ce60"></a><!-- doxytag: member="module.h::ast_module_shutdown" ref="a6bf911eb6793b87d52a792053fb1ce60" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_module_shutdown </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Run the unload() callback for all loaded modules. </p>
<p>This function should be called when Asterisk is shutting down gracefully. </p>

<p><dl class="note"><dt><b>Note:</b></dt><dd>Some resources, like timers, are started up dynamically, and thus may be still in use, even if all <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> are dead. We must therefore check the usecount before asking modules to unload.</dd>
<dd>
If we go through the entire list without changing anything, ignore the usecounts and unload, then exit. </dd></dl>
</p>

<p>Definition at line <a class="el" href="loader_8c_source.html#l00444">444</a> of file <a class="el" href="loader_8c_source.html">loader.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00637">AST_LIST_HEAD_DESTROY</a>, <a class="el" href="linkedlists_8h_source.html#l00039">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00553">AST_LIST_REMOVE_CURRENT</a>, <a class="el" href="linkedlists_8h_source.html#l00528">AST_LIST_TRAVERSE_SAFE_BEGIN</a>, <a class="el" href="linkedlists_8h_source.html#l00599">AST_LIST_TRAVERSE_SAFE_END</a>, <a class="el" href="linkedlists_8h_source.html#l00139">AST_LIST_UNLOCK</a>, <a class="el" href="astmm_8h_source.html#l00084">free</a>, <a class="el" href="loader_8c_source.html#l00085">ast_module::info</a>, <a class="el" href="structast__module__info.html#a06d86f635ad8f53a15cfbf757b8ed149">ast_module_info::unload</a>, <a class="el" href="loader_8c_source.html#l00087">ast_module::usecount</a>, and <a class="el" href="loader_8c_source.html#l00088">ast_module::users</a>.</p>

<p>Referenced by <a class="el" href="asterisk_8c_source.html#l01549">quit_handler()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00445"></a>00445 {
<a name="l00446"></a>00446    <span class="keyword">struct </span><a class="code" href="structast__module.html">ast_module</a> *mod;
<a name="l00447"></a>00447    <span class="keywordtype">int</span> somethingchanged = 1, <span class="keyword">final</span> = 0;
<a name="l00448"></a>00448 
<a name="l00449"></a>00449    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;<a class="code" href="structmodule__list.html">module_list</a>);
<a name="l00450"></a>00450 <span class="comment"></span>
<a name="l00451"></a>00451 <span class="comment">   /*!\note Some resources, like timers, are started up dynamically, and thus</span>
<a name="l00452"></a>00452 <span class="comment">    * may be still in use, even if all channels are dead.  We must therefore</span>
<a name="l00453"></a>00453 <span class="comment">    * check the usecount before asking modules to unload. */</span>
<a name="l00454"></a>00454    <span class="keywordflow">do</span> {
<a name="l00455"></a>00455       <span class="keywordflow">if</span> (!somethingchanged) {<span class="comment"></span>
<a name="l00456"></a>00456 <span class="comment">         /*!\note If we go through the entire list without changing</span>
<a name="l00457"></a>00457 <span class="comment">          * anything, ignore the usecounts and unload, then exit. */</span>
<a name="l00458"></a>00458          <span class="keyword">final</span> = 1;
<a name="l00459"></a>00459       }
<a name="l00460"></a>00460 
<a name="l00461"></a>00461       <span class="comment">/* Reset flag before traversing the list */</span>
<a name="l00462"></a>00462       somethingchanged = 0;
<a name="l00463"></a>00463 
<a name="l00464"></a>00464       <a class="code" href="linkedlists_8h.html#aa5be52067bf16bdc7e56ca19b5ba858d" title="Loops safely over (traverses) the entries in a list.">AST_LIST_TRAVERSE_SAFE_BEGIN</a>(&amp;<a class="code" href="structmodule__list.html">module_list</a>, mod, <a class="code" href="structast__module.html#a9fea691ae9aba6d601e329e598441c1a">entry</a>) {
<a name="l00465"></a>00465          <span class="keywordflow">if</span> (!<span class="keyword">final</span> &amp;&amp; mod-&gt;<a class="code" href="structast__module.html#ab0f2e84f976dc042139d37fd1c28d73b">usecount</a>) {
<a name="l00466"></a>00466             <span class="keywordflow">continue</span>;
<a name="l00467"></a>00467          }
<a name="l00468"></a>00468          <a class="code" href="linkedlists_8h.html#aa8ac496fa9c717d5afb99a02e1e2760c" title="Removes the current entry from a list during a traversal.">AST_LIST_REMOVE_CURRENT</a>(<a class="code" href="structast__module.html#a9fea691ae9aba6d601e329e598441c1a">entry</a>);
<a name="l00469"></a>00469          <span class="keywordflow">if</span> (mod-&gt;<a class="code" href="structast__module.html#a92b847af7c50bfb3566f2eae3602afb1">info</a>-&gt;<a class="code" href="structast__module__info.html#a06d86f635ad8f53a15cfbf757b8ed149">unload</a>) {
<a name="l00470"></a>00470             mod-&gt;<a class="code" href="structast__module.html#a92b847af7c50bfb3566f2eae3602afb1">info</a>-&gt;<a class="code" href="structast__module__info.html#a06d86f635ad8f53a15cfbf757b8ed149">unload</a>();
<a name="l00471"></a>00471          }
<a name="l00472"></a>00472          <a class="code" href="linkedlists_8h.html#a47bafe663a14b91827082787d7654d7c" title="Destroys a list head structure.">AST_LIST_HEAD_DESTROY</a>(&amp;mod-&gt;<a class="code" href="structast__module.html#a036f5d6b841eb6c93b9e24425c1bff72">users</a>);
<a name="l00473"></a>00473          <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(mod);
<a name="l00474"></a>00474          somethingchanged = 1;
<a name="l00475"></a>00475       }
<a name="l00476"></a>00476       <a class="code" href="linkedlists_8h.html#a712c04b4493919a7052399cd30ee8fb9" title="Closes a safe loop traversal block.">AST_LIST_TRAVERSE_SAFE_END</a>;
<a name="l00477"></a>00477    } <span class="keywordflow">while</span> (somethingchanged &amp;&amp; !<span class="keyword">final</span>);
<a name="l00478"></a>00478 
<a name="l00479"></a>00479    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="structmodule__list.html">module_list</a>);
<a name="l00480"></a>00480 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac65fa15b16dbc563a2424af744ab003d"></a><!-- doxytag: member="module.h::ast_module_unref" ref="ac65fa15b16dbc563a2424af744ab003d" args="(struct ast_module *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_module_unref </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__module.html">ast_module</a> *&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="loader_8c_source.html#l01171">1171</a> of file <a class="el" href="loader_8c_source.html">loader.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l01964">ast_atomic_fetchadd_int()</a>, <a class="el" href="loader_8c_source.html#l01085">ast_update_use_count()</a>, and <a class="el" href="loader_8c_source.html#l00087">ast_module::usecount</a>.</p>

<p>Referenced by <a class="el" href="res__agi_8c_source.html#l02777">agi_handle_command()</a>, <a class="el" href="chan__alsa_8c_source.html#l00349">alsa_hangup()</a>, <a class="el" href="res__agi_8c_source.html#l02593">ast_agi_unregister()</a>, <a class="el" href="bridging_8c_source.html#l00501">ast_bridge_check()</a>, <a class="el" href="res__smdi_8c_source.html#l00132">ast_smdi_interface_destroy()</a>, <a class="el" href="timing_8c_source.html#l00146">ast_timer_close()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09249">dahdi_destroy_channel_bynum()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04313">dahdi_hangup()</a>, <a class="el" href="translate_8c_source.html#l00133">destroy()</a>, <a class="el" href="bridging_8c_source.html#l00420">destroy_bridge()</a>, <a class="el" href="file_8c_source.html#l00290">filestream_destructor()</a>, <a class="el" href="chan__gtalk_8c_source.html#l01617">gtalk_hangup()</a>, <a class="el" href="res__convert_8c_source.html#l00062">handle_cli_file_convert()</a>, <a class="el" href="res__clioriginate_8c_source.html#l00119">handle_orig()</a>, <a class="el" href="chan__iax2_8c_source.html#l03200">iax2_predestroy()</a>, <a class="el" href="res__musiconhold_8c_source.html#l01185">local_ast_moh_cleanup()</a>, <a class="el" href="chan__mgcp_8c_source.html#l00936">mgcp_hangup()</a>, <a class="el" href="chan__h323_8c_source.html#l00681">oh323_hangup()</a>, <a class="el" href="chan__oss_8c_source.html#l00641">oss_hangup()</a>, <a class="el" href="chan__phone_8c_source.html#l00919">phone_check_exception()</a>, <a class="el" href="chan__phone_8c_source.html#l00341">phone_hangup()</a>, <a class="el" href="chan__sip_8c_source.html#l05956">sip_hangup()</a>, <a class="el" href="chan__skinny_8c_source.html#l03780">skinny_hangup()</a>, <a class="el" href="bridging_8c_source.html#l00585">smart_bridge_operation()</a>, and <a class="el" href="chan__usbradio_8c_source.html#l01724">usbradio_hangup()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01172"></a>01172 {
<a name="l01173"></a>01173    <a class="code" href="lock_8h.html#a30df186a6f53f66621e88fae2e7adaf9" title="Atomically add v to *p and return * the previous value of *p. This can be used to...">ast_atomic_fetchadd_int</a>(&amp;mod-&gt;usecount, -1);
<a name="l01174"></a>01174    <a class="code" href="module_8h.html#a28b9e8444e0f9b495cc1b10628b816e8" title="Notify when usecount has been changed.">ast_update_use_count</a>();
<a name="l01175"></a>01175 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae98c0eda87d842c390783a4968f6c003"></a><!-- doxytag: member="module.h::ast_module_unregister" ref="ae98c0eda87d842c390783a4968f6c003" args="(const struct ast_module_info *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_module_unregister </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structast__module__info.html">ast_module_info</a> *&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="loader_8c_source.html#l00171">171</a> of file <a class="el" href="loader_8c_source.html">loader.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="linkedlists_8h_source.html#l00637">AST_LIST_HEAD_DESTROY</a>, <a class="el" href="linkedlists_8h_source.html#l00039">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00553">AST_LIST_REMOVE_CURRENT</a>, <a class="el" href="linkedlists_8h_source.html#l00528">AST_LIST_TRAVERSE_SAFE_BEGIN</a>, <a class="el" href="linkedlists_8h_source.html#l00599">AST_LIST_TRAVERSE_SAFE_END</a>, <a class="el" href="linkedlists_8h_source.html#l00139">AST_LIST_UNLOCK</a>, <a class="el" href="loader_8c_source.html#l00085">ast_module::info</a>, and <a class="el" href="loader_8c_source.html#l00088">ast_module::users</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00172"></a>00172 {
<a name="l00173"></a>00173    <span class="keyword">struct </span><a class="code" href="structast__module.html">ast_module</a> *mod = NULL;
<a name="l00174"></a>00174 
<a name="l00175"></a>00175    <span class="comment">/* it is assumed that the users list in the module structure</span>
<a name="l00176"></a>00176 <span class="comment">      will already be empty, or we cannot have gotten to this</span>
<a name="l00177"></a>00177 <span class="comment">      point</span>
<a name="l00178"></a>00178 <span class="comment">   */</span>
<a name="l00179"></a>00179    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;<a class="code" href="structmodule__list.html">module_list</a>);
<a name="l00180"></a>00180    <a class="code" href="linkedlists_8h.html#aa5be52067bf16bdc7e56ca19b5ba858d" title="Loops safely over (traverses) the entries in a list.">AST_LIST_TRAVERSE_SAFE_BEGIN</a>(&amp;<a class="code" href="structmodule__list.html">module_list</a>, mod, <a class="code" href="structast__module.html#a9fea691ae9aba6d601e329e598441c1a">entry</a>) {
<a name="l00181"></a>00181       <span class="keywordflow">if</span> (mod-&gt;<a class="code" href="structast__module.html#a92b847af7c50bfb3566f2eae3602afb1">info</a> == <a class="code" href="structast__module.html#a92b847af7c50bfb3566f2eae3602afb1">info</a>) {
<a name="l00182"></a>00182          <a class="code" href="linkedlists_8h.html#aa8ac496fa9c717d5afb99a02e1e2760c" title="Removes the current entry from a list during a traversal.">AST_LIST_REMOVE_CURRENT</a>(<a class="code" href="structast__module.html#a9fea691ae9aba6d601e329e598441c1a">entry</a>);
<a name="l00183"></a>00183          <span class="keywordflow">break</span>;
<a name="l00184"></a>00184       }
<a name="l00185"></a>00185    }
<a name="l00186"></a>00186    <a class="code" href="linkedlists_8h.html#a712c04b4493919a7052399cd30ee8fb9" title="Closes a safe loop traversal block.">AST_LIST_TRAVERSE_SAFE_END</a>;
<a name="l00187"></a>00187    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="structmodule__list.html">module_list</a>);
<a name="l00188"></a>00188 
<a name="l00189"></a>00189    <span class="keywordflow">if</span> (mod) {
<a name="l00190"></a>00190       <a class="code" href="linkedlists_8h.html#a47bafe663a14b91827082787d7654d7c" title="Destroys a list head structure.">AST_LIST_HEAD_DESTROY</a>(&amp;mod-&gt;<a class="code" href="structast__module.html#a036f5d6b841eb6c93b9e24425c1bff72">users</a>);
<a name="l00191"></a>00191       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(mod);
<a name="l00192"></a>00192    }
<a name="l00193"></a>00193 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6814b6d7b0a7d23c41df65124eb77171"></a><!-- doxytag: member="module.h::ast_register_application2" ref="a6814b6d7b0a7d23c41df65124eb77171" args="(const char *app, int(*execute)(struct ast_channel *, void *), const char *synopsis, const char *description, void *mod)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_register_application2 </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>app</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int(*)(struct <a class="el" href="structast__channel.html">ast_channel</a> *, void *)&nbsp;</td>
          <td class="paramname"> <em>execute</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>synopsis</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>description</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>mod</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Register an application. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>app</em>&nbsp;</td><td>Short name of the application </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>execute</em>&nbsp;</td><td>a function callback to execute the application. It should return non-zero if the channel needs to be hung up. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>synopsis</em>&nbsp;</td><td>a short description (one line synopsis) of the application </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>description</em>&nbsp;</td><td>long description with all of the details about the use of the application </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>mod</em>&nbsp;</td><td>module this application belongs to</td></tr>
  </table>
  </dd>
</dl>
<p>This registers an application with Asterisk's internal application list. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>The individual applications themselves are responsible for registering and unregistering and unregistering their own CLI commands.</dd></dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>failure. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l05062">5062</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l00864">ast_app::arguments</a>, <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="linkedlists_8h_source.html#l00594">AST_RWLIST_INSERT_BEFORE_CURRENT</a>, <a class="el" href="linkedlists_8h_source.html#l00725">AST_RWLIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h_source.html#l00493">AST_RWLIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00541">AST_RWLIST_TRAVERSE_SAFE_BEGIN</a>, <a class="el" href="linkedlists_8h_source.html#l00601">AST_RWLIST_TRAVERSE_SAFE_END</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, <a class="el" href="pbx_8h_source.html#l00079">AST_STATIC_DOC</a>, <a class="el" href="stringfields_8h_source.html#l00241">ast_string_field_init</a>, <a class="el" href="stringfields_8h_source.html#l00285">ast_string_field_set</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="pbx_8h_source.html#l00078">AST_XML_DOC</a>, <a class="el" href="xmldoc_8c_source.html#l01611">ast_xmldoc_build_arguments()</a>, <a class="el" href="xmldoc_8c_source.html#l01745">ast_xmldoc_build_description()</a>, <a class="el" href="xmldoc_8c_source.html#l01318">ast_xmldoc_build_seealso()</a>, <a class="el" href="xmldoc_8c_source.html#l01740">ast_xmldoc_build_synopsis()</a>, <a class="el" href="xmldoc_8c_source.html#l01020">ast_xmldoc_build_syntax()</a>, <a class="el" href="term_8h_source.html#l00060">COLOR_BRCYAN</a>, <a class="el" href="pbx_8c_source.html#l00865">ast_app::docsrc</a>, <a class="el" href="structast__app.html#aaa273c19af19ad4f2f0cd376bd1b5f8f">ast_app::execute</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="pbx_8c_source.html#l00867">ast_app::module</a>, <a class="el" href="pbx_8c_source.html#l00868">ast_app::name</a>, <a class="el" href="pbx_8c_source.html#l00864">ast_app::seealso</a>, <a class="el" href="pbx_8c_source.html#l00864">ast_app::syntax</a>, and <a class="el" href="term_8c_source.html#l00168">term_color()</a>.</p>

<p>Referenced by <a class="el" href="features_8c_source.html#l04642">ast_features_init()</a>, and <a class="el" href="pbx_8c_source.html#l09302">load_pbx()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05063"></a>05063 {
<a name="l05064"></a>05064    <span class="keyword">struct </span><a class="code" href="structast__app.html" title="ast_app: A registered application">ast_app</a> *tmp, *cur = NULL;
<a name="l05065"></a>05065    <span class="keywordtype">char</span> tmps[80];
<a name="l05066"></a>05066    <span class="keywordtype">int</span> length, res;
<a name="l05067"></a>05067 <span class="preprocessor">#ifdef AST_XML_DOCS</span>
<a name="l05068"></a>05068 <span class="preprocessor"></span>   <span class="keywordtype">char</span> *tmpxml;
<a name="l05069"></a>05069 <span class="preprocessor">#endif</span>
<a name="l05070"></a>05070 <span class="preprocessor"></span>
<a name="l05071"></a>05071    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structapps.html">apps</a>);
<a name="l05072"></a>05072    <a class="code" href="linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;<a class="code" href="structapps.html">apps</a>, tmp, <a class="code" href="structast__app.html#a6f572a784cf87cd7e7efa625534f9d4e">list</a>) {
<a name="l05073"></a>05073       <span class="keywordflow">if</span> (!(res = strcasecmp(<a class="code" href="adsistub_8c.html#ad194d73de26c0d836555e029d245493d">app</a>, tmp-&gt;<a class="code" href="structast__app.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>))) {
<a name="l05074"></a>05074          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Already have an application &apos;%s&apos;\n&quot;</span>, <a class="code" href="adsistub_8c.html#ad194d73de26c0d836555e029d245493d">app</a>);
<a name="l05075"></a>05075          <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structapps.html">apps</a>);
<a name="l05076"></a>05076          <span class="keywordflow">return</span> -1;
<a name="l05077"></a>05077       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res &lt; 0)
<a name="l05078"></a>05078          <span class="keywordflow">break</span>;
<a name="l05079"></a>05079    }
<a name="l05080"></a>05080 
<a name="l05081"></a>05081    length = <span class="keyword">sizeof</span>(*tmp) + strlen(<a class="code" href="adsistub_8c.html#ad194d73de26c0d836555e029d245493d">app</a>) + 1;
<a name="l05082"></a>05082 
<a name="l05083"></a>05083    <span class="keywordflow">if</span> (!(tmp = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, length))) {
<a name="l05084"></a>05084       <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structapps.html">apps</a>);
<a name="l05085"></a>05085       <span class="keywordflow">return</span> -1;
<a name="l05086"></a>05086    }
<a name="l05087"></a>05087 
<a name="l05088"></a>05088    <span class="keywordflow">if</span> (<a class="code" href="stringfields_8h.html#a871274fa4fd2687c7a44849a84df3665" title="Initialize a field pool and fields.">ast_string_field_init</a>(tmp, 128)) {
<a name="l05089"></a>05089       <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structapps.html">apps</a>);
<a name="l05090"></a>05090       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(tmp);
<a name="l05091"></a>05091       <span class="keywordflow">return</span> -1;
<a name="l05092"></a>05092    }
<a name="l05093"></a>05093 
<a name="l05094"></a>05094 <span class="preprocessor">#ifdef AST_XML_DOCS</span>
<a name="l05095"></a>05095 <span class="preprocessor"></span>   <span class="comment">/* Try to lookup the docs in our XML documentation database */</span>
<a name="l05096"></a>05096    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="app__externalivr_8c.html#afa26529a1480355101f5b6d883a7d37e">synopsis</a>) &amp;&amp; <a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="callerid_8c.html#a68344fa88cf4e86b5079fd69a5c22d57">description</a>)) {
<a name="l05097"></a>05097       <span class="comment">/* load synopsis */</span>
<a name="l05098"></a>05098       tmpxml = <a class="code" href="xmldoc_8h.html#a92ab99fc2fa8a31c591531b36d391e3f" title="Generate synopsis documentation from XML.">ast_xmldoc_build_synopsis</a>(<span class="stringliteral">&quot;application&quot;</span>, <a class="code" href="adsistub_8c.html#ad194d73de26c0d836555e029d245493d">app</a>);
<a name="l05099"></a>05099       <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(tmp, <a class="code" href="app__externalivr_8c.html#afa26529a1480355101f5b6d883a7d37e">synopsis</a>, tmpxml);
<a name="l05100"></a>05100       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(tmpxml);
<a name="l05101"></a>05101 
<a name="l05102"></a>05102       <span class="comment">/* load description */</span>
<a name="l05103"></a>05103       tmpxml = <a class="code" href="xmldoc_8h.html#a7e6109ee5ae553d1fb3b6e7a7c4617f9" title="Generate description documentation from XML.">ast_xmldoc_build_description</a>(<span class="stringliteral">&quot;application&quot;</span>, <a class="code" href="adsistub_8c.html#ad194d73de26c0d836555e029d245493d">app</a>);
<a name="l05104"></a>05104       <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(tmp, <a class="code" href="callerid_8c.html#a68344fa88cf4e86b5079fd69a5c22d57">description</a>, tmpxml);
<a name="l05105"></a>05105       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(tmpxml);
<a name="l05106"></a>05106 
<a name="l05107"></a>05107       <span class="comment">/* load syntax */</span>
<a name="l05108"></a>05108       tmpxml = <a class="code" href="xmldoc_8h.html#a54a5b2e3ff1b6b6f06d9bab70e70c924" title="Get the syntax for a specified application or function.">ast_xmldoc_build_syntax</a>(<span class="stringliteral">&quot;application&quot;</span>, <a class="code" href="adsistub_8c.html#ad194d73de26c0d836555e029d245493d">app</a>);
<a name="l05109"></a>05109       <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(tmp, <a class="code" href="structast__app.html#ac72ddaf7b92092136fc38629a809c87a">syntax</a>, tmpxml);
<a name="l05110"></a>05110       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(tmpxml);
<a name="l05111"></a>05111 
<a name="l05112"></a>05112       <span class="comment">/* load arguments */</span>
<a name="l05113"></a>05113       tmpxml = <a class="code" href="xmldoc_8h.html#a54ea6bbcddbb8ef17051136a73227847" title="Generate the [arguments] tag based on type of node (&amp;#39;application&amp;#39;, &amp;#39;function&amp;#39;...">ast_xmldoc_build_arguments</a>(<span class="stringliteral">&quot;application&quot;</span>, <a class="code" href="adsistub_8c.html#ad194d73de26c0d836555e029d245493d">app</a>);
<a name="l05114"></a>05114       <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(tmp, <a class="code" href="structast__app.html#ad3d4ea338fb9552532c6828f6c312c57">arguments</a>, tmpxml);
<a name="l05115"></a>05115       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(tmpxml);
<a name="l05116"></a>05116 
<a name="l05117"></a>05117       <span class="comment">/* load seealso */</span>
<a name="l05118"></a>05118       tmpxml = <a class="code" href="xmldoc_8h.html#a51987b5bfa995cc9b76c81dd1a1d6ad4" title="Parse the &amp;lt;see-also&amp;gt; node content.">ast_xmldoc_build_seealso</a>(<span class="stringliteral">&quot;application&quot;</span>, <a class="code" href="adsistub_8c.html#ad194d73de26c0d836555e029d245493d">app</a>);
<a name="l05119"></a>05119       <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(tmp, <a class="code" href="structast__app.html#ac07925c5773daffa1e00486fbb9ef495">seealso</a>, tmpxml);
<a name="l05120"></a>05120       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(tmpxml);
<a name="l05121"></a>05121       tmp-&gt;<a class="code" href="structast__app.html#aa871ca3c361d229d4e37edf3c6016cc1">docsrc</a> = <a class="code" href="pbx_8h.html#a8717a951656993c40bd851ebf50f58e3a24212840b7b1b0e9c1eebc8cfd89ab3e">AST_XML_DOC</a>;
<a name="l05122"></a>05122    } <span class="keywordflow">else</span> {
<a name="l05123"></a>05123 <span class="preprocessor">#endif</span>
<a name="l05124"></a>05124 <span class="preprocessor"></span>      <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(tmp, <a class="code" href="app__externalivr_8c.html#afa26529a1480355101f5b6d883a7d37e">synopsis</a>, <a class="code" href="app__externalivr_8c.html#afa26529a1480355101f5b6d883a7d37e">synopsis</a>);
<a name="l05125"></a>05125       <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(tmp, <a class="code" href="callerid_8c.html#a68344fa88cf4e86b5079fd69a5c22d57">description</a>, <a class="code" href="callerid_8c.html#a68344fa88cf4e86b5079fd69a5c22d57">description</a>);
<a name="l05126"></a>05126       tmp-&gt;<a class="code" href="structast__app.html#aa871ca3c361d229d4e37edf3c6016cc1">docsrc</a> = <a class="code" href="pbx_8h.html#a8717a951656993c40bd851ebf50f58e3a7273ed64a1fd4a93692986eac376124a">AST_STATIC_DOC</a>;
<a name="l05127"></a>05127 <span class="preprocessor">#ifdef AST_XML_DOCS</span>
<a name="l05128"></a>05128 <span class="preprocessor"></span>   }
<a name="l05129"></a>05129 <span class="preprocessor">#endif</span>
<a name="l05130"></a>05130 <span class="preprocessor"></span>
<a name="l05131"></a>05131    strcpy(tmp-&gt;<a class="code" href="structast__app.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>, <a class="code" href="adsistub_8c.html#ad194d73de26c0d836555e029d245493d">app</a>);
<a name="l05132"></a>05132    tmp-&gt;<a class="code" href="structast__app.html#aaa273c19af19ad4f2f0cd376bd1b5f8f">execute</a> = <a class="code" href="structast__app.html#aaa273c19af19ad4f2f0cd376bd1b5f8f">execute</a>;
<a name="l05133"></a>05133    tmp-&gt;<a class="code" href="structast__app.html#a8637433cfbb88aeb10ce2ed5dcba0eb1">module</a> = mod;
<a name="l05134"></a>05134 
<a name="l05135"></a>05135    <span class="comment">/* Store in alphabetical order */</span>
<a name="l05136"></a>05136    <a class="code" href="linkedlists_8h.html#a21be6da4b2146b04b4868c2be5cae750">AST_RWLIST_TRAVERSE_SAFE_BEGIN</a>(&amp;<a class="code" href="structapps.html">apps</a>, cur, <a class="code" href="structast__app.html#a6f572a784cf87cd7e7efa625534f9d4e">list</a>) {
<a name="l05137"></a>05137       <span class="keywordflow">if</span> (strcasecmp(tmp-&gt;<a class="code" href="structast__app.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>, cur-&gt;<a class="code" href="structast__app.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>) &lt; 0) {
<a name="l05138"></a>05138          <a class="code" href="linkedlists_8h.html#acf8253a64f9a4e2170454f4bf0559e33">AST_RWLIST_INSERT_BEFORE_CURRENT</a>(tmp, <a class="code" href="structast__app.html#a6f572a784cf87cd7e7efa625534f9d4e">list</a>);
<a name="l05139"></a>05139          <span class="keywordflow">break</span>;
<a name="l05140"></a>05140       }
<a name="l05141"></a>05141    }
<a name="l05142"></a>05142    <a class="code" href="linkedlists_8h.html#a6bf0e81cb6ef01532ddebaba68f6de28">AST_RWLIST_TRAVERSE_SAFE_END</a>;
<a name="l05143"></a>05143    <span class="keywordflow">if</span> (!cur)
<a name="l05144"></a>05144       <a class="code" href="linkedlists_8h.html#aadda916488b2d151af4426e2f06ad332">AST_RWLIST_INSERT_TAIL</a>(&amp;<a class="code" href="structapps.html">apps</a>, tmp, <a class="code" href="structast__app.html#a6f572a784cf87cd7e7efa625534f9d4e">list</a>);
<a name="l05145"></a>05145 
<a name="l05146"></a>05146    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Registered application &apos;%s&apos;\n&quot;</span>, <a class="code" href="term_8h.html#a7b6c72116c334f40bf7c1e50e793c93b">term_color</a>(tmps, tmp-&gt;<a class="code" href="structast__app.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>, <a class="code" href="term_8h.html#a23aeefae76b2cacc1a6162de88c3fff0">COLOR_BRCYAN</a>, 0, <span class="keyword">sizeof</span>(tmps)));
<a name="l05147"></a>05147 
<a name="l05148"></a>05148    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structapps.html">apps</a>);
<a name="l05149"></a>05149 
<a name="l05150"></a>05150    <span class="keywordflow">return</span> 0;
<a name="l05151"></a>05151 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a52f6615f305951a0d61adc6e61920c34"></a><!-- doxytag: member="module.h::ast_unload_resource" ref="a52f6615f305951a0d61adc6e61920c34" args="(const char *resource_name, enum ast_module_unload_mode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_unload_resource </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>resource_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum&nbsp;</td>
          <td class="paramname"> <em>ast_module_unload_mode</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Unload a module. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>resource_name</em>&nbsp;</td><td>The name of the module to unload. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ast_module_unload_mode</em>&nbsp;</td><td>The force flag. This should be set using one of the AST_FORCE flags.</td></tr>
  </table>
  </dd>
</dl>
<p>This function unloads a module. It will only unload modules that are not in use (usecount not zero), unless <a class="el" href="module_8h.html#ac034ec04e9dd255a0d39bdfcb73113b9a8145144df4ddbc9122deba5069de0522">AST_FORCE_FIRM</a> or <a class="el" href="module_8h.html#ac034ec04e9dd255a0d39bdfcb73113b9a4fbd520c0fa0b70495fe9dd6aee373b9">AST_FORCE_HARD</a> is specified. Setting <a class="el" href="module_8h.html#ac034ec04e9dd255a0d39bdfcb73113b9a8145144df4ddbc9122deba5069de0522">AST_FORCE_FIRM</a> or <a class="el" href="module_8h.html#ac034ec04e9dd255a0d39bdfcb73113b9a4fbd520c0fa0b70495fe9dd6aee373b9">AST_FORCE_HARD</a> will unload the module regardless of consequences (NOT RECOMMENDED).</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on error. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="loader_8c_source.html#l00482">482</a> of file <a class="el" href="loader_8c_source.html">loader.c</a>.</p>

<p>References <a class="el" href="loader_8c_source.html#l00227">__ast_module_user_hangup_all()</a>, <a class="el" href="module_8h_source.html#l00055">AST_FORCE_FIRM</a>, <a class="el" href="linkedlists_8h_source.html#l00039">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00139">AST_LIST_UNLOCK</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="loader_8c_source.html#l01085">ast_update_use_count()</a>, <a class="el" href="loader_8c_source.html#l00091">ast_module::declined</a>, <a class="el" href="loader_8c_source.html#l00326">find_resource()</a>, <a class="el" href="structast__module.html#a4602cfc6834c0c5a50ba85844d9e36d3">ast_module::flags</a>, <a class="el" href="loader_8c_source.html#l00085">ast_module::info</a>, <a class="el" href="loader_8c_source.html#l00086">ast_module::lib</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="structast__module__info.html#ad2fc05e3da337981116e4c118c5004b0">ast_module_info::restore_globals</a>, <a class="el" href="loader_8c_source.html#l00090">ast_module::running</a>, <a class="el" href="structast__module__info.html#a06d86f635ad8f53a15cfbf757b8ed149">ast_module_info::unload</a>, <a class="el" href="loader_8c_source.html#l00345">unload_dynamic_module()</a>, and <a class="el" href="loader_8c_source.html#l00087">ast_module::usecount</a>.</p>

<p>Referenced by <a class="el" href="pbx__gtkconsole_8c_source.html#l00308">exit_now()</a>, <a class="el" href="cli_8c_source.html#l00542">handle_unload()</a>, <a class="el" href="manager_8c_source.html#l02938">manager_moduleload()</a>, <a class="el" href="pbx__gtkconsole_8c_source.html#l00203">reload()</a>, and <a class="el" href="pbx__gtkconsole_8c_source.html#l00183">remove_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00483"></a>00483 {
<a name="l00484"></a>00484    <span class="keyword">struct </span><a class="code" href="structast__module.html">ast_module</a> *mod;
<a name="l00485"></a>00485    <span class="keywordtype">int</span> res = -1;
<a name="l00486"></a>00486    <span class="keywordtype">int</span> error = 0;
<a name="l00487"></a>00487 
<a name="l00488"></a>00488    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;<a class="code" href="structmodule__list.html">module_list</a>);
<a name="l00489"></a>00489 
<a name="l00490"></a>00490    <span class="keywordflow">if</span> (!(mod = <a class="code" href="loader_8c.html#abfb73039867fcb82075f230a8bc928cd">find_resource</a>(resource_name, 0))) {
<a name="l00491"></a>00491       <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="structmodule__list.html">module_list</a>);
<a name="l00492"></a>00492       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unload failed, &apos;%s&apos; could not be found\n&quot;</span>, resource_name);
<a name="l00493"></a>00493       <span class="keywordflow">return</span> 0;
<a name="l00494"></a>00494    }
<a name="l00495"></a>00495 
<a name="l00496"></a>00496    <span class="keywordflow">if</span> (!(mod-&gt;<a class="code" href="structast__module.html#a4602cfc6834c0c5a50ba85844d9e36d3">flags</a>.<a class="code" href="structast__module.html#a08d1dda1d258042e77ca92d39a12e619">running</a> || mod-&gt;<a class="code" href="structast__module.html#a4602cfc6834c0c5a50ba85844d9e36d3">flags</a>.<a class="code" href="structast__module.html#a85ddc5d9a4ffbf82da66e98d8f85977e">declined</a>))
<a name="l00497"></a>00497       error = 1;
<a name="l00498"></a>00498 
<a name="l00499"></a>00499    <span class="keywordflow">if</span> (!error &amp;&amp; (mod-&gt;<a class="code" href="structast__module.html#ab0f2e84f976dc042139d37fd1c28d73b">usecount</a> &gt; 0)) {
<a name="l00500"></a>00500       <span class="keywordflow">if</span> (force)
<a name="l00501"></a>00501          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Warning:  Forcing removal of module &apos;%s&apos; with use count %d\n&quot;</span>,
<a name="l00502"></a>00502             resource_name, mod-&gt;<a class="code" href="structast__module.html#ab0f2e84f976dc042139d37fd1c28d73b">usecount</a>);
<a name="l00503"></a>00503       <span class="keywordflow">else</span> {
<a name="l00504"></a>00504          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Soft unload failed, &apos;%s&apos; has use count %d\n&quot;</span>, resource_name,
<a name="l00505"></a>00505             mod-&gt;<a class="code" href="structast__module.html#ab0f2e84f976dc042139d37fd1c28d73b">usecount</a>);
<a name="l00506"></a>00506          error = 1;
<a name="l00507"></a>00507       }
<a name="l00508"></a>00508    }
<a name="l00509"></a>00509 
<a name="l00510"></a>00510    <span class="keywordflow">if</span> (!error) {
<a name="l00511"></a>00511       <a class="code" href="module_8h.html#afc270b7358ecf057945a5ddbe3a4d750">__ast_module_user_hangup_all</a>(mod);
<a name="l00512"></a>00512       res = mod-&gt;<a class="code" href="structast__module.html#a92b847af7c50bfb3566f2eae3602afb1">info</a>-&gt;<a class="code" href="structast__module__info.html#a06d86f635ad8f53a15cfbf757b8ed149">unload</a>();
<a name="l00513"></a>00513 
<a name="l00514"></a>00514       <span class="keywordflow">if</span> (res) {
<a name="l00515"></a>00515          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Firm unload failed for %s\n&quot;</span>, resource_name);
<a name="l00516"></a>00516          <span class="keywordflow">if</span> (force &lt;= <a class="code" href="module_8h.html#ac034ec04e9dd255a0d39bdfcb73113b9a8145144df4ddbc9122deba5069de0522">AST_FORCE_FIRM</a>)
<a name="l00517"></a>00517             error = 1;
<a name="l00518"></a>00518          <span class="keywordflow">else</span>
<a name="l00519"></a>00519             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;** Dangerous **: Unloading resource anyway, at user request\n&quot;</span>);
<a name="l00520"></a>00520       }
<a name="l00521"></a>00521    }
<a name="l00522"></a>00522 
<a name="l00523"></a>00523    <span class="keywordflow">if</span> (!error)
<a name="l00524"></a>00524       mod-&gt;<a class="code" href="structast__module.html#a4602cfc6834c0c5a50ba85844d9e36d3">flags</a>.<a class="code" href="structast__module.html#a08d1dda1d258042e77ca92d39a12e619">running</a> = mod-&gt;<a class="code" href="structast__module.html#a4602cfc6834c0c5a50ba85844d9e36d3">flags</a>.<a class="code" href="structast__module.html#a85ddc5d9a4ffbf82da66e98d8f85977e">declined</a> = 0;
<a name="l00525"></a>00525 
<a name="l00526"></a>00526    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="structmodule__list.html">module_list</a>);
<a name="l00527"></a>00527 
<a name="l00528"></a>00528    <span class="keywordflow">if</span> (!error &amp;&amp; !mod-&gt;<a class="code" href="structast__module.html#a5940281c73a2d41b4afdfff28af5859a">lib</a> &amp;&amp; mod-&gt;<a class="code" href="structast__module.html#a92b847af7c50bfb3566f2eae3602afb1">info</a> &amp;&amp; mod-&gt;<a class="code" href="structast__module.html#a92b847af7c50bfb3566f2eae3602afb1">info</a>-&gt;<a class="code" href="structast__module__info.html#ad2fc05e3da337981116e4c118c5004b0">restore_globals</a>)
<a name="l00529"></a>00529       mod-&gt;<a class="code" href="structast__module.html#a92b847af7c50bfb3566f2eae3602afb1">info</a>-&gt;<a class="code" href="structast__module__info.html#ad2fc05e3da337981116e4c118c5004b0">restore_globals</a>();
<a name="l00530"></a>00530 
<a name="l00531"></a>00531 <span class="preprocessor">#ifdef LOADABLE_MODULES</span>
<a name="l00532"></a>00532 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (!error)
<a name="l00533"></a>00533       <a class="code" href="loader_8c.html#a5e400c9a7efe02d48abcbb6740c88ce5">unload_dynamic_module</a>(mod);
<a name="l00534"></a>00534 <span class="preprocessor">#endif</span>
<a name="l00535"></a>00535 <span class="preprocessor"></span>
<a name="l00536"></a>00536    <span class="keywordflow">if</span> (!error)
<a name="l00537"></a>00537       <a class="code" href="module_8h.html#a28b9e8444e0f9b495cc1b10628b816e8" title="Notify when usecount has been changed.">ast_update_use_count</a>();
<a name="l00538"></a>00538 
<a name="l00539"></a>00539    <span class="keywordflow">return</span> res;
<a name="l00540"></a>00540 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad2ca15621101154f29748cf1dac3c3cf"></a><!-- doxytag: member="module.h::ast_unregister_application" ref="ad2ca15621101154f29748cf1dac3c3cf" args="(const char *app)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_unregister_application </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>app</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Unregister an application. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>app</em>&nbsp;</td><td>name of the application (does not have to be the same string as the one that was registered)</td></tr>
  </table>
  </dd>
</dl>
<p>This unregisters an application from Asterisk's internal application list.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l06403">6403</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="linkedlists_8h_source.html#l00564">AST_RWLIST_REMOVE_CURRENT</a>, <a class="el" href="linkedlists_8h_source.html#l00541">AST_RWLIST_TRAVERSE_SAFE_BEGIN</a>, <a class="el" href="linkedlists_8h_source.html#l00601">AST_RWLIST_TRAVERSE_SAFE_END</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, <a class="el" href="stringfields_8h_source.html#l00245">ast_string_field_free_memory</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="pbx_8c_source.html#l00868">ast_app::name</a>, and <a class="el" href="pbx_8c_source.html#l06384">unreference_cached_app()</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l15849">__unload_module()</a>, <a class="el" href="app__jack_8c_source.html#l01011">load_module()</a>, and <a class="el" href="app__adsiprog_8c_source.html#l01582">unload_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l06404"></a>06404 {
<a name="l06405"></a>06405    <span class="keyword">struct </span><a class="code" href="structast__app.html" title="ast_app: A registered application">ast_app</a> *tmp;
<a name="l06406"></a>06406 
<a name="l06407"></a>06407    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structapps.html">apps</a>);
<a name="l06408"></a>06408    <a class="code" href="linkedlists_8h.html#a21be6da4b2146b04b4868c2be5cae750">AST_RWLIST_TRAVERSE_SAFE_BEGIN</a>(&amp;<a class="code" href="structapps.html">apps</a>, tmp, <a class="code" href="structast__app.html#a6f572a784cf87cd7e7efa625534f9d4e">list</a>) {
<a name="l06409"></a>06409       <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="adsistub_8c.html#ad194d73de26c0d836555e029d245493d">app</a>, tmp-&gt;<a class="code" href="structast__app.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>)) {
<a name="l06410"></a>06410          <a class="code" href="pbx_8c.html#a7d988d7cc30a609acec6a05c07546cbb">unreference_cached_app</a>(tmp);
<a name="l06411"></a>06411          <a class="code" href="linkedlists_8h.html#a02212548652c9eb0f3db38dc4e4bd285">AST_RWLIST_REMOVE_CURRENT</a>(<a class="code" href="structast__app.html#a6f572a784cf87cd7e7efa625534f9d4e">list</a>);
<a name="l06412"></a>06412          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Unregistered application &apos;%s&apos;\n&quot;</span>, tmp-&gt;<a class="code" href="structast__app.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>);
<a name="l06413"></a>06413          <a class="code" href="stringfields_8h.html#abf60f862ae6a141d2f86a0f5e82792de" title="free all memory - to be called before destroying the object">ast_string_field_free_memory</a>(tmp);
<a name="l06414"></a>06414          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(tmp);
<a name="l06415"></a>06415          <span class="keywordflow">break</span>;
<a name="l06416"></a>06416       }
<a name="l06417"></a>06417    }
<a name="l06418"></a>06418    <a class="code" href="linkedlists_8h.html#a6bf0e81cb6ef01532ddebaba68f6de28">AST_RWLIST_TRAVERSE_SAFE_END</a>;
<a name="l06419"></a>06419    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structapps.html">apps</a>);
<a name="l06420"></a>06420 
<a name="l06421"></a>06421    <span class="keywordflow">return</span> tmp ? 0 : -1;
<a name="l06422"></a>06422 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a19adc7caa79fecaf1257325ffb366fe7"></a><!-- doxytag: member="module.h::ast_update_module_list" ref="a19adc7caa79fecaf1257325ffb366fe7" args="(int(*modentry)(const char *module, const char *description, int usecnt, const char *like), const char *like)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_update_module_list </td>
          <td>(</td>
          <td class="paramtype">int(*)(const char *module, const char *<a class="el" href="callerid_8c.html#a68344fa88cf4e86b5079fd69a5c22d57">description</a>, int <a class="el" href="chan__unistim_8c.html#a2f8d20b887dab5677a21b650895a0dec">usecnt</a>, const char *like)&nbsp;</td>
          <td class="paramname"> <em>modentry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>like</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Ask for a list of modules, descriptions, and use counts. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>modentry</em>&nbsp;</td><td>A callback to an updater function. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>like</em>&nbsp;</td><td>For each of the modules loaded, modentry will be executed with the resource, description, and usecount <a class="el" href="structvalues.html">values</a> of each particular module.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>the <a class="el" href="structnumber.html" title="Number structure.">number</a> of modules loaded </dd></dl>

<p>Definition at line <a class="el" href="loader_8c_source.html#l01097">1097</a> of file <a class="el" href="loader_8c_source.html">loader.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00104">AST_LIST_TRYLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00139">AST_LIST_UNLOCK</a>, <a class="el" href="module_8h_source.html#l00211">ast_module_info::description</a>, <a class="el" href="loader_8c_source.html#l00085">ast_module::info</a>, <a class="el" href="loader_8c_source.html#l00094">ast_module::resource</a>, and <a class="el" href="loader_8c_source.html#l00087">ast_module::usecount</a>.</p>

<p>Referenced by <a class="el" href="agent_8c_source.html#l00740">ast_var_Modules()</a>, <a class="el" href="cli_8c_source.html#l00696">handle_modlist()</a>, and <a class="el" href="pbx__gtkconsole_8c_source.html#l00292">mod_update()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01099"></a>01099 {
<a name="l01100"></a>01100    <span class="keyword">struct </span><a class="code" href="structast__module.html">ast_module</a> *cur;
<a name="l01101"></a>01101    <span class="keywordtype">int</span> unlock = -1;
<a name="l01102"></a>01102    <span class="keywordtype">int</span> total_mod_loaded = 0;
<a name="l01103"></a>01103 
<a name="l01104"></a>01104    <span class="keywordflow">if</span> (<a class="code" href="linkedlists_8h.html#aee292a58a6a116a7b705e90189321c56" title="Locks a list, without blocking if the list is locked.">AST_LIST_TRYLOCK</a>(&amp;<a class="code" href="structmodule__list.html">module_list</a>))
<a name="l01105"></a>01105       unlock = 0;
<a name="l01106"></a>01106  
<a name="l01107"></a>01107    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="structmodule__list.html">module_list</a>, cur, <a class="code" href="structast__module.html#a9fea691ae9aba6d601e329e598441c1a">entry</a>) {
<a name="l01108"></a>01108       total_mod_loaded += modentry(cur-&gt;<a class="code" href="structast__module.html#ac88a22a2e7bf6d75bcc8fcc8ff257e9f">resource</a>, cur-&gt;<a class="code" href="structast__module.html#a92b847af7c50bfb3566f2eae3602afb1">info</a>-&gt;<a class="code" href="structast__module__info.html#a68344fa88cf4e86b5079fd69a5c22d57">description</a>, cur-&gt;<a class="code" href="structast__module.html#ab0f2e84f976dc042139d37fd1c28d73b">usecount</a>, like);
<a name="l01109"></a>01109    }
<a name="l01110"></a>01110 
<a name="l01111"></a>01111    <span class="keywordflow">if</span> (unlock)
<a name="l01112"></a>01112       <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="structmodule__list.html">module_list</a>);
<a name="l01113"></a>01113 
<a name="l01114"></a>01114    <span class="keywordflow">return</span> total_mod_loaded;
<a name="l01115"></a>01115 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a28b9e8444e0f9b495cc1b10628b816e8"></a><!-- doxytag: member="module.h::ast_update_use_count" ref="a28b9e8444e0f9b495cc1b10628b816e8" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_update_use_count </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Notify when usecount has been changed. </p>
<p>This function calulates use counts and notifies anyone trying to keep track of them. It should be called whenever your module's usecount changes.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>The ast_module_user_* functions take care of calling this function for you. </dd></dl>

<p>Definition at line <a class="el" href="loader_8c_source.html#l01085">1085</a> of file <a class="el" href="loader_8c_source.html">loader.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00039">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00139">AST_LIST_UNLOCK</a>, and <a class="el" href="structloadupdate.html#a4a45824143144324dc8e65241a06fc3a">loadupdate::updater</a>.</p>

<p>Referenced by <a class="el" href="loader_8c_source.html#l00195">__ast_module_user_add()</a>, <a class="el" href="loader_8c_source.html#l00227">__ast_module_user_hangup_all()</a>, <a class="el" href="loader_8c_source.html#l00216">__ast_module_user_remove()</a>, <a class="el" href="loader_8c_source.html#l01163">ast_module_ref()</a>, <a class="el" href="loader_8c_source.html#l01171">ast_module_unref()</a>, <a class="el" href="loader_8c_source.html#l00482">ast_unload_resource()</a>, <a class="el" href="pbx__gtkconsole_8c_source.html#l00308">exit_now()</a>, <a class="el" href="chan__sip_8c_source.html#l21921">handle_request_do()</a>, <a class="el" href="pbx__gtkconsole_8c_source.html#l00483">load_module()</a>, <a class="el" href="chan__h323_8c_source.html#l01722">oh323_request()</a>, <a class="el" href="chan__sip_8c_source.html#l21792">scheduler_process_request_queue()</a>, <a class="el" href="chan__sip_8c_source.html#l23066">sip_request_call()</a>, <a class="el" href="loader_8c_source.html#l00731">start_resource()</a>, and <a class="el" href="chan__unistim_8c_source.html#l04422">unistim_new()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01086"></a>01086 {
<a name="l01087"></a>01087    <span class="comment">/* Notify any module monitors that the use count for a</span>
<a name="l01088"></a>01088 <span class="comment">      resource has changed */</span>
<a name="l01089"></a>01089    <span class="keyword">struct </span><a class="code" href="structloadupdate.html">loadupdate</a> *m;
<a name="l01090"></a>01090 
<a name="l01091"></a>01091    <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;<a class="code" href="structupdaters.html">updaters</a>);
<a name="l01092"></a>01092    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="structupdaters.html">updaters</a>, m, <a class="code" href="structloadupdate.html#a23f79a5c6bb21f2f7c9759f1460fcb4a">entry</a>)
<a name="l01093"></a>01093       m-&gt;<a class="code" href="structloadupdate.html#a4a45824143144324dc8e65241a06fc3a">updater</a>();
<a name="l01094"></a>01094    <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="structupdaters.html">updaters</a>);
<a name="l01095"></a>01095 }
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="ae25b9f3970870610911f8850897e8ead"></a><!-- doxytag: member="module.h::ast_module_info" ref="ae25b9f3970870610911f8850897e8ead" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__module__info.html">ast_module_info</a>* <a class="el" href="structast__module__info.html">ast_module_info</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="module_8h_source.html#l00283">283</a> of file <a class="el" href="module_8h_source.html">module.h</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:22:24 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
