<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:19:45 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_0ca6ff3bf6b340411b2c6edd15b1a34d.html">channels</a>
  </div>
</div>
<div class="contents">
<h1>chan_dahdi.c File Reference</h1>
<p>DAHDI for Pseudo TDM.  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="asterisk_8h_source.html">asterisk.h</a>&quot;</code><br/>
<code>#include &lt;sys/signal.h&gt;</code><br/>
<code>#include &lt;sys/ioctl.h&gt;</code><br/>
<code>#include &lt;math.h&gt;</code><br/>
<code>#include &lt;ctype.h&gt;</code><br/>
<code>#include &lt;dahdi/user.h&gt;</code><br/>
<code>#include &lt;dahdi/tonezone.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="lock_8h_source.html">asterisk/lock.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="channel_8h_source.html">asterisk/channel.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="config_8h_source.html">asterisk/config.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="module_8h_source.html">asterisk/module.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="pbx_8h_source.html">asterisk/pbx.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="file_8h_source.html">asterisk/file.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="ulaw_8h_source.html">asterisk/ulaw.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="alaw_8h_source.html">asterisk/alaw.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="callerid_8h_source.html">asterisk/callerid.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="adsi_8h_source.html">asterisk/adsi.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="cli_8h_source.html">asterisk/cli.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="cdr_8h_source.html">asterisk/cdr.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="features_8h_source.html">asterisk/features.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="musiconhold_8h_source.html">asterisk/musiconhold.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="say_8h_source.html">asterisk/say.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="tdd_8h_source.html">asterisk/tdd.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="app_8h_source.html">asterisk/app.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="dsp_8h_source.html">asterisk/dsp.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="astdb_8h_source.html">asterisk/astdb.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="manager_8h_source.html">asterisk/manager.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="causes_8h_source.html">asterisk/causes.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="term_8h_source.html">asterisk/term.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="utils_8h_source.html">asterisk/utils.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="transcap_8h_source.html">asterisk/transcap.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="stringfields_8h_source.html">asterisk/stringfields.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="abstract__jb_8h_source.html">asterisk/abstract_jb.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="smdi_8h_source.html">asterisk/smdi.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="astobj_8h_source.html">asterisk/astobj.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="event_8h_source.html">asterisk/event.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="devicestate_8h_source.html">asterisk/devicestate.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="paths_8h_source.html">asterisk/paths.h</a>&quot;</code><br/>

<p><a href="chan__dahdi_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structdahdi__chan__conf.html">dahdi_chan_conf</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Channel configuration from chan_dahdi.conf . This struct is used for parsing the [<a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>] section of chan_dahdi.conf. Generally there is a field here for every possible configuration item.  <a href="structdahdi__chan__conf.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structdahdi__distRings.html">dahdi_distRings</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structdahdi__pvt.html">dahdi_pvt</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structdahdi__subchannel.html">dahdi_subchannel</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structdistRingData.html">distRingData</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmwi__thread__data.html">mwi_thread_data</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmwisend__info.html">mwisend_info</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structringContextData.html">ringContextData</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#aaee0889ebef226ef3d5842fc7c3e5e7a">ASCII_BYTES_PER_CHAR</a>&nbsp;&nbsp;&nbsp;80</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a830b5fdb3ba653640d3f5044192d82bf">AST_LAW</a>(p)&nbsp;&nbsp;&nbsp;(((p)-&gt;law == DAHDI_LAW_ALAW) ? AST_FORMAT_ALAW : AST_FORMAT_ULAW)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a88fcc93d4541c9adcab90b8b2ff37685">CALLPROGRESS_FAX</a>&nbsp;&nbsp;&nbsp;(CALLPROGRESS_FAX_INCOMING | CALLPROGRESS_FAX_OUTGOING)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a0069de9c37a93a8941cef2ce562abf81">CALLPROGRESS_FAX_INCOMING</a>&nbsp;&nbsp;&nbsp;4</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a2957dd1e62c977f55ccb4eeb99d87052">CALLPROGRESS_FAX_OUTGOING</a>&nbsp;&nbsp;&nbsp;2</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#aa66794917b368980eacd1bf179268e15">CALLPROGRESS_PROGRESS</a>&nbsp;&nbsp;&nbsp;1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a2422d71182014158dd163f020a8d4cc7">CALLWAITING_REPEAT_SAMPLES</a>&nbsp;&nbsp;&nbsp;( (10000 * 8) / READ_SIZE)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ae4c55b088658cc3983b18e093ae0a01a">CALLWAITING_SILENT_SAMPLES</a>&nbsp;&nbsp;&nbsp;( (300 * 8) / READ_SIZE)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#afc63e8eef602e5dd95f7363062550e0f">CANBUSYDETECT</a>(p)&nbsp;&nbsp;&nbsp;(ISTRUNK(p) || (p-&gt;sig &amp; (SIG_EM | SIG_EM_E1 | SIG_SF)) /* || (p-&gt;sig &amp; __DAHDI_SIG_FXO) */)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#aa40ff55dfcec4b66be7bbaec05993fad">CANPROGRESSDETECT</a>(p)&nbsp;&nbsp;&nbsp;(ISTRUNK(p) || (p-&gt;sig &amp; (SIG_EM | SIG_EM_E1 | SIG_SF)) /* || (p-&gt;sig &amp; __DAHDI_SIG_FXO) */)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ada02a3fa3d2da06560df664c7228a559">CHAN_PSEUDO</a>&nbsp;&nbsp;&nbsp;-2</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#aa5330d927fb8cad0df499df686543eeb">CHANNEL_PSEUDO</a>&nbsp;&nbsp;&nbsp;-12</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a1117129c7428d435d09423775904f91a">CIDCW_EXPIRE_SAMPLES</a>&nbsp;&nbsp;&nbsp;( (500 * 8) / READ_SIZE)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a35448edd80150ba52bebf13fe7bfdcab">CONF_USER_REAL</a>&nbsp;&nbsp;&nbsp;(1 &lt;&lt; 0)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a04995f0702692dc37ba72b16dac473e4">CONF_USER_THIRDCALL</a>&nbsp;&nbsp;&nbsp;(1 &lt;&lt; 1)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#aa65ac97c8c851bb8c7e1b80c523670f2">DAHDI_CHAN_MAPPING_LOGICAL</a>&nbsp;&nbsp;&nbsp;1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#af23a6a3582578bef25f1062d0dea1fc9">DAHDI_CHAN_MAPPING_PHYSICAL</a>&nbsp;&nbsp;&nbsp;0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a6633b1ced0d29c25cfba81c2349db046">DAHDI_OVERLAPDIAL_BOTH</a>&nbsp;&nbsp;&nbsp;(DAHDI_OVERLAPDIAL_INCOMING|DAHDI_OVERLAPDIAL_OUTGOING)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ab30dead77fa070cbe51316f43fcea8a2">DAHDI_OVERLAPDIAL_INCOMING</a>&nbsp;&nbsp;&nbsp;2</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a90cfffbd61222b99c247c74dd67a361a">DAHDI_OVERLAPDIAL_NONE</a>&nbsp;&nbsp;&nbsp;0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a4bccf90ead0cf7c93b177e59cbe5b3be">DAHDI_OVERLAPDIAL_OUTGOING</a>&nbsp;&nbsp;&nbsp;1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a23d4bddf4728371d9249323553f1fda1">DCHAN_AVAILABLE</a>&nbsp;&nbsp;&nbsp;(DCHAN_PROVISIONED | DCHAN_NOTINALARM | DCHAN_UP)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a4dc8a50049ed9587a0422a70565f1168">DCHAN_NOTINALARM</a>&nbsp;&nbsp;&nbsp;(1 &lt;&lt; 1)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ac8c27b72601b33385997100007b9a2e6">DCHAN_PROVISIONED</a>&nbsp;&nbsp;&nbsp;(1 &lt;&lt; 0)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a65b702e73ac512c6b46ac4d2cba85a74">DCHAN_UP</a>&nbsp;&nbsp;&nbsp;(1 &lt;&lt; 2)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ad39eeeb16f274560c29b960b2096d6d7">DEFAULT_CIDRINGS</a>&nbsp;&nbsp;&nbsp;1</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Typically, how many rings before we should send Caller*ID.  <a href="#ad39eeeb16f274560c29b960b2096d6d7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a28a1be995810b1a2ee849db935f7c51f">DEFAULT_RINGT</a>&nbsp;&nbsp;&nbsp;( (8000 * 8) / READ_SIZE)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a5b4bd94085f8d9db39f0096a52f795b3">END_SILENCE_LEN</a>&nbsp;&nbsp;&nbsp;400</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ac8dc47e3b39c930caed4bfd05b4ba805">FORMAT</a>&nbsp;&nbsp;&nbsp;&quot;%-40.40s %-7.7s %-6d %-6d %-6d %-3.3s %-4.4s %-8.8s %s\n&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ac8dc47e3b39c930caed4bfd05b4ba805">FORMAT</a>&nbsp;&nbsp;&nbsp;&quot;%7s %-10.10s %-15.15s %-10.10s %-20.20s %-10.10s %-10.10s\n&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#acfd58ce0ec836919236d7a1908494970">FORMAT2</a>&nbsp;&nbsp;&nbsp;&quot;%-40.40s %-7.7s %-6.6s %-6.6s %-6.6s %-3.3s %-4.4s %-8.8s %s\n&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#acfd58ce0ec836919236d7a1908494970">FORMAT2</a>&nbsp;&nbsp;&nbsp;&quot;%7s %-10.10s %-15.15s %-10.10s %-20.20s %-10.10s %-10.10s\n&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a93559b640fd4e3fad51f56745e05d2cf">GET_CHANNEL</a>(p)&nbsp;&nbsp;&nbsp;((p)-&gt;channel)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a096c3727950fc9aa70ca1b817dba1cf7">HANGUP</a>&nbsp;&nbsp;&nbsp;1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ab8f5e10b9f780e53f9583724ac965a0c">HEADER_LEN</a>&nbsp;&nbsp;&nbsp;((HEADER_MS + TRAILER_MS) * 8)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a372dce8627cc49448555f8372f743de9">HEADER_MS</a>&nbsp;&nbsp;&nbsp;50</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#aaba53263d23f0d5fc75b177b9adfc851">ISTRUNK</a>(p)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a65f5bd9f1932cdfe24b21443e4ddb576">MASK_AVAIL</a>&nbsp;&nbsp;&nbsp;(1 &lt;&lt; 0)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a4db09170290b8520f18e72e8559345fe">MASK_INUSE</a>&nbsp;&nbsp;&nbsp;(1 &lt;&lt; 1)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a29baa04e5997d3badd14e3291b69196b">MAX_CHANLIST_LEN</a>&nbsp;&nbsp;&nbsp;80</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ac69ee46f4a51ed14f0d68628c2dec71d">MAX_CHANNELS</a>&nbsp;&nbsp;&nbsp;672</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a2a3c5190bdbe2a4780a460383970aa92">MAX_SLAVES</a>&nbsp;&nbsp;&nbsp;4</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ac148eea53bd254d0c5b5757dd46d7058">MIN_MS_SINCE_FLASH</a>&nbsp;&nbsp;&nbsp;( (2000) )</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a97fec6c0baa06f18539a7c8165314210">NEED_MFDETECT</a>(p)&nbsp;&nbsp;&nbsp;(((p)-&gt;sig == SIG_FEATDMF) || ((p)-&gt;sig == SIG_FEATDMF_TA) || ((p)-&gt;sig == SIG_E911) || ((p)-&gt;sig == SIG_FGC_CAMA) || ((p)-&gt;sig == SIG_FGC_CAMAMF) || ((p)-&gt;sig == SIG_FEATB))</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Signaling types that need to use MF detection should be placed in this macro.  <a href="#a97fec6c0baa06f18539a7c8165314210"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#afa0bff4fd3f279871e101c0158c5a81a">NUM_CADENCE_MAX</a>&nbsp;&nbsp;&nbsp;25</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#aaad94eef7bd74293b956f6de74a62d0f">NUM_DCHANS</a>&nbsp;&nbsp;&nbsp;4</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a80bfdd8adbffe226265cd729655a7268">NUM_SPANS</a>&nbsp;&nbsp;&nbsp;32</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ad35015bf9d15c7474a4fef58ed0dcab2">POLARITY_IDLE</a>&nbsp;&nbsp;&nbsp;0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#aeba680adad3f0d1146c8e5003f6a44f2">POLARITY_REV</a>&nbsp;&nbsp;&nbsp;1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a6743ea33516885eca81012e31dfb7d09">PROC_DAHDI_OPT_NOCHAN</a>&nbsp;&nbsp;&nbsp;(1 &lt;&lt; 0)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ac0fd63b3569161611cb73dcd4af16570">PROC_DAHDI_OPT_NOWARN</a>&nbsp;&nbsp;&nbsp;(1 &lt;&lt; 1)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a86e1969b50e55e5d506233078ca0fa4c">READ_SIZE</a>&nbsp;&nbsp;&nbsp;160</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ac36e4cc782493e37064405666f5e4fdd">sig2str</a>&nbsp;&nbsp;&nbsp;dahdi_sig2str</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ab5bfeaf991c23c5b6510ace44ae79ce9">SIG_BRI</a>&nbsp;&nbsp;&nbsp;(0x2000000 | DAHDI_SIG_CLEAR)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a>&nbsp;&nbsp;&nbsp;(0X4000000 | DAHDI_SIG_CLEAR)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#adfdd0e4d05281d354c15ef1a5d158cd6">SIG_E911</a>&nbsp;&nbsp;&nbsp;(0x1000000 | DAHDI_SIG_EM)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#afa7547cd2cee1bae7734206102635216">SIG_EM</a>&nbsp;&nbsp;&nbsp;DAHDI_SIG_EM</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#aa7b59772722b794c5218768dac3ee419">SIG_EM_E1</a>&nbsp;&nbsp;&nbsp;DAHDI_SIG_EM_E1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a1ba988b93fce049075b7c2ef6c931cf9">SIG_EMWINK</a>&nbsp;&nbsp;&nbsp;(0x0100000 | DAHDI_SIG_EM)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a0ba8ec199f5fb4f2be64144be0bd13b1">SIG_FEATB</a>&nbsp;&nbsp;&nbsp;(0x0800000 | DAHDI_SIG_EM)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ab79873391af2857a602e1eff68606f23">SIG_FEATD</a>&nbsp;&nbsp;&nbsp;(0x0200000 | DAHDI_SIG_EM)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a98d4710afc1fcb2ff110eabb4fbcc308">SIG_FEATDMF</a>&nbsp;&nbsp;&nbsp;(0x0400000 | DAHDI_SIG_EM)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ac0c40f74945ed15aa82cd9fedc304e55">SIG_FEATDMF_TA</a>&nbsp;&nbsp;&nbsp;(0x2000000 | DAHDI_SIG_EM)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a167056b2763a4897838c7115efc1f9fc">SIG_FGC_CAMA</a>&nbsp;&nbsp;&nbsp;(0x4000000 | DAHDI_SIG_EM)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a945e2b5f225d3abdc57b5dcc53daa62a">SIG_FGC_CAMAMF</a>&nbsp;&nbsp;&nbsp;(0x8000000 | DAHDI_SIG_EM)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a3dcffbaf4a26f2b7b792998df1eea27b">SIG_FXOGS</a>&nbsp;&nbsp;&nbsp;DAHDI_SIG_FXOGS</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a7c9b3bb8225896ff2b9aed27e6f80f10">SIG_FXOKS</a>&nbsp;&nbsp;&nbsp;DAHDI_SIG_FXOKS</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#adb40571aa5ff846fc334be5260eab257">SIG_FXOLS</a>&nbsp;&nbsp;&nbsp;DAHDI_SIG_FXOLS</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a97e4c6fb4680984aafc6e0e55a2b6cb4">SIG_FXSGS</a>&nbsp;&nbsp;&nbsp;DAHDI_SIG_FXSGS</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a38139ec369c0243f4324eb4eb0c2f004">SIG_FXSKS</a>&nbsp;&nbsp;&nbsp;DAHDI_SIG_FXSKS</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a1dc50a07aef86c90ab94f1583c35a265">SIG_FXSLS</a>&nbsp;&nbsp;&nbsp;DAHDI_SIG_FXSLS</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a5724d8559318f4724b247ede46ff182d">SIG_GR303FXOKS</a>&nbsp;&nbsp;&nbsp;(0x0100000 | DAHDI_SIG_FXOKS)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#adc73c6cbd4b991ecd2925640c0c8761e">SIG_GR303FXSKS</a>&nbsp;&nbsp;&nbsp;(0x0100000 | DAHDI_SIG_FXSKS)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a1d73a98ae12601287580dedd9a6d739b">SIG_MFCR2</a>&nbsp;&nbsp;&nbsp;DAHDI_SIG_CAS</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ae9ab0c9508fca045a06730533be276a5">SIG_PRI</a>&nbsp;&nbsp;&nbsp;DAHDI_SIG_CLEAR</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#afacb372d32fba2192ed6a2989c54fbda">SIG_SF</a>&nbsp;&nbsp;&nbsp;DAHDI_SIG_SF</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a33a2f70a24e9f8ccfcc1e76f208b1ab6">SIG_SF_FEATB</a>&nbsp;&nbsp;&nbsp;(0x0800000 | DAHDI_SIG_SF)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#aac334a7f88651d9e44499897386d2cfd">SIG_SF_FEATD</a>&nbsp;&nbsp;&nbsp;(0x0200000 | DAHDI_SIG_SF)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a4625d3aba972e102c8460a9f16af0fc7">SIG_SF_FEATDMF</a>&nbsp;&nbsp;&nbsp;(0x0400000 | DAHDI_SIG_SF)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a193853e7e76cff05d51425eba48d030f">SIG_SFWINK</a>&nbsp;&nbsp;&nbsp;(0x0100000 | DAHDI_SIG_SF)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#aadcda889db3cf9dfe757dbc1d4d8311a">SIG_SS7</a>&nbsp;&nbsp;&nbsp;(0x1000000 | DAHDI_SIG_CLEAR)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#aa23909e437da8e1a5b8bf9b1b1e7fcdc">SMDI_MD_WAIT_TIMEOUT</a>&nbsp;&nbsp;&nbsp;1500</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>&nbsp;&nbsp;&nbsp;1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>&nbsp;&nbsp;&nbsp;0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>&nbsp;&nbsp;&nbsp;2</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a9b7ef3aa0efb7411931914e8562c8d46">TRAILER_MS</a>&nbsp;&nbsp;&nbsp;5</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a3811374ead4311c8b04a85ae6dd7196b">TRANSFER</a>&nbsp;&nbsp;&nbsp;0</td></tr>
<tr><td colspan="2"><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ac6eb1255d7d5fc62e32b545a15e2ee38">mwisend_states</a> { <br/>
&nbsp;&nbsp;<a class="el" href="chan__dahdi_8c.html#ac6eb1255d7d5fc62e32b545a15e2ee38a048f09b2d4c8ab143595fb3a033ba888">MWI_SEND_NULL</a> =  0, 
<a class="el" href="chan__dahdi_8c.html#ac6eb1255d7d5fc62e32b545a15e2ee38a26ea69f32853d570979948e99c019ad6">MWI_SEND_SA</a>, 
<a class="el" href="chan__dahdi_8c.html#ac6eb1255d7d5fc62e32b545a15e2ee38a6a12b01ecaf82d8837cb5d4e1764b54f">MWI_SEND_SA_WAIT</a>, 
<a class="el" href="chan__dahdi_8c.html#ac6eb1255d7d5fc62e32b545a15e2ee38a5030903afd5a2db7324494c3b2546935">MWI_SEND_PAUSE</a>, 
<br/>
&nbsp;&nbsp;<a class="el" href="chan__dahdi_8c.html#ac6eb1255d7d5fc62e32b545a15e2ee38abdb497716e46eb102ddd50ed81082e4c">MWI_SEND_SPILL</a>, 
<a class="el" href="chan__dahdi_8c.html#ac6eb1255d7d5fc62e32b545a15e2ee38ac1e087089f32665428639ae83f465b60">MWI_SEND_CLEANUP</a>, 
<a class="el" href="chan__dahdi_8c.html#ac6eb1255d7d5fc62e32b545a15e2ee38aae305004b9065d512f57d60fb0d36ef1">MWI_SEND_DONE</a>
<br/>
 }</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#afa1252981be0ae4165d3ff5993f9f9f1">__dahdi_exception</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *ast)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a2fd806029fe936c297e52d2236092fc0">__unload_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#af51603d74ba059c0bfc173b52e978686">action_dahdidialoffhook</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ad0866f57abaf118be36f09ed96ccdf07">action_dahdidndoff</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a91c68fb8703f9429fea494a96d638f0d">action_dahdidndon</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#acc92e8b12c791b7815e25d5a8451208f">action_dahdirestart</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a9f7e1b7dfbfbc2a04b02e6bf9376fc6c">action_dahdishowchannels</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a742acb2daa27adb84742a69ce1f0c7e9">action_transfer</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#afc56ae0d7123c24f867eafcaaa3743ea">action_transferhangup</a> (struct <a class="el" href="structmansession.html">mansession</a> *s, const struct <a class="el" href="structmessage.html">message</a> *m)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a0277190f0a3d01afa3bab8e7bcd47892">alarm2str</a> (int alm)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a8d921023bd460fd8278825f8f360f918">alloc_sub</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *p, int x)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ad54718f35d51ea9e62be03de62077724">AST_MODULE_INFO</a> (ASTERISK_GPL_KEY, AST_MODFLAG_DEFAULT, <a class="el" href="chan__usbradio_8c.html#a206197bcdc50090e511e22b33a2166a9">tdesc</a>,.load=load_module,.unload=unload_module,.reload=reload,)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ace10a3ad9bc673a5f3b1bb3c100ba644">AST_MUTEX_DEFINE_STATIC</a> (restart_lock)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a52fadbfaba2c70ca0d4b32cdd7c16a1c">AST_MUTEX_DEFINE_STATIC</a> (ss_thread_lock)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a381db14ebde360ab4092e0c7ab18579d">AST_MUTEX_DEFINE_STATIC</a> (monlock)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Protect the monitoring thread, so only one process can kill or start it, and not when it's doing something critical.  <a href="#a381db14ebde360ab4092e0c7ab18579d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a8a540d6c5362c0966c0c929270f046b7">AST_MUTEX_DEFINE_STATIC</a> (iflock)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Protect the interface list (of dahdi_pvt's).  <a href="#a8a540d6c5362c0966c0c929270f046b7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a4119ca9de19a055b1db3bb27bc8f589a">attempt_transfer</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *p)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a305c0e17a1db304e7e5d0a4c39e5d9a4">available</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *p, int channelmatch, <a class="el" href="channel_8h.html#a641d81d0c5c8df99d43eff69aede3bfd">ast_group_t</a> groupmatch, int *busy, int *channelmatched, int *groupmatched)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a00c626d9ce33144ed09b620b14afe56d">build_channels</a> (struct <a class="el" href="structdahdi__chan__conf.html">dahdi_chan_conf</a> *conf, int iscrv, const char *value, int reload, int lineno, int *found_pseudo)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a74f7e3c2c3944147a9ae2d1f6aceb71e">bump_gains</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *p)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a6fe88ac2d409718d8b1a788ad2930a24">calc_energy</a> (const unsigned char *<a class="el" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, int len, int law)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a7da85f2b0e343bc06fda0c9f675cb1e8">check_for_conference</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *p)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a59a7383df35eebc13f65625074a30353">conf_add</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *p, struct <a class="el" href="structdahdi__subchannel.html">dahdi_subchannel</a> *c, int idx, int slavechannel)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#aa44456edf36cac7dde2531aef042ec1c">conf_del</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *p, struct <a class="el" href="structdahdi__subchannel.html">dahdi_subchannel</a> *c, int idx)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a70ee00a2e6988aaca45ea87bcac2cc98">dahdi_answer</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *ast)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05">ast_bridge_result</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#aad73d49132bf3211857b52d664ecec33">dahdi_bridge</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c0, struct <a class="el" href="structast__channel.html">ast_channel</a> *c1, int flags, struct <a class="el" href="structast__frame.html">ast_frame</a> **fo, struct <a class="el" href="structast__channel.html">ast_channel</a> **rc, int timeoutms)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ab19867f6a8bde75e5c273e0f16e1e271">dahdi_call</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *ast, char *rdest, int timeout)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a5492a7d85ebc949f2277cd55fbc3febe">dahdi_callwait</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *ast)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structdahdi__chan__conf.html">dahdi_chan_conf</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#aa9cd3a63b87d28e1862e023bfd8a9cbb">dahdi_chan_conf_default</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ad726278395475a038d37c0c0bddbd82c">dahdi_close</a> (int fd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#aa677933b22aeb7b907176d84357464c0">dahdi_close_sub</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *chan_pvt, int sub_num)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a04126d689aca51a8a38499685cffe8f6">dahdi_confmute</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *p, int muted)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a2ec2516444763db4d7e46e5a246cafb8">dahdi_destroy_channel</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#aa8761113e1a59e2a550d60cd5a232f71">dahdi_destroy_channel_bynum</a> (int channel)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a352de2c30588a73da8caa5910f7acea8">dahdi_digit_begin</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *ast, char digit)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a4860117d2bdcbf32945465ff739706a2">dahdi_digit_end</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *ast, char digit, unsigned int duration)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a5ceb6fd5bd012740d50b04e84fb29be4">dahdi_disable_ec</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *p)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a4a0331eaa4997597bbca98a66c514bcd">dahdi_dnd</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *dahdichan, int on)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">enable or disable the chan_dahdi Do-Not-Disturb mode for a DAHDI channel  <a href="#a4a0331eaa4997597bbca98a66c514bcd"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a8c34a5bce2b26d056942349217806312">dahdi_enable_ec</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *p)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#aa186a55d5877c6ac26323e447e868f22">dahdi_exception</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *ast)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a5f1974e3b06695ea5cc87ff755bd2152">dahdi_fake_event</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *p, int mode)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a39307854d0a17fab92035d1c6d029765">dahdi_fixup</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *oldchan, struct <a class="el" href="structast__channel.html">ast_channel</a> *newchan)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#aa368dce4b7cc51c3481863fef872753b">dahdi_func_read</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *function, char *data, char *<a class="el" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, size_t len)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#aad4a9758fbc62380e70cbbcbb31311a4">dahdi_get_event</a> (int fd)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Avoid the silly dahdi_getevent which ignores a bunch of events.  <a href="#aad4a9758fbc62380e70cbbcbb31311a4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a62c8e3f411fb9e5ec62a1e77c152c2df">dahdi_get_index</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *ast, struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *p, int nullok)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#aa3d1e7c5ffebd0cd9fd147713ec71188">dahdi_handle_dtmfup</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *ast, int idx, struct <a class="el" href="structast__frame.html">ast_frame</a> **dest)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a0f158b05f591419e6624806afbd8cece">dahdi_handle_event</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *ast)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a62c33bf06afee20f754f2a4145eae9ef">dahdi_hangup</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *ast)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a13b021264eae31a56c08744c179bff2f">dahdi_indicate</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, int condition, const void *data, size_t datalen)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a8682ce9e42deed43c941fd7cae5ff30b">dahdi_link</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *slave, struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *<a class="el" href="cdr__custom_8c.html#ac4cd676396d9d62ba95a047806668d90">master</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ab3f00769ae6c995b4f5f3934d8c805f6">dahdi_new</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *, int, int, int, int, int)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a5be3d201f917ed02d9a08749cd673191">dahdi_open</a> (char *fn)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a32da5905fb64086d5a6fcf534aabd47b">dahdi_queue_frame</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *p, struct <a class="el" href="structast__frame.html">ast_frame</a> *<a class="el" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>, void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ac8523d205076076cdc3d81d94b1294a9">dahdi_read</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *ast)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#aa6d5dbe56b41e564aa2f11e536866c5b">dahdi_request</a> (const char *<a class="el" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>, int <a class="el" href="chan__alsa_8c.html#a98f5e70e98f6dc48e3c5ba316066d540">format</a>, void *data, int *<a class="el" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a738afcb4a2a9584043335b3279d1c1f7">dahdi_restart</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ae9c46c1629ae0a2d2260cdbcda36380d">dahdi_restart_cmd</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a22c775b992dee643a259e67efc1711d0">dahdi_ring_phone</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *p)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a642c508831fdb1f5351a747f4485866b">dahdi_sendtext</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c, const char *<a class="el" href="app__queue_8c.html#a5633b1433389cec21ade3811bbe9ca5b">text</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a910621ab1ae9c50093f6e0c1e0873e7e">dahdi_set_dnd</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a7c65e6943db828524ea6c9215b8bf696">dahdi_set_hook</a> (int fd, int hs)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a865b1afdb1075fa1b38f5758e06cb1ca">dahdi_set_hwgain</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a42d3da6ead0459ad04213cd1b95620cf">dahdi_set_swgain</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a8392b32cf7d3daa7b45154b7001460df">dahdi_setlinear</a> (int dfd, int linear)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a983e979fabe9ac6d4012524c7c2107d8">dahdi_setoption</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, int option, void *data, int datalen)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a3ff90e6d6cdc9917eb0e33227013acad">dahdi_show_channel</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#adc6baa1451369b3fc1515e91a55c31b0">dahdi_show_channels</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a2d75852a32e1c2a52935543a16fb056b">dahdi_show_status</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#abf63cde4493264f6ed7bd061985b234d">dahdi_show_version</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a79b74cfb99811f4c7f5b10daeaf4f9fa">dahdi_sig2str</a> (int sig)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a31724c8f07f8ccbb7817302855f1d837">dahdi_softhangup_all</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a31c006d7b409a09059a58946a706ea07">dahdi_train_ec</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *p)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a3e2349a75e5e78bd2168860df8746d49">dahdi_unlink</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *slave, struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *<a class="el" href="cdr__custom_8c.html#ac4cd676396d9d62ba95a047806668d90">master</a>, int needlock)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a497fdd00b631dd33acca24f8178cbd9d">dahdi_wait_event</a> (int fd)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Avoid the silly dahdi_waitevent which ignores a bunch of events.  <a href="#a497fdd00b631dd33acca24f8178cbd9d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a861b167aa5283df4f8153393acb50bbb">dahdi_wink</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *p, int idx)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a33b8ded71b995076d6146c2089157ea7">dahdi_write</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *ast, struct <a class="el" href="structast__frame.html">ast_frame</a> *frame)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#aff6140c85d9d958a2ff7abf6003a20d9">destroy_all_channels</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a707746b49a41e00df8477523111cb7f3">destroy_channel</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *prev, struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *cur, int now)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a9db88392ac10cee3a3116d1f7f4aae5f">destroy_dahdi_pvt</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> **pvt)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a8f89c806d859f8f9acec697afa7eca9a">digit_to_dtmfindex</a> (char digit)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#aeada40549c047d105e67ee036e638d85">disable_dtmf_detect</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *p)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a02d8db6086b4a18353b82ebcad631ff6">do_monitor</a> (void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#acbe36083a9c130b81506d874635f8ff9">duplicate_pseudo</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *src)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a0baab1d1f0651b64e22d0a095c2027a9">enable_dtmf_detect</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *p)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a92fb0724a6e93f69cec9d6e83cdcc3f3">event2str</a> (int event)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a186539eb5b78bd0849d09b4543ff47ef">fill_rxgain</a> (struct dahdi_gains *g, float gain, int law)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a6fac5af64b9b77c5d2c485bd3b70ea4d">fill_txgain</a> (struct dahdi_gains *g, float gain, int law)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a79906e057879b97581f8dbcede7ff036">find_channel</a> (int channel)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ace00362fe9640b8a792c965572a87826">get_alarms</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *p)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#aa8e0b028321154a280cad06d20099330">handle_alarms</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *p, int alms)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a67bb67148b7e75b16ad023bd133daac5">handle_dahdi_show_cadences</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#af0406c3cb1a1b5d39f8604376e52bc22">handle_init_event</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *i, int event)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a8be869dea1576c3f11795532605549dc">has_voicemail</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *p)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a08c5ea3a8b7ff7213a12de76994d4897">isourconf</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *p, struct <a class="el" href="structdahdi__subchannel.html">dahdi_subchannel</a> *c)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a1d078823a0af683aaa01d964f8a62039">isslavenative</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *p, struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> **out)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#aa7f4f5b8e2e3a682de5734874521d060">mkintf</a> (int channel, const struct <a class="el" href="structdahdi__chan__conf.html">dahdi_chan_conf</a> *conf, struct dahdi_pri *pri, int reloading)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a46e4523f99409c6696dc775ed6a5e5ed">mwi_event_cb</a> (const struct <a class="el" href="structast__event.html">ast_event</a> *event, void *userdata)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a5b4f0979ef9234fc9878dfa508ccf8ef">mwi_send_init</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *pvt)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ab7d3473f01f0d6142712aec7bb8ff323">mwi_send_process_buffer</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *pvt, int num_read)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ae8e5e4322c88dc92c793d37ad86a1fe1">mwi_send_process_event</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *pvt, int event)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a4c430057a548b7c6ec462ac238b58d6c">mwi_thread</a> (void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a124dc539e9fb2f5ac94d5be7db0b5f0b">my_dahdi_write</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *p, unsigned char *<a class="el" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, int len, int idx, int linear)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a9a611d7601630c4b1549fd303f6092a0">my_getsigstr</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, char *<a class="el" href="evt_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>, const char *term, int ms)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a3cd48b46cf8ee3ffc97d1f15fb53aaad">notify_message</a> (char *mailbox_full, int thereornot)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Send MWI <a class="el" href="structstate.html">state</a> change.  <a href="#a3cd48b46cf8ee3ffc97d1f15fb53aaad"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ad19a2de7bce089d3d6e11d7dfb487802">process_dahdi</a> (struct <a class="el" href="structdahdi__chan__conf.html">dahdi_chan_conf</a> *confp, const char *cat, struct <a class="el" href="structast__variable.html">ast_variable</a> *v, int reload, int options)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#aa1169f419df0c4b3f0b71deaf0506ec1">process_echocancel</a> (struct <a class="el" href="structdahdi__chan__conf.html">dahdi_chan_conf</a> *confp, const char *data, unsigned int line)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a1938310c1b6ab72fec5619a2ed69c92d">reset_conf</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *p)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a83af94bb19a421cb25ca02d16fa5ba9c">restart_monitor</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a128443b4d6aa50b91bcd4668d582095f">restore_conference</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *p)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a0ac913fed804e8326af276cfa450ed03">restore_gains</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *p)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a756c4e1d2909416c454b6e63d28f1db1">save_conference</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *p)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ae39659603ab09eecffce6638832c5b73">send_callerid</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *p)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#acf3dec3a37d62f9b0e7691747a5c37ee">send_cwcidspill</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *p)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a6abcbfc59e4d42646f31142d7dd2b830">set_actual_gain</a> (int fd, int <a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, float rxgain, float txgain, int law)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a199b65731d7c30946121938cc548b69c">set_actual_rxgain</a> (int fd, int <a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, float gain, int law)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a7327b1abb40a4d2dfcb05a13e132371f">set_actual_txgain</a> (int fd, int <a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, float gain, int law)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a90c93221b85857ca4af2b1097d267603">setup_dahdi</a> (int reload)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a898cf004da2556cf2cdd9119a6fcb7e8">sigtype_to_signalling</a> (int sigtype)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a0d1f78e604903f5ef4e42bf961f4df95">ss_thread</a> (void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#aaa6e6b7fe5725465004d3fabf351620e">swap_subs</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *p, int a, int b)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a164404a295fbba4f9d3c2c6cf123468f">unalloc_sub</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *p, int x)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ac56c05fde8bc30c71af46502e97fae3b">update_conf</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *p)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ae4d8c96f36d4b775d4806d13fdd8afd5">wakeup_sub</a> (struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *p, int a, struct dahdi_pri *pri)</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" >struct {</td></tr>
<tr><td class="memItemLeft" >&nbsp;&nbsp;&nbsp;int&nbsp;&nbsp;&nbsp;<a class="el" href="chan__dahdi_8c.html#a9e3b50e48c757ee5067da367f779839a">alarm</a></td></tr>
<tr><td class="memItemLeft" >&nbsp;&nbsp;&nbsp;char *&nbsp;&nbsp;&nbsp;<a class="el" href="chan__dahdi_8c.html#a5ac083a645d964373f022d03df4849c8">name</a></td></tr>
<tr><td class="memItemLeft" valign="top">}&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a018cba1c176ebc50102982fad2d404dc">alarms</a> []</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct dahdi_ring_cadence&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a7e5dcc799403137bdce59f53d7137385">AS_RP_cadence</a> = {{250, 10000}}</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct dahdi_ring_cadence&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ad07d646abd9d3f187412ff33dc665aee">cadences</a> [NUM_CADENCE_MAX]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a441c14817877dfc3ae49ff3aa2907400">cidrings</a> [NUM_CADENCE_MAX]</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">cidrings says in which pause to transmit the cid information, where the first pause is 1, the second pause is 2 and so on.  <a href="#a441c14817877dfc3ae49ff3aa2907400"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a9ee8d742a1fbcff45f97842b92952610">config</a> [] = &quot;chan_dahdi.conf&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ad34f2f8582cb6f9118dbd230b6636f2d">dahdi_cli</a> []</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__channel__tech.html">ast_channel_tech</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#abaaa1bdd4fa7ebb3e41873b18bda7170">dahdi_tech</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__jb__conf.html">ast_jb_conf</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a2d8d5920e90ccbad7832926becdadb29">default_jbconf</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a9ddac9567291bb4eb61b3989fae45780">defaultcic</a> [64] = &quot;&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ad7f989de9c9e4e717bf8991708c9814d">defaultozz</a> [64] = &quot;&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a57a2f035f40dcb6566153f7bd5db136e">distinctiveringaftercid</a> = 0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#aff2cd0cadc675280f2ee4b7c45bb9944">events</a> []</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#afd3be8e865f060b68db4d7c966489e0a">firstdigittimeout</a> = 16000</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Wait up to 16 seconds for first digit (FXO logic).  <a href="#afd3be8e865f060b68db4d7c966489e0a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#aa319ef1606201db158ce7195fb8eed45">gendigittimeout</a> = 8000</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">How long to wait for following digits (FXO logic).  <a href="#aa319ef1606201db158ce7195fb8eed45"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__jb__conf.html">ast_jb_conf</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#abaabcb7f4349cc632dde3af5c6a5e1bd">global_jbconf</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#af7b23639f050bf4be75e75d2a11cefc9">ifcount</a> = 0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#af06d42bbf0081c1eb058b893305b4e85">ifend</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a9dbc679cbf3418ca12b70a64acfbf03c">lbostr</a> []</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a24514343553b05c66e5b7d16e2df45cc">matchdigittimeout</a> = 3000</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">How long to wait for an extra digit, if there is an ambiguous match.  <a href="#a24514343553b05c66e5b7d16e2df45cc"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static pthread_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#afbd6fc6e0ab3c1a04a518f19c21d4503">monitor_thread</a> = AST_PTHREADT_NULL</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This is the thread for the monitor which checks for input on the <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> which are not currently in use.  <a href="#afbd6fc6e0ab3c1a04a518f19c21d4503"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a94ca20b7d80fbc4e7d2b1ea50e937243">mwilevel</a> = 512</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a200370774ee53e137af5d8d7932b7acc">mwimonitornotify</a> [PATH_MAX] = &quot;&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a3ae0342ed2b020e1e4cc4483e3fa55a6">mwisend_rpas</a> = 0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ad53fcc6c04d1c32732efa069a128136b">num_cadence</a> = 4</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a4e11ab7baf933c0b5151114a755704a5">num_restart_pending</a> = 0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a1c57b0f6ff35a4eed5cd50a0d0c313ba">numbufs</a> = 4</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ac59e01fcfbc9801f87f28f6b60957a24">parkinglot</a> [AST_MAX_EXTENSION] = &quot;&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ac3217a28bcd501a0e91a5337210750fb">progzone</a> [10] = &quot;&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#aadc5d8714afe5d456c8f17db3abf7f20">ringt_base</a> = DEFAULT_RINGT</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Configured ring timeout base.  <a href="#aadc5d8714afe5d456c8f17db3abf7f20"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#ad0a20124e90818c18842fd086b848e65">round_robin</a> [32]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="lock_8h.html#ab134d98cdfe7de0f7a72b377c0765dc7">ast_cond_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#aa0eccd1394a26a586074c22fe8d0ff43">ss_thread_complete</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#aec2d8d3ba7708b470105092c392b9b0a">ss_thread_count</a> = 0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a1f86ec72c5397a22d1b0e29e47635f04">subnames</a> []</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a71535bf985a1a06d548fd73a0a0ec32c">tdesc</a> [] = &quot;DAHDI Telephony Driver&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#adbb77dd3bae219ee6a026c9bfa5a5242">usedistinctiveringdetection</a> = 0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__dahdi_8c.html#a5143feca9ab414072f121c6b07619bdd">user_has_defined_cadences</a> = 0</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>DAHDI for Pseudo TDM. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Mark Spencer &lt;<a href="mailto:markster@digium.com">markster@digium.com</a>&gt;</dd></dl>
<p>Connects to the DAHDI telephony library as well as libpri. Libpri is optional and needed only if you are going to use ISDN connections.</p>
<p>You need to install libraries before you attempt to compile and install the DAHDI channel.</p>
<dl class="user"><dt><b>See also</b></dt><dd><ul>
<li><a class="el" href="Config_dahdi.html">DAHDI configuration</a></li>
</ul>
</dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000007">Todo:</a></b></dt><dd>Deprecate the "musiconhold" configuration option post 1.4 </dd></dl>

<p>Definition in file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="aaee0889ebef226ef3d5842fc7c3e5e7a"></a><!-- doxytag: member="chan_dahdi.c::ASCII_BYTES_PER_CHAR" ref="aaee0889ebef226ef3d5842fc7c3e5e7a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ASCII_BYTES_PER_CHAR&nbsp;&nbsp;&nbsp;80</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l17380">dahdi_sendtext()</a>.</p>

</div>
</div>
<a class="anchor" id="a830b5fdb3ba653640d3f5044192d82bf"></a><!-- doxytag: member="chan_dahdi.c::AST_LAW" ref="a830b5fdb3ba653640d3f5044192d82bf" args="(p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_LAW</td>
          <td>(</td>
          <td class="paramtype">p&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;(((p)-&gt;law == DAHDI_LAW_ALAW) ? AST_FORMAT_ALAW : AST_FORMAT_ULAW)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00209">209</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l03101">dahdi_call()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03059">dahdi_callwait()</a>, <a class="el" href="chan__dahdi_8c_source.html#l17380">dahdi_sendtext()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09496">do_monitor()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09063">mwi_send_init()</a>, <a class="el" href="chan__dahdi_8c_source.html#l08925">mwi_thread()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02986">send_cwcidspill()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="a88fcc93d4541c9adcab90b8b2ff37685"></a><!-- doxytag: member="chan_dahdi.c::CALLPROGRESS_FAX" ref="a88fcc93d4541c9adcab90b8b2ff37685" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CALLPROGRESS_FAX&nbsp;&nbsp;&nbsp;(CALLPROGRESS_FAX_INCOMING | CALLPROGRESS_FAX_OUTGOING)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00294">294</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l05607">dahdi_handle_dtmfup()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>.</p>

</div>
</div>
<a class="anchor" id="a0069de9c37a93a8941cef2ce562abf81"></a><!-- doxytag: member="chan_dahdi.c::CALLPROGRESS_FAX_INCOMING" ref="a0069de9c37a93a8941cef2ce562abf81" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CALLPROGRESS_FAX_INCOMING&nbsp;&nbsp;&nbsp;4</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00293">293</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l07417">dahdi_new()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>.</p>

</div>
</div>
<a class="anchor" id="a2957dd1e62c977f55ccb4eeb99d87052"></a><!-- doxytag: member="chan_dahdi.c::CALLPROGRESS_FAX_OUTGOING" ref="a2957dd1e62c977f55ccb4eeb99d87052" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CALLPROGRESS_FAX_OUTGOING&nbsp;&nbsp;&nbsp;2</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00292">292</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l07417">dahdi_new()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>.</p>

</div>
</div>
<a class="anchor" id="aa66794917b368980eacd1bf179268e15"></a><!-- doxytag: member="chan_dahdi.c::CALLPROGRESS_PROGRESS" ref="aa66794917b368980eacd1bf179268e15" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CALLPROGRESS_PROGRESS&nbsp;&nbsp;&nbsp;1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00291">291</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07417">dahdi_new()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>.</p>

</div>
</div>
<a class="anchor" id="a2422d71182014158dd163f020a8d4cc7"></a><!-- doxytag: member="chan_dahdi.c::CALLWAITING_REPEAT_SAMPLES" ref="a2422d71182014158dd163f020a8d4cc7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CALLWAITING_REPEAT_SAMPLES&nbsp;&nbsp;&nbsp;( (10000 * 8) / READ_SIZE)</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>10,000 ms </p>

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00403">403</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l03059">dahdi_callwait()</a>.</p>

</div>
</div>
<a class="anchor" id="ae4c55b088658cc3983b18e093ae0a01a"></a><!-- doxytag: member="chan_dahdi.c::CALLWAITING_SILENT_SAMPLES" ref="ae4c55b088658cc3983b18e093ae0a01a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CALLWAITING_SILENT_SAMPLES&nbsp;&nbsp;&nbsp;( (300 * 8) / READ_SIZE)</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>300 ms </p>

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00402">402</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="afc63e8eef602e5dd95f7363062550e0f"></a><!-- doxytag: member="chan_dahdi.c::CANBUSYDETECT" ref="afc63e8eef602e5dd95f7363062550e0f" args="(p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CANBUSYDETECT</td>
          <td>(</td>
          <td class="paramtype">p&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;(ISTRUNK(p) || (p-&gt;sig &amp; (SIG_EM | SIG_EM_E1 | SIG_SF)) /* || (p-&gt;sig &amp; __DAHDI_SIG_FXO) */)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l01500">1500</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l07417">dahdi_new()</a>.</p>

</div>
</div>
<a class="anchor" id="aa40ff55dfcec4b66be7bbaec05993fad"></a><!-- doxytag: member="chan_dahdi.c::CANPROGRESSDETECT" ref="aa40ff55dfcec4b66be7bbaec05993fad" args="(p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CANPROGRESSDETECT</td>
          <td>(</td>
          <td class="paramtype">p&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;(ISTRUNK(p) || (p-&gt;sig &amp; (SIG_EM | SIG_EM_E1 | SIG_SF)) /* || (p-&gt;sig &amp; __DAHDI_SIG_FXO) */)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l01501">1501</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l03101">dahdi_call()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07417">dahdi_new()</a>.</p>

</div>
</div>
<a class="anchor" id="ada02a3fa3d2da06560df664c7228a559"></a><!-- doxytag: member="chan_dahdi.c::CHAN_PSEUDO" ref="ada02a3fa3d2da06560df664c7228a559" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CHAN_PSEUDO&nbsp;&nbsp;&nbsp;-2</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00277">277</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l15948">build_channels()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07417">dahdi_new()</a>, <a class="el" href="chan__dahdi_8c_source.html#l10834">dahdi_request()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05138">enable_dtmf_detect()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>.</p>

</div>
</div>
<a class="anchor" id="aa5330d927fb8cad0df499df686543eeb"></a><!-- doxytag: member="chan_dahdi.c::CHANNEL_PSEUDO" ref="aa5330d927fb8cad0df499df686543eeb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CHANNEL_PSEUDO&nbsp;&nbsp;&nbsp;-12</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00207">207</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="a1117129c7428d435d09423775904f91a"></a><!-- doxytag: member="chan_dahdi.c::CIDCW_EXPIRE_SAMPLES" ref="a1117129c7428d435d09423775904f91a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CIDCW_EXPIRE_SAMPLES&nbsp;&nbsp;&nbsp;( (500 * 8) / READ_SIZE)</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>500 ms </p>

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00404">404</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l03026">send_callerid()</a>.</p>

</div>
</div>
<a class="anchor" id="a35448edd80150ba52bebf13fe7bfdcab"></a><!-- doxytag: member="chan_dahdi.c::CONF_USER_REAL" ref="a35448edd80150ba52bebf13fe7bfdcab" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CONF_USER_REAL&nbsp;&nbsp;&nbsp;(1 &lt;&lt; 0)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00625">625</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="a04995f0702692dc37ba72b16dac473e4"></a><!-- doxytag: member="chan_dahdi.c::CONF_USER_THIRDCALL" ref="a04995f0702692dc37ba72b16dac473e4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CONF_USER_THIRDCALL&nbsp;&nbsp;&nbsp;(1 &lt;&lt; 1)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00626">626</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="aa65ac97c8c851bb8c7e1b80c523670f2"></a><!-- doxytag: member="chan_dahdi.c::DAHDI_CHAN_MAPPING_LOGICAL" ref="aa65ac97c8c851bb8c7e1b80c523670f2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DAHDI_CHAN_MAPPING_LOGICAL&nbsp;&nbsp;&nbsp;1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00339">339</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>.</p>

</div>
</div>
<a class="anchor" id="af23a6a3582578bef25f1062d0dea1fc9"></a><!-- doxytag: member="chan_dahdi.c::DAHDI_CHAN_MAPPING_PHYSICAL" ref="af23a6a3582578bef25f1062d0dea1fc9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DAHDI_CHAN_MAPPING_PHYSICAL&nbsp;&nbsp;&nbsp;0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00338">338</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l01266">dahdi_chan_conf_default()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>.</p>

</div>
</div>
<a class="anchor" id="a6633b1ced0d29c25cfba81c2349db046"></a><!-- doxytag: member="chan_dahdi.c::DAHDI_OVERLAPDIAL_BOTH" ref="a6633b1ced0d29c25cfba81c2349db046" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DAHDI_OVERLAPDIAL_BOTH&nbsp;&nbsp;&nbsp;(DAHDI_OVERLAPDIAL_INCOMING|DAHDI_OVERLAPDIAL_OUTGOING)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00289">289</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>.</p>

</div>
</div>
<a class="anchor" id="ab30dead77fa070cbe51316f43fcea8a2"></a><!-- doxytag: member="chan_dahdi.c::DAHDI_OVERLAPDIAL_INCOMING" ref="ab30dead77fa070cbe51316f43fcea8a2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DAHDI_OVERLAPDIAL_INCOMING&nbsp;&nbsp;&nbsp;2</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00288">288</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l06717">dahdi_read()</a>, <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="a90cfffbd61222b99c247c74dd67a361a"></a><!-- doxytag: member="chan_dahdi.c::DAHDI_OVERLAPDIAL_NONE" ref="a90cfffbd61222b99c247c74dd67a361a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DAHDI_OVERLAPDIAL_NONE&nbsp;&nbsp;&nbsp;0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00286">286</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>.</p>

</div>
</div>
<a class="anchor" id="a4bccf90ead0cf7c93b177e59cbe5b3be"></a><!-- doxytag: member="chan_dahdi.c::DAHDI_OVERLAPDIAL_OUTGOING" ref="a4bccf90ead0cf7c93b177e59cbe5b3be" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DAHDI_OVERLAPDIAL_OUTGOING&nbsp;&nbsp;&nbsp;1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00287">287</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l06717">dahdi_read()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>.</p>

</div>
</div>
<a class="anchor" id="a23d4bddf4728371d9249323553f1fda1"></a><!-- doxytag: member="chan_dahdi.c::DCHAN_AVAILABLE" ref="a23d4bddf4728371d9249323553f1fda1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DCHAN_AVAILABLE&nbsp;&nbsp;&nbsp;(DCHAN_PROVISIONED | DCHAN_NOTINALARM | DCHAN_UP)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00283">283</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="a4dc8a50049ed9587a0422a70565f1168"></a><!-- doxytag: member="chan_dahdi.c::DCHAN_NOTINALARM" ref="a4dc8a50049ed9587a0422a70565f1168" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DCHAN_NOTINALARM&nbsp;&nbsp;&nbsp;(1 &lt;&lt; 1)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00280">280</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="ac8c27b72601b33385997100007b9a2e6"></a><!-- doxytag: member="chan_dahdi.c::DCHAN_PROVISIONED" ref="ac8c27b72601b33385997100007b9a2e6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DCHAN_PROVISIONED&nbsp;&nbsp;&nbsp;(1 &lt;&lt; 0)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00279">279</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="a65b702e73ac512c6b46ac4d2cba85a74"></a><!-- doxytag: member="chan_dahdi.c::DCHAN_UP" ref="a65b702e73ac512c6b46ac4d2cba85a74" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DCHAN_UP&nbsp;&nbsp;&nbsp;(1 &lt;&lt; 2)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00281">281</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad39eeeb16f274560c29b960b2096d6d7"></a><!-- doxytag: member="chan_dahdi.c::DEFAULT_CIDRINGS" ref="ad39eeeb16f274560c29b960b2096d6d7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEFAULT_CIDRINGS&nbsp;&nbsp;&nbsp;1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Typically, how many rings before we should send Caller*ID. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>Define ZHONE_HACK to cause us to go off hook and then back on hook when the <a class="el" href="structuser.html" title="structure to hold users read from users.conf">user</a> hangs up to reset the <a class="el" href="structstate.html">state</a> machine so ring works properly. This is used to be able to support kewlstart by putting the zhone in groundstart mode since their forward disconnect supervision is entirely broken even though their documentation says it isn't and their support is entirely unwilling to provide any assistance with their channel banks even though their web site says they support their products for life.</dd>
<dd>
Define if you want to check the hook <a class="el" href="structstate.html">state</a> for an FXO (FXS signalled) interface before dialing on it. Certain FXO interfaces always think they're out of service with this method however. </dd></dl>

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00205">205</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l01266">dahdi_chan_conf_default()</a>.</p>

</div>
</div>
<a class="anchor" id="a28a1be995810b1a2ee849db935f7c51f"></a><!-- doxytag: member="chan_dahdi.c::DEFAULT_RINGT" ref="a28a1be995810b1a2ee849db935f7c51f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEFAULT_RINGT&nbsp;&nbsp;&nbsp;( (8000 * 8) / READ_SIZE)</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>8,000 ms </p>

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00406">406</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="a5b4bd94085f8d9db39f0096a52f795b3"></a><!-- doxytag: member="chan_dahdi.c::END_SILENCE_LEN" ref="a5b4bd94085f8d9db39f0096a52f795b3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define END_SILENCE_LEN&nbsp;&nbsp;&nbsp;400</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l17380">dahdi_sendtext()</a>.</p>

</div>
</div>
<a class="anchor" id="ac8dc47e3b39c930caed4bfd05b4ba805"></a><!-- doxytag: member="chan_dahdi.c::FORMAT" ref="ac8dc47e3b39c930caed4bfd05b4ba805" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FORMAT&nbsp;&nbsp;&nbsp;&quot;%-40.40s %-7.7s %-6d %-6d %-6d %-3.3s %-4.4s %-8.8s %s\n&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ac8dc47e3b39c930caed4bfd05b4ba805"></a><!-- doxytag: member="chan_dahdi.c::FORMAT" ref="ac8dc47e3b39c930caed4bfd05b4ba805" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FORMAT&nbsp;&nbsp;&nbsp;&quot;%7s %-10.10s %-15.15s %-10.10s %-20.20s %-10.10s %-10.10s\n&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="chan__iax2_8c_source.html#l06324">__iax2_show_peers()</a>, <a class="el" href="chan__sip_8c_source.html#l14666">_sip_show_peers()</a>, <a class="el" href="res__clialiases_8c_source.html#l00137">alias_show()</a>, <a class="el" href="chan__dahdi_8c_source.html#l14485">dahdi_show_channels()</a>, <a class="el" href="chan__dahdi_8c_source.html#l14854">dahdi_show_status()</a>, <a class="el" href="pbx__dundi_8c_source.html#l02814">dundi_show_mappings()</a>, <a class="el" href="pbx__dundi_8c_source.html#l02636">dundi_show_peers()</a>, <a class="el" href="pbx__dundi_8c_source.html#l02847">dundi_show_precache()</a>, <a class="el" href="pbx__dundi_8c_source.html#l02782">dundi_show_requests()</a>, <a class="el" href="pbx__dundi_8c_source.html#l02731">dundi_show_trans()</a>, <a class="el" href="chan__gtalk_8c_source.html#l01683">gtalk_show_channels()</a>, <a class="el" href="channel_8c_source.html#l00203">handle_cli_core_show_channeltypes()</a>, <a class="el" href="file_8c_source.html#l01430">handle_cli_core_show_file_formats()</a>, <a class="el" href="chan__iax2_8c_source.html#l06825">handle_cli_iax2_show_channels()</a>, <a class="el" href="chan__iax2_8c_source.html#l06735">handle_cli_iax2_show_registry()</a>, <a class="el" href="chan__iax2_8c_source.html#l06250">handle_cli_iax2_show_users()</a>, <a class="el" href="res__crypto_8c_source.html#l00498">handle_cli_keys_show()</a>, <a class="el" href="image_8c_source.html#l00169">handle_core_show_image_formats()</a>, <a class="el" href="res__phoneprov_8c_source.html#l01193">handle_show_routes()</a>, <a class="el" href="asterisk_8c_source.html#l00831">handle_show_version_files()</a>, <a class="el" href="chan__jingle_8c_source.html#l01513">jingle_show_channels()</a>, <a class="el" href="chan__sip_8c_source.html#l16189">show_channels_cb()</a>, <a class="el" href="chan__sip_8c_source.html#l15831">show_chanstats_cb()</a>, <a class="el" href="chan__sip_8c_source.html#l15186">sip_show_domains()</a>, <a class="el" href="chan__sip_8c_source.html#l14279">sip_show_inuse()</a>, <a class="el" href="chan__sip_8c_source.html#l16120">sip_show_mwi()</a>, <a class="el" href="chan__sip_8c_source.html#l15748">sip_show_registry()</a>, <a class="el" href="chan__sip_8c_source.html#l14450">sip_show_tcp()</a>, and <a class="el" href="chan__sip_8c_source.html#l14488">sip_show_users()</a>.</p>

</div>
</div>
<a class="anchor" id="acfd58ce0ec836919236d7a1908494970"></a><!-- doxytag: member="chan_dahdi.c::FORMAT2" ref="acfd58ce0ec836919236d7a1908494970" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FORMAT2&nbsp;&nbsp;&nbsp;&quot;%-40.40s %-7.7s %-6.6s %-6.6s %-6.6s %-3.3s %-4.4s %-8.8s %s\n&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="acfd58ce0ec836919236d7a1908494970"></a><!-- doxytag: member="chan_dahdi.c::FORMAT2" ref="acfd58ce0ec836919236d7a1908494970" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FORMAT2&nbsp;&nbsp;&nbsp;&quot;%7s %-10.10s %-15.15s %-10.10s %-20.20s %-10.10s %-10.10s\n&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="chan__iax2_8c_source.html#l06324">__iax2_show_peers()</a>, <a class="el" href="chan__sip_8c_source.html#l14666">_sip_show_peers()</a>, <a class="el" href="chan__dahdi_8c_source.html#l14485">dahdi_show_channels()</a>, <a class="el" href="chan__dahdi_8c_source.html#l14854">dahdi_show_status()</a>, <a class="el" href="pbx__dundi_8c_source.html#l02814">dundi_show_mappings()</a>, <a class="el" href="pbx__dundi_8c_source.html#l02636">dundi_show_peers()</a>, <a class="el" href="pbx__dundi_8c_source.html#l02847">dundi_show_precache()</a>, <a class="el" href="pbx__dundi_8c_source.html#l02782">dundi_show_requests()</a>, <a class="el" href="pbx__dundi_8c_source.html#l02731">dundi_show_trans()</a>, <a class="el" href="file_8c_source.html#l01430">handle_cli_core_show_file_formats()</a>, <a class="el" href="chan__iax2_8c_source.html#l06825">handle_cli_iax2_show_channels()</a>, <a class="el" href="chan__iax2_8c_source.html#l06735">handle_cli_iax2_show_registry()</a>, <a class="el" href="chan__iax2_8c_source.html#l06250">handle_cli_iax2_show_users()</a>, <a class="el" href="image_8c_source.html#l00169">handle_core_show_image_formats()</a>, <a class="el" href="chan__sip_8c_source.html#l16236">sip_show_channels()</a>, <a class="el" href="chan__sip_8c_source.html#l15890">sip_show_channelstats()</a>, <a class="el" href="chan__sip_8c_source.html#l14279">sip_show_inuse()</a>, <a class="el" href="chan__sip_8c_source.html#l15748">sip_show_registry()</a>, and <a class="el" href="chan__sip_8c_source.html#l14450">sip_show_tcp()</a>.</p>

</div>
</div>
<a class="anchor" id="a93559b640fd4e3fad51f56745e05d2cf"></a><!-- doxytag: member="chan_dahdi.c::GET_CHANNEL" ref="a93559b640fd4e3fad51f56745e05d2cf" args="(p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define GET_CHANNEL</td>
          <td>(</td>
          <td class="paramtype">p&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;((p)-&gt;channel)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l01425">1425</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l02604">update_conf()</a>.</p>

</div>
</div>
<a class="anchor" id="a096c3727950fc9aa70ca1b817dba1cf7"></a><!-- doxytag: member="chan_dahdi.c::HANGUP" ref="a096c3727950fc9aa70ca1b817dba1cf7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HANGUP&nbsp;&nbsp;&nbsp;1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l15183">15183</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l15270">action_transferhangup()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l15185">dahdi_fake_event()</a>.</p>

</div>
</div>
<a class="anchor" id="ab8f5e10b9f780e53f9583724ac965a0c"></a><!-- doxytag: member="chan_dahdi.c::HEADER_LEN" ref="ab8f5e10b9f780e53f9583724ac965a0c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HEADER_LEN&nbsp;&nbsp;&nbsp;((HEADER_MS + TRAILER_MS) * 8)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="isdn__msg__parser_8c_source.html#l00113">build_alerting()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l00387">build_connect()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l00463">build_connect_acknowledge()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l00796">build_disconnect()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l00983">build_facility()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l00557">build_hold()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l00626">build_hold_acknowledge()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l00695">build_hold_reject()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l01079">build_information()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l01026">build_notify()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l00078">build_proceeding()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l00145">build_progress()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l00877">build_release()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l00934">build_release_complete()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l00838">build_restart()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l00603">build_resume()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l00672">build_resume_acknowledge()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l00534">build_resume_reject()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l00718">build_retrieve()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l00741">build_retrieve_acknowledge()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l00765">build_retrieve_reject()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l00275">build_setup()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l00435">build_setup_acknowledge()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l01120">build_status()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l01047">build_status_enquiry()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l00580">build_suspend()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l00649">build_suspend_acknowledge()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l00511">build_suspend_reject()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l01141">build_timeout()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l00488">build_user_information()</a>, <a class="el" href="chan__dahdi_8c_source.html#l17380">dahdi_sendtext()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l00098">parse_alerting()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l00364">parse_connect()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l00779">parse_disconnect()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l00956">parse_facility()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l01061">parse_information()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l00057">parse_proceeding()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l00132">parse_progress()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l00861">parse_release()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l00900">parse_release_complete()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l00819">parse_restart()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l00159">parse_setup()</a>, <a class="el" href="isdn__msg__parser_8c_source.html#l00414">parse_setup_acknowledge()</a>, and <a class="el" href="isdn__msg__parser_8c_source.html#l01104">parse_status()</a>.</p>

</div>
</div>
<a class="anchor" id="a372dce8627cc49448555f8372f743de9"></a><!-- doxytag: member="chan_dahdi.c::HEADER_MS" ref="a372dce8627cc49448555f8372f743de9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HEADER_MS&nbsp;&nbsp;&nbsp;50</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l17380">dahdi_sendtext()</a>.</p>

</div>
</div>
<a class="anchor" id="aaba53263d23f0d5fc75b177b9adfc851"></a><!-- doxytag: member="chan_dahdi.c::ISTRUNK" ref="aaba53263d23f0d5fc75b177b9adfc851" args="(p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ISTRUNK</td>
          <td>(</td>
          <td class="paramtype">p&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment">((p-&gt;sig == <a class="code" href="chan__dahdi_8c.html#a1dc50a07aef86c90ab94f1583c35a265">SIG_FXSLS</a>) || (p-&gt;sig == <a class="code" href="chan__dahdi_8c.html#a38139ec369c0243f4324eb4eb0c2f004">SIG_FXSKS</a>) || \
         (p-&gt;sig == <a class="code" href="chan__dahdi_8c.html#a97e4c6fb4680984aafc6e0e55a2b6cb4">SIG_FXSGS</a>) || (p-&gt;sig == <a class="code" href="chan__dahdi_8c.html#ae9ab0c9508fca045a06730533be276a5">SIG_PRI</a>))
</pre></div>
<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l01497">1497</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l07170">dahdi_indicate()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="a65f5bd9f1932cdfe24b21443e4ddb576"></a><!-- doxytag: member="chan_dahdi.c::MASK_AVAIL" ref="a65f5bd9f1932cdfe24b21443e4ddb576" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MASK_AVAIL&nbsp;&nbsp;&nbsp;(1 &lt;&lt; 0)</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Channel available for PRI use </p>

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00399">399</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="a4db09170290b8520f18e72e8559345fe"></a><!-- doxytag: member="chan_dahdi.c::MASK_INUSE" ref="a4db09170290b8520f18e72e8559345fe" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MASK_INUSE&nbsp;&nbsp;&nbsp;(1 &lt;&lt; 1)</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Channel currently in use </p>

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00400">400</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="a29baa04e5997d3badd14e3291b69196b"></a><!-- doxytag: member="chan_dahdi.c::MAX_CHANLIST_LEN" ref="a29baa04e5997d3badd14e3291b69196b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_CHANLIST_LEN&nbsp;&nbsp;&nbsp;80</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The length of the parameters list of 'dahdichan'. </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000009">Todo:</a></b></dt><dd>Move definition of MAX_CHANLIST_LEN to a proper place. </dd></dl>

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l16038">16038</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>.</p>

</div>
</div>
<a class="anchor" id="ac69ee46f4a51ed14f0d68628c2dec71d"></a><!-- doxytag: member="chan_dahdi.c::MAX_CHANNELS" ref="ac69ee46f4a51ed14f0d68628c2dec71d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_CHANNELS&nbsp;&nbsp;&nbsp;672</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>No more than a DS3 per trunk <a class="el" href="structgroup.html">group</a> </p>

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00275">275</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>.</p>

</div>
</div>
<a class="anchor" id="a2a3c5190bdbe2a4780a460383970aa92"></a><!-- doxytag: member="chan_dahdi.c::MAX_SLAVES" ref="a2a3c5190bdbe2a4780a460383970aa92" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_SLAVES&nbsp;&nbsp;&nbsp;4</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00628">628</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l05100">dahdi_link()</a>, <a class="el" href="chan__dahdi_8c_source.html#l14609">dahdi_show_channel()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05044">dahdi_unlink()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02546">isslavenative()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l02604">update_conf()</a>.</p>

</div>
</div>
<a class="anchor" id="ac148eea53bd254d0c5b5757dd46d7058"></a><!-- doxytag: member="chan_dahdi.c::MIN_MS_SINCE_FLASH" ref="ac148eea53bd254d0c5b5757dd46d7058" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MIN_MS_SINCE_FLASH&nbsp;&nbsp;&nbsp;( (2000) )</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>2000 ms </p>

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00405">405</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>.</p>

</div>
</div>
<a class="anchor" id="a97fec6c0baa06f18539a7c8165314210"></a><!-- doxytag: member="chan_dahdi.c::NEED_MFDETECT" ref="a97fec6c0baa06f18539a7c8165314210" args="(p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NEED_MFDETECT</td>
          <td>(</td>
          <td class="paramtype">p&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;(((p)-&gt;sig == SIG_FEATDMF) || ((p)-&gt;sig == SIG_FEATDMF_TA) || ((p)-&gt;sig == SIG_E911) || ((p)-&gt;sig == SIG_FGC_CAMA) || ((p)-&gt;sig == SIG_FGC_CAMAMF) || ((p)-&gt;sig == SIG_FEATB))</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Signaling types that need to use MF detection should be placed in this macro. </p>

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00213">213</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l07417">dahdi_new()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="afa0bff4fd3f279871e101c0158c5a81a"></a><!-- doxytag: member="chan_dahdi.c::NUM_CADENCE_MAX" ref="afa0bff4fd3f279871e101c0158c5a81a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NUM_CADENCE_MAX&nbsp;&nbsp;&nbsp;25</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l01472">1472</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>.</p>

</div>
</div>
<a class="anchor" id="aaad94eef7bd74293b956f6de74a62d0f"></a><!-- doxytag: member="chan_dahdi.c::NUM_DCHANS" ref="aaad94eef7bd74293b956f6de74a62d0f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NUM_DCHANS&nbsp;&nbsp;&nbsp;4</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>No more than 4 d-channels </p>

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00274">274</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="a80bfdd8adbffe226265cd729655a7268"></a><!-- doxytag: member="chan_dahdi.c::NUM_SPANS" ref="a80bfdd8adbffe226265cd729655a7268" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NUM_SPANS&nbsp;&nbsp;&nbsp;32</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00272">272</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad35015bf9d15c7474a4fef58ed0dcab2"></a><!-- doxytag: member="chan_dahdi.c::POLARITY_IDLE" ref="ad35015bf9d15c7474a4fef58ed0dcab2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define POLARITY_IDLE&nbsp;&nbsp;&nbsp;0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00584">584</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04313">dahdi_hangup()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l02212">unalloc_sub()</a>.</p>

</div>
</div>
<a class="anchor" id="aeba680adad3f0d1146c8e5003f6a44f2"></a><!-- doxytag: member="chan_dahdi.c::POLARITY_REV" ref="aeba680adad3f0d1146c8e5003f6a44f2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define POLARITY_REV&nbsp;&nbsp;&nbsp;1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00585">585</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="a6743ea33516885eca81012e31dfb7d09"></a><!-- doxytag: member="chan_dahdi.c::PROC_DAHDI_OPT_NOCHAN" ref="a6743ea33516885eca81012e31dfb7d09" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PROC_DAHDI_OPT_NOCHAN&nbsp;&nbsp;&nbsp;(1 &lt;&lt; 0)</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="chan__dahdi_8c.html#ad19a2de7bce089d3d6e11d7dfb487802">process_dahdi()</a> - ignore keyword 'channel' and similar </p>

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l16092">16092</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l17079">setup_dahdi()</a>.</p>

</div>
</div>
<a class="anchor" id="ac0fd63b3569161611cb73dcd4af16570"></a><!-- doxytag: member="chan_dahdi.c::PROC_DAHDI_OPT_NOWARN" ref="ac0fd63b3569161611cb73dcd4af16570" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PROC_DAHDI_OPT_NOWARN&nbsp;&nbsp;&nbsp;(1 &lt;&lt; 1)</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p><a class="el" href="chan__dahdi_8c.html#ad19a2de7bce089d3d6e11d7dfb487802">process_dahdi()</a> - No warnings on non-existing cofiguration keywords </p>

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l16094">16094</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l17079">setup_dahdi()</a>.</p>

</div>
</div>
<a class="anchor" id="a86e1969b50e55e5d506233078ca0fa4c"></a><!-- doxytag: member="chan_dahdi.c::READ_SIZE" ref="a86e1969b50e55e5d506233078ca0fa4c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define READ_SIZE&nbsp;&nbsp;&nbsp;160</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Chunk size to read -- we use 20ms chunks to make things happy. </p>

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00397">397</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l03059">dahdi_callwait()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02090">dahdi_open()</a>, <a class="el" href="chan__dahdi_8c_source.html#l06717">dahdi_read()</a>, <a class="el" href="chan__dahdi_8c_source.html#l17380">dahdi_sendtext()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04837">dahdi_setoption()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07068">my_dahdi_write()</a>, <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l02986">send_cwcidspill()</a>.</p>

</div>
</div>
<a class="anchor" id="ac36e4cc782493e37064405666f5e4fdd"></a><!-- doxytag: member="chan_dahdi.c::sig2str" ref="ac36e4cc782493e37064405666f5e4fdd" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define sig2str&nbsp;&nbsp;&nbsp;dahdi_sig2str</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l02476">2476</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l15321">action_dahdishowchannels()</a>, <a class="el" href="chan__dahdi_8c_source.html#l15948">build_channels()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l14609">dahdi_show_channel()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="ab5bfeaf991c23c5b6510ace44ae79ce9"></a><!-- doxytag: member="chan_dahdi.c::SIG_BRI" ref="ab5bfeaf991c23c5b6510ace44ae79ce9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SIG_BRI&nbsp;&nbsp;&nbsp;(0x2000000 | DAHDI_SIG_CLEAR)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00256">256</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l04718">dahdi_answer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03101">dahdi_call()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02880">dahdi_confmute()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02245">dahdi_digit_begin()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02307">dahdi_digit_end()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02660">dahdi_enable_ec()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04313">dahdi_hangup()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07170">dahdi_indicate()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07417">dahdi_new()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01544">dahdi_queue_frame()</a>, <a class="el" href="chan__dahdi_8c_source.html#l06717">dahdi_read()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02408">dahdi_sig2str()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>, <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="abcfd568d75fdb269f9c69cc5c6d980cd"></a><!-- doxytag: member="chan_dahdi.c::SIG_BRI_PTMP" ref="abcfd568d75fdb269f9c69cc5c6d980cd" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SIG_BRI_PTMP&nbsp;&nbsp;&nbsp;(0X4000000 | DAHDI_SIG_CLEAR)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00257">257</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l04718">dahdi_answer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03101">dahdi_call()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02880">dahdi_confmute()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02245">dahdi_digit_begin()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02307">dahdi_digit_end()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02660">dahdi_enable_ec()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04313">dahdi_hangup()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07170">dahdi_indicate()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07417">dahdi_new()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01544">dahdi_queue_frame()</a>, <a class="el" href="chan__dahdi_8c_source.html#l06717">dahdi_read()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02408">dahdi_sig2str()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>, <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="adfdd0e4d05281d354c15ef1a5d158cd6"></a><!-- doxytag: member="chan_dahdi.c::SIG_E911" ref="adfdd0e4d05281d354c15ef1a5d158cd6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SIG_E911&nbsp;&nbsp;&nbsp;(0x1000000 | DAHDI_SIG_EM)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00245">245</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l04718">dahdi_answer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03101">dahdi_call()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02408">dahdi_sig2str()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>, <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="afa7547cd2cee1bae7734206102635216"></a><!-- doxytag: member="chan_dahdi.c::SIG_EM" ref="afa7547cd2cee1bae7734206102635216" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SIG_EM&nbsp;&nbsp;&nbsp;DAHDI_SIG_EM</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00240">240</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l04718">dahdi_answer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03101">dahdi_call()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02408">dahdi_sig2str()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>, <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="aa7b59772722b794c5218768dac3ee419"></a><!-- doxytag: member="chan_dahdi.c::SIG_EM_E1" ref="aa7b59772722b794c5218768dac3ee419" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SIG_EM_E1&nbsp;&nbsp;&nbsp;DAHDI_SIG_EM_E1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00265">265</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l04718">dahdi_answer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03101">dahdi_call()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02408">dahdi_sig2str()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>, <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="a1ba988b93fce049075b7c2ef6c931cf9"></a><!-- doxytag: member="chan_dahdi.c::SIG_EMWINK" ref="a1ba988b93fce049075b7c2ef6c931cf9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SIG_EMWINK&nbsp;&nbsp;&nbsp;(0x0100000 | DAHDI_SIG_EM)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00241">241</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l04718">dahdi_answer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03101">dahdi_call()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02408">dahdi_sig2str()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>, <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="a0ba8ec199f5fb4f2be64144be0bd13b1"></a><!-- doxytag: member="chan_dahdi.c::SIG_FEATB" ref="a0ba8ec199f5fb4f2be64144be0bd13b1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SIG_FEATB&nbsp;&nbsp;&nbsp;(0x0800000 | DAHDI_SIG_EM)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00244">244</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l04718">dahdi_answer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03101">dahdi_call()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02408">dahdi_sig2str()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>, <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="ab79873391af2857a602e1eff68606f23"></a><!-- doxytag: member="chan_dahdi.c::SIG_FEATD" ref="ab79873391af2857a602e1eff68606f23" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SIG_FEATD&nbsp;&nbsp;&nbsp;(0x0200000 | DAHDI_SIG_EM)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00242">242</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l04718">dahdi_answer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03101">dahdi_call()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02408">dahdi_sig2str()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>, <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="a98d4710afc1fcb2ff110eabb4fbcc308"></a><!-- doxytag: member="chan_dahdi.c::SIG_FEATDMF" ref="a98d4710afc1fcb2ff110eabb4fbcc308" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SIG_FEATDMF&nbsp;&nbsp;&nbsp;(0x0400000 | DAHDI_SIG_EM)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00243">243</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l04718">dahdi_answer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03101">dahdi_call()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02408">dahdi_sig2str()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>, <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="ac0c40f74945ed15aa82cd9fedc304e55"></a><!-- doxytag: member="chan_dahdi.c::SIG_FEATDMF_TA" ref="ac0c40f74945ed15aa82cd9fedc304e55" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SIG_FEATDMF_TA&nbsp;&nbsp;&nbsp;(0x2000000 | DAHDI_SIG_EM)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00246">246</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l04718">dahdi_answer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03101">dahdi_call()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02408">dahdi_sig2str()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>, <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="a167056b2763a4897838c7115efc1f9fc"></a><!-- doxytag: member="chan_dahdi.c::SIG_FGC_CAMA" ref="a167056b2763a4897838c7115efc1f9fc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SIG_FGC_CAMA&nbsp;&nbsp;&nbsp;(0x4000000 | DAHDI_SIG_EM)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00247">247</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l04718">dahdi_answer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03101">dahdi_call()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02408">dahdi_sig2str()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>, <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="a945e2b5f225d3abdc57b5dcc53daa62a"></a><!-- doxytag: member="chan_dahdi.c::SIG_FGC_CAMAMF" ref="a945e2b5f225d3abdc57b5dcc53daa62a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SIG_FGC_CAMAMF&nbsp;&nbsp;&nbsp;(0x8000000 | DAHDI_SIG_EM)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00248">248</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l04718">dahdi_answer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03101">dahdi_call()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02408">dahdi_sig2str()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>, <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="a3dcffbaf4a26f2b7b792998df1eea27b"></a><!-- doxytag: member="chan_dahdi.c::SIG_FXOGS" ref="a3dcffbaf4a26f2b7b792998df1eea27b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SIG_FXOGS&nbsp;&nbsp;&nbsp;DAHDI_SIG_FXOGS</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00253">253</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l10640">available()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04718">dahdi_answer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03101">dahdi_call()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04313">dahdi_hangup()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07417">dahdi_new()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02408">dahdi_sig2str()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>, <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="a7c9b3bb8225896ff2b9aed27e6f80f10"></a><!-- doxytag: member="chan_dahdi.c::SIG_FXOKS" ref="a7c9b3bb8225896ff2b9aed27e6f80f10" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SIG_FXOKS&nbsp;&nbsp;&nbsp;DAHDI_SIG_FXOKS</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00254">254</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l10640">available()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04718">dahdi_answer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03101">dahdi_call()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04313">dahdi_hangup()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07417">dahdi_new()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02408">dahdi_sig2str()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>, <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="adb40571aa5ff846fc334be5260eab257"></a><!-- doxytag: member="chan_dahdi.c::SIG_FXOLS" ref="adb40571aa5ff846fc334be5260eab257" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SIG_FXOLS&nbsp;&nbsp;&nbsp;DAHDI_SIG_FXOLS</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00252">252</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l10640">available()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04718">dahdi_answer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03101">dahdi_call()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04313">dahdi_hangup()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07417">dahdi_new()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02408">dahdi_sig2str()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>, <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="a97e4c6fb4680984aafc6e0e55a2b6cb4"></a><!-- doxytag: member="chan_dahdi.c::SIG_FXSGS" ref="a97e4c6fb4680984aafc6e0e55a2b6cb4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SIG_FXSGS&nbsp;&nbsp;&nbsp;DAHDI_SIG_FXSGS</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00250">250</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l10640">available()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04718">dahdi_answer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03101">dahdi_call()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04313">dahdi_hangup()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07170">dahdi_indicate()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02408">dahdi_sig2str()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="a38139ec369c0243f4324eb4eb0c2f004"></a><!-- doxytag: member="chan_dahdi.c::SIG_FXSKS" ref="a38139ec369c0243f4324eb4eb0c2f004" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SIG_FXSKS&nbsp;&nbsp;&nbsp;DAHDI_SIG_FXSKS</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00251">251</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l10640">available()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04718">dahdi_answer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03101">dahdi_call()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04313">dahdi_hangup()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07170">dahdi_indicate()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07417">dahdi_new()</a>, <a class="el" href="chan__dahdi_8c_source.html#l10834">dahdi_request()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02408">dahdi_sig2str()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>, <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="a1dc50a07aef86c90ab94f1583c35a265"></a><!-- doxytag: member="chan_dahdi.c::SIG_FXSLS" ref="a1dc50a07aef86c90ab94f1583c35a265" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SIG_FXSLS&nbsp;&nbsp;&nbsp;DAHDI_SIG_FXSLS</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00249">249</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l10640">available()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04718">dahdi_answer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03101">dahdi_call()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04313">dahdi_hangup()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07170">dahdi_indicate()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02408">dahdi_sig2str()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>, <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="a5724d8559318f4724b247ede46ff182d"></a><!-- doxytag: member="chan_dahdi.c::SIG_GR303FXOKS" ref="a5724d8559318f4724b247ede46ff182d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SIG_GR303FXOKS&nbsp;&nbsp;&nbsp;(0x0100000 | DAHDI_SIG_FXOKS)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00266">266</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l02408">dahdi_sig2str()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>.</p>

</div>
</div>
<a class="anchor" id="adc73c6cbd4b991ecd2925640c0c8761e"></a><!-- doxytag: member="chan_dahdi.c::SIG_GR303FXSKS" ref="adc73c6cbd4b991ecd2925640c0c8761e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SIG_GR303FXSKS&nbsp;&nbsp;&nbsp;(0x0100000 | DAHDI_SIG_FXSKS)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00267">267</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l02408">dahdi_sig2str()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>.</p>

</div>
</div>
<a class="anchor" id="a1d73a98ae12601287580dedd9a6d739b"></a><!-- doxytag: member="chan_dahdi.c::SIG_MFCR2" ref="a1d73a98ae12601287580dedd9a6d739b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SIG_MFCR2&nbsp;&nbsp;&nbsp;DAHDI_SIG_CAS</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00259">259</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l04718">dahdi_answer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03101">dahdi_call()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04313">dahdi_hangup()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02408">dahdi_sig2str()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09496">do_monitor()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>.</p>

</div>
</div>
<a class="anchor" id="ae9ab0c9508fca045a06730533be276a5"></a><!-- doxytag: member="chan_dahdi.c::SIG_PRI" ref="ae9ab0c9508fca045a06730533be276a5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SIG_PRI&nbsp;&nbsp;&nbsp;DAHDI_SIG_CLEAR</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00255">255</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l04718">dahdi_answer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03101">dahdi_call()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02880">dahdi_confmute()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02245">dahdi_digit_begin()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02307">dahdi_digit_end()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02660">dahdi_enable_ec()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04313">dahdi_hangup()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07170">dahdi_indicate()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07417">dahdi_new()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01544">dahdi_queue_frame()</a>, <a class="el" href="chan__dahdi_8c_source.html#l06717">dahdi_read()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02408">dahdi_sig2str()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07090">dahdi_write()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>, <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="afacb372d32fba2192ed6a2989c54fbda"></a><!-- doxytag: member="chan_dahdi.c::SIG_SF" ref="afacb372d32fba2192ed6a2989c54fbda" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SIG_SF&nbsp;&nbsp;&nbsp;DAHDI_SIG_SF</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00260">260</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l04718">dahdi_answer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03101">dahdi_call()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02408">dahdi_sig2str()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>, <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="a33a2f70a24e9f8ccfcc1e76f208b1ab6"></a><!-- doxytag: member="chan_dahdi.c::SIG_SF_FEATB" ref="a33a2f70a24e9f8ccfcc1e76f208b1ab6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SIG_SF_FEATB&nbsp;&nbsp;&nbsp;(0x0800000 | DAHDI_SIG_SF)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00264">264</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l04718">dahdi_answer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03101">dahdi_call()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02408">dahdi_sig2str()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>, <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="aac334a7f88651d9e44499897386d2cfd"></a><!-- doxytag: member="chan_dahdi.c::SIG_SF_FEATD" ref="aac334a7f88651d9e44499897386d2cfd" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SIG_SF_FEATD&nbsp;&nbsp;&nbsp;(0x0200000 | DAHDI_SIG_SF)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00262">262</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l04718">dahdi_answer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03101">dahdi_call()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02408">dahdi_sig2str()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="a4625d3aba972e102c8460a9f16af0fc7"></a><!-- doxytag: member="chan_dahdi.c::SIG_SF_FEATDMF" ref="a4625d3aba972e102c8460a9f16af0fc7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SIG_SF_FEATDMF&nbsp;&nbsp;&nbsp;(0x0400000 | DAHDI_SIG_SF)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00263">263</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l04718">dahdi_answer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03101">dahdi_call()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02408">dahdi_sig2str()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="a193853e7e76cff05d51425eba48d030f"></a><!-- doxytag: member="chan_dahdi.c::SIG_SFWINK" ref="a193853e7e76cff05d51425eba48d030f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SIG_SFWINK&nbsp;&nbsp;&nbsp;(0x0100000 | DAHDI_SIG_SF)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00261">261</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l04718">dahdi_answer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03101">dahdi_call()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02408">dahdi_sig2str()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>, <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="aadcda889db3cf9dfe757dbc1d4d8311a"></a><!-- doxytag: member="chan_dahdi.c::SIG_SS7" ref="aadcda889db3cf9dfe757dbc1d4d8311a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SIG_SS7&nbsp;&nbsp;&nbsp;(0x1000000 | DAHDI_SIG_CLEAR)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00258">258</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l04718">dahdi_answer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03101">dahdi_call()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02880">dahdi_confmute()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02660">dahdi_enable_ec()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04313">dahdi_hangup()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07170">dahdi_indicate()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07417">dahdi_new()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01544">dahdi_queue_frame()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02408">dahdi_sig2str()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>.</p>

</div>
</div>
<a class="anchor" id="aa23909e437da8e1a5b8bf9b1b1e7fcdc"></a><!-- doxytag: member="chan_dahdi.c::SMDI_MD_WAIT_TIMEOUT" ref="aa23909e437da8e1a5b8bf9b1b1e7fcdc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SMDI_MD_WAIT_TIMEOUT&nbsp;&nbsp;&nbsp;1500</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00159">159</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="a5f4a19cf3d298b91b849f92ca1f834a0"></a><!-- doxytag: member="chan_dahdi.c::SUB_CALLWAIT" ref="a5f4a19cf3d298b91b849f92ca1f834a0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SUB_CALLWAIT&nbsp;&nbsp;&nbsp;1</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Call-Waiting call on hold </p>

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00580">580</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l10640">available()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05156">dahdi_bridge()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03101">dahdi_call()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01503">dahdi_get_index()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04313">dahdi_hangup()</a>, <a class="el" href="chan__dahdi_8c_source.html#l06717">dahdi_read()</a>, <a class="el" href="chan__dahdi_8c_source.html#l10834">dahdi_request()</a>, <a class="el" href="chan__dahdi_8c_source.html#l14609">dahdi_show_channel()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

</div>
</div>
<a class="anchor" id="a3f9523eb1c7c6620e8a9fddde066c2ff"></a><!-- doxytag: member="chan_dahdi.c::SUB_REAL" ref="a3f9523eb1c7c6620e8a9fddde066c2ff" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SUB_REAL&nbsp;&nbsp;&nbsp;0</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Active call </p>

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00579">579</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l06601">__dahdi_exception()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05502">attempt_transfer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l10640">available()</a>, <a class="el" href="chan__unistim_8c_source.html#l04998">build_device()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02836">bump_gains()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05554">check_for_conference()</a>, <a class="el" href="chan__unistim_8c_source.html#l01968">close_call()</a>, <a class="el" href="chan__unistim_8c_source.html#l01107">close_client()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04718">dahdi_answer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05156">dahdi_bridge()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03101">dahdi_call()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02880">dahdi_confmute()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09249">dahdi_destroy_channel_bynum()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02245">dahdi_digit_begin()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02307">dahdi_digit_end()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02709">dahdi_disable_ec()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02660">dahdi_enable_ec()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01503">dahdi_get_index()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04313">dahdi_hangup()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07170">dahdi_indicate()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07417">dahdi_new()</a>, <a class="el" href="chan__dahdi_8c_source.html#l06717">dahdi_read()</a>, <a class="el" href="chan__dahdi_8c_source.html#l10834">dahdi_request()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05470">dahdi_ring_phone()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04837">dahdi_setoption()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02692">dahdi_train_ec()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05044">dahdi_unlink()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03856">destroy_dahdi_pvt()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05123">disable_dtmf_detect()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09496">do_monitor()</a>, <a class="el" href="chan__dahdi_8c_source.html#l10771">duplicate_pseudo()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05138">enable_dtmf_detect()</a>, <a class="el" href="chan__unistim_8c_source.html#l04142">find_subchannel_by_name()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05580">get_alarms()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>, <a class="el" href="chan__unistim_8c_source.html#l02440">HandleCallIncoming()</a>, <a class="el" href="chan__unistim_8c_source.html#l02351">HandleCallOutgoing()</a>, <a class="el" href="chan__unistim_8c_source.html#l02544">key_call()</a>, <a class="el" href="chan__unistim_8c_source.html#l02652">key_dial_page()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09063">mwi_send_init()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09116">mwi_send_process_buffer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09203">mwi_send_process_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l08925">mwi_thread()</a>, <a class="el" href="chan__unistim_8c_source.html#l03345">process_request()</a>, <a class="el" href="chan__unistim_8c_source.html#l01510">rcv_mac_addr()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02590">reset_conf()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02969">restore_conference()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02850">restore_gains()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02896">save_conference()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03026">send_callerid()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>, <a class="el" href="chan__unistim_8c_source.html#l02305">TransferCallStep1()</a>, <a class="el" href="chan__unistim_8c_source.html#l02472">unistim_do_senddigit()</a>, <a class="el" href="chan__unistim_8c_source.html#l03709">unistim_hangup()</a>, <a class="el" href="chan__unistim_8c_source.html#l04219">unistim_senddigit_end()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l02604">update_conf()</a>.</p>

</div>
</div>
<a class="anchor" id="a4d6715f8ca4081df6121ac5442da521b"></a><!-- doxytag: member="chan_dahdi.c::SUB_THREEWAY" ref="a4d6715f8ca4081df6121ac5442da521b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SUB_THREEWAY&nbsp;&nbsp;&nbsp;2</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Three-way call </p>

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00581">581</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l05502">attempt_transfer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l10640">available()</a>, <a class="el" href="chan__unistim_8c_source.html#l01968">close_call()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04718">dahdi_answer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05156">dahdi_bridge()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01503">dahdi_get_index()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04313">dahdi_hangup()</a>, <a class="el" href="chan__dahdi_8c_source.html#l14609">dahdi_show_channel()</a>, <a class="el" href="chan__unistim_8c_source.html#l02351">HandleCallOutgoing()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>, <a class="el" href="chan__unistim_8c_source.html#l02305">TransferCallStep1()</a>, <a class="el" href="chan__unistim_8c_source.html#l03815">unistim_answer()</a>, and <a class="el" href="chan__unistim_8c_source.html#l03709">unistim_hangup()</a>.</p>

</div>
</div>
<a class="anchor" id="a9b7ef3aa0efb7411931914e8562c8d46"></a><!-- doxytag: member="chan_dahdi.c::TRAILER_MS" ref="a9b7ef3aa0efb7411931914e8562c8d46" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TRAILER_MS&nbsp;&nbsp;&nbsp;5</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l17380">dahdi_sendtext()</a>.</p>

</div>
</div>
<a class="anchor" id="a3811374ead4311c8b04a85ae6dd7196b"></a><!-- doxytag: member="chan_dahdi.c::TRANSFER" ref="a3811374ead4311c8b04a85ae6dd7196b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TRANSFER&nbsp;&nbsp;&nbsp;0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l15182">15182</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l15251">action_transfer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l15185">dahdi_fake_event()</a>, <a class="el" href="app__queue_8c_source.html#l03383">send_agent_complete()</a>, and <a class="el" href="app__queue_8c_source.html#l03569">try_calling()</a>.</p>

</div>
</div>
<hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="ac6eb1255d7d5fc62e32b545a15e2ee38"></a><!-- doxytag: member="chan_dahdi.c::mwisend_states" ref="ac6eb1255d7d5fc62e32b545a15e2ee38" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="chan__dahdi_8c.html#ac6eb1255d7d5fc62e32b545a15e2ee38">mwisend_states</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="ac6eb1255d7d5fc62e32b545a15e2ee38a048f09b2d4c8ab143595fb3a033ba888"></a><!-- doxytag: member="MWI_SEND_NULL" ref="ac6eb1255d7d5fc62e32b545a15e2ee38a048f09b2d4c8ab143595fb3a033ba888" args="" -->MWI_SEND_NULL</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ac6eb1255d7d5fc62e32b545a15e2ee38a26ea69f32853d570979948e99c019ad6"></a><!-- doxytag: member="MWI_SEND_SA" ref="ac6eb1255d7d5fc62e32b545a15e2ee38a26ea69f32853d570979948e99c019ad6" args="" -->MWI_SEND_SA</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ac6eb1255d7d5fc62e32b545a15e2ee38a6a12b01ecaf82d8837cb5d4e1764b54f"></a><!-- doxytag: member="MWI_SEND_SA_WAIT" ref="ac6eb1255d7d5fc62e32b545a15e2ee38a6a12b01ecaf82d8837cb5d4e1764b54f" args="" -->MWI_SEND_SA_WAIT</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ac6eb1255d7d5fc62e32b545a15e2ee38a5030903afd5a2db7324494c3b2546935"></a><!-- doxytag: member="MWI_SEND_PAUSE" ref="ac6eb1255d7d5fc62e32b545a15e2ee38a5030903afd5a2db7324494c3b2546935" args="" -->MWI_SEND_PAUSE</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ac6eb1255d7d5fc62e32b545a15e2ee38abdb497716e46eb102ddd50ed81082e4c"></a><!-- doxytag: member="MWI_SEND_SPILL" ref="ac6eb1255d7d5fc62e32b545a15e2ee38abdb497716e46eb102ddd50ed81082e4c" args="" -->MWI_SEND_SPILL</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ac6eb1255d7d5fc62e32b545a15e2ee38ac1e087089f32665428639ae83f465b60"></a><!-- doxytag: member="MWI_SEND_CLEANUP" ref="ac6eb1255d7d5fc62e32b545a15e2ee38ac1e087089f32665428639ae83f465b60" args="" -->MWI_SEND_CLEANUP</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ac6eb1255d7d5fc62e32b545a15e2ee38aae305004b9065d512f57d60fb0d36ef1"></a><!-- doxytag: member="MWI_SEND_DONE" ref="ac6eb1255d7d5fc62e32b545a15e2ee38aae305004b9065d512f57d60fb0d36ef1" args="" -->MWI_SEND_DONE</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00633">633</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00633"></a>00633              {
<a name="l00634"></a>00634    <a class="code" href="chan__dahdi_8c.html#ac6eb1255d7d5fc62e32b545a15e2ee38a048f09b2d4c8ab143595fb3a033ba888">MWI_SEND_NULL</a> = 0,
<a name="l00635"></a>00635    <a class="code" href="chan__dahdi_8c.html#ac6eb1255d7d5fc62e32b545a15e2ee38a26ea69f32853d570979948e99c019ad6">MWI_SEND_SA</a>,
<a name="l00636"></a>00636    <a class="code" href="chan__dahdi_8c.html#ac6eb1255d7d5fc62e32b545a15e2ee38a6a12b01ecaf82d8837cb5d4e1764b54f">MWI_SEND_SA_WAIT</a>,
<a name="l00637"></a>00637    <a class="code" href="chan__dahdi_8c.html#ac6eb1255d7d5fc62e32b545a15e2ee38a5030903afd5a2db7324494c3b2546935">MWI_SEND_PAUSE</a>,
<a name="l00638"></a>00638    <a class="code" href="chan__dahdi_8c.html#ac6eb1255d7d5fc62e32b545a15e2ee38abdb497716e46eb102ddd50ed81082e4c">MWI_SEND_SPILL</a>,
<a name="l00639"></a>00639    <a class="code" href="chan__dahdi_8c.html#ac6eb1255d7d5fc62e32b545a15e2ee38ac1e087089f32665428639ae83f465b60">MWI_SEND_CLEANUP</a>,
<a name="l00640"></a>00640    <a class="code" href="chan__dahdi_8c.html#ac6eb1255d7d5fc62e32b545a15e2ee38aae305004b9065d512f57d60fb0d36ef1">MWI_SEND_DONE</a>,
<a name="l00641"></a>00641 } <a class="code" href="chan__dahdi_8c.html#ac6eb1255d7d5fc62e32b545a15e2ee38">mwisend_states</a>;
</pre></div></p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="afa1252981be0ae4165d3ff5993f9f9f1"></a><!-- doxytag: member="chan_dahdi.c::__dahdi_exception" ref="afa1252981be0ae4165d3ff5993f9f9f1" args="(struct ast_channel *ast)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__frame.html">ast_frame</a>* __dahdi_exception </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>ast</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l06601">6601</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00469">ast_channel::_state</a>, <a class="el" href="channel_8c_source.html#l04733">ast_bridged_channel()</a>, <a class="el" href="frame_8h_source.html#l00314">AST_CONTROL_UNHOLD</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="frame_8h_source.html#l00107">AST_FRAME_NULL</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8c_source.html#l01123">ast_queue_control()</a>, <a class="el" href="channel_8c_source.html#l04695">ast_setstate()</a>, <a class="el" href="channel_8h_source.html#l00364">AST_STATE_RINGING</a>, <a class="el" href="channel_8h_source.html#l00365">AST_STATE_UP</a>, <a class="el" href="time_8h_source.html#l00164">ast_tv()</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="chan__dahdi_8c_source.html#l01047">dahdi_pvt::callwaitingrepeat</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="chan__dahdi_8c_source.html#l01048">dahdi_pvt::cidcwexpire</a>, <a class="el" href="chan__dahdi_8c_source.html#l02709">dahdi_disable_ec()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02660">dahdi_enable_ec()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00376">dahdi_get_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01503">dahdi_get_index()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05470">dahdi_ring_phone()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02863">dahdi_set_hook()</a>, <a class="el" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">ast_frame::data</a>, <a class="el" href="frame_8h_source.html#l00147">ast_frame::datalen</a>, <a class="el" href="frame_8h_source.html#l00161">ast_frame::delivery</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="chan__dahdi_8c_source.html#l00745">dahdi_pvt::dialing</a>, <a class="el" href="chan__dahdi_8c_source.html#l02389">event2str()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00611">dahdi_subchannel::f</a>, <a class="el" href="chan__dahdi_8c_source.html#l01149">dahdi_pvt::fake_event</a>, <a class="el" href="channel_8h_source.html#l00458">ast_channel::fds</a>, <a class="el" href="chan__dahdi_8c_source.html#l01111">dahdi_pvt::flashtime</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="frame_8h_source.html#l00151">ast_frame::mallocd</a>, <a class="el" href="chan__dahdi_8c_source.html#l00616">dahdi_subchannel::needanswer</a>, <a class="el" href="chan__dahdi_8c_source.html#l00619">dahdi_subchannel::needunhold</a>, <a class="el" href="frame_8h_source.html#l00155">ast_frame::offset</a>, <a class="el" href="chan__dahdi_8c_source.html#l00673">dahdi_pvt::oprmode</a>, <a class="el" href="chan__dahdi_8c_source.html#l00608">dahdi_subchannel::owner</a>, <a class="el" href="chan__dahdi_8c_source.html#l00650">dahdi_pvt::owner</a>, <a class="el" href="frame_8h_source.html#l00159">ast_frame::ptr</a>, <a class="el" href="chan__dahdi_8c_source.html#l00671">dahdi_pvt::radio</a>, <a class="el" href="frame_8h_source.html#l00149">ast_frame::samples</a>, <a class="el" href="frame_8h_source.html#l00157">ast_frame::src</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>, <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>, and <a class="el" href="chan__dahdi_8c_source.html#l02604">update_conf()</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l06707">dahdi_exception()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l06717">dahdi_read()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l06602"></a>06602 {
<a name="l06603"></a>06603    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *p = ast-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l06604"></a>06604    <span class="keywordtype">int</span> res;
<a name="l06605"></a>06605    <span class="keywordtype">int</span> usedindex=-1;
<a name="l06606"></a>06606    <span class="keywordtype">int</span> idx;
<a name="l06607"></a>06607    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l06608"></a>06608 
<a name="l06609"></a>06609 
<a name="l06610"></a>06610    idx = <a class="code" href="chan__dahdi_8c.html#a62c8e3f411fb9e5ec62a1e77c152c2df">dahdi_get_index</a>(ast, p, 1);
<a name="l06611"></a>06611 
<a name="l06612"></a>06612    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a29ff71f9d5c7927906ebd437fe372056">AST_FRAME_NULL</a>;
<a name="l06613"></a>06613    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> = 0;
<a name="l06614"></a>06614    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a> = 0;
<a name="l06615"></a>06615    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#aed16590d48f41d89f31e0cf347f5cd99">mallocd</a> = 0;
<a name="l06616"></a>06616    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#aed7ea92f45bd273dde380a45ddced592">offset</a> = 0;
<a name="l06617"></a>06617    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = 0;
<a name="l06618"></a>06618    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a41a708025486b4c9383e7432e9ba3f0e">delivery</a> = <a class="code" href="time_8h.html#af46dec59fc43982d018a757f7b499669" title="Returns a timeval from sec, usec.">ast_tv</a>(0,0);
<a name="l06619"></a>06619    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#af51e37c9331049b1e3d250a7c8bc3c26">src</a> = <span class="stringliteral">&quot;dahdi_exception&quot;</span>;
<a name="l06620"></a>06620    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a> = NULL;
<a name="l06621"></a>06621 
<a name="l06622"></a>06622 
<a name="l06623"></a>06623    <span class="keywordflow">if</span> ((!p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) &amp;&amp; (!(p-&gt;<a class="code" href="structdahdi__pvt.html#ac53b42243ee40edc74b615fe86806fe3" title="Nonzero if the signaling type is sent over a radio.">radio</a> || (p-&gt;<a class="code" href="structdahdi__pvt.html#a3b3cefe7a33d0cff61f3a2b5955b6c8b">oprmode</a> &lt; 0)))) {
<a name="l06624"></a>06624       <span class="comment">/* If nobody owns us, absorb the event appropriately, otherwise</span>
<a name="l06625"></a>06625 <span class="comment">         we loop indefinitely.  This occurs when, during call waiting, the</span>
<a name="l06626"></a>06626 <span class="comment">         other end hangs up our channel so that it no longer exists, but we</span>
<a name="l06627"></a>06627 <span class="comment">         have neither FLASH&apos;d nor ONHOOK&apos;d to signify our desire to</span>
<a name="l06628"></a>06628 <span class="comment">         change to the other channel. */</span>
<a name="l06629"></a>06629       <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a9e44f391f0742649b6cd532f8487c400" title="Holding place for event injected from outside normal operation.">fake_event</a>) {
<a name="l06630"></a>06630          res = p-&gt;<a class="code" href="structdahdi__pvt.html#a9e44f391f0742649b6cd532f8487c400" title="Holding place for event injected from outside normal operation.">fake_event</a>;
<a name="l06631"></a>06631          p-&gt;<a class="code" href="structdahdi__pvt.html#a9e44f391f0742649b6cd532f8487c400" title="Holding place for event injected from outside normal operation.">fake_event</a> = 0;
<a name="l06632"></a>06632       } <span class="keywordflow">else</span>
<a name="l06633"></a>06633          res = <a class="code" href="chan__dahdi_8c.html#aad4a9758fbc62380e70cbbcbb31311a4" title="Avoid the silly dahdi_getevent which ignores a bunch of events.">dahdi_get_event</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>);
<a name="l06634"></a>06634       <span class="comment">/* Switch to real if there is one and this isn&apos;t something really silly... */</span>
<a name="l06635"></a>06635       <span class="keywordflow">if</span> ((res != DAHDI_EVENT_RINGEROFF) &amp;&amp; (res != DAHDI_EVENT_RINGERON) &amp;&amp;
<a name="l06636"></a>06636          (res != DAHDI_EVENT_HOOKCOMPLETE)) {
<a name="l06637"></a>06637          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Restoring owner of channel %d on event %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, res);
<a name="l06638"></a>06638          p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;
<a name="l06639"></a>06639          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> &amp;&amp; <a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>))
<a name="l06640"></a>06640             <a class="code" href="channel_8h.html#a60f9d2b0ab8b7a839902313321163b28" title="Queue a control frame with payload.">ast_queue_control</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a3e7629b5f7e39f1cc8ad2e51e266f91e">AST_CONTROL_UNHOLD</a>);
<a name="l06641"></a>06641          p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a65087932715c9dad92fb135aac7f3fac">needunhold</a> = 1;
<a name="l06642"></a>06642       }
<a name="l06643"></a>06643       <span class="keywordflow">switch</span> (res) {
<a name="l06644"></a>06644       <span class="keywordflow">case</span> DAHDI_EVENT_ONHOOK:
<a name="l06645"></a>06645          <a class="code" href="chan__dahdi_8c.html#a5ceb6fd5bd012740d50b04e84fb29be4">dahdi_disable_ec</a>(p);
<a name="l06646"></a>06646          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l06647"></a>06647             <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Channel %s still has call, ringing phone\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name);
<a name="l06648"></a>06648             <a class="code" href="chan__dahdi_8c.html#a22c775b992dee643a259e67efc1711d0">dahdi_ring_phone</a>(p);
<a name="l06649"></a>06649             p-&gt;<a class="code" href="structdahdi__pvt.html#acb6666d113ea3605f76a45fe3e90e192">callwaitingrepeat</a> = 0;
<a name="l06650"></a>06650             p-&gt;<a class="code" href="structdahdi__pvt.html#ac8c4841c7cad35c09ddbd28ede1c4cfe">cidcwexpire</a> = 0;
<a name="l06651"></a>06651          } <span class="keywordflow">else</span>
<a name="l06652"></a>06652             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Absorbed on hook, but nobody is left!?!?\n&quot;</span>);
<a name="l06653"></a>06653          <a class="code" href="chan__dahdi_8c.html#ac56c05fde8bc30c71af46502e97fae3b">update_conf</a>(p);
<a name="l06654"></a>06654          <span class="keywordflow">break</span>;
<a name="l06655"></a>06655       <span class="keywordflow">case</span> DAHDI_EVENT_RINGOFFHOOK:
<a name="l06656"></a>06656          <a class="code" href="chan__dahdi_8c.html#a8c34a5bce2b26d056942349217806312">dahdi_enable_ec</a>(p);
<a name="l06657"></a>06657          <a class="code" href="chan__dahdi_8c.html#a7c65e6943db828524ea6c9215b8bf696">dahdi_set_hook</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_OFFHOOK);
<a name="l06658"></a>06658          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> &amp;&amp; (p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa">AST_STATE_RINGING</a>)) {
<a name="l06659"></a>06659             p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a00bf8ced61d8f8736d6dc3b769609600">needanswer</a> = 1;
<a name="l06660"></a>06660             p-&gt;<a class="code" href="structdahdi__pvt.html#af17335c0c7a4c1e03e987a33f6eec81b" title="TRUE if in the process of dialing digits or sending something.">dialing</a> = 0;
<a name="l06661"></a>06661          }
<a name="l06662"></a>06662          <span class="keywordflow">break</span>;
<a name="l06663"></a>06663       <span class="keywordflow">case</span> DAHDI_EVENT_HOOKCOMPLETE:
<a name="l06664"></a>06664       <span class="keywordflow">case</span> DAHDI_EVENT_RINGERON:
<a name="l06665"></a>06665       <span class="keywordflow">case</span> DAHDI_EVENT_RINGEROFF:
<a name="l06666"></a>06666          <span class="comment">/* Do nothing */</span>
<a name="l06667"></a>06667          <span class="keywordflow">break</span>;
<a name="l06668"></a>06668       <span class="keywordflow">case</span> DAHDI_EVENT_WINKFLASH:
<a name="l06669"></a>06669          p-&gt;<a class="code" href="structdahdi__pvt.html#a39ccf8f0384020d69764aa7ea619f515">flashtime</a> = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l06670"></a>06670          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l06671"></a>06671             <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Channel %d flashed to other channel %s\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name);
<a name="l06672"></a>06672             <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>) {
<a name="l06673"></a>06673                <span class="comment">/* Answer if necessary */</span>
<a name="l06674"></a>06674                usedindex = <a class="code" href="chan__dahdi_8c.html#a62c8e3f411fb9e5ec62a1e77c152c2df">dahdi_get_index</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, p, 0);
<a name="l06675"></a>06675                <span class="keywordflow">if</span> (usedindex &gt; -1) {
<a name="l06676"></a>06676                   p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[usedindex].<a class="code" href="structdahdi__subchannel.html#a00bf8ced61d8f8736d6dc3b769609600">needanswer</a> = 1;
<a name="l06677"></a>06677                }
<a name="l06678"></a>06678                <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>);
<a name="l06679"></a>06679             }
<a name="l06680"></a>06680             p-&gt;<a class="code" href="structdahdi__pvt.html#acb6666d113ea3605f76a45fe3e90e192">callwaitingrepeat</a> = 0;
<a name="l06681"></a>06681             p-&gt;<a class="code" href="structdahdi__pvt.html#ac8c4841c7cad35c09ddbd28ede1c4cfe">cidcwexpire</a> = 0;
<a name="l06682"></a>06682             <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>))
<a name="l06683"></a>06683                <a class="code" href="channel_8h.html#a60f9d2b0ab8b7a839902313321163b28" title="Queue a control frame with payload.">ast_queue_control</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a3e7629b5f7e39f1cc8ad2e51e266f91e">AST_CONTROL_UNHOLD</a>);
<a name="l06684"></a>06684             p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a65087932715c9dad92fb135aac7f3fac">needunhold</a> = 1;
<a name="l06685"></a>06685          } <span class="keywordflow">else</span>
<a name="l06686"></a>06686             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Absorbed on hook, but nobody is left!?!?\n&quot;</span>);
<a name="l06687"></a>06687          <a class="code" href="chan__dahdi_8c.html#ac56c05fde8bc30c71af46502e97fae3b">update_conf</a>(p);
<a name="l06688"></a>06688          <span class="keywordflow">break</span>;
<a name="l06689"></a>06689       <span class="keywordflow">default</span>:
<a name="l06690"></a>06690          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Don&apos;t know how to absorb event %s\n&quot;</span>, <a class="code" href="chan__dahdi_8c.html#a92fb0724a6e93f69cec9d6e83cdcc3f3">event2str</a>(res));
<a name="l06691"></a>06691       }
<a name="l06692"></a>06692       f = &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>;
<a name="l06693"></a>06693       <span class="keywordflow">return</span> f;
<a name="l06694"></a>06694    }
<a name="l06695"></a>06695    <span class="keywordflow">if</span> (!(p-&gt;<a class="code" href="structdahdi__pvt.html#ac53b42243ee40edc74b615fe86806fe3" title="Nonzero if the signaling type is sent over a radio.">radio</a> || (p-&gt;<a class="code" href="structdahdi__pvt.html#a3b3cefe7a33d0cff61f3a2b5955b6c8b">oprmode</a> &lt; 0)))
<a name="l06696"></a>06696       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Exception on %d, channel %d\n&quot;</span>, ast-&gt;<a class="code" href="structast__channel.html#aef68cd3879b791a3b6c12cdb750f8e6a">fds</a>[0],p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l06697"></a>06697    <span class="comment">/* If it&apos;s not us, return NULL immediately */</span>
<a name="l06698"></a>06698    <span class="keywordflow">if</span> (ast != p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l06699"></a>06699       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;We&apos;re %s, not %s\n&quot;</span>, ast-&gt;name, p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name);
<a name="l06700"></a>06700       f = &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>;
<a name="l06701"></a>06701       <span class="keywordflow">return</span> f;
<a name="l06702"></a>06702    }
<a name="l06703"></a>06703    f = <a class="code" href="chan__dahdi_8c.html#a0f158b05f591419e6624806afbd8cece">dahdi_handle_event</a>(ast);
<a name="l06704"></a>06704    <span class="keywordflow">return</span> f;
<a name="l06705"></a>06705 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2fd806029fe936c297e52d2236092fc0"></a><!-- doxytag: member="chan_dahdi.c::__unload_module" ref="a2fd806029fe936c297e52d2236092fc0" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int __unload_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l15849">15849</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="channel_8c_source.html#l00587">ast_channel_unregister()</a>, <a class="el" href="cli_8c_source.html#l01937">ast_cli_unregister_multiple()</a>, <a class="el" href="lock_8h_source.html#l01744">ast_cond_destroy()</a>, <a class="el" href="manager_8c_source.html#l03379">ast_manager_unregister()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="lock_8h_source.html#l00082">AST_PTHREADT_NULL</a>, <a class="el" href="lock_8h_source.html#l00083">AST_PTHREADT_STOP</a>, <a class="el" href="channel_8c_source.html#l01666">ast_softhangup()</a>, <a class="el" href="channel_8h_source.html#l00638">AST_SOFTHANGUP_APPUNLOAD</a>, <a class="el" href="pbx_8c_source.html#l06403">ast_unregister_application()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03929">destroy_all_channels()</a>, <a class="el" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>, <a class="el" href="cdr__custom_8c_source.html#l00057">master</a>, <a class="el" href="chan__dahdi_8c_source.html#l00682">dahdi_pvt::next</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00650">dahdi_pvt::owner</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l17308">load_module()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l15932">unload_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l15850"></a>15850 {
<a name="l15851"></a>15851    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *p;
<a name="l15852"></a>15852 <span class="preprocessor">#if defined(HAVE_PRI) || defined(HAVE_SS7)</span>
<a name="l15853"></a>15853 <span class="preprocessor"></span>   <span class="keywordtype">int</span> i, j;
<a name="l15854"></a>15854 <span class="preprocessor">#endif</span>
<a name="l15855"></a>15855 <span class="preprocessor"></span>
<a name="l15856"></a>15856 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l15857"></a>15857 <span class="preprocessor"></span>   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="chan__dahdi_8c.html#a80bfdd8adbffe226265cd729655a7268">NUM_SPANS</a>; i++) {
<a name="l15858"></a>15858       <span class="keywordflow">if</span> (pris[i].<a class="code" href="cdr__custom_8c.html#ac4cd676396d9d62ba95a047806668d90">master</a> != <a class="code" href="lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>)
<a name="l15859"></a>15859          pthread_cancel(pris[i].<a class="code" href="cdr__custom_8c.html#ac4cd676396d9d62ba95a047806668d90">master</a>);
<a name="l15860"></a>15860    }
<a name="l15861"></a>15861    <a class="code" href="cli_8h.html#a56b6b59ee2eaa994597a5b0f4e9f9d09" title="Unregister multiple commands.">ast_cli_unregister_multiple</a>(dahdi_pri_cli, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(dahdi_pri_cli));
<a name="l15862"></a>15862    <a class="code" href="module_8h.html#ad2ca15621101154f29748cf1dac3c3cf" title="Unregister an application.">ast_unregister_application</a>(dahdi_send_keypad_facility_app);
<a name="l15863"></a>15863 <span class="preprocessor">#ifdef HAVE_PRI_PROG_W_CAUSE</span>
<a name="l15864"></a>15864 <span class="preprocessor"></span>   <a class="code" href="module_8h.html#ad2ca15621101154f29748cf1dac3c3cf" title="Unregister an application.">ast_unregister_application</a>(dahdi_send_callrerouting_facility_app);
<a name="l15865"></a>15865 <span class="preprocessor">#endif</span>
<a name="l15866"></a>15866 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l15867"></a>15867 <span class="preprocessor"></span><span class="preprocessor">#if defined(HAVE_SS7)</span>
<a name="l15868"></a>15868 <span class="preprocessor"></span>   <span class="keywordflow">for</span> (i = 0; i &lt; NUM_SPANS; i++) {
<a name="l15869"></a>15869       <span class="keywordflow">if</span> (linksets[i].<a class="code" href="cdr__custom_8c.html#ac4cd676396d9d62ba95a047806668d90">master</a> != <a class="code" href="lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>)
<a name="l15870"></a>15870          pthread_cancel(linksets[i].<a class="code" href="cdr__custom_8c.html#ac4cd676396d9d62ba95a047806668d90">master</a>);
<a name="l15871"></a>15871       }
<a name="l15872"></a>15872    <a class="code" href="cli_8h.html#a56b6b59ee2eaa994597a5b0f4e9f9d09" title="Unregister multiple commands.">ast_cli_unregister_multiple</a>(dahdi_ss7_cli, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(dahdi_ss7_cli));
<a name="l15873"></a>15873 <span class="preprocessor">#endif</span>
<a name="l15874"></a>15874 <span class="preprocessor"></span><span class="preprocessor">#if defined(HAVE_OPENR2)</span>
<a name="l15875"></a>15875 <span class="preprocessor"></span>   dahdi_r2_destroy_links();
<a name="l15876"></a>15876    <a class="code" href="cli_8h.html#a56b6b59ee2eaa994597a5b0f4e9f9d09" title="Unregister multiple commands.">ast_cli_unregister_multiple</a>(dahdi_mfcr2_cli, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(dahdi_mfcr2_cli));
<a name="l15877"></a>15877    <a class="code" href="module_8h.html#ad2ca15621101154f29748cf1dac3c3cf" title="Unregister an application.">ast_unregister_application</a>(dahdi_accept_r2_call_app);
<a name="l15878"></a>15878 <span class="preprocessor">#endif</span>
<a name="l15879"></a>15879 <span class="preprocessor"></span>
<a name="l15880"></a>15880    <a class="code" href="cli_8h.html#a56b6b59ee2eaa994597a5b0f4e9f9d09" title="Unregister multiple commands.">ast_cli_unregister_multiple</a>(<a class="code" href="chan__dahdi_8c.html#ad34f2f8582cb6f9118dbd230b6636f2d">dahdi_cli</a>, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="chan__dahdi_8c.html#ad34f2f8582cb6f9118dbd230b6636f2d">dahdi_cli</a>));
<a name="l15881"></a>15881    <a class="code" href="group__Group__AMI.html#ga5a9336fe5bb6b2cf350de9571080809d" title="Unregister a registered manager command.">ast_manager_unregister</a>( <span class="stringliteral">&quot;DAHDIDialOffhook&quot;</span> );
<a name="l15882"></a>15882    <a class="code" href="group__Group__AMI.html#ga5a9336fe5bb6b2cf350de9571080809d" title="Unregister a registered manager command.">ast_manager_unregister</a>( <span class="stringliteral">&quot;DAHDIHangup&quot;</span> );
<a name="l15883"></a>15883    <a class="code" href="group__Group__AMI.html#ga5a9336fe5bb6b2cf350de9571080809d" title="Unregister a registered manager command.">ast_manager_unregister</a>( <span class="stringliteral">&quot;DAHDITransfer&quot;</span> );
<a name="l15884"></a>15884    <a class="code" href="group__Group__AMI.html#ga5a9336fe5bb6b2cf350de9571080809d" title="Unregister a registered manager command.">ast_manager_unregister</a>( <span class="stringliteral">&quot;DAHDIDNDoff&quot;</span> );
<a name="l15885"></a>15885    <a class="code" href="group__Group__AMI.html#ga5a9336fe5bb6b2cf350de9571080809d" title="Unregister a registered manager command.">ast_manager_unregister</a>( <span class="stringliteral">&quot;DAHDIDNDon&quot;</span> );
<a name="l15886"></a>15886    <a class="code" href="group__Group__AMI.html#ga5a9336fe5bb6b2cf350de9571080809d" title="Unregister a registered manager command.">ast_manager_unregister</a>(<span class="stringliteral">&quot;DAHDIShowChannels&quot;</span>);
<a name="l15887"></a>15887    <a class="code" href="group__Group__AMI.html#ga5a9336fe5bb6b2cf350de9571080809d" title="Unregister a registered manager command.">ast_manager_unregister</a>(<span class="stringliteral">&quot;DAHDIRestart&quot;</span>);
<a name="l15888"></a>15888    <a class="code" href="channel_8h.html#a53b708b7fc71dcbcd33acae0ad4d7ef8" title="Unregister a channel technology.">ast_channel_unregister</a>(&amp;<a class="code" href="chan__dahdi_8c.html#abaaa1bdd4fa7ebb3e41873b18bda7170">dahdi_tech</a>);
<a name="l15889"></a>15889    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;iflock);
<a name="l15890"></a>15890    <span class="comment">/* Hangup all interfaces if they have an owner */</span>
<a name="l15891"></a>15891    p = <a class="code" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>;
<a name="l15892"></a>15892    <span class="keywordflow">while</span> (p) {
<a name="l15893"></a>15893       <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)
<a name="l15894"></a>15894          <a class="code" href="channel_8h.html#ac2d6607253f7e8b272d4e845474eaa9b" title="Softly hangup up a channel.">ast_softhangup</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709aeeafae6abd77156800ec76b0ff7d3867">AST_SOFTHANGUP_APPUNLOAD</a>);
<a name="l15895"></a>15895       p = p-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>;
<a name="l15896"></a>15896    }
<a name="l15897"></a>15897    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;iflock);
<a name="l15898"></a>15898    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;monlock);
<a name="l15899"></a>15899    <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#afbd6fc6e0ab3c1a04a518f19c21d4503" title="This is the thread for the monitor which checks for input on the channels which are...">monitor_thread</a> &amp;&amp; (<a class="code" href="chan__dahdi_8c.html#afbd6fc6e0ab3c1a04a518f19c21d4503" title="This is the thread for the monitor which checks for input on the channels which are...">monitor_thread</a> != <a class="code" href="lock_8h.html#a873a83eb8196323194aac2bea23d794e">AST_PTHREADT_STOP</a>) &amp;&amp; (<a class="code" href="chan__dahdi_8c.html#afbd6fc6e0ab3c1a04a518f19c21d4503" title="This is the thread for the monitor which checks for input on the channels which are...">monitor_thread</a> != <a class="code" href="lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>)) {
<a name="l15900"></a>15900       pthread_cancel(<a class="code" href="chan__dahdi_8c.html#afbd6fc6e0ab3c1a04a518f19c21d4503" title="This is the thread for the monitor which checks for input on the channels which are...">monitor_thread</a>);
<a name="l15901"></a>15901       pthread_kill(<a class="code" href="chan__dahdi_8c.html#afbd6fc6e0ab3c1a04a518f19c21d4503" title="This is the thread for the monitor which checks for input on the channels which are...">monitor_thread</a>, SIGURG);
<a name="l15902"></a>15902       pthread_join(<a class="code" href="chan__dahdi_8c.html#afbd6fc6e0ab3c1a04a518f19c21d4503" title="This is the thread for the monitor which checks for input on the channels which are...">monitor_thread</a>, NULL);
<a name="l15903"></a>15903    }
<a name="l15904"></a>15904    <a class="code" href="chan__dahdi_8c.html#afbd6fc6e0ab3c1a04a518f19c21d4503" title="This is the thread for the monitor which checks for input on the channels which are...">monitor_thread</a> = <a class="code" href="lock_8h.html#a873a83eb8196323194aac2bea23d794e">AST_PTHREADT_STOP</a>;
<a name="l15905"></a>15905    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;monlock);
<a name="l15906"></a>15906 
<a name="l15907"></a>15907    <a class="code" href="chan__dahdi_8c.html#aff6140c85d9d958a2ff7abf6003a20d9">destroy_all_channels</a>();
<a name="l15908"></a>15908 
<a name="l15909"></a>15909 <span class="preprocessor">#if defined(HAVE_PRI)</span>
<a name="l15910"></a>15910 <span class="preprocessor"></span>   <span class="keywordflow">for</span> (i = 0; i &lt; NUM_SPANS; i++) {
<a name="l15911"></a>15911       <span class="keywordflow">if</span> (pris[i].<a class="code" href="cdr__custom_8c.html#ac4cd676396d9d62ba95a047806668d90">master</a> &amp;&amp; (pris[i].<a class="code" href="cdr__custom_8c.html#ac4cd676396d9d62ba95a047806668d90">master</a> != <a class="code" href="lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>))
<a name="l15912"></a>15912          pthread_join(pris[i].<a class="code" href="cdr__custom_8c.html#ac4cd676396d9d62ba95a047806668d90">master</a>, NULL);
<a name="l15913"></a>15913       <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="chan__dahdi_8c.html#aaad94eef7bd74293b956f6de74a62d0f">NUM_DCHANS</a>; j++) {
<a name="l15914"></a>15914          dahdi_close_pri_fd(&amp;(pris[i]), j);
<a name="l15915"></a>15915       }
<a name="l15916"></a>15916    }
<a name="l15917"></a>15917 <span class="preprocessor">#endif</span>
<a name="l15918"></a>15918 <span class="preprocessor"></span>
<a name="l15919"></a>15919 <span class="preprocessor">#if defined(HAVE_SS7)</span>
<a name="l15920"></a>15920 <span class="preprocessor"></span>   <span class="keywordflow">for</span> (i = 0; i &lt; NUM_SPANS; i++) {
<a name="l15921"></a>15921       <span class="keywordflow">if</span> (linksets[i].<a class="code" href="cdr__custom_8c.html#ac4cd676396d9d62ba95a047806668d90">master</a> &amp;&amp; (linksets[i].<a class="code" href="cdr__custom_8c.html#ac4cd676396d9d62ba95a047806668d90">master</a> != <a class="code" href="lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>))
<a name="l15922"></a>15922          pthread_join(linksets[i].<a class="code" href="cdr__custom_8c.html#ac4cd676396d9d62ba95a047806668d90">master</a>, NULL);
<a name="l15923"></a>15923       <span class="keywordflow">for</span> (j = 0; j &lt; NUM_DCHANS; j++) {
<a name="l15924"></a>15924          dahdi_close_ss7_fd(&amp;(linksets[i]), j);
<a name="l15925"></a>15925       }
<a name="l15926"></a>15926    }
<a name="l15927"></a>15927 <span class="preprocessor">#endif</span>
<a name="l15928"></a>15928 <span class="preprocessor"></span>   <a class="code" href="lock_8h.html#a7752bcadc38f1d7a7a8528c538569115">ast_cond_destroy</a>(&amp;<a class="code" href="chan__dahdi_8c.html#aa0eccd1394a26a586074c22fe8d0ff43">ss_thread_complete</a>);
<a name="l15929"></a>15929    <span class="keywordflow">return</span> 0;
<a name="l15930"></a>15930 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af51603d74ba059c0bfc173b52e978686"></a><!-- doxytag: member="chan_dahdi.c::action_dahdidialoffhook" ref="af51603d74ba059c0bfc173b52e978686" args="(struct mansession *s, const struct message *m)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int action_dahdidialoffhook </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="paramname"> <em>m</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l15289">15289</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="frame_8h_source.html#l00124">AST_FRAME_DTMF</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="manager_8c_source.html#l00897">astman_get_header()</a>, <a class="el" href="manager_8c_source.html#l01032">astman_send_ack()</a>, <a class="el" href="manager_8c_source.html#l01027">astman_send_error()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01544">dahdi_queue_frame()</a>, <a class="el" href="chan__dahdi_8c_source.html#l15201">find_channel()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00650">dahdi_pvt::owner</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l17308">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l15290"></a>15290 {
<a name="l15291"></a>15291    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *p = NULL;
<a name="l15292"></a>15292    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a> = <a class="code" href="group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556" title="Get header from mananger transaction.">astman_get_header</a>(m, <span class="stringliteral">&quot;DAHDIChannel&quot;</span>);
<a name="l15293"></a>15293    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structnumber.html" title="Number structure.">number</a> = <a class="code" href="group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556" title="Get header from mananger transaction.">astman_get_header</a>(m, <span class="stringliteral">&quot;Number&quot;</span>);
<a name="l15294"></a>15294    <span class="keywordtype">int</span> i;
<a name="l15295"></a>15295 
<a name="l15296"></a>15296    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(channel)) {
<a name="l15297"></a>15297       <a class="code" href="group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c" title="Send error in manager transaction.">astman_send_error</a>(s, m, <span class="stringliteral">&quot;No channel specified&quot;</span>);
<a name="l15298"></a>15298       <span class="keywordflow">return</span> 0;
<a name="l15299"></a>15299    }
<a name="l15300"></a>15300    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(number)) {
<a name="l15301"></a>15301       <a class="code" href="group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c" title="Send error in manager transaction.">astman_send_error</a>(s, m, <span class="stringliteral">&quot;No number specified&quot;</span>);
<a name="l15302"></a>15302       <span class="keywordflow">return</span> 0;
<a name="l15303"></a>15303    }
<a name="l15304"></a>15304    p = <a class="code" href="chan__dahdi_8c.html#a79906e057879b97581f8dbcede7ff036">find_channel</a>(atoi(channel));
<a name="l15305"></a>15305    <span class="keywordflow">if</span> (!p) {
<a name="l15306"></a>15306       <a class="code" href="group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c" title="Send error in manager transaction.">astman_send_error</a>(s, m, <span class="stringliteral">&quot;No such channel&quot;</span>);
<a name="l15307"></a>15307       <span class="keywordflow">return</span> 0;
<a name="l15308"></a>15308    }
<a name="l15309"></a>15309    <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l15310"></a>15310       <a class="code" href="group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c" title="Send error in manager transaction.">astman_send_error</a>(s, m, <span class="stringliteral">&quot;Channel does not have it&apos;s owner&quot;</span>);
<a name="l15311"></a>15311       <span class="keywordflow">return</span> 0;
<a name="l15312"></a>15312    }
<a name="l15313"></a>15313    <span class="keywordflow">for</span> (i = 0; i &lt; strlen(number); i++) {
<a name="l15314"></a>15314       <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> <a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a> = { <a class="code" href="frame_8h.html#a248afd6c02044259a386f6b7aee922a2">AST_FRAME_DTMF</a>, number[i] };
<a name="l15315"></a>15315       <a class="code" href="chan__dahdi_8c.html#a32da5905fb64086d5a6fcf534aabd47b">dahdi_queue_frame</a>(p, &amp;f, NULL);
<a name="l15316"></a>15316    }
<a name="l15317"></a>15317    <a class="code" href="group__Group__AMI.html#ga77315fa8e29950f0c88120501acda0a3" title="Send ack in manager transaction.">astman_send_ack</a>(s, m, <span class="stringliteral">&quot;DAHDIDialOffhook&quot;</span>);
<a name="l15318"></a>15318    <span class="keywordflow">return</span> 0;
<a name="l15319"></a>15319 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad0866f57abaf118be36f09ed96ccdf07"></a><!-- doxytag: member="chan_dahdi.c::action_dahdidndoff" ref="ad0866f57abaf118be36f09ed96ccdf07" args="(struct mansession *s, const struct message *m)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int action_dahdidndoff </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="paramname"> <em>m</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l15232">15232</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="manager_8c_source.html#l00897">astman_get_header()</a>, <a class="el" href="manager_8c_source.html#l01032">astman_send_ack()</a>, <a class="el" href="manager_8c_source.html#l01027">astman_send_error()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00749">dahdi_pvt::dnd</a>, and <a class="el" href="chan__dahdi_8c_source.html#l15201">find_channel()</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l17308">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l15233"></a>15233 {
<a name="l15234"></a>15234    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *p = NULL;
<a name="l15235"></a>15235    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a> = <a class="code" href="group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556" title="Get header from mananger transaction.">astman_get_header</a>(m, <span class="stringliteral">&quot;DAHDIChannel&quot;</span>);
<a name="l15236"></a>15236 
<a name="l15237"></a>15237    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(channel)) {
<a name="l15238"></a>15238       <a class="code" href="group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c" title="Send error in manager transaction.">astman_send_error</a>(s, m, <span class="stringliteral">&quot;No channel specified&quot;</span>);
<a name="l15239"></a>15239       <span class="keywordflow">return</span> 0;
<a name="l15240"></a>15240    }
<a name="l15241"></a>15241    p = <a class="code" href="chan__dahdi_8c.html#a79906e057879b97581f8dbcede7ff036">find_channel</a>(atoi(channel));
<a name="l15242"></a>15242    <span class="keywordflow">if</span> (!p) {
<a name="l15243"></a>15243       <a class="code" href="group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c" title="Send error in manager transaction.">astman_send_error</a>(s, m, <span class="stringliteral">&quot;No such channel&quot;</span>);
<a name="l15244"></a>15244       <span class="keywordflow">return</span> 0;
<a name="l15245"></a>15245    }
<a name="l15246"></a>15246    p-&gt;<a class="code" href="structdahdi__pvt.html#a1a8eeacca010367ea43120ef6ac08aa1" title="TRUE if Do-Not-Disturb is enabled.">dnd</a> = 0;
<a name="l15247"></a>15247    <a class="code" href="group__Group__AMI.html#ga77315fa8e29950f0c88120501acda0a3" title="Send ack in manager transaction.">astman_send_ack</a>(s, m, <span class="stringliteral">&quot;DND Disabled&quot;</span>);
<a name="l15248"></a>15248    <span class="keywordflow">return</span> 0;
<a name="l15249"></a>15249 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a91c68fb8703f9429fea494a96d638f0d"></a><!-- doxytag: member="chan_dahdi.c::action_dahdidndon" ref="a91c68fb8703f9429fea494a96d638f0d" args="(struct mansession *s, const struct message *m)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int action_dahdidndon </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="paramname"> <em>m</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l15213">15213</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="manager_8c_source.html#l00897">astman_get_header()</a>, <a class="el" href="manager_8c_source.html#l01032">astman_send_ack()</a>, <a class="el" href="manager_8c_source.html#l01027">astman_send_error()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00749">dahdi_pvt::dnd</a>, and <a class="el" href="chan__dahdi_8c_source.html#l15201">find_channel()</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l17308">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l15214"></a>15214 {
<a name="l15215"></a>15215    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *p = NULL;
<a name="l15216"></a>15216    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a> = <a class="code" href="group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556" title="Get header from mananger transaction.">astman_get_header</a>(m, <span class="stringliteral">&quot;DAHDIChannel&quot;</span>);
<a name="l15217"></a>15217 
<a name="l15218"></a>15218    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(channel)) {
<a name="l15219"></a>15219       <a class="code" href="group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c" title="Send error in manager transaction.">astman_send_error</a>(s, m, <span class="stringliteral">&quot;No channel specified&quot;</span>);
<a name="l15220"></a>15220       <span class="keywordflow">return</span> 0;
<a name="l15221"></a>15221    }
<a name="l15222"></a>15222    p = <a class="code" href="chan__dahdi_8c.html#a79906e057879b97581f8dbcede7ff036">find_channel</a>(atoi(channel));
<a name="l15223"></a>15223    <span class="keywordflow">if</span> (!p) {
<a name="l15224"></a>15224       <a class="code" href="group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c" title="Send error in manager transaction.">astman_send_error</a>(s, m, <span class="stringliteral">&quot;No such channel&quot;</span>);
<a name="l15225"></a>15225       <span class="keywordflow">return</span> 0;
<a name="l15226"></a>15226    }
<a name="l15227"></a>15227    p-&gt;<a class="code" href="structdahdi__pvt.html#a1a8eeacca010367ea43120ef6ac08aa1" title="TRUE if Do-Not-Disturb is enabled.">dnd</a> = 1;
<a name="l15228"></a>15228    <a class="code" href="group__Group__AMI.html#ga77315fa8e29950f0c88120501acda0a3" title="Send ack in manager transaction.">astman_send_ack</a>(s, m, <span class="stringliteral">&quot;DND Enabled&quot;</span>);
<a name="l15229"></a>15229    <span class="keywordflow">return</span> 0;
<a name="l15230"></a>15230 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="acc92e8b12c791b7815e25d5a8451208f"></a><!-- doxytag: member="chan_dahdi.c::action_dahdirestart" ref="acc92e8b12c791b7815e25d5a8451208f" args="(struct mansession *s, const struct message *m)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int action_dahdirestart </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="paramname"> <em>m</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l14475">14475</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="manager_8c_source.html#l01032">astman_send_ack()</a>, <a class="el" href="manager_8c_source.html#l01027">astman_send_error()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l14338">dahdi_restart()</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l17308">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l14476"></a>14476 {
<a name="l14477"></a>14477    <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#a738afcb4a2a9584043335b3279d1c1f7">dahdi_restart</a>() != 0) {
<a name="l14478"></a>14478       <a class="code" href="group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c" title="Send error in manager transaction.">astman_send_error</a>(s, m, <span class="stringliteral">&quot;Failed rereading DAHDI configuration&quot;</span>);
<a name="l14479"></a>14479       <span class="keywordflow">return</span> 1;
<a name="l14480"></a>14480    }
<a name="l14481"></a>14481    <a class="code" href="group__Group__AMI.html#ga77315fa8e29950f0c88120501acda0a3" title="Send ack in manager transaction.">astman_send_ack</a>(s, m, <span class="stringliteral">&quot;DAHDIRestart: Success&quot;</span>);
<a name="l14482"></a>14482    <span class="keywordflow">return</span> 0;
<a name="l14483"></a>14483 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9f7e1b7dfbfbc2a04b02e6bf9376fc6c"></a><!-- doxytag: member="chan_dahdi.c::action_dahdishowchannels" ref="a9f7e1b7dfbfbc2a04b02e6bf9376fc6c" args="(struct mansession *s, const struct message *m)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int action_dahdishowchannels </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="paramname"> <em>m</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l15321">15321</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="chan__dahdi_8c_source.html#l02379">alarm2str()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="manager_8c_source.html#l00969">astman_append()</a>, <a class="el" href="manager_8c_source.html#l00897">astman_get_header()</a>, <a class="el" href="manager_8c_source.html#l01032">astman_send_ack()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="chan__dahdi_8c_source.html#l00967">dahdi_pvt::context</a>, <a class="el" href="chan__dahdi_8c_source.html#l00749">dahdi_pvt::dnd</a>, <a class="el" href="chan__dahdi_8c_source.html#l05580">get_alarms()</a>, <a class="el" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>, <a class="el" href="chan__dahdi_8c_source.html#l00682">dahdi_pvt::next</a>, <a class="el" href="chan__dahdi_8c_source.html#l00650">dahdi_pvt::owner</a>, <a class="el" href="chan__dahdi_8c_source.html#l00666">dahdi_pvt::sig</a>, and <a class="el" href="chan__dahdi_8c_source.html#l02476">sig2str</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l17308">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l15322"></a>15322 {
<a name="l15323"></a>15323    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *tmp = NULL;
<a name="l15324"></a>15324    <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">id</span> = <a class="code" href="group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556" title="Get header from mananger transaction.">astman_get_header</a>(m, <span class="stringliteral">&quot;ActionID&quot;</span>);
<a name="l15325"></a>15325    <span class="keyword">const</span> <span class="keywordtype">char</span> *dahdichannel = <a class="code" href="group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556" title="Get header from mananger transaction.">astman_get_header</a>(m, <span class="stringliteral">&quot;DAHDIChannel&quot;</span>);
<a name="l15326"></a>15326    <span class="keywordtype">char</span> idText[256] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l15327"></a>15327    <span class="keywordtype">int</span> <a class="code" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> = 0;
<a name="l15328"></a>15328    <span class="keywordtype">int</span> dahdichanquery = -1;
<a name="l15329"></a>15329    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(dahdichannel)) {
<a name="l15330"></a>15330       dahdichanquery = atoi(dahdichannel);
<a name="l15331"></a>15331    }
<a name="l15332"></a>15332 
<a name="l15333"></a>15333    <a class="code" href="group__Group__AMI.html#ga77315fa8e29950f0c88120501acda0a3" title="Send ack in manager transaction.">astman_send_ack</a>(s, m, <span class="stringliteral">&quot;DAHDI channel status will follow&quot;</span>);
<a name="l15334"></a>15334    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<span class="keywordtype">id</span>))
<a name="l15335"></a>15335       snprintf(idText, <span class="keyword">sizeof</span>(idText), <span class="stringliteral">&quot;ActionID: %s\r\n&quot;</span>, <span class="keywordtype">id</span>);
<a name="l15336"></a>15336 
<a name="l15337"></a>15337    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;iflock);
<a name="l15338"></a>15338 
<a name="l15339"></a>15339    tmp = <a class="code" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>;
<a name="l15340"></a>15340    <span class="keywordflow">while</span> (tmp) {
<a name="l15341"></a>15341       <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a> &gt; 0) {
<a name="l15342"></a>15342          <span class="keywordtype">int</span> alm = <a class="code" href="chan__dahdi_8c.html#ace00362fe9640b8a792c965572a87826">get_alarms</a>(tmp);
<a name="l15343"></a>15343 
<a name="l15344"></a>15344          <span class="comment">/* If a specific channel is queried for, only deliver status for that channel */</span>
<a name="l15345"></a>15345          <span class="keywordflow">if</span> (dahdichanquery &gt; 0 &amp;&amp; tmp-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a> != dahdichanquery)
<a name="l15346"></a>15346             <span class="keywordflow">continue</span>;
<a name="l15347"></a>15347 
<a name="l15348"></a>15348          channels++;
<a name="l15349"></a>15349          <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l15350"></a>15350             <span class="comment">/* Add data if we have a current call */</span>
<a name="l15351"></a>15351             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s,
<a name="l15352"></a>15352                <span class="stringliteral">&quot;Event: DAHDIShowChannels\r\n&quot;</span>
<a name="l15353"></a>15353                <span class="stringliteral">&quot;DAHDIChannel: %d\r\n&quot;</span>
<a name="l15354"></a>15354                <span class="stringliteral">&quot;Channel: %s\r\n&quot;</span>
<a name="l15355"></a>15355                <span class="stringliteral">&quot;Uniqueid: %s\r\n&quot;</span>
<a name="l15356"></a>15356                <span class="stringliteral">&quot;AccountCode: %s\r\n&quot;</span>
<a name="l15357"></a>15357                <span class="stringliteral">&quot;Signalling: %s\r\n&quot;</span>
<a name="l15358"></a>15358                <span class="stringliteral">&quot;SignallingCode: %d\r\n&quot;</span>
<a name="l15359"></a>15359                <span class="stringliteral">&quot;Context: %s\r\n&quot;</span>
<a name="l15360"></a>15360                <span class="stringliteral">&quot;DND: %s\r\n&quot;</span>
<a name="l15361"></a>15361                <span class="stringliteral">&quot;Alarm: %s\r\n&quot;</span>
<a name="l15362"></a>15362                <span class="stringliteral">&quot;%s&quot;</span>
<a name="l15363"></a>15363                <span class="stringliteral">&quot;\r\n&quot;</span>,
<a name="l15364"></a>15364                tmp-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>,
<a name="l15365"></a>15365                tmp-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name,
<a name="l15366"></a>15366                tmp-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;uniqueid,
<a name="l15367"></a>15367                tmp-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;accountcode,
<a name="l15368"></a>15368                <a class="code" href="chan__dahdi_8c.html#ac36e4cc782493e37064405666f5e4fdd">sig2str</a>(tmp-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a>),
<a name="l15369"></a>15369                tmp-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a>,
<a name="l15370"></a>15370                tmp-&gt;<a class="code" href="structdahdi__pvt.html#ac25ea00ee3f082df06e0cf468cbde240" title="The configured context for incoming calls.">context</a>,
<a name="l15371"></a>15371                tmp-&gt;<a class="code" href="structdahdi__pvt.html#a1a8eeacca010367ea43120ef6ac08aa1" title="TRUE if Do-Not-Disturb is enabled.">dnd</a> ? <span class="stringliteral">&quot;Enabled&quot;</span> : <span class="stringliteral">&quot;Disabled&quot;</span>,
<a name="l15372"></a>15372                <a class="code" href="chan__dahdi_8c.html#a0277190f0a3d01afa3bab8e7bcd47892">alarm2str</a>(alm), idText);
<a name="l15373"></a>15373          } <span class="keywordflow">else</span> {
<a name="l15374"></a>15374             <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s,
<a name="l15375"></a>15375                <span class="stringliteral">&quot;Event: DAHDIShowChannels\r\n&quot;</span>
<a name="l15376"></a>15376                <span class="stringliteral">&quot;DAHDIChannel: %d\r\n&quot;</span>
<a name="l15377"></a>15377                <span class="stringliteral">&quot;Signalling: %s\r\n&quot;</span>
<a name="l15378"></a>15378                <span class="stringliteral">&quot;SignallingCode: %d\r\n&quot;</span>
<a name="l15379"></a>15379                <span class="stringliteral">&quot;Context: %s\r\n&quot;</span>
<a name="l15380"></a>15380                <span class="stringliteral">&quot;DND: %s\r\n&quot;</span>
<a name="l15381"></a>15381                <span class="stringliteral">&quot;Alarm: %s\r\n&quot;</span>
<a name="l15382"></a>15382                <span class="stringliteral">&quot;%s&quot;</span>
<a name="l15383"></a>15383                <span class="stringliteral">&quot;\r\n&quot;</span>,
<a name="l15384"></a>15384                tmp-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, <a class="code" href="chan__dahdi_8c.html#ac36e4cc782493e37064405666f5e4fdd">sig2str</a>(tmp-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a>), tmp-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a>,
<a name="l15385"></a>15385                tmp-&gt;<a class="code" href="structdahdi__pvt.html#ac25ea00ee3f082df06e0cf468cbde240" title="The configured context for incoming calls.">context</a>,
<a name="l15386"></a>15386                tmp-&gt;<a class="code" href="structdahdi__pvt.html#a1a8eeacca010367ea43120ef6ac08aa1" title="TRUE if Do-Not-Disturb is enabled.">dnd</a> ? <span class="stringliteral">&quot;Enabled&quot;</span> : <span class="stringliteral">&quot;Disabled&quot;</span>,
<a name="l15387"></a>15387                <a class="code" href="chan__dahdi_8c.html#a0277190f0a3d01afa3bab8e7bcd47892">alarm2str</a>(alm), idText);
<a name="l15388"></a>15388          }
<a name="l15389"></a>15389       }
<a name="l15390"></a>15390 
<a name="l15391"></a>15391       tmp = tmp-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>;
<a name="l15392"></a>15392    }
<a name="l15393"></a>15393 
<a name="l15394"></a>15394    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;iflock);
<a name="l15395"></a>15395 
<a name="l15396"></a>15396    <a class="code" href="group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s,
<a name="l15397"></a>15397       <span class="stringliteral">&quot;Event: DAHDIShowChannelsComplete\r\n&quot;</span>
<a name="l15398"></a>15398       <span class="stringliteral">&quot;%s&quot;</span>
<a name="l15399"></a>15399       <span class="stringliteral">&quot;Items: %d\r\n&quot;</span>
<a name="l15400"></a>15400       <span class="stringliteral">&quot;\r\n&quot;</span>,
<a name="l15401"></a>15401       idText,
<a name="l15402"></a>15402       channels);
<a name="l15403"></a>15403    <span class="keywordflow">return</span> 0;
<a name="l15404"></a>15404 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a742acb2daa27adb84742a69ce1f0c7e9"></a><!-- doxytag: member="chan_dahdi.c::action_transfer" ref="a742acb2daa27adb84742a69ce1f0c7e9" args="(struct mansession *s, const struct message *m)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int action_transfer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="paramname"> <em>m</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l15251">15251</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="manager_8c_source.html#l00897">astman_get_header()</a>, <a class="el" href="manager_8c_source.html#l01032">astman_send_ack()</a>, <a class="el" href="manager_8c_source.html#l01027">astman_send_error()</a>, <a class="el" href="chan__dahdi_8c_source.html#l15185">dahdi_fake_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l15201">find_channel()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l15182">TRANSFER</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l17308">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l15252"></a>15252 {
<a name="l15253"></a>15253    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *p = NULL;
<a name="l15254"></a>15254    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a> = <a class="code" href="group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556" title="Get header from mananger transaction.">astman_get_header</a>(m, <span class="stringliteral">&quot;DAHDIChannel&quot;</span>);
<a name="l15255"></a>15255 
<a name="l15256"></a>15256    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(channel)) {
<a name="l15257"></a>15257       <a class="code" href="group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c" title="Send error in manager transaction.">astman_send_error</a>(s, m, <span class="stringliteral">&quot;No channel specified&quot;</span>);
<a name="l15258"></a>15258       <span class="keywordflow">return</span> 0;
<a name="l15259"></a>15259    }
<a name="l15260"></a>15260    p = <a class="code" href="chan__dahdi_8c.html#a79906e057879b97581f8dbcede7ff036">find_channel</a>(atoi(channel));
<a name="l15261"></a>15261    <span class="keywordflow">if</span> (!p) {
<a name="l15262"></a>15262       <a class="code" href="group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c" title="Send error in manager transaction.">astman_send_error</a>(s, m, <span class="stringliteral">&quot;No such channel&quot;</span>);
<a name="l15263"></a>15263       <span class="keywordflow">return</span> 0;
<a name="l15264"></a>15264    }
<a name="l15265"></a>15265    <a class="code" href="chan__dahdi_8c.html#a5f1974e3b06695ea5cc87ff755bd2152">dahdi_fake_event</a>(p,<a class="code" href="chan__dahdi_8c.html#a3811374ead4311c8b04a85ae6dd7196b">TRANSFER</a>);
<a name="l15266"></a>15266    <a class="code" href="group__Group__AMI.html#ga77315fa8e29950f0c88120501acda0a3" title="Send ack in manager transaction.">astman_send_ack</a>(s, m, <span class="stringliteral">&quot;DAHDITransfer&quot;</span>);
<a name="l15267"></a>15267    <span class="keywordflow">return</span> 0;
<a name="l15268"></a>15268 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="afc56ae0d7123c24f867eafcaaa3743ea"></a><!-- doxytag: member="chan_dahdi.c::action_transferhangup" ref="afc56ae0d7123c24f867eafcaaa3743ea" args="(struct mansession *s, const struct message *m)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int action_transferhangup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structmansession.html">mansession</a> *&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structmessage.html">message</a> *&nbsp;</td>
          <td class="paramname"> <em>m</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l15270">15270</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="manager_8c_source.html#l00897">astman_get_header()</a>, <a class="el" href="manager_8c_source.html#l01032">astman_send_ack()</a>, <a class="el" href="manager_8c_source.html#l01027">astman_send_error()</a>, <a class="el" href="chan__dahdi_8c_source.html#l15185">dahdi_fake_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l15201">find_channel()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l15183">HANGUP</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l17308">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l15271"></a>15271 {
<a name="l15272"></a>15272    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *p = NULL;
<a name="l15273"></a>15273    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a> = <a class="code" href="group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556" title="Get header from mananger transaction.">astman_get_header</a>(m, <span class="stringliteral">&quot;DAHDIChannel&quot;</span>);
<a name="l15274"></a>15274 
<a name="l15275"></a>15275    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(channel)) {
<a name="l15276"></a>15276       <a class="code" href="group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c" title="Send error in manager transaction.">astman_send_error</a>(s, m, <span class="stringliteral">&quot;No channel specified&quot;</span>);
<a name="l15277"></a>15277       <span class="keywordflow">return</span> 0;
<a name="l15278"></a>15278    }
<a name="l15279"></a>15279    p = <a class="code" href="chan__dahdi_8c.html#a79906e057879b97581f8dbcede7ff036">find_channel</a>(atoi(channel));
<a name="l15280"></a>15280    <span class="keywordflow">if</span> (!p) {
<a name="l15281"></a>15281       <a class="code" href="group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c" title="Send error in manager transaction.">astman_send_error</a>(s, m, <span class="stringliteral">&quot;No such channel&quot;</span>);
<a name="l15282"></a>15282       <span class="keywordflow">return</span> 0;
<a name="l15283"></a>15283    }
<a name="l15284"></a>15284    <a class="code" href="chan__dahdi_8c.html#a5f1974e3b06695ea5cc87ff755bd2152">dahdi_fake_event</a>(p,<a class="code" href="chan__dahdi_8c.html#a096c3727950fc9aa70ca1b817dba1cf7">HANGUP</a>);
<a name="l15285"></a>15285    <a class="code" href="group__Group__AMI.html#ga77315fa8e29950f0c88120501acda0a3" title="Send ack in manager transaction.">astman_send_ack</a>(s, m, <span class="stringliteral">&quot;DAHDIHangup&quot;</span>);
<a name="l15286"></a>15286    <span class="keywordflow">return</span> 0;
<a name="l15287"></a>15287 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0277190f0a3d01afa3bab8e7bcd47892"></a><!-- doxytag: member="chan_dahdi.c::alarm2str" ref="a0277190f0a3d01afa3bab8e7bcd47892" args="(int alm)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* alarm2str </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>alm</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l02379">2379</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="chan__dahdi_8c.html#a018cba1c176ebc50102982fad2d404dc">alarms</a>, and <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l15321">action_dahdishowchannels()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l05688">handle_alarms()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02380"></a>02380 {
<a name="l02381"></a>02381    <span class="keywordtype">int</span> x;
<a name="l02382"></a>02382    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="chan__dahdi_8c.html#a018cba1c176ebc50102982fad2d404dc">alarms</a>); x++) {
<a name="l02383"></a>02383       <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#a018cba1c176ebc50102982fad2d404dc">alarms</a>[x].<a class="code" href="chan__dahdi_8c.html#a9e3b50e48c757ee5067da367f779839a">alarm</a> &amp; alm)
<a name="l02384"></a>02384          <span class="keywordflow">return</span> <a class="code" href="chan__dahdi_8c.html#a018cba1c176ebc50102982fad2d404dc">alarms</a>[x].name;
<a name="l02385"></a>02385    }
<a name="l02386"></a>02386    <span class="keywordflow">return</span> alm ? <span class="stringliteral">&quot;Unknown Alarm&quot;</span> : <span class="stringliteral">&quot;No Alarm&quot;</span>;
<a name="l02387"></a>02387 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8d921023bd460fd8278825f8f360f918"></a><!-- doxytag: member="chan_dahdi.c::alloc_sub" ref="a8d921023bd460fd8278825f8f360f918" args="(struct dahdi_pvt *p, int x)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int alloc_sub </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>x</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l02175">2175</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00662">dahdi_pvt::buf_no</a>, <a class="el" href="chan__dahdi_8c_source.html#l00663">dahdi_pvt::buf_policy</a>, <a class="el" href="chan__dahdi_8c_source.html#l00609">dahdi_subchannel::chan</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="chan__dahdi_8c_source.html#l02143">dahdi_close_sub()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02090">dahdi_open()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l10834">dahdi_request()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02176"></a>02176 {
<a name="l02177"></a>02177    <span class="keyword">struct </span>dahdi_bufferinfo bi;
<a name="l02178"></a>02178    <span class="keywordtype">int</span> res;
<a name="l02179"></a>02179    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[x].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a> &gt;= 0) {
<a name="l02180"></a>02180       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;%s subchannel of %d already in use\n&quot;</span>, <a class="code" href="chan__dahdi_8c.html#a1f86ec72c5397a22d1b0e29e47635f04">subnames</a>[x], p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l02181"></a>02181       <span class="keywordflow">return</span> -1;
<a name="l02182"></a>02182    }
<a name="l02183"></a>02183 
<a name="l02184"></a>02184    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[x].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a> = <a class="code" href="chan__dahdi_8c.html#a5be3d201f917ed02d9a08749cd673191">dahdi_open</a>(<span class="stringliteral">&quot;/dev/dahdi/pseudo&quot;</span>);
<a name="l02185"></a>02185    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[x].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a> &lt;= -1) {
<a name="l02186"></a>02186       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to open pseudo channel: %s\n&quot;</span>, strerror(errno));
<a name="l02187"></a>02187       <span class="keywordflow">return</span> -1;
<a name="l02188"></a>02188    }
<a name="l02189"></a>02189 
<a name="l02190"></a>02190    res = ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[x].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_GET_BUFINFO, &amp;bi);
<a name="l02191"></a>02191    <span class="keywordflow">if</span> (!res) {
<a name="l02192"></a>02192       bi.txbufpolicy = p-&gt;<a class="code" href="structdahdi__pvt.html#abfc3801c54ad9e430f5cdf383450a052">buf_policy</a>;
<a name="l02193"></a>02193       bi.rxbufpolicy = p-&gt;<a class="code" href="structdahdi__pvt.html#abfc3801c54ad9e430f5cdf383450a052">buf_policy</a>;
<a name="l02194"></a>02194       bi.numbufs = p-&gt;<a class="code" href="structdahdi__pvt.html#adb74dc4af40df4615bb5f05846cefc9d">buf_no</a>;
<a name="l02195"></a>02195       res = ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[x].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_SET_BUFINFO, &amp;bi);
<a name="l02196"></a>02196       <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l02197"></a>02197          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to set buffer policy on channel %d: %s\n&quot;</span>, x, strerror(errno));
<a name="l02198"></a>02198       }
<a name="l02199"></a>02199    } <span class="keywordflow">else</span>
<a name="l02200"></a>02200       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to check buffer policy on channel %d: %s\n&quot;</span>, x, strerror(errno));
<a name="l02201"></a>02201 
<a name="l02202"></a>02202    <span class="keywordflow">if</span> (ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[x].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_CHANNO, &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[x].<a class="code" href="structdahdi__subchannel.html#a029c258ce4f699b778c719cd0ef54d1b">chan</a>) == 1) {
<a name="l02203"></a>02203       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to get channel number for pseudo channel on FD %d: %s\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[x].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, strerror(errno));
<a name="l02204"></a>02204       <a class="code" href="chan__dahdi_8c.html#aa677933b22aeb7b907176d84357464c0">dahdi_close_sub</a>(p, x);
<a name="l02205"></a>02205       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[x].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a> = -1;
<a name="l02206"></a>02206       <span class="keywordflow">return</span> -1;
<a name="l02207"></a>02207    }
<a name="l02208"></a>02208    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Allocated %s subchannel on FD %d channel %d\n&quot;</span>, <a class="code" href="chan__dahdi_8c.html#a1f86ec72c5397a22d1b0e29e47635f04">subnames</a>[x], p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[x].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[x].<a class="code" href="structdahdi__subchannel.html#a029c258ce4f699b778c719cd0ef54d1b">chan</a>);
<a name="l02209"></a>02209    <span class="keywordflow">return</span> 0;
<a name="l02210"></a>02210 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad54718f35d51ea9e62be03de62077724"></a><!-- doxytag: member="chan_dahdi.c::AST_MODULE_INFO" ref="ad54718f35d51ea9e62be03de62077724" args="(ASTERISK_GPL_KEY, AST_MODFLAG_DEFAULT, tdesc,.load=load_module,.unload=unload_module,.reload=reload,)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">AST_MODULE_INFO </td>
          <td>(</td>
          <td class="paramtype">ASTERISK_GPL_KEY&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">AST_MODFLAG_DEFAULT&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="chan__usbradio_8c.html#a206197bcdc50090e511e22b33a2166a9">tdesc</a>&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">.&nbsp;</td>
          <td class="paramname"> <em>load</em> = <code>load_module</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">.&nbsp;</td>
          <td class="paramname"> <em>unload</em> = <code>unload_module</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">.&nbsp;</td>
          <td class="paramname"> <em>reload</em> = <code>reload</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ace10a3ad9bc673a5f3b1bb3c100ba644"></a><!-- doxytag: member="chan_dahdi.c::AST_MUTEX_DEFINE_STATIC" ref="ace10a3ad9bc673a5f3b1bb3c100ba644" args="(restart_lock)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">AST_MUTEX_DEFINE_STATIC </td>
          <td>(</td>
          <td class="paramtype">restart_lock&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a52fadbfaba2c70ca0d4b32cdd7c16a1c"></a><!-- doxytag: member="chan_dahdi.c::AST_MUTEX_DEFINE_STATIC" ref="a52fadbfaba2c70ca0d4b32cdd7c16a1c" args="(ss_thread_lock)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">AST_MUTEX_DEFINE_STATIC </td>
          <td>(</td>
          <td class="paramtype">ss_thread_lock&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a381db14ebde360ab4092e0c7ab18579d"></a><!-- doxytag: member="chan_dahdi.c::AST_MUTEX_DEFINE_STATIC" ref="a381db14ebde360ab4092e0c7ab18579d" args="(monlock)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">AST_MUTEX_DEFINE_STATIC </td>
          <td>(</td>
          <td class="paramtype">monlock&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Protect the monitoring thread, so only one process can kill or start it, and not when it's doing something critical. </p>

</div>
</div>
<a class="anchor" id="a8a540d6c5362c0966c0c929270f046b7"></a><!-- doxytag: member="chan_dahdi.c::AST_MUTEX_DEFINE_STATIC" ref="a8a540d6c5362c0966c0c929270f046b7" args="(iflock)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">AST_MUTEX_DEFINE_STATIC </td>
          <td>(</td>
          <td class="paramtype">iflock&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Protect the interface list (of dahdi_pvt's). </p>

</div>
</div>
<a class="anchor" id="a4119ca9de19a055b1db3bb27bc8f589a"></a><!-- doxytag: member="chan_dahdi.c::attempt_transfer" ref="a4119ca9de19a055b1db3bb27bc8f589a" args="(struct dahdi_pvt *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int attempt_transfer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l05502">5502</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00462">ast_channel::_softhangup</a>, <a class="el" href="channel_8h_source.html#l00469">ast_channel::_state</a>, <a class="el" href="channel_8c_source.html#l04733">ast_bridged_channel()</a>, <a class="el" href="channel_8c_source.html#l04217">ast_channel_masquerade()</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="frame_8h_source.html#l00300">AST_CONTROL_RINGING</a>, <a class="el" href="frame_8h_source.html#l00314">AST_CONTROL_UNHOLD</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="channel_8c_source.html#l03110">ast_indicate()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8c_source.html#l01123">ast_queue_control()</a>, <a class="el" href="channel_8h_source.html#l00633">AST_SOFTHANGUP_DEV</a>, <a class="el" href="channel_8h_source.html#l00363">AST_STATE_RING</a>, <a class="el" href="channel_8h_source.html#l00364">AST_STATE_RINGING</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__dahdi_8c_source.html#l00608">dahdi_subchannel::owner</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, <a class="el" href="chan__dahdi_8c_source.html#l00581">SUB_THREEWAY</a>, <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>, <a class="el" href="chan__dahdi_8c_source.html#l02062">swap_subs()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l02212">unalloc_sub()</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05503"></a>05503 {
<a name="l05504"></a>05504    <span class="comment">/* In order to transfer, we need at least one of the channels to</span>
<a name="l05505"></a>05505 <span class="comment">      actually be in a call bridge.  We can&apos;t conference two applications</span>
<a name="l05506"></a>05506 <span class="comment">      together (but then, why would we want to?) */</span>
<a name="l05507"></a>05507    <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)) {
<a name="l05508"></a>05508       <span class="comment">/* The three-way person we&apos;re about to transfer to could still be in MOH, so</span>
<a name="l05509"></a>05509 <span class="comment">         stop if now if appropriate */</span>
<a name="l05510"></a>05510       <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>))
<a name="l05511"></a>05511          <a class="code" href="channel_8h.html#a60f9d2b0ab8b7a839902313321163b28" title="Queue a control frame with payload.">ast_queue_control</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a3e7629b5f7e39f1cc8ad2e51e266f91e">AST_CONTROL_UNHOLD</a>);
<a name="l05512"></a>05512       <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa">AST_STATE_RINGING</a>) {
<a name="l05513"></a>05513          <a class="code" href="channel_8h.html#aef2af15a597c948e97628da6c5c84f28" title="Indicates condition of channel.">ast_indicate</a>(<a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>), <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa5814e690c23b590bcd4eb43535907a1">AST_CONTROL_RINGING</a>);
<a name="l05514"></a>05514       }
<a name="l05515"></a>05515       <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a>) {
<a name="l05516"></a>05516          tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_RINGTONE);
<a name="l05517"></a>05517       }
<a name="l05518"></a>05518        <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a84fa04f019436467dc17f9bdd5341dce" title="Weird function made for call transfers.">ast_channel_masquerade</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>))) {
<a name="l05519"></a>05519          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to masquerade %s as %s\n&quot;</span>,
<a name="l05520"></a>05520                <a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)-&gt;name, p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name);
<a name="l05521"></a>05521          <span class="keywordflow">return</span> -1;
<a name="l05522"></a>05522       }
<a name="l05523"></a>05523       <span class="comment">/* Orphan the channel after releasing the lock */</span>
<a name="l05524"></a>05524       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l05525"></a>05525       <a class="code" href="chan__dahdi_8c.html#a164404a295fbba4f9d3c2c6cf123468f">unalloc_sub</a>(p, <a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>);
<a name="l05526"></a>05526    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)) {
<a name="l05527"></a>05527       <a class="code" href="channel_8h.html#a60f9d2b0ab8b7a839902313321163b28" title="Queue a control frame with payload.">ast_queue_control</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a3e7629b5f7e39f1cc8ad2e51e266f91e">AST_CONTROL_UNHOLD</a>);
<a name="l05528"></a>05528       <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa">AST_STATE_RINGING</a>) {
<a name="l05529"></a>05529          <a class="code" href="channel_8h.html#aef2af15a597c948e97628da6c5c84f28" title="Indicates condition of channel.">ast_indicate</a>(<a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>), <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa5814e690c23b590bcd4eb43535907a1">AST_CONTROL_RINGING</a>);
<a name="l05530"></a>05530       }
<a name="l05531"></a>05531       <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a>) {
<a name="l05532"></a>05532          tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_RINGTONE);
<a name="l05533"></a>05533       }
<a name="l05534"></a>05534       <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a84fa04f019436467dc17f9bdd5341dce" title="Weird function made for call transfers.">ast_channel_masquerade</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>))) {
<a name="l05535"></a>05535          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to masquerade %s as %s\n&quot;</span>,
<a name="l05536"></a>05536                <a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)-&gt;name, p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name);
<a name="l05537"></a>05537          <span class="keywordflow">return</span> -1;
<a name="l05538"></a>05538       }
<a name="l05539"></a>05539       <span class="comment">/* Three-way is now the REAL */</span>
<a name="l05540"></a>05540       <a class="code" href="chan__dahdi_8c.html#aaa6e6b7fe5725465004d3fabf351620e">swap_subs</a>(p, <a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>, <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>);
<a name="l05541"></a>05541       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l05542"></a>05542       <a class="code" href="chan__dahdi_8c.html#a164404a295fbba4f9d3c2c6cf123468f">unalloc_sub</a>(p, <a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>);
<a name="l05543"></a>05543       <span class="comment">/* Tell the caller not to hangup */</span>
<a name="l05544"></a>05544       <span class="keywordflow">return</span> 1;
<a name="l05545"></a>05545    } <span class="keywordflow">else</span> {
<a name="l05546"></a>05546       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Neither %s nor %s are in a bridge, nothing to transfer\n&quot;</span>,
<a name="l05547"></a>05547          p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name, p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name);
<a name="l05548"></a>05548       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#a7386ba9cc89b0b446f553a4d0f36576a">_softhangup</a> |= <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709a2e185ce313026e13ed90ae3a319c9cb7">AST_SOFTHANGUP_DEV</a>;
<a name="l05549"></a>05549       <span class="keywordflow">return</span> -1;
<a name="l05550"></a>05550    }
<a name="l05551"></a>05551    <span class="keywordflow">return</span> 0;
<a name="l05552"></a>05552 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a305c0e17a1db304e7e5d0a4c39e5d9a4"></a><!-- doxytag: member="chan_dahdi.c::available" ref="a305c0e17a1db304e7e5d0a4c39e5d9a4" args="(struct dahdi_pvt *p, int channelmatch, ast_group_t groupmatch, int *busy, int *channelmatched, int *groupmatched)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int available </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>channelmatch</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="channel_8h.html#a641d81d0c5c8df99d43eff69aede3bfd">ast_group_t</a>&nbsp;</td>
          <td class="paramname"> <em>groupmatch</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>busy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>channelmatched</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>groupmatched</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l10640">10640</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00469">ast_channel::_state</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8h_source.html#l00364">AST_STATE_RINGING</a>, <a class="el" href="channel_8h_source.html#l00365">AST_STATE_UP</a>, <a class="el" href="chan__dahdi_8c_source.html#l00716">dahdi_pvt::callwaiting</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="chan__dahdi_8c_source.html#l00749">dahdi_pvt::dnd</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="chan__dahdi_8c_source.html#l01020">dahdi_pvt::group</a>, <a class="el" href="chan__dahdi_8c_source.html#l01043">dahdi_pvt::guardtime</a>, <a class="el" href="chan__dahdi_8c_source.html#l00621">dahdi_subchannel::inthreeway</a>, <a class="el" href="chan__dahdi_8c_source.html#l00912">dahdi_pvt::locallyblocked</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__dahdi_8c_source.html#l00673">dahdi_pvt::oprmode</a>, <a class="el" href="chan__dahdi_8c_source.html#l00801">dahdi_pvt::outgoing</a>, <a class="el" href="chan__dahdi_8c_source.html#l00608">dahdi_subchannel::owner</a>, <a class="el" href="chan__dahdi_8c_source.html#l00650">dahdi_pvt::owner</a>, <a class="el" href="chan__dahdi_8c_source.html#l00671">dahdi_pvt::radio</a>, <a class="el" href="chan__dahdi_8c_source.html#l00917">dahdi_pvt::remotelyblocked</a>, <a class="el" href="chan__dahdi_8c_source.html#l00666">dahdi_pvt::sig</a>, <a class="el" href="chan__dahdi_8c_source.html#l00253">SIG_FXOGS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00254">SIG_FXOKS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00252">SIG_FXOLS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00250">SIG_FXSGS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00251">SIG_FXSKS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00249">SIG_FXSLS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00580">SUB_CALLWAIT</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, <a class="el" href="chan__dahdi_8c_source.html#l00581">SUB_THREEWAY</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>.</p>

<p>Referenced by <a class="el" href="utils_8c_source.html#l01618">__ast_string_field_ptr_build_va()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l10834">dahdi_request()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l10641"></a>10641 {
<a name="l10642"></a>10642    <span class="keywordtype">int</span> res;
<a name="l10643"></a>10643    <span class="keyword">struct </span>dahdi_params par;
<a name="l10644"></a>10644 
<a name="l10645"></a>10645    <span class="comment">/* First, check group matching */</span>
<a name="l10646"></a>10646    <span class="keywordflow">if</span> (groupmatch) {
<a name="l10647"></a>10647       <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structdahdi__pvt.html#a2f66424184fe1873f7b46b19de589b57" title="Bitmapped groups this belongs to.">group</a> &amp; groupmatch) != groupmatch)
<a name="l10648"></a>10648          <span class="keywordflow">return</span> 0;
<a name="l10649"></a>10649       *groupmatched = 1;
<a name="l10650"></a>10650    }
<a name="l10651"></a>10651    <span class="comment">/* Check to see if we have a channel match */</span>
<a name="l10652"></a>10652    <span class="keywordflow">if</span> (channelmatch != -1) {
<a name="l10653"></a>10653       <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a> != channelmatch)
<a name="l10654"></a>10654          <span class="keywordflow">return</span> 0;
<a name="l10655"></a>10655       *channelmatched = 1;
<a name="l10656"></a>10656    }
<a name="l10657"></a>10657    <span class="comment">/* We&apos;re at least busy at this point */</span>
<a name="l10658"></a>10658    <span class="keywordflow">if</span> (busy) {
<a name="l10659"></a>10659       <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#a7c9b3bb8225896ff2b9aed27e6f80f10">SIG_FXOKS</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#adb40571aa5ff846fc334be5260eab257">SIG_FXOLS</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#a3dcffbaf4a26f2b7b792998df1eea27b">SIG_FXOGS</a>))
<a name="l10660"></a>10660          *busy = 1;
<a name="l10661"></a>10661    }
<a name="l10662"></a>10662    <span class="comment">/* If do not disturb, definitely not */</span>
<a name="l10663"></a>10663    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a1a8eeacca010367ea43120ef6ac08aa1" title="TRUE if Do-Not-Disturb is enabled.">dnd</a>)
<a name="l10664"></a>10664       <span class="keywordflow">return</span> 0;
<a name="l10665"></a>10665    <span class="comment">/* If guard time, definitely not */</span>
<a name="l10666"></a>10666    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a7a65a90f21ccf71e78b99dceb614afa9">guardtime</a> &amp;&amp; (time(NULL) &lt; p-&gt;<a class="code" href="structdahdi__pvt.html#a7a65a90f21ccf71e78b99dceb614afa9">guardtime</a>))
<a name="l10667"></a>10667       <span class="keywordflow">return</span> 0;
<a name="l10668"></a>10668 
<a name="l10669"></a>10669    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a513c772067fc245b524b1e46a0987ec0" title="TRUE if the channel is locally blocked.">locallyblocked</a> || p-&gt;<a class="code" href="structdahdi__pvt.html#a857733a6d05c0eda6d4b5122e1e4d3bc" title="TRUE if the channel is remotely blocked.">remotelyblocked</a>)
<a name="l10670"></a>10670       <span class="keywordflow">return</span> 0;
<a name="l10671"></a>10671 
<a name="l10672"></a>10672    <span class="comment">/* If no owner definitely available */</span>
<a name="l10673"></a>10673    <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l10674"></a>10674 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l10675"></a>10675 <span class="preprocessor"></span>      <span class="comment">/* Trust PRI */</span>
<a name="l10676"></a>10676       <span class="keywordflow">if</span> (p-&gt;pri) {
<a name="l10677"></a>10677          <span class="keywordflow">if</span> (p-&gt;resetting || p-&gt;call)
<a name="l10678"></a>10678             <span class="keywordflow">return</span> 0;
<a name="l10679"></a>10679          <span class="keywordflow">else</span>
<a name="l10680"></a>10680             <span class="keywordflow">return</span> 1;
<a name="l10681"></a>10681       }
<a name="l10682"></a>10682 <span class="preprocessor">#endif</span>
<a name="l10683"></a>10683 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_SS7</span>
<a name="l10684"></a>10684 <span class="preprocessor"></span>      <span class="comment">/* Trust SS7 */</span>
<a name="l10685"></a>10685       <span class="keywordflow">if</span> (p-&gt;ss7) {
<a name="l10686"></a>10686          <span class="keywordflow">if</span> (p-&gt;ss7call)
<a name="l10687"></a>10687             <span class="keywordflow">return</span> 0;
<a name="l10688"></a>10688          <span class="keywordflow">else</span>
<a name="l10689"></a>10689             <span class="keywordflow">return</span> 1;
<a name="l10690"></a>10690       }
<a name="l10691"></a>10691 <span class="preprocessor">#endif</span>
<a name="l10692"></a>10692 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_OPENR2</span>
<a name="l10693"></a>10693 <span class="preprocessor"></span>      <span class="comment">/* Trust MFC/R2 */</span>
<a name="l10694"></a>10694       <span class="keywordflow">if</span> (p-&gt;mfcr2) {
<a name="l10695"></a>10695          <span class="keywordflow">if</span> (p-&gt;mfcr2call)
<a name="l10696"></a>10696             <span class="keywordflow">return</span> 0;
<a name="l10697"></a>10697          <span class="keywordflow">else</span>
<a name="l10698"></a>10698             <span class="keywordflow">return</span> 1;
<a name="l10699"></a>10699       }
<a name="l10700"></a>10700 <span class="preprocessor">#endif</span>
<a name="l10701"></a>10701 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (!(p-&gt;<a class="code" href="structdahdi__pvt.html#ac53b42243ee40edc74b615fe86806fe3" title="Nonzero if the signaling type is sent over a radio.">radio</a> || (p-&gt;<a class="code" href="structdahdi__pvt.html#a3b3cefe7a33d0cff61f3a2b5955b6c8b">oprmode</a> &lt; 0)))
<a name="l10702"></a>10702       {
<a name="l10703"></a>10703          <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#a1dc50a07aef86c90ab94f1583c35a265">SIG_FXSLS</a>))
<a name="l10704"></a>10704             <span class="keywordflow">return</span> 1;
<a name="l10705"></a>10705          <span class="comment">/* Check hook state */</span>
<a name="l10706"></a>10706          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a> &gt; -1) {
<a name="l10707"></a>10707             memset(&amp;par, 0, <span class="keyword">sizeof</span>(par));
<a name="l10708"></a>10708             res = ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_GET_PARAMS, &amp;par);
<a name="l10709"></a>10709          } <span class="keywordflow">else</span> {
<a name="l10710"></a>10710             <span class="comment">/* Assume not off hook on CVRS */</span>
<a name="l10711"></a>10711             res = 0;
<a name="l10712"></a>10712             par.rxisoffhook = 0;
<a name="l10713"></a>10713          }
<a name="l10714"></a>10714          <span class="keywordflow">if</span> (res) {
<a name="l10715"></a>10715             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to check hook state on channel %d: %s\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, strerror(errno));
<a name="l10716"></a>10716          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#a38139ec369c0243f4324eb4eb0c2f004">SIG_FXSKS</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#a97e4c6fb4680984aafc6e0e55a2b6cb4">SIG_FXSGS</a>)) {
<a name="l10717"></a>10717             <span class="comment">/* When &quot;onhook&quot; that means no battery on the line, and thus</span>
<a name="l10718"></a>10718 <span class="comment">              it is out of service..., if it&apos;s on a TDM card... If it&apos;s a channel</span>
<a name="l10719"></a>10719 <span class="comment">              bank, there is no telling... */</span>
<a name="l10720"></a>10720             <span class="keywordflow">if</span> (par.rxbits &gt; -1)
<a name="l10721"></a>10721                <span class="keywordflow">return</span> 1;
<a name="l10722"></a>10722             <span class="keywordflow">if</span> (par.rxisoffhook)
<a name="l10723"></a>10723                <span class="keywordflow">return</span> 1;
<a name="l10724"></a>10724             <span class="keywordflow">else</span>
<a name="l10725"></a>10725                <span class="keywordflow">return</span> 0;
<a name="l10726"></a>10726          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (par.rxisoffhook) {
<a name="l10727"></a>10727             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Channel %d off hook, can&apos;t use\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l10728"></a>10728             <span class="comment">/* Not available when the other end is off hook */</span>
<a name="l10729"></a>10729 <span class="preprocessor">#ifdef DAHDI_CHECK_HOOKSTATE</span>
<a name="l10730"></a>10730 <span class="preprocessor"></span>            <span class="keywordflow">return</span> 0;
<a name="l10731"></a>10731 <span class="preprocessor">#else</span>
<a name="l10732"></a>10732 <span class="preprocessor"></span>            <span class="keywordflow">return</span> 1;
<a name="l10733"></a>10733 <span class="preprocessor">#endif</span>
<a name="l10734"></a>10734 <span class="preprocessor"></span>         }
<a name="l10735"></a>10735       }
<a name="l10736"></a>10736       <span class="keywordflow">return</span> 1;
<a name="l10737"></a>10737    }
<a name="l10738"></a>10738 
<a name="l10739"></a>10739    <span class="comment">/* If it&apos;s not an FXO, forget about call wait */</span>
<a name="l10740"></a>10740    <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> != <a class="code" href="chan__dahdi_8c.html#a7c9b3bb8225896ff2b9aed27e6f80f10">SIG_FXOKS</a>) &amp;&amp; (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> != <a class="code" href="chan__dahdi_8c.html#adb40571aa5ff846fc334be5260eab257">SIG_FXOLS</a>) &amp;&amp; (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> != <a class="code" href="chan__dahdi_8c.html#a3dcffbaf4a26f2b7b792998df1eea27b">SIG_FXOGS</a>))
<a name="l10741"></a>10741       <span class="keywordflow">return</span> 0;
<a name="l10742"></a>10742 
<a name="l10743"></a>10743    <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="structdahdi__pvt.html#a76742560de0554db5b0b59591ba93adc" title="TRUE if busy extensions will hear the call-waiting tone and can use hook-flash to...">callwaiting</a>) {
<a name="l10744"></a>10744       <span class="comment">/* If they don&apos;t have call waiting enabled, then for sure they&apos;re unavailable at this point */</span>
<a name="l10745"></a>10745       <span class="keywordflow">return</span> 0;
<a name="l10746"></a>10746    }
<a name="l10747"></a>10747 
<a name="l10748"></a>10748    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a> &gt; -1) {
<a name="l10749"></a>10749       <span class="comment">/* If there is already a call waiting call, then we can&apos;t take a second one */</span>
<a name="l10750"></a>10750       <span class="keywordflow">return</span> 0;
<a name="l10751"></a>10751    }
<a name="l10752"></a>10752 
<a name="l10753"></a>10753    <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>) &amp;&amp;
<a name="l10754"></a>10754       ((p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa">AST_STATE_RINGING</a>) || p-&gt;<a class="code" href="structdahdi__pvt.html#a40668dcb7d940b80c4f109861059a978" title="TRUE if we originated the call leg.">outgoing</a>)) {
<a name="l10755"></a>10755       <span class="comment">/* If the current call is not up, then don&apos;t allow the call */</span>
<a name="l10756"></a>10756       <span class="keywordflow">return</span> 0;
<a name="l10757"></a>10757    }
<a name="l10758"></a>10758    <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) &amp;&amp; (!p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a>)) {
<a name="l10759"></a>10759       <span class="comment">/* Can&apos;t take a call wait when the three way calling hasn&apos;t been merged yet. */</span>
<a name="l10760"></a>10760       <span class="keywordflow">return</span> 0;
<a name="l10761"></a>10761    }
<a name="l10762"></a>10762    <span class="comment">/* We&apos;re cool */</span>
<a name="l10763"></a>10763    <span class="keywordflow">return</span> 1;
<a name="l10764"></a>10764 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a00c626d9ce33144ed09b620b14afe56d"></a><!-- doxytag: member="chan_dahdi.c::build_channels" ref="a00c626d9ce33144ed09b620b14afe56d" args="(struct dahdi_chan_conf *conf, int iscrv, const char *value, int reload, int lineno, int *found_pseudo)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int build_channels </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__chan__conf.html">dahdi_chan_conf</a> *&nbsp;</td>
          <td class="paramname"> <em>conf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>iscrv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>reload</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>lineno</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>found_pseudo</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l15948">15948</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="chan__dahdi_8c_source.html#l01243">dahdi_chan_conf::chan</a>, <a class="el" href="chan__dahdi_8c_source.html#l00277">CHAN_PSEUDO</a>, <a class="el" href="chan__dahdi_8c_source.html#l01256">dahdi_chan_conf::is_sig_auto</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00666">dahdi_pvt::sig</a>, <a class="el" href="chan__dahdi_8c_source.html#l02476">sig2str</a>, and <a class="el" href="agi_2strcompat_8c_source.html#l00027">strsep()</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l15949"></a>15949 {
<a name="l15950"></a>15950    <span class="keywordtype">char</span> *c, *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>;
<a name="l15951"></a>15951    <span class="keywordtype">int</span> x, start, finish;
<a name="l15952"></a>15952    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *tmp;
<a name="l15953"></a>15953 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l15954"></a>15954 <span class="preprocessor"></span>   <span class="keyword">struct </span>dahdi_pri *pri;
<a name="l15955"></a>15955    <span class="keywordtype">int</span> trunkgroup, y;
<a name="l15956"></a>15956 <span class="preprocessor">#endif</span>
<a name="l15957"></a>15957 <span class="preprocessor"></span>
<a name="l15958"></a>15958    <span class="keywordflow">if</span> ((<a class="code" href="chan__dahdi_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a> == 0) &amp;&amp; (conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> &lt; 0) &amp;&amp; !conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a26ed3f8f070e4f51214b5370ad43d650">is_sig_auto</a>) {
<a name="l15959"></a>15959       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Signalling must be specified before any channels are.\n&quot;</span>);
<a name="l15960"></a>15960       <span class="keywordflow">return</span> -1;
<a name="l15961"></a>15961    }
<a name="l15962"></a>15962 
<a name="l15963"></a>15963    c = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(value);
<a name="l15964"></a>15964 
<a name="l15965"></a>15965 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l15966"></a>15966 <span class="preprocessor"></span>   pri = NULL;
<a name="l15967"></a>15967    <span class="keywordflow">if</span> (iscrv) {
<a name="l15968"></a>15968       <span class="keywordflow">if</span> (sscanf(c, <span class="stringliteral">&quot;%30d:%n&quot;</span>, &amp;trunkgroup, &amp;y) != 1) {
<a name="l15969"></a>15969          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;CRV must begin with trunkgroup followed by a colon at line %d.\n&quot;</span>, lineno);
<a name="l15970"></a>15970          <span class="keywordflow">return</span> -1;
<a name="l15971"></a>15971       }
<a name="l15972"></a>15972       <span class="keywordflow">if</span> (trunkgroup &lt; 1) {
<a name="l15973"></a>15973          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;CRV trunk group must be a positive number at line %d.\n&quot;</span>, lineno);
<a name="l15974"></a>15974          <span class="keywordflow">return</span> -1;
<a name="l15975"></a>15975       }
<a name="l15976"></a>15976       c += y;
<a name="l15977"></a>15977       <span class="keywordflow">for</span> (y = 0; y &lt; <a class="code" href="chan__dahdi_8c.html#a80bfdd8adbffe226265cd729655a7268">NUM_SPANS</a>; y++) {
<a name="l15978"></a>15978          <span class="keywordflow">if</span> (pris[y].trunkgroup == trunkgroup) {
<a name="l15979"></a>15979             pri = pris + y;
<a name="l15980"></a>15980             <span class="keywordflow">break</span>;
<a name="l15981"></a>15981          }
<a name="l15982"></a>15982       }
<a name="l15983"></a>15983       <span class="keywordflow">if</span> (!pri) {
<a name="l15984"></a>15984          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No such trunk group %d at CRV declaration at line %d.\n&quot;</span>, trunkgroup, lineno);
<a name="l15985"></a>15985          <span class="keywordflow">return</span> -1;
<a name="l15986"></a>15986       }
<a name="l15987"></a>15987    }
<a name="l15988"></a>15988 <span class="preprocessor">#endif</span>
<a name="l15989"></a>15989 <span class="preprocessor"></span>
<a name="l15990"></a>15990    <span class="keywordflow">while</span> ((chan = <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;c, <span class="stringliteral">&quot;,&quot;</span>))) {
<a name="l15991"></a>15991       <span class="keywordflow">if</span> (sscanf(chan, <span class="stringliteral">&quot;%30d-%30d&quot;</span>, &amp;start, &amp;finish) == 2) {
<a name="l15992"></a>15992          <span class="comment">/* Range */</span>
<a name="l15993"></a>15993       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sscanf(chan, <span class="stringliteral">&quot;%30d&quot;</span>, &amp;start)) {
<a name="l15994"></a>15994          <span class="comment">/* Just one */</span>
<a name="l15995"></a>15995          finish = start;
<a name="l15996"></a>15996       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(chan, <span class="stringliteral">&quot;pseudo&quot;</span>)) {
<a name="l15997"></a>15997          finish = start = <a class="code" href="chan__dahdi_8c.html#ada02a3fa3d2da06560df664c7228a559">CHAN_PSEUDO</a>;
<a name="l15998"></a>15998          <span class="keywordflow">if</span> (found_pseudo)
<a name="l15999"></a>15999             *found_pseudo = 1;
<a name="l16000"></a>16000       } <span class="keywordflow">else</span> {
<a name="l16001"></a>16001          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Syntax error parsing &apos;%s&apos; at &apos;%s&apos;\n&quot;</span>, value, chan);
<a name="l16002"></a>16002          <span class="keywordflow">return</span> -1;
<a name="l16003"></a>16003       }
<a name="l16004"></a>16004       <span class="keywordflow">if</span> (finish &lt; start) {
<a name="l16005"></a>16005          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Sillyness: %d &lt; %d\n&quot;</span>, start, finish);
<a name="l16006"></a>16006          x = finish;
<a name="l16007"></a>16007          finish = start;
<a name="l16008"></a>16008          start = x;
<a name="l16009"></a>16009       }
<a name="l16010"></a>16010 
<a name="l16011"></a>16011       <span class="keywordflow">for</span> (x = start; x &lt;= finish; x++) {
<a name="l16012"></a>16012 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l16013"></a>16013 <span class="preprocessor"></span>         tmp = <a class="code" href="chan__dahdi_8c.html#aa7f4f5b8e2e3a682de5734874521d060">mkintf</a>(x, conf, pri, <a class="code" href="chan__dahdi_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a>);
<a name="l16014"></a>16014 <span class="preprocessor">#else</span>
<a name="l16015"></a>16015 <span class="preprocessor"></span>         tmp = <a class="code" href="chan__dahdi_8c.html#aa7f4f5b8e2e3a682de5734874521d060">mkintf</a>(x, conf, NULL, <a class="code" href="chan__dahdi_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a>);
<a name="l16016"></a>16016 <span class="preprocessor">#endif</span>
<a name="l16017"></a>16017 <span class="preprocessor"></span>
<a name="l16018"></a>16018          <span class="keywordflow">if</span> (tmp) {
<a name="l16019"></a>16019 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l16020"></a>16020 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (pri)
<a name="l16021"></a>16021                <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;%s CRV %d:%d, %s signalling\n&quot;</span>, <a class="code" href="chan__dahdi_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a> ? <span class="stringliteral">&quot;Reconfigured&quot;</span> : <span class="stringliteral">&quot;Registered&quot;</span>, trunkgroup, x, <a class="code" href="chan__dahdi_8c.html#ac36e4cc782493e37064405666f5e4fdd">sig2str</a>(tmp-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a>));
<a name="l16022"></a>16022             <span class="keywordflow">else</span>
<a name="l16023"></a>16023 <span class="preprocessor">#endif</span>
<a name="l16024"></a>16024 <span class="preprocessor"></span>               <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;%s channel %d, %s signalling\n&quot;</span>, <a class="code" href="chan__dahdi_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a> ? <span class="stringliteral">&quot;Reconfigured&quot;</span> : <span class="stringliteral">&quot;Registered&quot;</span>, x, <a class="code" href="chan__dahdi_8c.html#ac36e4cc782493e37064405666f5e4fdd">sig2str</a>(tmp-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a>));
<a name="l16025"></a>16025          } <span class="keywordflow">else</span> {
<a name="l16026"></a>16026             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to %s channel &apos;%s&apos;\n&quot;</span>,
<a name="l16027"></a>16027                (<a class="code" href="chan__dahdi_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a> == 1) ? <span class="stringliteral">&quot;reconfigure&quot;</span> : <span class="stringliteral">&quot;register&quot;</span>, value);
<a name="l16028"></a>16028             <span class="keywordflow">return</span> -1;
<a name="l16029"></a>16029          }
<a name="l16030"></a>16030       }
<a name="l16031"></a>16031    }
<a name="l16032"></a>16032 
<a name="l16033"></a>16033    <span class="keywordflow">return</span> 0;
<a name="l16034"></a>16034 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a74f7e3c2c3944147a9ae2d1f6aceb71e"></a><!-- doxytag: member="chan_dahdi.c::bump_gains" ref="a74f7e3c2c3944147a9ae2d1f6aceb71e" args="(struct dahdi_pvt *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int bump_gains </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l02836">2836</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00676">dahdi_pvt::cid_rxgain</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="chan__dahdi_8c_source.html#l01022">dahdi_pvt::law</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__dahdi_8c_source.html#l00678">dahdi_pvt::rxgain</a>, <a class="el" href="chan__dahdi_8c_source.html#l02831">set_actual_gain()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00680">dahdi_pvt::txgain</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l08925">mwi_thread()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02837"></a>02837 {
<a name="l02838"></a>02838    <span class="keywordtype">int</span> res;
<a name="l02839"></a>02839 
<a name="l02840"></a>02840    <span class="comment">/* Bump receive gain by value stored in cid_rxgain */</span>
<a name="l02841"></a>02841    res = <a class="code" href="chan__dahdi_8c.html#a6abcbfc59e4d42646f31142d7dd2b830">set_actual_gain</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, 0, p-&gt;<a class="code" href="structdahdi__pvt.html#aeebb464c72892c9f3ddafed5ade720ee" title="Rx gain set by chan_dahdi.conf.">rxgain</a> + p-&gt;<a class="code" href="structdahdi__pvt.html#a0fab7ca391bb3e45727b888a50902f7e" title="Amount of gain to increase during caller id.">cid_rxgain</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#ad291967734f3b7bee3ec179278a1f76f" title="Tx gain set by chan_dahdi.conf.">txgain</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#a17dd7b17c0e736754e01e575ca8d8cb8" title="Active PCM encoding format: DAHDI_LAW_ALAW or DAHDI_LAW_MULAW.">law</a>);
<a name="l02842"></a>02842    <span class="keywordflow">if</span> (res) {
<a name="l02843"></a>02843       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to bump gain: %s\n&quot;</span>, strerror(errno));
<a name="l02844"></a>02844       <span class="keywordflow">return</span> -1;
<a name="l02845"></a>02845    }
<a name="l02846"></a>02846 
<a name="l02847"></a>02847    <span class="keywordflow">return</span> 0;
<a name="l02848"></a>02848 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6fe88ac2d409718d8b1a788ad2930a24"></a><!-- doxytag: member="chan_dahdi.c::calc_energy" ref="a6fe88ac2d409718d8b1a788ad2930a24" args="(const unsigned char *buf, int len, int law)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int calc_energy </td>
          <td>(</td>
          <td class="paramtype">const unsigned char *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>law</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l08911">8911</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="alaw_8h_source.html#l00084">AST_ALAW</a>, <a class="el" href="frame_8h_source.html#l00245">AST_FORMAT_ULAW</a>, and <a class="el" href="ulaw_8h_source.html#l00085">AST_MULAW</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l09496">do_monitor()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l08925">mwi_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l08912"></a>08912 {
<a name="l08913"></a>08913    <span class="keywordtype">int</span> x;
<a name="l08914"></a>08914    <span class="keywordtype">int</span> sum = 0;
<a name="l08915"></a>08915 
<a name="l08916"></a>08916    <span class="keywordflow">if</span> (!<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>)
<a name="l08917"></a>08917       <span class="keywordflow">return</span> 0;
<a name="l08918"></a>08918 
<a name="l08919"></a>08919    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>; x++)
<a name="l08920"></a>08920       sum += abs(law == <a class="code" href="frame_8h.html#ab602cf455d4a96a3adba2e3ba8cd2b2c">AST_FORMAT_ULAW</a> ? <a class="code" href="ulaw_8h.html#a00ac194f4317c7c388bfe531f51c803a">AST_MULAW</a>(<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[x]) : <a class="code" href="alaw_8h.html#a85173bf923da21593f2db8132a70d4b0">AST_ALAW</a>(<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[x]));
<a name="l08921"></a>08921 
<a name="l08922"></a>08922    <span class="keywordflow">return</span> sum / len;
<a name="l08923"></a>08923 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7da85f2b0e343bc06fda0c9f675cb1e8"></a><!-- doxytag: member="chan_dahdi.c::check_for_conference" ref="a7da85f2b0e343bc06fda0c9f675cb1e8" args="(struct dahdi_pvt *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int check_for_conference </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l05554">5554</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="chan__dahdi_8c_source.html#l01023">dahdi_pvt::confno</a>, <a class="el" href="chan__dahdi_8c_source.html#l00622">dahdi_subchannel::curconf</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__dahdi_8c_source.html#l00658">dahdi_pvt::master</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05555"></a>05555 {
<a name="l05556"></a>05556    <span class="keyword">struct </span>dahdi_confinfo ci;
<a name="l05557"></a>05557    <span class="comment">/* Fine if we already have a master, etc */</span>
<a name="l05558"></a>05558    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a3e30e79b4679785034d55aff6a17e41b">master</a> || (p-&gt;<a class="code" href="structdahdi__pvt.html#aa9d25d217a303c512db5f8bd7fabd587">confno</a> &gt; -1))
<a name="l05559"></a>05559       <span class="keywordflow">return</span> 0;
<a name="l05560"></a>05560    memset(&amp;ci, 0, <span class="keyword">sizeof</span>(ci));
<a name="l05561"></a>05561    <span class="keywordflow">if</span> (ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_GETCONF, &amp;ci)) {
<a name="l05562"></a>05562       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to get conference info on channel %d: %s\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, strerror(errno));
<a name="l05563"></a>05563       <span class="keywordflow">return</span> 0;
<a name="l05564"></a>05564    }
<a name="l05565"></a>05565    <span class="comment">/* If we have no master and don&apos;t have a confno, then</span>
<a name="l05566"></a>05566 <span class="comment">      if we&apos;re in a conference, it&apos;s probably a MeetMe room or</span>
<a name="l05567"></a>05567 <span class="comment">      some such, so don&apos;t let us 3-way out! */</span>
<a name="l05568"></a>05568    <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#ac50efd693f9db4d9cc6d1e1287791824">curconf</a>.confno != ci.confno) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#ac50efd693f9db4d9cc6d1e1287791824">curconf</a>.confmode != ci.confmode)) {
<a name="l05569"></a>05569       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Avoiding 3-way call when in an external conference\n&quot;</span>);
<a name="l05570"></a>05570       <span class="keywordflow">return</span> 1;
<a name="l05571"></a>05571    }
<a name="l05572"></a>05572    <span class="keywordflow">return</span> 0;
<a name="l05573"></a>05573 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a59a7383df35eebc13f65625074a30353"></a><!-- doxytag: member="chan_dahdi.c::conf_add" ref="a59a7383df35eebc13f65625074a30353" args="(struct dahdi_pvt *p, struct dahdi_subchannel *c, int idx, int slavechannel)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int conf_add </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdahdi__subchannel.html">dahdi_subchannel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>slavechannel</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l02478">2478</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01023">dahdi_pvt::confno</a>, <a class="el" href="chan__dahdi_8c_source.html#l00622">dahdi_subchannel::curconf</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, and <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l02604">update_conf()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02479"></a>02479 {
<a name="l02480"></a>02480    <span class="comment">/* If the conference already exists, and we&apos;re already in it</span>
<a name="l02481"></a>02481 <span class="comment">      don&apos;t bother doing anything */</span>
<a name="l02482"></a>02482    <span class="keyword">struct </span>dahdi_confinfo zi;
<a name="l02483"></a>02483 
<a name="l02484"></a>02484    memset(&amp;zi, 0, <span class="keyword">sizeof</span>(zi));
<a name="l02485"></a>02485    zi.chan = 0;
<a name="l02486"></a>02486 
<a name="l02487"></a>02487    <span class="keywordflow">if</span> (slavechannel &gt; 0) {
<a name="l02488"></a>02488       <span class="comment">/* If we have only one slave, do a digital mon */</span>
<a name="l02489"></a>02489       zi.confmode = DAHDI_CONF_DIGITALMON;
<a name="l02490"></a>02490       zi.confno = slavechannel;
<a name="l02491"></a>02491    } <span class="keywordflow">else</span> {
<a name="l02492"></a>02492       <span class="keywordflow">if</span> (!idx) {
<a name="l02493"></a>02493          <span class="comment">/* Real-side and pseudo-side both participate in conference */</span>
<a name="l02494"></a>02494          zi.confmode = DAHDI_CONF_REALANDPSEUDO | DAHDI_CONF_TALKER | DAHDI_CONF_LISTENER |
<a name="l02495"></a>02495             DAHDI_CONF_PSEUDO_TALKER | DAHDI_CONF_PSEUDO_LISTENER;
<a name="l02496"></a>02496       } <span class="keywordflow">else</span>
<a name="l02497"></a>02497          zi.confmode = DAHDI_CONF_CONF | DAHDI_CONF_TALKER | DAHDI_CONF_LISTENER;
<a name="l02498"></a>02498       zi.confno = p-&gt;<a class="code" href="structdahdi__pvt.html#aa9d25d217a303c512db5f8bd7fabd587">confno</a>;
<a name="l02499"></a>02499    }
<a name="l02500"></a>02500    <span class="keywordflow">if</span> ((zi.confno == c-&gt;<a class="code" href="structdahdi__subchannel.html#ac50efd693f9db4d9cc6d1e1287791824">curconf</a>.confno) &amp;&amp; (zi.confmode == c-&gt;<a class="code" href="structdahdi__subchannel.html#ac50efd693f9db4d9cc6d1e1287791824">curconf</a>.confmode))
<a name="l02501"></a>02501       <span class="keywordflow">return</span> 0;
<a name="l02502"></a>02502    <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a> &lt; 0)
<a name="l02503"></a>02503       <span class="keywordflow">return</span> 0;
<a name="l02504"></a>02504    <span class="keywordflow">if</span> (ioctl(c-&gt;<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_SETCONF, &amp;zi)) {
<a name="l02505"></a>02505       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to add %d to conference %d/%d: %s\n&quot;</span>, c-&gt;<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, zi.confmode, zi.confno, strerror(errno));
<a name="l02506"></a>02506       <span class="keywordflow">return</span> -1;
<a name="l02507"></a>02507    }
<a name="l02508"></a>02508    <span class="keywordflow">if</span> (slavechannel &lt; 1) {
<a name="l02509"></a>02509       p-&gt;<a class="code" href="structdahdi__pvt.html#aa9d25d217a303c512db5f8bd7fabd587">confno</a> = zi.confno;
<a name="l02510"></a>02510    }
<a name="l02511"></a>02511    memcpy(&amp;c-&gt;<a class="code" href="structdahdi__subchannel.html#ac50efd693f9db4d9cc6d1e1287791824">curconf</a>, &amp;zi, <span class="keyword">sizeof</span>(c-&gt;<a class="code" href="structdahdi__subchannel.html#ac50efd693f9db4d9cc6d1e1287791824">curconf</a>));
<a name="l02512"></a>02512    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Added %d to conference %d/%d\n&quot;</span>, c-&gt;<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, c-&gt;<a class="code" href="structdahdi__subchannel.html#ac50efd693f9db4d9cc6d1e1287791824">curconf</a>.confmode, c-&gt;<a class="code" href="structdahdi__subchannel.html#ac50efd693f9db4d9cc6d1e1287791824">curconf</a>.confno);
<a name="l02513"></a>02513    <span class="keywordflow">return</span> 0;
<a name="l02514"></a>02514 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa44456edf36cac7dde2531aef042ec1c"></a><!-- doxytag: member="chan_dahdi.c::conf_del" ref="aa44456edf36cac7dde2531aef042ec1c" args="(struct dahdi_pvt *p, struct dahdi_subchannel *c, int idx)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int conf_del </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdahdi__subchannel.html">dahdi_subchannel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>idx</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l02527">2527</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00622">dahdi_subchannel::curconf</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="chan__dahdi_8c_source.html#l02516">isourconf()</a>, and <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l05044">dahdi_unlink()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l02604">update_conf()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02528"></a>02528 {
<a name="l02529"></a>02529    <span class="keyword">struct </span>dahdi_confinfo zi;
<a name="l02530"></a>02530    <span class="keywordflow">if</span> (<span class="comment">/* Can&apos;t delete if there&apos;s no dfd */</span>
<a name="l02531"></a>02531       (c-&gt;<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a> &lt; 0) ||
<a name="l02532"></a>02532       <span class="comment">/* Don&apos;t delete from the conference if it&apos;s not our conference */</span>
<a name="l02533"></a>02533       !<a class="code" href="chan__dahdi_8c.html#a08c5ea3a8b7ff7213a12de76994d4897">isourconf</a>(p, c)
<a name="l02534"></a>02534       <span class="comment">/* Don&apos;t delete if we don&apos;t think it&apos;s conferenced at all (implied) */</span>
<a name="l02535"></a>02535       ) <span class="keywordflow">return</span> 0;
<a name="l02536"></a>02536    memset(&amp;zi, 0, <span class="keyword">sizeof</span>(zi));
<a name="l02537"></a>02537    <span class="keywordflow">if</span> (ioctl(c-&gt;<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_SETCONF, &amp;zi)) {
<a name="l02538"></a>02538       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to drop %d from conference %d/%d: %s\n&quot;</span>, c-&gt;<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, c-&gt;<a class="code" href="structdahdi__subchannel.html#ac50efd693f9db4d9cc6d1e1287791824">curconf</a>.confmode, c-&gt;<a class="code" href="structdahdi__subchannel.html#ac50efd693f9db4d9cc6d1e1287791824">curconf</a>.confno, strerror(errno));
<a name="l02539"></a>02539       <span class="keywordflow">return</span> -1;
<a name="l02540"></a>02540    }
<a name="l02541"></a>02541    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Removed %d from conference %d/%d\n&quot;</span>, c-&gt;<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, c-&gt;<a class="code" href="structdahdi__subchannel.html#ac50efd693f9db4d9cc6d1e1287791824">curconf</a>.confmode, c-&gt;<a class="code" href="structdahdi__subchannel.html#ac50efd693f9db4d9cc6d1e1287791824">curconf</a>.confno);
<a name="l02542"></a>02542    memcpy(&amp;c-&gt;<a class="code" href="structdahdi__subchannel.html#ac50efd693f9db4d9cc6d1e1287791824">curconf</a>, &amp;zi, <span class="keyword">sizeof</span>(c-&gt;<a class="code" href="structdahdi__subchannel.html#ac50efd693f9db4d9cc6d1e1287791824">curconf</a>));
<a name="l02543"></a>02543    <span class="keywordflow">return</span> 0;
<a name="l02544"></a>02544 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a70ee00a2e6988aaca45ea87bcac2cc98"></a><!-- doxytag: member="chan_dahdi.c::dahdi_answer" ref="a70ee00a2e6988aaca45ea87bcac2cc98" args="(struct ast_channel *ast)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int dahdi_answer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>ast</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l04718">4718</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00469">ast_channel::_state</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="channel_8c_source.html#l04695">ast_setstate()</a>, <a class="el" href="channel_8h_source.html#l00364">AST_STATE_RINGING</a>, <a class="el" href="channel_8h_source.html#l00365">AST_STATE_UP</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="chan__dahdi_8c_source.html#l02660">dahdi_enable_ec()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01503">dahdi_get_index()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02863">dahdi_set_hook()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02692">dahdi_train_ec()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="chan__dahdi_8c_source.html#l00745">dahdi_pvt::dialing</a>, <a class="el" href="chan__dahdi_8c_source.html#l00747">dahdi_pvt::digital</a>, <a class="el" href="chan__dahdi_8c_source.html#l00772">dahdi_pvt::hanguponpolarityswitch</a>, <a class="el" href="chan__dahdi_8c_source.html#l00621">dahdi_subchannel::inthreeway</a>, <a class="el" href="chan__dahdi_8c_source.html#l00649">dahdi_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00119">LOG_DEBUG</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__dahdi_8c_source.html#l00673">dahdi_pvt::oprmode</a>, <a class="el" href="chan__dahdi_8c_source.html#l00608">dahdi_subchannel::owner</a>, <a class="el" href="chan__dahdi_8c_source.html#l00650">dahdi_pvt::owner</a>, <a class="el" href="chan__dahdi_8c_source.html#l01156">dahdi_pvt::polaritydelaytv</a>, <a class="el" href="chan__dahdi_8c_source.html#l00671">dahdi_pvt::radio</a>, <a class="el" href="chan__dahdi_8c_source.html#l01056">dahdi_pvt::ringt</a>, <a class="el" href="chan__dahdi_8c_source.html#l00666">dahdi_pvt::sig</a>, <a class="el" href="chan__dahdi_8c_source.html#l00256">SIG_BRI</a>, <a class="el" href="chan__dahdi_8c_source.html#l00257">SIG_BRI_PTMP</a>, <a class="el" href="chan__dahdi_8c_source.html#l00245">SIG_E911</a>, <a class="el" href="chan__dahdi_8c_source.html#l00240">SIG_EM</a>, <a class="el" href="chan__dahdi_8c_source.html#l00265">SIG_EM_E1</a>, <a class="el" href="chan__dahdi_8c_source.html#l00241">SIG_EMWINK</a>, <a class="el" href="chan__dahdi_8c_source.html#l00244">SIG_FEATB</a>, <a class="el" href="chan__dahdi_8c_source.html#l00242">SIG_FEATD</a>, <a class="el" href="chan__dahdi_8c_source.html#l00243">SIG_FEATDMF</a>, <a class="el" href="chan__dahdi_8c_source.html#l00246">SIG_FEATDMF_TA</a>, <a class="el" href="chan__dahdi_8c_source.html#l00247">SIG_FGC_CAMA</a>, <a class="el" href="chan__dahdi_8c_source.html#l00248">SIG_FGC_CAMAMF</a>, <a class="el" href="chan__dahdi_8c_source.html#l00253">SIG_FXOGS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00254">SIG_FXOKS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00252">SIG_FXOLS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00250">SIG_FXSGS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00251">SIG_FXSKS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00249">SIG_FXSLS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00259">SIG_MFCR2</a>, <a class="el" href="chan__dahdi_8c_source.html#l00255">SIG_PRI</a>, <a class="el" href="chan__dahdi_8c_source.html#l00260">SIG_SF</a>, <a class="el" href="chan__dahdi_8c_source.html#l00264">SIG_SF_FEATB</a>, <a class="el" href="chan__dahdi_8c_source.html#l00262">SIG_SF_FEATD</a>, <a class="el" href="chan__dahdi_8c_source.html#l00263">SIG_SF_FEATDMF</a>, <a class="el" href="chan__dahdi_8c_source.html#l00261">SIG_SFWINK</a>, <a class="el" href="chan__dahdi_8c_source.html#l00258">SIG_SS7</a>, <a class="el" href="chan__dahdi_8c_source.html#l01042">dahdi_pvt::span</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, <a class="el" href="chan__dahdi_8c_source.html#l00581">SUB_THREEWAY</a>, <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>, <a class="el" href="chan__dahdi_8c_source.html#l02062">swap_subs()</a>, and <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04719"></a>04719 {
<a name="l04720"></a>04720    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *p = ast-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l04721"></a>04721    <span class="keywordtype">int</span> res = 0;
<a name="l04722"></a>04722    <span class="keywordtype">int</span> idx;
<a name="l04723"></a>04723    <span class="keywordtype">int</span> oldstate = ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a>;
<a name="l04724"></a>04724    <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(ast, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>);
<a name="l04725"></a>04725    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l04726"></a>04726    idx = <a class="code" href="chan__dahdi_8c.html#a62c8e3f411fb9e5ec62a1e77c152c2df">dahdi_get_index</a>(ast, p, 0);
<a name="l04727"></a>04727    <span class="keywordflow">if</span> (idx &lt; 0)
<a name="l04728"></a>04728       idx = <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>;
<a name="l04729"></a>04729    <span class="comment">/* nothing to do if a radio channel */</span>
<a name="l04730"></a>04730    <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structdahdi__pvt.html#ac53b42243ee40edc74b615fe86806fe3" title="Nonzero if the signaling type is sent over a radio.">radio</a> || (p-&gt;<a class="code" href="structdahdi__pvt.html#a3b3cefe7a33d0cff61f3a2b5955b6c8b">oprmode</a> &lt; 0))) {
<a name="l04731"></a>04731       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l04732"></a>04732       <span class="keywordflow">return</span> 0;
<a name="l04733"></a>04733    }
<a name="l04734"></a>04734    <span class="keywordflow">switch</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a>) {
<a name="l04735"></a>04735    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a1dc50a07aef86c90ab94f1583c35a265">SIG_FXSLS</a>:
<a name="l04736"></a>04736    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a97e4c6fb4680984aafc6e0e55a2b6cb4">SIG_FXSGS</a>:
<a name="l04737"></a>04737    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a38139ec369c0243f4324eb4eb0c2f004">SIG_FXSKS</a>:
<a name="l04738"></a>04738       p-&gt;<a class="code" href="structdahdi__pvt.html#a2ecae7dca8c46e1948d9117eee9a15e4" title="Ring timeout timer??">ringt</a> = 0;
<a name="l04739"></a>04739       <span class="comment">/* Fall through */</span>
<a name="l04740"></a>04740    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#afa7547cd2cee1bae7734206102635216">SIG_EM</a>:
<a name="l04741"></a>04741    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#aa7b59772722b794c5218768dac3ee419">SIG_EM_E1</a>:
<a name="l04742"></a>04742    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a1ba988b93fce049075b7c2ef6c931cf9">SIG_EMWINK</a>:
<a name="l04743"></a>04743    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ab79873391af2857a602e1eff68606f23">SIG_FEATD</a>:
<a name="l04744"></a>04744    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a98d4710afc1fcb2ff110eabb4fbcc308">SIG_FEATDMF</a>:
<a name="l04745"></a>04745    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ac0c40f74945ed15aa82cd9fedc304e55">SIG_FEATDMF_TA</a>:
<a name="l04746"></a>04746    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#adfdd0e4d05281d354c15ef1a5d158cd6">SIG_E911</a>:
<a name="l04747"></a>04747    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a167056b2763a4897838c7115efc1f9fc">SIG_FGC_CAMA</a>:
<a name="l04748"></a>04748    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a945e2b5f225d3abdc57b5dcc53daa62a">SIG_FGC_CAMAMF</a>:
<a name="l04749"></a>04749    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a0ba8ec199f5fb4f2be64144be0bd13b1">SIG_FEATB</a>:
<a name="l04750"></a>04750    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#afacb372d32fba2192ed6a2989c54fbda">SIG_SF</a>:
<a name="l04751"></a>04751    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a193853e7e76cff05d51425eba48d030f">SIG_SFWINK</a>:
<a name="l04752"></a>04752    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#aac334a7f88651d9e44499897386d2cfd">SIG_SF_FEATD</a>:
<a name="l04753"></a>04753    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a4625d3aba972e102c8460a9f16af0fc7">SIG_SF_FEATDMF</a>:
<a name="l04754"></a>04754    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a33a2f70a24e9f8ccfcc1e76f208b1ab6">SIG_SF_FEATB</a>:
<a name="l04755"></a>04755    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#adb40571aa5ff846fc334be5260eab257">SIG_FXOLS</a>:
<a name="l04756"></a>04756    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a3dcffbaf4a26f2b7b792998df1eea27b">SIG_FXOGS</a>:
<a name="l04757"></a>04757    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a7c9b3bb8225896ff2b9aed27e6f80f10">SIG_FXOKS</a>:
<a name="l04758"></a>04758       <span class="comment">/* Pick up the line */</span>
<a name="l04759"></a>04759       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Took %s off hook\n&quot;</span>, ast-&gt;name);
<a name="l04760"></a>04760       <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a7bc13c53b24817de617833097a940350" title="TRUE if the call will be considered &amp;quot;hung up&amp;quot; on a polarity reversal.">hanguponpolarityswitch</a>) {
<a name="l04761"></a>04761          p-&gt;<a class="code" href="structdahdi__pvt.html#a7ad8177600d95c8debaba02d2327a171" title="Start delay time if polarityonanswerdelay is nonzero.">polaritydelaytv</a> = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l04762"></a>04762       }
<a name="l04763"></a>04763       res = <a class="code" href="chan__dahdi_8c.html#a7c65e6943db828524ea6c9215b8bf696">dahdi_set_hook</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_OFFHOOK);
<a name="l04764"></a>04764       tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, -1);
<a name="l04765"></a>04765       p-&gt;<a class="code" href="structdahdi__pvt.html#af17335c0c7a4c1e03e987a33f6eec81b" title="TRUE if in the process of dialing digits or sending something.">dialing</a> = 0;
<a name="l04766"></a>04766       <span class="keywordflow">if</span> ((idx == <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>) &amp;&amp; p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a>) {
<a name="l04767"></a>04767          <span class="keywordflow">if</span> (oldstate == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa">AST_STATE_RINGING</a>) {
<a name="l04768"></a>04768             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Finally swapping real and threeway\n&quot;</span>);
<a name="l04769"></a>04769             tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, -1);
<a name="l04770"></a>04770             <a class="code" href="chan__dahdi_8c.html#aaa6e6b7fe5725465004d3fabf351620e">swap_subs</a>(p, <a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>, <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>);
<a name="l04771"></a>04771             p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;
<a name="l04772"></a>04772          }
<a name="l04773"></a>04773       }
<a name="l04774"></a>04774       <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> &amp; __DAHDI_SIG_FXS) {
<a name="l04775"></a>04775          <a class="code" href="chan__dahdi_8c.html#a8c34a5bce2b26d056942349217806312">dahdi_enable_ec</a>(p);
<a name="l04776"></a>04776          <a class="code" href="chan__dahdi_8c.html#a31c006d7b409a09059a58946a706ea07">dahdi_train_ec</a>(p);
<a name="l04777"></a>04777       }
<a name="l04778"></a>04778       <span class="keywordflow">break</span>;
<a name="l04779"></a>04779 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l04780"></a>04780 <span class="preprocessor"></span>   <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ab5bfeaf991c23c5b6510ace44ae79ce9">SIG_BRI</a>:
<a name="l04781"></a>04781    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a>:
<a name="l04782"></a>04782    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ae9ab0c9508fca045a06730533be276a5">SIG_PRI</a>:
<a name="l04783"></a>04783       <span class="comment">/* Send a pri acknowledge */</span>
<a name="l04784"></a>04784       <span class="keywordflow">if</span> (!pri_grab(p, p-&gt;pri)) {
<a name="l04785"></a>04785          p-&gt;proceeding = 1;
<a name="l04786"></a>04786          p-&gt;<a class="code" href="structdahdi__pvt.html#af17335c0c7a4c1e03e987a33f6eec81b" title="TRUE if in the process of dialing digits or sending something.">dialing</a> = 0;
<a name="l04787"></a>04787          res = pri_answer(p-&gt;pri-&gt;pri, p-&gt;call, 0, !p-&gt;<a class="code" href="structdahdi__pvt.html#adf54768a4327f86de3a234648305c4a4" title="TRUE if the transfer capability of the call is digital.">digital</a>);
<a name="l04788"></a>04788          pri_rel(p-&gt;pri);
<a name="l04789"></a>04789       } <span class="keywordflow">else</span> {
<a name="l04790"></a>04790          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to grab PRI on span %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#a63fc22149930803b4e3fb4c453177e5e">span</a>);
<a name="l04791"></a>04791          res = -1;
<a name="l04792"></a>04792       }
<a name="l04793"></a>04793       <span class="keywordflow">break</span>;
<a name="l04794"></a>04794 <span class="preprocessor">#endif</span>
<a name="l04795"></a>04795 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_SS7</span>
<a name="l04796"></a>04796 <span class="preprocessor"></span>   <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#aadcda889db3cf9dfe757dbc1d4d8311a">SIG_SS7</a>:
<a name="l04797"></a>04797       <span class="keywordflow">if</span> (!ss7_grab(p, p-&gt;ss7)) {
<a name="l04798"></a>04798          p-&gt;proceeding = 1;
<a name="l04799"></a>04799          res = isup_anm(p-&gt;ss7-&gt;ss7, p-&gt;ss7call);
<a name="l04800"></a>04800          ss7_rel(p-&gt;ss7);
<a name="l04801"></a>04801       } <span class="keywordflow">else</span> {
<a name="l04802"></a>04802          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to grab SS7 on span %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#a63fc22149930803b4e3fb4c453177e5e">span</a>);
<a name="l04803"></a>04803          res = -1;
<a name="l04804"></a>04804       }
<a name="l04805"></a>04805       <span class="keywordflow">break</span>;
<a name="l04806"></a>04806 <span class="preprocessor">#endif</span>
<a name="l04807"></a>04807 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_OPENR2</span>
<a name="l04808"></a>04808 <span class="preprocessor"></span>   <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a1d73a98ae12601287580dedd9a6d739b">SIG_MFCR2</a>:
<a name="l04809"></a>04809       <span class="keywordflow">if</span> (!p-&gt;mfcr2_call_accepted) {
<a name="l04810"></a>04810          <span class="comment">/* The call was not accepted on offer nor the user, so it must be accepted now before answering,</span>
<a name="l04811"></a>04811 <span class="comment">            openr2_chan_answer_call will be called when the callback on_call_accepted is executed */</span>
<a name="l04812"></a>04812          p-&gt;mfcr2_answer_pending = 1;
<a name="l04813"></a>04813          <span class="keywordflow">if</span> (p-&gt;mfcr2_charge_calls) {
<a name="l04814"></a>04814             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;Accepting MFC/R2 call with charge before answering on chan %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l04815"></a>04815             openr2_chan_accept_call(p-&gt;r2chan, OR2_CALL_WITH_CHARGE);
<a name="l04816"></a>04816          } <span class="keywordflow">else</span> {
<a name="l04817"></a>04817             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;Accepting MFC/R2 call with no charge before answering on chan %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l04818"></a>04818             openr2_chan_accept_call(p-&gt;r2chan, OR2_CALL_NO_CHARGE);
<a name="l04819"></a>04819          }
<a name="l04820"></a>04820       } <span class="keywordflow">else</span> {
<a name="l04821"></a>04821          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;Answering MFC/R2 call on chan %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l04822"></a>04822          dahdi_r2_answer(p);
<a name="l04823"></a>04823       }
<a name="l04824"></a>04824       <span class="keywordflow">break</span>;
<a name="l04825"></a>04825 <span class="preprocessor">#endif</span>
<a name="l04826"></a>04826 <span class="preprocessor"></span>   <span class="keywordflow">case</span> 0:
<a name="l04827"></a>04827       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l04828"></a>04828       <span class="keywordflow">return</span> 0;
<a name="l04829"></a>04829    <span class="keywordflow">default</span>:
<a name="l04830"></a>04830       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Don&apos;t know how to answer signalling %d (channel %d)\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l04831"></a>04831       res = -1;
<a name="l04832"></a>04832    }
<a name="l04833"></a>04833    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l04834"></a>04834    <span class="keywordflow">return</span> res;
<a name="l04835"></a>04835 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aad73d49132bf3211857b52d664ecec33"></a><!-- doxytag: member="chan_dahdi.c::dahdi_bridge" ref="aad73d49132bf3211857b52d664ecec33" args="(struct ast_channel *c0, struct ast_channel *c1, int flags, struct ast_frame **fo, struct ast_channel **rc, int timeoutms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05">ast_bridge_result</a> dahdi_bridge </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__frame.html">ast_frame</a> **&nbsp;</td>
          <td class="paramname"> <em>fo</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> **&nbsp;</td>
          <td class="paramname"> <em>rc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>timeoutms</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l05156">5156</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00469">ast_channel::_state</a>, <a class="el" href="channel_8h_source.html#l00164">AST_BRIDGE_COMPLETE</a>, <a class="el" href="channel_8h_source.html#l01370">AST_BRIDGE_DTMF_CHANNEL_0</a>, <a class="el" href="channel_8h_source.html#l01372">AST_BRIDGE_DTMF_CHANNEL_1</a>, <a class="el" href="channel_8h_source.html#l00165">AST_BRIDGE_FAILED</a>, <a class="el" href="channel_8h_source.html#l00166">AST_BRIDGE_FAILED_NOWARN</a>, <a class="el" href="channel_8h_source.html#l00167">AST_BRIDGE_RETRY</a>, <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02037">ast_channel_trylock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="frame_8h_source.html#l00105">AST_FRAME_CONTROL</a>, <a class="el" href="frame_8h_source.html#l00124">AST_FRAME_DTMF</a>, <a class="el" href="frame_8h_source.html#l00462">ast_frfree</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01722">ast_mutex_trylock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="channel_8c_source.html#l03100">ast_read()</a>, <a class="el" href="channel_8h_source.html#l00364">AST_STATE_RINGING</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="channel_8c_source.html#l02384">ast_waitfor_n()</a>, <a class="el" href="channel_8c_source.html#l03411">ast_write()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="lock_8h_source.html#l01671">CHANNEL_DEADLOCK_AVOIDANCE</a>, <a class="el" href="chan__dahdi_8c_source.html#l02709">dahdi_disable_ec()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02660">dahdi_enable_ec()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01503">dahdi_get_index()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05100">dahdi_link()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05044">dahdi_unlink()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="chan__dahdi_8c_source.html#l05123">disable_dtmf_detect()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00757">dahdi_pvt::echocanbridged</a>, <a class="el" href="chan__dahdi_8c_source.html#l05138">enable_dtmf_detect()</a>, <a class="el" href="channel_8h_source.html#l00458">ast_channel::fds</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="chan__dahdi_8c_source.html#l00659">dahdi_pvt::inconference</a>, <a class="el" href="chan__dahdi_8c_source.html#l00621">dahdi_subchannel::inthreeway</a>, <a class="el" href="chan__dahdi_8c_source.html#l00649">dahdi_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="cdr__custom_8c_source.html#l00057">master</a>, <a class="el" href="chan__dahdi_8c_source.html#l00608">dahdi_subchannel::owner</a>, <a class="el" href="chan__dahdi_8c_source.html#l00650">dahdi_pvt::owner</a>, <a class="el" href="chan__dahdi_8c_source.html#l00830">dahdi_pvt::pulsedial</a>, <a class="el" href="chan__dahdi_8c_source.html#l00666">dahdi_pvt::sig</a>, <a class="el" href="chan__dahdi_8c_source.html#l00580">SUB_CALLWAIT</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, <a class="el" href="chan__dahdi_8c_source.html#l00581">SUB_THREEWAY</a>, <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>, <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>, <a class="el" href="chan__dahdi_8c_source.html#l00851">dahdi_pvt::transfer</a>, and <a class="el" href="chan__dahdi_8c_source.html#l02604">update_conf()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05157"></a>05157 {
<a name="l05158"></a>05158    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *who;
<a name="l05159"></a>05159    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *p0, *p1, *op0, *op1;
<a name="l05160"></a>05160    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *<a class="code" href="cdr__custom_8c.html#ac4cd676396d9d62ba95a047806668d90">master</a> = NULL, *slave = NULL;
<a name="l05161"></a>05161    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l05162"></a>05162    <span class="keywordtype">int</span> inconf = 0;
<a name="l05163"></a>05163    <span class="keywordtype">int</span> nothingok = 1;
<a name="l05164"></a>05164    <span class="keywordtype">int</span> ofd0, ofd1;
<a name="l05165"></a>05165    <span class="keywordtype">int</span> oi0, oi1, i0 = -1, i1 = -1, t0, t1;
<a name="l05166"></a>05166    <span class="keywordtype">int</span> os0 = -1, os1 = -1;
<a name="l05167"></a>05167    <span class="keywordtype">int</span> priority = 0;
<a name="l05168"></a>05168    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *oc0, *oc1;
<a name="l05169"></a>05169    <span class="keyword">enum</span> <a class="code" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05">ast_bridge_result</a> res;
<a name="l05170"></a>05170 
<a name="l05171"></a>05171 <span class="preprocessor">#ifdef PRI_2BCT</span>
<a name="l05172"></a>05172 <span class="preprocessor"></span>   <span class="keywordtype">int</span> triedtopribridge = 0;
<a name="l05173"></a>05173    q931_call *q931c0 = NULL, *q931c1 = NULL;
<a name="l05174"></a>05174 <span class="preprocessor">#endif</span>
<a name="l05175"></a>05175 <span class="preprocessor"></span>
<a name="l05176"></a>05176    <span class="comment">/* For now, don&apos;t attempt to native bridge if either channel needs DTMF detection.</span>
<a name="l05177"></a>05177 <span class="comment">      There is code below to handle it properly until DTMF is actually seen,</span>
<a name="l05178"></a>05178 <span class="comment">      but due to currently unresolved issues it&apos;s ignored...</span>
<a name="l05179"></a>05179 <span class="comment">   */</span>
<a name="l05180"></a>05180 
<a name="l05181"></a>05181    <span class="keywordflow">if</span> (<a class="code" href="structast__channel.html#ac92588540e8c1d014a08cd8a45462b19">flags</a> &amp; (<a class="code" href="channel_8h.html#a2bd5879255a0f6a758c99b58fcab2f27" title="Report DTMF on channel 0.">AST_BRIDGE_DTMF_CHANNEL_0</a> | <a class="code" href="channel_8h.html#a7dbb6edabad3e02e80d605ca5d254c35" title="Report DTMF on channel 1.">AST_BRIDGE_DTMF_CHANNEL_1</a>))
<a name="l05182"></a>05182       <span class="keywordflow">return</span> <a class="code" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05a4368c9e8d0072a09af3086c79790abfb">AST_BRIDGE_FAILED_NOWARN</a>;
<a name="l05183"></a>05183 
<a name="l05184"></a>05184    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(c0);
<a name="l05185"></a>05185    <span class="keywordflow">while</span> (<a class="code" href="lock_8h.html#a8b8532d377bd19e8411000ddccfa6607" title="Try locking a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_trylock</a>(c1)) {
<a name="l05186"></a>05186       <a class="code" href="lock_8h.html#a7b1d6c8183a6f6f42a98239da3d1c7ca">CHANNEL_DEADLOCK_AVOIDANCE</a>(c0);
<a name="l05187"></a>05187    }
<a name="l05188"></a>05188 
<a name="l05189"></a>05189    p0 = c0-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l05190"></a>05190    p1 = c1-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l05191"></a>05191    <span class="comment">/* cant do pseudo-channels here */</span>
<a name="l05192"></a>05192    <span class="keywordflow">if</span> (!p0 || (!p0-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a>) || !p1 || (!p1-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a>)) {
<a name="l05193"></a>05193       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c0);
<a name="l05194"></a>05194       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c1);
<a name="l05195"></a>05195       <span class="keywordflow">return</span> <a class="code" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05a4368c9e8d0072a09af3086c79790abfb">AST_BRIDGE_FAILED_NOWARN</a>;
<a name="l05196"></a>05196    }
<a name="l05197"></a>05197 
<a name="l05198"></a>05198    oi0 = <a class="code" href="chan__dahdi_8c.html#a62c8e3f411fb9e5ec62a1e77c152c2df">dahdi_get_index</a>(c0, p0, 0);
<a name="l05199"></a>05199    oi1 = <a class="code" href="chan__dahdi_8c.html#a62c8e3f411fb9e5ec62a1e77c152c2df">dahdi_get_index</a>(c1, p1, 0);
<a name="l05200"></a>05200    <span class="keywordflow">if</span> ((oi0 &lt; 0) || (oi1 &lt; 0)) {
<a name="l05201"></a>05201       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c0);
<a name="l05202"></a>05202       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c1);
<a name="l05203"></a>05203       <span class="keywordflow">return</span> <a class="code" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05afcae35649bbc24a8c2080bec8d592c40">AST_BRIDGE_FAILED</a>;
<a name="l05204"></a>05204    }
<a name="l05205"></a>05205 
<a name="l05206"></a>05206    op0 = p0 = c0-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l05207"></a>05207    op1 = p1 = c1-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l05208"></a>05208    ofd0 = c0-&gt;<a class="code" href="structast__channel.html#aef68cd3879b791a3b6c12cdb750f8e6a">fds</a>[0];
<a name="l05209"></a>05209    ofd1 = c1-&gt;<a class="code" href="structast__channel.html#aef68cd3879b791a3b6c12cdb750f8e6a">fds</a>[0];
<a name="l05210"></a>05210    oc0 = p0-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;
<a name="l05211"></a>05211    oc1 = p1-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;
<a name="l05212"></a>05212 
<a name="l05213"></a>05213    <span class="keywordflow">if</span> (<a class="code" href="lock_8h.html#a036ccafa2339f674a46bc269bbd48c5f">ast_mutex_trylock</a>(&amp;p0-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>)) {
<a name="l05214"></a>05214       <span class="comment">/* Don&apos;t block, due to potential for deadlock */</span>
<a name="l05215"></a>05215       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c0);
<a name="l05216"></a>05216       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c1);
<a name="l05217"></a>05217       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Avoiding deadlock...\n&quot;</span>);
<a name="l05218"></a>05218       <span class="keywordflow">return</span> <a class="code" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05ac83c1441a620f7bdae5ef84692f8e7a5">AST_BRIDGE_RETRY</a>;
<a name="l05219"></a>05219    }
<a name="l05220"></a>05220    <span class="keywordflow">if</span> (<a class="code" href="lock_8h.html#a036ccafa2339f674a46bc269bbd48c5f">ast_mutex_trylock</a>(&amp;p1-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>)) {
<a name="l05221"></a>05221       <span class="comment">/* Don&apos;t block, due to potential for deadlock */</span>
<a name="l05222"></a>05222       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p0-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l05223"></a>05223       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c0);
<a name="l05224"></a>05224       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c1);
<a name="l05225"></a>05225       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Avoiding deadlock...\n&quot;</span>);
<a name="l05226"></a>05226       <span class="keywordflow">return</span> <a class="code" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05ac83c1441a620f7bdae5ef84692f8e7a5">AST_BRIDGE_RETRY</a>;
<a name="l05227"></a>05227    }
<a name="l05228"></a>05228 
<a name="l05229"></a>05229    <span class="keywordflow">if</span> ((oi0 == <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>) &amp;&amp; (oi1 == <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>)) {
<a name="l05230"></a>05230       <span class="keywordflow">if</span> (p0-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> &amp;&amp; p1-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l05231"></a>05231          <span class="comment">/* If we don&apos;t have a call-wait in a 3-way, and we aren&apos;t in a 3-way, we can be master */</span>
<a name="l05232"></a>05232          <span class="keywordflow">if</span> (!p0-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a> &amp;&amp; !p1-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a>) {
<a name="l05233"></a>05233             master = p0;
<a name="l05234"></a>05234             slave = p1;
<a name="l05235"></a>05235             inconf = 1;
<a name="l05236"></a>05236          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!p1-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a> &amp;&amp; !p0-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a>) {
<a name="l05237"></a>05237             master = p1;
<a name="l05238"></a>05238             slave = p0;
<a name="l05239"></a>05239             inconf = 1;
<a name="l05240"></a>05240          } <span class="keywordflow">else</span> {
<a name="l05241"></a>05241             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Huh?  Both calls are callwaits or 3-ways?  That&apos;s clever...?\n&quot;</span>);
<a name="l05242"></a>05242             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;p0: chan %d/%d/CW%d/3W%d, p1: chan %d/%d/CW%d/3W%d\n&quot;</span>,
<a name="l05243"></a>05243                p0-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>,
<a name="l05244"></a>05244                oi0, (p0-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a> &gt; -1) ? 1 : 0,
<a name="l05245"></a>05245                p0-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a>, p0-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>,
<a name="l05246"></a>05246                oi0, (p1-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a> &gt; -1) ? 1 : 0,
<a name="l05247"></a>05247                p1-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a>);
<a name="l05248"></a>05248          }
<a name="l05249"></a>05249          nothingok = 0;
<a name="l05250"></a>05250       }
<a name="l05251"></a>05251    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((oi0 == <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>) &amp;&amp; (oi1 == <a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>)) {
<a name="l05252"></a>05252       <span class="keywordflow">if</span> (p1-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a>) {
<a name="l05253"></a>05253          master = p1;
<a name="l05254"></a>05254          slave = p0;
<a name="l05255"></a>05255          nothingok = 0;
<a name="l05256"></a>05256       }
<a name="l05257"></a>05257    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((oi0 == <a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>) &amp;&amp; (oi1 == <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>)) {
<a name="l05258"></a>05258       <span class="keywordflow">if</span> (p0-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a>) {
<a name="l05259"></a>05259          master = p0;
<a name="l05260"></a>05260          slave = p1;
<a name="l05261"></a>05261          nothingok = 0;
<a name="l05262"></a>05262       }
<a name="l05263"></a>05263    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((oi0 == <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>) &amp;&amp; (oi1 == <a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>)) {
<a name="l05264"></a>05264       <span class="comment">/* We have a real and a call wait.  If we&apos;re in a three way call, put us in it, otherwise,</span>
<a name="l05265"></a>05265 <span class="comment">         don&apos;t put us in anything */</span>
<a name="l05266"></a>05266       <span class="keywordflow">if</span> (p1-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a>) {
<a name="l05267"></a>05267          master = p1;
<a name="l05268"></a>05268          slave = p0;
<a name="l05269"></a>05269          nothingok = 0;
<a name="l05270"></a>05270       }
<a name="l05271"></a>05271    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((oi0 == <a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>) &amp;&amp; (oi1 == <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>)) {
<a name="l05272"></a>05272       <span class="comment">/* Same as previous */</span>
<a name="l05273"></a>05273       <span class="keywordflow">if</span> (p0-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a>) {
<a name="l05274"></a>05274          master = p0;
<a name="l05275"></a>05275          slave = p1;
<a name="l05276"></a>05276          nothingok = 0;
<a name="l05277"></a>05277       }
<a name="l05278"></a>05278    }
<a name="l05279"></a>05279    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;master: %d, slave: %d, nothingok: %d\n&quot;</span>,
<a name="l05280"></a>05280       master ? master-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a> : 0, slave ? slave-&gt;channel : 0, nothingok);
<a name="l05281"></a>05281    <span class="keywordflow">if</span> (master &amp;&amp; slave) {
<a name="l05282"></a>05282       <span class="comment">/* Stop any tones, or play ringtone as appropriate.  If they&apos;re bridged</span>
<a name="l05283"></a>05283 <span class="comment">         in an active threeway call with a channel that is ringing, we should</span>
<a name="l05284"></a>05284 <span class="comment">         indicate ringing. */</span>
<a name="l05285"></a>05285       <span class="keywordflow">if</span> ((oi1 == <a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>) &amp;&amp;
<a name="l05286"></a>05286          p1-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a> &amp;&amp;
<a name="l05287"></a>05287          p1-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> &amp;&amp;
<a name="l05288"></a>05288          p1-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a> &amp;&amp;
<a name="l05289"></a>05289          (p1-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa">AST_STATE_RINGING</a>)) {
<a name="l05290"></a>05290          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Playing ringback on %s since %s is in a ringing three-way\n&quot;</span>, c0-&gt;name, c1-&gt;name);
<a name="l05291"></a>05291          tone_zone_play_tone(p0-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[oi0].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_RINGTONE);
<a name="l05292"></a>05292          os1 = p1-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a>;
<a name="l05293"></a>05293       } <span class="keywordflow">else</span> {
<a name="l05294"></a>05294          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Stopping tones on %d/%d talking to %d/%d\n&quot;</span>, p0-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, oi0, p1-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, oi1);
<a name="l05295"></a>05295          tone_zone_play_tone(p0-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[oi0].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, -1);
<a name="l05296"></a>05296       }
<a name="l05297"></a>05297       <span class="keywordflow">if</span> ((oi0 == <a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>) &amp;&amp;
<a name="l05298"></a>05298          p0-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a> &amp;&amp;
<a name="l05299"></a>05299          p0-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> &amp;&amp;
<a name="l05300"></a>05300          p0-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a> &amp;&amp;
<a name="l05301"></a>05301          (p0-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa">AST_STATE_RINGING</a>)) {
<a name="l05302"></a>05302          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Playing ringback on %s since %s is in a ringing three-way\n&quot;</span>, c1-&gt;name, c0-&gt;name);
<a name="l05303"></a>05303          tone_zone_play_tone(p1-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[oi1].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_RINGTONE);
<a name="l05304"></a>05304          os0 = p0-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a>;
<a name="l05305"></a>05305       } <span class="keywordflow">else</span> {
<a name="l05306"></a>05306          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Stopping tones on %d/%d talking to %d/%d\n&quot;</span>, p1-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, oi1, p0-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, oi0);
<a name="l05307"></a>05307          tone_zone_play_tone(p1-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[oi0].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, -1);
<a name="l05308"></a>05308       }
<a name="l05309"></a>05309       <span class="keywordflow">if</span> ((oi0 == <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>) &amp;&amp; (oi1 == <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>)) {
<a name="l05310"></a>05310          <span class="keywordflow">if</span> (!p0-&gt;<a class="code" href="structdahdi__pvt.html#ad4ee8bc9c653a9a2ce08e66f62d8814d" title="TRUE if echo cancellation enabled when bridged.">echocanbridged</a> || !p1-&gt;<a class="code" href="structdahdi__pvt.html#ad4ee8bc9c653a9a2ce08e66f62d8814d" title="TRUE if echo cancellation enabled when bridged.">echocanbridged</a>) {
<a name="l05311"></a>05311             <span class="comment">/* Disable echo cancellation if appropriate */</span>
<a name="l05312"></a>05312             <a class="code" href="chan__dahdi_8c.html#a5ceb6fd5bd012740d50b04e84fb29be4">dahdi_disable_ec</a>(p0);
<a name="l05313"></a>05313             <a class="code" href="chan__dahdi_8c.html#a5ceb6fd5bd012740d50b04e84fb29be4">dahdi_disable_ec</a>(p1);
<a name="l05314"></a>05314          }
<a name="l05315"></a>05315       }
<a name="l05316"></a>05316       <a class="code" href="chan__dahdi_8c.html#a8682ce9e42deed43c941fd7cae5ff30b">dahdi_link</a>(slave, master);
<a name="l05317"></a>05317       master-&gt;<a class="code" href="structdahdi__pvt.html#afa5f2dbd816e7f6141e6932e94b8eedd">inconference</a> = inconf;
<a name="l05318"></a>05318    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!nothingok)
<a name="l05319"></a>05319       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Can&apos;t link %d/%s with %d/%s\n&quot;</span>, p0-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, <a class="code" href="chan__dahdi_8c.html#a1f86ec72c5397a22d1b0e29e47635f04">subnames</a>[oi0], p1-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, <a class="code" href="chan__dahdi_8c.html#a1f86ec72c5397a22d1b0e29e47635f04">subnames</a>[oi1]);
<a name="l05320"></a>05320 
<a name="l05321"></a>05321    <a class="code" href="chan__dahdi_8c.html#ac56c05fde8bc30c71af46502e97fae3b">update_conf</a>(p0);
<a name="l05322"></a>05322    <a class="code" href="chan__dahdi_8c.html#ac56c05fde8bc30c71af46502e97fae3b">update_conf</a>(p1);
<a name="l05323"></a>05323    t0 = p0-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a>;
<a name="l05324"></a>05324    t1 = p1-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a>;
<a name="l05325"></a>05325 
<a name="l05326"></a>05326    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p0-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l05327"></a>05327    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p1-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l05328"></a>05328 
<a name="l05329"></a>05329    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c0);
<a name="l05330"></a>05330    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c1);
<a name="l05331"></a>05331 
<a name="l05332"></a>05332    <span class="comment">/* Native bridge failed */</span>
<a name="l05333"></a>05333    <span class="keywordflow">if</span> ((!master || !slave) &amp;&amp; !nothingok) {
<a name="l05334"></a>05334       <a class="code" href="chan__dahdi_8c.html#a8c34a5bce2b26d056942349217806312">dahdi_enable_ec</a>(p0);
<a name="l05335"></a>05335       <a class="code" href="chan__dahdi_8c.html#a8c34a5bce2b26d056942349217806312">dahdi_enable_ec</a>(p1);
<a name="l05336"></a>05336       <span class="keywordflow">return</span> <a class="code" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05afcae35649bbc24a8c2080bec8d592c40">AST_BRIDGE_FAILED</a>;
<a name="l05337"></a>05337    }
<a name="l05338"></a>05338 
<a name="l05339"></a>05339    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Native bridging %s and %s\n&quot;</span>, c0-&gt;name, c1-&gt;name);
<a name="l05340"></a>05340 
<a name="l05341"></a>05341    <span class="keywordflow">if</span> (!(<a class="code" href="structast__channel.html#ac92588540e8c1d014a08cd8a45462b19">flags</a> &amp; <a class="code" href="channel_8h.html#a2bd5879255a0f6a758c99b58fcab2f27" title="Report DTMF on channel 0.">AST_BRIDGE_DTMF_CHANNEL_0</a>) &amp;&amp; (oi0 == <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>))
<a name="l05342"></a>05342       <a class="code" href="chan__dahdi_8c.html#aeada40549c047d105e67ee036e638d85">disable_dtmf_detect</a>(op0);
<a name="l05343"></a>05343 
<a name="l05344"></a>05344    <span class="keywordflow">if</span> (!(<a class="code" href="structast__channel.html#ac92588540e8c1d014a08cd8a45462b19">flags</a> &amp; <a class="code" href="channel_8h.html#a7dbb6edabad3e02e80d605ca5d254c35" title="Report DTMF on channel 1.">AST_BRIDGE_DTMF_CHANNEL_1</a>) &amp;&amp; (oi1 == <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>))
<a name="l05345"></a>05345       <a class="code" href="chan__dahdi_8c.html#aeada40549c047d105e67ee036e638d85">disable_dtmf_detect</a>(op1);
<a name="l05346"></a>05346 
<a name="l05347"></a>05347    <span class="keywordflow">for</span> (;;) {
<a name="l05348"></a>05348       <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c0_priority[2] = {c0, c1};
<a name="l05349"></a>05349       <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c1_priority[2] = {c1, c0};
<a name="l05350"></a>05350 
<a name="l05351"></a>05351       <span class="comment">/* Here&apos;s our main loop...  Start by locking things, looking for private parts,</span>
<a name="l05352"></a>05352 <span class="comment">         and then balking if anything is wrong */</span>
<a name="l05353"></a>05353 
<a name="l05354"></a>05354       <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(c0);
<a name="l05355"></a>05355       <span class="keywordflow">while</span> (<a class="code" href="lock_8h.html#a8b8532d377bd19e8411000ddccfa6607" title="Try locking a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_trylock</a>(c1)) {
<a name="l05356"></a>05356          <a class="code" href="lock_8h.html#a7b1d6c8183a6f6f42a98239da3d1c7ca">CHANNEL_DEADLOCK_AVOIDANCE</a>(c0);
<a name="l05357"></a>05357       }
<a name="l05358"></a>05358 
<a name="l05359"></a>05359       p0 = c0-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l05360"></a>05360       p1 = c1-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l05361"></a>05361 
<a name="l05362"></a>05362       <span class="keywordflow">if</span> (op0 == p0)
<a name="l05363"></a>05363          i0 = <a class="code" href="chan__dahdi_8c.html#a62c8e3f411fb9e5ec62a1e77c152c2df">dahdi_get_index</a>(c0, p0, 1);
<a name="l05364"></a>05364       <span class="keywordflow">if</span> (op1 == p1)
<a name="l05365"></a>05365          i1 = <a class="code" href="chan__dahdi_8c.html#a62c8e3f411fb9e5ec62a1e77c152c2df">dahdi_get_index</a>(c1, p1, 1);
<a name="l05366"></a>05366 
<a name="l05367"></a>05367       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c0);
<a name="l05368"></a>05368       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c1);
<a name="l05369"></a>05369 
<a name="l05370"></a>05370       <span class="keywordflow">if</span> (!timeoutms ||
<a name="l05371"></a>05371          (op0 != p0) ||
<a name="l05372"></a>05372          (op1 != p1) ||
<a name="l05373"></a>05373          (ofd0 != c0-&gt;<a class="code" href="structast__channel.html#aef68cd3879b791a3b6c12cdb750f8e6a">fds</a>[0]) ||
<a name="l05374"></a>05374          (ofd1 != c1-&gt;<a class="code" href="structast__channel.html#aef68cd3879b791a3b6c12cdb750f8e6a">fds</a>[0]) ||
<a name="l05375"></a>05375          (p0-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> &amp;&amp; (os0 &gt; -1) &amp;&amp; (os0 != p0-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a>)) ||
<a name="l05376"></a>05376          (p1-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> &amp;&amp; (os1 &gt; -1) &amp;&amp; (os1 != p1-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a>)) ||
<a name="l05377"></a>05377          (oc0 != p0-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) ||
<a name="l05378"></a>05378          (oc1 != p1-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) ||
<a name="l05379"></a>05379          (t0 != p0-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a>) ||
<a name="l05380"></a>05380          (t1 != p1-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a>) ||
<a name="l05381"></a>05381          (oi0 != i0) ||
<a name="l05382"></a>05382          (oi1 != i1)) {
<a name="l05383"></a>05383          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Something changed out on %d/%d to %d/%d, returning -3 to restart\n&quot;</span>,
<a name="l05384"></a>05384             op0-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, oi0, op1-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, oi1);
<a name="l05385"></a>05385          res = <a class="code" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05ac83c1441a620f7bdae5ef84692f8e7a5">AST_BRIDGE_RETRY</a>;
<a name="l05386"></a>05386          <span class="keywordflow">goto</span> return_from_bridge;
<a name="l05387"></a>05387       }
<a name="l05388"></a>05388 
<a name="l05389"></a>05389 <span class="preprocessor">#ifdef PRI_2BCT</span>
<a name="l05390"></a>05390 <span class="preprocessor"></span>      q931c0 = p0-&gt;call;
<a name="l05391"></a>05391       q931c1 = p1-&gt;call;
<a name="l05392"></a>05392       <span class="keywordflow">if</span> (p0-&gt;<a class="code" href="structdahdi__pvt.html#ad9e41a9a2b63c1e9bad00df4c2bfc92e" title="TRUE if call transfer is enabled.">transfer</a> &amp;&amp; p1-&gt;<a class="code" href="structdahdi__pvt.html#ad9e41a9a2b63c1e9bad00df4c2bfc92e" title="TRUE if call transfer is enabled.">transfer</a>
<a name="l05393"></a>05393          &amp;&amp; q931c0 &amp;&amp; q931c1
<a name="l05394"></a>05394          &amp;&amp; !triedtopribridge) {
<a name="l05395"></a>05395          pri_channel_bridge(q931c0, q931c1);
<a name="l05396"></a>05396          triedtopribridge = 1;
<a name="l05397"></a>05397       }
<a name="l05398"></a>05398 <span class="preprocessor">#endif</span>
<a name="l05399"></a>05399 <span class="preprocessor"></span>
<a name="l05400"></a>05400       who = <a class="code" href="channel_8h.html#aec8ce59b78afbd3651f3de011f13290a" title="Waits for input on a group of channels Wait for input on an array of channels for...">ast_waitfor_n</a>(priority ? c0_priority : c1_priority, 2, &amp;timeoutms);
<a name="l05401"></a>05401       <span class="keywordflow">if</span> (!who) {
<a name="l05402"></a>05402          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Ooh, empty read...\n&quot;</span>);
<a name="l05403"></a>05403          <span class="keywordflow">continue</span>;
<a name="l05404"></a>05404       }
<a name="l05405"></a>05405       f = <a class="code" href="channel_8h.html#a7ef6737309dc9e8b6c4a7cb4800638b1" title="Reads a frame.">ast_read</a>(who);
<a name="l05406"></a>05406       <span class="keywordflow">if</span> (!f || (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>)) {
<a name="l05407"></a>05407          *fo = f;
<a name="l05408"></a>05408          *rc = who;
<a name="l05409"></a>05409          res = <a class="code" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05ada47e397237355168a082a189cf13ee1">AST_BRIDGE_COMPLETE</a>;
<a name="l05410"></a>05410          <span class="keywordflow">goto</span> return_from_bridge;
<a name="l05411"></a>05411       }
<a name="l05412"></a>05412       <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#a248afd6c02044259a386f6b7aee922a2">AST_FRAME_DTMF</a>) {
<a name="l05413"></a>05413          <span class="keywordflow">if</span> ((who == c0) &amp;&amp; p0-&gt;<a class="code" href="structdahdi__pvt.html#ae56835e2739c5d155391c01485455497" title="TRUE if a pulsed digit was detected. (Pulse dial phone detected).">pulsedial</a>) {
<a name="l05414"></a>05414             <a class="code" href="channel_8h.html#a79c413d51b7135404d5cacf811649a61" title="Write a frame to a channel This function writes the given frame to the indicated...">ast_write</a>(c1, f);
<a name="l05415"></a>05415          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((who == c1) &amp;&amp; p1-&gt;<a class="code" href="structdahdi__pvt.html#ae56835e2739c5d155391c01485455497" title="TRUE if a pulsed digit was detected. (Pulse dial phone detected).">pulsedial</a>) {
<a name="l05416"></a>05416             <a class="code" href="channel_8h.html#a79c413d51b7135404d5cacf811649a61" title="Write a frame to a channel This function writes the given frame to the indicated...">ast_write</a>(c0, f);
<a name="l05417"></a>05417          } <span class="keywordflow">else</span> {
<a name="l05418"></a>05418             *fo = f;
<a name="l05419"></a>05419             *rc = who;
<a name="l05420"></a>05420             res = <a class="code" href="channel_8h.html#aadd815141298769e39efd4c3f70a7f05ada47e397237355168a082a189cf13ee1">AST_BRIDGE_COMPLETE</a>;
<a name="l05421"></a>05421             <span class="keywordflow">goto</span> return_from_bridge;
<a name="l05422"></a>05422          }
<a name="l05423"></a>05423       }
<a name="l05424"></a>05424       <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l05425"></a>05425 
<a name="l05426"></a>05426       <span class="comment">/* Swap who gets priority */</span>
<a name="l05427"></a>05427       priority = !priority;
<a name="l05428"></a>05428    }
<a name="l05429"></a>05429 
<a name="l05430"></a>05430 return_from_bridge:
<a name="l05431"></a>05431    <span class="keywordflow">if</span> (op0 == p0)
<a name="l05432"></a>05432       <a class="code" href="chan__dahdi_8c.html#a8c34a5bce2b26d056942349217806312">dahdi_enable_ec</a>(p0);
<a name="l05433"></a>05433 
<a name="l05434"></a>05434    <span class="keywordflow">if</span> (op1 == p1)
<a name="l05435"></a>05435       <a class="code" href="chan__dahdi_8c.html#a8c34a5bce2b26d056942349217806312">dahdi_enable_ec</a>(p1);
<a name="l05436"></a>05436 
<a name="l05437"></a>05437    <span class="keywordflow">if</span> (!(<a class="code" href="structast__channel.html#ac92588540e8c1d014a08cd8a45462b19">flags</a> &amp; AST_BRIDGE_DTMF_CHANNEL_0) &amp;&amp; (oi0 == <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>))
<a name="l05438"></a>05438       <a class="code" href="chan__dahdi_8c.html#a0baab1d1f0651b64e22d0a095c2027a9">enable_dtmf_detect</a>(op0);
<a name="l05439"></a>05439 
<a name="l05440"></a>05440    <span class="keywordflow">if</span> (!(<a class="code" href="structast__channel.html#ac92588540e8c1d014a08cd8a45462b19">flags</a> &amp; AST_BRIDGE_DTMF_CHANNEL_1) &amp;&amp; (oi1 == <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>))
<a name="l05441"></a>05441       <a class="code" href="chan__dahdi_8c.html#a0baab1d1f0651b64e22d0a095c2027a9">enable_dtmf_detect</a>(op1);
<a name="l05442"></a>05442 
<a name="l05443"></a>05443    <a class="code" href="chan__dahdi_8c.html#a3e2349a75e5e78bd2168860df8746d49">dahdi_unlink</a>(slave, master, 1);
<a name="l05444"></a>05444 
<a name="l05445"></a>05445    <span class="keywordflow">return</span> res;
<a name="l05446"></a>05446 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab19867f6a8bde75e5c273e0f16e1e271"></a><!-- doxytag: member="chan_dahdi.c::dahdi_call" ref="ab19867f6a8bde75e5c273e0f16e1e271" args="(struct ast_channel *ast, char *rdest, int timeout)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int dahdi_call </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>ast</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>rdest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>timeout</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l03101">3101</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00469">ast_channel::_state</a>, <a class="el" href="chan__dahdi_8c_source.html#l00697">dahdi_pvt::answeronpolarityswitch</a>, <a class="el" href="callerid_8c_source.html#l01062">ast_callerid_generate()</a>, <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="chan__dahdi_8c_source.html#l00209">AST_LAW</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="astmm_8h_source.html#l00081">ast_malloc</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="channel_8c_source.html#l04695">ast_setstate()</a>, <a class="el" href="channel_8h_source.html#l00366">AST_STATE_BUSY</a>, <a class="el" href="channel_8h_source.html#l00362">AST_STATE_DIALING</a>, <a class="el" href="channel_8h_source.html#l00359">AST_STATE_DOWN</a>, <a class="el" href="channel_8h_source.html#l00361">AST_STATE_OFFHOOK</a>, <a class="el" href="channel_8h_source.html#l00360">AST_STATE_RESERVED</a>, <a class="el" href="channel_8h_source.html#l00364">AST_STATE_RINGING</a>, <a class="el" href="channel_8h_source.html#l00365">AST_STATE_UP</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="channel_8c_source.html#l00690">ast_transfercapability2str()</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="chan__dahdi_8c_source.html#l01011">dahdi_pvt::callwait_name</a>, <a class="el" href="chan__dahdi_8c_source.html#l01009">dahdi_pvt::callwait_num</a>, <a class="el" href="chan__dahdi_8c_source.html#l01070">dahdi_pvt::callwaitcas</a>, <a class="el" href="chan__dahdi_8c_source.html#l01072">dahdi_pvt::callwaitrings</a>, <a class="el" href="chan__dahdi_8c_source.html#l01501">CANPROGRESSDETECT</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="channel_8h_source.html#l00444">ast_channel::cid</a>, <a class="el" href="channel_8h_source.html#l00208">ast_callerid::cid_ani2</a>, <a class="el" href="channel_8h_source.html#l00204">ast_callerid::cid_name</a>, <a class="el" href="channel_8h_source.html#l00203">ast_callerid::cid_num</a>, <a class="el" href="channel_8h_source.html#l00207">ast_callerid::cid_pres</a>, <a class="el" href="channel_8h_source.html#l00206">ast_callerid::cid_rdnis</a>, <a class="el" href="chan__dahdi_8c_source.html#l01054">dahdi_pvt::cidlen</a>, <a class="el" href="chan__dahdi_8c_source.html#l01052">dahdi_pvt::cidpos</a>, <a class="el" href="chan__dahdi_8c_source.html#l01146">dahdi_pvt::cidrings</a>, <a class="el" href="chan__dahdi_8c_source.html#l01050">dahdi_pvt::cidspill</a>, <a class="el" href="chan__dahdi_8c_source.html#l03059">dahdi_callwait()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01503">dahdi_get_index()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="chan__dahdi_8c_source.html#l01133">dahdi_pvt::dialdest</a>, <a class="el" href="chan__dahdi_8c_source.html#l00743">dahdi_pvt::dialednone</a>, <a class="el" href="chan__dahdi_8c_source.html#l00745">dahdi_pvt::dialing</a>, <a class="el" href="chan__dahdi_8c_source.html#l00747">dahdi_pvt::digital</a>, <a class="el" href="chan__dahdi_8c_source.html#l01145">dahdi_pvt::distinctivering</a>, <a class="el" href="chan__dahdi_8c_source.html#l01116">dahdi_pvt::dop</a>, <a class="el" href="chan__dahdi_8c_source.html#l01113">dahdi_pvt::dsp</a>, <a class="el" href="chan__dahdi_8c_source.html#l00751">dahdi_pvt::echobreak</a>, <a class="el" href="chan__dahdi_8c_source.html#l01084">dahdi_pvt::echorest</a>, <a class="el" href="chan__dahdi_8c_source.html#l01082">dahdi_pvt::echotraining</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="chan__dahdi_8c_source.html#l01119">dahdi_pvt::finaldial</a>, <a class="el" href="chan__dahdi_8c_source.html#l00772">dahdi_pvt::hanguponpolarityswitch</a>, <a class="el" href="chan__dahdi_8c_source.html#l00781">dahdi_pvt::hidecallerid</a>, <a class="el" href="chan__dahdi_8c_source.html#l00787">dahdi_pvt::hidecalleridname</a>, <a class="el" href="transcap_8h_source.html#l00043">IS_DIGITAL</a>, <a class="el" href="chan__dahdi_8c_source.html#l01005">dahdi_pvt::lastcid_name</a>, <a class="el" href="chan__dahdi_8c_source.html#l01003">dahdi_pvt::lastcid_num</a>, <a class="el" href="chan__dahdi_8c_source.html#l01022">dahdi_pvt::law</a>, <a class="el" href="chan__dahdi_8c_source.html#l00649">dahdi_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00119">LOG_DEBUG</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="callerid_8h_source.html#l00048">MAX_CALLERID_SIZE</a>, <a class="el" href="chan__dahdi_8c_source.html#l00613">dahdi_subchannel::needbusy</a>, <a class="el" href="chan__dahdi_8c_source.html#l00612">dahdi_subchannel::needringing</a>, <a class="el" href="chan__dahdi_8c_source.html#l00673">dahdi_pvt::oprmode</a>, <a class="el" href="chan__dahdi_8c_source.html#l00801">dahdi_pvt::outgoing</a>, <a class="el" href="chan__dahdi_8c_source.html#l00672">dahdi_pvt::outsigmod</a>, <a class="el" href="chan__dahdi_8c_source.html#l00650">dahdi_pvt::owner</a>, <a class="el" href="pbx_8c_source.html#l08951">pbx_builtin_getvar_helper()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01156">dahdi_pvt::polaritydelaytv</a>, <a class="el" href="isdn__lib_8h_source.html#l00666">PRI_TRANS_CAP_DIGITAL</a>, <a class="el" href="chan__dahdi_8c_source.html#l00823">dahdi_pvt::priexclusive</a>, <a class="el" href="chan__dahdi_8c_source.html#l00828">dahdi_pvt::pulse</a>, <a class="el" href="chan__dahdi_8c_source.html#l00671">dahdi_pvt::radio</a>, <a class="el" href="chan__dahdi_8c_source.html#l00678">dahdi_pvt::rxgain</a>, <a class="el" href="aesopt_8h_source.html#l00399">s</a>, <a class="el" href="chan__dahdi_8c_source.html#l03026">send_callerid()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01161">dahdi_pvt::sendcalleridafter</a>, <a class="el" href="chan__dahdi_8c_source.html#l02831">set_actual_gain()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00666">dahdi_pvt::sig</a>, <a class="el" href="chan__dahdi_8c_source.html#l00256">SIG_BRI</a>, <a class="el" href="chan__dahdi_8c_source.html#l00257">SIG_BRI_PTMP</a>, <a class="el" href="chan__dahdi_8c_source.html#l00245">SIG_E911</a>, <a class="el" href="chan__dahdi_8c_source.html#l00240">SIG_EM</a>, <a class="el" href="chan__dahdi_8c_source.html#l00265">SIG_EM_E1</a>, <a class="el" href="chan__dahdi_8c_source.html#l00241">SIG_EMWINK</a>, <a class="el" href="chan__dahdi_8c_source.html#l00244">SIG_FEATB</a>, <a class="el" href="chan__dahdi_8c_source.html#l00242">SIG_FEATD</a>, <a class="el" href="chan__dahdi_8c_source.html#l00243">SIG_FEATDMF</a>, <a class="el" href="chan__dahdi_8c_source.html#l00246">SIG_FEATDMF_TA</a>, <a class="el" href="chan__dahdi_8c_source.html#l00247">SIG_FGC_CAMA</a>, <a class="el" href="chan__dahdi_8c_source.html#l00248">SIG_FGC_CAMAMF</a>, <a class="el" href="chan__dahdi_8c_source.html#l00253">SIG_FXOGS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00254">SIG_FXOKS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00252">SIG_FXOLS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00250">SIG_FXSGS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00251">SIG_FXSKS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00249">SIG_FXSLS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00259">SIG_MFCR2</a>, <a class="el" href="chan__dahdi_8c_source.html#l00255">SIG_PRI</a>, <a class="el" href="chan__dahdi_8c_source.html#l00260">SIG_SF</a>, <a class="el" href="chan__dahdi_8c_source.html#l00264">SIG_SF_FEATB</a>, <a class="el" href="chan__dahdi_8c_source.html#l00262">SIG_SF_FEATD</a>, <a class="el" href="chan__dahdi_8c_source.html#l00263">SIG_SF_FEATDMF</a>, <a class="el" href="chan__dahdi_8c_source.html#l00261">SIG_SFWINK</a>, <a class="el" href="chan__dahdi_8c_source.html#l00258">SIG_SS7</a>, <a class="el" href="chan__dahdi_8c_source.html#l01068">dahdi_pvt::stripmsd</a>, <a class="el" href="chan__dahdi_8c_source.html#l00580">SUB_CALLWAIT</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>, <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>, <a class="el" href="channel_8h_source.html#l00493">ast_channel::transfercapability</a>, <a class="el" href="chan__dahdi_8c_source.html#l00680">dahdi_pvt::txgain</a>, <a class="el" href="chan__dahdi_8c_source.html#l00859">dahdi_pvt::use_callerid</a>, <a class="el" href="chan__dahdi_8c_source.html#l00866">dahdi_pvt::use_callingpres</a>, <a class="el" href="chan__dahdi_8c_source.html#l01109">dahdi_pvt::waitfordialtone</a>, <a class="el" href="chan__dahdi_8c_source.html#l01110">dahdi_pvt::waitingfordt</a>, and <a class="el" href="chan__dahdi_8c_source.html#l01117">dahdi_pvt::whichwink</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03102"></a>03102 {
<a name="l03103"></a>03103    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *p = ast-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l03104"></a>03104    <span class="keywordtype">int</span> x, res, idx,mysig;
<a name="l03105"></a>03105    <span class="keywordtype">char</span> *c, *n, *l;
<a name="l03106"></a>03106 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l03107"></a>03107 <span class="preprocessor"></span>   <span class="keywordtype">char</span> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a> = NULL;
<a name="l03108"></a>03108 <span class="preprocessor">#endif</span>
<a name="l03109"></a>03109 <span class="preprocessor"></span>   <span class="keywordtype">char</span> dest[256]; <span class="comment">/* must be same length as p-&gt;dialdest */</span>
<a name="l03110"></a>03110    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l03111"></a>03111    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(dest, rdest, <span class="keyword">sizeof</span>(dest));
<a name="l03112"></a>03112    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a0368d49962f1bf26c2603ade03cd8ee9" title="Delayed dialing for E911. Overlap digits for ISDN.">dialdest</a>, rdest, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structdahdi__pvt.html#a0368d49962f1bf26c2603ade03cd8ee9" title="Delayed dialing for E911. Overlap digits for ISDN.">dialdest</a>));
<a name="l03113"></a>03113    <span class="keywordflow">if</span> ((ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa00d313d1a4f4502932f1c10bd619591">AST_STATE_BUSY</a>)) {
<a name="l03114"></a>03114       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#acff5e006a504c765d6519826b2eedfbb">needbusy</a> = 1;
<a name="l03115"></a>03115       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l03116"></a>03116       <span class="keywordflow">return</span> 0;
<a name="l03117"></a>03117    }
<a name="l03118"></a>03118    <span class="keywordflow">if</span> ((ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a>) &amp;&amp; (ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660addb60fd97b55a4aea24f992e30fe3c84">AST_STATE_RESERVED</a>)) {
<a name="l03119"></a>03119       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;dahdi_call called on %s, neither down nor reserved\n&quot;</span>, ast-&gt;name);
<a name="l03120"></a>03120       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l03121"></a>03121       <span class="keywordflow">return</span> -1;
<a name="l03122"></a>03122    }
<a name="l03123"></a>03123    p-&gt;<a class="code" href="structdahdi__pvt.html#ab9aab7a638e67037d3b01f381ed4beae">waitingfordt</a>.tv_sec = 0;
<a name="l03124"></a>03124    p-&gt;<a class="code" href="structdahdi__pvt.html#a9cfceba897ebb6fc6665c255b9dc0164" title="TRUE if analog type line dialed no digits in Dial().">dialednone</a> = 0;
<a name="l03125"></a>03125    <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structdahdi__pvt.html#ac53b42243ee40edc74b615fe86806fe3" title="Nonzero if the signaling type is sent over a radio.">radio</a> || (p-&gt;<a class="code" href="structdahdi__pvt.html#a3b3cefe7a33d0cff61f3a2b5955b6c8b">oprmode</a> &lt; 0)))  <span class="comment">/* if a radio channel, up immediately */</span>
<a name="l03126"></a>03126    {
<a name="l03127"></a>03127       <span class="comment">/* Special pseudo -- automatically up */</span>
<a name="l03128"></a>03128       <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(ast, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>);
<a name="l03129"></a>03129       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l03130"></a>03130       <span class="keywordflow">return</span> 0;
<a name="l03131"></a>03131    }
<a name="l03132"></a>03132    x = DAHDI_FLUSH_READ | DAHDI_FLUSH_WRITE;
<a name="l03133"></a>03133    res = ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_FLUSH, &amp;x);
<a name="l03134"></a>03134    <span class="keywordflow">if</span> (res)
<a name="l03135"></a>03135       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to flush input on channel %d: %s\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, strerror(errno));
<a name="l03136"></a>03136    p-&gt;<a class="code" href="structdahdi__pvt.html#a40668dcb7d940b80c4f109861059a978" title="TRUE if we originated the call leg.">outgoing</a> = 1;
<a name="l03137"></a>03137 
<a name="l03138"></a>03138    <span class="keywordflow">if</span> (<a class="code" href="transcap_8h.html#a5e35948d3406bb03e04e1725ad491cb0">IS_DIGITAL</a>(ast-&gt;<a class="code" href="structast__channel.html#a67fbfb6a4051ff15a242b9685167f16a">transfercapability</a>)){
<a name="l03139"></a>03139       <a class="code" href="chan__dahdi_8c.html#a6abcbfc59e4d42646f31142d7dd2b830">set_actual_gain</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, 0, 0, 0, p-&gt;<a class="code" href="structdahdi__pvt.html#a17dd7b17c0e736754e01e575ca8d8cb8" title="Active PCM encoding format: DAHDI_LAW_ALAW or DAHDI_LAW_MULAW.">law</a>);
<a name="l03140"></a>03140    } <span class="keywordflow">else</span> {
<a name="l03141"></a>03141       <a class="code" href="chan__dahdi_8c.html#a6abcbfc59e4d42646f31142d7dd2b830">set_actual_gain</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, 0, p-&gt;<a class="code" href="structdahdi__pvt.html#aeebb464c72892c9f3ddafed5ade720ee" title="Rx gain set by chan_dahdi.conf.">rxgain</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#ad291967734f3b7bee3ec179278a1f76f" title="Tx gain set by chan_dahdi.conf.">txgain</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#a17dd7b17c0e736754e01e575ca8d8cb8" title="Active PCM encoding format: DAHDI_LAW_ALAW or DAHDI_LAW_MULAW.">law</a>);
<a name="l03142"></a>03142    }  
<a name="l03143"></a>03143 
<a name="l03144"></a>03144    mysig = p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a>;
<a name="l03145"></a>03145    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a57a35ad748a874002c2b58676e5b2687">outsigmod</a> &gt; -1)
<a name="l03146"></a>03146       mysig = p-&gt;<a class="code" href="structdahdi__pvt.html#a57a35ad748a874002c2b58676e5b2687">outsigmod</a>;
<a name="l03147"></a>03147 
<a name="l03148"></a>03148    <span class="keywordflow">switch</span> (mysig) {
<a name="l03149"></a>03149    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#adb40571aa5ff846fc334be5260eab257">SIG_FXOLS</a>:
<a name="l03150"></a>03150    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a3dcffbaf4a26f2b7b792998df1eea27b">SIG_FXOGS</a>:
<a name="l03151"></a>03151    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a7c9b3bb8225896ff2b9aed27e6f80f10">SIG_FXOKS</a>:
<a name="l03152"></a>03152       <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> == ast) {
<a name="l03153"></a>03153          <span class="comment">/* Normal ring, on hook */</span>
<a name="l03154"></a>03154 
<a name="l03155"></a>03155          <span class="comment">/* Don&apos;t send audio while on hook, until the call is answered */</span>
<a name="l03156"></a>03156          p-&gt;<a class="code" href="structdahdi__pvt.html#af17335c0c7a4c1e03e987a33f6eec81b" title="TRUE if in the process of dialing digits or sending something.">dialing</a> = 1;
<a name="l03157"></a>03157          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#aee1feef8ad729d208a3ab28f0de46658" title="TRUE if caller ID is used on this channel.">use_callerid</a>) {
<a name="l03158"></a>03158             <span class="comment">/* Generate the Caller-ID spill if desired */</span>
<a name="l03159"></a>03159             <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a>) {
<a name="l03160"></a>03160                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;cidspill already exists??\n&quot;</span>);
<a name="l03161"></a>03161                <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a>);
<a name="l03162"></a>03162             }
<a name="l03163"></a>03163             p-&gt;<a class="code" href="structdahdi__pvt.html#a7a4e9b0410dd0636d8f10df9ff51e0a3" title="BOOLEAN. XXX Meaning what??">callwaitcas</a> = 0;
<a name="l03164"></a>03164             <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a> = <a class="code" href="astmm_8h.html#a64a0e7a3ab511a3777ac56f5d43c628e">ast_malloc</a>(<a class="code" href="callerid_8h.html#a532bcb39ca48d514d3765747d5c91f25">MAX_CALLERID_SIZE</a>))) {
<a name="l03165"></a>03165                p-&gt;<a class="code" href="structdahdi__pvt.html#a241dcb75aa2cae2b5c7b899eb95079d0" title="Length of the cidspill buffer containing samples.">cidlen</a> = <a class="code" href="callerid_8h.html#a9700baf9deee60587fa1ef9b7bb9987b" title="Generate Caller-ID spill from the &amp;quot;callerid&amp;quot; field of asterisk (in e-mail...">ast_callerid_generate</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a>, ast-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ab2461abe6e234fe4f763b0a2179184b5">cid_name</a>, ast-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>, <a class="code" href="chan__dahdi_8c.html#a830b5fdb3ba653640d3f5044192d82bf">AST_LAW</a>(p));
<a name="l03166"></a>03166                p-&gt;<a class="code" href="structdahdi__pvt.html#ac0df3c8f4391be85a4d95a23866d4313" title="Position in the cidspill buffer to send out next.">cidpos</a> = 0;
<a name="l03167"></a>03167                <a class="code" href="chan__dahdi_8c.html#ae39659603ab09eecffce6638832c5b73">send_callerid</a>(p);
<a name="l03168"></a>03168             }
<a name="l03169"></a>03169          }
<a name="l03170"></a>03170          <span class="comment">/* Choose proper cadence */</span>
<a name="l03171"></a>03171          <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structdahdi__pvt.html#a64dd7ed4d1e8aebcfe5b84001765d22c">distinctivering</a> &gt; 0) &amp;&amp; (p-&gt;<a class="code" href="structdahdi__pvt.html#a64dd7ed4d1e8aebcfe5b84001765d22c">distinctivering</a> &lt;= <a class="code" href="chan__dahdi_8c.html#ad53fcc6c04d1c32732efa069a128136b">num_cadence</a>)) {
<a name="l03172"></a>03172             <span class="keywordflow">if</span> (ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_SETCADENCE, &amp;<a class="code" href="chan__dahdi_8c.html#ad07d646abd9d3f187412ff33dc665aee">cadences</a>[p-&gt;<a class="code" href="structdahdi__pvt.html#a64dd7ed4d1e8aebcfe5b84001765d22c">distinctivering</a> - 1]))
<a name="l03173"></a>03173                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to set distinctive ring cadence %d on &apos;%s&apos;: %s\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#a64dd7ed4d1e8aebcfe5b84001765d22c">distinctivering</a>, ast-&gt;name, strerror(errno));
<a name="l03174"></a>03174             p-&gt;<a class="code" href="structdahdi__pvt.html#a7ca7134673ead6f14bc255488c0ac15f">cidrings</a> = <a class="code" href="chan__dahdi_8c.html#a441c14817877dfc3ae49ff3aa2907400" title="cidrings says in which pause to transmit the cid information, where the first pause...">cidrings</a>[p-&gt;<a class="code" href="structdahdi__pvt.html#a64dd7ed4d1e8aebcfe5b84001765d22c">distinctivering</a> - 1];
<a name="l03175"></a>03175          } <span class="keywordflow">else</span> {
<a name="l03176"></a>03176             <span class="keywordflow">if</span> (ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_SETCADENCE, NULL))
<a name="l03177"></a>03177                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to reset default ring on &apos;%s&apos;: %s\n&quot;</span>, ast-&gt;name, strerror(errno));
<a name="l03178"></a>03178             p-&gt;<a class="code" href="structdahdi__pvt.html#a7ca7134673ead6f14bc255488c0ac15f">cidrings</a> = p-&gt;<a class="code" href="structdahdi__pvt.html#a311ee33a384e8e54e8d782e584ec4544" title="Send caller ID after this many rings.">sendcalleridafter</a>;
<a name="l03179"></a>03179          }
<a name="l03180"></a>03180 
<a name="l03181"></a>03181          <span class="comment">/* nick@dccinc.com 4/3/03 mods to allow for deferred dialing */</span>
<a name="l03182"></a>03182          c = strchr(dest, <span class="charliteral">&apos;/&apos;</span>);
<a name="l03183"></a>03183          <span class="keywordflow">if</span> (c)
<a name="l03184"></a>03184             c++;
<a name="l03185"></a>03185          <span class="keywordflow">if</span> (c &amp;&amp; (strlen(c) &lt; p-&gt;<a class="code" href="structdahdi__pvt.html#ae485b093be94ace2ac61433abb70d3f1" title="Number of most significant digits/characters to strip from the dialed number.">stripmsd</a>)) {
<a name="l03186"></a>03186             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Number &apos;%s&apos; is shorter than stripmsd (%d)\n&quot;</span>, c, p-&gt;<a class="code" href="structdahdi__pvt.html#ae485b093be94ace2ac61433abb70d3f1" title="Number of most significant digits/characters to strip from the dialed number.">stripmsd</a>);
<a name="l03187"></a>03187             c = NULL;
<a name="l03188"></a>03188          }
<a name="l03189"></a>03189          <span class="keywordflow">if</span> (c) {
<a name="l03190"></a>03190             p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.op = DAHDI_DIAL_OP_REPLACE;
<a name="l03191"></a>03191             snprintf(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr), <span class="stringliteral">&quot;Tw%s&quot;</span>, c);
<a name="l03192"></a>03192             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;FXO: setup deferred dialstring: %s\n&quot;</span>, c);
<a name="l03193"></a>03193          } <span class="keywordflow">else</span> {
<a name="l03194"></a>03194             p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l03195"></a>03195          }
<a name="l03196"></a>03196          x = DAHDI_RING;
<a name="l03197"></a>03197          <span class="keywordflow">if</span> (ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_HOOK, &amp;x) &amp;&amp; (errno != EINPROGRESS)) {
<a name="l03198"></a>03198             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to ring phone: %s\n&quot;</span>, strerror(errno));
<a name="l03199"></a>03199             <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l03200"></a>03200             <span class="keywordflow">return</span> -1;
<a name="l03201"></a>03201          }
<a name="l03202"></a>03202          p-&gt;<a class="code" href="structdahdi__pvt.html#af17335c0c7a4c1e03e987a33f6eec81b" title="TRUE if in the process of dialing digits or sending something.">dialing</a> = 1;
<a name="l03203"></a>03203       } <span class="keywordflow">else</span> {
<a name="l03204"></a>03204          <span class="comment">/* Call waiting call */</span>
<a name="l03205"></a>03205          p-&gt;<a class="code" href="structdahdi__pvt.html#a9c8a40476c67374b9150fcbbb4b993af" title="Number of call waiting rings.">callwaitrings</a> = 0;
<a name="l03206"></a>03206          <span class="keywordflow">if</span> (ast-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>)
<a name="l03207"></a>03207             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a700ba82d6275fe8b33711eca4907b028" title="Call waiting number.">callwait_num</a>, ast-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structdahdi__pvt.html#a700ba82d6275fe8b33711eca4907b028" title="Call waiting number.">callwait_num</a>));
<a name="l03208"></a>03208          <span class="keywordflow">else</span>
<a name="l03209"></a>03209             p-&gt;<a class="code" href="structdahdi__pvt.html#a700ba82d6275fe8b33711eca4907b028" title="Call waiting number.">callwait_num</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l03210"></a>03210          <span class="keywordflow">if</span> (ast-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ab2461abe6e234fe4f763b0a2179184b5">cid_name</a>)
<a name="l03211"></a>03211             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#af6279f03935b629298857a9d76d7e49d" title="Call waiting name.">callwait_name</a>, ast-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ab2461abe6e234fe4f763b0a2179184b5">cid_name</a>, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structdahdi__pvt.html#af6279f03935b629298857a9d76d7e49d" title="Call waiting name.">callwait_name</a>));
<a name="l03212"></a>03212          <span class="keywordflow">else</span>
<a name="l03213"></a>03213             p-&gt;<a class="code" href="structdahdi__pvt.html#af6279f03935b629298857a9d76d7e49d" title="Call waiting name.">callwait_name</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l03214"></a>03214          <span class="comment">/* Call waiting tone instead */</span>
<a name="l03215"></a>03215          <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#a5492a7d85ebc949f2277cd55fbc3febe">dahdi_callwait</a>(ast)) {
<a name="l03216"></a>03216             <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l03217"></a>03217             <span class="keywordflow">return</span> -1;
<a name="l03218"></a>03218          }
<a name="l03219"></a>03219          <span class="comment">/* Make ring-back */</span>
<a name="l03220"></a>03220          <span class="keywordflow">if</span> (tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_RINGTONE))
<a name="l03221"></a>03221             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to generate call-wait ring-back on channel %s\n&quot;</span>, ast-&gt;name);
<a name="l03222"></a>03222       }
<a name="l03223"></a>03223       n = ast-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ab2461abe6e234fe4f763b0a2179184b5">cid_name</a>;
<a name="l03224"></a>03224       l = ast-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>;
<a name="l03225"></a>03225       <span class="keywordflow">if</span> (l)
<a name="l03226"></a>03226          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ac6d55b34cf1c26bff3d105f067f16439" title="Last Caller ID number from an incoming call.">lastcid_num</a>, l, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structdahdi__pvt.html#ac6d55b34cf1c26bff3d105f067f16439" title="Last Caller ID number from an incoming call.">lastcid_num</a>));
<a name="l03227"></a>03227       <span class="keywordflow">else</span>
<a name="l03228"></a>03228          p-&gt;<a class="code" href="structdahdi__pvt.html#ac6d55b34cf1c26bff3d105f067f16439" title="Last Caller ID number from an incoming call.">lastcid_num</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l03229"></a>03229       <span class="keywordflow">if</span> (n)
<a name="l03230"></a>03230          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a9ad2b3a8d00e47a81f82e038fc672348" title="Last Caller ID name from an incoming call.">lastcid_name</a>, n, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structdahdi__pvt.html#a9ad2b3a8d00e47a81f82e038fc672348" title="Last Caller ID name from an incoming call.">lastcid_name</a>));
<a name="l03231"></a>03231       <span class="keywordflow">else</span>
<a name="l03232"></a>03232          p-&gt;<a class="code" href="structdahdi__pvt.html#a9ad2b3a8d00e47a81f82e038fc672348" title="Last Caller ID name from an incoming call.">lastcid_name</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l03233"></a>03233       <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(ast, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa">AST_STATE_RINGING</a>);
<a name="l03234"></a>03234       idx = <a class="code" href="chan__dahdi_8c.html#a62c8e3f411fb9e5ec62a1e77c152c2df">dahdi_get_index</a>(ast, p, 0);
<a name="l03235"></a>03235       <span class="keywordflow">if</span> (idx &gt; -1) {
<a name="l03236"></a>03236          p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a0b09a2171a877eaadb67da4f5639abc4">needringing</a> = 1;
<a name="l03237"></a>03237       }
<a name="l03238"></a>03238       <span class="keywordflow">break</span>;
<a name="l03239"></a>03239    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a1dc50a07aef86c90ab94f1583c35a265">SIG_FXSLS</a>:
<a name="l03240"></a>03240    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a97e4c6fb4680984aafc6e0e55a2b6cb4">SIG_FXSGS</a>:
<a name="l03241"></a>03241    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a38139ec369c0243f4324eb4eb0c2f004">SIG_FXSKS</a>:
<a name="l03242"></a>03242       <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a5a4fb6da5625cc1eec0c9821f0d41d52" title="TRUE if we can use a polarity reversal to mark when an outgoing call is answered...">answeronpolarityswitch</a> || p-&gt;<a class="code" href="structdahdi__pvt.html#a7bc13c53b24817de617833097a940350" title="TRUE if the call will be considered &amp;quot;hung up&amp;quot; on a polarity reversal.">hanguponpolarityswitch</a>) {
<a name="l03243"></a>03243          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Ignore possible polarity reversal on line seizure\n&quot;</span>);
<a name="l03244"></a>03244          p-&gt;<a class="code" href="structdahdi__pvt.html#a7ad8177600d95c8debaba02d2327a171" title="Start delay time if polarityonanswerdelay is nonzero.">polaritydelaytv</a> = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l03245"></a>03245       }
<a name="l03246"></a>03246       <span class="comment">/* fall through */</span>
<a name="l03247"></a>03247    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a1ba988b93fce049075b7c2ef6c931cf9">SIG_EMWINK</a>:
<a name="l03248"></a>03248    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#afa7547cd2cee1bae7734206102635216">SIG_EM</a>:
<a name="l03249"></a>03249    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#aa7b59772722b794c5218768dac3ee419">SIG_EM_E1</a>:
<a name="l03250"></a>03250    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ab79873391af2857a602e1eff68606f23">SIG_FEATD</a>:
<a name="l03251"></a>03251    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a98d4710afc1fcb2ff110eabb4fbcc308">SIG_FEATDMF</a>:
<a name="l03252"></a>03252    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#adfdd0e4d05281d354c15ef1a5d158cd6">SIG_E911</a>:
<a name="l03253"></a>03253    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a167056b2763a4897838c7115efc1f9fc">SIG_FGC_CAMA</a>:
<a name="l03254"></a>03254    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a945e2b5f225d3abdc57b5dcc53daa62a">SIG_FGC_CAMAMF</a>:
<a name="l03255"></a>03255    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a0ba8ec199f5fb4f2be64144be0bd13b1">SIG_FEATB</a>:
<a name="l03256"></a>03256    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a193853e7e76cff05d51425eba48d030f">SIG_SFWINK</a>:
<a name="l03257"></a>03257    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#afacb372d32fba2192ed6a2989c54fbda">SIG_SF</a>:
<a name="l03258"></a>03258    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#aac334a7f88651d9e44499897386d2cfd">SIG_SF_FEATD</a>:
<a name="l03259"></a>03259    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a4625d3aba972e102c8460a9f16af0fc7">SIG_SF_FEATDMF</a>:
<a name="l03260"></a>03260    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ac0c40f74945ed15aa82cd9fedc304e55">SIG_FEATDMF_TA</a>:
<a name="l03261"></a>03261    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a33a2f70a24e9f8ccfcc1e76f208b1ab6">SIG_SF_FEATB</a>:
<a name="l03262"></a>03262       c = strchr(dest, <span class="charliteral">&apos;/&apos;</span>);
<a name="l03263"></a>03263       <span class="keywordflow">if</span> (c)
<a name="l03264"></a>03264          c++;
<a name="l03265"></a>03265       <span class="keywordflow">else</span>
<a name="l03266"></a>03266          c = <span class="stringliteral">&quot;&quot;</span>;
<a name="l03267"></a>03267       <span class="keywordflow">if</span> (strlen(c) &lt; p-&gt;<a class="code" href="structdahdi__pvt.html#ae485b093be94ace2ac61433abb70d3f1" title="Number of most significant digits/characters to strip from the dialed number.">stripmsd</a>) {
<a name="l03268"></a>03268          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Number &apos;%s&apos; is shorter than stripmsd (%d)\n&quot;</span>, c, p-&gt;<a class="code" href="structdahdi__pvt.html#ae485b093be94ace2ac61433abb70d3f1" title="Number of most significant digits/characters to strip from the dialed number.">stripmsd</a>);
<a name="l03269"></a>03269          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l03270"></a>03270          <span class="keywordflow">return</span> -1;
<a name="l03271"></a>03271       }
<a name="l03272"></a>03272 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l03273"></a>03273 <span class="preprocessor"></span>      <span class="comment">/* Start the trunk, if not GR-303 */</span>
<a name="l03274"></a>03274       <span class="keywordflow">if</span> (!p-&gt;pri) {
<a name="l03275"></a>03275 <span class="preprocessor">#endif</span>
<a name="l03276"></a>03276 <span class="preprocessor"></span>         x = DAHDI_START;
<a name="l03277"></a>03277          res = ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_HOOK, &amp;x);
<a name="l03278"></a>03278          <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l03279"></a>03279             <span class="keywordflow">if</span> (errno != EINPROGRESS) {
<a name="l03280"></a>03280                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to start channel: %s\n&quot;</span>, strerror(errno));
<a name="l03281"></a>03281                <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l03282"></a>03282                <span class="keywordflow">return</span> -1;
<a name="l03283"></a>03283             }
<a name="l03284"></a>03284          }
<a name="l03285"></a>03285 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l03286"></a>03286 <span class="preprocessor"></span>      }
<a name="l03287"></a>03287 <span class="preprocessor">#endif</span>
<a name="l03288"></a>03288 <span class="preprocessor"></span>      <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Dialing &apos;%s&apos;\n&quot;</span>, c);
<a name="l03289"></a>03289       p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.op = DAHDI_DIAL_OP_REPLACE;
<a name="l03290"></a>03290 
<a name="l03291"></a>03291       c += p-&gt;<a class="code" href="structdahdi__pvt.html#ae485b093be94ace2ac61433abb70d3f1" title="Number of most significant digits/characters to strip from the dialed number.">stripmsd</a>;
<a name="l03292"></a>03292 
<a name="l03293"></a>03293       <span class="keywordflow">switch</span> (mysig) {
<a name="l03294"></a>03294       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ab79873391af2857a602e1eff68606f23">SIG_FEATD</a>:
<a name="l03295"></a>03295          l = ast-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>;
<a name="l03296"></a>03296          <span class="keywordflow">if</span> (l)
<a name="l03297"></a>03297             snprintf(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr), <span class="stringliteral">&quot;T*%s*%s*&quot;</span>, l, c);
<a name="l03298"></a>03298          <span class="keywordflow">else</span>
<a name="l03299"></a>03299             snprintf(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr), <span class="stringliteral">&quot;T**%s*&quot;</span>, c);
<a name="l03300"></a>03300          <span class="keywordflow">break</span>;
<a name="l03301"></a>03301       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a98d4710afc1fcb2ff110eabb4fbcc308">SIG_FEATDMF</a>:
<a name="l03302"></a>03302          l = ast-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>;
<a name="l03303"></a>03303          <span class="keywordflow">if</span> (l)
<a name="l03304"></a>03304             snprintf(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr), <span class="stringliteral">&quot;M*00%s#*%s#&quot;</span>, l, c);
<a name="l03305"></a>03305          <span class="keywordflow">else</span>
<a name="l03306"></a>03306             snprintf(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr), <span class="stringliteral">&quot;M*02#*%s#&quot;</span>, c);
<a name="l03307"></a>03307          <span class="keywordflow">break</span>;
<a name="l03308"></a>03308       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ac0c40f74945ed15aa82cd9fedc304e55">SIG_FEATDMF_TA</a>:
<a name="l03309"></a>03309       {
<a name="l03310"></a>03310          <span class="keyword">const</span> <span class="keywordtype">char</span> *cic, *ozz;
<a name="l03311"></a>03311 
<a name="l03312"></a>03312          <span class="comment">/* If you have to go through a Tandem Access point you need to use this */</span>
<a name="l03313"></a>03313          ozz = <a class="code" href="pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b" title="Return a pointer to the value of the corresponding channel variable.">pbx_builtin_getvar_helper</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <span class="stringliteral">&quot;FEATDMF_OZZ&quot;</span>);
<a name="l03314"></a>03314          <span class="keywordflow">if</span> (!ozz)
<a name="l03315"></a>03315             ozz = <a class="code" href="chan__dahdi_8c.html#ad7f989de9c9e4e717bf8991708c9814d">defaultozz</a>;
<a name="l03316"></a>03316          cic = <a class="code" href="pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b" title="Return a pointer to the value of the corresponding channel variable.">pbx_builtin_getvar_helper</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <span class="stringliteral">&quot;FEATDMF_CIC&quot;</span>);
<a name="l03317"></a>03317          <span class="keywordflow">if</span> (!cic)
<a name="l03318"></a>03318             cic = <a class="code" href="chan__dahdi_8c.html#a9ddac9567291bb4eb61b3989fae45780">defaultcic</a>;
<a name="l03319"></a>03319          <span class="keywordflow">if</span> (!ozz || !cic) {
<a name="l03320"></a>03320             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to dial channel of type feature group D MF tandem access without CIC or OZZ set\n&quot;</span>);
<a name="l03321"></a>03321             <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l03322"></a>03322             <span class="keywordflow">return</span> -1;
<a name="l03323"></a>03323          }
<a name="l03324"></a>03324          snprintf(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr), <span class="stringliteral">&quot;M*%s%s#&quot;</span>, ozz, cic);
<a name="l03325"></a>03325          snprintf(p-&gt;<a class="code" href="structdahdi__pvt.html#ad85d116dfc33464946da211c8a8fcb99" title="Second part of SIG_FEATDMF_TA wink operation.">finaldial</a>, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structdahdi__pvt.html#ad85d116dfc33464946da211c8a8fcb99" title="Second part of SIG_FEATDMF_TA wink operation.">finaldial</a>), <span class="stringliteral">&quot;M*%s#&quot;</span>, c);
<a name="l03326"></a>03326          p-&gt;<a class="code" href="structdahdi__pvt.html#a448acac556be429cac9617bbdb402145">whichwink</a> = 0;
<a name="l03327"></a>03327       }
<a name="l03328"></a>03328          <span class="keywordflow">break</span>;
<a name="l03329"></a>03329       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#adfdd0e4d05281d354c15ef1a5d158cd6">SIG_E911</a>:
<a name="l03330"></a>03330          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr, <span class="stringliteral">&quot;M*911#&quot;</span>, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr));
<a name="l03331"></a>03331          <span class="keywordflow">break</span>;
<a name="l03332"></a>03332       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a167056b2763a4897838c7115efc1f9fc">SIG_FGC_CAMA</a>:
<a name="l03333"></a>03333          snprintf(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr), <span class="stringliteral">&quot;P%s&quot;</span>, c);
<a name="l03334"></a>03334          <span class="keywordflow">break</span>;
<a name="l03335"></a>03335       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a945e2b5f225d3abdc57b5dcc53daa62a">SIG_FGC_CAMAMF</a>:
<a name="l03336"></a>03336       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a0ba8ec199f5fb4f2be64144be0bd13b1">SIG_FEATB</a>:
<a name="l03337"></a>03337          snprintf(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr), <span class="stringliteral">&quot;M*%s#&quot;</span>, c);
<a name="l03338"></a>03338          <span class="keywordflow">break</span>;
<a name="l03339"></a>03339       <span class="keywordflow">default</span>:
<a name="l03340"></a>03340          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a68d59a550fd5b3d5ce6d59388044ad63" title="TRUE if we will pulse dial.">pulse</a>)
<a name="l03341"></a>03341             snprintf(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr), <span class="stringliteral">&quot;P%sw&quot;</span>, c);
<a name="l03342"></a>03342          <span class="keywordflow">else</span>
<a name="l03343"></a>03343             snprintf(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr), <span class="stringliteral">&quot;T%sw&quot;</span>, c);
<a name="l03344"></a>03344          <span class="keywordflow">break</span>;
<a name="l03345"></a>03345       }
<a name="l03346"></a>03346 
<a name="l03347"></a>03347       <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a6c8f2e86376f982c0d9e709736787a51" title="Echo training time. 0 = disabled.">echotraining</a> &amp;&amp; (strlen(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr) &gt; 4)) {
<a name="l03348"></a>03348          memset(p-&gt;<a class="code" href="structdahdi__pvt.html#aa407dc4f683f66545461a5854c2ccff2" title="Filled with &amp;#39;w&amp;#39;. XXX Purpose??">echorest</a>, <span class="charliteral">&apos;w&apos;</span>, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structdahdi__pvt.html#aa407dc4f683f66545461a5854c2ccff2" title="Filled with &amp;#39;w&amp;#39;. XXX Purpose??">echorest</a>) - 1);
<a name="l03349"></a>03349          strcpy(p-&gt;<a class="code" href="structdahdi__pvt.html#aa407dc4f683f66545461a5854c2ccff2" title="Filled with &amp;#39;w&amp;#39;. XXX Purpose??">echorest</a> + (p-&gt;<a class="code" href="structdahdi__pvt.html#a6c8f2e86376f982c0d9e709736787a51" title="Echo training time. 0 = disabled.">echotraining</a> / 400) + 1, p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr + strlen(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr) - 2);
<a name="l03350"></a>03350          p-&gt;<a class="code" href="structdahdi__pvt.html#aa407dc4f683f66545461a5854c2ccff2" title="Filled with &amp;#39;w&amp;#39;. XXX Purpose??">echorest</a>[<span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structdahdi__pvt.html#aa407dc4f683f66545461a5854c2ccff2" title="Filled with &amp;#39;w&amp;#39;. XXX Purpose??">echorest</a>) - 1] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l03351"></a>03351          p-&gt;<a class="code" href="structdahdi__pvt.html#a8c759f824385c61bf3d4f56ad757ea76" title="XXX BOOLEAN Purpose???">echobreak</a> = 1;
<a name="l03352"></a>03352          p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr[strlen(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr)-2] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l03353"></a>03353       } <span class="keywordflow">else</span>
<a name="l03354"></a>03354          p-&gt;<a class="code" href="structdahdi__pvt.html#a8c759f824385c61bf3d4f56ad757ea76" title="XXX BOOLEAN Purpose???">echobreak</a> = 0;
<a name="l03355"></a>03355 
<a name="l03356"></a>03356       <span class="comment">/* waitfordialtone ? */</span>
<a name="l03357"></a>03357 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l03358"></a>03358 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (!p-&gt;pri) {
<a name="l03359"></a>03359 <span class="preprocessor">#endif</span>
<a name="l03360"></a>03360 <span class="preprocessor"></span>         <span class="keywordflow">if</span>( p-&gt;<a class="code" href="structdahdi__pvt.html#a508c2407a52638696697fdeb08f0b2e5" title="Number of milliseconds to wait for dialtone.">waitfordialtone</a> &amp;&amp; <a class="code" href="chan__dahdi_8c.html#aa40ff55dfcec4b66be7bbaec05993fad">CANPROGRESSDETECT</a>(p) &amp;&amp; p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a> ) {
<a name="l03361"></a>03361             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;Defer dialling for %dms or dialtone\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#a508c2407a52638696697fdeb08f0b2e5" title="Number of milliseconds to wait for dialtone.">waitfordialtone</a>);
<a name="l03362"></a>03362             gettimeofday(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#ab9aab7a638e67037d3b01f381ed4beae">waitingfordt</a>,NULL);
<a name="l03363"></a>03363             <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(ast, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a9d7b264ddca4b05135add5d9d48e6271">AST_STATE_OFFHOOK</a>);
<a name="l03364"></a>03364             <span class="keywordflow">break</span>;
<a name="l03365"></a>03365          }
<a name="l03366"></a>03366 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l03367"></a>03367 <span class="preprocessor"></span>      }
<a name="l03368"></a>03368 <span class="preprocessor">#endif</span>
<a name="l03369"></a>03369 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (!res) {
<a name="l03370"></a>03370          <span class="keywordflow">if</span> (ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_DIAL, &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>)) {
<a name="l03371"></a>03371             <span class="keywordtype">int</span> saveerr = <a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;
<a name="l03372"></a>03372 
<a name="l03373"></a>03373             x = DAHDI_ONHOOK;
<a name="l03374"></a>03374             ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_HOOK, &amp;x);
<a name="l03375"></a>03375             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Dialing failed on channel %d: %s\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, strerror(saveerr));
<a name="l03376"></a>03376             <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l03377"></a>03377             <span class="keywordflow">return</span> -1;
<a name="l03378"></a>03378          }
<a name="l03379"></a>03379       } <span class="keywordflow">else</span>
<a name="l03380"></a>03380          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Deferring dialing...\n&quot;</span>);
<a name="l03381"></a>03381 
<a name="l03382"></a>03382       p-&gt;<a class="code" href="structdahdi__pvt.html#af17335c0c7a4c1e03e987a33f6eec81b" title="TRUE if in the process of dialing digits or sending something.">dialing</a> = 1;
<a name="l03383"></a>03383       <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(c))
<a name="l03384"></a>03384          p-&gt;<a class="code" href="structdahdi__pvt.html#a9cfceba897ebb6fc6665c255b9dc0164" title="TRUE if analog type line dialed no digits in Dial().">dialednone</a> = 1;
<a name="l03385"></a>03385       <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(ast, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa70881e902c6c29f27ffba80bb43554f">AST_STATE_DIALING</a>);
<a name="l03386"></a>03386       <span class="keywordflow">break</span>;
<a name="l03387"></a>03387    <span class="keywordflow">case</span> 0:
<a name="l03388"></a>03388       <span class="comment">/* Special pseudo -- automatically up*/</span>
<a name="l03389"></a>03389       <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(ast, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>);
<a name="l03390"></a>03390       <span class="keywordflow">break</span>;
<a name="l03391"></a>03391    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ae9ab0c9508fca045a06730533be276a5">SIG_PRI</a>:
<a name="l03392"></a>03392    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ab5bfeaf991c23c5b6510ace44ae79ce9">SIG_BRI</a>:
<a name="l03393"></a>03393    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a>:
<a name="l03394"></a>03394    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#aadcda889db3cf9dfe757dbc1d4d8311a">SIG_SS7</a>:
<a name="l03395"></a>03395    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a1d73a98ae12601287580dedd9a6d739b">SIG_MFCR2</a>:
<a name="l03396"></a>03396       <span class="comment">/* We&apos;ll get it in a moment -- but use dialdest to store pre-setup_ack digits */</span>
<a name="l03397"></a>03397       p-&gt;<a class="code" href="structdahdi__pvt.html#a0368d49962f1bf26c2603ade03cd8ee9" title="Delayed dialing for E911. Overlap digits for ISDN.">dialdest</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l03398"></a>03398       p-&gt;<a class="code" href="structdahdi__pvt.html#af17335c0c7a4c1e03e987a33f6eec81b" title="TRUE if in the process of dialing digits or sending something.">dialing</a> = 1;
<a name="l03399"></a>03399       <span class="keywordflow">break</span>;
<a name="l03400"></a>03400    <span class="keywordflow">default</span>:
<a name="l03401"></a>03401       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;not yet implemented\n&quot;</span>);
<a name="l03402"></a>03402       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l03403"></a>03403       <span class="keywordflow">return</span> -1;
<a name="l03404"></a>03404    }
<a name="l03405"></a>03405 <span class="preprocessor">#ifdef HAVE_SS7</span>
<a name="l03406"></a>03406 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (p-&gt;ss7) {
<a name="l03407"></a>03407       <span class="keywordtype">char</span> ss7_called_nai;
<a name="l03408"></a>03408       <span class="keywordtype">int</span> called_nai_strip;
<a name="l03409"></a>03409       <span class="keywordtype">char</span> ss7_calling_nai;
<a name="l03410"></a>03410       <span class="keywordtype">int</span> calling_nai_strip;
<a name="l03411"></a>03411       <span class="keyword">const</span> <span class="keywordtype">char</span> *charge_str = NULL;
<a name="l03412"></a>03412       <span class="keyword">const</span> <span class="keywordtype">char</span> *gen_address = NULL;
<a name="l03413"></a>03413       <span class="keyword">const</span> <span class="keywordtype">char</span> *gen_digits = NULL;
<a name="l03414"></a>03414       <span class="keyword">const</span> <span class="keywordtype">char</span> *gen_dig_type = NULL;
<a name="l03415"></a>03415       <span class="keyword">const</span> <span class="keywordtype">char</span> *gen_dig_scheme = NULL;
<a name="l03416"></a>03416       <span class="keyword">const</span> <span class="keywordtype">char</span> *gen_name = NULL;
<a name="l03417"></a>03417       <span class="keyword">const</span> <span class="keywordtype">char</span> *jip_digits = NULL;
<a name="l03418"></a>03418       <span class="keyword">const</span> <span class="keywordtype">char</span> *lspi_ident = NULL;
<a name="l03419"></a>03419       <span class="keyword">const</span> <span class="keywordtype">char</span> *rlt_flag = NULL;
<a name="l03420"></a>03420       <span class="keyword">const</span> <span class="keywordtype">char</span> *call_ref_id = NULL;
<a name="l03421"></a>03421       <span class="keyword">const</span> <span class="keywordtype">char</span> *call_ref_pc = NULL;
<a name="l03422"></a>03422       <span class="keyword">const</span> <span class="keywordtype">char</span> *send_far = NULL;
<a name="l03423"></a>03423 
<a name="l03424"></a>03424       c = strchr(dest, <span class="charliteral">&apos;/&apos;</span>);
<a name="l03425"></a>03425       <span class="keywordflow">if</span> (c) {
<a name="l03426"></a>03426          c++;
<a name="l03427"></a>03427       } <span class="keywordflow">else</span> {
<a name="l03428"></a>03428          c = <span class="stringliteral">&quot;&quot;</span>;
<a name="l03429"></a>03429       }
<a name="l03430"></a>03430       <span class="keywordflow">if</span> (strlen(c) &lt; p-&gt;<a class="code" href="structdahdi__pvt.html#ae485b093be94ace2ac61433abb70d3f1" title="Number of most significant digits/characters to strip from the dialed number.">stripmsd</a>) {
<a name="l03431"></a>03431          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Number &apos;%s&apos; is shorter than stripmsd (%d)\n&quot;</span>, c, p-&gt;<a class="code" href="structdahdi__pvt.html#ae485b093be94ace2ac61433abb70d3f1" title="Number of most significant digits/characters to strip from the dialed number.">stripmsd</a>);
<a name="l03432"></a>03432          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l03433"></a>03433          <span class="keywordflow">return</span> -1;
<a name="l03434"></a>03434       }
<a name="l03435"></a>03435 
<a name="l03436"></a>03436       <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="structdahdi__pvt.html#a8c5bb01611cd9890c062782fa0366459" title="TRUE if the outgoing caller ID is blocked/hidden.">hidecallerid</a>) {
<a name="l03437"></a>03437          l = ast-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>;
<a name="l03438"></a>03438       } <span class="keywordflow">else</span> {
<a name="l03439"></a>03439          l = NULL;
<a name="l03440"></a>03440       }
<a name="l03441"></a>03441 
<a name="l03442"></a>03442       <span class="keywordflow">if</span> (ss7_grab(p, p-&gt;ss7)) {
<a name="l03443"></a>03443          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to grab SS7!\n&quot;</span>);
<a name="l03444"></a>03444          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l03445"></a>03445          <span class="keywordflow">return</span> -1;
<a name="l03446"></a>03446       }
<a name="l03447"></a>03447       p-&gt;<a class="code" href="structdahdi__pvt.html#adf54768a4327f86de3a234648305c4a4" title="TRUE if the transfer capability of the call is digital.">digital</a> = <a class="code" href="transcap_8h.html#a5e35948d3406bb03e04e1725ad491cb0">IS_DIGITAL</a>(ast-&gt;<a class="code" href="structast__channel.html#a67fbfb6a4051ff15a242b9685167f16a">transfercapability</a>);
<a name="l03448"></a>03448       p-&gt;ss7call = isup_new_call(p-&gt;ss7-&gt;ss7);
<a name="l03449"></a>03449 
<a name="l03450"></a>03450       <span class="keywordflow">if</span> (!p-&gt;ss7call) {
<a name="l03451"></a>03451          ss7_rel(p-&gt;ss7);
<a name="l03452"></a>03452          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l03453"></a>03453          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to allocate new SS7 call!\n&quot;</span>);
<a name="l03454"></a>03454          <span class="keywordflow">return</span> -1;
<a name="l03455"></a>03455       }
<a name="l03456"></a>03456 
<a name="l03457"></a>03457       called_nai_strip = 0;
<a name="l03458"></a>03458       ss7_called_nai = p-&gt;ss7-&gt;called_nai;
<a name="l03459"></a>03459       <span class="keywordflow">if</span> (ss7_called_nai == SS7_NAI_DYNAMIC) { <span class="comment">/* compute dynamically */</span>
<a name="l03460"></a>03460          <span class="keywordflow">if</span> (strncmp(c + p-&gt;<a class="code" href="structdahdi__pvt.html#ae485b093be94ace2ac61433abb70d3f1" title="Number of most significant digits/characters to strip from the dialed number.">stripmsd</a>, p-&gt;ss7-&gt;internationalprefix, strlen(p-&gt;ss7-&gt;internationalprefix)) == 0) {
<a name="l03461"></a>03461             called_nai_strip = strlen(p-&gt;ss7-&gt;internationalprefix);
<a name="l03462"></a>03462             ss7_called_nai = SS7_NAI_INTERNATIONAL;
<a name="l03463"></a>03463          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp(c + p-&gt;<a class="code" href="structdahdi__pvt.html#ae485b093be94ace2ac61433abb70d3f1" title="Number of most significant digits/characters to strip from the dialed number.">stripmsd</a>, p-&gt;ss7-&gt;nationalprefix, strlen(p-&gt;ss7-&gt;nationalprefix)) == 0) {
<a name="l03464"></a>03464             called_nai_strip = strlen(p-&gt;ss7-&gt;nationalprefix);
<a name="l03465"></a>03465             ss7_called_nai = SS7_NAI_NATIONAL;
<a name="l03466"></a>03466          } <span class="keywordflow">else</span> {
<a name="l03467"></a>03467             ss7_called_nai = SS7_NAI_SUBSCRIBER;
<a name="l03468"></a>03468          }
<a name="l03469"></a>03469       }
<a name="l03470"></a>03470       isup_set_called(p-&gt;ss7call, c + p-&gt;<a class="code" href="structdahdi__pvt.html#ae485b093be94ace2ac61433abb70d3f1" title="Number of most significant digits/characters to strip from the dialed number.">stripmsd</a> + called_nai_strip, ss7_called_nai, p-&gt;ss7-&gt;ss7);
<a name="l03471"></a>03471 
<a name="l03472"></a>03472       calling_nai_strip = 0;
<a name="l03473"></a>03473       ss7_calling_nai = p-&gt;ss7-&gt;calling_nai;
<a name="l03474"></a>03474       <span class="keywordflow">if</span> ((l != NULL) &amp;&amp; (ss7_calling_nai == SS7_NAI_DYNAMIC)) { <span class="comment">/* compute dynamically */</span>
<a name="l03475"></a>03475          <span class="keywordflow">if</span> (strncmp(l, p-&gt;ss7-&gt;internationalprefix, strlen(p-&gt;ss7-&gt;internationalprefix)) == 0) {
<a name="l03476"></a>03476             calling_nai_strip = strlen(p-&gt;ss7-&gt;internationalprefix);
<a name="l03477"></a>03477             ss7_calling_nai = SS7_NAI_INTERNATIONAL;
<a name="l03478"></a>03478          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp(l, p-&gt;ss7-&gt;nationalprefix, strlen(p-&gt;ss7-&gt;nationalprefix)) == 0) {
<a name="l03479"></a>03479             calling_nai_strip = strlen(p-&gt;ss7-&gt;nationalprefix);
<a name="l03480"></a>03480             ss7_calling_nai = SS7_NAI_NATIONAL;
<a name="l03481"></a>03481          } <span class="keywordflow">else</span> {
<a name="l03482"></a>03482             ss7_calling_nai = SS7_NAI_SUBSCRIBER;
<a name="l03483"></a>03483          }
<a name="l03484"></a>03484       }
<a name="l03485"></a>03485       isup_set_calling(p-&gt;ss7call, l ? (l + calling_nai_strip) : NULL, ss7_calling_nai,
<a name="l03486"></a>03486          p-&gt;<a class="code" href="structdahdi__pvt.html#a6799914e39462ec4cfef0e6b310e7104" title="TRUE if we will use the calling presentation setting from the Asterisk channel for...">use_callingpres</a> ? cid_pres2ss7pres(ast-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a5674af3fa5ce1dd1fe052be1477d4110">cid_pres</a>) : (l ? SS7_PRESENTATION_ALLOWED : SS7_PRESENTATION_RESTRICTED),
<a name="l03487"></a>03487          p-&gt;<a class="code" href="structdahdi__pvt.html#a6799914e39462ec4cfef0e6b310e7104" title="TRUE if we will use the calling presentation setting from the Asterisk channel for...">use_callingpres</a> ? cid_pres2ss7screen(ast-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a5674af3fa5ce1dd1fe052be1477d4110">cid_pres</a>) : SS7_SCREENING_USER_PROVIDED );
<a name="l03488"></a>03488 
<a name="l03489"></a>03489       isup_set_oli(p-&gt;ss7call, ast-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a9540aaac76be952860ef25d607eb33fb">cid_ani2</a>);
<a name="l03490"></a>03490       isup_init_call(p-&gt;ss7-&gt;ss7, p-&gt;ss7call, p-&gt;cic, p-&gt;dpc);
<a name="l03491"></a>03491 
<a name="l03492"></a>03492       <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(ast);
<a name="l03493"></a>03493       <span class="comment">/* Set the charge number if it is set */</span>
<a name="l03494"></a>03494       charge_str = <a class="code" href="pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b" title="Return a pointer to the value of the corresponding channel variable.">pbx_builtin_getvar_helper</a>(ast, <span class="stringliteral">&quot;SS7_CHARGE_NUMBER&quot;</span>);
<a name="l03495"></a>03495       <span class="keywordflow">if</span> (charge_str)
<a name="l03496"></a>03496          isup_set_charge(p-&gt;ss7call, charge_str, SS7_ANI_CALLING_PARTY_SUB_NUMBER, 0x10);
<a name="l03497"></a>03497 
<a name="l03498"></a>03498       gen_address = <a class="code" href="pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b" title="Return a pointer to the value of the corresponding channel variable.">pbx_builtin_getvar_helper</a>(ast, <span class="stringliteral">&quot;SS7_GENERIC_ADDRESS&quot;</span>);
<a name="l03499"></a>03499       <span class="keywordflow">if</span> (gen_address)
<a name="l03500"></a>03500          isup_set_gen_address(p-&gt;ss7call, gen_address, p-&gt;gen_add_nai,p-&gt;gen_add_pres_ind, p-&gt;gen_add_num_plan,p-&gt;gen_add_type); <span class="comment">/* need to add some types here for NAI,PRES,TYPE */</span>
<a name="l03501"></a>03501 
<a name="l03502"></a>03502       gen_digits = <a class="code" href="pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b" title="Return a pointer to the value of the corresponding channel variable.">pbx_builtin_getvar_helper</a>(ast, <span class="stringliteral">&quot;SS7_GENERIC_DIGITS&quot;</span>);
<a name="l03503"></a>03503       gen_dig_type = <a class="code" href="pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b" title="Return a pointer to the value of the corresponding channel variable.">pbx_builtin_getvar_helper</a>(ast, <span class="stringliteral">&quot;SS7_GENERIC_DIGTYPE&quot;</span>);
<a name="l03504"></a>03504       gen_dig_scheme = <a class="code" href="pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b" title="Return a pointer to the value of the corresponding channel variable.">pbx_builtin_getvar_helper</a>(ast, <span class="stringliteral">&quot;SS7_GENERIC_DIGSCHEME&quot;</span>);
<a name="l03505"></a>03505       <span class="keywordflow">if</span> (gen_digits)
<a name="l03506"></a>03506          isup_set_gen_digits(p-&gt;ss7call, gen_digits, atoi(gen_dig_type), atoi(gen_dig_scheme));
<a name="l03507"></a>03507 
<a name="l03508"></a>03508       gen_name = <a class="code" href="pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b" title="Return a pointer to the value of the corresponding channel variable.">pbx_builtin_getvar_helper</a>(ast, <span class="stringliteral">&quot;SS7_GENERIC_NAME&quot;</span>);
<a name="l03509"></a>03509       <span class="keywordflow">if</span> (gen_name)
<a name="l03510"></a>03510          isup_set_generic_name(p-&gt;ss7call, gen_name, GEN_NAME_TYPE_CALLING_NAME, GEN_NAME_AVAIL_AVAILABLE, GEN_NAME_PRES_ALLOWED);
<a name="l03511"></a>03511 
<a name="l03512"></a>03512       jip_digits = <a class="code" href="pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b" title="Return a pointer to the value of the corresponding channel variable.">pbx_builtin_getvar_helper</a>(ast, <span class="stringliteral">&quot;SS7_JIP&quot;</span>);
<a name="l03513"></a>03513       <span class="keywordflow">if</span> (jip_digits)
<a name="l03514"></a>03514          isup_set_jip_digits(p-&gt;ss7call, jip_digits);
<a name="l03515"></a>03515 
<a name="l03516"></a>03516       lspi_ident = <a class="code" href="pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b" title="Return a pointer to the value of the corresponding channel variable.">pbx_builtin_getvar_helper</a>(ast, <span class="stringliteral">&quot;SS7_LSPI_IDENT&quot;</span>);
<a name="l03517"></a>03517       <span class="keywordflow">if</span> (lspi_ident)
<a name="l03518"></a>03518          isup_set_lspi(p-&gt;ss7call, lspi_ident, 0x18, 0x7, 0x00);
<a name="l03519"></a>03519 
<a name="l03520"></a>03520       rlt_flag = <a class="code" href="pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b" title="Return a pointer to the value of the corresponding channel variable.">pbx_builtin_getvar_helper</a>(ast, <span class="stringliteral">&quot;SS7_RLT_ON&quot;</span>);
<a name="l03521"></a>03521       <span class="keywordflow">if</span> ((rlt_flag) &amp;&amp; ((strncmp(<span class="stringliteral">&quot;NO&quot;</span>, rlt_flag, strlen(rlt_flag))) != 0 )) {
<a name="l03522"></a>03522          isup_set_lspi(p-&gt;ss7call, rlt_flag, 0x18, 0x7, 0x00); <span class="comment">/* Setting for Nortel DMS-250/500 */</span>
<a name="l03523"></a>03523       }
<a name="l03524"></a>03524 
<a name="l03525"></a>03525       call_ref_id = <a class="code" href="pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b" title="Return a pointer to the value of the corresponding channel variable.">pbx_builtin_getvar_helper</a>(ast, <span class="stringliteral">&quot;SS7_CALLREF_IDENT&quot;</span>);
<a name="l03526"></a>03526       call_ref_pc = <a class="code" href="pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b" title="Return a pointer to the value of the corresponding channel variable.">pbx_builtin_getvar_helper</a>(ast, <span class="stringliteral">&quot;SS7_CALLREF_PC&quot;</span>);
<a name="l03527"></a>03527       <span class="keywordflow">if</span> (call_ref_id &amp;&amp; call_ref_pc) {
<a name="l03528"></a>03528          isup_set_callref(p-&gt;ss7call, atoi(call_ref_id),
<a name="l03529"></a>03529                 call_ref_pc ? atoi(call_ref_pc) : 0);
<a name="l03530"></a>03530       }
<a name="l03531"></a>03531 
<a name="l03532"></a>03532       send_far = <a class="code" href="pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b" title="Return a pointer to the value of the corresponding channel variable.">pbx_builtin_getvar_helper</a>(ast, <span class="stringliteral">&quot;SS7_SEND_FAR&quot;</span>);
<a name="l03533"></a>03533       <span class="keywordflow">if</span> ((send_far) &amp;&amp; ((strncmp(<span class="stringliteral">&quot;NO&quot;</span>, send_far, strlen(send_far))) != 0 ))
<a name="l03534"></a>03534          (isup_far(p-&gt;ss7-&gt;ss7, p-&gt;ss7call));
<a name="l03535"></a>03535 
<a name="l03536"></a>03536       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(ast);
<a name="l03537"></a>03537 
<a name="l03538"></a>03538       isup_iam(p-&gt;ss7-&gt;ss7, p-&gt;ss7call);
<a name="l03539"></a>03539       <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(ast, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa70881e902c6c29f27ffba80bb43554f">AST_STATE_DIALING</a>);
<a name="l03540"></a>03540       ss7_rel(p-&gt;ss7);
<a name="l03541"></a>03541    }
<a name="l03542"></a>03542 <span class="preprocessor">#endif </span><span class="comment">/* HAVE_SS7 */</span>
<a name="l03543"></a>03543 <span class="preprocessor">#ifdef HAVE_OPENR2</span>
<a name="l03544"></a>03544 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (p-&gt;mfcr2) {
<a name="l03545"></a>03545       openr2_calling_party_category_t chancat;
<a name="l03546"></a>03546       <span class="keywordtype">int</span> callres = 0;
<a name="l03547"></a>03547       <span class="keywordtype">char</span> *c, *l;
<a name="l03548"></a>03548 
<a name="l03549"></a>03549       c = strchr(dest, <span class="charliteral">&apos;/&apos;</span>);
<a name="l03550"></a>03550       <span class="keywordflow">if</span> (c) {
<a name="l03551"></a>03551          c++;
<a name="l03552"></a>03552       } <span class="keywordflow">else</span> {
<a name="l03553"></a>03553          c = <span class="stringliteral">&quot;&quot;</span>;
<a name="l03554"></a>03554       }
<a name="l03555"></a>03555       <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="structdahdi__pvt.html#a8c5bb01611cd9890c062782fa0366459" title="TRUE if the outgoing caller ID is blocked/hidden.">hidecallerid</a>) {
<a name="l03556"></a>03556          l = ast-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>;
<a name="l03557"></a>03557       } <span class="keywordflow">else</span> {
<a name="l03558"></a>03558          l = NULL;
<a name="l03559"></a>03559       }
<a name="l03560"></a>03560       <span class="keywordflow">if</span> (strlen(c) &lt; p-&gt;<a class="code" href="structdahdi__pvt.html#ae485b093be94ace2ac61433abb70d3f1" title="Number of most significant digits/characters to strip from the dialed number.">stripmsd</a>) {
<a name="l03561"></a>03561          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Number &apos;%s&apos; is shorter than stripmsd (%d)\n&quot;</span>, c, p-&gt;<a class="code" href="structdahdi__pvt.html#ae485b093be94ace2ac61433abb70d3f1" title="Number of most significant digits/characters to strip from the dialed number.">stripmsd</a>);
<a name="l03562"></a>03562          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l03563"></a>03563          <span class="keywordflow">return</span> -1;
<a name="l03564"></a>03564       }
<a name="l03565"></a>03565       p-&gt;<a class="code" href="structdahdi__pvt.html#af17335c0c7a4c1e03e987a33f6eec81b" title="TRUE if in the process of dialing digits or sending something.">dialing</a> = 1;
<a name="l03566"></a>03566       <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(ast);
<a name="l03567"></a>03567       chancat = dahdi_r2_get_channel_category(ast);
<a name="l03568"></a>03568       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(ast);
<a name="l03569"></a>03569       callres = openr2_chan_make_call(p-&gt;r2chan, l, (c + p-&gt;<a class="code" href="structdahdi__pvt.html#ae485b093be94ace2ac61433abb70d3f1" title="Number of most significant digits/characters to strip from the dialed number.">stripmsd</a>), chancat);
<a name="l03570"></a>03570       <span class="keywordflow">if</span> (-1 == callres) {
<a name="l03571"></a>03571          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l03572"></a>03572          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;unable to make new MFC/R2 call!\n&quot;</span>);
<a name="l03573"></a>03573          <span class="keywordflow">return</span> -1;
<a name="l03574"></a>03574       }
<a name="l03575"></a>03575       <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(ast, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa70881e902c6c29f27ffba80bb43554f">AST_STATE_DIALING</a>);
<a name="l03576"></a>03576    }
<a name="l03577"></a>03577 <span class="preprocessor">#endif </span><span class="comment">/* HAVE_OPENR2 */</span>
<a name="l03578"></a>03578 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l03579"></a>03579 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (p-&gt;pri) {
<a name="l03580"></a>03580       <span class="keyword">struct </span>pri_sr *sr;
<a name="l03581"></a>03581 <span class="preprocessor">#ifdef SUPPORT_USERUSER</span>
<a name="l03582"></a>03582 <span class="preprocessor"></span>      <span class="keyword">const</span> <span class="keywordtype">char</span> *useruser;
<a name="l03583"></a>03583 <span class="preprocessor">#endif</span>
<a name="l03584"></a>03584 <span class="preprocessor"></span>      <span class="keywordtype">int</span> pridialplan;
<a name="l03585"></a>03585       <span class="keywordtype">int</span> dp_strip;
<a name="l03586"></a>03586       <span class="keywordtype">int</span> prilocaldialplan;
<a name="l03587"></a>03587       <span class="keywordtype">int</span> ldp_strip;
<a name="l03588"></a>03588       <span class="keywordtype">int</span> exclusive;
<a name="l03589"></a>03589       <span class="keyword">const</span> <span class="keywordtype">char</span> *rr_str;
<a name="l03590"></a>03590       <span class="keywordtype">int</span> redirect_reason;
<a name="l03591"></a>03591 
<a name="l03592"></a>03592       c = strchr(dest, <span class="charliteral">&apos;/&apos;</span>);
<a name="l03593"></a>03593       <span class="keywordflow">if</span> (c) {
<a name="l03594"></a>03594          c++;
<a name="l03595"></a>03595       } <span class="keywordflow">else</span> {
<a name="l03596"></a>03596          c = <span class="stringliteral">&quot;&quot;</span>;
<a name="l03597"></a>03597       }
<a name="l03598"></a>03598 
<a name="l03599"></a>03599       l = NULL;
<a name="l03600"></a>03600       n = NULL;
<a name="l03601"></a>03601       <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="structdahdi__pvt.html#a8c5bb01611cd9890c062782fa0366459" title="TRUE if the outgoing caller ID is blocked/hidden.">hidecallerid</a>) {
<a name="l03602"></a>03602          l = ast-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>;
<a name="l03603"></a>03603          <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="structdahdi__pvt.html#ab9a2fe4dd3d880dcb9fec85b60814978" title="TRUE if hide just the name not the number for legacy PBX use.">hidecalleridname</a>) {
<a name="l03604"></a>03604             n = ast-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ab2461abe6e234fe4f763b0a2179184b5">cid_name</a>;
<a name="l03605"></a>03605          }
<a name="l03606"></a>03606       }
<a name="l03607"></a>03607 
<a name="l03608"></a>03608       <span class="keywordflow">if</span> (strlen(c) &lt; p-&gt;<a class="code" href="structdahdi__pvt.html#ae485b093be94ace2ac61433abb70d3f1" title="Number of most significant digits/characters to strip from the dialed number.">stripmsd</a>) {
<a name="l03609"></a>03609          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Number &apos;%s&apos; is shorter than stripmsd (%d)\n&quot;</span>, c, p-&gt;<a class="code" href="structdahdi__pvt.html#ae485b093be94ace2ac61433abb70d3f1" title="Number of most significant digits/characters to strip from the dialed number.">stripmsd</a>);
<a name="l03610"></a>03610          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l03611"></a>03611          <span class="keywordflow">return</span> -1;
<a name="l03612"></a>03612       }
<a name="l03613"></a>03613       <span class="keywordflow">if</span> (mysig != <a class="code" href="chan__dahdi_8c.html#a38139ec369c0243f4324eb4eb0c2f004">SIG_FXSKS</a>) {
<a name="l03614"></a>03614          p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.op = DAHDI_DIAL_OP_REPLACE;
<a name="l03615"></a>03615          s = strchr(c + p-&gt;<a class="code" href="structdahdi__pvt.html#ae485b093be94ace2ac61433abb70d3f1" title="Number of most significant digits/characters to strip from the dialed number.">stripmsd</a>, <span class="charliteral">&apos;w&apos;</span>);
<a name="l03616"></a>03616          <span class="keywordflow">if</span> (s) {
<a name="l03617"></a>03617             <span class="keywordflow">if</span> (strlen(s) &gt; 1)
<a name="l03618"></a>03618                snprintf(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr), <span class="stringliteral">&quot;T%s&quot;</span>, s);
<a name="l03619"></a>03619             <span class="keywordflow">else</span>
<a name="l03620"></a>03620                p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l03621"></a>03621             *s = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l03622"></a>03622          } <span class="keywordflow">else</span> {
<a name="l03623"></a>03623             p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l03624"></a>03624          }
<a name="l03625"></a>03625       }
<a name="l03626"></a>03626       <span class="keywordflow">if</span> (pri_grab(p, p-&gt;pri)) {
<a name="l03627"></a>03627          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to grab PRI!\n&quot;</span>);
<a name="l03628"></a>03628          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l03629"></a>03629          <span class="keywordflow">return</span> -1;
<a name="l03630"></a>03630       }
<a name="l03631"></a>03631       <span class="keywordflow">if</span> (!(p-&gt;call = pri_new_call(p-&gt;pri-&gt;pri))) {
<a name="l03632"></a>03632          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create call on channel %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l03633"></a>03633          pri_rel(p-&gt;pri);
<a name="l03634"></a>03634          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l03635"></a>03635          <span class="keywordflow">return</span> -1;
<a name="l03636"></a>03636       }
<a name="l03637"></a>03637       <span class="keywordflow">if</span> (!(sr = pri_sr_new())) {
<a name="l03638"></a>03638          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to allocate setup request channel %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l03639"></a>03639          pri_rel(p-&gt;pri);
<a name="l03640"></a>03640          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l03641"></a>03641       }
<a name="l03642"></a>03642       <span class="keywordflow">if</span> (p-&gt;bearer || (mysig == <a class="code" href="chan__dahdi_8c.html#a38139ec369c0243f4324eb4eb0c2f004">SIG_FXSKS</a>)) {
<a name="l03643"></a>03643          <span class="keywordflow">if</span> (p-&gt;bearer) {
<a name="l03644"></a>03644             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Oooh, I have a bearer on %d (%d:%d)\n&quot;</span>, PVT_TO_CHANNEL(p-&gt;bearer), p-&gt;bearer-&gt;logicalspan, p-&gt;bearer-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l03645"></a>03645             p-&gt;bearer-&gt;call = p-&gt;call;
<a name="l03646"></a>03646          } <span class="keywordflow">else</span>
<a name="l03647"></a>03647             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;I&apos;m being setup with no bearer right now...\n&quot;</span>);
<a name="l03648"></a>03648 
<a name="l03649"></a>03649          pri_set_crv(p-&gt;pri-&gt;pri, p-&gt;call, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, 0);
<a name="l03650"></a>03650       }
<a name="l03651"></a>03651       p-&gt;<a class="code" href="structdahdi__pvt.html#adf54768a4327f86de3a234648305c4a4" title="TRUE if the transfer capability of the call is digital.">digital</a> = <a class="code" href="transcap_8h.html#a5e35948d3406bb03e04e1725ad491cb0">IS_DIGITAL</a>(ast-&gt;<a class="code" href="structast__channel.html#a67fbfb6a4051ff15a242b9685167f16a">transfercapability</a>);
<a name="l03652"></a>03652 
<a name="l03653"></a>03653       <span class="comment">/* Should the picked channel be used exclusively? */</span>
<a name="l03654"></a>03654       <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a6ae2ff84731ea1e81a24412800030423" title="TRUE if PRI B channels are always exclusively selected.">priexclusive</a> || p-&gt;pri-&gt;nodetype == PRI_NETWORK) {
<a name="l03655"></a>03655          exclusive = 1;
<a name="l03656"></a>03656       } <span class="keywordflow">else</span> {
<a name="l03657"></a>03657          exclusive = 0;
<a name="l03658"></a>03658       }
<a name="l03659"></a>03659 
<a name="l03660"></a>03660       pri_sr_set_channel(sr, p-&gt;bearer ? PVT_TO_CHANNEL(p-&gt;bearer) : PVT_TO_CHANNEL(p), exclusive, 1);
<a name="l03661"></a>03661       pri_sr_set_bearer(sr, p-&gt;<a class="code" href="structdahdi__pvt.html#adf54768a4327f86de3a234648305c4a4" title="TRUE if the transfer capability of the call is digital.">digital</a> ? <a class="code" href="isdn__lib_8h.html#a7c03637dce11d369a3e96ad5767607c0">PRI_TRANS_CAP_DIGITAL</a> : ast-&gt;<a class="code" href="structast__channel.html#a67fbfb6a4051ff15a242b9685167f16a">transfercapability</a>,
<a name="l03662"></a>03662          (p-&gt;<a class="code" href="structdahdi__pvt.html#adf54768a4327f86de3a234648305c4a4" title="TRUE if the transfer capability of the call is digital.">digital</a> ? -1 :
<a name="l03663"></a>03663             ((p-&gt;<a class="code" href="structdahdi__pvt.html#a17dd7b17c0e736754e01e575ca8d8cb8" title="Active PCM encoding format: DAHDI_LAW_ALAW or DAHDI_LAW_MULAW.">law</a> == DAHDI_LAW_ALAW) ? PRI_LAYER_1_ALAW : PRI_LAYER_1_ULAW)));
<a name="l03664"></a>03664       <span class="keywordflow">if</span> (p-&gt;pri-&gt;facilityenable)
<a name="l03665"></a>03665          pri_facility_enable(p-&gt;pri-&gt;pri);
<a name="l03666"></a>03666 
<a name="l03667"></a>03667       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Requested transfer capability: 0x%.2x - %s\n&quot;</span>, ast-&gt;<a class="code" href="structast__channel.html#a67fbfb6a4051ff15a242b9685167f16a">transfercapability</a>, <a class="code" href="channel_8h.html#acb027b361350d81e4b94b540fbdfe4e4" title="Gives the string form of a given transfer capability.">ast_transfercapability2str</a>(ast-&gt;<a class="code" href="structast__channel.html#a67fbfb6a4051ff15a242b9685167f16a">transfercapability</a>));
<a name="l03668"></a>03668 
<a name="l03669"></a>03669       dp_strip = 0;
<a name="l03670"></a>03670       pridialplan = p-&gt;pri-&gt;dialplan - 1;
<a name="l03671"></a>03671       <span class="keywordflow">if</span> (pridialplan == -2 || pridialplan == -3) { <span class="comment">/* compute dynamically */</span>
<a name="l03672"></a>03672          <span class="keywordflow">if</span> (strncmp(c + p-&gt;<a class="code" href="structdahdi__pvt.html#ae485b093be94ace2ac61433abb70d3f1" title="Number of most significant digits/characters to strip from the dialed number.">stripmsd</a>, p-&gt;pri-&gt;internationalprefix, strlen(p-&gt;pri-&gt;internationalprefix)) == 0) {
<a name="l03673"></a>03673             <span class="keywordflow">if</span> (pridialplan == -2) {
<a name="l03674"></a>03674                dp_strip = strlen(p-&gt;pri-&gt;internationalprefix);
<a name="l03675"></a>03675             }
<a name="l03676"></a>03676             pridialplan = PRI_INTERNATIONAL_ISDN;
<a name="l03677"></a>03677          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp(c + p-&gt;<a class="code" href="structdahdi__pvt.html#ae485b093be94ace2ac61433abb70d3f1" title="Number of most significant digits/characters to strip from the dialed number.">stripmsd</a>, p-&gt;pri-&gt;nationalprefix, strlen(p-&gt;pri-&gt;nationalprefix)) == 0) {
<a name="l03678"></a>03678             <span class="keywordflow">if</span> (pridialplan == -2) {
<a name="l03679"></a>03679                dp_strip = strlen(p-&gt;pri-&gt;nationalprefix);
<a name="l03680"></a>03680             }
<a name="l03681"></a>03681             pridialplan = PRI_NATIONAL_ISDN;
<a name="l03682"></a>03682          } <span class="keywordflow">else</span> {
<a name="l03683"></a>03683             pridialplan = PRI_LOCAL_ISDN;
<a name="l03684"></a>03684          }
<a name="l03685"></a>03685       }
<a name="l03686"></a>03686       <span class="keywordflow">while</span> (c[p-&gt;<a class="code" href="structdahdi__pvt.html#ae485b093be94ace2ac61433abb70d3f1" title="Number of most significant digits/characters to strip from the dialed number.">stripmsd</a>] &gt; <span class="charliteral">&apos;9&apos;</span> &amp;&amp; c[p-&gt;<a class="code" href="structdahdi__pvt.html#ae485b093be94ace2ac61433abb70d3f1" title="Number of most significant digits/characters to strip from the dialed number.">stripmsd</a>] != <span class="charliteral">&apos;*&apos;</span> &amp;&amp; c[p-&gt;<a class="code" href="structdahdi__pvt.html#ae485b093be94ace2ac61433abb70d3f1" title="Number of most significant digits/characters to strip from the dialed number.">stripmsd</a>] != <span class="charliteral">&apos;#&apos;</span>) {
<a name="l03687"></a>03687          <span class="keywordflow">switch</span> (c[p-&gt;<a class="code" href="structdahdi__pvt.html#ae485b093be94ace2ac61433abb70d3f1" title="Number of most significant digits/characters to strip from the dialed number.">stripmsd</a>]) {
<a name="l03688"></a>03688          <span class="keywordflow">case</span> <span class="charliteral">&apos;U&apos;</span>:
<a name="l03689"></a>03689             pridialplan = (PRI_TON_UNKNOWN &lt;&lt; 4) | (pridialplan &amp; 0xf);
<a name="l03690"></a>03690             <span class="keywordflow">break</span>;
<a name="l03691"></a>03691          <span class="keywordflow">case</span> <span class="charliteral">&apos;I&apos;</span>:
<a name="l03692"></a>03692             pridialplan = (PRI_TON_INTERNATIONAL &lt;&lt; 4) | (pridialplan &amp; 0xf);
<a name="l03693"></a>03693             <span class="keywordflow">break</span>;
<a name="l03694"></a>03694          <span class="keywordflow">case</span> <span class="charliteral">&apos;N&apos;</span>:
<a name="l03695"></a>03695             pridialplan = (PRI_TON_NATIONAL &lt;&lt; 4) | (pridialplan &amp; 0xf);
<a name="l03696"></a>03696             <span class="keywordflow">break</span>;
<a name="l03697"></a>03697          <span class="keywordflow">case</span> <span class="charliteral">&apos;L&apos;</span>:
<a name="l03698"></a>03698             pridialplan = (PRI_TON_NET_SPECIFIC &lt;&lt; 4) | (pridialplan &amp; 0xf);
<a name="l03699"></a>03699             <span class="keywordflow">break</span>;
<a name="l03700"></a>03700          <span class="keywordflow">case</span> <span class="charliteral">&apos;S&apos;</span>:
<a name="l03701"></a>03701             pridialplan = (PRI_TON_SUBSCRIBER &lt;&lt; 4) | (pridialplan &amp; 0xf);
<a name="l03702"></a>03702             <span class="keywordflow">break</span>;
<a name="l03703"></a>03703          <span class="keywordflow">case</span> <span class="charliteral">&apos;V&apos;</span>:
<a name="l03704"></a>03704             pridialplan = (PRI_TON_ABBREVIATED &lt;&lt; 4) | (pridialplan &amp; 0xf);
<a name="l03705"></a>03705             <span class="keywordflow">break</span>;
<a name="l03706"></a>03706          <span class="keywordflow">case</span> <span class="charliteral">&apos;R&apos;</span>:
<a name="l03707"></a>03707             pridialplan = (PRI_TON_RESERVED &lt;&lt; 4) | (pridialplan &amp; 0xf);
<a name="l03708"></a>03708             <span class="keywordflow">break</span>;
<a name="l03709"></a>03709          <span class="keywordflow">case</span> <span class="charliteral">&apos;u&apos;</span>:
<a name="l03710"></a>03710             pridialplan = PRI_NPI_UNKNOWN | (pridialplan &amp; 0xf0);
<a name="l03711"></a>03711             <span class="keywordflow">break</span>;
<a name="l03712"></a>03712          <span class="keywordflow">case</span> <span class="charliteral">&apos;e&apos;</span>:
<a name="l03713"></a>03713             pridialplan = PRI_NPI_E163_E164 | (pridialplan &amp; 0xf0);
<a name="l03714"></a>03714             <span class="keywordflow">break</span>;
<a name="l03715"></a>03715          <span class="keywordflow">case</span> <span class="charliteral">&apos;x&apos;</span>:
<a name="l03716"></a>03716             pridialplan = PRI_NPI_X121 | (pridialplan &amp; 0xf0);
<a name="l03717"></a>03717             <span class="keywordflow">break</span>;
<a name="l03718"></a>03718          <span class="keywordflow">case</span> <span class="charliteral">&apos;f&apos;</span>:
<a name="l03719"></a>03719             pridialplan = PRI_NPI_F69 | (pridialplan &amp; 0xf0);
<a name="l03720"></a>03720             <span class="keywordflow">break</span>;
<a name="l03721"></a>03721          <span class="keywordflow">case</span> <span class="charliteral">&apos;n&apos;</span>:
<a name="l03722"></a>03722             pridialplan = PRI_NPI_NATIONAL | (pridialplan &amp; 0xf0);
<a name="l03723"></a>03723             <span class="keywordflow">break</span>;
<a name="l03724"></a>03724          <span class="keywordflow">case</span> <span class="charliteral">&apos;p&apos;</span>:
<a name="l03725"></a>03725             pridialplan = PRI_NPI_PRIVATE | (pridialplan &amp; 0xf0);
<a name="l03726"></a>03726             <span class="keywordflow">break</span>;
<a name="l03727"></a>03727          <span class="keywordflow">case</span> <span class="charliteral">&apos;r&apos;</span>:
<a name="l03728"></a>03728             pridialplan = PRI_NPI_RESERVED | (pridialplan &amp; 0xf0);
<a name="l03729"></a>03729             <span class="keywordflow">break</span>;
<a name="l03730"></a>03730          <span class="keywordflow">default</span>:
<a name="l03731"></a>03731             <span class="keywordflow">if</span> (isalpha(c[p-&gt;<a class="code" href="structdahdi__pvt.html#ae485b093be94ace2ac61433abb70d3f1" title="Number of most significant digits/characters to strip from the dialed number.">stripmsd</a>])) {
<a name="l03732"></a>03732                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unrecognized pridialplan %s modifier: %c\n&quot;</span>,
<a name="l03733"></a>03733                   c[p-&gt;<a class="code" href="structdahdi__pvt.html#ae485b093be94ace2ac61433abb70d3f1" title="Number of most significant digits/characters to strip from the dialed number.">stripmsd</a>] &gt; <span class="charliteral">&apos;Z&apos;</span> ? <span class="stringliteral">&quot;NPI&quot;</span> : <span class="stringliteral">&quot;TON&quot;</span>, c[p-&gt;<a class="code" href="structdahdi__pvt.html#ae485b093be94ace2ac61433abb70d3f1" title="Number of most significant digits/characters to strip from the dialed number.">stripmsd</a>]);
<a name="l03734"></a>03734             }
<a name="l03735"></a>03735             <span class="keywordflow">break</span>;
<a name="l03736"></a>03736          }
<a name="l03737"></a>03737          c++;
<a name="l03738"></a>03738       }
<a name="l03739"></a>03739       pri_sr_set_called(sr, c + p-&gt;<a class="code" href="structdahdi__pvt.html#ae485b093be94ace2ac61433abb70d3f1" title="Number of most significant digits/characters to strip from the dialed number.">stripmsd</a> + dp_strip, pridialplan, s ? 1 : 0);
<a name="l03740"></a>03740 
<a name="l03741"></a>03741       ldp_strip = 0;
<a name="l03742"></a>03742       prilocaldialplan = p-&gt;pri-&gt;localdialplan - 1;
<a name="l03743"></a>03743       <span class="keywordflow">if</span> ((l != NULL) &amp;&amp; (prilocaldialplan == -2 || prilocaldialplan == -3)) { <span class="comment">/* compute dynamically */</span>
<a name="l03744"></a>03744          <span class="keywordflow">if</span> (strncmp(l, p-&gt;pri-&gt;internationalprefix, strlen(p-&gt;pri-&gt;internationalprefix)) == 0) {
<a name="l03745"></a>03745             <span class="keywordflow">if</span> (prilocaldialplan == -2) {
<a name="l03746"></a>03746                ldp_strip = strlen(p-&gt;pri-&gt;internationalprefix);
<a name="l03747"></a>03747             }
<a name="l03748"></a>03748             prilocaldialplan = PRI_INTERNATIONAL_ISDN;
<a name="l03749"></a>03749          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp(l, p-&gt;pri-&gt;nationalprefix, strlen(p-&gt;pri-&gt;nationalprefix)) == 0) {
<a name="l03750"></a>03750             <span class="keywordflow">if</span> (prilocaldialplan == -2) {
<a name="l03751"></a>03751                ldp_strip = strlen(p-&gt;pri-&gt;nationalprefix);
<a name="l03752"></a>03752             }
<a name="l03753"></a>03753             prilocaldialplan = PRI_NATIONAL_ISDN;
<a name="l03754"></a>03754          } <span class="keywordflow">else</span> {
<a name="l03755"></a>03755             prilocaldialplan = PRI_LOCAL_ISDN;
<a name="l03756"></a>03756          }
<a name="l03757"></a>03757       }
<a name="l03758"></a>03758       <span class="keywordflow">if</span> (l != NULL) {
<a name="l03759"></a>03759          <span class="keywordflow">while</span> (*l &gt; <span class="charliteral">&apos;9&apos;</span> &amp;&amp; *l != <span class="charliteral">&apos;*&apos;</span> &amp;&amp; *l != <span class="charliteral">&apos;#&apos;</span>) {
<a name="l03760"></a>03760             <span class="keywordflow">switch</span> (*l) {
<a name="l03761"></a>03761             <span class="keywordflow">case</span> <span class="charliteral">&apos;U&apos;</span>:
<a name="l03762"></a>03762                prilocaldialplan = (PRI_TON_UNKNOWN &lt;&lt; 4) | (prilocaldialplan &amp; 0xf);
<a name="l03763"></a>03763                <span class="keywordflow">break</span>;
<a name="l03764"></a>03764             <span class="keywordflow">case</span> <span class="charliteral">&apos;I&apos;</span>:
<a name="l03765"></a>03765                prilocaldialplan = (PRI_TON_INTERNATIONAL &lt;&lt; 4) | (prilocaldialplan &amp; 0xf);
<a name="l03766"></a>03766                <span class="keywordflow">break</span>;
<a name="l03767"></a>03767             <span class="keywordflow">case</span> <span class="charliteral">&apos;N&apos;</span>:
<a name="l03768"></a>03768                prilocaldialplan = (PRI_TON_NATIONAL &lt;&lt; 4) | (prilocaldialplan &amp; 0xf);
<a name="l03769"></a>03769                <span class="keywordflow">break</span>;
<a name="l03770"></a>03770             <span class="keywordflow">case</span> <span class="charliteral">&apos;L&apos;</span>:
<a name="l03771"></a>03771                prilocaldialplan = (PRI_TON_NET_SPECIFIC &lt;&lt; 4) | (prilocaldialplan &amp; 0xf);
<a name="l03772"></a>03772                <span class="keywordflow">break</span>;
<a name="l03773"></a>03773             <span class="keywordflow">case</span> <span class="charliteral">&apos;S&apos;</span>:
<a name="l03774"></a>03774                prilocaldialplan = (PRI_TON_SUBSCRIBER &lt;&lt; 4) | (prilocaldialplan &amp; 0xf);
<a name="l03775"></a>03775                <span class="keywordflow">break</span>;
<a name="l03776"></a>03776             <span class="keywordflow">case</span> <span class="charliteral">&apos;V&apos;</span>:
<a name="l03777"></a>03777                prilocaldialplan = (PRI_TON_ABBREVIATED &lt;&lt; 4) | (prilocaldialplan &amp; 0xf);
<a name="l03778"></a>03778                <span class="keywordflow">break</span>;
<a name="l03779"></a>03779             <span class="keywordflow">case</span> <span class="charliteral">&apos;R&apos;</span>:
<a name="l03780"></a>03780                prilocaldialplan = (PRI_TON_RESERVED &lt;&lt; 4) | (prilocaldialplan &amp; 0xf);
<a name="l03781"></a>03781                <span class="keywordflow">break</span>;
<a name="l03782"></a>03782             <span class="keywordflow">case</span> <span class="charliteral">&apos;u&apos;</span>:
<a name="l03783"></a>03783                prilocaldialplan = PRI_NPI_UNKNOWN | (prilocaldialplan &amp; 0xf0);
<a name="l03784"></a>03784                <span class="keywordflow">break</span>;
<a name="l03785"></a>03785             <span class="keywordflow">case</span> <span class="charliteral">&apos;e&apos;</span>:
<a name="l03786"></a>03786                prilocaldialplan = PRI_NPI_E163_E164 | (prilocaldialplan &amp; 0xf0);
<a name="l03787"></a>03787                <span class="keywordflow">break</span>;
<a name="l03788"></a>03788             <span class="keywordflow">case</span> <span class="charliteral">&apos;x&apos;</span>:
<a name="l03789"></a>03789                prilocaldialplan = PRI_NPI_X121 | (prilocaldialplan &amp; 0xf0);
<a name="l03790"></a>03790                <span class="keywordflow">break</span>;
<a name="l03791"></a>03791             <span class="keywordflow">case</span> <span class="charliteral">&apos;f&apos;</span>:
<a name="l03792"></a>03792                prilocaldialplan = PRI_NPI_F69 | (prilocaldialplan &amp; 0xf0);
<a name="l03793"></a>03793                <span class="keywordflow">break</span>;
<a name="l03794"></a>03794             <span class="keywordflow">case</span> <span class="charliteral">&apos;n&apos;</span>:
<a name="l03795"></a>03795                prilocaldialplan = PRI_NPI_NATIONAL | (prilocaldialplan &amp; 0xf0);
<a name="l03796"></a>03796                <span class="keywordflow">break</span>;
<a name="l03797"></a>03797             <span class="keywordflow">case</span> <span class="charliteral">&apos;p&apos;</span>:
<a name="l03798"></a>03798                prilocaldialplan = PRI_NPI_PRIVATE | (prilocaldialplan &amp; 0xf0);
<a name="l03799"></a>03799                <span class="keywordflow">break</span>;
<a name="l03800"></a>03800             <span class="keywordflow">case</span> <span class="charliteral">&apos;r&apos;</span>:
<a name="l03801"></a>03801                prilocaldialplan = PRI_NPI_RESERVED | (prilocaldialplan &amp; 0xf0);
<a name="l03802"></a>03802                <span class="keywordflow">break</span>;
<a name="l03803"></a>03803             <span class="keywordflow">default</span>:
<a name="l03804"></a>03804                <span class="keywordflow">if</span> (isalpha(*l)) {
<a name="l03805"></a>03805                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,
<a name="l03806"></a>03806                      <span class="stringliteral">&quot;Unrecognized prilocaldialplan %s modifier: %c\n&quot;</span>,
<a name="l03807"></a>03807                      *l &gt; <span class="charliteral">&apos;Z&apos;</span> ? <span class="stringliteral">&quot;NPI&quot;</span> : <span class="stringliteral">&quot;TON&quot;</span>, *l);
<a name="l03808"></a>03808                }
<a name="l03809"></a>03809                <span class="keywordflow">break</span>;
<a name="l03810"></a>03810             }
<a name="l03811"></a>03811             l++;
<a name="l03812"></a>03812          }
<a name="l03813"></a>03813       }
<a name="l03814"></a>03814       pri_sr_set_caller(sr, l ? (l + ldp_strip) : NULL, n, prilocaldialplan,
<a name="l03815"></a>03815          p-&gt;<a class="code" href="structdahdi__pvt.html#a6799914e39462ec4cfef0e6b310e7104" title="TRUE if we will use the calling presentation setting from the Asterisk channel for...">use_callingpres</a> ? ast-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a5674af3fa5ce1dd1fe052be1477d4110">cid_pres</a> : (l ? PRES_ALLOWED_USER_NUMBER_PASSED_SCREEN : PRES_NUMBER_NOT_AVAILABLE));
<a name="l03816"></a>03816       <span class="keywordflow">if</span> ((rr_str = <a class="code" href="pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b" title="Return a pointer to the value of the corresponding channel variable.">pbx_builtin_getvar_helper</a>(ast, <span class="stringliteral">&quot;PRIREDIRECTREASON&quot;</span>))) {
<a name="l03817"></a>03817          <span class="keywordflow">if</span> (!strcasecmp(rr_str, <span class="stringliteral">&quot;UNKNOWN&quot;</span>))
<a name="l03818"></a>03818             redirect_reason = 0;
<a name="l03819"></a>03819          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(rr_str, <span class="stringliteral">&quot;BUSY&quot;</span>))
<a name="l03820"></a>03820             redirect_reason = 1;
<a name="l03821"></a>03821          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(rr_str, <span class="stringliteral">&quot;NO_REPLY&quot;</span>) || !strcasecmp(rr_str, <span class="stringliteral">&quot;NOANSWER&quot;</span>))
<a name="l03822"></a>03822          <span class="comment">/* the NOANSWER is to match diversion-reason from chan_sip, (which never reads PRIREDIRECTREASON) */</span>
<a name="l03823"></a>03823             redirect_reason = 2;
<a name="l03824"></a>03824          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(rr_str, <span class="stringliteral">&quot;UNCONDITIONAL&quot;</span>))
<a name="l03825"></a>03825             redirect_reason = 15;
<a name="l03826"></a>03826          <span class="keywordflow">else</span>
<a name="l03827"></a>03827             redirect_reason = PRI_REDIR_UNCONDITIONAL;
<a name="l03828"></a>03828       } <span class="keywordflow">else</span>
<a name="l03829"></a>03829          redirect_reason = PRI_REDIR_UNCONDITIONAL;
<a name="l03830"></a>03830       pri_sr_set_redirecting(sr, ast-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a4791c5f3aedc8782678867a1741f4131">cid_rdnis</a>, p-&gt;pri-&gt;localdialplan - 1, PRES_ALLOWED_USER_NUMBER_PASSED_SCREEN, redirect_reason);
<a name="l03831"></a>03831 
<a name="l03832"></a>03832 <span class="preprocessor">#ifdef SUPPORT_USERUSER</span>
<a name="l03833"></a>03833 <span class="preprocessor"></span>      <span class="comment">/* User-user info */</span>
<a name="l03834"></a>03834       useruser = <a class="code" href="pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b" title="Return a pointer to the value of the corresponding channel variable.">pbx_builtin_getvar_helper</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <span class="stringliteral">&quot;USERUSERINFO&quot;</span>);
<a name="l03835"></a>03835       <span class="keywordflow">if</span> (useruser)
<a name="l03836"></a>03836          pri_sr_set_useruser(sr, useruser);
<a name="l03837"></a>03837 <span class="preprocessor">#endif</span>
<a name="l03838"></a>03838 <span class="preprocessor"></span>
<a name="l03839"></a>03839       <span class="keywordflow">if</span> (pri_setup(p-&gt;pri-&gt;pri, p-&gt;call, sr)) {
<a name="l03840"></a>03840          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to setup call to %s (using %s)\n&quot;</span>,
<a name="l03841"></a>03841             c + p-&gt;<a class="code" href="structdahdi__pvt.html#ae485b093be94ace2ac61433abb70d3f1" title="Number of most significant digits/characters to strip from the dialed number.">stripmsd</a> + dp_strip, dialplan2str(p-&gt;pri-&gt;dialplan));
<a name="l03842"></a>03842          pri_rel(p-&gt;pri);
<a name="l03843"></a>03843          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l03844"></a>03844          pri_sr_free(sr);
<a name="l03845"></a>03845          <span class="keywordflow">return</span> -1;
<a name="l03846"></a>03846       }
<a name="l03847"></a>03847       pri_sr_free(sr);
<a name="l03848"></a>03848       <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(ast, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa70881e902c6c29f27ffba80bb43554f">AST_STATE_DIALING</a>);
<a name="l03849"></a>03849       pri_rel(p-&gt;pri);
<a name="l03850"></a>03850    }
<a name="l03851"></a>03851 <span class="preprocessor">#endif</span>
<a name="l03852"></a>03852 <span class="preprocessor"></span>   <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l03853"></a>03853    <span class="keywordflow">return</span> 0;
<a name="l03854"></a>03854 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5492a7d85ebc949f2277cd55fbc3febe"></a><!-- doxytag: member="chan_dahdi.c::dahdi_callwait" ref="a5492a7d85ebc949f2277cd55fbc3febe" args="(struct ast_channel *ast)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int dahdi_callwait </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>ast</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l03059">3059</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="callerid_8c_source.html#l00258">ast_gen_cas()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00209">AST_LAW</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="astmm_8h_source.html#l00081">ast_malloc</a>, <a class="el" href="chan__dahdi_8c_source.html#l01070">dahdi_pvt::callwaitcas</a>, <a class="el" href="chan__dahdi_8c_source.html#l00403">CALLWAITING_REPEAT_SAMPLES</a>, <a class="el" href="chan__dahdi_8c_source.html#l00721">dahdi_pvt::callwaitingcallerid</a>, <a class="el" href="chan__dahdi_8c_source.html#l01047">dahdi_pvt::callwaitingrepeat</a>, <a class="el" href="chan__dahdi_8c_source.html#l01072">dahdi_pvt::callwaitrings</a>, <a class="el" href="chan__dahdi_8c_source.html#l01054">dahdi_pvt::cidlen</a>, <a class="el" href="chan__dahdi_8c_source.html#l01052">dahdi_pvt::cidpos</a>, <a class="el" href="chan__dahdi_8c_source.html#l01050">dahdi_pvt::cidspill</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__dahdi_8c_source.html#l00397">READ_SIZE</a>, <a class="el" href="chan__dahdi_8c_source.html#l02896">save_conference()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03026">send_callerid()</a>, and <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l03101">dahdi_call()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l06717">dahdi_read()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03060"></a>03060 {
<a name="l03061"></a>03061    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *p = ast-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l03062"></a>03062    p-&gt;<a class="code" href="structdahdi__pvt.html#acb6666d113ea3605f76a45fe3e90e192">callwaitingrepeat</a> = <a class="code" href="chan__dahdi_8c.html#a2422d71182014158dd163f020a8d4cc7">CALLWAITING_REPEAT_SAMPLES</a>;
<a name="l03063"></a>03063    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a>) {
<a name="l03064"></a>03064       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Spill already exists?!?\n&quot;</span>);
<a name="l03065"></a>03065       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a>);
<a name="l03066"></a>03066    }
<a name="l03067"></a>03067    <span class="keywordflow">if</span> (!(p-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a> = <a class="code" href="astmm_8h.html#a64a0e7a3ab511a3777ac56f5d43c628e">ast_malloc</a>(2400 <span class="comment">/* SAS */</span> + 680 <span class="comment">/* CAS */</span> + <a class="code" href="chan__dahdi_8c.html#a86e1969b50e55e5d506233078ca0fa4c">READ_SIZE</a> * 4)))
<a name="l03068"></a>03068       <span class="keywordflow">return</span> -1;
<a name="l03069"></a>03069    <a class="code" href="chan__dahdi_8c.html#a756c4e1d2909416c454b6e63d28f1db1">save_conference</a>(p);
<a name="l03070"></a>03070    <span class="comment">/* Silence */</span>
<a name="l03071"></a>03071    memset(p-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a>, 0x7f, 2400 + 600 + <a class="code" href="chan__dahdi_8c.html#a86e1969b50e55e5d506233078ca0fa4c">READ_SIZE</a> * 4);
<a name="l03072"></a>03072    <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="structdahdi__pvt.html#a9c8a40476c67374b9150fcbbb4b993af" title="Number of call waiting rings.">callwaitrings</a> &amp;&amp; p-&gt;<a class="code" href="structdahdi__pvt.html#a4a2ed3a92159fb783d3471ea7d76cf43" title="TRUE if send caller ID for Call Waiting.">callwaitingcallerid</a>) {
<a name="l03073"></a>03073       <a class="code" href="callerid_8h.html#a571971ad3245bec086419b6fdc77b6e5">ast_gen_cas</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a>, 1, 2400 + 680, <a class="code" href="chan__dahdi_8c.html#a830b5fdb3ba653640d3f5044192d82bf">AST_LAW</a>(p));
<a name="l03074"></a>03074       p-&gt;<a class="code" href="structdahdi__pvt.html#a7a4e9b0410dd0636d8f10df9ff51e0a3" title="BOOLEAN. XXX Meaning what??">callwaitcas</a> = 1;
<a name="l03075"></a>03075       p-&gt;<a class="code" href="structdahdi__pvt.html#a241dcb75aa2cae2b5c7b899eb95079d0" title="Length of the cidspill buffer containing samples.">cidlen</a> = 2400 + 680 + <a class="code" href="chan__dahdi_8c.html#a86e1969b50e55e5d506233078ca0fa4c">READ_SIZE</a> * 4;
<a name="l03076"></a>03076    } <span class="keywordflow">else</span> {
<a name="l03077"></a>03077       <a class="code" href="callerid_8h.html#a571971ad3245bec086419b6fdc77b6e5">ast_gen_cas</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a>, 1, 2400, <a class="code" href="chan__dahdi_8c.html#a830b5fdb3ba653640d3f5044192d82bf">AST_LAW</a>(p));
<a name="l03078"></a>03078       p-&gt;<a class="code" href="structdahdi__pvt.html#a7a4e9b0410dd0636d8f10df9ff51e0a3" title="BOOLEAN. XXX Meaning what??">callwaitcas</a> = 0;
<a name="l03079"></a>03079       p-&gt;<a class="code" href="structdahdi__pvt.html#a241dcb75aa2cae2b5c7b899eb95079d0" title="Length of the cidspill buffer containing samples.">cidlen</a> = 2400 + <a class="code" href="chan__dahdi_8c.html#a86e1969b50e55e5d506233078ca0fa4c">READ_SIZE</a> * 4;
<a name="l03080"></a>03080    }
<a name="l03081"></a>03081    p-&gt;<a class="code" href="structdahdi__pvt.html#ac0df3c8f4391be85a4d95a23866d4313" title="Position in the cidspill buffer to send out next.">cidpos</a> = 0;
<a name="l03082"></a>03082    <a class="code" href="chan__dahdi_8c.html#ae39659603ab09eecffce6638832c5b73">send_callerid</a>(p);
<a name="l03083"></a>03083 
<a name="l03084"></a>03084    <span class="keywordflow">return</span> 0;
<a name="l03085"></a>03085 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa9cd3a63b87d28e1862e023bfd8a9cbb"></a><!-- doxytag: member="chan_dahdi.c::dahdi_chan_conf_default" ref="aa9cd3a63b87d28e1862e023bfd8a9cbb" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structdahdi__chan__conf.html">dahdi_chan_conf</a> dahdi_chan_conf_default </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>returns a new <a class="el" href="structdahdi__chan__conf.html" title="Channel configuration from chan_dahdi.conf . This struct is used for parsing the...">dahdi_chan_conf</a> with default <a class="el" href="structvalues.html">values</a> (by-value) </p>

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l01266">1266</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="callerid_8h_source.html#l00057">CID_SIG_BELL</a>, <a class="el" href="callerid_8h_source.html#l00063">CID_START_RING</a>, <a class="el" href="chan__dahdi_8c_source.html#l00338">DAHDI_CHAN_MAPPING_PHYSICAL</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00205">DEFAULT_CIDRINGS</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l17079">setup_dahdi()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01267"></a>01267 {
<a name="l01268"></a>01268    <span class="comment">/* recall that if a field is not included here it is initialized</span>
<a name="l01269"></a>01269 <span class="comment">    * to 0 or equivalent</span>
<a name="l01270"></a>01270 <span class="comment">    */</span>
<a name="l01271"></a>01271    <span class="keyword">struct </span><a class="code" href="structdahdi__chan__conf.html" title="Channel configuration from chan_dahdi.conf . This struct is used for parsing the...">dahdi_chan_conf</a> conf = {
<a name="l01272"></a>01272 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l01273"></a>01273 <span class="preprocessor"></span>      .pri = {
<a name="l01274"></a>01274          .nsf = PRI_NSF_NONE,
<a name="l01275"></a>01275          .switchtype = PRI_SWITCH_NI2,
<a name="l01276"></a>01276          .dialplan = PRI_UNKNOWN + 1,
<a name="l01277"></a>01277          .localdialplan = PRI_NATIONAL_ISDN + 1,
<a name="l01278"></a>01278          .nodetype = PRI_CPE,
<a name="l01279"></a>01279          .qsigchannelmapping = <a class="code" href="chan__dahdi_8c.html#af23a6a3582578bef25f1062d0dea1fc9">DAHDI_CHAN_MAPPING_PHYSICAL</a>,
<a name="l01280"></a>01280 
<a name="l01281"></a>01281          .minunused = 2,
<a name="l01282"></a>01282          .idleext = <span class="stringliteral">&quot;&quot;</span>,
<a name="l01283"></a>01283          .idledial = <span class="stringliteral">&quot;&quot;</span>,
<a name="l01284"></a>01284          .internationalprefix = <span class="stringliteral">&quot;&quot;</span>,
<a name="l01285"></a>01285          .nationalprefix = <span class="stringliteral">&quot;&quot;</span>,
<a name="l01286"></a>01286          .localprefix = <span class="stringliteral">&quot;&quot;</span>,
<a name="l01287"></a>01287          .privateprefix = <span class="stringliteral">&quot;&quot;</span>,
<a name="l01288"></a>01288          .unknownprefix = <span class="stringliteral">&quot;&quot;</span>,
<a name="l01289"></a>01289          .resetinterval = -1,
<a name="l01290"></a>01290       },
<a name="l01291"></a>01291 <span class="preprocessor">#endif</span>
<a name="l01292"></a>01292 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_SS7</span>
<a name="l01293"></a>01293 <span class="preprocessor"></span>      .ss7 = {
<a name="l01294"></a>01294          .called_nai = SS7_NAI_NATIONAL,
<a name="l01295"></a>01295          .calling_nai = SS7_NAI_NATIONAL,
<a name="l01296"></a>01296          .internationalprefix = <span class="stringliteral">&quot;&quot;</span>,
<a name="l01297"></a>01297          .nationalprefix = <span class="stringliteral">&quot;&quot;</span>,
<a name="l01298"></a>01298          .subscriberprefix = <span class="stringliteral">&quot;&quot;</span>,
<a name="l01299"></a>01299          .unknownprefix = <span class="stringliteral">&quot;&quot;</span>
<a name="l01300"></a>01300       },
<a name="l01301"></a>01301 <span class="preprocessor">#endif</span>
<a name="l01302"></a>01302 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_OPENR2</span>
<a name="l01303"></a>01303 <span class="preprocessor"></span>      .mfcr2 = {
<a name="l01304"></a>01304          .variant = OR2_VAR_ITU,
<a name="l01305"></a>01305          .mfback_timeout = -1,
<a name="l01306"></a>01306          .metering_pulse_timeout = -1,
<a name="l01307"></a>01307          .max_ani = 10,
<a name="l01308"></a>01308          .max_dnis = 4,
<a name="l01309"></a>01309          .get_ani_first = -1,
<a name="l01310"></a>01310 <span class="preprocessor">#if defined(OR2_LIB_INTERFACE) &amp;&amp; OR2_LIB_INTERFACE &gt; 1</span>
<a name="l01311"></a>01311 <span class="preprocessor"></span>         .skip_category_request = -1,
<a name="l01312"></a>01312 <span class="preprocessor">#endif</span>
<a name="l01313"></a>01313 <span class="preprocessor"></span>         .call_files = 0,
<a name="l01314"></a>01314          .allow_collect_calls = 0,
<a name="l01315"></a>01315          .charge_calls = 1,
<a name="l01316"></a>01316          .accept_on_offer = 1,
<a name="l01317"></a>01317          .forced_release = 0,
<a name="l01318"></a>01318          .double_answer = 0,
<a name="l01319"></a>01319          .immediate_accept = -1,
<a name="l01320"></a>01320          .logdir = <span class="stringliteral">&quot;&quot;</span>,
<a name="l01321"></a>01321          .r2proto_file = <span class="stringliteral">&quot;&quot;</span>,
<a name="l01322"></a>01322          .loglevel = OR2_LOG_ERROR | OR2_LOG_WARNING,
<a name="l01323"></a>01323          .category = OR2_CALLING_PARTY_CATEGORY_NATIONAL_SUBSCRIBER
<a name="l01324"></a>01324       },
<a name="l01325"></a>01325 <span class="preprocessor">#endif</span>
<a name="l01326"></a>01326 <span class="preprocessor"></span>      .chan = {
<a name="l01327"></a>01327          .context = <span class="stringliteral">&quot;default&quot;</span>,
<a name="l01328"></a>01328          .cid_num = <span class="stringliteral">&quot;&quot;</span>,
<a name="l01329"></a>01329          .cid_name = <span class="stringliteral">&quot;&quot;</span>,
<a name="l01330"></a>01330          .mohinterpret = <span class="stringliteral">&quot;default&quot;</span>,
<a name="l01331"></a>01331          .mohsuggest = <span class="stringliteral">&quot;&quot;</span>,
<a name="l01332"></a>01332          .parkinglot = <span class="stringliteral">&quot;&quot;</span>,
<a name="l01333"></a>01333          .transfertobusy = 1,
<a name="l01334"></a>01334 
<a name="l01335"></a>01335          .cid_signalling = <a class="code" href="callerid_8h.html#ac4765a6a92728d0defdddd89570baf34">CID_SIG_BELL</a>,
<a name="l01336"></a>01336          .cid_start = <a class="code" href="callerid_8h.html#ab95ac6538ec3b930163ffd43f62063de">CID_START_RING</a>,
<a name="l01337"></a>01337          .dahditrcallerid = 0,
<a name="l01338"></a>01338          .use_callerid = 1,
<a name="l01339"></a>01339          .sig = -1,
<a name="l01340"></a>01340          .outsigmod = -1,
<a name="l01341"></a>01341 
<a name="l01342"></a>01342          .cid_rxgain = +5.0,
<a name="l01343"></a>01343 
<a name="l01344"></a>01344          .tonezone = -1,
<a name="l01345"></a>01345 
<a name="l01346"></a>01346          .echocancel.head.tap_length = 1,
<a name="l01347"></a>01347 
<a name="l01348"></a>01348          .busycount = 3,
<a name="l01349"></a>01349 
<a name="l01350"></a>01350          .accountcode = <span class="stringliteral">&quot;&quot;</span>,
<a name="l01351"></a>01351 
<a name="l01352"></a>01352          .mailbox = <span class="stringliteral">&quot;&quot;</span>,
<a name="l01353"></a>01353 
<a name="l01354"></a>01354 <span class="preprocessor">#ifdef HAVE_DAHDI_LINEREVERSE_VMWI</span>
<a name="l01355"></a>01355 <span class="preprocessor"></span>         .mwisend_fsk = 1,
<a name="l01356"></a>01356 <span class="preprocessor">#endif</span>
<a name="l01357"></a>01357 <span class="preprocessor"></span>         .polarityonanswerdelay = 600,
<a name="l01358"></a>01358 
<a name="l01359"></a>01359          .sendcalleridafter = <a class="code" href="chan__dahdi_8c.html#ad39eeeb16f274560c29b960b2096d6d7" title="Typically, how many rings before we should send Caller*ID.">DEFAULT_CIDRINGS</a>,
<a name="l01360"></a>01360 
<a name="l01361"></a>01361          .buf_policy = DAHDI_POLICY_IMMEDIATE,
<a name="l01362"></a>01362          .buf_no = <a class="code" href="chan__dahdi_8c.html#a1c57b0f6ff35a4eed5cd50a0d0c313ba">numbufs</a>,
<a name="l01363"></a>01363          .usefaxbuffers = 0,
<a name="l01364"></a>01364          .faxbuf_policy = DAHDI_POLICY_IMMEDIATE,
<a name="l01365"></a>01365          .faxbuf_no = <a class="code" href="chan__dahdi_8c.html#a1c57b0f6ff35a4eed5cd50a0d0c313ba">numbufs</a>,
<a name="l01366"></a>01366       },
<a name="l01367"></a>01367       .timing = {
<a name="l01368"></a>01368          .prewinktime = -1,
<a name="l01369"></a>01369          .preflashtime = -1,
<a name="l01370"></a>01370          .winktime = -1,
<a name="l01371"></a>01371          .flashtime = -1,
<a name="l01372"></a>01372          .starttime = -1,
<a name="l01373"></a>01373          .rxwinktime = -1,
<a name="l01374"></a>01374          .rxflashtime = -1,
<a name="l01375"></a>01375          .debouncetime = -1
<a name="l01376"></a>01376       },
<a name="l01377"></a>01377       .is_sig_auto = 1,
<a name="l01378"></a>01378       .smdi_port = <span class="stringliteral">&quot;/dev/ttyS0&quot;</span>,
<a name="l01379"></a>01379    };
<a name="l01380"></a>01380 
<a name="l01381"></a>01381    <span class="keywordflow">return</span> conf;
<a name="l01382"></a>01382 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad726278395475a038d37c0c0bddbd82c"></a><!-- doxytag: member="chan_dahdi.c::dahdi_close" ref="ad726278395475a038d37c0c0bddbd82c" args="(int fd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void dahdi_close </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l02137">2137</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l02143">dahdi_close_sub()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02138"></a>02138 {
<a name="l02139"></a>02139    <span class="keywordflow">if</span> (fd &gt; 0)
<a name="l02140"></a>02140       close(fd);
<a name="l02141"></a>02141 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa677933b22aeb7b907176d84357464c0"></a><!-- doxytag: member="chan_dahdi.c::dahdi_close_sub" ref="aa677933b22aeb7b907176d84357464c0" args="(struct dahdi_pvt *chan_pvt, int sub_num)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void dahdi_close_sub </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>chan_pvt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>sub_num</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l02143">2143</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="chan__dahdi_8c_source.html#l02137">dahdi_close()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l02175">alloc_sub()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03856">destroy_dahdi_pvt()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l02212">unalloc_sub()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02144"></a>02144 {
<a name="l02145"></a>02145    <a class="code" href="chan__dahdi_8c.html#ad726278395475a038d37c0c0bddbd82c">dahdi_close</a>(chan_pvt-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[sub_num].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>);
<a name="l02146"></a>02146    chan_pvt-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[sub_num].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a> = -1;
<a name="l02147"></a>02147 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a04126d689aca51a8a38499685cffe8f6"></a><!-- doxytag: member="chan_dahdi.c::dahdi_confmute" ref="a04126d689aca51a8a38499685cffe8f6" args="(struct dahdi_pvt *p, int muted)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int dahdi_confmute </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>muted</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l02880">2880</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__dahdi_8c_source.html#l00666">dahdi_pvt::sig</a>, <a class="el" href="chan__dahdi_8c_source.html#l00256">SIG_BRI</a>, <a class="el" href="chan__dahdi_8c_source.html#l00257">SIG_BRI_PTMP</a>, <a class="el" href="chan__dahdi_8c_source.html#l00255">SIG_PRI</a>, <a class="el" href="chan__dahdi_8c_source.html#l00258">SIG_SS7</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l05607">dahdi_handle_dtmfup()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04313">dahdi_hangup()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07417">dahdi_new()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l06717">dahdi_read()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02881"></a>02881 {
<a name="l02882"></a>02882    <span class="keywordtype">int</span> x, y, res;
<a name="l02883"></a>02883    x = muted;
<a name="l02884"></a>02884    <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#ae9ab0c9508fca045a06730533be276a5">SIG_PRI</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#aadcda889db3cf9dfe757dbc1d4d8311a">SIG_SS7</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#ab5bfeaf991c23c5b6510ace44ae79ce9">SIG_BRI</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a>)) {
<a name="l02885"></a>02885       y = 1;
<a name="l02886"></a>02886       res = ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_AUDIOMODE, &amp;y);
<a name="l02887"></a>02887       <span class="keywordflow">if</span> (res)
<a name="l02888"></a>02888          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to set audio mode on %d: %s\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, strerror(errno));
<a name="l02889"></a>02889    }
<a name="l02890"></a>02890    res = ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_CONFMUTE, &amp;x);
<a name="l02891"></a>02891    <span class="keywordflow">if</span> (res &lt; 0)
<a name="l02892"></a>02892       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;DAHDI confmute(%d) failed on channel %d: %s\n&quot;</span>, muted, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, strerror(errno));
<a name="l02893"></a>02893    <span class="keywordflow">return</span> res;
<a name="l02894"></a>02894 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2ec2516444763db4d7e46e5a246cafb8"></a><!-- doxytag: member="chan_dahdi.c::dahdi_destroy_channel" ref="a2ec2516444763db4d7e46e5a246cafb8" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* dahdi_destroy_channel </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l14287">14287</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8h_source.html#l00141">ast_cli_args::argv</a>, <a class="el" href="cli_8h_source.html#l00045">CLI_FAILURE</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="chan__dahdi_8c_source.html#l09249">dahdi_destroy_channel_bynum()</a>, <a class="el" href="cli_8h_source.html#l00039">RESULT_SUCCESS</a>, and <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l14288"></a>14288 {
<a name="l14289"></a>14289    <span class="keywordtype">int</span> channel;
<a name="l14290"></a>14290    <span class="keywordtype">int</span> ret;
<a name="l14291"></a>14291    <span class="keywordflow">switch</span> (cmd) {
<a name="l14292"></a>14292    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l14293"></a>14293       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;dahdi destroy channel&quot;</span>;
<a name="l14294"></a>14294       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l14295"></a>14295          <span class="stringliteral">&quot;Usage: dahdi destroy channel &lt;chan num&gt;\n&quot;</span>
<a name="l14296"></a>14296          <span class="stringliteral">&quot;  DON&apos;T USE THIS UNLESS YOU KNOW WHAT YOU ARE DOING.  Immediately removes a given channel, whether it is in use or not\n&quot;</span>;
<a name="l14297"></a>14297       <span class="keywordflow">return</span> NULL;
<a name="l14298"></a>14298    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l14299"></a>14299       <span class="keywordflow">return</span> NULL;
<a name="l14300"></a>14300    }
<a name="l14301"></a>14301    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> != 4)
<a name="l14302"></a>14302       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l14303"></a>14303 
<a name="l14304"></a>14304    channel = atoi(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3]);
<a name="l14305"></a>14305    ret = <a class="code" href="chan__dahdi_8c.html#aa8761113e1a59e2a550d60cd5a232f71">dahdi_destroy_channel_bynum</a>(channel);
<a name="l14306"></a>14306    <span class="keywordflow">return</span> ( <a class="code" href="cli_8h.html#a7cc1753a05a0821f6c70dd2bccfbab5c">RESULT_SUCCESS</a> == ret ) ? <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a> : <a class="code" href="cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;
<a name="l14307"></a>14307 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa8761113e1a59e2a550d60cd5a232f71"></a><!-- doxytag: member="chan_dahdi.c::dahdi_destroy_channel_bynum" ref="aa8761113e1a59e2a550d60cd5a232f71" args="(int channel)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int dahdi_destroy_channel_bynum </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>channel</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l09249">9249</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="loader_8c_source.html#l01171">ast_module_unref()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="chan__dahdi_8c_source.html#l03879">destroy_channel()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>, <a class="el" href="chan__dahdi_8c_source.html#l00682">dahdi_pvt::next</a>, <a class="el" href="chan__dahdi_8c_source.html#l00683">dahdi_pvt::prev</a>, <a class="el" href="cli_8h_source.html#l00041">RESULT_FAILURE</a>, <a class="el" href="cli_8h_source.html#l00039">RESULT_SUCCESS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l14287">dahdi_destroy_channel()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l09496">do_monitor()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09250"></a>09250 {
<a name="l09251"></a>09251    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *tmp = NULL;
<a name="l09252"></a>09252    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *<a class="code" href="structdahdi__pvt.html#abba5e5e1dcf19b4ded5000d926e0a70d">prev</a> = NULL;
<a name="l09253"></a>09253 
<a name="l09254"></a>09254    tmp = <a class="code" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>;
<a name="l09255"></a>09255    <span class="keywordflow">while</span> (tmp) {
<a name="l09256"></a>09256       <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a> == <a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>) {
<a name="l09257"></a>09257          <span class="keywordtype">int</span> x = DAHDI_FLASH;
<a name="l09258"></a>09258          ioctl(tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_HOOK, &amp;x); <span class="comment">/* important to create an event for dahdi_wait_event to register so that all ss_threads terminate */</span>
<a name="l09259"></a>09259          <a class="code" href="chan__dahdi_8c.html#a707746b49a41e00df8477523111cb7f3">destroy_channel</a>(prev, tmp, 1);
<a name="l09260"></a>09260          <a class="code" href="module_8h.html#ac65fa15b16dbc563a2424af744ab003d">ast_module_unref</a>(<a class="code" href="structast__module__info.html">ast_module_info</a>-&gt;self);
<a name="l09261"></a>09261          <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a7cc1753a05a0821f6c70dd2bccfbab5c">RESULT_SUCCESS</a>;
<a name="l09262"></a>09262       }
<a name="l09263"></a>09263       prev = tmp;
<a name="l09264"></a>09264       tmp = tmp-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>;
<a name="l09265"></a>09265    }
<a name="l09266"></a>09266    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#aea87ce97f86effb2c4df6274d4aac567">RESULT_FAILURE</a>;
<a name="l09267"></a>09267 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a352de2c30588a73da8caa5910f7acea8"></a><!-- doxytag: member="chan_dahdi.c::dahdi_digit_begin" ref="a352de2c30588a73da8caa5910f7acea8" args="(struct ast_channel *ast, char digit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int dahdi_digit_begin </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>ast</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>digit</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l02245">2245</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00469">ast_channel::_state</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="channel_8h_source.html#l00362">AST_STATE_DIALING</a>, <a class="el" href="chan__dahdi_8c_source.html#l01227">dahdi_pvt::begindigit</a>, <a class="el" href="chan__dahdi_8c_source.html#l01503">dahdi_get_index()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="chan__dahdi_8c_source.html#l01133">dahdi_pvt::dialdest</a>, <a class="el" href="chan__dahdi_8c_source.html#l00745">dahdi_pvt::dialing</a>, <a class="el" href="chan__dahdi_8c_source.html#l02229">digit_to_dtmfindex()</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="chan__dahdi_8c_source.html#l00649">dahdi_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__dahdi_8c_source.html#l00650">dahdi_pvt::owner</a>, <a class="el" href="chan__dahdi_8c_source.html#l00828">dahdi_pvt::pulse</a>, <a class="el" href="chan__dahdi_8c_source.html#l00666">dahdi_pvt::sig</a>, <a class="el" href="chan__dahdi_8c_source.html#l00256">SIG_BRI</a>, <a class="el" href="chan__dahdi_8c_source.html#l00257">SIG_BRI_PTMP</a>, <a class="el" href="chan__dahdi_8c_source.html#l00255">SIG_PRI</a>, <a class="el" href="chan__dahdi_8c_source.html#l01042">dahdi_pvt::span</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>, and <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02246"></a>02246 {
<a name="l02247"></a>02247    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *pvt;
<a name="l02248"></a>02248    <span class="keywordtype">int</span> idx;
<a name="l02249"></a>02249    <span class="keywordtype">int</span> dtmf = -1;
<a name="l02250"></a>02250 
<a name="l02251"></a>02251    pvt = <a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l02252"></a>02252 
<a name="l02253"></a>02253    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;pvt-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l02254"></a>02254 
<a name="l02255"></a>02255    idx = <a class="code" href="chan__dahdi_8c.html#a62c8e3f411fb9e5ec62a1e77c152c2df">dahdi_get_index</a>(<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, pvt, 0);
<a name="l02256"></a>02256 
<a name="l02257"></a>02257    <span class="keywordflow">if</span> ((idx != <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>) || !pvt-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)
<a name="l02258"></a>02258       <span class="keywordflow">goto</span> out;
<a name="l02259"></a>02259 
<a name="l02260"></a>02260 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l02261"></a>02261 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (((pvt-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#ae9ab0c9508fca045a06730533be276a5">SIG_PRI</a>) || (pvt-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#ab5bfeaf991c23c5b6510ace44ae79ce9">SIG_BRI</a>) || (pvt-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a>))
<a name="l02262"></a>02262          &amp;&amp; (<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa70881e902c6c29f27ffba80bb43554f">AST_STATE_DIALING</a>) &amp;&amp; !pvt-&gt;proceeding) {
<a name="l02263"></a>02263       <span class="keywordflow">if</span> (pvt-&gt;setup_ack) {
<a name="l02264"></a>02264          <span class="keywordflow">if</span> (!pri_grab(pvt, pvt-&gt;pri)) {
<a name="l02265"></a>02265             pri_information(pvt-&gt;pri-&gt;pri, pvt-&gt;call, digit);
<a name="l02266"></a>02266             pri_rel(pvt-&gt;pri);
<a name="l02267"></a>02267          } <span class="keywordflow">else</span>
<a name="l02268"></a>02268             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to grab PRI on span %d\n&quot;</span>, pvt-&gt;<a class="code" href="structdahdi__pvt.html#a63fc22149930803b4e3fb4c453177e5e">span</a>);
<a name="l02269"></a>02269       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strlen(pvt-&gt;<a class="code" href="structdahdi__pvt.html#a0368d49962f1bf26c2603ade03cd8ee9" title="Delayed dialing for E911. Overlap digits for ISDN.">dialdest</a>) &lt; <span class="keyword">sizeof</span>(pvt-&gt;<a class="code" href="structdahdi__pvt.html#a0368d49962f1bf26c2603ade03cd8ee9" title="Delayed dialing for E911. Overlap digits for ISDN.">dialdest</a>) - 1) {
<a name="l02270"></a>02270          <span class="keywordtype">int</span> res;
<a name="l02271"></a>02271          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Queueing digit &apos;%c&apos; since setup_ack not yet received\n&quot;</span>, digit);
<a name="l02272"></a>02272          res = strlen(pvt-&gt;<a class="code" href="structdahdi__pvt.html#a0368d49962f1bf26c2603ade03cd8ee9" title="Delayed dialing for E911. Overlap digits for ISDN.">dialdest</a>);
<a name="l02273"></a>02273          pvt-&gt;<a class="code" href="structdahdi__pvt.html#a0368d49962f1bf26c2603ade03cd8ee9" title="Delayed dialing for E911. Overlap digits for ISDN.">dialdest</a>[res++] = digit;
<a name="l02274"></a>02274          pvt-&gt;<a class="code" href="structdahdi__pvt.html#a0368d49962f1bf26c2603ade03cd8ee9" title="Delayed dialing for E911. Overlap digits for ISDN.">dialdest</a>[res] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l02275"></a>02275       }
<a name="l02276"></a>02276       <span class="keywordflow">goto</span> out;
<a name="l02277"></a>02277    }
<a name="l02278"></a>02278 <span class="preprocessor">#endif</span>
<a name="l02279"></a>02279 <span class="preprocessor"></span>   <span class="keywordflow">if</span> ((dtmf = <a class="code" href="chan__dahdi_8c.html#a8f89c806d859f8f9acec697afa7eca9a">digit_to_dtmfindex</a>(digit)) == -1)
<a name="l02280"></a>02280       <span class="keywordflow">goto</span> out;
<a name="l02281"></a>02281 
<a name="l02282"></a>02282    <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structdahdi__pvt.html#a68d59a550fd5b3d5ce6d59388044ad63" title="TRUE if we will pulse dial.">pulse</a> || ioctl(pvt-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_SENDTONE, &amp;dtmf)) {
<a name="l02283"></a>02283       <span class="keywordtype">int</span> res;
<a name="l02284"></a>02284       <span class="keyword">struct </span>dahdi_dialoperation zo = {
<a name="l02285"></a>02285          .op = DAHDI_DIAL_OP_APPEND,
<a name="l02286"></a>02286       };
<a name="l02287"></a>02287 
<a name="l02288"></a>02288       zo.dialstr[0] = <span class="charliteral">&apos;T&apos;</span>;
<a name="l02289"></a>02289       zo.dialstr[1] = digit;
<a name="l02290"></a>02290       zo.dialstr[2] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l02291"></a>02291       <span class="keywordflow">if</span> ((res = ioctl(pvt-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_DIAL, &amp;zo)))
<a name="l02292"></a>02292          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Couldn&apos;t dial digit %c: %s\n&quot;</span>, digit, strerror(errno));
<a name="l02293"></a>02293       <span class="keywordflow">else</span>
<a name="l02294"></a>02294          pvt-&gt;<a class="code" href="structdahdi__pvt.html#af17335c0c7a4c1e03e987a33f6eec81b" title="TRUE if in the process of dialing digits or sending something.">dialing</a> = 1;
<a name="l02295"></a>02295    } <span class="keywordflow">else</span> {
<a name="l02296"></a>02296       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Started VLDTMF digit &apos;%c&apos;\n&quot;</span>, digit);
<a name="l02297"></a>02297       pvt-&gt;<a class="code" href="structdahdi__pvt.html#af17335c0c7a4c1e03e987a33f6eec81b" title="TRUE if in the process of dialing digits or sending something.">dialing</a> = 1;
<a name="l02298"></a>02298       pvt-&gt;<a class="code" href="structdahdi__pvt.html#ad0226e703a5a4d0940fdf30f3e818875" title="DTMF digit in progress. 0 when no digit in progress.">begindigit</a> = digit;
<a name="l02299"></a>02299    }
<a name="l02300"></a>02300 
<a name="l02301"></a>02301 out:
<a name="l02302"></a>02302    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l02303"></a>02303 
<a name="l02304"></a>02304    <span class="keywordflow">return</span> 0;
<a name="l02305"></a>02305 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4860117d2bdcbf32945465ff739706a2"></a><!-- doxytag: member="chan_dahdi.c::dahdi_digit_end" ref="a4860117d2bdcbf32945465ff739706a2" args="(struct ast_channel *ast, char digit, unsigned int duration)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int dahdi_digit_end </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>ast</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>digit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>duration</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l02307">2307</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01227">dahdi_pvt::begindigit</a>, <a class="el" href="chan__dahdi_8c_source.html#l01503">dahdi_get_index()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="chan__dahdi_8c_source.html#l00745">dahdi_pvt::dialing</a>, <a class="el" href="chan__dahdi_8c_source.html#l00649">dahdi_pvt::lock</a>, <a class="el" href="chan__dahdi_8c_source.html#l00650">dahdi_pvt::owner</a>, <a class="el" href="chan__dahdi_8c_source.html#l00828">dahdi_pvt::pulse</a>, <a class="el" href="chan__dahdi_8c_source.html#l00666">dahdi_pvt::sig</a>, <a class="el" href="chan__dahdi_8c_source.html#l00256">SIG_BRI</a>, <a class="el" href="chan__dahdi_8c_source.html#l00257">SIG_BRI_PTMP</a>, <a class="el" href="chan__dahdi_8c_source.html#l00255">SIG_PRI</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>, and <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02308"></a>02308 {
<a name="l02309"></a>02309    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *pvt;
<a name="l02310"></a>02310    <span class="keywordtype">int</span> res = 0;
<a name="l02311"></a>02311    <span class="keywordtype">int</span> idx;
<a name="l02312"></a>02312    <span class="keywordtype">int</span> x;
<a name="l02313"></a>02313 
<a name="l02314"></a>02314    pvt = <a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l02315"></a>02315 
<a name="l02316"></a>02316    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;pvt-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l02317"></a>02317 
<a name="l02318"></a>02318    idx = <a class="code" href="chan__dahdi_8c.html#a62c8e3f411fb9e5ec62a1e77c152c2df">dahdi_get_index</a>(<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, pvt, 0);
<a name="l02319"></a>02319 
<a name="l02320"></a>02320    <span class="keywordflow">if</span> ((idx != <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>) || !pvt-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> || pvt-&gt;<a class="code" href="structdahdi__pvt.html#a68d59a550fd5b3d5ce6d59388044ad63" title="TRUE if we will pulse dial.">pulse</a>)
<a name="l02321"></a>02321       <span class="keywordflow">goto</span> out;
<a name="l02322"></a>02322 
<a name="l02323"></a>02323 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l02324"></a>02324 <span class="preprocessor"></span>   <span class="comment">/* This means that the digit was already sent via PRI signalling */</span>
<a name="l02325"></a>02325    <span class="keywordflow">if</span> (((pvt-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#ae9ab0c9508fca045a06730533be276a5">SIG_PRI</a>) || (pvt-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#ab5bfeaf991c23c5b6510ace44ae79ce9">SIG_BRI</a>) || (pvt-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a>))
<a name="l02326"></a>02326          &amp;&amp; !pvt-&gt;<a class="code" href="structdahdi__pvt.html#ad0226e703a5a4d0940fdf30f3e818875" title="DTMF digit in progress. 0 when no digit in progress.">begindigit</a>)
<a name="l02327"></a>02327       <span class="keywordflow">goto</span> out;
<a name="l02328"></a>02328 <span class="preprocessor">#endif</span>
<a name="l02329"></a>02329 <span class="preprocessor"></span>
<a name="l02330"></a>02330    <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structdahdi__pvt.html#ad0226e703a5a4d0940fdf30f3e818875" title="DTMF digit in progress. 0 when no digit in progress.">begindigit</a>) {
<a name="l02331"></a>02331       x = -1;
<a name="l02332"></a>02332       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Ending VLDTMF digit &apos;%c&apos;\n&quot;</span>, digit);
<a name="l02333"></a>02333       res = ioctl(pvt-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_SENDTONE, &amp;x);
<a name="l02334"></a>02334       pvt-&gt;<a class="code" href="structdahdi__pvt.html#af17335c0c7a4c1e03e987a33f6eec81b" title="TRUE if in the process of dialing digits or sending something.">dialing</a> = 0;
<a name="l02335"></a>02335       pvt-&gt;<a class="code" href="structdahdi__pvt.html#ad0226e703a5a4d0940fdf30f3e818875" title="DTMF digit in progress. 0 when no digit in progress.">begindigit</a> = 0;
<a name="l02336"></a>02336    }
<a name="l02337"></a>02337 
<a name="l02338"></a>02338 out:
<a name="l02339"></a>02339    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pvt-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l02340"></a>02340 
<a name="l02341"></a>02341    <span class="keywordflow">return</span> res;
<a name="l02342"></a>02342 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5ceb6fd5bd012740d50b04e84fb29be4"></a><!-- doxytag: member="chan_dahdi.c::dahdi_disable_ec" ref="a5ceb6fd5bd012740d50b04e84fb29be4" args="(struct dahdi_pvt *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void dahdi_disable_ec </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l02709">2709</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="chan__dahdi_8c_source.html#l00759">dahdi_pvt::echocanon</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l06601">__dahdi_exception()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05156">dahdi_bridge()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04313">dahdi_hangup()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04837">dahdi_setoption()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02710"></a>02710 {
<a name="l02711"></a>02711    <span class="keywordtype">int</span> res;
<a name="l02712"></a>02712 
<a name="l02713"></a>02713    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a02f7d8025e31d288688f4b53215369f4" title="TRUE if echo cancellation is turned on.">echocanon</a>) {
<a name="l02714"></a>02714       <span class="keyword">struct </span>dahdi_echocanparams ecp = { .tap_length = 0 };
<a name="l02715"></a>02715 
<a name="l02716"></a>02716       res = ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_ECHOCANCEL_PARAMS, &amp;ecp);
<a name="l02717"></a>02717 
<a name="l02718"></a>02718       <span class="keywordflow">if</span> (res)
<a name="l02719"></a>02719          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to disable echo cancellation on channel %d: %s\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, strerror(errno));
<a name="l02720"></a>02720       <span class="keywordflow">else</span>
<a name="l02721"></a>02721          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Disabled echo cancellation on channel %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l02722"></a>02722    }
<a name="l02723"></a>02723 
<a name="l02724"></a>02724    p-&gt;<a class="code" href="structdahdi__pvt.html#a02f7d8025e31d288688f4b53215369f4" title="TRUE if echo cancellation is turned on.">echocanon</a> = 0;
<a name="l02725"></a>02725 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4a0331eaa4997597bbca98a66c514bcd"></a><!-- doxytag: member="chan_dahdi.c::dahdi_dnd" ref="a4a0331eaa4997597bbca98a66c514bcd" args="(struct dahdi_pvt *dahdichan, int on)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void dahdi_dnd </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>dahdichan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>on</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>enable or disable the chan_dahdi Do-Not-Disturb mode for a DAHDI channel </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dahdichan</em>&nbsp;</td><td>"Physical" DAHDI channel (e.g: DAHDI/5) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>on</em>&nbsp;</td><td>1 to enable, 0 to disable</td></tr>
  </table>
  </dd>
</dl>
<p>chan_dahdi has a DND (Do Not Disturb) mode for each dahdichan (physical DAHDI channel). Use this to enable or disable it.</p>
<dl class="bug"><dt><b><a class="el" href="bug.html#_bug000001">Bug:</a></b></dt><dd>the use of the word "channel" for those dahdichans is really confusing. </dd></dl>

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l07662">7662</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="chan__dahdi_8c_source.html#l00749">dahdi_pvt::dnd</a>, <a class="el" href="manager_8h_source.html#l00061">EVENT_FLAG_SYSTEM</a>, and <a class="el" href="manager_8h_source.html#l00181">manager_event</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l15112">dahdi_set_dnd()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l07663"></a>07663 {
<a name="l07664"></a>07664    <span class="comment">/* Do not disturb */</span>
<a name="l07665"></a>07665    dahdichan-&gt;<a class="code" href="structdahdi__pvt.html#a1a8eeacca010367ea43120ef6ac08aa1" title="TRUE if Do-Not-Disturb is enabled.">dnd</a> = on;
<a name="l07666"></a>07666    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;%s DND on channel %d\n&quot;</span>,
<a name="l07667"></a>07667          on? <span class="stringliteral">&quot;Enabled&quot;</span> : <span class="stringliteral">&quot;Disabled&quot;</span>,
<a name="l07668"></a>07668          dahdichan-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l07669"></a>07669    <a class="code" href="manager_8h.html#a1ef0ee0044dbbeb4c3a5abc6c046b208" title="External routines may send asterisk manager events this way.">manager_event</a>(<a class="code" href="manager_8h.html#a420f0f755e1c3378b45ca7f6f0669ffa">EVENT_FLAG_SYSTEM</a>, <span class="stringliteral">&quot;DNDState&quot;</span>,
<a name="l07670"></a>07670          <span class="stringliteral">&quot;Channel: DAHDI/%d\r\n&quot;</span>
<a name="l07671"></a>07671          <span class="stringliteral">&quot;Status: %s\r\n&quot;</span>, dahdichan-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>,
<a name="l07672"></a>07672          on? <span class="stringliteral">&quot;enabled&quot;</span> : <span class="stringliteral">&quot;disabled&quot;</span>);
<a name="l07673"></a>07673 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8c34a5bce2b26d056942349217806312"></a><!-- doxytag: member="chan_dahdi.c::dahdi_enable_ec" ref="a8c34a5bce2b26d056942349217806312" args="(struct dahdi_pvt *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void dahdi_enable_ec </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l02660">2660</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="chan__dahdi_8c_source.html#l00747">dahdi_pvt::digital</a>, <a class="el" href="structdahdi__pvt.html#a12f1128b223526997d1601ee6e33325d">dahdi_pvt::echocancel</a>, <a class="el" href="chan__dahdi_8c_source.html#l00759">dahdi_pvt::echocanon</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="chan__dahdi_8c_source.html#l01075">dahdi_pvt::head</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__dahdi_8c_source.html#l00666">dahdi_pvt::sig</a>, <a class="el" href="chan__dahdi_8c_source.html#l00256">SIG_BRI</a>, <a class="el" href="chan__dahdi_8c_source.html#l00257">SIG_BRI_PTMP</a>, <a class="el" href="chan__dahdi_8c_source.html#l00255">SIG_PRI</a>, <a class="el" href="chan__dahdi_8c_source.html#l00258">SIG_SS7</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l06601">__dahdi_exception()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04718">dahdi_answer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05156">dahdi_bridge()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07170">dahdi_indicate()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04837">dahdi_setoption()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02661"></a>02661 {
<a name="l02662"></a>02662    <span class="keywordtype">int</span> x;
<a name="l02663"></a>02663    <span class="keywordtype">int</span> res;
<a name="l02664"></a>02664    <span class="keywordflow">if</span> (!p)
<a name="l02665"></a>02665       <span class="keywordflow">return</span>;
<a name="l02666"></a>02666    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a02f7d8025e31d288688f4b53215369f4" title="TRUE if echo cancellation is turned on.">echocanon</a>) {
<a name="l02667"></a>02667       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Echo cancellation already on\n&quot;</span>);
<a name="l02668"></a>02668       <span class="keywordflow">return</span>;
<a name="l02669"></a>02669    }
<a name="l02670"></a>02670    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#adf54768a4327f86de3a234648305c4a4" title="TRUE if the transfer capability of the call is digital.">digital</a>) {
<a name="l02671"></a>02671       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Echo cancellation isn&apos;t required on digital connection\n&quot;</span>);
<a name="l02672"></a>02672       <span class="keywordflow">return</span>;
<a name="l02673"></a>02673    }
<a name="l02674"></a>02674    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a12f1128b223526997d1601ee6e33325d" title="Echo cancel parameters.">echocancel</a>.<a class="code" href="structdahdi__pvt.html#ad4baed46a5922e2eecd2876f455dc726">head</a>.tap_length) {
<a name="l02675"></a>02675       <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#ab5bfeaf991c23c5b6510ace44ae79ce9">SIG_BRI</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#ae9ab0c9508fca045a06730533be276a5">SIG_PRI</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#aadcda889db3cf9dfe757dbc1d4d8311a">SIG_SS7</a>)) {
<a name="l02676"></a>02676          x = 1;
<a name="l02677"></a>02677          res = ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_AUDIOMODE, &amp;x);
<a name="l02678"></a>02678          <span class="keywordflow">if</span> (res)
<a name="l02679"></a>02679             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to enable audio mode on channel %d (%s)\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, strerror(errno));
<a name="l02680"></a>02680       }
<a name="l02681"></a>02681       res = ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_ECHOCANCEL_PARAMS, &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a12f1128b223526997d1601ee6e33325d" title="Echo cancel parameters.">echocancel</a>);
<a name="l02682"></a>02682       <span class="keywordflow">if</span> (res) {
<a name="l02683"></a>02683          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to enable echo cancellation on channel %d (%s)\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, strerror(errno));
<a name="l02684"></a>02684       } <span class="keywordflow">else</span> {
<a name="l02685"></a>02685          p-&gt;<a class="code" href="structdahdi__pvt.html#a02f7d8025e31d288688f4b53215369f4" title="TRUE if echo cancellation is turned on.">echocanon</a> = 1;
<a name="l02686"></a>02686          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Enabled echo cancellation on channel %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l02687"></a>02687       }
<a name="l02688"></a>02688    } <span class="keywordflow">else</span>
<a name="l02689"></a>02689       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;No echo cancellation requested\n&quot;</span>);
<a name="l02690"></a>02690 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa186a55d5877c6ac26323e447e868f22"></a><!-- doxytag: member="chan_dahdi.c::dahdi_exception" ref="aa186a55d5877c6ac26323e447e868f22" args="(struct ast_channel *ast)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__frame.html">ast_frame</a> * dahdi_exception </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>ast</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l06707">6707</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="chan__dahdi_8c_source.html#l06601">__dahdi_exception()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00649">dahdi_pvt::lock</a>, and <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l06708"></a>06708 {
<a name="l06709"></a>06709    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *p = ast-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l06710"></a>06710    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l06711"></a>06711    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l06712"></a>06712    f = <a class="code" href="chan__dahdi_8c.html#afa1252981be0ae4165d3ff5993f9f9f1">__dahdi_exception</a>(ast);
<a name="l06713"></a>06713    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l06714"></a>06714    <span class="keywordflow">return</span> f;
<a name="l06715"></a>06715 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5f1974e3b06695ea5cc87ff755bd2152"></a><!-- doxytag: member="chan_dahdi.c::dahdi_fake_event" ref="a5f1974e3b06695ea5cc87ff755bd2152" args="(struct dahdi_pvt *p, int mode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int dahdi_fake_event </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>mode</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l15185">15185</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01149">dahdi_pvt::fake_event</a>, <a class="el" href="chan__dahdi_8c_source.html#l15183">HANGUP</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__dahdi_8c_source.html#l00650">dahdi_pvt::owner</a>, and <a class="el" href="chan__dahdi_8c_source.html#l15182">TRANSFER</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l15251">action_transfer()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l15270">action_transferhangup()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l15186"></a>15186 {
<a name="l15187"></a>15187    <span class="keywordflow">if</span> (p) {
<a name="l15188"></a>15188       <span class="keywordflow">switch</span> (mode) {
<a name="l15189"></a>15189          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a3811374ead4311c8b04a85ae6dd7196b">TRANSFER</a>:
<a name="l15190"></a>15190             p-&gt;<a class="code" href="structdahdi__pvt.html#a9e44f391f0742649b6cd532f8487c400" title="Holding place for event injected from outside normal operation.">fake_event</a> = DAHDI_EVENT_WINKFLASH;
<a name="l15191"></a>15191             <span class="keywordflow">break</span>;
<a name="l15192"></a>15192          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a096c3727950fc9aa70ca1b817dba1cf7">HANGUP</a>:
<a name="l15193"></a>15193             p-&gt;<a class="code" href="structdahdi__pvt.html#a9e44f391f0742649b6cd532f8487c400" title="Holding place for event injected from outside normal operation.">fake_event</a> = DAHDI_EVENT_ONHOOK;
<a name="l15194"></a>15194             <span class="keywordflow">break</span>;
<a name="l15195"></a>15195          <span class="keywordflow">default</span>:
<a name="l15196"></a>15196             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;I don&apos;t know how to handle transfer event with this: %d on channel %s\n&quot;</span>,mode, p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name);
<a name="l15197"></a>15197       }
<a name="l15198"></a>15198    }
<a name="l15199"></a>15199    <span class="keywordflow">return</span> 0;
<a name="l15200"></a>15200 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a39307854d0a17fab92035d1c6d029765"></a><!-- doxytag: member="chan_dahdi.c::dahdi_fixup" ref="a39307854d0a17fab92035d1c6d029765" args="(struct ast_channel *oldchan, struct ast_channel *newchan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int dahdi_fixup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>oldchan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>newchan</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l05448">5448</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00469">ast_channel::_state</a>, <a class="el" href="frame_8h_source.html#l00300">AST_CONTROL_RINGING</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="channel_8h_source.html#l00364">AST_STATE_RINGING</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="chan__dahdi_8c_source.html#l07170">dahdi_indicate()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05044">dahdi_unlink()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00649">dahdi_pvt::lock</a>, <a class="el" href="chan__dahdi_8c_source.html#l00608">dahdi_subchannel::owner</a>, <a class="el" href="chan__dahdi_8c_source.html#l00650">dahdi_pvt::owner</a>, <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>, <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>, and <a class="el" href="chan__dahdi_8c_source.html#l02604">update_conf()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05449"></a>05449 {
<a name="l05450"></a>05450    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *p = newchan-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l05451"></a>05451    <span class="keywordtype">int</span> x;
<a name="l05452"></a>05452    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l05453"></a>05453    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;New owner for channel %d is %s\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, newchan-&gt;name);
<a name="l05454"></a>05454    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> == oldchan) {
<a name="l05455"></a>05455       p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = newchan;
<a name="l05456"></a>05456    }
<a name="l05457"></a>05457    <span class="keywordflow">for</span> (x = 0; x &lt; 3; x++)
<a name="l05458"></a>05458       <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[x].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> == oldchan) {
<a name="l05459"></a>05459          <span class="keywordflow">if</span> (!x)
<a name="l05460"></a>05460             <a class="code" href="chan__dahdi_8c.html#a3e2349a75e5e78bd2168860df8746d49">dahdi_unlink</a>(NULL, p, 0);
<a name="l05461"></a>05461          p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[x].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = newchan;
<a name="l05462"></a>05462       }
<a name="l05463"></a>05463    <span class="keywordflow">if</span> (newchan-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa">AST_STATE_RINGING</a>)
<a name="l05464"></a>05464       <a class="code" href="chan__dahdi_8c.html#a13b021264eae31a56c08744c179bff2f">dahdi_indicate</a>(newchan, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa5814e690c23b590bcd4eb43535907a1">AST_CONTROL_RINGING</a>, NULL, 0);
<a name="l05465"></a>05465    <a class="code" href="chan__dahdi_8c.html#ac56c05fde8bc30c71af46502e97fae3b">update_conf</a>(p);
<a name="l05466"></a>05466    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l05467"></a>05467    <span class="keywordflow">return</span> 0;
<a name="l05468"></a>05468 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa368dce4b7cc51c3481863fef872753b"></a><!-- doxytag: member="chan_dahdi.c::dahdi_func_read" ref="aa368dce4b7cc51c3481863fef872753b" args="(struct ast_channel *chan, const char *function, char *data, char *buf, size_t len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int dahdi_func_read </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>function</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>len</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l05025">5025</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00649">dahdi_pvt::lock</a>, <a class="el" href="chan__dahdi_8c_source.html#l00678">dahdi_pvt::rxgain</a>, <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00680">dahdi_pvt::txgain</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05026"></a>05026 {
<a name="l05027"></a>05027    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *p = chan-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l05028"></a>05028 
<a name="l05029"></a>05029    <span class="keywordflow">if</span> (!strcasecmp(data, <span class="stringliteral">&quot;rxgain&quot;</span>)) {
<a name="l05030"></a>05030       <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l05031"></a>05031       snprintf(<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, <span class="stringliteral">&quot;%f&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#aeebb464c72892c9f3ddafed5ade720ee" title="Rx gain set by chan_dahdi.conf.">rxgain</a>);
<a name="l05032"></a>05032       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l05033"></a>05033    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(data, <span class="stringliteral">&quot;txgain&quot;</span>)) {
<a name="l05034"></a>05034       <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l05035"></a>05035       snprintf(<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, <span class="stringliteral">&quot;%f&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#ad291967734f3b7bee3ec179278a1f76f" title="Tx gain set by chan_dahdi.conf.">txgain</a>);
<a name="l05036"></a>05036       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l05037"></a>05037    } <span class="keywordflow">else</span> {
<a name="l05038"></a>05038       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>);
<a name="l05039"></a>05039    }
<a name="l05040"></a>05040    <span class="keywordflow">return</span> 0;
<a name="l05041"></a>05041 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aad4a9758fbc62380e70cbbcbb31311a4"></a><!-- doxytag: member="chan_dahdi.c::dahdi_get_event" ref="aad4a9758fbc62380e70cbbcbb31311a4" args="(int fd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int dahdi_get_event </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Avoid the silly dahdi_getevent which ignores a bunch of events. </p>

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00376">376</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l06601">__dahdi_exception()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09496">do_monitor()</a>, <a class="el" href="chan__dahdi_8c_source.html#l08925">mwi_thread()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00377"></a>00377 {
<a name="l00378"></a>00378    <span class="keywordtype">int</span> j;
<a name="l00379"></a>00379    <span class="keywordflow">if</span> (ioctl(fd, DAHDI_GETEVENT, &amp;j) == -1)
<a name="l00380"></a>00380       <span class="keywordflow">return</span> -1;
<a name="l00381"></a>00381    <span class="keywordflow">return</span> j;
<a name="l00382"></a>00382 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a62c8e3f411fb9e5ec62a1e77c152c2df"></a><!-- doxytag: member="chan_dahdi.c::dahdi_get_index" ref="a62c8e3f411fb9e5ec62a1e77c152c2df" args="(struct ast_channel *ast, struct dahdi_pvt *p, int nullok)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int dahdi_get_index </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>ast</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nullok</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l01503">1503</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__dahdi_8c_source.html#l00608">dahdi_subchannel::owner</a>, <a class="el" href="chan__dahdi_8c_source.html#l00580">SUB_CALLWAIT</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, <a class="el" href="chan__dahdi_8c_source.html#l00581">SUB_THREEWAY</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l06601">__dahdi_exception()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04718">dahdi_answer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05156">dahdi_bridge()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03101">dahdi_call()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02245">dahdi_digit_begin()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02307">dahdi_digit_end()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04313">dahdi_hangup()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07170">dahdi_indicate()</a>, <a class="el" href="chan__dahdi_8c_source.html#l06717">dahdi_read()</a>, <a class="el" href="chan__dahdi_8c_source.html#l17380">dahdi_sendtext()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04837">dahdi_setoption()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07090">dahdi_write()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01504"></a>01504 {
<a name="l01505"></a>01505    <span class="keywordtype">int</span> res;
<a name="l01506"></a>01506    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> == ast)
<a name="l01507"></a>01507       res = 0;
<a name="l01508"></a>01508    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> == ast)
<a name="l01509"></a>01509       res = 1;
<a name="l01510"></a>01510    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> == ast)
<a name="l01511"></a>01511       res = 2;
<a name="l01512"></a>01512    <span class="keywordflow">else</span> {
<a name="l01513"></a>01513       res = -1;
<a name="l01514"></a>01514       <span class="keywordflow">if</span> (!nullok)
<a name="l01515"></a>01515          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to get index, and nullok is not asserted\n&quot;</span>);
<a name="l01516"></a>01516    }
<a name="l01517"></a>01517    <span class="keywordflow">return</span> res;
<a name="l01518"></a>01518 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa3d1e7c5ffebd0cd9fd147713ec71188"></a><!-- doxytag: member="chan_dahdi.c::dahdi_handle_dtmfup" ref="aa3d1e7c5ffebd0cd9fd147713ec71188" args="(struct ast_channel *ast, int idx, struct ast_frame **dest)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void dahdi_handle_dtmfup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>ast</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__frame.html">ast_frame</a> **&nbsp;</td>
          <td class="paramname"> <em>dest</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l05607">5607</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l07344">ast_async_goto()</a>, <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="frame_8h_source.html#l00301">AST_CONTROL_ANSWER</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="pbx_8c_source.html#l04143">ast_exists_extension()</a>, <a class="el" href="frame_8h_source.html#l00105">AST_FRAME_CONTROL</a>, <a class="el" href="frame_8h_source.html#l00107">AST_FRAME_NULL</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="chan__dahdi_8c_source.html#l00661">dahdi_pvt::bufsize</a>, <a class="el" href="chan__dahdi_8c_source.html#l01104">dahdi_pvt::callprogress</a>, <a class="el" href="chan__dahdi_8c_source.html#l00294">CALLPROGRESS_FAX</a>, <a class="el" href="chan__dahdi_8c_source.html#l01070">dahdi_pvt::callwaitcas</a>, <a class="el" href="channel_8h_source.html#l00444">ast_channel::cid</a>, <a class="el" href="channel_8h_source.html#l00203">ast_callerid::cid_num</a>, <a class="el" href="chan__dahdi_8c_source.html#l01050">dahdi_pvt::cidspill</a>, <a class="el" href="chan__dahdi_8c_source.html#l00735">dahdi_pvt::confirmanswer</a>, <a class="el" href="channel_8h_source.html#l00503">ast_channel::context</a>, <a class="el" href="chan__dahdi_8c_source.html#l02880">dahdi_confmute()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="channel_8h_source.html#l00504">ast_channel::exten</a>, <a class="el" href="chan__dahdi_8c_source.html#l00611">dahdi_subchannel::f</a>, <a class="el" href="chan__dahdi_8c_source.html#l00664">dahdi_pvt::faxbuf_no</a>, <a class="el" href="chan__dahdi_8c_source.html#l00665">dahdi_pvt::faxbuf_policy</a>, <a class="el" href="chan__dahdi_8c_source.html#l00765">dahdi_pvt::faxbuffersinuse</a>, <a class="el" href="chan__dahdi_8c_source.html#l00761">dahdi_pvt::faxhandled</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="chan__dahdi_8c_source.html#l00649">dahdi_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="channel_8h_source.html#l00505">ast_channel::macrocontext</a>, <a class="el" href="pbx_8c_source.html#l09023">pbx_builtin_setvar_helper()</a>, <a class="el" href="strings_8h_source.html#l00072">S_OR</a>, <a class="el" href="chan__dahdi_8c_source.html#l02986">send_cwcidspill()</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>, <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00763">dahdi_pvt::usefaxbuffers</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l06717">dahdi_read()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05608"></a>05608 {
<a name="l05609"></a>05609    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *p = ast-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l05610"></a>05610    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a> = *dest;
<a name="l05611"></a>05611 
<a name="l05612"></a>05612    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;DTMF digit: %c on %s\n&quot;</span>, f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>, ast-&gt;name);
<a name="l05613"></a>05613 
<a name="l05614"></a>05614    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a3e597345fe12637b3f04fb25e11b2fa6" title="TRUE if to wait for a DTMF digit to confirm answer.">confirmanswer</a>) {
<a name="l05615"></a>05615       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Confirm answer on %s!\n&quot;</span>, ast-&gt;name);
<a name="l05616"></a>05616       <span class="comment">/* Upon receiving a DTMF digit, consider this an answer confirmation instead</span>
<a name="l05617"></a>05617 <span class="comment">         of a DTMF digit */</span>
<a name="l05618"></a>05618       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>;
<a name="l05619"></a>05619       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe">AST_CONTROL_ANSWER</a>;
<a name="l05620"></a>05620       *dest = &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>;
<a name="l05621"></a>05621       <span class="comment">/* Reset confirmanswer so DTMF&apos;s will behave properly for the duration of the call */</span>
<a name="l05622"></a>05622       p-&gt;<a class="code" href="structdahdi__pvt.html#a3e597345fe12637b3f04fb25e11b2fa6" title="TRUE if to wait for a DTMF digit to confirm answer.">confirmanswer</a> = 0;
<a name="l05623"></a>05623    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a7a4e9b0410dd0636d8f10df9ff51e0a3" title="BOOLEAN. XXX Meaning what??">callwaitcas</a>) {
<a name="l05624"></a>05624       <span class="keywordflow">if</span> ((f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> == <span class="charliteral">&apos;A&apos;</span>) || (f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> == <span class="charliteral">&apos;D&apos;</span>)) {
<a name="l05625"></a>05625          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Got some DTMF, but it&apos;s for the CAS\n&quot;</span>);
<a name="l05626"></a>05626          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a>)
<a name="l05627"></a>05627             <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a>);
<a name="l05628"></a>05628          <a class="code" href="chan__dahdi_8c.html#acf3dec3a37d62f9b0e7691747a5c37ee">send_cwcidspill</a>(p);
<a name="l05629"></a>05629       }
<a name="l05630"></a>05630       p-&gt;<a class="code" href="structdahdi__pvt.html#a7a4e9b0410dd0636d8f10df9ff51e0a3" title="BOOLEAN. XXX Meaning what??">callwaitcas</a> = 0;
<a name="l05631"></a>05631       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a29ff71f9d5c7927906ebd437fe372056">AST_FRAME_NULL</a>;
<a name="l05632"></a>05632       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = 0;
<a name="l05633"></a>05633       *dest = &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>;
<a name="l05634"></a>05634    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> == <span class="charliteral">&apos;f&apos;</span>) {
<a name="l05635"></a>05635       <span class="comment">/* Fax tone -- Handle and return NULL */</span>
<a name="l05636"></a>05636       <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structdahdi__pvt.html#a79710add069e32170f03d92067ec3877" title="Bitmapped call progress detection flags. CALLPROGRESS_xxx values.">callprogress</a> &amp; <a class="code" href="chan__dahdi_8c.html#a88fcc93d4541c9adcab90b8b2ff37685">CALLPROGRESS_FAX</a>) &amp;&amp; !p-&gt;<a class="code" href="structdahdi__pvt.html#a93c16dce1468c2decb08eae44d525fbd" title="TRUE if a fax tone has already been handled.">faxhandled</a>) {
<a name="l05637"></a>05637          <span class="comment">/* If faxbuffers are configured, use them for the fax transmission */</span>
<a name="l05638"></a>05638          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#af518c69bd5c2dd844c9621c278998c3b" title="TRUE if dynamic faxbuffers are configured for use, default is OFF.">usefaxbuffers</a> &amp;&amp; !p-&gt;<a class="code" href="structdahdi__pvt.html#af7d7cae908ce478b4822c5dc385324df" title="TRUE while dynamic faxbuffers are in use.">faxbuffersinuse</a>) {
<a name="l05639"></a>05639             <span class="keyword">struct </span>dahdi_bufferinfo bi = {
<a name="l05640"></a>05640                .txbufpolicy = p-&gt;<a class="code" href="structdahdi__pvt.html#a1bdd30b5265eac27d813ba677086d9ea">faxbuf_policy</a>,
<a name="l05641"></a>05641                .bufsize = p-&gt;<a class="code" href="structdahdi__pvt.html#a199ab88d4ca8eab30e1cb7d35edacca5">bufsize</a>,
<a name="l05642"></a>05642                .numbufs = p-&gt;<a class="code" href="structdahdi__pvt.html#a8e922e18e6489408800cdd7ec015ef85">faxbuf_no</a>
<a name="l05643"></a>05643             };
<a name="l05644"></a>05644             <span class="keywordtype">int</span> res;
<a name="l05645"></a>05645 
<a name="l05646"></a>05646             <span class="keywordflow">if</span> ((res = ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_SET_BUFINFO, &amp;bi)) &lt; 0) {
<a name="l05647"></a>05647                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Channel &apos;%s&apos; unable to set faxbuffer policy, reason: %s\n&quot;</span>, ast-&gt;name, strerror(errno));
<a name="l05648"></a>05648             } <span class="keywordflow">else</span> {
<a name="l05649"></a>05649                p-&gt;<a class="code" href="structdahdi__pvt.html#af7d7cae908ce478b4822c5dc385324df" title="TRUE while dynamic faxbuffers are in use.">faxbuffersinuse</a> = 1;
<a name="l05650"></a>05650             }
<a name="l05651"></a>05651          }
<a name="l05652"></a>05652          p-&gt;<a class="code" href="structdahdi__pvt.html#a93c16dce1468c2decb08eae44d525fbd" title="TRUE if a fax tone has already been handled.">faxhandled</a> = 1;
<a name="l05653"></a>05653          <span class="keywordflow">if</span> (strcmp(ast-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>, <span class="stringliteral">&quot;fax&quot;</span>)) {
<a name="l05654"></a>05654             <span class="keyword">const</span> <span class="keywordtype">char</span> *target_context = <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(ast-&gt;<a class="code" href="structast__channel.html#a0a602b0f10ece2644f247c3f6ff841e0">macrocontext</a>, ast-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>);
<a name="l05655"></a>05655 
<a name="l05656"></a>05656             <span class="comment">/* We need to unlock &apos;ast&apos; here because ast_exists_extension has the</span>
<a name="l05657"></a>05657 <span class="comment">             * potential to start autoservice on the channel. Such action is prone</span>
<a name="l05658"></a>05658 <span class="comment">             * to deadlock.</span>
<a name="l05659"></a>05659 <span class="comment">             */</span>
<a name="l05660"></a>05660             <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l05661"></a>05661             <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(ast);
<a name="l05662"></a>05662             <span class="keywordflow">if</span> (<a class="code" href="pbx_8h.html#a64a5b8fdc919806135ad427aca9e71b7" title="Determine whether an extension exists.">ast_exists_extension</a>(ast, target_context, <span class="stringliteral">&quot;fax&quot;</span>, 1, ast-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>)) {
<a name="l05663"></a>05663                <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(ast);
<a name="l05664"></a>05664                <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l05665"></a>05665                <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Redirecting %s to fax extension\n&quot;</span>, ast-&gt;name);
<a name="l05666"></a>05666                <span class="comment">/* Save the DID/DNIS when we transfer the fax call to a &quot;fax&quot; extension */</span>
<a name="l05667"></a>05667                <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(ast, <span class="stringliteral">&quot;FAXEXTEN&quot;</span>, ast-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>);
<a name="l05668"></a>05668                <span class="keywordflow">if</span> (<a class="code" href="pbx_8h.html#ae0ba2eb966a9e3376de61d30513f7302" title="Set the channel to next execute the specified dialplan location.">ast_async_goto</a>(ast, target_context, <span class="stringliteral">&quot;fax&quot;</span>, 1))
<a name="l05669"></a>05669                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to async goto &apos;%s&apos; into fax of &apos;%s&apos;\n&quot;</span>, ast-&gt;name, target_context);
<a name="l05670"></a>05670             } <span class="keywordflow">else</span> {
<a name="l05671"></a>05671                <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(ast);
<a name="l05672"></a>05672                <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l05673"></a>05673                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Fax detected, but no fax extension\n&quot;</span>);
<a name="l05674"></a>05674             }
<a name="l05675"></a>05675          } <span class="keywordflow">else</span> {
<a name="l05676"></a>05676             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Already in a fax extension, not redirecting\n&quot;</span>);
<a name="l05677"></a>05677          }
<a name="l05678"></a>05678       } <span class="keywordflow">else</span> {
<a name="l05679"></a>05679          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Fax already handled\n&quot;</span>);
<a name="l05680"></a>05680       }
<a name="l05681"></a>05681       <a class="code" href="chan__dahdi_8c.html#a04126d689aca51a8a38499685cffe8f6">dahdi_confmute</a>(p, 0);
<a name="l05682"></a>05682       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a29ff71f9d5c7927906ebd437fe372056">AST_FRAME_NULL</a>;
<a name="l05683"></a>05683       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = 0;
<a name="l05684"></a>05684       *dest = &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>;
<a name="l05685"></a>05685    }
<a name="l05686"></a>05686 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0f158b05f591419e6624806afbd8cece"></a><!-- doxytag: member="chan_dahdi.c::dahdi_handle_event" ref="a0f158b05f591419e6624806afbd8cece" args="(struct ast_channel *ast)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__frame.html">ast_frame</a>* dahdi_handle_event </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>ast</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><p>&lt; Digits (or equivalent) have been dialed</p>
<p>&lt; Remote end is ringing</p>
<p>&lt; Line is up</p>
<p>&lt; Line is ringing</p>
<p>&lt; Channel is down and available</p>
<p>&lt; Channel is down, but reserved</p>
<p>&lt; Channel is off hook</p>
<p>&lt; Line is busy</p>
<p>&lt; Digits (or equivalent) have been dialed while offhook</p>
<p>&lt; Channel has detected an incoming call and is waiting for ring</p>
<p>&lt; Digits (or equivalent) have been dialed</p>
<p>&lt; Remote end is ringing</p>
<p>&lt; Line is up</p>
<p>&lt; Line is ringing </p>
</p>

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l05699">5699</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00462">ast_channel::_softhangup</a>, <a class="el" href="channel_8h_source.html#l00469">ast_channel::_state</a>, <a class="el" href="chan__dahdi_8c_source.html#l02175">alloc_sub()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00697">dahdi_pvt::answeronpolarityswitch</a>, <a class="el" href="channel_8c_source.html#l04733">ast_bridged_channel()</a>, <a class="el" href="causes_8h_source.html#l00105">AST_CAUSE_NO_ANSWER</a>, <a class="el" href="lock_8h_source.html#l02037">ast_channel_trylock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="frame_8h_source.html#l00301">AST_CONTROL_ANSWER</a>, <a class="el" href="frame_8h_source.html#l00313">AST_CONTROL_HOLD</a>, <a class="el" href="frame_8h_source.html#l00304">AST_CONTROL_OFFHOOK</a>, <a class="el" href="frame_8h_source.html#l00309">AST_CONTROL_RADIO_KEY</a>, <a class="el" href="frame_8h_source.html#l00310">AST_CONTROL_RADIO_UNKEY</a>, <a class="el" href="frame_8h_source.html#l00299">AST_CONTROL_RING</a>, <a class="el" href="frame_8h_source.html#l00300">AST_CONTROL_RINGING</a>, <a class="el" href="frame_8h_source.html#l00314">AST_CONTROL_UNHOLD</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="frame_8h_source.html#l00105">AST_FRAME_CONTROL</a>, <a class="el" href="frame_8h_source.html#l00122">AST_FRAME_DTMF_BEGIN</a>, <a class="el" href="frame_8h_source.html#l00099">AST_FRAME_DTMF_END</a>, <a class="el" href="frame_8h_source.html#l00107">AST_FRAME_NULL</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="channel_8c_source.html#l01690">ast_hangup()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="utils_8h_source.html#l00380">ast_pthread_create_detached</a>, <a class="el" href="channel_8c_source.html#l01123">ast_queue_control()</a>, <a class="el" href="channel_8c_source.html#l01133">ast_queue_control_data()</a>, <a class="el" href="channel_8c_source.html#l01103">ast_queue_hangup_with_cause()</a>, <a class="el" href="channel_8c_source.html#l04695">ast_setstate()</a>, <a class="el" href="channel_8c_source.html#l01666">ast_softhangup()</a>, <a class="el" href="channel_8h_source.html#l00633">AST_SOFTHANGUP_DEV</a>, <a class="el" href="channel_8h_source.html#l00639">AST_SOFTHANGUP_EXPLICIT</a>, <a class="el" href="channel_8h_source.html#l00366">AST_STATE_BUSY</a>, <a class="el" href="channel_8h_source.html#l00362">AST_STATE_DIALING</a>, <a class="el" href="channel_8h_source.html#l00367">AST_STATE_DIALING_OFFHOOK</a>, <a class="el" href="channel_8h_source.html#l00359">AST_STATE_DOWN</a>, <a class="el" href="channel_8h_source.html#l00361">AST_STATE_OFFHOOK</a>, <a class="el" href="channel_8h_source.html#l00368">AST_STATE_PRERING</a>, <a class="el" href="channel_8h_source.html#l00360">AST_STATE_RESERVED</a>, <a class="el" href="channel_8h_source.html#l00363">AST_STATE_RING</a>, <a class="el" href="channel_8h_source.html#l00364">AST_STATE_RINGING</a>, <a class="el" href="channel_8h_source.html#l00365">AST_STATE_UP</a>, <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="time_8h_source.html#l00089">ast_tvdiff_ms()</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="chan__dahdi_8c_source.html#l05502">attempt_transfer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01104">dahdi_pvt::callprogress</a>, <a class="el" href="chan__dahdi_8c_source.html#l00291">CALLPROGRESS_PROGRESS</a>, <a class="el" href="chan__dahdi_8c_source.html#l01070">dahdi_pvt::callwaitcas</a>, <a class="el" href="chan__dahdi_8c_source.html#l01047">dahdi_pvt::callwaitingrepeat</a>, <a class="el" href="chan__dahdi_8c_source.html#l01501">CANPROGRESSDETECT</a>, <a class="el" href="channel_8h_source.html#l00422">ast_channel::cdr</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="lock_8h_source.html#l01671">CHANNEL_DEADLOCK_AVOIDANCE</a>, <a class="el" href="chan__dahdi_8c_source.html#l05554">check_for_conference()</a>, <a class="el" href="channel_8h_source.html#l00444">ast_channel::cid</a>, <a class="el" href="channel_8h_source.html#l00205">ast_callerid::cid_ani</a>, <a class="el" href="channel_8h_source.html#l00208">ast_callerid::cid_ani2</a>, <a class="el" href="chan__dahdi_8c_source.html#l01001">dahdi_pvt::cid_name</a>, <a class="el" href="channel_8h_source.html#l00204">ast_callerid::cid_name</a>, <a class="el" href="chan__mgcp_8c_source.html#l00149">cid_name</a>, <a class="el" href="chan__dahdi_8c_source.html#l00997">dahdi_pvt::cid_num</a>, <a class="el" href="channel_8h_source.html#l00203">ast_callerid::cid_num</a>, <a class="el" href="chan__mgcp_8c_source.html#l00148">cid_num</a>, <a class="el" href="chan__dahdi_8c_source.html#l01048">dahdi_pvt::cidcwexpire</a>, <a class="el" href="chan__dahdi_8c_source.html#l01146">dahdi_pvt::cidrings</a>, <a class="el" href="chan__dahdi_8c_source.html#l01050">dahdi_pvt::cidspill</a>, <a class="el" href="chan__dahdi_8c_source.html#l00735">dahdi_pvt::confirmanswer</a>, <a class="el" href="chan__dahdi_8c_source.html#l02880">dahdi_confmute()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02709">dahdi_disable_ec()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02660">dahdi_enable_ec()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00376">dahdi_get_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01503">dahdi_get_index()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05607">dahdi_handle_dtmfup()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07417">dahdi_new()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00288">DAHDI_OVERLAPDIAL_INCOMING</a>, <a class="el" href="chan__dahdi_8c_source.html#l05470">dahdi_ring_phone()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02863">dahdi_set_hook()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02692">dahdi_train_ec()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00877">dahdi_pvt::dahditrcallerid</a>, <a class="el" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">ast_frame::data</a>, <a class="el" href="frame_8h_source.html#l00147">ast_frame::datalen</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="chan__dahdi_8c_source.html#l01133">dahdi_pvt::dialdest</a>, <a class="el" href="chan__dahdi_8c_source.html#l00743">dahdi_pvt::dialednone</a>, <a class="el" href="chan__dahdi_8c_source.html#l00745">dahdi_pvt::dialing</a>, <a class="el" href="lock_8h_source.html#l01683">DLA_LOCK</a>, <a class="el" href="lock_8h_source.html#l01681">DLA_UNLOCK</a>, <a class="el" href="chan__dahdi_8c_source.html#l01116">dahdi_pvt::dop</a>, <a class="el" href="chan__dahdi_8c_source.html#l01113">dahdi_pvt::dsp</a>, <a class="el" href="chan__dahdi_8c_source.html#l00751">dahdi_pvt::echobreak</a>, <a class="el" href="chan__dahdi_8c_source.html#l00759">dahdi_pvt::echocanon</a>, <a class="el" href="chan__dahdi_8c_source.html#l01084">dahdi_pvt::echorest</a>, <a class="el" href="chan__dahdi_8c_source.html#l01082">dahdi_pvt::echotraining</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="chan__dahdi_8c_source.html#l02389">event2str()</a>, <a class="el" href="manager_8h_source.html#l00061">EVENT_FLAG_SYSTEM</a>, <a class="el" href="chan__dahdi_8c_source.html#l00611">dahdi_subchannel::f</a>, <a class="el" href="chan__dahdi_8c_source.html#l01149">dahdi_pvt::fake_event</a>, <a class="el" href="chan__dahdi_8c_source.html#l01119">dahdi_pvt::finaldial</a>, <a class="el" href="chan__dahdi_8c_source.html#l01111">dahdi_pvt::flashtime</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="chan__dahdi_8c_source.html#l01137">dahdi_pvt::fxsoffhookstate</a>, <a class="el" href="chan__dahdi_8c_source.html#l05580">get_alarms()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05688">handle_alarms()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00772">dahdi_pvt::hanguponpolarityswitch</a>, <a class="el" href="chan__dahdi_8c_source.html#l03001">has_voicemail()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00797">dahdi_pvt::inalarm</a>, <a class="el" href="chan__dahdi_8c_source.html#l00621">dahdi_subchannel::inthreeway</a>, <a class="el" href="chan__dahdi_8c_source.html#l00649">dahdi_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00119">LOG_DEBUG</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="frame_8h_source.html#l00151">ast_frame::mallocd</a>, <a class="el" href="manager_8h_source.html#l00181">manager_event</a>, <a class="el" href="chan__dahdi_8c_source.html#l00405">MIN_MS_SINCE_FLASH</a>, <a class="el" href="chan__dahdi_8c_source.html#l00988">dahdi_pvt::mohsuggest</a>, <a class="el" href="chan__dahdi_8c_source.html#l01139">dahdi_pvt::msgstate</a>, <a class="el" href="chan__dahdi_8c_source.html#l00616">dahdi_subchannel::needanswer</a>, <a class="el" href="chan__dahdi_8c_source.html#l00617">dahdi_subchannel::needflash</a>, <a class="el" href="chan__dahdi_8c_source.html#l00618">dahdi_subchannel::needhold</a>, <a class="el" href="chan__dahdi_8c_source.html#l00612">dahdi_subchannel::needringing</a>, <a class="el" href="chan__dahdi_8c_source.html#l00619">dahdi_subchannel::needunhold</a>, <a class="el" href="frame_8h_source.html#l00155">ast_frame::offset</a>, <a class="el" href="chan__dahdi_8c_source.html#l01135">dahdi_pvt::onhooktime</a>, <a class="el" href="chan__dahdi_8c_source.html#l00673">dahdi_pvt::oprmode</a>, <a class="el" href="chan__dahdi_8c_source.html#l00674">dahdi_pvt::oprpeer</a>, <a class="el" href="asterisk_8c_source.html#l00175">option_debug</a>, <a class="el" href="chan__dahdi_8c_source.html#l01007">dahdi_pvt::origcid_name</a>, <a class="el" href="chan__dahdi_8c_source.html#l01006">dahdi_pvt::origcid_num</a>, <a class="el" href="chan__dahdi_8c_source.html#l00801">dahdi_pvt::outgoing</a>, <a class="el" href="chan__dahdi_8c_source.html#l00672">dahdi_pvt::outsigmod</a>, <a class="el" href="chan__dahdi_8c_source.html#l00608">dahdi_subchannel::owner</a>, <a class="el" href="chan__dahdi_8c_source.html#l00650">dahdi_pvt::owner</a>, <a class="el" href="channel_8h_source.html#l00418">ast_channel::pbx</a>, <a class="el" href="chan__dahdi_8c_source.html#l01177">dahdi_pvt::polarity</a>, <a class="el" href="chan__dahdi_8c_source.html#l00584">POLARITY_IDLE</a>, <a class="el" href="chan__dahdi_8c_source.html#l00585">POLARITY_REV</a>, <a class="el" href="chan__dahdi_8c_source.html#l01156">dahdi_pvt::polaritydelaytv</a>, <a class="el" href="chan__dahdi_8c_source.html#l01154">dahdi_pvt::polarityonanswerdelay</a>, <a class="el" href="frame_8h_source.html#l00159">ast_frame::ptr</a>, <a class="el" href="chan__dahdi_8c_source.html#l00830">dahdi_pvt::pulsedial</a>, <a class="el" href="chan__dahdi_8c_source.html#l00671">dahdi_pvt::radio</a>, <a class="el" href="chan__dahdi_8c_source.html#l02969">restore_conference()</a>, <a class="el" href="channel_8h_source.html#l00470">ast_channel::rings</a>, <a class="el" href="chan__dahdi_8c_source.html#l01056">dahdi_pvt::ringt</a>, <a class="el" href="chan__dahdi_8c_source.html#l01061">dahdi_pvt::ringt_base</a>, <a class="el" href="strings_8h_source.html#l00072">S_OR</a>, <a class="el" href="frame_8h_source.html#l00149">ast_frame::samples</a>, <a class="el" href="chan__dahdi_8c_source.html#l02896">save_conference()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00666">dahdi_pvt::sig</a>, <a class="el" href="chan__dahdi_8c_source.html#l02476">sig2str</a>, <a class="el" href="chan__dahdi_8c_source.html#l00256">SIG_BRI</a>, <a class="el" href="chan__dahdi_8c_source.html#l00257">SIG_BRI_PTMP</a>, <a class="el" href="chan__dahdi_8c_source.html#l00245">SIG_E911</a>, <a class="el" href="chan__dahdi_8c_source.html#l00240">SIG_EM</a>, <a class="el" href="chan__dahdi_8c_source.html#l00265">SIG_EM_E1</a>, <a class="el" href="chan__dahdi_8c_source.html#l00241">SIG_EMWINK</a>, <a class="el" href="chan__dahdi_8c_source.html#l00244">SIG_FEATB</a>, <a class="el" href="chan__dahdi_8c_source.html#l00242">SIG_FEATD</a>, <a class="el" href="chan__dahdi_8c_source.html#l00243">SIG_FEATDMF</a>, <a class="el" href="chan__dahdi_8c_source.html#l00246">SIG_FEATDMF_TA</a>, <a class="el" href="chan__dahdi_8c_source.html#l00247">SIG_FGC_CAMA</a>, <a class="el" href="chan__dahdi_8c_source.html#l00248">SIG_FGC_CAMAMF</a>, <a class="el" href="chan__dahdi_8c_source.html#l00253">SIG_FXOGS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00254">SIG_FXOKS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00252">SIG_FXOLS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00250">SIG_FXSGS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00251">SIG_FXSKS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00249">SIG_FXSLS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00259">SIG_MFCR2</a>, <a class="el" href="chan__dahdi_8c_source.html#l00255">SIG_PRI</a>, <a class="el" href="chan__dahdi_8c_source.html#l00260">SIG_SF</a>, <a class="el" href="chan__dahdi_8c_source.html#l00264">SIG_SF_FEATB</a>, <a class="el" href="chan__dahdi_8c_source.html#l00262">SIG_SF_FEATD</a>, <a class="el" href="chan__dahdi_8c_source.html#l00263">SIG_SF_FEATDMF</a>, <a class="el" href="chan__dahdi_8c_source.html#l00261">SIG_SFWINK</a>, <a class="el" href="chan__dahdi_8c_source.html#l00258">SIG_SS7</a>, <a class="el" href="frame_8h_source.html#l00157">ast_frame::src</a>, <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00580">SUB_CALLWAIT</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, <a class="el" href="chan__dahdi_8c_source.html#l00581">SUB_THREEWAY</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>, <a class="el" href="chan__dahdi_8c_source.html#l02062">swap_subs()</a>, <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>, <a class="el" href="chan__dahdi_8c_source.html#l00842">dahdi_pvt::threewaycalling</a>, <a class="el" href="chan__dahdi_8c_source.html#l00851">dahdi_pvt::transfer</a>, <a class="el" href="chan__dahdi_8c_source.html#l00882">dahdi_pvt::transfertobusy</a>, <a class="el" href="chan__dahdi_8c_source.html#l02212">unalloc_sub()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02604">update_conf()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01110">dahdi_pvt::waitingfordt</a>, and <a class="el" href="chan__dahdi_8c_source.html#l01117">dahdi_pvt::whichwink</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l06601">__dahdi_exception()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05700"></a>05700 {
<a name="l05701"></a>05701    <span class="keywordtype">int</span> res, x;
<a name="l05702"></a>05702    <span class="keywordtype">int</span> idx, mysig;
<a name="l05703"></a>05703    <span class="keywordtype">char</span> *c;
<a name="l05704"></a>05704    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *p = ast-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l05705"></a>05705    pthread_t threadid;
<a name="l05706"></a>05706    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>;
<a name="l05707"></a>05707    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l05708"></a>05708 
<a name="l05709"></a>05709    idx = <a class="code" href="chan__dahdi_8c.html#a62c8e3f411fb9e5ec62a1e77c152c2df">dahdi_get_index</a>(ast, p, 0);
<a name="l05710"></a>05710    mysig = p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a>;
<a name="l05711"></a>05711    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a57a35ad748a874002c2b58676e5b2687">outsigmod</a> &gt; -1)
<a name="l05712"></a>05712       mysig = p-&gt;<a class="code" href="structdahdi__pvt.html#a57a35ad748a874002c2b58676e5b2687">outsigmod</a>;
<a name="l05713"></a>05713    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a29ff71f9d5c7927906ebd437fe372056">AST_FRAME_NULL</a>;
<a name="l05714"></a>05714    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = 0;
<a name="l05715"></a>05715    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> = 0;
<a name="l05716"></a>05716    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a> = 0;
<a name="l05717"></a>05717    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#aed16590d48f41d89f31e0cf347f5cd99">mallocd</a> = 0;
<a name="l05718"></a>05718    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#aed7ea92f45bd273dde380a45ddced592">offset</a> = 0;
<a name="l05719"></a>05719    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#af51e37c9331049b1e3d250a7c8bc3c26">src</a> = <span class="stringliteral">&quot;dahdi_handle_event&quot;</span>;
<a name="l05720"></a>05720    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a> = NULL;
<a name="l05721"></a>05721    f = &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>;
<a name="l05722"></a>05722 
<a name="l05723"></a>05723    <span class="keywordflow">if</span> (idx &lt; 0)
<a name="l05724"></a>05724       <span class="keywordflow">return</span> &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>;
<a name="l05725"></a>05725    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a9e44f391f0742649b6cd532f8487c400" title="Holding place for event injected from outside normal operation.">fake_event</a>) {
<a name="l05726"></a>05726       res = p-&gt;<a class="code" href="structdahdi__pvt.html#a9e44f391f0742649b6cd532f8487c400" title="Holding place for event injected from outside normal operation.">fake_event</a>;
<a name="l05727"></a>05727       p-&gt;<a class="code" href="structdahdi__pvt.html#a9e44f391f0742649b6cd532f8487c400" title="Holding place for event injected from outside normal operation.">fake_event</a> = 0;
<a name="l05728"></a>05728    } <span class="keywordflow">else</span>
<a name="l05729"></a>05729       res = <a class="code" href="chan__dahdi_8c.html#aad4a9758fbc62380e70cbbcbb31311a4" title="Avoid the silly dahdi_getevent which ignores a bunch of events.">dahdi_get_event</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>);
<a name="l05730"></a>05730 
<a name="l05731"></a>05731    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Got event %s(%d) on channel %d (index %d)\n&quot;</span>, <a class="code" href="chan__dahdi_8c.html#a92fb0724a6e93f69cec9d6e83cdcc3f3">event2str</a>(res), res, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, idx);
<a name="l05732"></a>05732 
<a name="l05733"></a>05733    <span class="keywordflow">if</span> (res &amp; (DAHDI_EVENT_PULSEDIGIT | DAHDI_EVENT_DTMFUP)) {
<a name="l05734"></a>05734       p-&gt;<a class="code" href="structdahdi__pvt.html#ae56835e2739c5d155391c01485455497" title="TRUE if a pulsed digit was detected. (Pulse dial phone detected).">pulsedial</a> = (res &amp; DAHDI_EVENT_PULSEDIGIT) ? 1 : 0;
<a name="l05735"></a>05735       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Detected %sdigit &apos;%c&apos;\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#ae56835e2739c5d155391c01485455497" title="TRUE if a pulsed digit was detected. (Pulse dial phone detected).">pulsedial</a> ? <span class="stringliteral">&quot;pulse &quot;</span>: <span class="stringliteral">&quot;&quot;</span>, res &amp; 0xff);
<a name="l05736"></a>05736 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l05737"></a>05737 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (!p-&gt;proceeding &amp;&amp; ((p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#ae9ab0c9508fca045a06730533be276a5">SIG_PRI</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#ab5bfeaf991c23c5b6510ace44ae79ce9">SIG_BRI</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a>)) &amp;&amp; p-&gt;pri &amp;&amp; (p-&gt;pri-&gt;overlapdial &amp; <a class="code" href="chan__dahdi_8c.html#ab30dead77fa070cbe51316f43fcea8a2">DAHDI_OVERLAPDIAL_INCOMING</a>)) {
<a name="l05738"></a>05738          <span class="comment">/* absorb event */</span>
<a name="l05739"></a>05739       } <span class="keywordflow">else</span> {
<a name="l05740"></a>05740 <span class="preprocessor">#endif</span>
<a name="l05741"></a>05741 <span class="preprocessor"></span>         <a class="code" href="chan__dahdi_8c.html#a04126d689aca51a8a38499685cffe8f6">dahdi_confmute</a>(p, 0);
<a name="l05742"></a>05742          p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a98e65764bc963016c394bcc1bad6540b">AST_FRAME_DTMF_END</a>;
<a name="l05743"></a>05743          p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = res &amp; 0xff;
<a name="l05744"></a>05744 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l05745"></a>05745 <span class="preprocessor"></span>      }
<a name="l05746"></a>05746 <span class="preprocessor">#endif</span>
<a name="l05747"></a>05747 <span class="preprocessor"></span>      <a class="code" href="chan__dahdi_8c.html#aa3d1e7c5ffebd0cd9fd147713ec71188">dahdi_handle_dtmfup</a>(ast, idx, &amp;f);
<a name="l05748"></a>05748       <span class="keywordflow">return</span> f;
<a name="l05749"></a>05749    }
<a name="l05750"></a>05750 
<a name="l05751"></a>05751    <span class="keywordflow">if</span> (res &amp; DAHDI_EVENT_DTMFDOWN) {
<a name="l05752"></a>05752       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;DTMF Down &apos;%c&apos;\n&quot;</span>, res &amp; 0xff);
<a name="l05753"></a>05753       <span class="comment">/* Mute conference */</span>
<a name="l05754"></a>05754       <a class="code" href="chan__dahdi_8c.html#a04126d689aca51a8a38499685cffe8f6">dahdi_confmute</a>(p, 1);
<a name="l05755"></a>05755       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a9b350360a64b55c7590f1ec03db480be">AST_FRAME_DTMF_BEGIN</a>;
<a name="l05756"></a>05756       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = res &amp; 0xff;
<a name="l05757"></a>05757       <span class="keywordflow">return</span> &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>;
<a name="l05758"></a>05758    }
<a name="l05759"></a>05759 
<a name="l05760"></a>05760    <span class="keywordflow">switch</span> (res) {
<a name="l05761"></a>05761       <span class="keywordflow">case</span> DAHDI_EVENT_EC_DISABLED:
<a name="l05762"></a>05762          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Channel %d echo canceler disabled due to CED detection\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l05763"></a>05763          p-&gt;<a class="code" href="structdahdi__pvt.html#a02f7d8025e31d288688f4b53215369f4" title="TRUE if echo cancellation is turned on.">echocanon</a> = 0;
<a name="l05764"></a>05764          <span class="keywordflow">break</span>;
<a name="l05765"></a>05765       <span class="keywordflow">case</span> DAHDI_EVENT_BITSCHANGED:
<a name="l05766"></a>05766 <span class="preprocessor">#ifdef HAVE_OPENR2</span>
<a name="l05767"></a>05767 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> != <a class="code" href="chan__dahdi_8c.html#a1d73a98ae12601287580dedd9a6d739b">SIG_MFCR2</a>) {
<a name="l05768"></a>05768             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Received bits changed on %s signalling?\n&quot;</span>, <a class="code" href="chan__dahdi_8c.html#ac36e4cc782493e37064405666f5e4fdd">sig2str</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a>));
<a name="l05769"></a>05769          } <span class="keywordflow">else</span> {
<a name="l05770"></a>05770             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;bits changed in chan %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l05771"></a>05771             openr2_chan_handle_cas(p-&gt;r2chan);
<a name="l05772"></a>05772          }
<a name="l05773"></a>05773 <span class="preprocessor">#else</span>
<a name="l05774"></a>05774 <span class="preprocessor"></span>         <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Received bits changed on %s signalling?\n&quot;</span>, <a class="code" href="chan__dahdi_8c.html#ac36e4cc782493e37064405666f5e4fdd">sig2str</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a>));
<a name="l05775"></a>05775 <span class="preprocessor">#endif</span>
<a name="l05776"></a>05776 <span class="preprocessor"></span>      <span class="keywordflow">case</span> DAHDI_EVENT_PULSE_START:
<a name="l05777"></a>05777          <span class="comment">/* Stop tone if there&apos;s a pulse start and the PBX isn&apos;t started */</span>
<a name="l05778"></a>05778          <span class="keywordflow">if</span> (!ast-&gt;<a class="code" href="structast__channel.html#aebc9ecdf679da616c7d975b827e1f4b4">pbx</a>)
<a name="l05779"></a>05779             tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, -1);
<a name="l05780"></a>05780          <span class="keywordflow">break</span>;
<a name="l05781"></a>05781       <span class="keywordflow">case</span> DAHDI_EVENT_DIALCOMPLETE:
<a name="l05782"></a>05782 <span class="preprocessor">#ifdef HAVE_OPENR2</span>
<a name="l05783"></a>05783 <span class="preprocessor"></span>         <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> &amp; <a class="code" href="chan__dahdi_8c.html#a1d73a98ae12601287580dedd9a6d739b">SIG_MFCR2</a>) &amp;&amp; p-&gt;r2chan &amp;&amp; ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>) {
<a name="l05784"></a>05784             <span class="comment">/* we don&apos;t need to do anything for this event for R2 signaling</span>
<a name="l05785"></a>05785 <span class="comment">               if the call is being setup */</span>
<a name="l05786"></a>05786             <span class="keywordflow">break</span>;
<a name="l05787"></a>05787          }
<a name="l05788"></a>05788 <span class="preprocessor">#endif</span>
<a name="l05789"></a>05789 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#adbe10c4b12619d6cb58b1ad14bc437af" title="TRUE if in an alarm condition.">inalarm</a>) <span class="keywordflow">break</span>;
<a name="l05790"></a>05790          <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structdahdi__pvt.html#ac53b42243ee40edc74b615fe86806fe3" title="Nonzero if the signaling type is sent over a radio.">radio</a> || (p-&gt;<a class="code" href="structdahdi__pvt.html#a3b3cefe7a33d0cff61f3a2b5955b6c8b">oprmode</a> &lt; 0))) <span class="keywordflow">break</span>;
<a name="l05791"></a>05791          <span class="keywordflow">if</span> (ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>,DAHDI_DIALING,&amp;x) == -1) {
<a name="l05792"></a>05792             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;DAHDI_DIALING ioctl failed on %s: %s\n&quot;</span>,ast-&gt;name, strerror(errno));
<a name="l05793"></a>05793             <span class="keywordflow">return</span> NULL;
<a name="l05794"></a>05794          }
<a name="l05795"></a>05795          <span class="keywordflow">if</span> (!x) { <span class="comment">/* if not still dialing in driver */</span>
<a name="l05796"></a>05796             <a class="code" href="chan__dahdi_8c.html#a8c34a5bce2b26d056942349217806312">dahdi_enable_ec</a>(p);
<a name="l05797"></a>05797             <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a8c759f824385c61bf3d4f56ad757ea76" title="XXX BOOLEAN Purpose???">echobreak</a>) {
<a name="l05798"></a>05798                <a class="code" href="chan__dahdi_8c.html#a31c006d7b409a09059a58946a706ea07">dahdi_train_ec</a>(p);
<a name="l05799"></a>05799                <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr, p-&gt;<a class="code" href="structdahdi__pvt.html#aa407dc4f683f66545461a5854c2ccff2" title="Filled with &amp;#39;w&amp;#39;. XXX Purpose??">echorest</a>, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr));
<a name="l05800"></a>05800                p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.op = DAHDI_DIAL_OP_REPLACE;
<a name="l05801"></a>05801                res = ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_DIAL, &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>);
<a name="l05802"></a>05802                p-&gt;<a class="code" href="structdahdi__pvt.html#a8c759f824385c61bf3d4f56ad757ea76" title="XXX BOOLEAN Purpose???">echobreak</a> = 0;
<a name="l05803"></a>05803             } <span class="keywordflow">else</span> {
<a name="l05804"></a>05804                p-&gt;<a class="code" href="structdahdi__pvt.html#af17335c0c7a4c1e03e987a33f6eec81b" title="TRUE if in the process of dialing digits or sending something.">dialing</a> = 0;
<a name="l05805"></a>05805                <span class="keywordflow">if</span> ((mysig == <a class="code" href="chan__dahdi_8c.html#adfdd0e4d05281d354c15ef1a5d158cd6">SIG_E911</a>) || (mysig == <a class="code" href="chan__dahdi_8c.html#a167056b2763a4897838c7115efc1f9fc">SIG_FGC_CAMA</a>) || (mysig == <a class="code" href="chan__dahdi_8c.html#a945e2b5f225d3abdc57b5dcc53daa62a">SIG_FGC_CAMAMF</a>)) {
<a name="l05806"></a>05806                   <span class="comment">/* if thru with dialing after offhook */</span>
<a name="l05807"></a>05807                   <span class="keywordflow">if</span> (ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a4e5d21d1ab20653e36109919d6ea72e1">AST_STATE_DIALING_OFFHOOK</a>) {
<a name="l05808"></a>05808                      <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(ast, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>);
<a name="l05809"></a>05809                      p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>;
<a name="l05810"></a>05810                      p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe">AST_CONTROL_ANSWER</a>;
<a name="l05811"></a>05811                      <span class="keywordflow">break</span>;
<a name="l05812"></a>05812                   } <span class="keywordflow">else</span> { <span class="comment">/* if to state wait for offhook to dial rest */</span>
<a name="l05813"></a>05813                      <span class="comment">/* we now wait for off hook */</span>
<a name="l05814"></a>05814                      <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(ast,<a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a4e5d21d1ab20653e36109919d6ea72e1">AST_STATE_DIALING_OFFHOOK</a>);
<a name="l05815"></a>05815                   }
<a name="l05816"></a>05816                }
<a name="l05817"></a>05817                <span class="keywordflow">if</span> (ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa70881e902c6c29f27ffba80bb43554f">AST_STATE_DIALING</a>) {
<a name="l05818"></a>05818                   <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structdahdi__pvt.html#a79710add069e32170f03d92067ec3877" title="Bitmapped call progress detection flags. CALLPROGRESS_xxx values.">callprogress</a> &amp; <a class="code" href="chan__dahdi_8c.html#aa66794917b368980eacd1bf179268e15">CALLPROGRESS_PROGRESS</a>) &amp;&amp; <a class="code" href="chan__dahdi_8c.html#aa40ff55dfcec4b66be7bbaec05993fad">CANPROGRESSDETECT</a>(p) &amp;&amp; p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a> &amp;&amp; p-&gt;<a class="code" href="structdahdi__pvt.html#a40668dcb7d940b80c4f109861059a978" title="TRUE if we originated the call leg.">outgoing</a>) {
<a name="l05819"></a>05819                      <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Done dialing, but waiting for progress detection before doing more...\n&quot;</span>);
<a name="l05820"></a>05820                   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a3e597345fe12637b3f04fb25e11b2fa6" title="TRUE if to wait for a DTMF digit to confirm answer.">confirmanswer</a> || (!p-&gt;<a class="code" href="structdahdi__pvt.html#a9cfceba897ebb6fc6665c255b9dc0164" title="TRUE if analog type line dialed no digits in Dial().">dialednone</a>
<a name="l05821"></a>05821                      &amp;&amp; ((mysig == <a class="code" href="chan__dahdi_8c.html#afa7547cd2cee1bae7734206102635216">SIG_EM</a>) || (mysig == <a class="code" href="chan__dahdi_8c.html#aa7b59772722b794c5218768dac3ee419">SIG_EM_E1</a>)
<a name="l05822"></a>05822                         || (mysig == <a class="code" href="chan__dahdi_8c.html#a1ba988b93fce049075b7c2ef6c931cf9">SIG_EMWINK</a>) || (mysig == <a class="code" href="chan__dahdi_8c.html#ab79873391af2857a602e1eff68606f23">SIG_FEATD</a>)
<a name="l05823"></a>05823                         || (mysig == <a class="code" href="chan__dahdi_8c.html#ac0c40f74945ed15aa82cd9fedc304e55">SIG_FEATDMF_TA</a>) || (mysig == <a class="code" href="chan__dahdi_8c.html#a98d4710afc1fcb2ff110eabb4fbcc308">SIG_FEATDMF</a>)
<a name="l05824"></a>05824                         || (mysig == <a class="code" href="chan__dahdi_8c.html#adfdd0e4d05281d354c15ef1a5d158cd6">SIG_E911</a>) || (mysig == <a class="code" href="chan__dahdi_8c.html#a167056b2763a4897838c7115efc1f9fc">SIG_FGC_CAMA</a>)
<a name="l05825"></a>05825                         || (mysig == <a class="code" href="chan__dahdi_8c.html#a945e2b5f225d3abdc57b5dcc53daa62a">SIG_FGC_CAMAMF</a>) || (mysig == <a class="code" href="chan__dahdi_8c.html#a0ba8ec199f5fb4f2be64144be0bd13b1">SIG_FEATB</a>)
<a name="l05826"></a>05826                         || (mysig == <a class="code" href="chan__dahdi_8c.html#afacb372d32fba2192ed6a2989c54fbda">SIG_SF</a>) || (mysig == <a class="code" href="chan__dahdi_8c.html#a193853e7e76cff05d51425eba48d030f">SIG_SFWINK</a>)
<a name="l05827"></a>05827                         || (mysig == <a class="code" href="chan__dahdi_8c.html#aac334a7f88651d9e44499897386d2cfd">SIG_SF_FEATD</a>) || (mysig == <a class="code" href="chan__dahdi_8c.html#a4625d3aba972e102c8460a9f16af0fc7">SIG_SF_FEATDMF</a>)
<a name="l05828"></a>05828                         || (mysig == <a class="code" href="chan__dahdi_8c.html#a33a2f70a24e9f8ccfcc1e76f208b1ab6">SIG_SF_FEATB</a>)))) {
<a name="l05829"></a>05829                      <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(ast, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa">AST_STATE_RINGING</a>);
<a name="l05830"></a>05830                   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="structdahdi__pvt.html#a5a4fb6da5625cc1eec0c9821f0d41d52" title="TRUE if we can use a polarity reversal to mark when an outgoing call is answered...">answeronpolarityswitch</a>) {
<a name="l05831"></a>05831                      <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(ast, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>);
<a name="l05832"></a>05832                      p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>;
<a name="l05833"></a>05833                      p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe">AST_CONTROL_ANSWER</a>;
<a name="l05834"></a>05834                      <span class="comment">/* If aops=0 and hops=1, this is necessary */</span>
<a name="l05835"></a>05835                      p-&gt;<a class="code" href="structdahdi__pvt.html#aeffac59edf881b639bb5e7c7137a7312" title="Current line interface polarity. POLARITY_IDLE, POLARITY_REV.">polarity</a> = <a class="code" href="chan__dahdi_8c.html#aeba680adad3f0d1146c8e5003f6a44f2">POLARITY_REV</a>;
<a name="l05836"></a>05836                   } <span class="keywordflow">else</span> {
<a name="l05837"></a>05837                      <span class="comment">/* Start clean, so we can catch the change to REV polarity when party answers */</span>
<a name="l05838"></a>05838                      p-&gt;<a class="code" href="structdahdi__pvt.html#aeffac59edf881b639bb5e7c7137a7312" title="Current line interface polarity. POLARITY_IDLE, POLARITY_REV.">polarity</a> = <a class="code" href="chan__dahdi_8c.html#ad35015bf9d15c7474a4fef58ed0dcab2">POLARITY_IDLE</a>;
<a name="l05839"></a>05839                   }
<a name="l05840"></a>05840                }
<a name="l05841"></a>05841             }
<a name="l05842"></a>05842          }
<a name="l05843"></a>05843          <span class="keywordflow">break</span>;
<a name="l05844"></a>05844       <span class="keywordflow">case</span> DAHDI_EVENT_ALARM:
<a name="l05845"></a>05845 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l05846"></a>05846 <span class="preprocessor"></span>         <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#ae9ab0c9508fca045a06730533be276a5">SIG_PRI</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#ab5bfeaf991c23c5b6510ace44ae79ce9">SIG_BRI</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a>)) {
<a name="l05847"></a>05847             <span class="keywordflow">if</span> (!p-&gt;pri || !p-&gt;pri-&gt;pri || (pri_get_timer(p-&gt;pri-&gt;pri, PRI_TIMER_T309) &lt; 0)) {
<a name="l05848"></a>05848                <span class="comment">/* T309 is not enabled : hangup calls when alarm occurs */</span>
<a name="l05849"></a>05849                <span class="keywordflow">if</span> (p-&gt;call) {
<a name="l05850"></a>05850                   <span class="keywordflow">if</span> (p-&gt;pri &amp;&amp; p-&gt;pri-&gt;pri) {
<a name="l05851"></a>05851                      <span class="keywordflow">if</span> (!pri_grab(p, p-&gt;pri)) {
<a name="l05852"></a>05852                         pri_hangup(p-&gt;pri-&gt;pri, p-&gt;call, -1);
<a name="l05853"></a>05853                         pri_destroycall(p-&gt;pri-&gt;pri, p-&gt;call);
<a name="l05854"></a>05854                         p-&gt;call = NULL;
<a name="l05855"></a>05855                         pri_rel(p-&gt;pri);
<a name="l05856"></a>05856                      } <span class="keywordflow">else</span>
<a name="l05857"></a>05857                         <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to grab PRI!\n&quot;</span>);
<a name="l05858"></a>05858                   } <span class="keywordflow">else</span>
<a name="l05859"></a>05859                      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;The PRI Call has not been destroyed\n&quot;</span>);
<a name="l05860"></a>05860                }
<a name="l05861"></a>05861                <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)
<a name="l05862"></a>05862                   p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#a7386ba9cc89b0b446f553a4d0f36576a">_softhangup</a> |= <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709a2e185ce313026e13ed90ae3a319c9cb7">AST_SOFTHANGUP_DEV</a>;
<a name="l05863"></a>05863             }
<a name="l05864"></a>05864          }
<a name="l05865"></a>05865          <span class="keywordflow">if</span> (p-&gt;bearer)
<a name="l05866"></a>05866             p-&gt;bearer-&gt;<a class="code" href="structdahdi__pvt.html#adbe10c4b12619d6cb58b1ad14bc437af" title="TRUE if in an alarm condition.">inalarm</a> = 1;
<a name="l05867"></a>05867          <span class="keywordflow">else</span>
<a name="l05868"></a>05868 <span class="preprocessor">#endif</span>
<a name="l05869"></a>05869 <span class="preprocessor"></span>         p-&gt;<a class="code" href="structdahdi__pvt.html#adbe10c4b12619d6cb58b1ad14bc437af" title="TRUE if in an alarm condition.">inalarm</a> = 1;
<a name="l05870"></a>05870          res = <a class="code" href="chan__dahdi_8c.html#ace00362fe9640b8a792c965572a87826">get_alarms</a>(p);
<a name="l05871"></a>05871          <a class="code" href="chan__dahdi_8c.html#aa8e0b028321154a280cad06d20099330">handle_alarms</a>(p, res);
<a name="l05872"></a>05872 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l05873"></a>05873 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (!p-&gt;pri || !p-&gt;pri-&gt;pri || pri_get_timer(p-&gt;pri-&gt;pri, PRI_TIMER_T309) &lt; 0) {
<a name="l05874"></a>05874             <span class="comment">/* fall through intentionally */</span>
<a name="l05875"></a>05875          } <span class="keywordflow">else</span> {
<a name="l05876"></a>05876             <span class="keywordflow">break</span>;
<a name="l05877"></a>05877          }
<a name="l05878"></a>05878 <span class="preprocessor">#endif</span>
<a name="l05879"></a>05879 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_SS7</span>
<a name="l05880"></a>05880 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#aadcda889db3cf9dfe757dbc1d4d8311a">SIG_SS7</a>)
<a name="l05881"></a>05881             <span class="keywordflow">break</span>;
<a name="l05882"></a>05882 <span class="preprocessor">#endif</span>
<a name="l05883"></a>05883 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_OPENR2</span>
<a name="l05884"></a>05884 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#a1d73a98ae12601287580dedd9a6d739b">SIG_MFCR2</a>)
<a name="l05885"></a>05885             <span class="keywordflow">break</span>;
<a name="l05886"></a>05886 <span class="preprocessor">#endif</span>
<a name="l05887"></a>05887 <span class="preprocessor"></span>      <span class="keywordflow">case</span> DAHDI_EVENT_ONHOOK:
<a name="l05888"></a>05888          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#ac53b42243ee40edc74b615fe86806fe3" title="Nonzero if the signaling type is sent over a radio.">radio</a>) {
<a name="l05889"></a>05889             p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>;
<a name="l05890"></a>05890             p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a34ac3ccebc219c59daa7eb0275fcd54d">AST_CONTROL_RADIO_UNKEY</a>;
<a name="l05891"></a>05891             <span class="keywordflow">break</span>;
<a name="l05892"></a>05892          }
<a name="l05893"></a>05893          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a3b3cefe7a33d0cff61f3a2b5955b6c8b">oprmode</a> &lt; 0)
<a name="l05894"></a>05894          {
<a name="l05895"></a>05895             <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a3b3cefe7a33d0cff61f3a2b5955b6c8b">oprmode</a> != -1) <span class="keywordflow">break</span>;
<a name="l05896"></a>05896             <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#adb40571aa5ff846fc334be5260eab257">SIG_FXOLS</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#a7c9b3bb8225896ff2b9aed27e6f80f10">SIG_FXOKS</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#a3dcffbaf4a26f2b7b792998df1eea27b">SIG_FXOGS</a>))
<a name="l05897"></a>05897             {
<a name="l05898"></a>05898                <span class="comment">/* Make sure it starts ringing */</span>
<a name="l05899"></a>05899                <a class="code" href="chan__dahdi_8c.html#a7c65e6943db828524ea6c9215b8bf696">dahdi_set_hook</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_RINGOFF);
<a name="l05900"></a>05900                <a class="code" href="chan__dahdi_8c.html#a7c65e6943db828524ea6c9215b8bf696">dahdi_set_hook</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_RING);
<a name="l05901"></a>05901                <a class="code" href="chan__dahdi_8c.html#a756c4e1d2909416c454b6e63d28f1db1">save_conference</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a32e155760f552f4f2c0780e27b173c8c">oprpeer</a>);
<a name="l05902"></a>05902                tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a32e155760f552f4f2c0780e27b173c8c">oprpeer</a>-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_RINGTONE);
<a name="l05903"></a>05903             }
<a name="l05904"></a>05904             <span class="keywordflow">break</span>;
<a name="l05905"></a>05905          }
<a name="l05906"></a>05906          <span class="keywordflow">switch</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a>) {
<a name="l05907"></a>05907          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#adb40571aa5ff846fc334be5260eab257">SIG_FXOLS</a>:
<a name="l05908"></a>05908          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a3dcffbaf4a26f2b7b792998df1eea27b">SIG_FXOGS</a>:
<a name="l05909"></a>05909          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a7c9b3bb8225896ff2b9aed27e6f80f10">SIG_FXOKS</a>:
<a name="l05910"></a>05910             p-&gt;<a class="code" href="structdahdi__pvt.html#a74643a768dac2465f8612f81ba4ff177" title="Time the interface went on-hook.">onhooktime</a> = time(NULL);
<a name="l05911"></a>05911             p-&gt;<a class="code" href="structdahdi__pvt.html#ab18fd594a2af8725e3ddb868d8499e06" title="TRUE if the FXS port is off-hook.">fxsoffhookstate</a> = 0;
<a name="l05912"></a>05912             p-&gt;<a class="code" href="structdahdi__pvt.html#a734dc49c409d35148bff4b61e12ad58b" title="-1 = unknown, 0 = no messages, 1 = new messages available">msgstate</a> = -1;
<a name="l05913"></a>05913             <span class="comment">/* Check for some special conditions regarding call waiting */</span>
<a name="l05914"></a>05914             <span class="keywordflow">if</span> (idx == <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>) {
<a name="l05915"></a>05915                <span class="comment">/* The normal line was hung up */</span>
<a name="l05916"></a>05916                <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l05917"></a>05917                   <span class="comment">/* There&apos;s a call waiting call, so ring the phone, but make it unowned in the mean time */</span>
<a name="l05918"></a>05918                   <a class="code" href="chan__dahdi_8c.html#aaa6e6b7fe5725465004d3fabf351620e">swap_subs</a>(p, <a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>, <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>);
<a name="l05919"></a>05919                   <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Channel %d still has (callwait) call, ringing phone\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l05920"></a>05920                   <a class="code" href="chan__dahdi_8c.html#a164404a295fbba4f9d3c2c6cf123468f">unalloc_sub</a>(p, <a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>);
<a name="l05921"></a>05921 <span class="preprocessor">#if 0</span>
<a name="l05922"></a>05922 <span class="preprocessor"></span>                  p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a00bf8ced61d8f8736d6dc3b769609600">needanswer</a> = 0;
<a name="l05923"></a>05923                   p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a0b09a2171a877eaadb67da4f5639abc4">needringing</a> = 0;
<a name="l05924"></a>05924 <span class="preprocessor">#endif</span>
<a name="l05925"></a>05925 <span class="preprocessor"></span>                  p-&gt;<a class="code" href="structdahdi__pvt.html#acb6666d113ea3605f76a45fe3e90e192">callwaitingrepeat</a> = 0;
<a name="l05926"></a>05926                   p-&gt;<a class="code" href="structdahdi__pvt.html#ac8c4841c7cad35c09ddbd28ede1c4cfe">cidcwexpire</a> = 0;
<a name="l05927"></a>05927                   p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = NULL;
<a name="l05928"></a>05928                   <span class="comment">/* Don&apos;t start streaming audio yet if the incoming call isn&apos;t up yet */</span>
<a name="l05929"></a>05929                   <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>)
<a name="l05930"></a>05930                      p-&gt;<a class="code" href="structdahdi__pvt.html#af17335c0c7a4c1e03e987a33f6eec81b" title="TRUE if in the process of dialing digits or sending something.">dialing</a> = 1;
<a name="l05931"></a>05931                   <a class="code" href="chan__dahdi_8c.html#a22c775b992dee643a259e67efc1711d0">dahdi_ring_phone</a>(p);
<a name="l05932"></a>05932                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l05933"></a>05933                   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> mssinceflash;
<a name="l05934"></a>05934                   <span class="comment">/* Here we have to retain the lock on both the main channel, the 3-way channel, and</span>
<a name="l05935"></a>05935 <span class="comment">                     the private structure -- not especially easy or clean */</span>
<a name="l05936"></a>05936                   <span class="keywordflow">while</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> &amp;&amp; <a class="code" href="lock_8h.html#a8b8532d377bd19e8411000ddccfa6607" title="Try locking a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_trylock</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)) {
<a name="l05937"></a>05937                      <span class="comment">/* Yuck, didn&apos;t get the lock on the 3-way, gotta release everything and re-grab! */</span>
<a name="l05938"></a>05938                      <a class="code" href="lock_8h.html#a0fd21e02b26076ca0b070300f46c0a70">DLA_UNLOCK</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l05939"></a>05939                      <a class="code" href="lock_8h.html#a7b1d6c8183a6f6f42a98239da3d1c7ca">CHANNEL_DEADLOCK_AVOIDANCE</a>(ast);
<a name="l05940"></a>05940                      <span class="comment">/* We can grab ast and p in that order, without worry.  We should make sure</span>
<a name="l05941"></a>05941 <span class="comment">                        nothing seriously bad has happened though like some sort of bizarre double</span>
<a name="l05942"></a>05942 <span class="comment">                        masquerade! */</span>
<a name="l05943"></a>05943                      <a class="code" href="lock_8h.html#a0dde24cad9d699034d4ece0d576364d8">DLA_LOCK</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l05944"></a>05944                      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> != ast) {
<a name="l05945"></a>05945                         <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;This isn&apos;t good...\n&quot;</span>);
<a name="l05946"></a>05946                         <span class="keywordflow">return</span> NULL;
<a name="l05947"></a>05947                      }
<a name="l05948"></a>05948                   }
<a name="l05949"></a>05949                   <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l05950"></a>05950                      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Whoa, threeway disappeared kinda randomly.\n&quot;</span>);
<a name="l05951"></a>05951                      <span class="keywordflow">return</span> NULL;
<a name="l05952"></a>05952                   }
<a name="l05953"></a>05953                   mssinceflash = <a class="code" href="time_8h.html#a74e35cffcd45ad6cd7c8587921e8a4c2" title="Computes the difference (in milliseconds) between two struct timeval instances.">ast_tvdiff_ms</a>(<a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>(), p-&gt;<a class="code" href="structdahdi__pvt.html#a39ccf8f0384020d69764aa7ea619f515">flashtime</a>);
<a name="l05954"></a>05954                   <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Last flash was %d ms ago\n&quot;</span>, mssinceflash);
<a name="l05955"></a>05955                   <span class="keywordflow">if</span> (mssinceflash &lt; <a class="code" href="chan__dahdi_8c.html#ac148eea53bd254d0c5b5757dd46d7058">MIN_MS_SINCE_FLASH</a>) {
<a name="l05956"></a>05956                      <span class="comment">/* It hasn&apos;t been long enough since the last flashook.  This is probably a bounce on</span>
<a name="l05957"></a>05957 <span class="comment">                        hanging up.  Hangup both channels now */</span>
<a name="l05958"></a>05958                      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)
<a name="l05959"></a>05959                         <a class="code" href="channel_8h.html#a91e78b15da3244307ffd749fa85f4db7" title="Queue a hangup frame with hangupcause set.">ast_queue_hangup_with_cause</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="causes_8h.html#af03fc9fe2f0ecc69330e014aff8d0f73">AST_CAUSE_NO_ANSWER</a>);
<a name="l05960"></a>05960                      p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#a7386ba9cc89b0b446f553a4d0f36576a">_softhangup</a> |= <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709a2e185ce313026e13ed90ae3a319c9cb7">AST_SOFTHANGUP_DEV</a>;
<a name="l05961"></a>05961                      <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Looks like a bounced flash, hanging up both calls on %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l05962"></a>05962                      <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l05963"></a>05963                   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((ast-&gt;<a class="code" href="structast__channel.html#aebc9ecdf679da616c7d975b827e1f4b4">pbx</a>) || (ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>)) {
<a name="l05964"></a>05964                      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#ad9e41a9a2b63c1e9bad00df4c2bfc92e" title="TRUE if call transfer is enabled.">transfer</a>) {
<a name="l05965"></a>05965                         <span class="comment">/* In any case this isn&apos;t a threeway call anymore */</span>
<a name="l05966"></a>05966                         p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a> = 0;
<a name="l05967"></a>05967                         p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a> = 0;
<a name="l05968"></a>05968                         <span class="comment">/* Only attempt transfer if the phone is ringing; why transfer to busy tone eh? */</span>
<a name="l05969"></a>05969                         <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="structdahdi__pvt.html#ad9edd1e07f21e10f246e7dc644d47e7e" title="TRUE if allowed to flash-transfer to busy channels.">transfertobusy</a> &amp;&amp; ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa00d313d1a4f4502932f1c10bd619591">AST_STATE_BUSY</a>) {
<a name="l05970"></a>05970                            <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l05971"></a>05971                            <span class="comment">/* Swap subs and dis-own channel */</span>
<a name="l05972"></a>05972                            <a class="code" href="chan__dahdi_8c.html#aaa6e6b7fe5725465004d3fabf351620e">swap_subs</a>(p, <a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>, <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>);
<a name="l05973"></a>05973                            p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = NULL;
<a name="l05974"></a>05974                            <span class="comment">/* Ring the phone */</span>
<a name="l05975"></a>05975                            <a class="code" href="chan__dahdi_8c.html#a22c775b992dee643a259e67efc1711d0">dahdi_ring_phone</a>(p);
<a name="l05976"></a>05976                         } <span class="keywordflow">else</span> {
<a name="l05977"></a>05977                            <span class="keywordflow">if</span> ((res = <a class="code" href="chan__dahdi_8c.html#a4119ca9de19a055b1db3bb27bc8f589a">attempt_transfer</a>(p)) &lt; 0) {
<a name="l05978"></a>05978                               p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#a7386ba9cc89b0b446f553a4d0f36576a">_softhangup</a> |= <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709a2e185ce313026e13ed90ae3a319c9cb7">AST_SOFTHANGUP_DEV</a>;
<a name="l05979"></a>05979                               <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)
<a name="l05980"></a>05980                                  <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l05981"></a>05981                            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res) {
<a name="l05982"></a>05982                               <span class="comment">/* Don&apos;t actually hang up at this point */</span>
<a name="l05983"></a>05983                               <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)
<a name="l05984"></a>05984                                  <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l05985"></a>05985                               <span class="keywordflow">break</span>;
<a name="l05986"></a>05986                            }
<a name="l05987"></a>05987                         }
<a name="l05988"></a>05988                      } <span class="keywordflow">else</span> {
<a name="l05989"></a>05989                         p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#a7386ba9cc89b0b446f553a4d0f36576a">_softhangup</a> |= <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709a2e185ce313026e13ed90ae3a319c9cb7">AST_SOFTHANGUP_DEV</a>;
<a name="l05990"></a>05990                         <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)
<a name="l05991"></a>05991                            <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l05992"></a>05992                      }
<a name="l05993"></a>05993                   } <span class="keywordflow">else</span> {
<a name="l05994"></a>05994                      <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l05995"></a>05995                      <span class="comment">/* Swap subs and dis-own channel */</span>
<a name="l05996"></a>05996                      <a class="code" href="chan__dahdi_8c.html#aaa6e6b7fe5725465004d3fabf351620e">swap_subs</a>(p, <a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>, <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>);
<a name="l05997"></a>05997                      p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = NULL;
<a name="l05998"></a>05998                      <span class="comment">/* Ring the phone */</span>
<a name="l05999"></a>05999                      <a class="code" href="chan__dahdi_8c.html#a22c775b992dee643a259e67efc1711d0">dahdi_ring_phone</a>(p);
<a name="l06000"></a>06000                   }
<a name="l06001"></a>06001                }
<a name="l06002"></a>06002             } <span class="keywordflow">else</span> {
<a name="l06003"></a>06003                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Got a hangup and my index is %d?\n&quot;</span>, idx);
<a name="l06004"></a>06004             }
<a name="l06005"></a>06005             <span class="comment">/* Fall through */</span>
<a name="l06006"></a>06006          <span class="keywordflow">default</span>:
<a name="l06007"></a>06007             <a class="code" href="chan__dahdi_8c.html#a5ceb6fd5bd012740d50b04e84fb29be4">dahdi_disable_ec</a>(p);
<a name="l06008"></a>06008             <span class="keywordflow">return</span> NULL;
<a name="l06009"></a>06009          }
<a name="l06010"></a>06010          <span class="keywordflow">break</span>;
<a name="l06011"></a>06011       <span class="keywordflow">case</span> DAHDI_EVENT_RINGOFFHOOK:
<a name="l06012"></a>06012          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#adbe10c4b12619d6cb58b1ad14bc437af" title="TRUE if in an alarm condition.">inalarm</a>) <span class="keywordflow">break</span>;
<a name="l06013"></a>06013          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a3b3cefe7a33d0cff61f3a2b5955b6c8b">oprmode</a> &lt; 0)
<a name="l06014"></a>06014          {
<a name="l06015"></a>06015             <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#adb40571aa5ff846fc334be5260eab257">SIG_FXOLS</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#a7c9b3bb8225896ff2b9aed27e6f80f10">SIG_FXOKS</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#a3dcffbaf4a26f2b7b792998df1eea27b">SIG_FXOGS</a>))
<a name="l06016"></a>06016             {
<a name="l06017"></a>06017                <span class="comment">/* Make sure it stops ringing */</span>
<a name="l06018"></a>06018                <a class="code" href="chan__dahdi_8c.html#a7c65e6943db828524ea6c9215b8bf696">dahdi_set_hook</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_RINGOFF);
<a name="l06019"></a>06019                tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a32e155760f552f4f2c0780e27b173c8c">oprpeer</a>-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, -1);
<a name="l06020"></a>06020                <a class="code" href="chan__dahdi_8c.html#a128443b4d6aa50b91bcd4668d582095f">restore_conference</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a32e155760f552f4f2c0780e27b173c8c">oprpeer</a>);
<a name="l06021"></a>06021             }
<a name="l06022"></a>06022             <span class="keywordflow">break</span>;
<a name="l06023"></a>06023          }
<a name="l06024"></a>06024          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#ac53b42243ee40edc74b615fe86806fe3" title="Nonzero if the signaling type is sent over a radio.">radio</a>)
<a name="l06025"></a>06025          {
<a name="l06026"></a>06026             p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>;
<a name="l06027"></a>06027             p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aacb7ddf1a95fa544fdecada68213f3c7">AST_CONTROL_RADIO_KEY</a>;
<a name="l06028"></a>06028             <span class="keywordflow">break</span>;
<a name="l06029"></a>06029          }
<a name="l06030"></a>06030          <span class="comment">/* for E911, its supposed to wait for offhook then dial</span>
<a name="l06031"></a>06031 <span class="comment">            the second half of the dial string */</span>
<a name="l06032"></a>06032          <span class="keywordflow">if</span> (((mysig == <a class="code" href="chan__dahdi_8c.html#adfdd0e4d05281d354c15ef1a5d158cd6">SIG_E911</a>) || (mysig == <a class="code" href="chan__dahdi_8c.html#a167056b2763a4897838c7115efc1f9fc">SIG_FGC_CAMA</a>) || (mysig == <a class="code" href="chan__dahdi_8c.html#a945e2b5f225d3abdc57b5dcc53daa62a">SIG_FGC_CAMAMF</a>)) &amp;&amp; (ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a4e5d21d1ab20653e36109919d6ea72e1">AST_STATE_DIALING_OFFHOOK</a>)) {
<a name="l06033"></a>06033             c = strchr(p-&gt;<a class="code" href="structdahdi__pvt.html#a0368d49962f1bf26c2603ade03cd8ee9" title="Delayed dialing for E911. Overlap digits for ISDN.">dialdest</a>, <span class="charliteral">&apos;/&apos;</span>);
<a name="l06034"></a>06034             <span class="keywordflow">if</span> (c)
<a name="l06035"></a>06035                c++;
<a name="l06036"></a>06036             <span class="keywordflow">else</span>
<a name="l06037"></a>06037                c = p-&gt;<a class="code" href="structdahdi__pvt.html#a0368d49962f1bf26c2603ade03cd8ee9" title="Delayed dialing for E911. Overlap digits for ISDN.">dialdest</a>;
<a name="l06038"></a>06038             <span class="keywordflow">if</span> (*c) snprintf(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr), <span class="stringliteral">&quot;M*0%s#&quot;</span>, c);
<a name="l06039"></a>06039             <span class="keywordflow">else</span> <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr,<span class="stringliteral">&quot;M*2#&quot;</span>, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr));
<a name="l06040"></a>06040             <span class="keywordflow">if</span> (strlen(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr) &gt; 4) {
<a name="l06041"></a>06041                memset(p-&gt;<a class="code" href="structdahdi__pvt.html#aa407dc4f683f66545461a5854c2ccff2" title="Filled with &amp;#39;w&amp;#39;. XXX Purpose??">echorest</a>, <span class="charliteral">&apos;w&apos;</span>, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structdahdi__pvt.html#aa407dc4f683f66545461a5854c2ccff2" title="Filled with &amp;#39;w&amp;#39;. XXX Purpose??">echorest</a>) - 1);
<a name="l06042"></a>06042                strcpy(p-&gt;<a class="code" href="structdahdi__pvt.html#aa407dc4f683f66545461a5854c2ccff2" title="Filled with &amp;#39;w&amp;#39;. XXX Purpose??">echorest</a> + (p-&gt;<a class="code" href="structdahdi__pvt.html#a6c8f2e86376f982c0d9e709736787a51" title="Echo training time. 0 = disabled.">echotraining</a> / 401) + 1, p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr + strlen(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr) - 2);
<a name="l06043"></a>06043                p-&gt;<a class="code" href="structdahdi__pvt.html#aa407dc4f683f66545461a5854c2ccff2" title="Filled with &amp;#39;w&amp;#39;. XXX Purpose??">echorest</a>[<span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structdahdi__pvt.html#aa407dc4f683f66545461a5854c2ccff2" title="Filled with &amp;#39;w&amp;#39;. XXX Purpose??">echorest</a>) - 1] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l06044"></a>06044                p-&gt;<a class="code" href="structdahdi__pvt.html#a8c759f824385c61bf3d4f56ad757ea76" title="XXX BOOLEAN Purpose???">echobreak</a> = 1;
<a name="l06045"></a>06045                p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr[strlen(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr)-2] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l06046"></a>06046             } <span class="keywordflow">else</span>
<a name="l06047"></a>06047                p-&gt;<a class="code" href="structdahdi__pvt.html#a8c759f824385c61bf3d4f56ad757ea76" title="XXX BOOLEAN Purpose???">echobreak</a> = 0;
<a name="l06048"></a>06048             <span class="keywordflow">if</span> (ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_DIAL, &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>)) {
<a name="l06049"></a>06049                <span class="keywordtype">int</span> saveerr = <a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;
<a name="l06050"></a>06050 
<a name="l06051"></a>06051                x = DAHDI_ONHOOK;
<a name="l06052"></a>06052                ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_HOOK, &amp;x);
<a name="l06053"></a>06053                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Dialing failed on channel %d: %s\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, strerror(saveerr));
<a name="l06054"></a>06054                <span class="keywordflow">return</span> NULL;
<a name="l06055"></a>06055                }
<a name="l06056"></a>06056             p-&gt;<a class="code" href="structdahdi__pvt.html#af17335c0c7a4c1e03e987a33f6eec81b" title="TRUE if in the process of dialing digits or sending something.">dialing</a> = 1;
<a name="l06057"></a>06057             <span class="keywordflow">return</span> &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>;
<a name="l06058"></a>06058          }
<a name="l06059"></a>06059          <span class="keywordflow">switch</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a>) {
<a name="l06060"></a>06060          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#adb40571aa5ff846fc334be5260eab257">SIG_FXOLS</a>:
<a name="l06061"></a>06061          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a3dcffbaf4a26f2b7b792998df1eea27b">SIG_FXOGS</a>:
<a name="l06062"></a>06062          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a7c9b3bb8225896ff2b9aed27e6f80f10">SIG_FXOKS</a>:
<a name="l06063"></a>06063             p-&gt;<a class="code" href="structdahdi__pvt.html#ab18fd594a2af8725e3ddb868d8499e06" title="TRUE if the FXS port is off-hook.">fxsoffhookstate</a> = 1;
<a name="l06064"></a>06064             <span class="keywordflow">switch</span> (ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a>) {
<a name="l06065"></a>06065             <span class="keywordflow">case</span> <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa">AST_STATE_RINGING</a>:
<a name="l06066"></a>06066                <a class="code" href="chan__dahdi_8c.html#a8c34a5bce2b26d056942349217806312">dahdi_enable_ec</a>(p);
<a name="l06067"></a>06067                <a class="code" href="chan__dahdi_8c.html#a31c006d7b409a09059a58946a706ea07">dahdi_train_ec</a>(p);
<a name="l06068"></a>06068                p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>;
<a name="l06069"></a>06069                p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe">AST_CONTROL_ANSWER</a>;
<a name="l06070"></a>06070                <span class="comment">/* Make sure it stops ringing */</span>
<a name="l06071"></a>06071                <a class="code" href="chan__dahdi_8c.html#a7c65e6943db828524ea6c9215b8bf696">dahdi_set_hook</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_OFFHOOK);
<a name="l06072"></a>06072                <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;channel %d answered\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l06073"></a>06073                <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a>) {
<a name="l06074"></a>06074                   <span class="comment">/* Cancel any running CallerID spill */</span>
<a name="l06075"></a>06075                   <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a>);
<a name="l06076"></a>06076                   p-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a> = NULL;
<a name="l06077"></a>06077                }
<a name="l06078"></a>06078                p-&gt;<a class="code" href="structdahdi__pvt.html#af17335c0c7a4c1e03e987a33f6eec81b" title="TRUE if in the process of dialing digits or sending something.">dialing</a> = 0;
<a name="l06079"></a>06079                p-&gt;<a class="code" href="structdahdi__pvt.html#a7a4e9b0410dd0636d8f10df9ff51e0a3" title="BOOLEAN. XXX Meaning what??">callwaitcas</a> = 0;
<a name="l06080"></a>06080                <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a3e597345fe12637b3f04fb25e11b2fa6" title="TRUE if to wait for a DTMF digit to confirm answer.">confirmanswer</a>) {
<a name="l06081"></a>06081                   <span class="comment">/* Ignore answer if &quot;confirm answer&quot; is enabled */</span>
<a name="l06082"></a>06082                   p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a29ff71f9d5c7927906ebd437fe372056">AST_FRAME_NULL</a>;
<a name="l06083"></a>06083                   p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = 0;
<a name="l06084"></a>06084                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr)) {
<a name="l06085"></a>06085                   <span class="comment">/* nick@dccinc.com 4/3/03 - fxo should be able to do deferred dialing */</span>
<a name="l06086"></a>06086                   res = ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_DIAL, &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>);
<a name="l06087"></a>06087                   <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l06088"></a>06088                      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to initiate dialing on trunk channel %d: %s\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, strerror(errno));
<a name="l06089"></a>06089                      p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l06090"></a>06090                      <span class="keywordflow">return</span> NULL;
<a name="l06091"></a>06091                   } <span class="keywordflow">else</span> {
<a name="l06092"></a>06092                      <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Sent FXO deferred digit string: %s\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr);
<a name="l06093"></a>06093                      p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a29ff71f9d5c7927906ebd437fe372056">AST_FRAME_NULL</a>;
<a name="l06094"></a>06094                      p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = 0;
<a name="l06095"></a>06095                      p-&gt;<a class="code" href="structdahdi__pvt.html#af17335c0c7a4c1e03e987a33f6eec81b" title="TRUE if in the process of dialing digits or sending something.">dialing</a> = 1;
<a name="l06096"></a>06096                   }
<a name="l06097"></a>06097                   p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l06098"></a>06098                   <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(ast, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa70881e902c6c29f27ffba80bb43554f">AST_STATE_DIALING</a>);
<a name="l06099"></a>06099                } <span class="keywordflow">else</span>
<a name="l06100"></a>06100                   <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(ast, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>);
<a name="l06101"></a>06101                <span class="keywordflow">return</span> &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>;
<a name="l06102"></a>06102             <span class="keywordflow">case</span> <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a>:
<a name="l06103"></a>06103                <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(ast, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a>);
<a name="l06104"></a>06104                ast-&gt;<a class="code" href="structast__channel.html#a358fd14658a0c5276190e48f1b1f251a">rings</a> = 1;
<a name="l06105"></a>06105                p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>;
<a name="l06106"></a>06106                p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a28cd8e9f9005e25624f993d6edd46755">AST_CONTROL_OFFHOOK</a>;
<a name="l06107"></a>06107                <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;channel %d picked up\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l06108"></a>06108                <span class="keywordflow">return</span> &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>;
<a name="l06109"></a>06109             <span class="keywordflow">case</span> <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>:
<a name="l06110"></a>06110                <span class="comment">/* Make sure it stops ringing */</span>
<a name="l06111"></a>06111                <a class="code" href="chan__dahdi_8c.html#a7c65e6943db828524ea6c9215b8bf696">dahdi_set_hook</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_OFFHOOK);
<a name="l06112"></a>06112                <span class="comment">/* Okay -- probably call waiting*/</span>
<a name="l06113"></a>06113                <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>))
<a name="l06114"></a>06114                   <a class="code" href="channel_8h.html#a60f9d2b0ab8b7a839902313321163b28" title="Queue a control frame with payload.">ast_queue_control</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a3e7629b5f7e39f1cc8ad2e51e266f91e">AST_CONTROL_UNHOLD</a>);
<a name="l06115"></a>06115                p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a65087932715c9dad92fb135aac7f3fac">needunhold</a> = 1;
<a name="l06116"></a>06116                <span class="keywordflow">break</span>;
<a name="l06117"></a>06117             <span class="keywordflow">case</span> <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660addb60fd97b55a4aea24f992e30fe3c84">AST_STATE_RESERVED</a>:
<a name="l06118"></a>06118                <span class="comment">/* Start up dialtone */</span>
<a name="l06119"></a>06119                <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#a8be869dea1576c3f11795532605549dc">has_voicemail</a>(p))
<a name="l06120"></a>06120                   res = tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_STUTTER);
<a name="l06121"></a>06121                <span class="keywordflow">else</span>
<a name="l06122"></a>06122                   res = tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_DIALTONE);
<a name="l06123"></a>06123                <span class="keywordflow">break</span>;
<a name="l06124"></a>06124             <span class="keywordflow">default</span>:
<a name="l06125"></a>06125                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;FXO phone off hook in weird state %d??\n&quot;</span>, ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a>);
<a name="l06126"></a>06126             }
<a name="l06127"></a>06127             <span class="keywordflow">break</span>;
<a name="l06128"></a>06128          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a1dc50a07aef86c90ab94f1583c35a265">SIG_FXSLS</a>:
<a name="l06129"></a>06129          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a97e4c6fb4680984aafc6e0e55a2b6cb4">SIG_FXSGS</a>:
<a name="l06130"></a>06130          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a38139ec369c0243f4324eb4eb0c2f004">SIG_FXSKS</a>:
<a name="l06131"></a>06131             <span class="keywordflow">if</span> (ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a>) {
<a name="l06132"></a>06132                p-&gt;<a class="code" href="structdahdi__pvt.html#a2ecae7dca8c46e1948d9117eee9a15e4" title="Ring timeout timer??">ringt</a> = p-&gt;<a class="code" href="structdahdi__pvt.html#aadc5d8714afe5d456c8f17db3abf7f20" title="Ring timeout base.">ringt_base</a>;
<a name="l06133"></a>06133             }
<a name="l06134"></a>06134 
<a name="l06135"></a>06135             <span class="comment">/* If we get a ring then we cannot be in</span>
<a name="l06136"></a>06136 <span class="comment">             * reversed polarity. So we reset to idle */</span>
<a name="l06137"></a>06137             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Setting IDLE polarity due &quot;</span>
<a name="l06138"></a>06138                <span class="stringliteral">&quot;to ring. Old polarity was %d\n&quot;</span>,
<a name="l06139"></a>06139                p-&gt;<a class="code" href="structdahdi__pvt.html#aeffac59edf881b639bb5e7c7137a7312" title="Current line interface polarity. POLARITY_IDLE, POLARITY_REV.">polarity</a>);
<a name="l06140"></a>06140             p-&gt;<a class="code" href="structdahdi__pvt.html#aeffac59edf881b639bb5e7c7137a7312" title="Current line interface polarity. POLARITY_IDLE, POLARITY_REV.">polarity</a> = <a class="code" href="chan__dahdi_8c.html#ad35015bf9d15c7474a4fef58ed0dcab2">POLARITY_IDLE</a>;
<a name="l06141"></a>06141 
<a name="l06142"></a>06142             <span class="comment">/* Fall through */</span>
<a name="l06143"></a>06143          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#afa7547cd2cee1bae7734206102635216">SIG_EM</a>:
<a name="l06144"></a>06144          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#aa7b59772722b794c5218768dac3ee419">SIG_EM_E1</a>:
<a name="l06145"></a>06145          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a1ba988b93fce049075b7c2ef6c931cf9">SIG_EMWINK</a>:
<a name="l06146"></a>06146          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ab79873391af2857a602e1eff68606f23">SIG_FEATD</a>:
<a name="l06147"></a>06147          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a98d4710afc1fcb2ff110eabb4fbcc308">SIG_FEATDMF</a>:
<a name="l06148"></a>06148          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ac0c40f74945ed15aa82cd9fedc304e55">SIG_FEATDMF_TA</a>:
<a name="l06149"></a>06149          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#adfdd0e4d05281d354c15ef1a5d158cd6">SIG_E911</a>:
<a name="l06150"></a>06150          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a167056b2763a4897838c7115efc1f9fc">SIG_FGC_CAMA</a>:
<a name="l06151"></a>06151          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a945e2b5f225d3abdc57b5dcc53daa62a">SIG_FGC_CAMAMF</a>:
<a name="l06152"></a>06152          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a0ba8ec199f5fb4f2be64144be0bd13b1">SIG_FEATB</a>:
<a name="l06153"></a>06153          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#afacb372d32fba2192ed6a2989c54fbda">SIG_SF</a>:
<a name="l06154"></a>06154          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a193853e7e76cff05d51425eba48d030f">SIG_SFWINK</a>:
<a name="l06155"></a>06155          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#aac334a7f88651d9e44499897386d2cfd">SIG_SF_FEATD</a>:
<a name="l06156"></a>06156          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a4625d3aba972e102c8460a9f16af0fc7">SIG_SF_FEATDMF</a>:
<a name="l06157"></a>06157          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a33a2f70a24e9f8ccfcc1e76f208b1ab6">SIG_SF_FEATB</a>:
<a name="l06158"></a>06158             <span class="keywordflow">if</span> (ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a70a2b40aa2ec0f6f0e7378df7a0810db">AST_STATE_PRERING</a>)
<a name="l06159"></a>06159                <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(ast, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a>);
<a name="l06160"></a>06160             <span class="keywordflow">if</span> ((ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a>) || (ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a>)) {
<a name="l06161"></a>06161                <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Ring detected\n&quot;</span>);
<a name="l06162"></a>06162                p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>;
<a name="l06163"></a>06163                p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a00675bfb8c64b2be86297fe4cba51fa2">AST_CONTROL_RING</a>;
<a name="l06164"></a>06164             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a40668dcb7d940b80c4f109861059a978" title="TRUE if we originated the call leg.">outgoing</a> &amp;&amp; ((ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa">AST_STATE_RINGING</a>) || (ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa70881e902c6c29f27ffba80bb43554f">AST_STATE_DIALING</a>))) {
<a name="l06165"></a>06165                <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Line answered\n&quot;</span>);
<a name="l06166"></a>06166                <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a3e597345fe12637b3f04fb25e11b2fa6" title="TRUE if to wait for a DTMF digit to confirm answer.">confirmanswer</a>) {
<a name="l06167"></a>06167                   p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a29ff71f9d5c7927906ebd437fe372056">AST_FRAME_NULL</a>;
<a name="l06168"></a>06168                   p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = 0;
<a name="l06169"></a>06169                } <span class="keywordflow">else</span> {
<a name="l06170"></a>06170                   p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>;
<a name="l06171"></a>06171                   p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe">AST_CONTROL_ANSWER</a>;
<a name="l06172"></a>06172                   <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(ast, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>);
<a name="l06173"></a>06173                }
<a name="l06174"></a>06174             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a>)
<a name="l06175"></a>06175                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Ring/Off-hook in strange state %d on channel %d\n&quot;</span>, ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l06176"></a>06176             <span class="keywordflow">break</span>;
<a name="l06177"></a>06177          <span class="keywordflow">default</span>:
<a name="l06178"></a>06178             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Don&apos;t know how to handle ring/off hook for signalling %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a>);
<a name="l06179"></a>06179          }
<a name="l06180"></a>06180          <span class="keywordflow">break</span>;
<a name="l06181"></a>06181       <span class="keywordflow">case</span> DAHDI_EVENT_RINGBEGIN:
<a name="l06182"></a>06182          <span class="keywordflow">switch</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a>) {
<a name="l06183"></a>06183          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a1dc50a07aef86c90ab94f1583c35a265">SIG_FXSLS</a>:
<a name="l06184"></a>06184          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a97e4c6fb4680984aafc6e0e55a2b6cb4">SIG_FXSGS</a>:
<a name="l06185"></a>06185          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a38139ec369c0243f4324eb4eb0c2f004">SIG_FXSKS</a>:
<a name="l06186"></a>06186             <span class="keywordflow">if</span> (ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a>) {
<a name="l06187"></a>06187                p-&gt;<a class="code" href="structdahdi__pvt.html#a2ecae7dca8c46e1948d9117eee9a15e4" title="Ring timeout timer??">ringt</a> = p-&gt;<a class="code" href="structdahdi__pvt.html#aadc5d8714afe5d456c8f17db3abf7f20" title="Ring timeout base.">ringt_base</a>;
<a name="l06188"></a>06188             }
<a name="l06189"></a>06189             <span class="keywordflow">break</span>;
<a name="l06190"></a>06190          }
<a name="l06191"></a>06191          <span class="keywordflow">break</span>;
<a name="l06192"></a>06192       <span class="keywordflow">case</span> DAHDI_EVENT_RINGEROFF:
<a name="l06193"></a>06193          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#adbe10c4b12619d6cb58b1ad14bc437af" title="TRUE if in an alarm condition.">inalarm</a>) <span class="keywordflow">break</span>;
<a name="l06194"></a>06194          <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structdahdi__pvt.html#ac53b42243ee40edc74b615fe86806fe3" title="Nonzero if the signaling type is sent over a radio.">radio</a> || (p-&gt;<a class="code" href="structdahdi__pvt.html#a3b3cefe7a33d0cff61f3a2b5955b6c8b">oprmode</a> &lt; 0))) <span class="keywordflow">break</span>;
<a name="l06195"></a>06195          ast-&gt;<a class="code" href="structast__channel.html#a358fd14658a0c5276190e48f1b1f251a">rings</a>++;
<a name="l06196"></a>06196          <span class="keywordflow">if</span> ((ast-&gt;<a class="code" href="structast__channel.html#a358fd14658a0c5276190e48f1b1f251a">rings</a> &gt; p-&gt;<a class="code" href="structdahdi__pvt.html#a7ca7134673ead6f14bc255488c0ac15f">cidrings</a>) &amp;&amp; (p-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a>)) {
<a name="l06197"></a>06197             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Didn&apos;t finish Caller-ID spill.  Cancelling.\n&quot;</span>);
<a name="l06198"></a>06198             <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a>);
<a name="l06199"></a>06199             p-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a> = NULL;
<a name="l06200"></a>06200             p-&gt;<a class="code" href="structdahdi__pvt.html#a7a4e9b0410dd0636d8f10df9ff51e0a3" title="BOOLEAN. XXX Meaning what??">callwaitcas</a> = 0;
<a name="l06201"></a>06201          }
<a name="l06202"></a>06202          p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>;
<a name="l06203"></a>06203          p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa5814e690c23b590bcd4eb43535907a1">AST_CONTROL_RINGING</a>;
<a name="l06204"></a>06204          <span class="keywordflow">break</span>;
<a name="l06205"></a>06205       <span class="keywordflow">case</span> DAHDI_EVENT_RINGERON:
<a name="l06206"></a>06206          <span class="keywordflow">break</span>;
<a name="l06207"></a>06207       <span class="keywordflow">case</span> DAHDI_EVENT_NOALARM:
<a name="l06208"></a>06208          p-&gt;<a class="code" href="structdahdi__pvt.html#adbe10c4b12619d6cb58b1ad14bc437af" title="TRUE if in an alarm condition.">inalarm</a> = 0;
<a name="l06209"></a>06209 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l06210"></a>06210 <span class="preprocessor"></span>         <span class="comment">/* Extremely unlikely but just in case */</span>
<a name="l06211"></a>06211          <span class="keywordflow">if</span> (p-&gt;bearer)
<a name="l06212"></a>06212             p-&gt;bearer-&gt;<a class="code" href="structdahdi__pvt.html#adbe10c4b12619d6cb58b1ad14bc437af" title="TRUE if in an alarm condition.">inalarm</a> = 0;
<a name="l06213"></a>06213 <span class="preprocessor">#endif</span>
<a name="l06214"></a>06214 <span class="preprocessor"></span>         <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Alarm cleared on channel %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l06215"></a>06215          <a class="code" href="manager_8h.html#a1ef0ee0044dbbeb4c3a5abc6c046b208" title="External routines may send asterisk manager events this way.">manager_event</a>(<a class="code" href="manager_8h.html#a420f0f755e1c3378b45ca7f6f0669ffa">EVENT_FLAG_SYSTEM</a>, <span class="stringliteral">&quot;AlarmClear&quot;</span>,
<a name="l06216"></a>06216                         <span class="stringliteral">&quot;Channel: %d\r\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l06217"></a>06217          <span class="keywordflow">break</span>;
<a name="l06218"></a>06218       <span class="keywordflow">case</span> DAHDI_EVENT_WINKFLASH:
<a name="l06219"></a>06219          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#adbe10c4b12619d6cb58b1ad14bc437af" title="TRUE if in an alarm condition.">inalarm</a>) <span class="keywordflow">break</span>;
<a name="l06220"></a>06220          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#ac53b42243ee40edc74b615fe86806fe3" title="Nonzero if the signaling type is sent over a radio.">radio</a>) <span class="keywordflow">break</span>;
<a name="l06221"></a>06221          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a3b3cefe7a33d0cff61f3a2b5955b6c8b">oprmode</a> &lt; 0) <span class="keywordflow">break</span>;
<a name="l06222"></a>06222          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a3b3cefe7a33d0cff61f3a2b5955b6c8b">oprmode</a> &gt; 1)
<a name="l06223"></a>06223          {
<a name="l06224"></a>06224             <span class="keyword">struct </span>dahdi_params par;
<a name="l06225"></a>06225 
<a name="l06226"></a>06226             memset(&amp;par, 0, <span class="keyword">sizeof</span>(par));
<a name="l06227"></a>06227             <span class="keywordflow">if</span> (ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a32e155760f552f4f2c0780e27b173c8c">oprpeer</a>-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_GET_PARAMS, &amp;par) != -1)
<a name="l06228"></a>06228             {
<a name="l06229"></a>06229                <span class="keywordflow">if</span> (!par.rxisoffhook)
<a name="l06230"></a>06230                {
<a name="l06231"></a>06231                   <span class="comment">/* Make sure it stops ringing */</span>
<a name="l06232"></a>06232                   <a class="code" href="chan__dahdi_8c.html#a7c65e6943db828524ea6c9215b8bf696">dahdi_set_hook</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a32e155760f552f4f2c0780e27b173c8c">oprpeer</a>-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_RINGOFF);
<a name="l06233"></a>06233                   <a class="code" href="chan__dahdi_8c.html#a7c65e6943db828524ea6c9215b8bf696">dahdi_set_hook</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a32e155760f552f4f2c0780e27b173c8c">oprpeer</a>-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_RING);
<a name="l06234"></a>06234                   <a class="code" href="chan__dahdi_8c.html#a756c4e1d2909416c454b6e63d28f1db1">save_conference</a>(p);
<a name="l06235"></a>06235                   tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_RINGTONE);
<a name="l06236"></a>06236                }
<a name="l06237"></a>06237             }
<a name="l06238"></a>06238             <span class="keywordflow">break</span>;
<a name="l06239"></a>06239          }
<a name="l06240"></a>06240          <span class="comment">/* Remember last time we got a flash-hook */</span>
<a name="l06241"></a>06241          p-&gt;<a class="code" href="structdahdi__pvt.html#a39ccf8f0384020d69764aa7ea619f515">flashtime</a> = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l06242"></a>06242          <span class="keywordflow">switch</span> (mysig) {
<a name="l06243"></a>06243          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#adb40571aa5ff846fc334be5260eab257">SIG_FXOLS</a>:
<a name="l06244"></a>06244          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a3dcffbaf4a26f2b7b792998df1eea27b">SIG_FXOGS</a>:
<a name="l06245"></a>06245          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a7c9b3bb8225896ff2b9aed27e6f80f10">SIG_FXOKS</a>:
<a name="l06246"></a>06246             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Winkflash, index: %d, normal: %d, callwait: %d, thirdcall: %d\n&quot;</span>,
<a name="l06247"></a>06247                idx, p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>);
<a name="l06248"></a>06248             p-&gt;<a class="code" href="structdahdi__pvt.html#a7a4e9b0410dd0636d8f10df9ff51e0a3" title="BOOLEAN. XXX Meaning what??">callwaitcas</a> = 0;
<a name="l06249"></a>06249 
<a name="l06250"></a>06250             <span class="keywordflow">if</span> (idx != <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>) {
<a name="l06251"></a>06251                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Got flash hook with index %d on channel %d?!?\n&quot;</span>, idx, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l06252"></a>06252                <span class="keywordflow">goto</span> winkflashdone;
<a name="l06253"></a>06253             }
<a name="l06254"></a>06254 
<a name="l06255"></a>06255             <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l06256"></a>06256                <span class="comment">/* Swap to call-wait */</span>
<a name="l06257"></a>06257                <a class="code" href="chan__dahdi_8c.html#aaa6e6b7fe5725465004d3fabf351620e">swap_subs</a>(p, <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>, <a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>);
<a name="l06258"></a>06258                tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, -1);
<a name="l06259"></a>06259                p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;
<a name="l06260"></a>06260                <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Making %s the new owner\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name);
<a name="l06261"></a>06261                <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa">AST_STATE_RINGING</a>) {
<a name="l06262"></a>06262                   <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>);
<a name="l06263"></a>06263                   p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a00bf8ced61d8f8736d6dc3b769609600">needanswer</a> = 1;
<a name="l06264"></a>06264                }
<a name="l06265"></a>06265                p-&gt;<a class="code" href="structdahdi__pvt.html#acb6666d113ea3605f76a45fe3e90e192">callwaitingrepeat</a> = 0;
<a name="l06266"></a>06266                p-&gt;<a class="code" href="structdahdi__pvt.html#ac8c4841c7cad35c09ddbd28ede1c4cfe">cidcwexpire</a> = 0;
<a name="l06267"></a>06267                <span class="comment">/* Start music on hold if appropriate */</span>
<a name="l06268"></a>06268                <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a> &amp;&amp; <a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)) {
<a name="l06269"></a>06269                   <a class="code" href="channel_8h.html#a7e5e15c22564fd66351d332ad10658b5" title="Queue a control frame with payload.">ast_queue_control_data</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390ab99a3d1c08c5ae8bca078c7cd1ec02f5">AST_CONTROL_HOLD</a>,
<a name="l06270"></a>06270                      <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#aec4e201113703e94cd365aaa6dabd4f0" title="Suggested music-on-hold class for peer channel to use for calls.">mohsuggest</a>, NULL),
<a name="l06271"></a>06271                      !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#aec4e201113703e94cd365aaa6dabd4f0" title="Suggested music-on-hold class for peer channel to use for calls.">mohsuggest</a>) ? strlen(p-&gt;<a class="code" href="structdahdi__pvt.html#aec4e201113703e94cd365aaa6dabd4f0" title="Suggested music-on-hold class for peer channel to use for calls.">mohsuggest</a>) + 1 : 0);
<a name="l06272"></a>06272                }
<a name="l06273"></a>06273                p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>].<a class="code" href="structdahdi__subchannel.html#a5efa58bfc75868fa24e748d4be6643d5">needhold</a> = 1;
<a name="l06274"></a>06274                <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)) {
<a name="l06275"></a>06275                   <a class="code" href="channel_8h.html#a7e5e15c22564fd66351d332ad10658b5" title="Queue a control frame with payload.">ast_queue_control_data</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390ab99a3d1c08c5ae8bca078c7cd1ec02f5">AST_CONTROL_HOLD</a>,
<a name="l06276"></a>06276                      <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#aec4e201113703e94cd365aaa6dabd4f0" title="Suggested music-on-hold class for peer channel to use for calls.">mohsuggest</a>, NULL),
<a name="l06277"></a>06277                      !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#aec4e201113703e94cd365aaa6dabd4f0" title="Suggested music-on-hold class for peer channel to use for calls.">mohsuggest</a>) ? strlen(p-&gt;<a class="code" href="structdahdi__pvt.html#aec4e201113703e94cd365aaa6dabd4f0" title="Suggested music-on-hold class for peer channel to use for calls.">mohsuggest</a>) + 1 : 0);
<a name="l06278"></a>06278                }
<a name="l06279"></a>06279                p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a65087932715c9dad92fb135aac7f3fac">needunhold</a> = 1;
<a name="l06280"></a>06280             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l06281"></a>06281                <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="structdahdi__pvt.html#a5ce774381529ffaadd4171bdeba5ebf3" title="TRUE if three way calling is enabled.">threewaycalling</a>) {
<a name="l06282"></a>06282                   <span class="comment">/* Just send a flash if no 3-way calling */</span>
<a name="l06283"></a>06283                   p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#ac6be644690e708e0af41b0e75f6a1e73">needflash</a> = 1;
<a name="l06284"></a>06284                   <span class="keywordflow">goto</span> winkflashdone;
<a name="l06285"></a>06285                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="chan__dahdi_8c.html#a7da85f2b0e343bc06fda0c9f675cb1e8">check_for_conference</a>(p)) {
<a name="l06286"></a>06286                   <span class="keywordtype">char</span> <a class="code" href="chan__mgcp_8c.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>[256];
<a name="l06287"></a>06287                   <span class="keywordtype">char</span> <a class="code" href="chan__mgcp_8c.html#ade5a89f9bee15a492c760ec1765a292d">cid_name</a>[256];
<a name="l06288"></a>06288 
<a name="l06289"></a>06289                   cid_num[0] = 0;
<a name="l06290"></a>06290                   cid_name[0] = 0;
<a name="l06291"></a>06291                   <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a1ef0f7461e78f948f1b71a1e5c99cc8b" title="TRUE if we should use the callerid from incoming call on dahdi transfer.">dahditrcallerid</a> &amp;&amp; p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l06292"></a>06292                      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>)
<a name="l06293"></a>06293                         <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(cid_num, p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>, <span class="keyword">sizeof</span>(cid_num));
<a name="l06294"></a>06294                      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ab2461abe6e234fe4f763b0a2179184b5">cid_name</a>)
<a name="l06295"></a>06295                         <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(cid_name, p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ab2461abe6e234fe4f763b0a2179184b5">cid_name</a>, <span class="keyword">sizeof</span>(cid_name));
<a name="l06296"></a>06296                   }
<a name="l06297"></a>06297                   <span class="comment">/* XXX This section needs much more error checking!!! XXX */</span>
<a name="l06298"></a>06298                   <span class="comment">/* Start a 3-way call if feasible */</span>
<a name="l06299"></a>06299                   <span class="keywordflow">if</span> (!((ast-&gt;<a class="code" href="structast__channel.html#aebc9ecdf679da616c7d975b827e1f4b4">pbx</a>) ||
<a name="l06300"></a>06300                      (ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>) ||
<a name="l06301"></a>06301                      (ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a>))) {
<a name="l06302"></a>06302                      <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Flash when call not up or ringing\n&quot;</span>);
<a name="l06303"></a>06303                      <span class="keywordflow">goto</span> winkflashdone;
<a name="l06304"></a>06304                   }
<a name="l06305"></a>06305                   <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#a8d921023bd460fd8278825f8f360f918">alloc_sub</a>(p, <a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>)) {
<a name="l06306"></a>06306                      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to allocate three-way subchannel\n&quot;</span>);
<a name="l06307"></a>06307                      <span class="keywordflow">goto</span> winkflashdone;
<a name="l06308"></a>06308                   }
<a name="l06309"></a>06309                   <span class="comment">/* Make new channel */</span>
<a name="l06310"></a>06310                   chan = <a class="code" href="chan__dahdi_8c.html#ab3f00769ae6c995b4f5f3934d8c805f6">dahdi_new</a>(p, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660addb60fd97b55a4aea24f992e30fe3c84">AST_STATE_RESERVED</a>, 0, <a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>, 0, 0);
<a name="l06311"></a>06311                   <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a1ef0f7461e78f948f1b71a1e5c99cc8b" title="TRUE if we should use the callerid from incoming call on dahdi transfer.">dahditrcallerid</a>) {
<a name="l06312"></a>06312                      <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="structdahdi__pvt.html#a4a5adec75d4b9de582f474a976b0162b">origcid_num</a>)
<a name="l06313"></a>06313                         p-&gt;<a class="code" href="structdahdi__pvt.html#a4a5adec75d4b9de582f474a976b0162b">origcid_num</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a29e973bd94bfbaf59d939bd1bc988c32" title="Caller ID number from an incoming call.">cid_num</a>);
<a name="l06314"></a>06314                      <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="structdahdi__pvt.html#a380d02f6bbbf15da87684ca8d288c4f7">origcid_name</a>)
<a name="l06315"></a>06315                         p-&gt;<a class="code" href="structdahdi__pvt.html#a380d02f6bbbf15da87684ca8d288c4f7">origcid_name</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ade5a89f9bee15a492c760ec1765a292d" title="Caller ID name from an incoming call.">cid_name</a>);
<a name="l06316"></a>06316                      <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a29e973bd94bfbaf59d939bd1bc988c32" title="Caller ID number from an incoming call.">cid_num</a>, cid_num, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structdahdi__pvt.html#a29e973bd94bfbaf59d939bd1bc988c32" title="Caller ID number from an incoming call.">cid_num</a>));
<a name="l06317"></a>06317                      <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ade5a89f9bee15a492c760ec1765a292d" title="Caller ID name from an incoming call.">cid_name</a>, cid_name, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structdahdi__pvt.html#ade5a89f9bee15a492c760ec1765a292d" title="Caller ID name from an incoming call.">cid_name</a>));
<a name="l06318"></a>06318                   }
<a name="l06319"></a>06319                   <span class="comment">/* Swap things around between the three-way and real call */</span>
<a name="l06320"></a>06320                   <a class="code" href="chan__dahdi_8c.html#aaa6e6b7fe5725465004d3fabf351620e">swap_subs</a>(p, <a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>, <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>);
<a name="l06321"></a>06321                   <span class="comment">/* Disable echo canceller for better dialing */</span>
<a name="l06322"></a>06322                   <a class="code" href="chan__dahdi_8c.html#a5ceb6fd5bd012740d50b04e84fb29be4">dahdi_disable_ec</a>(p);
<a name="l06323"></a>06323                   res = tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_DIALRECALL);
<a name="l06324"></a>06324                   <span class="keywordflow">if</span> (res)
<a name="l06325"></a>06325                      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to start dial recall tone on channel %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l06326"></a>06326                   p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = chan;
<a name="l06327"></a>06327                   <span class="keywordflow">if</span> (!chan) {
<a name="l06328"></a>06328                      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Cannot allocate new structure on channel %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l06329"></a>06329                   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a832647380b1f97e7ac1b4492f8816d46">ast_pthread_create_detached</a>(&amp;threadid, NULL, <a class="code" href="chan__dahdi_8c.html#a0d1f78e604903f5ef4e42bf961f4df95">ss_thread</a>, chan)) {
<a name="l06330"></a>06330                      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to start simple switch on channel %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l06331"></a>06331                      res = tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_CONGESTION);
<a name="l06332"></a>06332                      <a class="code" href="chan__dahdi_8c.html#a8c34a5bce2b26d056942349217806312">dahdi_enable_ec</a>(p);
<a name="l06333"></a>06333                      <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l06334"></a>06334                   } <span class="keywordflow">else</span> {
<a name="l06335"></a>06335                      <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *other = <a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l06336"></a>06336                      <span class="keywordtype">int</span> way3bridge = 0, cdr3way = 0;
<a name="l06337"></a>06337 
<a name="l06338"></a>06338                      <span class="keywordflow">if</span> (!other) {
<a name="l06339"></a>06339                         other = <a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l06340"></a>06340                      } <span class="keywordflow">else</span>
<a name="l06341"></a>06341                         way3bridge = 1;
<a name="l06342"></a>06342 
<a name="l06343"></a>06343                      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>)
<a name="l06344"></a>06344                         cdr3way = 1;
<a name="l06345"></a>06345 
<a name="l06346"></a>06346                      <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Started three way call on channel %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l06347"></a>06347 
<a name="l06348"></a>06348                      <span class="comment">/* Start music on hold if appropriate */</span>
<a name="l06349"></a>06349                      <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)) {
<a name="l06350"></a>06350                         <a class="code" href="channel_8h.html#a7e5e15c22564fd66351d332ad10658b5" title="Queue a control frame with payload.">ast_queue_control_data</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390ab99a3d1c08c5ae8bca078c7cd1ec02f5">AST_CONTROL_HOLD</a>,
<a name="l06351"></a>06351                            <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#aec4e201113703e94cd365aaa6dabd4f0" title="Suggested music-on-hold class for peer channel to use for calls.">mohsuggest</a>, NULL),
<a name="l06352"></a>06352                            !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#aec4e201113703e94cd365aaa6dabd4f0" title="Suggested music-on-hold class for peer channel to use for calls.">mohsuggest</a>) ? strlen(p-&gt;<a class="code" href="structdahdi__pvt.html#aec4e201113703e94cd365aaa6dabd4f0" title="Suggested music-on-hold class for peer channel to use for calls.">mohsuggest</a>) + 1 : 0);
<a name="l06353"></a>06353                      }
<a name="l06354"></a>06354                      p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a5efa58bfc75868fa24e748d4be6643d5">needhold</a> = 1;
<a name="l06355"></a>06355                   }
<a name="l06356"></a>06356                }
<a name="l06357"></a>06357             } <span class="keywordflow">else</span> {
<a name="l06358"></a>06358                <span class="comment">/* Already have a 3 way call */</span>
<a name="l06359"></a>06359                <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a>) {
<a name="l06360"></a>06360                   <span class="comment">/* Call is already up, drop the last person */</span>
<a name="l06361"></a>06361                   <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Got flash with three way call up, dropping last call on %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l06362"></a>06362                   <span class="comment">/* If the primary call isn&apos;t answered yet, use it */</span>
<a name="l06363"></a>06363                   <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>) &amp;&amp; (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>)) {
<a name="l06364"></a>06364                      <span class="comment">/* Swap back -- we&apos;re dropping the real 3-way that isn&apos;t finished yet*/</span>
<a name="l06365"></a>06365                      <a class="code" href="chan__dahdi_8c.html#aaa6e6b7fe5725465004d3fabf351620e">swap_subs</a>(p, <a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>, <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>);
<a name="l06366"></a>06366                      p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;
<a name="l06367"></a>06367                   }
<a name="l06368"></a>06368                   <span class="comment">/* Drop the last call and stop the conference */</span>
<a name="l06369"></a>06369                   <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Dropping three-way call on %s\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name);
<a name="l06370"></a>06370                   p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#a7386ba9cc89b0b446f553a4d0f36576a">_softhangup</a> |= <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709a2e185ce313026e13ed90ae3a319c9cb7">AST_SOFTHANGUP_DEV</a>;
<a name="l06371"></a>06371                   p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a> = 0;
<a name="l06372"></a>06372                   p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a> = 0;
<a name="l06373"></a>06373                } <span class="keywordflow">else</span> {
<a name="l06374"></a>06374                   <span class="comment">/* Lets see what we&apos;re up to */</span>
<a name="l06375"></a>06375                   <span class="keywordflow">if</span> (((ast-&gt;<a class="code" href="structast__channel.html#aebc9ecdf679da616c7d975b827e1f4b4">pbx</a>) || (ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>)) &amp;&amp;
<a name="l06376"></a>06376                      (p-&gt;<a class="code" href="structdahdi__pvt.html#ad9edd1e07f21e10f246e7dc644d47e7e" title="TRUE if allowed to flash-transfer to busy channels.">transfertobusy</a> || (ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa00d313d1a4f4502932f1c10bd619591">AST_STATE_BUSY</a>))) {
<a name="l06377"></a>06377                      <span class="keywordtype">int</span> otherindex = <a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>;
<a name="l06378"></a>06378                      <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *other = <a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l06379"></a>06379                      <span class="keywordtype">int</span> way3bridge = 0, cdr3way = 0;
<a name="l06380"></a>06380 
<a name="l06381"></a>06381                      <span class="keywordflow">if</span> (!other) {
<a name="l06382"></a>06382                         other = <a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l06383"></a>06383                      } <span class="keywordflow">else</span>
<a name="l06384"></a>06384                         way3bridge = 1;
<a name="l06385"></a>06385 
<a name="l06386"></a>06386                      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>)
<a name="l06387"></a>06387                         cdr3way = 1;
<a name="l06388"></a>06388 
<a name="l06389"></a>06389                      <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Building conference on call on %s and %s\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name, p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name);
<a name="l06390"></a>06390                      <span class="comment">/* Put them in the threeway, and flip */</span>
<a name="l06391"></a>06391                      p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a> = 1;
<a name="l06392"></a>06392                      p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a> = 1;
<a name="l06393"></a>06393                      <span class="keywordflow">if</span> (ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>) {
<a name="l06394"></a>06394                         <a class="code" href="chan__dahdi_8c.html#aaa6e6b7fe5725465004d3fabf351620e">swap_subs</a>(p, <a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>, <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>);
<a name="l06395"></a>06395                         otherindex = <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>;
<a name="l06396"></a>06396                      }
<a name="l06397"></a>06397                      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[otherindex].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> &amp;&amp; <a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[otherindex].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>))
<a name="l06398"></a>06398                         <a class="code" href="channel_8h.html#a60f9d2b0ab8b7a839902313321163b28" title="Queue a control frame with payload.">ast_queue_control</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[otherindex].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a3e7629b5f7e39f1cc8ad2e51e266f91e">AST_CONTROL_UNHOLD</a>);
<a name="l06399"></a>06399                      p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[otherindex].<a class="code" href="structdahdi__subchannel.html#a65087932715c9dad92fb135aac7f3fac">needunhold</a> = 1;
<a name="l06400"></a>06400                      p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;
<a name="l06401"></a>06401                      <span class="keywordflow">if</span> (ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa">AST_STATE_RINGING</a>) {
<a name="l06402"></a>06402                         <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Enabling ringtone on real and threeway\n&quot;</span>);
<a name="l06403"></a>06403                         res = tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_RINGTONE);
<a name="l06404"></a>06404                         res = tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_RINGTONE);
<a name="l06405"></a>06405                      }
<a name="l06406"></a>06406                   } <span class="keywordflow">else</span> {
<a name="l06407"></a>06407                      <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Dumping incomplete call on on %s\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name);
<a name="l06408"></a>06408                      <a class="code" href="chan__dahdi_8c.html#aaa6e6b7fe5725465004d3fabf351620e">swap_subs</a>(p, <a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>, <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>);
<a name="l06409"></a>06409                      p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#a7386ba9cc89b0b446f553a4d0f36576a">_softhangup</a> |= <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709a2e185ce313026e13ed90ae3a319c9cb7">AST_SOFTHANGUP_DEV</a>;
<a name="l06410"></a>06410                      p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;
<a name="l06411"></a>06411                      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> &amp;&amp; <a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>))
<a name="l06412"></a>06412                         <a class="code" href="channel_8h.html#a60f9d2b0ab8b7a839902313321163b28" title="Queue a control frame with payload.">ast_queue_control</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a3e7629b5f7e39f1cc8ad2e51e266f91e">AST_CONTROL_UNHOLD</a>);
<a name="l06413"></a>06413                      p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a65087932715c9dad92fb135aac7f3fac">needunhold</a> = 1;
<a name="l06414"></a>06414                      <a class="code" href="chan__dahdi_8c.html#a8c34a5bce2b26d056942349217806312">dahdi_enable_ec</a>(p);
<a name="l06415"></a>06415                   }
<a name="l06416"></a>06416                }
<a name="l06417"></a>06417             }
<a name="l06418"></a>06418 winkflashdone:
<a name="l06419"></a>06419             <a class="code" href="chan__dahdi_8c.html#ac56c05fde8bc30c71af46502e97fae3b">update_conf</a>(p);
<a name="l06420"></a>06420             <span class="keywordflow">break</span>;
<a name="l06421"></a>06421          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#afa7547cd2cee1bae7734206102635216">SIG_EM</a>:
<a name="l06422"></a>06422          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#aa7b59772722b794c5218768dac3ee419">SIG_EM_E1</a>:
<a name="l06423"></a>06423          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ab79873391af2857a602e1eff68606f23">SIG_FEATD</a>:
<a name="l06424"></a>06424          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#afacb372d32fba2192ed6a2989c54fbda">SIG_SF</a>:
<a name="l06425"></a>06425          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a193853e7e76cff05d51425eba48d030f">SIG_SFWINK</a>:
<a name="l06426"></a>06426          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#aac334a7f88651d9e44499897386d2cfd">SIG_SF_FEATD</a>:
<a name="l06427"></a>06427          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a1dc50a07aef86c90ab94f1583c35a265">SIG_FXSLS</a>:
<a name="l06428"></a>06428          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a97e4c6fb4680984aafc6e0e55a2b6cb4">SIG_FXSGS</a>:
<a name="l06429"></a>06429             <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#ga40f8fb2e731031d99f732f515cec680f">option_debug</a>) {
<a name="l06430"></a>06430                <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#af17335c0c7a4c1e03e987a33f6eec81b" title="TRUE if in the process of dialing digits or sending something.">dialing</a>)
<a name="l06431"></a>06431                   <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Ignoring wink on channel %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l06432"></a>06432                <span class="keywordflow">else</span>
<a name="l06433"></a>06433                   <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Got wink in weird state %d on channel %d\n&quot;</span>, ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l06434"></a>06434             }
<a name="l06435"></a>06435             <span class="keywordflow">break</span>;
<a name="l06436"></a>06436          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ac0c40f74945ed15aa82cd9fedc304e55">SIG_FEATDMF_TA</a>:
<a name="l06437"></a>06437             <span class="keywordflow">switch</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a448acac556be429cac9617bbdb402145">whichwink</a>) {
<a name="l06438"></a>06438             <span class="keywordflow">case</span> 0:
<a name="l06439"></a>06439                <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;ANI2 set to &apos;%d&apos; and ANI is &apos;%s&apos;\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a9540aaac76be952860ef25d607eb33fb">cid_ani2</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a7bb8ad258e687da69d6933ab48320df7">cid_ani</a>);
<a name="l06440"></a>06440                snprintf(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr), <span class="stringliteral">&quot;M*%d%s#&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a9540aaac76be952860ef25d607eb33fb">cid_ani2</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a7bb8ad258e687da69d6933ab48320df7">cid_ani</a>);
<a name="l06441"></a>06441                <span class="keywordflow">break</span>;
<a name="l06442"></a>06442             <span class="keywordflow">case</span> 1:
<a name="l06443"></a>06443                <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr, p-&gt;<a class="code" href="structdahdi__pvt.html#ad85d116dfc33464946da211c8a8fcb99" title="Second part of SIG_FEATDMF_TA wink operation.">finaldial</a>, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr));
<a name="l06444"></a>06444                <span class="keywordflow">break</span>;
<a name="l06445"></a>06445             <span class="keywordflow">case</span> 2:
<a name="l06446"></a>06446                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Received unexpected wink on channel of type SIG_FEATDMF_TA\n&quot;</span>);
<a name="l06447"></a>06447                <span class="keywordflow">return</span> NULL;
<a name="l06448"></a>06448             }
<a name="l06449"></a>06449             p-&gt;<a class="code" href="structdahdi__pvt.html#a448acac556be429cac9617bbdb402145">whichwink</a>++;
<a name="l06450"></a>06450             <span class="comment">/* Fall through */</span>
<a name="l06451"></a>06451          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a98d4710afc1fcb2ff110eabb4fbcc308">SIG_FEATDMF</a>:
<a name="l06452"></a>06452          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#adfdd0e4d05281d354c15ef1a5d158cd6">SIG_E911</a>:
<a name="l06453"></a>06453          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a945e2b5f225d3abdc57b5dcc53daa62a">SIG_FGC_CAMAMF</a>:
<a name="l06454"></a>06454          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a167056b2763a4897838c7115efc1f9fc">SIG_FGC_CAMA</a>:
<a name="l06455"></a>06455          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a0ba8ec199f5fb4f2be64144be0bd13b1">SIG_FEATB</a>:
<a name="l06456"></a>06456          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a4625d3aba972e102c8460a9f16af0fc7">SIG_SF_FEATDMF</a>:
<a name="l06457"></a>06457          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a33a2f70a24e9f8ccfcc1e76f208b1ab6">SIG_SF_FEATB</a>:
<a name="l06458"></a>06458          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a1ba988b93fce049075b7c2ef6c931cf9">SIG_EMWINK</a>:
<a name="l06459"></a>06459             <span class="comment">/* FGD MF and EMWINK *Must* wait for wink */</span>
<a name="l06460"></a>06460             <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr)) {
<a name="l06461"></a>06461                res = ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_DIAL, &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>);
<a name="l06462"></a>06462                <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l06463"></a>06463                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to initiate dialing on trunk channel %d: %s\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, strerror(errno));
<a name="l06464"></a>06464                   p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l06465"></a>06465                   <span class="keywordflow">return</span> NULL;
<a name="l06466"></a>06466                } <span class="keywordflow">else</span>
<a name="l06467"></a>06467                   <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Sent deferred digit string: %s\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr);
<a name="l06468"></a>06468             }
<a name="l06469"></a>06469             p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l06470"></a>06470             <span class="keywordflow">break</span>;
<a name="l06471"></a>06471          <span class="keywordflow">default</span>:
<a name="l06472"></a>06472             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Don&apos;t know how to handle ring/off hook for signalling %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a>);
<a name="l06473"></a>06473          }
<a name="l06474"></a>06474          <span class="keywordflow">break</span>;
<a name="l06475"></a>06475       <span class="keywordflow">case</span> DAHDI_EVENT_HOOKCOMPLETE:
<a name="l06476"></a>06476          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#adbe10c4b12619d6cb58b1ad14bc437af" title="TRUE if in an alarm condition.">inalarm</a>) <span class="keywordflow">break</span>;
<a name="l06477"></a>06477          <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structdahdi__pvt.html#ac53b42243ee40edc74b615fe86806fe3" title="Nonzero if the signaling type is sent over a radio.">radio</a> || (p-&gt;<a class="code" href="structdahdi__pvt.html#a3b3cefe7a33d0cff61f3a2b5955b6c8b">oprmode</a> &lt; 0))) <span class="keywordflow">break</span>;
<a name="l06478"></a>06478          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#ab9aab7a638e67037d3b01f381ed4beae">waitingfordt</a>.tv_sec) <span class="keywordflow">break</span>;
<a name="l06479"></a>06479          <span class="keywordflow">switch</span> (mysig) {
<a name="l06480"></a>06480          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a1dc50a07aef86c90ab94f1583c35a265">SIG_FXSLS</a>:  <span class="comment">/* only interesting for FXS */</span>
<a name="l06481"></a>06481          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a97e4c6fb4680984aafc6e0e55a2b6cb4">SIG_FXSGS</a>:
<a name="l06482"></a>06482          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a38139ec369c0243f4324eb4eb0c2f004">SIG_FXSKS</a>:
<a name="l06483"></a>06483          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#afa7547cd2cee1bae7734206102635216">SIG_EM</a>:
<a name="l06484"></a>06484          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#aa7b59772722b794c5218768dac3ee419">SIG_EM_E1</a>:
<a name="l06485"></a>06485          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a1ba988b93fce049075b7c2ef6c931cf9">SIG_EMWINK</a>:
<a name="l06486"></a>06486          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ab79873391af2857a602e1eff68606f23">SIG_FEATD</a>:
<a name="l06487"></a>06487          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#afacb372d32fba2192ed6a2989c54fbda">SIG_SF</a>:
<a name="l06488"></a>06488          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a193853e7e76cff05d51425eba48d030f">SIG_SFWINK</a>:
<a name="l06489"></a>06489          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#aac334a7f88651d9e44499897386d2cfd">SIG_SF_FEATD</a>:
<a name="l06490"></a>06490             <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr)) {
<a name="l06491"></a>06491                res = ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_DIAL, &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>);
<a name="l06492"></a>06492                <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l06493"></a>06493                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to initiate dialing on trunk channel %d: %s\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, strerror(errno));
<a name="l06494"></a>06494                   p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l06495"></a>06495                   <span class="keywordflow">return</span> NULL;
<a name="l06496"></a>06496                } <span class="keywordflow">else</span>
<a name="l06497"></a>06497                   <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Sent deferred digit string: %s\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr);
<a name="l06498"></a>06498             }
<a name="l06499"></a>06499             p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l06500"></a>06500             p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.op = DAHDI_DIAL_OP_REPLACE;
<a name="l06501"></a>06501             <span class="keywordflow">break</span>;
<a name="l06502"></a>06502          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a98d4710afc1fcb2ff110eabb4fbcc308">SIG_FEATDMF</a>:
<a name="l06503"></a>06503          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ac0c40f74945ed15aa82cd9fedc304e55">SIG_FEATDMF_TA</a>:
<a name="l06504"></a>06504          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#adfdd0e4d05281d354c15ef1a5d158cd6">SIG_E911</a>:
<a name="l06505"></a>06505          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a167056b2763a4897838c7115efc1f9fc">SIG_FGC_CAMA</a>:
<a name="l06506"></a>06506          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a945e2b5f225d3abdc57b5dcc53daa62a">SIG_FGC_CAMAMF</a>:
<a name="l06507"></a>06507          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a0ba8ec199f5fb4f2be64144be0bd13b1">SIG_FEATB</a>:
<a name="l06508"></a>06508          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a4625d3aba972e102c8460a9f16af0fc7">SIG_SF_FEATDMF</a>:
<a name="l06509"></a>06509          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a33a2f70a24e9f8ccfcc1e76f208b1ab6">SIG_SF_FEATB</a>:
<a name="l06510"></a>06510             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Got hook complete in MF FGD, waiting for wink now on channel %d\n&quot;</span>,p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l06511"></a>06511             <span class="keywordflow">break</span>;
<a name="l06512"></a>06512          <span class="keywordflow">default</span>:
<a name="l06513"></a>06513             <span class="keywordflow">break</span>;
<a name="l06514"></a>06514          }
<a name="l06515"></a>06515          <span class="keywordflow">break</span>;
<a name="l06516"></a>06516       <span class="keywordflow">case</span> DAHDI_EVENT_POLARITY:
<a name="l06517"></a>06517          <span class="comment">/*</span>
<a name="l06518"></a>06518 <span class="comment">          * If we get a Polarity Switch event, this could be</span>
<a name="l06519"></a>06519 <span class="comment">          * due to line seizure, remote end connect or remote end disconnect.</span>
<a name="l06520"></a>06520 <span class="comment">          *</span>
<a name="l06521"></a>06521 <span class="comment">          * Check to see if we should change the polarity state and</span>
<a name="l06522"></a>06522 <span class="comment">          * mark the channel as UP or if this is an indication</span>
<a name="l06523"></a>06523 <span class="comment">          * of remote end disconnect.</span>
<a name="l06524"></a>06524 <span class="comment">          */</span>
<a name="l06525"></a>06525 
<a name="l06526"></a>06526          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a28dcc1bc69a96039746426f0093f1ee5" title="Minimal time period (ms) between the answer polarity switch and hangup polarity switch...">polarityonanswerdelay</a> &gt; 0) {
<a name="l06527"></a>06527             <span class="comment">/* check if event is not too soon after OffHook or Answer */</span>
<a name="l06528"></a>06528             <span class="keywordflow">if</span> (<a class="code" href="time_8h.html#a74e35cffcd45ad6cd7c8587921e8a4c2" title="Computes the difference (in milliseconds) between two struct timeval instances.">ast_tvdiff_ms</a>(<a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>(), p-&gt;<a class="code" href="structdahdi__pvt.html#a7ad8177600d95c8debaba02d2327a171" title="Start delay time if polarityonanswerdelay is nonzero.">polaritydelaytv</a>) &gt; p-&gt;<a class="code" href="structdahdi__pvt.html#a28dcc1bc69a96039746426f0093f1ee5" title="Minimal time period (ms) between the answer polarity switch and hangup polarity switch...">polarityonanswerdelay</a>) {
<a name="l06529"></a>06529                <span class="keywordflow">switch</span> (ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a>) {
<a name="l06530"></a>06530                <span class="keywordflow">case</span> <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa70881e902c6c29f27ffba80bb43554f">AST_STATE_DIALING</a>:       <span class="comment">/*!&lt; Digits (or equivalent) have been dialed */</span>
<a name="l06531"></a>06531                <span class="keywordflow">case</span> <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa">AST_STATE_RINGING</a>:       <span class="comment">/*!&lt; Remote end is ringing */</span>
<a name="l06532"></a>06532                   <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a5a4fb6da5625cc1eec0c9821f0d41d52" title="TRUE if we can use a polarity reversal to mark when an outgoing call is answered...">answeronpolarityswitch</a>) {
<a name="l06533"></a>06533                      <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Answering on polarity switch! channel %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l06534"></a>06534                      <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>);
<a name="l06535"></a>06535                      p-&gt;<a class="code" href="structdahdi__pvt.html#aeffac59edf881b639bb5e7c7137a7312" title="Current line interface polarity. POLARITY_IDLE, POLARITY_REV.">polarity</a> = <a class="code" href="chan__dahdi_8c.html#aeba680adad3f0d1146c8e5003f6a44f2">POLARITY_REV</a>;
<a name="l06536"></a>06536                      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a7bc13c53b24817de617833097a940350" title="TRUE if the call will be considered &amp;quot;hung up&amp;quot; on a polarity reversal.">hanguponpolarityswitch</a>) {
<a name="l06537"></a>06537                         p-&gt;<a class="code" href="structdahdi__pvt.html#a7ad8177600d95c8debaba02d2327a171" title="Start delay time if polarityonanswerdelay is nonzero.">polaritydelaytv</a> = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l06538"></a>06538                      }
<a name="l06539"></a>06539                   } <span class="keywordflow">else</span> {
<a name="l06540"></a>06540                      <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Ignore Answer on polarity switch, channel %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l06541"></a>06541                   }
<a name="l06542"></a>06542                   <span class="keywordflow">break</span>;
<a name="l06543"></a>06543 
<a name="l06544"></a>06544                <span class="keywordflow">case</span> <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>:         <span class="comment">/*!&lt; Line is up */</span>
<a name="l06545"></a>06545                <span class="keywordflow">case</span> <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a>:       <span class="comment">/*!&lt; Line is ringing */</span>
<a name="l06546"></a>06546                   <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a7bc13c53b24817de617833097a940350" title="TRUE if the call will be considered &amp;quot;hung up&amp;quot; on a polarity reversal.">hanguponpolarityswitch</a>) {
<a name="l06547"></a>06547                      <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;HangingUp on polarity switch! channel %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l06548"></a>06548                      <a class="code" href="channel_8h.html#ac2d6607253f7e8b272d4e845474eaa9b" title="Softly hangup up a channel.">ast_softhangup</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709a2b3b711afc65059c4b51008c9fbc7aee">AST_SOFTHANGUP_EXPLICIT</a>);
<a name="l06549"></a>06549                      p-&gt;<a class="code" href="structdahdi__pvt.html#aeffac59edf881b639bb5e7c7137a7312" title="Current line interface polarity. POLARITY_IDLE, POLARITY_REV.">polarity</a> = <a class="code" href="chan__dahdi_8c.html#ad35015bf9d15c7474a4fef58ed0dcab2">POLARITY_IDLE</a>;
<a name="l06550"></a>06550                   } <span class="keywordflow">else</span> {
<a name="l06551"></a>06551                      <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Ignore Hangup on polarity switch, channel %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l06552"></a>06552                   }
<a name="l06553"></a>06553                   <span class="keywordflow">break</span>;
<a name="l06554"></a>06554 
<a name="l06555"></a>06555                <span class="keywordflow">case</span> <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a>:       <span class="comment">/*!&lt; Channel is down and available */</span>
<a name="l06556"></a>06556                <span class="keywordflow">case</span> <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660addb60fd97b55a4aea24f992e30fe3c84">AST_STATE_RESERVED</a>:      <span class="comment">/*!&lt; Channel is down, but reserved */</span>
<a name="l06557"></a>06557                <span class="keywordflow">case</span> <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a9d7b264ddca4b05135add5d9d48e6271">AST_STATE_OFFHOOK</a>:       <span class="comment">/*!&lt; Channel is off hook */</span>
<a name="l06558"></a>06558                <span class="keywordflow">case</span> <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa00d313d1a4f4502932f1c10bd619591">AST_STATE_BUSY</a>:       <span class="comment">/*!&lt; Line is busy */</span>
<a name="l06559"></a>06559                <span class="keywordflow">case</span> <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a4e5d21d1ab20653e36109919d6ea72e1">AST_STATE_DIALING_OFFHOOK</a>:     <span class="comment">/*!&lt; Digits (or equivalent) have been dialed while offhook */</span>
<a name="l06560"></a>06560                <span class="keywordflow">case</span> <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a70a2b40aa2ec0f6f0e7378df7a0810db">AST_STATE_PRERING</a>:       <span class="comment">/*!&lt; Channel has detected an incoming call and is waiting for ring */</span>
<a name="l06561"></a>06561                <span class="keywordflow">default</span>:
<a name="l06562"></a>06562                   <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a5a4fb6da5625cc1eec0c9821f0d41d52" title="TRUE if we can use a polarity reversal to mark when an outgoing call is answered...">answeronpolarityswitch</a> || p-&gt;<a class="code" href="structdahdi__pvt.html#a7bc13c53b24817de617833097a940350" title="TRUE if the call will be considered &amp;quot;hung up&amp;quot; on a polarity reversal.">hanguponpolarityswitch</a>) {
<a name="l06563"></a>06563                      <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Ignoring Polarity switch on channel %d, state %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a>);
<a name="l06564"></a>06564                   }
<a name="l06565"></a>06565                }
<a name="l06566"></a>06566 
<a name="l06567"></a>06567             } <span class="keywordflow">else</span> {
<a name="l06568"></a>06568                <span class="comment">/* event is too soon after OffHook or Answer */</span>
<a name="l06569"></a>06569                <span class="keywordflow">switch</span> (ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a>) {
<a name="l06570"></a>06570                <span class="keywordflow">case</span> <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa70881e902c6c29f27ffba80bb43554f">AST_STATE_DIALING</a>:       <span class="comment">/*!&lt; Digits (or equivalent) have been dialed */</span>
<a name="l06571"></a>06571                <span class="keywordflow">case</span> <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa">AST_STATE_RINGING</a>:       <span class="comment">/*!&lt; Remote end is ringing */</span>
<a name="l06572"></a>06572                   <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a5a4fb6da5625cc1eec0c9821f0d41d52" title="TRUE if we can use a polarity reversal to mark when an outgoing call is answered...">answeronpolarityswitch</a>) {
<a name="l06573"></a>06573                      <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Polarity switch detected but NOT answering (too close to OffHook event) on channel %d, state %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a>);
<a name="l06574"></a>06574                   }
<a name="l06575"></a>06575                   <span class="keywordflow">break</span>;
<a name="l06576"></a>06576 
<a name="l06577"></a>06577                <span class="keywordflow">case</span> <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>:         <span class="comment">/*!&lt; Line is up */</span>
<a name="l06578"></a>06578                <span class="keywordflow">case</span> <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a>:       <span class="comment">/*!&lt; Line is ringing */</span>
<a name="l06579"></a>06579                   <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a7bc13c53b24817de617833097a940350" title="TRUE if the call will be considered &amp;quot;hung up&amp;quot; on a polarity reversal.">hanguponpolarityswitch</a>) {
<a name="l06580"></a>06580                      <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Polarity switch detected but NOT hanging up (too close to Answer event) on channel %d, state %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a>);
<a name="l06581"></a>06581                   }
<a name="l06582"></a>06582                   <span class="keywordflow">break</span>;
<a name="l06583"></a>06583 
<a name="l06584"></a>06584                <span class="keywordflow">default</span>: 
<a name="l06585"></a>06585                   <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a5a4fb6da5625cc1eec0c9821f0d41d52" title="TRUE if we can use a polarity reversal to mark when an outgoing call is answered...">answeronpolarityswitch</a> || p-&gt;<a class="code" href="structdahdi__pvt.html#a7bc13c53b24817de617833097a940350" title="TRUE if the call will be considered &amp;quot;hung up&amp;quot; on a polarity reversal.">hanguponpolarityswitch</a>) {
<a name="l06586"></a>06586                      <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Polarity switch detected (too close to previous event) on channel %d, state %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a>);
<a name="l06587"></a>06587                   }
<a name="l06588"></a>06588                }
<a name="l06589"></a>06589             }
<a name="l06590"></a>06590          }
<a name="l06591"></a>06591 
<a name="l06592"></a>06592          <span class="comment">/* Added more log_debug information below to provide a better indication of what is going on */</span>
<a name="l06593"></a>06593          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Polarity Reversal event occured - DEBUG 2: channel %d, state %d, pol= %d, aonp= %d, honp= %d, pdelay= %d, tv= %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#aeffac59edf881b639bb5e7c7137a7312" title="Current line interface polarity. POLARITY_IDLE, POLARITY_REV.">polarity</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#a5a4fb6da5625cc1eec0c9821f0d41d52" title="TRUE if we can use a polarity reversal to mark when an outgoing call is answered...">answeronpolarityswitch</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#a7bc13c53b24817de617833097a940350" title="TRUE if the call will be considered &amp;quot;hung up&amp;quot; on a polarity reversal.">hanguponpolarityswitch</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#a28dcc1bc69a96039746426f0093f1ee5" title="Minimal time period (ms) between the answer polarity switch and hangup polarity switch...">polarityonanswerdelay</a>, <a class="code" href="time_8h.html#a74e35cffcd45ad6cd7c8587921e8a4c2" title="Computes the difference (in milliseconds) between two struct timeval instances.">ast_tvdiff_ms</a>(<a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>(), p-&gt;<a class="code" href="structdahdi__pvt.html#a7ad8177600d95c8debaba02d2327a171" title="Start delay time if polarityonanswerdelay is nonzero.">polaritydelaytv</a>) );
<a name="l06594"></a>06594          <span class="keywordflow">break</span>;
<a name="l06595"></a>06595       <span class="keywordflow">default</span>:
<a name="l06596"></a>06596          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Dunno what to do with event %d on channel %d\n&quot;</span>, res, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l06597"></a>06597    }
<a name="l06598"></a>06598    <span class="keywordflow">return</span> &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>;
<a name="l06599"></a>06599 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a62c33bf06afee20f754f2a4145eae9ef"></a><!-- doxytag: member="chan_dahdi.c::dahdi_hangup" ref="a62c33bf06afee20f754f2a4145eae9ef" args="(struct ast_channel *ast)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int dahdi_hangup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>ast</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l04313">4313</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00469">ast_channel::_state</a>, <a class="el" href="channel_8c_source.html#l04733">ast_bridged_channel()</a>, <a class="el" href="channel_8c_source.html#l05307">ast_channel_setoption()</a>, <a class="el" href="frame_8h_source.html#l00313">AST_CONTROL_HOLD</a>, <a class="el" href="frame_8h_source.html#l00314">AST_CONTROL_UNHOLD</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="dsp_8c_source.html#l01545">ast_dsp_free()</a>, <a class="el" href="dsp_8c_source.html#l01628">ast_dsp_set_digitmode()</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="loader_8c_source.html#l01171">ast_module_unref()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="frame_8h_source.html#l00376">AST_OPTION_AUDIO_MODE</a>, <a class="el" href="frame_8h_source.html#l00370">AST_OPTION_TDD</a>, <a class="el" href="frame_8h_source.html#l00367">AST_OPTION_TONE_VERIFY</a>, <a class="el" href="channel_8c_source.html#l01123">ast_queue_control()</a>, <a class="el" href="channel_8c_source.html#l01133">ast_queue_control_data()</a>, <a class="el" href="channel_8h_source.html#l00360">AST_STATE_RESERVED</a>, <a class="el" href="channel_8h_source.html#l00365">AST_STATE_UP</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="chan__dahdi_8c_source.html#l00662">dahdi_pvt::buf_no</a>, <a class="el" href="chan__dahdi_8c_source.html#l00663">dahdi_pvt::buf_policy</a>, <a class="el" href="chan__dahdi_8c_source.html#l00661">dahdi_pvt::bufsize</a>, <a class="el" href="chan__dahdi_8c_source.html#l01070">dahdi_pvt::callwaitcas</a>, <a class="el" href="chan__dahdi_8c_source.html#l00716">dahdi_pvt::callwaiting</a>, <a class="el" href="chan__dahdi_8c_source.html#l01047">dahdi_pvt::callwaitingrepeat</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="chan__dahdi_8c_source.html#l01001">dahdi_pvt::cid_name</a>, <a class="el" href="chan__dahdi_8c_source.html#l00997">dahdi_pvt::cid_num</a>, <a class="el" href="chan__dahdi_8c_source.html#l01048">dahdi_pvt::cidcwexpire</a>, <a class="el" href="chan__dahdi_8c_source.html#l01146">dahdi_pvt::cidrings</a>, <a class="el" href="chan__dahdi_8c_source.html#l01050">dahdi_pvt::cidspill</a>, <a class="el" href="chan__dahdi_8c_source.html#l00735">dahdi_pvt::confirmanswer</a>, <a class="el" href="chan__dahdi_8c_source.html#l02880">dahdi_confmute()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02709">dahdi_disable_ec()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01503">dahdi_get_index()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02863">dahdi_set_hook()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02165">dahdi_setlinear()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00740">dahdi_pvt::destroy</a>, <a class="el" href="chan__dahdi_8c_source.html#l03879">destroy_channel()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="chan__dahdi_8c_source.html#l00745">dahdi_pvt::dialing</a>, <a class="el" href="chan__dahdi_8c_source.html#l00741">dahdi_pvt::didtdd</a>, <a class="el" href="chan__dahdi_8c_source.html#l00747">dahdi_pvt::digital</a>, <a class="el" href="chan__dahdi_8c_source.html#l01145">dahdi_pvt::distinctivering</a>, <a class="el" href="chan__dahdi_8c_source.html#l01113">dahdi_pvt::dsp</a>, <a class="el" href="dsp_8h_source.html#l00031">DSP_DIGITMODE_DTMF</a>, <a class="el" href="chan__dahdi_8c_source.html#l01147">dahdi_pvt::dtmfrelax</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="chan__dahdi_8c_source.html#l00973">dahdi_pvt::exten</a>, <a class="el" href="chan__dahdi_8c_source.html#l00765">dahdi_pvt::faxbuffersinuse</a>, <a class="el" href="chan__dahdi_8c_source.html#l00761">dahdi_pvt::faxhandled</a>, <a class="el" href="chan__dahdi_8c_source.html#l01137">dahdi_pvt::fxsoffhookstate</a>, <a class="el" href="chan__dahdi_8c_source.html#l01043">dahdi_pvt::guardtime</a>, <a class="el" href="channel_8h_source.html#l00479">ast_channel::hangupcause</a>, <a class="el" href="chan__dahdi_8c_source.html#l00781">dahdi_pvt::hidecallerid</a>, <a class="el" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>, <a class="el" href="chan__dahdi_8c_source.html#l00789">dahdi_pvt::ignoredtmf</a>, <a class="el" href="chan__dahdi_8c_source.html#l00621">dahdi_subchannel::inthreeway</a>, <a class="el" href="chan__dahdi_8c_source.html#l01022">dahdi_pvt::law</a>, <a class="el" href="chan__dahdi_8c_source.html#l00620">dahdi_subchannel::linear</a>, <a class="el" href="chan__dahdi_8c_source.html#l00649">dahdi_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00119">LOG_DEBUG</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__dahdi_8c_source.html#l00988">dahdi_pvt::mohsuggest</a>, <a class="el" href="chan__dahdi_8c_source.html#l01229">dahdi_pvt::muting</a>, <a class="el" href="chan__dahdi_8c_source.html#l00616">dahdi_subchannel::needanswer</a>, <a class="el" href="chan__dahdi_8c_source.html#l00613">dahdi_subchannel::needbusy</a>, <a class="el" href="chan__dahdi_8c_source.html#l00615">dahdi_subchannel::needcallerid</a>, <a class="el" href="chan__dahdi_8c_source.html#l00614">dahdi_subchannel::needcongestion</a>, <a class="el" href="chan__dahdi_8c_source.html#l00617">dahdi_subchannel::needflash</a>, <a class="el" href="chan__dahdi_8c_source.html#l00612">dahdi_subchannel::needringing</a>, <a class="el" href="chan__dahdi_8c_source.html#l00682">dahdi_pvt::next</a>, <a class="el" href="chan__dahdi_8c_source.html#l01135">dahdi_pvt::onhooktime</a>, <a class="el" href="chan__dahdi_8c_source.html#l00673">dahdi_pvt::oprmode</a>, <a class="el" href="chan__dahdi_8c_source.html#l01007">dahdi_pvt::origcid_name</a>, <a class="el" href="chan__dahdi_8c_source.html#l01006">dahdi_pvt::origcid_num</a>, <a class="el" href="chan__dahdi_8c_source.html#l00801">dahdi_pvt::outgoing</a>, <a class="el" href="chan__dahdi_8c_source.html#l00650">dahdi_pvt::owner</a>, <a class="el" href="chan__dahdi_8c_source.html#l00608">dahdi_subchannel::owner</a>, <a class="el" href="pbx_8c_source.html#l08951">pbx_builtin_getvar_helper()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00808">dahdi_pvt::permcallwaiting</a>, <a class="el" href="chan__dahdi_8c_source.html#l00813">dahdi_pvt::permhidecallerid</a>, <a class="el" href="chan__dahdi_8c_source.html#l01177">dahdi_pvt::polarity</a>, <a class="el" href="chan__dahdi_8c_source.html#l00584">POLARITY_IDLE</a>, <a class="el" href="chan__dahdi_8c_source.html#l00683">dahdi_pvt::prev</a>, <a class="el" href="chan__dahdi_8c_source.html#l00830">dahdi_pvt::pulsedial</a>, <a class="el" href="chan__dahdi_8c_source.html#l00671">dahdi_pvt::radio</a>, <a class="el" href="chan__dahdi_8c_source.html#l01013">dahdi_pvt::rdnis</a>, <a class="el" href="chan__dahdi_8c_source.html#l02590">reset_conf()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09705">restart_monitor()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00831">dahdi_pvt::restartpending</a>, <a class="el" href="chan__dahdi_8c_source.html#l02850">restore_gains()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01056">dahdi_pvt::ringt</a>, <a class="el" href="strings_8h_source.html#l00072">S_OR</a>, <a class="el" href="chan__dahdi_8c_source.html#l00666">dahdi_pvt::sig</a>, <a class="el" href="chan__dahdi_8c_source.html#l00256">SIG_BRI</a>, <a class="el" href="chan__dahdi_8c_source.html#l00257">SIG_BRI_PTMP</a>, <a class="el" href="chan__dahdi_8c_source.html#l00253">SIG_FXOGS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00254">SIG_FXOKS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00252">SIG_FXOLS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00250">SIG_FXSGS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00251">SIG_FXSKS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00249">SIG_FXSLS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00259">SIG_MFCR2</a>, <a class="el" href="chan__dahdi_8c_source.html#l00255">SIG_PRI</a>, <a class="el" href="chan__dahdi_8c_source.html#l00258">SIG_SS7</a>, <a class="el" href="chan__dahdi_8c_source.html#l01042">dahdi_pvt::span</a>, <a class="el" href="chan__dahdi_8c_source.html#l00580">SUB_CALLWAIT</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, <a class="el" href="chan__dahdi_8c_source.html#l00581">SUB_THREEWAY</a>, <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>, <a class="el" href="chan__dahdi_8c_source.html#l02062">swap_subs()</a>, <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>, <a class="el" href="chan__dahdi_8c_source.html#l02212">unalloc_sub()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02604">update_conf()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l01110">dahdi_pvt::waitingfordt</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04314"></a>04314 {
<a name="l04315"></a>04315    <span class="keywordtype">int</span> res;
<a name="l04316"></a>04316    <span class="keywordtype">int</span> idx,x, law;
<a name="l04317"></a>04317    <span class="comment">/*static int restore_gains(struct dahdi_pvt *p);*/</span>
<a name="l04318"></a>04318    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *p = ast-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l04319"></a>04319    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *tmp = NULL;
<a name="l04320"></a>04320    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *<a class="code" href="structdahdi__pvt.html#abba5e5e1dcf19b4ded5000d926e0a70d">prev</a> = NULL;
<a name="l04321"></a>04321    <span class="keyword">struct </span>dahdi_params par;
<a name="l04322"></a>04322 
<a name="l04323"></a>04323    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;dahdi_hangup(%s)\n&quot;</span>, ast-&gt;name);
<a name="l04324"></a>04324    <span class="keywordflow">if</span> (!ast-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>) {
<a name="l04325"></a>04325       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Asked to hangup channel not connected\n&quot;</span>);
<a name="l04326"></a>04326       <span class="keywordflow">return</span> 0;
<a name="l04327"></a>04327    }
<a name="l04328"></a>04328 
<a name="l04329"></a>04329    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l04330"></a>04330 
<a name="l04331"></a>04331    idx = <a class="code" href="chan__dahdi_8c.html#a62c8e3f411fb9e5ec62a1e77c152c2df">dahdi_get_index</a>(ast, p, 1);
<a name="l04332"></a>04332 
<a name="l04333"></a>04333    <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#ae9ab0c9508fca045a06730533be276a5">SIG_PRI</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#aadcda889db3cf9dfe757dbc1d4d8311a">SIG_SS7</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#ab5bfeaf991c23c5b6510ace44ae79ce9">SIG_BRI</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a>)) {
<a name="l04334"></a>04334       x = 1;
<a name="l04335"></a>04335       <a class="code" href="channel_8h.html#adcfd8d241b6de48068ead143ac29978d" title="Sets an option on a channel.">ast_channel_setoption</a>(ast,<a class="code" href="frame_8h.html#aee98973da4263b45bacb162534a66cfc">AST_OPTION_AUDIO_MODE</a>,&amp;x,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>),0);
<a name="l04336"></a>04336       p-&gt;<a class="code" href="structdahdi__pvt.html#a29e973bd94bfbaf59d939bd1bc988c32" title="Caller ID number from an incoming call.">cid_num</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l04337"></a>04337       p-&gt;<a class="code" href="structdahdi__pvt.html#ade5a89f9bee15a492c760ec1765a292d" title="Caller ID name from an incoming call.">cid_name</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l04338"></a>04338    }
<a name="l04339"></a>04339 
<a name="l04340"></a>04340    x = 0;
<a name="l04341"></a>04341    <a class="code" href="chan__dahdi_8c.html#a04126d689aca51a8a38499685cffe8f6">dahdi_confmute</a>(p, 0);
<a name="l04342"></a>04342    p-&gt;<a class="code" href="structdahdi__pvt.html#ae6778ad7c2d7a99161a32c9b87eddf85" title="TRUE if confrence is muted.">muting</a> = 0;
<a name="l04343"></a>04343    <a class="code" href="chan__dahdi_8c.html#a0ac913fed804e8326af276cfa450ed03">restore_gains</a>(p);
<a name="l04344"></a>04344    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a4a5adec75d4b9de582f474a976b0162b">origcid_num</a>) {
<a name="l04345"></a>04345       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a29e973bd94bfbaf59d939bd1bc988c32" title="Caller ID number from an incoming call.">cid_num</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#a4a5adec75d4b9de582f474a976b0162b">origcid_num</a>, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structdahdi__pvt.html#a29e973bd94bfbaf59d939bd1bc988c32" title="Caller ID number from an incoming call.">cid_num</a>));
<a name="l04346"></a>04346       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a4a5adec75d4b9de582f474a976b0162b">origcid_num</a>);
<a name="l04347"></a>04347       p-&gt;<a class="code" href="structdahdi__pvt.html#a4a5adec75d4b9de582f474a976b0162b">origcid_num</a> = NULL;
<a name="l04348"></a>04348    }
<a name="l04349"></a>04349    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a380d02f6bbbf15da87684ca8d288c4f7">origcid_name</a>) {
<a name="l04350"></a>04350       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ade5a89f9bee15a492c760ec1765a292d" title="Caller ID name from an incoming call.">cid_name</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#a380d02f6bbbf15da87684ca8d288c4f7">origcid_name</a>, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structdahdi__pvt.html#ade5a89f9bee15a492c760ec1765a292d" title="Caller ID name from an incoming call.">cid_name</a>));
<a name="l04351"></a>04351       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a380d02f6bbbf15da87684ca8d288c4f7">origcid_name</a>);
<a name="l04352"></a>04352       p-&gt;<a class="code" href="structdahdi__pvt.html#a380d02f6bbbf15da87684ca8d288c4f7">origcid_name</a> = NULL;
<a name="l04353"></a>04353    }
<a name="l04354"></a>04354    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>)
<a name="l04355"></a>04355       <a class="code" href="dsp_8h.html#aa28ffa065bd46d09b5b06de2f77183b0" title="Set digit mode.">ast_dsp_set_digitmode</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>, <a class="code" href="dsp_8h.html#af0e16e88030540319d8a545dd7c2576c">DSP_DIGITMODE_DTMF</a> | p-&gt;<a class="code" href="structdahdi__pvt.html#a6829c6ed48c184cbd85055163786a7eb">dtmfrelax</a>);
<a name="l04356"></a>04356    p-&gt;<a class="code" href="structdahdi__pvt.html#a78d4847658b695383d849efd12399b38" title="Extension to use in the dialplan.">exten</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l04357"></a>04357 
<a name="l04358"></a>04358    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Hangup: channel: %d index = %d, normal = %d, callwait = %d, thirdcall = %d\n&quot;</span>,
<a name="l04359"></a>04359       p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, idx, p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>);
<a name="l04360"></a>04360    p-&gt;<a class="code" href="structdahdi__pvt.html#a1caa9d0f8fb61da132fe2a1aa69d1973" title="TRUE if DTMF detection is disabled.">ignoredtmf</a> = 0;
<a name="l04361"></a>04361 
<a name="l04362"></a>04362    <span class="keywordflow">if</span> (idx &gt; -1) {
<a name="l04363"></a>04363       <span class="comment">/* Real channel, do some fixup */</span>
<a name="l04364"></a>04364       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = NULL;
<a name="l04365"></a>04365       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a00bf8ced61d8f8736d6dc3b769609600">needanswer</a> = 0;
<a name="l04366"></a>04366       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#ac6be644690e708e0af41b0e75f6a1e73">needflash</a> = 0;
<a name="l04367"></a>04367       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a0b09a2171a877eaadb67da4f5639abc4">needringing</a> = 0;
<a name="l04368"></a>04368       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#acff5e006a504c765d6519826b2eedfbb">needbusy</a> = 0;
<a name="l04369"></a>04369       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#aef1968b7fea4a1850482539b046f0f96">needcongestion</a> = 0;
<a name="l04370"></a>04370       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a2de30c0a559b0df57ba137153a1370ea">linear</a> = 0;
<a name="l04371"></a>04371       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#acdc708c228fb207718ea0a3bae497d26">needcallerid</a> = 0;
<a name="l04372"></a>04372       p-&gt;<a class="code" href="structdahdi__pvt.html#aeffac59edf881b639bb5e7c7137a7312" title="Current line interface polarity. POLARITY_IDLE, POLARITY_REV.">polarity</a> = <a class="code" href="chan__dahdi_8c.html#ad35015bf9d15c7474a4fef58ed0dcab2">POLARITY_IDLE</a>;
<a name="l04373"></a>04373       <a class="code" href="chan__dahdi_8c.html#a8392b32cf7d3daa7b45154b7001460df">dahdi_setlinear</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, 0);
<a name="l04374"></a>04374       <span class="keywordflow">if</span> (idx == <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>) {
<a name="l04375"></a>04375          <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a> &gt; -1) &amp;&amp; (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a> &gt; -1)) {
<a name="l04376"></a>04376             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Normal call hung up with both three way call and a call waiting call in place?\n&quot;</span>);
<a name="l04377"></a>04377             <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a>) {
<a name="l04378"></a>04378                <span class="comment">/* We had flipped over to answer a callwait and now it&apos;s gone */</span>
<a name="l04379"></a>04379                <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;We were flipped over to the callwait, moving back and unowning.\n&quot;</span>);
<a name="l04380"></a>04380                <span class="comment">/* Move to the call-wait, but un-own us until they flip back. */</span>
<a name="l04381"></a>04381                <a class="code" href="chan__dahdi_8c.html#aaa6e6b7fe5725465004d3fabf351620e">swap_subs</a>(p, <a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>, <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>);
<a name="l04382"></a>04382                <a class="code" href="chan__dahdi_8c.html#a164404a295fbba4f9d3c2c6cf123468f">unalloc_sub</a>(p, <a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>);
<a name="l04383"></a>04383                p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = NULL;
<a name="l04384"></a>04384             } <span class="keywordflow">else</span> {
<a name="l04385"></a>04385                <span class="comment">/* The three way hung up, but we still have a call wait */</span>
<a name="l04386"></a>04386                <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;We were in the threeway and have a callwait still.  Ditching the threeway.\n&quot;</span>);
<a name="l04387"></a>04387                <a class="code" href="chan__dahdi_8c.html#aaa6e6b7fe5725465004d3fabf351620e">swap_subs</a>(p, <a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>, <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>);
<a name="l04388"></a>04388                <a class="code" href="chan__dahdi_8c.html#a164404a295fbba4f9d3c2c6cf123468f">unalloc_sub</a>(p, <a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>);
<a name="l04389"></a>04389                <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a>) {
<a name="l04390"></a>04390                   <span class="comment">/* This was part of a three way call.  Immediately make way for</span>
<a name="l04391"></a>04391 <span class="comment">                     another call */</span>
<a name="l04392"></a>04392                   <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Call was complete, setting owner to former third call\n&quot;</span>);
<a name="l04393"></a>04393                   p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;
<a name="l04394"></a>04394                } <span class="keywordflow">else</span> {
<a name="l04395"></a>04395                   <span class="comment">/* This call hasn&apos;t been completed yet...  Set owner to NULL */</span>
<a name="l04396"></a>04396                   <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Call was incomplete, setting owner to NULL\n&quot;</span>);
<a name="l04397"></a>04397                   p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = NULL;
<a name="l04398"></a>04398                }
<a name="l04399"></a>04399                p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a> = 0;
<a name="l04400"></a>04400             }
<a name="l04401"></a>04401          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a> &gt; -1) {
<a name="l04402"></a>04402             <span class="comment">/* Move to the call-wait and switch back to them. */</span>
<a name="l04403"></a>04403             <a class="code" href="chan__dahdi_8c.html#aaa6e6b7fe5725465004d3fabf351620e">swap_subs</a>(p, <a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>, <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>);
<a name="l04404"></a>04404             <a class="code" href="chan__dahdi_8c.html#a164404a295fbba4f9d3c2c6cf123468f">unalloc_sub</a>(p, <a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>);
<a name="l04405"></a>04405             p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;
<a name="l04406"></a>04406             <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>)
<a name="l04407"></a>04407                p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a00bf8ced61d8f8736d6dc3b769609600">needanswer</a> = 1;
<a name="l04408"></a>04408             <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>))
<a name="l04409"></a>04409                <a class="code" href="channel_8h.html#a60f9d2b0ab8b7a839902313321163b28" title="Queue a control frame with payload.">ast_queue_control</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a3e7629b5f7e39f1cc8ad2e51e266f91e">AST_CONTROL_UNHOLD</a>);
<a name="l04410"></a>04410          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a> &gt; -1) {
<a name="l04411"></a>04411             <a class="code" href="chan__dahdi_8c.html#aaa6e6b7fe5725465004d3fabf351620e">swap_subs</a>(p, <a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>, <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>);
<a name="l04412"></a>04412             <a class="code" href="chan__dahdi_8c.html#a164404a295fbba4f9d3c2c6cf123468f">unalloc_sub</a>(p, <a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>);
<a name="l04413"></a>04413             <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a>) {
<a name="l04414"></a>04414                <span class="comment">/* This was part of a three way call.  Immediately make way for</span>
<a name="l04415"></a>04415 <span class="comment">                  another call */</span>
<a name="l04416"></a>04416                <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Call was complete, setting owner to former third call\n&quot;</span>);
<a name="l04417"></a>04417                p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;
<a name="l04418"></a>04418             } <span class="keywordflow">else</span> {
<a name="l04419"></a>04419                <span class="comment">/* This call hasn&apos;t been completed yet...  Set owner to NULL */</span>
<a name="l04420"></a>04420                <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Call was incomplete, setting owner to NULL\n&quot;</span>);
<a name="l04421"></a>04421                p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = NULL;
<a name="l04422"></a>04422             }
<a name="l04423"></a>04423             p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a> = 0;
<a name="l04424"></a>04424          }
<a name="l04425"></a>04425       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (idx == <a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>) {
<a name="l04426"></a>04426          <span class="comment">/* Ditch the holding callwait call, and immediately make it availabe */</span>
<a name="l04427"></a>04427          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a>) {
<a name="l04428"></a>04428             <span class="comment">/* This is actually part of a three way, placed on hold.  Place the third part</span>
<a name="l04429"></a>04429 <span class="comment">               on music on hold now */</span>
<a name="l04430"></a>04430             <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> &amp;&amp; <a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)) {
<a name="l04431"></a>04431                <a class="code" href="channel_8h.html#a7e5e15c22564fd66351d332ad10658b5" title="Queue a control frame with payload.">ast_queue_control_data</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390ab99a3d1c08c5ae8bca078c7cd1ec02f5">AST_CONTROL_HOLD</a>,
<a name="l04432"></a>04432                   <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#aec4e201113703e94cd365aaa6dabd4f0" title="Suggested music-on-hold class for peer channel to use for calls.">mohsuggest</a>, NULL),
<a name="l04433"></a>04433                   !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#aec4e201113703e94cd365aaa6dabd4f0" title="Suggested music-on-hold class for peer channel to use for calls.">mohsuggest</a>) ? strlen(p-&gt;<a class="code" href="structdahdi__pvt.html#aec4e201113703e94cd365aaa6dabd4f0" title="Suggested music-on-hold class for peer channel to use for calls.">mohsuggest</a>) + 1 : 0);
<a name="l04434"></a>04434             }
<a name="l04435"></a>04435             p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a> = 0;
<a name="l04436"></a>04436             <span class="comment">/* Make it the call wait now */</span>
<a name="l04437"></a>04437             <a class="code" href="chan__dahdi_8c.html#aaa6e6b7fe5725465004d3fabf351620e">swap_subs</a>(p, <a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>, <a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>);
<a name="l04438"></a>04438             <a class="code" href="chan__dahdi_8c.html#a164404a295fbba4f9d3c2c6cf123468f">unalloc_sub</a>(p, <a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>);
<a name="l04439"></a>04439          } <span class="keywordflow">else</span>
<a name="l04440"></a>04440             <a class="code" href="chan__dahdi_8c.html#a164404a295fbba4f9d3c2c6cf123468f">unalloc_sub</a>(p, <a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>);
<a name="l04441"></a>04441       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (idx == <a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>) {
<a name="l04442"></a>04442          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a>) {
<a name="l04443"></a>04443             <span class="comment">/* The other party of the three way call is currently in a call-wait state.</span>
<a name="l04444"></a>04444 <span class="comment">               Start music on hold for them, and take the main guy out of the third call */</span>
<a name="l04445"></a>04445             <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> &amp;&amp; <a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)) {
<a name="l04446"></a>04446                <a class="code" href="channel_8h.html#a7e5e15c22564fd66351d332ad10658b5" title="Queue a control frame with payload.">ast_queue_control_data</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390ab99a3d1c08c5ae8bca078c7cd1ec02f5">AST_CONTROL_HOLD</a>,
<a name="l04447"></a>04447                   <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#aec4e201113703e94cd365aaa6dabd4f0" title="Suggested music-on-hold class for peer channel to use for calls.">mohsuggest</a>, NULL),
<a name="l04448"></a>04448                   !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#aec4e201113703e94cd365aaa6dabd4f0" title="Suggested music-on-hold class for peer channel to use for calls.">mohsuggest</a>) ? strlen(p-&gt;<a class="code" href="structdahdi__pvt.html#aec4e201113703e94cd365aaa6dabd4f0" title="Suggested music-on-hold class for peer channel to use for calls.">mohsuggest</a>) + 1 : 0);
<a name="l04449"></a>04449             }
<a name="l04450"></a>04450             p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a> = 0;
<a name="l04451"></a>04451          }
<a name="l04452"></a>04452          p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a> = 0;
<a name="l04453"></a>04453          <span class="comment">/* If this was part of a three way call index, let us make</span>
<a name="l04454"></a>04454 <span class="comment">            another three way call */</span>
<a name="l04455"></a>04455          <a class="code" href="chan__dahdi_8c.html#a164404a295fbba4f9d3c2c6cf123468f">unalloc_sub</a>(p, <a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>);
<a name="l04456"></a>04456       } <span class="keywordflow">else</span> {
<a name="l04457"></a>04457          <span class="comment">/* This wasn&apos;t any sort of call, but how are we an index? */</span>
<a name="l04458"></a>04458          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Index found but not any type of call?\n&quot;</span>);
<a name="l04459"></a>04459       }
<a name="l04460"></a>04460    }
<a name="l04461"></a>04461 
<a name="l04462"></a>04462    <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> &amp;&amp; !p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> &amp;&amp; !p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l04463"></a>04463       p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = NULL;
<a name="l04464"></a>04464       p-&gt;<a class="code" href="structdahdi__pvt.html#a2ecae7dca8c46e1948d9117eee9a15e4" title="Ring timeout timer??">ringt</a> = 0;
<a name="l04465"></a>04465       p-&gt;<a class="code" href="structdahdi__pvt.html#a64dd7ed4d1e8aebcfe5b84001765d22c">distinctivering</a> = 0;
<a name="l04466"></a>04466       p-&gt;<a class="code" href="structdahdi__pvt.html#a3e597345fe12637b3f04fb25e11b2fa6" title="TRUE if to wait for a DTMF digit to confirm answer.">confirmanswer</a> = 0;
<a name="l04467"></a>04467       p-&gt;<a class="code" href="structdahdi__pvt.html#a7ca7134673ead6f14bc255488c0ac15f">cidrings</a> = 1;
<a name="l04468"></a>04468       p-&gt;<a class="code" href="structdahdi__pvt.html#a40668dcb7d940b80c4f109861059a978" title="TRUE if we originated the call leg.">outgoing</a> = 0;
<a name="l04469"></a>04469       p-&gt;<a class="code" href="structdahdi__pvt.html#adf54768a4327f86de3a234648305c4a4" title="TRUE if the transfer capability of the call is digital.">digital</a> = 0;
<a name="l04470"></a>04470       p-&gt;<a class="code" href="structdahdi__pvt.html#a93c16dce1468c2decb08eae44d525fbd" title="TRUE if a fax tone has already been handled.">faxhandled</a> = 0;
<a name="l04471"></a>04471       p-&gt;<a class="code" href="structdahdi__pvt.html#ae56835e2739c5d155391c01485455497" title="TRUE if a pulsed digit was detected. (Pulse dial phone detected).">pulsedial</a> = 0;
<a name="l04472"></a>04472       p-&gt;<a class="code" href="structdahdi__pvt.html#a74643a768dac2465f8612f81ba4ff177" title="Time the interface went on-hook.">onhooktime</a> = time(NULL);
<a name="l04473"></a>04473 <span class="preprocessor">#if defined(HAVE_PRI) || defined(HAVE_SS7)</span>
<a name="l04474"></a>04474 <span class="preprocessor"></span>      p-&gt;proceeding = 0;
<a name="l04475"></a>04475       p-&gt;<a class="code" href="structdahdi__pvt.html#af17335c0c7a4c1e03e987a33f6eec81b" title="TRUE if in the process of dialing digits or sending something.">dialing</a> = 0;
<a name="l04476"></a>04476       p-&gt;progress = 0;
<a name="l04477"></a>04477       p-&gt;alerting = 0;
<a name="l04478"></a>04478       p-&gt;setup_ack = 0;
<a name="l04479"></a>04479       p-&gt;rlt = 0;
<a name="l04480"></a>04480 <span class="preprocessor">#endif</span>
<a name="l04481"></a>04481 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>) {
<a name="l04482"></a>04482          <a class="code" href="dsp_8h.html#a0a57a1e374549eb2705068688f4046db">ast_dsp_free</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>);
<a name="l04483"></a>04483          p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a> = NULL;
<a name="l04484"></a>04484       }
<a name="l04485"></a>04485 
<a name="l04486"></a>04486       <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#af7d7cae908ce478b4822c5dc385324df" title="TRUE while dynamic faxbuffers are in use.">faxbuffersinuse</a>) {
<a name="l04487"></a>04487          <span class="comment">/* faxbuffers are in use, revert them */</span>
<a name="l04488"></a>04488          <span class="keyword">struct </span>dahdi_bufferinfo bi = {
<a name="l04489"></a>04489             .txbufpolicy = p-&gt;<a class="code" href="structdahdi__pvt.html#abfc3801c54ad9e430f5cdf383450a052">buf_policy</a>,
<a name="l04490"></a>04490             .rxbufpolicy = p-&gt;<a class="code" href="structdahdi__pvt.html#abfc3801c54ad9e430f5cdf383450a052">buf_policy</a>,
<a name="l04491"></a>04491             .bufsize = p-&gt;<a class="code" href="structdahdi__pvt.html#a199ab88d4ca8eab30e1cb7d35edacca5">bufsize</a>,
<a name="l04492"></a>04492             .numbufs = p-&gt;<a class="code" href="structdahdi__pvt.html#adb74dc4af40df4615bb5f05846cefc9d">buf_no</a>
<a name="l04493"></a>04493          };
<a name="l04494"></a>04494          <span class="keywordtype">int</span> bpres;
<a name="l04495"></a>04495 
<a name="l04496"></a>04496          <span class="keywordflow">if</span> ((bpres = ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_SET_BUFINFO, &amp;bi)) &lt; 0) {
<a name="l04497"></a>04497             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Channel &apos;%s&apos; unable to revert faxbuffer policy: %s\n&quot;</span>, ast-&gt;name, strerror(errno));
<a name="l04498"></a>04498          }
<a name="l04499"></a>04499          p-&gt;<a class="code" href="structdahdi__pvt.html#af7d7cae908ce478b4822c5dc385324df" title="TRUE while dynamic faxbuffers are in use.">faxbuffersinuse</a> = 0;
<a name="l04500"></a>04500       }
<a name="l04501"></a>04501 
<a name="l04502"></a>04502       law = DAHDI_LAW_DEFAULT;
<a name="l04503"></a>04503       res = ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_SETLAW, &amp;law);
<a name="l04504"></a>04504       <span class="keywordflow">if</span> (res &lt; 0)
<a name="l04505"></a>04505          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to set law on channel %d to default: %s\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, strerror(errno));
<a name="l04506"></a>04506       <span class="comment">/* Perform low level hangup if no owner left */</span>
<a name="l04507"></a>04507 <span class="preprocessor">#ifdef HAVE_SS7</span>
<a name="l04508"></a>04508 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (p-&gt;ss7) {
<a name="l04509"></a>04509          <span class="keywordflow">if</span> (p-&gt;ss7call) {
<a name="l04510"></a>04510             <span class="keywordflow">if</span> (!ss7_grab(p, p-&gt;ss7)) {
<a name="l04511"></a>04511                <span class="keywordflow">if</span> (!p-&gt;alreadyhungup) {
<a name="l04512"></a>04512                   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a> = <a class="code" href="pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b" title="Return a pointer to the value of the corresponding channel variable.">pbx_builtin_getvar_helper</a>(ast,<span class="stringliteral">&quot;SS7_CAUSE&quot;</span>);
<a name="l04513"></a>04513                   <span class="keywordtype">int</span> icause = ast-&gt;<a class="code" href="structast__channel.html#aa4261b664d6712ba8551bde24ad17382">hangupcause</a> ? ast-&gt;<a class="code" href="structast__channel.html#aa4261b664d6712ba8551bde24ad17382">hangupcause</a> : -1;
<a name="l04514"></a>04514 
<a name="l04515"></a>04515                   <span class="keywordflow">if</span> (cause) {
<a name="l04516"></a>04516                      <span class="keywordflow">if</span> (atoi(cause))
<a name="l04517"></a>04517                         icause = atoi(cause);
<a name="l04518"></a>04518                   }
<a name="l04519"></a>04519                   isup_rel(p-&gt;ss7-&gt;ss7, p-&gt;ss7call, icause);
<a name="l04520"></a>04520                   ss7_rel(p-&gt;ss7);
<a name="l04521"></a>04521                   p-&gt;alreadyhungup = 1;
<a name="l04522"></a>04522                } <span class="keywordflow">else</span>
<a name="l04523"></a>04523                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Trying to hangup twice!\n&quot;</span>);
<a name="l04524"></a>04524             } <span class="keywordflow">else</span> {
<a name="l04525"></a>04525                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to grab SS7 on CIC %d\n&quot;</span>, p-&gt;cic);
<a name="l04526"></a>04526                res = -1;
<a name="l04527"></a>04527             }
<a name="l04528"></a>04528          }
<a name="l04529"></a>04529       }
<a name="l04530"></a>04530 <span class="preprocessor">#endif</span>
<a name="l04531"></a>04531 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_OPENR2</span>
<a name="l04532"></a>04532 <span class="preprocessor"></span>      p-&gt;<a class="code" href="structdahdi__pvt.html#a29e973bd94bfbaf59d939bd1bc988c32" title="Caller ID number from an incoming call.">cid_num</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l04533"></a>04533       p-&gt;<a class="code" href="structdahdi__pvt.html#ade5a89f9bee15a492c760ec1765a292d" title="Caller ID name from an incoming call.">cid_name</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l04534"></a>04534       <span class="keywordflow">if</span> (p-&gt;mfcr2 &amp;&amp; p-&gt;mfcr2call &amp;&amp; openr2_chan_get_direction(p-&gt;r2chan) != OR2_DIR_STOPPED) {
<a name="l04535"></a>04535          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;disconnecting MFC/R2 call on chan %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l04536"></a>04536          <span class="comment">/* If it&apos;s an incoming call, check the mfcr2_forced_release setting */</span>
<a name="l04537"></a>04537          <span class="keywordflow">if</span> (openr2_chan_get_direction(p-&gt;r2chan) == OR2_DIR_BACKWARD &amp;&amp; p-&gt;mfcr2_forced_release) {
<a name="l04538"></a>04538             dahdi_r2_disconnect_call(p, OR2_CAUSE_FORCED_RELEASE);
<a name="l04539"></a>04539          } <span class="keywordflow">else</span> {
<a name="l04540"></a>04540             <span class="keyword">const</span> <span class="keywordtype">char</span> *r2causestr = <a class="code" href="pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b" title="Return a pointer to the value of the corresponding channel variable.">pbx_builtin_getvar_helper</a>(ast, <span class="stringliteral">&quot;MFCR2_CAUSE&quot;</span>);
<a name="l04541"></a>04541             <span class="keywordtype">int</span> r2cause_user = r2causestr ? atoi(r2causestr) : 0;
<a name="l04542"></a>04542             openr2_call_disconnect_cause_t r2cause = r2cause_user ? dahdi_ast_cause_to_r2_cause(r2cause_user)
<a name="l04543"></a>04543                                                              : dahdi_ast_cause_to_r2_cause(ast-&gt;hangupcause);
<a name="l04544"></a>04544             dahdi_r2_disconnect_call(p, r2cause);
<a name="l04545"></a>04545          }
<a name="l04546"></a>04546       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p-&gt;mfcr2call) {
<a name="l04547"></a>04547          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;Clearing call request on channel %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l04548"></a>04548          <span class="comment">/* since ast_request() was called but not ast_call() we have not yet dialed</span>
<a name="l04549"></a>04549 <span class="comment">         and the openr2 stack will not call on_call_end callback, we need to unset</span>
<a name="l04550"></a>04550 <span class="comment">         the mfcr2call flag and bump the monitor count so the monitor thread can take</span>
<a name="l04551"></a>04551 <span class="comment">         care of this channel events from now on */</span>
<a name="l04552"></a>04552          p-&gt;mfcr2call = 0;
<a name="l04553"></a>04553       }
<a name="l04554"></a>04554 <span class="preprocessor">#endif</span>
<a name="l04555"></a>04555 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l04556"></a>04556 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (p-&gt;pri) {
<a name="l04557"></a>04557 <span class="preprocessor">#ifdef SUPPORT_USERUSER</span>
<a name="l04558"></a>04558 <span class="preprocessor"></span>         <span class="keyword">const</span> <span class="keywordtype">char</span> *useruser = <a class="code" href="pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b" title="Return a pointer to the value of the corresponding channel variable.">pbx_builtin_getvar_helper</a>(ast,<span class="stringliteral">&quot;USERUSERINFO&quot;</span>);
<a name="l04559"></a>04559 <span class="preprocessor">#endif</span>
<a name="l04560"></a>04560 <span class="preprocessor"></span>
<a name="l04561"></a>04561          <span class="comment">/* Make sure we have a call (or REALLY have a call in the case of a PRI) */</span>
<a name="l04562"></a>04562          <span class="keywordflow">if</span> (p-&gt;call &amp;&amp; (!p-&gt;bearer || (p-&gt;bearer-&gt;call == p-&gt;call))) {
<a name="l04563"></a>04563             <span class="keywordflow">if</span> (!pri_grab(p, p-&gt;pri)) {
<a name="l04564"></a>04564                <span class="keywordflow">if</span> (p-&gt;alreadyhungup) {
<a name="l04565"></a>04565                   <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Already hungup...  Calling hangup once, and clearing call\n&quot;</span>);
<a name="l04566"></a>04566 
<a name="l04567"></a>04567 <span class="preprocessor">#ifdef SUPPORT_USERUSER</span>
<a name="l04568"></a>04568 <span class="preprocessor"></span>                  pri_call_set_useruser(p-&gt;call, useruser);
<a name="l04569"></a>04569 <span class="preprocessor">#endif</span>
<a name="l04570"></a>04570 <span class="preprocessor"></span>
<a name="l04571"></a>04571                   pri_hangup(p-&gt;pri-&gt;pri, p-&gt;call, -1);
<a name="l04572"></a>04572                   p-&gt;call = NULL;
<a name="l04573"></a>04573                   <span class="keywordflow">if</span> (p-&gt;bearer)
<a name="l04574"></a>04574                      p-&gt;bearer-&gt;call = NULL;
<a name="l04575"></a>04575                } <span class="keywordflow">else</span> {
<a name="l04576"></a>04576                   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a> = <a class="code" href="pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b" title="Return a pointer to the value of the corresponding channel variable.">pbx_builtin_getvar_helper</a>(ast,<span class="stringliteral">&quot;PRI_CAUSE&quot;</span>);
<a name="l04577"></a>04577                   <span class="keywordtype">int</span> icause = ast-&gt;<a class="code" href="structast__channel.html#aa4261b664d6712ba8551bde24ad17382">hangupcause</a> ? ast-&gt;<a class="code" href="structast__channel.html#aa4261b664d6712ba8551bde24ad17382">hangupcause</a> : -1;
<a name="l04578"></a>04578                   <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Not yet hungup...  Calling hangup once with icause, and clearing call\n&quot;</span>);
<a name="l04579"></a>04579 
<a name="l04580"></a>04580 <span class="preprocessor">#ifdef SUPPORT_USERUSER</span>
<a name="l04581"></a>04581 <span class="preprocessor"></span>                  pri_call_set_useruser(p-&gt;call, useruser);
<a name="l04582"></a>04582 <span class="preprocessor">#endif</span>
<a name="l04583"></a>04583 <span class="preprocessor"></span>
<a name="l04584"></a>04584                   p-&gt;alreadyhungup = 1;
<a name="l04585"></a>04585                   <span class="keywordflow">if</span> (p-&gt;bearer)
<a name="l04586"></a>04586                      p-&gt;bearer-&gt;alreadyhungup = 1;
<a name="l04587"></a>04587                   <span class="keywordflow">if</span> (cause) {
<a name="l04588"></a>04588                      <span class="keywordflow">if</span> (atoi(cause))
<a name="l04589"></a>04589                         icause = atoi(cause);
<a name="l04590"></a>04590                   }
<a name="l04591"></a>04591                   pri_hangup(p-&gt;pri-&gt;pri, p-&gt;call, icause);
<a name="l04592"></a>04592                }
<a name="l04593"></a>04593                <span class="keywordflow">if</span> (res &lt; 0)
<a name="l04594"></a>04594                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;pri_disconnect failed\n&quot;</span>);
<a name="l04595"></a>04595                pri_rel(p-&gt;pri);
<a name="l04596"></a>04596             } <span class="keywordflow">else</span> {
<a name="l04597"></a>04597                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to grab PRI on span %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#a63fc22149930803b4e3fb4c453177e5e">span</a>);
<a name="l04598"></a>04598                res = -1;
<a name="l04599"></a>04599             }
<a name="l04600"></a>04600          } <span class="keywordflow">else</span> {
<a name="l04601"></a>04601             <span class="keywordflow">if</span> (p-&gt;bearer)
<a name="l04602"></a>04602                <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Bearer call is %p, while ours is still %p\n&quot;</span>, p-&gt;bearer-&gt;call, p-&gt;call);
<a name="l04603"></a>04603             p-&gt;call = NULL;
<a name="l04604"></a>04604             res = 0;
<a name="l04605"></a>04605          }
<a name="l04606"></a>04606       }
<a name="l04607"></a>04607 <span class="preprocessor">#endif</span>
<a name="l04608"></a>04608 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> &amp;&amp; ((p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> != <a class="code" href="chan__dahdi_8c.html#ae9ab0c9508fca045a06730533be276a5">SIG_PRI</a>) &amp;&amp; (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> != <a class="code" href="chan__dahdi_8c.html#aadcda889db3cf9dfe757dbc1d4d8311a">SIG_SS7</a>)
<a name="l04609"></a>04609          &amp;&amp; (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> != <a class="code" href="chan__dahdi_8c.html#ab5bfeaf991c23c5b6510ace44ae79ce9">SIG_BRI</a>)
<a name="l04610"></a>04610          &amp;&amp; (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> != <a class="code" href="chan__dahdi_8c.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a>))
<a name="l04611"></a>04611          &amp;&amp; (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> != <a class="code" href="chan__dahdi_8c.html#a1d73a98ae12601287580dedd9a6d739b">SIG_MFCR2</a>))
<a name="l04612"></a>04612          res = <a class="code" href="chan__dahdi_8c.html#a7c65e6943db828524ea6c9215b8bf696">dahdi_set_hook</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_ONHOOK);
<a name="l04613"></a>04613       <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l04614"></a>04614          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to hangup line %s\n&quot;</span>, ast-&gt;name);
<a name="l04615"></a>04615       }
<a name="l04616"></a>04616       <span class="keywordflow">switch</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a>) {
<a name="l04617"></a>04617       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a3dcffbaf4a26f2b7b792998df1eea27b">SIG_FXOGS</a>:
<a name="l04618"></a>04618       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#adb40571aa5ff846fc334be5260eab257">SIG_FXOLS</a>:
<a name="l04619"></a>04619       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a7c9b3bb8225896ff2b9aed27e6f80f10">SIG_FXOKS</a>:
<a name="l04620"></a>04620          memset(&amp;par, 0, <span class="keyword">sizeof</span>(par));
<a name="l04621"></a>04621          res = ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_GET_PARAMS, &amp;par);
<a name="l04622"></a>04622          <span class="keywordflow">if</span> (!res) {
<a name="l04623"></a>04623 <span class="preprocessor">#if 0</span>
<a name="l04624"></a>04624 <span class="preprocessor"></span>            <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Hanging up channel %d, offhook = %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, par.rxisoffhook);
<a name="l04625"></a>04625 <span class="preprocessor">#endif</span>
<a name="l04626"></a>04626 <span class="preprocessor"></span>            <span class="comment">/* If they&apos;re off hook, try playing congestion */</span>
<a name="l04627"></a>04627             <span class="keywordflow">if</span> ((par.rxisoffhook) &amp;&amp; (!(p-&gt;<a class="code" href="structdahdi__pvt.html#ac53b42243ee40edc74b615fe86806fe3" title="Nonzero if the signaling type is sent over a radio.">radio</a> || (p-&gt;<a class="code" href="structdahdi__pvt.html#a3b3cefe7a33d0cff61f3a2b5955b6c8b">oprmode</a> &lt; 0))))
<a name="l04628"></a>04628                tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_CONGESTION);
<a name="l04629"></a>04629             <span class="keywordflow">else</span>
<a name="l04630"></a>04630                tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, -1);
<a name="l04631"></a>04631             p-&gt;<a class="code" href="structdahdi__pvt.html#ab18fd594a2af8725e3ddb868d8499e06" title="TRUE if the FXS port is off-hook.">fxsoffhookstate</a> = par.rxisoffhook;
<a name="l04632"></a>04632          }
<a name="l04633"></a>04633          <span class="keywordflow">break</span>;
<a name="l04634"></a>04634       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a97e4c6fb4680984aafc6e0e55a2b6cb4">SIG_FXSGS</a>:
<a name="l04635"></a>04635       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a1dc50a07aef86c90ab94f1583c35a265">SIG_FXSLS</a>:
<a name="l04636"></a>04636       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a38139ec369c0243f4324eb4eb0c2f004">SIG_FXSKS</a>:
<a name="l04637"></a>04637          <span class="comment">/* Make sure we&apos;re not made available for at least two seconds assuming</span>
<a name="l04638"></a>04638 <span class="comment">            we were actually used for an inbound or outbound call. */</span>
<a name="l04639"></a>04639          <span class="keywordflow">if</span> (ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660addb60fd97b55a4aea24f992e30fe3c84">AST_STATE_RESERVED</a>) {
<a name="l04640"></a>04640             time(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a7a65a90f21ccf71e78b99dceb614afa9">guardtime</a>);
<a name="l04641"></a>04641             p-&gt;<a class="code" href="structdahdi__pvt.html#a7a65a90f21ccf71e78b99dceb614afa9">guardtime</a> += 2;
<a name="l04642"></a>04642          }
<a name="l04643"></a>04643          <span class="keywordflow">break</span>;
<a name="l04644"></a>04644       <span class="keywordflow">default</span>:
<a name="l04645"></a>04645          tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, -1);
<a name="l04646"></a>04646       }
<a name="l04647"></a>04647       <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a>)
<a name="l04648"></a>04648          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a>);
<a name="l04649"></a>04649       <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a>)
<a name="l04650"></a>04650          <a class="code" href="chan__dahdi_8c.html#a5ceb6fd5bd012740d50b04e84fb29be4">dahdi_disable_ec</a>(p);
<a name="l04651"></a>04651       x = 0;
<a name="l04652"></a>04652       <a class="code" href="channel_8h.html#adcfd8d241b6de48068ead143ac29978d" title="Sets an option on a channel.">ast_channel_setoption</a>(ast,<a class="code" href="frame_8h.html#a31312f6b6c2296e3495ad1d9e198cbf4">AST_OPTION_TONE_VERIFY</a>,&amp;x,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>),0);
<a name="l04653"></a>04653       <a class="code" href="channel_8h.html#adcfd8d241b6de48068ead143ac29978d" title="Sets an option on a channel.">ast_channel_setoption</a>(ast,<a class="code" href="frame_8h.html#aa27da183a0551e3f9497a8064e24b0b6">AST_OPTION_TDD</a>,&amp;x,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>),0);
<a name="l04654"></a>04654       p-&gt;<a class="code" href="structdahdi__pvt.html#aa28ac1bb597b0510dd06d72ac1a30c10">didtdd</a> = 0;
<a name="l04655"></a>04655       p-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a> = NULL;
<a name="l04656"></a>04656       p-&gt;<a class="code" href="structdahdi__pvt.html#a7a4e9b0410dd0636d8f10df9ff51e0a3" title="BOOLEAN. XXX Meaning what??">callwaitcas</a> = 0;
<a name="l04657"></a>04657       p-&gt;<a class="code" href="structdahdi__pvt.html#a76742560de0554db5b0b59591ba93adc" title="TRUE if busy extensions will hear the call-waiting tone and can use hook-flash to...">callwaiting</a> = p-&gt;<a class="code" href="structdahdi__pvt.html#a0d390f8ec30c29d45eff19e375ed5763" title="TRUE if busy extensions will hear the call-waiting tone and can use hook-flash to...">permcallwaiting</a>;
<a name="l04658"></a>04658       p-&gt;<a class="code" href="structdahdi__pvt.html#a8c5bb01611cd9890c062782fa0366459" title="TRUE if the outgoing caller ID is blocked/hidden.">hidecallerid</a> = p-&gt;<a class="code" href="structdahdi__pvt.html#a34eea482c8faa3e04316f786877fe6ae" title="TRUE if the outgoing caller ID is blocked/restricted/hidden.">permhidecallerid</a>;
<a name="l04659"></a>04659       p-&gt;<a class="code" href="structdahdi__pvt.html#ab9aab7a638e67037d3b01f381ed4beae">waitingfordt</a>.tv_sec = 0;
<a name="l04660"></a>04660       p-&gt;<a class="code" href="structdahdi__pvt.html#af17335c0c7a4c1e03e987a33f6eec81b" title="TRUE if in the process of dialing digits or sending something.">dialing</a> = 0;
<a name="l04661"></a>04661       p-&gt;<a class="code" href="structdahdi__pvt.html#a93abdcdde8e3c987c4573427a10b2727" title="Redirecting Directory Number Information Service (RDNIS) number.">rdnis</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l04662"></a>04662       <a class="code" href="chan__dahdi_8c.html#ac56c05fde8bc30c71af46502e97fae3b">update_conf</a>(p);
<a name="l04663"></a>04663       <a class="code" href="chan__dahdi_8c.html#a1938310c1b6ab72fec5619a2ed69c92d">reset_conf</a>(p);
<a name="l04664"></a>04664       <span class="comment">/* Restore data mode */</span>
<a name="l04665"></a>04665       <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#ae9ab0c9508fca045a06730533be276a5">SIG_PRI</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#aadcda889db3cf9dfe757dbc1d4d8311a">SIG_SS7</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#ab5bfeaf991c23c5b6510ace44ae79ce9">SIG_BRI</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a>)) {
<a name="l04666"></a>04666          x = 0;
<a name="l04667"></a>04667          <a class="code" href="channel_8h.html#adcfd8d241b6de48068ead143ac29978d" title="Sets an option on a channel.">ast_channel_setoption</a>(ast,<a class="code" href="frame_8h.html#aee98973da4263b45bacb162534a66cfc">AST_OPTION_AUDIO_MODE</a>,&amp;x,<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>),0);
<a name="l04668"></a>04668       }
<a name="l04669"></a>04669 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l04670"></a>04670 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (p-&gt;bearer) {
<a name="l04671"></a>04671          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Freeing up bearer channel %d\n&quot;</span>, p-&gt;bearer-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l04672"></a>04672          <span class="comment">/* Free up the bearer channel as well, and</span>
<a name="l04673"></a>04673 <span class="comment">            don&apos;t use its file descriptor anymore */</span>
<a name="l04674"></a>04674          <a class="code" href="chan__dahdi_8c.html#ac56c05fde8bc30c71af46502e97fae3b">update_conf</a>(p-&gt;bearer);
<a name="l04675"></a>04675          <a class="code" href="chan__dahdi_8c.html#a1938310c1b6ab72fec5619a2ed69c92d">reset_conf</a>(p-&gt;bearer);
<a name="l04676"></a>04676          p-&gt;bearer-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = NULL;
<a name="l04677"></a>04677          p-&gt;bearer-&gt;realcall = NULL;
<a name="l04678"></a>04678          p-&gt;bearer = NULL;
<a name="l04679"></a>04679          p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a> = -1;
<a name="l04680"></a>04680          p-&gt;pri = NULL;
<a name="l04681"></a>04681       }
<a name="l04682"></a>04682 <span class="preprocessor">#endif</span>
<a name="l04683"></a>04683 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#a4e11ab7baf933c0b5151114a755704a5">num_restart_pending</a> == 0)
<a name="l04684"></a>04684          <a class="code" href="chan__dahdi_8c.html#a83af94bb19a421cb25ca02d16fa5ba9c">restart_monitor</a>();
<a name="l04685"></a>04685    }
<a name="l04686"></a>04686 
<a name="l04687"></a>04687    p-&gt;<a class="code" href="structdahdi__pvt.html#acb6666d113ea3605f76a45fe3e90e192">callwaitingrepeat</a> = 0;
<a name="l04688"></a>04688    p-&gt;<a class="code" href="structdahdi__pvt.html#ac8c4841c7cad35c09ddbd28ede1c4cfe">cidcwexpire</a> = 0;
<a name="l04689"></a>04689    p-&gt;<a class="code" href="structdahdi__pvt.html#a3b3cefe7a33d0cff61f3a2b5955b6c8b">oprmode</a> = 0;
<a name="l04690"></a>04690    ast-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a> = NULL;
<a name="l04691"></a>04691    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l04692"></a>04692    <a class="code" href="module_8h.html#ac65fa15b16dbc563a2424af744ab003d">ast_module_unref</a>(<a class="code" href="structast__module__info.html">ast_module_info</a>-&gt;self);
<a name="l04693"></a>04693    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Hungup &apos;%s&apos;\n&quot;</span>, ast-&gt;name);
<a name="l04694"></a>04694 
<a name="l04695"></a>04695    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;iflock);
<a name="l04696"></a>04696 
<a name="l04697"></a>04697    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a3e7bd1a358a0b3d915ed7ce256c71a8c">restartpending</a>) {
<a name="l04698"></a>04698       <a class="code" href="chan__dahdi_8c.html#a4e11ab7baf933c0b5151114a755704a5">num_restart_pending</a>--;
<a name="l04699"></a>04699    }
<a name="l04700"></a>04700 
<a name="l04701"></a>04701    tmp = <a class="code" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>;
<a name="l04702"></a>04702    prev = NULL;
<a name="l04703"></a>04703    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#ab16498ae4f96c29649dd52ac032e811d" title="TRUE if the channel is to be destroyed on hangup. (Used by pseudo channels.).">destroy</a>) {
<a name="l04704"></a>04704       <span class="keywordflow">while</span> (tmp) {
<a name="l04705"></a>04705          <span class="keywordflow">if</span> (tmp == p) {
<a name="l04706"></a>04706             <a class="code" href="chan__dahdi_8c.html#a707746b49a41e00df8477523111cb7f3">destroy_channel</a>(prev, tmp, 0);
<a name="l04707"></a>04707             <span class="keywordflow">break</span>;
<a name="l04708"></a>04708          } <span class="keywordflow">else</span> {
<a name="l04709"></a>04709             prev = tmp;
<a name="l04710"></a>04710             tmp = tmp-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>;
<a name="l04711"></a>04711          }
<a name="l04712"></a>04712       }
<a name="l04713"></a>04713    }
<a name="l04714"></a>04714    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;iflock);
<a name="l04715"></a>04715    <span class="keywordflow">return</span> 0;
<a name="l04716"></a>04716 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a13b021264eae31a56c08744c179bff2f"></a><!-- doxytag: member="chan_dahdi.c::dahdi_indicate" ref="a13b021264eae31a56c08744c179bff2f" args="(struct ast_channel *chan, int condition, const void *data, size_t datalen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int dahdi_indicate </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>condition</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>datalen</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l07170">7170</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00462">ast_channel::_softhangup</a>, <a class="el" href="channel_8h_source.html#l00469">ast_channel::_state</a>, <a class="el" href="causes_8h_source.html#l00151">AST_CAUSE_CONGESTION</a>, <a class="el" href="causes_8h_source.html#l00117">AST_CAUSE_SWITCH_CONGESTION</a>, <a class="el" href="causes_8h_source.html#l00103">AST_CAUSE_USER_BUSY</a>, <a class="el" href="frame_8h_source.html#l00302">AST_CONTROL_BUSY</a>, <a class="el" href="frame_8h_source.html#l00305">AST_CONTROL_CONGESTION</a>, <a class="el" href="frame_8h_source.html#l00306">AST_CONTROL_FLASH</a>, <a class="el" href="frame_8h_source.html#l00313">AST_CONTROL_HOLD</a>, <a class="el" href="frame_8h_source.html#l00312">AST_CONTROL_PROCEEDING</a>, <a class="el" href="frame_8h_source.html#l00311">AST_CONTROL_PROGRESS</a>, <a class="el" href="frame_8h_source.html#l00309">AST_CONTROL_RADIO_KEY</a>, <a class="el" href="frame_8h_source.html#l00310">AST_CONTROL_RADIO_UNKEY</a>, <a class="el" href="frame_8h_source.html#l00300">AST_CONTROL_RINGING</a>, <a class="el" href="frame_8h_source.html#l00317">AST_CONTROL_SRCUPDATE</a>, <a class="el" href="frame_8h_source.html#l00314">AST_CONTROL_UNHOLD</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8c_source.html#l05538">ast_moh_start()</a>, <a class="el" href="channel_8c_source.html#l05549">ast_moh_stop()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="channel_8c_source.html#l04695">ast_setstate()</a>, <a class="el" href="channel_8h_source.html#l00633">AST_SOFTHANGUP_DEV</a>, <a class="el" href="channel_8h_source.html#l00363">AST_STATE_RING</a>, <a class="el" href="channel_8h_source.html#l00364">AST_STATE_RINGING</a>, <a class="el" href="channel_8h_source.html#l00365">AST_STATE_UP</a>, <a class="el" href="chan__dahdi_8c_source.html#l02660">dahdi_enable_ec()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01503">dahdi_get_index()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02863">dahdi_set_hook()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="chan__dahdi_8c_source.html#l00745">dahdi_pvt::dialing</a>, <a class="el" href="chan__dahdi_8c_source.html#l00747">dahdi_pvt::digital</a>, <a class="el" href="chan__dahdi_8c_source.html#l01116">dahdi_pvt::dop</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="channel_8h_source.html#l00479">ast_channel::hangupcause</a>, <a class="el" href="chan__dahdi_8c_source.html#l01497">ISTRUNK</a>, <a class="el" href="chan__dahdi_8c_source.html#l00649">dahdi_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__dahdi_8c_source.html#l00983">dahdi_pvt::mohinterpret</a>, <a class="el" href="chan__dahdi_8c_source.html#l00801">dahdi_pvt::outgoing</a>, <a class="el" href="chan__dahdi_8c_source.html#l00818">dahdi_pvt::priindication_oob</a>, <a class="el" href="chan__dahdi_8c_source.html#l00671">dahdi_pvt::radio</a>, <a class="el" href="chan__dahdi_8c_source.html#l00666">dahdi_pvt::sig</a>, <a class="el" href="chan__dahdi_8c_source.html#l00256">SIG_BRI</a>, <a class="el" href="chan__dahdi_8c_source.html#l00257">SIG_BRI_PTMP</a>, <a class="el" href="chan__dahdi_8c_source.html#l00250">SIG_FXSGS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00251">SIG_FXSKS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00249">SIG_FXSLS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00255">SIG_PRI</a>, <a class="el" href="chan__dahdi_8c_source.html#l00258">SIG_SS7</a>, <a class="el" href="chan__dahdi_8c_source.html#l01042">dahdi_pvt::span</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>, and <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l05448">dahdi_fixup()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l07171"></a>07171 {
<a name="l07172"></a>07172    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *p = chan-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l07173"></a>07173    <span class="keywordtype">int</span> res=-1;
<a name="l07174"></a>07174    <span class="keywordtype">int</span> idx;
<a name="l07175"></a>07175    <span class="keywordtype">int</span> func = DAHDI_FLASH;
<a name="l07176"></a>07176    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l07177"></a>07177    idx = <a class="code" href="chan__dahdi_8c.html#a62c8e3f411fb9e5ec62a1e77c152c2df">dahdi_get_index</a>(chan, p, 0);
<a name="l07178"></a>07178    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Requested indication %d on channel %s\n&quot;</span>, condition, chan-&gt;name);
<a name="l07179"></a>07179 <span class="preprocessor">#ifdef HAVE_OPENR2</span>
<a name="l07180"></a>07180 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (p-&gt;mfcr2 &amp;&amp; !p-&gt;mfcr2_call_accepted) {
<a name="l07181"></a>07181       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l07182"></a>07182       <span class="comment">/* if this is an R2 call and the call is not yet accepted, we don&apos;t want the</span>
<a name="l07183"></a>07183 <span class="comment">         tone indications to mess up with the MF tones */</span>
<a name="l07184"></a>07184       <span class="keywordflow">return</span> 0;
<a name="l07185"></a>07185    }
<a name="l07186"></a>07186 <span class="preprocessor">#endif</span>
<a name="l07187"></a>07187 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (idx == <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>) {
<a name="l07188"></a>07188       <span class="keywordflow">switch</span> (condition) {
<a name="l07189"></a>07189       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a387635982df3d2edb669a1eece92c875">AST_CONTROL_BUSY</a>:
<a name="l07190"></a>07190 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l07191"></a>07191 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#ab7d3c3f03d40ad5cea4721e94cb64e40" title="TRUE if PRI congestion/busy indications are sent out-of-band.">priindication_oob</a> &amp;&amp; ((p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#ae9ab0c9508fca045a06730533be276a5">SIG_PRI</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#ab5bfeaf991c23c5b6510ace44ae79ce9">SIG_BRI</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a>))) {
<a name="l07192"></a>07192             chan-&gt;<a class="code" href="structast__channel.html#aa4261b664d6712ba8551bde24ad17382">hangupcause</a> = <a class="code" href="causes_8h.html#aff0e956cb3ef657557fa468a17416c0b">AST_CAUSE_USER_BUSY</a>;
<a name="l07193"></a>07193             chan-&gt;<a class="code" href="structast__channel.html#a7386ba9cc89b0b446f553a4d0f36576a">_softhangup</a> |= <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709a2e185ce313026e13ed90ae3a319c9cb7">AST_SOFTHANGUP_DEV</a>;
<a name="l07194"></a>07194             res = 0;
<a name="l07195"></a>07195          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!p-&gt;progress &amp;&amp;
<a name="l07196"></a>07196                ((p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#ae9ab0c9508fca045a06730533be276a5">SIG_PRI</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#ab5bfeaf991c23c5b6510ace44ae79ce9">SIG_BRI</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a>))
<a name="l07197"></a>07197                &amp;&amp; p-&gt;pri &amp;&amp; !p-&gt;<a class="code" href="structdahdi__pvt.html#a40668dcb7d940b80c4f109861059a978" title="TRUE if we originated the call leg.">outgoing</a>) {
<a name="l07198"></a>07198             <span class="keywordflow">if</span> (p-&gt;pri-&gt;pri) {
<a name="l07199"></a>07199                <span class="keywordflow">if</span> (!pri_grab(p, p-&gt;pri)) {
<a name="l07200"></a>07200 <span class="preprocessor">#ifdef HAVE_PRI_PROG_W_CAUSE</span>
<a name="l07201"></a>07201 <span class="preprocessor"></span>                  pri_progress_with_cause(p-&gt;pri-&gt;pri,p-&gt;call, PVT_TO_CHANNEL(p), 1, PRI_CAUSE_USER_BUSY); <span class="comment">/* cause = 17 */</span>
<a name="l07202"></a>07202 <span class="preprocessor">#else</span>
<a name="l07203"></a>07203 <span class="preprocessor"></span>                  pri_progress(p-&gt;pri-&gt;pri,p-&gt;call, PVT_TO_CHANNEL(p), 1);
<a name="l07204"></a>07204 <span class="preprocessor">#endif</span>
<a name="l07205"></a>07205 <span class="preprocessor"></span>                  pri_rel(p-&gt;pri);
<a name="l07206"></a>07206                }
<a name="l07207"></a>07207                <span class="keywordflow">else</span>
<a name="l07208"></a>07208                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to grab PRI on span %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#a63fc22149930803b4e3fb4c453177e5e">span</a>);
<a name="l07209"></a>07209             }
<a name="l07210"></a>07210             p-&gt;progress = 1;
<a name="l07211"></a>07211             res = tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_BUSY);
<a name="l07212"></a>07212          } <span class="keywordflow">else</span>
<a name="l07213"></a>07213 <span class="preprocessor">#endif</span>
<a name="l07214"></a>07214 <span class="preprocessor"></span>            res = tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_BUSY);
<a name="l07215"></a>07215          <span class="keywordflow">break</span>;
<a name="l07216"></a>07216       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa5814e690c23b590bcd4eb43535907a1">AST_CONTROL_RINGING</a>:
<a name="l07217"></a>07217 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l07218"></a>07218 <span class="preprocessor"></span>         <span class="keywordflow">if</span> ((!p-&gt;alerting) &amp;&amp; ((p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#ae9ab0c9508fca045a06730533be276a5">SIG_PRI</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#ab5bfeaf991c23c5b6510ace44ae79ce9">SIG_BRI</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a>))
<a name="l07219"></a>07219                &amp;&amp; p-&gt;pri &amp;&amp; !p-&gt;<a class="code" href="structdahdi__pvt.html#a40668dcb7d940b80c4f109861059a978" title="TRUE if we originated the call leg.">outgoing</a> &amp;&amp; (chan-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>)) {
<a name="l07220"></a>07220             <span class="keywordflow">if</span> (p-&gt;pri-&gt;pri) {
<a name="l07221"></a>07221                <span class="keywordflow">if</span> (!pri_grab(p, p-&gt;pri)) {
<a name="l07222"></a>07222                   pri_acknowledge(p-&gt;pri-&gt;pri,p-&gt;call, PVT_TO_CHANNEL(p), !p-&gt;<a class="code" href="structdahdi__pvt.html#adf54768a4327f86de3a234648305c4a4" title="TRUE if the transfer capability of the call is digital.">digital</a>);
<a name="l07223"></a>07223                   pri_rel(p-&gt;pri);
<a name="l07224"></a>07224                }
<a name="l07225"></a>07225                <span class="keywordflow">else</span>
<a name="l07226"></a>07226                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to grab PRI on span %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#a63fc22149930803b4e3fb4c453177e5e">span</a>);
<a name="l07227"></a>07227             }
<a name="l07228"></a>07228             p-&gt;alerting = 1;
<a name="l07229"></a>07229          }
<a name="l07230"></a>07230 
<a name="l07231"></a>07231 <span class="preprocessor">#endif</span>
<a name="l07232"></a>07232 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_SS7</span>
<a name="l07233"></a>07233 <span class="preprocessor"></span>         <span class="keywordflow">if</span> ((!p-&gt;alerting) &amp;&amp; (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#aadcda889db3cf9dfe757dbc1d4d8311a">SIG_SS7</a>) &amp;&amp; p-&gt;ss7 &amp;&amp; !p-&gt;<a class="code" href="structdahdi__pvt.html#a40668dcb7d940b80c4f109861059a978" title="TRUE if we originated the call leg.">outgoing</a> &amp;&amp; (chan-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>)) {
<a name="l07234"></a>07234             <span class="keywordflow">if</span> (p-&gt;ss7-&gt;ss7) {
<a name="l07235"></a>07235                ss7_grab(p, p-&gt;ss7);
<a name="l07236"></a>07236 
<a name="l07237"></a>07237                <span class="keywordflow">if</span> ((isup_far(p-&gt;ss7-&gt;ss7, p-&gt;ss7call)) != -1)
<a name="l07238"></a>07238                   p-&gt;rlt = 1;
<a name="l07239"></a>07239                <span class="keywordflow">if</span> (p-&gt;rlt != 1) <span class="comment">/* No need to send CPG if call will be RELEASE */</span>
<a name="l07240"></a>07240                   isup_cpg(p-&gt;ss7-&gt;ss7, p-&gt;ss7call, CPG_EVENT_ALERTING);
<a name="l07241"></a>07241                p-&gt;alerting = 1;
<a name="l07242"></a>07242                ss7_rel(p-&gt;ss7);
<a name="l07243"></a>07243             }
<a name="l07244"></a>07244          }
<a name="l07245"></a>07245 <span class="preprocessor">#endif</span>
<a name="l07246"></a>07246 <span class="preprocessor"></span>
<a name="l07247"></a>07247          res = tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_RINGTONE);
<a name="l07248"></a>07248 
<a name="l07249"></a>07249          <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>) {
<a name="l07250"></a>07250             <span class="keywordflow">if</span> ((chan-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a>) ||
<a name="l07251"></a>07251                ((p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> != <a class="code" href="chan__dahdi_8c.html#a38139ec369c0243f4324eb4eb0c2f004">SIG_FXSKS</a>) &amp;&amp;
<a name="l07252"></a>07252              (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> != <a class="code" href="chan__dahdi_8c.html#a1dc50a07aef86c90ab94f1583c35a265">SIG_FXSLS</a>) &amp;&amp;
<a name="l07253"></a>07253              (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> != <a class="code" href="chan__dahdi_8c.html#a97e4c6fb4680984aafc6e0e55a2b6cb4">SIG_FXSGS</a>)))
<a name="l07254"></a>07254             <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(chan, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa">AST_STATE_RINGING</a>);
<a name="l07255"></a>07255          }
<a name="l07256"></a>07256          <span class="keywordflow">break</span>;
<a name="l07257"></a>07257       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a50b7fe33bba67b74dd7b746539e81000">AST_CONTROL_PROCEEDING</a>:
<a name="l07258"></a>07258          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1,<span class="stringliteral">&quot;Received AST_CONTROL_PROCEEDING on %s\n&quot;</span>,chan-&gt;name);
<a name="l07259"></a>07259 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l07260"></a>07260 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (!p-&gt;proceeding &amp;&amp; ((p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#ae9ab0c9508fca045a06730533be276a5">SIG_PRI</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#ab5bfeaf991c23c5b6510ace44ae79ce9">SIG_BRI</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a>))
<a name="l07261"></a>07261                &amp;&amp; p-&gt;pri &amp;&amp; !p-&gt;<a class="code" href="structdahdi__pvt.html#a40668dcb7d940b80c4f109861059a978" title="TRUE if we originated the call leg.">outgoing</a>) {
<a name="l07262"></a>07262             <span class="keywordflow">if</span> (p-&gt;pri-&gt;pri) {
<a name="l07263"></a>07263                <span class="keywordflow">if</span> (!pri_grab(p, p-&gt;pri)) {
<a name="l07264"></a>07264                   pri_proceeding(p-&gt;pri-&gt;pri,p-&gt;call, PVT_TO_CHANNEL(p), !p-&gt;<a class="code" href="structdahdi__pvt.html#adf54768a4327f86de3a234648305c4a4" title="TRUE if the transfer capability of the call is digital.">digital</a>);
<a name="l07265"></a>07265                   pri_rel(p-&gt;pri);
<a name="l07266"></a>07266                }
<a name="l07267"></a>07267                <span class="keywordflow">else</span>
<a name="l07268"></a>07268                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to grab PRI on span %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#a63fc22149930803b4e3fb4c453177e5e">span</a>);
<a name="l07269"></a>07269             }
<a name="l07270"></a>07270             p-&gt;proceeding = 1;
<a name="l07271"></a>07271             p-&gt;<a class="code" href="structdahdi__pvt.html#af17335c0c7a4c1e03e987a33f6eec81b" title="TRUE if in the process of dialing digits or sending something.">dialing</a> = 0;
<a name="l07272"></a>07272          }
<a name="l07273"></a>07273 <span class="preprocessor">#endif</span>
<a name="l07274"></a>07274 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_SS7</span>
<a name="l07275"></a>07275 <span class="preprocessor"></span>         <span class="comment">/* This IF sends the FAR for an answered ALEG call */</span>
<a name="l07276"></a>07276          <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a> &amp;&amp; (p-&gt;rlt != 1) &amp;&amp; (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#aadcda889db3cf9dfe757dbc1d4d8311a">SIG_SS7</a>)){
<a name="l07277"></a>07277             <span class="keywordflow">if</span> ((isup_far(p-&gt;ss7-&gt;ss7, p-&gt;ss7call)) != -1)
<a name="l07278"></a>07278                p-&gt;rlt = 1;
<a name="l07279"></a>07279          }
<a name="l07280"></a>07280 
<a name="l07281"></a>07281          <span class="keywordflow">if</span> (!p-&gt;proceeding &amp;&amp; p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#aadcda889db3cf9dfe757dbc1d4d8311a">SIG_SS7</a> &amp;&amp; p-&gt;ss7 &amp;&amp; !p-&gt;<a class="code" href="structdahdi__pvt.html#a40668dcb7d940b80c4f109861059a978" title="TRUE if we originated the call leg.">outgoing</a>) {
<a name="l07282"></a>07282             <span class="keywordflow">if</span> (p-&gt;ss7-&gt;ss7) {
<a name="l07283"></a>07283                ss7_grab(p, p-&gt;ss7);
<a name="l07284"></a>07284                isup_acm(p-&gt;ss7-&gt;ss7, p-&gt;ss7call);
<a name="l07285"></a>07285                p-&gt;proceeding = 1;
<a name="l07286"></a>07286                ss7_rel(p-&gt;ss7);
<a name="l07287"></a>07287 
<a name="l07288"></a>07288             }
<a name="l07289"></a>07289          }
<a name="l07290"></a>07290 <span class="preprocessor">#endif</span>
<a name="l07291"></a>07291 <span class="preprocessor"></span>         <span class="comment">/* don&apos;t continue in ast_indicate */</span>
<a name="l07292"></a>07292          res = 0;
<a name="l07293"></a>07293          <span class="keywordflow">break</span>;
<a name="l07294"></a>07294       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a1a461c5e737ed6ed7c8cb0f78557a6fd">AST_CONTROL_PROGRESS</a>:
<a name="l07295"></a>07295          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1,<span class="stringliteral">&quot;Received AST_CONTROL_PROGRESS on %s\n&quot;</span>,chan-&gt;name);
<a name="l07296"></a>07296 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l07297"></a>07297 <span class="preprocessor"></span>         p-&gt;<a class="code" href="structdahdi__pvt.html#adf54768a4327f86de3a234648305c4a4" title="TRUE if the transfer capability of the call is digital.">digital</a> = 0;   <span class="comment">/* Digital-only calls isn&apos;t allows any inband progress messages */</span>
<a name="l07298"></a>07298          <span class="keywordflow">if</span> (!p-&gt;progress &amp;&amp; ((p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#ae9ab0c9508fca045a06730533be276a5">SIG_PRI</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#ab5bfeaf991c23c5b6510ace44ae79ce9">SIG_BRI</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a>))
<a name="l07299"></a>07299                &amp;&amp; p-&gt;pri &amp;&amp; !p-&gt;<a class="code" href="structdahdi__pvt.html#a40668dcb7d940b80c4f109861059a978" title="TRUE if we originated the call leg.">outgoing</a>) {
<a name="l07300"></a>07300             <span class="keywordflow">if</span> (p-&gt;pri-&gt;pri) {
<a name="l07301"></a>07301                <span class="keywordflow">if</span> (!pri_grab(p, p-&gt;pri)) {
<a name="l07302"></a>07302 <span class="preprocessor">#ifdef HAVE_PRI_PROG_W_CAUSE</span>
<a name="l07303"></a>07303 <span class="preprocessor"></span>                  pri_progress_with_cause(p-&gt;pri-&gt;pri,p-&gt;call, PVT_TO_CHANNEL(p), 1, -1);  <span class="comment">/* no cause at all */</span>
<a name="l07304"></a>07304 <span class="preprocessor">#else</span>
<a name="l07305"></a>07305 <span class="preprocessor"></span>                  pri_progress(p-&gt;pri-&gt;pri,p-&gt;call, PVT_TO_CHANNEL(p), 1);
<a name="l07306"></a>07306 <span class="preprocessor">#endif</span>
<a name="l07307"></a>07307 <span class="preprocessor"></span>                  pri_rel(p-&gt;pri);
<a name="l07308"></a>07308                }
<a name="l07309"></a>07309                <span class="keywordflow">else</span>
<a name="l07310"></a>07310                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to grab PRI on span %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#a63fc22149930803b4e3fb4c453177e5e">span</a>);
<a name="l07311"></a>07311             }
<a name="l07312"></a>07312             p-&gt;progress = 1;
<a name="l07313"></a>07313          }
<a name="l07314"></a>07314 <span class="preprocessor">#endif</span>
<a name="l07315"></a>07315 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_SS7</span>
<a name="l07316"></a>07316 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (!p-&gt;progress &amp;&amp; p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a>==<a class="code" href="chan__dahdi_8c.html#aadcda889db3cf9dfe757dbc1d4d8311a">SIG_SS7</a> &amp;&amp; p-&gt;ss7 &amp;&amp; !p-&gt;<a class="code" href="structdahdi__pvt.html#a40668dcb7d940b80c4f109861059a978" title="TRUE if we originated the call leg.">outgoing</a>) {
<a name="l07317"></a>07317             <span class="keywordflow">if</span> (p-&gt;ss7-&gt;ss7) {
<a name="l07318"></a>07318                ss7_grab(p, p-&gt;ss7);
<a name="l07319"></a>07319                isup_cpg(p-&gt;ss7-&gt;ss7, p-&gt;ss7call, CPG_EVENT_INBANDINFO);
<a name="l07320"></a>07320                p-&gt;progress = 1;
<a name="l07321"></a>07321                ss7_rel(p-&gt;ss7);
<a name="l07322"></a>07322                <span class="comment">/* enable echo canceler here on SS7 calls */</span>
<a name="l07323"></a>07323                <a class="code" href="chan__dahdi_8c.html#a8c34a5bce2b26d056942349217806312">dahdi_enable_ec</a>(p);
<a name="l07324"></a>07324 
<a name="l07325"></a>07325             }
<a name="l07326"></a>07326          }
<a name="l07327"></a>07327 <span class="preprocessor">#endif</span>
<a name="l07328"></a>07328 <span class="preprocessor"></span>         <span class="comment">/* don&apos;t continue in ast_indicate */</span>
<a name="l07329"></a>07329          res = 0;
<a name="l07330"></a>07330          <span class="keywordflow">break</span>;
<a name="l07331"></a>07331       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a850bb06a1702741c93a3fd67cc9637ab">AST_CONTROL_CONGESTION</a>:
<a name="l07332"></a>07332          chan-&gt;<a class="code" href="structast__channel.html#aa4261b664d6712ba8551bde24ad17382">hangupcause</a> = <a class="code" href="causes_8h.html#a0a35518d7b448a53da368cf57f354fba">AST_CAUSE_CONGESTION</a>;
<a name="l07333"></a>07333 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l07334"></a>07334 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#ab7d3c3f03d40ad5cea4721e94cb64e40" title="TRUE if PRI congestion/busy indications are sent out-of-band.">priindication_oob</a> &amp;&amp; ((p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#ae9ab0c9508fca045a06730533be276a5">SIG_PRI</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#ab5bfeaf991c23c5b6510ace44ae79ce9">SIG_BRI</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a>))) {
<a name="l07335"></a>07335             chan-&gt;<a class="code" href="structast__channel.html#aa4261b664d6712ba8551bde24ad17382">hangupcause</a> = <a class="code" href="causes_8h.html#a02b3785262e0be6843e8e9d235d8d78d">AST_CAUSE_SWITCH_CONGESTION</a>;
<a name="l07336"></a>07336             chan-&gt;<a class="code" href="structast__channel.html#a7386ba9cc89b0b446f553a4d0f36576a">_softhangup</a> |= <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709a2e185ce313026e13ed90ae3a319c9cb7">AST_SOFTHANGUP_DEV</a>;
<a name="l07337"></a>07337             res = 0;
<a name="l07338"></a>07338          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!p-&gt;progress &amp;&amp; ((p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#ae9ab0c9508fca045a06730533be276a5">SIG_PRI</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#ab5bfeaf991c23c5b6510ace44ae79ce9">SIG_BRI</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a>))
<a name="l07339"></a>07339                &amp;&amp; p-&gt;pri &amp;&amp; !p-&gt;<a class="code" href="structdahdi__pvt.html#a40668dcb7d940b80c4f109861059a978" title="TRUE if we originated the call leg.">outgoing</a>) {
<a name="l07340"></a>07340             <span class="keywordflow">if</span> (p-&gt;pri) {
<a name="l07341"></a>07341                <span class="keywordflow">if</span> (!pri_grab(p, p-&gt;pri)) {
<a name="l07342"></a>07342 <span class="preprocessor">#ifdef HAVE_PRI_PROG_W_CAUSE</span>
<a name="l07343"></a>07343 <span class="preprocessor"></span>                  pri_progress_with_cause(p-&gt;pri-&gt;pri,p-&gt;call, PVT_TO_CHANNEL(p), 1, PRI_CAUSE_SWITCH_CONGESTION); <span class="comment">/* cause = 42 */</span>
<a name="l07344"></a>07344 <span class="preprocessor">#else</span>
<a name="l07345"></a>07345 <span class="preprocessor"></span>                  pri_progress(p-&gt;pri-&gt;pri,p-&gt;call, PVT_TO_CHANNEL(p), 1);
<a name="l07346"></a>07346 <span class="preprocessor">#endif</span>
<a name="l07347"></a>07347 <span class="preprocessor"></span>                  pri_rel(p-&gt;pri);
<a name="l07348"></a>07348                } <span class="keywordflow">else</span>
<a name="l07349"></a>07349                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to grab PRI on span %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#a63fc22149930803b4e3fb4c453177e5e">span</a>);
<a name="l07350"></a>07350             }
<a name="l07351"></a>07351             p-&gt;progress = 1;
<a name="l07352"></a>07352             res = tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_CONGESTION);
<a name="l07353"></a>07353          } <span class="keywordflow">else</span>
<a name="l07354"></a>07354 <span class="preprocessor">#endif</span>
<a name="l07355"></a>07355 <span class="preprocessor"></span>            res = tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_CONGESTION);
<a name="l07356"></a>07356          <span class="keywordflow">break</span>;
<a name="l07357"></a>07357       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390ab99a3d1c08c5ae8bca078c7cd1ec02f5">AST_CONTROL_HOLD</a>:
<a name="l07358"></a>07358 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l07359"></a>07359 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (p-&gt;pri &amp;&amp; !strcasecmp(p-&gt;<a class="code" href="structdahdi__pvt.html#af689da2b77d1265192a78a5b0994a1d5" title="The configured music-on-hold class to use for calls.">mohinterpret</a>, <span class="stringliteral">&quot;passthrough&quot;</span>)) {
<a name="l07360"></a>07360             <span class="keywordflow">if</span> (!pri_grab(p, p-&gt;pri)) {
<a name="l07361"></a>07361                res = pri_notify(p-&gt;pri-&gt;pri, p-&gt;call, p-&gt;prioffset, PRI_NOTIFY_REMOTE_HOLD);
<a name="l07362"></a>07362                pri_rel(p-&gt;pri);
<a name="l07363"></a>07363             } <span class="keywordflow">else</span>
<a name="l07364"></a>07364                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to grab PRI on span %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#a63fc22149930803b4e3fb4c453177e5e">span</a>);
<a name="l07365"></a>07365          } <span class="keywordflow">else</span>
<a name="l07366"></a>07366 <span class="preprocessor">#endif</span>
<a name="l07367"></a>07367 <span class="preprocessor"></span>            <a class="code" href="musiconhold_8h.html#a2acec01f2fddd8ca494d874003815cf7" title="Turn on music on hold on a given channel.">ast_moh_start</a>(chan, data, p-&gt;<a class="code" href="structdahdi__pvt.html#af689da2b77d1265192a78a5b0994a1d5" title="The configured music-on-hold class to use for calls.">mohinterpret</a>);
<a name="l07368"></a>07368          <span class="keywordflow">break</span>;
<a name="l07369"></a>07369       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a3e7629b5f7e39f1cc8ad2e51e266f91e">AST_CONTROL_UNHOLD</a>:
<a name="l07370"></a>07370 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l07371"></a>07371 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (p-&gt;pri &amp;&amp; !strcasecmp(p-&gt;<a class="code" href="structdahdi__pvt.html#af689da2b77d1265192a78a5b0994a1d5" title="The configured music-on-hold class to use for calls.">mohinterpret</a>, <span class="stringliteral">&quot;passthrough&quot;</span>)) {
<a name="l07372"></a>07372             <span class="keywordflow">if</span> (!pri_grab(p, p-&gt;pri)) {
<a name="l07373"></a>07373                res = pri_notify(p-&gt;pri-&gt;pri, p-&gt;call, p-&gt;prioffset, PRI_NOTIFY_REMOTE_RETRIEVAL);
<a name="l07374"></a>07374                pri_rel(p-&gt;pri);
<a name="l07375"></a>07375             } <span class="keywordflow">else</span>
<a name="l07376"></a>07376                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to grab PRI on span %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#a63fc22149930803b4e3fb4c453177e5e">span</a>);
<a name="l07377"></a>07377          } <span class="keywordflow">else</span>
<a name="l07378"></a>07378 <span class="preprocessor">#endif</span>
<a name="l07379"></a>07379 <span class="preprocessor"></span>            <a class="code" href="musiconhold_8h.html#a52fead32f69533450f3c05b2e6960149" title="Turn off music on hold on a given channel.">ast_moh_stop</a>(chan);
<a name="l07380"></a>07380          <span class="keywordflow">break</span>;
<a name="l07381"></a>07381       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aacb7ddf1a95fa544fdecada68213f3c7">AST_CONTROL_RADIO_KEY</a>:
<a name="l07382"></a>07382          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#ac53b42243ee40edc74b615fe86806fe3" title="Nonzero if the signaling type is sent over a radio.">radio</a>)
<a name="l07383"></a>07383             res = <a class="code" href="chan__dahdi_8c.html#a7c65e6943db828524ea6c9215b8bf696">dahdi_set_hook</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_OFFHOOK);
<a name="l07384"></a>07384          res = 0;
<a name="l07385"></a>07385          <span class="keywordflow">break</span>;
<a name="l07386"></a>07386       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a34ac3ccebc219c59daa7eb0275fcd54d">AST_CONTROL_RADIO_UNKEY</a>:
<a name="l07387"></a>07387          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#ac53b42243ee40edc74b615fe86806fe3" title="Nonzero if the signaling type is sent over a radio.">radio</a>)
<a name="l07388"></a>07388             res = <a class="code" href="chan__dahdi_8c.html#a7c65e6943db828524ea6c9215b8bf696">dahdi_set_hook</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_RINGOFF);
<a name="l07389"></a>07389          res = 0;
<a name="l07390"></a>07390          <span class="keywordflow">break</span>;
<a name="l07391"></a>07391       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390ae8f2cd460fdc81e0a774434fa002e4bf">AST_CONTROL_FLASH</a>:
<a name="l07392"></a>07392          <span class="comment">/* flash hookswitch */</span>
<a name="l07393"></a>07393          <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#aaba53263d23f0d5fc75b177b9adfc851">ISTRUNK</a>(p) &amp;&amp; (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> != <a class="code" href="chan__dahdi_8c.html#ae9ab0c9508fca045a06730533be276a5">SIG_PRI</a>)) {
<a name="l07394"></a>07394             <span class="comment">/* Clear out the dial buffer */</span>
<a name="l07395"></a>07395             p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l07396"></a>07396             <span class="keywordflow">if</span> ((ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>,DAHDI_HOOK,&amp;func) == -1) &amp;&amp; (errno != EINPROGRESS)) {
<a name="l07397"></a>07397                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to flash external trunk on channel %s: %s\n&quot;</span>,
<a name="l07398"></a>07398                   chan-&gt;name, strerror(errno));
<a name="l07399"></a>07399             } <span class="keywordflow">else</span>
<a name="l07400"></a>07400                res = 0;
<a name="l07401"></a>07401          } <span class="keywordflow">else</span>
<a name="l07402"></a>07402             res = 0;
<a name="l07403"></a>07403          <span class="keywordflow">break</span>;
<a name="l07404"></a>07404       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a009e81151b19671f42b5e84ab6a619f4">AST_CONTROL_SRCUPDATE</a>:
<a name="l07405"></a>07405          res = 0;
<a name="l07406"></a>07406          <span class="keywordflow">break</span>;
<a name="l07407"></a>07407       <span class="keywordflow">case</span> -1:
<a name="l07408"></a>07408          res = tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, -1);
<a name="l07409"></a>07409          <span class="keywordflow">break</span>;
<a name="l07410"></a>07410       }
<a name="l07411"></a>07411    } <span class="keywordflow">else</span>
<a name="l07412"></a>07412       res = 0;
<a name="l07413"></a>07413    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l07414"></a>07414    <span class="keywordflow">return</span> res;
<a name="l07415"></a>07415 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8682ce9e42deed43c941fd7cae5ff30b"></a><!-- doxytag: member="chan_dahdi.c::dahdi_link" ref="a8682ce9e42deed43c941fd7cae5ff30b" args="(struct dahdi_pvt *slave, struct dahdi_pvt *master)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void dahdi_link </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>slave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>master</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l05100">5100</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__dahdi_8c_source.html#l00658">dahdi_pvt::master</a>, <a class="el" href="chan__dahdi_8c_source.html#l00628">MAX_SLAVES</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00657">dahdi_pvt::slaves</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l05156">dahdi_bridge()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05100"></a>05100                                                                           {
<a name="l05101"></a>05101    <span class="keywordtype">int</span> x;
<a name="l05102"></a>05102    <span class="keywordflow">if</span> (!slave || !master) {
<a name="l05103"></a>05103       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Tried to link to/from NULL??\n&quot;</span>);
<a name="l05104"></a>05104       <span class="keywordflow">return</span>;
<a name="l05105"></a>05105    }
<a name="l05106"></a>05106    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="chan__dahdi_8c.html#a2a3c5190bdbe2a4780a460383970aa92">MAX_SLAVES</a>; x++) {
<a name="l05107"></a>05107       <span class="keywordflow">if</span> (!master-&gt;<a class="code" href="structdahdi__pvt.html#aa607a8a226852c168c96a4d0f3001c88">slaves</a>[x]) {
<a name="l05108"></a>05108          master-&gt;<a class="code" href="structdahdi__pvt.html#aa607a8a226852c168c96a4d0f3001c88">slaves</a>[x] = slave;
<a name="l05109"></a>05109          <span class="keywordflow">break</span>;
<a name="l05110"></a>05110       }
<a name="l05111"></a>05111    }
<a name="l05112"></a>05112    <span class="keywordflow">if</span> (x &gt;= MAX_SLAVES) {
<a name="l05113"></a>05113       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Replacing slave %d with new slave, %d\n&quot;</span>, master-&gt;<a class="code" href="structdahdi__pvt.html#aa607a8a226852c168c96a4d0f3001c88">slaves</a>[MAX_SLAVES - 1]-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, slave-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l05114"></a>05114       master-&gt;<a class="code" href="structdahdi__pvt.html#aa607a8a226852c168c96a4d0f3001c88">slaves</a>[MAX_SLAVES - 1] = slave;
<a name="l05115"></a>05115    }
<a name="l05116"></a>05116    <span class="keywordflow">if</span> (slave-&gt;<a class="code" href="structdahdi__pvt.html#a3e30e79b4679785034d55aff6a17e41b">master</a>)
<a name="l05117"></a>05117       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Replacing master %d with new master, %d\n&quot;</span>, slave-&gt;<a class="code" href="structdahdi__pvt.html#a3e30e79b4679785034d55aff6a17e41b">master</a>-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, master-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l05118"></a>05118    slave-&gt;<a class="code" href="structdahdi__pvt.html#a3e30e79b4679785034d55aff6a17e41b">master</a> = master;
<a name="l05119"></a>05119 
<a name="l05120"></a>05120    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Making %d slave to master %d at %d\n&quot;</span>, slave-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, master-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, x);
<a name="l05121"></a>05121 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab3f00769ae6c995b4f5f3934d8c805f6"></a><!-- doxytag: member="chan_dahdi.c::dahdi_new" ref="ab3f00769ae6c995b4f5f3934d8c805f6" args="(struct dahdi_pvt *, int, int, int, int, int)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__channel.html">ast_channel</a> * dahdi_new </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>startpbx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>law</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>transfercapability</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l07417">7417</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="chan__iax2_8c_source.html#l00328">accountcode</a>, <a class="el" href="chan__dahdi_8c_source.html#l01120">dahdi_pvt::accountcode</a>, <a class="el" href="chan__dahdi_8c_source.html#l00691">dahdi_pvt::adsi</a>, <a class="el" href="channel_8h_source.html#l00474">ast_channel::adsicpe</a>, <a class="el" href="channel_8h_source.html#l00473">ast_channel::amaflags</a>, <a class="el" href="chan__dahdi_8c_source.html#l01121">dahdi_pvt::amaflags</a>, <a class="el" href="channel_8h_source.html#l00348">AST_ADSI_UNAVAILABLE</a>, <a class="el" href="channel_8h_source.html#l00730">ast_channel_alloc</a>, <a class="el" href="channel_8c_source.html#l01576">ast_channel_set_fd()</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="devicestate_8c_source.html#l00465">ast_devstate_changed_literal()</a>, <a class="el" href="dsp_8c_source.html#l01519">ast_dsp_new()</a>, <a class="el" href="dsp_8c_source.html#l01565">ast_dsp_set_busy_count()</a>, <a class="el" href="dsp_8c_source.html#l01576">ast_dsp_set_busy_pattern()</a>, <a class="el" href="dsp_8c_source.html#l01652">ast_dsp_set_call_progress_zone()</a>, <a class="el" href="dsp_8c_source.html#l01628">ast_dsp_set_digitmode()</a>, <a class="el" href="dsp_8c_source.html#l01540">ast_dsp_set_features()</a>, <a class="el" href="frame_8h_source.html#l00247">AST_FORMAT_ALAW</a>, <a class="el" href="frame_8h_source.html#l00245">AST_FORMAT_ULAW</a>, <a class="el" href="channel_8c_source.html#l01690">ast_hangup()</a>, <a class="el" href="abstract__jb_8c_source.html#l00610">ast_jb_configure()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="loader_8c_source.html#l01163">ast_module_ref()</a>, <a class="el" href="pbx_8c_source.html#l04559">ast_pbx_start()</a>, <a class="el" href="utils_8c_source.html#l01401">ast_random()</a>, <a class="el" href="devicestate_8c_source.html#l00220">ast_state_chan2dev()</a>, <a class="el" href="channel_8h_source.html#l00363">AST_STATE_RING</a>, <a class="el" href="strings_8h_source.html#l00576">ast_str_alloca</a>, <a class="el" href="strings_8h_source.html#l00488">ast_str_buffer()</a>, <a class="el" href="strings_8h_source.html#l00825">ast_str_set()</a>, <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="stringfields_8h_source.html#l00285">ast_string_field_set</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="transcap_8h_source.html#l00035">AST_TRANS_CAP_DIGITAL</a>, <a class="el" href="channel_8c_source.html#l00690">ast_transfercapability2str()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01099">dahdi_pvt::busy_quietlength</a>, <a class="el" href="chan__dahdi_8c_source.html#l01094">dahdi_pvt::busy_tonelength</a>, <a class="el" href="chan__dahdi_8c_source.html#l01089">dahdi_pvt::busycount</a>, <a class="el" href="chan__dahdi_8c_source.html#l00703">dahdi_pvt::busydetect</a>, <a class="el" href="chan__dahdi_8c_source.html#l01124">dahdi_pvt::call_forward</a>, <a class="el" href="chan__dahdi_8c_source.html#l01030">dahdi_pvt::callgroup</a>, <a class="el" href="channel_8h_source.html#l00447">ast_channel::callgroup</a>, <a class="el" href="chan__dahdi_8c_source.html#l01046">dahdi_pvt::callingpres</a>, <a class="el" href="chan__dahdi_8c_source.html#l01104">dahdi_pvt::callprogress</a>, <a class="el" href="chan__dahdi_8c_source.html#l00293">CALLPROGRESS_FAX_INCOMING</a>, <a class="el" href="chan__dahdi_8c_source.html#l00292">CALLPROGRESS_FAX_OUTGOING</a>, <a class="el" href="chan__dahdi_8c_source.html#l00291">CALLPROGRESS_PROGRESS</a>, <a class="el" href="chan__dahdi_8c_source.html#l01500">CANBUSYDETECT</a>, <a class="el" href="chan__dahdi_8c_source.html#l01501">CANPROGRESSDETECT</a>, <a class="el" href="chan__dahdi_8c_source.html#l00277">CHAN_PSEUDO</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="channel_8h_source.html#l00444">ast_channel::cid</a>, <a class="el" href="channel_8h_source.html#l00205">ast_callerid::cid_ani</a>, <a class="el" href="chan__dahdi_8c_source.html#l00995">dahdi_pvt::cid_ani2</a>, <a class="el" href="channel_8h_source.html#l00208">ast_callerid::cid_ani2</a>, <a class="el" href="channel_8h_source.html#l00202">ast_callerid::cid_dnid</a>, <a class="el" href="chan__dahdi_8c_source.html#l01001">dahdi_pvt::cid_name</a>, <a class="el" href="chan__dahdi_8c_source.html#l00997">dahdi_pvt::cid_num</a>, <a class="el" href="channel_8h_source.html#l00207">ast_callerid::cid_pres</a>, <a class="el" href="channel_8h_source.html#l00206">ast_callerid::cid_rdnis</a>, <a class="el" href="chan__dahdi_8c_source.html#l00999">dahdi_pvt::cid_ton</a>, <a class="el" href="channel_8h_source.html#l00209">ast_callerid::cid_ton</a>, <a class="el" href="channel_8h_source.html#l00503">ast_channel::context</a>, <a class="el" href="chan__dahdi_8c_source.html#l00967">dahdi_pvt::context</a>, <a class="el" href="chan__dahdi_8c_source.html#l02880">dahdi_confmute()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02165">dahdi_setlinear()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="chan__dahdi_8c_source.html#l00747">dahdi_pvt::digital</a>, <a class="el" href="chan__dahdi_8c_source.html#l01015">dahdi_pvt::dnid</a>, <a class="el" href="chan__dahdi_8c_source.html#l01113">dahdi_pvt::dsp</a>, <a class="el" href="dsp_8h_source.html#l00031">DSP_DIGITMODE_DTMF</a>, <a class="el" href="dsp_8h_source.html#l00027">DSP_FEATURE_BUSY_DETECT</a>, <a class="el" href="dsp_8h_source.html#l00043">DSP_FEATURE_CALL_PROGRESS</a>, <a class="el" href="dsp_8h_source.html#l00028">DSP_FEATURE_DIGIT_DETECT</a>, <a class="el" href="dsp_8h_source.html#l00029">DSP_FEATURE_FAX_DETECT</a>, <a class="el" href="dsp_8h_source.html#l00044">DSP_FEATURE_WAITDIALTONE</a>, <a class="el" href="chan__dahdi_8c_source.html#l01179">dahdi_pvt::dsp_features</a>, <a class="el" href="dsp_8h_source.html#l00039">DSP_PROGRESS_TALK</a>, <a class="el" href="chan__dahdi_8c_source.html#l01147">dahdi_pvt::dtmfrelax</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="channel_8h_source.html#l00504">ast_channel::exten</a>, <a class="el" href="chan__dahdi_8c_source.html#l00973">dahdi_pvt::exten</a>, <a class="el" href="chan__dahdi_8c_source.html#l01149">dahdi_pvt::fake_event</a>, <a class="el" href="chan__dahdi_8c_source.html#l00181">global_jbconf</a>, <a class="el" href="chan__dahdi_8c_source.html#l00774">dahdi_pvt::hardwaredtmf</a>, <a class="el" href="chan__alsa_8c_source.html#l00106">language</a>, <a class="el" href="chan__dahdi_8c_source.html#l00978">dahdi_pvt::language</a>, <a class="el" href="chan__dahdi_8c_source.html#l00620">dahdi_subchannel::linear</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__dahdi_8c_source.html#l01229">dahdi_pvt::muting</a>, <a class="el" href="config_8h_source.html#l00075">ast_variable::name</a>, <a class="el" href="channel_8h_source.html#l00482">ast_channel::nativeformats</a>, <a class="el" href="chan__dahdi_8c_source.html#l00213">NEED_MFDETECT</a>, <a class="el" href="config_8h_source.html#l00077">ast_variable::next</a>, <a class="el" href="chan__dahdi_8c_source.html#l00801">dahdi_pvt::outgoing</a>, <a class="el" href="chan__dahdi_8c_source.html#l00650">dahdi_pvt::owner</a>, <a class="el" href="chan__dahdi_8c_source.html#l00608">dahdi_subchannel::owner</a>, <a class="el" href="chan__dahdi_8c_source.html#l00989">dahdi_pvt::parkinglot</a>, <a class="el" href="pbx_8c_source.html#l09023">pbx_builtin_setvar_helper()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01035">dahdi_pvt::pickupgroup</a>, <a class="el" href="channel_8h_source.html#l00448">ast_channel::pickupgroup</a>, <a class="el" href="channel_8h_source.html#l00485">ast_channel::rawreadformat</a>, <a class="el" href="channel_8h_source.html#l00486">ast_channel::rawwriteformat</a>, <a class="el" href="chan__dahdi_8c_source.html#l01013">dahdi_pvt::rdnis</a>, <a class="el" href="channel_8h_source.html#l00483">ast_channel::readformat</a>, <a class="el" href="channel_8h_source.html#l00470">ast_channel::rings</a>, <a class="el" href="chan__dahdi_8c_source.html#l00666">dahdi_pvt::sig</a>, <a class="el" href="chan__dahdi_8c_source.html#l00256">SIG_BRI</a>, <a class="el" href="chan__dahdi_8c_source.html#l00257">SIG_BRI_PTMP</a>, <a class="el" href="chan__dahdi_8c_source.html#l00253">SIG_FXOGS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00254">SIG_FXOKS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00252">SIG_FXOLS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00251">SIG_FXSKS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00255">SIG_PRI</a>, <a class="el" href="chan__dahdi_8c_source.html#l00258">SIG_SS7</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>, <a class="el" href="channel_8h_source.html#l00400">ast_channel::tech</a>, <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>, <a class="el" href="channel_8h_source.html#l00493">ast_channel::transfercapability</a>, <a class="el" href="config_8h_source.html#l00076">ast_variable::value</a>, <a class="el" href="chan__dahdi_8c_source.html#l01040">dahdi_pvt::vars</a>, <a class="el" href="chan__dahdi_8c_source.html#l01109">dahdi_pvt::waitfordialtone</a>, and <a class="el" href="channel_8h_source.html#l00484">ast_channel::writeformat</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l10834">dahdi_request()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l08925">mwi_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l07418"></a>07418 {
<a name="l07419"></a>07419    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *tmp;
<a name="l07420"></a>07420    <span class="keywordtype">int</span> deflaw;
<a name="l07421"></a>07421    <span class="keywordtype">int</span> res;
<a name="l07422"></a>07422    <span class="keywordtype">int</span> x,y;
<a name="l07423"></a>07423    <span class="keywordtype">int</span> features;
<a name="l07424"></a>07424    <span class="keyword">struct </span><a class="code" href="structast__str.html" title="The descriptor of a dynamic string XXX storage will be optimized later if needed...">ast_str</a> *chan_name;
<a name="l07425"></a>07425    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *v;
<a name="l07426"></a>07426    <span class="keyword">struct </span>dahdi_params <a class="code" href="chan__usbradio_8c.html#ae320c29b526039fbf085fc7337bb2265">ps</a>;
<a name="l07427"></a>07427    <span class="keywordflow">if</span> (i-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l07428"></a>07428       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Channel %d already has a %s call\n&quot;</span>, i-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>,<a class="code" href="chan__dahdi_8c.html#a1f86ec72c5397a22d1b0e29e47635f04">subnames</a>[idx]);
<a name="l07429"></a>07429       <span class="keywordflow">return</span> NULL;
<a name="l07430"></a>07430    }
<a name="l07431"></a>07431    y = 1;
<a name="l07432"></a>07432    chan_name = <a class="code" href="strings_8h.html#a7fc844c12b769ccded05e7514036e241">ast_str_alloca</a>(32);
<a name="l07433"></a>07433    <span class="keywordflow">do</span> {
<a name="l07434"></a>07434 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l07435"></a>07435 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (i-&gt;bearer || (i-&gt;pri &amp;&amp; (i-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#a38139ec369c0243f4324eb4eb0c2f004">SIG_FXSKS</a>)))
<a name="l07436"></a>07436          <a class="code" href="strings_8h.html#a4a3222f04f84c80a1d70f51e2dff00ea" title="Set a dynamic string using variable arguments.">ast_str_set</a>(&amp;chan_name, 0, <span class="stringliteral">&quot;%d:%d-%d&quot;</span>, i-&gt;pri-&gt;trunkgroup, i-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, y);
<a name="l07437"></a>07437       <span class="keywordflow">else</span>
<a name="l07438"></a>07438 <span class="preprocessor">#endif</span>
<a name="l07439"></a>07439 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (i-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a> == <a class="code" href="chan__dahdi_8c.html#ada02a3fa3d2da06560df664c7228a559">CHAN_PSEUDO</a>)
<a name="l07440"></a>07440          <a class="code" href="strings_8h.html#a4a3222f04f84c80a1d70f51e2dff00ea" title="Set a dynamic string using variable arguments.">ast_str_set</a>(&amp;chan_name, 0, <span class="stringliteral">&quot;pseudo-%ld&quot;</span>, <a class="code" href="utils_8h.html#a7b4f10b070e95ba413e258a3e4b03c20">ast_random</a>());
<a name="l07441"></a>07441       <span class="keywordflow">else</span>
<a name="l07442"></a>07442          <a class="code" href="strings_8h.html#a4a3222f04f84c80a1d70f51e2dff00ea" title="Set a dynamic string using variable arguments.">ast_str_set</a>(&amp;chan_name, 0, <span class="stringliteral">&quot;%d-%d&quot;</span>, i-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, y);
<a name="l07443"></a>07443       <span class="keywordflow">for</span> (x = 0; x &lt; 3; x++) {
<a name="l07444"></a>07444          <span class="keywordflow">if</span> ((idx != x) &amp;&amp; i-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[x].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> &amp;&amp; !strcasecmp(<a class="code" href="strings_8h.html#a053bdfc229997a75f112bdd7b995e00b" title="Returns the string buffer within the ast_str buf.">ast_str_buffer</a>(chan_name), i-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[x].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name + 6))
<a name="l07445"></a>07445             <span class="keywordflow">break</span>;
<a name="l07446"></a>07446       }
<a name="l07447"></a>07447       y++;
<a name="l07448"></a>07448    } <span class="keywordflow">while</span> (x &lt; 3);
<a name="l07449"></a>07449    tmp = <a class="code" href="channel_8h.html#adfbceb39821586c0f9be0c47496a4e18">ast_channel_alloc</a>(0, <a class="code" href="structstate.html">state</a>, i-&gt;<a class="code" href="structdahdi__pvt.html#a29e973bd94bfbaf59d939bd1bc988c32" title="Caller ID number from an incoming call.">cid_num</a>, i-&gt;<a class="code" href="structdahdi__pvt.html#ade5a89f9bee15a492c760ec1765a292d" title="Caller ID name from an incoming call.">cid_name</a>, i-&gt;<a class="code" href="structdahdi__pvt.html#adfee50d07a98645d4d20b896ce03785a">accountcode</a>, i-&gt;<a class="code" href="structdahdi__pvt.html#a78d4847658b695383d849efd12399b38" title="Extension to use in the dialplan.">exten</a>, i-&gt;<a class="code" href="structdahdi__pvt.html#ac25ea00ee3f082df06e0cf468cbde240" title="The configured context for incoming calls.">context</a>, i-&gt;<a class="code" href="structdahdi__pvt.html#ad2cfb0f821c065261382a9298bb5a16b">amaflags</a>, <span class="stringliteral">&quot;DAHDI/%s&quot;</span>, <a class="code" href="strings_8h.html#a053bdfc229997a75f112bdd7b995e00b" title="Returns the string buffer within the ast_str buf.">ast_str_buffer</a>(chan_name));
<a name="l07450"></a>07450    <span class="keywordflow">if</span> (!tmp)
<a name="l07451"></a>07451       <span class="keywordflow">return</span> NULL;
<a name="l07452"></a>07452    tmp-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a> = &amp;<a class="code" href="chan__dahdi_8c.html#abaaa1bdd4fa7ebb3e41873b18bda7170">dahdi_tech</a>;
<a name="l07453"></a>07453    memset(&amp;<a class="code" href="chan__usbradio_8c.html#ae320c29b526039fbf085fc7337bb2265">ps</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="chan__usbradio_8c.html#ae320c29b526039fbf085fc7337bb2265">ps</a>));
<a name="l07454"></a>07454    <a class="code" href="chan__usbradio_8c.html#ae320c29b526039fbf085fc7337bb2265">ps</a>.channo = i-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>;
<a name="l07455"></a>07455    res = ioctl(i-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_GET_PARAMS, &amp;<a class="code" href="chan__usbradio_8c.html#ae320c29b526039fbf085fc7337bb2265">ps</a>);
<a name="l07456"></a>07456    <span class="keywordflow">if</span> (res) {
<a name="l07457"></a>07457       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to get parameters, assuming MULAW: %s\n&quot;</span>, strerror(errno));
<a name="l07458"></a>07458       <a class="code" href="chan__usbradio_8c.html#ae320c29b526039fbf085fc7337bb2265">ps</a>.curlaw = DAHDI_LAW_MULAW;
<a name="l07459"></a>07459    }
<a name="l07460"></a>07460    <span class="keywordflow">if</span> (<a class="code" href="chan__usbradio_8c.html#ae320c29b526039fbf085fc7337bb2265">ps</a>.curlaw == DAHDI_LAW_ALAW)
<a name="l07461"></a>07461       deflaw = <a class="code" href="frame_8h.html#aa58cc980a9c9108522effc64e9aff2d6">AST_FORMAT_ALAW</a>;
<a name="l07462"></a>07462    <span class="keywordflow">else</span>
<a name="l07463"></a>07463       deflaw = <a class="code" href="frame_8h.html#ab602cf455d4a96a3adba2e3ba8cd2b2c">AST_FORMAT_ULAW</a>;
<a name="l07464"></a>07464    <span class="keywordflow">if</span> (law) {
<a name="l07465"></a>07465       <span class="keywordflow">if</span> (law == DAHDI_LAW_ALAW)
<a name="l07466"></a>07466          deflaw = <a class="code" href="frame_8h.html#aa58cc980a9c9108522effc64e9aff2d6">AST_FORMAT_ALAW</a>;
<a name="l07467"></a>07467       <span class="keywordflow">else</span>
<a name="l07468"></a>07468          deflaw = <a class="code" href="frame_8h.html#ab602cf455d4a96a3adba2e3ba8cd2b2c">AST_FORMAT_ULAW</a>;
<a name="l07469"></a>07469    }
<a name="l07470"></a>07470    <a class="code" href="channel_8h.html#aca37ca2f3d55a223d26617329ed48a3e">ast_channel_set_fd</a>(tmp, 0, i-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>);
<a name="l07471"></a>07471    tmp-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a> = deflaw;
<a name="l07472"></a>07472    <span class="comment">/* Start out assuming ulaw since it&apos;s smaller :) */</span>
<a name="l07473"></a>07473    tmp-&gt;<a class="code" href="structast__channel.html#a6fcf944239e3718e282e0ba7512e66c6">rawreadformat</a> = deflaw;
<a name="l07474"></a>07474    tmp-&gt;<a class="code" href="structast__channel.html#ab7786a0f5b9a9ebf83daed87be4f3868">readformat</a> = deflaw;
<a name="l07475"></a>07475    tmp-&gt;<a class="code" href="structast__channel.html#a045b6dfdee84adceb7e86b6c5c4f9a86">rawwriteformat</a> = deflaw;
<a name="l07476"></a>07476    tmp-&gt;<a class="code" href="structast__channel.html#a00f5ce2ad53ff8523f8e46ea5aceba48">writeformat</a> = deflaw;
<a name="l07477"></a>07477    i-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a2de30c0a559b0df57ba137153a1370ea">linear</a> = 0;
<a name="l07478"></a>07478    <a class="code" href="chan__dahdi_8c.html#a8392b32cf7d3daa7b45154b7001460df">dahdi_setlinear</a>(i-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, i-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a2de30c0a559b0df57ba137153a1370ea">linear</a>);
<a name="l07479"></a>07479    features = 0;
<a name="l07480"></a>07480    <span class="keywordflow">if</span> (idx == <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>) {
<a name="l07481"></a>07481       <span class="keywordflow">if</span> (i-&gt;<a class="code" href="structdahdi__pvt.html#ab86910b871c8cff810ab15a587a1ed3b" title="TRUE if busy detection is enabled. (Listens for the beep-beep busy pattern.).">busydetect</a> &amp;&amp; <a class="code" href="chan__dahdi_8c.html#afc63e8eef602e5dd95f7363062550e0f">CANBUSYDETECT</a>(i))
<a name="l07482"></a>07482          features |= <a class="code" href="dsp_8h.html#a25ab003573ab7f608bc42723b3a5168a">DSP_FEATURE_BUSY_DETECT</a>;
<a name="l07483"></a>07483       <span class="keywordflow">if</span> ((i-&gt;<a class="code" href="structdahdi__pvt.html#a79710add069e32170f03d92067ec3877" title="Bitmapped call progress detection flags. CALLPROGRESS_xxx values.">callprogress</a> &amp; <a class="code" href="chan__dahdi_8c.html#aa66794917b368980eacd1bf179268e15">CALLPROGRESS_PROGRESS</a>) &amp;&amp; <a class="code" href="chan__dahdi_8c.html#aa40ff55dfcec4b66be7bbaec05993fad">CANPROGRESSDETECT</a>(i))
<a name="l07484"></a>07484          features |= <a class="code" href="dsp_8h.html#aa21ad1de4ef65e04563f6283a2213e25">DSP_FEATURE_CALL_PROGRESS</a>;
<a name="l07485"></a>07485       <span class="keywordflow">if</span> ((i-&gt;<a class="code" href="structdahdi__pvt.html#a508c2407a52638696697fdeb08f0b2e5" title="Number of milliseconds to wait for dialtone.">waitfordialtone</a>) &amp;&amp; <a class="code" href="chan__dahdi_8c.html#aa40ff55dfcec4b66be7bbaec05993fad">CANPROGRESSDETECT</a>(i))
<a name="l07486"></a>07486          features |= <a class="code" href="dsp_8h.html#a1d5cf337f5788319b8ba8bf6d161dce5">DSP_FEATURE_WAITDIALTONE</a>;
<a name="l07487"></a>07487       <span class="keywordflow">if</span> ((!i-&gt;<a class="code" href="structdahdi__pvt.html#a40668dcb7d940b80c4f109861059a978" title="TRUE if we originated the call leg.">outgoing</a> &amp;&amp; (i-&gt;<a class="code" href="structdahdi__pvt.html#a79710add069e32170f03d92067ec3877" title="Bitmapped call progress detection flags. CALLPROGRESS_xxx values.">callprogress</a> &amp; <a class="code" href="chan__dahdi_8c.html#a0069de9c37a93a8941cef2ce562abf81">CALLPROGRESS_FAX_INCOMING</a>)) ||
<a name="l07488"></a>07488          (i-&gt;<a class="code" href="structdahdi__pvt.html#a40668dcb7d940b80c4f109861059a978" title="TRUE if we originated the call leg.">outgoing</a> &amp;&amp; (i-&gt;<a class="code" href="structdahdi__pvt.html#a79710add069e32170f03d92067ec3877" title="Bitmapped call progress detection flags. CALLPROGRESS_xxx values.">callprogress</a> &amp; <a class="code" href="chan__dahdi_8c.html#a2957dd1e62c977f55ccb4eeb99d87052">CALLPROGRESS_FAX_OUTGOING</a>))) {
<a name="l07489"></a>07489          features |= <a class="code" href="dsp_8h.html#a92045e8a8ad56b9b31d24db325fa95ab">DSP_FEATURE_FAX_DETECT</a>;
<a name="l07490"></a>07490       }
<a name="l07491"></a>07491       x = DAHDI_TONEDETECT_ON | DAHDI_TONEDETECT_MUTE;
<a name="l07492"></a>07492       <span class="keywordflow">if</span> (ioctl(i-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONEDETECT, &amp;x)) {
<a name="l07493"></a>07493          i-&gt;<a class="code" href="structdahdi__pvt.html#acb50d09ad188475206ff2f852afb6831" title="TRUE if DTMF detection needs to be done by hardware.">hardwaredtmf</a> = 0;
<a name="l07494"></a>07494          features |= <a class="code" href="dsp_8h.html#a84818b360426bdd5f588cdca463e15be">DSP_FEATURE_DIGIT_DETECT</a>;
<a name="l07495"></a>07495       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#a97fec6c0baa06f18539a7c8165314210" title="Signaling types that need to use MF detection should be placed in this macro.">NEED_MFDETECT</a>(i)) {
<a name="l07496"></a>07496          i-&gt;<a class="code" href="structdahdi__pvt.html#acb50d09ad188475206ff2f852afb6831" title="TRUE if DTMF detection needs to be done by hardware.">hardwaredtmf</a> = 1;
<a name="l07497"></a>07497          features |= <a class="code" href="dsp_8h.html#a84818b360426bdd5f588cdca463e15be">DSP_FEATURE_DIGIT_DETECT</a>;
<a name="l07498"></a>07498       }
<a name="l07499"></a>07499    }
<a name="l07500"></a>07500    <span class="keywordflow">if</span> (features) {
<a name="l07501"></a>07501       <span class="keywordflow">if</span> (i-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>) {
<a name="l07502"></a>07502          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Already have a dsp on %s?\n&quot;</span>, tmp-&gt;name);
<a name="l07503"></a>07503       } <span class="keywordflow">else</span> {
<a name="l07504"></a>07504          <span class="keywordflow">if</span> (i-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a> != <a class="code" href="chan__dahdi_8c.html#ada02a3fa3d2da06560df664c7228a559">CHAN_PSEUDO</a>)
<a name="l07505"></a>07505             i-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a> = <a class="code" href="dsp_8h.html#a0a60e93006c8e1ca8fda922ae0e0da2c">ast_dsp_new</a>();
<a name="l07506"></a>07506          <span class="keywordflow">else</span>
<a name="l07507"></a>07507             i-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a> = NULL;
<a name="l07508"></a>07508          <span class="keywordflow">if</span> (i-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>) {
<a name="l07509"></a>07509             i-&gt;<a class="code" href="structdahdi__pvt.html#a746e641282b3f1665a817252c8e4145e" title="DSP feature flags: DSP_FEATURE_xxx.">dsp_features</a> = features;
<a name="l07510"></a>07510 <span class="preprocessor">#if defined(HAVE_PRI) || defined(HAVE_SS7)</span>
<a name="l07511"></a>07511 <span class="preprocessor"></span>            <span class="comment">/* We cannot do progress detection until receives PROGRESS message */</span>
<a name="l07512"></a>07512             <span class="keywordflow">if</span> (i-&gt;<a class="code" href="structdahdi__pvt.html#a40668dcb7d940b80c4f109861059a978" title="TRUE if we originated the call leg.">outgoing</a> &amp;&amp; ((i-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#ae9ab0c9508fca045a06730533be276a5">SIG_PRI</a>) || (i-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#ab5bfeaf991c23c5b6510ace44ae79ce9">SIG_BRI</a>) || (i-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a>) || (i-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#aadcda889db3cf9dfe757dbc1d4d8311a">SIG_SS7</a>))) {
<a name="l07513"></a>07513                <span class="comment">/* Remember requested DSP features, don&apos;t treat</span>
<a name="l07514"></a>07514 <span class="comment">                  talking as ANSWER */</span>
<a name="l07515"></a>07515                i-&gt;<a class="code" href="structdahdi__pvt.html#a746e641282b3f1665a817252c8e4145e" title="DSP feature flags: DSP_FEATURE_xxx.">dsp_features</a> = features &amp; ~<a class="code" href="dsp_8h.html#a3096d3630e21aecb4f12942a1f6361f6">DSP_PROGRESS_TALK</a>;
<a name="l07516"></a>07516                features = 0;
<a name="l07517"></a>07517             }
<a name="l07518"></a>07518 <span class="preprocessor">#endif</span>
<a name="l07519"></a>07519 <span class="preprocessor"></span>            <a class="code" href="dsp_8h.html#aedc7fa20fba91e3c018f6989e95c714b" title="Select feature set.">ast_dsp_set_features</a>(i-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>, features);
<a name="l07520"></a>07520             <a class="code" href="dsp_8h.html#aa28ffa065bd46d09b5b06de2f77183b0" title="Set digit mode.">ast_dsp_set_digitmode</a>(i-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>, <a class="code" href="dsp_8h.html#af0e16e88030540319d8a545dd7c2576c">DSP_DIGITMODE_DTMF</a> | i-&gt;<a class="code" href="structdahdi__pvt.html#a6829c6ed48c184cbd85055163786a7eb">dtmfrelax</a>);
<a name="l07521"></a>07521             <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="chan__dahdi_8c.html#ac3217a28bcd501a0e91a5337210750fb">progzone</a>))
<a name="l07522"></a>07522                <a class="code" href="dsp_8h.html#af9912e8fcfc4d76058656934932af0b1" title="Set zone for doing progress detection.">ast_dsp_set_call_progress_zone</a>(i-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>, <a class="code" href="chan__dahdi_8c.html#ac3217a28bcd501a0e91a5337210750fb">progzone</a>);
<a name="l07523"></a>07523             <span class="keywordflow">if</span> (i-&gt;<a class="code" href="structdahdi__pvt.html#ab86910b871c8cff810ab15a587a1ed3b" title="TRUE if busy detection is enabled. (Listens for the beep-beep busy pattern.).">busydetect</a> &amp;&amp; <a class="code" href="chan__dahdi_8c.html#afc63e8eef602e5dd95f7363062550e0f">CANBUSYDETECT</a>(i)) {
<a name="l07524"></a>07524                <a class="code" href="dsp_8h.html#ae5088d241f0f7c6e3c82bacfb4a5099b" title="Set number of required cadences for busy.">ast_dsp_set_busy_count</a>(i-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>, i-&gt;<a class="code" href="structdahdi__pvt.html#a29a1e575aa8b94876e2d3b8da3f6da2b" title="Number of times to see &amp;quot;busy&amp;quot; tone before hanging up.">busycount</a>);
<a name="l07525"></a>07525                <a class="code" href="dsp_8h.html#a6e304e69484e7e3ddc179cddfcc539a8" title="Set expected lengths of the busy tone.">ast_dsp_set_busy_pattern</a>(i-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>, i-&gt;<a class="code" href="structdahdi__pvt.html#a0b9321a0ad6b6a804a8c7f295f5b8b7a" title="Length of &amp;quot;busy&amp;quot; tone on time.">busy_tonelength</a>, i-&gt;<a class="code" href="structdahdi__pvt.html#a9224645275ef08732407aea48569aea1" title="Length of &amp;quot;busy&amp;quot; tone off time.">busy_quietlength</a>);
<a name="l07526"></a>07526             }
<a name="l07527"></a>07527          }
<a name="l07528"></a>07528       }
<a name="l07529"></a>07529    }
<a name="l07530"></a>07530 
<a name="l07531"></a>07531    <span class="keywordflow">if</span> (<a class="code" href="structstate.html">state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a>)
<a name="l07532"></a>07532       tmp-&gt;<a class="code" href="structast__channel.html#a358fd14658a0c5276190e48f1b1f251a">rings</a> = 1;
<a name="l07533"></a>07533    tmp-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a> = i;
<a name="l07534"></a>07534    <span class="keywordflow">if</span> ((i-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#a7c9b3bb8225896ff2b9aed27e6f80f10">SIG_FXOKS</a>) || (i-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#a3dcffbaf4a26f2b7b792998df1eea27b">SIG_FXOGS</a>) || (i-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#adb40571aa5ff846fc334be5260eab257">SIG_FXOLS</a>)) {
<a name="l07535"></a>07535       <span class="comment">/* Only FXO signalled stuff can be picked up */</span>
<a name="l07536"></a>07536       tmp-&gt;<a class="code" href="structast__channel.html#af0f007b48a9c8cf0629428bd0483e0d1">callgroup</a> = i-&gt;<a class="code" href="structdahdi__pvt.html#af0f007b48a9c8cf0629428bd0483e0d1" title="Bitmapped call groups this belongs to.">callgroup</a>;
<a name="l07537"></a>07537       tmp-&gt;<a class="code" href="structast__channel.html#abc0651bcec68410023c036b7d8ec4d11">pickupgroup</a> = i-&gt;<a class="code" href="structdahdi__pvt.html#abc0651bcec68410023c036b7d8ec4d11" title="Bitmapped pickup groups this belongs to.">pickupgroup</a>;
<a name="l07538"></a>07538    }
<a name="l07539"></a>07539    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(i-&gt;<a class="code" href="structdahdi__pvt.html#ac59e01fcfbc9801f87f28f6b60957a24">parkinglot</a>))
<a name="l07540"></a>07540       <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(tmp, <a class="code" href="chan__dahdi_8c.html#ac59e01fcfbc9801f87f28f6b60957a24">parkinglot</a>, i-&gt;<a class="code" href="structdahdi__pvt.html#ac59e01fcfbc9801f87f28f6b60957a24">parkinglot</a>);
<a name="l07541"></a>07541    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(i-&gt;<a class="code" href="structdahdi__pvt.html#adf416dc058363e2fd5750c77e2d78bee" title="Language configured for calls.">language</a>))
<a name="l07542"></a>07542       <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(tmp, <a class="code" href="chan__alsa_8c.html#adf416dc058363e2fd5750c77e2d78bee">language</a>, i-&gt;<a class="code" href="structdahdi__pvt.html#adf416dc058363e2fd5750c77e2d78bee" title="Language configured for calls.">language</a>);
<a name="l07543"></a>07543    <span class="keywordflow">if</span> (!i-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)
<a name="l07544"></a>07544       i-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = tmp;
<a name="l07545"></a>07545    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(i-&gt;<a class="code" href="structdahdi__pvt.html#adfee50d07a98645d4d20b896ce03785a">accountcode</a>))
<a name="l07546"></a>07546       <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(tmp, <a class="code" href="chan__iax2_8c.html#adfee50d07a98645d4d20b896ce03785a">accountcode</a>, i-&gt;<a class="code" href="structdahdi__pvt.html#adfee50d07a98645d4d20b896ce03785a">accountcode</a>);
<a name="l07547"></a>07547    <span class="keywordflow">if</span> (i-&gt;<a class="code" href="structdahdi__pvt.html#ad2cfb0f821c065261382a9298bb5a16b">amaflags</a>)
<a name="l07548"></a>07548       tmp-&gt;<a class="code" href="structast__channel.html#ad2cfb0f821c065261382a9298bb5a16b">amaflags</a> = i-&gt;<a class="code" href="structdahdi__pvt.html#ad2cfb0f821c065261382a9298bb5a16b">amaflags</a>;
<a name="l07549"></a>07549    i-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = tmp;
<a name="l07550"></a>07550    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmp-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, i-&gt;<a class="code" href="structdahdi__pvt.html#ac25ea00ee3f082df06e0cf468cbde240" title="The configured context for incoming calls.">context</a>, <span class="keyword">sizeof</span>(tmp-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>));
<a name="l07551"></a>07551    <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(tmp, call_forward, i-&gt;<a class="code" href="structdahdi__pvt.html#a82162415ab1c1e6d5ee85973d68b3655" title="Accumulated call forwarding number.">call_forward</a>);
<a name="l07552"></a>07552    <span class="comment">/* If we&apos;ve been told &quot;no ADSI&quot; then enforce it */</span>
<a name="l07553"></a>07553    <span class="keywordflow">if</span> (!i-&gt;<a class="code" href="structdahdi__pvt.html#a537f2d4f7f35cb2c667f7c9790793626" title="TRUE if ADSI (Analog Display Services Interface) available.">adsi</a>)
<a name="l07554"></a>07554       tmp-&gt;<a class="code" href="structast__channel.html#a4507948aab513e976b52d2253376ee7f">adsicpe</a> = <a class="code" href="channel_8h.html#a828f537544a2ad2352c56c078390a0bda5f0673b46cfdba3094393b3fbce084ff">AST_ADSI_UNAVAILABLE</a>;
<a name="l07555"></a>07555    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(i-&gt;<a class="code" href="structdahdi__pvt.html#a78d4847658b695383d849efd12399b38" title="Extension to use in the dialplan.">exten</a>))
<a name="l07556"></a>07556       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmp-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>, i-&gt;<a class="code" href="structdahdi__pvt.html#a78d4847658b695383d849efd12399b38" title="Extension to use in the dialplan.">exten</a>, <span class="keyword">sizeof</span>(tmp-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>));
<a name="l07557"></a>07557    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(i-&gt;<a class="code" href="structdahdi__pvt.html#a93abdcdde8e3c987c4573427a10b2727" title="Redirecting Directory Number Information Service (RDNIS) number.">rdnis</a>))
<a name="l07558"></a>07558       tmp-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a4791c5f3aedc8782678867a1741f4131">cid_rdnis</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(i-&gt;<a class="code" href="structdahdi__pvt.html#a93abdcdde8e3c987c4573427a10b2727" title="Redirecting Directory Number Information Service (RDNIS) number.">rdnis</a>);
<a name="l07559"></a>07559    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(i-&gt;<a class="code" href="structdahdi__pvt.html#a7d7bab8ea8b311d16219b832de90c8f6" title="Dialed Number Identifier.">dnid</a>))
<a name="l07560"></a>07560       tmp-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#aa54ab157f47ac529034d524781e2a7e2">cid_dnid</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(i-&gt;<a class="code" href="structdahdi__pvt.html#a7d7bab8ea8b311d16219b832de90c8f6" title="Dialed Number Identifier.">dnid</a>);
<a name="l07561"></a>07561 
<a name="l07562"></a>07562    <span class="comment">/* Don&apos;t use ast_set_callerid() here because it will</span>
<a name="l07563"></a>07563 <span class="comment">    * generate a needless NewCallerID event */</span>
<a name="l07564"></a>07564 <span class="preprocessor">#ifdef PRI_ANI</span>
<a name="l07565"></a>07565 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(i-&gt;cid_ani))
<a name="l07566"></a>07566       tmp-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a7bb8ad258e687da69d6933ab48320df7">cid_ani</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(i-&gt;cid_ani);
<a name="l07567"></a>07567    <span class="keywordflow">else</span>
<a name="l07568"></a>07568       tmp-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a7bb8ad258e687da69d6933ab48320df7">cid_ani</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(i-&gt;<a class="code" href="structdahdi__pvt.html#a29e973bd94bfbaf59d939bd1bc988c32" title="Caller ID number from an incoming call.">cid_num</a>);
<a name="l07569"></a>07569 <span class="preprocessor">#else</span>
<a name="l07570"></a>07570 <span class="preprocessor"></span>   tmp-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a7bb8ad258e687da69d6933ab48320df7">cid_ani</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(i-&gt;<a class="code" href="structdahdi__pvt.html#a29e973bd94bfbaf59d939bd1bc988c32" title="Caller ID number from an incoming call.">cid_num</a>);
<a name="l07571"></a>07571 <span class="preprocessor">#endif</span>
<a name="l07572"></a>07572 <span class="preprocessor"></span>   tmp-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a5674af3fa5ce1dd1fe052be1477d4110">cid_pres</a> = i-&gt;<a class="code" href="structdahdi__pvt.html#abd29b99884a9fc8a54fc021555190fb8">callingpres</a>;
<a name="l07573"></a>07573    tmp-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#aff456ca48d31a9813584e799064cf88e">cid_ton</a> = i-&gt;<a class="code" href="structdahdi__pvt.html#aff456ca48d31a9813584e799064cf88e" title="Caller ID Q.931 TON/NPI field values. Set by PRI. Zero otherwise.">cid_ton</a>;
<a name="l07574"></a>07574    tmp-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a9540aaac76be952860ef25d607eb33fb">cid_ani2</a> = i-&gt;<a class="code" href="structdahdi__pvt.html#a9540aaac76be952860ef25d607eb33fb" title="Automatic Number Identification code from PRI.">cid_ani2</a>;
<a name="l07575"></a>07575 <span class="preprocessor">#if defined(HAVE_PRI) || defined(HAVE_SS7)</span>
<a name="l07576"></a>07576 <span class="preprocessor"></span>   tmp-&gt;<a class="code" href="structast__channel.html#a67fbfb6a4051ff15a242b9685167f16a">transfercapability</a> = transfercapability;
<a name="l07577"></a>07577    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(tmp, <span class="stringliteral">&quot;TRANSFERCAPABILITY&quot;</span>, <a class="code" href="channel_8h.html#acb027b361350d81e4b94b540fbdfe4e4" title="Gives the string form of a given transfer capability.">ast_transfercapability2str</a>(transfercapability));
<a name="l07578"></a>07578    <span class="keywordflow">if</span> (transfercapability &amp; <a class="code" href="transcap_8h.html#a70df930118839f3fc035fc9f15dfa621">AST_TRANS_CAP_DIGITAL</a>)
<a name="l07579"></a>07579       i-&gt;<a class="code" href="structdahdi__pvt.html#adf54768a4327f86de3a234648305c4a4" title="TRUE if the transfer capability of the call is digital.">digital</a> = 1;
<a name="l07580"></a>07580    <span class="comment">/* Assume calls are not idle calls unless we&apos;re told differently */</span>
<a name="l07581"></a>07581    i-&gt;isidlecall = 0;
<a name="l07582"></a>07582    i-&gt;alreadyhungup = 0;
<a name="l07583"></a>07583 <span class="preprocessor">#endif</span>
<a name="l07584"></a>07584 <span class="preprocessor"></span>   <span class="comment">/* clear the fake event in case we posted one before we had ast_channel */</span>
<a name="l07585"></a>07585    i-&gt;<a class="code" href="structdahdi__pvt.html#a9e44f391f0742649b6cd532f8487c400" title="Holding place for event injected from outside normal operation.">fake_event</a> = 0;
<a name="l07586"></a>07586    <span class="comment">/* Assure there is no confmute on this channel */</span>
<a name="l07587"></a>07587    <a class="code" href="chan__dahdi_8c.html#a04126d689aca51a8a38499685cffe8f6">dahdi_confmute</a>(i, 0);
<a name="l07588"></a>07588    i-&gt;<a class="code" href="structdahdi__pvt.html#ae6778ad7c2d7a99161a32c9b87eddf85" title="TRUE if confrence is muted.">muting</a> = 0;
<a name="l07589"></a>07589    <span class="comment">/* Configure the new channel jb */</span>
<a name="l07590"></a>07590    <a class="code" href="abstract__jb_8h.html#a0981c84ac90dd79bc2a0fdd90aa6efba" title="Configures a jitterbuffer on a channel.">ast_jb_configure</a>(tmp, &amp;<a class="code" href="chan__dahdi_8c.html#abaabcb7f4349cc632dde3af5c6a5e1bd">global_jbconf</a>);
<a name="l07591"></a>07591 
<a name="l07592"></a>07592    <a class="code" href="devicestate_8h.html#a0cc33ebff1ed76c113d17785814b5a47" title="Tells Asterisk the State for Device is changed.">ast_devstate_changed_literal</a>(<a class="code" href="devicestate_8h.html#a8e0c5acc035f43741343b8ed2fcb14ea" title="Convert channel state to devicestate.">ast_state_chan2dev</a>(<a class="code" href="structstate.html">state</a>), tmp-&gt;name);
<a name="l07593"></a>07593 
<a name="l07594"></a>07594    <span class="keywordflow">for</span> (v = i-&gt;<a class="code" href="structdahdi__pvt.html#a134fe67053d035e763d6cf99916c1bf8" title="Channel variable list with associated values to set when a channel is created.">vars</a> ; v ; v = v-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>)
<a name="l07595"></a>07595       <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(tmp, v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l07596"></a>07596 
<a name="l07597"></a>07597    <span class="keywordflow">if</span> (startpbx) {
<a name="l07598"></a>07598 <span class="preprocessor">#ifdef HAVE_OPENR2</span>
<a name="l07599"></a>07599 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (i-&gt;mfcr2call) {
<a name="l07600"></a>07600          <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(tmp, <span class="stringliteral">&quot;MFCR2_CATEGORY&quot;</span>, openr2_proto_get_category_string(i-&gt;mfcr2_recvd_category));
<a name="l07601"></a>07601       }
<a name="l07602"></a>07602 <span class="preprocessor">#endif</span>
<a name="l07603"></a>07603 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (<a class="code" href="pbx_8h.html#a9a937fbb3b5f4e68880a9c5714a29ce5" title="Create a new thread and start the PBX.">ast_pbx_start</a>(tmp)) {
<a name="l07604"></a>07604          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to start PBX on %s\n&quot;</span>, tmp-&gt;name);
<a name="l07605"></a>07605          <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(tmp);
<a name="l07606"></a>07606          i-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = NULL;
<a name="l07607"></a>07607          <span class="keywordflow">return</span> NULL;
<a name="l07608"></a>07608       }
<a name="l07609"></a>07609    }
<a name="l07610"></a>07610 
<a name="l07611"></a>07611    <a class="code" href="module_8h.html#aa08fcee0b390e15532dd03803c8728c4">ast_module_ref</a>(<a class="code" href="structast__module__info.html">ast_module_info</a>-&gt;self);
<a name="l07612"></a>07612    <span class="keywordflow">return</span> tmp;
<a name="l07613"></a>07613 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5be3d201f917ed02d9a08749cd673191"></a><!-- doxytag: member="chan_dahdi.c::dahdi_open" ref="a5be3d201f917ed02d9a08749cd673191" args="(char *fn)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int dahdi_open </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>fn</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l02090">2090</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="adsistub_8c_source.html#l00049">chan</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00397">READ_SIZE</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l02175">alloc_sub()</a>, <a class="el" href="chan__dahdi_8c_source.html#l10771">duplicate_pseudo()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02091"></a>02091 {
<a name="l02092"></a>02092    <span class="keywordtype">int</span> fd;
<a name="l02093"></a>02093    <span class="keywordtype">int</span> isnum;
<a name="l02094"></a>02094    <span class="keywordtype">int</span> <a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a> = 0;
<a name="l02095"></a>02095    <span class="keywordtype">int</span> bs;
<a name="l02096"></a>02096    <span class="keywordtype">int</span> x;
<a name="l02097"></a>02097    isnum = 1;
<a name="l02098"></a>02098    <span class="keywordflow">for</span> (x = 0; x &lt; strlen(fn); x++) {
<a name="l02099"></a>02099       <span class="keywordflow">if</span> (!isdigit(fn[x])) {
<a name="l02100"></a>02100          isnum = 0;
<a name="l02101"></a>02101          <span class="keywordflow">break</span>;
<a name="l02102"></a>02102       }
<a name="l02103"></a>02103    }
<a name="l02104"></a>02104    <span class="keywordflow">if</span> (isnum) {
<a name="l02105"></a>02105       chan = atoi(fn);
<a name="l02106"></a>02106       <span class="keywordflow">if</span> (chan &lt; 1) {
<a name="l02107"></a>02107          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid channel number &apos;%s&apos;\n&quot;</span>, fn);
<a name="l02108"></a>02108          <span class="keywordflow">return</span> -1;
<a name="l02109"></a>02109       }
<a name="l02110"></a>02110       fn = <span class="stringliteral">&quot;/dev/dahdi/channel&quot;</span>;
<a name="l02111"></a>02111    }
<a name="l02112"></a>02112    fd = open(fn, O_RDWR | O_NONBLOCK);
<a name="l02113"></a>02113    <span class="keywordflow">if</span> (fd &lt; 0) {
<a name="l02114"></a>02114       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to open &apos;%s&apos;: %s\n&quot;</span>, fn, strerror(errno));
<a name="l02115"></a>02115       <span class="keywordflow">return</span> -1;
<a name="l02116"></a>02116    }
<a name="l02117"></a>02117    <span class="keywordflow">if</span> (chan) {
<a name="l02118"></a>02118       <span class="keywordflow">if</span> (ioctl(fd, DAHDI_SPECIFY, &amp;chan)) {
<a name="l02119"></a>02119          x = <a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;
<a name="l02120"></a>02120          close(fd);
<a name="l02121"></a>02121          <a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> = x;
<a name="l02122"></a>02122          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to specify channel %d: %s\n&quot;</span>, chan, strerror(errno));
<a name="l02123"></a>02123          <span class="keywordflow">return</span> -1;
<a name="l02124"></a>02124       }
<a name="l02125"></a>02125    }
<a name="l02126"></a>02126    bs = <a class="code" href="chan__dahdi_8c.html#a86e1969b50e55e5d506233078ca0fa4c">READ_SIZE</a>;
<a name="l02127"></a>02127    <span class="keywordflow">if</span> (ioctl(fd, DAHDI_SET_BLOCKSIZE, &amp;bs) == -1) {
<a name="l02128"></a>02128       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to set blocksize &apos;%d&apos;: %s\n&quot;</span>, bs,  strerror(errno));
<a name="l02129"></a>02129       x = <a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;
<a name="l02130"></a>02130       close(fd);
<a name="l02131"></a>02131       <a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> = x;
<a name="l02132"></a>02132       <span class="keywordflow">return</span> -1;
<a name="l02133"></a>02133    }
<a name="l02134"></a>02134    <span class="keywordflow">return</span> fd;
<a name="l02135"></a>02135 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a32da5905fb64086d5a6fcf534aabd47b"></a><!-- doxytag: member="chan_dahdi.c::dahdi_queue_frame" ref="a32da5905fb64086d5a6fcf534aabd47b" args="(struct dahdi_pvt *p, struct ast_frame *f, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void dahdi_queue_frame </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td>
          <td class="paramname"> <em>f</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l01544">1544</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l02037">ast_channel_trylock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="channel_8c_source.html#l01080">ast_queue_frame()</a>, <a class="el" href="lock_8h_source.html#l01676">DEADLOCK_AVOIDANCE</a>, <a class="el" href="chan__dahdi_8c_source.html#l00649">dahdi_pvt::lock</a>, <a class="el" href="chan__dahdi_8c_source.html#l00650">dahdi_pvt::owner</a>, <a class="el" href="chan__dahdi_8c_source.html#l00666">dahdi_pvt::sig</a>, <a class="el" href="chan__dahdi_8c_source.html#l00256">SIG_BRI</a>, <a class="el" href="chan__dahdi_8c_source.html#l00257">SIG_BRI_PTMP</a>, <a class="el" href="chan__dahdi_8c_source.html#l00255">SIG_PRI</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00258">SIG_SS7</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l15289">action_dahdidialoffhook()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01545"></a>01545 {
<a name="l01546"></a>01546 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l01547"></a>01547 <span class="preprocessor"></span>   <span class="keyword">struct </span>dahdi_pri *pri = (<span class="keyword">struct </span>dahdi_pri*) data;
<a name="l01548"></a>01548 <span class="preprocessor">#endif</span>
<a name="l01549"></a>01549 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_SS7</span>
<a name="l01550"></a>01550 <span class="preprocessor"></span>   <span class="keyword">struct </span>dahdi_ss7 *ss7 = (<span class="keyword">struct </span>dahdi_ss7*) data;
<a name="l01551"></a>01551 <span class="preprocessor">#endif</span>
<a name="l01552"></a>01552 <span class="preprocessor"></span>   <span class="comment">/* We must unlock the PRI to avoid the possibility of a deadlock */</span>
<a name="l01553"></a>01553 <span class="preprocessor">#if defined(HAVE_PRI) || defined(HAVE_SS7)</span>
<a name="l01554"></a>01554 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (data) {
<a name="l01555"></a>01555       <span class="keywordflow">switch</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a>) {
<a name="l01556"></a>01556 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l01557"></a>01557 <span class="preprocessor"></span>      <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ab5bfeaf991c23c5b6510ace44ae79ce9">SIG_BRI</a>:
<a name="l01558"></a>01558       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a>:
<a name="l01559"></a>01559       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ae9ab0c9508fca045a06730533be276a5">SIG_PRI</a>:
<a name="l01560"></a>01560          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pri-&gt;lock);
<a name="l01561"></a>01561          <span class="keywordflow">break</span>;
<a name="l01562"></a>01562 <span class="preprocessor">#endif</span>
<a name="l01563"></a>01563 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_SS7</span>
<a name="l01564"></a>01564 <span class="preprocessor"></span>      <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#aadcda889db3cf9dfe757dbc1d4d8311a">SIG_SS7</a>:
<a name="l01565"></a>01565          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;ss7-&gt;lock);
<a name="l01566"></a>01566          <span class="keywordflow">break</span>;
<a name="l01567"></a>01567 <span class="preprocessor">#endif</span>
<a name="l01568"></a>01568 <span class="preprocessor"></span>      <span class="keywordflow">default</span>:
<a name="l01569"></a>01569          <span class="keywordflow">break</span>;
<a name="l01570"></a>01570       }
<a name="l01571"></a>01571    }
<a name="l01572"></a>01572 <span class="preprocessor">#endif</span>
<a name="l01573"></a>01573 <span class="preprocessor"></span>   <span class="keywordflow">for</span> (;;) {
<a name="l01574"></a>01574       <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l01575"></a>01575          <span class="keywordflow">if</span> (<a class="code" href="lock_8h.html#a8b8532d377bd19e8411000ddccfa6607" title="Try locking a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_trylock</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)) {
<a name="l01576"></a>01576             <a class="code" href="lock_8h.html#a851106e971b4611a38cb4be8b39d9fcf">DEADLOCK_AVOIDANCE</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01577"></a>01577          } <span class="keywordflow">else</span> {
<a name="l01578"></a>01578             <a class="code" href="channel_8h.html#a6cbcba5661d55216968cde8fdf913c89" title="Queue one or more frames to a channel&amp;#39;s frame queue.">ast_queue_frame</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, f);
<a name="l01579"></a>01579             <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l01580"></a>01580             <span class="keywordflow">break</span>;
<a name="l01581"></a>01581          }
<a name="l01582"></a>01582       } <span class="keywordflow">else</span>
<a name="l01583"></a>01583          <span class="keywordflow">break</span>;
<a name="l01584"></a>01584    }
<a name="l01585"></a>01585 <span class="preprocessor">#if defined(HAVE_PRI) || defined(HAVE_SS7)</span>
<a name="l01586"></a>01586 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (data) {
<a name="l01587"></a>01587       <span class="keywordflow">switch</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a>) {
<a name="l01588"></a>01588 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l01589"></a>01589 <span class="preprocessor"></span>      <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ab5bfeaf991c23c5b6510ace44ae79ce9">SIG_BRI</a>:
<a name="l01590"></a>01590       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a>:
<a name="l01591"></a>01591       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ae9ab0c9508fca045a06730533be276a5">SIG_PRI</a>:
<a name="l01592"></a>01592          <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;pri-&gt;lock);
<a name="l01593"></a>01593          <span class="keywordflow">break</span>;
<a name="l01594"></a>01594 <span class="preprocessor">#endif</span>
<a name="l01595"></a>01595 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_SS7</span>
<a name="l01596"></a>01596 <span class="preprocessor"></span>      <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#aadcda889db3cf9dfe757dbc1d4d8311a">SIG_SS7</a>:
<a name="l01597"></a>01597          <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;ss7-&gt;lock);
<a name="l01598"></a>01598          <span class="keywordflow">break</span>;
<a name="l01599"></a>01599 <span class="preprocessor">#endif</span>
<a name="l01600"></a>01600 <span class="preprocessor"></span>      <span class="keywordflow">default</span>:
<a name="l01601"></a>01601          <span class="keywordflow">break</span>;
<a name="l01602"></a>01602       }
<a name="l01603"></a>01603    }
<a name="l01604"></a>01604 <span class="preprocessor">#endif</span>
<a name="l01605"></a>01605 <span class="preprocessor"></span>}
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac8523d205076076cdc3d81d94b1294a9"></a><!-- doxytag: member="chan_dahdi.c::dahdi_read" ref="ac8523d205076076cdc3d81d94b1294a9" args="(struct ast_channel *ast)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__frame.html">ast_frame</a> * dahdi_read </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>ast</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l06717">6717</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="chan__dahdi_8c_source.html#l06601">__dahdi_exception()</a>, <a class="el" href="channel_8h_source.html#l00469">ast_channel::_state</a>, <a class="el" href="utils_8h_source.html#l00075">ast_clear_flag</a>, <a class="el" href="frame_8h_source.html#l00301">AST_CONTROL_ANSWER</a>, <a class="el" href="frame_8h_source.html#l00302">AST_CONTROL_BUSY</a>, <a class="el" href="frame_8h_source.html#l00305">AST_CONTROL_CONGESTION</a>, <a class="el" href="frame_8h_source.html#l00306">AST_CONTROL_FLASH</a>, <a class="el" href="frame_8h_source.html#l00313">AST_CONTROL_HOLD</a>, <a class="el" href="frame_8h_source.html#l00309">AST_CONTROL_RADIO_KEY</a>, <a class="el" href="frame_8h_source.html#l00310">AST_CONTROL_RADIO_UNKEY</a>, <a class="el" href="frame_8h_source.html#l00300">AST_CONTROL_RINGING</a>, <a class="el" href="frame_8h_source.html#l00314">AST_CONTROL_UNHOLD</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="dsp_8c_source.html#l01676">ast_dsp_get_tcount()</a>, <a class="el" href="dsp_8c_source.html#l01671">ast_dsp_get_tstate()</a>, <a class="el" href="dsp_8c_source.html#l01306">ast_dsp_process()</a>, <a class="el" href="dsp_8c_source.html#l01540">ast_dsp_set_features()</a>, <a class="el" href="dsp_8c_source.html#l01666">ast_dsp_was_muted()</a>, <a class="el" href="channel_8h_source.html#l00527">AST_FLAG_BLOCKING</a>, <a class="el" href="channel_8h_source.html#l00531">AST_FLAG_EXCEPTION</a>, <a class="el" href="frame_8h_source.html#l00247">AST_FORMAT_ALAW</a>, <a class="el" href="frame_8h_source.html#l00253">AST_FORMAT_SLINEAR</a>, <a class="el" href="frame_8h_source.html#l00245">AST_FORMAT_ULAW</a>, <a class="el" href="frame_8h_source.html#l00105">AST_FRAME_CONTROL</a>, <a class="el" href="frame_8h_source.html#l00124">AST_FRAME_DTMF</a>, <a class="el" href="frame_8h_source.html#l00107">AST_FRAME_NULL</a>, <a class="el" href="frame_8h_source.html#l00111">AST_FRAME_TEXT</a>, <a class="el" href="frame_8h_source.html#l00101">AST_FRAME_VOICE</a>, <a class="el" href="frame_8h_source.html#l00203">AST_FRIENDLY_OFFSET</a>, <a class="el" href="frame_8c_source.html#l00573">ast_getformatname()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01722">ast_mutex_trylock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="frame_8c_source.html#l00124">ast_null_frame</a>, <a class="el" href="channel_8c_source.html#l04670">ast_set_callerid()</a>, <a class="el" href="utils_8h_source.html#l00068">ast_set_flag</a>, <a class="el" href="channel_8c_source.html#l04695">ast_setstate()</a>, <a class="el" href="channel_8h_source.html#l00362">AST_STATE_DIALING</a>, <a class="el" href="channel_8h_source.html#l00364">AST_STATE_RINGING</a>, <a class="el" href="channel_8h_source.html#l00365">AST_STATE_UP</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="time_8h_source.html#l00164">ast_tv()</a>, <a class="el" href="time_8h_source.html#l00089">ast_tvdiff_ms()</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="chan__dahdi_8c_source.html#l00610">dahdi_subchannel::buffer</a>, <a class="el" href="chan__dahdi_8c_source.html#l00703">dahdi_pvt::busydetect</a>, <a class="el" href="chan__dahdi_8c_source.html#l01104">dahdi_pvt::callprogress</a>, <a class="el" href="chan__dahdi_8c_source.html#l01070">dahdi_pvt::callwaitcas</a>, <a class="el" href="chan__dahdi_8c_source.html#l01047">dahdi_pvt::callwaitingrepeat</a>, <a class="el" href="chan__dahdi_8c_source.html#l01072">dahdi_pvt::callwaitrings</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="lock_8h_source.html#l01671">CHANNEL_DEADLOCK_AVOIDANCE</a>, <a class="el" href="channel_8h_source.html#l01763">CHECK_BLOCKING</a>, <a class="el" href="chan__dahdi_8c_source.html#l01048">dahdi_pvt::cidcwexpire</a>, <a class="el" href="chan__dahdi_8c_source.html#l01146">dahdi_pvt::cidrings</a>, <a class="el" href="chan__dahdi_8c_source.html#l01050">dahdi_pvt::cidspill</a>, <a class="el" href="chan__dahdi_8c_source.html#l03059">dahdi_callwait()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02880">dahdi_confmute()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01503">dahdi_get_index()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05607">dahdi_handle_dtmfup()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00288">DAHDI_OVERLAPDIAL_INCOMING</a>, <a class="el" href="chan__dahdi_8c_source.html#l00287">DAHDI_OVERLAPDIAL_OUTGOING</a>, <a class="el" href="chan__dahdi_8c_source.html#l02165">dahdi_setlinear()</a>, <a class="el" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">ast_frame::data</a>, <a class="el" href="frame_8h_source.html#l00147">ast_frame::datalen</a>, <a class="el" href="frame_8h_source.html#l00161">ast_frame::delivery</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="chan__dahdi_8c_source.html#l00745">dahdi_pvt::dialing</a>, <a class="el" href="chan__dahdi_8c_source.html#l01116">dahdi_pvt::dop</a>, <a class="el" href="chan__dahdi_8c_source.html#l01113">dahdi_pvt::dsp</a>, <a class="el" href="dsp_8h_source.html#l00044">DSP_FEATURE_WAITDIALTONE</a>, <a class="el" href="chan__dahdi_8c_source.html#l01179">dahdi_pvt::dsp_features</a>, <a class="el" href="dsp_8h_source.html#l00052">DSP_TONE_STATE_DIALTONE</a>, <a class="el" href="dsp_8h_source.html#l00051">DSP_TONE_STATE_RINGING</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="chan__dahdi_8c_source.html#l00611">dahdi_subchannel::f</a>, <a class="el" href="chan__dahdi_8c_source.html#l01149">dahdi_pvt::fake_event</a>, <a class="el" href="chan__dahdi_8c_source.html#l00767">dahdi_pvt::firstradio</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="chan__dahdi_8c_source.html#l00789">dahdi_pvt::ignoredtmf</a>, <a class="el" href="chan__dahdi_8c_source.html#l00797">dahdi_pvt::inalarm</a>, <a class="el" href="chan__dahdi_8c_source.html#l00621">dahdi_subchannel::inthreeway</a>, <a class="el" href="chan__dahdi_8c_source.html#l01005">dahdi_pvt::lastcid_name</a>, <a class="el" href="chan__dahdi_8c_source.html#l01003">dahdi_pvt::lastcid_num</a>, <a class="el" href="chan__dahdi_8c_source.html#l00620">dahdi_subchannel::linear</a>, <a class="el" href="chan__dahdi_8c_source.html#l00649">dahdi_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00119">LOG_DEBUG</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="frame_8h_source.html#l00151">ast_frame::mallocd</a>, <a class="el" href="chan__dahdi_8c_source.html#l01229">dahdi_pvt::muting</a>, <a class="el" href="chan__dahdi_8c_source.html#l00616">dahdi_subchannel::needanswer</a>, <a class="el" href="chan__dahdi_8c_source.html#l00613">dahdi_subchannel::needbusy</a>, <a class="el" href="chan__dahdi_8c_source.html#l00615">dahdi_subchannel::needcallerid</a>, <a class="el" href="chan__dahdi_8c_source.html#l00614">dahdi_subchannel::needcongestion</a>, <a class="el" href="chan__dahdi_8c_source.html#l00617">dahdi_subchannel::needflash</a>, <a class="el" href="chan__dahdi_8c_source.html#l00618">dahdi_subchannel::needhold</a>, <a class="el" href="chan__dahdi_8c_source.html#l00612">dahdi_subchannel::needringing</a>, <a class="el" href="chan__dahdi_8c_source.html#l00619">dahdi_subchannel::needunhold</a>, <a class="el" href="frame_8h_source.html#l00155">ast_frame::offset</a>, <a class="el" href="chan__dahdi_8c_source.html#l00673">dahdi_pvt::oprmode</a>, <a class="el" href="chan__dahdi_8c_source.html#l00801">dahdi_pvt::outgoing</a>, <a class="el" href="chan__dahdi_8c_source.html#l00650">dahdi_pvt::owner</a>, <a class="el" href="frame_8h_source.html#l00159">ast_frame::ptr</a>, <a class="el" href="chan__dahdi_8c_source.html#l00830">dahdi_pvt::pulsedial</a>, <a class="el" href="chan__dahdi_8c_source.html#l00671">dahdi_pvt::radio</a>, <a class="el" href="channel_8h_source.html#l00485">ast_channel::rawreadformat</a>, <a class="el" href="chan__dahdi_8c_source.html#l00397">READ_SIZE</a>, <a class="el" href="chan__dahdi_8c_source.html#l02969">restore_conference()</a>, <a class="el" href="channel_8h_source.html#l00470">ast_channel::rings</a>, <a class="el" href="chan__dahdi_8c_source.html#l01056">dahdi_pvt::ringt</a>, <a class="el" href="strings_8h_source.html#l00072">S_OR</a>, <a class="el" href="frame_8h_source.html#l00149">ast_frame::samples</a>, <a class="el" href="chan__dahdi_8c_source.html#l03026">send_callerid()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00666">dahdi_pvt::sig</a>, <a class="el" href="chan__dahdi_8c_source.html#l00256">SIG_BRI</a>, <a class="el" href="chan__dahdi_8c_source.html#l00257">SIG_BRI_PTMP</a>, <a class="el" href="chan__dahdi_8c_source.html#l00255">SIG_PRI</a>, <a class="el" href="frame_8h_source.html#l00157">ast_frame::src</a>, <a class="el" href="chan__dahdi_8c_source.html#l00580">SUB_CALLWAIT</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>, <a class="el" href="chan__dahdi_8c_source.html#l01122">dahdi_pvt::tdd</a>, <a class="el" href="tdd_8c_source.html#l00156">tdd_feed()</a>, <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>, <a class="el" href="chan__dahdi_8c_source.html#l01109">dahdi_pvt::waitfordialtone</a>, and <a class="el" href="chan__dahdi_8c_source.html#l01110">dahdi_pvt::waitingfordt</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l06718"></a>06718 {
<a name="l06719"></a>06719    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *p = ast-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l06720"></a>06720    <span class="keywordtype">int</span> res;
<a name="l06721"></a>06721    <span class="keywordtype">int</span> idx;
<a name="l06722"></a>06722    <span class="keywordtype">void</span> *readbuf;
<a name="l06723"></a>06723    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l06724"></a>06724 
<a name="l06725"></a>06725    <span class="keywordflow">while</span> (<a class="code" href="lock_8h.html#a036ccafa2339f674a46bc269bbd48c5f">ast_mutex_trylock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>)) {
<a name="l06726"></a>06726       <a class="code" href="lock_8h.html#a7b1d6c8183a6f6f42a98239da3d1c7ca">CHANNEL_DEADLOCK_AVOIDANCE</a>(ast);
<a name="l06727"></a>06727    }
<a name="l06728"></a>06728 
<a name="l06729"></a>06729    idx = <a class="code" href="chan__dahdi_8c.html#a62c8e3f411fb9e5ec62a1e77c152c2df">dahdi_get_index</a>(ast, p, 0);
<a name="l06730"></a>06730 
<a name="l06731"></a>06731    <span class="comment">/* Hang up if we don&apos;t really exist */</span>
<a name="l06732"></a>06732    <span class="keywordflow">if</span> (idx &lt; 0)   {
<a name="l06733"></a>06733       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;We dont exist?\n&quot;</span>);
<a name="l06734"></a>06734       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l06735"></a>06735       <span class="keywordflow">return</span> NULL;
<a name="l06736"></a>06736    }
<a name="l06737"></a>06737 
<a name="l06738"></a>06738    <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structdahdi__pvt.html#ac53b42243ee40edc74b615fe86806fe3" title="Nonzero if the signaling type is sent over a radio.">radio</a> || (p-&gt;<a class="code" href="structdahdi__pvt.html#a3b3cefe7a33d0cff61f3a2b5955b6c8b">oprmode</a> &lt; 0)) &amp;&amp; p-&gt;<a class="code" href="structdahdi__pvt.html#adbe10c4b12619d6cb58b1ad14bc437af" title="TRUE if in an alarm condition.">inalarm</a>) {
<a name="l06739"></a>06739       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l06740"></a>06740       <span class="keywordflow">return</span> NULL;
<a name="l06741"></a>06741    }
<a name="l06742"></a>06742 
<a name="l06743"></a>06743    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a29ff71f9d5c7927906ebd437fe372056">AST_FRAME_NULL</a>;
<a name="l06744"></a>06744    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> = 0;
<a name="l06745"></a>06745    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a> = 0;
<a name="l06746"></a>06746    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#aed16590d48f41d89f31e0cf347f5cd99">mallocd</a> = 0;
<a name="l06747"></a>06747    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#aed7ea92f45bd273dde380a45ddced592">offset</a> = 0;
<a name="l06748"></a>06748    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = 0;
<a name="l06749"></a>06749    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a41a708025486b4c9383e7432e9ba3f0e">delivery</a> = <a class="code" href="time_8h.html#af46dec59fc43982d018a757f7b499669" title="Returns a timeval from sec, usec.">ast_tv</a>(0,0);
<a name="l06750"></a>06750    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#af51e37c9331049b1e3d250a7c8bc3c26">src</a> = <span class="stringliteral">&quot;dahdi_read&quot;</span>;
<a name="l06751"></a>06751    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a> = NULL;
<a name="l06752"></a>06752 
<a name="l06753"></a>06753    <span class="comment">/* make sure it sends initial key state as first frame */</span>
<a name="l06754"></a>06754    <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structdahdi__pvt.html#ac53b42243ee40edc74b615fe86806fe3" title="Nonzero if the signaling type is sent over a radio.">radio</a> || (p-&gt;<a class="code" href="structdahdi__pvt.html#a3b3cefe7a33d0cff61f3a2b5955b6c8b">oprmode</a> &lt; 0)) &amp;&amp; (!p-&gt;<a class="code" href="structdahdi__pvt.html#a8537a72727d120580515b6c8108ac0b0" title="TRUE if over a radio and dahdi_read() has been called.">firstradio</a>))
<a name="l06755"></a>06755    {
<a name="l06756"></a>06756       <span class="keyword">struct </span>dahdi_params <a class="code" href="chan__usbradio_8c.html#ae320c29b526039fbf085fc7337bb2265">ps</a>;
<a name="l06757"></a>06757 
<a name="l06758"></a>06758       memset(&amp;<a class="code" href="chan__usbradio_8c.html#ae320c29b526039fbf085fc7337bb2265">ps</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="chan__usbradio_8c.html#ae320c29b526039fbf085fc7337bb2265">ps</a>));
<a name="l06759"></a>06759       <a class="code" href="chan__usbradio_8c.html#ae320c29b526039fbf085fc7337bb2265">ps</a>.channo = p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>;
<a name="l06760"></a>06760       <span class="keywordflow">if</span> (ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_GET_PARAMS, &amp;<a class="code" href="chan__usbradio_8c.html#ae320c29b526039fbf085fc7337bb2265">ps</a>) &lt; 0) {
<a name="l06761"></a>06761          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l06762"></a>06762          <span class="keywordflow">return</span> NULL;
<a name="l06763"></a>06763       }
<a name="l06764"></a>06764       p-&gt;<a class="code" href="structdahdi__pvt.html#a8537a72727d120580515b6c8108ac0b0" title="TRUE if over a radio and dahdi_read() has been called.">firstradio</a> = 1;
<a name="l06765"></a>06765       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>;
<a name="l06766"></a>06766       <span class="keywordflow">if</span> (<a class="code" href="chan__usbradio_8c.html#ae320c29b526039fbf085fc7337bb2265">ps</a>.rxisoffhook)
<a name="l06767"></a>06767       {
<a name="l06768"></a>06768          p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aacb7ddf1a95fa544fdecada68213f3c7">AST_CONTROL_RADIO_KEY</a>;
<a name="l06769"></a>06769       }
<a name="l06770"></a>06770       <span class="keywordflow">else</span>
<a name="l06771"></a>06771       {
<a name="l06772"></a>06772          p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a34ac3ccebc219c59daa7eb0275fcd54d">AST_CONTROL_RADIO_UNKEY</a>;
<a name="l06773"></a>06773       }
<a name="l06774"></a>06774       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l06775"></a>06775       <span class="keywordflow">return</span> &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>;
<a name="l06776"></a>06776    }
<a name="l06777"></a>06777    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a2ecae7dca8c46e1948d9117eee9a15e4" title="Ring timeout timer??">ringt</a> == 1) {
<a name="l06778"></a>06778       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l06779"></a>06779       <span class="keywordflow">return</span> NULL;
<a name="l06780"></a>06780    }
<a name="l06781"></a>06781    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a2ecae7dca8c46e1948d9117eee9a15e4" title="Ring timeout timer??">ringt</a> &gt; 0)
<a name="l06782"></a>06782       p-&gt;<a class="code" href="structdahdi__pvt.html#a2ecae7dca8c46e1948d9117eee9a15e4" title="Ring timeout timer??">ringt</a>--;
<a name="l06783"></a>06783 
<a name="l06784"></a>06784 <span class="preprocessor">#ifdef HAVE_OPENR2</span>
<a name="l06785"></a>06785 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (p-&gt;mfcr2) {
<a name="l06786"></a>06786       openr2_chan_process_event(p-&gt;r2chan);
<a name="l06787"></a>06787    }
<a name="l06788"></a>06788 <span class="preprocessor">#endif</span>
<a name="l06789"></a>06789 <span class="preprocessor"></span>
<a name="l06790"></a>06790    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a0b09a2171a877eaadb67da4f5639abc4">needringing</a>) {
<a name="l06791"></a>06791       <span class="comment">/* Send ringing frame if requested */</span>
<a name="l06792"></a>06792       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a0b09a2171a877eaadb67da4f5639abc4">needringing</a> = 0;
<a name="l06793"></a>06793       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>;
<a name="l06794"></a>06794       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa5814e690c23b590bcd4eb43535907a1">AST_CONTROL_RINGING</a>;
<a name="l06795"></a>06795       <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(ast, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa">AST_STATE_RINGING</a>);
<a name="l06796"></a>06796       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l06797"></a>06797       <span class="keywordflow">return</span> &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>;
<a name="l06798"></a>06798    }
<a name="l06799"></a>06799 
<a name="l06800"></a>06800    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#acff5e006a504c765d6519826b2eedfbb">needbusy</a>) {
<a name="l06801"></a>06801       <span class="comment">/* Send busy frame if requested */</span>
<a name="l06802"></a>06802       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#acff5e006a504c765d6519826b2eedfbb">needbusy</a> = 0;
<a name="l06803"></a>06803       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>;
<a name="l06804"></a>06804       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a387635982df3d2edb669a1eece92c875">AST_CONTROL_BUSY</a>;
<a name="l06805"></a>06805       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l06806"></a>06806       <span class="keywordflow">return</span> &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>;
<a name="l06807"></a>06807    }
<a name="l06808"></a>06808 
<a name="l06809"></a>06809    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#aef1968b7fea4a1850482539b046f0f96">needcongestion</a>) {
<a name="l06810"></a>06810       <span class="comment">/* Send congestion frame if requested */</span>
<a name="l06811"></a>06811       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#aef1968b7fea4a1850482539b046f0f96">needcongestion</a> = 0;
<a name="l06812"></a>06812       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>;
<a name="l06813"></a>06813       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a850bb06a1702741c93a3fd67cc9637ab">AST_CONTROL_CONGESTION</a>;
<a name="l06814"></a>06814       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l06815"></a>06815       <span class="keywordflow">return</span> &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>;
<a name="l06816"></a>06816    }
<a name="l06817"></a>06817 
<a name="l06818"></a>06818    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#acdc708c228fb207718ea0a3bae497d26">needcallerid</a>) {
<a name="l06819"></a>06819       <a class="code" href="channel_8h.html#a88d833a56ea7de33e230281c5c12b75d" title="Set caller ID number, name and ANI.">ast_set_callerid</a>(ast, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ac6d55b34cf1c26bff3d105f067f16439" title="Last Caller ID number from an incoming call.">lastcid_num</a>, NULL),
<a name="l06820"></a>06820                      <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a9ad2b3a8d00e47a81f82e038fc672348" title="Last Caller ID name from an incoming call.">lastcid_name</a>, NULL),
<a name="l06821"></a>06821                      <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ac6d55b34cf1c26bff3d105f067f16439" title="Last Caller ID number from an incoming call.">lastcid_num</a>, NULL)
<a name="l06822"></a>06822                      );
<a name="l06823"></a>06823       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#acdc708c228fb207718ea0a3bae497d26">needcallerid</a> = 0;
<a name="l06824"></a>06824    }
<a name="l06825"></a>06825 
<a name="l06826"></a>06826    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a00bf8ced61d8f8736d6dc3b769609600">needanswer</a>) {
<a name="l06827"></a>06827       <span class="comment">/* Send answer frame if requested */</span>
<a name="l06828"></a>06828       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a00bf8ced61d8f8736d6dc3b769609600">needanswer</a> = 0;
<a name="l06829"></a>06829       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>;
<a name="l06830"></a>06830       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe">AST_CONTROL_ANSWER</a>;
<a name="l06831"></a>06831       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l06832"></a>06832       <span class="keywordflow">return</span> &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>;
<a name="l06833"></a>06833    }
<a name="l06834"></a>06834 <span class="preprocessor">#ifdef HAVE_OPENR2</span>
<a name="l06835"></a>06835 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (p-&gt;mfcr2 &amp;&amp; openr2_chan_get_read_enabled(p-&gt;r2chan)) {
<a name="l06836"></a>06836       <span class="comment">/* openr2 took care of reading and handling any event</span>
<a name="l06837"></a>06837 <span class="comment">        (needanswer, needbusy etc), if we continue we will read()</span>
<a name="l06838"></a>06838 <span class="comment">        twice, lets just return a null frame. This should only</span>
<a name="l06839"></a>06839 <span class="comment">        happen when openr2 is dialing out */</span>
<a name="l06840"></a>06840       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l06841"></a>06841       <span class="keywordflow">return</span> &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l06842"></a>06842    }
<a name="l06843"></a>06843 <span class="preprocessor">#endif</span>
<a name="l06844"></a>06844 <span class="preprocessor"></span>
<a name="l06845"></a>06845    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#ac6be644690e708e0af41b0e75f6a1e73">needflash</a>) {
<a name="l06846"></a>06846       <span class="comment">/* Send answer frame if requested */</span>
<a name="l06847"></a>06847       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#ac6be644690e708e0af41b0e75f6a1e73">needflash</a> = 0;
<a name="l06848"></a>06848       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>;
<a name="l06849"></a>06849       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390ae8f2cd460fdc81e0a774434fa002e4bf">AST_CONTROL_FLASH</a>;
<a name="l06850"></a>06850       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l06851"></a>06851       <span class="keywordflow">return</span> &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>;
<a name="l06852"></a>06852    }
<a name="l06853"></a>06853 
<a name="l06854"></a>06854    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a5efa58bfc75868fa24e748d4be6643d5">needhold</a>) {
<a name="l06855"></a>06855       <span class="comment">/* Send answer frame if requested */</span>
<a name="l06856"></a>06856       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a5efa58bfc75868fa24e748d4be6643d5">needhold</a> = 0;
<a name="l06857"></a>06857       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>;
<a name="l06858"></a>06858       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390ab99a3d1c08c5ae8bca078c7cd1ec02f5">AST_CONTROL_HOLD</a>;
<a name="l06859"></a>06859       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l06860"></a>06860       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Sending hold on &apos;%s&apos;\n&quot;</span>, ast-&gt;name);
<a name="l06861"></a>06861       <span class="keywordflow">return</span> &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>;
<a name="l06862"></a>06862    }
<a name="l06863"></a>06863 
<a name="l06864"></a>06864    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a65087932715c9dad92fb135aac7f3fac">needunhold</a>) {
<a name="l06865"></a>06865       <span class="comment">/* Send answer frame if requested */</span>
<a name="l06866"></a>06866       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a65087932715c9dad92fb135aac7f3fac">needunhold</a> = 0;
<a name="l06867"></a>06867       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>;
<a name="l06868"></a>06868       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a3e7629b5f7e39f1cc8ad2e51e266f91e">AST_CONTROL_UNHOLD</a>;
<a name="l06869"></a>06869       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l06870"></a>06870       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Sending unhold on &apos;%s&apos;\n&quot;</span>, ast-&gt;name);
<a name="l06871"></a>06871       <span class="keywordflow">return</span> &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>;
<a name="l06872"></a>06872    }
<a name="l06873"></a>06873 
<a name="l06874"></a>06874    <span class="keywordflow">if</span> (ast-&gt;<a class="code" href="structast__channel.html#a6fcf944239e3718e282e0ba7512e66c6">rawreadformat</a> == <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>) {
<a name="l06875"></a>06875       <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a2de30c0a559b0df57ba137153a1370ea">linear</a>) {
<a name="l06876"></a>06876          p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a2de30c0a559b0df57ba137153a1370ea">linear</a> = 1;
<a name="l06877"></a>06877          res = <a class="code" href="chan__dahdi_8c.html#a8392b32cf7d3daa7b45154b7001460df">dahdi_setlinear</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a2de30c0a559b0df57ba137153a1370ea">linear</a>);
<a name="l06878"></a>06878          <span class="keywordflow">if</span> (res)
<a name="l06879"></a>06879             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to set channel %d (index %d) to linear mode.\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, idx);
<a name="l06880"></a>06880       }
<a name="l06881"></a>06881    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((ast-&gt;<a class="code" href="structast__channel.html#a6fcf944239e3718e282e0ba7512e66c6">rawreadformat</a> == <a class="code" href="frame_8h.html#ab602cf455d4a96a3adba2e3ba8cd2b2c">AST_FORMAT_ULAW</a>) ||
<a name="l06882"></a>06882       (ast-&gt;<a class="code" href="structast__channel.html#a6fcf944239e3718e282e0ba7512e66c6">rawreadformat</a> == <a class="code" href="frame_8h.html#aa58cc980a9c9108522effc64e9aff2d6">AST_FORMAT_ALAW</a>)) {
<a name="l06883"></a>06883       <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a2de30c0a559b0df57ba137153a1370ea">linear</a>) {
<a name="l06884"></a>06884          p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a2de30c0a559b0df57ba137153a1370ea">linear</a> = 0;
<a name="l06885"></a>06885          res = <a class="code" href="chan__dahdi_8c.html#a8392b32cf7d3daa7b45154b7001460df">dahdi_setlinear</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a2de30c0a559b0df57ba137153a1370ea">linear</a>);
<a name="l06886"></a>06886          <span class="keywordflow">if</span> (res)
<a name="l06887"></a>06887             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to set channel %d (index %d) to companded mode.\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, idx);
<a name="l06888"></a>06888       }
<a name="l06889"></a>06889    } <span class="keywordflow">else</span> {
<a name="l06890"></a>06890       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Don&apos;t know how to read frames in format %s\n&quot;</span>, <a class="code" href="frame_8h.html#afe8f690984f8ba95cd01a431198c10bf" title="Get the name of a format.">ast_getformatname</a>(ast-&gt;<a class="code" href="structast__channel.html#a6fcf944239e3718e282e0ba7512e66c6">rawreadformat</a>));
<a name="l06891"></a>06891       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l06892"></a>06892       <span class="keywordflow">return</span> NULL;
<a name="l06893"></a>06893    }
<a name="l06894"></a>06894    readbuf = ((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#ad495085900b55600be8a256a56ad1e97">buffer</a>) + <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>;
<a name="l06895"></a>06895    <a class="code" href="channel_8h.html#a3a5d847510a477edda3d0bc1459709f4">CHECK_BLOCKING</a>(ast);
<a name="l06896"></a>06896    res = read(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, readbuf, p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a2de30c0a559b0df57ba137153a1370ea">linear</a> ? <a class="code" href="chan__dahdi_8c.html#a86e1969b50e55e5d506233078ca0fa4c">READ_SIZE</a> * 2 : <a class="code" href="chan__dahdi_8c.html#a86e1969b50e55e5d506233078ca0fa4c">READ_SIZE</a>);
<a name="l06897"></a>06897    <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(ast, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329ab5b2bec9425dd0cfc789d96ef229cb3a">AST_FLAG_BLOCKING</a>);
<a name="l06898"></a>06898    <span class="comment">/* Check for hangup */</span>
<a name="l06899"></a>06899    <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l06900"></a>06900       f = NULL;
<a name="l06901"></a>06901       <span class="keywordflow">if</span> (res == -1) {
<a name="l06902"></a>06902          <span class="keywordflow">if</span> (errno == EAGAIN) {
<a name="l06903"></a>06903             <span class="comment">/* Return &quot;NULL&quot; frame if there is nobody there */</span>
<a name="l06904"></a>06904             <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l06905"></a>06905             <span class="keywordflow">return</span> &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>;
<a name="l06906"></a>06906          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (errno == ELAST) {
<a name="l06907"></a>06907             f = <a class="code" href="chan__dahdi_8c.html#afa1252981be0ae4165d3ff5993f9f9f1">__dahdi_exception</a>(ast);
<a name="l06908"></a>06908          } <span class="keywordflow">else</span>
<a name="l06909"></a>06909             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;dahdi_rec: %s\n&quot;</span>, strerror(errno));
<a name="l06910"></a>06910       }
<a name="l06911"></a>06911       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l06912"></a>06912       <span class="keywordflow">return</span> f;
<a name="l06913"></a>06913    }
<a name="l06914"></a>06914    <span class="keywordflow">if</span> (res != (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a2de30c0a559b0df57ba137153a1370ea">linear</a> ? <a class="code" href="chan__dahdi_8c.html#a86e1969b50e55e5d506233078ca0fa4c">READ_SIZE</a> * 2 : <a class="code" href="chan__dahdi_8c.html#a86e1969b50e55e5d506233078ca0fa4c">READ_SIZE</a>)) {
<a name="l06915"></a>06915       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Short read (%d/%d), must be an event...\n&quot;</span>, res, p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a2de30c0a559b0df57ba137153a1370ea">linear</a> ? READ_SIZE * 2 : READ_SIZE);
<a name="l06916"></a>06916       f = <a class="code" href="chan__dahdi_8c.html#afa1252981be0ae4165d3ff5993f9f9f1">__dahdi_exception</a>(ast);
<a name="l06917"></a>06917       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l06918"></a>06918       <span class="keywordflow">return</span> f;
<a name="l06919"></a>06919    }
<a name="l06920"></a>06920    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a2042629f86bb4c3dbb7185ed0701e4ca">tdd</a>) { <span class="comment">/* if in TDD mode, see if we receive that */</span>
<a name="l06921"></a>06921       <span class="keywordtype">int</span> c;
<a name="l06922"></a>06922 
<a name="l06923"></a>06923       c = <a class="code" href="tdd_8h.html#afec1235e43c521e80f43b8074bfb7b7d">tdd_feed</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a2042629f86bb4c3dbb7185ed0701e4ca">tdd</a>,readbuf,READ_SIZE);
<a name="l06924"></a>06924       <span class="keywordflow">if</span> (c &lt; 0) {
<a name="l06925"></a>06925          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1,<span class="stringliteral">&quot;tdd_feed failed\n&quot;</span>);
<a name="l06926"></a>06926          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l06927"></a>06927          <span class="keywordflow">return</span> NULL;
<a name="l06928"></a>06928       }
<a name="l06929"></a>06929       <span class="keywordflow">if</span> (c) { <span class="comment">/* if a char to return */</span>
<a name="l06930"></a>06930          p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = 0;
<a name="l06931"></a>06931          p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0af7728b18670d3cd075f63d67f8867078">AST_FRAME_TEXT</a>;
<a name="l06932"></a>06932          p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#aed16590d48f41d89f31e0cf347f5cd99">mallocd</a> = 0;
<a name="l06933"></a>06933          p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#aed7ea92f45bd273dde380a45ddced592">offset</a> = <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>;
<a name="l06934"></a>06934          p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a> = p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#ad495085900b55600be8a256a56ad1e97">buffer</a> + <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>;
<a name="l06935"></a>06935          p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> = 1;
<a name="l06936"></a>06936          *((<span class="keywordtype">char</span> *) p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>) = c;
<a name="l06937"></a>06937          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l06938"></a>06938          <span class="keywordflow">return</span> &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>;
<a name="l06939"></a>06939       }
<a name="l06940"></a>06940    }
<a name="l06941"></a>06941    <span class="comment">/* Ensure the CW timer decrements only on a single subchannel */</span>
<a name="l06942"></a>06942    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#acb6666d113ea3605f76a45fe3e90e192">callwaitingrepeat</a> &amp;&amp; <a class="code" href="chan__dahdi_8c.html#a62c8e3f411fb9e5ec62a1e77c152c2df">dahdi_get_index</a>(ast, p, 1) == <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>) {
<a name="l06943"></a>06943       p-&gt;<a class="code" href="structdahdi__pvt.html#acb6666d113ea3605f76a45fe3e90e192">callwaitingrepeat</a>--;
<a name="l06944"></a>06944    }
<a name="l06945"></a>06945    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#ac8c4841c7cad35c09ddbd28ede1c4cfe">cidcwexpire</a>)
<a name="l06946"></a>06946       p-&gt;<a class="code" href="structdahdi__pvt.html#ac8c4841c7cad35c09ddbd28ede1c4cfe">cidcwexpire</a>--;
<a name="l06947"></a>06947    <span class="comment">/* Repeat callwaiting */</span>
<a name="l06948"></a>06948    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#acb6666d113ea3605f76a45fe3e90e192">callwaitingrepeat</a> == 1) {
<a name="l06949"></a>06949       p-&gt;<a class="code" href="structdahdi__pvt.html#a9c8a40476c67374b9150fcbbb4b993af" title="Number of call waiting rings.">callwaitrings</a>++;
<a name="l06950"></a>06950       <a class="code" href="chan__dahdi_8c.html#a5492a7d85ebc949f2277cd55fbc3febe">dahdi_callwait</a>(ast);
<a name="l06951"></a>06951    }
<a name="l06952"></a>06952    <span class="comment">/* Expire CID/CW */</span>
<a name="l06953"></a>06953    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#ac8c4841c7cad35c09ddbd28ede1c4cfe">cidcwexpire</a> == 1) {
<a name="l06954"></a>06954       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;CPE does not support Call Waiting Caller*ID.\n&quot;</span>);
<a name="l06955"></a>06955       <a class="code" href="chan__dahdi_8c.html#a128443b4d6aa50b91bcd4668d582095f">restore_conference</a>(p);
<a name="l06956"></a>06956    }
<a name="l06957"></a>06957    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a2de30c0a559b0df57ba137153a1370ea">linear</a>) {
<a name="l06958"></a>06958       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> = READ_SIZE * 2;
<a name="l06959"></a>06959    } <span class="keywordflow">else</span>
<a name="l06960"></a>06960       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> = READ_SIZE;
<a name="l06961"></a>06961 
<a name="l06962"></a>06962    <span class="comment">/* Handle CallerID Transmission */</span>
<a name="l06963"></a>06963    <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> == ast) &amp;&amp; p-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a> &amp;&amp;((ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>) || (ast-&gt;<a class="code" href="structast__channel.html#a358fd14658a0c5276190e48f1b1f251a">rings</a> == p-&gt;<a class="code" href="structdahdi__pvt.html#a7ca7134673ead6f14bc255488c0ac15f">cidrings</a>))) {
<a name="l06964"></a>06964       <a class="code" href="chan__dahdi_8c.html#ae39659603ab09eecffce6638832c5b73">send_callerid</a>(p);
<a name="l06965"></a>06965    }
<a name="l06966"></a>06966 
<a name="l06967"></a>06967    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>;
<a name="l06968"></a>06968    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = ast-&gt;<a class="code" href="structast__channel.html#a6fcf944239e3718e282e0ba7512e66c6">rawreadformat</a>;
<a name="l06969"></a>06969    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a> = READ_SIZE;
<a name="l06970"></a>06970    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#aed16590d48f41d89f31e0cf347f5cd99">mallocd</a> = 0;
<a name="l06971"></a>06971    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#aed7ea92f45bd273dde380a45ddced592">offset</a> = <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>;
<a name="l06972"></a>06972    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a> = p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#ad495085900b55600be8a256a56ad1e97">buffer</a> + <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a> / <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#ad495085900b55600be8a256a56ad1e97">buffer</a>[0]);
<a name="l06973"></a>06973 <span class="preprocessor">#if 0</span>
<a name="l06974"></a>06974 <span class="preprocessor"></span>   <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Read %d of voice on %s\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>, ast-&gt;name);
<a name="l06975"></a>06975 <span class="preprocessor">#endif</span>
<a name="l06976"></a>06976 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#af17335c0c7a4c1e03e987a33f6eec81b" title="TRUE if in the process of dialing digits or sending something.">dialing</a> || <span class="comment">/* Transmitting something */</span>
<a name="l06977"></a>06977       (idx &amp;&amp; (ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>)) || <span class="comment">/* Three-way or callwait that isn&apos;t up */</span>
<a name="l06978"></a>06978       ((idx == <a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>) &amp;&amp; !p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a>) <span class="comment">/* Inactive and non-confed call-wait */</span>
<a name="l06979"></a>06979       ) {
<a name="l06980"></a>06980       <span class="comment">/* Whoops, we&apos;re still dialing, or in a state where we shouldn&apos;t transmit....</span>
<a name="l06981"></a>06981 <span class="comment">         don&apos;t send anything */</span>
<a name="l06982"></a>06982       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a29ff71f9d5c7927906ebd437fe372056">AST_FRAME_NULL</a>;
<a name="l06983"></a>06983       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = 0;
<a name="l06984"></a>06984       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a> = 0;
<a name="l06985"></a>06985       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#aed16590d48f41d89f31e0cf347f5cd99">mallocd</a> = 0;
<a name="l06986"></a>06986       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#aed7ea92f45bd273dde380a45ddced592">offset</a> = 0;
<a name="l06987"></a>06987       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a> = NULL;
<a name="l06988"></a>06988       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>.<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>= 0;
<a name="l06989"></a>06989    }
<a name="l06990"></a>06990    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a> &amp;&amp; (!p-&gt;<a class="code" href="structdahdi__pvt.html#a1caa9d0f8fb61da132fe2a1aa69d1973" title="TRUE if DTMF detection is disabled.">ignoredtmf</a> || p-&gt;<a class="code" href="structdahdi__pvt.html#a7a4e9b0410dd0636d8f10df9ff51e0a3" title="BOOLEAN. XXX Meaning what??">callwaitcas</a> || p-&gt;<a class="code" href="structdahdi__pvt.html#ab86910b871c8cff810ab15a587a1ed3b" title="TRUE if busy detection is enabled. (Listens for the beep-beep busy pattern.).">busydetect</a> || p-&gt;<a class="code" href="structdahdi__pvt.html#a79710add069e32170f03d92067ec3877" title="Bitmapped call progress detection flags. CALLPROGRESS_xxx values.">callprogress</a> || p-&gt;<a class="code" href="structdahdi__pvt.html#ab9aab7a638e67037d3b01f381ed4beae">waitingfordt</a>.tv_sec) &amp;&amp; !idx) {
<a name="l06991"></a>06991       <span class="comment">/* Perform busy detection etc on the dahdi line */</span>
<a name="l06992"></a>06992       <span class="keywordtype">int</span> mute;
<a name="l06993"></a>06993 
<a name="l06994"></a>06994       f = <a class="code" href="dsp_8h.html#ab6387ee12a3544d3d2068db61d9576ad" title="Return AST_FRAME_NULL frames when there is silence, AST_FRAME_BUSY on busies, and...">ast_dsp_process</a>(ast, p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>, &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>);
<a name="l06995"></a>06995 
<a name="l06996"></a>06996       <span class="comment">/* Check if DSP code thinks we should be muting this frame and mute the conference if so */</span>
<a name="l06997"></a>06997       mute = <a class="code" href="dsp_8h.html#ace6f146702ec253a6189176566527d30" title="Returns true if DSP code was muting any fragment of the last processed frame. Muting...">ast_dsp_was_muted</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>);
<a name="l06998"></a>06998       <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#ae6778ad7c2d7a99161a32c9b87eddf85" title="TRUE if confrence is muted.">muting</a> != mute) {
<a name="l06999"></a>06999          p-&gt;<a class="code" href="structdahdi__pvt.html#ae6778ad7c2d7a99161a32c9b87eddf85" title="TRUE if confrence is muted.">muting</a> = mute;
<a name="l07000"></a>07000          <a class="code" href="chan__dahdi_8c.html#a04126d689aca51a8a38499685cffe8f6">dahdi_confmute</a>(p, mute);
<a name="l07001"></a>07001       }
<a name="l07002"></a>07002 
<a name="l07003"></a>07003       <span class="keywordflow">if</span> (f) {
<a name="l07004"></a>07004          <span class="keywordflow">if</span> ((f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>) &amp;&amp; (f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> == <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a387635982df3d2edb669a1eece92c875">AST_CONTROL_BUSY</a>)) {
<a name="l07005"></a>07005             <span class="keywordflow">if</span> ((ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>) &amp;&amp; !p-&gt;<a class="code" href="structdahdi__pvt.html#a40668dcb7d940b80c4f109861059a978" title="TRUE if we originated the call leg.">outgoing</a>) {
<a name="l07006"></a>07006                <span class="comment">/* Treat this as a &quot;hangup&quot; instead of a &quot;busy&quot; on the assumption that</span>
<a name="l07007"></a>07007 <span class="comment">                  a busy */</span>
<a name="l07008"></a>07008                f = NULL;
<a name="l07009"></a>07009             }
<a name="l07010"></a>07010          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#a248afd6c02044259a386f6b7aee922a2">AST_FRAME_DTMF</a>) {
<a name="l07011"></a>07011 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l07012"></a>07012 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (!p-&gt;proceeding &amp;&amp; ((p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#ae9ab0c9508fca045a06730533be276a5">SIG_PRI</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#ab5bfeaf991c23c5b6510ace44ae79ce9">SIG_BRI</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a>)) &amp;&amp; p-&gt;pri &amp;&amp;
<a name="l07013"></a>07013                ((!p-&gt;<a class="code" href="structdahdi__pvt.html#a40668dcb7d940b80c4f109861059a978" title="TRUE if we originated the call leg.">outgoing</a> &amp;&amp; (p-&gt;pri-&gt;overlapdial &amp; <a class="code" href="chan__dahdi_8c.html#ab30dead77fa070cbe51316f43fcea8a2">DAHDI_OVERLAPDIAL_INCOMING</a>)) ||
<a name="l07014"></a>07014                (p-&gt;<a class="code" href="structdahdi__pvt.html#a40668dcb7d940b80c4f109861059a978" title="TRUE if we originated the call leg.">outgoing</a> &amp;&amp; (p-&gt;pri-&gt;overlapdial &amp; <a class="code" href="chan__dahdi_8c.html#a4bccf90ead0cf7c93b177e59cbe5b3be">DAHDI_OVERLAPDIAL_OUTGOING</a>)))) {
<a name="l07015"></a>07015                <span class="comment">/* Don&apos;t accept in-band DTMF when in overlap dial mode */</span>
<a name="l07016"></a>07016                f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a29ff71f9d5c7927906ebd437fe372056">AST_FRAME_NULL</a>;
<a name="l07017"></a>07017                f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = 0;
<a name="l07018"></a>07018             }
<a name="l07019"></a>07019 <span class="preprocessor">#endif</span>
<a name="l07020"></a>07020 <span class="preprocessor"></span>            <span class="comment">/* DSP clears us of being pulse */</span>
<a name="l07021"></a>07021             p-&gt;<a class="code" href="structdahdi__pvt.html#ae56835e2739c5d155391c01485455497" title="TRUE if a pulsed digit was detected. (Pulse dial phone detected).">pulsedial</a> = 0;
<a name="l07022"></a>07022          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#ab9aab7a638e67037d3b01f381ed4beae">waitingfordt</a>.tv_sec) {
<a name="l07023"></a>07023             <span class="keywordflow">if</span> (<a class="code" href="time_8h.html#a74e35cffcd45ad6cd7c8587921e8a4c2" title="Computes the difference (in milliseconds) between two struct timeval instances.">ast_tvdiff_ms</a>(<a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>(), p-&gt;<a class="code" href="structdahdi__pvt.html#ab9aab7a638e67037d3b01f381ed4beae">waitingfordt</a>) &gt;= p-&gt;<a class="code" href="structdahdi__pvt.html#a508c2407a52638696697fdeb08f0b2e5" title="Number of milliseconds to wait for dialtone.">waitfordialtone</a> ) {
<a name="l07024"></a>07024                p-&gt;<a class="code" href="structdahdi__pvt.html#ab9aab7a638e67037d3b01f381ed4beae">waitingfordt</a>.tv_sec = 0;
<a name="l07025"></a>07025                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Never saw dialtone on channel %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l07026"></a>07026                f=NULL;
<a name="l07027"></a>07027             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>) {
<a name="l07028"></a>07028                f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a29ff71f9d5c7927906ebd437fe372056">AST_FRAME_NULL</a>;
<a name="l07029"></a>07029                f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = 0;
<a name="l07030"></a>07030                <span class="keywordflow">if</span> ((<a class="code" href="dsp_8h.html#accae19c5763ae43f0d5cf058f07d8d18" title="Get tstate (Tone State).">ast_dsp_get_tstate</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>) == <a class="code" href="dsp_8h.html#a2aa4a8185d14eb917c5c1fd498b234d6">DSP_TONE_STATE_DIALTONE</a> || <a class="code" href="dsp_8h.html#accae19c5763ae43f0d5cf058f07d8d18" title="Get tstate (Tone State).">ast_dsp_get_tstate</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>) == <a class="code" href="dsp_8h.html#ad2b35b81126d95bb62e32d66ec15d907">DSP_TONE_STATE_RINGING</a>) &amp;&amp; <a class="code" href="dsp_8h.html#a0b5cfada9ab61cee75ac7d006e86d09d" title="Get tcount (Threshold counter).">ast_dsp_get_tcount</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>) &gt; 9) {
<a name="l07031"></a>07031                   p-&gt;<a class="code" href="structdahdi__pvt.html#ab9aab7a638e67037d3b01f381ed4beae">waitingfordt</a>.tv_sec = 0;
<a name="l07032"></a>07032                   p-&gt;<a class="code" href="structdahdi__pvt.html#a746e641282b3f1665a817252c8e4145e" title="DSP feature flags: DSP_FEATURE_xxx.">dsp_features</a> &amp;= ~<a class="code" href="dsp_8h.html#a1d5cf337f5788319b8ba8bf6d161dce5">DSP_FEATURE_WAITDIALTONE</a>;
<a name="l07033"></a>07033                   <a class="code" href="dsp_8h.html#aedc7fa20fba91e3c018f6989e95c714b" title="Select feature set.">ast_dsp_set_features</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#a746e641282b3f1665a817252c8e4145e" title="DSP feature flags: DSP_FEATURE_xxx.">dsp_features</a>);
<a name="l07034"></a>07034                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;Got 10 samples of dialtone!\n&quot;</span>);
<a name="l07035"></a>07035                   <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr)) { <span class="comment">/* Dial deferred digits */</span>
<a name="l07036"></a>07036                      res = ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_DIAL, &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>);
<a name="l07037"></a>07037                      <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l07038"></a>07038                         <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to initiate dialing on trunk channel %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l07039"></a>07039                         p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l07040"></a>07040                         <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l07041"></a>07041                         <span class="keywordflow">return</span> NULL;
<a name="l07042"></a>07042                      } <span class="keywordflow">else</span> {
<a name="l07043"></a>07043                         <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;Sent deferred digit string: %s\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr);
<a name="l07044"></a>07044                         p-&gt;<a class="code" href="structdahdi__pvt.html#af17335c0c7a4c1e03e987a33f6eec81b" title="TRUE if in the process of dialing digits or sending something.">dialing</a> = 1;
<a name="l07045"></a>07045                         p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l07046"></a>07046                         p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.op = DAHDI_DIAL_OP_REPLACE;
<a name="l07047"></a>07047                         <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(ast, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa70881e902c6c29f27ffba80bb43554f">AST_STATE_DIALING</a>);
<a name="l07048"></a>07048                      }
<a name="l07049"></a>07049                   }
<a name="l07050"></a>07050                }
<a name="l07051"></a>07051             }
<a name="l07052"></a>07052          }
<a name="l07053"></a>07053       }
<a name="l07054"></a>07054    } <span class="keywordflow">else</span>
<a name="l07055"></a>07055       f = &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a735f764b1095611ace084e7c6c06857d">f</a>;
<a name="l07056"></a>07056 
<a name="l07057"></a>07057    <span class="keywordflow">if</span> (f &amp;&amp; (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#a248afd6c02044259a386f6b7aee922a2">AST_FRAME_DTMF</a>))
<a name="l07058"></a>07058       <a class="code" href="chan__dahdi_8c.html#aa3d1e7c5ffebd0cd9fd147713ec71188">dahdi_handle_dtmfup</a>(ast, idx, &amp;f);
<a name="l07059"></a>07059 
<a name="l07060"></a>07060    <span class="comment">/* If we have a fake_event, trigger exception to handle it */</span>
<a name="l07061"></a>07061    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a9e44f391f0742649b6cd532f8487c400" title="Holding place for event injected from outside normal operation.">fake_event</a>)
<a name="l07062"></a>07062       <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(ast, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a75202bcfa58fce5d40e2daddc73b8d11">AST_FLAG_EXCEPTION</a>);
<a name="l07063"></a>07063 
<a name="l07064"></a>07064    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l07065"></a>07065    <span class="keywordflow">return</span> f;
<a name="l07066"></a>07066 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa6d5dbe56b41e564aa2f11e536866c5b"></a><!-- doxytag: member="chan_dahdi.c::dahdi_request" ref="aa6d5dbe56b41e564aa2f11e536866c5b" args="(const char *type, int format, void *data, int *cause)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__channel.html">ast_channel</a> * dahdi_request </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>format</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>cause</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l10834">10834</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="chan__dahdi_8c_source.html#l02175">alloc_sub()</a>, <a class="el" href="causes_8h_source.html#l00147">AST_CAUSE_BUSY</a>, <a class="el" href="causes_8h_source.html#l00151">AST_CAUSE_CONGESTION</a>, <a class="el" href="channel_8h_source.html#l00627">AST_CDR_CALLWAIT</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="channel_8h_source.html#l00360">AST_STATE_RESERVED</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="transcap_8h_source.html#l00035">AST_TRANS_CAP_DIGITAL</a>, <a class="el" href="logger_8h_source.html#l00079">ast_verbose</a>, <a class="el" href="chan__dahdi_8c_source.html#l10640">available()</a>, <a class="el" href="channel_8h_source.html#l00461">ast_channel::cdrflags</a>, <a class="el" href="chan__dahdi_8c_source.html#l00277">CHAN_PSEUDO</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="chan__dahdi_8c_source.html#l00735">dahdi_pvt::confirmanswer</a>, <a class="el" href="chan__dahdi_8c_source.html#l07417">dahdi_new()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="chan__dahdi_8c_source.html#l00747">dahdi_pvt::digital</a>, <a class="el" href="chan__dahdi_8c_source.html#l01145">dahdi_pvt::distinctivering</a>, <a class="el" href="chan__dahdi_8c_source.html#l10771">duplicate_pseudo()</a>, <a class="el" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>, <a class="el" href="chan__dahdi_8c_source.html#l00797">dahdi_pvt::inalarm</a>, <a class="el" href="chan__dahdi_8c_source.html#l00649">dahdi_pvt::lock</a>, <a class="el" href="app__meetme_8c_source.html#l00842">lock</a>, <a class="el" href="logger_8h_source.html#l00119">LOG_DEBUG</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__dahdi_8c_source.html#l00682">dahdi_pvt::next</a>, <a class="el" href="chan__dahdi_8c_source.html#l00801">dahdi_pvt::outgoing</a>, <a class="el" href="chan__dahdi_8c_source.html#l00650">dahdi_pvt::owner</a>, <a class="el" href="chan__dahdi_8c_source.html#l00683">dahdi_pvt::prev</a>, <a class="el" href="chan__dahdi_8c_source.html#l09705">restart_monitor()</a>, <a class="el" href="aesopt_8h_source.html#l00399">s</a>, <a class="el" href="chan__dahdi_8c_source.html#l00666">dahdi_pvt::sig</a>, <a class="el" href="chan__dahdi_8c_source.html#l00251">SIG_FXSKS</a>, <a class="el" href="agi_2strcompat_8c_source.html#l00027">strsep()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00580">SUB_CALLWAIT</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>, and <a class="el" href="channel_8h_source.html#l00493">ast_channel::transfercapability</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l10835"></a>10835 {
<a name="l10836"></a>10836    <a class="code" href="channel_8h.html#a641d81d0c5c8df99d43eff69aede3bfd">ast_group_t</a> groupmatch = 0;
<a name="l10837"></a>10837    <span class="keywordtype">int</span> channelmatch = -1;
<a name="l10838"></a>10838    <span class="keywordtype">int</span> roundrobin = 0;
<a name="l10839"></a>10839    <span class="keywordtype">int</span> callwait = 0;
<a name="l10840"></a>10840    <span class="keywordtype">int</span> busy = 0;
<a name="l10841"></a>10841    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *p;
<a name="l10842"></a>10842    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *tmp = NULL;
<a name="l10843"></a>10843    <span class="keywordtype">char</span> *dest=NULL;
<a name="l10844"></a>10844    <span class="keywordtype">int</span> x;
<a name="l10845"></a>10845    <span class="keywordtype">char</span> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>;
<a name="l10846"></a>10846    <span class="keywordtype">char</span> opt=0;
<a name="l10847"></a>10847    <span class="keywordtype">int</span> res=0, y=0;
<a name="l10848"></a>10848    <span class="keywordtype">int</span> backwards = 0;
<a name="l10849"></a>10849 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l10850"></a>10850 <span class="preprocessor"></span>   <span class="keywordtype">int</span> crv;
<a name="l10851"></a>10851    <span class="keywordtype">int</span> bearer = -1;
<a name="l10852"></a>10852    <span class="keywordtype">int</span> trunkgroup;
<a name="l10853"></a>10853    <span class="keyword">struct </span>dahdi_pri *pri=NULL;
<a name="l10854"></a>10854 <span class="preprocessor">#endif</span>
<a name="l10855"></a>10855 <span class="preprocessor"></span>   <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *exitpvt, *start, *end;
<a name="l10856"></a>10856    <a class="code" href="lock_8h.html#a2d9118a2a8939f115eea771bce3a52f2">ast_mutex_t</a> *<a class="code" href="app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>;
<a name="l10857"></a>10857    <span class="keywordtype">int</span> channelmatched = 0;
<a name="l10858"></a>10858    <span class="keywordtype">int</span> groupmatched = 0;
<a name="l10859"></a>10859 
<a name="l10860"></a>10860    <span class="comment">/*</span>
<a name="l10861"></a>10861 <span class="comment">    * data is ---v</span>
<a name="l10862"></a>10862 <span class="comment">    * Dial(DAHDI/pseudo[/extension])</span>
<a name="l10863"></a>10863 <span class="comment">    * Dial(DAHDI/&lt;channel#&gt;[c|r&lt;cadance#&gt;|d][/extension])</span>
<a name="l10864"></a>10864 <span class="comment">    * Dial(DAHDI/&lt;trunk_group#&gt;:&lt;crv#&gt;[c|r&lt;cadance#&gt;|d][/extension])</span>
<a name="l10865"></a>10865 <span class="comment">    * Dial(DAHDI/(g|G|r|R)&lt;group#(0-63)&gt;[c|r&lt;cadance#&gt;|d][/extension])</span>
<a name="l10866"></a>10866 <span class="comment">    *</span>
<a name="l10867"></a>10867 <span class="comment">    * g - channel group allocation search forward</span>
<a name="l10868"></a>10868 <span class="comment">    * G - channel group allocation search backward</span>
<a name="l10869"></a>10869 <span class="comment">    * r - channel group allocation round robin search forward</span>
<a name="l10870"></a>10870 <span class="comment">    * R - channel group allocation round robin search backward</span>
<a name="l10871"></a>10871 <span class="comment">    *</span>
<a name="l10872"></a>10872 <span class="comment">    * c - Wait for DTMF digit to confirm answer</span>
<a name="l10873"></a>10873 <span class="comment">    * r&lt;cadance#&gt; - Set distintive ring cadance number</span>
<a name="l10874"></a>10874 <span class="comment">    * d - Force bearer capability for ISDN/SS7 call to digital.</span>
<a name="l10875"></a>10875 <span class="comment">    */</span>
<a name="l10876"></a>10876 
<a name="l10877"></a>10877    <span class="comment">/* Assume we&apos;re locking the iflock */</span>
<a name="l10878"></a>10878    lock = &amp;iflock;
<a name="l10879"></a>10879    start = <a class="code" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>;
<a name="l10880"></a>10880    end = <a class="code" href="chan__dahdi_8c.html#af06d42bbf0081c1eb058b893305b4e85">ifend</a>;
<a name="l10881"></a>10881    <span class="keywordflow">if</span> (data) {
<a name="l10882"></a>10882       dest = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>((<span class="keywordtype">char</span> *)data);
<a name="l10883"></a>10883    } <span class="keywordflow">else</span> {
<a name="l10884"></a>10884       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Channel requested with no data\n&quot;</span>);
<a name="l10885"></a>10885       <span class="keywordflow">return</span> NULL;
<a name="l10886"></a>10886    }
<a name="l10887"></a>10887    <span class="keywordflow">if</span> (toupper(dest[0]) == <span class="charliteral">&apos;G&apos;</span> || toupper(dest[0])==<span class="charliteral">&apos;R&apos;</span>) {
<a name="l10888"></a>10888       <span class="comment">/* Retrieve the group number */</span>
<a name="l10889"></a>10889       <span class="keywordtype">char</span> *stringp;
<a name="l10890"></a>10890 
<a name="l10891"></a>10891       stringp = dest + 1;
<a name="l10892"></a>10892       s = <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;stringp, <span class="stringliteral">&quot;/&quot;</span>);
<a name="l10893"></a>10893       <span class="keywordflow">if</span> ((res = sscanf(s, <span class="stringliteral">&quot;%30d%1c%30d&quot;</span>, &amp;x, &amp;opt, &amp;y)) &lt; 1) {
<a name="l10894"></a>10894          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to determine group for data %s\n&quot;</span>, (<span class="keywordtype">char</span> *)data);
<a name="l10895"></a>10895          <span class="keywordflow">return</span> NULL;
<a name="l10896"></a>10896       }
<a name="l10897"></a>10897       groupmatch = ((<a class="code" href="channel_8h.html#a641d81d0c5c8df99d43eff69aede3bfd">ast_group_t</a>) 1 &lt;&lt; x);
<a name="l10898"></a>10898       <span class="keywordflow">if</span> (toupper(dest[0]) == <span class="charliteral">&apos;G&apos;</span>) {
<a name="l10899"></a>10899          <span class="keywordflow">if</span> (dest[0] == <span class="charliteral">&apos;G&apos;</span>) {
<a name="l10900"></a>10900             backwards = 1;
<a name="l10901"></a>10901             p = <a class="code" href="chan__dahdi_8c.html#af06d42bbf0081c1eb058b893305b4e85">ifend</a>;
<a name="l10902"></a>10902          } <span class="keywordflow">else</span>
<a name="l10903"></a>10903             p = <a class="code" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>;
<a name="l10904"></a>10904       } <span class="keywordflow">else</span> {
<a name="l10905"></a>10905          <span class="keywordflow">if</span> (dest[0] == <span class="charliteral">&apos;R&apos;</span>) {
<a name="l10906"></a>10906             backwards = 1;
<a name="l10907"></a>10907             p = <a class="code" href="chan__dahdi_8c.html#ad0a20124e90818c18842fd086b848e65">round_robin</a>[x]?<a class="code" href="chan__dahdi_8c.html#ad0a20124e90818c18842fd086b848e65">round_robin</a>[x]-&gt;<a class="code" href="structdahdi__pvt.html#abba5e5e1dcf19b4ded5000d926e0a70d">prev</a>:<a class="code" href="chan__dahdi_8c.html#af06d42bbf0081c1eb058b893305b4e85">ifend</a>;
<a name="l10908"></a>10908             <span class="keywordflow">if</span> (!p)
<a name="l10909"></a>10909                p = <a class="code" href="chan__dahdi_8c.html#af06d42bbf0081c1eb058b893305b4e85">ifend</a>;
<a name="l10910"></a>10910          } <span class="keywordflow">else</span> {
<a name="l10911"></a>10911             p = <a class="code" href="chan__dahdi_8c.html#ad0a20124e90818c18842fd086b848e65">round_robin</a>[x]?<a class="code" href="chan__dahdi_8c.html#ad0a20124e90818c18842fd086b848e65">round_robin</a>[x]-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>:<a class="code" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>;
<a name="l10912"></a>10912             <span class="keywordflow">if</span> (!p)
<a name="l10913"></a>10913                p = <a class="code" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>;
<a name="l10914"></a>10914          }
<a name="l10915"></a>10915          roundrobin = 1;
<a name="l10916"></a>10916       }
<a name="l10917"></a>10917    } <span class="keywordflow">else</span> {
<a name="l10918"></a>10918       <span class="keywordtype">char</span> *stringp;
<a name="l10919"></a>10919 
<a name="l10920"></a>10920       stringp = dest;
<a name="l10921"></a>10921       s = <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;stringp, <span class="stringliteral">&quot;/&quot;</span>);
<a name="l10922"></a>10922       p = <a class="code" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>;
<a name="l10923"></a>10923       <span class="keywordflow">if</span> (!strcasecmp(s, <span class="stringliteral">&quot;pseudo&quot;</span>)) {
<a name="l10924"></a>10924          <span class="comment">/* Special case for pseudo */</span>
<a name="l10925"></a>10925          x = <a class="code" href="chan__dahdi_8c.html#ada02a3fa3d2da06560df664c7228a559">CHAN_PSEUDO</a>;
<a name="l10926"></a>10926          channelmatch = x;
<a name="l10927"></a>10927       }
<a name="l10928"></a>10928 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l10929"></a>10929 <span class="preprocessor"></span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((res = sscanf(s, <span class="stringliteral">&quot;%30d:%30d%1c%30d&quot;</span>, &amp;trunkgroup, &amp;crv, &amp;opt, &amp;y)) &gt; 1) {
<a name="l10930"></a>10930          <span class="keywordflow">if</span> ((trunkgroup &lt; 1) || (crv &lt; 1)) {
<a name="l10931"></a>10931             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to determine trunk group and CRV for data %s\n&quot;</span>, (<span class="keywordtype">char</span> *)data);
<a name="l10932"></a>10932             <span class="keywordflow">return</span> NULL;
<a name="l10933"></a>10933          }
<a name="l10934"></a>10934          res--;
<a name="l10935"></a>10935          <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="chan__dahdi_8c.html#a80bfdd8adbffe226265cd729655a7268">NUM_SPANS</a>; x++) {
<a name="l10936"></a>10936             <span class="keywordflow">if</span> (pris[x].trunkgroup == trunkgroup) {
<a name="l10937"></a>10937                pri = pris + x;
<a name="l10938"></a>10938                lock = &amp;pri-&gt;lock;
<a name="l10939"></a>10939                start = pri-&gt;crvs;
<a name="l10940"></a>10940                end = pri-&gt;crvend;
<a name="l10941"></a>10941                <span class="keywordflow">break</span>;
<a name="l10942"></a>10942             }
<a name="l10943"></a>10943          }
<a name="l10944"></a>10944          <span class="keywordflow">if</span> (!pri) {
<a name="l10945"></a>10945             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to find trunk group %d\n&quot;</span>, trunkgroup);
<a name="l10946"></a>10946             <span class="keywordflow">return</span> NULL;
<a name="l10947"></a>10947          }
<a name="l10948"></a>10948          channelmatch = crv;
<a name="l10949"></a>10949          p = pris[x].crvs;
<a name="l10950"></a>10950       }
<a name="l10951"></a>10951 <span class="preprocessor">#endif</span>
<a name="l10952"></a>10952 <span class="preprocessor"></span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((res = sscanf(s, <span class="stringliteral">&quot;%30d%1c%30d&quot;</span>, &amp;x, &amp;opt, &amp;y)) &lt; 1) {
<a name="l10953"></a>10953          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to determine channel for data %s\n&quot;</span>, (<span class="keywordtype">char</span> *)data);
<a name="l10954"></a>10954          <span class="keywordflow">return</span> NULL;
<a name="l10955"></a>10955       } <span class="keywordflow">else</span> {
<a name="l10956"></a>10956          channelmatch = x;
<a name="l10957"></a>10957       }
<a name="l10958"></a>10958    }
<a name="l10959"></a>10959    <span class="comment">/* Search for an unowned channel */</span>
<a name="l10960"></a>10960    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(lock);
<a name="l10961"></a>10961    exitpvt = p;
<a name="l10962"></a>10962    <span class="keywordflow">while</span> (p &amp;&amp; !tmp) {
<a name="l10963"></a>10963       <span class="keywordflow">if</span> (roundrobin)
<a name="l10964"></a>10964          <a class="code" href="chan__dahdi_8c.html#ad0a20124e90818c18842fd086b848e65">round_robin</a>[x] = p;
<a name="l10965"></a>10965 <span class="preprocessor">#if 0</span>
<a name="l10966"></a>10966 <span class="preprocessor"></span>      <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;name = %s, %d, %d, %llu\n&quot;</span>,p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> ? p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name : <span class="stringliteral">&quot;&lt;none&gt;&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, channelmatch, groupmatch);
<a name="l10967"></a>10967 <span class="preprocessor">#endif</span>
<a name="l10968"></a>10968 <span class="preprocessor"></span>
<a name="l10969"></a>10969       <span class="keywordflow">if</span> (p &amp;&amp; <a class="code" href="chan__dahdi_8c.html#a305c0e17a1db304e7e5d0a4c39e5d9a4">available</a>(p, channelmatch, groupmatch, &amp;busy, &amp;channelmatched, &amp;groupmatched)) {
<a name="l10970"></a>10970          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Using channel %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l10971"></a>10971          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#adbe10c4b12619d6cb58b1ad14bc437af" title="TRUE if in an alarm condition.">inalarm</a>)
<a name="l10972"></a>10972             <span class="keywordflow">goto</span> <a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>;
<a name="l10973"></a>10973 
<a name="l10974"></a>10974          callwait = (p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> != NULL);
<a name="l10975"></a>10975 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l10976"></a>10976 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (pri &amp;&amp; (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a> &lt; 0)) {
<a name="l10977"></a>10977             <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> != <a class="code" href="chan__dahdi_8c.html#a38139ec369c0243f4324eb4eb0c2f004">SIG_FXSKS</a>) {
<a name="l10978"></a>10978                <span class="comment">/* Gotta find an actual channel to use for this</span>
<a name="l10979"></a>10979 <span class="comment">                  CRV if this isn&apos;t a callwait */</span>
<a name="l10980"></a>10980                bearer = pri_find_empty_chan(pri, 0);
<a name="l10981"></a>10981                <span class="keywordflow">if</span> (bearer &lt; 0) {
<a name="l10982"></a>10982                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Out of bearer channels on span %d for call to CRV %d:%d\n&quot;</span>, pri-&gt;span, trunkgroup, crv);
<a name="l10983"></a>10983                   p = NULL;
<a name="l10984"></a>10984                   <span class="keywordflow">break</span>;
<a name="l10985"></a>10985                }
<a name="l10986"></a>10986                pri_assign_bearer(p, pri, pri-&gt;pvts[bearer]);
<a name="l10987"></a>10987             } <span class="keywordflow">else</span> {
<a name="l10988"></a>10988                <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#a8d921023bd460fd8278825f8f360f918">alloc_sub</a>(p, 0)) {
<a name="l10989"></a>10989                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Failed to allocate place holder pseudo channel!\n&quot;</span>);
<a name="l10990"></a>10990                   p = NULL;
<a name="l10991"></a>10991                   <span class="keywordflow">break</span>;
<a name="l10992"></a>10992                } <span class="keywordflow">else</span>
<a name="l10993"></a>10993                   <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Allocated placeholder pseudo channel\n&quot;</span>);
<a name="l10994"></a>10994 
<a name="l10995"></a>10995                p-&gt;pri = pri;
<a name="l10996"></a>10996             }
<a name="l10997"></a>10997          }
<a name="l10998"></a>10998 <span class="preprocessor">#endif</span>
<a name="l10999"></a>10999 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_OPENR2</span>
<a name="l11000"></a>11000 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (p-&gt;mfcr2) {
<a name="l11001"></a>11001             <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l11002"></a>11002             <span class="keywordflow">if</span> (p-&gt;mfcr2call) {
<a name="l11003"></a>11003                <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l11004"></a>11004                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;Yay!, someone just beat us in the race for channel %d.\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l11005"></a>11005                <span class="keywordflow">goto</span> <a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>;
<a name="l11006"></a>11006             }
<a name="l11007"></a>11007             p-&gt;mfcr2call = 1;
<a name="l11008"></a>11008             <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l11009"></a>11009          }
<a name="l11010"></a>11010 <span class="preprocessor">#endif</span>
<a name="l11011"></a>11011 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a> == <a class="code" href="chan__dahdi_8c.html#ada02a3fa3d2da06560df664c7228a559">CHAN_PSEUDO</a>) {
<a name="l11012"></a>11012             p = <a class="code" href="chan__dahdi_8c.html#acbe36083a9c130b81506d874635f8ff9">duplicate_pseudo</a>(p);
<a name="l11013"></a>11013             <span class="keywordflow">if</span> (!p) {
<a name="l11014"></a>11014                <span class="keywordflow">break</span>;
<a name="l11015"></a>11015             }
<a name="l11016"></a>11016          }
<a name="l11017"></a>11017          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l11018"></a>11018             <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#a8d921023bd460fd8278825f8f360f918">alloc_sub</a>(p, <a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>)) {
<a name="l11019"></a>11019                p = NULL;
<a name="l11020"></a>11020                <span class="keywordflow">break</span>;
<a name="l11021"></a>11021             }
<a name="l11022"></a>11022          }
<a name="l11023"></a>11023          p-&gt;<a class="code" href="structdahdi__pvt.html#a40668dcb7d940b80c4f109861059a978" title="TRUE if we originated the call leg.">outgoing</a> = 1;
<a name="l11024"></a>11024          tmp = <a class="code" href="chan__dahdi_8c.html#ab3f00769ae6c995b4f5f3934d8c805f6">dahdi_new</a>(p, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660addb60fd97b55a4aea24f992e30fe3c84">AST_STATE_RESERVED</a>, 0, p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> ? <a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a> : <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>, 0, 0);
<a name="l11025"></a>11025          <span class="keywordflow">if</span> (!tmp) {
<a name="l11026"></a>11026             p-&gt;<a class="code" href="structdahdi__pvt.html#a40668dcb7d940b80c4f109861059a978" title="TRUE if we originated the call leg.">outgoing</a> = 0;
<a name="l11027"></a>11027          }
<a name="l11028"></a>11028 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l11029"></a>11029 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (p-&gt;bearer) {
<a name="l11030"></a>11030             <span class="comment">/* Log owner to bearer channel, too */</span>
<a name="l11031"></a>11031             p-&gt;bearer-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = tmp;
<a name="l11032"></a>11032          }
<a name="l11033"></a>11033 <span class="preprocessor">#endif</span>
<a name="l11034"></a>11034 <span class="preprocessor"></span>         <span class="comment">/* Make special notes */</span>
<a name="l11035"></a>11035          <span class="keywordflow">if</span> (res &gt; 1) {
<a name="l11036"></a>11036             <span class="keywordflow">if</span> (opt == <span class="charliteral">&apos;c&apos;</span>) {
<a name="l11037"></a>11037                <span class="comment">/* Confirm answer */</span>
<a name="l11038"></a>11038                p-&gt;<a class="code" href="structdahdi__pvt.html#a3e597345fe12637b3f04fb25e11b2fa6" title="TRUE if to wait for a DTMF digit to confirm answer.">confirmanswer</a> = 1;
<a name="l11039"></a>11039             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (opt == <span class="charliteral">&apos;r&apos;</span>) {
<a name="l11040"></a>11040                <span class="comment">/* Distinctive ring */</span>
<a name="l11041"></a>11041                <span class="keywordflow">if</span> (res &lt; 3)
<a name="l11042"></a>11042                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Distinctive ring missing identifier in &apos;%s&apos;\n&quot;</span>, (<span class="keywordtype">char</span> *)data);
<a name="l11043"></a>11043                <span class="keywordflow">else</span>
<a name="l11044"></a>11044                   p-&gt;<a class="code" href="structdahdi__pvt.html#a64dd7ed4d1e8aebcfe5b84001765d22c">distinctivering</a> = y;
<a name="l11045"></a>11045             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (opt == <span class="charliteral">&apos;d&apos;</span>) {
<a name="l11046"></a>11046                <span class="comment">/* If this is an ISDN call, make it digital */</span>
<a name="l11047"></a>11047                p-&gt;<a class="code" href="structdahdi__pvt.html#adf54768a4327f86de3a234648305c4a4" title="TRUE if the transfer capability of the call is digital.">digital</a> = 1;
<a name="l11048"></a>11048                <span class="keywordflow">if</span> (tmp)
<a name="l11049"></a>11049                   tmp-&gt;<a class="code" href="structast__channel.html#a67fbfb6a4051ff15a242b9685167f16a">transfercapability</a> = <a class="code" href="transcap_8h.html#a70df930118839f3fc035fc9f15dfa621">AST_TRANS_CAP_DIGITAL</a>;
<a name="l11050"></a>11050             } <span class="keywordflow">else</span> {
<a name="l11051"></a>11051                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unknown option &apos;%c&apos; in &apos;%s&apos;\n&quot;</span>, opt, (<span class="keywordtype">char</span> *)data);
<a name="l11052"></a>11052             }
<a name="l11053"></a>11053          }
<a name="l11054"></a>11054          <span class="comment">/* Note if the call is a call waiting call */</span>
<a name="l11055"></a>11055          <span class="keywordflow">if</span> (tmp &amp;&amp; callwait)
<a name="l11056"></a>11056             tmp-&gt;<a class="code" href="structast__channel.html#a45c4bec79a4bc84fdd2d2c67f6605a6c">cdrflags</a> |= <a class="code" href="channel_8h.html#a9a3be2d66956bd67c0b66c32d8b30f17a2af768a329725d3bbb4b64e48623bf12">AST_CDR_CALLWAIT</a>;
<a name="l11057"></a>11057          <span class="keywordflow">break</span>;
<a name="l11058"></a>11058       }
<a name="l11059"></a>11059 <a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>:
<a name="l11060"></a>11060       <span class="keywordflow">if</span> (backwards) {
<a name="l11061"></a>11061          p = p-&gt;<a class="code" href="structdahdi__pvt.html#abba5e5e1dcf19b4ded5000d926e0a70d">prev</a>;
<a name="l11062"></a>11062          <span class="keywordflow">if</span> (!p)
<a name="l11063"></a>11063             p = end;
<a name="l11064"></a>11064       } <span class="keywordflow">else</span> {
<a name="l11065"></a>11065          p = p-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>;
<a name="l11066"></a>11066          <span class="keywordflow">if</span> (!p)
<a name="l11067"></a>11067             p = start;
<a name="l11068"></a>11068       }
<a name="l11069"></a>11069       <span class="comment">/* stop when you roll to the one that we started from */</span>
<a name="l11070"></a>11070       <span class="keywordflow">if</span> (p == exitpvt)
<a name="l11071"></a>11071          <span class="keywordflow">break</span>;
<a name="l11072"></a>11072    }
<a name="l11073"></a>11073    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(lock);
<a name="l11074"></a>11074    <a class="code" href="chan__dahdi_8c.html#a83af94bb19a421cb25ca02d16fa5ba9c">restart_monitor</a>();
<a name="l11075"></a>11075    <span class="keywordflow">if</span> (callwait)
<a name="l11076"></a>11076       *<a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a> = <a class="code" href="causes_8h.html#ae009c193522491f7de7ea28b23f20868">AST_CAUSE_BUSY</a>;
<a name="l11077"></a>11077    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!tmp) {
<a name="l11078"></a>11078       <span class="keywordflow">if</span> (channelmatched) {
<a name="l11079"></a>11079          <span class="keywordflow">if</span> (busy)
<a name="l11080"></a>11080             *<a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a> = <a class="code" href="causes_8h.html#ae009c193522491f7de7ea28b23f20868">AST_CAUSE_BUSY</a>;
<a name="l11081"></a>11081       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (groupmatched) {
<a name="l11082"></a>11082          *<a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a> = <a class="code" href="causes_8h.html#a0a35518d7b448a53da368cf57f354fba">AST_CAUSE_CONGESTION</a>;
<a name="l11083"></a>11083       }
<a name="l11084"></a>11084    }
<a name="l11085"></a>11085 
<a name="l11086"></a>11086    <span class="keywordflow">return</span> tmp;
<a name="l11087"></a>11087 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a738afcb4a2a9584043335b3279d1c1f7"></a><!-- doxytag: member="chan_dahdi.c::dahdi_restart" ref="a738afcb4a2a9584043335b3279d1c1f7" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int dahdi_restart </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l14338">14338</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l00497">ast_active_channels()</a>, <a class="el" href="lock_8h_source.html#l01749">ast_cond_wait()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01692">ast_mutex_init()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="lock_8h_source.html#l00082">AST_PTHREADT_NULL</a>, <a class="el" href="lock_8h_source.html#l00083">AST_PTHREADT_STOP</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="chan__dahdi_8c_source.html#l14309">dahdi_softhangup_all()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03929">destroy_all_channels()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>, <a class="el" href="app__meetme_8c_source.html#l00842">lock</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="cdr__custom_8c_source.html#l00057">master</a>, <a class="el" href="chan__dahdi_8c_source.html#l00682">dahdi_pvt::next</a>, <a class="el" href="chan__dahdi_8c_source.html#l00650">dahdi_pvt::owner</a>, <a class="el" href="chan__dahdi_8c_source.html#l17079">setup_dahdi()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l14475">action_dahdirestart()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l14452">dahdi_restart_cmd()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l14339"></a>14339 {
<a name="l14340"></a>14340 <span class="preprocessor">#if defined(HAVE_PRI) || defined(HAVE_SS7)</span>
<a name="l14341"></a>14341 <span class="preprocessor"></span>   <span class="keywordtype">int</span> i, j;
<a name="l14342"></a>14342 <span class="preprocessor">#endif</span>
<a name="l14343"></a>14343 <span class="preprocessor"></span>   <span class="keywordtype">int</span> cancel_code;
<a name="l14344"></a>14344    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *p;
<a name="l14345"></a>14345 
<a name="l14346"></a>14346    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;restart_lock);
<a name="l14347"></a>14347    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;Destroying channels and reloading DAHDI configuration.\n&quot;</span>);
<a name="l14348"></a>14348    <a class="code" href="chan__dahdi_8c.html#a31724c8f07f8ccbb7817302855f1d837">dahdi_softhangup_all</a>();
<a name="l14349"></a>14349    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(4, <span class="stringliteral">&quot;Initial softhangup of all DAHDI channels complete.\n&quot;</span>);
<a name="l14350"></a>14350 <span class="preprocessor">#ifdef HAVE_OPENR2</span>
<a name="l14351"></a>14351 <span class="preprocessor"></span>   dahdi_r2_destroy_links();
<a name="l14352"></a>14352 <span class="preprocessor">#endif</span>
<a name="l14353"></a>14353 <span class="preprocessor"></span>
<a name="l14354"></a>14354 <span class="preprocessor">#if defined(HAVE_PRI)</span>
<a name="l14355"></a>14355 <span class="preprocessor"></span>   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="chan__dahdi_8c.html#a80bfdd8adbffe226265cd729655a7268">NUM_SPANS</a>; i++) {
<a name="l14356"></a>14356       <span class="keywordflow">if</span> (pris[i].<a class="code" href="cdr__custom_8c.html#ac4cd676396d9d62ba95a047806668d90">master</a> &amp;&amp; (pris[i].<a class="code" href="cdr__custom_8c.html#ac4cd676396d9d62ba95a047806668d90">master</a> != <a class="code" href="lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>)) {
<a name="l14357"></a>14357          cancel_code = pthread_cancel(pris[i].<a class="code" href="cdr__custom_8c.html#ac4cd676396d9d62ba95a047806668d90">master</a>);
<a name="l14358"></a>14358          pthread_kill(pris[i].<a class="code" href="cdr__custom_8c.html#ac4cd676396d9d62ba95a047806668d90">master</a>, SIGURG);
<a name="l14359"></a>14359          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(4, <span class="stringliteral">&quot;Waiting to join thread of span %d with pid=%p, cancel_code=%d\n&quot;</span>, i, (<span class="keywordtype">void</span> *) pris[i].<a class="code" href="cdr__custom_8c.html#ac4cd676396d9d62ba95a047806668d90">master</a>, cancel_code);
<a name="l14360"></a>14360          pthread_join(pris[i].<a class="code" href="cdr__custom_8c.html#ac4cd676396d9d62ba95a047806668d90">master</a>, NULL);
<a name="l14361"></a>14361          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(4, <span class="stringliteral">&quot;Joined thread of span %d\n&quot;</span>, i);
<a name="l14362"></a>14362       }
<a name="l14363"></a>14363    }
<a name="l14364"></a>14364 <span class="preprocessor">#endif</span>
<a name="l14365"></a>14365 <span class="preprocessor"></span>
<a name="l14366"></a>14366 <span class="preprocessor">#if defined(HAVE_SS7)</span>
<a name="l14367"></a>14367 <span class="preprocessor"></span>   <span class="keywordflow">for</span> (i = 0; i &lt; NUM_SPANS; i++) {
<a name="l14368"></a>14368       <span class="keywordflow">if</span> (linksets[i].<a class="code" href="cdr__custom_8c.html#ac4cd676396d9d62ba95a047806668d90">master</a> &amp;&amp; (linksets[i].<a class="code" href="cdr__custom_8c.html#ac4cd676396d9d62ba95a047806668d90">master</a> != <a class="code" href="lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>)) {
<a name="l14369"></a>14369          cancel_code = pthread_cancel(linksets[i].<a class="code" href="cdr__custom_8c.html#ac4cd676396d9d62ba95a047806668d90">master</a>);
<a name="l14370"></a>14370          pthread_kill(linksets[i].<a class="code" href="cdr__custom_8c.html#ac4cd676396d9d62ba95a047806668d90">master</a>, SIGURG);
<a name="l14371"></a>14371          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(4, <span class="stringliteral">&quot;Waiting to join thread of span %d with pid=%p, cancel_code=%d\n&quot;</span>, i, (<span class="keywordtype">void</span> *) linksets[i].<a class="code" href="cdr__custom_8c.html#ac4cd676396d9d62ba95a047806668d90">master</a>, cancel_code);
<a name="l14372"></a>14372          pthread_join(linksets[i].<a class="code" href="cdr__custom_8c.html#ac4cd676396d9d62ba95a047806668d90">master</a>, NULL);
<a name="l14373"></a>14373          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(4, <span class="stringliteral">&quot;Joined thread of span %d\n&quot;</span>, i);
<a name="l14374"></a>14374       }
<a name="l14375"></a>14375    }
<a name="l14376"></a>14376 <span class="preprocessor">#endif</span>
<a name="l14377"></a>14377 <span class="preprocessor"></span>
<a name="l14378"></a>14378    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;monlock);
<a name="l14379"></a>14379    <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#afbd6fc6e0ab3c1a04a518f19c21d4503" title="This is the thread for the monitor which checks for input on the channels which are...">monitor_thread</a> &amp;&amp; (<a class="code" href="chan__dahdi_8c.html#afbd6fc6e0ab3c1a04a518f19c21d4503" title="This is the thread for the monitor which checks for input on the channels which are...">monitor_thread</a> != <a class="code" href="lock_8h.html#a873a83eb8196323194aac2bea23d794e">AST_PTHREADT_STOP</a>) &amp;&amp; (<a class="code" href="chan__dahdi_8c.html#afbd6fc6e0ab3c1a04a518f19c21d4503" title="This is the thread for the monitor which checks for input on the channels which are...">monitor_thread</a> != <a class="code" href="lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>)) {
<a name="l14380"></a>14380       cancel_code = pthread_cancel(<a class="code" href="chan__dahdi_8c.html#afbd6fc6e0ab3c1a04a518f19c21d4503" title="This is the thread for the monitor which checks for input on the channels which are...">monitor_thread</a>);
<a name="l14381"></a>14381       pthread_kill(<a class="code" href="chan__dahdi_8c.html#afbd6fc6e0ab3c1a04a518f19c21d4503" title="This is the thread for the monitor which checks for input on the channels which are...">monitor_thread</a>, SIGURG);
<a name="l14382"></a>14382       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(4, <span class="stringliteral">&quot;Waiting to join monitor thread with pid=%p, cancel_code=%d\n&quot;</span>, (<span class="keywordtype">void</span> *) <a class="code" href="chan__dahdi_8c.html#afbd6fc6e0ab3c1a04a518f19c21d4503" title="This is the thread for the monitor which checks for input on the channels which are...">monitor_thread</a>, cancel_code);
<a name="l14383"></a>14383       pthread_join(<a class="code" href="chan__dahdi_8c.html#afbd6fc6e0ab3c1a04a518f19c21d4503" title="This is the thread for the monitor which checks for input on the channels which are...">monitor_thread</a>, NULL);
<a name="l14384"></a>14384       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(4, <span class="stringliteral">&quot;Joined monitor thread\n&quot;</span>);
<a name="l14385"></a>14385    }
<a name="l14386"></a>14386    <a class="code" href="chan__dahdi_8c.html#afbd6fc6e0ab3c1a04a518f19c21d4503" title="This is the thread for the monitor which checks for input on the channels which are...">monitor_thread</a> = <a class="code" href="lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>; <span class="comment">/* prepare to restart thread in setup_dahdi once channels are reconfigured */</span>
<a name="l14387"></a>14387 
<a name="l14388"></a>14388    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;ss_thread_lock);
<a name="l14389"></a>14389    <span class="keywordflow">while</span> (<a class="code" href="chan__dahdi_8c.html#aec2d8d3ba7708b470105092c392b9b0a">ss_thread_count</a> &gt; 0) { <span class="comment">/* let ss_threads finish and run dahdi_hangup before dahvi_pvts are destroyed */</span>
<a name="l14390"></a>14390       <span class="keywordtype">int</span> x = DAHDI_FLASH;
<a name="l14391"></a>14391       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(3, <span class="stringliteral">&quot;Waiting on %d ss_thread(s) to finish\n&quot;</span>, <a class="code" href="chan__dahdi_8c.html#aec2d8d3ba7708b470105092c392b9b0a">ss_thread_count</a>);
<a name="l14392"></a>14392 
<a name="l14393"></a>14393       <span class="keywordflow">for</span> (p = <a class="code" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>; p; p = p-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>) {
<a name="l14394"></a>14394          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)
<a name="l14395"></a>14395             ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_HOOK, &amp;x); <span class="comment">/* important to create an event for dahdi_wait_event to register so that all ss_threads terminate */</span>
<a name="l14396"></a>14396          }
<a name="l14397"></a>14397          <a class="code" href="lock_8h.html#ae454b1ebfb5f5e9948876d470865d9dc">ast_cond_wait</a>(&amp;<a class="code" href="chan__dahdi_8c.html#aa0eccd1394a26a586074c22fe8d0ff43">ss_thread_complete</a>, &amp;ss_thread_lock);
<a name="l14398"></a>14398       }
<a name="l14399"></a>14399 
<a name="l14400"></a>14400    <span class="comment">/* ensure any created channels before monitor threads were stopped are hungup */</span>
<a name="l14401"></a>14401    <a class="code" href="chan__dahdi_8c.html#a31724c8f07f8ccbb7817302855f1d837">dahdi_softhangup_all</a>();
<a name="l14402"></a>14402    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(4, <span class="stringliteral">&quot;Final softhangup of all DAHDI channels complete.\n&quot;</span>);
<a name="l14403"></a>14403    <a class="code" href="chan__dahdi_8c.html#aff6140c85d9d958a2ff7abf6003a20d9">destroy_all_channels</a>();
<a name="l14404"></a>14404    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Channels destroyed. Now re-reading config. %d active channels remaining.\n&quot;</span>, <a class="code" href="channel_8h.html#a9704ae96ab849e9e5a20040c13d29705" title="returns number of active/allocated channels">ast_active_channels</a>());
<a name="l14405"></a>14405 
<a name="l14406"></a>14406    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;monlock);
<a name="l14407"></a>14407 
<a name="l14408"></a>14408 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l14409"></a>14409 <span class="preprocessor"></span>   <span class="keywordflow">for</span> (i = 0; i &lt; NUM_SPANS; i++) {
<a name="l14410"></a>14410       <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="chan__dahdi_8c.html#aaad94eef7bd74293b956f6de74a62d0f">NUM_DCHANS</a>; j++)
<a name="l14411"></a>14411          dahdi_close_pri_fd(&amp;(pris[i]), j);
<a name="l14412"></a>14412    }
<a name="l14413"></a>14413 
<a name="l14414"></a>14414    memset(pris, 0, <span class="keyword">sizeof</span>(pris));
<a name="l14415"></a>14415    <span class="keywordflow">for</span> (i = 0; i &lt; NUM_SPANS; i++) {
<a name="l14416"></a>14416       <a class="code" href="lock_8h.html#a5dc895fe6e8c089175159fc22e33fc3b">ast_mutex_init</a>(&amp;pris[i].<a class="code" href="app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l14417"></a>14417       pris[i].offset = -1;
<a name="l14418"></a>14418       pris[i].master = <a class="code" href="lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>;
<a name="l14419"></a>14419       <span class="keywordflow">for</span> (j = 0; j &lt; NUM_DCHANS; j++)
<a name="l14420"></a>14420          pris[i].fds[j] = -1;
<a name="l14421"></a>14421       }
<a name="l14422"></a>14422    pri_set_error(dahdi_pri_error);
<a name="l14423"></a>14423    pri_set_message(dahdi_pri_message);
<a name="l14424"></a>14424 <span class="preprocessor">#endif</span>
<a name="l14425"></a>14425 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_SS7</span>
<a name="l14426"></a>14426 <span class="preprocessor"></span>   <span class="keywordflow">for</span> (i = 0; i &lt; NUM_SPANS; i++) {
<a name="l14427"></a>14427       <span class="keywordflow">for</span> (j = 0; j &lt; NUM_DCHANS; j++)
<a name="l14428"></a>14428          dahdi_close_ss7_fd(&amp;(linksets[i]), j);
<a name="l14429"></a>14429    }
<a name="l14430"></a>14430 
<a name="l14431"></a>14431    memset(linksets, 0, <span class="keyword">sizeof</span>(linksets));
<a name="l14432"></a>14432    <span class="keywordflow">for</span> (i = 0; i &lt; NUM_SPANS; i++) {
<a name="l14433"></a>14433       <a class="code" href="lock_8h.html#a5dc895fe6e8c089175159fc22e33fc3b">ast_mutex_init</a>(&amp;linksets[i].<a class="code" href="app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l14434"></a>14434       linksets[i].master = <a class="code" href="lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>;
<a name="l14435"></a>14435       <span class="keywordflow">for</span> (j = 0; j &lt; NUM_DCHANS; j++)
<a name="l14436"></a>14436          linksets[i].fds[j] = -1;
<a name="l14437"></a>14437    }
<a name="l14438"></a>14438    ss7_set_error(dahdi_ss7_error);
<a name="l14439"></a>14439    ss7_set_message(dahdi_ss7_message);
<a name="l14440"></a>14440 <span class="preprocessor">#endif</span>
<a name="l14441"></a>14441 <span class="preprocessor"></span>
<a name="l14442"></a>14442    <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#a90c93221b85857ca4af2b1097d267603">setup_dahdi</a>(2) != 0) {
<a name="l14443"></a>14443       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Reload channels from dahdi config failed!\n&quot;</span>);
<a name="l14444"></a>14444       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;ss_thread_lock);
<a name="l14445"></a>14445       <span class="keywordflow">return</span> 1;
<a name="l14446"></a>14446    }
<a name="l14447"></a>14447    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;ss_thread_lock);
<a name="l14448"></a>14448    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;restart_lock);
<a name="l14449"></a>14449    <span class="keywordflow">return</span> 0;
<a name="l14450"></a>14450 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae9c46c1629ae0a2d2260cdbcda36380d"></a><!-- doxytag: member="chan_dahdi.c::dahdi_restart_cmd" ref="ae9c46c1629ae0a2d2260cdbcda36380d" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* dahdi_restart_cmd </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l14452">14452</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8h_source.html#l00045">CLI_FAILURE</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="chan__dahdi_8c_source.html#l14338">dahdi_restart()</a>, and <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l14453"></a>14453 {
<a name="l14454"></a>14454    <span class="keywordflow">switch</span> (cmd) {
<a name="l14455"></a>14455    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l14456"></a>14456       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;dahdi restart&quot;</span>;
<a name="l14457"></a>14457       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l14458"></a>14458          <span class="stringliteral">&quot;Usage: dahdi restart\n&quot;</span>
<a name="l14459"></a>14459          <span class="stringliteral">&quot;  Restarts the DAHDI channels: destroys them all and then\n&quot;</span>
<a name="l14460"></a>14460          <span class="stringliteral">&quot;  re-reads them from chan_dahdi.conf.\n&quot;</span>
<a name="l14461"></a>14461          <span class="stringliteral">&quot;  Note that this will STOP any running CALL on DAHDI channels.\n&quot;</span>
<a name="l14462"></a>14462          <span class="stringliteral">&quot;&quot;</span>;
<a name="l14463"></a>14463       <span class="keywordflow">return</span> NULL;
<a name="l14464"></a>14464    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l14465"></a>14465       <span class="keywordflow">return</span> NULL;
<a name="l14466"></a>14466    }
<a name="l14467"></a>14467    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> != 2)
<a name="l14468"></a>14468       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l14469"></a>14469 
<a name="l14470"></a>14470    <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#a738afcb4a2a9584043335b3279d1c1f7">dahdi_restart</a>() != 0)
<a name="l14471"></a>14471       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;
<a name="l14472"></a>14472    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l14473"></a>14473 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a22c775b992dee643a259e67efc1711d0"></a><!-- doxytag: member="chan_dahdi.c::dahdi_ring_phone" ref="a22c775b992dee643a259e67efc1711d0" args="(struct dahdi_pvt *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int dahdi_ring_phone </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l05470">5470</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l06601">__dahdi_exception()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05471"></a>05471 {
<a name="l05472"></a>05472    <span class="keywordtype">int</span> x;
<a name="l05473"></a>05473    <span class="keywordtype">int</span> res;
<a name="l05474"></a>05474    <span class="comment">/* Make sure our transmit state is on hook */</span>
<a name="l05475"></a>05475    x = 0;
<a name="l05476"></a>05476    x = DAHDI_ONHOOK;
<a name="l05477"></a>05477    res = ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_HOOK, &amp;x);
<a name="l05478"></a>05478    <span class="keywordflow">do</span> {
<a name="l05479"></a>05479       x = DAHDI_RING;
<a name="l05480"></a>05480       res = ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_HOOK, &amp;x);
<a name="l05481"></a>05481       <span class="keywordflow">if</span> (res) {
<a name="l05482"></a>05482          <span class="keywordflow">switch</span> (errno) {
<a name="l05483"></a>05483          <span class="keywordflow">case</span> EBUSY:
<a name="l05484"></a>05484          <span class="keywordflow">case</span> EINTR:
<a name="l05485"></a>05485             <span class="comment">/* Wait just in case */</span>
<a name="l05486"></a>05486             usleep(10000);
<a name="l05487"></a>05487             <span class="keywordflow">continue</span>;
<a name="l05488"></a>05488          <span class="keywordflow">case</span> EINPROGRESS:
<a name="l05489"></a>05489             res = 0;
<a name="l05490"></a>05490             <span class="keywordflow">break</span>;
<a name="l05491"></a>05491          <span class="keywordflow">default</span>:
<a name="l05492"></a>05492             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Couldn&apos;t ring the phone: %s\n&quot;</span>, strerror(errno));
<a name="l05493"></a>05493             res = 0;
<a name="l05494"></a>05494          }
<a name="l05495"></a>05495       }
<a name="l05496"></a>05496    } <span class="keywordflow">while</span> (res);
<a name="l05497"></a>05497    <span class="keywordflow">return</span> res;
<a name="l05498"></a>05498 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a642c508831fdb1f5351a747f4485866b"></a><!-- doxytag: member="chan_dahdi.c::dahdi_sendtext" ref="a642c508831fdb1f5351a747f4485866b" args="(struct ast_channel *c, const char *text)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int dahdi_sendtext </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>text</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l17380">17380</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="chan__dahdi_8c.html#aaee0889ebef226ef3d5842fc7c3e5e7a">ASCII_BYTES_PER_CHAR</a>, <a class="el" href="channel_8c_source.html#l00461">ast_check_hangup()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="chan__dahdi_8c_source.html#l00209">AST_LAW</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="astmm_8h_source.html#l00081">ast_malloc</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="chan__dahdi_8c_source.html#l01503">dahdi_get_index()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="chan__dahdi_8c.html#a5b4bd94085f8d9db39f0096a52f795b3">END_SILENCE_LEN</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="chan__dahdi_8c.html#ab8f5e10b9f780e53f9583724ac965a0c">HEADER_LEN</a>, <a class="el" href="chan__dahdi_8c.html#a372dce8627cc49448555f8372f743de9">HEADER_MS</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__dahdi_8c_source.html#l00799">dahdi_pvt::mate</a>, <a class="el" href="callerid_8h_source.html#l00279">PUT_CLID</a>, <a class="el" href="callerid_8h_source.html#l00264">PUT_CLID_MARKMS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00397">READ_SIZE</a>, <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>, <a class="el" href="chan__dahdi_8c_source.html#l01122">dahdi_pvt::tdd</a>, <a class="el" href="tdd_8h_source.html#l00027">TDD_BYTES_PER_CHAR</a>, <a class="el" href="tdd_8c_source.html#l00291">tdd_generate()</a>, <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>, and <a class="el" href="chan__dahdi_8c.html#a9b7ef3aa0efb7411931914e8562c8d46">TRAILER_MS</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l17381"></a>17381 {
<a name="l17382"></a>17382 <span class="preprocessor">#define  END_SILENCE_LEN 400</span>
<a name="l17383"></a>17383 <span class="preprocessor"></span><span class="preprocessor">#define  HEADER_MS 50</span>
<a name="l17384"></a>17384 <span class="preprocessor"></span><span class="preprocessor">#define  TRAILER_MS 5</span>
<a name="l17385"></a>17385 <span class="preprocessor"></span><span class="preprocessor">#define  HEADER_LEN ((HEADER_MS + TRAILER_MS) * 8)</span>
<a name="l17386"></a>17386 <span class="preprocessor"></span><span class="preprocessor">#define  ASCII_BYTES_PER_CHAR 80</span>
<a name="l17387"></a>17387 <span class="preprocessor"></span>
<a name="l17388"></a>17388    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>,*mybuf;
<a name="l17389"></a>17389    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *p = c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l17390"></a>17390    <span class="keyword">struct </span>pollfd fds[1];
<a name="l17391"></a>17391    <span class="keywordtype">int</span> size,res,fd,<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>,x;
<a name="l17392"></a>17392    <span class="keywordtype">int</span> bytes=0;
<a name="l17393"></a>17393    <span class="comment">/* Initial carrier (imaginary) */</span>
<a name="l17394"></a>17394    <span class="keywordtype">float</span> cr = 1.0;
<a name="l17395"></a>17395    <span class="keywordtype">float</span> ci = 0.0;
<a name="l17396"></a>17396    <span class="keywordtype">float</span> scont = 0.0;
<a name="l17397"></a>17397    <span class="keywordtype">int</span> idx;
<a name="l17398"></a>17398 
<a name="l17399"></a>17399    idx = <a class="code" href="chan__dahdi_8c.html#a62c8e3f411fb9e5ec62a1e77c152c2df">dahdi_get_index</a>(c, p, 0);
<a name="l17400"></a>17400    <span class="keywordflow">if</span> (idx &lt; 0) {
<a name="l17401"></a>17401       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Huh?  I don&apos;t exist?\n&quot;</span>);
<a name="l17402"></a>17402       <span class="keywordflow">return</span> -1;
<a name="l17403"></a>17403    }
<a name="l17404"></a>17404    <span class="keywordflow">if</span> (!<a class="code" href="app__queue_8c.html#a5633b1433389cec21ade3811bbe9ca5b">text</a>[0]) <span class="keywordflow">return</span>(0); <span class="comment">/* if nothing to send, dont */</span>
<a name="l17405"></a>17405    <span class="keywordflow">if</span> ((!p-&gt;<a class="code" href="structdahdi__pvt.html#a2042629f86bb4c3dbb7185ed0701e4ca">tdd</a>) &amp;&amp; (!p-&gt;<a class="code" href="structdahdi__pvt.html#ad1e08af45f20c47979c166ecb7b50343" title="TRUE if TDD in MATE mode.">mate</a>)) <span class="keywordflow">return</span>(0);  <span class="comment">/* if not in TDD mode, just return */</span>
<a name="l17406"></a>17406    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#ad1e08af45f20c47979c166ecb7b50343" title="TRUE if TDD in MATE mode.">mate</a>)
<a name="l17407"></a>17407       buf = <a class="code" href="astmm_8h.html#a64a0e7a3ab511a3777ac56f5d43c628e">ast_malloc</a>(((strlen(<a class="code" href="app__queue_8c.html#a5633b1433389cec21ade3811bbe9ca5b">text</a>) + 1) * ASCII_BYTES_PER_CHAR) + END_SILENCE_LEN + HEADER_LEN);
<a name="l17408"></a>17408    <span class="keywordflow">else</span>
<a name="l17409"></a>17409       buf = <a class="code" href="astmm_8h.html#a64a0e7a3ab511a3777ac56f5d43c628e">ast_malloc</a>(((strlen(<a class="code" href="app__queue_8c.html#a5633b1433389cec21ade3811bbe9ca5b">text</a>) + 1) * <a class="code" href="tdd_8h.html#a3ae922be753078396c9ac0f6403a6d06">TDD_BYTES_PER_CHAR</a>) + END_SILENCE_LEN);
<a name="l17410"></a>17410    <span class="keywordflow">if</span> (!buf)
<a name="l17411"></a>17411       <span class="keywordflow">return</span> -1;
<a name="l17412"></a>17412    mybuf = buf;
<a name="l17413"></a>17413    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#ad1e08af45f20c47979c166ecb7b50343" title="TRUE if TDD in MATE mode.">mate</a>) {
<a name="l17414"></a>17414       <span class="keywordtype">int</span> codec = <a class="code" href="chan__dahdi_8c.html#a830b5fdb3ba653640d3f5044192d82bf">AST_LAW</a>(p);
<a name="l17415"></a>17415       <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="chan__dahdi_8c.html#a372dce8627cc49448555f8372f743de9">HEADER_MS</a>; x++) {   <span class="comment">/* 50 ms of Mark */</span>
<a name="l17416"></a>17416          <a class="code" href="callerid_8h.html#a7ce7cf8db165eb44e64e704c3ced9774">PUT_CLID_MARKMS</a>;
<a name="l17417"></a>17417       }
<a name="l17418"></a>17418       <span class="comment">/* Put actual message */</span>
<a name="l17419"></a>17419       <span class="keywordflow">for</span> (x = 0; <a class="code" href="app__queue_8c.html#a5633b1433389cec21ade3811bbe9ca5b">text</a>[x]; x++) {
<a name="l17420"></a>17420          <a class="code" href="callerid_8h.html#a02c7254b3ec648f815c15bd6f8cce39b">PUT_CLID</a>(<a class="code" href="app__queue_8c.html#a5633b1433389cec21ade3811bbe9ca5b">text</a>[x]);
<a name="l17421"></a>17421       }
<a name="l17422"></a>17422       <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="chan__dahdi_8c.html#a9b7ef3aa0efb7411931914e8562c8d46">TRAILER_MS</a>; x++) {  <span class="comment">/* 5 ms of Mark */</span>
<a name="l17423"></a>17423          <a class="code" href="callerid_8h.html#a7ce7cf8db165eb44e64e704c3ced9774">PUT_CLID_MARKMS</a>;
<a name="l17424"></a>17424       }
<a name="l17425"></a>17425       len = bytes;
<a name="l17426"></a>17426       buf = mybuf;
<a name="l17427"></a>17427    } <span class="keywordflow">else</span> {
<a name="l17428"></a>17428       len = <a class="code" href="tdd_8h.html#a867e003f292d4851249d8cbe345c5f5d">tdd_generate</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a2042629f86bb4c3dbb7185ed0701e4ca">tdd</a>, buf, <a class="code" href="app__queue_8c.html#a5633b1433389cec21ade3811bbe9ca5b">text</a>);
<a name="l17429"></a>17429       <span class="keywordflow">if</span> (len &lt; 1) {
<a name="l17430"></a>17430          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;TDD generate (len %d) failed!!\n&quot;</span>, (<span class="keywordtype">int</span>)strlen(<a class="code" href="app__queue_8c.html#a5633b1433389cec21ade3811bbe9ca5b">text</a>));
<a name="l17431"></a>17431          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(mybuf);
<a name="l17432"></a>17432          <span class="keywordflow">return</span> -1;
<a name="l17433"></a>17433       }
<a name="l17434"></a>17434    }
<a name="l17435"></a>17435    memset(buf + len, 0x7f, END_SILENCE_LEN);
<a name="l17436"></a>17436    len += <a class="code" href="chan__dahdi_8c.html#a5b4bd94085f8d9db39f0096a52f795b3">END_SILENCE_LEN</a>;
<a name="l17437"></a>17437    fd = p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>;
<a name="l17438"></a>17438    <span class="keywordflow">while</span> (len) {
<a name="l17439"></a>17439       <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a9c63fff1d736568d1ee332dd7ea502bd" title="Check to see if a channel is needing hang up.">ast_check_hangup</a>(c)) {
<a name="l17440"></a>17440          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(mybuf);
<a name="l17441"></a>17441          <span class="keywordflow">return</span> -1;
<a name="l17442"></a>17442       }
<a name="l17443"></a>17443       size = len;
<a name="l17444"></a>17444       <span class="keywordflow">if</span> (size &gt; <a class="code" href="chan__dahdi_8c.html#a86e1969b50e55e5d506233078ca0fa4c">READ_SIZE</a>)
<a name="l17445"></a>17445          size = <a class="code" href="chan__dahdi_8c.html#a86e1969b50e55e5d506233078ca0fa4c">READ_SIZE</a>;
<a name="l17446"></a>17446       fds[0].fd = fd;
<a name="l17447"></a>17447       fds[0].events = POLLOUT | POLLPRI;
<a name="l17448"></a>17448       fds[0].revents = 0;
<a name="l17449"></a>17449       res = poll(fds, 1, -1);
<a name="l17450"></a>17450       <span class="keywordflow">if</span> (!res) {
<a name="l17451"></a>17451          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;poll (for write) ret. 0 on channel %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l17452"></a>17452          <span class="keywordflow">continue</span>;
<a name="l17453"></a>17453       }
<a name="l17454"></a>17454       <span class="comment">/* if got exception */</span>
<a name="l17455"></a>17455       <span class="keywordflow">if</span> (fds[0].revents &amp; POLLPRI) {
<a name="l17456"></a>17456          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(mybuf);
<a name="l17457"></a>17457          <span class="keywordflow">return</span> -1;
<a name="l17458"></a>17458       }
<a name="l17459"></a>17459       <span class="keywordflow">if</span> (!(fds[0].revents &amp; POLLOUT)) {
<a name="l17460"></a>17460          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;write fd not ready on channel %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l17461"></a>17461          <span class="keywordflow">continue</span>;
<a name="l17462"></a>17462       }
<a name="l17463"></a>17463       res = write(fd, buf, size);
<a name="l17464"></a>17464       <span class="keywordflow">if</span> (res != size) {
<a name="l17465"></a>17465          <span class="keywordflow">if</span> (res == -1) {
<a name="l17466"></a>17466             <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(mybuf);
<a name="l17467"></a>17467             <span class="keywordflow">return</span> -1;
<a name="l17468"></a>17468          }
<a name="l17469"></a>17469          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Write returned %d (%s) on channel %d\n&quot;</span>, res, strerror(errno), p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l17470"></a>17470          <span class="keywordflow">break</span>;
<a name="l17471"></a>17471       }
<a name="l17472"></a>17472       len -= size;
<a name="l17473"></a>17473       buf += size;
<a name="l17474"></a>17474    }
<a name="l17475"></a>17475    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(mybuf);
<a name="l17476"></a>17476    <span class="keywordflow">return</span>(0);
<a name="l17477"></a>17477 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a910621ab1ae9c50093f6e0c1e0873e7e"></a><!-- doxytag: member="chan_dahdi.c::dahdi_set_dnd" ref="a910621ab1ae9c50093f6e0c1e0873e7e" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* dahdi_set_dnd </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l15112">15112</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8h_source.html#l00141">ast_cli_args::argv</a>, <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="utils_8c_source.html#l01328">ast_false()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="utils_8c_source.html#l01311">ast_true()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="cli_8h_source.html#l00045">CLI_FAILURE</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="chan__dahdi_8c_source.html#l07662">dahdi_dnd()</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, <a class="el" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>, <a class="el" href="chan__dahdi_8c_source.html#l00682">dahdi_pvt::next</a>, and <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l15113"></a>15113 {
<a name="l15114"></a>15114    <span class="keywordtype">int</span> channel;
<a name="l15115"></a>15115    <span class="keywordtype">int</span> on;
<a name="l15116"></a>15116    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *dahdi_chan = NULL;
<a name="l15117"></a>15117 
<a name="l15118"></a>15118    <span class="keywordflow">switch</span> (cmd) {
<a name="l15119"></a>15119    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l15120"></a>15120       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;dahdi set dnd&quot;</span>;
<a name="l15121"></a>15121       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l15122"></a>15122          <span class="stringliteral">&quot;Usage: dahdi set dnd &lt;chan#&gt; &lt;on|off&gt;\n&quot;</span>
<a name="l15123"></a>15123          <span class="stringliteral">&quot;  Sets/resets DND (Do Not Disturb) mode on a channel.\n&quot;</span>
<a name="l15124"></a>15124          <span class="stringliteral">&quot;  Changes take effect immediately.\n&quot;</span>
<a name="l15125"></a>15125          <span class="stringliteral">&quot;  &lt;chan num&gt; is the channel number\n&quot;</span>
<a name="l15126"></a>15126          <span class="stringliteral">&quot;  &lt;on|off&gt; Enable or disable DND mode?\n&quot;</span>
<a name="l15127"></a>15127          ;
<a name="l15128"></a>15128       <span class="keywordflow">return</span> NULL;
<a name="l15129"></a>15129    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l15130"></a>15130       <span class="keywordflow">return</span> NULL;
<a name="l15131"></a>15131    }
<a name="l15132"></a>15132 
<a name="l15133"></a>15133    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> != 5)
<a name="l15134"></a>15134       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l15135"></a>15135 
<a name="l15136"></a>15136    <span class="keywordflow">if</span> ((channel = atoi(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3])) &lt;= 0) {
<a name="l15137"></a>15137       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Expected channel number, got &apos;%s&apos;\n&quot;</span>, a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3]);
<a name="l15138"></a>15138       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l15139"></a>15139    }
<a name="l15140"></a>15140 
<a name="l15141"></a>15141    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[4]))
<a name="l15142"></a>15142       on = 1;
<a name="l15143"></a>15143    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a6c3dc0bad204e9dd9890325c1c861e38" title="Make sure something is false. Determine if a string containing a boolean value is...">ast_false</a>(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[4]))
<a name="l15144"></a>15144       on = 0;
<a name="l15145"></a>15145    <span class="keywordflow">else</span> {
<a name="l15146"></a>15146       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Expected &apos;on&apos; or &apos;off&apos;, got &apos;%s&apos;\n&quot;</span>, a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[4]);
<a name="l15147"></a>15147       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l15148"></a>15148    }
<a name="l15149"></a>15149 
<a name="l15150"></a>15150    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;iflock);
<a name="l15151"></a>15151    <span class="keywordflow">for</span> (dahdi_chan = <a class="code" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>; dahdi_chan; dahdi_chan = dahdi_chan-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>) {
<a name="l15152"></a>15152       <span class="keywordflow">if</span> (dahdi_chan-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a> != channel)
<a name="l15153"></a>15153          <span class="keywordflow">continue</span>;
<a name="l15154"></a>15154 
<a name="l15155"></a>15155       <span class="comment">/* Found the channel. Actually set it */</span>
<a name="l15156"></a>15156       <a class="code" href="chan__dahdi_8c.html#a4a0331eaa4997597bbca98a66c514bcd" title="enable or disable the chan_dahdi Do-Not-Disturb mode for a DAHDI channel">dahdi_dnd</a>(dahdi_chan, on);
<a name="l15157"></a>15157       <span class="keywordflow">break</span>;
<a name="l15158"></a>15158    }
<a name="l15159"></a>15159    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;iflock);
<a name="l15160"></a>15160 
<a name="l15161"></a>15161    <span class="keywordflow">if</span> (!dahdi_chan) {
<a name="l15162"></a>15162       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Unable to find given channel %d\n&quot;</span>, channel);
<a name="l15163"></a>15163       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;
<a name="l15164"></a>15164    }
<a name="l15165"></a>15165 
<a name="l15166"></a>15166    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l15167"></a>15167 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7c65e6943db828524ea6c9215b8bf696"></a><!-- doxytag: member="chan_dahdi.c::dahdi_set_hook" ref="a7c65e6943db828524ea6c9215b8bf696" args="(int fd, int hs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int dahdi_set_hook </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>hs</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l02863">2863</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, and <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l06601">__dahdi_exception()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04718">dahdi_answer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04313">dahdi_hangup()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07170">dahdi_indicate()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07635">dahdi_wink()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09116">mwi_send_process_buffer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09203">mwi_send_process_event()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02864"></a>02864 {
<a name="l02865"></a>02865    <span class="keywordtype">int</span> x, res;
<a name="l02866"></a>02866 
<a name="l02867"></a>02867    x = hs;
<a name="l02868"></a>02868    res = ioctl(fd, DAHDI_HOOK, &amp;x);
<a name="l02869"></a>02869 
<a name="l02870"></a>02870    <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l02871"></a>02871       <span class="keywordflow">if</span> (errno == EINPROGRESS)
<a name="l02872"></a>02872          <span class="keywordflow">return</span> 0;
<a name="l02873"></a>02873       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;DAHDI hook failed returned %d (trying %d): %s\n&quot;</span>, res, hs, strerror(errno));
<a name="l02874"></a>02874       <span class="comment">/* will expectedly fail if phone is off hook during operation, such as during a restart */</span>
<a name="l02875"></a>02875    }
<a name="l02876"></a>02876 
<a name="l02877"></a>02877    <span class="keywordflow">return</span> res;
<a name="l02878"></a>02878 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a865b1afdb1075fa1b38f5758e06cb1ca"></a><!-- doxytag: member="chan_dahdi.c::dahdi_set_hwgain" ref="a865b1afdb1075fa1b38f5758e06cb1ca" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* dahdi_set_hwgain </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l14969">14969</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8h_source.html#l00141">ast_cli_args::argv</a>, <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="cli_8h_source.html#l00045">CLI_FAILURE</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, <a class="el" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>, <a class="el" href="chan__dahdi_8c_source.html#l00682">dahdi_pvt::next</a>, <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>, and <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l14970"></a>14970 {
<a name="l14971"></a>14971    <span class="keywordtype">int</span> <a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>;
<a name="l14972"></a>14972    <span class="keywordtype">int</span> gain;
<a name="l14973"></a>14973    <span class="keywordtype">int</span> tx;
<a name="l14974"></a>14974    <span class="keyword">struct </span>dahdi_hwgain hwgain;
<a name="l14975"></a>14975    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *tmp = NULL;
<a name="l14976"></a>14976 
<a name="l14977"></a>14977    <span class="keywordflow">switch</span> (cmd) {
<a name="l14978"></a>14978    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l14979"></a>14979       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;dahdi set hwgain&quot;</span>;
<a name="l14980"></a>14980       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l14981"></a>14981          <span class="stringliteral">&quot;Usage: dahdi set hwgain &lt;rx|tx&gt; &lt;chan#&gt; &lt;gain&gt;\n&quot;</span>
<a name="l14982"></a>14982          <span class="stringliteral">&quot;  Sets the hardware gain on a a given channel, overriding the\n&quot;</span>
<a name="l14983"></a>14983          <span class="stringliteral">&quot;   value provided at module loadtime, whether the channel is in\n&quot;</span>
<a name="l14984"></a>14984          <span class="stringliteral">&quot;   use or not.  Changes take effect immediately.\n&quot;</span>
<a name="l14985"></a>14985          <span class="stringliteral">&quot;   &lt;rx|tx&gt; which direction do you want to change (relative to our module)\n&quot;</span>
<a name="l14986"></a>14986          <span class="stringliteral">&quot;   &lt;chan num&gt; is the channel number relative to the device\n&quot;</span>
<a name="l14987"></a>14987          <span class="stringliteral">&quot;   &lt;gain&gt; is the gain in dB (e.g. -3.5 for -3.5dB)\n&quot;</span>;
<a name="l14988"></a>14988       <span class="keywordflow">return</span> NULL;
<a name="l14989"></a>14989    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l14990"></a>14990       <span class="keywordflow">return</span> NULL;
<a name="l14991"></a>14991    }
<a name="l14992"></a>14992 
<a name="l14993"></a>14993    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> != 6)
<a name="l14994"></a>14994       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l14995"></a>14995 
<a name="l14996"></a>14996    <span class="keywordflow">if</span> (!strcasecmp(<span class="stringliteral">&quot;rx&quot;</span>, a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3]))
<a name="l14997"></a>14997       tx = 0; <span class="comment">/* rx */</span>
<a name="l14998"></a>14998    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<span class="stringliteral">&quot;tx&quot;</span>, a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3]))
<a name="l14999"></a>14999       tx = 1; <span class="comment">/* tx */</span>
<a name="l15000"></a>15000    <span class="keywordflow">else</span>
<a name="l15001"></a>15001       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l15002"></a>15002 
<a name="l15003"></a>15003    channel = atoi(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[4]);
<a name="l15004"></a>15004    gain = atof(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[5])*10.0;
<a name="l15005"></a>15005 
<a name="l15006"></a>15006    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;iflock);
<a name="l15007"></a>15007 
<a name="l15008"></a>15008    <span class="keywordflow">for</span> (tmp = <a class="code" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>; tmp; tmp = tmp-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>) {
<a name="l15009"></a>15009 
<a name="l15010"></a>15010       <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a> != channel)
<a name="l15011"></a>15011          <span class="keywordflow">continue</span>;
<a name="l15012"></a>15012 
<a name="l15013"></a>15013       <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a> == -1)
<a name="l15014"></a>15014          <span class="keywordflow">break</span>;
<a name="l15015"></a>15015 
<a name="l15016"></a>15016       hwgain.newgain = gain;
<a name="l15017"></a>15017       hwgain.tx = tx;
<a name="l15018"></a>15018       <span class="keywordflow">if</span> (ioctl(tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_SET_HWGAIN, &amp;hwgain) &lt; 0) {
<a name="l15019"></a>15019          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Unable to set the hardware gain for channel %d: %s\n&quot;</span>, channel, strerror(errno));
<a name="l15020"></a>15020          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;iflock);
<a name="l15021"></a>15021          <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;
<a name="l15022"></a>15022       }
<a name="l15023"></a>15023       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;hardware %s gain set to %d (%.1f dB) on channel %d\n&quot;</span>,
<a name="l15024"></a>15024          tx ? <span class="stringliteral">&quot;tx&quot;</span> : <span class="stringliteral">&quot;rx&quot;</span>, gain, (<span class="keywordtype">float</span>)gain/10.0, channel);
<a name="l15025"></a>15025       <span class="keywordflow">break</span>;
<a name="l15026"></a>15026    }
<a name="l15027"></a>15027 
<a name="l15028"></a>15028    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;iflock);
<a name="l15029"></a>15029 
<a name="l15030"></a>15030    <span class="keywordflow">if</span> (tmp)
<a name="l15031"></a>15031       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l15032"></a>15032 
<a name="l15033"></a>15033    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Unable to find given channel %d\n&quot;</span>, channel);
<a name="l15034"></a>15034    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;
<a name="l15035"></a>15035 
<a name="l15036"></a>15036 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a42d3da6ead0459ad04213cd1b95620cf"></a><!-- doxytag: member="chan_dahdi.c::dahdi_set_swgain" ref="a42d3da6ead0459ad04213cd1b95620cf" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* dahdi_set_swgain </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l15038">15038</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8h_source.html#l00141">ast_cli_args::argv</a>, <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="cli_8h_source.html#l00045">CLI_FAILURE</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, <a class="el" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>, <a class="el" href="chan__dahdi_8c_source.html#l01022">dahdi_pvt::law</a>, <a class="el" href="app__meetme_8c_source.html#l00842">lock</a>, <a class="el" href="chan__dahdi_8c_source.html#l00682">dahdi_pvt::next</a>, <a class="el" href="chan__dahdi_8c_source.html#l02813">set_actual_rxgain()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02795">set_actual_txgain()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>, and <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l15039"></a>15039 {
<a name="l15040"></a>15040    <span class="keywordtype">int</span> <a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>;
<a name="l15041"></a>15041    <span class="keywordtype">float</span> gain;
<a name="l15042"></a>15042    <span class="keywordtype">int</span> tx;
<a name="l15043"></a>15043    <span class="keywordtype">int</span> res;
<a name="l15044"></a>15044    <a class="code" href="lock_8h.html#a2d9118a2a8939f115eea771bce3a52f2">ast_mutex_t</a> *<a class="code" href="app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>;
<a name="l15045"></a>15045    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *tmp = NULL;
<a name="l15046"></a>15046 
<a name="l15047"></a>15047    <span class="keywordflow">switch</span> (cmd) {
<a name="l15048"></a>15048    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l15049"></a>15049       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;dahdi set swgain&quot;</span>;
<a name="l15050"></a>15050       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l15051"></a>15051          <span class="stringliteral">&quot;Usage: dahdi set swgain &lt;rx|tx&gt; &lt;chan#&gt; &lt;gain&gt;\n&quot;</span>
<a name="l15052"></a>15052          <span class="stringliteral">&quot;  Sets the software gain on a a given channel, overriding the\n&quot;</span>
<a name="l15053"></a>15053          <span class="stringliteral">&quot;   value provided at module loadtime, whether the channel is in\n&quot;</span>
<a name="l15054"></a>15054          <span class="stringliteral">&quot;   use or not.  Changes take effect immediately.\n&quot;</span>
<a name="l15055"></a>15055          <span class="stringliteral">&quot;   &lt;rx|tx&gt; which direction do you want to change (relative to our module)\n&quot;</span>
<a name="l15056"></a>15056          <span class="stringliteral">&quot;   &lt;chan num&gt; is the channel number relative to the device\n&quot;</span>
<a name="l15057"></a>15057          <span class="stringliteral">&quot;   &lt;gain&gt; is the gain in dB (e.g. -3.5 for -3.5dB)\n&quot;</span>;
<a name="l15058"></a>15058       <span class="keywordflow">return</span> NULL;
<a name="l15059"></a>15059    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l15060"></a>15060       <span class="keywordflow">return</span> NULL;
<a name="l15061"></a>15061    }
<a name="l15062"></a>15062 
<a name="l15063"></a>15063    lock = &amp;iflock;
<a name="l15064"></a>15064 
<a name="l15065"></a>15065    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> != 6)
<a name="l15066"></a>15066       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l15067"></a>15067 
<a name="l15068"></a>15068    <span class="keywordflow">if</span> (!strcasecmp(<span class="stringliteral">&quot;rx&quot;</span>, a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3]))
<a name="l15069"></a>15069       tx = 0; <span class="comment">/* rx */</span>
<a name="l15070"></a>15070    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<span class="stringliteral">&quot;tx&quot;</span>, a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3]))
<a name="l15071"></a>15071       tx = 1; <span class="comment">/* tx */</span>
<a name="l15072"></a>15072    <span class="keywordflow">else</span>
<a name="l15073"></a>15073       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l15074"></a>15074 
<a name="l15075"></a>15075    channel = atoi(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[4]);
<a name="l15076"></a>15076    gain = atof(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[5]);
<a name="l15077"></a>15077 
<a name="l15078"></a>15078    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(lock);
<a name="l15079"></a>15079    <span class="keywordflow">for</span> (tmp = <a class="code" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>; tmp; tmp = tmp-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>) {
<a name="l15080"></a>15080 
<a name="l15081"></a>15081       <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a> != channel)
<a name="l15082"></a>15082          <span class="keywordflow">continue</span>;
<a name="l15083"></a>15083 
<a name="l15084"></a>15084       <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a> == -1)
<a name="l15085"></a>15085          <span class="keywordflow">break</span>;
<a name="l15086"></a>15086 
<a name="l15087"></a>15087       <span class="keywordflow">if</span> (tx)
<a name="l15088"></a>15088          res = <a class="code" href="chan__dahdi_8c.html#a7327b1abb40a4d2dfcb05a13e132371f">set_actual_txgain</a>(tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, channel, gain, tmp-&gt;<a class="code" href="structdahdi__pvt.html#a17dd7b17c0e736754e01e575ca8d8cb8" title="Active PCM encoding format: DAHDI_LAW_ALAW or DAHDI_LAW_MULAW.">law</a>);
<a name="l15089"></a>15089       <span class="keywordflow">else</span>
<a name="l15090"></a>15090          res = <a class="code" href="chan__dahdi_8c.html#a199b65731d7c30946121938cc548b69c">set_actual_rxgain</a>(tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, channel, gain, tmp-&gt;<a class="code" href="structdahdi__pvt.html#a17dd7b17c0e736754e01e575ca8d8cb8" title="Active PCM encoding format: DAHDI_LAW_ALAW or DAHDI_LAW_MULAW.">law</a>);
<a name="l15091"></a>15091 
<a name="l15092"></a>15092       <span class="keywordflow">if</span> (res) {
<a name="l15093"></a>15093          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Unable to set the software gain for channel %d\n&quot;</span>, channel);
<a name="l15094"></a>15094          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(lock);
<a name="l15095"></a>15095          <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;
<a name="l15096"></a>15096       }
<a name="l15097"></a>15097 
<a name="l15098"></a>15098       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;software %s gain set to %.1f on channel %d\n&quot;</span>,
<a name="l15099"></a>15099          tx ? <span class="stringliteral">&quot;tx&quot;</span> : <span class="stringliteral">&quot;rx&quot;</span>, gain, channel);
<a name="l15100"></a>15100       <span class="keywordflow">break</span>;
<a name="l15101"></a>15101    }
<a name="l15102"></a>15102    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(lock);
<a name="l15103"></a>15103 
<a name="l15104"></a>15104    <span class="keywordflow">if</span> (tmp)
<a name="l15105"></a>15105       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l15106"></a>15106 
<a name="l15107"></a>15107    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Unable to find given channel %d\n&quot;</span>, channel);
<a name="l15108"></a>15108    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;
<a name="l15109"></a>15109 
<a name="l15110"></a>15110 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8392b32cf7d3daa7b45154b7001460df"></a><!-- doxytag: member="chan_dahdi.c::dahdi_setlinear" ref="a8392b32cf7d3daa7b45154b7001460df" args="(int dfd, int linear)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int dahdi_setlinear </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>dfd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>linear</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l02165">2165</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l04313">dahdi_hangup()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07417">dahdi_new()</a>, <a class="el" href="chan__dahdi_8c_source.html#l06717">dahdi_read()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07090">dahdi_write()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03026">send_callerid()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02166"></a>02166 {
<a name="l02167"></a>02167    <span class="keywordtype">int</span> res;
<a name="l02168"></a>02168    res = ioctl(dfd, DAHDI_SETLINEAR, &amp;linear);
<a name="l02169"></a>02169    <span class="keywordflow">if</span> (res)
<a name="l02170"></a>02170       <span class="keywordflow">return</span> res;
<a name="l02171"></a>02171    <span class="keywordflow">return</span> 0;
<a name="l02172"></a>02172 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a983e979fabe9ac6d4012524c7c2107d8"></a><!-- doxytag: member="chan_dahdi.c::dahdi_setoption" ref="a983e979fabe9ac6d4012524c7c2107d8" args="(struct ast_channel *chan, int option, void *data, int datalen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int dahdi_setoption </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>option</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>datalen</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><dl class="todo"><dt><b><a class="el" href="todo.html#_todo000008">Todo:</a></b></dt><dd>XXX This is an abuse of the stack!! </dd></dl>
</p>

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l04837">4837</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l00461">ast_check_hangup()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="dsp_8c_source.html#l01628">ast_dsp_set_digitmode()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="frame_8h_source.html#l00376">AST_OPTION_AUDIO_MODE</a>, <a class="el" href="frame_8h_source.html#l00398">AST_OPTION_ECHOCAN</a>, <a class="el" href="frame_8h_source.html#l00395">AST_OPTION_OPRMODE</a>, <a class="el" href="frame_8h_source.html#l00373">AST_OPTION_RELAXDTMF</a>, <a class="el" href="frame_8h_source.html#l00392">AST_OPTION_RXGAIN</a>, <a class="el" href="frame_8h_source.html#l00370">AST_OPTION_TDD</a>, <a class="el" href="frame_8h_source.html#l00367">AST_OPTION_TONE_VERIFY</a>, <a class="el" href="frame_8h_source.html#l00384">AST_OPTION_TXGAIN</a>, <a class="el" href="tdd_8c_source.html#l00143">ast_tdd_gen_ecdisa()</a>, <a class="el" href="adsistub_8c_source.html#l00059">buf</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="chan__dahdi_8c_source.html#l02709">dahdi_disable_ec()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02660">dahdi_enable_ec()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01503">dahdi_get_index()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="chan__dahdi_8c_source.html#l00741">dahdi_pvt::didtdd</a>, <a class="el" href="chan__dahdi_8c_source.html#l01113">dahdi_pvt::dsp</a>, <a class="el" href="dsp_8h_source.html#l00031">DSP_DIGITMODE_DTMF</a>, <a class="el" href="dsp_8h_source.html#l00035">DSP_DIGITMODE_MUTECONF</a>, <a class="el" href="dsp_8h_source.html#l00036">DSP_DIGITMODE_MUTEMAX</a>, <a class="el" href="dsp_8h_source.html#l00037">DSP_DIGITMODE_RELAXDTMF</a>, <a class="el" href="chan__dahdi_8c_source.html#l01147">dahdi_pvt::dtmfrelax</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="chan__dahdi_8c_source.html#l01022">dahdi_pvt::law</a>, <a class="el" href="func__strings_8c_source.html#l00821">len()</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__dahdi_8c_source.html#l00799">dahdi_pvt::mate</a>, <a class="el" href="frame_8h_source.html#l00408">oprmode::mode</a>, <a class="el" href="chan__dahdi_8c_source.html#l00673">dahdi_pvt::oprmode</a>, <a class="el" href="chan__dahdi_8c_source.html#l00674">dahdi_pvt::oprpeer</a>, <a class="el" href="frame_8h_source.html#l00407">oprmode::peer</a>, <a class="el" href="chan__usbradio_8c_source.html#l03157">pp</a>, <a class="el" href="chan__dahdi_8c_source.html#l00397">READ_SIZE</a>, <a class="el" href="chan__dahdi_8c_source.html#l00678">dahdi_pvt::rxgain</a>, <a class="el" href="chan__dahdi_8c_source.html#l02813">set_actual_rxgain()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02795">set_actual_txgain()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>, <a class="el" href="chan__dahdi_8c_source.html#l01122">dahdi_pvt::tdd</a>, <a class="el" href="tdd_8c_source.html#l00213">tdd_free()</a>, <a class="el" href="tdd_8c_source.html#l00098">tdd_new()</a>, <a class="el" href="channel_8h_source.html#l00400">ast_channel::tech</a>, <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>, <a class="el" href="chan__dahdi_8c_source.html#l00680">dahdi_pvt::txgain</a>, and <a class="el" href="channel_8h_source.html#l00226">ast_channel_tech::type</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04838"></a>04838 {
<a name="l04839"></a>04839    <span class="keywordtype">char</span> *cp;
<a name="l04840"></a>04840    <span class="keywordtype">signed</span> <span class="keywordtype">char</span> *scp;
<a name="l04841"></a>04841    <span class="keywordtype">int</span> x;
<a name="l04842"></a>04842    <span class="keywordtype">int</span> idx;
<a name="l04843"></a>04843    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *p = chan-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>, *<a class="code" href="chan__usbradio_8c.html#a76ef0d203c3e50e32968f67eb382677d">pp</a>;
<a name="l04844"></a>04844    <span class="keyword">struct </span><a class="code" href="structoprmode.html">oprmode</a> *<a class="code" href="structoprmode.html">oprmode</a>;
<a name="l04845"></a>04845 
<a name="l04846"></a>04846 
<a name="l04847"></a>04847    <span class="comment">/* all supported options require data */</span>
<a name="l04848"></a>04848    <span class="keywordflow">if</span> (!data || (datalen &lt; 1)) {
<a name="l04849"></a>04849       <a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> = EINVAL;
<a name="l04850"></a>04850       <span class="keywordflow">return</span> -1;
<a name="l04851"></a>04851    }
<a name="l04852"></a>04852 
<a name="l04853"></a>04853    <span class="keywordflow">switch</span> (option) {
<a name="l04854"></a>04854    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#abcf55626860f173284cafa474946d9b2">AST_OPTION_TXGAIN</a>:
<a name="l04855"></a>04855       scp = (<span class="keywordtype">signed</span> <span class="keywordtype">char</span> *) data;
<a name="l04856"></a>04856       idx = <a class="code" href="chan__dahdi_8c.html#a62c8e3f411fb9e5ec62a1e77c152c2df">dahdi_get_index</a>(chan, p, 0);
<a name="l04857"></a>04857       <span class="keywordflow">if</span> (idx &lt; 0) {
<a name="l04858"></a>04858          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No index in TXGAIN?\n&quot;</span>);
<a name="l04859"></a>04859          <span class="keywordflow">return</span> -1;
<a name="l04860"></a>04860       }
<a name="l04861"></a>04861       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Setting actual tx gain on %s to %f\n&quot;</span>, chan-&gt;name, p-&gt;<a class="code" href="structdahdi__pvt.html#ad291967734f3b7bee3ec179278a1f76f" title="Tx gain set by chan_dahdi.conf.">txgain</a> + (<span class="keywordtype">float</span>) *scp);
<a name="l04862"></a>04862       <span class="keywordflow">return</span> <a class="code" href="chan__dahdi_8c.html#a7327b1abb40a4d2dfcb05a13e132371f">set_actual_txgain</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, 0, p-&gt;<a class="code" href="structdahdi__pvt.html#ad291967734f3b7bee3ec179278a1f76f" title="Tx gain set by chan_dahdi.conf.">txgain</a> + (<span class="keywordtype">float</span>) *scp, p-&gt;<a class="code" href="structdahdi__pvt.html#a17dd7b17c0e736754e01e575ca8d8cb8" title="Active PCM encoding format: DAHDI_LAW_ALAW or DAHDI_LAW_MULAW.">law</a>);
<a name="l04863"></a>04863    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a3e9274bcddca58b613f4e676b9943c03">AST_OPTION_RXGAIN</a>:
<a name="l04864"></a>04864       scp = (<span class="keywordtype">signed</span> <span class="keywordtype">char</span> *) data;
<a name="l04865"></a>04865       idx = <a class="code" href="chan__dahdi_8c.html#a62c8e3f411fb9e5ec62a1e77c152c2df">dahdi_get_index</a>(chan, p, 0);
<a name="l04866"></a>04866       <span class="keywordflow">if</span> (idx &lt; 0) {
<a name="l04867"></a>04867          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No index in RXGAIN?\n&quot;</span>);
<a name="l04868"></a>04868          <span class="keywordflow">return</span> -1;
<a name="l04869"></a>04869       }
<a name="l04870"></a>04870       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Setting actual rx gain on %s to %f\n&quot;</span>, chan-&gt;name, p-&gt;<a class="code" href="structdahdi__pvt.html#aeebb464c72892c9f3ddafed5ade720ee" title="Rx gain set by chan_dahdi.conf.">rxgain</a> + (<span class="keywordtype">float</span>) *scp);
<a name="l04871"></a>04871       <span class="keywordflow">return</span> <a class="code" href="chan__dahdi_8c.html#a199b65731d7c30946121938cc548b69c">set_actual_rxgain</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, 0, p-&gt;<a class="code" href="structdahdi__pvt.html#aeebb464c72892c9f3ddafed5ade720ee" title="Rx gain set by chan_dahdi.conf.">rxgain</a> + (<span class="keywordtype">float</span>) *scp, p-&gt;<a class="code" href="structdahdi__pvt.html#a17dd7b17c0e736754e01e575ca8d8cb8" title="Active PCM encoding format: DAHDI_LAW_ALAW or DAHDI_LAW_MULAW.">law</a>);
<a name="l04872"></a>04872    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a31312f6b6c2296e3495ad1d9e198cbf4">AST_OPTION_TONE_VERIFY</a>:
<a name="l04873"></a>04873       <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>)
<a name="l04874"></a>04874          <span class="keywordflow">break</span>;
<a name="l04875"></a>04875       cp = (<span class="keywordtype">char</span> *) data;
<a name="l04876"></a>04876       <span class="keywordflow">switch</span> (*cp) {
<a name="l04877"></a>04877       <span class="keywordflow">case</span> 1:
<a name="l04878"></a>04878          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Set option TONE VERIFY, mode: MUTECONF(1) on %s\n&quot;</span>,chan-&gt;name);
<a name="l04879"></a>04879          <a class="code" href="dsp_8h.html#aa28ffa065bd46d09b5b06de2f77183b0" title="Set digit mode.">ast_dsp_set_digitmode</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>, <a class="code" href="dsp_8h.html#aa34f768f0cae2ee8f2db1e8f57f02b21">DSP_DIGITMODE_MUTECONF</a> | p-&gt;<a class="code" href="structdahdi__pvt.html#a6829c6ed48c184cbd85055163786a7eb">dtmfrelax</a>);  <span class="comment">/* set mute mode if desired */</span>
<a name="l04880"></a>04880          <span class="keywordflow">break</span>;
<a name="l04881"></a>04881       <span class="keywordflow">case</span> 2:
<a name="l04882"></a>04882          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Set option TONE VERIFY, mode: MUTECONF/MAX(2) on %s\n&quot;</span>,chan-&gt;name);
<a name="l04883"></a>04883          <a class="code" href="dsp_8h.html#aa28ffa065bd46d09b5b06de2f77183b0" title="Set digit mode.">ast_dsp_set_digitmode</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>, <a class="code" href="dsp_8h.html#aa34f768f0cae2ee8f2db1e8f57f02b21">DSP_DIGITMODE_MUTECONF</a> | <a class="code" href="dsp_8h.html#a6d78a2f3c0532d36beca1b8b5e97eb30">DSP_DIGITMODE_MUTEMAX</a> | p-&gt;<a class="code" href="structdahdi__pvt.html#a6829c6ed48c184cbd85055163786a7eb">dtmfrelax</a>);  <span class="comment">/* set mute mode if desired */</span>
<a name="l04884"></a>04884          <span class="keywordflow">break</span>;
<a name="l04885"></a>04885       <span class="keywordflow">default</span>:
<a name="l04886"></a>04886          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Set option TONE VERIFY, mode: OFF(0) on %s\n&quot;</span>,chan-&gt;name);
<a name="l04887"></a>04887          <a class="code" href="dsp_8h.html#aa28ffa065bd46d09b5b06de2f77183b0" title="Set digit mode.">ast_dsp_set_digitmode</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>, <a class="code" href="dsp_8h.html#af0e16e88030540319d8a545dd7c2576c">DSP_DIGITMODE_DTMF</a> | p-&gt;<a class="code" href="structdahdi__pvt.html#a6829c6ed48c184cbd85055163786a7eb">dtmfrelax</a>);  <span class="comment">/* set mute mode if desired */</span>
<a name="l04888"></a>04888          <span class="keywordflow">break</span>;
<a name="l04889"></a>04889       }
<a name="l04890"></a>04890       <span class="keywordflow">break</span>;
<a name="l04891"></a>04891    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aa27da183a0551e3f9497a8064e24b0b6">AST_OPTION_TDD</a>:
<a name="l04892"></a>04892       <span class="comment">/* turn on or off TDD */</span>
<a name="l04893"></a>04893       cp = (<span class="keywordtype">char</span> *) data;
<a name="l04894"></a>04894       p-&gt;<a class="code" href="structdahdi__pvt.html#ad1e08af45f20c47979c166ecb7b50343" title="TRUE if TDD in MATE mode.">mate</a> = 0;
<a name="l04895"></a>04895       <span class="keywordflow">if</span> (!*cp) { <span class="comment">/* turn it off */</span>
<a name="l04896"></a>04896          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Set option TDD MODE, value: OFF(0) on %s\n&quot;</span>,chan-&gt;name);
<a name="l04897"></a>04897          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a2042629f86bb4c3dbb7185ed0701e4ca">tdd</a>)
<a name="l04898"></a>04898             <a class="code" href="tdd_8h.html#ad636c3d55be97483b9a09f91b984202d">tdd_free</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a2042629f86bb4c3dbb7185ed0701e4ca">tdd</a>);
<a name="l04899"></a>04899          p-&gt;<a class="code" href="structdahdi__pvt.html#a2042629f86bb4c3dbb7185ed0701e4ca">tdd</a> = 0;
<a name="l04900"></a>04900          <span class="keywordflow">break</span>;
<a name="l04901"></a>04901       }
<a name="l04902"></a>04902       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Set option TDD MODE, value: %s(%d) on %s\n&quot;</span>,
<a name="l04903"></a>04903          (*cp == 2) ? <span class="stringliteral">&quot;MATE&quot;</span> : <span class="stringliteral">&quot;ON&quot;</span>, (<span class="keywordtype">int</span>) *cp, chan-&gt;name);
<a name="l04904"></a>04904       <a class="code" href="chan__dahdi_8c.html#a5ceb6fd5bd012740d50b04e84fb29be4">dahdi_disable_ec</a>(p);
<a name="l04905"></a>04905       <span class="comment">/* otherwise, turn it on */</span>
<a name="l04906"></a>04906       <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="structdahdi__pvt.html#aa28ac1bb597b0510dd06d72ac1a30c10">didtdd</a>) { <span class="comment">/* if havent done it yet */</span>
<a name="l04907"></a>04907          <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> mybuf[41000];<span class="comment">/*! \todo XXX This is an abuse of the stack!! */</span>
<a name="l04908"></a>04908          <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>;
<a name="l04909"></a>04909          <span class="keywordtype">int</span> size, res, fd, <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>;
<a name="l04910"></a>04910          <span class="keyword">struct </span>pollfd fds[1];
<a name="l04911"></a>04911 
<a name="l04912"></a>04912          buf = mybuf;
<a name="l04913"></a>04913          memset(buf, 0x7f, <span class="keyword">sizeof</span>(mybuf)); <span class="comment">/* set to silence */</span>
<a name="l04914"></a>04914          <a class="code" href="tdd_8h.html#adcf51d0da81c369977ea4ac7cb0afcf8">ast_tdd_gen_ecdisa</a>(buf + 16000, 16000);  <span class="comment">/* put in tone */</span>
<a name="l04915"></a>04915          len = 40000;
<a name="l04916"></a>04916          idx = <a class="code" href="chan__dahdi_8c.html#a62c8e3f411fb9e5ec62a1e77c152c2df">dahdi_get_index</a>(chan, p, 0);
<a name="l04917"></a>04917          <span class="keywordflow">if</span> (idx &lt; 0) {
<a name="l04918"></a>04918             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No index in TDD?\n&quot;</span>);
<a name="l04919"></a>04919             <span class="keywordflow">return</span> -1;
<a name="l04920"></a>04920          }
<a name="l04921"></a>04921          fd = p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>;
<a name="l04922"></a>04922          <span class="keywordflow">while</span> (len) {
<a name="l04923"></a>04923             <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a9c63fff1d736568d1ee332dd7ea502bd" title="Check to see if a channel is needing hang up.">ast_check_hangup</a>(chan))
<a name="l04924"></a>04924                <span class="keywordflow">return</span> -1;
<a name="l04925"></a>04925             size = len;
<a name="l04926"></a>04926             <span class="keywordflow">if</span> (size &gt; <a class="code" href="chan__dahdi_8c.html#a86e1969b50e55e5d506233078ca0fa4c">READ_SIZE</a>)
<a name="l04927"></a>04927                size = <a class="code" href="chan__dahdi_8c.html#a86e1969b50e55e5d506233078ca0fa4c">READ_SIZE</a>;
<a name="l04928"></a>04928             fds[0].fd = fd;
<a name="l04929"></a>04929             fds[0].events = POLLPRI | POLLOUT;
<a name="l04930"></a>04930             fds[0].revents = 0;
<a name="l04931"></a>04931             res = poll(fds, 1, -1);
<a name="l04932"></a>04932             <span class="keywordflow">if</span> (!res) {
<a name="l04933"></a>04933                <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;poll (for write) ret. 0 on channel %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l04934"></a>04934                <span class="keywordflow">continue</span>;
<a name="l04935"></a>04935             }
<a name="l04936"></a>04936             <span class="comment">/* if got exception */</span>
<a name="l04937"></a>04937             <span class="keywordflow">if</span> (fds[0].revents &amp; POLLPRI)
<a name="l04938"></a>04938                <span class="keywordflow">return</span> -1;
<a name="l04939"></a>04939             <span class="keywordflow">if</span> (!(fds[0].revents &amp; POLLOUT)) {
<a name="l04940"></a>04940                <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;write fd not ready on channel %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l04941"></a>04941                <span class="keywordflow">continue</span>;
<a name="l04942"></a>04942             }
<a name="l04943"></a>04943             res = write(fd, buf, size);
<a name="l04944"></a>04944             <span class="keywordflow">if</span> (res != size) {
<a name="l04945"></a>04945                <span class="keywordflow">if</span> (res == -1) <span class="keywordflow">return</span> -1;
<a name="l04946"></a>04946                <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Write returned %d (%s) on channel %d\n&quot;</span>, res, strerror(errno), p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l04947"></a>04947                <span class="keywordflow">break</span>;
<a name="l04948"></a>04948             }
<a name="l04949"></a>04949             len -= size;
<a name="l04950"></a>04950             buf += size;
<a name="l04951"></a>04951          }
<a name="l04952"></a>04952          p-&gt;<a class="code" href="structdahdi__pvt.html#aa28ac1bb597b0510dd06d72ac1a30c10">didtdd</a> = 1; <span class="comment">/* set to have done it now */</span>
<a name="l04953"></a>04953       }
<a name="l04954"></a>04954       <span class="keywordflow">if</span> (*cp == 2) { <span class="comment">/* Mate mode */</span>
<a name="l04955"></a>04955          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a2042629f86bb4c3dbb7185ed0701e4ca">tdd</a>)
<a name="l04956"></a>04956             <a class="code" href="tdd_8h.html#ad636c3d55be97483b9a09f91b984202d">tdd_free</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a2042629f86bb4c3dbb7185ed0701e4ca">tdd</a>);
<a name="l04957"></a>04957          p-&gt;<a class="code" href="structdahdi__pvt.html#a2042629f86bb4c3dbb7185ed0701e4ca">tdd</a> = 0;
<a name="l04958"></a>04958          p-&gt;<a class="code" href="structdahdi__pvt.html#ad1e08af45f20c47979c166ecb7b50343" title="TRUE if TDD in MATE mode.">mate</a> = 1;
<a name="l04959"></a>04959          <span class="keywordflow">break</span>;
<a name="l04960"></a>04960       }
<a name="l04961"></a>04961       <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="structdahdi__pvt.html#a2042629f86bb4c3dbb7185ed0701e4ca">tdd</a>) { <span class="comment">/* if we dont have one yet */</span>
<a name="l04962"></a>04962          p-&gt;<a class="code" href="structdahdi__pvt.html#a2042629f86bb4c3dbb7185ed0701e4ca">tdd</a> = <a class="code" href="tdd_8h.html#aac9b480ebdb80d1f7c7067a111c5235e">tdd_new</a>(); <span class="comment">/* allocate one */</span>
<a name="l04963"></a>04963       }
<a name="l04964"></a>04964       <span class="keywordflow">break</span>;
<a name="l04965"></a>04965    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a255dd10b04d66ed03d553244b4aa2f15">AST_OPTION_RELAXDTMF</a>:  <span class="comment">/* Relax DTMF decoding (or not) */</span>
<a name="l04966"></a>04966       <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>)
<a name="l04967"></a>04967          <span class="keywordflow">break</span>;
<a name="l04968"></a>04968       cp = (<span class="keywordtype">char</span> *) data;
<a name="l04969"></a>04969       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Set option RELAX DTMF, value: %s(%d) on %s\n&quot;</span>,
<a name="l04970"></a>04970          *cp ? <span class="stringliteral">&quot;ON&quot;</span> : <span class="stringliteral">&quot;OFF&quot;</span>, (<span class="keywordtype">int</span>) *cp, chan-&gt;name);
<a name="l04971"></a>04971       <a class="code" href="dsp_8h.html#aa28ffa065bd46d09b5b06de2f77183b0" title="Set digit mode.">ast_dsp_set_digitmode</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>, ((*cp) ? <a class="code" href="dsp_8h.html#af955a2d9ad32683d8d783619480cd348">DSP_DIGITMODE_RELAXDTMF</a> : <a class="code" href="dsp_8h.html#af0e16e88030540319d8a545dd7c2576c">DSP_DIGITMODE_DTMF</a>) | p-&gt;<a class="code" href="structdahdi__pvt.html#a6829c6ed48c184cbd85055163786a7eb">dtmfrelax</a>);
<a name="l04972"></a>04972       <span class="keywordflow">break</span>;
<a name="l04973"></a>04973    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aee98973da4263b45bacb162534a66cfc">AST_OPTION_AUDIO_MODE</a>:  <span class="comment">/* Set AUDIO mode (or not) */</span>
<a name="l04974"></a>04974       cp = (<span class="keywordtype">char</span> *) data;
<a name="l04975"></a>04975       <span class="keywordflow">if</span> (!*cp) {
<a name="l04976"></a>04976          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Set option AUDIO MODE, value: OFF(0) on %s\n&quot;</span>, chan-&gt;name);
<a name="l04977"></a>04977          x = 0;
<a name="l04978"></a>04978          <a class="code" href="chan__dahdi_8c.html#a5ceb6fd5bd012740d50b04e84fb29be4">dahdi_disable_ec</a>(p);
<a name="l04979"></a>04979       } <span class="keywordflow">else</span> {
<a name="l04980"></a>04980          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Set option AUDIO MODE, value: ON(1) on %s\n&quot;</span>, chan-&gt;name);
<a name="l04981"></a>04981          x = 1;
<a name="l04982"></a>04982       }
<a name="l04983"></a>04983       <span class="keywordflow">if</span> (ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_AUDIOMODE, &amp;x) == -1)
<a name="l04984"></a>04984          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to set audio mode on channel %d to %d: %s\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, x, strerror(errno));
<a name="l04985"></a>04985       <span class="keywordflow">break</span>;
<a name="l04986"></a>04986    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a5cb9d9050e5d0ec07f7c85849aea5b52">AST_OPTION_OPRMODE</a>:  <span class="comment">/* Operator services mode */</span>
<a name="l04987"></a>04987       oprmode = (<span class="keyword">struct </span>oprmode *) data;
<a name="l04988"></a>04988       <span class="comment">/* We don&apos;t support operator mode across technologies */</span>
<a name="l04989"></a>04989       <span class="keywordflow">if</span> (strcasecmp(chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>, oprmode-&gt;<a class="code" href="structoprmode.html#a49ad9c522be37a447242ba7ff4a1e0db">peer</a>-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>)) {
<a name="l04990"></a>04990          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Operator mode not supported on %s to %s calls.\n&quot;</span>,
<a name="l04991"></a>04991                chan-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>, oprmode-&gt;<a class="code" href="structoprmode.html#a49ad9c522be37a447242ba7ff4a1e0db">peer</a>-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>);
<a name="l04992"></a>04992          <a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> = EINVAL;
<a name="l04993"></a>04993          <span class="keywordflow">return</span> -1;
<a name="l04994"></a>04994       }
<a name="l04995"></a>04995       <a class="code" href="chan__usbradio_8c.html#a76ef0d203c3e50e32968f67eb382677d">pp</a> = oprmode-&gt;<a class="code" href="structoprmode.html#a49ad9c522be37a447242ba7ff4a1e0db">peer</a>-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l04996"></a>04996       p-&gt;<a class="code" href="structdahdi__pvt.html#a3b3cefe7a33d0cff61f3a2b5955b6c8b">oprmode</a> = <a class="code" href="chan__usbradio_8c.html#a76ef0d203c3e50e32968f67eb382677d">pp</a>-&gt;oprmode = 0;
<a name="l04997"></a>04997       <span class="comment">/* setup peers */</span>
<a name="l04998"></a>04998       p-&gt;<a class="code" href="structdahdi__pvt.html#a32e155760f552f4f2c0780e27b173c8c">oprpeer</a> = <a class="code" href="chan__usbradio_8c.html#a76ef0d203c3e50e32968f67eb382677d">pp</a>;
<a name="l04999"></a>04999       <a class="code" href="chan__usbradio_8c.html#a76ef0d203c3e50e32968f67eb382677d">pp</a>-&gt;oprpeer = p;
<a name="l05000"></a>05000       <span class="comment">/* setup modes, if any */</span>
<a name="l05001"></a>05001       <span class="keywordflow">if</span> (oprmode-&gt;<a class="code" href="structoprmode.html#a1ea5d0cb93f22f7d0fdf804bd68c3326">mode</a>)
<a name="l05002"></a>05002       {
<a name="l05003"></a>05003          <a class="code" href="chan__usbradio_8c.html#a76ef0d203c3e50e32968f67eb382677d">pp</a>-&gt;oprmode = oprmode-&gt;<a class="code" href="structoprmode.html#a1ea5d0cb93f22f7d0fdf804bd68c3326">mode</a>;
<a name="l05004"></a>05004          p-&gt;<a class="code" href="structdahdi__pvt.html#a3b3cefe7a33d0cff61f3a2b5955b6c8b">oprmode</a> = -oprmode-&gt;<a class="code" href="structoprmode.html#a1ea5d0cb93f22f7d0fdf804bd68c3326">mode</a>;
<a name="l05005"></a>05005       }
<a name="l05006"></a>05006       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Set Operator Services mode, value: %d on %s/%s\n&quot;</span>,
<a name="l05007"></a>05007          oprmode-&gt;<a class="code" href="structoprmode.html#a1ea5d0cb93f22f7d0fdf804bd68c3326">mode</a>, chan-&gt;name,oprmode-&gt;<a class="code" href="structoprmode.html#a49ad9c522be37a447242ba7ff4a1e0db">peer</a>-&gt;name);
<a name="l05008"></a>05008       <span class="keywordflow">break</span>;
<a name="l05009"></a>05009    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ac888578b526eb9f2c888d248fdbe17e3">AST_OPTION_ECHOCAN</a>:
<a name="l05010"></a>05010       cp = (<span class="keywordtype">char</span> *) data;
<a name="l05011"></a>05011       <span class="keywordflow">if</span> (*cp) {
<a name="l05012"></a>05012          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Enabling echo cancelation on %s\n&quot;</span>, chan-&gt;name);
<a name="l05013"></a>05013          <a class="code" href="chan__dahdi_8c.html#a8c34a5bce2b26d056942349217806312">dahdi_enable_ec</a>(p);
<a name="l05014"></a>05014       } <span class="keywordflow">else</span> {
<a name="l05015"></a>05015          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Disabling echo cancelation on %s\n&quot;</span>, chan-&gt;name);
<a name="l05016"></a>05016          <a class="code" href="chan__dahdi_8c.html#a5ceb6fd5bd012740d50b04e84fb29be4">dahdi_disable_ec</a>(p);
<a name="l05017"></a>05017       }
<a name="l05018"></a>05018       <span class="keywordflow">break</span>;
<a name="l05019"></a>05019    }
<a name="l05020"></a>05020    <a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> = 0;
<a name="l05021"></a>05021 
<a name="l05022"></a>05022    <span class="keywordflow">return</span> 0;
<a name="l05023"></a>05023 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3ff90e6d6cdc9917eb0e33227013acad"></a><!-- doxytag: member="chan_dahdi.c::dahdi_show_channel" ref="a3ff90e6d6cdc9917eb0e33227013acad" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* dahdi_show_channel </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l14609">14609</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8h_source.html#l00141">ast_cli_args::argv</a>, <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01099">dahdi_pvt::busy_quietlength</a>, <a class="el" href="chan__dahdi_8c_source.html#l01094">dahdi_pvt::busy_tonelength</a>, <a class="el" href="chan__dahdi_8c_source.html#l01089">dahdi_pvt::busycount</a>, <a class="el" href="chan__dahdi_8c_source.html#l00703">dahdi_pvt::busydetect</a>, <a class="el" href="chan__dahdi_8c_source.html#l01070">dahdi_pvt::callwaitcas</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="chan__dahdi_8c_source.html#l01001">dahdi_pvt::cid_name</a>, <a class="el" href="chan__dahdi_8c_source.html#l00997">dahdi_pvt::cid_num</a>, <a class="el" href="chan__dahdi_8c_source.html#l00999">dahdi_pvt::cid_ton</a>, <a class="el" href="cli_8h_source.html#l00045">CLI_FAILURE</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="chan__dahdi_8c_source.html#l01023">dahdi_pvt::confno</a>, <a class="el" href="chan__dahdi_8c_source.html#l00967">dahdi_pvt::context</a>, <a class="el" href="chan__dahdi_8c_source.html#l00740">dahdi_pvt::destroy</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="chan__dahdi_8c_source.html#l00745">dahdi_pvt::dialing</a>, <a class="el" href="chan__dahdi_8c_source.html#l00749">dahdi_pvt::dnd</a>, <a class="el" href="chan__dahdi_8c_source.html#l01113">dahdi_pvt::dsp</a>, <a class="el" href="chan__dahdi_8c_source.html#l01147">dahdi_pvt::dtmfrelax</a>, <a class="el" href="chan__dahdi_8c_source.html#l00757">dahdi_pvt::echocanbridged</a>, <a class="el" href="structdahdi__pvt.html#a12f1128b223526997d1601ee6e33325d">dahdi_pvt::echocancel</a>, <a class="el" href="chan__dahdi_8c_source.html#l00759">dahdi_pvt::echocanon</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="chan__dahdi_8c_source.html#l00973">dahdi_pvt::exten</a>, <a class="el" href="chan__dahdi_8c_source.html#l00761">dahdi_pvt::faxhandled</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, <a class="el" href="chan__dahdi_8c_source.html#l01075">dahdi_pvt::head</a>, <a class="el" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>, <a class="el" href="chan__dahdi_8c_source.html#l00797">dahdi_pvt::inalarm</a>, <a class="el" href="chan__dahdi_8c_source.html#l00659">dahdi_pvt::inconference</a>, <a class="el" href="chan__dahdi_8c_source.html#l00621">dahdi_subchannel::inthreeway</a>, <a class="el" href="chan__dahdi_8c_source.html#l01022">dahdi_pvt::law</a>, <a class="el" href="chan__dahdi_8c_source.html#l00620">dahdi_subchannel::linear</a>, <a class="el" href="app__meetme_8c_source.html#l00842">lock</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__dahdi_8c_source.html#l01129">dahdi_pvt::mailbox</a>, <a class="el" href="chan__dahdi_8c_source.html#l00658">dahdi_pvt::master</a>, <a class="el" href="chan__dahdi_8c_source.html#l00628">MAX_SLAVES</a>, <a class="el" href="config_8h_source.html#l00075">ast_variable::name</a>, <a class="el" href="chan__dahdi_8c_source.html#l00682">dahdi_pvt::next</a>, <a class="el" href="config_8h_source.html#l00077">ast_variable::next</a>, <a class="el" href="chan__dahdi_8c_source.html#l00608">dahdi_subchannel::owner</a>, <a class="el" href="chan__dahdi_8c_source.html#l00650">dahdi_pvt::owner</a>, <a class="el" href="chan__dahdi_8c_source.html#l01076">dahdi_pvt::params</a>, <a class="el" href="chan__dahdi_8c_source.html#l01025">dahdi_pvt::propconfno</a>, <a class="el" href="chan__dahdi_8c_source.html#l00830">dahdi_pvt::pulsedial</a>, <a class="el" href="chan__dahdi_8c_source.html#l00671">dahdi_pvt::radio</a>, <a class="el" href="strings_8h_source.html#l00072">S_OR</a>, <a class="el" href="chan__dahdi_8c_source.html#l00666">dahdi_pvt::sig</a>, <a class="el" href="chan__dahdi_8c_source.html#l02476">sig2str</a>, <a class="el" href="chan__dahdi_8c_source.html#l00657">dahdi_pvt::slaves</a>, <a class="el" href="chan__dahdi_8c_source.html#l01042">dahdi_pvt::span</a>, <a class="el" href="chan__dahdi_8c_source.html#l00580">SUB_CALLWAIT</a>, <a class="el" href="chan__dahdi_8c_source.html#l00581">SUB_THREEWAY</a>, <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>, <a class="el" href="chan__dahdi_8c_source.html#l01122">dahdi_pvt::tdd</a>, <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>, <a class="el" href="config_8h_source.html#l00076">ast_variable::value</a>, <a class="el" href="chan__dahdi_8c_source.html#l01040">dahdi_pvt::vars</a>, and <a class="el" href="chan__dahdi_8c_source.html#l01109">dahdi_pvt::waitfordialtone</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l14610"></a>14610 {
<a name="l14611"></a>14611    <span class="keywordtype">int</span> channel;
<a name="l14612"></a>14612    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *tmp = NULL;
<a name="l14613"></a>14613    <span class="keyword">struct </span>dahdi_confinfo ci;
<a name="l14614"></a>14614    <span class="keyword">struct </span>dahdi_params <a class="code" href="chan__usbradio_8c.html#ae320c29b526039fbf085fc7337bb2265">ps</a>;
<a name="l14615"></a>14615    <span class="keywordtype">int</span> x;
<a name="l14616"></a>14616    <a class="code" href="lock_8h.html#a2d9118a2a8939f115eea771bce3a52f2">ast_mutex_t</a> *<a class="code" href="app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>;
<a name="l14617"></a>14617    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *start;
<a name="l14618"></a>14618 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l14619"></a>14619 <span class="preprocessor"></span>   <span class="keywordtype">char</span> *c;
<a name="l14620"></a>14620    <span class="keywordtype">int</span> trunkgroup;
<a name="l14621"></a>14621    <span class="keyword">struct </span>dahdi_pri *pri=NULL;
<a name="l14622"></a>14622 <span class="preprocessor">#endif</span>
<a name="l14623"></a>14623 <span class="preprocessor"></span>   <span class="keywordflow">switch</span> (cmd) {
<a name="l14624"></a>14624    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l14625"></a>14625       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;dahdi show channel&quot;</span>;
<a name="l14626"></a>14626       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l14627"></a>14627          <span class="stringliteral">&quot;Usage: dahdi show channel &lt;chan num&gt;\n&quot;</span>
<a name="l14628"></a>14628          <span class="stringliteral">&quot;  Detailed information about a given channel\n&quot;</span>;
<a name="l14629"></a>14629       <span class="keywordflow">return</span> NULL;
<a name="l14630"></a>14630    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l14631"></a>14631       <span class="keywordflow">return</span> NULL;
<a name="l14632"></a>14632    }
<a name="l14633"></a>14633 
<a name="l14634"></a>14634    lock = &amp;iflock;
<a name="l14635"></a>14635    start = <a class="code" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>;
<a name="l14636"></a>14636 
<a name="l14637"></a>14637    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> != 4)
<a name="l14638"></a>14638       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l14639"></a>14639 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l14640"></a>14640 <span class="preprocessor"></span>   <span class="keywordflow">if</span> ((c = strchr(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3], <span class="charliteral">&apos;:&apos;</span>))) {
<a name="l14641"></a>14641       <span class="keywordflow">if</span> (sscanf(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3], <span class="stringliteral">&quot;%30d:%30d&quot;</span>, &amp;trunkgroup, &amp;channel) != 2)
<a name="l14642"></a>14642          <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l14643"></a>14643       <span class="keywordflow">if</span> ((trunkgroup &lt; 1) || (channel &lt; 1))
<a name="l14644"></a>14644          <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l14645"></a>14645       <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="chan__dahdi_8c.html#a80bfdd8adbffe226265cd729655a7268">NUM_SPANS</a>; x++) {
<a name="l14646"></a>14646          <span class="keywordflow">if</span> (pris[x].trunkgroup == trunkgroup) {
<a name="l14647"></a>14647             pri = pris + x;
<a name="l14648"></a>14648             <span class="keywordflow">break</span>;
<a name="l14649"></a>14649          }
<a name="l14650"></a>14650       }
<a name="l14651"></a>14651       <span class="keywordflow">if</span> (pri) {
<a name="l14652"></a>14652          start = pri-&gt;crvs;
<a name="l14653"></a>14653          lock = &amp;pri-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>;
<a name="l14654"></a>14654       } <span class="keywordflow">else</span> {
<a name="l14655"></a>14655          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;No such trunk group %d\n&quot;</span>, trunkgroup);
<a name="l14656"></a>14656          <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;
<a name="l14657"></a>14657       }
<a name="l14658"></a>14658    } <span class="keywordflow">else</span>
<a name="l14659"></a>14659 <span class="preprocessor">#endif</span>
<a name="l14660"></a>14660 <span class="preprocessor"></span>      channel = atoi(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3]);
<a name="l14661"></a>14661 
<a name="l14662"></a>14662    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(lock);
<a name="l14663"></a>14663    tmp = start;
<a name="l14664"></a>14664    <span class="keywordflow">while</span> (tmp) {
<a name="l14665"></a>14665       <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a> == channel) {
<a name="l14666"></a>14666 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l14667"></a>14667 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (pri)
<a name="l14668"></a>14668             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Trunk/CRV: %d/%d\n&quot;</span>, trunkgroup, tmp-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l14669"></a>14669          <span class="keywordflow">else</span>
<a name="l14670"></a>14670 <span class="preprocessor">#endif</span>
<a name="l14671"></a>14671 <span class="preprocessor"></span>         <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Channel: %d\n&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l14672"></a>14672          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;File Descriptor: %d\n&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>);
<a name="l14673"></a>14673          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Span: %d\n&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#a63fc22149930803b4e3fb4c453177e5e">span</a>);
<a name="l14674"></a>14674          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Extension: %s\n&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#a78d4847658b695383d849efd12399b38" title="Extension to use in the dialplan.">exten</a>);
<a name="l14675"></a>14675          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Dialing: %s\n&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#af17335c0c7a4c1e03e987a33f6eec81b" title="TRUE if in the process of dialing digits or sending something.">dialing</a> ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>);
<a name="l14676"></a>14676          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Context: %s\n&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#ac25ea00ee3f082df06e0cf468cbde240" title="The configured context for incoming calls.">context</a>);
<a name="l14677"></a>14677          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Caller ID: %s\n&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#a29e973bd94bfbaf59d939bd1bc988c32" title="Caller ID number from an incoming call.">cid_num</a>);
<a name="l14678"></a>14678          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Calling TON: %d\n&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#aff456ca48d31a9813584e799064cf88e" title="Caller ID Q.931 TON/NPI field values. Set by PRI. Zero otherwise.">cid_ton</a>);
<a name="l14679"></a>14679          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Caller ID name: %s\n&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#ade5a89f9bee15a492c760ec1765a292d" title="Caller ID name from an incoming call.">cid_name</a>);
<a name="l14680"></a>14680          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Mailbox: %s\n&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(tmp-&gt;<a class="code" href="structdahdi__pvt.html#ac81f44f4f22dee90de5975cf8fa4641b" title="Voice mailbox location.">mailbox</a>, <span class="stringliteral">&quot;none&quot;</span>));
<a name="l14681"></a>14681          <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="structdahdi__pvt.html#a134fe67053d035e763d6cf99916c1bf8" title="Channel variable list with associated values to set when a channel is created.">vars</a>) {
<a name="l14682"></a>14682             <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *v;
<a name="l14683"></a>14683             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Variables:\n&quot;</span>);
<a name="l14684"></a>14684             <span class="keywordflow">for</span> (v = tmp-&gt;<a class="code" href="structdahdi__pvt.html#a134fe67053d035e763d6cf99916c1bf8" title="Channel variable list with associated values to set when a channel is created.">vars</a> ; v ; v = v-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>)
<a name="l14685"></a>14685                <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;       %s = %s\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l14686"></a>14686          }
<a name="l14687"></a>14687          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Destroy: %d\n&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#ab16498ae4f96c29649dd52ac032e811d" title="TRUE if the channel is to be destroyed on hangup. (Used by pseudo channels.).">destroy</a>);
<a name="l14688"></a>14688          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;InAlarm: %d\n&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#adbe10c4b12619d6cb58b1ad14bc437af" title="TRUE if in an alarm condition.">inalarm</a>);
<a name="l14689"></a>14689          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Signalling Type: %s\n&quot;</span>, <a class="code" href="chan__dahdi_8c.html#ac36e4cc782493e37064405666f5e4fdd">sig2str</a>(tmp-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a>));
<a name="l14690"></a>14690          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Radio: %d\n&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#ac53b42243ee40edc74b615fe86806fe3" title="Nonzero if the signaling type is sent over a radio.">radio</a>);
<a name="l14691"></a>14691          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Owner: %s\n&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> ? tmp-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name : <span class="stringliteral">&quot;&lt;None&gt;&quot;</span>);
<a name="l14692"></a>14692          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Real: %s%s%s\n&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> ? tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name : <span class="stringliteral">&quot;&lt;None&gt;&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[SUB_REAL].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a> ? <span class="stringliteral">&quot; (Confed)&quot;</span> : <span class="stringliteral">&quot;&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[SUB_REAL].<a class="code" href="structdahdi__subchannel.html#a2de30c0a559b0df57ba137153a1370ea">linear</a> ? <span class="stringliteral">&quot; (Linear)&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l14693"></a>14693          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Callwait: %s%s%s\n&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> ? tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name : <span class="stringliteral">&quot;&lt;None&gt;&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[SUB_CALLWAIT].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a> ? <span class="stringliteral">&quot; (Confed)&quot;</span> : <span class="stringliteral">&quot;&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[SUB_CALLWAIT].<a class="code" href="structdahdi__subchannel.html#a2de30c0a559b0df57ba137153a1370ea">linear</a> ? <span class="stringliteral">&quot; (Linear)&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l14694"></a>14694          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Threeway: %s%s%s\n&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> ? tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name : <span class="stringliteral">&quot;&lt;None&gt;&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[SUB_THREEWAY].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a> ? <span class="stringliteral">&quot; (Confed)&quot;</span> : <span class="stringliteral">&quot;&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[SUB_THREEWAY].<a class="code" href="structdahdi__subchannel.html#a2de30c0a559b0df57ba137153a1370ea">linear</a> ? <span class="stringliteral">&quot; (Linear)&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l14695"></a>14695          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Confno: %d\n&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#aa9d25d217a303c512db5f8bd7fabd587">confno</a>);
<a name="l14696"></a>14696          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Propagated Conference: %d\n&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#af9fdafa3d77ac5c004c90bf4f9042a07">propconfno</a>);
<a name="l14697"></a>14697          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Real in conference: %d\n&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#afa5f2dbd816e7f6141e6932e94b8eedd">inconference</a>);
<a name="l14698"></a>14698          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;DSP: %s\n&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a> ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>);
<a name="l14699"></a>14699          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Busy Detection: %s\n&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#ab86910b871c8cff810ab15a587a1ed3b" title="TRUE if busy detection is enabled. (Listens for the beep-beep busy pattern.).">busydetect</a> ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>);
<a name="l14700"></a>14700          <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="structdahdi__pvt.html#ab86910b871c8cff810ab15a587a1ed3b" title="TRUE if busy detection is enabled. (Listens for the beep-beep busy pattern.).">busydetect</a>) {
<a name="l14701"></a>14701 <span class="preprocessor">#if defined(BUSYDETECT_TONEONLY)</span>
<a name="l14702"></a>14702 <span class="preprocessor"></span>            <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;    Busy Detector Helper: BUSYDETECT_TONEONLY\n&quot;</span>);
<a name="l14703"></a>14703 <span class="preprocessor">#elif defined(BUSYDETECT_COMPARE_TONE_AND_SILENCE)</span>
<a name="l14704"></a>14704 <span class="preprocessor"></span>            <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;    Busy Detector Helper: BUSYDETECT_COMPARE_TONE_AND_SILENCE\n&quot;</span>);
<a name="l14705"></a>14705 <span class="preprocessor">#endif</span>
<a name="l14706"></a>14706 <span class="preprocessor"></span><span class="preprocessor">#ifdef BUSYDETECT_DEBUG</span>
<a name="l14707"></a>14707 <span class="preprocessor"></span>            <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;    Busy Detector Debug: Enabled\n&quot;</span>);
<a name="l14708"></a>14708 <span class="preprocessor">#endif</span>
<a name="l14709"></a>14709 <span class="preprocessor"></span>            <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;    Busy Count: %d\n&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#a29a1e575aa8b94876e2d3b8da3f6da2b" title="Number of times to see &amp;quot;busy&amp;quot; tone before hanging up.">busycount</a>);
<a name="l14710"></a>14710             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;    Busy Pattern: %d,%d\n&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#a0b9321a0ad6b6a804a8c7f295f5b8b7a" title="Length of &amp;quot;busy&amp;quot; tone on time.">busy_tonelength</a>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#a9224645275ef08732407aea48569aea1" title="Length of &amp;quot;busy&amp;quot; tone off time.">busy_quietlength</a>);
<a name="l14711"></a>14711          }
<a name="l14712"></a>14712          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;TDD: %s\n&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#a2042629f86bb4c3dbb7185ed0701e4ca">tdd</a> ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>);
<a name="l14713"></a>14713          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Relax DTMF: %s\n&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#a6829c6ed48c184cbd85055163786a7eb">dtmfrelax</a> ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>);
<a name="l14714"></a>14714          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Dialing/CallwaitCAS: %d/%d\n&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#af17335c0c7a4c1e03e987a33f6eec81b" title="TRUE if in the process of dialing digits or sending something.">dialing</a>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#a7a4e9b0410dd0636d8f10df9ff51e0a3" title="BOOLEAN. XXX Meaning what??">callwaitcas</a>);
<a name="l14715"></a>14715          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Default law: %s\n&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#a17dd7b17c0e736754e01e575ca8d8cb8" title="Active PCM encoding format: DAHDI_LAW_ALAW or DAHDI_LAW_MULAW.">law</a> == DAHDI_LAW_MULAW ? <span class="stringliteral">&quot;ulaw&quot;</span> : tmp-&gt;<a class="code" href="structdahdi__pvt.html#a17dd7b17c0e736754e01e575ca8d8cb8" title="Active PCM encoding format: DAHDI_LAW_ALAW or DAHDI_LAW_MULAW.">law</a> == DAHDI_LAW_ALAW ? <span class="stringliteral">&quot;alaw&quot;</span> : <span class="stringliteral">&quot;unknown&quot;</span>);
<a name="l14716"></a>14716          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Fax Handled: %s\n&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#a93c16dce1468c2decb08eae44d525fbd" title="TRUE if a fax tone has already been handled.">faxhandled</a> ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>);
<a name="l14717"></a>14717          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Pulse phone: %s\n&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#ae56835e2739c5d155391c01485455497" title="TRUE if a pulsed digit was detected. (Pulse dial phone detected).">pulsedial</a> ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>);
<a name="l14718"></a>14718          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;DND: %s\n&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#a1a8eeacca010367ea43120ef6ac08aa1" title="TRUE if Do-Not-Disturb is enabled.">dnd</a> ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>);
<a name="l14719"></a>14719          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Echo Cancellation:\n&quot;</span>);
<a name="l14720"></a>14720 
<a name="l14721"></a>14721          <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="structdahdi__pvt.html#a12f1128b223526997d1601ee6e33325d" title="Echo cancel parameters.">echocancel</a>.<a class="code" href="structdahdi__pvt.html#ad4baed46a5922e2eecd2876f455dc726">head</a>.tap_length) {
<a name="l14722"></a>14722             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;\t%d taps\n&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#a12f1128b223526997d1601ee6e33325d" title="Echo cancel parameters.">echocancel</a>.<a class="code" href="structdahdi__pvt.html#ad4baed46a5922e2eecd2876f455dc726">head</a>.tap_length);
<a name="l14723"></a>14723             <span class="keywordflow">for</span> (x = 0; x &lt; tmp-&gt;<a class="code" href="structdahdi__pvt.html#a12f1128b223526997d1601ee6e33325d" title="Echo cancel parameters.">echocancel</a>.<a class="code" href="structdahdi__pvt.html#ad4baed46a5922e2eecd2876f455dc726">head</a>.param_count; x++) {
<a name="l14724"></a>14724                <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;\t\t%s: %ud\n&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#a12f1128b223526997d1601ee6e33325d" title="Echo cancel parameters.">echocancel</a>.<a class="code" href="structdahdi__pvt.html#a8e87da14ae6e04958083ea33979d78dc">params</a>[x].name, tmp-&gt;<a class="code" href="structdahdi__pvt.html#a12f1128b223526997d1601ee6e33325d" title="Echo cancel parameters.">echocancel</a>.<a class="code" href="structdahdi__pvt.html#a8e87da14ae6e04958083ea33979d78dc">params</a>[x].value);
<a name="l14725"></a>14725             }
<a name="l14726"></a>14726             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;\t%scurrently %s\n&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#ad4ee8bc9c653a9a2ce08e66f62d8814d" title="TRUE if echo cancellation enabled when bridged.">echocanbridged</a> ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;(unless TDM bridged) &quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#a02f7d8025e31d288688f4b53215369f4" title="TRUE if echo cancellation is turned on.">echocanon</a> ? <span class="stringliteral">&quot;ON&quot;</span> : <span class="stringliteral">&quot;OFF&quot;</span>);
<a name="l14727"></a>14727          } <span class="keywordflow">else</span> {
<a name="l14728"></a>14728             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;\tnone\n&quot;</span>);
<a name="l14729"></a>14729          }
<a name="l14730"></a>14730          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Wait for dialtone: %dms\n&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#a508c2407a52638696697fdeb08f0b2e5" title="Number of milliseconds to wait for dialtone.">waitfordialtone</a>);
<a name="l14731"></a>14731          <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="structdahdi__pvt.html#a3e30e79b4679785034d55aff6a17e41b">master</a>)
<a name="l14732"></a>14732             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Master Channel: %d\n&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#a3e30e79b4679785034d55aff6a17e41b">master</a>-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l14733"></a>14733          <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="chan__dahdi_8c.html#a2a3c5190bdbe2a4780a460383970aa92">MAX_SLAVES</a>; x++) {
<a name="l14734"></a>14734             <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="structdahdi__pvt.html#aa607a8a226852c168c96a4d0f3001c88">slaves</a>[x])
<a name="l14735"></a>14735                <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Slave Channel: %d\n&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#aa607a8a226852c168c96a4d0f3001c88">slaves</a>[x]-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l14736"></a>14736          }
<a name="l14737"></a>14737 <span class="preprocessor">#ifdef HAVE_OPENR2</span>
<a name="l14738"></a>14738 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (tmp-&gt;mfcr2) {
<a name="l14739"></a>14739             <span class="keywordtype">char</span> calldir[OR2_MAX_PATH];
<a name="l14740"></a>14740             openr2_context_t *r2context = openr2_chan_get_context(tmp-&gt;r2chan);
<a name="l14741"></a>14741             openr2_variant_t r2variant = openr2_context_get_variant(r2context);
<a name="l14742"></a>14742             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;MFC/R2 MF State: %s\n&quot;</span>, openr2_chan_get_mf_state_string(tmp-&gt;r2chan));
<a name="l14743"></a>14743             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;MFC/R2 MF Group: %s\n&quot;</span>, openr2_chan_get_mf_group_string(tmp-&gt;r2chan));
<a name="l14744"></a>14744             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;MFC/R2 State: %s\n&quot;</span>, openr2_chan_get_r2_state_string(tmp-&gt;r2chan));
<a name="l14745"></a>14745             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;MFC/R2 Call State: %s\n&quot;</span>, openr2_chan_get_call_state_string(tmp-&gt;r2chan));
<a name="l14746"></a>14746             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;MFC/R2 Call Files Enabled: %s\n&quot;</span>, openr2_chan_get_call_files_enabled(tmp-&gt;r2chan) ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>);
<a name="l14747"></a>14747             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;MFC/R2 Variant: %s\n&quot;</span>, openr2_proto_get_variant_string(r2variant));
<a name="l14748"></a>14748             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;MFC/R2 Max ANI: %d\n&quot;</span>, openr2_context_get_max_ani(r2context));
<a name="l14749"></a>14749             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;MFC/R2 Max DNIS: %d\n&quot;</span>, openr2_context_get_max_dnis(r2context));
<a name="l14750"></a>14750             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;MFC/R2 Get ANI First: %s\n&quot;</span>, openr2_context_get_ani_first(r2context) ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>);
<a name="l14751"></a>14751 <span class="preprocessor">#if defined(OR2_LIB_INTERFACE) &amp;&amp; OR2_LIB_INTERFACE &gt; 1</span>
<a name="l14752"></a>14752 <span class="preprocessor"></span>            <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;MFC/R2 Skip Category Request: %s\n&quot;</span>, openr2_context_get_skip_category_request(r2context) ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>);
<a name="l14753"></a>14753 <span class="preprocessor">#endif</span>
<a name="l14754"></a>14754 <span class="preprocessor"></span>            <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;MFC/R2 Immediate Accept: %s\n&quot;</span>, openr2_context_get_immediate_accept(r2context) ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>);
<a name="l14755"></a>14755             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;MFC/R2 Accept on Offer: %s\n&quot;</span>, tmp-&gt;mfcr2_accept_on_offer ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>);
<a name="l14756"></a>14756             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;MFC/R2 Charge Calls: %s\n&quot;</span>, tmp-&gt;mfcr2_charge_calls ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>);
<a name="l14757"></a>14757             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;MFC/R2 Allow Collect Calls: %s\n&quot;</span>, tmp-&gt;mfcr2_allow_collect_calls ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>);
<a name="l14758"></a>14758             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;MFC/R2 Forced Release: %s\n&quot;</span>, tmp-&gt;mfcr2_forced_release ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>);
<a name="l14759"></a>14759             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;MFC/R2 MF Back Timeout: %dms\n&quot;</span>, openr2_context_get_mf_back_timeout(r2context));
<a name="l14760"></a>14760             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;MFC/R2 R2 Metering Pulse Timeout: %dms\n&quot;</span>, openr2_context_get_metering_pulse_timeout(r2context));
<a name="l14761"></a>14761             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;MFC/R2 Rx CAS: %s\n&quot;</span>, openr2_chan_get_rx_cas_string(tmp-&gt;r2chan));
<a name="l14762"></a>14762             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;MFC/R2 Tx CAS: %s\n&quot;</span>, openr2_chan_get_tx_cas_string(tmp-&gt;r2chan));
<a name="l14763"></a>14763             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;MFC/R2 MF Tx Signal: %d\n&quot;</span>, openr2_chan_get_tx_mf_signal(tmp-&gt;r2chan));
<a name="l14764"></a>14764             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;MFC/R2 MF Rx Signal: %d\n&quot;</span>, openr2_chan_get_rx_mf_signal(tmp-&gt;r2chan));
<a name="l14765"></a>14765             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;MFC/R2 Call Files Directory: %s\n&quot;</span>, openr2_context_get_log_directory(r2context, calldir, <span class="keyword">sizeof</span>(calldir)));
<a name="l14766"></a>14766          }
<a name="l14767"></a>14767 <span class="preprocessor">#endif</span>
<a name="l14768"></a>14768 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_SS7</span>
<a name="l14769"></a>14769 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (tmp-&gt;ss7) {
<a name="l14770"></a>14770             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;CIC: %d\n&quot;</span>, tmp-&gt;cic);
<a name="l14771"></a>14771          }
<a name="l14772"></a>14772 <span class="preprocessor">#endif</span>
<a name="l14773"></a>14773 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l14774"></a>14774 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (tmp-&gt;pri) {
<a name="l14775"></a>14775             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;PRI Flags: &quot;</span>);
<a name="l14776"></a>14776             <span class="keywordflow">if</span> (tmp-&gt;resetting)
<a name="l14777"></a>14777                <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Resetting &quot;</span>);
<a name="l14778"></a>14778             <span class="keywordflow">if</span> (tmp-&gt;call)
<a name="l14779"></a>14779                <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Call &quot;</span>);
<a name="l14780"></a>14780             <span class="keywordflow">if</span> (tmp-&gt;bearer)
<a name="l14781"></a>14781                <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Bearer &quot;</span>);
<a name="l14782"></a>14782             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l14783"></a>14783             <span class="keywordflow">if</span> (tmp-&gt;logicalspan)
<a name="l14784"></a>14784                <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;PRI Logical Span: %d\n&quot;</span>, tmp-&gt;logicalspan);
<a name="l14785"></a>14785             <span class="keywordflow">else</span>
<a name="l14786"></a>14786                <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;PRI Logical Span: Implicit\n&quot;</span>);
<a name="l14787"></a>14787          }
<a name="l14788"></a>14788 <span class="preprocessor">#endif</span>
<a name="l14789"></a>14789 <span class="preprocessor"></span>         memset(&amp;ci, 0, <span class="keyword">sizeof</span>(ci));
<a name="l14790"></a>14790          <a class="code" href="chan__usbradio_8c.html#ae320c29b526039fbf085fc7337bb2265">ps</a>.channo = tmp-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>;
<a name="l14791"></a>14791          <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a> &gt; -1) {
<a name="l14792"></a>14792             memset(&amp;ci, 0, <span class="keyword">sizeof</span>(ci));
<a name="l14793"></a>14793             <span class="keywordflow">if</span> (!ioctl(tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_GETCONF, &amp;ci)) {
<a name="l14794"></a>14794                <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Actual Confinfo: Num/%d, Mode/0x%04x\n&quot;</span>, ci.confno, ci.confmode);
<a name="l14795"></a>14795             }
<a name="l14796"></a>14796             <span class="keywordflow">if</span> (!ioctl(tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_GETCONFMUTE, &amp;x)) {
<a name="l14797"></a>14797                <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Actual Confmute: %s\n&quot;</span>, x ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>);
<a name="l14798"></a>14798             }
<a name="l14799"></a>14799             memset(&amp;<a class="code" href="chan__usbradio_8c.html#ae320c29b526039fbf085fc7337bb2265">ps</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="chan__usbradio_8c.html#ae320c29b526039fbf085fc7337bb2265">ps</a>));
<a name="l14800"></a>14800             <span class="keywordflow">if</span> (ioctl(tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_GET_PARAMS, &amp;<a class="code" href="chan__usbradio_8c.html#ae320c29b526039fbf085fc7337bb2265">ps</a>) &lt; 0) {
<a name="l14801"></a>14801                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to get parameters on channel %d: %s\n&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, strerror(errno));
<a name="l14802"></a>14802             } <span class="keywordflow">else</span> {
<a name="l14803"></a>14803                <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Hookstate (FXS only): %s\n&quot;</span>, <a class="code" href="chan__usbradio_8c.html#ae320c29b526039fbf085fc7337bb2265">ps</a>.rxisoffhook ? <span class="stringliteral">&quot;Offhook&quot;</span> : <span class="stringliteral">&quot;Onhook&quot;</span>);
<a name="l14804"></a>14804             }
<a name="l14805"></a>14805          }
<a name="l14806"></a>14806          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(lock);
<a name="l14807"></a>14807          <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l14808"></a>14808       }
<a name="l14809"></a>14809       tmp = tmp-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>;
<a name="l14810"></a>14810    }
<a name="l14811"></a>14811 
<a name="l14812"></a>14812    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Unable to find given channel %d\n&quot;</span>, channel);
<a name="l14813"></a>14813    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(lock);
<a name="l14814"></a>14814    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;
<a name="l14815"></a>14815 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="adc6baa1451369b3fc1515e91a55c31b0"></a><!-- doxytag: member="chan_dahdi.c::dahdi_show_channels" ref="adc6baa1451369b3fc1515e91a55c31b0" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* dahdi_show_channels </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l14485">14485</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8h_source.html#l00141">ast_cli_args::argv</a>, <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="cli_8h_source.html#l00045">CLI_FAILURE</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="chan__dahdi_8c_source.html#l00967">dahdi_pvt::context</a>, <a class="el" href="chan__dahdi_8c_source.html#l00973">dahdi_pvt::exten</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, <a class="el" href="chan__dahdi_8c.html#ac8dc47e3b39c930caed4bfd05b4ba805">FORMAT</a>, <a class="el" href="chan__dahdi_8c.html#acfd58ce0ec836919236d7a1908494970">FORMAT2</a>, <a class="el" href="chan__dahdi_8c_source.html#l01020">dahdi_pvt::group</a>, <a class="el" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>, <a class="el" href="chan__dahdi_8c_source.html#l00978">dahdi_pvt::language</a>, <a class="el" href="chan__dahdi_8c_source.html#l00912">dahdi_pvt::locallyblocked</a>, <a class="el" href="app__meetme_8c_source.html#l00842">lock</a>, <a class="el" href="chan__dahdi_8c_source.html#l00983">dahdi_pvt::mohinterpret</a>, <a class="el" href="chan__dahdi_8c_source.html#l00682">dahdi_pvt::next</a>, <a class="el" href="chan__dahdi_8c_source.html#l00917">dahdi_pvt::remotelyblocked</a>, and <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l14486"></a>14486 {
<a name="l14487"></a>14487 <span class="preprocessor">#define FORMAT &quot;%7s %-10.10s %-15.15s %-10.10s %-20.20s %-10.10s %-10.10s\n&quot;</span>
<a name="l14488"></a>14488 <span class="preprocessor"></span><span class="preprocessor">#define FORMAT2 &quot;%7s %-10.10s %-15.15s %-10.10s %-20.20s %-10.10s %-10.10s\n&quot;</span>
<a name="l14489"></a>14489 <span class="preprocessor"></span>   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> targetnum = 0;
<a name="l14490"></a>14490    <span class="keywordtype">int</span> filtertype = 0;
<a name="l14491"></a>14491    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *tmp = NULL;
<a name="l14492"></a>14492    <span class="keywordtype">char</span> tmps[20] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l14493"></a>14493    <span class="keywordtype">char</span> statestr[20] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l14494"></a>14494    <span class="keywordtype">char</span> blockstr[20] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l14495"></a>14495    <a class="code" href="lock_8h.html#a2d9118a2a8939f115eea771bce3a52f2">ast_mutex_t</a> *<a class="code" href="app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>;
<a name="l14496"></a>14496    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *start;
<a name="l14497"></a>14497 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l14498"></a>14498 <span class="preprocessor"></span>   <span class="keywordtype">int</span> trunkgroup;
<a name="l14499"></a>14499    <span class="keyword">struct </span>dahdi_pri *pri = NULL;
<a name="l14500"></a>14500    <span class="keywordtype">int</span> x;
<a name="l14501"></a>14501 <span class="preprocessor">#endif</span>
<a name="l14502"></a>14502 <span class="preprocessor"></span>   <span class="keywordflow">switch</span> (cmd) {
<a name="l14503"></a>14503    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l14504"></a>14504       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;dahdi show channels [trunkgroup|group|context]&quot;</span>;
<a name="l14505"></a>14505       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l14506"></a>14506          <span class="stringliteral">&quot;Usage: dahdi show channels [ trunkgroup &lt;trunkgroup&gt; | group &lt;group&gt; | context &lt;context&gt; ]\n&quot;</span>
<a name="l14507"></a>14507          <span class="stringliteral">&quot;  Shows a list of available channels with optional filtering\n&quot;</span>
<a name="l14508"></a>14508          <span class="stringliteral">&quot;  &lt;group&gt; must be a number between 0 and 63\n&quot;</span>;
<a name="l14509"></a>14509       <span class="keywordflow">return</span> NULL;
<a name="l14510"></a>14510    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l14511"></a>14511       <span class="keywordflow">return</span> NULL;
<a name="l14512"></a>14512    }
<a name="l14513"></a>14513 
<a name="l14514"></a>14514    lock = &amp;iflock;
<a name="l14515"></a>14515    start = <a class="code" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>;
<a name="l14516"></a>14516 
<a name="l14517"></a>14517    <span class="comment">/* syntax: dahdi show channels [ group &lt;group&gt; | context &lt;context&gt; | trunkgroup &lt;trunkgroup&gt; ] */</span>
<a name="l14518"></a>14518 
<a name="l14519"></a>14519    <span class="keywordflow">if</span> (!((a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> == 3) || (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> == 5)))
<a name="l14520"></a>14520       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l14521"></a>14521 
<a name="l14522"></a>14522    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> == 5) {
<a name="l14523"></a>14523 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l14524"></a>14524 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (!strcasecmp(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3], <span class="stringliteral">&quot;trunkgroup&quot;</span>)) {
<a name="l14525"></a>14525          <span class="comment">/* this option requires no special handling, so leave filtertype to zero */</span>
<a name="l14526"></a>14526          <span class="keywordflow">if</span> ((trunkgroup = atoi(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[4])) &lt; 1)
<a name="l14527"></a>14527             <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l14528"></a>14528          <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="chan__dahdi_8c.html#a80bfdd8adbffe226265cd729655a7268">NUM_SPANS</a>; x++) {
<a name="l14529"></a>14529             <span class="keywordflow">if</span> (pris[x].trunkgroup == trunkgroup) {
<a name="l14530"></a>14530                pri = pris + x;
<a name="l14531"></a>14531                <span class="keywordflow">break</span>;
<a name="l14532"></a>14532             }
<a name="l14533"></a>14533          }
<a name="l14534"></a>14534          <span class="keywordflow">if</span> (pri) {
<a name="l14535"></a>14535             start = pri-&gt;crvs;
<a name="l14536"></a>14536             lock = &amp;pri-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>;
<a name="l14537"></a>14537          } <span class="keywordflow">else</span> {
<a name="l14538"></a>14538             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;No such trunk group %d\n&quot;</span>, trunkgroup);
<a name="l14539"></a>14539             <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;
<a name="l14540"></a>14540          }
<a name="l14541"></a>14541       } <span class="keywordflow">else</span>
<a name="l14542"></a>14542 <span class="preprocessor">#endif</span>
<a name="l14543"></a>14543 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (!strcasecmp(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3], <span class="stringliteral">&quot;group&quot;</span>)) {
<a name="l14544"></a>14544          targetnum = atoi(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[4]);
<a name="l14545"></a>14545          <span class="keywordflow">if</span> ((targetnum &lt; 0) || (targetnum &gt; 63))
<a name="l14546"></a>14546             <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l14547"></a>14547          targetnum = 1 &lt;&lt; targetnum;
<a name="l14548"></a>14548          filtertype = 1;
<a name="l14549"></a>14549       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3], <span class="stringliteral">&quot;context&quot;</span>)) {
<a name="l14550"></a>14550          filtertype = 2;
<a name="l14551"></a>14551       }
<a name="l14552"></a>14552    }
<a name="l14553"></a>14553 
<a name="l14554"></a>14554    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(lock);
<a name="l14555"></a>14555 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l14556"></a>14556 <span class="preprocessor"></span>   <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, FORMAT2, pri ? <span class="stringliteral">&quot;CRV&quot;</span> : <span class="stringliteral">&quot;Chan&quot;</span>, <span class="stringliteral">&quot;Extension&quot;</span>, <span class="stringliteral">&quot;Context&quot;</span>, <span class="stringliteral">&quot;Language&quot;</span>, <span class="stringliteral">&quot;MOH Interpret&quot;</span>, <span class="stringliteral">&quot;Blocked&quot;</span>, <span class="stringliteral">&quot;State&quot;</span>);
<a name="l14557"></a>14557 <span class="preprocessor">#else</span>
<a name="l14558"></a>14558 <span class="preprocessor"></span>   <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, FORMAT2, <span class="stringliteral">&quot;Chan&quot;</span>, <span class="stringliteral">&quot;Extension&quot;</span>, <span class="stringliteral">&quot;Context&quot;</span>, <span class="stringliteral">&quot;Language&quot;</span>, <span class="stringliteral">&quot;MOH Interpret&quot;</span>, <span class="stringliteral">&quot;Blocked&quot;</span>, <span class="stringliteral">&quot;State&quot;</span>);
<a name="l14559"></a>14559 <span class="preprocessor">#endif</span>
<a name="l14560"></a>14560 <span class="preprocessor"></span>
<a name="l14561"></a>14561    tmp = start;
<a name="l14562"></a>14562    <span class="keywordflow">while</span> (tmp) {
<a name="l14563"></a>14563       <span class="keywordflow">if</span> (filtertype) {
<a name="l14564"></a>14564          <span class="keywordflow">switch</span>(filtertype) {
<a name="l14565"></a>14565          <span class="keywordflow">case</span> 1: <span class="comment">/* dahdi show channels group &lt;group&gt; */</span>
<a name="l14566"></a>14566             <span class="keywordflow">if</span> (!(tmp-&gt;<a class="code" href="structdahdi__pvt.html#a2f66424184fe1873f7b46b19de589b57" title="Bitmapped groups this belongs to.">group</a> &amp; targetnum)) {
<a name="l14567"></a>14567                tmp = tmp-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>;
<a name="l14568"></a>14568                <span class="keywordflow">continue</span>;
<a name="l14569"></a>14569             }
<a name="l14570"></a>14570             <span class="keywordflow">break</span>;
<a name="l14571"></a>14571          <span class="keywordflow">case</span> 2: <span class="comment">/* dahdi show channels context &lt;context&gt; */</span>
<a name="l14572"></a>14572             <span class="keywordflow">if</span> (strcasecmp(tmp-&gt;<a class="code" href="structdahdi__pvt.html#ac25ea00ee3f082df06e0cf468cbde240" title="The configured context for incoming calls.">context</a>, a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[4])) {
<a name="l14573"></a>14573                tmp = tmp-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>;
<a name="l14574"></a>14574                <span class="keywordflow">continue</span>;
<a name="l14575"></a>14575             }
<a name="l14576"></a>14576             <span class="keywordflow">break</span>;
<a name="l14577"></a>14577          <span class="keywordflow">default</span>:
<a name="l14578"></a>14578             ;
<a name="l14579"></a>14579          }
<a name="l14580"></a>14580       }
<a name="l14581"></a>14581       <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a> &gt; 0) {
<a name="l14582"></a>14582          snprintf(tmps, <span class="keyword">sizeof</span>(tmps), <span class="stringliteral">&quot;%d&quot;</span>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l14583"></a>14583       } <span class="keywordflow">else</span>
<a name="l14584"></a>14584          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmps, <span class="stringliteral">&quot;pseudo&quot;</span>, <span class="keyword">sizeof</span>(tmps));
<a name="l14585"></a>14585 
<a name="l14586"></a>14586       <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="structdahdi__pvt.html#a513c772067fc245b524b1e46a0987ec0" title="TRUE if the channel is locally blocked.">locallyblocked</a>)
<a name="l14587"></a>14587          blockstr[0] = <span class="charliteral">&apos;L&apos;</span>;
<a name="l14588"></a>14588       <span class="keywordflow">else</span>
<a name="l14589"></a>14589          blockstr[0] = <span class="charliteral">&apos; &apos;</span>;
<a name="l14590"></a>14590 
<a name="l14591"></a>14591       <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="structdahdi__pvt.html#a857733a6d05c0eda6d4b5122e1e4d3bc" title="TRUE if the channel is remotely blocked.">remotelyblocked</a>)
<a name="l14592"></a>14592          blockstr[1] = <span class="charliteral">&apos;R&apos;</span>;
<a name="l14593"></a>14593       <span class="keywordflow">else</span>
<a name="l14594"></a>14594          blockstr[1] = <span class="charliteral">&apos; &apos;</span>;
<a name="l14595"></a>14595 
<a name="l14596"></a>14596       blockstr[2] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l14597"></a>14597 
<a name="l14598"></a>14598       snprintf(statestr, <span class="keyword">sizeof</span>(statestr), <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;In Service&quot;</span>);
<a name="l14599"></a>14599 
<a name="l14600"></a>14600       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, FORMAT, tmps, tmp-&gt;<a class="code" href="structdahdi__pvt.html#a78d4847658b695383d849efd12399b38" title="Extension to use in the dialplan.">exten</a>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#ac25ea00ee3f082df06e0cf468cbde240" title="The configured context for incoming calls.">context</a>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#adf416dc058363e2fd5750c77e2d78bee" title="Language configured for calls.">language</a>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#af689da2b77d1265192a78a5b0994a1d5" title="The configured music-on-hold class to use for calls.">mohinterpret</a>, blockstr, statestr);
<a name="l14601"></a>14601       tmp = tmp-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>;
<a name="l14602"></a>14602    }
<a name="l14603"></a>14603    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(lock);
<a name="l14604"></a>14604    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l14605"></a>14605 <span class="preprocessor">#undef FORMAT</span>
<a name="l14606"></a>14606 <span class="preprocessor"></span><span class="preprocessor">#undef FORMAT2</span>
<a name="l14607"></a>14607 <span class="preprocessor"></span>}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2d75852a32e1c2a52935543a16fb056b"></a><!-- doxytag: member="chan_dahdi.c::dahdi_show_status" ref="a2d75852a32e1c2a52935543a16fb056b" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* dahdi_show_status </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l14854">14854</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="cli_8h_source.html#l00045">CLI_FAILURE</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, <a class="el" href="chan__dahdi_8c.html#ac8dc47e3b39c930caed4bfd05b4ba805">FORMAT</a>, <a class="el" href="chan__dahdi_8c.html#acfd58ce0ec836919236d7a1908494970">FORMAT2</a>, and <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l14855"></a>14855 {
<a name="l14856"></a>14856 <span class="preprocessor">   #define FORMAT &quot;%-40.40s %-7.7s %-6d %-6d %-6d %-3.3s %-4.4s %-8.8s %s\n&quot;</span>
<a name="l14857"></a>14857 <span class="preprocessor"></span><span class="preprocessor">   #define FORMAT2 &quot;%-40.40s %-7.7s %-6.6s %-6.6s %-6.6s %-3.3s %-4.4s %-8.8s %s\n&quot;</span>
<a name="l14858"></a>14858 <span class="preprocessor"></span>   <span class="keywordtype">int</span> span;
<a name="l14859"></a>14859    <span class="keywordtype">int</span> res;
<a name="l14860"></a>14860    <span class="keywordtype">char</span> alarmstr[50];
<a name="l14861"></a>14861 
<a name="l14862"></a>14862    <span class="keywordtype">int</span> ctl;
<a name="l14863"></a>14863    <span class="keyword">struct </span>dahdi_spaninfo <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>;
<a name="l14864"></a>14864 
<a name="l14865"></a>14865    <span class="keywordflow">switch</span> (cmd) {
<a name="l14866"></a>14866    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l14867"></a>14867       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;dahdi show status&quot;</span>;
<a name="l14868"></a>14868       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l14869"></a>14869          <span class="stringliteral">&quot;Usage: dahdi show status\n&quot;</span>
<a name="l14870"></a>14870          <span class="stringliteral">&quot;       Shows a list of DAHDI cards with status\n&quot;</span>;
<a name="l14871"></a>14871       <span class="keywordflow">return</span> NULL;
<a name="l14872"></a>14872    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l14873"></a>14873       <span class="keywordflow">return</span> NULL;
<a name="l14874"></a>14874    }
<a name="l14875"></a>14875    ctl = open(<span class="stringliteral">&quot;/dev/dahdi/ctl&quot;</span>, O_RDWR);
<a name="l14876"></a>14876    <span class="keywordflow">if</span> (ctl &lt; 0) {
<a name="l14877"></a>14877       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;No DAHDI found. Unable to open /dev/dahdi/ctl: %s\n&quot;</span>, strerror(errno));
<a name="l14878"></a>14878       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;
<a name="l14879"></a>14879    }
<a name="l14880"></a>14880    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, FORMAT2, <span class="stringliteral">&quot;Description&quot;</span>, <span class="stringliteral">&quot;Alarms&quot;</span>, <span class="stringliteral">&quot;IRQ&quot;</span>, <span class="stringliteral">&quot;bpviol&quot;</span>, <span class="stringliteral">&quot;CRC4&quot;</span>, <span class="stringliteral">&quot;Framing&quot;</span>, <span class="stringliteral">&quot;Coding&quot;</span>, <span class="stringliteral">&quot;Options&quot;</span>, <span class="stringliteral">&quot;LBO&quot;</span>);
<a name="l14881"></a>14881 
<a name="l14882"></a>14882    <span class="keywordflow">for</span> (span = 1; span &lt; DAHDI_MAX_SPANS; ++span) {
<a name="l14883"></a>14883       <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>.spanno = span;
<a name="l14884"></a>14884       res = ioctl(ctl, DAHDI_SPANSTAT, &amp;<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>);
<a name="l14885"></a>14885       <span class="keywordflow">if</span> (res) {
<a name="l14886"></a>14886          <span class="keywordflow">continue</span>;
<a name="l14887"></a>14887       }
<a name="l14888"></a>14888       alarmstr[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l14889"></a>14889       <span class="keywordflow">if</span> (<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>.alarms &gt; 0) {
<a name="l14890"></a>14890          <span class="keywordflow">if</span> (<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>.alarms &amp; DAHDI_ALARM_BLUE)
<a name="l14891"></a>14891             strcat(alarmstr, <span class="stringliteral">&quot;BLU/&quot;</span>);
<a name="l14892"></a>14892          <span class="keywordflow">if</span> (<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>.alarms &amp; DAHDI_ALARM_YELLOW)
<a name="l14893"></a>14893             strcat(alarmstr, <span class="stringliteral">&quot;YEL/&quot;</span>);
<a name="l14894"></a>14894          <span class="keywordflow">if</span> (<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>.alarms &amp; DAHDI_ALARM_RED)
<a name="l14895"></a>14895             strcat(alarmstr, <span class="stringliteral">&quot;RED/&quot;</span>);
<a name="l14896"></a>14896          <span class="keywordflow">if</span> (<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>.alarms &amp; DAHDI_ALARM_LOOPBACK)
<a name="l14897"></a>14897             strcat(alarmstr, <span class="stringliteral">&quot;LB/&quot;</span>);
<a name="l14898"></a>14898          <span class="keywordflow">if</span> (<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>.alarms &amp; DAHDI_ALARM_RECOVER)
<a name="l14899"></a>14899             strcat(alarmstr, <span class="stringliteral">&quot;REC/&quot;</span>);
<a name="l14900"></a>14900          <span class="keywordflow">if</span> (<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>.alarms &amp; DAHDI_ALARM_NOTOPEN)
<a name="l14901"></a>14901             strcat(alarmstr, <span class="stringliteral">&quot;NOP/&quot;</span>);
<a name="l14902"></a>14902          <span class="keywordflow">if</span> (!strlen(alarmstr))
<a name="l14903"></a>14903             strcat(alarmstr, <span class="stringliteral">&quot;UUU/&quot;</span>);
<a name="l14904"></a>14904          <span class="keywordflow">if</span> (strlen(alarmstr)) {
<a name="l14905"></a>14905             <span class="comment">/* Strip trailing / */</span>
<a name="l14906"></a>14906             alarmstr[strlen(alarmstr) - 1] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l14907"></a>14907          }
<a name="l14908"></a>14908       } <span class="keywordflow">else</span> {
<a name="l14909"></a>14909          <span class="keywordflow">if</span> (<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>.numchans)
<a name="l14910"></a>14910             strcpy(alarmstr, <span class="stringliteral">&quot;OK&quot;</span>);
<a name="l14911"></a>14911          <span class="keywordflow">else</span>
<a name="l14912"></a>14912             strcpy(alarmstr, <span class="stringliteral">&quot;UNCONFIGURED&quot;</span>);
<a name="l14913"></a>14913       }
<a name="l14914"></a>14914 
<a name="l14915"></a>14915       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, FORMAT, <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>.desc, alarmstr, <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>.irqmisses, <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>.bpvcount, <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>.crc4count,
<a name="l14916"></a>14916          <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>.lineconfig &amp; DAHDI_CONFIG_D4 ? <span class="stringliteral">&quot;D4&quot;</span> :
<a name="l14917"></a>14917          <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>.lineconfig &amp; DAHDI_CONFIG_ESF ? <span class="stringliteral">&quot;ESF&quot;</span> :
<a name="l14918"></a>14918          <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>.lineconfig &amp; DAHDI_CONFIG_CCS ? <span class="stringliteral">&quot;CCS&quot;</span> :
<a name="l14919"></a>14919          <span class="stringliteral">&quot;CAS&quot;</span>,
<a name="l14920"></a>14920          <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>.lineconfig &amp; DAHDI_CONFIG_B8ZS ? <span class="stringliteral">&quot;B8ZS&quot;</span> :
<a name="l14921"></a>14921          <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>.lineconfig &amp; DAHDI_CONFIG_HDB3 ? <span class="stringliteral">&quot;HDB3&quot;</span> :
<a name="l14922"></a>14922          <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>.lineconfig &amp; DAHDI_CONFIG_AMI ? <span class="stringliteral">&quot;AMI&quot;</span> :
<a name="l14923"></a>14923          <span class="stringliteral">&quot;Unk&quot;</span>,
<a name="l14924"></a>14924          <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>.lineconfig &amp; DAHDI_CONFIG_CRC4 ?
<a name="l14925"></a>14925          <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>.lineconfig &amp; DAHDI_CONFIG_NOTOPEN ? <span class="stringliteral">&quot;CRC4/YEL&quot;</span> : <span class="stringliteral">&quot;CRC4&quot;</span> : <span class="stringliteral">&quot;YEL&quot;</span>,
<a name="l14926"></a>14926          <a class="code" href="chan__dahdi_8c.html#a9dbc679cbf3418ca12b70a64acfbf03c">lbostr</a>[<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>.lbo]
<a name="l14927"></a>14927          );
<a name="l14928"></a>14928    }
<a name="l14929"></a>14929    close(ctl);
<a name="l14930"></a>14930 
<a name="l14931"></a>14931    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l14932"></a>14932 <span class="preprocessor">#undef FORMAT</span>
<a name="l14933"></a>14933 <span class="preprocessor"></span><span class="preprocessor">#undef FORMAT2</span>
<a name="l14934"></a>14934 <span class="preprocessor"></span>}
</pre></div></p>

</div>
</div>
<a class="anchor" id="abf63cde4493264f6ed7bd061985b234d"></a><!-- doxytag: member="chan_dahdi.c::dahdi_show_version" ref="abf63cde4493264f6ed7bd061985b234d" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* dahdi_show_version </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l14936">14936</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, and <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l14937"></a>14937 {
<a name="l14938"></a>14938    <span class="keywordtype">int</span> pseudo_fd = -1;
<a name="l14939"></a>14939    <span class="keyword">struct </span>dahdi_versioninfo vi;
<a name="l14940"></a>14940 
<a name="l14941"></a>14941    <span class="keywordflow">switch</span> (cmd) {
<a name="l14942"></a>14942    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l14943"></a>14943       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;dahdi show version&quot;</span>;
<a name="l14944"></a>14944       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l14945"></a>14945          <span class="stringliteral">&quot;Usage: dahdi show version\n&quot;</span>
<a name="l14946"></a>14946          <span class="stringliteral">&quot;       Shows the DAHDI version in use\n&quot;</span>;
<a name="l14947"></a>14947       <span class="keywordflow">return</span> NULL;
<a name="l14948"></a>14948    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l14949"></a>14949       <span class="keywordflow">return</span> NULL;
<a name="l14950"></a>14950    }
<a name="l14951"></a>14951    <span class="keywordflow">if</span> ((pseudo_fd = open(<span class="stringliteral">&quot;/dev/dahdi/ctl&quot;</span>, O_RDONLY)) &lt; 0) {
<a name="l14952"></a>14952       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Failed to open control file to get version.\n&quot;</span>);
<a name="l14953"></a>14953       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l14954"></a>14954    }
<a name="l14955"></a>14955 
<a name="l14956"></a>14956    strcpy(vi.version, <span class="stringliteral">&quot;Unknown&quot;</span>);
<a name="l14957"></a>14957    strcpy(vi.echo_canceller, <span class="stringliteral">&quot;Unknown&quot;</span>);
<a name="l14958"></a>14958 
<a name="l14959"></a>14959    <span class="keywordflow">if</span> (ioctl(pseudo_fd, DAHDI_GETVERSION, &amp;vi))
<a name="l14960"></a>14960       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Failed to get DAHDI version: %s\n&quot;</span>, strerror(errno));
<a name="l14961"></a>14961    <span class="keywordflow">else</span>
<a name="l14962"></a>14962       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;DAHDI Version: %s Echo Canceller: %s\n&quot;</span>, vi.version, vi.echo_canceller);
<a name="l14963"></a>14963 
<a name="l14964"></a>14964    close(pseudo_fd);
<a name="l14965"></a>14965 
<a name="l14966"></a>14966    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l14967"></a>14967 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a79b74cfb99811f4c7f5b10daeaf4f9fa"></a><!-- doxytag: member="chan_dahdi.c::dahdi_sig2str" ref="a79b74cfb99811f4c7f5b10daeaf4f9fa" args="(int sig)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* dahdi_sig2str </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>sig</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l02408">2408</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="adsistub_8c_source.html#l00059">buf</a>, <a class="el" href="chan__dahdi_8c_source.html#l00256">SIG_BRI</a>, <a class="el" href="chan__dahdi_8c_source.html#l00257">SIG_BRI_PTMP</a>, <a class="el" href="chan__dahdi_8c_source.html#l00245">SIG_E911</a>, <a class="el" href="chan__dahdi_8c_source.html#l00240">SIG_EM</a>, <a class="el" href="chan__dahdi_8c_source.html#l00265">SIG_EM_E1</a>, <a class="el" href="chan__dahdi_8c_source.html#l00241">SIG_EMWINK</a>, <a class="el" href="chan__dahdi_8c_source.html#l00244">SIG_FEATB</a>, <a class="el" href="chan__dahdi_8c_source.html#l00242">SIG_FEATD</a>, <a class="el" href="chan__dahdi_8c_source.html#l00243">SIG_FEATDMF</a>, <a class="el" href="chan__dahdi_8c_source.html#l00246">SIG_FEATDMF_TA</a>, <a class="el" href="chan__dahdi_8c_source.html#l00247">SIG_FGC_CAMA</a>, <a class="el" href="chan__dahdi_8c_source.html#l00248">SIG_FGC_CAMAMF</a>, <a class="el" href="chan__dahdi_8c_source.html#l00253">SIG_FXOGS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00254">SIG_FXOKS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00252">SIG_FXOLS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00250">SIG_FXSGS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00251">SIG_FXSKS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00249">SIG_FXSLS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00266">SIG_GR303FXOKS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00267">SIG_GR303FXSKS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00259">SIG_MFCR2</a>, <a class="el" href="chan__dahdi_8c_source.html#l00255">SIG_PRI</a>, <a class="el" href="chan__dahdi_8c_source.html#l00260">SIG_SF</a>, <a class="el" href="chan__dahdi_8c_source.html#l00264">SIG_SF_FEATB</a>, <a class="el" href="chan__dahdi_8c_source.html#l00262">SIG_SF_FEATD</a>, <a class="el" href="chan__dahdi_8c_source.html#l00263">SIG_SF_FEATDMF</a>, <a class="el" href="chan__dahdi_8c_source.html#l00261">SIG_SFWINK</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00258">SIG_SS7</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02409"></a>02409 {
<a name="l02410"></a>02410    <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[256];
<a name="l02411"></a>02411    <span class="keywordflow">switch</span> (sig) {
<a name="l02412"></a>02412    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#afa7547cd2cee1bae7734206102635216">SIG_EM</a>:
<a name="l02413"></a>02413       <span class="keywordflow">return</span> <span class="stringliteral">&quot;E &amp; M Immediate&quot;</span>;
<a name="l02414"></a>02414    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a1ba988b93fce049075b7c2ef6c931cf9">SIG_EMWINK</a>:
<a name="l02415"></a>02415       <span class="keywordflow">return</span> <span class="stringliteral">&quot;E &amp; M Wink&quot;</span>;
<a name="l02416"></a>02416    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#aa7b59772722b794c5218768dac3ee419">SIG_EM_E1</a>:
<a name="l02417"></a>02417       <span class="keywordflow">return</span> <span class="stringliteral">&quot;E &amp; M E1&quot;</span>;
<a name="l02418"></a>02418    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ab79873391af2857a602e1eff68606f23">SIG_FEATD</a>:
<a name="l02419"></a>02419       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Feature Group D (DTMF)&quot;</span>;
<a name="l02420"></a>02420    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a98d4710afc1fcb2ff110eabb4fbcc308">SIG_FEATDMF</a>:
<a name="l02421"></a>02421       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Feature Group D (MF)&quot;</span>;
<a name="l02422"></a>02422    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ac0c40f74945ed15aa82cd9fedc304e55">SIG_FEATDMF_TA</a>:
<a name="l02423"></a>02423       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Feature Groud D (MF) Tandem Access&quot;</span>;
<a name="l02424"></a>02424    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a0ba8ec199f5fb4f2be64144be0bd13b1">SIG_FEATB</a>:
<a name="l02425"></a>02425       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Feature Group B (MF)&quot;</span>;
<a name="l02426"></a>02426    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#adfdd0e4d05281d354c15ef1a5d158cd6">SIG_E911</a>:
<a name="l02427"></a>02427       <span class="keywordflow">return</span> <span class="stringliteral">&quot;E911 (MF)&quot;</span>;
<a name="l02428"></a>02428    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a167056b2763a4897838c7115efc1f9fc">SIG_FGC_CAMA</a>:
<a name="l02429"></a>02429       <span class="keywordflow">return</span> <span class="stringliteral">&quot;FGC/CAMA (Dialpulse)&quot;</span>;
<a name="l02430"></a>02430    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a945e2b5f225d3abdc57b5dcc53daa62a">SIG_FGC_CAMAMF</a>:
<a name="l02431"></a>02431       <span class="keywordflow">return</span> <span class="stringliteral">&quot;FGC/CAMA (MF)&quot;</span>;
<a name="l02432"></a>02432    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a1dc50a07aef86c90ab94f1583c35a265">SIG_FXSLS</a>:
<a name="l02433"></a>02433       <span class="keywordflow">return</span> <span class="stringliteral">&quot;FXS Loopstart&quot;</span>;
<a name="l02434"></a>02434    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a97e4c6fb4680984aafc6e0e55a2b6cb4">SIG_FXSGS</a>:
<a name="l02435"></a>02435       <span class="keywordflow">return</span> <span class="stringliteral">&quot;FXS Groundstart&quot;</span>;
<a name="l02436"></a>02436    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a38139ec369c0243f4324eb4eb0c2f004">SIG_FXSKS</a>:
<a name="l02437"></a>02437       <span class="keywordflow">return</span> <span class="stringliteral">&quot;FXS Kewlstart&quot;</span>;
<a name="l02438"></a>02438    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#adb40571aa5ff846fc334be5260eab257">SIG_FXOLS</a>:
<a name="l02439"></a>02439       <span class="keywordflow">return</span> <span class="stringliteral">&quot;FXO Loopstart&quot;</span>;
<a name="l02440"></a>02440    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a3dcffbaf4a26f2b7b792998df1eea27b">SIG_FXOGS</a>:
<a name="l02441"></a>02441       <span class="keywordflow">return</span> <span class="stringliteral">&quot;FXO Groundstart&quot;</span>;
<a name="l02442"></a>02442    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a7c9b3bb8225896ff2b9aed27e6f80f10">SIG_FXOKS</a>:
<a name="l02443"></a>02443       <span class="keywordflow">return</span> <span class="stringliteral">&quot;FXO Kewlstart&quot;</span>;
<a name="l02444"></a>02444    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ae9ab0c9508fca045a06730533be276a5">SIG_PRI</a>:
<a name="l02445"></a>02445       <span class="keywordflow">return</span> <span class="stringliteral">&quot;ISDN PRI&quot;</span>;
<a name="l02446"></a>02446    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ab5bfeaf991c23c5b6510ace44ae79ce9">SIG_BRI</a>:
<a name="l02447"></a>02447       <span class="keywordflow">return</span> <span class="stringliteral">&quot;ISDN BRI Point to Point&quot;</span>;
<a name="l02448"></a>02448    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a>:
<a name="l02449"></a>02449       <span class="keywordflow">return</span> <span class="stringliteral">&quot;ISDN BRI Point to MultiPoint&quot;</span>;
<a name="l02450"></a>02450    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#aadcda889db3cf9dfe757dbc1d4d8311a">SIG_SS7</a>:
<a name="l02451"></a>02451       <span class="keywordflow">return</span> <span class="stringliteral">&quot;SS7&quot;</span>;
<a name="l02452"></a>02452    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a1d73a98ae12601287580dedd9a6d739b">SIG_MFCR2</a>:
<a name="l02453"></a>02453       <span class="keywordflow">return</span> <span class="stringliteral">&quot;MFC/R2&quot;</span>;
<a name="l02454"></a>02454    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#afacb372d32fba2192ed6a2989c54fbda">SIG_SF</a>:
<a name="l02455"></a>02455       <span class="keywordflow">return</span> <span class="stringliteral">&quot;SF (Tone) Immediate&quot;</span>;
<a name="l02456"></a>02456    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a193853e7e76cff05d51425eba48d030f">SIG_SFWINK</a>:
<a name="l02457"></a>02457       <span class="keywordflow">return</span> <span class="stringliteral">&quot;SF (Tone) Wink&quot;</span>;
<a name="l02458"></a>02458    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#aac334a7f88651d9e44499897386d2cfd">SIG_SF_FEATD</a>:
<a name="l02459"></a>02459       <span class="keywordflow">return</span> <span class="stringliteral">&quot;SF (Tone) with Feature Group D (DTMF)&quot;</span>;
<a name="l02460"></a>02460    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a4625d3aba972e102c8460a9f16af0fc7">SIG_SF_FEATDMF</a>:
<a name="l02461"></a>02461       <span class="keywordflow">return</span> <span class="stringliteral">&quot;SF (Tone) with Feature Group D (MF)&quot;</span>;
<a name="l02462"></a>02462    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a33a2f70a24e9f8ccfcc1e76f208b1ab6">SIG_SF_FEATB</a>:
<a name="l02463"></a>02463       <span class="keywordflow">return</span> <span class="stringliteral">&quot;SF (Tone) with Feature Group B (MF)&quot;</span>;
<a name="l02464"></a>02464    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a5724d8559318f4724b247ede46ff182d">SIG_GR303FXOKS</a>:
<a name="l02465"></a>02465       <span class="keywordflow">return</span> <span class="stringliteral">&quot;GR-303 with FXOKS&quot;</span>;
<a name="l02466"></a>02466    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#adc73c6cbd4b991ecd2925640c0c8761e">SIG_GR303FXSKS</a>:
<a name="l02467"></a>02467       <span class="keywordflow">return</span> <span class="stringliteral">&quot;GR-303 with FXSKS&quot;</span>;
<a name="l02468"></a>02468    <span class="keywordflow">case</span> 0:
<a name="l02469"></a>02469       <span class="keywordflow">return</span> <span class="stringliteral">&quot;Pseudo&quot;</span>;
<a name="l02470"></a>02470    <span class="keywordflow">default</span>:
<a name="l02471"></a>02471       snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;Unknown signalling %d&quot;</span>, sig);
<a name="l02472"></a>02472       <span class="keywordflow">return</span> buf;
<a name="l02473"></a>02473    }
<a name="l02474"></a>02474 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a31724c8f07f8ccbb7817302855f1d837"></a><!-- doxytag: member="chan_dahdi.c::dahdi_softhangup_all" ref="a31724c8f07f8ccbb7817302855f1d837" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void dahdi_softhangup_all </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l14309">14309</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l02037">ast_channel_trylock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="channel_8h_source.html#l00639">AST_SOFTHANGUP_EXPLICIT</a>, <a class="el" href="channel_8c_source.html#l01653">ast_softhangup_nolock()</a>, <a class="el" href="logger_8h_source.html#l00079">ast_verbose</a>, <a class="el" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>, <a class="el" href="chan__dahdi_8c_source.html#l00649">dahdi_pvt::lock</a>, <a class="el" href="chan__dahdi_8c_source.html#l00682">dahdi_pvt::next</a>, <a class="el" href="asterisk_8c_source.html#l00175">option_debug</a>, <a class="el" href="chan__dahdi_8c_source.html#l00650">dahdi_pvt::owner</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00831">dahdi_pvt::restartpending</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l14338">dahdi_restart()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l14310"></a>14310 {
<a name="l14311"></a>14311    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *p;
<a name="l14312"></a>14312 retry:
<a name="l14313"></a>14313    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;iflock);
<a name="l14314"></a>14314    <span class="keywordflow">for</span> (p = <a class="code" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>; p; p = p-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>) {
<a name="l14315"></a>14315       <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l14316"></a>14316       <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> &amp;&amp; !p-&gt;<a class="code" href="structdahdi__pvt.html#a3e7bd1a358a0b3d915ed7ce256c71a8c">restartpending</a>) {
<a name="l14317"></a>14317          <span class="keywordflow">if</span> (<a class="code" href="lock_8h.html#a8b8532d377bd19e8411000ddccfa6607" title="Try locking a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_trylock</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)) {
<a name="l14318"></a>14318             <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#ga40f8fb2e731031d99f732f515cec680f">option_debug</a> &gt; 2)
<a name="l14319"></a>14319                <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;Avoiding deadlock\n&quot;</span>);
<a name="l14320"></a>14320             <span class="comment">/* Avoid deadlock since you&apos;re not supposed to lock iflock or pvt before a channel */</span>
<a name="l14321"></a>14321             <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l14322"></a>14322             <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;iflock);
<a name="l14323"></a>14323             <span class="keywordflow">goto</span> retry;
<a name="l14324"></a>14324          }
<a name="l14325"></a>14325          <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#ga40f8fb2e731031d99f732f515cec680f">option_debug</a> &gt; 2)
<a name="l14326"></a>14326             <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;Softhanging up on %s\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name);
<a name="l14327"></a>14327          <a class="code" href="channel_8h.html#ae90da1877e143b996d202d4c88a9c862" title="Softly hangup up a channel (no channel lock).">ast_softhangup_nolock</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709a2b3b711afc65059c4b51008c9fbc7aee">AST_SOFTHANGUP_EXPLICIT</a>);
<a name="l14328"></a>14328          p-&gt;<a class="code" href="structdahdi__pvt.html#a3e7bd1a358a0b3d915ed7ce256c71a8c">restartpending</a> = 1;
<a name="l14329"></a>14329          <a class="code" href="chan__dahdi_8c.html#a4e11ab7baf933c0b5151114a755704a5">num_restart_pending</a>++;
<a name="l14330"></a>14330          <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l14331"></a>14331       }
<a name="l14332"></a>14332       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l14333"></a>14333    }
<a name="l14334"></a>14334    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;iflock);
<a name="l14335"></a>14335 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a31c006d7b409a09059a58946a706ea07"></a><!-- doxytag: member="chan_dahdi.c::dahdi_train_ec" ref="a31c006d7b409a09059a58946a706ea07" args="(struct dahdi_pvt *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void dahdi_train_ec </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l02692">2692</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="chan__dahdi_8c_source.html#l00759">dahdi_pvt::echocanon</a>, <a class="el" href="chan__dahdi_8c_source.html#l01082">dahdi_pvt::echotraining</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l04718">dahdi_answer()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02693"></a>02693 {
<a name="l02694"></a>02694    <span class="keywordtype">int</span> x;
<a name="l02695"></a>02695    <span class="keywordtype">int</span> res;
<a name="l02696"></a>02696 
<a name="l02697"></a>02697    <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="structdahdi__pvt.html#a02f7d8025e31d288688f4b53215369f4" title="TRUE if echo cancellation is turned on.">echocanon</a> &amp;&amp; p-&gt;<a class="code" href="structdahdi__pvt.html#a6c8f2e86376f982c0d9e709736787a51" title="Echo training time. 0 = disabled.">echotraining</a>) {
<a name="l02698"></a>02698       x = p-&gt;<a class="code" href="structdahdi__pvt.html#a6c8f2e86376f982c0d9e709736787a51" title="Echo training time. 0 = disabled.">echotraining</a>;
<a name="l02699"></a>02699       res = ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_ECHOTRAIN, &amp;x);
<a name="l02700"></a>02700       <span class="keywordflow">if</span> (res)
<a name="l02701"></a>02701          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to request echo training on channel %d: %s\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, strerror(errno));
<a name="l02702"></a>02702       <span class="keywordflow">else</span>
<a name="l02703"></a>02703          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Engaged echo training on channel %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l02704"></a>02704    } <span class="keywordflow">else</span> {
<a name="l02705"></a>02705       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;No echo training requested\n&quot;</span>);
<a name="l02706"></a>02706    }
<a name="l02707"></a>02707 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3e2349a75e5e78bd2168860df8746d49"></a><!-- doxytag: member="chan_dahdi.c::dahdi_unlink" ref="a3e2349a75e5e78bd2168860df8746d49" args="(struct dahdi_pvt *slave, struct dahdi_pvt *master, int needlock)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void dahdi_unlink </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>slave</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>master</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>needlock</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l05044">5044</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01722">ast_mutex_trylock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="chan__dahdi_8c_source.html#l02527">conf_del()</a>, <a class="el" href="lock_8h_source.html#l01676">DEADLOCK_AVOIDANCE</a>, <a class="el" href="chan__dahdi_8c_source.html#l00659">dahdi_pvt::inconference</a>, <a class="el" href="chan__dahdi_8c_source.html#l00649">dahdi_pvt::lock</a>, <a class="el" href="chan__dahdi_8c_source.html#l00658">dahdi_pvt::master</a>, <a class="el" href="chan__dahdi_8c_source.html#l00628">MAX_SLAVES</a>, <a class="el" href="chan__dahdi_8c_source.html#l00657">dahdi_pvt::slaves</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>, and <a class="el" href="chan__dahdi_8c_source.html#l02604">update_conf()</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l05156">dahdi_bridge()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l05448">dahdi_fixup()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05045"></a>05045 {
<a name="l05046"></a>05046    <span class="comment">/* Unlink a specific slave or all slaves/masters from a given master */</span>
<a name="l05047"></a>05047    <span class="keywordtype">int</span> x;
<a name="l05048"></a>05048    <span class="keywordtype">int</span> hasslaves;
<a name="l05049"></a>05049    <span class="keywordflow">if</span> (!master)
<a name="l05050"></a>05050       <span class="keywordflow">return</span>;
<a name="l05051"></a>05051    <span class="keywordflow">if</span> (needlock) {
<a name="l05052"></a>05052       <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;master-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l05053"></a>05053       <span class="keywordflow">if</span> (slave) {
<a name="l05054"></a>05054          <span class="keywordflow">while</span> (<a class="code" href="lock_8h.html#a036ccafa2339f674a46bc269bbd48c5f">ast_mutex_trylock</a>(&amp;slave-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>)) {
<a name="l05055"></a>05055             <a class="code" href="lock_8h.html#a851106e971b4611a38cb4be8b39d9fcf">DEADLOCK_AVOIDANCE</a>(&amp;master-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l05056"></a>05056          }
<a name="l05057"></a>05057       }
<a name="l05058"></a>05058    }
<a name="l05059"></a>05059    hasslaves = 0;
<a name="l05060"></a>05060    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="chan__dahdi_8c.html#a2a3c5190bdbe2a4780a460383970aa92">MAX_SLAVES</a>; x++) {
<a name="l05061"></a>05061       <span class="keywordflow">if</span> (master-&gt;<a class="code" href="structdahdi__pvt.html#aa607a8a226852c168c96a4d0f3001c88">slaves</a>[x]) {
<a name="l05062"></a>05062          <span class="keywordflow">if</span> (!slave || (master-&gt;<a class="code" href="structdahdi__pvt.html#aa607a8a226852c168c96a4d0f3001c88">slaves</a>[x] == slave)) {
<a name="l05063"></a>05063             <span class="comment">/* Take slave out of the conference */</span>
<a name="l05064"></a>05064             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Unlinking slave %d from %d\n&quot;</span>, master-&gt;<a class="code" href="structdahdi__pvt.html#aa607a8a226852c168c96a4d0f3001c88">slaves</a>[x]-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, master-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l05065"></a>05065             <a class="code" href="chan__dahdi_8c.html#aa44456edf36cac7dde2531aef042ec1c">conf_del</a>(master, &amp;master-&gt;<a class="code" href="structdahdi__pvt.html#aa607a8a226852c168c96a4d0f3001c88">slaves</a>[x]-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>], SUB_REAL);
<a name="l05066"></a>05066             <a class="code" href="chan__dahdi_8c.html#aa44456edf36cac7dde2531aef042ec1c">conf_del</a>(master-&gt;<a class="code" href="structdahdi__pvt.html#aa607a8a226852c168c96a4d0f3001c88">slaves</a>[x], &amp;master-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>], <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>);
<a name="l05067"></a>05067             master-&gt;<a class="code" href="structdahdi__pvt.html#aa607a8a226852c168c96a4d0f3001c88">slaves</a>[x]-&gt;<a class="code" href="structdahdi__pvt.html#a3e30e79b4679785034d55aff6a17e41b">master</a> = NULL;
<a name="l05068"></a>05068             master-&gt;<a class="code" href="structdahdi__pvt.html#aa607a8a226852c168c96a4d0f3001c88">slaves</a>[x] = NULL;
<a name="l05069"></a>05069          } <span class="keywordflow">else</span>
<a name="l05070"></a>05070             hasslaves = 1;
<a name="l05071"></a>05071       }
<a name="l05072"></a>05072       <span class="keywordflow">if</span> (!hasslaves)
<a name="l05073"></a>05073          master-&gt;<a class="code" href="structdahdi__pvt.html#afa5f2dbd816e7f6141e6932e94b8eedd">inconference</a> = 0;
<a name="l05074"></a>05074    }
<a name="l05075"></a>05075    <span class="keywordflow">if</span> (!slave) {
<a name="l05076"></a>05076       <span class="keywordflow">if</span> (master-&gt;<a class="code" href="structdahdi__pvt.html#a3e30e79b4679785034d55aff6a17e41b">master</a>) {
<a name="l05077"></a>05077          <span class="comment">/* Take master out of the conference */</span>
<a name="l05078"></a>05078          <a class="code" href="chan__dahdi_8c.html#aa44456edf36cac7dde2531aef042ec1c">conf_del</a>(master-&gt;<a class="code" href="structdahdi__pvt.html#a3e30e79b4679785034d55aff6a17e41b">master</a>, &amp;master-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>], <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>);
<a name="l05079"></a>05079          <a class="code" href="chan__dahdi_8c.html#aa44456edf36cac7dde2531aef042ec1c">conf_del</a>(master, &amp;master-&gt;<a class="code" href="structdahdi__pvt.html#a3e30e79b4679785034d55aff6a17e41b">master</a>-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>], <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>);
<a name="l05080"></a>05080          hasslaves = 0;
<a name="l05081"></a>05081          <span class="keywordflow">for</span> (x = 0; x &lt; MAX_SLAVES; x++) {
<a name="l05082"></a>05082             <span class="keywordflow">if</span> (master-&gt;<a class="code" href="structdahdi__pvt.html#a3e30e79b4679785034d55aff6a17e41b">master</a>-&gt;<a class="code" href="structdahdi__pvt.html#aa607a8a226852c168c96a4d0f3001c88">slaves</a>[x] == master)
<a name="l05083"></a>05083                master-&gt;<a class="code" href="structdahdi__pvt.html#a3e30e79b4679785034d55aff6a17e41b">master</a>-&gt;<a class="code" href="structdahdi__pvt.html#aa607a8a226852c168c96a4d0f3001c88">slaves</a>[x] = NULL;
<a name="l05084"></a>05084             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (master-&gt;<a class="code" href="structdahdi__pvt.html#a3e30e79b4679785034d55aff6a17e41b">master</a>-&gt;<a class="code" href="structdahdi__pvt.html#aa607a8a226852c168c96a4d0f3001c88">slaves</a>[x])
<a name="l05085"></a>05085                hasslaves = 1;
<a name="l05086"></a>05086          }
<a name="l05087"></a>05087          <span class="keywordflow">if</span> (!hasslaves)
<a name="l05088"></a>05088             master-&gt;<a class="code" href="structdahdi__pvt.html#a3e30e79b4679785034d55aff6a17e41b">master</a>-&gt;<a class="code" href="structdahdi__pvt.html#afa5f2dbd816e7f6141e6932e94b8eedd">inconference</a> = 0;
<a name="l05089"></a>05089       }
<a name="l05090"></a>05090       master-&gt;<a class="code" href="structdahdi__pvt.html#a3e30e79b4679785034d55aff6a17e41b">master</a> = NULL;
<a name="l05091"></a>05091    }
<a name="l05092"></a>05092    <a class="code" href="chan__dahdi_8c.html#ac56c05fde8bc30c71af46502e97fae3b">update_conf</a>(master);
<a name="l05093"></a>05093    <span class="keywordflow">if</span> (needlock) {
<a name="l05094"></a>05094       <span class="keywordflow">if</span> (slave)
<a name="l05095"></a>05095          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;slave-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l05096"></a>05096       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;master-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l05097"></a>05097    }
<a name="l05098"></a>05098 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a497fdd00b631dd33acca24f8178cbd9d"></a><!-- doxytag: member="chan_dahdi.c::dahdi_wait_event" ref="a497fdd00b631dd33acca24f8178cbd9d" args="(int fd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int dahdi_wait_event </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Avoid the silly dahdi_waitevent which ignores a bunch of events. </p>

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00385">385</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00386"></a>00386 {
<a name="l00387"></a>00387    <span class="keywordtype">int</span> i, j = 0;
<a name="l00388"></a>00388    i = DAHDI_IOMUX_SIGEVENT;
<a name="l00389"></a>00389    <span class="keywordflow">if</span> (ioctl(fd, DAHDI_IOMUX, &amp;i) == -1)
<a name="l00390"></a>00390       <span class="keywordflow">return</span> -1;
<a name="l00391"></a>00391    <span class="keywordflow">if</span> (ioctl(fd, DAHDI_GETEVENT, &amp;j) == -1)
<a name="l00392"></a>00392       <span class="keywordflow">return</span> -1;
<a name="l00393"></a>00393    <span class="keywordflow">return</span> j;
<a name="l00394"></a>00394 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a861b167aa5283df4f8153393acb50bbb"></a><!-- doxytag: member="chan_dahdi.c::dahdi_wink" ref="a861b167aa5283df4f8153393acb50bbb" args="(struct dahdi_pvt *p, int idx)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int dahdi_wink </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>idx</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l07635">7635</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="chan__dahdi_8c_source.html#l02863">dahdi_set_hook()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l07636"></a>07636 {
<a name="l07637"></a>07637    <span class="keywordtype">int</span> j;
<a name="l07638"></a>07638    <a class="code" href="chan__dahdi_8c.html#a7c65e6943db828524ea6c9215b8bf696">dahdi_set_hook</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_WINK);
<a name="l07639"></a>07639    <span class="keywordflow">for</span> (;;)
<a name="l07640"></a>07640    {
<a name="l07641"></a>07641       <span class="comment">/* set bits of interest */</span>
<a name="l07642"></a>07642       j = DAHDI_IOMUX_SIGEVENT;
<a name="l07643"></a>07643       <span class="comment">/* wait for some happening */</span>
<a name="l07644"></a>07644       <span class="keywordflow">if</span> (ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>,DAHDI_IOMUX,&amp;j) == -1) <span class="keywordflow">return</span>(-1);
<a name="l07645"></a>07645       <span class="comment">/* exit loop if we have it */</span>
<a name="l07646"></a>07646       <span class="keywordflow">if</span> (j &amp; DAHDI_IOMUX_SIGEVENT) <span class="keywordflow">break</span>;
<a name="l07647"></a>07647    }
<a name="l07648"></a>07648    <span class="comment">/* get the event info */</span>
<a name="l07649"></a>07649    <span class="keywordflow">if</span> (ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>,DAHDI_GETEVENT,&amp;j) == -1) <span class="keywordflow">return</span>(-1);
<a name="l07650"></a>07650    <span class="keywordflow">return</span> 0;
<a name="l07651"></a>07651 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a33b8ded71b995076d6146c2089157ea7"></a><!-- doxytag: member="chan_dahdi.c::dahdi_write" ref="a33b8ded71b995076d6146c2089157ea7" args="(struct ast_channel *ast, struct ast_frame *frame)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int dahdi_write </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>ast</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td>
          <td class="paramname"> <em>frame</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l07090">7090</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="frame_8h_source.html#l00247">AST_FORMAT_ALAW</a>, <a class="el" href="frame_8h_source.html#l00253">AST_FORMAT_SLINEAR</a>, <a class="el" href="frame_8h_source.html#l00245">AST_FORMAT_ULAW</a>, <a class="el" href="frame_8h_source.html#l00113">AST_FRAME_IMAGE</a>, <a class="el" href="frame_8h_source.html#l00101">AST_FRAME_VOICE</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="chan__dahdi_8c_source.html#l01050">dahdi_pvt::cidspill</a>, <a class="el" href="chan__dahdi_8c_source.html#l01503">dahdi_get_index()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02165">dahdi_setlinear()</a>, <a class="el" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">ast_frame::data</a>, <a class="el" href="frame_8h_source.html#l00147">ast_frame::datalen</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="chan__dahdi_8c_source.html#l00745">dahdi_pvt::dialing</a>, <a class="el" href="chan__dahdi_8c_source.html#l00747">dahdi_pvt::digital</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="chan__dahdi_8c_source.html#l00620">dahdi_subchannel::linear</a>, <a class="el" href="chan__dahdi_8c_source.html#l00649">dahdi_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__dahdi_8c_source.html#l07068">my_dahdi_write()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00801">dahdi_pvt::outgoing</a>, <a class="el" href="chan__dahdi_8c_source.html#l00650">dahdi_pvt::owner</a>, <a class="el" href="frame_8h_source.html#l00159">ast_frame::ptr</a>, <a class="el" href="chan__dahdi_8c_source.html#l00666">dahdi_pvt::sig</a>, <a class="el" href="chan__dahdi_8c_source.html#l00255">SIG_PRI</a>, <a class="el" href="chan__dahdi_8c_source.html#l01042">dahdi_pvt::span</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>, and <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l07091"></a>07091 {
<a name="l07092"></a>07092    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *p = ast-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l07093"></a>07093    <span class="keywordtype">int</span> res;
<a name="l07094"></a>07094    <span class="keywordtype">int</span> idx;
<a name="l07095"></a>07095    idx = <a class="code" href="chan__dahdi_8c.html#a62c8e3f411fb9e5ec62a1e77c152c2df">dahdi_get_index</a>(ast, p, 0);
<a name="l07096"></a>07096    <span class="keywordflow">if</span> (idx &lt; 0) {
<a name="l07097"></a>07097       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;%s doesn&apos;t really exist?\n&quot;</span>, ast-&gt;name);
<a name="l07098"></a>07098       <span class="keywordflow">return</span> -1;
<a name="l07099"></a>07099    }
<a name="l07100"></a>07100 
<a name="l07101"></a>07101 <span class="preprocessor">#if 0</span>
<a name="l07102"></a>07102 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l07103"></a>07103 <span class="preprocessor"></span>   <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l07104"></a>07104    <span class="keywordflow">if</span> (!p-&gt;proceeding &amp;&amp; p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a>==<a class="code" href="chan__dahdi_8c.html#ae9ab0c9508fca045a06730533be276a5">SIG_PRI</a> &amp;&amp; p-&gt;pri &amp;&amp; !p-&gt;<a class="code" href="structdahdi__pvt.html#a40668dcb7d940b80c4f109861059a978" title="TRUE if we originated the call leg.">outgoing</a>) {
<a name="l07105"></a>07105       <span class="keywordflow">if</span> (p-&gt;pri-&gt;pri) {
<a name="l07106"></a>07106          <span class="keywordflow">if</span> (!pri_grab(p, p-&gt;pri)) {
<a name="l07107"></a>07107                pri_progress(p-&gt;pri-&gt;pri,p-&gt;call, PVT_TO_CHANNEL(p), !p-&gt;<a class="code" href="structdahdi__pvt.html#adf54768a4327f86de3a234648305c4a4" title="TRUE if the transfer capability of the call is digital.">digital</a>);
<a name="l07108"></a>07108                pri_rel(p-&gt;pri);
<a name="l07109"></a>07109          } <span class="keywordflow">else</span>
<a name="l07110"></a>07110                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to grab PRI on span %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#a63fc22149930803b4e3fb4c453177e5e">span</a>);
<a name="l07111"></a>07111       }
<a name="l07112"></a>07112       p-&gt;proceeding=1;
<a name="l07113"></a>07113    }
<a name="l07114"></a>07114    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l07115"></a>07115 <span class="preprocessor">#endif</span>
<a name="l07116"></a>07116 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l07117"></a>07117 <span class="preprocessor"></span>   <span class="comment">/* Write a frame of (presumably voice) data */</span>
<a name="l07118"></a>07118    <span class="keywordflow">if</span> (frame-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> != <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>) {
<a name="l07119"></a>07119       <span class="keywordflow">if</span> (frame-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> != <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a6c9398ee8989239124295d096a87bf32">AST_FRAME_IMAGE</a>)
<a name="l07120"></a>07120          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Don&apos;t know what to do with frame type &apos;%d&apos;\n&quot;</span>, frame-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a>);
<a name="l07121"></a>07121       <span class="keywordflow">return</span> 0;
<a name="l07122"></a>07122    }
<a name="l07123"></a>07123    <span class="keywordflow">if</span> ((frame-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> != <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>) &amp;&amp;
<a name="l07124"></a>07124       (frame-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> != <a class="code" href="frame_8h.html#ab602cf455d4a96a3adba2e3ba8cd2b2c">AST_FORMAT_ULAW</a>) &amp;&amp;
<a name="l07125"></a>07125       (frame-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> != <a class="code" href="frame_8h.html#aa58cc980a9c9108522effc64e9aff2d6">AST_FORMAT_ALAW</a>)) {
<a name="l07126"></a>07126       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Cannot handle frames in %d format\n&quot;</span>, frame-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>);
<a name="l07127"></a>07127       <span class="keywordflow">return</span> -1;
<a name="l07128"></a>07128    }
<a name="l07129"></a>07129    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#af17335c0c7a4c1e03e987a33f6eec81b" title="TRUE if in the process of dialing digits or sending something.">dialing</a>) {
<a name="l07130"></a>07130       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Dropping frame since I&apos;m still dialing on %s...\n&quot;</span>,ast-&gt;name);
<a name="l07131"></a>07131       <span class="keywordflow">return</span> 0;
<a name="l07132"></a>07132    }
<a name="l07133"></a>07133    <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l07134"></a>07134       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Dropping frame since there is no active owner on %s...\n&quot;</span>,ast-&gt;name);
<a name="l07135"></a>07135       <span class="keywordflow">return</span> 0;
<a name="l07136"></a>07136    }
<a name="l07137"></a>07137    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a>) {
<a name="l07138"></a>07138       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Dropping frame since I&apos;ve still got a callerid spill\n&quot;</span>);
<a name="l07139"></a>07139       <span class="keywordflow">return</span> 0;
<a name="l07140"></a>07140    }
<a name="l07141"></a>07141    <span class="comment">/* Return if it&apos;s not valid data */</span>
<a name="l07142"></a>07142    <span class="keywordflow">if</span> (!frame-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a> || !frame-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>)
<a name="l07143"></a>07143       <span class="keywordflow">return</span> 0;
<a name="l07144"></a>07144 
<a name="l07145"></a>07145    <span class="keywordflow">if</span> (frame-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> == <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>) {
<a name="l07146"></a>07146       <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a2de30c0a559b0df57ba137153a1370ea">linear</a>) {
<a name="l07147"></a>07147          p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a2de30c0a559b0df57ba137153a1370ea">linear</a> = 1;
<a name="l07148"></a>07148          res = <a class="code" href="chan__dahdi_8c.html#a8392b32cf7d3daa7b45154b7001460df">dahdi_setlinear</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a2de30c0a559b0df57ba137153a1370ea">linear</a>);
<a name="l07149"></a>07149          <span class="keywordflow">if</span> (res)
<a name="l07150"></a>07150             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to set linear mode on channel %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l07151"></a>07151       }
<a name="l07152"></a>07152       res = <a class="code" href="chan__dahdi_8c.html#a124dc539e9fb2f5ac94d5be7db0b5f0b">my_dahdi_write</a>(p, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)frame-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, frame-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>, idx, 1);
<a name="l07153"></a>07153    } <span class="keywordflow">else</span> {
<a name="l07154"></a>07154       <span class="comment">/* x-law already */</span>
<a name="l07155"></a>07155       <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a2de30c0a559b0df57ba137153a1370ea">linear</a>) {
<a name="l07156"></a>07156          p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a2de30c0a559b0df57ba137153a1370ea">linear</a> = 0;
<a name="l07157"></a>07157          res = <a class="code" href="chan__dahdi_8c.html#a8392b32cf7d3daa7b45154b7001460df">dahdi_setlinear</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a2de30c0a559b0df57ba137153a1370ea">linear</a>);
<a name="l07158"></a>07158          <span class="keywordflow">if</span> (res)
<a name="l07159"></a>07159             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to set companded mode on channel %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l07160"></a>07160       }
<a name="l07161"></a>07161       res = <a class="code" href="chan__dahdi_8c.html#a124dc539e9fb2f5ac94d5be7db0b5f0b">my_dahdi_write</a>(p, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)frame-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, frame-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>, idx, 0);
<a name="l07162"></a>07162    }
<a name="l07163"></a>07163    <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l07164"></a>07164       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;write failed: %s\n&quot;</span>, strerror(errno));
<a name="l07165"></a>07165       <span class="keywordflow">return</span> -1;
<a name="l07166"></a>07166    }
<a name="l07167"></a>07167    <span class="keywordflow">return</span> 0;
<a name="l07168"></a>07168 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aff6140c85d9d958a2ff7abf6003a20d9"></a><!-- doxytag: member="chan_dahdi.c::destroy_all_channels" ref="aff6140c85d9d958a2ff7abf6003a20d9" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void destroy_all_channels </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l03929">3929</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="logger_8h_source.html#l00079">ast_verbose</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="chan__dahdi_8c_source.html#l01050">dahdi_pvt::cidspill</a>, <a class="el" href="chan__dahdi_8c_source.html#l03856">destroy_dahdi_pvt()</a>, <a class="el" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>, <a class="el" href="chan__dahdi_8c_source.html#l00682">dahdi_pvt::next</a>, <a class="el" href="asterisk_8c_source.html#l00174">option_verbose</a>, and <a class="el" href="logger_8h_source.html#l00042">VERBOSE_PREFIX_2</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l15849">__unload_module()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l14338">dahdi_restart()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03930"></a>03930 {
<a name="l03931"></a>03931    <span class="keywordtype">int</span> x;
<a name="l03932"></a>03932    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *p, *pl;
<a name="l03933"></a>03933 
<a name="l03934"></a>03934    <span class="keywordflow">while</span> (<a class="code" href="chan__dahdi_8c.html#a4e11ab7baf933c0b5151114a755704a5">num_restart_pending</a>) {
<a name="l03935"></a>03935       usleep(1);
<a name="l03936"></a>03936    }
<a name="l03937"></a>03937 
<a name="l03938"></a>03938    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;iflock);
<a name="l03939"></a>03939    <span class="comment">/* Destroy all the interfaces and free their memory */</span>
<a name="l03940"></a>03940    p = <a class="code" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>;
<a name="l03941"></a>03941    <span class="keywordflow">while</span> (p) {
<a name="l03942"></a>03942       <span class="comment">/* Free any callerid */</span>
<a name="l03943"></a>03943       <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a>)
<a name="l03944"></a>03944          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a>);
<a name="l03945"></a>03945       pl = p;
<a name="l03946"></a>03946       p = p-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>;
<a name="l03947"></a>03947       x = pl-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>;
<a name="l03948"></a>03948       <span class="comment">/* Free associated memory */</span>
<a name="l03949"></a>03949       <span class="keywordflow">if</span> (pl)
<a name="l03950"></a>03950          <a class="code" href="chan__dahdi_8c.html#a9db88392ac10cee3a3116d1f7f4aae5f">destroy_dahdi_pvt</a>(&amp;pl);
<a name="l03951"></a>03951       <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#gaa294d0efa6a89c1a3d162787cac4fff5">option_verbose</a> &gt; 2)
<a name="l03952"></a>03952          <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<a class="code" href="logger_8h.html#a5623b2747e49964e0eae2795057bc92e">VERBOSE_PREFIX_2</a> <span class="stringliteral">&quot;Unregistered channel %d\n&quot;</span>, x);
<a name="l03953"></a>03953    }
<a name="l03954"></a>03954    <a class="code" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a> = NULL;
<a name="l03955"></a>03955    <a class="code" href="chan__dahdi_8c.html#af7b23639f050bf4be75e75d2a11cefc9">ifcount</a> = 0;
<a name="l03956"></a>03956    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;iflock);
<a name="l03957"></a>03957 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a707746b49a41e00df8477523111cb7f3"></a><!-- doxytag: member="chan_dahdi.c::destroy_channel" ref="a707746b49a41e00df8477523111cb7f3" args="(struct dahdi_pvt *prev, struct dahdi_pvt *cur, int now)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int destroy_channel </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>prev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>cur</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>now</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l03879">3879</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="chan__dahdi_8c_source.html#l03856">destroy_dahdi_pvt()</a>, <a class="el" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>, <a class="el" href="chan__dahdi_8c_source.html#l00682">dahdi_pvt::next</a>, <a class="el" href="chan__dahdi_8c_source.html#l00608">dahdi_subchannel::owner</a>, <a class="el" href="chan__dahdi_8c_source.html#l00650">dahdi_pvt::owner</a>, <a class="el" href="chan__dahdi_8c_source.html#l00683">dahdi_pvt::prev</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l09249">dahdi_destroy_channel_bynum()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l04313">dahdi_hangup()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03880"></a>03880 {
<a name="l03881"></a>03881    <span class="keywordtype">int</span> owned = 0;
<a name="l03882"></a>03882    <span class="keywordtype">int</span> i = 0;
<a name="l03883"></a>03883 
<a name="l03884"></a>03884    <span class="keywordflow">if</span> (!now) {
<a name="l03885"></a>03885       <span class="keywordflow">if</span> (cur-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l03886"></a>03886          owned = 1;
<a name="l03887"></a>03887       }
<a name="l03888"></a>03888 
<a name="l03889"></a>03889       <span class="keywordflow">for</span> (i = 0; i &lt; 3; i++) {
<a name="l03890"></a>03890          <span class="keywordflow">if</span> (cur-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[i].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l03891"></a>03891             owned = 1;
<a name="l03892"></a>03892          }
<a name="l03893"></a>03893       }
<a name="l03894"></a>03894       <span class="keywordflow">if</span> (!owned) {
<a name="l03895"></a>03895          <span class="keywordflow">if</span> (prev) {
<a name="l03896"></a>03896             prev-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a> = cur-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>;
<a name="l03897"></a>03897             <span class="keywordflow">if</span> (prev-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>)
<a name="l03898"></a>03898                prev-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>-&gt;<a class="code" href="structdahdi__pvt.html#abba5e5e1dcf19b4ded5000d926e0a70d">prev</a> = prev;
<a name="l03899"></a>03899             <span class="keywordflow">else</span>
<a name="l03900"></a>03900                <a class="code" href="chan__dahdi_8c.html#af06d42bbf0081c1eb058b893305b4e85">ifend</a> = prev;
<a name="l03901"></a>03901          } <span class="keywordflow">else</span> {
<a name="l03902"></a>03902             <a class="code" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a> = cur-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>;
<a name="l03903"></a>03903             <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>)
<a name="l03904"></a>03904                <a class="code" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>-&gt;<a class="code" href="structdahdi__pvt.html#abba5e5e1dcf19b4ded5000d926e0a70d">prev</a> = NULL;
<a name="l03905"></a>03905             <span class="keywordflow">else</span>
<a name="l03906"></a>03906                <a class="code" href="chan__dahdi_8c.html#af06d42bbf0081c1eb058b893305b4e85">ifend</a> = NULL;
<a name="l03907"></a>03907          }
<a name="l03908"></a>03908          <a class="code" href="chan__dahdi_8c.html#a9db88392ac10cee3a3116d1f7f4aae5f">destroy_dahdi_pvt</a>(&amp;cur);
<a name="l03909"></a>03909       }
<a name="l03910"></a>03910    } <span class="keywordflow">else</span> {
<a name="l03911"></a>03911       <span class="keywordflow">if</span> (prev) {
<a name="l03912"></a>03912          prev-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a> = cur-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>;
<a name="l03913"></a>03913          <span class="keywordflow">if</span> (prev-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>)
<a name="l03914"></a>03914             prev-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>-&gt;<a class="code" href="structdahdi__pvt.html#abba5e5e1dcf19b4ded5000d926e0a70d">prev</a> = prev;
<a name="l03915"></a>03915          <span class="keywordflow">else</span>
<a name="l03916"></a>03916             <a class="code" href="chan__dahdi_8c.html#af06d42bbf0081c1eb058b893305b4e85">ifend</a> = prev;
<a name="l03917"></a>03917       } <span class="keywordflow">else</span> {
<a name="l03918"></a>03918          <a class="code" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a> = cur-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>;
<a name="l03919"></a>03919          <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>)
<a name="l03920"></a>03920             <a class="code" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>-&gt;<a class="code" href="structdahdi__pvt.html#abba5e5e1dcf19b4ded5000d926e0a70d">prev</a> = NULL;
<a name="l03921"></a>03921          <span class="keywordflow">else</span>
<a name="l03922"></a>03922             <a class="code" href="chan__dahdi_8c.html#af06d42bbf0081c1eb058b893305b4e85">ifend</a> = NULL;
<a name="l03923"></a>03923       }
<a name="l03924"></a>03924       <a class="code" href="chan__dahdi_8c.html#a9db88392ac10cee3a3116d1f7f4aae5f">destroy_dahdi_pvt</a>(&amp;cur);
<a name="l03925"></a>03925    }
<a name="l03926"></a>03926    <span class="keywordflow">return</span> 0;
<a name="l03927"></a>03927 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9db88392ac10cee3a3116d1f7f4aae5f"></a><!-- doxytag: member="chan_dahdi.c::destroy_dahdi_pvt" ref="a9db88392ac10cee3a3116d1f7f4aae5f" args="(struct dahdi_pvt **pvt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void destroy_dahdi_pvt </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> **&nbsp;</td>
          <td class="paramname"> <em>pvt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l03856">3856</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="event_8c_source.html#l00743">ast_event_unsubscribe()</a>, <a class="el" href="lock_8h_source.html#l01712">ast_mutex_destroy()</a>, <a class="el" href="res__smdi_8c_source.html#l00160">ast_smdi_interface_unref()</a>, <a class="el" href="config_8c_source.html#l00397">ast_variables_destroy()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02143">dahdi_close_sub()</a>, <a class="el" href="astmm_8h_source.html#l00084">free</a>, <a class="el" href="chan__dahdi_8c_source.html#l00649">dahdi_pvt::lock</a>, <a class="el" href="chan__dahdi_8c_source.html#l01131">dahdi_pvt::mwi_event_sub</a>, <a class="el" href="chan__dahdi_8c_source.html#l00682">dahdi_pvt::next</a>, <a class="el" href="chan__dahdi_8c_source.html#l00650">dahdi_pvt::owner</a>, <a class="el" href="chan__dahdi_8c_source.html#l00683">dahdi_pvt::prev</a>, <a class="el" href="chan__dahdi_8c_source.html#l00958">dahdi_pvt::smdi_iface</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>, <a class="el" href="chan__dahdi_8c_source.html#l00955">dahdi_pvt::use_smdi</a>, and <a class="el" href="chan__dahdi_8c_source.html#l01040">dahdi_pvt::vars</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l03929">destroy_all_channels()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03879">destroy_channel()</a>, <a class="el" href="chan__dahdi_8c_source.html#l10771">duplicate_pseudo()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03857"></a>03857 {
<a name="l03858"></a>03858    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *p = *pvt;
<a name="l03859"></a>03859    <span class="comment">/* Remove channel from the list */</span>
<a name="l03860"></a>03860    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#abba5e5e1dcf19b4ded5000d926e0a70d">prev</a>)
<a name="l03861"></a>03861       p-&gt;<a class="code" href="structdahdi__pvt.html#abba5e5e1dcf19b4ded5000d926e0a70d">prev</a>-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a> = p-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>;
<a name="l03862"></a>03862    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>)
<a name="l03863"></a>03863       p-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>-&gt;<a class="code" href="structdahdi__pvt.html#abba5e5e1dcf19b4ded5000d926e0a70d">prev</a> = p-&gt;<a class="code" href="structdahdi__pvt.html#abba5e5e1dcf19b4ded5000d926e0a70d">prev</a>;
<a name="l03864"></a>03864    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a93dcf4e5286d88e9c218bbc521584784" title="TRUE if SMDI (Simplified Message Desk Interface) is enabled.">use_smdi</a>)
<a name="l03865"></a>03865       <a class="code" href="smdi_8h.html#a577ed2bec7b89c642c3a2bbc89179b34">ast_smdi_interface_unref</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#af9bb0c022848cf3af1e8e51ae3c18e06" title="The serial port to listen for SMDI data on.">smdi_iface</a>);
<a name="l03866"></a>03866    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a7dec0df43032d5c53d9a125030385a30" title="Opaque event subscription parameters for message waiting indication support.">mwi_event_sub</a>)
<a name="l03867"></a>03867       <a class="code" href="event_8h.html#a71eb177cf8553883be773f1534e8a09a" title="Un-subscribe from events.">ast_event_unsubscribe</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a7dec0df43032d5c53d9a125030385a30" title="Opaque event subscription parameters for message waiting indication support.">mwi_event_sub</a>);
<a name="l03868"></a>03868    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a134fe67053d035e763d6cf99916c1bf8" title="Channel variable list with associated values to set when a channel is created.">vars</a>) {
<a name="l03869"></a>03869       <a class="code" href="config_8h.html#ad3d8122172af6f13687a07840411d65d" title="Free variable list.">ast_variables_destroy</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a134fe67053d035e763d6cf99916c1bf8" title="Channel variable list with associated values to set when a channel is created.">vars</a>);
<a name="l03870"></a>03870    }
<a name="l03871"></a>03871    <a class="code" href="lock_8h.html#ab237e70b569019bfb490ab0c3c09b8c5">ast_mutex_destroy</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l03872"></a>03872    <a class="code" href="chan__dahdi_8c.html#aa677933b22aeb7b907176d84357464c0">dahdi_close_sub</a>(p, <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>);
<a name="l03873"></a>03873    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)
<a name="l03874"></a>03874       p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a> = NULL;
<a name="l03875"></a>03875    <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(p);
<a name="l03876"></a>03876    *pvt = NULL;
<a name="l03877"></a>03877 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8f89c806d859f8f9acec697afa7eca9a"></a><!-- doxytag: member="chan_dahdi.c::digit_to_dtmfindex" ref="a8f89c806d859f8f9acec697afa7eca9a" args="(char digit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int digit_to_dtmfindex </td>
          <td>(</td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>digit</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l02229">2229</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l02245">dahdi_digit_begin()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02230"></a>02230 {
<a name="l02231"></a>02231    <span class="keywordflow">if</span> (isdigit(digit))
<a name="l02232"></a>02232       <span class="keywordflow">return</span> DAHDI_TONE_DTMF_BASE + (digit - <span class="charliteral">&apos;0&apos;</span>);
<a name="l02233"></a>02233    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (digit &gt;= <span class="charliteral">&apos;A&apos;</span> &amp;&amp; digit &lt;= <span class="charliteral">&apos;D&apos;</span>)
<a name="l02234"></a>02234       <span class="keywordflow">return</span> DAHDI_TONE_DTMF_A + (digit - <span class="charliteral">&apos;A&apos;</span>);
<a name="l02235"></a>02235    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (digit &gt;= <span class="charliteral">&apos;a&apos;</span> &amp;&amp; digit &lt;= <span class="charliteral">&apos;d&apos;</span>)
<a name="l02236"></a>02236       <span class="keywordflow">return</span> DAHDI_TONE_DTMF_A + (digit - <span class="charliteral">&apos;a&apos;</span>);
<a name="l02237"></a>02237    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (digit == <span class="charliteral">&apos;*&apos;</span>)
<a name="l02238"></a>02238       <span class="keywordflow">return</span> DAHDI_TONE_DTMF_s;
<a name="l02239"></a>02239    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (digit == <span class="charliteral">&apos;#&apos;</span>)
<a name="l02240"></a>02240       <span class="keywordflow">return</span> DAHDI_TONE_DTMF_p;
<a name="l02241"></a>02241    <span class="keywordflow">else</span>
<a name="l02242"></a>02242       <span class="keywordflow">return</span> -1;
<a name="l02243"></a>02243 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aeada40549c047d105e67ee036e638d85"></a><!-- doxytag: member="chan_dahdi.c::disable_dtmf_detect" ref="aeada40549c047d105e67ee036e638d85" args="(struct dahdi_pvt *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void disable_dtmf_detect </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l05123">5123</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="dsp_8c_source.html#l01540">ast_dsp_set_features()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="chan__dahdi_8c_source.html#l01113">dahdi_pvt::dsp</a>, <a class="el" href="dsp_8h_source.html#l00028">DSP_FEATURE_DIGIT_DETECT</a>, <a class="el" href="chan__dahdi_8c_source.html#l01179">dahdi_pvt::dsp_features</a>, <a class="el" href="chan__dahdi_8c_source.html#l00774">dahdi_pvt::hardwaredtmf</a>, <a class="el" href="chan__dahdi_8c_source.html#l00789">dahdi_pvt::ignoredtmf</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l05156">dahdi_bridge()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05124"></a>05124 {
<a name="l05125"></a>05125    <span class="keywordtype">int</span> <a class="code" href="structval.html">val</a>;
<a name="l05126"></a>05126 
<a name="l05127"></a>05127    p-&gt;<a class="code" href="structdahdi__pvt.html#a1caa9d0f8fb61da132fe2a1aa69d1973" title="TRUE if DTMF detection is disabled.">ignoredtmf</a> = 1;
<a name="l05128"></a>05128 
<a name="l05129"></a>05129    val = 0;
<a name="l05130"></a>05130    ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONEDETECT, &amp;val);
<a name="l05131"></a>05131 
<a name="l05132"></a>05132    <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="structdahdi__pvt.html#acb50d09ad188475206ff2f852afb6831" title="TRUE if DTMF detection needs to be done by hardware.">hardwaredtmf</a> &amp;&amp; p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>) {
<a name="l05133"></a>05133       p-&gt;<a class="code" href="structdahdi__pvt.html#a746e641282b3f1665a817252c8e4145e" title="DSP feature flags: DSP_FEATURE_xxx.">dsp_features</a> &amp;= ~<a class="code" href="dsp_8h.html#a84818b360426bdd5f588cdca463e15be">DSP_FEATURE_DIGIT_DETECT</a>;
<a name="l05134"></a>05134       <a class="code" href="dsp_8h.html#aedc7fa20fba91e3c018f6989e95c714b" title="Select feature set.">ast_dsp_set_features</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#a746e641282b3f1665a817252c8e4145e" title="DSP feature flags: DSP_FEATURE_xxx.">dsp_features</a>);
<a name="l05135"></a>05135    }
<a name="l05136"></a>05136 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a02d8db6086b4a18353b82ebcad631ff6"></a><!-- doxytag: member="chan_dahdi.c::do_monitor" ref="a02d8db6086b4a18353b82ebcad631ff6" args="(void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void* do_monitor </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l09496">9496</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="channel_8h_source.html#l01685">ast_fdisset()</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="chan__dahdi_8c_source.html#l00209">AST_LAW</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="utils_8h_source.html#l00384">ast_pthread_create_background</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="chan__dahdi_8c_source.html#l08907">mwi_thread_data::buf</a>, <a class="el" href="adsistub_8c_source.html#l00059">buf</a>, <a class="el" href="chan__dahdi_8c_source.html#l08911">calc_energy()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="chan__dahdi_8c_source.html#l01050">dahdi_pvt::cidspill</a>, <a class="el" href="chan__dahdi_8c_source.html#l09249">dahdi_destroy_channel_bynum()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00376">dahdi_get_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="chan__dahdi_8c_source.html#l02389">event2str()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01137">dahdi_pvt::fxsoffhookstate</a>, <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03001">has_voicemail()</a>, <a class="el" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>, <a class="el" href="devicestate_8c_source.html#l00198">last</a>, <a class="el" href="chan__dahdi_8c_source.html#l08908">mwi_thread_data::len</a>, <a class="el" href="logger_8h_source.html#l00119">LOG_DEBUG</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__dahdi_8c_source.html#l01129">dahdi_pvt::mailbox</a>, <a class="el" href="chan__dahdi_8c_source.html#l01139">dahdi_pvt::msgstate</a>, <a class="el" href="chan__dahdi_8c_source.html#l09063">mwi_send_init()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09116">mwi_send_process_buffer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09203">mwi_send_process_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l08925">mwi_thread()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00892">dahdi_pvt::mwimonitor_fsk</a>, <a class="el" href="chan__dahdi_8c_source.html#l00900">dahdi_pvt::mwimonitoractive</a>, <a class="el" href="chan__dahdi_8c_source.html#l00902">dahdi_pvt::mwisendactive</a>, <a class="el" href="chan__dahdi_8c_source.html#l00682">dahdi_pvt::next</a>, <a class="el" href="chan__dahdi_8c_source.html#l01135">dahdi_pvt::onhooktime</a>, <a class="el" href="chan__dahdi_8c_source.html#l00608">dahdi_subchannel::owner</a>, <a class="el" href="chan__dahdi_8c_source.html#l00650">dahdi_pvt::owner</a>, <a class="el" href="chan__dahdi_8c_source.html#l08906">mwi_thread_data::pvt</a>, <a class="el" href="chan__dahdi_8c_source.html#l00671">dahdi_pvt::radio</a>, <a class="el" href="chan__dahdi_8c_source.html#l00666">dahdi_pvt::sig</a>, <a class="el" href="chan__dahdi_8c_source.html#l00259">SIG_MFCR2</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l09705">restart_monitor()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09497"></a>09497 {
<a name="l09498"></a>09498    <span class="keywordtype">int</span> count, res, res2, spoint, pollres=0;
<a name="l09499"></a>09499    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *i;
<a name="l09500"></a>09500    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *<a class="code" href="devicestate_8c.html#a43a8def62ee15449794285cbbc0f79af">last</a> = NULL;
<a name="l09501"></a>09501    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *doomed;
<a name="l09502"></a>09502    time_t thispass = 0, lastpass = 0;
<a name="l09503"></a>09503    <span class="keywordtype">int</span> found;
<a name="l09504"></a>09504    <span class="keywordtype">char</span> <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[1024];
<a name="l09505"></a>09505    <span class="keyword">struct </span>pollfd *pfds=NULL;
<a name="l09506"></a>09506    <span class="keywordtype">int</span> lastalloc = -1;
<a name="l09507"></a>09507    <span class="comment">/* This thread monitors all the frame relay interfaces which are not yet in use</span>
<a name="l09508"></a>09508 <span class="comment">      (and thus do not have a separate thread) indefinitely */</span>
<a name="l09509"></a>09509    <span class="comment">/* From here on out, we die whenever asked */</span>
<a name="l09510"></a>09510 <span class="preprocessor">#if 0</span>
<a name="l09511"></a>09511 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (pthread_setcanceltype(PTHREAD_CANCEL_ASYNCHRONOUS, NULL)) {
<a name="l09512"></a>09512       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to set cancel type to asynchronous\n&quot;</span>);
<a name="l09513"></a>09513       <span class="keywordflow">return</span> NULL;
<a name="l09514"></a>09514    }
<a name="l09515"></a>09515    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Monitor starting...\n&quot;</span>);
<a name="l09516"></a>09516 <span class="preprocessor">#endif</span>
<a name="l09517"></a>09517 <span class="preprocessor"></span>   pthread_setcancelstate(PTHREAD_CANCEL_DISABLE, NULL);
<a name="l09518"></a>09518 
<a name="l09519"></a>09519    <span class="keywordflow">for</span> (;;) {
<a name="l09520"></a>09520       <span class="comment">/* Lock the interface list */</span>
<a name="l09521"></a>09521       <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;iflock);
<a name="l09522"></a>09522       <span class="keywordflow">if</span> (!pfds || (lastalloc != <a class="code" href="chan__dahdi_8c.html#af7b23639f050bf4be75e75d2a11cefc9">ifcount</a>)) {
<a name="l09523"></a>09523          <span class="keywordflow">if</span> (pfds) {
<a name="l09524"></a>09524             <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(pfds);
<a name="l09525"></a>09525             pfds = NULL;
<a name="l09526"></a>09526          }
<a name="l09527"></a>09527          <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#af7b23639f050bf4be75e75d2a11cefc9">ifcount</a>) {
<a name="l09528"></a>09528             <span class="keywordflow">if</span> (!(pfds = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <a class="code" href="chan__dahdi_8c.html#af7b23639f050bf4be75e75d2a11cefc9">ifcount</a> * <span class="keyword">sizeof</span>(*pfds)))) {
<a name="l09529"></a>09529                <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;iflock);
<a name="l09530"></a>09530                <span class="keywordflow">return</span> NULL;
<a name="l09531"></a>09531             }
<a name="l09532"></a>09532          }
<a name="l09533"></a>09533          lastalloc = <a class="code" href="chan__dahdi_8c.html#af7b23639f050bf4be75e75d2a11cefc9">ifcount</a>;
<a name="l09534"></a>09534       }
<a name="l09535"></a>09535       <span class="comment">/* Build the stuff we&apos;re going to poll on, that is the socket of every</span>
<a name="l09536"></a>09536 <span class="comment">         dahdi_pvt that does not have an associated owner channel */</span>
<a name="l09537"></a>09537       count = 0;
<a name="l09538"></a>09538       i = <a class="code" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>;
<a name="l09539"></a>09539       <span class="keywordflow">while</span> (i) {
<a name="l09540"></a>09540          <span class="keywordflow">if</span> ((i-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a> &gt; -1) &amp;&amp; i-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> &amp;&amp; (!i-&gt;<a class="code" href="structdahdi__pvt.html#ac53b42243ee40edc74b615fe86806fe3" title="Nonzero if the signaling type is sent over a radio.">radio</a>) &amp;&amp; !(i-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> &amp; <a class="code" href="chan__dahdi_8c.html#a1d73a98ae12601287580dedd9a6d739b">SIG_MFCR2</a>)) {
<a name="l09541"></a>09541             <span class="keywordflow">if</span> (!i-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> &amp;&amp; !i-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> &amp;&amp; !i-&gt;<a class="code" href="structdahdi__pvt.html#a3f5ebedc03e93eee1fa771cfc69bd77b" title="TRUE if an MWI monitor thread is currently active.">mwimonitoractive</a> ) {
<a name="l09542"></a>09542                <span class="comment">/* This needs to be watched, as it lacks an owner */</span>
<a name="l09543"></a>09543                pfds[count].fd = i-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>;
<a name="l09544"></a>09544                pfds[count].events = POLLPRI;
<a name="l09545"></a>09545                pfds[count].revents = 0;
<a name="l09546"></a>09546                <span class="comment">/* If we are monitoring for VMWI or sending CID, we need to</span>
<a name="l09547"></a>09547 <span class="comment">                  read from the channel as well */</span>
<a name="l09548"></a>09548                <span class="keywordflow">if</span> (i-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a> || i-&gt;<a class="code" href="structdahdi__pvt.html#a35892585f7fbbba650b0bf1315d5e8c1" title="TRUE if a MWI message sending thread is active.">mwisendactive</a> || i-&gt;<a class="code" href="structdahdi__pvt.html#aad3e7a9f0fe63779a32719116bf7a77b" title="TRUE if the FXO port monitors for fsk type MWI indications from the other end.">mwimonitor_fsk</a>)
<a name="l09549"></a>09549                   pfds[count].events |= POLLIN;
<a name="l09550"></a>09550                count++;
<a name="l09551"></a>09551             }
<a name="l09552"></a>09552          }
<a name="l09553"></a>09553          i = i-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>;
<a name="l09554"></a>09554       }
<a name="l09555"></a>09555       <span class="comment">/* Okay, now that we know what to do, release the interface lock */</span>
<a name="l09556"></a>09556       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;iflock);
<a name="l09557"></a>09557 
<a name="l09558"></a>09558       pthread_setcancelstate(PTHREAD_CANCEL_ENABLE, NULL);
<a name="l09559"></a>09559       pthread_testcancel();
<a name="l09560"></a>09560       <span class="comment">/* Wait at least a second for something to happen */</span>
<a name="l09561"></a>09561       res = poll(pfds, count, 1000);
<a name="l09562"></a>09562       pthread_testcancel();
<a name="l09563"></a>09563       pthread_setcancelstate(PTHREAD_CANCEL_DISABLE, NULL);
<a name="l09564"></a>09564 
<a name="l09565"></a>09565       <span class="comment">/* Okay, poll has finished.  Let&apos;s see what happened.  */</span>
<a name="l09566"></a>09566       <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l09567"></a>09567          <span class="keywordflow">if</span> ((errno != EAGAIN) &amp;&amp; (errno != EINTR))
<a name="l09568"></a>09568             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;poll return %d: %s\n&quot;</span>, res, strerror(errno));
<a name="l09569"></a>09569          <span class="keywordflow">continue</span>;
<a name="l09570"></a>09570       }
<a name="l09571"></a>09571       <span class="comment">/* Alright, lock the interface list again, and let&apos;s look and see what has</span>
<a name="l09572"></a>09572 <span class="comment">         happened */</span>
<a name="l09573"></a>09573       <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;iflock);
<a name="l09574"></a>09574       found = 0;
<a name="l09575"></a>09575       spoint = 0;
<a name="l09576"></a>09576       lastpass = thispass;
<a name="l09577"></a>09577       thispass = time(NULL);
<a name="l09578"></a>09578       i = <a class="code" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>;
<a name="l09579"></a>09579       doomed = NULL;
<a name="l09580"></a>09580       <span class="keywordflow">for</span> (i = <a class="code" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>;; i = i-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>) {
<a name="l09581"></a>09581          <span class="keywordflow">if</span> (doomed) {
<a name="l09582"></a>09582             <span class="keywordtype">int</span> res;
<a name="l09583"></a>09583             res = <a class="code" href="chan__dahdi_8c.html#aa8761113e1a59e2a550d60cd5a232f71">dahdi_destroy_channel_bynum</a>(doomed-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l09584"></a>09584             <span class="keywordflow">if</span> (!res) {
<a name="l09585"></a>09585                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Couldn&apos;t find channel to destroy, hopefully another destroy operation just happened.\n&quot;</span>);
<a name="l09586"></a>09586             }
<a name="l09587"></a>09587             doomed = NULL;
<a name="l09588"></a>09588          }
<a name="l09589"></a>09589          <span class="keywordflow">if</span> (!i) {
<a name="l09590"></a>09590             <span class="keywordflow">break</span>;
<a name="l09591"></a>09591          }
<a name="l09592"></a>09592 
<a name="l09593"></a>09593          <span class="keywordflow">if</span> (thispass != lastpass) {
<a name="l09594"></a>09594             <span class="keywordflow">if</span> (!found &amp;&amp; ((i == last) || ((i == <a class="code" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>) &amp;&amp; !last))) {
<a name="l09595"></a>09595                last = i;
<a name="l09596"></a>09596                <span class="keywordflow">if</span> (last) {
<a name="l09597"></a>09597                   <span class="comment">/* Only allow MWI to be initiated on a quiescent fxs port */</span>
<a name="l09598"></a>09598                   <span class="keywordflow">if</span> (!last-&gt;<a class="code" href="structdahdi__pvt.html#a35892585f7fbbba650b0bf1315d5e8c1" title="TRUE if a MWI message sending thread is active.">mwisendactive</a> &amp;&amp;   last-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> &amp; __DAHDI_SIG_FXO &amp;&amp;
<a name="l09599"></a>09599                         !last-&gt;<a class="code" href="structdahdi__pvt.html#ab18fd594a2af8725e3ddb868d8499e06" title="TRUE if the FXS port is off-hook.">fxsoffhookstate</a> &amp;&amp; !last-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> &amp;&amp;
<a name="l09600"></a>09600                         !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(last-&gt;<a class="code" href="structdahdi__pvt.html#ac81f44f4f22dee90de5975cf8fa4641b" title="Voice mailbox location.">mailbox</a>) &amp;&amp; (thispass - last-&gt;<a class="code" href="structdahdi__pvt.html#a74643a768dac2465f8612f81ba4ff177" title="Time the interface went on-hook.">onhooktime</a> &gt; 3)) {
<a name="l09601"></a>09601                      res = <a class="code" href="chan__dahdi_8c.html#a8be869dea1576c3f11795532605549dc">has_voicemail</a>(last);
<a name="l09602"></a>09602                      <span class="keywordflow">if</span> (last-&gt;<a class="code" href="structdahdi__pvt.html#a734dc49c409d35148bff4b61e12ad58b" title="-1 = unknown, 0 = no messages, 1 = new messages available">msgstate</a> != res) {
<a name="l09603"></a>09603                         <span class="comment">/* Set driver resources for signalling VMWI */</span>
<a name="l09604"></a>09604                         res2 = ioctl(last-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_VMWI, &amp;res);
<a name="l09605"></a>09605                         <span class="keywordflow">if</span> (res2) {
<a name="l09606"></a>09606                            <span class="comment">/* TODO: This message will ALWAYS be generated on some cards; any way to restrict it to those cards where it is interesting? */</span>
<a name="l09607"></a>09607                            <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(3, <span class="stringliteral">&quot;Unable to control message waiting led on channel %d: %s\n&quot;</span>, last-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, strerror(errno));
<a name="l09608"></a>09608                         }
<a name="l09609"></a>09609                         <span class="comment">/* If enabled for FSK spill then initiate it */</span>
<a name="l09610"></a>09610                         <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#a5b4f0979ef9234fc9878dfa508ccf8ef">mwi_send_init</a>(last)) {
<a name="l09611"></a>09611                            <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to initiate mwi send sequence on channel %d\n&quot;</span>, last-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l09612"></a>09612                         }
<a name="l09613"></a>09613                         last-&gt;<a class="code" href="structdahdi__pvt.html#a734dc49c409d35148bff4b61e12ad58b" title="-1 = unknown, 0 = no messages, 1 = new messages available">msgstate</a> = res;
<a name="l09614"></a>09614                         found ++;
<a name="l09615"></a>09615                      }
<a name="l09616"></a>09616                   }
<a name="l09617"></a>09617                   last = last-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>;
<a name="l09618"></a>09618                }
<a name="l09619"></a>09619             }
<a name="l09620"></a>09620          }
<a name="l09621"></a>09621          <span class="keywordflow">if</span> ((i-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a> &gt; -1) &amp;&amp; i-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a>) {
<a name="l09622"></a>09622             <span class="keywordflow">if</span> (i-&gt;<a class="code" href="structdahdi__pvt.html#ac53b42243ee40edc74b615fe86806fe3" title="Nonzero if the signaling type is sent over a radio.">radio</a> &amp;&amp; !i-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)
<a name="l09623"></a>09623             {
<a name="l09624"></a>09624                res = <a class="code" href="chan__dahdi_8c.html#aad4a9758fbc62380e70cbbcbb31311a4" title="Avoid the silly dahdi_getevent which ignores a bunch of events.">dahdi_get_event</a>(i-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>);
<a name="l09625"></a>09625                <span class="keywordflow">if</span> (res)
<a name="l09626"></a>09626                {
<a name="l09627"></a>09627                   <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Monitor doohicky got event %s on radio channel %d\n&quot;</span>, <a class="code" href="chan__dahdi_8c.html#a92fb0724a6e93f69cec9d6e83cdcc3f3">event2str</a>(res), i-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l09628"></a>09628                   <span class="comment">/* Don&apos;t hold iflock while handling init events */</span>
<a name="l09629"></a>09629                   <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;iflock);
<a name="l09630"></a>09630                   doomed = <a class="code" href="chan__dahdi_8c.html#af0406c3cb1a1b5d39f8604376e52bc22">handle_init_event</a>(i, res);
<a name="l09631"></a>09631                   <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;iflock);
<a name="l09632"></a>09632                }
<a name="l09633"></a>09633                <span class="keywordflow">continue</span>;
<a name="l09634"></a>09634             }
<a name="l09635"></a>09635             pollres = <a class="code" href="channel_8h.html#a063bc78be44f44ee5027c00ca69b140e" title="Helper function for migrating select to poll.">ast_fdisset</a>(pfds, i-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, count, &amp;spoint);
<a name="l09636"></a>09636             <span class="keywordflow">if</span> (pollres &amp; POLLIN) {
<a name="l09637"></a>09637                <span class="keywordflow">if</span> (i-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> || i-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l09638"></a>09638 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l09639"></a>09639 <span class="preprocessor"></span>                  <span class="keywordflow">if</span> (!i-&gt;pri)
<a name="l09640"></a>09640 <span class="preprocessor">#endif</span>
<a name="l09641"></a>09641 <span class="preprocessor"></span>                     <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Whoa....  I&apos;m owned but found (%d) in read...\n&quot;</span>, i-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>);
<a name="l09642"></a>09642                   <span class="keywordflow">continue</span>;
<a name="l09643"></a>09643                }
<a name="l09644"></a>09644                <span class="keywordflow">if</span> (!i-&gt;<a class="code" href="structdahdi__pvt.html#aad3e7a9f0fe63779a32719116bf7a77b" title="TRUE if the FXO port monitors for fsk type MWI indications from the other end.">mwimonitor_fsk</a> &amp;&amp; !i-&gt;<a class="code" href="structdahdi__pvt.html#a35892585f7fbbba650b0bf1315d5e8c1" title="TRUE if a MWI message sending thread is active.">mwisendactive</a>) {
<a name="l09645"></a>09645                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Whoa....  I&apos;m not looking for MWI or sending MWI but am reading (%d)...\n&quot;</span>, i-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>);
<a name="l09646"></a>09646                   <span class="keywordflow">continue</span>;
<a name="l09647"></a>09647                }
<a name="l09648"></a>09648                res = read(i-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, buf, <span class="keyword">sizeof</span>(buf));
<a name="l09649"></a>09649                <span class="keywordflow">if</span> (res &gt; 0) {
<a name="l09650"></a>09650                   <span class="keywordflow">if</span> (i-&gt;<a class="code" href="structdahdi__pvt.html#aad3e7a9f0fe63779a32719116bf7a77b" title="TRUE if the FXO port monitors for fsk type MWI indications from the other end.">mwimonitor_fsk</a>) {
<a name="l09651"></a>09651                      <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#a6fe88ac2d409718d8b1a788ad2930a24">calc_energy</a>((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) buf, res, <a class="code" href="chan__dahdi_8c.html#a830b5fdb3ba653640d3f5044192d82bf">AST_LAW</a>(i)) &gt; <a class="code" href="chan__dahdi_8c.html#a94ca20b7d80fbc4e7d2b1ea50e937243">mwilevel</a>) {
<a name="l09652"></a>09652                         pthread_attr_t attr;
<a name="l09653"></a>09653                         pthread_t threadid;
<a name="l09654"></a>09654                         <span class="keyword">struct </span><a class="code" href="structmwi__thread__data.html">mwi_thread_data</a> *mtd;
<a name="l09655"></a>09655 
<a name="l09656"></a>09656                         pthread_attr_init(&amp;attr);
<a name="l09657"></a>09657                         pthread_attr_setdetachstate(&amp;attr, PTHREAD_CREATE_DETACHED);
<a name="l09658"></a>09658 
<a name="l09659"></a>09659                         <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;Maybe some MWI on port %d!\n&quot;</span>, i-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l09660"></a>09660                         <span class="keywordflow">if</span> ((mtd = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*mtd)))) {
<a name="l09661"></a>09661                            mtd-&gt;<a class="code" href="structmwi__thread__data.html#a96fcebe4e3d09a6aefc4a12522e07bd7">pvt</a> = i;
<a name="l09662"></a>09662                            memcpy(mtd-&gt;<a class="code" href="structmwi__thread__data.html#acc88ecad1777325d4b41329a853998ec">buf</a>, buf, res);
<a name="l09663"></a>09663                            mtd-&gt;<a class="code" href="structmwi__thread__data.html#a7360b55975153b822efc5217b7734e6a">len</a> = res;
<a name="l09664"></a>09664                            <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a595e2f8aa398f4bd21e381c3211235fe">ast_pthread_create_background</a>(&amp;threadid, &amp;attr, <a class="code" href="chan__dahdi_8c.html#a4c430057a548b7c6ec462ac238b58d6c">mwi_thread</a>, mtd)) {
<a name="l09665"></a>09665                               <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to start mwi thread on channel %d\n&quot;</span>, i-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l09666"></a>09666                               <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(mtd);
<a name="l09667"></a>09667                            }
<a name="l09668"></a>09668                            i-&gt;<a class="code" href="structdahdi__pvt.html#a3f5ebedc03e93eee1fa771cfc69bd77b" title="TRUE if an MWI monitor thread is currently active.">mwimonitoractive</a> = 1;
<a name="l09669"></a>09669                         }
<a name="l09670"></a>09670                      }
<a name="l09671"></a>09671                   }
<a name="l09672"></a>09672                   <span class="keywordflow">if</span> (i-&gt;<a class="code" href="structdahdi__pvt.html#a35892585f7fbbba650b0bf1315d5e8c1" title="TRUE if a MWI message sending thread is active.">mwisendactive</a>) {
<a name="l09673"></a>09673                      <a class="code" href="chan__dahdi_8c.html#ab7d3473f01f0d6142712aec7bb8ff323">mwi_send_process_buffer</a>(i, res);
<a name="l09674"></a>09674                   }
<a name="l09675"></a>09675                } <span class="keywordflow">else</span> {
<a name="l09676"></a>09676                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Read failed with %d: %s\n&quot;</span>, res, strerror(errno));
<a name="l09677"></a>09677                }
<a name="l09678"></a>09678             }
<a name="l09679"></a>09679             <span class="keywordflow">if</span> (pollres &amp; POLLPRI) {
<a name="l09680"></a>09680                <span class="keywordflow">if</span> (i-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> || i-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l09681"></a>09681 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l09682"></a>09682 <span class="preprocessor"></span>                  <span class="keywordflow">if</span> (!i-&gt;pri)
<a name="l09683"></a>09683 <span class="preprocessor">#endif</span>
<a name="l09684"></a>09684 <span class="preprocessor"></span>                     <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Whoa....  I&apos;m owned but found (%d)...\n&quot;</span>, i-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>);
<a name="l09685"></a>09685                   <span class="keywordflow">continue</span>;
<a name="l09686"></a>09686                }
<a name="l09687"></a>09687                res = <a class="code" href="chan__dahdi_8c.html#aad4a9758fbc62380e70cbbcbb31311a4" title="Avoid the silly dahdi_getevent which ignores a bunch of events.">dahdi_get_event</a>(i-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>);
<a name="l09688"></a>09688                <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Monitor doohicky got event %s on channel %d\n&quot;</span>, <a class="code" href="chan__dahdi_8c.html#a92fb0724a6e93f69cec9d6e83cdcc3f3">event2str</a>(res), i-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l09689"></a>09689                <span class="comment">/* Don&apos;t hold iflock while handling init events */</span>
<a name="l09690"></a>09690                <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;iflock);
<a name="l09691"></a>09691                <span class="keywordflow">if</span> (0 == i-&gt;<a class="code" href="structdahdi__pvt.html#a35892585f7fbbba650b0bf1315d5e8c1" title="TRUE if a MWI message sending thread is active.">mwisendactive</a> || 0 == <a class="code" href="chan__dahdi_8c.html#ae8e5e4322c88dc92c793d37ad86a1fe1">mwi_send_process_event</a>(i, res)) {
<a name="l09692"></a>09692                   doomed = <a class="code" href="chan__dahdi_8c.html#af0406c3cb1a1b5d39f8604376e52bc22">handle_init_event</a>(i, res);
<a name="l09693"></a>09693                }
<a name="l09694"></a>09694                <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;iflock);
<a name="l09695"></a>09695             }
<a name="l09696"></a>09696          }
<a name="l09697"></a>09697       }
<a name="l09698"></a>09698       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;iflock);
<a name="l09699"></a>09699    }
<a name="l09700"></a>09700    <span class="comment">/* Never reached */</span>
<a name="l09701"></a>09701    <span class="keywordflow">return</span> NULL;
<a name="l09702"></a>09702 
<a name="l09703"></a>09703 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="acbe36083a9c130b81506d874635f8ff9"></a><!-- doxytag: member="chan_dahdi.c::duplicate_pseudo" ref="acbe36083a9c130b81506d874635f8ff9" args="(struct dahdi_pvt *src)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a>* duplicate_pseudo </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>src</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l10771">10771</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="astmm_8h_source.html#l00081">ast_malloc</a>, <a class="el" href="lock_8h_source.html#l01692">ast_mutex_init()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00662">dahdi_pvt::buf_no</a>, <a class="el" href="chan__dahdi_8c_source.html#l00663">dahdi_pvt::buf_policy</a>, <a class="el" href="chan__dahdi_8c_source.html#l02090">dahdi_open()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00740">dahdi_pvt::destroy</a>, <a class="el" href="chan__dahdi_8c_source.html#l03856">destroy_dahdi_pvt()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>, <a class="el" href="chan__dahdi_8c_source.html#l00649">dahdi_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__dahdi_8c_source.html#l00682">dahdi_pvt::next</a>, <a class="el" href="chan__dahdi_8c_source.html#l00683">dahdi_pvt::prev</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l10834">dahdi_request()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l10772"></a>10772 {
<a name="l10773"></a>10773    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *p;
<a name="l10774"></a>10774    <span class="keyword">struct </span>dahdi_bufferinfo bi;
<a name="l10775"></a>10775    <span class="keywordtype">int</span> res;
<a name="l10776"></a>10776 
<a name="l10777"></a>10777    <span class="keywordflow">if</span> ((p = <a class="code" href="astmm_8h.html#a64a0e7a3ab511a3777ac56f5d43c628e">ast_malloc</a>(<span class="keyword">sizeof</span>(*p)))) {
<a name="l10778"></a>10778       memcpy(p, src, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structdahdi__pvt.html">dahdi_pvt</a>));
<a name="l10779"></a>10779       <a class="code" href="lock_8h.html#a5dc895fe6e8c089175159fc22e33fc3b">ast_mutex_init</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l10780"></a>10780       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a> = <a class="code" href="chan__dahdi_8c.html#a5be3d201f917ed02d9a08749cd673191">dahdi_open</a>(<span class="stringliteral">&quot;/dev/dahdi/pseudo&quot;</span>);
<a name="l10781"></a>10781       <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a> &lt; 0) {
<a name="l10782"></a>10782          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to dup channel: %s\n&quot;</span>, strerror(errno));
<a name="l10783"></a>10783          <a class="code" href="chan__dahdi_8c.html#a9db88392ac10cee3a3116d1f7f4aae5f">destroy_dahdi_pvt</a>(&amp;p);
<a name="l10784"></a>10784          <span class="keywordflow">return</span> NULL;
<a name="l10785"></a>10785       }
<a name="l10786"></a>10786       res = ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_GET_BUFINFO, &amp;bi);
<a name="l10787"></a>10787       <span class="keywordflow">if</span> (!res) {
<a name="l10788"></a>10788          bi.txbufpolicy = src-&gt;<a class="code" href="structdahdi__pvt.html#abfc3801c54ad9e430f5cdf383450a052">buf_policy</a>;
<a name="l10789"></a>10789          bi.rxbufpolicy = src-&gt;<a class="code" href="structdahdi__pvt.html#abfc3801c54ad9e430f5cdf383450a052">buf_policy</a>;
<a name="l10790"></a>10790          bi.numbufs = src-&gt;<a class="code" href="structdahdi__pvt.html#adb74dc4af40df4615bb5f05846cefc9d">buf_no</a>;
<a name="l10791"></a>10791          res = ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_SET_BUFINFO, &amp;bi);
<a name="l10792"></a>10792          <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l10793"></a>10793             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to set buffer policy on dup channel: %s\n&quot;</span>, strerror(errno));
<a name="l10794"></a>10794          }
<a name="l10795"></a>10795       } <span class="keywordflow">else</span>
<a name="l10796"></a>10796          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to check buffer policy on dup channel: %s\n&quot;</span>, strerror(errno));
<a name="l10797"></a>10797    }
<a name="l10798"></a>10798    p-&gt;<a class="code" href="structdahdi__pvt.html#ab16498ae4f96c29649dd52ac032e811d" title="TRUE if the channel is to be destroyed on hangup. (Used by pseudo channels.).">destroy</a> = 1;
<a name="l10799"></a>10799    p-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a> = <a class="code" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>;
<a name="l10800"></a>10800    p-&gt;<a class="code" href="structdahdi__pvt.html#abba5e5e1dcf19b4ded5000d926e0a70d">prev</a> = NULL;
<a name="l10801"></a>10801    <a class="code" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a> = p;
<a name="l10802"></a>10802    <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>)
<a name="l10803"></a>10803       <a class="code" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>-&gt;<a class="code" href="structdahdi__pvt.html#abba5e5e1dcf19b4ded5000d926e0a70d">prev</a> = p;
<a name="l10804"></a>10804    <span class="keywordflow">return</span> p;
<a name="l10805"></a>10805 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0baab1d1f0651b64e22d0a095c2027a9"></a><!-- doxytag: member="chan_dahdi.c::enable_dtmf_detect" ref="a0baab1d1f0651b64e22d0a095c2027a9" args="(struct dahdi_pvt *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void enable_dtmf_detect </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l05138">5138</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="dsp_8c_source.html#l01540">ast_dsp_set_features()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00277">CHAN_PSEUDO</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="chan__dahdi_8c_source.html#l01113">dahdi_pvt::dsp</a>, <a class="el" href="dsp_8h_source.html#l00028">DSP_FEATURE_DIGIT_DETECT</a>, <a class="el" href="chan__dahdi_8c_source.html#l01179">dahdi_pvt::dsp_features</a>, <a class="el" href="chan__dahdi_8c_source.html#l00774">dahdi_pvt::hardwaredtmf</a>, <a class="el" href="chan__dahdi_8c_source.html#l00789">dahdi_pvt::ignoredtmf</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l05156">dahdi_bridge()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05139"></a>05139 {
<a name="l05140"></a>05140    <span class="keywordtype">int</span> <a class="code" href="structval.html">val</a>;
<a name="l05141"></a>05141 
<a name="l05142"></a>05142    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a> == <a class="code" href="chan__dahdi_8c.html#ada02a3fa3d2da06560df664c7228a559">CHAN_PSEUDO</a>)
<a name="l05143"></a>05143       <span class="keywordflow">return</span>;
<a name="l05144"></a>05144 
<a name="l05145"></a>05145    p-&gt;<a class="code" href="structdahdi__pvt.html#a1caa9d0f8fb61da132fe2a1aa69d1973" title="TRUE if DTMF detection is disabled.">ignoredtmf</a> = 0;
<a name="l05146"></a>05146 
<a name="l05147"></a>05147    val = DAHDI_TONEDETECT_ON | DAHDI_TONEDETECT_MUTE;
<a name="l05148"></a>05148    ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONEDETECT, &amp;val);
<a name="l05149"></a>05149 
<a name="l05150"></a>05150    <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="structdahdi__pvt.html#acb50d09ad188475206ff2f852afb6831" title="TRUE if DTMF detection needs to be done by hardware.">hardwaredtmf</a> &amp;&amp; p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>) {
<a name="l05151"></a>05151       p-&gt;<a class="code" href="structdahdi__pvt.html#a746e641282b3f1665a817252c8e4145e" title="DSP feature flags: DSP_FEATURE_xxx.">dsp_features</a> |= <a class="code" href="dsp_8h.html#a84818b360426bdd5f588cdca463e15be">DSP_FEATURE_DIGIT_DETECT</a>;
<a name="l05152"></a>05152       <a class="code" href="dsp_8h.html#aedc7fa20fba91e3c018f6989e95c714b" title="Select feature set.">ast_dsp_set_features</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#a746e641282b3f1665a817252c8e4145e" title="DSP feature flags: DSP_FEATURE_xxx.">dsp_features</a>);
<a name="l05153"></a>05153    }
<a name="l05154"></a>05154 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a92fb0724a6e93f69cec9d6e83cdcc3f3"></a><!-- doxytag: member="chan_dahdi.c::event2str" ref="a92fb0724a6e93f69cec9d6e83cdcc3f3" args="(int event)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* event2str </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>event</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l02389">2389</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, and <a class="el" href="adsistub_8c_source.html#l00059">buf</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l06601">__dahdi_exception()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09496">do_monitor()</a>, <a class="el" href="chan__dahdi_8c_source.html#l08925">mwi_thread()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02390"></a>02390 {
<a name="l02391"></a>02391    <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[256];
<a name="l02392"></a>02392    <span class="keywordflow">if</span> ((event &lt; (<a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="chan__dahdi_8c.html#aff2cd0cadc675280f2ee4b7c45bb9944">events</a>))) &amp;&amp; (event &gt; -1))
<a name="l02393"></a>02393       <span class="keywordflow">return</span> <a class="code" href="chan__dahdi_8c.html#aff2cd0cadc675280f2ee4b7c45bb9944">events</a>[event];
<a name="l02394"></a>02394    sprintf(buf, <span class="stringliteral">&quot;Event %d&quot;</span>, event); <span class="comment">/* safe */</span>
<a name="l02395"></a>02395    <span class="keywordflow">return</span> buf;
<a name="l02396"></a>02396 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a186539eb5b78bd0849d09b4543ff47ef"></a><!-- doxytag: member="chan_dahdi.c::fill_rxgain" ref="a186539eb5b78bd0849d09b4543ff47ef" args="(struct dahdi_gains *g, float gain, int law)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void fill_rxgain </td>
          <td>(</td>
          <td class="paramtype">struct dahdi_gains *&nbsp;</td>
          <td class="paramname"> <em>g</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>gain</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>law</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l02761">2761</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="alaw_8h_source.html#l00084">AST_ALAW</a>, <a class="el" href="alaw_8h_source.html#l00050">AST_LIN2A</a>, <a class="el" href="ulaw_8h_source.html#l00049">AST_LIN2MU</a>, and <a class="el" href="ulaw_8h_source.html#l00085">AST_MULAW</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l02813">set_actual_rxgain()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02762"></a>02762 {
<a name="l02763"></a>02763    <span class="keywordtype">int</span> j;
<a name="l02764"></a>02764    <span class="keywordtype">int</span> k;
<a name="l02765"></a>02765    <span class="keywordtype">float</span> linear_gain = pow(10.0, gain / 20.0);
<a name="l02766"></a>02766 
<a name="l02767"></a>02767    <span class="keywordflow">switch</span> (law) {
<a name="l02768"></a>02768    <span class="keywordflow">case</span> DAHDI_LAW_ALAW:
<a name="l02769"></a>02769       <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(g-&gt;rxgain); j++) {
<a name="l02770"></a>02770          <span class="keywordflow">if</span> (gain) {
<a name="l02771"></a>02771             k = (int) (((<span class="keywordtype">float</span>) <a class="code" href="alaw_8h.html#a85173bf923da21593f2db8132a70d4b0">AST_ALAW</a>(j)) * linear_gain);
<a name="l02772"></a>02772             <span class="keywordflow">if</span> (k &gt; 32767) k = 32767;
<a name="l02773"></a>02773             <span class="keywordflow">if</span> (k &lt; -32767) k = -32767;
<a name="l02774"></a>02774             g-&gt;rxgain[j] = <a class="code" href="alaw_8h.html#a45b65da856bb05f79d22425d41457e0f">AST_LIN2A</a>(k);
<a name="l02775"></a>02775          } <span class="keywordflow">else</span> {
<a name="l02776"></a>02776             g-&gt;rxgain[j] = j;
<a name="l02777"></a>02777          }
<a name="l02778"></a>02778       }
<a name="l02779"></a>02779       <span class="keywordflow">break</span>;
<a name="l02780"></a>02780    <span class="keywordflow">case</span> DAHDI_LAW_MULAW:
<a name="l02781"></a>02781       <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(g-&gt;rxgain); j++) {
<a name="l02782"></a>02782          <span class="keywordflow">if</span> (gain) {
<a name="l02783"></a>02783             k = (int) (((<span class="keywordtype">float</span>) <a class="code" href="ulaw_8h.html#a00ac194f4317c7c388bfe531f51c803a">AST_MULAW</a>(j)) * linear_gain);
<a name="l02784"></a>02784             <span class="keywordflow">if</span> (k &gt; 32767) k = 32767;
<a name="l02785"></a>02785             <span class="keywordflow">if</span> (k &lt; -32767) k = -32767;
<a name="l02786"></a>02786             g-&gt;rxgain[j] = <a class="code" href="ulaw_8h.html#a8e5e288eb1167065a9a235f79dcfee89">AST_LIN2MU</a>(k);
<a name="l02787"></a>02787          } <span class="keywordflow">else</span> {
<a name="l02788"></a>02788             g-&gt;rxgain[j] = j;
<a name="l02789"></a>02789          }
<a name="l02790"></a>02790       }
<a name="l02791"></a>02791       <span class="keywordflow">break</span>;
<a name="l02792"></a>02792    }
<a name="l02793"></a>02793 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6fac5af64b9b77c5d2c485bd3b70ea4d"></a><!-- doxytag: member="chan_dahdi.c::fill_txgain" ref="a6fac5af64b9b77c5d2c485bd3b70ea4d" args="(struct dahdi_gains *g, float gain, int law)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void fill_txgain </td>
          <td>(</td>
          <td class="paramtype">struct dahdi_gains *&nbsp;</td>
          <td class="paramname"> <em>g</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>gain</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>law</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l02727">2727</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="alaw_8h_source.html#l00084">AST_ALAW</a>, <a class="el" href="alaw_8h_source.html#l00050">AST_LIN2A</a>, <a class="el" href="ulaw_8h_source.html#l00049">AST_LIN2MU</a>, and <a class="el" href="ulaw_8h_source.html#l00085">AST_MULAW</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l02795">set_actual_txgain()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02728"></a>02728 {
<a name="l02729"></a>02729    <span class="keywordtype">int</span> j;
<a name="l02730"></a>02730    <span class="keywordtype">int</span> k;
<a name="l02731"></a>02731    <span class="keywordtype">float</span> linear_gain = pow(10.0, gain / 20.0);
<a name="l02732"></a>02732 
<a name="l02733"></a>02733    <span class="keywordflow">switch</span> (law) {
<a name="l02734"></a>02734    <span class="keywordflow">case</span> DAHDI_LAW_ALAW:
<a name="l02735"></a>02735       <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(g-&gt;txgain); j++) {
<a name="l02736"></a>02736          <span class="keywordflow">if</span> (gain) {
<a name="l02737"></a>02737             k = (int) (((<span class="keywordtype">float</span>) <a class="code" href="alaw_8h.html#a85173bf923da21593f2db8132a70d4b0">AST_ALAW</a>(j)) * linear_gain);
<a name="l02738"></a>02738             <span class="keywordflow">if</span> (k &gt; 32767) k = 32767;
<a name="l02739"></a>02739             <span class="keywordflow">if</span> (k &lt; -32767) k = -32767;
<a name="l02740"></a>02740             g-&gt;txgain[j] = <a class="code" href="alaw_8h.html#a45b65da856bb05f79d22425d41457e0f">AST_LIN2A</a>(k);
<a name="l02741"></a>02741          } <span class="keywordflow">else</span> {
<a name="l02742"></a>02742             g-&gt;txgain[j] = j;
<a name="l02743"></a>02743          }
<a name="l02744"></a>02744       }
<a name="l02745"></a>02745       <span class="keywordflow">break</span>;
<a name="l02746"></a>02746    <span class="keywordflow">case</span> DAHDI_LAW_MULAW:
<a name="l02747"></a>02747       <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(g-&gt;txgain); j++) {
<a name="l02748"></a>02748          <span class="keywordflow">if</span> (gain) {
<a name="l02749"></a>02749             k = (int) (((<span class="keywordtype">float</span>) <a class="code" href="ulaw_8h.html#a00ac194f4317c7c388bfe531f51c803a">AST_MULAW</a>(j)) * linear_gain);
<a name="l02750"></a>02750             <span class="keywordflow">if</span> (k &gt; 32767) k = 32767;
<a name="l02751"></a>02751             <span class="keywordflow">if</span> (k &lt; -32767) k = -32767;
<a name="l02752"></a>02752             g-&gt;txgain[j] = <a class="code" href="ulaw_8h.html#a8e5e288eb1167065a9a235f79dcfee89">AST_LIN2MU</a>(k);
<a name="l02753"></a>02753          } <span class="keywordflow">else</span> {
<a name="l02754"></a>02754             g-&gt;txgain[j] = j;
<a name="l02755"></a>02755          }
<a name="l02756"></a>02756       }
<a name="l02757"></a>02757       <span class="keywordflow">break</span>;
<a name="l02758"></a>02758    }
<a name="l02759"></a>02759 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a79906e057879b97581f8dbcede7ff036"></a><!-- doxytag: member="chan_dahdi.c::find_channel" ref="a79906e057879b97581f8dbcede7ff036" args="(int channel)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a>* find_channel </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>channel</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l15201">15201</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00682">dahdi_pvt::next</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l15289">action_dahdidialoffhook()</a>, <a class="el" href="chan__dahdi_8c_source.html#l15232">action_dahdidndoff()</a>, <a class="el" href="chan__dahdi_8c_source.html#l15213">action_dahdidndon()</a>, <a class="el" href="chan__dahdi_8c_source.html#l15251">action_transfer()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l15270">action_transferhangup()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l15202"></a>15202 {
<a name="l15203"></a>15203    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *p = <a class="code" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>;
<a name="l15204"></a>15204    <span class="keywordflow">while</span> (p) {
<a name="l15205"></a>15205       <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a> == <a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>) {
<a name="l15206"></a>15206          <span class="keywordflow">break</span>;
<a name="l15207"></a>15207       }
<a name="l15208"></a>15208       p = p-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>;
<a name="l15209"></a>15209    }
<a name="l15210"></a>15210    <span class="keywordflow">return</span> p;
<a name="l15211"></a>15211 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ace00362fe9640b8a792c965572a87826"></a><!-- doxytag: member="chan_dahdi.c::get_alarms" ref="ace00362fe9640b8a792c965572a87826" args="(struct dahdi_pvt *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int get_alarms </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Checks channel for alarms </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>p</em>&nbsp;</td><td>a channel to check for alarms. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>the alarms on the span to which the channel belongs, or alarms on the channel if no span alarms. </dd></dl>

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l05580">5580</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__dahdi_8c_source.html#l01042">dahdi_pvt::span</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l15321">action_dahdishowchannels()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l08925">mwi_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05581"></a>05581 {
<a name="l05582"></a>05582    <span class="keywordtype">int</span> res;
<a name="l05583"></a>05583    <span class="keyword">struct </span>dahdi_spaninfo zi;
<a name="l05584"></a>05584    <span class="keyword">struct </span>dahdi_params params;
<a name="l05585"></a>05585 
<a name="l05586"></a>05586    memset(&amp;zi, 0, <span class="keyword">sizeof</span>(zi));
<a name="l05587"></a>05587    zi.spanno = p-&gt;<a class="code" href="structdahdi__pvt.html#a63fc22149930803b4e3fb4c453177e5e">span</a>;
<a name="l05588"></a>05588 
<a name="l05589"></a>05589    <span class="keywordflow">if</span> ((res = ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_SPANSTAT, &amp;zi)) &gt;= 0) {
<a name="l05590"></a>05590       <span class="keywordflow">if</span> (zi.alarms != DAHDI_ALARM_NONE)
<a name="l05591"></a>05591          <span class="keywordflow">return</span> zi.alarms;
<a name="l05592"></a>05592    } <span class="keywordflow">else</span> {
<a name="l05593"></a>05593       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to determine alarm on channel %d: %s\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, strerror(errno));
<a name="l05594"></a>05594       <span class="keywordflow">return</span> 0;
<a name="l05595"></a>05595    }
<a name="l05596"></a>05596 
<a name="l05597"></a>05597    <span class="comment">/* No alarms on the span. Check for channel alarms. */</span>
<a name="l05598"></a>05598    memset(&amp;params, 0, <span class="keyword">sizeof</span>(params));
<a name="l05599"></a>05599    <span class="keywordflow">if</span> ((res = ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_GET_PARAMS, &amp;params)) &gt;= 0)
<a name="l05600"></a>05600       <span class="keywordflow">return</span> params.chan_alarms;
<a name="l05601"></a>05601 
<a name="l05602"></a>05602    <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to determine alarm on channel %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l05603"></a>05603 
<a name="l05604"></a>05604    <span class="keywordflow">return</span> DAHDI_ALARM_NONE;
<a name="l05605"></a>05605 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa8e0b028321154a280cad06d20099330"></a><!-- doxytag: member="chan_dahdi.c::handle_alarms" ref="aa8e0b028321154a280cad06d20099330" args="(struct dahdi_pvt *p, int alms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void handle_alarms </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>alms</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l05688">5688</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="chan__dahdi_8c_source.html#l02379">alarm2str()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="manager_8h_source.html#l00061">EVENT_FLAG_SYSTEM</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, and <a class="el" href="manager_8h_source.html#l00181">manager_event</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l08925">mwi_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05689"></a>05689 {
<a name="l05690"></a>05690    <span class="keyword">const</span> <span class="keywordtype">char</span> *alarm_str = <a class="code" href="chan__dahdi_8c.html#a0277190f0a3d01afa3bab8e7bcd47892">alarm2str</a>(alms);
<a name="l05691"></a>05691 
<a name="l05692"></a>05692    <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Detected alarm on channel %d: %s\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, alarm_str);
<a name="l05693"></a>05693    <a class="code" href="manager_8h.html#a1ef0ee0044dbbeb4c3a5abc6c046b208" title="External routines may send asterisk manager events this way.">manager_event</a>(<a class="code" href="manager_8h.html#a420f0f755e1c3378b45ca7f6f0669ffa">EVENT_FLAG_SYSTEM</a>, <span class="stringliteral">&quot;Alarm&quot;</span>,
<a name="l05694"></a>05694       <span class="stringliteral">&quot;Alarm: %s\r\n&quot;</span>
<a name="l05695"></a>05695       <span class="stringliteral">&quot;Channel: %d\r\n&quot;</span>,
<a name="l05696"></a>05696       alarm_str, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l05697"></a>05697 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a67bb67148b7e75b16ad023bd133daac5"></a><!-- doxytag: member="chan_dahdi.c::handle_dahdi_show_cadences" ref="a67bb67148b7e75b16ad023bd133daac5" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* handle_dahdi_show_cadences </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l14817">14817</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="term_8h_source.html#l00047">COLOR_BLACK</a>, <a class="el" href="term_8h_source.html#l00051">COLOR_GREEN</a>, <a class="el" href="term_8h_source.html#l00057">COLOR_MAGENTA</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, <a class="el" href="term_8c_source.html#l00168">term_color()</a>, and <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l14818"></a>14818 {
<a name="l14819"></a>14819    <span class="keywordtype">int</span> i, j;
<a name="l14820"></a>14820    <span class="keywordflow">switch</span> (cmd) {
<a name="l14821"></a>14821    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l14822"></a>14822       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;dahdi show cadences&quot;</span>;
<a name="l14823"></a>14823       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l14824"></a>14824          <span class="stringliteral">&quot;Usage: dahdi show cadences\n&quot;</span>
<a name="l14825"></a>14825          <span class="stringliteral">&quot;       Shows all cadences currently defined\n&quot;</span>;
<a name="l14826"></a>14826       <span class="keywordflow">return</span> NULL;
<a name="l14827"></a>14827    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l14828"></a>14828       <span class="keywordflow">return</span> NULL;
<a name="l14829"></a>14829    }
<a name="l14830"></a>14830    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="chan__dahdi_8c.html#ad53fcc6c04d1c32732efa069a128136b">num_cadence</a>; i++) {
<a name="l14831"></a>14831       <span class="keywordtype">char</span> output[1024];
<a name="l14832"></a>14832       <span class="keywordtype">char</span> tmp[16], tmp2[64];
<a name="l14833"></a>14833       snprintf(tmp, <span class="keyword">sizeof</span>(tmp), <span class="stringliteral">&quot;r%d: &quot;</span>, i + 1);
<a name="l14834"></a>14834       <a class="code" href="term_8h.html#a7b6c72116c334f40bf7c1e50e793c93b">term_color</a>(output, tmp, <a class="code" href="term_8h.html#afc9149f5de51bd9ac4f5ebbfa153f018">COLOR_GREEN</a>, <a class="code" href="term_8h.html#aba2a7fe77a7501e5844370eec0185207">COLOR_BLACK</a>, <span class="keyword">sizeof</span>(output));
<a name="l14835"></a>14835 
<a name="l14836"></a>14836       <span class="keywordflow">for</span> (j = 0; j &lt; 16; j++) {
<a name="l14837"></a>14837          <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#ad07d646abd9d3f187412ff33dc665aee">cadences</a>[i].ringcadence[j] == 0)
<a name="l14838"></a>14838             <span class="keywordflow">break</span>;
<a name="l14839"></a>14839          snprintf(tmp, <span class="keyword">sizeof</span>(tmp), <span class="stringliteral">&quot;%d&quot;</span>, <a class="code" href="chan__dahdi_8c.html#ad07d646abd9d3f187412ff33dc665aee">cadences</a>[i].ringcadence[j]);
<a name="l14840"></a>14840          <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#a441c14817877dfc3ae49ff3aa2907400" title="cidrings says in which pause to transmit the cid information, where the first pause...">cidrings</a>[i] * 2 - 1 == j)
<a name="l14841"></a>14841             <a class="code" href="term_8h.html#a7b6c72116c334f40bf7c1e50e793c93b">term_color</a>(tmp2, tmp, <a class="code" href="term_8h.html#a8deb0beccea721b35bdb1b4f7264fe75">COLOR_MAGENTA</a>, <a class="code" href="term_8h.html#aba2a7fe77a7501e5844370eec0185207">COLOR_BLACK</a>, <span class="keyword">sizeof</span>(tmp2) - 1);
<a name="l14842"></a>14842          <span class="keywordflow">else</span>
<a name="l14843"></a>14843             <a class="code" href="term_8h.html#a7b6c72116c334f40bf7c1e50e793c93b">term_color</a>(tmp2, tmp, <a class="code" href="term_8h.html#afc9149f5de51bd9ac4f5ebbfa153f018">COLOR_GREEN</a>, <a class="code" href="term_8h.html#aba2a7fe77a7501e5844370eec0185207">COLOR_BLACK</a>, <span class="keyword">sizeof</span>(tmp2) - 1);
<a name="l14844"></a>14844          <span class="keywordflow">if</span> (j != 0)
<a name="l14845"></a>14845             strncat(output, <span class="stringliteral">&quot;,&quot;</span>, <span class="keyword">sizeof</span>(output) - strlen(output) - 1);
<a name="l14846"></a>14846          strncat(output, tmp2, <span class="keyword">sizeof</span>(output) - strlen(output) - 1);
<a name="l14847"></a>14847       }
<a name="l14848"></a>14848       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>,<span class="stringliteral">&quot;%s\n&quot;</span>,output);
<a name="l14849"></a>14849    }
<a name="l14850"></a>14850    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l14851"></a>14851 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af0406c3cb1a1b5d39f8604376e52bc22"></a><!-- doxytag: member="chan_dahdi.c::handle_init_event" ref="af0406c3cb1a1b5d39f8604376e52bc22" args="(struct dahdi_pvt *i, int event)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> * handle_init_event </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>event</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l09269">9269</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="channel_8c_source.html#l01690">ast_hangup()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="utils_8h_source.html#l00380">ast_pthread_create_detached</a>, <a class="el" href="channel_8h_source.html#l00368">AST_STATE_PRERING</a>, <a class="el" href="channel_8h_source.html#l00360">AST_STATE_RESERVED</a>, <a class="el" href="channel_8h_source.html#l00363">AST_STATE_RING</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="chan__dahdi_8c_source.html#l01045">dahdi_pvt::cid_start</a>, <a class="el" href="callerid_8h_source.html#l00064">CID_START_POLARITY</a>, <a class="el" href="callerid_8h_source.html#l00065">CID_START_POLARITY_IN</a>, <a class="el" href="chan__dahdi_8c_source.html#l01050">dahdi_pvt::cidspill</a>, <a class="el" href="chan__dahdi_8c_source.html#l02709">dahdi_disable_ec()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02660">dahdi_enable_ec()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07417">dahdi_new()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02863">dahdi_set_hook()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="manager_8h_source.html#l00061">EVENT_FLAG_SYSTEM</a>, <a class="el" href="chan__dahdi_8c_source.html#l01137">dahdi_pvt::fxsoffhookstate</a>, <a class="el" href="chan__dahdi_8c_source.html#l05580">get_alarms()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05688">handle_alarms()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00772">dahdi_pvt::hanguponpolarityswitch</a>, <a class="el" href="chan__dahdi_8c_source.html#l03001">has_voicemail()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00795">dahdi_pvt::immediate</a>, <a class="el" href="chan__dahdi_8c_source.html#l00797">dahdi_pvt::inalarm</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__dahdi_8c_source.html#l01129">dahdi_pvt::mailbox</a>, <a class="el" href="manager_8h_source.html#l00181">manager_event</a>, <a class="el" href="chan__dahdi_8c_source.html#l00887">dahdi_pvt::mwimonitor_neon</a>, <a class="el" href="chan__dahdi_8c_source.html#l02940">notify_message()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01177">dahdi_pvt::polarity</a>, <a class="el" href="chan__dahdi_8c_source.html#l00585">POLARITY_REV</a>, <a class="el" href="chan__dahdi_8c_source.html#l00671">dahdi_pvt::radio</a>, <a class="el" href="chan__dahdi_8c_source.html#l01056">dahdi_pvt::ringt</a>, <a class="el" href="chan__dahdi_8c_source.html#l01061">dahdi_pvt::ringt_base</a>, <a class="el" href="chan__dahdi_8c_source.html#l00666">dahdi_pvt::sig</a>, <a class="el" href="chan__dahdi_8c_source.html#l02476">sig2str</a>, <a class="el" href="chan__dahdi_8c_source.html#l00256">SIG_BRI</a>, <a class="el" href="chan__dahdi_8c_source.html#l00257">SIG_BRI_PTMP</a>, <a class="el" href="chan__dahdi_8c_source.html#l00245">SIG_E911</a>, <a class="el" href="chan__dahdi_8c_source.html#l00240">SIG_EM</a>, <a class="el" href="chan__dahdi_8c_source.html#l00265">SIG_EM_E1</a>, <a class="el" href="chan__dahdi_8c_source.html#l00241">SIG_EMWINK</a>, <a class="el" href="chan__dahdi_8c_source.html#l00244">SIG_FEATB</a>, <a class="el" href="chan__dahdi_8c_source.html#l00242">SIG_FEATD</a>, <a class="el" href="chan__dahdi_8c_source.html#l00243">SIG_FEATDMF</a>, <a class="el" href="chan__dahdi_8c_source.html#l00246">SIG_FEATDMF_TA</a>, <a class="el" href="chan__dahdi_8c_source.html#l00247">SIG_FGC_CAMA</a>, <a class="el" href="chan__dahdi_8c_source.html#l00248">SIG_FGC_CAMAMF</a>, <a class="el" href="chan__dahdi_8c_source.html#l00253">SIG_FXOGS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00254">SIG_FXOKS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00252">SIG_FXOLS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00250">SIG_FXSGS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00251">SIG_FXSKS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00249">SIG_FXSLS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00266">SIG_GR303FXOKS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00267">SIG_GR303FXSKS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00255">SIG_PRI</a>, <a class="el" href="chan__dahdi_8c_source.html#l00260">SIG_SF</a>, <a class="el" href="chan__dahdi_8c_source.html#l00264">SIG_SF_FEATB</a>, <a class="el" href="chan__dahdi_8c_source.html#l00262">SIG_SF_FEATD</a>, <a class="el" href="chan__dahdi_8c_source.html#l00263">SIG_SF_FEATDMF</a>, <a class="el" href="chan__dahdi_8c_source.html#l00261">SIG_SFWINK</a>, <a class="el" href="chan__dahdi_8c_source.html#l00258">SIG_SS7</a>, <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l09496">do_monitor()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09270"></a>09270 {
<a name="l09271"></a>09271    <span class="keywordtype">int</span> res;
<a name="l09272"></a>09272    pthread_t threadid;
<a name="l09273"></a>09273    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>;
<a name="l09274"></a>09274 
<a name="l09275"></a>09275    <span class="comment">/* Handle an event on a given channel for the monitor thread. */</span>
<a name="l09276"></a>09276 
<a name="l09277"></a>09277    <span class="keywordflow">switch</span> (event) {
<a name="l09278"></a>09278    <span class="keywordflow">case</span> DAHDI_EVENT_NONE:
<a name="l09279"></a>09279    <span class="keywordflow">case</span> DAHDI_EVENT_BITSCHANGED:
<a name="l09280"></a>09280       <span class="keywordflow">break</span>;
<a name="l09281"></a>09281    <span class="keywordflow">case</span> DAHDI_EVENT_WINKFLASH:
<a name="l09282"></a>09282    <span class="keywordflow">case</span> DAHDI_EVENT_RINGOFFHOOK:
<a name="l09283"></a>09283       <span class="keywordflow">if</span> (i-&gt;<a class="code" href="structdahdi__pvt.html#adbe10c4b12619d6cb58b1ad14bc437af" title="TRUE if in an alarm condition.">inalarm</a>) <span class="keywordflow">break</span>;
<a name="l09284"></a>09284       <span class="keywordflow">if</span> (i-&gt;<a class="code" href="structdahdi__pvt.html#ac53b42243ee40edc74b615fe86806fe3" title="Nonzero if the signaling type is sent over a radio.">radio</a>) <span class="keywordflow">break</span>;
<a name="l09285"></a>09285       <span class="comment">/* Got a ring/answer.  What kind of channel are we? */</span>
<a name="l09286"></a>09286       <span class="keywordflow">switch</span> (i-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a>) {
<a name="l09287"></a>09287       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#adb40571aa5ff846fc334be5260eab257">SIG_FXOLS</a>:
<a name="l09288"></a>09288       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a3dcffbaf4a26f2b7b792998df1eea27b">SIG_FXOGS</a>:
<a name="l09289"></a>09289       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a7c9b3bb8225896ff2b9aed27e6f80f10">SIG_FXOKS</a>:
<a name="l09290"></a>09290          res = <a class="code" href="chan__dahdi_8c.html#a7c65e6943db828524ea6c9215b8bf696">dahdi_set_hook</a>(i-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_OFFHOOK);
<a name="l09291"></a>09291          i-&gt;<a class="code" href="structdahdi__pvt.html#ab18fd594a2af8725e3ddb868d8499e06" title="TRUE if the FXS port is off-hook.">fxsoffhookstate</a> = 1;
<a name="l09292"></a>09292          <span class="keywordflow">if</span> (res &amp;&amp; (errno == EBUSY))
<a name="l09293"></a>09293             <span class="keywordflow">break</span>;
<a name="l09294"></a>09294          <span class="keywordflow">if</span> (i-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a>) {
<a name="l09295"></a>09295             <span class="comment">/* Cancel VMWI spill */</span>
<a name="l09296"></a>09296             <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(i-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a>);
<a name="l09297"></a>09297             i-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a> = NULL;
<a name="l09298"></a>09298          }
<a name="l09299"></a>09299          <span class="keywordflow">if</span> (i-&gt;<a class="code" href="structdahdi__pvt.html#a04e3105c0481dfd78913d4bc9796f1c3" title="TRUE if the channel should be answered immediately without attempting to gather any...">immediate</a>) {
<a name="l09300"></a>09300             <a class="code" href="chan__dahdi_8c.html#a8c34a5bce2b26d056942349217806312">dahdi_enable_ec</a>(i);
<a name="l09301"></a>09301             <span class="comment">/* The channel is immediately up.  Start right away */</span>
<a name="l09302"></a>09302             res = tone_zone_play_tone(i-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_RINGTONE);
<a name="l09303"></a>09303             chan = <a class="code" href="chan__dahdi_8c.html#ab3f00769ae6c995b4f5f3934d8c805f6">dahdi_new</a>(i, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a>, 1, <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>, 0, 0);
<a name="l09304"></a>09304             <span class="keywordflow">if</span> (!chan) {
<a name="l09305"></a>09305                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to start PBX on channel %d\n&quot;</span>, i-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l09306"></a>09306                res = tone_zone_play_tone(i-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_CONGESTION);
<a name="l09307"></a>09307                <span class="keywordflow">if</span> (res &lt; 0)
<a name="l09308"></a>09308                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to play congestion tone on channel %d\n&quot;</span>, i-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l09309"></a>09309             }
<a name="l09310"></a>09310          } <span class="keywordflow">else</span> {
<a name="l09311"></a>09311             <span class="comment">/* Check for callerid, digits, etc */</span>
<a name="l09312"></a>09312             chan = <a class="code" href="chan__dahdi_8c.html#ab3f00769ae6c995b4f5f3934d8c805f6">dahdi_new</a>(i, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660addb60fd97b55a4aea24f992e30fe3c84">AST_STATE_RESERVED</a>, 0, <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>, 0, 0);
<a name="l09313"></a>09313             <span class="keywordflow">if</span> (chan) {
<a name="l09314"></a>09314                <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#a8be869dea1576c3f11795532605549dc">has_voicemail</a>(i))
<a name="l09315"></a>09315                   res = tone_zone_play_tone(i-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_STUTTER);
<a name="l09316"></a>09316                <span class="keywordflow">else</span>
<a name="l09317"></a>09317                   res = tone_zone_play_tone(i-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_DIALTONE);
<a name="l09318"></a>09318                <span class="keywordflow">if</span> (res &lt; 0)
<a name="l09319"></a>09319                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to play dialtone on channel %d, do you have defaultzone and loadzone defined?\n&quot;</span>, i-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l09320"></a>09320                <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a832647380b1f97e7ac1b4492f8816d46">ast_pthread_create_detached</a>(&amp;threadid, NULL, <a class="code" href="chan__dahdi_8c.html#a0d1f78e604903f5ef4e42bf961f4df95">ss_thread</a>, chan)) {
<a name="l09321"></a>09321                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to start simple switch thread on channel %d\n&quot;</span>, i-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l09322"></a>09322                   res = tone_zone_play_tone(i-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_CONGESTION);
<a name="l09323"></a>09323                   <span class="keywordflow">if</span> (res &lt; 0)
<a name="l09324"></a>09324                      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to play congestion tone on channel %d\n&quot;</span>, i-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l09325"></a>09325                   <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l09326"></a>09326                }
<a name="l09327"></a>09327             } <span class="keywordflow">else</span>
<a name="l09328"></a>09328                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create channel\n&quot;</span>);
<a name="l09329"></a>09329          }
<a name="l09330"></a>09330          <span class="keywordflow">break</span>;
<a name="l09331"></a>09331       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a1dc50a07aef86c90ab94f1583c35a265">SIG_FXSLS</a>:
<a name="l09332"></a>09332       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a97e4c6fb4680984aafc6e0e55a2b6cb4">SIG_FXSGS</a>:
<a name="l09333"></a>09333       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a38139ec369c0243f4324eb4eb0c2f004">SIG_FXSKS</a>:
<a name="l09334"></a>09334             i-&gt;<a class="code" href="structdahdi__pvt.html#a2ecae7dca8c46e1948d9117eee9a15e4" title="Ring timeout timer??">ringt</a> = i-&gt;<a class="code" href="structdahdi__pvt.html#aadc5d8714afe5d456c8f17db3abf7f20" title="Ring timeout base.">ringt_base</a>;
<a name="l09335"></a>09335             <span class="comment">/* Fall through */</span>
<a name="l09336"></a>09336       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a1ba988b93fce049075b7c2ef6c931cf9">SIG_EMWINK</a>:
<a name="l09337"></a>09337       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ab79873391af2857a602e1eff68606f23">SIG_FEATD</a>:
<a name="l09338"></a>09338       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a98d4710afc1fcb2ff110eabb4fbcc308">SIG_FEATDMF</a>:
<a name="l09339"></a>09339       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ac0c40f74945ed15aa82cd9fedc304e55">SIG_FEATDMF_TA</a>:
<a name="l09340"></a>09340       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#adfdd0e4d05281d354c15ef1a5d158cd6">SIG_E911</a>:
<a name="l09341"></a>09341       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a167056b2763a4897838c7115efc1f9fc">SIG_FGC_CAMA</a>:
<a name="l09342"></a>09342       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a945e2b5f225d3abdc57b5dcc53daa62a">SIG_FGC_CAMAMF</a>:
<a name="l09343"></a>09343       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a0ba8ec199f5fb4f2be64144be0bd13b1">SIG_FEATB</a>:
<a name="l09344"></a>09344       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#afa7547cd2cee1bae7734206102635216">SIG_EM</a>:
<a name="l09345"></a>09345       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#aa7b59772722b794c5218768dac3ee419">SIG_EM_E1</a>:
<a name="l09346"></a>09346       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a193853e7e76cff05d51425eba48d030f">SIG_SFWINK</a>:
<a name="l09347"></a>09347       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#aac334a7f88651d9e44499897386d2cfd">SIG_SF_FEATD</a>:
<a name="l09348"></a>09348       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a4625d3aba972e102c8460a9f16af0fc7">SIG_SF_FEATDMF</a>:
<a name="l09349"></a>09349       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a33a2f70a24e9f8ccfcc1e76f208b1ab6">SIG_SF_FEATB</a>:
<a name="l09350"></a>09350       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#afacb372d32fba2192ed6a2989c54fbda">SIG_SF</a>:
<a name="l09351"></a>09351          <span class="comment">/* Check for callerid, digits, etc */</span>
<a name="l09352"></a>09352          <span class="keywordflow">if</span> (i-&gt;<a class="code" href="structdahdi__pvt.html#aafa12631e52b2af7ee7a6ab7bf554ed2">cid_start</a> == <a class="code" href="callerid_8h.html#ae09f76d7a76cca0f6ba8cc074828ba70">CID_START_POLARITY_IN</a>) {
<a name="l09353"></a>09353             chan = <a class="code" href="chan__dahdi_8c.html#ab3f00769ae6c995b4f5f3934d8c805f6">dahdi_new</a>(i, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a70a2b40aa2ec0f6f0e7378df7a0810db">AST_STATE_PRERING</a>, 0, <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>, 0, 0);
<a name="l09354"></a>09354          } <span class="keywordflow">else</span> {
<a name="l09355"></a>09355             chan = <a class="code" href="chan__dahdi_8c.html#ab3f00769ae6c995b4f5f3934d8c805f6">dahdi_new</a>(i, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a>, 0, <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>, 0, 0);
<a name="l09356"></a>09356          }
<a name="l09357"></a>09357 
<a name="l09358"></a>09358          <span class="keywordflow">if</span> (!chan) {
<a name="l09359"></a>09359             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Cannot allocate new structure on channel %d\n&quot;</span>, i-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l09360"></a>09360          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a832647380b1f97e7ac1b4492f8816d46">ast_pthread_create_detached</a>(&amp;threadid, NULL, <a class="code" href="chan__dahdi_8c.html#a0d1f78e604903f5ef4e42bf961f4df95">ss_thread</a>, chan)) {
<a name="l09361"></a>09361             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to start simple switch thread on channel %d\n&quot;</span>, i-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l09362"></a>09362             res = tone_zone_play_tone(i-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_CONGESTION);
<a name="l09363"></a>09363             <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l09364"></a>09364                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to play congestion tone on channel %d\n&quot;</span>, i-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l09365"></a>09365             }
<a name="l09366"></a>09366             <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l09367"></a>09367          }
<a name="l09368"></a>09368          <span class="keywordflow">break</span>;
<a name="l09369"></a>09369       <span class="keywordflow">default</span>:
<a name="l09370"></a>09370          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Don&apos;t know how to handle ring/answer with signalling %s on channel %d\n&quot;</span>, <a class="code" href="chan__dahdi_8c.html#ac36e4cc782493e37064405666f5e4fdd">sig2str</a>(i-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a>), i-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l09371"></a>09371          res = tone_zone_play_tone(i-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_CONGESTION);
<a name="l09372"></a>09372          <span class="keywordflow">if</span> (res &lt; 0)
<a name="l09373"></a>09373             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to play congestion tone on channel %d\n&quot;</span>, i-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l09374"></a>09374          <span class="keywordflow">return</span> NULL;
<a name="l09375"></a>09375       }
<a name="l09376"></a>09376       <span class="keywordflow">break</span>;
<a name="l09377"></a>09377    <span class="keywordflow">case</span> DAHDI_EVENT_NOALARM:
<a name="l09378"></a>09378       i-&gt;<a class="code" href="structdahdi__pvt.html#adbe10c4b12619d6cb58b1ad14bc437af" title="TRUE if in an alarm condition.">inalarm</a> = 0;
<a name="l09379"></a>09379       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Alarm cleared on channel %d\n&quot;</span>, i-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l09380"></a>09380       <a class="code" href="manager_8h.html#a1ef0ee0044dbbeb4c3a5abc6c046b208" title="External routines may send asterisk manager events this way.">manager_event</a>(<a class="code" href="manager_8h.html#a420f0f755e1c3378b45ca7f6f0669ffa">EVENT_FLAG_SYSTEM</a>, <span class="stringliteral">&quot;AlarmClear&quot;</span>,
<a name="l09381"></a>09381          <span class="stringliteral">&quot;Channel: %d\r\n&quot;</span>, i-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l09382"></a>09382       <span class="keywordflow">break</span>;
<a name="l09383"></a>09383    <span class="keywordflow">case</span> DAHDI_EVENT_ALARM:
<a name="l09384"></a>09384       i-&gt;<a class="code" href="structdahdi__pvt.html#adbe10c4b12619d6cb58b1ad14bc437af" title="TRUE if in an alarm condition.">inalarm</a> = 1;
<a name="l09385"></a>09385       res = <a class="code" href="chan__dahdi_8c.html#ace00362fe9640b8a792c965572a87826">get_alarms</a>(i);
<a name="l09386"></a>09386       <a class="code" href="chan__dahdi_8c.html#aa8e0b028321154a280cad06d20099330">handle_alarms</a>(i, res);
<a name="l09387"></a>09387       <span class="comment">/* fall thru intentionally */</span>
<a name="l09388"></a>09388    <span class="keywordflow">case</span> DAHDI_EVENT_ONHOOK:
<a name="l09389"></a>09389       <span class="keywordflow">if</span> (i-&gt;<a class="code" href="structdahdi__pvt.html#ac53b42243ee40edc74b615fe86806fe3" title="Nonzero if the signaling type is sent over a radio.">radio</a>)
<a name="l09390"></a>09390          <span class="keywordflow">break</span>;
<a name="l09391"></a>09391       <span class="comment">/* Back on hook.  Hang up. */</span>
<a name="l09392"></a>09392       <span class="keywordflow">switch</span> (i-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a>) {
<a name="l09393"></a>09393       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#adb40571aa5ff846fc334be5260eab257">SIG_FXOLS</a>:
<a name="l09394"></a>09394       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a3dcffbaf4a26f2b7b792998df1eea27b">SIG_FXOGS</a>:
<a name="l09395"></a>09395       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ab79873391af2857a602e1eff68606f23">SIG_FEATD</a>:
<a name="l09396"></a>09396       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a98d4710afc1fcb2ff110eabb4fbcc308">SIG_FEATDMF</a>:
<a name="l09397"></a>09397       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ac0c40f74945ed15aa82cd9fedc304e55">SIG_FEATDMF_TA</a>:
<a name="l09398"></a>09398       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#adfdd0e4d05281d354c15ef1a5d158cd6">SIG_E911</a>:
<a name="l09399"></a>09399       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a167056b2763a4897838c7115efc1f9fc">SIG_FGC_CAMA</a>:
<a name="l09400"></a>09400       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a945e2b5f225d3abdc57b5dcc53daa62a">SIG_FGC_CAMAMF</a>:
<a name="l09401"></a>09401       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a0ba8ec199f5fb4f2be64144be0bd13b1">SIG_FEATB</a>:
<a name="l09402"></a>09402       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#afa7547cd2cee1bae7734206102635216">SIG_EM</a>:
<a name="l09403"></a>09403       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#aa7b59772722b794c5218768dac3ee419">SIG_EM_E1</a>:
<a name="l09404"></a>09404       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a1ba988b93fce049075b7c2ef6c931cf9">SIG_EMWINK</a>:
<a name="l09405"></a>09405       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#aac334a7f88651d9e44499897386d2cfd">SIG_SF_FEATD</a>:
<a name="l09406"></a>09406       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a4625d3aba972e102c8460a9f16af0fc7">SIG_SF_FEATDMF</a>:
<a name="l09407"></a>09407       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a33a2f70a24e9f8ccfcc1e76f208b1ab6">SIG_SF_FEATB</a>:
<a name="l09408"></a>09408       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#afacb372d32fba2192ed6a2989c54fbda">SIG_SF</a>:
<a name="l09409"></a>09409       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a193853e7e76cff05d51425eba48d030f">SIG_SFWINK</a>:
<a name="l09410"></a>09410       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a1dc50a07aef86c90ab94f1583c35a265">SIG_FXSLS</a>:
<a name="l09411"></a>09411       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a97e4c6fb4680984aafc6e0e55a2b6cb4">SIG_FXSGS</a>:
<a name="l09412"></a>09412       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a38139ec369c0243f4324eb4eb0c2f004">SIG_FXSKS</a>:
<a name="l09413"></a>09413       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#adc73c6cbd4b991ecd2925640c0c8761e">SIG_GR303FXSKS</a>:
<a name="l09414"></a>09414          <a class="code" href="chan__dahdi_8c.html#a5ceb6fd5bd012740d50b04e84fb29be4">dahdi_disable_ec</a>(i);
<a name="l09415"></a>09415          res = tone_zone_play_tone(i-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, -1);
<a name="l09416"></a>09416          <a class="code" href="chan__dahdi_8c.html#a7c65e6943db828524ea6c9215b8bf696">dahdi_set_hook</a>(i-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_ONHOOK);
<a name="l09417"></a>09417          <span class="keywordflow">break</span>;
<a name="l09418"></a>09418       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a5724d8559318f4724b247ede46ff182d">SIG_GR303FXOKS</a>:
<a name="l09419"></a>09419       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a7c9b3bb8225896ff2b9aed27e6f80f10">SIG_FXOKS</a>:
<a name="l09420"></a>09420          <a class="code" href="chan__dahdi_8c.html#a5ceb6fd5bd012740d50b04e84fb29be4">dahdi_disable_ec</a>(i);
<a name="l09421"></a>09421          <span class="comment">/* Diddle the battery for the zhone */</span>
<a name="l09422"></a>09422 <span class="preprocessor">#ifdef ZHONE_HACK</span>
<a name="l09423"></a>09423 <span class="preprocessor"></span>         <a class="code" href="chan__dahdi_8c.html#a7c65e6943db828524ea6c9215b8bf696">dahdi_set_hook</a>(i-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_OFFHOOK);
<a name="l09424"></a>09424          usleep(1);
<a name="l09425"></a>09425 <span class="preprocessor">#endif</span>
<a name="l09426"></a>09426 <span class="preprocessor"></span>         res = tone_zone_play_tone(i-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, -1);
<a name="l09427"></a>09427          <a class="code" href="chan__dahdi_8c.html#a7c65e6943db828524ea6c9215b8bf696">dahdi_set_hook</a>(i-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_ONHOOK);
<a name="l09428"></a>09428          <span class="keywordflow">break</span>;
<a name="l09429"></a>09429       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ae9ab0c9508fca045a06730533be276a5">SIG_PRI</a>:
<a name="l09430"></a>09430       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#aadcda889db3cf9dfe757dbc1d4d8311a">SIG_SS7</a>:
<a name="l09431"></a>09431       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ab5bfeaf991c23c5b6510ace44ae79ce9">SIG_BRI</a>:
<a name="l09432"></a>09432       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a>:
<a name="l09433"></a>09433          <a class="code" href="chan__dahdi_8c.html#a5ceb6fd5bd012740d50b04e84fb29be4">dahdi_disable_ec</a>(i);
<a name="l09434"></a>09434          res = tone_zone_play_tone(i-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, -1);
<a name="l09435"></a>09435          <span class="keywordflow">break</span>;
<a name="l09436"></a>09436       <span class="keywordflow">default</span>:
<a name="l09437"></a>09437          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Don&apos;t know how to handle on hook with signalling %s on channel %d\n&quot;</span>, <a class="code" href="chan__dahdi_8c.html#ac36e4cc782493e37064405666f5e4fdd">sig2str</a>(i-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a>), i-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l09438"></a>09438          res = tone_zone_play_tone(i-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, -1);
<a name="l09439"></a>09439          <span class="keywordflow">return</span> NULL;
<a name="l09440"></a>09440       }
<a name="l09441"></a>09441       <span class="keywordflow">if</span> (i-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> &amp; __DAHDI_SIG_FXO) {
<a name="l09442"></a>09442          i-&gt;<a class="code" href="structdahdi__pvt.html#ab18fd594a2af8725e3ddb868d8499e06" title="TRUE if the FXS port is off-hook.">fxsoffhookstate</a> = 0;
<a name="l09443"></a>09443       }
<a name="l09444"></a>09444       <span class="keywordflow">break</span>;
<a name="l09445"></a>09445    <span class="keywordflow">case</span> DAHDI_EVENT_POLARITY:
<a name="l09446"></a>09446       <span class="keywordflow">switch</span> (i-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a>) {
<a name="l09447"></a>09447       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a1dc50a07aef86c90ab94f1583c35a265">SIG_FXSLS</a>:
<a name="l09448"></a>09448       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a38139ec369c0243f4324eb4eb0c2f004">SIG_FXSKS</a>:
<a name="l09449"></a>09449       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a97e4c6fb4680984aafc6e0e55a2b6cb4">SIG_FXSGS</a>:
<a name="l09450"></a>09450          <span class="comment">/* We have already got a PR before the channel was</span>
<a name="l09451"></a>09451 <span class="comment">            created, but it wasn&apos;t handled. We need polarity</span>
<a name="l09452"></a>09452 <span class="comment">            to be REV for remote hangup detection to work.</span>
<a name="l09453"></a>09453 <span class="comment">            At least in Spain */</span>
<a name="l09454"></a>09454          <span class="keywordflow">if</span> (i-&gt;<a class="code" href="structdahdi__pvt.html#a7bc13c53b24817de617833097a940350" title="TRUE if the call will be considered &amp;quot;hung up&amp;quot; on a polarity reversal.">hanguponpolarityswitch</a>)
<a name="l09455"></a>09455             i-&gt;<a class="code" href="structdahdi__pvt.html#aeffac59edf881b639bb5e7c7137a7312" title="Current line interface polarity. POLARITY_IDLE, POLARITY_REV.">polarity</a> = <a class="code" href="chan__dahdi_8c.html#aeba680adad3f0d1146c8e5003f6a44f2">POLARITY_REV</a>;
<a name="l09456"></a>09456          <span class="keywordflow">if</span> (i-&gt;<a class="code" href="structdahdi__pvt.html#aafa12631e52b2af7ee7a6ab7bf554ed2">cid_start</a> == <a class="code" href="callerid_8h.html#ac420c8a2c16e140da85ba27d43bb72ac">CID_START_POLARITY</a> || i-&gt;<a class="code" href="structdahdi__pvt.html#aafa12631e52b2af7ee7a6ab7bf554ed2">cid_start</a> == <a class="code" href="callerid_8h.html#ae09f76d7a76cca0f6ba8cc074828ba70">CID_START_POLARITY_IN</a>) {
<a name="l09457"></a>09457             i-&gt;<a class="code" href="structdahdi__pvt.html#aeffac59edf881b639bb5e7c7137a7312" title="Current line interface polarity. POLARITY_IDLE, POLARITY_REV.">polarity</a> = <a class="code" href="chan__dahdi_8c.html#aeba680adad3f0d1146c8e5003f6a44f2">POLARITY_REV</a>;
<a name="l09458"></a>09458             <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Starting post polarity &quot;</span>
<a name="l09459"></a>09459                <span class="stringliteral">&quot;CID detection on channel %d\n&quot;</span>,
<a name="l09460"></a>09460                i-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l09461"></a>09461             chan = <a class="code" href="chan__dahdi_8c.html#ab3f00769ae6c995b4f5f3934d8c805f6">dahdi_new</a>(i, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a70a2b40aa2ec0f6f0e7378df7a0810db">AST_STATE_PRERING</a>, 0, <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>, 0, 0);
<a name="l09462"></a>09462             <span class="keywordflow">if</span> (!chan) {
<a name="l09463"></a>09463                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Cannot allocate new structure on channel %d\n&quot;</span>, i-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l09464"></a>09464             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a832647380b1f97e7ac1b4492f8816d46">ast_pthread_create_detached</a>(&amp;threadid, NULL, <a class="code" href="chan__dahdi_8c.html#a0d1f78e604903f5ef4e42bf961f4df95">ss_thread</a>, chan)) {
<a name="l09465"></a>09465                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to start simple switch thread on channel %d\n&quot;</span>, i-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l09466"></a>09466             }
<a name="l09467"></a>09467          }
<a name="l09468"></a>09468          <span class="keywordflow">break</span>;
<a name="l09469"></a>09469       <span class="keywordflow">default</span>:
<a name="l09470"></a>09470          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;handle_init_event detected &quot;</span>
<a name="l09471"></a>09471             <span class="stringliteral">&quot;polarity reversal on non-FXO (SIG_FXS) &quot;</span>
<a name="l09472"></a>09472             <span class="stringliteral">&quot;interface %d\n&quot;</span>, i-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l09473"></a>09473       }
<a name="l09474"></a>09474       <span class="keywordflow">break</span>;
<a name="l09475"></a>09475    <span class="keywordflow">case</span> DAHDI_EVENT_REMOVED: <span class="comment">/* destroy channel, will actually do so in do_monitor */</span>
<a name="l09476"></a>09476       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,
<a name="l09477"></a>09477             <span class="stringliteral">&quot;Got DAHDI_EVENT_REMOVED. Destroying channel %d\n&quot;</span>,
<a name="l09478"></a>09478             i-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l09479"></a>09479       <span class="keywordflow">return</span> i;
<a name="l09480"></a>09480    <span class="keywordflow">case</span> DAHDI_EVENT_NEONMWI_ACTIVE:
<a name="l09481"></a>09481       <span class="keywordflow">if</span> (i-&gt;<a class="code" href="structdahdi__pvt.html#a9ca6405842cd66b52da98bb94fbe4fe7" title="TRUE if the FXO port monitors for neon type MWI indications from the other end.">mwimonitor_neon</a>) {
<a name="l09482"></a>09482          <a class="code" href="chan__dahdi_8c.html#a3cd48b46cf8ee3ffc97d1f15fb53aaad" title="Send MWI state change.">notify_message</a>(i-&gt;<a class="code" href="structdahdi__pvt.html#ac81f44f4f22dee90de5975cf8fa4641b" title="Voice mailbox location.">mailbox</a>, 1);
<a name="l09483"></a>09483          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;NEON MWI set for channel %d, mailbox %s \n&quot;</span>, i-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, i-&gt;<a class="code" href="structdahdi__pvt.html#ac81f44f4f22dee90de5975cf8fa4641b" title="Voice mailbox location.">mailbox</a>);
<a name="l09484"></a>09484       }
<a name="l09485"></a>09485       <span class="keywordflow">break</span>;
<a name="l09486"></a>09486    <span class="keywordflow">case</span> DAHDI_EVENT_NEONMWI_INACTIVE:
<a name="l09487"></a>09487       <span class="keywordflow">if</span> (i-&gt;<a class="code" href="structdahdi__pvt.html#a9ca6405842cd66b52da98bb94fbe4fe7" title="TRUE if the FXO port monitors for neon type MWI indications from the other end.">mwimonitor_neon</a>) {
<a name="l09488"></a>09488          <a class="code" href="chan__dahdi_8c.html#a3cd48b46cf8ee3ffc97d1f15fb53aaad" title="Send MWI state change.">notify_message</a>(i-&gt;<a class="code" href="structdahdi__pvt.html#ac81f44f4f22dee90de5975cf8fa4641b" title="Voice mailbox location.">mailbox</a>, 0);
<a name="l09489"></a>09489          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;NEON MWI cleared for channel %d, mailbox %s\n&quot;</span>, i-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, i-&gt;<a class="code" href="structdahdi__pvt.html#ac81f44f4f22dee90de5975cf8fa4641b" title="Voice mailbox location.">mailbox</a>);
<a name="l09490"></a>09490       }
<a name="l09491"></a>09491       <span class="keywordflow">break</span>;
<a name="l09492"></a>09492    }
<a name="l09493"></a>09493    <span class="keywordflow">return</span> NULL;
<a name="l09494"></a>09494 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8be869dea1576c3f11795532605549dc"></a><!-- doxytag: member="chan_dahdi.c::has_voicemail" ref="a8be869dea1576c3f11795532605549dc" args="(struct dahdi_pvt *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int has_voicemail </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l03001">3001</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="app_8c_source.html#l00234">ast_app_has_voicemail()</a>, <a class="el" href="event_8c_source.html#l00963">ast_event_destroy()</a>, <a class="el" href="event_8c_source.html#l00991">ast_event_get_cached()</a>, <a class="el" href="event_8c_source.html#l00812">ast_event_get_ie_uint()</a>, <a class="el" href="event__defs_8h_source.html#l00115">AST_EVENT_IE_CONTEXT</a>, <a class="el" href="event__defs_8h_source.html#l00058">AST_EVENT_IE_END</a>, <a class="el" href="event__defs_8h_source.html#l00077">AST_EVENT_IE_MAILBOX</a>, <a class="el" href="event__defs_8h_source.html#l00065">AST_EVENT_IE_NEWMSGS</a>, <a class="el" href="event__defs_8h_source.html#l00137">AST_EVENT_IE_PLTYPE_STR</a>, <a class="el" href="event__defs_8h_source.html#l00040">AST_EVENT_MWI</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="chan__alsa_8c_source.html#l00105">context</a>, <a class="el" href="chan__dahdi_8c_source.html#l01129">dahdi_pvt::mailbox</a>, <a class="el" href="chan__mgcp_8c_source.html#l00185">mailbox</a>, and <a class="el" href="agi_2strcompat_8c_source.html#l00027">strsep()</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09496">do_monitor()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l09063">mwi_send_init()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03002"></a>03002 {
<a name="l03003"></a>03003    <span class="keywordtype">int</span> new_msgs;
<a name="l03004"></a>03004    <span class="keyword">struct </span><a class="code" href="structast__event.html" title="An event.">ast_event</a> *event;
<a name="l03005"></a>03005    <span class="keywordtype">char</span> *<a class="code" href="chan__mgcp_8c.html#ac81f44f4f22dee90de5975cf8fa4641b">mailbox</a>, *<a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>;
<a name="l03006"></a>03006 
<a name="l03007"></a>03007    mailbox = context = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ac81f44f4f22dee90de5975cf8fa4641b" title="Voice mailbox location.">mailbox</a>);
<a name="l03008"></a>03008    <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;context, <span class="stringliteral">&quot;@&quot;</span>);
<a name="l03009"></a>03009    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(context))
<a name="l03010"></a>03010       context = <span class="stringliteral">&quot;default&quot;</span>;
<a name="l03011"></a>03011 
<a name="l03012"></a>03012    <span class="keyword">event</span> = <a class="code" href="event_8h.html#a419385710c135873656b047df8f72e7e" title="Retrieve an event from the cache.">ast_event_get_cached</a>(<a class="code" href="event__defs_8h.html#a6fa079412d9d9c1cc539f6d71f37f79fa9a217b1f500680b3e458d62b048c0892">AST_EVENT_MWI</a>,
<a name="l03013"></a>03013       <a class="code" href="event__defs_8h.html#a003673523d7fe265c6738a5a9e49c491aae6c80d8f4c6ab3cee006ed57d874710" title="Mailbox name.">AST_EVENT_IE_MAILBOX</a>, <a class="code" href="event__defs_8h.html#a73dadfa1128d5e75107536e132e758c6ab82ac16f0791be2f8f918429a73430be">AST_EVENT_IE_PLTYPE_STR</a>, mailbox,
<a name="l03014"></a>03014       <a class="code" href="event__defs_8h.html#a003673523d7fe265c6738a5a9e49c491a25764e2fb734ccb3ee1f6f41caba5318" title="Context IE Used by AST_EVENT_MWI Payload type: str.">AST_EVENT_IE_CONTEXT</a>, <a class="code" href="event__defs_8h.html#a73dadfa1128d5e75107536e132e758c6ab82ac16f0791be2f8f918429a73430be">AST_EVENT_IE_PLTYPE_STR</a>, context,
<a name="l03015"></a>03015       <a class="code" href="event__defs_8h.html#a003673523d7fe265c6738a5a9e49c491a04c78c1362e97d548344c354001c151f">AST_EVENT_IE_END</a>);
<a name="l03016"></a>03016 
<a name="l03017"></a>03017    <span class="keywordflow">if</span> (event) {
<a name="l03018"></a>03018       new_msgs = <a class="code" href="event_8h.html#a317f6947b933acd0da82df6e9a4672e5" title="Get the value of an information element that has an integer payload.">ast_event_get_ie_uint</a>(event, <a class="code" href="event__defs_8h.html#a003673523d7fe265c6738a5a9e49c491aff40847f0450f17c96e94e721aee38f2" title="Number of new messages Used by: AST_EVENT_MWI Payload type: UINT.">AST_EVENT_IE_NEWMSGS</a>);
<a name="l03019"></a>03019       <a class="code" href="event_8h.html#a50b34e0161630dbbc0880a06eb78ad7a" title="Destroy an event.">ast_event_destroy</a>(event);
<a name="l03020"></a>03020    } <span class="keywordflow">else</span>
<a name="l03021"></a>03021       new_msgs = <a class="code" href="app_8h.html#ae5953304e56862ac7efc1fed0ac6732f" title="Determine if a given mailbox has any voicemail If folder is NULL, defaults to &amp;quot;INBOX&amp;quot;...">ast_app_has_voicemail</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ac81f44f4f22dee90de5975cf8fa4641b" title="Voice mailbox location.">mailbox</a>, NULL);
<a name="l03022"></a>03022 
<a name="l03023"></a>03023    <span class="keywordflow">return</span> new_msgs;
<a name="l03024"></a>03024 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a08c5ea3a8b7ff7213a12de76994d4897"></a><!-- doxytag: member="chan_dahdi.c::isourconf" ref="a08c5ea3a8b7ff7213a12de76994d4897" args="(struct dahdi_pvt *p, struct dahdi_subchannel *c)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int isourconf </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdahdi__subchannel.html">dahdi_subchannel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l02516">2516</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="chan__dahdi_8c_source.html#l01023">dahdi_pvt::confno</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00622">dahdi_subchannel::curconf</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l02527">conf_del()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02517"></a>02517 {
<a name="l02518"></a>02518    <span class="comment">/* If they&apos;re listening to our channel, they&apos;re ours */</span>
<a name="l02519"></a>02519    <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a> == c-&gt;<a class="code" href="structdahdi__subchannel.html#ac50efd693f9db4d9cc6d1e1287791824">curconf</a>.confno) &amp;&amp; (c-&gt;<a class="code" href="structdahdi__subchannel.html#ac50efd693f9db4d9cc6d1e1287791824">curconf</a>.confmode == DAHDI_CONF_DIGITALMON))
<a name="l02520"></a>02520       <span class="keywordflow">return</span> 1;
<a name="l02521"></a>02521    <span class="comment">/* If they&apos;re a talker on our (allocated) conference, they&apos;re ours */</span>
<a name="l02522"></a>02522    <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structdahdi__pvt.html#aa9d25d217a303c512db5f8bd7fabd587">confno</a> &gt; 0) &amp;&amp; (p-&gt;<a class="code" href="structdahdi__pvt.html#aa9d25d217a303c512db5f8bd7fabd587">confno</a> == c-&gt;<a class="code" href="structdahdi__subchannel.html#ac50efd693f9db4d9cc6d1e1287791824">curconf</a>.confno) &amp;&amp; (c-&gt;<a class="code" href="structdahdi__subchannel.html#ac50efd693f9db4d9cc6d1e1287791824">curconf</a>.confmode &amp; DAHDI_CONF_TALKER))
<a name="l02523"></a>02523       <span class="keywordflow">return</span> 1;
<a name="l02524"></a>02524    <span class="keywordflow">return</span> 0;
<a name="l02525"></a>02525 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1d078823a0af683aaa01d964f8a62039"></a><!-- doxytag: member="chan_dahdi.c::isslavenative" ref="a1d078823a0af683aaa01d964f8a62039" args="(struct dahdi_pvt *p, struct dahdi_pvt **out)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int isslavenative </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> **&nbsp;</td>
          <td class="paramname"> <em>out</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l02546">2546</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="chan__dahdi_8c_source.html#l00621">dahdi_subchannel::inthreeway</a>, <a class="el" href="chan__dahdi_8c_source.html#l01022">dahdi_pvt::law</a>, <a class="el" href="chan__dahdi_8c_source.html#l00628">MAX_SLAVES</a>, <a class="el" href="chan__dahdi_8c_source.html#l00657">dahdi_pvt::slaves</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l02604">update_conf()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02547"></a>02547 {
<a name="l02548"></a>02548    <span class="keywordtype">int</span> x;
<a name="l02549"></a>02549    <span class="keywordtype">int</span> useslavenative;
<a name="l02550"></a>02550    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *slave = NULL;
<a name="l02551"></a>02551    <span class="comment">/* Start out optimistic */</span>
<a name="l02552"></a>02552    useslavenative = 1;
<a name="l02553"></a>02553    <span class="comment">/* Update conference state in a stateless fashion */</span>
<a name="l02554"></a>02554    <span class="keywordflow">for</span> (x = 0; x &lt; 3; x++) {
<a name="l02555"></a>02555       <span class="comment">/* Any three-way calling makes slave native mode *definitely* out</span>
<a name="l02556"></a>02556 <span class="comment">         of the question */</span>
<a name="l02557"></a>02557       <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[x].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a> &gt; -1) &amp;&amp; p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[x].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a>)
<a name="l02558"></a>02558          useslavenative = 0;
<a name="l02559"></a>02559    }
<a name="l02560"></a>02560    <span class="comment">/* If we don&apos;t have any 3-way calls, check to see if we have</span>
<a name="l02561"></a>02561 <span class="comment">      precisely one slave */</span>
<a name="l02562"></a>02562    <span class="keywordflow">if</span> (useslavenative) {
<a name="l02563"></a>02563       <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="chan__dahdi_8c.html#a2a3c5190bdbe2a4780a460383970aa92">MAX_SLAVES</a>; x++) {
<a name="l02564"></a>02564          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#aa607a8a226852c168c96a4d0f3001c88">slaves</a>[x]) {
<a name="l02565"></a>02565             <span class="keywordflow">if</span> (slave) {
<a name="l02566"></a>02566                <span class="comment">/* Whoops already have a slave!  No</span>
<a name="l02567"></a>02567 <span class="comment">                  slave native and stop right away */</span>
<a name="l02568"></a>02568                slave = NULL;
<a name="l02569"></a>02569                useslavenative = 0;
<a name="l02570"></a>02570                <span class="keywordflow">break</span>;
<a name="l02571"></a>02571             } <span class="keywordflow">else</span> {
<a name="l02572"></a>02572                <span class="comment">/* We have one slave so far */</span>
<a name="l02573"></a>02573                slave = p-&gt;<a class="code" href="structdahdi__pvt.html#aa607a8a226852c168c96a4d0f3001c88">slaves</a>[x];
<a name="l02574"></a>02574             }
<a name="l02575"></a>02575          }
<a name="l02576"></a>02576       }
<a name="l02577"></a>02577    }
<a name="l02578"></a>02578    <span class="comment">/* If no slave, slave native definitely out */</span>
<a name="l02579"></a>02579    <span class="keywordflow">if</span> (!slave)
<a name="l02580"></a>02580       useslavenative = 0;
<a name="l02581"></a>02581    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (slave-&gt;<a class="code" href="structdahdi__pvt.html#a17dd7b17c0e736754e01e575ca8d8cb8" title="Active PCM encoding format: DAHDI_LAW_ALAW or DAHDI_LAW_MULAW.">law</a> != p-&gt;<a class="code" href="structdahdi__pvt.html#a17dd7b17c0e736754e01e575ca8d8cb8" title="Active PCM encoding format: DAHDI_LAW_ALAW or DAHDI_LAW_MULAW.">law</a>) {
<a name="l02582"></a>02582       useslavenative = 0;
<a name="l02583"></a>02583       slave = NULL;
<a name="l02584"></a>02584    }
<a name="l02585"></a>02585    <span class="keywordflow">if</span> (out)
<a name="l02586"></a>02586       *out = slave;
<a name="l02587"></a>02587    <span class="keywordflow">return</span> useslavenative;
<a name="l02588"></a>02588 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac3382bf6da54c56b37069bd76bbdf4f9"></a><!-- doxytag: member="chan_dahdi.c::load_module" ref="ac3382bf6da54c56b37069bd76bbdf4f9" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int load_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l17308">17308</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="chan__dahdi_8c_source.html#l15849">__unload_module()</a>, <a class="el" href="chan__dahdi_8c_source.html#l15289">action_dahdidialoffhook()</a>, <a class="el" href="chan__dahdi_8c_source.html#l15232">action_dahdidndoff()</a>, <a class="el" href="chan__dahdi_8c_source.html#l15213">action_dahdidndon()</a>, <a class="el" href="chan__dahdi_8c_source.html#l14475">action_dahdirestart()</a>, <a class="el" href="chan__dahdi_8c_source.html#l15321">action_dahdishowchannels()</a>, <a class="el" href="chan__dahdi_8c_source.html#l15251">action_transfer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l15270">action_transferhangup()</a>, <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="channel_8c_source.html#l00557">ast_channel_register()</a>, <a class="el" href="cli_8c_source.html#l01927">ast_cli_register_multiple()</a>, <a class="el" href="lock_8h_source.html#l01729">ast_cond_init()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="manager_8h_source.html#l00133">ast_manager_register</a>, <a class="el" href="module_8h_source.html#l00062">AST_MODULE_LOAD_DECLINE</a>, <a class="el" href="module_8h_source.html#l00065">AST_MODULE_LOAD_FAILURE</a>, <a class="el" href="lock_8h_source.html#l01692">ast_mutex_init()</a>, <a class="el" href="lock_8h_source.html#l00082">AST_PTHREADT_NULL</a>, <a class="el" href="module_8h_source.html#l00406">ast_register_application_xml</a>, <a class="el" href="stringfields_8h_source.html#l00241">ast_string_field_init</a>, <a class="el" href="stringfields_8h_source.html#l00285">ast_string_field_set</a>, <a class="el" href="pbx__gtkconsole_8c_source.html#l00054">inuse</a>, <a class="el" href="app__meetme_8c_source.html#l00842">lock</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="cdr__adaptive__odbc_8c_source.html#l00053">name</a>, and <a class="el" href="chan__dahdi_8c_source.html#l17079">setup_dahdi()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l17309"></a>17309 {
<a name="l17310"></a>17310    <span class="keywordtype">int</span> res;
<a name="l17311"></a>17311 <span class="preprocessor">#if defined(HAVE_PRI) || defined(HAVE_SS7)</span>
<a name="l17312"></a>17312 <span class="preprocessor"></span>   <span class="keywordtype">int</span> y, i;
<a name="l17313"></a>17313 <span class="preprocessor">#endif</span>
<a name="l17314"></a>17314 <span class="preprocessor"></span>
<a name="l17315"></a>17315 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l17316"></a>17316 <span class="preprocessor"></span>   memset(pris, 0, <span class="keyword">sizeof</span>(pris));
<a name="l17317"></a>17317    <span class="keywordflow">for</span> (y = 0; y &lt; <a class="code" href="chan__dahdi_8c.html#a80bfdd8adbffe226265cd729655a7268">NUM_SPANS</a>; y++) {
<a name="l17318"></a>17318       <a class="code" href="lock_8h.html#a5dc895fe6e8c089175159fc22e33fc3b">ast_mutex_init</a>(&amp;pris[y].<a class="code" href="app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l17319"></a>17319       pris[y].offset = -1;
<a name="l17320"></a>17320       pris[y].master = <a class="code" href="lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>;
<a name="l17321"></a>17321       <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="chan__dahdi_8c.html#aaad94eef7bd74293b956f6de74a62d0f">NUM_DCHANS</a>; i++)
<a name="l17322"></a>17322          pris[y].fds[i] = -1;
<a name="l17323"></a>17323    }
<a name="l17324"></a>17324    pri_set_error(dahdi_pri_error);
<a name="l17325"></a>17325    pri_set_message(dahdi_pri_message);
<a name="l17326"></a>17326    <a class="code" href="module_8h.html#afba4eb7a910b10969041ae4cd488729d" title="Register an application using XML documentation.">ast_register_application_xml</a>(dahdi_send_keypad_facility_app, dahdi_send_keypad_facility_exec);
<a name="l17327"></a>17327 <span class="preprocessor">#ifdef HAVE_PRI_PROG_W_CAUSE</span>
<a name="l17328"></a>17328 <span class="preprocessor"></span>   <a class="code" href="module_8h.html#afba4eb7a910b10969041ae4cd488729d" title="Register an application using XML documentation.">ast_register_application_xml</a>(dahdi_send_callrerouting_facility_app, dahdi_send_callrerouting_facility_exec);
<a name="l17329"></a>17329 <span class="preprocessor">#endif</span>
<a name="l17330"></a>17330 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l17331"></a>17331 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_SS7</span>
<a name="l17332"></a>17332 <span class="preprocessor"></span>   memset(linksets, 0, <span class="keyword">sizeof</span>(linksets));
<a name="l17333"></a>17333    <span class="keywordflow">for</span> (y = 0; y &lt; NUM_SPANS; y++) {
<a name="l17334"></a>17334       <a class="code" href="lock_8h.html#a5dc895fe6e8c089175159fc22e33fc3b">ast_mutex_init</a>(&amp;linksets[y].<a class="code" href="app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l17335"></a>17335       linksets[y].master = <a class="code" href="lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>;
<a name="l17336"></a>17336       <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="chan__dahdi_8c.html#aaad94eef7bd74293b956f6de74a62d0f">NUM_DCHANS</a>; i++)
<a name="l17337"></a>17337          linksets[y].fds[i] = -1;
<a name="l17338"></a>17338    }
<a name="l17339"></a>17339    ss7_set_error(dahdi_ss7_error);
<a name="l17340"></a>17340    ss7_set_message(dahdi_ss7_message);
<a name="l17341"></a>17341 <span class="preprocessor">#endif </span><span class="comment">/* HAVE_SS7 */</span>
<a name="l17342"></a>17342    res = <a class="code" href="chan__dahdi_8c.html#a90c93221b85857ca4af2b1097d267603">setup_dahdi</a>(0);
<a name="l17343"></a>17343    <span class="comment">/* Make sure we can register our DAHDI channel type */</span>
<a name="l17344"></a>17344    <span class="keywordflow">if</span> (res)
<a name="l17345"></a>17345       <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;
<a name="l17346"></a>17346    <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#ab5f3776fda943e52820ceeee5835c1b4" title="Register a channel technology (a new channel driver) Called by a channel module to...">ast_channel_register</a>(&amp;<a class="code" href="chan__dahdi_8c.html#abaaa1bdd4fa7ebb3e41873b18bda7170">dahdi_tech</a>)) {
<a name="l17347"></a>17347       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to register channel class &apos;DAHDI&apos;\n&quot;</span>);
<a name="l17348"></a>17348       <a class="code" href="chan__dahdi_8c.html#a2fd806029fe936c297e52d2236092fc0">__unload_module</a>();
<a name="l17349"></a>17349       <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfa8724da3ad620df86524280e760add388">AST_MODULE_LOAD_FAILURE</a>;
<a name="l17350"></a>17350    }
<a name="l17351"></a>17351 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l17352"></a>17352 <span class="preprocessor"></span>   <a class="code" href="stringfields_8h.html#a871274fa4fd2687c7a44849a84df3665" title="Initialize a field pool and fields.">ast_string_field_init</a>(&amp;<a class="code" href="pbx__gtkconsole_8c.html#a679cabe3b846f2e363f43d8e57433834">inuse</a>, 16);
<a name="l17353"></a>17353    <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(&amp;<a class="code" href="pbx__gtkconsole_8c.html#a679cabe3b846f2e363f43d8e57433834">inuse</a>, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="stringliteral">&quot;GR-303InUse&quot;</span>);
<a name="l17354"></a>17354    <a class="code" href="cli_8h.html#aadeef34f3106bb78aeb3414032ad7fb7" title="Register multiple commands.">ast_cli_register_multiple</a>(dahdi_pri_cli, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(dahdi_pri_cli));
<a name="l17355"></a>17355 <span class="preprocessor">#endif</span>
<a name="l17356"></a>17356 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_SS7</span>
<a name="l17357"></a>17357 <span class="preprocessor"></span>   <a class="code" href="cli_8h.html#aadeef34f3106bb78aeb3414032ad7fb7" title="Register multiple commands.">ast_cli_register_multiple</a>(dahdi_ss7_cli, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(dahdi_ss7_cli));
<a name="l17358"></a>17358 <span class="preprocessor">#endif</span>
<a name="l17359"></a>17359 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_OPENR2</span>
<a name="l17360"></a>17360 <span class="preprocessor"></span>   <a class="code" href="cli_8h.html#aadeef34f3106bb78aeb3414032ad7fb7" title="Register multiple commands.">ast_cli_register_multiple</a>(dahdi_mfcr2_cli, <span class="keyword">sizeof</span>(dahdi_mfcr2_cli)/<span class="keyword">sizeof</span>(dahdi_mfcr2_cli[0]));
<a name="l17361"></a>17361    <a class="code" href="module_8h.html#afba4eb7a910b10969041ae4cd488729d" title="Register an application using XML documentation.">ast_register_application_xml</a>(dahdi_accept_r2_call_app, dahdi_accept_r2_call_exec);
<a name="l17362"></a>17362 <span class="preprocessor">#endif</span>
<a name="l17363"></a>17363 <span class="preprocessor"></span>
<a name="l17364"></a>17364    <a class="code" href="cli_8h.html#aadeef34f3106bb78aeb3414032ad7fb7" title="Register multiple commands.">ast_cli_register_multiple</a>(<a class="code" href="chan__dahdi_8c.html#ad34f2f8582cb6f9118dbd230b6636f2d">dahdi_cli</a>, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="chan__dahdi_8c.html#ad34f2f8582cb6f9118dbd230b6636f2d">dahdi_cli</a>));
<a name="l17365"></a>17365 
<a name="l17366"></a>17366    memset(<a class="code" href="chan__dahdi_8c.html#ad0a20124e90818c18842fd086b848e65">round_robin</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="chan__dahdi_8c.html#ad0a20124e90818c18842fd086b848e65">round_robin</a>));
<a name="l17367"></a>17367    <a class="code" href="manager_8h.html#a24c8fe57053553be1a1458d4afe8909b" title="External routines may register/unregister manager callbacks this way.">ast_manager_register</a>( <span class="stringliteral">&quot;DAHDITransfer&quot;</span>, 0, <a class="code" href="chan__dahdi_8c.html#a742acb2daa27adb84742a69ce1f0c7e9">action_transfer</a>, <span class="stringliteral">&quot;Transfer DAHDI Channel&quot;</span> );
<a name="l17368"></a>17368    <a class="code" href="manager_8h.html#a24c8fe57053553be1a1458d4afe8909b" title="External routines may register/unregister manager callbacks this way.">ast_manager_register</a>( <span class="stringliteral">&quot;DAHDIHangup&quot;</span>, 0, <a class="code" href="chan__dahdi_8c.html#afc56ae0d7123c24f867eafcaaa3743ea">action_transferhangup</a>, <span class="stringliteral">&quot;Hangup DAHDI Channel&quot;</span> );
<a name="l17369"></a>17369    <a class="code" href="manager_8h.html#a24c8fe57053553be1a1458d4afe8909b" title="External routines may register/unregister manager callbacks this way.">ast_manager_register</a>( <span class="stringliteral">&quot;DAHDIDialOffhook&quot;</span>, 0, <a class="code" href="chan__dahdi_8c.html#af51603d74ba059c0bfc173b52e978686">action_dahdidialoffhook</a>, <span class="stringliteral">&quot;Dial over DAHDI channel while offhook&quot;</span> );
<a name="l17370"></a>17370    <a class="code" href="manager_8h.html#a24c8fe57053553be1a1458d4afe8909b" title="External routines may register/unregister manager callbacks this way.">ast_manager_register</a>( <span class="stringliteral">&quot;DAHDIDNDon&quot;</span>, 0, <a class="code" href="chan__dahdi_8c.html#a91c68fb8703f9429fea494a96d638f0d">action_dahdidndon</a>, <span class="stringliteral">&quot;Toggle DAHDI channel Do Not Disturb status ON&quot;</span> );
<a name="l17371"></a>17371    <a class="code" href="manager_8h.html#a24c8fe57053553be1a1458d4afe8909b" title="External routines may register/unregister manager callbacks this way.">ast_manager_register</a>( <span class="stringliteral">&quot;DAHDIDNDoff&quot;</span>, 0, <a class="code" href="chan__dahdi_8c.html#ad0866f57abaf118be36f09ed96ccdf07">action_dahdidndoff</a>, <span class="stringliteral">&quot;Toggle DAHDI channel Do Not Disturb status OFF&quot;</span> );
<a name="l17372"></a>17372    <a class="code" href="manager_8h.html#a24c8fe57053553be1a1458d4afe8909b" title="External routines may register/unregister manager callbacks this way.">ast_manager_register</a>(<span class="stringliteral">&quot;DAHDIShowChannels&quot;</span>, 0, <a class="code" href="chan__dahdi_8c.html#a9f7e1b7dfbfbc2a04b02e6bf9376fc6c">action_dahdishowchannels</a>, <span class="stringliteral">&quot;Show status DAHDI channels&quot;</span>);
<a name="l17373"></a>17373    <a class="code" href="manager_8h.html#a24c8fe57053553be1a1458d4afe8909b" title="External routines may register/unregister manager callbacks this way.">ast_manager_register</a>(<span class="stringliteral">&quot;DAHDIRestart&quot;</span>, 0, <a class="code" href="chan__dahdi_8c.html#acc92e8b12c791b7815e25d5a8451208f">action_dahdirestart</a>, <span class="stringliteral">&quot;Fully Restart DAHDI channels (terminates calls)&quot;</span>);
<a name="l17374"></a>17374 
<a name="l17375"></a>17375    <a class="code" href="lock_8h.html#a21f75f462115427718d78aa66cc61f9b">ast_cond_init</a>(&amp;<a class="code" href="chan__dahdi_8c.html#aa0eccd1394a26a586074c22fe8d0ff43">ss_thread_complete</a>, NULL);
<a name="l17376"></a>17376 
<a name="l17377"></a>17377    <span class="keywordflow">return</span> res;
<a name="l17378"></a>17378 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa7f4f5b8e2e3a682de5734874521d060"></a><!-- doxytag: member="chan_dahdi.c::mkintf" ref="aa7f4f5b8e2e3a682de5734874521d060" args="(int channel, const struct dahdi_chan_conf *conf, struct dahdi_pri *pri, int reloading)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a>* mkintf </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>channel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structdahdi__chan__conf.html">dahdi_chan_conf</a> *&nbsp;</td>
          <td class="paramname"> <em>conf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct dahdi_pri *&nbsp;</td>
          <td class="paramname"> <em>pri</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>reloading</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l09990">9990</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="chan__dahdi_8c_source.html#l01120">dahdi_pvt::accountcode</a>, <a class="el" href="chan__dahdi_8c_source.html#l00691">dahdi_pvt::adsi</a>, <a class="el" href="chan__dahdi_8c_source.html#l01121">dahdi_pvt::amaflags</a>, <a class="el" href="chan__dahdi_8c_source.html#l00697">dahdi_pvt::answeronpolarityswitch</a>, <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="dsp_8c_source.html#l01628">ast_dsp_set_digitmode()</a>, <a class="el" href="event__defs_8h_source.html#l00115">AST_EVENT_IE_CONTEXT</a>, <a class="el" href="event__defs_8h_source.html#l00058">AST_EVENT_IE_END</a>, <a class="el" href="event__defs_8h_source.html#l00077">AST_EVENT_IE_MAILBOX</a>, <a class="el" href="event__defs_8h_source.html#l00065">AST_EVENT_IE_NEWMSGS</a>, <a class="el" href="event__defs_8h_source.html#l00133">AST_EVENT_IE_PLTYPE_EXISTS</a>, <a class="el" href="event__defs_8h_source.html#l00137">AST_EVENT_IE_PLTYPE_STR</a>, <a class="el" href="event__defs_8h_source.html#l00040">AST_EVENT_MWI</a>, <a class="el" href="event_8c_source.html#l00680">ast_event_subscribe()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01692">ast_mutex_init()</a>, <a class="el" href="res__smdi_8c_source.html#l00528">ast_smdi_interface_find()</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="config_8c_source.html#l00223">ast_variable_new()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00662">dahdi_pvt::buf_no</a>, <a class="el" href="chan__dahdi_8c_source.html#l00663">dahdi_pvt::buf_policy</a>, <a class="el" href="chan__dahdi_8c_source.html#l00661">dahdi_pvt::bufsize</a>, <a class="el" href="chan__dahdi_8c_source.html#l01099">dahdi_pvt::busy_quietlength</a>, <a class="el" href="chan__dahdi_8c_source.html#l01094">dahdi_pvt::busy_tonelength</a>, <a class="el" href="chan__dahdi_8c_source.html#l01089">dahdi_pvt::busycount</a>, <a class="el" href="chan__dahdi_8c_source.html#l00703">dahdi_pvt::busydetect</a>, <a class="el" href="chan__dahdi_8c_source.html#l01030">dahdi_pvt::callgroup</a>, <a class="el" href="chan__dahdi_8c_source.html#l01104">dahdi_pvt::callprogress</a>, <a class="el" href="chan__dahdi_8c_source.html#l00709">dahdi_pvt::callreturn</a>, <a class="el" href="chan__dahdi_8c_source.html#l00716">dahdi_pvt::callwaiting</a>, <a class="el" href="chan__dahdi_8c_source.html#l00721">dahdi_pvt::callwaitingcallerid</a>, <a class="el" href="chan__dahdi_8c_source.html#l00728">dahdi_pvt::cancallforward</a>, <a class="el" href="chan__dahdi_8c_source.html#l00733">dahdi_pvt::canpark</a>, <a class="el" href="chan__dahdi_8c_source.html#l01243">dahdi_chan_conf::chan</a>, <a class="el" href="chan__dahdi_8c_source.html#l00277">CHAN_PSEUDO</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="chan__dahdi_8c_source.html#l01001">dahdi_pvt::cid_name</a>, <a class="el" href="chan__dahdi_8c_source.html#l00997">dahdi_pvt::cid_num</a>, <a class="el" href="chan__dahdi_8c_source.html#l00676">dahdi_pvt::cid_rxgain</a>, <a class="el" href="callerid_8h_source.html#l00061">CID_SIG_SMDI</a>, <a class="el" href="chan__dahdi_8c_source.html#l01044">dahdi_pvt::cid_signalling</a>, <a class="el" href="chan__dahdi_8c_source.html#l01045">dahdi_pvt::cid_start</a>, <a class="el" href="chan__dahdi_8c_source.html#l00999">dahdi_pvt::cid_ton</a>, <a class="el" href="chan__dahdi_8c_source.html#l01023">dahdi_pvt::confno</a>, <a class="el" href="chan__alsa_8c_source.html#l00105">context</a>, <a class="el" href="chan__dahdi_8c_source.html#l00967">dahdi_pvt::context</a>, <a class="el" href="chan__dahdi_8c_source.html#l02090">dahdi_open()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02863">dahdi_set_hook()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00877">dahdi_pvt::dahditrcallerid</a>, <a class="el" href="chan__dahdi_8c_source.html#l00971">dahdi_pvt::defcontext</a>, <a class="el" href="chan__dahdi_8c_source.html#l00740">dahdi_pvt::destroy</a>, <a class="el" href="chan__dahdi_8c_source.html#l03856">destroy_dahdi_pvt()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="chan__dahdi_8c_source.html#l00961">dahdi_pvt::drings</a>, <a class="el" href="chan__dahdi_8c_source.html#l01113">dahdi_pvt::dsp</a>, <a class="el" href="dsp_8h_source.html#l00031">DSP_DIGITMODE_DTMF</a>, <a class="el" href="chan__dahdi_8c_source.html#l01147">dahdi_pvt::dtmfrelax</a>, <a class="el" href="chan__dahdi_8c_source.html#l00757">dahdi_pvt::echocanbridged</a>, <a class="el" href="structdahdi__pvt.html#a12f1128b223526997d1601ee6e33325d">dahdi_pvt::echocancel</a>, <a class="el" href="chan__dahdi_8c_source.html#l01082">dahdi_pvt::echotraining</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="chan__dahdi_8c_source.html#l00664">dahdi_pvt::faxbuf_no</a>, <a class="el" href="chan__dahdi_8c_source.html#l00665">dahdi_pvt::faxbuf_policy</a>, <a class="el" href="config_8h_source.html#l00079">ast_variable::file</a>, <a class="el" href="chan__dahdi_8c_source.html#l00767">dahdi_pvt::firstradio</a>, <a class="el" href="astmm_8h_source.html#l00084">free</a>, <a class="el" href="chan__dahdi_8c_source.html#l01137">dahdi_pvt::fxsoffhookstate</a>, <a class="el" href="chan__dahdi_8c_source.html#l05580">get_alarms()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01020">dahdi_pvt::group</a>, <a class="el" href="chan__dahdi_8c_source.html#l05688">handle_alarms()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00772">dahdi_pvt::hanguponpolarityswitch</a>, <a class="el" href="chan__dahdi_8c_source.html#l01075">dahdi_pvt::head</a>, <a class="el" href="chan__dahdi_8c_source.html#l00781">dahdi_pvt::hidecallerid</a>, <a class="el" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>, <a class="el" href="chan__dahdi_8c_source.html#l00795">dahdi_pvt::immediate</a>, <a class="el" href="chan__dahdi_8c_source.html#l00797">dahdi_pvt::inalarm</a>, <a class="el" href="chan__dahdi_8c_source.html#l00907">dahdi_pvt::inservice</a>, <a class="el" href="chan__dahdi_8c_source.html#l01256">dahdi_chan_conf::is_sig_auto</a>, <a class="el" href="chan__dahdi_8c_source.html#l00978">dahdi_pvt::language</a>, <a class="el" href="chan__dahdi_8c_source.html#l01022">dahdi_pvt::law</a>, <a class="el" href="chan__dahdi_8c_source.html#l00912">dahdi_pvt::locallyblocked</a>, <a class="el" href="chan__dahdi_8c_source.html#l00649">dahdi_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__mgcp_8c_source.html#l00185">mailbox</a>, <a class="el" href="chan__dahdi_8c_source.html#l01129">dahdi_pvt::mailbox</a>, <a class="el" href="chan__dahdi_8c_source.html#l00275">MAX_CHANNELS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00983">dahdi_pvt::mohinterpret</a>, <a class="el" href="chan__dahdi_8c_source.html#l00988">dahdi_pvt::mohsuggest</a>, <a class="el" href="chan__dahdi_8c_source.html#l01139">dahdi_pvt::msgstate</a>, <a class="el" href="chan__dahdi_8c_source.html#l00367">mwi_event_cb()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01131">dahdi_pvt::mwi_event_sub</a>, <a class="el" href="chan__dahdi_8c_source.html#l00892">dahdi_pvt::mwimonitor_fsk</a>, <a class="el" href="chan__dahdi_8c_source.html#l00887">dahdi_pvt::mwimonitor_neon</a>, <a class="el" href="chan__dahdi_8c_source.html#l00898">dahdi_pvt::mwimonitor_rpas</a>, <a class="el" href="config_8h_source.html#l00075">ast_variable::name</a>, <a class="el" href="config_8h_source.html#l00077">ast_variable::next</a>, <a class="el" href="chan__dahdi_8c_source.html#l00682">dahdi_pvt::next</a>, <a class="el" href="chan__dahdi_8c_source.html#l01135">dahdi_pvt::onhooktime</a>, <a class="el" href="chan__dahdi_8c_source.html#l00672">dahdi_pvt::outsigmod</a>, <a class="el" href="chan__dahdi_8c_source.html#l00989">dahdi_pvt::parkinglot</a>, <a class="el" href="chan__dahdi_8c_source.html#l00808">dahdi_pvt::permcallwaiting</a>, <a class="el" href="chan__dahdi_8c_source.html#l00813">dahdi_pvt::permhidecallerid</a>, <a class="el" href="chan__dahdi_8c_source.html#l01035">dahdi_pvt::pickupgroup</a>, <a class="el" href="chan__dahdi_8c_source.html#l01154">dahdi_pvt::polarityonanswerdelay</a>, <a class="el" href="chan__dahdi_8c_source.html#l00683">dahdi_pvt::prev</a>, <a class="el" href="chan__dahdi_8c_source.html#l00823">dahdi_pvt::priexclusive</a>, <a class="el" href="chan__dahdi_8c_source.html#l00818">dahdi_pvt::priindication_oob</a>, <a class="el" href="chan__dahdi_8c_source.html#l01025">dahdi_pvt::propconfno</a>, <a class="el" href="chan__dahdi_8c_source.html#l00828">dahdi_pvt::pulse</a>, <a class="el" href="chan__dahdi_8c_source.html#l00671">dahdi_pvt::radio</a>, <a class="el" href="chan__dahdi_8c_source.html#l00590">distRingData::range</a>, <a class="el" href="chan__dahdi_8c_source.html#l00917">dahdi_pvt::remotelyblocked</a>, <a class="el" href="chan__dahdi_8c_source.html#l00837">dahdi_pvt::restrictcid</a>, <a class="el" href="chan__dahdi_8c_source.html#l00596">dahdi_distRings::ringnum</a>, <a class="el" href="chan__dahdi_8c_source.html#l01061">dahdi_pvt::ringt_base</a>, <a class="el" href="chan__dahdi_8c_source.html#l00678">dahdi_pvt::rxgain</a>, <a class="el" href="chan__dahdi_8c_source.html#l01161">dahdi_pvt::sendcalleridafter</a>, <a class="el" href="chan__dahdi_8c_source.html#l02831">set_actual_gain()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00666">dahdi_pvt::sig</a>, <a class="el" href="chan__dahdi_8c_source.html#l02476">sig2str</a>, <a class="el" href="chan__dahdi_8c_source.html#l00256">SIG_BRI</a>, <a class="el" href="chan__dahdi_8c_source.html#l00257">SIG_BRI_PTMP</a>, <a class="el" href="chan__dahdi_8c_source.html#l00245">SIG_E911</a>, <a class="el" href="chan__dahdi_8c_source.html#l00240">SIG_EM</a>, <a class="el" href="chan__dahdi_8c_source.html#l00265">SIG_EM_E1</a>, <a class="el" href="chan__dahdi_8c_source.html#l00241">SIG_EMWINK</a>, <a class="el" href="chan__dahdi_8c_source.html#l00244">SIG_FEATB</a>, <a class="el" href="chan__dahdi_8c_source.html#l00242">SIG_FEATD</a>, <a class="el" href="chan__dahdi_8c_source.html#l00243">SIG_FEATDMF</a>, <a class="el" href="chan__dahdi_8c_source.html#l00246">SIG_FEATDMF_TA</a>, <a class="el" href="chan__dahdi_8c_source.html#l00247">SIG_FGC_CAMA</a>, <a class="el" href="chan__dahdi_8c_source.html#l00248">SIG_FGC_CAMAMF</a>, <a class="el" href="chan__dahdi_8c_source.html#l00253">SIG_FXOGS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00254">SIG_FXOKS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00252">SIG_FXOLS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00251">SIG_FXSKS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00249">SIG_FXSLS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00266">SIG_GR303FXOKS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00267">SIG_GR303FXSKS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00259">SIG_MFCR2</a>, <a class="el" href="chan__dahdi_8c_source.html#l00255">SIG_PRI</a>, <a class="el" href="chan__dahdi_8c_source.html#l00260">SIG_SF</a>, <a class="el" href="chan__dahdi_8c_source.html#l00264">SIG_SF_FEATB</a>, <a class="el" href="chan__dahdi_8c_source.html#l00262">SIG_SF_FEATD</a>, <a class="el" href="chan__dahdi_8c_source.html#l00263">SIG_SF_FEATDMF</a>, <a class="el" href="chan__dahdi_8c_source.html#l00261">SIG_SFWINK</a>, <a class="el" href="chan__dahdi_8c_source.html#l00258">SIG_SS7</a>, <a class="el" href="chan__dahdi_8c_source.html#l09985">sigtype_to_signalling()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00958">dahdi_pvt::smdi_iface</a>, <a class="el" href="chan__dahdi_8c_source.html#l01262">dahdi_chan_conf::smdi_port</a>, <a class="el" href="chan__dahdi_8c_source.html#l01042">dahdi_pvt::span</a>, <a class="el" href="chan__dahdi_8c_source.html#l01068">dahdi_pvt::stripmsd</a>, <a class="el" href="agi_2strcompat_8c_source.html#l00027">strsep()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>, <a class="el" href="chan__dahdi_8c_source.html#l00842">dahdi_pvt::threewaycalling</a>, <a class="el" href="chan__dahdi_8c_source.html#l01255">dahdi_chan_conf::timing</a>, <a class="el" href="chan__dahdi_8c_source.html#l00681">dahdi_pvt::tonezone</a>, <a class="el" href="chan__dahdi_8c_source.html#l00851">dahdi_pvt::transfer</a>, <a class="el" href="chan__dahdi_8c_source.html#l00882">dahdi_pvt::transfertobusy</a>, <a class="el" href="chan__dahdi_8c_source.html#l00680">dahdi_pvt::txgain</a>, <a class="el" href="chan__dahdi_8c_source.html#l02604">update_conf()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00859">dahdi_pvt::use_callerid</a>, <a class="el" href="chan__dahdi_8c_source.html#l00866">dahdi_pvt::use_callingpres</a>, <a class="el" href="chan__dahdi_8c_source.html#l00955">dahdi_pvt::use_smdi</a>, <a class="el" href="chan__dahdi_8c_source.html#l00872">dahdi_pvt::usedistinctiveringdetection</a>, <a class="el" href="chan__dahdi_8c_source.html#l00763">dahdi_pvt::usefaxbuffers</a>, <a class="el" href="config_8h_source.html#l00076">ast_variable::value</a>, <a class="el" href="chan__dahdi_8c_source.html#l01040">dahdi_pvt::vars</a>, and <a class="el" href="chan__dahdi_8c_source.html#l01109">dahdi_pvt::waitfordialtone</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l15948">build_channels()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09991"></a>09991 {
<a name="l09992"></a>09992    <span class="comment">/* Make a dahdi_pvt structure for this interface (or CRV if &quot;pri&quot; is specified) */</span>
<a name="l09993"></a>09993    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *tmp = NULL, *tmp2, *<a class="code" href="structdahdi__pvt.html#abba5e5e1dcf19b4ded5000d926e0a70d">prev</a> = NULL;
<a name="l09994"></a>09994    <span class="keywordtype">char</span> fn[80];
<a name="l09995"></a>09995    <span class="keyword">struct </span>dahdi_bufferinfo bi;
<a name="l09996"></a>09996 
<a name="l09997"></a>09997    <span class="keywordtype">int</span> res;
<a name="l09998"></a>09998    <span class="keywordtype">int</span> span = 0;
<a name="l09999"></a>09999    <span class="keywordtype">int</span> here = 0;
<a name="l10000"></a>10000    <span class="keywordtype">int</span> x;
<a name="l10001"></a>10001    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> **wlist;
<a name="l10002"></a>10002    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> **wend;
<a name="l10003"></a>10003    <span class="keyword">struct </span>dahdi_params p;
<a name="l10004"></a>10004 
<a name="l10005"></a>10005    wlist = &amp;<a class="code" href="chan__dahdi_8c.html#a38bc838f6d206eef6a7a7ca87f5848e7">iflist</a>;
<a name="l10006"></a>10006    wend = &amp;<a class="code" href="chan__dahdi_8c.html#af06d42bbf0081c1eb058b893305b4e85">ifend</a>;
<a name="l10007"></a>10007 
<a name="l10008"></a>10008 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l10009"></a>10009 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (pri) {
<a name="l10010"></a>10010       wlist = &amp;pri-&gt;crvs;
<a name="l10011"></a>10011       wend = &amp;pri-&gt;crvend;
<a name="l10012"></a>10012    }
<a name="l10013"></a>10013 <span class="preprocessor">#endif</span>
<a name="l10014"></a>10014 <span class="preprocessor"></span>
<a name="l10015"></a>10015    tmp2 = *wlist;
<a name="l10016"></a>10016    prev = NULL;
<a name="l10017"></a>10017 
<a name="l10018"></a>10018    <span class="keywordflow">while</span> (tmp2) {
<a name="l10019"></a>10019       <span class="keywordflow">if</span> (!tmp2-&gt;destroy) {
<a name="l10020"></a>10020          <span class="keywordflow">if</span> (tmp2-&gt;channel == channel) {
<a name="l10021"></a>10021             tmp = tmp2;
<a name="l10022"></a>10022             here = 1;
<a name="l10023"></a>10023             <span class="keywordflow">break</span>;
<a name="l10024"></a>10024          }
<a name="l10025"></a>10025          <span class="keywordflow">if</span> (tmp2-&gt;channel &gt; channel) {
<a name="l10026"></a>10026             <span class="keywordflow">break</span>;
<a name="l10027"></a>10027          }
<a name="l10028"></a>10028       }
<a name="l10029"></a>10029       prev = tmp2;
<a name="l10030"></a>10030       tmp2 = tmp2-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>;
<a name="l10031"></a>10031    }
<a name="l10032"></a>10032 
<a name="l10033"></a>10033    <span class="keywordflow">if</span> (!here &amp;&amp; reloading != 1) {
<a name="l10034"></a>10034       <span class="keywordflow">if</span> (!(tmp = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*tmp)))) {
<a name="l10035"></a>10035          <span class="keywordflow">if</span> (tmp)
<a name="l10036"></a>10036             <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(tmp);
<a name="l10037"></a>10037          <span class="keywordflow">return</span> NULL;
<a name="l10038"></a>10038       }
<a name="l10039"></a>10039       <a class="code" href="lock_8h.html#a5dc895fe6e8c089175159fc22e33fc3b">ast_mutex_init</a>(&amp;tmp-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l10040"></a>10040       <a class="code" href="chan__dahdi_8c.html#af7b23639f050bf4be75e75d2a11cefc9">ifcount</a>++;
<a name="l10041"></a>10041       <span class="keywordflow">for</span> (x = 0; x &lt; 3; x++)
<a name="l10042"></a>10042          tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[x].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a> = -1;
<a name="l10043"></a>10043       tmp-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a> = channel;
<a name="l10044"></a>10044       tmp-&gt;<a class="code" href="structdahdi__pvt.html#ab7d3c3f03d40ad5cea4721e94cb64e40" title="TRUE if PRI congestion/busy indications are sent out-of-band.">priindication_oob</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ab7d3c3f03d40ad5cea4721e94cb64e40" title="TRUE if PRI congestion/busy indications are sent out-of-band.">priindication_oob</a>;
<a name="l10045"></a>10045    }
<a name="l10046"></a>10046 
<a name="l10047"></a>10047    <span class="keywordflow">if</span> (tmp) {
<a name="l10048"></a>10048       <span class="keywordtype">int</span> chan_sig = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a>;
<a name="l10049"></a>10049       <span class="keywordflow">if</span> (!here) {
<a name="l10050"></a>10050          <span class="keywordflow">if</span> ((channel != <a class="code" href="chan__dahdi_8c.html#ada02a3fa3d2da06560df664c7228a559">CHAN_PSEUDO</a>) &amp;&amp; !pri) {
<a name="l10051"></a>10051             <span class="keywordtype">int</span> count = 0;
<a name="l10052"></a>10052             snprintf(fn, <span class="keyword">sizeof</span>(fn), <span class="stringliteral">&quot;%d&quot;</span>, channel);
<a name="l10053"></a>10053             <span class="comment">/* Open non-blocking */</span>
<a name="l10054"></a>10054             tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a> = <a class="code" href="chan__dahdi_8c.html#a5be3d201f917ed02d9a08749cd673191">dahdi_open</a>(fn);
<a name="l10055"></a>10055             <span class="keywordflow">while</span> (tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a> &lt; 0 &amp;&amp; reloading == 2 &amp;&amp; count &lt; 1000) { <span class="comment">/* the kernel may not call dahdi_release fast enough for the open flagbit to be cleared in time */</span>
<a name="l10056"></a>10056                usleep(1);
<a name="l10057"></a>10057                tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a> = <a class="code" href="chan__dahdi_8c.html#a5be3d201f917ed02d9a08749cd673191">dahdi_open</a>(fn);
<a name="l10058"></a>10058                count++;
<a name="l10059"></a>10059             }
<a name="l10060"></a>10060             <span class="comment">/* Allocate a DAHDI structure */</span>
<a name="l10061"></a>10061             <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a> &lt; 0) {
<a name="l10062"></a>10062                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to open channel %d: %s\nhere = %d, tmp-&gt;channel = %d, channel = %d\n&quot;</span>, channel, strerror(errno), here, tmp-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, channel);
<a name="l10063"></a>10063                <a class="code" href="chan__dahdi_8c.html#a9db88392ac10cee3a3116d1f7f4aae5f">destroy_dahdi_pvt</a>(&amp;tmp);
<a name="l10064"></a>10064                <span class="keywordflow">return</span> NULL;
<a name="l10065"></a>10065             }
<a name="l10066"></a>10066             memset(&amp;p, 0, <span class="keyword">sizeof</span>(p));
<a name="l10067"></a>10067             res = ioctl(tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_GET_PARAMS, &amp;p);
<a name="l10068"></a>10068             <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l10069"></a>10069                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to get parameters: %s\n&quot;</span>, strerror(errno));
<a name="l10070"></a>10070                <a class="code" href="chan__dahdi_8c.html#a9db88392ac10cee3a3116d1f7f4aae5f">destroy_dahdi_pvt</a>(&amp;tmp);
<a name="l10071"></a>10071                <span class="keywordflow">return</span> NULL;
<a name="l10072"></a>10072             }
<a name="l10073"></a>10073             <span class="keywordflow">if</span> (conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a26ed3f8f070e4f51214b5370ad43d650">is_sig_auto</a>)
<a name="l10074"></a>10074                chan_sig = <a class="code" href="chan__dahdi_8c.html#a898cf004da2556cf2cdd9119a6fcb7e8">sigtype_to_signalling</a>(p.sigtype);
<a name="l10075"></a>10075             <span class="keywordflow">if</span> (p.sigtype != (chan_sig &amp; 0x3ffff)) {
<a name="l10076"></a>10076                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Signalling requested on channel %d is %s but line is in %s signalling\n&quot;</span>, channel, <a class="code" href="chan__dahdi_8c.html#ac36e4cc782493e37064405666f5e4fdd">sig2str</a>(chan_sig), <a class="code" href="chan__dahdi_8c.html#ac36e4cc782493e37064405666f5e4fdd">sig2str</a>(p.sigtype));
<a name="l10077"></a>10077                <a class="code" href="chan__dahdi_8c.html#a9db88392ac10cee3a3116d1f7f4aae5f">destroy_dahdi_pvt</a>(&amp;tmp);
<a name="l10078"></a>10078                <span class="keywordflow">return</span> NULL;
<a name="l10079"></a>10079             }
<a name="l10080"></a>10080             tmp-&gt;<a class="code" href="structdahdi__pvt.html#a17dd7b17c0e736754e01e575ca8d8cb8" title="Active PCM encoding format: DAHDI_LAW_ALAW or DAHDI_LAW_MULAW.">law</a> = p.curlaw;
<a name="l10081"></a>10081             tmp-&gt;<a class="code" href="structdahdi__pvt.html#a63fc22149930803b4e3fb4c453177e5e">span</a> = p.spanno;
<a name="l10082"></a>10082             span = p.spanno - 1;
<a name="l10083"></a>10083          } <span class="keywordflow">else</span> {
<a name="l10084"></a>10084             <span class="keywordflow">if</span> (channel == <a class="code" href="chan__dahdi_8c.html#ada02a3fa3d2da06560df664c7228a559">CHAN_PSEUDO</a>)
<a name="l10085"></a>10085                chan_sig = 0;
<a name="l10086"></a>10086             <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((chan_sig != <a class="code" href="chan__dahdi_8c.html#a7c9b3bb8225896ff2b9aed27e6f80f10">SIG_FXOKS</a>) &amp;&amp; (chan_sig != <a class="code" href="chan__dahdi_8c.html#a38139ec369c0243f4324eb4eb0c2f004">SIG_FXSKS</a>)) {
<a name="l10087"></a>10087                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;CRV&apos;s must use FXO/FXS Kewl Start (fxo_ks/fxs_ks) signalling only.\n&quot;</span>);
<a name="l10088"></a>10088                <span class="keywordflow">return</span> NULL;
<a name="l10089"></a>10089             }
<a name="l10090"></a>10090          }
<a name="l10091"></a>10091 <span class="preprocessor">#ifdef HAVE_SS7</span>
<a name="l10092"></a>10092 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (chan_sig == <a class="code" href="chan__dahdi_8c.html#aadcda889db3cf9dfe757dbc1d4d8311a">SIG_SS7</a>) {
<a name="l10093"></a>10093             <span class="keyword">struct </span>dahdi_ss7 *ss7;
<a name="l10094"></a>10094             <span class="keywordtype">int</span> clear = 0;
<a name="l10095"></a>10095             <span class="keywordflow">if</span> (ioctl(tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_AUDIOMODE, &amp;clear)) {
<a name="l10096"></a>10096                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to set clear mode on clear channel %d of span %d: %s\n&quot;</span>, channel, p.spanno, strerror(errno));
<a name="l10097"></a>10097                <a class="code" href="chan__dahdi_8c.html#a9db88392ac10cee3a3116d1f7f4aae5f">destroy_dahdi_pvt</a>(&amp;tmp);
<a name="l10098"></a>10098                <span class="keywordflow">return</span> NULL;
<a name="l10099"></a>10099             }
<a name="l10100"></a>10100 
<a name="l10101"></a>10101             ss7 = ss7_resolve_linkset(cur_linkset);
<a name="l10102"></a>10102             <span class="keywordflow">if</span> (!ss7) {
<a name="l10103"></a>10103                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to find linkset %d\n&quot;</span>, cur_linkset);
<a name="l10104"></a>10104                <a class="code" href="chan__dahdi_8c.html#a9db88392ac10cee3a3116d1f7f4aae5f">destroy_dahdi_pvt</a>(&amp;tmp);
<a name="l10105"></a>10105                <span class="keywordflow">return</span> NULL;
<a name="l10106"></a>10106             }
<a name="l10107"></a>10107             <span class="keywordflow">if</span> (cur_cicbeginswith &lt; 0) {
<a name="l10108"></a>10108                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Need to set cicbeginswith for the channels!\n&quot;</span>);
<a name="l10109"></a>10109                <a class="code" href="chan__dahdi_8c.html#a9db88392ac10cee3a3116d1f7f4aae5f">destroy_dahdi_pvt</a>(&amp;tmp);
<a name="l10110"></a>10110                <span class="keywordflow">return</span> NULL;
<a name="l10111"></a>10111             }
<a name="l10112"></a>10112 
<a name="l10113"></a>10113             tmp-&gt;cic = cur_cicbeginswith++;
<a name="l10114"></a>10114 
<a name="l10115"></a>10115             <span class="comment">/* DB: Add CIC&apos;s DPC information */</span>
<a name="l10116"></a>10116             tmp-&gt;dpc = cur_defaultdpc;
<a name="l10117"></a>10117 
<a name="l10118"></a>10118             tmp-&gt;ss7 = ss7;
<a name="l10119"></a>10119             tmp-&gt;ss7call = NULL;
<a name="l10120"></a>10120             ss7-&gt;pvts[ss7-&gt;numchans++] = tmp;
<a name="l10121"></a>10121 
<a name="l10122"></a>10122             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(ss7-&gt;internationalprefix, conf-&gt;ss7.internationalprefix, <span class="keyword">sizeof</span>(ss7-&gt;internationalprefix));
<a name="l10123"></a>10123             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(ss7-&gt;nationalprefix, conf-&gt;ss7.nationalprefix, <span class="keyword">sizeof</span>(ss7-&gt;nationalprefix));
<a name="l10124"></a>10124             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(ss7-&gt;subscriberprefix, conf-&gt;ss7.subscriberprefix, <span class="keyword">sizeof</span>(ss7-&gt;subscriberprefix));
<a name="l10125"></a>10125             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(ss7-&gt;unknownprefix, conf-&gt;ss7.unknownprefix, <span class="keyword">sizeof</span>(ss7-&gt;unknownprefix));
<a name="l10126"></a>10126 
<a name="l10127"></a>10127             ss7-&gt;called_nai = conf-&gt;ss7.called_nai;
<a name="l10128"></a>10128             ss7-&gt;calling_nai = conf-&gt;ss7.calling_nai;
<a name="l10129"></a>10129          }
<a name="l10130"></a>10130 <span class="preprocessor">#endif</span>
<a name="l10131"></a>10131 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_OPENR2</span>
<a name="l10132"></a>10132 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (chan_sig == <a class="code" href="chan__dahdi_8c.html#a1d73a98ae12601287580dedd9a6d739b">SIG_MFCR2</a> &amp;&amp; reloading != 1) {
<a name="l10133"></a>10133             <span class="keyword">struct </span>dahdi_mfcr2 *r2_link;
<a name="l10134"></a>10134             r2_link = dahdi_r2_get_link();
<a name="l10135"></a>10135             <span class="keywordflow">if</span> (!r2_link) {
<a name="l10136"></a>10136                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Cannot get another R2 DAHDI context!\n&quot;</span>);
<a name="l10137"></a>10137                <a class="code" href="chan__dahdi_8c.html#a9db88392ac10cee3a3116d1f7f4aae5f">destroy_dahdi_pvt</a>(&amp;tmp);
<a name="l10138"></a>10138                <span class="keywordflow">return</span> NULL;
<a name="l10139"></a>10139             }
<a name="l10140"></a>10140             <span class="keywordflow">if</span> (!r2_link-&gt;protocol_context &amp;&amp; dahdi_r2_set_context(r2_link, conf)) {
<a name="l10141"></a>10141                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Cannot create OpenR2 protocol context.\n&quot;</span>);
<a name="l10142"></a>10142                <a class="code" href="chan__dahdi_8c.html#a9db88392ac10cee3a3116d1f7f4aae5f">destroy_dahdi_pvt</a>(&amp;tmp);
<a name="l10143"></a>10143                <span class="keywordflow">return</span> NULL;
<a name="l10144"></a>10144             }
<a name="l10145"></a>10145             <span class="keywordflow">if</span> (r2_link-&gt;numchans == (<span class="keyword">sizeof</span>(r2_link-&gt;pvts)/<span class="keyword">sizeof</span>(r2_link-&gt;pvts[0]))) {
<a name="l10146"></a>10146                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Cannot add more channels to this link!\n&quot;</span>);
<a name="l10147"></a>10147                <a class="code" href="chan__dahdi_8c.html#a9db88392ac10cee3a3116d1f7f4aae5f">destroy_dahdi_pvt</a>(&amp;tmp);
<a name="l10148"></a>10148                <span class="keywordflow">return</span> NULL;
<a name="l10149"></a>10149             }
<a name="l10150"></a>10150             r2_link-&gt;pvts[r2_link-&gt;numchans++] = tmp;
<a name="l10151"></a>10151             tmp-&gt;r2chan = openr2_chan_new_from_fd(r2_link-&gt;protocol_context,
<a name="l10152"></a>10152                                         tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>,
<a name="l10153"></a>10153                                         NULL, NULL);
<a name="l10154"></a>10154             <span class="keywordflow">if</span> (!tmp-&gt;r2chan) {
<a name="l10155"></a>10155                openr2_liberr_t err = openr2_context_get_last_error(r2_link-&gt;protocol_context);
<a name="l10156"></a>10156                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Cannot create OpenR2 channel: %s\n&quot;</span>, openr2_context_error_string(err));
<a name="l10157"></a>10157                <a class="code" href="chan__dahdi_8c.html#a9db88392ac10cee3a3116d1f7f4aae5f">destroy_dahdi_pvt</a>(&amp;tmp);
<a name="l10158"></a>10158                <span class="keywordflow">return</span> NULL;
<a name="l10159"></a>10159             }
<a name="l10160"></a>10160             tmp-&gt;mfcr2 = r2_link;
<a name="l10161"></a>10161             <span class="keywordflow">if</span> (conf-&gt;mfcr2.call_files) {
<a name="l10162"></a>10162                openr2_chan_enable_call_files(tmp-&gt;r2chan);
<a name="l10163"></a>10163             }
<a name="l10164"></a>10164             openr2_chan_set_client_data(tmp-&gt;r2chan, tmp);
<a name="l10165"></a>10165             <span class="comment">/* cast seems to be needed to get rid of the annoying warning regarding format attribute  */</span>
<a name="l10166"></a>10166             openr2_chan_set_logging_func(tmp-&gt;r2chan, (openr2_logging_func_t)dahdi_r2_on_chan_log);
<a name="l10167"></a>10167             openr2_chan_set_log_level(tmp-&gt;r2chan, conf-&gt;mfcr2.loglevel);
<a name="l10168"></a>10168             tmp-&gt;mfcr2_category = conf-&gt;mfcr2.category;
<a name="l10169"></a>10169             tmp-&gt;mfcr2_charge_calls = conf-&gt;mfcr2.charge_calls;
<a name="l10170"></a>10170             tmp-&gt;mfcr2_allow_collect_calls = conf-&gt;mfcr2.allow_collect_calls;
<a name="l10171"></a>10171             tmp-&gt;mfcr2_forced_release = conf-&gt;mfcr2.forced_release;
<a name="l10172"></a>10172             tmp-&gt;mfcr2_accept_on_offer = conf-&gt;mfcr2.accept_on_offer;
<a name="l10173"></a>10173             tmp-&gt;mfcr2call = 0;
<a name="l10174"></a>10174             tmp-&gt;mfcr2_dnis_index = 0;
<a name="l10175"></a>10175             tmp-&gt;mfcr2_ani_index = 0;
<a name="l10176"></a>10176             r2_link-&gt;monitored_count++;
<a name="l10177"></a>10177          }
<a name="l10178"></a>10178 <span class="preprocessor">#endif</span>
<a name="l10179"></a>10179 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l10180"></a>10180 <span class="preprocessor"></span>         <span class="keywordflow">if</span> ((chan_sig == <a class="code" href="chan__dahdi_8c.html#ae9ab0c9508fca045a06730533be276a5">SIG_PRI</a>) || (chan_sig == <a class="code" href="chan__dahdi_8c.html#ab5bfeaf991c23c5b6510ace44ae79ce9">SIG_BRI</a>) || (chan_sig == <a class="code" href="chan__dahdi_8c.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a>) || (chan_sig == <a class="code" href="chan__dahdi_8c.html#a5724d8559318f4724b247ede46ff182d">SIG_GR303FXOKS</a>) || (chan_sig == <a class="code" href="chan__dahdi_8c.html#adc73c6cbd4b991ecd2925640c0c8761e">SIG_GR303FXSKS</a>)) {
<a name="l10181"></a>10181             <span class="keywordtype">int</span> offset;
<a name="l10182"></a>10182             <span class="keywordtype">int</span> myswitchtype;
<a name="l10183"></a>10183             <span class="keywordtype">int</span> matchesdchan;
<a name="l10184"></a>10184             <span class="keywordtype">int</span> x,y;
<a name="l10185"></a>10185             offset = 0;
<a name="l10186"></a>10186             <span class="keywordflow">if</span> (((chan_sig == <a class="code" href="chan__dahdi_8c.html#ae9ab0c9508fca045a06730533be276a5">SIG_PRI</a>) || (chan_sig == <a class="code" href="chan__dahdi_8c.html#ab5bfeaf991c23c5b6510ace44ae79ce9">SIG_BRI</a>) || (chan_sig == <a class="code" href="chan__dahdi_8c.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a>))
<a name="l10187"></a>10187                   &amp;&amp; ioctl(tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_AUDIOMODE, &amp;offset)) {
<a name="l10188"></a>10188                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to set clear mode on clear channel %d of span %d: %s\n&quot;</span>, channel, p.spanno, strerror(errno));
<a name="l10189"></a>10189                <a class="code" href="chan__dahdi_8c.html#a9db88392ac10cee3a3116d1f7f4aae5f">destroy_dahdi_pvt</a>(&amp;tmp);
<a name="l10190"></a>10190                <span class="keywordflow">return</span> NULL;
<a name="l10191"></a>10191             }
<a name="l10192"></a>10192             <span class="keywordflow">if</span> (span &gt;= <a class="code" href="chan__dahdi_8c.html#a80bfdd8adbffe226265cd729655a7268">NUM_SPANS</a>) {
<a name="l10193"></a>10193                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Channel %d does not lie on a span I know of (%d)\n&quot;</span>, channel, span);
<a name="l10194"></a>10194                <a class="code" href="chan__dahdi_8c.html#a9db88392ac10cee3a3116d1f7f4aae5f">destroy_dahdi_pvt</a>(&amp;tmp);
<a name="l10195"></a>10195                <span class="keywordflow">return</span> NULL;
<a name="l10196"></a>10196             } <span class="keywordflow">else</span> {
<a name="l10197"></a>10197                <span class="keyword">struct </span>dahdi_spaninfo si;
<a name="l10198"></a>10198                si.spanno = 0;
<a name="l10199"></a>10199                <span class="keywordflow">if</span> (ioctl(tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>,DAHDI_SPANSTAT,&amp;si) == -1) {
<a name="l10200"></a>10200                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to get span status: %s\n&quot;</span>, strerror(errno));
<a name="l10201"></a>10201                   <a class="code" href="chan__dahdi_8c.html#a9db88392ac10cee3a3116d1f7f4aae5f">destroy_dahdi_pvt</a>(&amp;tmp);
<a name="l10202"></a>10202                   <span class="keywordflow">return</span> NULL;
<a name="l10203"></a>10203                }
<a name="l10204"></a>10204                <span class="comment">/* Store the logical span first based upon the real span */</span>
<a name="l10205"></a>10205                tmp-&gt;logicalspan = pris[span].prilogicalspan;
<a name="l10206"></a>10206                pri_resolve_span(&amp;span, channel, (channel - p.chanpos), &amp;si);
<a name="l10207"></a>10207                <span class="keywordflow">if</span> (span &lt; 0) {
<a name="l10208"></a>10208                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Channel %d: Unable to find locate channel/trunk group!\n&quot;</span>, channel);
<a name="l10209"></a>10209                   <a class="code" href="chan__dahdi_8c.html#a9db88392ac10cee3a3116d1f7f4aae5f">destroy_dahdi_pvt</a>(&amp;tmp);
<a name="l10210"></a>10210                   <span class="keywordflow">return</span> NULL;
<a name="l10211"></a>10211                }
<a name="l10212"></a>10212                <span class="keywordflow">if</span> ((chan_sig == <a class="code" href="chan__dahdi_8c.html#ae9ab0c9508fca045a06730533be276a5">SIG_PRI</a>) ||
<a name="l10213"></a>10213                      (chan_sig == <a class="code" href="chan__dahdi_8c.html#ab5bfeaf991c23c5b6510ace44ae79ce9">SIG_BRI</a>) ||
<a name="l10214"></a>10214                      (chan_sig == <a class="code" href="chan__dahdi_8c.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a>))
<a name="l10215"></a>10215                   myswitchtype = conf-&gt;pri.switchtype;
<a name="l10216"></a>10216                <span class="keywordflow">else</span>
<a name="l10217"></a>10217                   myswitchtype = PRI_SWITCH_GR303_TMC;
<a name="l10218"></a>10218                <span class="comment">/* Make sure this isn&apos;t a d-channel */</span>
<a name="l10219"></a>10219                matchesdchan=0;
<a name="l10220"></a>10220                <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="chan__dahdi_8c.html#a80bfdd8adbffe226265cd729655a7268">NUM_SPANS</a>; x++) {
<a name="l10221"></a>10221                   <span class="keywordflow">for</span> (y = 0; y &lt; <a class="code" href="chan__dahdi_8c.html#aaad94eef7bd74293b956f6de74a62d0f">NUM_DCHANS</a>; y++) {
<a name="l10222"></a>10222                      <span class="keywordflow">if</span> (pris[x].dchannels[y] == tmp-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>) {
<a name="l10223"></a>10223                         matchesdchan = 1;
<a name="l10224"></a>10224                         <span class="keywordflow">break</span>;
<a name="l10225"></a>10225                      }
<a name="l10226"></a>10226                   }
<a name="l10227"></a>10227                }
<a name="l10228"></a>10228                offset = p.chanpos;
<a name="l10229"></a>10229                <span class="keywordflow">if</span> (!matchesdchan) {
<a name="l10230"></a>10230                   <span class="keywordflow">if</span> (pris[span].nodetype &amp;&amp; (pris[span].nodetype != conf-&gt;pri.nodetype)) {
<a name="l10231"></a>10231                      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Span %d is already a %s node\n&quot;</span>, span + 1, pri_node2str(pris[span].nodetype));
<a name="l10232"></a>10232                      <a class="code" href="chan__dahdi_8c.html#a9db88392ac10cee3a3116d1f7f4aae5f">destroy_dahdi_pvt</a>(&amp;tmp);
<a name="l10233"></a>10233                      <span class="keywordflow">return</span> NULL;
<a name="l10234"></a>10234                   }
<a name="l10235"></a>10235                   <span class="keywordflow">if</span> (pris[span].switchtype &amp;&amp; (pris[span].switchtype != myswitchtype)) {
<a name="l10236"></a>10236                      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Span %d is already a %s switch\n&quot;</span>, span + 1, pri_switch2str(pris[span].switchtype));
<a name="l10237"></a>10237                      <a class="code" href="chan__dahdi_8c.html#a9db88392ac10cee3a3116d1f7f4aae5f">destroy_dahdi_pvt</a>(&amp;tmp);
<a name="l10238"></a>10238                      <span class="keywordflow">return</span> NULL;
<a name="l10239"></a>10239                   }
<a name="l10240"></a>10240                   <span class="keywordflow">if</span> ((pris[span].dialplan) &amp;&amp; (pris[span].dialplan != conf-&gt;pri.dialplan)) {
<a name="l10241"></a>10241                      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Span %d is already a %s dialing plan\n&quot;</span>, span + 1, dialplan2str(pris[span].dialplan));
<a name="l10242"></a>10242                      <a class="code" href="chan__dahdi_8c.html#a9db88392ac10cee3a3116d1f7f4aae5f">destroy_dahdi_pvt</a>(&amp;tmp);
<a name="l10243"></a>10243                      <span class="keywordflow">return</span> NULL;
<a name="l10244"></a>10244                   }
<a name="l10245"></a>10245                   <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(pris[span].idledial) &amp;&amp; strcmp(pris[span].idledial, conf-&gt;pri.idledial)) {
<a name="l10246"></a>10246                      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Span %d already has idledial &apos;%s&apos;.\n&quot;</span>, span + 1, conf-&gt;pri.idledial);
<a name="l10247"></a>10247                      <a class="code" href="chan__dahdi_8c.html#a9db88392ac10cee3a3116d1f7f4aae5f">destroy_dahdi_pvt</a>(&amp;tmp);
<a name="l10248"></a>10248                      <span class="keywordflow">return</span> NULL;
<a name="l10249"></a>10249                   }
<a name="l10250"></a>10250                   <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(pris[span].idleext) &amp;&amp; strcmp(pris[span].idleext, conf-&gt;pri.idleext)) {
<a name="l10251"></a>10251                      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Span %d already has idleext &apos;%s&apos;.\n&quot;</span>, span + 1, conf-&gt;pri.idleext);
<a name="l10252"></a>10252                      <a class="code" href="chan__dahdi_8c.html#a9db88392ac10cee3a3116d1f7f4aae5f">destroy_dahdi_pvt</a>(&amp;tmp);
<a name="l10253"></a>10253                      <span class="keywordflow">return</span> NULL;
<a name="l10254"></a>10254                   }
<a name="l10255"></a>10255                   <span class="keywordflow">if</span> (pris[span].minunused &amp;&amp; (pris[span].minunused != conf-&gt;pri.minunused)) {
<a name="l10256"></a>10256                      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Span %d already has minunused of %d.\n&quot;</span>, span + 1, conf-&gt;pri.minunused);
<a name="l10257"></a>10257                      <a class="code" href="chan__dahdi_8c.html#a9db88392ac10cee3a3116d1f7f4aae5f">destroy_dahdi_pvt</a>(&amp;tmp);
<a name="l10258"></a>10258                      <span class="keywordflow">return</span> NULL;
<a name="l10259"></a>10259                   }
<a name="l10260"></a>10260                   <span class="keywordflow">if</span> (pris[span].minidle &amp;&amp; (pris[span].minidle != conf-&gt;pri.minidle)) {
<a name="l10261"></a>10261                      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Span %d already has minidle of %d.\n&quot;</span>, span + 1, conf-&gt;pri.minidle);
<a name="l10262"></a>10262                      <a class="code" href="chan__dahdi_8c.html#a9db88392ac10cee3a3116d1f7f4aae5f">destroy_dahdi_pvt</a>(&amp;tmp);
<a name="l10263"></a>10263                      <span class="keywordflow">return</span> NULL;
<a name="l10264"></a>10264                   }
<a name="l10265"></a>10265                   <span class="keywordflow">if</span> (pris[span].numchans &gt;= <a class="code" href="chan__dahdi_8c.html#ac69ee46f4a51ed14f0d68628c2dec71d">MAX_CHANNELS</a>) {
<a name="l10266"></a>10266                      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to add channel %d: Too many channels in trunk group %d!\n&quot;</span>, channel,
<a name="l10267"></a>10267                         pris[span].trunkgroup);
<a name="l10268"></a>10268                      <a class="code" href="chan__dahdi_8c.html#a9db88392ac10cee3a3116d1f7f4aae5f">destroy_dahdi_pvt</a>(&amp;tmp);
<a name="l10269"></a>10269                      <span class="keywordflow">return</span> NULL;
<a name="l10270"></a>10270                   }
<a name="l10271"></a>10271 
<a name="l10272"></a>10272                   pris[span].sig = chan_sig;
<a name="l10273"></a>10273                   pris[span].nodetype = conf-&gt;pri.nodetype;
<a name="l10274"></a>10274                   pris[span].switchtype = myswitchtype;
<a name="l10275"></a>10275                   pris[span].nsf = conf-&gt;pri.nsf;
<a name="l10276"></a>10276                   pris[span].dialplan = conf-&gt;pri.dialplan;
<a name="l10277"></a>10277                   pris[span].localdialplan = conf-&gt;pri.localdialplan;
<a name="l10278"></a>10278                   pris[span].pvts[pris[span].numchans++] = tmp;
<a name="l10279"></a>10279                   pris[span].minunused = conf-&gt;pri.minunused;
<a name="l10280"></a>10280                   pris[span].minidle = conf-&gt;pri.minidle;
<a name="l10281"></a>10281                   pris[span].overlapdial = conf-&gt;pri.overlapdial;
<a name="l10282"></a>10282                   pris[span].qsigchannelmapping = conf-&gt;pri.qsigchannelmapping;
<a name="l10283"></a>10283                   pris[span].discardremoteholdretrieval = conf-&gt;pri.discardremoteholdretrieval;
<a name="l10284"></a>10284 <span class="preprocessor">#ifdef HAVE_PRI_INBANDDISCONNECT</span>
<a name="l10285"></a>10285 <span class="preprocessor"></span>                  pris[span].inbanddisconnect = conf-&gt;pri.inbanddisconnect;
<a name="l10286"></a>10286 <span class="preprocessor">#endif</span>
<a name="l10287"></a>10287 <span class="preprocessor"></span>                  pris[span].facilityenable = conf-&gt;pri.facilityenable;
<a name="l10288"></a>10288                   <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(pris[span].idledial, conf-&gt;pri.idledial, <span class="keyword">sizeof</span>(pris[span].idledial));
<a name="l10289"></a>10289                   <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(pris[span].idleext, conf-&gt;pri.idleext, <span class="keyword">sizeof</span>(pris[span].idleext));
<a name="l10290"></a>10290                   <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(pris[span].internationalprefix, conf-&gt;pri.internationalprefix, <span class="keyword">sizeof</span>(pris[span].internationalprefix));
<a name="l10291"></a>10291                   <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(pris[span].nationalprefix, conf-&gt;pri.nationalprefix, <span class="keyword">sizeof</span>(pris[span].nationalprefix));
<a name="l10292"></a>10292                   <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(pris[span].localprefix, conf-&gt;pri.localprefix, <span class="keyword">sizeof</span>(pris[span].localprefix));
<a name="l10293"></a>10293                   <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(pris[span].privateprefix, conf-&gt;pri.privateprefix, <span class="keyword">sizeof</span>(pris[span].privateprefix));
<a name="l10294"></a>10294                   <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(pris[span].unknownprefix, conf-&gt;pri.unknownprefix, <span class="keyword">sizeof</span>(pris[span].unknownprefix));
<a name="l10295"></a>10295                   pris[span].resetinterval = conf-&gt;pri.resetinterval;
<a name="l10296"></a>10296 
<a name="l10297"></a>10297                   tmp-&gt;pri = &amp;pris[span];
<a name="l10298"></a>10298                   tmp-&gt;prioffset = offset;
<a name="l10299"></a>10299                   tmp-&gt;call = NULL;
<a name="l10300"></a>10300                } <span class="keywordflow">else</span> {
<a name="l10301"></a>10301                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Channel %d is reserved for D-channel.\n&quot;</span>, offset);
<a name="l10302"></a>10302                   <a class="code" href="chan__dahdi_8c.html#a9db88392ac10cee3a3116d1f7f4aae5f">destroy_dahdi_pvt</a>(&amp;tmp);
<a name="l10303"></a>10303                   <span class="keywordflow">return</span> NULL;
<a name="l10304"></a>10304                }
<a name="l10305"></a>10305             }
<a name="l10306"></a>10306          } <span class="keywordflow">else</span> {
<a name="l10307"></a>10307             tmp-&gt;prioffset = 0;
<a name="l10308"></a>10308          }
<a name="l10309"></a>10309 <span class="preprocessor">#endif</span>
<a name="l10310"></a>10310 <span class="preprocessor"></span>      } <span class="keywordflow">else</span> {
<a name="l10311"></a>10311          chan_sig = tmp-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a>;
<a name="l10312"></a>10312          <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a> &gt; -1) {
<a name="l10313"></a>10313             memset(&amp;p, 0, <span class="keyword">sizeof</span>(p));
<a name="l10314"></a>10314             res = ioctl(tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_GET_PARAMS, &amp;p);
<a name="l10315"></a>10315          }
<a name="l10316"></a>10316       }
<a name="l10317"></a>10317       <span class="comment">/* Adjust starttime on loopstart and kewlstart trunks to reasonable values */</span>
<a name="l10318"></a>10318       <span class="keywordflow">switch</span> (chan_sig) {
<a name="l10319"></a>10319       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a38139ec369c0243f4324eb4eb0c2f004">SIG_FXSKS</a>:
<a name="l10320"></a>10320       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a1dc50a07aef86c90ab94f1583c35a265">SIG_FXSLS</a>:
<a name="l10321"></a>10321       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#afa7547cd2cee1bae7734206102635216">SIG_EM</a>:
<a name="l10322"></a>10322       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#aa7b59772722b794c5218768dac3ee419">SIG_EM_E1</a>:
<a name="l10323"></a>10323       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a1ba988b93fce049075b7c2ef6c931cf9">SIG_EMWINK</a>:
<a name="l10324"></a>10324       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ab79873391af2857a602e1eff68606f23">SIG_FEATD</a>:
<a name="l10325"></a>10325       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a98d4710afc1fcb2ff110eabb4fbcc308">SIG_FEATDMF</a>:
<a name="l10326"></a>10326       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ac0c40f74945ed15aa82cd9fedc304e55">SIG_FEATDMF_TA</a>:
<a name="l10327"></a>10327       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a0ba8ec199f5fb4f2be64144be0bd13b1">SIG_FEATB</a>:
<a name="l10328"></a>10328       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#adfdd0e4d05281d354c15ef1a5d158cd6">SIG_E911</a>:
<a name="l10329"></a>10329       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#afacb372d32fba2192ed6a2989c54fbda">SIG_SF</a>:
<a name="l10330"></a>10330       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a193853e7e76cff05d51425eba48d030f">SIG_SFWINK</a>:
<a name="l10331"></a>10331       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a167056b2763a4897838c7115efc1f9fc">SIG_FGC_CAMA</a>:
<a name="l10332"></a>10332       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a945e2b5f225d3abdc57b5dcc53daa62a">SIG_FGC_CAMAMF</a>:
<a name="l10333"></a>10333       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#aac334a7f88651d9e44499897386d2cfd">SIG_SF_FEATD</a>:
<a name="l10334"></a>10334       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a4625d3aba972e102c8460a9f16af0fc7">SIG_SF_FEATDMF</a>:
<a name="l10335"></a>10335       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a33a2f70a24e9f8ccfcc1e76f208b1ab6">SIG_SF_FEATB</a>:
<a name="l10336"></a>10336          p.starttime = 250;
<a name="l10337"></a>10337          <span class="keywordflow">break</span>;
<a name="l10338"></a>10338       }
<a name="l10339"></a>10339 
<a name="l10340"></a>10340       <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="structdahdi__pvt.html#ac53b42243ee40edc74b615fe86806fe3" title="Nonzero if the signaling type is sent over a radio.">radio</a>) {
<a name="l10341"></a>10341          <span class="comment">/* XXX Waiting to hear back from Jim if these should be adjustable XXX */</span>
<a name="l10342"></a>10342          p.channo = channel;
<a name="l10343"></a>10343          p.rxwinktime = 1;
<a name="l10344"></a>10344          p.rxflashtime = 1;
<a name="l10345"></a>10345          p.starttime = 1;
<a name="l10346"></a>10346          p.debouncetime = 5;
<a name="l10347"></a>10347       }
<a name="l10348"></a>10348       <span class="keywordflow">if</span> (!tmp-&gt;<a class="code" href="structdahdi__pvt.html#ac53b42243ee40edc74b615fe86806fe3" title="Nonzero if the signaling type is sent over a radio.">radio</a>) {
<a name="l10349"></a>10349          p.channo = channel;
<a name="l10350"></a>10350          <span class="comment">/* Override timing settings based on config file */</span>
<a name="l10351"></a>10351          <span class="keywordflow">if</span> (conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a40775f53eef5801fc139a021dc8ca589">timing</a>.prewinktime &gt;= 0)
<a name="l10352"></a>10352             p.prewinktime = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a40775f53eef5801fc139a021dc8ca589">timing</a>.prewinktime;
<a name="l10353"></a>10353          <span class="keywordflow">if</span> (conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a40775f53eef5801fc139a021dc8ca589">timing</a>.preflashtime &gt;= 0)
<a name="l10354"></a>10354             p.preflashtime = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a40775f53eef5801fc139a021dc8ca589">timing</a>.preflashtime;
<a name="l10355"></a>10355          <span class="keywordflow">if</span> (conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a40775f53eef5801fc139a021dc8ca589">timing</a>.winktime &gt;= 0)
<a name="l10356"></a>10356             p.winktime = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a40775f53eef5801fc139a021dc8ca589">timing</a>.winktime;
<a name="l10357"></a>10357          <span class="keywordflow">if</span> (conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a40775f53eef5801fc139a021dc8ca589">timing</a>.flashtime &gt;= 0)
<a name="l10358"></a>10358             p.flashtime = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a40775f53eef5801fc139a021dc8ca589">timing</a>.flashtime;
<a name="l10359"></a>10359          <span class="keywordflow">if</span> (conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a40775f53eef5801fc139a021dc8ca589">timing</a>.starttime &gt;= 0)
<a name="l10360"></a>10360             p.starttime = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a40775f53eef5801fc139a021dc8ca589">timing</a>.starttime;
<a name="l10361"></a>10361          <span class="keywordflow">if</span> (conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a40775f53eef5801fc139a021dc8ca589">timing</a>.rxwinktime &gt;= 0)
<a name="l10362"></a>10362             p.rxwinktime = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a40775f53eef5801fc139a021dc8ca589">timing</a>.rxwinktime;
<a name="l10363"></a>10363          <span class="keywordflow">if</span> (conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a40775f53eef5801fc139a021dc8ca589">timing</a>.rxflashtime &gt;= 0)
<a name="l10364"></a>10364             p.rxflashtime = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a40775f53eef5801fc139a021dc8ca589">timing</a>.rxflashtime;
<a name="l10365"></a>10365          <span class="keywordflow">if</span> (conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a40775f53eef5801fc139a021dc8ca589">timing</a>.debouncetime &gt;= 0)
<a name="l10366"></a>10366             p.debouncetime = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a40775f53eef5801fc139a021dc8ca589">timing</a>.debouncetime;
<a name="l10367"></a>10367       }
<a name="l10368"></a>10368 
<a name="l10369"></a>10369       <span class="comment">/* dont set parms on a pseudo-channel (or CRV) */</span>
<a name="l10370"></a>10370       <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a> &gt;= 0)
<a name="l10371"></a>10371       {
<a name="l10372"></a>10372          res = ioctl(tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_SET_PARAMS, &amp;p);
<a name="l10373"></a>10373          <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l10374"></a>10374             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to set parameters: %s\n&quot;</span>, strerror(errno));
<a name="l10375"></a>10375             <a class="code" href="chan__dahdi_8c.html#a9db88392ac10cee3a3116d1f7f4aae5f">destroy_dahdi_pvt</a>(&amp;tmp);
<a name="l10376"></a>10376             <span class="keywordflow">return</span> NULL;
<a name="l10377"></a>10377          }
<a name="l10378"></a>10378       }
<a name="l10379"></a>10379 <span class="preprocessor">#if 1</span>
<a name="l10380"></a>10380 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (!here &amp;&amp; (tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a> &gt; -1)) {
<a name="l10381"></a>10381          memset(&amp;bi, 0, <span class="keyword">sizeof</span>(bi));
<a name="l10382"></a>10382          res = ioctl(tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_GET_BUFINFO, &amp;bi);
<a name="l10383"></a>10383          <span class="keywordflow">if</span> (!res) {
<a name="l10384"></a>10384             bi.txbufpolicy = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#abfc3801c54ad9e430f5cdf383450a052">buf_policy</a>;
<a name="l10385"></a>10385             bi.rxbufpolicy = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#abfc3801c54ad9e430f5cdf383450a052">buf_policy</a>;
<a name="l10386"></a>10386             bi.numbufs = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#adb74dc4af40df4615bb5f05846cefc9d">buf_no</a>;
<a name="l10387"></a>10387             res = ioctl(tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_SET_BUFINFO, &amp;bi);
<a name="l10388"></a>10388             <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l10389"></a>10389                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to set buffer policy on channel %d: %s\n&quot;</span>, channel, strerror(errno));
<a name="l10390"></a>10390             }
<a name="l10391"></a>10391          } <span class="keywordflow">else</span> {
<a name="l10392"></a>10392             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to check buffer policy on channel %d: %s\n&quot;</span>, channel, strerror(errno));
<a name="l10393"></a>10393          }
<a name="l10394"></a>10394          tmp-&gt;<a class="code" href="structdahdi__pvt.html#abfc3801c54ad9e430f5cdf383450a052">buf_policy</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#abfc3801c54ad9e430f5cdf383450a052">buf_policy</a>;
<a name="l10395"></a>10395          tmp-&gt;<a class="code" href="structdahdi__pvt.html#adb74dc4af40df4615bb5f05846cefc9d">buf_no</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#adb74dc4af40df4615bb5f05846cefc9d">buf_no</a>;
<a name="l10396"></a>10396          tmp-&gt;<a class="code" href="structdahdi__pvt.html#af518c69bd5c2dd844c9621c278998c3b" title="TRUE if dynamic faxbuffers are configured for use, default is OFF.">usefaxbuffers</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#af518c69bd5c2dd844c9621c278998c3b" title="TRUE if dynamic faxbuffers are configured for use, default is OFF.">usefaxbuffers</a>;
<a name="l10397"></a>10397          tmp-&gt;<a class="code" href="structdahdi__pvt.html#a1bdd30b5265eac27d813ba677086d9ea">faxbuf_policy</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a1bdd30b5265eac27d813ba677086d9ea">faxbuf_policy</a>;
<a name="l10398"></a>10398          tmp-&gt;<a class="code" href="structdahdi__pvt.html#a8e922e18e6489408800cdd7ec015ef85">faxbuf_no</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a8e922e18e6489408800cdd7ec015ef85">faxbuf_no</a>;
<a name="l10399"></a>10399          <span class="comment">/* This is not as gnarly as it may first appear.  If the ioctl above failed, we&apos;d be setting</span>
<a name="l10400"></a>10400 <span class="comment">          * tmp-&gt;bufsize to zero which would cause subsequent faxbuffer-related ioctl calls to fail.</span>
<a name="l10401"></a>10401 <span class="comment">          * The reason the ioctl call above failed should to be determined before worrying about the</span>
<a name="l10402"></a>10402 <span class="comment">          * faxbuffer-related ioctl calls */</span>
<a name="l10403"></a>10403          tmp-&gt;<a class="code" href="structdahdi__pvt.html#a199ab88d4ca8eab30e1cb7d35edacca5">bufsize</a> = bi.bufsize;
<a name="l10404"></a>10404       }
<a name="l10405"></a>10405 <span class="preprocessor">#endif</span>
<a name="l10406"></a>10406 <span class="preprocessor"></span>      tmp-&gt;<a class="code" href="structdahdi__pvt.html#a04e3105c0481dfd78913d4bc9796f1c3" title="TRUE if the channel should be answered immediately without attempting to gather any...">immediate</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a04e3105c0481dfd78913d4bc9796f1c3" title="TRUE if the channel should be answered immediately without attempting to gather any...">immediate</a>;
<a name="l10407"></a>10407       tmp-&gt;<a class="code" href="structdahdi__pvt.html#ad9edd1e07f21e10f246e7dc644d47e7e" title="TRUE if allowed to flash-transfer to busy channels.">transfertobusy</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ad9edd1e07f21e10f246e7dc644d47e7e" title="TRUE if allowed to flash-transfer to busy channels.">transfertobusy</a>;
<a name="l10408"></a>10408       <span class="keywordflow">if</span> (chan_sig &amp; __DAHDI_SIG_FXS) {
<a name="l10409"></a>10409          tmp-&gt;<a class="code" href="structdahdi__pvt.html#aad3e7a9f0fe63779a32719116bf7a77b" title="TRUE if the FXO port monitors for fsk type MWI indications from the other end.">mwimonitor_fsk</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#aad3e7a9f0fe63779a32719116bf7a77b" title="TRUE if the FXO port monitors for fsk type MWI indications from the other end.">mwimonitor_fsk</a>;
<a name="l10410"></a>10410          tmp-&gt;<a class="code" href="structdahdi__pvt.html#a9ca6405842cd66b52da98bb94fbe4fe7" title="TRUE if the FXO port monitors for neon type MWI indications from the other end.">mwimonitor_neon</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a9ca6405842cd66b52da98bb94fbe4fe7" title="TRUE if the FXO port monitors for neon type MWI indications from the other end.">mwimonitor_neon</a>;
<a name="l10411"></a>10411          tmp-&gt;<a class="code" href="structdahdi__pvt.html#a3dc50dfe697cc83ee35e72ea27025724" title="TRUE if the FXO port monitors for rpas precursor to fsk MWI indications from the...">mwimonitor_rpas</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a3dc50dfe697cc83ee35e72ea27025724" title="TRUE if the FXO port monitors for rpas precursor to fsk MWI indications from the...">mwimonitor_rpas</a>;
<a name="l10412"></a>10412       }
<a name="l10413"></a>10413       tmp-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = chan_sig;
<a name="l10414"></a>10414       tmp-&gt;<a class="code" href="structdahdi__pvt.html#a57a35ad748a874002c2b58676e5b2687">outsigmod</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a57a35ad748a874002c2b58676e5b2687">outsigmod</a>;
<a name="l10415"></a>10415       tmp-&gt;<a class="code" href="structdahdi__pvt.html#aadc5d8714afe5d456c8f17db3abf7f20" title="Ring timeout base.">ringt_base</a> = <a class="code" href="chan__dahdi_8c.html#aadc5d8714afe5d456c8f17db3abf7f20" title="Configured ring timeout base.">ringt_base</a>;
<a name="l10416"></a>10416       tmp-&gt;<a class="code" href="structdahdi__pvt.html#a8537a72727d120580515b6c8108ac0b0" title="TRUE if over a radio and dahdi_read() has been called.">firstradio</a> = 0;
<a name="l10417"></a>10417       <span class="keywordflow">if</span> ((chan_sig == <a class="code" href="chan__dahdi_8c.html#a7c9b3bb8225896ff2b9aed27e6f80f10">SIG_FXOKS</a>) || (chan_sig == <a class="code" href="chan__dahdi_8c.html#adb40571aa5ff846fc334be5260eab257">SIG_FXOLS</a>) || (chan_sig == <a class="code" href="chan__dahdi_8c.html#a3dcffbaf4a26f2b7b792998df1eea27b">SIG_FXOGS</a>))
<a name="l10418"></a>10418          tmp-&gt;<a class="code" href="structdahdi__pvt.html#a0d390f8ec30c29d45eff19e375ed5763" title="TRUE if busy extensions will hear the call-waiting tone and can use hook-flash to...">permcallwaiting</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a76742560de0554db5b0b59591ba93adc" title="TRUE if busy extensions will hear the call-waiting tone and can use hook-flash to...">callwaiting</a>;
<a name="l10419"></a>10419       <span class="keywordflow">else</span>
<a name="l10420"></a>10420          tmp-&gt;<a class="code" href="structdahdi__pvt.html#a0d390f8ec30c29d45eff19e375ed5763" title="TRUE if busy extensions will hear the call-waiting tone and can use hook-flash to...">permcallwaiting</a> = 0;
<a name="l10421"></a>10421       <span class="comment">/* Flag to destroy the channel must be cleared on new mkif.  Part of changes for reload to work */</span>
<a name="l10422"></a>10422       tmp-&gt;<a class="code" href="structdahdi__pvt.html#ab16498ae4f96c29649dd52ac032e811d" title="TRUE if the channel is to be destroyed on hangup. (Used by pseudo channels.).">destroy</a> = 0;
<a name="l10423"></a>10423       tmp-&gt;<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>;
<a name="l10424"></a>10424 
<a name="l10425"></a>10425       <span class="comment">/* 10 is a nice default. */</span>
<a name="l10426"></a>10426       <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[0].<a class="code" href="structdistRingData.html#a037e8e370380046bec287bdc96942091">range</a> == 0)
<a name="l10427"></a>10427          tmp-&gt;<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[0].<a class="code" href="structdistRingData.html#a037e8e370380046bec287bdc96942091">range</a> = 10;
<a name="l10428"></a>10428       <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[1].<a class="code" href="structdistRingData.html#a037e8e370380046bec287bdc96942091">range</a> == 0)
<a name="l10429"></a>10429          tmp-&gt;<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[1].<a class="code" href="structdistRingData.html#a037e8e370380046bec287bdc96942091">range</a> = 10;
<a name="l10430"></a>10430       <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[2].<a class="code" href="structdistRingData.html#a037e8e370380046bec287bdc96942091">range</a> == 0)
<a name="l10431"></a>10431          tmp-&gt;<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[2].<a class="code" href="structdistRingData.html#a037e8e370380046bec287bdc96942091">range</a> = 10;
<a name="l10432"></a>10432 
<a name="l10433"></a>10433       tmp-&gt;<a class="code" href="structdahdi__pvt.html#a59551a5cbca312a8fc3cc38f0af80637" title="TRUE if distinctive rings are to be detected.">usedistinctiveringdetection</a> = <a class="code" href="chan__dahdi_8c.html#adbb77dd3bae219ee6a026c9bfa5a5242">usedistinctiveringdetection</a>;
<a name="l10434"></a>10434       tmp-&gt;<a class="code" href="structdahdi__pvt.html#a4a2ed3a92159fb783d3471ea7d76cf43" title="TRUE if send caller ID for Call Waiting.">callwaitingcallerid</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a4a2ed3a92159fb783d3471ea7d76cf43" title="TRUE if send caller ID for Call Waiting.">callwaitingcallerid</a>;
<a name="l10435"></a>10435       tmp-&gt;<a class="code" href="structdahdi__pvt.html#a5ce774381529ffaadd4171bdeba5ebf3" title="TRUE if three way calling is enabled.">threewaycalling</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a5ce774381529ffaadd4171bdeba5ebf3" title="TRUE if three way calling is enabled.">threewaycalling</a>;
<a name="l10436"></a>10436       tmp-&gt;<a class="code" href="structdahdi__pvt.html#a537f2d4f7f35cb2c667f7c9790793626" title="TRUE if ADSI (Analog Display Services Interface) available.">adsi</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a537f2d4f7f35cb2c667f7c9790793626" title="TRUE if ADSI (Analog Display Services Interface) available.">adsi</a>;
<a name="l10437"></a>10437       tmp-&gt;<a class="code" href="structdahdi__pvt.html#a93dcf4e5286d88e9c218bbc521584784" title="TRUE if SMDI (Simplified Message Desk Interface) is enabled.">use_smdi</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a93dcf4e5286d88e9c218bbc521584784" title="TRUE if SMDI (Simplified Message Desk Interface) is enabled.">use_smdi</a>;
<a name="l10438"></a>10438       tmp-&gt;<a class="code" href="structdahdi__pvt.html#a34eea482c8faa3e04316f786877fe6ae" title="TRUE if the outgoing caller ID is blocked/restricted/hidden.">permhidecallerid</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a8c5bb01611cd9890c062782fa0366459" title="TRUE if the outgoing caller ID is blocked/hidden.">hidecallerid</a>;
<a name="l10439"></a>10439       tmp-&gt;<a class="code" href="structdahdi__pvt.html#a8f5bca0f17b0735bf05517a0b7e18ebd" title="TRUE if call return is enabled. (*69, if your dialplan doesn&amp;#39;t catch this first)...">callreturn</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a8f5bca0f17b0735bf05517a0b7e18ebd" title="TRUE if call return is enabled. (*69, if your dialplan doesn&amp;#39;t catch this first)...">callreturn</a>;
<a name="l10440"></a>10440       tmp-&gt;<a class="code" href="structdahdi__pvt.html#a12f1128b223526997d1601ee6e33325d" title="Echo cancel parameters.">echocancel</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a12f1128b223526997d1601ee6e33325d" title="Echo cancel parameters.">echocancel</a>;
<a name="l10441"></a>10441       tmp-&gt;<a class="code" href="structdahdi__pvt.html#a6c8f2e86376f982c0d9e709736787a51" title="Echo training time. 0 = disabled.">echotraining</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a6c8f2e86376f982c0d9e709736787a51" title="Echo training time. 0 = disabled.">echotraining</a>;
<a name="l10442"></a>10442       tmp-&gt;<a class="code" href="structdahdi__pvt.html#a68d59a550fd5b3d5ce6d59388044ad63" title="TRUE if we will pulse dial.">pulse</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68d59a550fd5b3d5ce6d59388044ad63" title="TRUE if we will pulse dial.">pulse</a>;
<a name="l10443"></a>10443       <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="structdahdi__pvt.html#a12f1128b223526997d1601ee6e33325d" title="Echo cancel parameters.">echocancel</a>.<a class="code" href="structdahdi__pvt.html#ad4baed46a5922e2eecd2876f455dc726">head</a>.tap_length) {
<a name="l10444"></a>10444          tmp-&gt;<a class="code" href="structdahdi__pvt.html#ad4ee8bc9c653a9a2ce08e66f62d8814d" title="TRUE if echo cancellation enabled when bridged.">echocanbridged</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ad4ee8bc9c653a9a2ce08e66f62d8814d" title="TRUE if echo cancellation enabled when bridged.">echocanbridged</a>;
<a name="l10445"></a>10445       } <span class="keywordflow">else</span> {
<a name="l10446"></a>10446          <span class="keywordflow">if</span> (conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ad4ee8bc9c653a9a2ce08e66f62d8814d" title="TRUE if echo cancellation enabled when bridged.">echocanbridged</a>)
<a name="l10447"></a>10447             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;echocancelwhenbridged requires echocancel to be enabled; ignoring\n&quot;</span>);
<a name="l10448"></a>10448          tmp-&gt;<a class="code" href="structdahdi__pvt.html#ad4ee8bc9c653a9a2ce08e66f62d8814d" title="TRUE if echo cancellation enabled when bridged.">echocanbridged</a> = 0;
<a name="l10449"></a>10449       }
<a name="l10450"></a>10450       tmp-&gt;<a class="code" href="structdahdi__pvt.html#ab86910b871c8cff810ab15a587a1ed3b" title="TRUE if busy detection is enabled. (Listens for the beep-beep busy pattern.).">busydetect</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ab86910b871c8cff810ab15a587a1ed3b" title="TRUE if busy detection is enabled. (Listens for the beep-beep busy pattern.).">busydetect</a>;
<a name="l10451"></a>10451       tmp-&gt;<a class="code" href="structdahdi__pvt.html#a29a1e575aa8b94876e2d3b8da3f6da2b" title="Number of times to see &amp;quot;busy&amp;quot; tone before hanging up.">busycount</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a29a1e575aa8b94876e2d3b8da3f6da2b" title="Number of times to see &amp;quot;busy&amp;quot; tone before hanging up.">busycount</a>;
<a name="l10452"></a>10452       tmp-&gt;<a class="code" href="structdahdi__pvt.html#a0b9321a0ad6b6a804a8c7f295f5b8b7a" title="Length of &amp;quot;busy&amp;quot; tone on time.">busy_tonelength</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a0b9321a0ad6b6a804a8c7f295f5b8b7a" title="Length of &amp;quot;busy&amp;quot; tone on time.">busy_tonelength</a>;
<a name="l10453"></a>10453       tmp-&gt;<a class="code" href="structdahdi__pvt.html#a9224645275ef08732407aea48569aea1" title="Length of &amp;quot;busy&amp;quot; tone off time.">busy_quietlength</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a9224645275ef08732407aea48569aea1" title="Length of &amp;quot;busy&amp;quot; tone off time.">busy_quietlength</a>;
<a name="l10454"></a>10454       tmp-&gt;<a class="code" href="structdahdi__pvt.html#a79710add069e32170f03d92067ec3877" title="Bitmapped call progress detection flags. CALLPROGRESS_xxx values.">callprogress</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a79710add069e32170f03d92067ec3877" title="Bitmapped call progress detection flags. CALLPROGRESS_xxx values.">callprogress</a>;
<a name="l10455"></a>10455       tmp-&gt;<a class="code" href="structdahdi__pvt.html#a508c2407a52638696697fdeb08f0b2e5" title="Number of milliseconds to wait for dialtone.">waitfordialtone</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a508c2407a52638696697fdeb08f0b2e5" title="Number of milliseconds to wait for dialtone.">waitfordialtone</a>;
<a name="l10456"></a>10456       tmp-&gt;<a class="code" href="structdahdi__pvt.html#ac4e156067fb7e78b012fa7e35dafc887" title="TRUE if support for call forwarding enabled. Dial *72 to enable call forwarding....">cancallforward</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ac4e156067fb7e78b012fa7e35dafc887" title="TRUE if support for call forwarding enabled. Dial *72 to enable call forwarding....">cancallforward</a>;
<a name="l10457"></a>10457       tmp-&gt;<a class="code" href="structdahdi__pvt.html#a6829c6ed48c184cbd85055163786a7eb">dtmfrelax</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a6829c6ed48c184cbd85055163786a7eb">dtmfrelax</a>;
<a name="l10458"></a>10458       tmp-&gt;<a class="code" href="structdahdi__pvt.html#a76742560de0554db5b0b59591ba93adc" title="TRUE if busy extensions will hear the call-waiting tone and can use hook-flash to...">callwaiting</a> = tmp-&gt;<a class="code" href="structdahdi__pvt.html#a0d390f8ec30c29d45eff19e375ed5763" title="TRUE if busy extensions will hear the call-waiting tone and can use hook-flash to...">permcallwaiting</a>;
<a name="l10459"></a>10459       tmp-&gt;<a class="code" href="structdahdi__pvt.html#a8c5bb01611cd9890c062782fa0366459" title="TRUE if the outgoing caller ID is blocked/hidden.">hidecallerid</a> = tmp-&gt;<a class="code" href="structdahdi__pvt.html#a34eea482c8faa3e04316f786877fe6ae" title="TRUE if the outgoing caller ID is blocked/restricted/hidden.">permhidecallerid</a>;
<a name="l10460"></a>10460       tmp-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a> = channel;
<a name="l10461"></a>10461       tmp-&gt;<a class="code" href="structdahdi__pvt.html#ae485b093be94ace2ac61433abb70d3f1" title="Number of most significant digits/characters to strip from the dialed number.">stripmsd</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ae485b093be94ace2ac61433abb70d3f1" title="Number of most significant digits/characters to strip from the dialed number.">stripmsd</a>;
<a name="l10462"></a>10462       tmp-&gt;<a class="code" href="structdahdi__pvt.html#aee1feef8ad729d208a3ab28f0de46658" title="TRUE if caller ID is used on this channel.">use_callerid</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#aee1feef8ad729d208a3ab28f0de46658" title="TRUE if caller ID is used on this channel.">use_callerid</a>;
<a name="l10463"></a>10463       tmp-&gt;<a class="code" href="structdahdi__pvt.html#ad7f246923324f9b4186b3ee50de56c36">cid_signalling</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ad7f246923324f9b4186b3ee50de56c36">cid_signalling</a>;
<a name="l10464"></a>10464       tmp-&gt;<a class="code" href="structdahdi__pvt.html#aafa12631e52b2af7ee7a6ab7bf554ed2">cid_start</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#aafa12631e52b2af7ee7a6ab7bf554ed2">cid_start</a>;
<a name="l10465"></a>10465       tmp-&gt;<a class="code" href="structdahdi__pvt.html#a1ef0f7461e78f948f1b71a1e5c99cc8b" title="TRUE if we should use the callerid from incoming call on dahdi transfer.">dahditrcallerid</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a1ef0f7461e78f948f1b71a1e5c99cc8b" title="TRUE if we should use the callerid from incoming call on dahdi transfer.">dahditrcallerid</a>;
<a name="l10466"></a>10466       tmp-&gt;<a class="code" href="structdahdi__pvt.html#ab16ad9a41cc58b9ebf666bbe923db5ea" title="TRUE if caller ID is restricted.">restrictcid</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ab16ad9a41cc58b9ebf666bbe923db5ea" title="TRUE if caller ID is restricted.">restrictcid</a>;
<a name="l10467"></a>10467       tmp-&gt;<a class="code" href="structdahdi__pvt.html#a6799914e39462ec4cfef0e6b310e7104" title="TRUE if we will use the calling presentation setting from the Asterisk channel for...">use_callingpres</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a6799914e39462ec4cfef0e6b310e7104" title="TRUE if we will use the calling presentation setting from the Asterisk channel for...">use_callingpres</a>;
<a name="l10468"></a>10468       tmp-&gt;<a class="code" href="structdahdi__pvt.html#a6ae2ff84731ea1e81a24412800030423" title="TRUE if PRI B channels are always exclusively selected.">priexclusive</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a6ae2ff84731ea1e81a24412800030423" title="TRUE if PRI B channels are always exclusively selected.">priexclusive</a>;
<a name="l10469"></a>10469       <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="structdahdi__pvt.html#a59551a5cbca312a8fc3cc38f0af80637" title="TRUE if distinctive rings are to be detected.">usedistinctiveringdetection</a>) {
<a name="l10470"></a>10470          <span class="keywordflow">if</span> (!tmp-&gt;<a class="code" href="structdahdi__pvt.html#aee1feef8ad729d208a3ab28f0de46658" title="TRUE if caller ID is used on this channel.">use_callerid</a>) {
<a name="l10471"></a>10471             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Distinctive Ring detect requires &apos;usecallerid&apos; be on\n&quot;</span>);
<a name="l10472"></a>10472             tmp-&gt;<a class="code" href="structdahdi__pvt.html#aee1feef8ad729d208a3ab28f0de46658" title="TRUE if caller ID is used on this channel.">use_callerid</a> = 1;
<a name="l10473"></a>10473          }
<a name="l10474"></a>10474       }
<a name="l10475"></a>10475 
<a name="l10476"></a>10476       <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="structdahdi__pvt.html#ad7f246923324f9b4186b3ee50de56c36">cid_signalling</a> == <a class="code" href="callerid_8h.html#a184ebb33d2f7bd0bf257356761404aa7">CID_SIG_SMDI</a>) {
<a name="l10477"></a>10477          <span class="keywordflow">if</span> (!tmp-&gt;<a class="code" href="structdahdi__pvt.html#a93dcf4e5286d88e9c218bbc521584784" title="TRUE if SMDI (Simplified Message Desk Interface) is enabled.">use_smdi</a>) {
<a name="l10478"></a>10478             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;SMDI callerid requires SMDI to be enabled, enabling...\n&quot;</span>);
<a name="l10479"></a>10479             tmp-&gt;<a class="code" href="structdahdi__pvt.html#a93dcf4e5286d88e9c218bbc521584784" title="TRUE if SMDI (Simplified Message Desk Interface) is enabled.">use_smdi</a> = 1;
<a name="l10480"></a>10480          }
<a name="l10481"></a>10481       }
<a name="l10482"></a>10482       <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="structdahdi__pvt.html#a93dcf4e5286d88e9c218bbc521584784" title="TRUE if SMDI (Simplified Message Desk Interface) is enabled.">use_smdi</a>) {
<a name="l10483"></a>10483          tmp-&gt;<a class="code" href="structdahdi__pvt.html#af9bb0c022848cf3af1e8e51ae3c18e06" title="The serial port to listen for SMDI data on.">smdi_iface</a> = <a class="code" href="smdi_8h.html#aa5a1e111a1c9346decb38270aeb28c29" title="Find an SMDI interface with the specified name.">ast_smdi_interface_find</a>(conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a0d6775bd80749b630d70f6b77a416a5f" title="The serial port to listen for SMDI data on.">smdi_port</a>);
<a name="l10484"></a>10484          <span class="keywordflow">if</span> (!(tmp-&gt;<a class="code" href="structdahdi__pvt.html#af9bb0c022848cf3af1e8e51ae3c18e06" title="The serial port to listen for SMDI data on.">smdi_iface</a>)) {
<a name="l10485"></a>10485             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Invalid SMDI port specfied, disabling SMDI support\n&quot;</span>);
<a name="l10486"></a>10486             tmp-&gt;<a class="code" href="structdahdi__pvt.html#a93dcf4e5286d88e9c218bbc521584784" title="TRUE if SMDI (Simplified Message Desk Interface) is enabled.">use_smdi</a> = 0;
<a name="l10487"></a>10487          }
<a name="l10488"></a>10488       }
<a name="l10489"></a>10489 
<a name="l10490"></a>10490       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmp-&gt;<a class="code" href="structdahdi__pvt.html#adfee50d07a98645d4d20b896ce03785a">accountcode</a>, conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#adfee50d07a98645d4d20b896ce03785a">accountcode</a>, <span class="keyword">sizeof</span>(tmp-&gt;<a class="code" href="structdahdi__pvt.html#adfee50d07a98645d4d20b896ce03785a">accountcode</a>));
<a name="l10491"></a>10491       tmp-&gt;<a class="code" href="structdahdi__pvt.html#ad2cfb0f821c065261382a9298bb5a16b">amaflags</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ad2cfb0f821c065261382a9298bb5a16b">amaflags</a>;
<a name="l10492"></a>10492       <span class="keywordflow">if</span> (!here) {
<a name="l10493"></a>10493          tmp-&gt;<a class="code" href="structdahdi__pvt.html#aa9d25d217a303c512db5f8bd7fabd587">confno</a> = -1;
<a name="l10494"></a>10494          tmp-&gt;<a class="code" href="structdahdi__pvt.html#af9fdafa3d77ac5c004c90bf4f9042a07">propconfno</a> = -1;
<a name="l10495"></a>10495       }
<a name="l10496"></a>10496       tmp-&gt;<a class="code" href="structdahdi__pvt.html#a17706e8df212b8e7d0aaf7d13027bf8d" title="TRUE if support for call parking is enabled.">canpark</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a17706e8df212b8e7d0aaf7d13027bf8d" title="TRUE if support for call parking is enabled.">canpark</a>;
<a name="l10497"></a>10497       tmp-&gt;<a class="code" href="structdahdi__pvt.html#ad9e41a9a2b63c1e9bad00df4c2bfc92e" title="TRUE if call transfer is enabled.">transfer</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ad9e41a9a2b63c1e9bad00df4c2bfc92e" title="TRUE if call transfer is enabled.">transfer</a>;
<a name="l10498"></a>10498       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmp-&gt;<a class="code" href="structdahdi__pvt.html#ab56885da69b74c7fad6a1075b5a296dc" title="Saved context string.">defcontext</a>,conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ac25ea00ee3f082df06e0cf468cbde240" title="The configured context for incoming calls.">context</a>,<span class="keyword">sizeof</span>(tmp-&gt;<a class="code" href="structdahdi__pvt.html#ab56885da69b74c7fad6a1075b5a296dc" title="Saved context string.">defcontext</a>));
<a name="l10499"></a>10499       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmp-&gt;<a class="code" href="structdahdi__pvt.html#adf416dc058363e2fd5750c77e2d78bee" title="Language configured for calls.">language</a>, conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#adf416dc058363e2fd5750c77e2d78bee" title="Language configured for calls.">language</a>, <span class="keyword">sizeof</span>(tmp-&gt;<a class="code" href="structdahdi__pvt.html#adf416dc058363e2fd5750c77e2d78bee" title="Language configured for calls.">language</a>));
<a name="l10500"></a>10500       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmp-&gt;<a class="code" href="structdahdi__pvt.html#af689da2b77d1265192a78a5b0994a1d5" title="The configured music-on-hold class to use for calls.">mohinterpret</a>, conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#af689da2b77d1265192a78a5b0994a1d5" title="The configured music-on-hold class to use for calls.">mohinterpret</a>, <span class="keyword">sizeof</span>(tmp-&gt;<a class="code" href="structdahdi__pvt.html#af689da2b77d1265192a78a5b0994a1d5" title="The configured music-on-hold class to use for calls.">mohinterpret</a>));
<a name="l10501"></a>10501       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmp-&gt;<a class="code" href="structdahdi__pvt.html#aec4e201113703e94cd365aaa6dabd4f0" title="Suggested music-on-hold class for peer channel to use for calls.">mohsuggest</a>, conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#aec4e201113703e94cd365aaa6dabd4f0" title="Suggested music-on-hold class for peer channel to use for calls.">mohsuggest</a>, <span class="keyword">sizeof</span>(tmp-&gt;<a class="code" href="structdahdi__pvt.html#aec4e201113703e94cd365aaa6dabd4f0" title="Suggested music-on-hold class for peer channel to use for calls.">mohsuggest</a>));
<a name="l10502"></a>10502       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmp-&gt;<a class="code" href="structdahdi__pvt.html#ac25ea00ee3f082df06e0cf468cbde240" title="The configured context for incoming calls.">context</a>, conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ac25ea00ee3f082df06e0cf468cbde240" title="The configured context for incoming calls.">context</a>, <span class="keyword">sizeof</span>(tmp-&gt;<a class="code" href="structdahdi__pvt.html#ac25ea00ee3f082df06e0cf468cbde240" title="The configured context for incoming calls.">context</a>));
<a name="l10503"></a>10503       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmp-&gt;<a class="code" href="structdahdi__pvt.html#ac59e01fcfbc9801f87f28f6b60957a24">parkinglot</a>, conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ac59e01fcfbc9801f87f28f6b60957a24">parkinglot</a>, <span class="keyword">sizeof</span>(tmp-&gt;<a class="code" href="structdahdi__pvt.html#ac59e01fcfbc9801f87f28f6b60957a24">parkinglot</a>));
<a name="l10504"></a>10504       tmp-&gt;<a class="code" href="structdahdi__pvt.html#aff456ca48d31a9813584e799064cf88e" title="Caller ID Q.931 TON/NPI field values. Set by PRI. Zero otherwise.">cid_ton</a> = 0;
<a name="l10505"></a>10505       <span class="keywordflow">if</span> ((tmp-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> != <a class="code" href="chan__dahdi_8c.html#ae9ab0c9508fca045a06730533be276a5">SIG_PRI</a>) || (tmp-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> != <a class="code" href="chan__dahdi_8c.html#aadcda889db3cf9dfe757dbc1d4d8311a">SIG_SS7</a>) || (tmp-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> != <a class="code" href="chan__dahdi_8c.html#ab5bfeaf991c23c5b6510ace44ae79ce9">SIG_BRI</a>) || (tmp-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> != <a class="code" href="chan__dahdi_8c.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a>) || (tmp-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> != <a class="code" href="chan__dahdi_8c.html#a1d73a98ae12601287580dedd9a6d739b">SIG_MFCR2</a>)) {
<a name="l10506"></a>10506          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmp-&gt;<a class="code" href="structdahdi__pvt.html#a29e973bd94bfbaf59d939bd1bc988c32" title="Caller ID number from an incoming call.">cid_num</a>, conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a29e973bd94bfbaf59d939bd1bc988c32" title="Caller ID number from an incoming call.">cid_num</a>, <span class="keyword">sizeof</span>(tmp-&gt;<a class="code" href="structdahdi__pvt.html#a29e973bd94bfbaf59d939bd1bc988c32" title="Caller ID number from an incoming call.">cid_num</a>));
<a name="l10507"></a>10507          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmp-&gt;<a class="code" href="structdahdi__pvt.html#ade5a89f9bee15a492c760ec1765a292d" title="Caller ID name from an incoming call.">cid_name</a>, conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ade5a89f9bee15a492c760ec1765a292d" title="Caller ID name from an incoming call.">cid_name</a>, <span class="keyword">sizeof</span>(tmp-&gt;<a class="code" href="structdahdi__pvt.html#ade5a89f9bee15a492c760ec1765a292d" title="Caller ID name from an incoming call.">cid_name</a>));
<a name="l10508"></a>10508       } <span class="keywordflow">else</span> {
<a name="l10509"></a>10509          tmp-&gt;<a class="code" href="structdahdi__pvt.html#a29e973bd94bfbaf59d939bd1bc988c32" title="Caller ID number from an incoming call.">cid_num</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l10510"></a>10510          tmp-&gt;<a class="code" href="structdahdi__pvt.html#ade5a89f9bee15a492c760ec1765a292d" title="Caller ID name from an incoming call.">cid_name</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l10511"></a>10511       }
<a name="l10512"></a>10512       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmp-&gt;<a class="code" href="structdahdi__pvt.html#ac81f44f4f22dee90de5975cf8fa4641b" title="Voice mailbox location.">mailbox</a>, conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ac81f44f4f22dee90de5975cf8fa4641b" title="Voice mailbox location.">mailbox</a>, <span class="keyword">sizeof</span>(tmp-&gt;<a class="code" href="structdahdi__pvt.html#ac81f44f4f22dee90de5975cf8fa4641b" title="Voice mailbox location.">mailbox</a>));
<a name="l10513"></a>10513       <span class="keywordflow">if</span> (channel != <a class="code" href="chan__dahdi_8c.html#ada02a3fa3d2da06560df664c7228a559">CHAN_PSEUDO</a> &amp;&amp; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(tmp-&gt;<a class="code" href="structdahdi__pvt.html#ac81f44f4f22dee90de5975cf8fa4641b" title="Voice mailbox location.">mailbox</a>)) {
<a name="l10514"></a>10514          <span class="keywordtype">char</span> *<a class="code" href="chan__mgcp_8c.html#ac81f44f4f22dee90de5975cf8fa4641b">mailbox</a>, *<a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>;
<a name="l10515"></a>10515          mailbox = context = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(tmp-&gt;<a class="code" href="structdahdi__pvt.html#ac81f44f4f22dee90de5975cf8fa4641b" title="Voice mailbox location.">mailbox</a>);
<a name="l10516"></a>10516          <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;context, <span class="stringliteral">&quot;@&quot;</span>);
<a name="l10517"></a>10517          <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(context))
<a name="l10518"></a>10518             context = <span class="stringliteral">&quot;default&quot;</span>;
<a name="l10519"></a>10519          tmp-&gt;<a class="code" href="structdahdi__pvt.html#a7dec0df43032d5c53d9a125030385a30" title="Opaque event subscription parameters for message waiting indication support.">mwi_event_sub</a> = <a class="code" href="event_8h.html#a517ac17630e7658463b66b309a6ce78f" title="Subscribe to events.">ast_event_subscribe</a>(<a class="code" href="event__defs_8h.html#a6fa079412d9d9c1cc539f6d71f37f79fa9a217b1f500680b3e458d62b048c0892">AST_EVENT_MWI</a>, <a class="code" href="chan__dahdi_8c.html#a46e4523f99409c6696dc775ed6a5e5ed">mwi_event_cb</a>, NULL,
<a name="l10520"></a>10520             <a class="code" href="event__defs_8h.html#a003673523d7fe265c6738a5a9e49c491aae6c80d8f4c6ab3cee006ed57d874710" title="Mailbox name.">AST_EVENT_IE_MAILBOX</a>, <a class="code" href="event__defs_8h.html#a73dadfa1128d5e75107536e132e758c6ab82ac16f0791be2f8f918429a73430be">AST_EVENT_IE_PLTYPE_STR</a>, mailbox,
<a name="l10521"></a>10521             <a class="code" href="event__defs_8h.html#a003673523d7fe265c6738a5a9e49c491a25764e2fb734ccb3ee1f6f41caba5318" title="Context IE Used by AST_EVENT_MWI Payload type: str.">AST_EVENT_IE_CONTEXT</a>, <a class="code" href="event__defs_8h.html#a73dadfa1128d5e75107536e132e758c6ab82ac16f0791be2f8f918429a73430be">AST_EVENT_IE_PLTYPE_STR</a>, context,
<a name="l10522"></a>10522             <a class="code" href="event__defs_8h.html#a003673523d7fe265c6738a5a9e49c491aff40847f0450f17c96e94e721aee38f2" title="Number of new messages Used by: AST_EVENT_MWI Payload type: UINT.">AST_EVENT_IE_NEWMSGS</a>, <a class="code" href="event__defs_8h.html#a73dadfa1128d5e75107536e132e758c6a9a74c1021384e906552a3187545b5068">AST_EVENT_IE_PLTYPE_EXISTS</a>,
<a name="l10523"></a>10523             <a class="code" href="event__defs_8h.html#a003673523d7fe265c6738a5a9e49c491a04c78c1362e97d548344c354001c151f">AST_EVENT_IE_END</a>);
<a name="l10524"></a>10524       }
<a name="l10525"></a>10525       tmp-&gt;<a class="code" href="structdahdi__pvt.html#a734dc49c409d35148bff4b61e12ad58b" title="-1 = unknown, 0 = no messages, 1 = new messages available">msgstate</a> = -1;
<a name="l10526"></a>10526 <span class="preprocessor">#ifdef HAVE_DAHDI_LINEREVERSE_VMWI</span>
<a name="l10527"></a>10527 <span class="preprocessor"></span>      tmp-&gt;mwisend_setting = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.mwisend_setting;
<a name="l10528"></a>10528       tmp-&gt;mwisend_fsk  = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.mwisend_fsk;
<a name="l10529"></a>10529       tmp-&gt;mwisend_rpas = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.mwisend_rpas;
<a name="l10530"></a>10530 <span class="preprocessor">#endif</span>
<a name="l10531"></a>10531 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (chan_sig &amp; __DAHDI_SIG_FXO) {
<a name="l10532"></a>10532          memset(&amp;p, 0, <span class="keyword">sizeof</span>(p));
<a name="l10533"></a>10533          res = ioctl(tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_GET_PARAMS, &amp;p);
<a name="l10534"></a>10534          <span class="keywordflow">if</span> (!res) {
<a name="l10535"></a>10535             tmp-&gt;<a class="code" href="structdahdi__pvt.html#ab18fd594a2af8725e3ddb868d8499e06" title="TRUE if the FXS port is off-hook.">fxsoffhookstate</a> = p.rxisoffhook;
<a name="l10536"></a>10536          }
<a name="l10537"></a>10537 <span class="preprocessor">#ifdef HAVE_DAHDI_LINEREVERSE_VMWI</span>
<a name="l10538"></a>10538 <span class="preprocessor"></span>         res = ioctl(tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_VMWI_CONFIG, &amp;tmp-&gt;mwisend_setting);
<a name="l10539"></a>10539 <span class="preprocessor">#endif</span>
<a name="l10540"></a>10540 <span class="preprocessor"></span>      }
<a name="l10541"></a>10541       tmp-&gt;<a class="code" href="structdahdi__pvt.html#a74643a768dac2465f8612f81ba4ff177" title="Time the interface went on-hook.">onhooktime</a> = time(NULL);
<a name="l10542"></a>10542       tmp-&gt;<a class="code" href="structdahdi__pvt.html#a2f66424184fe1873f7b46b19de589b57" title="Bitmapped groups this belongs to.">group</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a2f66424184fe1873f7b46b19de589b57" title="Bitmapped groups this belongs to.">group</a>;
<a name="l10543"></a>10543       tmp-&gt;<a class="code" href="structdahdi__pvt.html#af0f007b48a9c8cf0629428bd0483e0d1" title="Bitmapped call groups this belongs to.">callgroup</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#af0f007b48a9c8cf0629428bd0483e0d1" title="Bitmapped call groups this belongs to.">callgroup</a>;
<a name="l10544"></a>10544       tmp-&gt;<a class="code" href="structdahdi__pvt.html#abc0651bcec68410023c036b7d8ec4d11" title="Bitmapped pickup groups this belongs to.">pickupgroup</a>= conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#abc0651bcec68410023c036b7d8ec4d11" title="Bitmapped pickup groups this belongs to.">pickupgroup</a>;
<a name="l10545"></a>10545       <span class="keywordflow">if</span> (conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a134fe67053d035e763d6cf99916c1bf8" title="Channel variable list with associated values to set when a channel is created.">vars</a>) {
<a name="l10546"></a>10546          <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *v, *tmpvar;
<a name="l10547"></a>10547                    <span class="keywordflow">for</span> (v = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a134fe67053d035e763d6cf99916c1bf8" title="Channel variable list with associated values to set when a channel is created.">vars</a> ; v ; v = v-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l10548"></a>10548                          <span class="keywordflow">if</span> ((tmpvar = <a class="code" href="config_8h.html#a08e94d96f459e7301a74daf32035423b">ast_variable_new</a>(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, v-&gt;<a class="code" href="structast__variable.html#adf16cd437526a5c5e0e0af87745acbb8">file</a>))) {
<a name="l10549"></a>10549                                   tmpvar-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a> = tmp-&gt;<a class="code" href="structdahdi__pvt.html#a134fe67053d035e763d6cf99916c1bf8" title="Channel variable list with associated values to set when a channel is created.">vars</a>;
<a name="l10550"></a>10550                                    tmp-&gt;<a class="code" href="structdahdi__pvt.html#a134fe67053d035e763d6cf99916c1bf8" title="Channel variable list with associated values to set when a channel is created.">vars</a> = tmpvar;
<a name="l10551"></a>10551                            }
<a name="l10552"></a>10552                   }
<a name="l10553"></a>10553       }
<a name="l10554"></a>10554       tmp-&gt;<a class="code" href="structdahdi__pvt.html#a0fab7ca391bb3e45727b888a50902f7e" title="Amount of gain to increase during caller id.">cid_rxgain</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a0fab7ca391bb3e45727b888a50902f7e" title="Amount of gain to increase during caller id.">cid_rxgain</a>;
<a name="l10555"></a>10555       tmp-&gt;<a class="code" href="structdahdi__pvt.html#aeebb464c72892c9f3ddafed5ade720ee" title="Rx gain set by chan_dahdi.conf.">rxgain</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#aeebb464c72892c9f3ddafed5ade720ee" title="Rx gain set by chan_dahdi.conf.">rxgain</a>;
<a name="l10556"></a>10556       tmp-&gt;<a class="code" href="structdahdi__pvt.html#ad291967734f3b7bee3ec179278a1f76f" title="Tx gain set by chan_dahdi.conf.">txgain</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ad291967734f3b7bee3ec179278a1f76f" title="Tx gain set by chan_dahdi.conf.">txgain</a>;
<a name="l10557"></a>10557       tmp-&gt;<a class="code" href="structdahdi__pvt.html#a6db22ef545ab36c0c1913d4541122d99">tonezone</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a6db22ef545ab36c0c1913d4541122d99">tonezone</a>;
<a name="l10558"></a>10558       <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a> &gt; -1) {
<a name="l10559"></a>10559          <a class="code" href="chan__dahdi_8c.html#a6abcbfc59e4d42646f31142d7dd2b830">set_actual_gain</a>(tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, 0, tmp-&gt;<a class="code" href="structdahdi__pvt.html#aeebb464c72892c9f3ddafed5ade720ee" title="Rx gain set by chan_dahdi.conf.">rxgain</a>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#ad291967734f3b7bee3ec179278a1f76f" title="Tx gain set by chan_dahdi.conf.">txgain</a>, tmp-&gt;<a class="code" href="structdahdi__pvt.html#a17dd7b17c0e736754e01e575ca8d8cb8" title="Active PCM encoding format: DAHDI_LAW_ALAW or DAHDI_LAW_MULAW.">law</a>);
<a name="l10560"></a>10560          <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>)
<a name="l10561"></a>10561             <a class="code" href="dsp_8h.html#aa28ffa065bd46d09b5b06de2f77183b0" title="Set digit mode.">ast_dsp_set_digitmode</a>(tmp-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>, <a class="code" href="dsp_8h.html#af0e16e88030540319d8a545dd7c2576c">DSP_DIGITMODE_DTMF</a> | tmp-&gt;<a class="code" href="structdahdi__pvt.html#a6829c6ed48c184cbd85055163786a7eb">dtmfrelax</a>);
<a name="l10562"></a>10562          <a class="code" href="chan__dahdi_8c.html#ac56c05fde8bc30c71af46502e97fae3b">update_conf</a>(tmp);
<a name="l10563"></a>10563          <span class="keywordflow">if</span> (!here) {
<a name="l10564"></a>10564             <span class="keywordflow">if</span> ((chan_sig != <a class="code" href="chan__dahdi_8c.html#ab5bfeaf991c23c5b6510ace44ae79ce9">SIG_BRI</a>) &amp;&amp; (chan_sig != <a class="code" href="chan__dahdi_8c.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a>) &amp;&amp; (chan_sig != <a class="code" href="chan__dahdi_8c.html#ae9ab0c9508fca045a06730533be276a5">SIG_PRI</a>)
<a name="l10565"></a>10565                 &amp;&amp; (chan_sig != <a class="code" href="chan__dahdi_8c.html#aadcda889db3cf9dfe757dbc1d4d8311a">SIG_SS7</a>) &amp;&amp; (chan_sig != <a class="code" href="chan__dahdi_8c.html#a1d73a98ae12601287580dedd9a6d739b">SIG_MFCR2</a>))
<a name="l10566"></a>10566                <span class="comment">/* Hang it up to be sure it&apos;s good */</span>
<a name="l10567"></a>10567                <a class="code" href="chan__dahdi_8c.html#a7c65e6943db828524ea6c9215b8bf696">dahdi_set_hook</a>(tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_ONHOOK);
<a name="l10568"></a>10568          }
<a name="l10569"></a>10569          ioctl(tmp-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>,DAHDI_SETTONEZONE,&amp;tmp-&gt;<a class="code" href="structdahdi__pvt.html#a6db22ef545ab36c0c1913d4541122d99">tonezone</a>);
<a name="l10570"></a>10570 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l10571"></a>10571 <span class="preprocessor"></span>         <span class="comment">/* the dchannel is down so put the channel in alarm */</span>
<a name="l10572"></a>10572          <span class="keywordflow">if</span> (tmp-&gt;pri &amp;&amp; !pri_is_up(tmp-&gt;pri))
<a name="l10573"></a>10573             tmp-&gt;<a class="code" href="structdahdi__pvt.html#adbe10c4b12619d6cb58b1ad14bc437af" title="TRUE if in an alarm condition.">inalarm</a> = 1;
<a name="l10574"></a>10574 <span class="preprocessor">#endif</span>
<a name="l10575"></a>10575 <span class="preprocessor"></span>         <span class="keywordflow">if</span> ((res = <a class="code" href="chan__dahdi_8c.html#ace00362fe9640b8a792c965572a87826">get_alarms</a>(tmp)) != DAHDI_ALARM_NONE) {
<a name="l10576"></a>10576             tmp-&gt;<a class="code" href="structdahdi__pvt.html#adbe10c4b12619d6cb58b1ad14bc437af" title="TRUE if in an alarm condition.">inalarm</a> = 1;
<a name="l10577"></a>10577             <a class="code" href="chan__dahdi_8c.html#aa8e0b028321154a280cad06d20099330">handle_alarms</a>(tmp, res);
<a name="l10578"></a>10578          }
<a name="l10579"></a>10579       }
<a name="l10580"></a>10580 
<a name="l10581"></a>10581       tmp-&gt;<a class="code" href="structdahdi__pvt.html#a28dcc1bc69a96039746426f0093f1ee5" title="Minimal time period (ms) between the answer polarity switch and hangup polarity switch...">polarityonanswerdelay</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a28dcc1bc69a96039746426f0093f1ee5" title="Minimal time period (ms) between the answer polarity switch and hangup polarity switch...">polarityonanswerdelay</a>;
<a name="l10582"></a>10582       tmp-&gt;<a class="code" href="structdahdi__pvt.html#a5a4fb6da5625cc1eec0c9821f0d41d52" title="TRUE if we can use a polarity reversal to mark when an outgoing call is answered...">answeronpolarityswitch</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a5a4fb6da5625cc1eec0c9821f0d41d52" title="TRUE if we can use a polarity reversal to mark when an outgoing call is answered...">answeronpolarityswitch</a>;
<a name="l10583"></a>10583       tmp-&gt;<a class="code" href="structdahdi__pvt.html#a7bc13c53b24817de617833097a940350" title="TRUE if the call will be considered &amp;quot;hung up&amp;quot; on a polarity reversal.">hanguponpolarityswitch</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a7bc13c53b24817de617833097a940350" title="TRUE if the call will be considered &amp;quot;hung up&amp;quot; on a polarity reversal.">hanguponpolarityswitch</a>;
<a name="l10584"></a>10584       tmp-&gt;<a class="code" href="structdahdi__pvt.html#a311ee33a384e8e54e8d782e584ec4544" title="Send caller ID after this many rings.">sendcalleridafter</a> = conf-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a311ee33a384e8e54e8d782e584ec4544" title="Send caller ID after this many rings.">sendcalleridafter</a>;
<a name="l10585"></a>10585       <span class="keywordflow">if</span> (!here) {
<a name="l10586"></a>10586          tmp-&gt;<a class="code" href="structdahdi__pvt.html#a513c772067fc245b524b1e46a0987ec0" title="TRUE if the channel is locally blocked.">locallyblocked</a> = tmp-&gt;<a class="code" href="structdahdi__pvt.html#a857733a6d05c0eda6d4b5122e1e4d3bc" title="TRUE if the channel is remotely blocked.">remotelyblocked</a> = 0;
<a name="l10587"></a>10587          <span class="keywordflow">if</span> ((chan_sig == <a class="code" href="chan__dahdi_8c.html#ae9ab0c9508fca045a06730533be276a5">SIG_PRI</a>) || (chan_sig == <a class="code" href="chan__dahdi_8c.html#ab5bfeaf991c23c5b6510ace44ae79ce9">SIG_BRI</a>) || (chan_sig == <a class="code" href="chan__dahdi_8c.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a>) || (chan_sig == <a class="code" href="chan__dahdi_8c.html#aadcda889db3cf9dfe757dbc1d4d8311a">SIG_SS7</a>))
<a name="l10588"></a>10588             tmp-&gt;<a class="code" href="structdahdi__pvt.html#adf0efa7b1a2facbbaccccd9e6744f65e" title="TRUE if channel is out of reset and ready.">inservice</a> = 0;
<a name="l10589"></a>10589          <span class="keywordflow">else</span> <span class="comment">/* We default to in service on protocols that don&apos;t have a reset */</span>
<a name="l10590"></a>10590             tmp-&gt;<a class="code" href="structdahdi__pvt.html#adf0efa7b1a2facbbaccccd9e6744f65e" title="TRUE if channel is out of reset and ready.">inservice</a> = 1;
<a name="l10591"></a>10591       }
<a name="l10592"></a>10592    }
<a name="l10593"></a>10593    <span class="keywordflow">if</span> (tmp &amp;&amp; !here) {
<a name="l10594"></a>10594       <span class="comment">/* nothing on the iflist */</span>
<a name="l10595"></a>10595       <span class="keywordflow">if</span> (!*wlist) {
<a name="l10596"></a>10596          *wlist = tmp;
<a name="l10597"></a>10597          tmp-&gt;<a class="code" href="structdahdi__pvt.html#abba5e5e1dcf19b4ded5000d926e0a70d">prev</a> = NULL;
<a name="l10598"></a>10598          tmp-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a> = NULL;
<a name="l10599"></a>10599          *wend = tmp;
<a name="l10600"></a>10600       } <span class="keywordflow">else</span> {
<a name="l10601"></a>10601          <span class="comment">/* at least one member on the iflist */</span>
<a name="l10602"></a>10602          <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *working = *wlist;
<a name="l10603"></a>10603 
<a name="l10604"></a>10604          <span class="comment">/* check if we maybe have to put it on the begining */</span>
<a name="l10605"></a>10605          <span class="keywordflow">if</span> (working-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a> &gt; tmp-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>) {
<a name="l10606"></a>10606             tmp-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a> = *wlist;
<a name="l10607"></a>10607             tmp-&gt;<a class="code" href="structdahdi__pvt.html#abba5e5e1dcf19b4ded5000d926e0a70d">prev</a> = NULL;
<a name="l10608"></a>10608             (*wlist)-&gt;<a class="code" href="structdahdi__pvt.html#abba5e5e1dcf19b4ded5000d926e0a70d">prev</a> = tmp;
<a name="l10609"></a>10609             *wlist = tmp;
<a name="l10610"></a>10610          } <span class="keywordflow">else</span> {
<a name="l10611"></a>10611          <span class="comment">/* go through all the members and put the member in the right place */</span>
<a name="l10612"></a>10612             <span class="keywordflow">while</span> (working) {
<a name="l10613"></a>10613                <span class="comment">/* in the middle */</span>
<a name="l10614"></a>10614                <span class="keywordflow">if</span> (working-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>) {
<a name="l10615"></a>10615                   <span class="keywordflow">if</span> (working-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a> &lt; tmp-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a> &amp;&amp; working-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a> &gt; tmp-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>) {
<a name="l10616"></a>10616                      tmp-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a> = working-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>;
<a name="l10617"></a>10617                      tmp-&gt;<a class="code" href="structdahdi__pvt.html#abba5e5e1dcf19b4ded5000d926e0a70d">prev</a> = working;
<a name="l10618"></a>10618                      working-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>-&gt;<a class="code" href="structdahdi__pvt.html#abba5e5e1dcf19b4ded5000d926e0a70d">prev</a> = tmp;
<a name="l10619"></a>10619                      working-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a> = tmp;
<a name="l10620"></a>10620                      <span class="keywordflow">break</span>;
<a name="l10621"></a>10621                   }
<a name="l10622"></a>10622                } <span class="keywordflow">else</span> {
<a name="l10623"></a>10623                <span class="comment">/* the last */</span>
<a name="l10624"></a>10624                   <span class="keywordflow">if</span> (working-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a> &lt; tmp-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>) {
<a name="l10625"></a>10625                      working-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a> = tmp;
<a name="l10626"></a>10626                      tmp-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a> = NULL;
<a name="l10627"></a>10627                      tmp-&gt;<a class="code" href="structdahdi__pvt.html#abba5e5e1dcf19b4ded5000d926e0a70d">prev</a> = working;
<a name="l10628"></a>10628                      *wend = tmp;
<a name="l10629"></a>10629                      <span class="keywordflow">break</span>;
<a name="l10630"></a>10630                   }
<a name="l10631"></a>10631                }
<a name="l10632"></a>10632                working = working-&gt;<a class="code" href="structdahdi__pvt.html#a1f63ecd911ba1dd51c8dfed8909e7cd9">next</a>;
<a name="l10633"></a>10633             }
<a name="l10634"></a>10634          }
<a name="l10635"></a>10635       }
<a name="l10636"></a>10636    }
<a name="l10637"></a>10637    <span class="keywordflow">return</span> tmp;
<a name="l10638"></a>10638 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a46e4523f99409c6696dc775ed6a5e5ed"></a><!-- doxytag: member="chan_dahdi.c::mwi_event_cb" ref="a46e4523f99409c6696dc775ed6a5e5ed" args="(const struct ast_event *event, void *userdata)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void mwi_event_cb </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structast__event.html">ast_event</a> *&nbsp;</td>
          <td class="paramname"> <em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>userdata</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00367">367</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00368"></a>00368 {
<a name="l00369"></a>00369    <span class="comment">/* This module does not handle MWI in an event-based manner.  However, it</span>
<a name="l00370"></a>00370 <span class="comment">    * subscribes to MWI for each mailbox that is configured so that the core</span>
<a name="l00371"></a>00371 <span class="comment">    * knows that we care about it.  Then, chan_dahdi will get the MWI from the</span>
<a name="l00372"></a>00372 <span class="comment">    * event cache instead of checking the mailbox directly. */</span>
<a name="l00373"></a>00373 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5b4f0979ef9234fc9878dfa508ccf8ef"></a><!-- doxytag: member="chan_dahdi.c::mwi_send_init" ref="a5b4f0979ef9234fc9878dfa508ccf8ef" args="(struct dahdi_pvt *pvt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int mwi_send_init </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>pvt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l09063">9063</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="chan__dahdi_8c_source.html#l00209">AST_LAW</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="callerid_8h_source.html#l00073">CID_MWI_TYPE_MDMF_FULL</a>, <a class="el" href="chan__dahdi_8c_source.html#l01001">dahdi_pvt::cid_name</a>, <a class="el" href="chan__dahdi_8c_source.html#l00997">dahdi_pvt::cid_num</a>, <a class="el" href="chan__dahdi_8c_source.html#l01054">dahdi_pvt::cidlen</a>, <a class="el" href="chan__dahdi_8c_source.html#l01052">dahdi_pvt::cidpos</a>, <a class="el" href="chan__dahdi_8c_source.html#l01050">dahdi_pvt::cidspill</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="chan__dahdi_8c_source.html#l03001">has_voicemail()</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="callerid_8h_source.html#l00048">MAX_CALLERID_SIZE</a>, <a class="el" href="chan__dahdi_8c_source.html#l00635">MWI_SEND_SA</a>, <a class="el" href="chan__dahdi_8c_source.html#l00638">MWI_SEND_SPILL</a>, <a class="el" href="chan__dahdi_8c_source.html#l00645">mwisend_info::mwisend_current</a>, <a class="el" href="chan__dahdi_8c_source.html#l00956">dahdi_pvt::mwisend_data</a>, <a class="el" href="chan__dahdi_8c_source.html#l00902">dahdi_pvt::mwisendactive</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>, and <a class="el" href="callerid_8c_source.html#l00794">vmwi_generate()</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l09496">do_monitor()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09064"></a>09064 {
<a name="l09065"></a>09065    <span class="keywordtype">int</span> x, res;
<a name="l09066"></a>09066 
<a name="l09067"></a>09067 <span class="preprocessor">#ifdef HAVE_DAHDI_LINEREVERSE_VMWI</span>
<a name="l09068"></a>09068 <span class="preprocessor"></span>   <span class="comment">/* Determine how this spill is to be sent */</span>
<a name="l09069"></a>09069    <span class="keywordflow">if</span> (pvt-&gt;mwisend_rpas) {
<a name="l09070"></a>09070       pvt-&gt;<a class="code" href="structdahdi__pvt.html#a39a7c5e5175acb8c242f944cc6b7eb71">mwisend_data</a>.<a class="code" href="structmwisend__info.html#a08a962c5a80e63eb6da43d615dc153ad">mwisend_current</a> = <a class="code" href="chan__dahdi_8c.html#ac6eb1255d7d5fc62e32b545a15e2ee38a26ea69f32853d570979948e99c019ad6">MWI_SEND_SA</a>;
<a name="l09071"></a>09071       pvt-&gt;<a class="code" href="structdahdi__pvt.html#a35892585f7fbbba650b0bf1315d5e8c1" title="TRUE if a MWI message sending thread is active.">mwisendactive</a> = 1;
<a name="l09072"></a>09072    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pvt-&gt;mwisend_fsk) {
<a name="l09073"></a>09073       pvt-&gt;<a class="code" href="structdahdi__pvt.html#a39a7c5e5175acb8c242f944cc6b7eb71">mwisend_data</a>.<a class="code" href="structmwisend__info.html#a08a962c5a80e63eb6da43d615dc153ad">mwisend_current</a> = <a class="code" href="chan__dahdi_8c.html#ac6eb1255d7d5fc62e32b545a15e2ee38abdb497716e46eb102ddd50ed81082e4c">MWI_SEND_SPILL</a>;
<a name="l09074"></a>09074       pvt-&gt;<a class="code" href="structdahdi__pvt.html#a35892585f7fbbba650b0bf1315d5e8c1" title="TRUE if a MWI message sending thread is active.">mwisendactive</a> = 1;
<a name="l09075"></a>09075    } <span class="keywordflow">else</span> {
<a name="l09076"></a>09076       pvt-&gt;<a class="code" href="structdahdi__pvt.html#a35892585f7fbbba650b0bf1315d5e8c1" title="TRUE if a MWI message sending thread is active.">mwisendactive</a> = 0;
<a name="l09077"></a>09077       <span class="keywordflow">return</span> 0;
<a name="l09078"></a>09078    }
<a name="l09079"></a>09079 <span class="preprocessor">#else</span>
<a name="l09080"></a>09080 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#a3ae0342ed2b020e1e4cc4483e3fa55a6">mwisend_rpas</a>) {
<a name="l09081"></a>09081       pvt-&gt;<a class="code" href="structdahdi__pvt.html#a39a7c5e5175acb8c242f944cc6b7eb71">mwisend_data</a>.<a class="code" href="structmwisend__info.html#a08a962c5a80e63eb6da43d615dc153ad">mwisend_current</a> = <a class="code" href="chan__dahdi_8c.html#ac6eb1255d7d5fc62e32b545a15e2ee38a26ea69f32853d570979948e99c019ad6">MWI_SEND_SA</a>;
<a name="l09082"></a>09082    } <span class="keywordflow">else</span> {
<a name="l09083"></a>09083       pvt-&gt;<a class="code" href="structdahdi__pvt.html#a39a7c5e5175acb8c242f944cc6b7eb71">mwisend_data</a>.<a class="code" href="structmwisend__info.html#a08a962c5a80e63eb6da43d615dc153ad">mwisend_current</a> = <a class="code" href="chan__dahdi_8c.html#ac6eb1255d7d5fc62e32b545a15e2ee38abdb497716e46eb102ddd50ed81082e4c">MWI_SEND_SPILL</a>;
<a name="l09084"></a>09084    }
<a name="l09085"></a>09085    pvt-&gt;<a class="code" href="structdahdi__pvt.html#a35892585f7fbbba650b0bf1315d5e8c1" title="TRUE if a MWI message sending thread is active.">mwisendactive</a> = 1;
<a name="l09086"></a>09086 <span class="preprocessor">#endif</span>
<a name="l09087"></a>09087 <span class="preprocessor"></span>
<a name="l09088"></a>09088    <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a>) {
<a name="l09089"></a>09089       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;cidspill already exists when trying to send FSK MWI\n&quot;</span>);
<a name="l09090"></a>09090       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(pvt-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a>);
<a name="l09091"></a>09091       pvt-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a> = NULL;
<a name="l09092"></a>09092       pvt-&gt;<a class="code" href="structdahdi__pvt.html#ac0df3c8f4391be85a4d95a23866d4313" title="Position in the cidspill buffer to send out next.">cidpos</a> = 0;
<a name="l09093"></a>09093       pvt-&gt;<a class="code" href="structdahdi__pvt.html#a241dcb75aa2cae2b5c7b899eb95079d0" title="Length of the cidspill buffer containing samples.">cidlen</a> = 0;
<a name="l09094"></a>09094    }
<a name="l09095"></a>09095    pvt-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a> = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <a class="code" href="callerid_8h.html#a532bcb39ca48d514d3765747d5c91f25">MAX_CALLERID_SIZE</a>);
<a name="l09096"></a>09096    <span class="keywordflow">if</span> (!pvt-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a>) {
<a name="l09097"></a>09097       pvt-&gt;<a class="code" href="structdahdi__pvt.html#a35892585f7fbbba650b0bf1315d5e8c1" title="TRUE if a MWI message sending thread is active.">mwisendactive</a> = 0;
<a name="l09098"></a>09098       <span class="keywordflow">return</span> -1;
<a name="l09099"></a>09099    }
<a name="l09100"></a>09100    x = DAHDI_FLUSH_BOTH;
<a name="l09101"></a>09101    res = ioctl(pvt-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_FLUSH, &amp;x);
<a name="l09102"></a>09102    x = 3000;
<a name="l09103"></a>09103    ioctl(pvt-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_ONHOOKTRANSFER, &amp;x);
<a name="l09104"></a>09104 <span class="preprocessor">#ifdef HAVE_DAHDI_LINEREVERSE_VMWI</span>
<a name="l09105"></a>09105 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (pvt-&gt;mwisend_fsk) {
<a name="l09106"></a>09106 <span class="preprocessor">#endif</span>
<a name="l09107"></a>09107 <span class="preprocessor"></span>      pvt-&gt;<a class="code" href="structdahdi__pvt.html#a241dcb75aa2cae2b5c7b899eb95079d0" title="Length of the cidspill buffer containing samples.">cidlen</a> = <a class="code" href="callerid_8h.html#a8b49195fa90c382bda46882ffabfe0a2" title="Generate message waiting indicator.">vmwi_generate</a>(pvt-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a>, <a class="code" href="chan__dahdi_8c.html#a8be869dea1576c3f11795532605549dc">has_voicemail</a>(pvt), <a class="code" href="callerid_8h.html#aacdaed00a37721d3ab3a861627af9222">CID_MWI_TYPE_MDMF_FULL</a>,
<a name="l09108"></a>09108                         <a class="code" href="chan__dahdi_8c.html#a830b5fdb3ba653640d3f5044192d82bf">AST_LAW</a>(pvt), pvt-&gt;<a class="code" href="structdahdi__pvt.html#ade5a89f9bee15a492c760ec1765a292d" title="Caller ID name from an incoming call.">cid_name</a>, pvt-&gt;<a class="code" href="structdahdi__pvt.html#a29e973bd94bfbaf59d939bd1bc988c32" title="Caller ID number from an incoming call.">cid_num</a>, 0);
<a name="l09109"></a>09109       pvt-&gt;<a class="code" href="structdahdi__pvt.html#ac0df3c8f4391be85a4d95a23866d4313" title="Position in the cidspill buffer to send out next.">cidpos</a> = 0;
<a name="l09110"></a>09110 <span class="preprocessor">#ifdef HAVE_DAHDI_LINEREVERSE_VMWI</span>
<a name="l09111"></a>09111 <span class="preprocessor"></span>   }
<a name="l09112"></a>09112 <span class="preprocessor">#endif</span>
<a name="l09113"></a>09113 <span class="preprocessor"></span>   <span class="keywordflow">return</span> 0;
<a name="l09114"></a>09114 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab7d3473f01f0d6142712aec7bb8ff323"></a><!-- doxytag: member="chan_dahdi.c::mwi_send_process_buffer" ref="ab7d3473f01f0d6142712aec7bb8ff323" args="(struct dahdi_pvt *pvt, int num_read)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int mwi_send_process_buffer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>pvt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>num_read</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l09116">9116</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01054">dahdi_pvt::cidlen</a>, <a class="el" href="chan__dahdi_8c_source.html#l01052">dahdi_pvt::cidpos</a>, <a class="el" href="chan__dahdi_8c_source.html#l01050">dahdi_pvt::cidspill</a>, <a class="el" href="chan__dahdi_8c_source.html#l02863">dahdi_set_hook()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__dahdi_8c_source.html#l00639">MWI_SEND_CLEANUP</a>, <a class="el" href="chan__dahdi_8c_source.html#l00640">MWI_SEND_DONE</a>, <a class="el" href="chan__dahdi_8c_source.html#l00637">MWI_SEND_PAUSE</a>, <a class="el" href="chan__dahdi_8c_source.html#l00635">MWI_SEND_SA</a>, <a class="el" href="chan__dahdi_8c_source.html#l00636">MWI_SEND_SA_WAIT</a>, <a class="el" href="chan__dahdi_8c_source.html#l00638">MWI_SEND_SPILL</a>, <a class="el" href="chan__dahdi_8c_source.html#l00645">mwisend_info::mwisend_current</a>, <a class="el" href="chan__dahdi_8c_source.html#l00956">dahdi_pvt::mwisend_data</a>, <a class="el" href="chan__dahdi_8c_source.html#l00902">dahdi_pvt::mwisendactive</a>, <a class="el" href="chan__dahdi_8c_source.html#l00644">mwisend_info::pause</a>, <a class="el" href="pbx__gtkconsole_8c_source.html#l00059">quit</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l09496">do_monitor()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09117"></a>09117 {
<a name="l09118"></a>09118    <span class="keyword">struct </span>timeval    now;
<a name="l09119"></a>09119    <span class="keywordtype">int</span>         res;
<a name="l09120"></a>09120 
<a name="l09121"></a>09121    <span class="comment">/* sanity check to catch if this had been interrupted previously</span>
<a name="l09122"></a>09122 <span class="comment">   *  i.e. state says there is more to do but there is no spill allocated</span>
<a name="l09123"></a>09123 <span class="comment">   */</span>
<a name="l09124"></a>09124    <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#ac6eb1255d7d5fc62e32b545a15e2ee38aae305004b9065d512f57d60fb0d36ef1">MWI_SEND_DONE</a> != pvt-&gt;<a class="code" href="structdahdi__pvt.html#a39a7c5e5175acb8c242f944cc6b7eb71">mwisend_data</a>.<a class="code" href="structmwisend__info.html#a08a962c5a80e63eb6da43d615dc153ad">mwisend_current</a> &amp;&amp; !pvt-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a>) {
<a name="l09125"></a>09125       pvt-&gt;<a class="code" href="structdahdi__pvt.html#a39a7c5e5175acb8c242f944cc6b7eb71">mwisend_data</a>.<a class="code" href="structmwisend__info.html#a08a962c5a80e63eb6da43d615dc153ad">mwisend_current</a> = <a class="code" href="chan__dahdi_8c.html#ac6eb1255d7d5fc62e32b545a15e2ee38aae305004b9065d512f57d60fb0d36ef1">MWI_SEND_DONE</a>;
<a name="l09126"></a>09126    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#ac6eb1255d7d5fc62e32b545a15e2ee38aae305004b9065d512f57d60fb0d36ef1">MWI_SEND_DONE</a> != pvt-&gt;<a class="code" href="structdahdi__pvt.html#a39a7c5e5175acb8c242f944cc6b7eb71">mwisend_data</a>.<a class="code" href="structmwisend__info.html#a08a962c5a80e63eb6da43d615dc153ad">mwisend_current</a>) {
<a name="l09127"></a>09127       <span class="comment">/* Normal processing -- Perform mwi send action */</span>
<a name="l09128"></a>09128       <span class="keywordflow">switch</span> ( pvt-&gt;<a class="code" href="structdahdi__pvt.html#a39a7c5e5175acb8c242f944cc6b7eb71">mwisend_data</a>.<a class="code" href="structmwisend__info.html#a08a962c5a80e63eb6da43d615dc153ad">mwisend_current</a>) {
<a name="l09129"></a>09129       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ac6eb1255d7d5fc62e32b545a15e2ee38a26ea69f32853d570979948e99c019ad6">MWI_SEND_SA</a>:
<a name="l09130"></a>09130          <span class="comment">/* Send the Ring Pulse Signal Alert */</span>
<a name="l09131"></a>09131          res = ioctl(pvt-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_SETCADENCE, &amp;<a class="code" href="chan__dahdi_8c.html#a7e5dcc799403137bdce59f53d7137385">AS_RP_cadence</a>);
<a name="l09132"></a>09132          <span class="keywordflow">if</span> (res) {
<a name="l09133"></a>09133             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to set RP-AS ring cadence: %s\n&quot;</span>, strerror(errno));
<a name="l09134"></a>09134             <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l09135"></a>09135          }
<a name="l09136"></a>09136          res = <a class="code" href="chan__dahdi_8c.html#a7c65e6943db828524ea6c9215b8bf696">dahdi_set_hook</a>(pvt-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_RING);
<a name="l09137"></a>09137          pvt-&gt;<a class="code" href="structdahdi__pvt.html#a39a7c5e5175acb8c242f944cc6b7eb71">mwisend_data</a>.<a class="code" href="structmwisend__info.html#a08a962c5a80e63eb6da43d615dc153ad">mwisend_current</a> = <a class="code" href="chan__dahdi_8c.html#ac6eb1255d7d5fc62e32b545a15e2ee38a6a12b01ecaf82d8837cb5d4e1764b54f">MWI_SEND_SA_WAIT</a>;
<a name="l09138"></a>09138          <span class="keywordflow">break</span>;
<a name="l09139"></a>09139       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ac6eb1255d7d5fc62e32b545a15e2ee38a6a12b01ecaf82d8837cb5d4e1764b54f">MWI_SEND_SA_WAIT</a>:  <span class="comment">/* do nothing until I get RINGEROFF event */</span>
<a name="l09140"></a>09140          <span class="keywordflow">break</span>;
<a name="l09141"></a>09141       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ac6eb1255d7d5fc62e32b545a15e2ee38a5030903afd5a2db7324494c3b2546935">MWI_SEND_PAUSE</a>:  <span class="comment">/* Wait between alert and spill - min of 500 mS*/</span>
<a name="l09142"></a>09142 <span class="preprocessor">#ifdef HAVE_DAHDI_LINEREVERSE_VMWI</span>
<a name="l09143"></a>09143 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (pvt-&gt;mwisend_fsk) {
<a name="l09144"></a>09144 <span class="preprocessor">#endif</span>
<a name="l09145"></a>09145 <span class="preprocessor"></span>            gettimeofday(&amp;now, NULL);
<a name="l09146"></a>09146             <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)(now.tv_sec - pvt-&gt;<a class="code" href="structdahdi__pvt.html#a39a7c5e5175acb8c242f944cc6b7eb71">mwisend_data</a>.<a class="code" href="structmwisend__info.html#ab69c80cc0e2dda5839a253483ed0e861">pause</a>.tv_sec) * 1000000 + (<span class="keywordtype">int</span>)now.tv_usec - (<span class="keywordtype">int</span>)pvt-&gt;<a class="code" href="structdahdi__pvt.html#a39a7c5e5175acb8c242f944cc6b7eb71">mwisend_data</a>.<a class="code" href="structmwisend__info.html#ab69c80cc0e2dda5839a253483ed0e861">pause</a>.tv_usec &gt; 500000) {
<a name="l09147"></a>09147                pvt-&gt;<a class="code" href="structdahdi__pvt.html#a39a7c5e5175acb8c242f944cc6b7eb71">mwisend_data</a>.<a class="code" href="structmwisend__info.html#a08a962c5a80e63eb6da43d615dc153ad">mwisend_current</a> = <a class="code" href="chan__dahdi_8c.html#ac6eb1255d7d5fc62e32b545a15e2ee38abdb497716e46eb102ddd50ed81082e4c">MWI_SEND_SPILL</a>;
<a name="l09148"></a>09148             }
<a name="l09149"></a>09149 <span class="preprocessor">#ifdef HAVE_DAHDI_LINEREVERSE_VMWI</span>
<a name="l09150"></a>09150 <span class="preprocessor"></span>         } <span class="keywordflow">else</span> { <span class="comment">/* support for mwisendtype=nofsk */</span>
<a name="l09151"></a>09151             pvt-&gt;<a class="code" href="structdahdi__pvt.html#a39a7c5e5175acb8c242f944cc6b7eb71">mwisend_data</a>.<a class="code" href="structmwisend__info.html#a08a962c5a80e63eb6da43d615dc153ad">mwisend_current</a> = <a class="code" href="chan__dahdi_8c.html#ac6eb1255d7d5fc62e32b545a15e2ee38ac1e087089f32665428639ae83f465b60">MWI_SEND_CLEANUP</a>;
<a name="l09152"></a>09152          }
<a name="l09153"></a>09153 <span class="preprocessor">#endif</span>
<a name="l09154"></a>09154 <span class="preprocessor"></span>         <span class="keywordflow">break</span>;
<a name="l09155"></a>09155       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ac6eb1255d7d5fc62e32b545a15e2ee38abdb497716e46eb102ddd50ed81082e4c">MWI_SEND_SPILL</a>:
<a name="l09156"></a>09156          <span class="comment">/* We read some number of bytes.  Write an equal amount of data */</span>
<a name="l09157"></a>09157          <span class="keywordflow">if</span>(0 &lt; num_read) {
<a name="l09158"></a>09158             <span class="keywordflow">if</span> (num_read &gt; pvt-&gt;<a class="code" href="structdahdi__pvt.html#a241dcb75aa2cae2b5c7b899eb95079d0" title="Length of the cidspill buffer containing samples.">cidlen</a> - pvt-&gt;<a class="code" href="structdahdi__pvt.html#ac0df3c8f4391be85a4d95a23866d4313" title="Position in the cidspill buffer to send out next.">cidpos</a>)
<a name="l09159"></a>09159                num_read = pvt-&gt;<a class="code" href="structdahdi__pvt.html#a241dcb75aa2cae2b5c7b899eb95079d0" title="Length of the cidspill buffer containing samples.">cidlen</a> - pvt-&gt;<a class="code" href="structdahdi__pvt.html#ac0df3c8f4391be85a4d95a23866d4313" title="Position in the cidspill buffer to send out next.">cidpos</a>;
<a name="l09160"></a>09160             res = write(pvt-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, pvt-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a> + pvt-&gt;<a class="code" href="structdahdi__pvt.html#ac0df3c8f4391be85a4d95a23866d4313" title="Position in the cidspill buffer to send out next.">cidpos</a>, num_read);
<a name="l09161"></a>09161             <span class="keywordflow">if</span> (res &gt; 0) {
<a name="l09162"></a>09162                pvt-&gt;<a class="code" href="structdahdi__pvt.html#ac0df3c8f4391be85a4d95a23866d4313" title="Position in the cidspill buffer to send out next.">cidpos</a> += res;
<a name="l09163"></a>09163                <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structdahdi__pvt.html#ac0df3c8f4391be85a4d95a23866d4313" title="Position in the cidspill buffer to send out next.">cidpos</a> &gt;= pvt-&gt;<a class="code" href="structdahdi__pvt.html#a241dcb75aa2cae2b5c7b899eb95079d0" title="Length of the cidspill buffer containing samples.">cidlen</a>) {
<a name="l09164"></a>09164                   pvt-&gt;<a class="code" href="structdahdi__pvt.html#a39a7c5e5175acb8c242f944cc6b7eb71">mwisend_data</a>.<a class="code" href="structmwisend__info.html#a08a962c5a80e63eb6da43d615dc153ad">mwisend_current</a> = <a class="code" href="chan__dahdi_8c.html#ac6eb1255d7d5fc62e32b545a15e2ee38ac1e087089f32665428639ae83f465b60">MWI_SEND_CLEANUP</a>;
<a name="l09165"></a>09165                }
<a name="l09166"></a>09166             } <span class="keywordflow">else</span> {
<a name="l09167"></a>09167                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;MWI FSK Send Write failed: %s\n&quot;</span>, strerror(errno));
<a name="l09168"></a>09168                <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l09169"></a>09169             }
<a name="l09170"></a>09170          }
<a name="l09171"></a>09171          <span class="keywordflow">break</span>;
<a name="l09172"></a>09172       <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ac6eb1255d7d5fc62e32b545a15e2ee38ac1e087089f32665428639ae83f465b60">MWI_SEND_CLEANUP</a>:
<a name="l09173"></a>09173          <span class="comment">/* For now, do nothing */</span>
<a name="l09174"></a>09174          pvt-&gt;<a class="code" href="structdahdi__pvt.html#a39a7c5e5175acb8c242f944cc6b7eb71">mwisend_data</a>.<a class="code" href="structmwisend__info.html#a08a962c5a80e63eb6da43d615dc153ad">mwisend_current</a> = <a class="code" href="chan__dahdi_8c.html#ac6eb1255d7d5fc62e32b545a15e2ee38aae305004b9065d512f57d60fb0d36ef1">MWI_SEND_DONE</a>;
<a name="l09175"></a>09175          <span class="keywordflow">break</span>;
<a name="l09176"></a>09176       <span class="keywordflow">default</span>:
<a name="l09177"></a>09177          <span class="comment">/* Should not get here, punt*/</span>
<a name="l09178"></a>09178          <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l09179"></a>09179       }
<a name="l09180"></a>09180    }
<a name="l09181"></a>09181 
<a name="l09182"></a>09182    <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#ac6eb1255d7d5fc62e32b545a15e2ee38aae305004b9065d512f57d60fb0d36ef1">MWI_SEND_DONE</a> == pvt-&gt;<a class="code" href="structdahdi__pvt.html#a39a7c5e5175acb8c242f944cc6b7eb71">mwisend_data</a>.<a class="code" href="structmwisend__info.html#a08a962c5a80e63eb6da43d615dc153ad">mwisend_current</a>) {
<a name="l09183"></a>09183       <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a>) {
<a name="l09184"></a>09184          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(pvt-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a>);
<a name="l09185"></a>09185          pvt-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a> = NULL;
<a name="l09186"></a>09186          pvt-&gt;<a class="code" href="structdahdi__pvt.html#ac0df3c8f4391be85a4d95a23866d4313" title="Position in the cidspill buffer to send out next.">cidpos</a> = 0;
<a name="l09187"></a>09187          pvt-&gt;<a class="code" href="structdahdi__pvt.html#a241dcb75aa2cae2b5c7b899eb95079d0" title="Length of the cidspill buffer containing samples.">cidlen</a> = 0;
<a name="l09188"></a>09188       }
<a name="l09189"></a>09189       pvt-&gt;<a class="code" href="structdahdi__pvt.html#a35892585f7fbbba650b0bf1315d5e8c1" title="TRUE if a MWI message sending thread is active.">mwisendactive</a> = 0;
<a name="l09190"></a>09190    }
<a name="l09191"></a>09191    <span class="keywordflow">return</span> 0;
<a name="l09192"></a>09192 <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>:
<a name="l09193"></a>09193    <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a>) {
<a name="l09194"></a>09194       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(pvt-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a>);
<a name="l09195"></a>09195       pvt-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a> = NULL;
<a name="l09196"></a>09196       pvt-&gt;<a class="code" href="structdahdi__pvt.html#ac0df3c8f4391be85a4d95a23866d4313" title="Position in the cidspill buffer to send out next.">cidpos</a> = 0;
<a name="l09197"></a>09197       pvt-&gt;<a class="code" href="structdahdi__pvt.html#a241dcb75aa2cae2b5c7b899eb95079d0" title="Length of the cidspill buffer containing samples.">cidlen</a> = 0;
<a name="l09198"></a>09198    }
<a name="l09199"></a>09199    pvt-&gt;<a class="code" href="structdahdi__pvt.html#a35892585f7fbbba650b0bf1315d5e8c1" title="TRUE if a MWI message sending thread is active.">mwisendactive</a> = 0;
<a name="l09200"></a>09200    <span class="keywordflow">return</span> -1;
<a name="l09201"></a>09201 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae8e5e4322c88dc92c793d37ad86a1fe1"></a><!-- doxytag: member="chan_dahdi.c::mwi_send_process_event" ref="ae8e5e4322c88dc92c793d37ad86a1fe1" args="(struct dahdi_pvt *pvt, int event)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int mwi_send_process_event </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>pvt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>event</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l09203">9203</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01054">dahdi_pvt::cidlen</a>, <a class="el" href="chan__dahdi_8c_source.html#l01052">dahdi_pvt::cidpos</a>, <a class="el" href="chan__dahdi_8c_source.html#l01050">dahdi_pvt::cidspill</a>, <a class="el" href="chan__dahdi_8c_source.html#l02863">dahdi_set_hook()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__dahdi_8c_source.html#l00640">MWI_SEND_DONE</a>, <a class="el" href="chan__dahdi_8c_source.html#l00637">MWI_SEND_PAUSE</a>, <a class="el" href="chan__dahdi_8c_source.html#l00636">MWI_SEND_SA_WAIT</a>, <a class="el" href="chan__dahdi_8c_source.html#l00645">mwisend_info::mwisend_current</a>, <a class="el" href="chan__dahdi_8c_source.html#l00956">dahdi_pvt::mwisend_data</a>, <a class="el" href="chan__dahdi_8c_source.html#l00902">dahdi_pvt::mwisendactive</a>, <a class="el" href="chan__dahdi_8c_source.html#l00644">mwisend_info::pause</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l09496">do_monitor()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09204"></a>09204 {
<a name="l09205"></a>09205    <span class="keywordtype">int</span> handled = 0;
<a name="l09206"></a>09206 
<a name="l09207"></a>09207    <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#ac6eb1255d7d5fc62e32b545a15e2ee38aae305004b9065d512f57d60fb0d36ef1">MWI_SEND_DONE</a> != pvt-&gt;<a class="code" href="structdahdi__pvt.html#a39a7c5e5175acb8c242f944cc6b7eb71">mwisend_data</a>.<a class="code" href="structmwisend__info.html#a08a962c5a80e63eb6da43d615dc153ad">mwisend_current</a>) {
<a name="l09208"></a>09208       <span class="keywordflow">switch</span> (event) {
<a name="l09209"></a>09209       <span class="keywordflow">case</span> DAHDI_EVENT_RINGEROFF:
<a name="l09210"></a>09210          <span class="keywordflow">if</span>(pvt-&gt;<a class="code" href="structdahdi__pvt.html#a39a7c5e5175acb8c242f944cc6b7eb71">mwisend_data</a>.<a class="code" href="structmwisend__info.html#a08a962c5a80e63eb6da43d615dc153ad">mwisend_current</a> == <a class="code" href="chan__dahdi_8c.html#ac6eb1255d7d5fc62e32b545a15e2ee38a6a12b01ecaf82d8837cb5d4e1764b54f">MWI_SEND_SA_WAIT</a>) {
<a name="l09211"></a>09211             handled = 1;
<a name="l09212"></a>09212 
<a name="l09213"></a>09213             <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#a7c65e6943db828524ea6c9215b8bf696">dahdi_set_hook</a>(pvt-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_RINGOFF) ) {
<a name="l09214"></a>09214                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to finsh RP-AS: %s mwi send aborted\n&quot;</span>, strerror(errno));
<a name="l09215"></a>09215                <span class="keywordflow">if</span>(pvt-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a>) {
<a name="l09216"></a>09216                   <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(pvt-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a>);
<a name="l09217"></a>09217                   pvt-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a> = NULL;
<a name="l09218"></a>09218                }
<a name="l09219"></a>09219                pvt-&gt;<a class="code" href="structdahdi__pvt.html#a39a7c5e5175acb8c242f944cc6b7eb71">mwisend_data</a>.<a class="code" href="structmwisend__info.html#a08a962c5a80e63eb6da43d615dc153ad">mwisend_current</a> = <a class="code" href="chan__dahdi_8c.html#ac6eb1255d7d5fc62e32b545a15e2ee38aae305004b9065d512f57d60fb0d36ef1">MWI_SEND_DONE</a>;
<a name="l09220"></a>09220                pvt-&gt;<a class="code" href="structdahdi__pvt.html#a35892585f7fbbba650b0bf1315d5e8c1" title="TRUE if a MWI message sending thread is active.">mwisendactive</a> = 0;
<a name="l09221"></a>09221             } <span class="keywordflow">else</span> {
<a name="l09222"></a>09222                pvt-&gt;<a class="code" href="structdahdi__pvt.html#a39a7c5e5175acb8c242f944cc6b7eb71">mwisend_data</a>.<a class="code" href="structmwisend__info.html#a08a962c5a80e63eb6da43d615dc153ad">mwisend_current</a> = <a class="code" href="chan__dahdi_8c.html#ac6eb1255d7d5fc62e32b545a15e2ee38a5030903afd5a2db7324494c3b2546935">MWI_SEND_PAUSE</a>;
<a name="l09223"></a>09223                gettimeofday(&amp;pvt-&gt;<a class="code" href="structdahdi__pvt.html#a39a7c5e5175acb8c242f944cc6b7eb71">mwisend_data</a>.<a class="code" href="structmwisend__info.html#ab69c80cc0e2dda5839a253483ed0e861">pause</a>, NULL);
<a name="l09224"></a>09224             }
<a name="l09225"></a>09225          }
<a name="l09226"></a>09226          <span class="keywordflow">break</span>;
<a name="l09227"></a>09227       <span class="comment">/* Going off hook, I need to punt this spill */</span>
<a name="l09228"></a>09228       <span class="keywordflow">case</span> DAHDI_EVENT_RINGOFFHOOK:
<a name="l09229"></a>09229          <span class="keywordflow">if</span> (pvt-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a>) {
<a name="l09230"></a>09230             <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(pvt-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a>);
<a name="l09231"></a>09231             pvt-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a> = NULL;
<a name="l09232"></a>09232             pvt-&gt;<a class="code" href="structdahdi__pvt.html#ac0df3c8f4391be85a4d95a23866d4313" title="Position in the cidspill buffer to send out next.">cidpos</a> = 0;
<a name="l09233"></a>09233             pvt-&gt;<a class="code" href="structdahdi__pvt.html#a241dcb75aa2cae2b5c7b899eb95079d0" title="Length of the cidspill buffer containing samples.">cidlen</a> = 0;
<a name="l09234"></a>09234          }
<a name="l09235"></a>09235          pvt-&gt;<a class="code" href="structdahdi__pvt.html#a39a7c5e5175acb8c242f944cc6b7eb71">mwisend_data</a>.<a class="code" href="structmwisend__info.html#a08a962c5a80e63eb6da43d615dc153ad">mwisend_current</a> = <a class="code" href="chan__dahdi_8c.html#ac6eb1255d7d5fc62e32b545a15e2ee38aae305004b9065d512f57d60fb0d36ef1">MWI_SEND_DONE</a>;
<a name="l09236"></a>09236          pvt-&gt;<a class="code" href="structdahdi__pvt.html#a35892585f7fbbba650b0bf1315d5e8c1" title="TRUE if a MWI message sending thread is active.">mwisendactive</a> = 0;
<a name="l09237"></a>09237          <span class="keywordflow">break</span>;
<a name="l09238"></a>09238       <span class="keywordflow">case</span> DAHDI_EVENT_RINGERON:
<a name="l09239"></a>09239       <span class="keywordflow">case</span> DAHDI_EVENT_HOOKCOMPLETE:
<a name="l09240"></a>09240          <span class="keywordflow">break</span>;
<a name="l09241"></a>09241       <span class="keywordflow">default</span>:
<a name="l09242"></a>09242          <span class="keywordflow">break</span>;
<a name="l09243"></a>09243       }
<a name="l09244"></a>09244    }
<a name="l09245"></a>09245    <span class="keywordflow">return</span> handled;
<a name="l09246"></a>09246 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4c430057a548b7c6ec462ac238b58d6c"></a><!-- doxytag: member="chan_dahdi.c::mwi_thread" ref="a4c430057a548b7c6ec462ac238b58d6c" args="(void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void* mwi_thread </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l08925">8925</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="channel_8c_source.html#l01690">ast_hangup()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00209">AST_LAW</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="utils_8h_source.html#l00380">ast_pthread_create_detached</a>, <a class="el" href="channel_8h_source.html#l00363">AST_STATE_RING</a>, <a class="el" href="chan__dahdi_8c_source.html#l08907">mwi_thread_data::buf</a>, <a class="el" href="chan__dahdi_8c_source.html#l02836">bump_gains()</a>, <a class="el" href="chan__dahdi_8c_source.html#l08911">calc_energy()</a>, <a class="el" href="callerid_8c_source.html#l00542">callerid_feed()</a>, <a class="el" href="callerid_8c_source.html#l00718">callerid_free()</a>, <a class="el" href="callerid_8c_source.html#l00185">callerid_get()</a>, <a class="el" href="callerid_8c_source.html#l00126">callerid_new()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="callerid_8h_source.html#l00054">CID_MSGWAITING</a>, <a class="el" href="callerid_8h_source.html#l00055">CID_NOMSGWAITING</a>, <a class="el" href="chan__dahdi_8c_source.html#l01044">dahdi_pvt::cid_signalling</a>, <a class="el" href="chan__dahdi_8c_source.html#l00376">dahdi_get_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07417">dahdi_new()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="chan__dahdi_8c_source.html#l02389">event2str()</a>, <a class="el" href="manager_8h_source.html#l00061">EVENT_FLAG_SYSTEM</a>, <a class="el" href="callerid_8c_source.html#l00052">callerid_state::flags</a>, <a class="el" href="chan__dahdi_8c_source.html#l05580">get_alarms()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05688">handle_alarms()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00797">dahdi_pvt::inalarm</a>, <a class="el" href="chan__dahdi_8c_source.html#l08908">mwi_thread_data::len</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__dahdi_8c_source.html#l01129">dahdi_pvt::mailbox</a>, <a class="el" href="manager_8h_source.html#l00181">manager_event</a>, <a class="el" href="chan__dahdi_8c_source.html#l00900">dahdi_pvt::mwimonitoractive</a>, <a class="el" href="cdr__adaptive__odbc_8c_source.html#l00053">name</a>, <a class="el" href="chan__dahdi_8c_source.html#l02940">notify_message()</a>, <a class="el" href="chan__dahdi_8c_source.html#l08906">mwi_thread_data::pvt</a>, <a class="el" href="pbx__gtkconsole_8c_source.html#l00059">quit</a>, <a class="el" href="chan__dahdi_8c_source.html#l02850">restore_gains()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01056">dahdi_pvt::ringt</a>, <a class="el" href="chan__dahdi_8c_source.html#l01061">dahdi_pvt::ringt_base</a>, <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l09496">do_monitor()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l08926"></a>08926 {
<a name="l08927"></a>08927    <span class="keyword">struct </span><a class="code" href="structmwi__thread__data.html">mwi_thread_data</a> *mtd = data;
<a name="l08928"></a>08928    <span class="keyword">struct </span><a class="code" href="structcallerid__state.html">callerid_state</a> *cs;
<a name="l08929"></a>08929    pthread_t threadid;
<a name="l08930"></a>08930    <span class="keywordtype">int</span> samples = 0;
<a name="l08931"></a>08931    <span class="keywordtype">char</span> *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, *<a class="code" href="structnumber.html" title="Number structure.">number</a>;
<a name="l08932"></a>08932    <span class="keywordtype">int</span> <a class="code" href="structcallerid__state.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a>;
<a name="l08933"></a>08933    <span class="keywordtype">int</span> i, res;
<a name="l08934"></a>08934    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> spill_done = 0;
<a name="l08935"></a>08935    <span class="keywordtype">int</span> spill_result = -1;
<a name="l08936"></a>08936 
<a name="l08937"></a>08937    <span class="keywordflow">if</span> (!(cs = <a class="code" href="callerid_8h.html#ae48529c2f2ea547ec29a2451b8fef8a2" title="Create a callerID state machine.">callerid_new</a>(mtd-&gt;<a class="code" href="structmwi__thread__data.html#a96fcebe4e3d09a6aefc4a12522e07bd7">pvt</a>-&gt;<a class="code" href="structdahdi__pvt.html#ad7f246923324f9b4186b3ee50de56c36">cid_signalling</a>))) {
<a name="l08938"></a>08938       mtd-&gt;<a class="code" href="structmwi__thread__data.html#a96fcebe4e3d09a6aefc4a12522e07bd7">pvt</a>-&gt;<a class="code" href="structdahdi__pvt.html#a3f5ebedc03e93eee1fa771cfc69bd77b" title="TRUE if an MWI monitor thread is currently active.">mwimonitoractive</a> = 0;
<a name="l08939"></a>08939 
<a name="l08940"></a>08940       <span class="keywordflow">return</span> NULL;
<a name="l08941"></a>08941    }
<a name="l08942"></a>08942 
<a name="l08943"></a>08943    <a class="code" href="callerid_8h.html#a873803a7ac6ffd08fe0aca90b192e0ca" title="Read samples into the state machine.">callerid_feed</a>(cs, mtd-&gt;<a class="code" href="structmwi__thread__data.html#acc88ecad1777325d4b41329a853998ec">buf</a>, mtd-&gt;<a class="code" href="structmwi__thread__data.html#a7360b55975153b822efc5217b7734e6a">len</a>, <a class="code" href="chan__dahdi_8c.html#a830b5fdb3ba653640d3f5044192d82bf">AST_LAW</a>(mtd-&gt;<a class="code" href="structmwi__thread__data.html#a96fcebe4e3d09a6aefc4a12522e07bd7">pvt</a>));
<a name="l08944"></a>08944 
<a name="l08945"></a>08945    <a class="code" href="chan__dahdi_8c.html#a74f7e3c2c3944147a9ae2d1f6aceb71e">bump_gains</a>(mtd-&gt;<a class="code" href="structmwi__thread__data.html#a96fcebe4e3d09a6aefc4a12522e07bd7">pvt</a>);
<a name="l08946"></a>08946 
<a name="l08947"></a>08947    <span class="keywordflow">for</span> (;;) {
<a name="l08948"></a>08948       i = DAHDI_IOMUX_READ | DAHDI_IOMUX_SIGEVENT;
<a name="l08949"></a>08949       <span class="keywordflow">if</span> ((res = ioctl(mtd-&gt;<a class="code" href="structmwi__thread__data.html#a96fcebe4e3d09a6aefc4a12522e07bd7">pvt</a>-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_IOMUX, &amp;i))) {
<a name="l08950"></a>08950          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;I/O MUX failed: %s\n&quot;</span>, strerror(errno));
<a name="l08951"></a>08951          <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l08952"></a>08952       }
<a name="l08953"></a>08953 
<a name="l08954"></a>08954       <span class="keywordflow">if</span> (i &amp; DAHDI_IOMUX_SIGEVENT) {
<a name="l08955"></a>08955          <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>;
<a name="l08956"></a>08956 
<a name="l08957"></a>08957          <span class="comment">/* If we get an event, screen out events that we do not act on.</span>
<a name="l08958"></a>08958 <span class="comment">          * Otherwise, cancel and go to the simple switch to let it deal with it.</span>
<a name="l08959"></a>08959 <span class="comment">          */</span>
<a name="l08960"></a>08960          res = <a class="code" href="chan__dahdi_8c.html#aad4a9758fbc62380e70cbbcbb31311a4" title="Avoid the silly dahdi_getevent which ignores a bunch of events.">dahdi_get_event</a>(mtd-&gt;<a class="code" href="structmwi__thread__data.html#a96fcebe4e3d09a6aefc4a12522e07bd7">pvt</a>-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>);
<a name="l08961"></a>08961 
<a name="l08962"></a>08962          <span class="keywordflow">switch</span> (res) {
<a name="l08963"></a>08963          <span class="keywordflow">case</span> DAHDI_EVENT_NEONMWI_ACTIVE:
<a name="l08964"></a>08964          <span class="keywordflow">case</span> DAHDI_EVENT_NEONMWI_INACTIVE:
<a name="l08965"></a>08965          <span class="keywordflow">case</span> DAHDI_EVENT_NONE:
<a name="l08966"></a>08966          <span class="keywordflow">case</span> DAHDI_EVENT_BITSCHANGED:
<a name="l08967"></a>08967             <span class="keywordflow">break</span>;
<a name="l08968"></a>08968          <span class="keywordflow">case</span> DAHDI_EVENT_NOALARM:
<a name="l08969"></a>08969             mtd-&gt;<a class="code" href="structmwi__thread__data.html#a96fcebe4e3d09a6aefc4a12522e07bd7">pvt</a>-&gt;<a class="code" href="structdahdi__pvt.html#adbe10c4b12619d6cb58b1ad14bc437af" title="TRUE if in an alarm condition.">inalarm</a> = 0;
<a name="l08970"></a>08970             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Alarm cleared on channel %d\n&quot;</span>, mtd-&gt;<a class="code" href="structmwi__thread__data.html#a96fcebe4e3d09a6aefc4a12522e07bd7">pvt</a>-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l08971"></a>08971             <a class="code" href="manager_8h.html#a1ef0ee0044dbbeb4c3a5abc6c046b208" title="External routines may send asterisk manager events this way.">manager_event</a>(<a class="code" href="manager_8h.html#a420f0f755e1c3378b45ca7f6f0669ffa">EVENT_FLAG_SYSTEM</a>, <span class="stringliteral">&quot;AlarmClear&quot;</span>,
<a name="l08972"></a>08972                <span class="stringliteral">&quot;Channel: %d\r\n&quot;</span>, mtd-&gt;<a class="code" href="structmwi__thread__data.html#a96fcebe4e3d09a6aefc4a12522e07bd7">pvt</a>-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l08973"></a>08973             <span class="keywordflow">break</span>;
<a name="l08974"></a>08974          <span class="keywordflow">case</span> DAHDI_EVENT_ALARM:
<a name="l08975"></a>08975             mtd-&gt;<a class="code" href="structmwi__thread__data.html#a96fcebe4e3d09a6aefc4a12522e07bd7">pvt</a>-&gt;<a class="code" href="structdahdi__pvt.html#adbe10c4b12619d6cb58b1ad14bc437af" title="TRUE if in an alarm condition.">inalarm</a> = 1;
<a name="l08976"></a>08976             res = <a class="code" href="chan__dahdi_8c.html#ace00362fe9640b8a792c965572a87826">get_alarms</a>(mtd-&gt;<a class="code" href="structmwi__thread__data.html#a96fcebe4e3d09a6aefc4a12522e07bd7">pvt</a>);
<a name="l08977"></a>08977             <a class="code" href="chan__dahdi_8c.html#aa8e0b028321154a280cad06d20099330">handle_alarms</a>(mtd-&gt;<a class="code" href="structmwi__thread__data.html#a96fcebe4e3d09a6aefc4a12522e07bd7">pvt</a>, res);
<a name="l08978"></a>08978             <span class="keywordflow">break</span>; <span class="comment">/* What to do on channel alarm ???? -- fall thru intentionally?? */</span>
<a name="l08979"></a>08979          <span class="keywordflow">default</span>:
<a name="l08980"></a>08980             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Got event %d (%s)...  Passing along to ss_thread\n&quot;</span>, res, <a class="code" href="chan__dahdi_8c.html#a92fb0724a6e93f69cec9d6e83cdcc3f3">event2str</a>(res));
<a name="l08981"></a>08981             <a class="code" href="callerid_8h.html#a4d792e593d99c8b5b3a5534e73082c9d" title="Free a callerID state.">callerid_free</a>(cs);
<a name="l08982"></a>08982 
<a name="l08983"></a>08983             <a class="code" href="chan__dahdi_8c.html#a0ac913fed804e8326af276cfa450ed03">restore_gains</a>(mtd-&gt;<a class="code" href="structmwi__thread__data.html#a96fcebe4e3d09a6aefc4a12522e07bd7">pvt</a>);
<a name="l08984"></a>08984             mtd-&gt;<a class="code" href="structmwi__thread__data.html#a96fcebe4e3d09a6aefc4a12522e07bd7">pvt</a>-&gt;<a class="code" href="structdahdi__pvt.html#a2ecae7dca8c46e1948d9117eee9a15e4" title="Ring timeout timer??">ringt</a> = mtd-&gt;<a class="code" href="structmwi__thread__data.html#a96fcebe4e3d09a6aefc4a12522e07bd7">pvt</a>-&gt;<a class="code" href="structdahdi__pvt.html#aadc5d8714afe5d456c8f17db3abf7f20" title="Ring timeout base.">ringt_base</a>;
<a name="l08985"></a>08985 
<a name="l08986"></a>08986             <span class="keywordflow">if</span> ((chan = <a class="code" href="chan__dahdi_8c.html#ab3f00769ae6c995b4f5f3934d8c805f6">dahdi_new</a>(mtd-&gt;<a class="code" href="structmwi__thread__data.html#a96fcebe4e3d09a6aefc4a12522e07bd7">pvt</a>, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a>, 0, <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>, 0, 0))) {
<a name="l08987"></a>08987                <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a832647380b1f97e7ac1b4492f8816d46">ast_pthread_create_detached</a>(&amp;threadid, NULL, <a class="code" href="chan__dahdi_8c.html#a0d1f78e604903f5ef4e42bf961f4df95">ss_thread</a>, chan)) {
<a name="l08988"></a>08988                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to start simple switch thread on channel %d\n&quot;</span>, mtd-&gt;<a class="code" href="structmwi__thread__data.html#a96fcebe4e3d09a6aefc4a12522e07bd7">pvt</a>-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l08989"></a>08989                   res = tone_zone_play_tone(mtd-&gt;<a class="code" href="structmwi__thread__data.html#a96fcebe4e3d09a6aefc4a12522e07bd7">pvt</a>-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_CONGESTION);
<a name="l08990"></a>08990                   <span class="keywordflow">if</span> (res &lt; 0)
<a name="l08991"></a>08991                      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to play congestion tone on channel %d\n&quot;</span>, mtd-&gt;<a class="code" href="structmwi__thread__data.html#a96fcebe4e3d09a6aefc4a12522e07bd7">pvt</a>-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l08992"></a>08992                   <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l08993"></a>08993                   <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l08994"></a>08994                }
<a name="l08995"></a>08995                <span class="keywordflow">goto</span> quit_no_clean;
<a name="l08996"></a>08996 
<a name="l08997"></a>08997             } <span class="keywordflow">else</span> {
<a name="l08998"></a>08998                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not create channel to handle call\n&quot;</span>);
<a name="l08999"></a>08999             }
<a name="l09000"></a>09000          }
<a name="l09001"></a>09001       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i &amp; DAHDI_IOMUX_READ) {
<a name="l09002"></a>09002          <span class="keywordflow">if</span> ((res = read(mtd-&gt;<a class="code" href="structmwi__thread__data.html#a96fcebe4e3d09a6aefc4a12522e07bd7">pvt</a>-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, mtd-&gt;<a class="code" href="structmwi__thread__data.html#acc88ecad1777325d4b41329a853998ec">buf</a>, <span class="keyword">sizeof</span>(mtd-&gt;<a class="code" href="structmwi__thread__data.html#acc88ecad1777325d4b41329a853998ec">buf</a>))) &lt; 0) {
<a name="l09003"></a>09003             <span class="keywordflow">if</span> (errno != ELAST) {
<a name="l09004"></a>09004                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;read returned error: %s\n&quot;</span>, strerror(errno));
<a name="l09005"></a>09005                <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l09006"></a>09006             }
<a name="l09007"></a>09007             <span class="keywordflow">break</span>;
<a name="l09008"></a>09008          }
<a name="l09009"></a>09009          samples += res;
<a name="l09010"></a>09010          <span class="keywordflow">if</span> (!spill_done) {
<a name="l09011"></a>09011             <span class="keywordflow">if</span> ((spill_result = <a class="code" href="callerid_8h.html#a873803a7ac6ffd08fe0aca90b192e0ca" title="Read samples into the state machine.">callerid_feed</a>(cs, mtd-&gt;<a class="code" href="structmwi__thread__data.html#acc88ecad1777325d4b41329a853998ec">buf</a>, res, <a class="code" href="chan__dahdi_8c.html#a830b5fdb3ba653640d3f5044192d82bf">AST_LAW</a>(mtd-&gt;<a class="code" href="structmwi__thread__data.html#a96fcebe4e3d09a6aefc4a12522e07bd7">pvt</a>))) &lt; 0) {
<a name="l09012"></a>09012                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;CallerID feed failed: %s\n&quot;</span>, strerror(errno));
<a name="l09013"></a>09013                <span class="keywordflow">break</span>;
<a name="l09014"></a>09014             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (spill_result) {
<a name="l09015"></a>09015                spill_done = 1;
<a name="l09016"></a>09016             }
<a name="l09017"></a>09017          } <span class="keywordflow">else</span> {
<a name="l09018"></a>09018             <span class="comment">/* keep reading data until the energy level drops below the threshold</span>
<a name="l09019"></a>09019 <span class="comment">               so we don&apos;t get another &apos;trigger&apos; on the remaining carrier signal</span>
<a name="l09020"></a>09020 <span class="comment">            */</span>
<a name="l09021"></a>09021             <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#a6fe88ac2d409718d8b1a788ad2930a24">calc_energy</a>(mtd-&gt;<a class="code" href="structmwi__thread__data.html#acc88ecad1777325d4b41329a853998ec">buf</a>, res, <a class="code" href="chan__dahdi_8c.html#a830b5fdb3ba653640d3f5044192d82bf">AST_LAW</a>(mtd-&gt;<a class="code" href="structmwi__thread__data.html#a96fcebe4e3d09a6aefc4a12522e07bd7">pvt</a>)) &lt;= <a class="code" href="chan__dahdi_8c.html#a94ca20b7d80fbc4e7d2b1ea50e937243">mwilevel</a>)
<a name="l09022"></a>09022                <span class="keywordflow">break</span>;
<a name="l09023"></a>09023          }
<a name="l09024"></a>09024          <span class="keywordflow">if</span> (samples &gt; (8000 * 4)) <span class="comment">/*Termination case - time to give up*/</span>
<a name="l09025"></a>09025             <span class="keywordflow">break</span>;
<a name="l09026"></a>09026       }
<a name="l09027"></a>09027    }
<a name="l09028"></a>09028 
<a name="l09029"></a>09029    <span class="keywordflow">if</span> (spill_result == 1) {
<a name="l09030"></a>09030       <a class="code" href="callerid_8h.html#ae05580f722c821a76a7f52831721d3f4" title="Extract info out of callerID state machine. Flags are listed above.">callerid_get</a>(cs, &amp;name, &amp;number, &amp;flags);
<a name="l09031"></a>09031       <span class="keywordflow">if</span> (flags &amp; <a class="code" href="callerid_8h.html#a9c4dfda5214a190d972ea14ae5055378">CID_MSGWAITING</a>) {
<a name="l09032"></a>09032          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;mwi: Have Messages on channel %d\n&quot;</span>, mtd-&gt;<a class="code" href="structmwi__thread__data.html#a96fcebe4e3d09a6aefc4a12522e07bd7">pvt</a>-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l09033"></a>09033          <a class="code" href="chan__dahdi_8c.html#a3cd48b46cf8ee3ffc97d1f15fb53aaad" title="Send MWI state change.">notify_message</a>(mtd-&gt;<a class="code" href="structmwi__thread__data.html#a96fcebe4e3d09a6aefc4a12522e07bd7">pvt</a>-&gt;<a class="code" href="structdahdi__pvt.html#ac81f44f4f22dee90de5975cf8fa4641b" title="Voice mailbox location.">mailbox</a>, 1);
<a name="l09034"></a>09034       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (flags &amp; <a class="code" href="callerid_8h.html#a826d6ae29e47b657de576a044828734a">CID_NOMSGWAITING</a>) {
<a name="l09035"></a>09035          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;mwi: No Messages on channel %d\n&quot;</span>, mtd-&gt;<a class="code" href="structmwi__thread__data.html#a96fcebe4e3d09a6aefc4a12522e07bd7">pvt</a>-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l09036"></a>09036          <a class="code" href="chan__dahdi_8c.html#a3cd48b46cf8ee3ffc97d1f15fb53aaad" title="Send MWI state change.">notify_message</a>(mtd-&gt;<a class="code" href="structmwi__thread__data.html#a96fcebe4e3d09a6aefc4a12522e07bd7">pvt</a>-&gt;<a class="code" href="structdahdi__pvt.html#ac81f44f4f22dee90de5975cf8fa4641b" title="Voice mailbox location.">mailbox</a>, 0);
<a name="l09037"></a>09037       } <span class="keywordflow">else</span> {
<a name="l09038"></a>09038          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;mwi: Status unknown on channel %d\n&quot;</span>, mtd-&gt;<a class="code" href="structmwi__thread__data.html#a96fcebe4e3d09a6aefc4a12522e07bd7">pvt</a>-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l09039"></a>09039       }
<a name="l09040"></a>09040    }
<a name="l09041"></a>09041 
<a name="l09042"></a>09042 
<a name="l09043"></a>09043 <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>:
<a name="l09044"></a>09044    <a class="code" href="callerid_8h.html#a4d792e593d99c8b5b3a5534e73082c9d" title="Free a callerID state.">callerid_free</a>(cs);
<a name="l09045"></a>09045 
<a name="l09046"></a>09046    <a class="code" href="chan__dahdi_8c.html#a0ac913fed804e8326af276cfa450ed03">restore_gains</a>(mtd-&gt;<a class="code" href="structmwi__thread__data.html#a96fcebe4e3d09a6aefc4a12522e07bd7">pvt</a>);
<a name="l09047"></a>09047 
<a name="l09048"></a>09048 quit_no_clean:
<a name="l09049"></a>09049    mtd-&gt;<a class="code" href="structmwi__thread__data.html#a96fcebe4e3d09a6aefc4a12522e07bd7">pvt</a>-&gt;<a class="code" href="structdahdi__pvt.html#a3f5ebedc03e93eee1fa771cfc69bd77b" title="TRUE if an MWI monitor thread is currently active.">mwimonitoractive</a> = 0;
<a name="l09050"></a>09050 
<a name="l09051"></a>09051    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(mtd);
<a name="l09052"></a>09052 
<a name="l09053"></a>09053    <span class="keywordflow">return</span> NULL;
<a name="l09054"></a>09054 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a124dc539e9fb2f5ac94d5be7db0b5f0b"></a><!-- doxytag: member="chan_dahdi.c::my_dahdi_write" ref="a124dc539e9fb2f5ac94d5be7db0b5f0b" args="(struct dahdi_pvt *p, unsigned char *buf, int len, int idx, int linear)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int my_dahdi_write </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>linear</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l07068">7068</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="chan__dahdi_8c_source.html#l00397">READ_SIZE</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l07090">dahdi_write()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l07069"></a>07069 {
<a name="l07070"></a>07070    <span class="keywordtype">int</span> sent=0;
<a name="l07071"></a>07071    <span class="keywordtype">int</span> size;
<a name="l07072"></a>07072    <span class="keywordtype">int</span> res;
<a name="l07073"></a>07073    <span class="keywordtype">int</span> fd;
<a name="l07074"></a>07074    fd = p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>;
<a name="l07075"></a>07075    <span class="keywordflow">while</span> (<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>) {
<a name="l07076"></a>07076       size = <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>;
<a name="l07077"></a>07077       <span class="keywordflow">if</span> (size &gt; (linear ? <a class="code" href="chan__dahdi_8c.html#a86e1969b50e55e5d506233078ca0fa4c">READ_SIZE</a> * 2 : <a class="code" href="chan__dahdi_8c.html#a86e1969b50e55e5d506233078ca0fa4c">READ_SIZE</a>))
<a name="l07078"></a>07078          size = (linear ? READ_SIZE * 2 : READ_SIZE);
<a name="l07079"></a>07079       res = write(fd, <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, size);
<a name="l07080"></a>07080       <span class="keywordflow">if</span> (res != size) {
<a name="l07081"></a>07081          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Write returned %d (%s) on channel %d\n&quot;</span>, res, strerror(errno), p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l07082"></a>07082          <span class="keywordflow">return</span> sent;
<a name="l07083"></a>07083       }
<a name="l07084"></a>07084       <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> -= size;
<a name="l07085"></a>07085       <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a> += size;
<a name="l07086"></a>07086    }
<a name="l07087"></a>07087    <span class="keywordflow">return</span> sent;
<a name="l07088"></a>07088 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9a611d7601630c4b1549fd303f6092a0"></a><!-- doxytag: member="chan_dahdi.c::my_getsigstr" ref="a9a611d7601630c4b1549fd303f6092a0" args="(struct ast_channel *chan, char *str, const char *term, int ms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int my_getsigstr </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>str</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>term</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>ms</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l07616">7616</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l02400">ast_waitfordigit()</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l07617"></a>07617 {
<a name="l07618"></a>07618    <span class="keywordtype">char</span> c;
<a name="l07619"></a>07619 
<a name="l07620"></a>07620    *<a class="code" href="app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a> = 0; <span class="comment">/* start with empty output buffer */</span>
<a name="l07621"></a>07621    <span class="keywordflow">for</span> (;;)
<a name="l07622"></a>07622    {
<a name="l07623"></a>07623       <span class="comment">/* Wait for the first digit (up to specified ms). */</span>
<a name="l07624"></a>07624       c = <a class="code" href="channel_8h.html#a050bec9a4abc1a599b6573a6091b080c" title="Waits for a digit.">ast_waitfordigit</a>(chan, ms);
<a name="l07625"></a>07625       <span class="comment">/* if timeout, hangup or error, return as such */</span>
<a name="l07626"></a>07626       <span class="keywordflow">if</span> (c &lt; 1)
<a name="l07627"></a>07627          <span class="keywordflow">return</span> c;
<a name="l07628"></a>07628       *<a class="code" href="app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>++ = c;
<a name="l07629"></a>07629       *<a class="code" href="app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a> = 0;
<a name="l07630"></a>07630       <span class="keywordflow">if</span> (strchr(term, c))
<a name="l07631"></a>07631          <span class="keywordflow">return</span> 1;
<a name="l07632"></a>07632    }
<a name="l07633"></a>07633 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3cd48b46cf8ee3ffc97d1f15fb53aaad"></a><!-- doxytag: member="chan_dahdi.c::notify_message" ref="a3cd48b46cf8ee3ffc97d1f15fb53aaad" args="(char *mailbox_full, int thereornot)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void notify_message </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>mailbox_full</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>thereornot</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Send MWI <a class="el" href="structstate.html">state</a> change. </p>
<ul>
<li>mailbox_full This is the mailbox associated with the FXO line that the MWI <a class="el" href="structstate.html">state</a> has changed on. </li>
<li>thereornot This argument should simply be set to 1 or 0, to indicate whether there are messages waiting or not.</li>
</ul>
<dl class="return"><dt><b>Returns:</b></dt><dd>nothing</dd></dl>
<p>This function does two things:</p>
<p>1) It generates an internal Asterisk event notifying any other module that cares about MWI that the <a class="el" href="structstate.html">state</a> of a mailbox has changed.</p>
<p>2) It runs the script specified by the mwimonitornotify option to allow some custom handling of the <a class="el" href="structstate.html">state</a> change. </p>

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l02940">2940</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="event__defs_8h_source.html#l00115">AST_EVENT_IE_CONTEXT</a>, <a class="el" href="event__defs_8h_source.html#l00058">AST_EVENT_IE_END</a>, <a class="el" href="event__defs_8h_source.html#l00077">AST_EVENT_IE_MAILBOX</a>, <a class="el" href="event__defs_8h_source.html#l00065">AST_EVENT_IE_NEWMSGS</a>, <a class="el" href="event__defs_8h_source.html#l00071">AST_EVENT_IE_OLDMSGS</a>, <a class="el" href="event__defs_8h_source.html#l00137">AST_EVENT_IE_PLTYPE_STR</a>, <a class="el" href="event__defs_8h_source.html#l00135">AST_EVENT_IE_PLTYPE_UINT</a>, <a class="el" href="event__defs_8h_source.html#l00040">AST_EVENT_MWI</a>, <a class="el" href="event_8c_source.html#l00897">ast_event_new()</a>, <a class="el" href="event_8c_source.html#l01094">ast_event_queue_and_cache()</a>, <a class="el" href="asterisk_8c_source.html#l01001">ast_safe_system()</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="chan__alsa_8c_source.html#l00105">context</a>, <a class="el" href="chan__mgcp_8c_source.html#l00185">mailbox</a>, <a class="el" href="aesopt_8h_source.html#l00399">s</a>, and <a class="el" href="agi_2strcompat_8c_source.html#l00027">strsep()</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l08925">mwi_thread()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02941"></a>02941 {
<a name="l02942"></a>02942    <span class="keywordtype">char</span> <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>[<span class="keyword">sizeof</span>(<a class="code" href="chan__dahdi_8c.html#a200370774ee53e137af5d8d7932b7acc">mwimonitornotify</a>) + 80];
<a name="l02943"></a>02943    <span class="keyword">struct </span><a class="code" href="structast__event.html" title="An event.">ast_event</a> *event;
<a name="l02944"></a>02944    <span class="keywordtype">char</span> *<a class="code" href="chan__mgcp_8c.html#ac81f44f4f22dee90de5975cf8fa4641b">mailbox</a>, *<a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>;
<a name="l02945"></a>02945 
<a name="l02946"></a>02946    <span class="comment">/* Strip off @default */</span>
<a name="l02947"></a>02947    context = mailbox = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(mailbox_full);
<a name="l02948"></a>02948    <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;context, <span class="stringliteral">&quot;@&quot;</span>);
<a name="l02949"></a>02949    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(context))
<a name="l02950"></a>02950       context = <span class="stringliteral">&quot;default&quot;</span>;
<a name="l02951"></a>02951 
<a name="l02952"></a>02952    <span class="keywordflow">if</span> (!(event = <a class="code" href="event_8h.html#afb4a2a00de28bb0733037060da8c4bac" title="Create a new event.">ast_event_new</a>(<a class="code" href="event__defs_8h.html#a6fa079412d9d9c1cc539f6d71f37f79fa9a217b1f500680b3e458d62b048c0892">AST_EVENT_MWI</a>,
<a name="l02953"></a>02953          <a class="code" href="event__defs_8h.html#a003673523d7fe265c6738a5a9e49c491aae6c80d8f4c6ab3cee006ed57d874710" title="Mailbox name.">AST_EVENT_IE_MAILBOX</a>, <a class="code" href="event__defs_8h.html#a73dadfa1128d5e75107536e132e758c6ab82ac16f0791be2f8f918429a73430be">AST_EVENT_IE_PLTYPE_STR</a>, mailbox,
<a name="l02954"></a>02954          <a class="code" href="event__defs_8h.html#a003673523d7fe265c6738a5a9e49c491a25764e2fb734ccb3ee1f6f41caba5318" title="Context IE Used by AST_EVENT_MWI Payload type: str.">AST_EVENT_IE_CONTEXT</a>, <a class="code" href="event__defs_8h.html#a73dadfa1128d5e75107536e132e758c6ab82ac16f0791be2f8f918429a73430be">AST_EVENT_IE_PLTYPE_STR</a>, context,
<a name="l02955"></a>02955          <a class="code" href="event__defs_8h.html#a003673523d7fe265c6738a5a9e49c491aff40847f0450f17c96e94e721aee38f2" title="Number of new messages Used by: AST_EVENT_MWI Payload type: UINT.">AST_EVENT_IE_NEWMSGS</a>, <a class="code" href="event__defs_8h.html#a73dadfa1128d5e75107536e132e758c6a4647cbfacd475cb5067f9f9906107641">AST_EVENT_IE_PLTYPE_UINT</a>, thereornot,
<a name="l02956"></a>02956          <a class="code" href="event__defs_8h.html#a003673523d7fe265c6738a5a9e49c491aeda30786b0dfece37a9a06b84a653fd9" title="Number of Used by: AST_EVENT_MWI Payload type: UINT.">AST_EVENT_IE_OLDMSGS</a>, <a class="code" href="event__defs_8h.html#a73dadfa1128d5e75107536e132e758c6a4647cbfacd475cb5067f9f9906107641">AST_EVENT_IE_PLTYPE_UINT</a>, thereornot,
<a name="l02957"></a>02957          <a class="code" href="event__defs_8h.html#a003673523d7fe265c6738a5a9e49c491a04c78c1362e97d548344c354001c151f">AST_EVENT_IE_END</a>))) {
<a name="l02958"></a>02958       <span class="keywordflow">return</span>;
<a name="l02959"></a>02959    }
<a name="l02960"></a>02960 
<a name="l02961"></a>02961    <a class="code" href="event_8h.html#a5ef4e1053ab8a91ebdcf4dd6ad1c81c4" title="Queue and cache an event.">ast_event_queue_and_cache</a>(event);
<a name="l02962"></a>02962 
<a name="l02963"></a>02963    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(mailbox) &amp;&amp; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="chan__dahdi_8c.html#a200370774ee53e137af5d8d7932b7acc">mwimonitornotify</a>)) {
<a name="l02964"></a>02964       snprintf(<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>, <span class="keyword">sizeof</span>(<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>), <span class="stringliteral">&quot;%s %s %d&quot;</span>, <a class="code" href="chan__dahdi_8c.html#a200370774ee53e137af5d8d7932b7acc">mwimonitornotify</a>, mailbox, thereornot);
<a name="l02965"></a>02965       <a class="code" href="app_8h.html#a9fb5cf0385848033ee3e98625e5f9784" title="Safely spawn an external program while closing file descriptors.">ast_safe_system</a>(<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>);
<a name="l02966"></a>02966    }
<a name="l02967"></a>02967 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad19a2de7bce089d3d6e11d7dfb487802"></a><!-- doxytag: member="chan_dahdi.c::process_dahdi" ref="ad19a2de7bce089d3d6e11d7dfb487802" args="(struct dahdi_chan_conf *confp, const char *cat, struct ast_variable *v, int reload, int options)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int process_dahdi </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__chan__conf.html">dahdi_chan_conf</a> *&nbsp;</td>
          <td class="paramname"> <em>confp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>cat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__variable.html">ast_variable</a> *&nbsp;</td>
          <td class="paramname"> <em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>reload</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>options</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l16096">16096</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="chan__dahdi_8c_source.html#l01120">dahdi_pvt::accountcode</a>, <a class="el" href="chan__dahdi_8c_source.html#l00691">dahdi_pvt::adsi</a>, <a class="el" href="chan__dahdi_8c_source.html#l01121">dahdi_pvt::amaflags</a>, <a class="el" href="chan__dahdi_8c_source.html#l00697">dahdi_pvt::answeronpolarityswitch</a>, <a class="el" href="callerid_8c_source.html#l01087">ast_callerid_split()</a>, <a class="el" href="cdr_8c_source.html#l01016">ast_cdr_amaflags2int()</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="channel_8c_source.html#l05485">ast_get_group()</a>, <a class="el" href="abstract__jb_8c_source.html#l00571">ast_jb_read_conf()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8h_source.html#l00134">AST_MAX_EXTENSION</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="utils_8c_source.html#l01311">ast_true()</a>, <a class="el" href="config_8c_source.html#l00223">ast_variable_new()</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="chan__dahdi_8c_source.html#l00662">dahdi_pvt::buf_no</a>, <a class="el" href="chan__dahdi_8c_source.html#l00663">dahdi_pvt::buf_policy</a>, <a class="el" href="chan__dahdi_8c_source.html#l15948">build_channels()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01099">dahdi_pvt::busy_quietlength</a>, <a class="el" href="chan__dahdi_8c_source.html#l01094">dahdi_pvt::busy_tonelength</a>, <a class="el" href="chan__dahdi_8c_source.html#l01089">dahdi_pvt::busycount</a>, <a class="el" href="chan__dahdi_8c_source.html#l00703">dahdi_pvt::busydetect</a>, <a class="el" href="chan__dahdi_8c_source.html#l01030">dahdi_pvt::callgroup</a>, <a class="el" href="chan__dahdi_8c_source.html#l01104">dahdi_pvt::callprogress</a>, <a class="el" href="chan__dahdi_8c_source.html#l00294">CALLPROGRESS_FAX</a>, <a class="el" href="chan__dahdi_8c_source.html#l00293">CALLPROGRESS_FAX_INCOMING</a>, <a class="el" href="chan__dahdi_8c_source.html#l00292">CALLPROGRESS_FAX_OUTGOING</a>, <a class="el" href="chan__dahdi_8c_source.html#l00291">CALLPROGRESS_PROGRESS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00709">dahdi_pvt::callreturn</a>, <a class="el" href="chan__dahdi_8c_source.html#l00716">dahdi_pvt::callwaiting</a>, <a class="el" href="chan__dahdi_8c_source.html#l00721">dahdi_pvt::callwaitingcallerid</a>, <a class="el" href="chan__dahdi_8c_source.html#l00728">dahdi_pvt::cancallforward</a>, <a class="el" href="chan__dahdi_8c_source.html#l00733">dahdi_pvt::canpark</a>, <a class="el" href="chan__dahdi_8c_source.html#l01243">dahdi_chan_conf::chan</a>, <a class="el" href="chan__dahdi_8c_source.html#l00277">CHAN_PSEUDO</a>, <a class="el" href="chan__dahdi_8c_source.html#l01001">dahdi_pvt::cid_name</a>, <a class="el" href="chan__dahdi_8c_source.html#l00997">dahdi_pvt::cid_num</a>, <a class="el" href="chan__dahdi_8c_source.html#l00676">dahdi_pvt::cid_rxgain</a>, <a class="el" href="callerid_8h_source.html#l00057">CID_SIG_BELL</a>, <a class="el" href="callerid_8h_source.html#l00059">CID_SIG_DTMF</a>, <a class="el" href="callerid_8h_source.html#l00061">CID_SIG_SMDI</a>, <a class="el" href="callerid_8h_source.html#l00058">CID_SIG_V23</a>, <a class="el" href="callerid_8h_source.html#l00060">CID_SIG_V23_JP</a>, <a class="el" href="chan__dahdi_8c_source.html#l01044">dahdi_pvt::cid_signalling</a>, <a class="el" href="chan__dahdi_8c_source.html#l01045">dahdi_pvt::cid_start</a>, <a class="el" href="callerid_8h_source.html#l00064">CID_START_POLARITY</a>, <a class="el" href="callerid_8h_source.html#l00065">CID_START_POLARITY_IN</a>, <a class="el" href="callerid_8h_source.html#l00063">CID_START_RING</a>, <a class="el" href="chan__dahdi_8c_source.html#l00967">dahdi_pvt::context</a>, <a class="el" href="chan__dahdi_8c_source.html#l00593">ringContextData::contextData</a>, <a class="el" href="chan__dahdi_8c_source.html#l01266">dahdi_chan_conf_default()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00339">DAHDI_CHAN_MAPPING_LOGICAL</a>, <a class="el" href="chan__dahdi_8c_source.html#l00338">DAHDI_CHAN_MAPPING_PHYSICAL</a>, <a class="el" href="chan__dahdi_8c_source.html#l00289">DAHDI_OVERLAPDIAL_BOTH</a>, <a class="el" href="chan__dahdi_8c_source.html#l00288">DAHDI_OVERLAPDIAL_INCOMING</a>, <a class="el" href="chan__dahdi_8c_source.html#l00286">DAHDI_OVERLAPDIAL_NONE</a>, <a class="el" href="chan__dahdi_8c_source.html#l00287">DAHDI_OVERLAPDIAL_OUTGOING</a>, <a class="el" href="chan__dahdi_8c_source.html#l00877">dahdi_pvt::dahditrcallerid</a>, <a class="el" href="chan__dahdi_8c_source.html#l00961">dahdi_pvt::drings</a>, <a class="el" href="dsp_8h_source.html#l00037">DSP_DIGITMODE_RELAXDTMF</a>, <a class="el" href="chan__dahdi_8c_source.html#l01147">dahdi_pvt::dtmfrelax</a>, <a class="el" href="chan__dahdi_8c_source.html#l00757">dahdi_pvt::echocanbridged</a>, <a class="el" href="chan__dahdi_8c_source.html#l01082">dahdi_pvt::echotraining</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="chan__dahdi_8c_source.html#l00664">dahdi_pvt::faxbuf_no</a>, <a class="el" href="chan__dahdi_8c_source.html#l00665">dahdi_pvt::faxbuf_policy</a>, <a class="el" href="chan__dahdi_8c_source.html#l00181">global_jbconf</a>, <a class="el" href="chan__dahdi_8c_source.html#l01020">dahdi_pvt::group</a>, <a class="el" href="chan__dahdi_8c_source.html#l00772">dahdi_pvt::hanguponpolarityswitch</a>, <a class="el" href="chan__dahdi_8c_source.html#l00781">dahdi_pvt::hidecallerid</a>, <a class="el" href="chan__dahdi_8c_source.html#l00787">dahdi_pvt::hidecalleridname</a>, <a class="el" href="chan__dahdi_8c_source.html#l00795">dahdi_pvt::immediate</a>, <a class="el" href="chan__dahdi_8c_source.html#l01256">dahdi_chan_conf::is_sig_auto</a>, <a class="el" href="chan__dahdi_8c_source.html#l00978">dahdi_pvt::language</a>, <a class="el" href="config_8h_source.html#l00081">ast_variable::lineno</a>, <a class="el" href="logger_8h_source.html#l00119">LOG_DEBUG</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__dahdi_8c_source.html#l01129">dahdi_pvt::mailbox</a>, <a class="el" href="chan__dahdi_8c_source.html#l16038">MAX_CHANLIST_LEN</a>, <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00983">dahdi_pvt::mohinterpret</a>, <a class="el" href="chan__dahdi_8c_source.html#l00988">dahdi_pvt::mohsuggest</a>, <a class="el" href="chan__dahdi_8c_source.html#l00892">dahdi_pvt::mwimonitor_fsk</a>, <a class="el" href="chan__dahdi_8c_source.html#l00887">dahdi_pvt::mwimonitor_neon</a>, <a class="el" href="chan__dahdi_8c_source.html#l00898">dahdi_pvt::mwimonitor_rpas</a>, <a class="el" href="config_8h_source.html#l00075">ast_variable::name</a>, <a class="el" href="config_8h_source.html#l00077">ast_variable::next</a>, <a class="el" href="chan__dahdi_8c_source.html#l01472">NUM_CADENCE_MAX</a>, <a class="el" href="chan__dahdi_8c_source.html#l00672">dahdi_pvt::outsigmod</a>, <a class="el" href="chan__dahdi_8c_source.html#l00989">dahdi_pvt::parkinglot</a>, <a class="el" href="chan__dahdi_8c_source.html#l01035">dahdi_pvt::pickupgroup</a>, <a class="el" href="chan__dahdi_8c_source.html#l01154">dahdi_pvt::polarityonanswerdelay</a>, <a class="el" href="chan__dahdi_8c_source.html#l00823">dahdi_pvt::priexclusive</a>, <a class="el" href="chan__dahdi_8c_source.html#l00818">dahdi_pvt::priindication_oob</a>, <a class="el" href="chan__dahdi_8c_source.html#l16092">PROC_DAHDI_OPT_NOCHAN</a>, <a class="el" href="chan__dahdi_8c_source.html#l16094">PROC_DAHDI_OPT_NOWARN</a>, <a class="el" href="chan__dahdi_8c_source.html#l16040">process_echocancel()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00828">dahdi_pvt::pulse</a>, <a class="el" href="chan__dahdi_8c_source.html#l00671">dahdi_pvt::radio</a>, <a class="el" href="chan__dahdi_8c_source.html#l00590">distRingData::range</a>, <a class="el" href="chan__dahdi_8c_source.html#l00397">READ_SIZE</a>, <a class="el" href="chan__dahdi_8c_source.html#l00837">dahdi_pvt::restrictcid</a>, <a class="el" href="chan__dahdi_8c_source.html#l00589">distRingData::ring</a>, <a class="el" href="chan__dahdi_8c_source.html#l00597">dahdi_distRings::ringContext</a>, <a class="el" href="chan__dahdi_8c_source.html#l00596">dahdi_distRings::ringnum</a>, <a class="el" href="chan__dahdi_8c_source.html#l00678">dahdi_pvt::rxgain</a>, <a class="el" href="chan__dahdi_8c_source.html#l01161">dahdi_pvt::sendcalleridafter</a>, <a class="el" href="chan__dahdi_8c_source.html#l00666">dahdi_pvt::sig</a>, <a class="el" href="chan__dahdi_8c_source.html#l00256">SIG_BRI</a>, <a class="el" href="chan__dahdi_8c_source.html#l00257">SIG_BRI_PTMP</a>, <a class="el" href="chan__dahdi_8c_source.html#l00245">SIG_E911</a>, <a class="el" href="chan__dahdi_8c_source.html#l00240">SIG_EM</a>, <a class="el" href="chan__dahdi_8c_source.html#l00265">SIG_EM_E1</a>, <a class="el" href="chan__dahdi_8c_source.html#l00241">SIG_EMWINK</a>, <a class="el" href="chan__dahdi_8c_source.html#l00244">SIG_FEATB</a>, <a class="el" href="chan__dahdi_8c_source.html#l00242">SIG_FEATD</a>, <a class="el" href="chan__dahdi_8c_source.html#l00243">SIG_FEATDMF</a>, <a class="el" href="chan__dahdi_8c_source.html#l00246">SIG_FEATDMF_TA</a>, <a class="el" href="chan__dahdi_8c_source.html#l00247">SIG_FGC_CAMA</a>, <a class="el" href="chan__dahdi_8c_source.html#l00248">SIG_FGC_CAMAMF</a>, <a class="el" href="chan__dahdi_8c_source.html#l00253">SIG_FXOGS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00254">SIG_FXOKS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00252">SIG_FXOLS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00250">SIG_FXSGS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00251">SIG_FXSKS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00249">SIG_FXSLS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00266">SIG_GR303FXOKS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00267">SIG_GR303FXSKS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00259">SIG_MFCR2</a>, <a class="el" href="chan__dahdi_8c_source.html#l00255">SIG_PRI</a>, <a class="el" href="chan__dahdi_8c_source.html#l00260">SIG_SF</a>, <a class="el" href="chan__dahdi_8c_source.html#l00264">SIG_SF_FEATB</a>, <a class="el" href="chan__dahdi_8c_source.html#l00261">SIG_SFWINK</a>, <a class="el" href="chan__dahdi_8c_source.html#l00258">SIG_SS7</a>, <a class="el" href="chan__dahdi_8c_source.html#l01262">dahdi_chan_conf::smdi_port</a>, <a class="el" href="agi_2strcompat_8c_source.html#l00093">strcasestr()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01068">dahdi_pvt::stripmsd</a>, <a class="el" href="agi_2strcompat_8c_source.html#l00027">strsep()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00842">dahdi_pvt::threewaycalling</a>, <a class="el" href="chan__iax2_8c_source.html#l00261">timer</a>, <a class="el" href="chan__dahdi_8c_source.html#l01255">dahdi_chan_conf::timing</a>, <a class="el" href="chan__dahdi_8c_source.html#l00681">dahdi_pvt::tonezone</a>, <a class="el" href="chan__dahdi_8c_source.html#l00851">dahdi_pvt::transfer</a>, <a class="el" href="chan__dahdi_8c_source.html#l00882">dahdi_pvt::transfertobusy</a>, <a class="el" href="chan__dahdi_8c_source.html#l00680">dahdi_pvt::txgain</a>, <a class="el" href="chan__dahdi_8c_source.html#l00859">dahdi_pvt::use_callerid</a>, <a class="el" href="chan__dahdi_8c_source.html#l00866">dahdi_pvt::use_callingpres</a>, <a class="el" href="chan__dahdi_8c_source.html#l00955">dahdi_pvt::use_smdi</a>, <a class="el" href="chan__dahdi_8c_source.html#l00763">dahdi_pvt::usefaxbuffers</a>, <a class="el" href="config_8h_source.html#l00076">ast_variable::value</a>, <a class="el" href="chan__dahdi_8c_source.html#l01040">dahdi_pvt::vars</a>, and <a class="el" href="chan__dahdi_8c_source.html#l01109">dahdi_pvt::waitfordialtone</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l17079">setup_dahdi()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l16097"></a>16097 {
<a name="l16098"></a>16098    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *tmp;
<a name="l16099"></a>16099    <span class="keywordtype">int</span> y;
<a name="l16100"></a>16100    <span class="keywordtype">int</span> found_pseudo = 0;
<a name="l16101"></a>16101    <span class="keywordtype">char</span> dahdichan[<a class="code" href="chan__dahdi_8c.html#a29baa04e5997d3badd14e3291b69196b">MAX_CHANLIST_LEN</a>] = {};
<a name="l16102"></a>16102 
<a name="l16103"></a>16103    <span class="keywordflow">for</span> (; v; v = v-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l16104"></a>16104       <span class="keywordflow">if</span> (!<a class="code" href="abstract__jb_8h.html#ae50ad081bd2ae6b58bcfc4687916c586" title="Sets jitterbuffer configuration property.">ast_jb_read_conf</a>(&amp;<a class="code" href="chan__dahdi_8c.html#abaabcb7f4349cc632dde3af5c6a5e1bd">global_jbconf</a>, v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>))
<a name="l16105"></a>16105          <span class="keywordflow">continue</span>;
<a name="l16106"></a>16106 
<a name="l16107"></a>16107       <span class="comment">/* must have parkinglot in confp before build_channels is called */</span>
<a name="l16108"></a>16108       <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;parkinglot&quot;</span>)) {
<a name="l16109"></a>16109          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ac59e01fcfbc9801f87f28f6b60957a24">parkinglot</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ac59e01fcfbc9801f87f28f6b60957a24">parkinglot</a>));
<a name="l16110"></a>16110       }
<a name="l16111"></a>16111 
<a name="l16112"></a>16112       <span class="comment">/* Create the interface list */</span>
<a name="l16113"></a>16113       <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;channel&quot;</span>)
<a name="l16114"></a>16114 #ifdef HAVE_PRI
<a name="l16115"></a>16115          || !strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;crv&quot;</span>)
<a name="l16116"></a>16116 #endif
<a name="l16117"></a>16117          ) {
<a name="l16118"></a>16118          <span class="keywordtype">int</span> iscrv;
<a name="l16119"></a>16119          <span class="keywordflow">if</span> (options &amp; <a class="code" href="chan__dahdi_8c.html#a6743ea33516885eca81012e31dfb7d09">PROC_DAHDI_OPT_NOCHAN</a>) {
<a name="l16120"></a>16120             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Channel &apos;%s&apos; ignored.\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16121"></a>16121             <span class="keywordflow">continue</span>;
<a name="l16122"></a>16122          }
<a name="l16123"></a>16123          iscrv = !strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;crv&quot;</span>);
<a name="l16124"></a>16124          <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#a00c626d9ce33144ed09b620b14afe56d">build_channels</a>(confp, iscrv, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <a class="code" href="chan__dahdi_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>, &amp;found_pseudo))
<a name="l16125"></a>16125                <span class="keywordflow">return</span> -1;
<a name="l16126"></a>16126          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;Channel &apos;%s&apos; configured.\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16127"></a>16127       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;buffers&quot;</span>)) {
<a name="l16128"></a>16128          <span class="keywordtype">int</span> res;
<a name="l16129"></a>16129          <span class="keywordtype">char</span> policy[21] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l16130"></a>16130 
<a name="l16131"></a>16131          res = sscanf(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;%30d,%20s&quot;</span>, &amp;confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#adb74dc4af40df4615bb5f05846cefc9d">buf_no</a>, policy);
<a name="l16132"></a>16132          <span class="keywordflow">if</span> (res != 2) {
<a name="l16133"></a>16133             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Parsing buffers option data failed, using defaults.\n&quot;</span>);
<a name="l16134"></a>16134             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#adb74dc4af40df4615bb5f05846cefc9d">buf_no</a> = <a class="code" href="chan__dahdi_8c.html#a1c57b0f6ff35a4eed5cd50a0d0c313ba">numbufs</a>;
<a name="l16135"></a>16135             <span class="keywordflow">continue</span>;
<a name="l16136"></a>16136          }
<a name="l16137"></a>16137          <span class="keywordflow">if</span> (confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#adb74dc4af40df4615bb5f05846cefc9d">buf_no</a> &lt; 0)
<a name="l16138"></a>16138             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#adb74dc4af40df4615bb5f05846cefc9d">buf_no</a> = <a class="code" href="chan__dahdi_8c.html#a1c57b0f6ff35a4eed5cd50a0d0c313ba">numbufs</a>;
<a name="l16139"></a>16139          <span class="keywordflow">if</span> (!strcasecmp(policy, <span class="stringliteral">&quot;full&quot;</span>)) {
<a name="l16140"></a>16140             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#abfc3801c54ad9e430f5cdf383450a052">buf_policy</a> = DAHDI_POLICY_WHEN_FULL;
<a name="l16141"></a>16141          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(policy, <span class="stringliteral">&quot;immediate&quot;</span>)) {
<a name="l16142"></a>16142             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#abfc3801c54ad9e430f5cdf383450a052">buf_policy</a> = DAHDI_POLICY_IMMEDIATE;
<a name="l16143"></a>16143 <span class="preprocessor">#ifdef HAVE_DAHDI_HALF_FULL</span>
<a name="l16144"></a>16144 <span class="preprocessor"></span>         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(policy, <span class="stringliteral">&quot;half_full&quot;</span>)) {
<a name="l16145"></a>16145             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#abfc3801c54ad9e430f5cdf383450a052">buf_policy</a> = DAHDI_POLICY_HALF_FULL;
<a name="l16146"></a>16146 <span class="preprocessor">#endif</span>
<a name="l16147"></a>16147 <span class="preprocessor"></span>         } <span class="keywordflow">else</span> {
<a name="l16148"></a>16148             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid policy name given (%s).\n&quot;</span>, policy);
<a name="l16149"></a>16149          }
<a name="l16150"></a>16150       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;faxbuffers&quot;</span>)) {
<a name="l16151"></a>16151          <span class="keywordtype">int</span> res;
<a name="l16152"></a>16152          <span class="keywordtype">char</span> policy[21] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l16153"></a>16153 
<a name="l16154"></a>16154          res = sscanf(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;%30d,%20s&quot;</span>, &amp;confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a8e922e18e6489408800cdd7ec015ef85">faxbuf_no</a>, policy);
<a name="l16155"></a>16155          <span class="keywordflow">if</span> (res != 2) {
<a name="l16156"></a>16156             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Parsing faxbuffers option data failed, using defaults.\n&quot;</span>);
<a name="l16157"></a>16157             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a8e922e18e6489408800cdd7ec015ef85">faxbuf_no</a> = <a class="code" href="chan__dahdi_8c.html#a1c57b0f6ff35a4eed5cd50a0d0c313ba">numbufs</a>;
<a name="l16158"></a>16158             <span class="keywordflow">continue</span>;
<a name="l16159"></a>16159          }
<a name="l16160"></a>16160          confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#af518c69bd5c2dd844c9621c278998c3b" title="TRUE if dynamic faxbuffers are configured for use, default is OFF.">usefaxbuffers</a> = 1;
<a name="l16161"></a>16161          <span class="keywordflow">if</span> (confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a8e922e18e6489408800cdd7ec015ef85">faxbuf_no</a> &lt; 0)
<a name="l16162"></a>16162             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a8e922e18e6489408800cdd7ec015ef85">faxbuf_no</a> = <a class="code" href="chan__dahdi_8c.html#a1c57b0f6ff35a4eed5cd50a0d0c313ba">numbufs</a>;
<a name="l16163"></a>16163          <span class="keywordflow">if</span> (!strcasecmp(policy, <span class="stringliteral">&quot;full&quot;</span>)) {
<a name="l16164"></a>16164             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a1bdd30b5265eac27d813ba677086d9ea">faxbuf_policy</a> = DAHDI_POLICY_WHEN_FULL;
<a name="l16165"></a>16165          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(policy, <span class="stringliteral">&quot;immediate&quot;</span>)) {
<a name="l16166"></a>16166             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a1bdd30b5265eac27d813ba677086d9ea">faxbuf_policy</a> = DAHDI_POLICY_IMMEDIATE;
<a name="l16167"></a>16167          } <span class="keywordflow">else</span> {
<a name="l16168"></a>16168             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid policy name given (%s).\n&quot;</span>, policy);
<a name="l16169"></a>16169             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#af518c69bd5c2dd844c9621c278998c3b" title="TRUE if dynamic faxbuffers are configured for use, default is OFF.">usefaxbuffers</a> = 0;
<a name="l16170"></a>16170          }
<a name="l16171"></a>16171       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;dahdichan&quot;</span>)) {
<a name="l16172"></a>16172          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(dahdichan, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(dahdichan));
<a name="l16173"></a>16173       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;usedistinctiveringdetection&quot;</span>)) {
<a name="l16174"></a>16174          <a class="code" href="chan__dahdi_8c.html#adbb77dd3bae219ee6a026c9bfa5a5242">usedistinctiveringdetection</a> = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16175"></a>16175       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;distinctiveringaftercid&quot;</span>)) {
<a name="l16176"></a>16176          <a class="code" href="chan__dahdi_8c.html#a57a2f035f40dcb6566153f7bd5db136e">distinctiveringaftercid</a> = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16177"></a>16177       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;dring1context&quot;</span>)) {
<a name="l16178"></a>16178          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#a4048e79457b9638e0cc206baea4cf1b3">ringContext</a>[0].<a class="code" href="structringContextData.html#a96f75d718104e470aa3c3fc8e3a1257e">contextData</a>,v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>,<span class="keyword">sizeof</span>(confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#a4048e79457b9638e0cc206baea4cf1b3">ringContext</a>[0].<a class="code" href="structringContextData.html#a96f75d718104e470aa3c3fc8e3a1257e">contextData</a>));
<a name="l16179"></a>16179       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;dring2context&quot;</span>)) {
<a name="l16180"></a>16180          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#a4048e79457b9638e0cc206baea4cf1b3">ringContext</a>[1].<a class="code" href="structringContextData.html#a96f75d718104e470aa3c3fc8e3a1257e">contextData</a>,v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>,<span class="keyword">sizeof</span>(confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#a4048e79457b9638e0cc206baea4cf1b3">ringContext</a>[1].<a class="code" href="structringContextData.html#a96f75d718104e470aa3c3fc8e3a1257e">contextData</a>));
<a name="l16181"></a>16181       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;dring3context&quot;</span>)) {
<a name="l16182"></a>16182          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#a4048e79457b9638e0cc206baea4cf1b3">ringContext</a>[2].<a class="code" href="structringContextData.html#a96f75d718104e470aa3c3fc8e3a1257e">contextData</a>,v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>,<span class="keyword">sizeof</span>(confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#a4048e79457b9638e0cc206baea4cf1b3">ringContext</a>[2].<a class="code" href="structringContextData.html#a96f75d718104e470aa3c3fc8e3a1257e">contextData</a>));
<a name="l16183"></a>16183       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;dring1range&quot;</span>)) {
<a name="l16184"></a>16184          confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[0].<a class="code" href="structdistRingData.html#a037e8e370380046bec287bdc96942091">range</a> = atoi(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16185"></a>16185       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;dring2range&quot;</span>)) {
<a name="l16186"></a>16186          confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[1].<a class="code" href="structdistRingData.html#a037e8e370380046bec287bdc96942091">range</a> = atoi(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16187"></a>16187       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;dring3range&quot;</span>)) {
<a name="l16188"></a>16188          confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[2].<a class="code" href="structdistRingData.html#a037e8e370380046bec287bdc96942091">range</a> = atoi(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16189"></a>16189       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;dring1&quot;</span>)) {
<a name="l16190"></a>16190          sscanf(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;%30d,%30d,%30d&quot;</span>, &amp;confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[0].<a class="code" href="structdistRingData.html#ae366f207b91c81a710dc73af8a6f6f52">ring</a>[0], &amp;confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[0].<a class="code" href="structdistRingData.html#ae366f207b91c81a710dc73af8a6f6f52">ring</a>[1], &amp;confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[0].<a class="code" href="structdistRingData.html#ae366f207b91c81a710dc73af8a6f6f52">ring</a>[2]);
<a name="l16191"></a>16191       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;dring2&quot;</span>)) {
<a name="l16192"></a>16192          sscanf(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;%30d,%30d,%30d&quot;</span>, &amp;confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[1].<a class="code" href="structdistRingData.html#ae366f207b91c81a710dc73af8a6f6f52">ring</a>[0], &amp;confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[1].<a class="code" href="structdistRingData.html#ae366f207b91c81a710dc73af8a6f6f52">ring</a>[1], &amp;confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[1].<a class="code" href="structdistRingData.html#ae366f207b91c81a710dc73af8a6f6f52">ring</a>[2]);
<a name="l16193"></a>16193       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;dring3&quot;</span>)) {
<a name="l16194"></a>16194          sscanf(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;%30d,%30d,%30d&quot;</span>, &amp;confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[2].<a class="code" href="structdistRingData.html#ae366f207b91c81a710dc73af8a6f6f52">ring</a>[0], &amp;confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[2].<a class="code" href="structdistRingData.html#ae366f207b91c81a710dc73af8a6f6f52">ring</a>[1], &amp;confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[2].<a class="code" href="structdistRingData.html#ae366f207b91c81a710dc73af8a6f6f52">ring</a>[2]);
<a name="l16195"></a>16195       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;usecallerid&quot;</span>)) {
<a name="l16196"></a>16196          confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#aee1feef8ad729d208a3ab28f0de46658" title="TRUE if caller ID is used on this channel.">use_callerid</a> = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16197"></a>16197       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;cidsignalling&quot;</span>)) {
<a name="l16198"></a>16198          <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;bell&quot;</span>))
<a name="l16199"></a>16199             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ad7f246923324f9b4186b3ee50de56c36">cid_signalling</a> = <a class="code" href="callerid_8h.html#ac4765a6a92728d0defdddd89570baf34">CID_SIG_BELL</a>;
<a name="l16200"></a>16200          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;v23&quot;</span>))
<a name="l16201"></a>16201             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ad7f246923324f9b4186b3ee50de56c36">cid_signalling</a> = <a class="code" href="callerid_8h.html#aa3d409629df5696c54157649828f175b">CID_SIG_V23</a>;
<a name="l16202"></a>16202          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;dtmf&quot;</span>))
<a name="l16203"></a>16203             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ad7f246923324f9b4186b3ee50de56c36">cid_signalling</a> = <a class="code" href="callerid_8h.html#a8503fd7168b61fb6b75cbc73ddec4d4a">CID_SIG_DTMF</a>;
<a name="l16204"></a>16204          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;smdi&quot;</span>))
<a name="l16205"></a>16205             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ad7f246923324f9b4186b3ee50de56c36">cid_signalling</a> = <a class="code" href="callerid_8h.html#a184ebb33d2f7bd0bf257356761404aa7">CID_SIG_SMDI</a>;
<a name="l16206"></a>16206          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;v23_jp&quot;</span>))
<a name="l16207"></a>16207             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ad7f246923324f9b4186b3ee50de56c36">cid_signalling</a> = <a class="code" href="callerid_8h.html#a0b354e4ddad912bb5b23fbee06537104">CID_SIG_V23_JP</a>;
<a name="l16208"></a>16208          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>))
<a name="l16209"></a>16209             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ad7f246923324f9b4186b3ee50de56c36">cid_signalling</a> = <a class="code" href="callerid_8h.html#ac4765a6a92728d0defdddd89570baf34">CID_SIG_BELL</a>;
<a name="l16210"></a>16210       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;cidstart&quot;</span>)) {
<a name="l16211"></a>16211          <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;ring&quot;</span>))
<a name="l16212"></a>16212             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#aafa12631e52b2af7ee7a6ab7bf554ed2">cid_start</a> = <a class="code" href="callerid_8h.html#ab95ac6538ec3b930163ffd43f62063de">CID_START_RING</a>;
<a name="l16213"></a>16213          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;polarity_in&quot;</span>))
<a name="l16214"></a>16214             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#aafa12631e52b2af7ee7a6ab7bf554ed2">cid_start</a> = <a class="code" href="callerid_8h.html#ae09f76d7a76cca0f6ba8cc074828ba70">CID_START_POLARITY_IN</a>;
<a name="l16215"></a>16215          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;polarity&quot;</span>))
<a name="l16216"></a>16216             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#aafa12631e52b2af7ee7a6ab7bf554ed2">cid_start</a> = <a class="code" href="callerid_8h.html#ac420c8a2c16e140da85ba27d43bb72ac">CID_START_POLARITY</a>;
<a name="l16217"></a>16217          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>))
<a name="l16218"></a>16218             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#aafa12631e52b2af7ee7a6ab7bf554ed2">cid_start</a> = <a class="code" href="callerid_8h.html#ab95ac6538ec3b930163ffd43f62063de">CID_START_RING</a>;
<a name="l16219"></a>16219       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;threewaycalling&quot;</span>)) {
<a name="l16220"></a>16220          confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a5ce774381529ffaadd4171bdeba5ebf3" title="TRUE if three way calling is enabled.">threewaycalling</a> = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16221"></a>16221       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;cancallforward&quot;</span>)) {
<a name="l16222"></a>16222          confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ac4e156067fb7e78b012fa7e35dafc887" title="TRUE if support for call forwarding enabled. Dial *72 to enable call forwarding....">cancallforward</a> = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16223"></a>16223       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;relaxdtmf&quot;</span>)) {
<a name="l16224"></a>16224          <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>))
<a name="l16225"></a>16225             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a6829c6ed48c184cbd85055163786a7eb">dtmfrelax</a> = <a class="code" href="dsp_8h.html#af955a2d9ad32683d8d783619480cd348">DSP_DIGITMODE_RELAXDTMF</a>;
<a name="l16226"></a>16226          <span class="keywordflow">else</span>
<a name="l16227"></a>16227             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a6829c6ed48c184cbd85055163786a7eb">dtmfrelax</a> = 0;
<a name="l16228"></a>16228       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;mailbox&quot;</span>)) {
<a name="l16229"></a>16229          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ac81f44f4f22dee90de5975cf8fa4641b" title="Voice mailbox location.">mailbox</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ac81f44f4f22dee90de5975cf8fa4641b" title="Voice mailbox location.">mailbox</a>));
<a name="l16230"></a>16230       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;hasvoicemail&quot;</span>)) {
<a name="l16231"></a>16231          <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>) &amp;&amp; <a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ac81f44f4f22dee90de5975cf8fa4641b" title="Voice mailbox location.">mailbox</a>)) {
<a name="l16232"></a>16232             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ac81f44f4f22dee90de5975cf8fa4641b" title="Voice mailbox location.">mailbox</a>, cat, <span class="keyword">sizeof</span>(confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ac81f44f4f22dee90de5975cf8fa4641b" title="Voice mailbox location.">mailbox</a>));
<a name="l16233"></a>16233          }
<a name="l16234"></a>16234       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;adsi&quot;</span>)) {
<a name="l16235"></a>16235          confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a537f2d4f7f35cb2c667f7c9790793626" title="TRUE if ADSI (Analog Display Services Interface) available.">adsi</a> = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16236"></a>16236       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;usesmdi&quot;</span>)) {
<a name="l16237"></a>16237          confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a93dcf4e5286d88e9c218bbc521584784" title="TRUE if SMDI (Simplified Message Desk Interface) is enabled.">use_smdi</a> = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16238"></a>16238       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;smdiport&quot;</span>)) {
<a name="l16239"></a>16239          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a0d6775bd80749b630d70f6b77a416a5f" title="The serial port to listen for SMDI data on.">smdi_port</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a0d6775bd80749b630d70f6b77a416a5f" title="The serial port to listen for SMDI data on.">smdi_port</a>));
<a name="l16240"></a>16240       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;transfer&quot;</span>)) {
<a name="l16241"></a>16241          confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ad9e41a9a2b63c1e9bad00df4c2bfc92e" title="TRUE if call transfer is enabled.">transfer</a> = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16242"></a>16242       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;canpark&quot;</span>)) {
<a name="l16243"></a>16243          confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a17706e8df212b8e7d0aaf7d13027bf8d" title="TRUE if support for call parking is enabled.">canpark</a> = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16244"></a>16244       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;echocancelwhenbridged&quot;</span>)) {
<a name="l16245"></a>16245          confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ad4ee8bc9c653a9a2ce08e66f62d8814d" title="TRUE if echo cancellation enabled when bridged.">echocanbridged</a> = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16246"></a>16246       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;busydetect&quot;</span>)) {
<a name="l16247"></a>16247          confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ab86910b871c8cff810ab15a587a1ed3b" title="TRUE if busy detection is enabled. (Listens for the beep-beep busy pattern.).">busydetect</a> = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16248"></a>16248       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;busycount&quot;</span>)) {
<a name="l16249"></a>16249          confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a29a1e575aa8b94876e2d3b8da3f6da2b" title="Number of times to see &amp;quot;busy&amp;quot; tone before hanging up.">busycount</a> = atoi(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16250"></a>16250       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;busypattern&quot;</span>)) {
<a name="l16251"></a>16251          <span class="keywordflow">if</span> (sscanf(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;%30d,%30d&quot;</span>, &amp;confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a0b9321a0ad6b6a804a8c7f295f5b8b7a" title="Length of &amp;quot;busy&amp;quot; tone on time.">busy_tonelength</a>, &amp;confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a9224645275ef08732407aea48569aea1" title="Length of &amp;quot;busy&amp;quot; tone off time.">busy_quietlength</a>) != 2) {
<a name="l16252"></a>16252             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;busypattern= expects busypattern=tonelength,quietlength at line %d.\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l16253"></a>16253          }
<a name="l16254"></a>16254       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;callprogress&quot;</span>)) {
<a name="l16255"></a>16255          confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a79710add069e32170f03d92067ec3877" title="Bitmapped call progress detection flags. CALLPROGRESS_xxx values.">callprogress</a> &amp;= ~<a class="code" href="chan__dahdi_8c.html#aa66794917b368980eacd1bf179268e15">CALLPROGRESS_PROGRESS</a>;
<a name="l16256"></a>16256          <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>))
<a name="l16257"></a>16257             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a79710add069e32170f03d92067ec3877" title="Bitmapped call progress detection flags. CALLPROGRESS_xxx values.">callprogress</a> |= <a class="code" href="chan__dahdi_8c.html#aa66794917b368980eacd1bf179268e15">CALLPROGRESS_PROGRESS</a>;
<a name="l16258"></a>16258       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;waitfordialtone&quot;</span>)) {
<a name="l16259"></a>16259          confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a508c2407a52638696697fdeb08f0b2e5" title="Number of milliseconds to wait for dialtone.">waitfordialtone</a> = atoi(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16260"></a>16260       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;faxdetect&quot;</span>)) {
<a name="l16261"></a>16261          confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a79710add069e32170f03d92067ec3877" title="Bitmapped call progress detection flags. CALLPROGRESS_xxx values.">callprogress</a> &amp;= ~<a class="code" href="chan__dahdi_8c.html#a88fcc93d4541c9adcab90b8b2ff37685">CALLPROGRESS_FAX</a>;
<a name="l16262"></a>16262          <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;incoming&quot;</span>)) {
<a name="l16263"></a>16263             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a79710add069e32170f03d92067ec3877" title="Bitmapped call progress detection flags. CALLPROGRESS_xxx values.">callprogress</a> |= <a class="code" href="chan__dahdi_8c.html#a0069de9c37a93a8941cef2ce562abf81">CALLPROGRESS_FAX_INCOMING</a>;
<a name="l16264"></a>16264          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;outgoing&quot;</span>)) {
<a name="l16265"></a>16265             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a79710add069e32170f03d92067ec3877" title="Bitmapped call progress detection flags. CALLPROGRESS_xxx values.">callprogress</a> |= <a class="code" href="chan__dahdi_8c.html#a2957dd1e62c977f55ccb4eeb99d87052">CALLPROGRESS_FAX_OUTGOING</a>;
<a name="l16266"></a>16266          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;both&quot;</span>) || <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>))
<a name="l16267"></a>16267             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a79710add069e32170f03d92067ec3877" title="Bitmapped call progress detection flags. CALLPROGRESS_xxx values.">callprogress</a> |= <a class="code" href="chan__dahdi_8c.html#a0069de9c37a93a8941cef2ce562abf81">CALLPROGRESS_FAX_INCOMING</a> | <a class="code" href="chan__dahdi_8c.html#a2957dd1e62c977f55ccb4eeb99d87052">CALLPROGRESS_FAX_OUTGOING</a>;
<a name="l16268"></a>16268       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;echocancel&quot;</span>)) {
<a name="l16269"></a>16269          <a class="code" href="chan__dahdi_8c.html#aa1169f419df0c4b3f0b71deaf0506ec1">process_echocancel</a>(confp, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l16270"></a>16270       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;echotraining&quot;</span>)) {
<a name="l16271"></a>16271          <span class="keywordflow">if</span> (sscanf(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;%30d&quot;</span>, &amp;y) == 1) {
<a name="l16272"></a>16272             <span class="keywordflow">if</span> ((y &lt; 10) || (y &gt; 4000)) {
<a name="l16273"></a>16273                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Echo training time must be within the range of 10 to 4000 ms at line %d.\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l16274"></a>16274             } <span class="keywordflow">else</span> {
<a name="l16275"></a>16275                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a6c8f2e86376f982c0d9e709736787a51" title="Echo training time. 0 = disabled.">echotraining</a> = y;
<a name="l16276"></a>16276             }
<a name="l16277"></a>16277          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>)) {
<a name="l16278"></a>16278             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a6c8f2e86376f982c0d9e709736787a51" title="Echo training time. 0 = disabled.">echotraining</a> = 400;
<a name="l16279"></a>16279          } <span class="keywordflow">else</span>
<a name="l16280"></a>16280             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a6c8f2e86376f982c0d9e709736787a51" title="Echo training time. 0 = disabled.">echotraining</a> = 0;
<a name="l16281"></a>16281       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;hidecallerid&quot;</span>)) {
<a name="l16282"></a>16282          confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a8c5bb01611cd9890c062782fa0366459" title="TRUE if the outgoing caller ID is blocked/hidden.">hidecallerid</a> = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16283"></a>16283       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;hidecalleridname&quot;</span>)) {
<a name="l16284"></a>16284          confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ab9a2fe4dd3d880dcb9fec85b60814978" title="TRUE if hide just the name not the number for legacy PBX use.">hidecalleridname</a> = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16285"></a>16285       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;pulsedial&quot;</span>)) {
<a name="l16286"></a>16286          confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68d59a550fd5b3d5ce6d59388044ad63" title="TRUE if we will pulse dial.">pulse</a> = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16287"></a>16287       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;callreturn&quot;</span>)) {
<a name="l16288"></a>16288          confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a8f5bca0f17b0735bf05517a0b7e18ebd" title="TRUE if call return is enabled. (*69, if your dialplan doesn&amp;#39;t catch this first)...">callreturn</a> = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16289"></a>16289       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;callwaiting&quot;</span>)) {
<a name="l16290"></a>16290          confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a76742560de0554db5b0b59591ba93adc" title="TRUE if busy extensions will hear the call-waiting tone and can use hook-flash to...">callwaiting</a> = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16291"></a>16291       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;callwaitingcallerid&quot;</span>)) {
<a name="l16292"></a>16292          confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a4a2ed3a92159fb783d3471ea7d76cf43" title="TRUE if send caller ID for Call Waiting.">callwaitingcallerid</a> = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16293"></a>16293       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;context&quot;</span>)) {
<a name="l16294"></a>16294          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ac25ea00ee3f082df06e0cf468cbde240" title="The configured context for incoming calls.">context</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ac25ea00ee3f082df06e0cf468cbde240" title="The configured context for incoming calls.">context</a>));
<a name="l16295"></a>16295       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;language&quot;</span>)) {
<a name="l16296"></a>16296          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#adf416dc058363e2fd5750c77e2d78bee" title="Language configured for calls.">language</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#adf416dc058363e2fd5750c77e2d78bee" title="Language configured for calls.">language</a>));
<a name="l16297"></a>16297       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;progzone&quot;</span>)) {
<a name="l16298"></a>16298          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="chan__dahdi_8c.html#ac3217a28bcd501a0e91a5337210750fb">progzone</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(<a class="code" href="chan__dahdi_8c.html#ac3217a28bcd501a0e91a5337210750fb">progzone</a>));
<a name="l16299"></a>16299       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;mohinterpret&quot;</span>)
<a name="l16300"></a>16300          ||!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;musiconhold&quot;</span>) || !strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;musicclass&quot;</span>)) {
<a name="l16301"></a>16301          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#af689da2b77d1265192a78a5b0994a1d5" title="The configured music-on-hold class to use for calls.">mohinterpret</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#af689da2b77d1265192a78a5b0994a1d5" title="The configured music-on-hold class to use for calls.">mohinterpret</a>));
<a name="l16302"></a>16302       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;mohsuggest&quot;</span>)) {
<a name="l16303"></a>16303          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#aec4e201113703e94cd365aaa6dabd4f0" title="Suggested music-on-hold class for peer channel to use for calls.">mohsuggest</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#aec4e201113703e94cd365aaa6dabd4f0" title="Suggested music-on-hold class for peer channel to use for calls.">mohsuggest</a>));
<a name="l16304"></a>16304       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;parkinglot&quot;</span>)) {
<a name="l16305"></a>16305          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="chan__dahdi_8c.html#ac59e01fcfbc9801f87f28f6b60957a24">parkinglot</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(<a class="code" href="chan__dahdi_8c.html#ac59e01fcfbc9801f87f28f6b60957a24">parkinglot</a>));
<a name="l16306"></a>16306       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;stripmsd&quot;</span>)) {
<a name="l16307"></a>16307          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Configuration option \&quot;%s\&quot; has been deprecated. Please use dialplan instead\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);
<a name="l16308"></a>16308          confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ae485b093be94ace2ac61433abb70d3f1" title="Number of most significant digits/characters to strip from the dialed number.">stripmsd</a> = atoi(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16309"></a>16309       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;jitterbuffers&quot;</span>)) {
<a name="l16310"></a>16310          <a class="code" href="chan__dahdi_8c.html#a1c57b0f6ff35a4eed5cd50a0d0c313ba">numbufs</a> = atoi(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16311"></a>16311       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;group&quot;</span>)) {
<a name="l16312"></a>16312          confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a2f66424184fe1873f7b46b19de589b57" title="Bitmapped groups this belongs to.">group</a> = <a class="code" href="channel_8h.html#aee83e23058d0a4111fda1f506cbda107">ast_get_group</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16313"></a>16313       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;callgroup&quot;</span>)) {
<a name="l16314"></a>16314          <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;none&quot;</span>))
<a name="l16315"></a>16315             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#af0f007b48a9c8cf0629428bd0483e0d1" title="Bitmapped call groups this belongs to.">callgroup</a> = 0;
<a name="l16316"></a>16316          <span class="keywordflow">else</span>
<a name="l16317"></a>16317             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#af0f007b48a9c8cf0629428bd0483e0d1" title="Bitmapped call groups this belongs to.">callgroup</a> = <a class="code" href="channel_8h.html#aee83e23058d0a4111fda1f506cbda107">ast_get_group</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16318"></a>16318       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;pickupgroup&quot;</span>)) {
<a name="l16319"></a>16319          <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;none&quot;</span>))
<a name="l16320"></a>16320             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#abc0651bcec68410023c036b7d8ec4d11" title="Bitmapped pickup groups this belongs to.">pickupgroup</a> = 0;
<a name="l16321"></a>16321          <span class="keywordflow">else</span>
<a name="l16322"></a>16322             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#abc0651bcec68410023c036b7d8ec4d11" title="Bitmapped pickup groups this belongs to.">pickupgroup</a> = <a class="code" href="channel_8h.html#aee83e23058d0a4111fda1f506cbda107">ast_get_group</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16323"></a>16323       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;setvar&quot;</span>)) {
<a name="l16324"></a>16324          <span class="keywordtype">char</span> *varname = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>), *varval = NULL;
<a name="l16325"></a>16325          <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *tmpvar;
<a name="l16326"></a>16326          <span class="keywordflow">if</span> (varname &amp;&amp; (varval = strchr(varname, <span class="charliteral">&apos;=&apos;</span>))) {
<a name="l16327"></a>16327             *varval++ = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l16328"></a>16328             <span class="keywordflow">if</span> ((tmpvar = <a class="code" href="config_8h.html#a08e94d96f459e7301a74daf32035423b">ast_variable_new</a>(varname, varval, <span class="stringliteral">&quot;&quot;</span>))) {
<a name="l16329"></a>16329                tmpvar-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a> = confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a134fe67053d035e763d6cf99916c1bf8" title="Channel variable list with associated values to set when a channel is created.">vars</a>;
<a name="l16330"></a>16330                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a134fe67053d035e763d6cf99916c1bf8" title="Channel variable list with associated values to set when a channel is created.">vars</a> = tmpvar;
<a name="l16331"></a>16331             }
<a name="l16332"></a>16332          }
<a name="l16333"></a>16333       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;immediate&quot;</span>)) {
<a name="l16334"></a>16334          confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a04e3105c0481dfd78913d4bc9796f1c3" title="TRUE if the channel should be answered immediately without attempting to gather any...">immediate</a> = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16335"></a>16335       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;transfertobusy&quot;</span>)) {
<a name="l16336"></a>16336          confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ad9edd1e07f21e10f246e7dc644d47e7e" title="TRUE if allowed to flash-transfer to busy channels.">transfertobusy</a> = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16337"></a>16337       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;mwimonitor&quot;</span>)) {
<a name="l16338"></a>16338          confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a9ca6405842cd66b52da98bb94fbe4fe7" title="TRUE if the FXO port monitors for neon type MWI indications from the other end.">mwimonitor_neon</a> = 0;
<a name="l16339"></a>16339          confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#aad3e7a9f0fe63779a32719116bf7a77b" title="TRUE if the FXO port monitors for fsk type MWI indications from the other end.">mwimonitor_fsk</a> = 0;
<a name="l16340"></a>16340          confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a3dc50dfe697cc83ee35e72ea27025724" title="TRUE if the FXO port monitors for rpas precursor to fsk MWI indications from the...">mwimonitor_rpas</a> = 0;
<a name="l16341"></a>16341          <span class="keywordflow">if</span> (<a class="code" href="agi_2strcompat_8c.html#ae9229017a4501f8d6a637b4498cfed2e">strcasestr</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;fsk&quot;</span>)) {
<a name="l16342"></a>16342             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#aad3e7a9f0fe63779a32719116bf7a77b" title="TRUE if the FXO port monitors for fsk type MWI indications from the other end.">mwimonitor_fsk</a> = 1;
<a name="l16343"></a>16343          }
<a name="l16344"></a>16344          <span class="keywordflow">if</span> (<a class="code" href="agi_2strcompat_8c.html#ae9229017a4501f8d6a637b4498cfed2e">strcasestr</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;rpas&quot;</span>)) {
<a name="l16345"></a>16345             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a3dc50dfe697cc83ee35e72ea27025724" title="TRUE if the FXO port monitors for rpas precursor to fsk MWI indications from the...">mwimonitor_rpas</a> = 1;
<a name="l16346"></a>16346          }
<a name="l16347"></a>16347          <span class="keywordflow">if</span> (<a class="code" href="agi_2strcompat_8c.html#ae9229017a4501f8d6a637b4498cfed2e">strcasestr</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;neon&quot;</span>)) {
<a name="l16348"></a>16348             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a9ca6405842cd66b52da98bb94fbe4fe7" title="TRUE if the FXO port monitors for neon type MWI indications from the other end.">mwimonitor_neon</a> = 1;
<a name="l16349"></a>16349          }
<a name="l16350"></a>16350          <span class="comment">/* If set to true or yes, assume that simple fsk is desired */</span>
<a name="l16351"></a>16351          <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>)) {
<a name="l16352"></a>16352             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#aad3e7a9f0fe63779a32719116bf7a77b" title="TRUE if the FXO port monitors for fsk type MWI indications from the other end.">mwimonitor_fsk</a> = 1;
<a name="l16353"></a>16353          }
<a name="l16354"></a>16354       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;cid_rxgain&quot;</span>)) {
<a name="l16355"></a>16355          <span class="keywordflow">if</span> (sscanf(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;%30f&quot;</span>, &amp;confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a0fab7ca391bb3e45727b888a50902f7e" title="Amount of gain to increase during caller id.">cid_rxgain</a>) != 1) {
<a name="l16356"></a>16356             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid cid_rxgain: %s at line %d.\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l16357"></a>16357          }
<a name="l16358"></a>16358       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;rxgain&quot;</span>)) {
<a name="l16359"></a>16359          <span class="keywordflow">if</span> (sscanf(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;%30f&quot;</span>, &amp;confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#aeebb464c72892c9f3ddafed5ade720ee" title="Rx gain set by chan_dahdi.conf.">rxgain</a>) != 1) {
<a name="l16360"></a>16360             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid rxgain: %s at line %d.\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l16361"></a>16361          }
<a name="l16362"></a>16362       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;txgain&quot;</span>)) {
<a name="l16363"></a>16363          <span class="keywordflow">if</span> (sscanf(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;%30f&quot;</span>, &amp;confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ad291967734f3b7bee3ec179278a1f76f" title="Tx gain set by chan_dahdi.conf.">txgain</a>) != 1) {
<a name="l16364"></a>16364             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid txgain: %s at line %d.\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l16365"></a>16365          }
<a name="l16366"></a>16366       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;tonezone&quot;</span>)) {
<a name="l16367"></a>16367          <span class="keywordflow">if</span> (sscanf(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;%30d&quot;</span>, &amp;confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a6db22ef545ab36c0c1913d4541122d99">tonezone</a>) != 1) {
<a name="l16368"></a>16368             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid tonezone: %s at line %d.\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l16369"></a>16369          }
<a name="l16370"></a>16370       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;callerid&quot;</span>)) {
<a name="l16371"></a>16371          <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;asreceived&quot;</span>)) {
<a name="l16372"></a>16372             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a29e973bd94bfbaf59d939bd1bc988c32" title="Caller ID number from an incoming call.">cid_num</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l16373"></a>16373             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ade5a89f9bee15a492c760ec1765a292d" title="Caller ID name from an incoming call.">cid_name</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l16374"></a>16374          } <span class="keywordflow">else</span> {
<a name="l16375"></a>16375             <a class="code" href="callerid_8h.html#af33ee38631fe79ab21d91bcd0634903a">ast_callerid_split</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ade5a89f9bee15a492c760ec1765a292d" title="Caller ID name from an incoming call.">cid_name</a>, <span class="keyword">sizeof</span>(confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ade5a89f9bee15a492c760ec1765a292d" title="Caller ID name from an incoming call.">cid_name</a>), confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a29e973bd94bfbaf59d939bd1bc988c32" title="Caller ID number from an incoming call.">cid_num</a>, <span class="keyword">sizeof</span>(confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a29e973bd94bfbaf59d939bd1bc988c32" title="Caller ID number from an incoming call.">cid_num</a>));
<a name="l16376"></a>16376          }
<a name="l16377"></a>16377       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;fullname&quot;</span>)) {
<a name="l16378"></a>16378          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ade5a89f9bee15a492c760ec1765a292d" title="Caller ID name from an incoming call.">cid_name</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ade5a89f9bee15a492c760ec1765a292d" title="Caller ID name from an incoming call.">cid_name</a>));
<a name="l16379"></a>16379       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;cid_number&quot;</span>)) {
<a name="l16380"></a>16380          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a29e973bd94bfbaf59d939bd1bc988c32" title="Caller ID number from an incoming call.">cid_num</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a29e973bd94bfbaf59d939bd1bc988c32" title="Caller ID number from an incoming call.">cid_num</a>));
<a name="l16381"></a>16381       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;useincomingcalleridondahditransfer&quot;</span>)) {
<a name="l16382"></a>16382          confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a1ef0f7461e78f948f1b71a1e5c99cc8b" title="TRUE if we should use the callerid from incoming call on dahdi transfer.">dahditrcallerid</a> = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16383"></a>16383       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;restrictcid&quot;</span>)) {
<a name="l16384"></a>16384          confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ab16ad9a41cc58b9ebf666bbe923db5ea" title="TRUE if caller ID is restricted.">restrictcid</a> = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16385"></a>16385       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;usecallingpres&quot;</span>)) {
<a name="l16386"></a>16386          confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a6799914e39462ec4cfef0e6b310e7104" title="TRUE if we will use the calling presentation setting from the Asterisk channel for...">use_callingpres</a> = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16387"></a>16387       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;accountcode&quot;</span>)) {
<a name="l16388"></a>16388          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#adfee50d07a98645d4d20b896ce03785a">accountcode</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#adfee50d07a98645d4d20b896ce03785a">accountcode</a>));
<a name="l16389"></a>16389       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;amaflags&quot;</span>)) {
<a name="l16390"></a>16390          y = <a class="code" href="cdr_8h.html#a5c2d2dee484a1ad9dbef128c11a2b693" title="Convert a string to a detail record AMA flag.">ast_cdr_amaflags2int</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16391"></a>16391          <span class="keywordflow">if</span> (y &lt; 0)
<a name="l16392"></a>16392             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid AMA flags: %s at line %d.\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l16393"></a>16393          <span class="keywordflow">else</span>
<a name="l16394"></a>16394             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ad2cfb0f821c065261382a9298bb5a16b">amaflags</a> = y;
<a name="l16395"></a>16395       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;polarityonanswerdelay&quot;</span>)) {
<a name="l16396"></a>16396          confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a28dcc1bc69a96039746426f0093f1ee5" title="Minimal time period (ms) between the answer polarity switch and hangup polarity switch...">polarityonanswerdelay</a> = atoi(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16397"></a>16397       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;answeronpolarityswitch&quot;</span>)) {
<a name="l16398"></a>16398          confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a5a4fb6da5625cc1eec0c9821f0d41d52" title="TRUE if we can use a polarity reversal to mark when an outgoing call is answered...">answeronpolarityswitch</a> = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16399"></a>16399       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;hanguponpolarityswitch&quot;</span>)) {
<a name="l16400"></a>16400          confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a7bc13c53b24817de617833097a940350" title="TRUE if the call will be considered &amp;quot;hung up&amp;quot; on a polarity reversal.">hanguponpolarityswitch</a> = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16401"></a>16401       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;sendcalleridafter&quot;</span>)) {
<a name="l16402"></a>16402          confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a311ee33a384e8e54e8d782e584ec4544" title="Send caller ID after this many rings.">sendcalleridafter</a> = atoi(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16403"></a>16403       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;mwimonitornotify&quot;</span>)) {
<a name="l16404"></a>16404          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="chan__dahdi_8c.html#a200370774ee53e137af5d8d7932b7acc">mwimonitornotify</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(<a class="code" href="chan__dahdi_8c.html#a200370774ee53e137af5d8d7932b7acc">mwimonitornotify</a>));
<a name="l16405"></a>16405       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;mwisendtype&quot;</span>)) {
<a name="l16406"></a>16406 <span class="preprocessor">#ifndef HAVE_DAHDI_LINEREVERSE_VMWI  </span><span class="comment">/* backward compatibility for older dahdi VMWI implementation */</span>
<a name="l16407"></a>16407          <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;rpas&quot;</span>)) { <span class="comment">/* Ring Pulse Alert Signal */</span>
<a name="l16408"></a>16408             <a class="code" href="chan__dahdi_8c.html#a3ae0342ed2b020e1e4cc4483e3fa55a6">mwisend_rpas</a> = 1;
<a name="l16409"></a>16409          } <span class="keywordflow">else</span> {
<a name="l16410"></a>16410             <a class="code" href="chan__dahdi_8c.html#a3ae0342ed2b020e1e4cc4483e3fa55a6">mwisend_rpas</a> = 0;
<a name="l16411"></a>16411          }
<a name="l16412"></a>16412 <span class="preprocessor">#else</span>
<a name="l16413"></a>16413 <span class="preprocessor"></span>         <span class="comment">/* Default is fsk, to turn it off you must specify nofsk */</span>
<a name="l16414"></a>16414          memset(&amp;confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.mwisend_setting, 0, <span class="keyword">sizeof</span>(confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.mwisend_setting));
<a name="l16415"></a>16415          <span class="keywordflow">if</span> (<a class="code" href="agi_2strcompat_8c.html#ae9229017a4501f8d6a637b4498cfed2e">strcasestr</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;nofsk&quot;</span>)) {      <span class="comment">/* NoFSK */</span>
<a name="l16416"></a>16416             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.mwisend_fsk = 0;
<a name="l16417"></a>16417          } <span class="keywordflow">else</span> {             <span class="comment">/* Default FSK */</span>
<a name="l16418"></a>16418             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.mwisend_fsk = 1;
<a name="l16419"></a>16419          }
<a name="l16420"></a>16420          <span class="keywordflow">if</span> (<a class="code" href="agi_2strcompat_8c.html#ae9229017a4501f8d6a637b4498cfed2e">strcasestr</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;rpas&quot;</span>)) {       <span class="comment">/* Ring Pulse Alert Signal, normally followed by FSK */</span>
<a name="l16421"></a>16421             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.mwisend_rpas = 1;
<a name="l16422"></a>16422          } <span class="keywordflow">else</span> {
<a name="l16423"></a>16423             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.mwisend_rpas = 0;
<a name="l16424"></a>16424          }
<a name="l16425"></a>16425          <span class="keywordflow">if</span> (<a class="code" href="agi_2strcompat_8c.html#ae9229017a4501f8d6a637b4498cfed2e">strcasestr</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;lrev&quot;</span>)) {       <span class="comment">/* Line Reversal */</span>
<a name="l16426"></a>16426             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.mwisend_setting.vmwi_type |= DAHDI_VMWI_LREV;
<a name="l16427"></a>16427          }
<a name="l16428"></a>16428          <span class="keywordflow">if</span> (<a class="code" href="agi_2strcompat_8c.html#ae9229017a4501f8d6a637b4498cfed2e">strcasestr</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;hvdc&quot;</span>)) {       <span class="comment">/* HV 90VDC */</span>
<a name="l16429"></a>16429             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.mwisend_setting.vmwi_type |= DAHDI_VMWI_HVDC;
<a name="l16430"></a>16430          }
<a name="l16431"></a>16431          <span class="keywordflow">if</span> ( (<a class="code" href="agi_2strcompat_8c.html#ae9229017a4501f8d6a637b4498cfed2e">strcasestr</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;neon&quot;</span>)) || (<a class="code" href="agi_2strcompat_8c.html#ae9229017a4501f8d6a637b4498cfed2e">strcasestr</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;hvac&quot;</span>)) ){   <span class="comment">/* 90V DC pulses */</span>
<a name="l16432"></a>16432             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.mwisend_setting.vmwi_type |= DAHDI_VMWI_HVAC;
<a name="l16433"></a>16433          }
<a name="l16434"></a>16434 <span class="preprocessor">#endif</span>
<a name="l16435"></a>16435 <span class="preprocessor"></span>      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a> != 1) {
<a name="l16436"></a>16436           <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;signalling&quot;</span>) || !strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;signaling&quot;</span>)) {
<a name="l16437"></a>16437             <span class="keywordtype">int</span> orig_radio = confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ac53b42243ee40edc74b615fe86806fe3" title="Nonzero if the signaling type is sent over a radio.">radio</a>;
<a name="l16438"></a>16438             <span class="keywordtype">int</span> orig_outsigmod = confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a57a35ad748a874002c2b58676e5b2687">outsigmod</a>;
<a name="l16439"></a>16439             <span class="keywordtype">int</span> orig_auto = confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a26ed3f8f070e4f51214b5370ad43d650">is_sig_auto</a>;
<a name="l16440"></a>16440 
<a name="l16441"></a>16441             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ac53b42243ee40edc74b615fe86806fe3" title="Nonzero if the signaling type is sent over a radio.">radio</a> = 0;
<a name="l16442"></a>16442             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a57a35ad748a874002c2b58676e5b2687">outsigmod</a> = -1;
<a name="l16443"></a>16443             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a26ed3f8f070e4f51214b5370ad43d650">is_sig_auto</a> = 0;
<a name="l16444"></a>16444             <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;em&quot;</span>)) {
<a name="l16445"></a>16445                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#afa7547cd2cee1bae7734206102635216">SIG_EM</a>;
<a name="l16446"></a>16446             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;em_e1&quot;</span>)) {
<a name="l16447"></a>16447                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#aa7b59772722b794c5218768dac3ee419">SIG_EM_E1</a>;
<a name="l16448"></a>16448             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;em_w&quot;</span>)) {
<a name="l16449"></a>16449                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#a1ba988b93fce049075b7c2ef6c931cf9">SIG_EMWINK</a>;
<a name="l16450"></a>16450             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;fxs_ls&quot;</span>)) {
<a name="l16451"></a>16451                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#a1dc50a07aef86c90ab94f1583c35a265">SIG_FXSLS</a>;
<a name="l16452"></a>16452             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;fxs_gs&quot;</span>)) {
<a name="l16453"></a>16453                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#a97e4c6fb4680984aafc6e0e55a2b6cb4">SIG_FXSGS</a>;
<a name="l16454"></a>16454             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;fxs_ks&quot;</span>)) {
<a name="l16455"></a>16455                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#a38139ec369c0243f4324eb4eb0c2f004">SIG_FXSKS</a>;
<a name="l16456"></a>16456             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;fxo_ls&quot;</span>)) {
<a name="l16457"></a>16457                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#adb40571aa5ff846fc334be5260eab257">SIG_FXOLS</a>;
<a name="l16458"></a>16458             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;fxo_gs&quot;</span>)) {
<a name="l16459"></a>16459                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#a3dcffbaf4a26f2b7b792998df1eea27b">SIG_FXOGS</a>;
<a name="l16460"></a>16460             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;fxo_ks&quot;</span>)) {
<a name="l16461"></a>16461                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#a7c9b3bb8225896ff2b9aed27e6f80f10">SIG_FXOKS</a>;
<a name="l16462"></a>16462             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;fxs_rx&quot;</span>)) {
<a name="l16463"></a>16463                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#a38139ec369c0243f4324eb4eb0c2f004">SIG_FXSKS</a>;
<a name="l16464"></a>16464                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ac53b42243ee40edc74b615fe86806fe3" title="Nonzero if the signaling type is sent over a radio.">radio</a> = 1;
<a name="l16465"></a>16465             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;fxo_rx&quot;</span>)) {
<a name="l16466"></a>16466                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#adb40571aa5ff846fc334be5260eab257">SIG_FXOLS</a>;
<a name="l16467"></a>16467                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ac53b42243ee40edc74b615fe86806fe3" title="Nonzero if the signaling type is sent over a radio.">radio</a> = 1;
<a name="l16468"></a>16468             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;fxs_tx&quot;</span>)) {
<a name="l16469"></a>16469                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#a1dc50a07aef86c90ab94f1583c35a265">SIG_FXSLS</a>;
<a name="l16470"></a>16470                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ac53b42243ee40edc74b615fe86806fe3" title="Nonzero if the signaling type is sent over a radio.">radio</a> = 1;
<a name="l16471"></a>16471             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;fxo_tx&quot;</span>)) {
<a name="l16472"></a>16472                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#a3dcffbaf4a26f2b7b792998df1eea27b">SIG_FXOGS</a>;
<a name="l16473"></a>16473                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ac53b42243ee40edc74b615fe86806fe3" title="Nonzero if the signaling type is sent over a radio.">radio</a> = 1;
<a name="l16474"></a>16474             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;em_rx&quot;</span>)) {
<a name="l16475"></a>16475                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#afa7547cd2cee1bae7734206102635216">SIG_EM</a>;
<a name="l16476"></a>16476                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ac53b42243ee40edc74b615fe86806fe3" title="Nonzero if the signaling type is sent over a radio.">radio</a> = 1;
<a name="l16477"></a>16477             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;em_tx&quot;</span>)) {
<a name="l16478"></a>16478                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#afa7547cd2cee1bae7734206102635216">SIG_EM</a>;
<a name="l16479"></a>16479                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ac53b42243ee40edc74b615fe86806fe3" title="Nonzero if the signaling type is sent over a radio.">radio</a> = 1;
<a name="l16480"></a>16480             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;em_rxtx&quot;</span>)) {
<a name="l16481"></a>16481                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#afa7547cd2cee1bae7734206102635216">SIG_EM</a>;
<a name="l16482"></a>16482                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ac53b42243ee40edc74b615fe86806fe3" title="Nonzero if the signaling type is sent over a radio.">radio</a> = 2;
<a name="l16483"></a>16483             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;em_txrx&quot;</span>)) {
<a name="l16484"></a>16484                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#afa7547cd2cee1bae7734206102635216">SIG_EM</a>;
<a name="l16485"></a>16485                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ac53b42243ee40edc74b615fe86806fe3" title="Nonzero if the signaling type is sent over a radio.">radio</a> = 2;
<a name="l16486"></a>16486             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;sf&quot;</span>)) {
<a name="l16487"></a>16487                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#afacb372d32fba2192ed6a2989c54fbda">SIG_SF</a>;
<a name="l16488"></a>16488             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;sf_w&quot;</span>)) {
<a name="l16489"></a>16489                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#a193853e7e76cff05d51425eba48d030f">SIG_SFWINK</a>;
<a name="l16490"></a>16490             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;sf_featd&quot;</span>)) {
<a name="l16491"></a>16491                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#ab79873391af2857a602e1eff68606f23">SIG_FEATD</a>;
<a name="l16492"></a>16492             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;sf_featdmf&quot;</span>)) {
<a name="l16493"></a>16493                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#a98d4710afc1fcb2ff110eabb4fbcc308">SIG_FEATDMF</a>;
<a name="l16494"></a>16494             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;sf_featb&quot;</span>)) {
<a name="l16495"></a>16495                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#a33a2f70a24e9f8ccfcc1e76f208b1ab6">SIG_SF_FEATB</a>;
<a name="l16496"></a>16496             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;sf&quot;</span>)) {
<a name="l16497"></a>16497                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#afacb372d32fba2192ed6a2989c54fbda">SIG_SF</a>;
<a name="l16498"></a>16498             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;sf_rx&quot;</span>)) {
<a name="l16499"></a>16499                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#afacb372d32fba2192ed6a2989c54fbda">SIG_SF</a>;
<a name="l16500"></a>16500                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ac53b42243ee40edc74b615fe86806fe3" title="Nonzero if the signaling type is sent over a radio.">radio</a> = 1;
<a name="l16501"></a>16501             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;sf_tx&quot;</span>)) {
<a name="l16502"></a>16502                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#afacb372d32fba2192ed6a2989c54fbda">SIG_SF</a>;
<a name="l16503"></a>16503                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ac53b42243ee40edc74b615fe86806fe3" title="Nonzero if the signaling type is sent over a radio.">radio</a> = 1;
<a name="l16504"></a>16504             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;sf_rxtx&quot;</span>)) {
<a name="l16505"></a>16505                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#afacb372d32fba2192ed6a2989c54fbda">SIG_SF</a>;
<a name="l16506"></a>16506                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ac53b42243ee40edc74b615fe86806fe3" title="Nonzero if the signaling type is sent over a radio.">radio</a> = 2;
<a name="l16507"></a>16507             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;sf_txrx&quot;</span>)) {
<a name="l16508"></a>16508                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#afacb372d32fba2192ed6a2989c54fbda">SIG_SF</a>;
<a name="l16509"></a>16509                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ac53b42243ee40edc74b615fe86806fe3" title="Nonzero if the signaling type is sent over a radio.">radio</a> = 2;
<a name="l16510"></a>16510             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;featd&quot;</span>)) {
<a name="l16511"></a>16511                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#ab79873391af2857a602e1eff68606f23">SIG_FEATD</a>;
<a name="l16512"></a>16512             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;featdmf&quot;</span>)) {
<a name="l16513"></a>16513                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#a98d4710afc1fcb2ff110eabb4fbcc308">SIG_FEATDMF</a>;
<a name="l16514"></a>16514             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;featdmf_ta&quot;</span>)) {
<a name="l16515"></a>16515                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#ac0c40f74945ed15aa82cd9fedc304e55">SIG_FEATDMF_TA</a>;
<a name="l16516"></a>16516             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;e911&quot;</span>)) {
<a name="l16517"></a>16517                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#adfdd0e4d05281d354c15ef1a5d158cd6">SIG_E911</a>;
<a name="l16518"></a>16518             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;fgccama&quot;</span>)) {
<a name="l16519"></a>16519                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#a167056b2763a4897838c7115efc1f9fc">SIG_FGC_CAMA</a>;
<a name="l16520"></a>16520             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;fgccamamf&quot;</span>)) {
<a name="l16521"></a>16521                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#a945e2b5f225d3abdc57b5dcc53daa62a">SIG_FGC_CAMAMF</a>;
<a name="l16522"></a>16522             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;featb&quot;</span>)) {
<a name="l16523"></a>16523                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#a0ba8ec199f5fb4f2be64144be0bd13b1">SIG_FEATB</a>;
<a name="l16524"></a>16524 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l16525"></a>16525 <span class="preprocessor"></span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;pri_net&quot;</span>)) {
<a name="l16526"></a>16526                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#ae9ab0c9508fca045a06730533be276a5">SIG_PRI</a>;
<a name="l16527"></a>16527                confp-&gt;pri.nodetype = PRI_NETWORK;
<a name="l16528"></a>16528             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;pri_cpe&quot;</span>)) {
<a name="l16529"></a>16529                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#ae9ab0c9508fca045a06730533be276a5">SIG_PRI</a>;
<a name="l16530"></a>16530                confp-&gt;pri.nodetype = PRI_CPE;
<a name="l16531"></a>16531             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;bri_cpe&quot;</span>)) {
<a name="l16532"></a>16532                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#ab5bfeaf991c23c5b6510ace44ae79ce9">SIG_BRI</a>;
<a name="l16533"></a>16533                confp-&gt;pri.nodetype = PRI_CPE;
<a name="l16534"></a>16534             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;bri_net&quot;</span>)) {
<a name="l16535"></a>16535                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#ab5bfeaf991c23c5b6510ace44ae79ce9">SIG_BRI</a>;
<a name="l16536"></a>16536                confp-&gt;pri.nodetype = PRI_NETWORK;
<a name="l16537"></a>16537             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;bri_cpe_ptmp&quot;</span>)) {
<a name="l16538"></a>16538                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a>;
<a name="l16539"></a>16539                confp-&gt;pri.nodetype = PRI_CPE;
<a name="l16540"></a>16540             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;bri_net_ptmp&quot;</span>)) {
<a name="l16541"></a>16541                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;How cool would it be if someone implemented this mode!  For now, sucks for you. (line %d)\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l16542"></a>16542             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;gr303fxoks_net&quot;</span>)) {
<a name="l16543"></a>16543                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#a5724d8559318f4724b247ede46ff182d">SIG_GR303FXOKS</a>;
<a name="l16544"></a>16544                confp-&gt;pri.nodetype = PRI_NETWORK;
<a name="l16545"></a>16545             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;gr303fxsks_cpe&quot;</span>)) {
<a name="l16546"></a>16546                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#adc73c6cbd4b991ecd2925640c0c8761e">SIG_GR303FXSKS</a>;
<a name="l16547"></a>16547                confp-&gt;pri.nodetype = PRI_CPE;
<a name="l16548"></a>16548 <span class="preprocessor">#endif</span>
<a name="l16549"></a>16549 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_SS7</span>
<a name="l16550"></a>16550 <span class="preprocessor"></span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;ss7&quot;</span>)) {
<a name="l16551"></a>16551                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#aadcda889db3cf9dfe757dbc1d4d8311a">SIG_SS7</a>;
<a name="l16552"></a>16552 <span class="preprocessor">#endif</span>
<a name="l16553"></a>16553 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_OPENR2</span>
<a name="l16554"></a>16554 <span class="preprocessor"></span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;mfcr2&quot;</span>)) {
<a name="l16555"></a>16555                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> = <a class="code" href="chan__dahdi_8c.html#a1d73a98ae12601287580dedd9a6d739b">SIG_MFCR2</a>;
<a name="l16556"></a>16556 <span class="preprocessor">#endif</span>
<a name="l16557"></a>16557 <span class="preprocessor"></span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;auto&quot;</span>)) {
<a name="l16558"></a>16558                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a26ed3f8f070e4f51214b5370ad43d650">is_sig_auto</a> = 1;
<a name="l16559"></a>16559             } <span class="keywordflow">else</span> {
<a name="l16560"></a>16560                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a57a35ad748a874002c2b58676e5b2687">outsigmod</a> = orig_outsigmod;
<a name="l16561"></a>16561                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ac53b42243ee40edc74b615fe86806fe3" title="Nonzero if the signaling type is sent over a radio.">radio</a> = orig_radio;
<a name="l16562"></a>16562                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a26ed3f8f070e4f51214b5370ad43d650">is_sig_auto</a> = orig_auto;
<a name="l16563"></a>16563                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unknown signalling method &apos;%s&apos; at line %d.\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l16564"></a>16564             }
<a name="l16565"></a>16565           } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;outsignalling&quot;</span>) || !strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;outsignaling&quot;</span>)) {
<a name="l16566"></a>16566             <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;em&quot;</span>)) {
<a name="l16567"></a>16567                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a57a35ad748a874002c2b58676e5b2687">outsigmod</a> = <a class="code" href="chan__dahdi_8c.html#afa7547cd2cee1bae7734206102635216">SIG_EM</a>;
<a name="l16568"></a>16568             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;em_e1&quot;</span>)) {
<a name="l16569"></a>16569                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a57a35ad748a874002c2b58676e5b2687">outsigmod</a> = <a class="code" href="chan__dahdi_8c.html#aa7b59772722b794c5218768dac3ee419">SIG_EM_E1</a>;
<a name="l16570"></a>16570             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;em_w&quot;</span>)) {
<a name="l16571"></a>16571                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a57a35ad748a874002c2b58676e5b2687">outsigmod</a> = <a class="code" href="chan__dahdi_8c.html#a1ba988b93fce049075b7c2ef6c931cf9">SIG_EMWINK</a>;
<a name="l16572"></a>16572             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;sf&quot;</span>)) {
<a name="l16573"></a>16573                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a57a35ad748a874002c2b58676e5b2687">outsigmod</a> = <a class="code" href="chan__dahdi_8c.html#afacb372d32fba2192ed6a2989c54fbda">SIG_SF</a>;
<a name="l16574"></a>16574             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;sf_w&quot;</span>)) {
<a name="l16575"></a>16575                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a57a35ad748a874002c2b58676e5b2687">outsigmod</a> = <a class="code" href="chan__dahdi_8c.html#a193853e7e76cff05d51425eba48d030f">SIG_SFWINK</a>;
<a name="l16576"></a>16576             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;sf_featd&quot;</span>)) {
<a name="l16577"></a>16577                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a57a35ad748a874002c2b58676e5b2687">outsigmod</a> = <a class="code" href="chan__dahdi_8c.html#ab79873391af2857a602e1eff68606f23">SIG_FEATD</a>;
<a name="l16578"></a>16578             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;sf_featdmf&quot;</span>)) {
<a name="l16579"></a>16579                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a57a35ad748a874002c2b58676e5b2687">outsigmod</a> = <a class="code" href="chan__dahdi_8c.html#a98d4710afc1fcb2ff110eabb4fbcc308">SIG_FEATDMF</a>;
<a name="l16580"></a>16580             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;sf_featb&quot;</span>)) {
<a name="l16581"></a>16581                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a57a35ad748a874002c2b58676e5b2687">outsigmod</a> = <a class="code" href="chan__dahdi_8c.html#a33a2f70a24e9f8ccfcc1e76f208b1ab6">SIG_SF_FEATB</a>;
<a name="l16582"></a>16582             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;sf&quot;</span>)) {
<a name="l16583"></a>16583                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a57a35ad748a874002c2b58676e5b2687">outsigmod</a> = <a class="code" href="chan__dahdi_8c.html#afacb372d32fba2192ed6a2989c54fbda">SIG_SF</a>;
<a name="l16584"></a>16584             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;featd&quot;</span>)) {
<a name="l16585"></a>16585                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a57a35ad748a874002c2b58676e5b2687">outsigmod</a> = <a class="code" href="chan__dahdi_8c.html#ab79873391af2857a602e1eff68606f23">SIG_FEATD</a>;
<a name="l16586"></a>16586             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;featdmf&quot;</span>)) {
<a name="l16587"></a>16587                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a57a35ad748a874002c2b58676e5b2687">outsigmod</a> = <a class="code" href="chan__dahdi_8c.html#a98d4710afc1fcb2ff110eabb4fbcc308">SIG_FEATDMF</a>;
<a name="l16588"></a>16588             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;featdmf_ta&quot;</span>)) {
<a name="l16589"></a>16589                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a57a35ad748a874002c2b58676e5b2687">outsigmod</a> = <a class="code" href="chan__dahdi_8c.html#ac0c40f74945ed15aa82cd9fedc304e55">SIG_FEATDMF_TA</a>;
<a name="l16590"></a>16590             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;e911&quot;</span>)) {
<a name="l16591"></a>16591                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a57a35ad748a874002c2b58676e5b2687">outsigmod</a> = <a class="code" href="chan__dahdi_8c.html#adfdd0e4d05281d354c15ef1a5d158cd6">SIG_E911</a>;
<a name="l16592"></a>16592             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;fgccama&quot;</span>)) {
<a name="l16593"></a>16593                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a57a35ad748a874002c2b58676e5b2687">outsigmod</a> = <a class="code" href="chan__dahdi_8c.html#a167056b2763a4897838c7115efc1f9fc">SIG_FGC_CAMA</a>;
<a name="l16594"></a>16594             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;fgccamamf&quot;</span>)) {
<a name="l16595"></a>16595                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a57a35ad748a874002c2b58676e5b2687">outsigmod</a> = <a class="code" href="chan__dahdi_8c.html#a945e2b5f225d3abdc57b5dcc53daa62a">SIG_FGC_CAMAMF</a>;
<a name="l16596"></a>16596             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;featb&quot;</span>)) {
<a name="l16597"></a>16597                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a57a35ad748a874002c2b58676e5b2687">outsigmod</a> = <a class="code" href="chan__dahdi_8c.html#a0ba8ec199f5fb4f2be64144be0bd13b1">SIG_FEATB</a>;
<a name="l16598"></a>16598             } <span class="keywordflow">else</span> {
<a name="l16599"></a>16599                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unknown signalling method &apos;%s&apos; at line %d.\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l16600"></a>16600             }
<a name="l16601"></a>16601 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l16602"></a>16602 <span class="preprocessor"></span>         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;pridialplan&quot;</span>)) {
<a name="l16603"></a>16603             <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;national&quot;</span>)) {
<a name="l16604"></a>16604                confp-&gt;pri.dialplan = PRI_NATIONAL_ISDN + 1;
<a name="l16605"></a>16605             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;unknown&quot;</span>)) {
<a name="l16606"></a>16606                confp-&gt;pri.dialplan = PRI_UNKNOWN + 1;
<a name="l16607"></a>16607             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;private&quot;</span>)) {
<a name="l16608"></a>16608                confp-&gt;pri.dialplan = PRI_PRIVATE + 1;
<a name="l16609"></a>16609             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;international&quot;</span>)) {
<a name="l16610"></a>16610                confp-&gt;pri.dialplan = PRI_INTERNATIONAL_ISDN + 1;
<a name="l16611"></a>16611             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;local&quot;</span>)) {
<a name="l16612"></a>16612                confp-&gt;pri.dialplan = PRI_LOCAL_ISDN + 1;
<a name="l16613"></a>16613             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;dynamic&quot;</span>)) {
<a name="l16614"></a>16614                confp-&gt;pri.dialplan = -1;
<a name="l16615"></a>16615             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;redundant&quot;</span>)) {
<a name="l16616"></a>16616                confp-&gt;pri.dialplan = -2;
<a name="l16617"></a>16617             } <span class="keywordflow">else</span> {
<a name="l16618"></a>16618                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unknown PRI dialplan &apos;%s&apos; at line %d.\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l16619"></a>16619             }
<a name="l16620"></a>16620          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;prilocaldialplan&quot;</span>)) {
<a name="l16621"></a>16621             <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;national&quot;</span>)) {
<a name="l16622"></a>16622                confp-&gt;pri.localdialplan = PRI_NATIONAL_ISDN + 1;
<a name="l16623"></a>16623             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;unknown&quot;</span>)) {
<a name="l16624"></a>16624                confp-&gt;pri.localdialplan = PRI_UNKNOWN + 1;
<a name="l16625"></a>16625             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;private&quot;</span>)) {
<a name="l16626"></a>16626                confp-&gt;pri.localdialplan = PRI_PRIVATE + 1;
<a name="l16627"></a>16627             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;international&quot;</span>)) {
<a name="l16628"></a>16628                confp-&gt;pri.localdialplan = PRI_INTERNATIONAL_ISDN + 1;
<a name="l16629"></a>16629             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;local&quot;</span>)) {
<a name="l16630"></a>16630                confp-&gt;pri.localdialplan = PRI_LOCAL_ISDN + 1;
<a name="l16631"></a>16631             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;dynamic&quot;</span>)) {
<a name="l16632"></a>16632                confp-&gt;pri.localdialplan = -1;
<a name="l16633"></a>16633             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;redundant&quot;</span>)) {
<a name="l16634"></a>16634                confp-&gt;pri.localdialplan = -2;
<a name="l16635"></a>16635             } <span class="keywordflow">else</span> {
<a name="l16636"></a>16636                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unknown PRI localdialplan &apos;%s&apos; at line %d.\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l16637"></a>16637             }
<a name="l16638"></a>16638          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;switchtype&quot;</span>)) {
<a name="l16639"></a>16639             <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;national&quot;</span>))
<a name="l16640"></a>16640                confp-&gt;pri.switchtype = PRI_SWITCH_NI2;
<a name="l16641"></a>16641             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;ni1&quot;</span>))
<a name="l16642"></a>16642                confp-&gt;pri.switchtype = PRI_SWITCH_NI1;
<a name="l16643"></a>16643             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;dms100&quot;</span>))
<a name="l16644"></a>16644                confp-&gt;pri.switchtype = PRI_SWITCH_DMS100;
<a name="l16645"></a>16645             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;4ess&quot;</span>))
<a name="l16646"></a>16646                confp-&gt;pri.switchtype = PRI_SWITCH_ATT4ESS;
<a name="l16647"></a>16647             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;5ess&quot;</span>))
<a name="l16648"></a>16648                confp-&gt;pri.switchtype = PRI_SWITCH_LUCENT5E;
<a name="l16649"></a>16649             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;euroisdn&quot;</span>))
<a name="l16650"></a>16650                confp-&gt;pri.switchtype = PRI_SWITCH_EUROISDN_E1;
<a name="l16651"></a>16651             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;qsig&quot;</span>))
<a name="l16652"></a>16652                confp-&gt;pri.switchtype = PRI_SWITCH_QSIG;
<a name="l16653"></a>16653             <span class="keywordflow">else</span> {
<a name="l16654"></a>16654                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unknown switchtype &apos;%s&apos; at line %d.\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l16655"></a>16655                <span class="keywordflow">return</span> -1;
<a name="l16656"></a>16656             }
<a name="l16657"></a>16657          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;nsf&quot;</span>)) {
<a name="l16658"></a>16658             <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;sdn&quot;</span>))
<a name="l16659"></a>16659                confp-&gt;pri.nsf = PRI_NSF_SDN;
<a name="l16660"></a>16660             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;megacom&quot;</span>))
<a name="l16661"></a>16661                confp-&gt;pri.nsf = PRI_NSF_MEGACOM;
<a name="l16662"></a>16662             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;tollfreemegacom&quot;</span>))
<a name="l16663"></a>16663                confp-&gt;pri.nsf = PRI_NSF_TOLL_FREE_MEGACOM;
<a name="l16664"></a>16664             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;accunet&quot;</span>))
<a name="l16665"></a>16665                confp-&gt;pri.nsf = PRI_NSF_ACCUNET;
<a name="l16666"></a>16666             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;none&quot;</span>))
<a name="l16667"></a>16667                confp-&gt;pri.nsf = PRI_NSF_NONE;
<a name="l16668"></a>16668             <span class="keywordflow">else</span> {
<a name="l16669"></a>16669                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unknown network-specific facility &apos;%s&apos; at line %d.\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l16670"></a>16670                confp-&gt;pri.nsf = PRI_NSF_NONE;
<a name="l16671"></a>16671             }
<a name="l16672"></a>16672          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;priindication&quot;</span>)) {
<a name="l16673"></a>16673             <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;outofband&quot;</span>))
<a name="l16674"></a>16674                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ab7d3c3f03d40ad5cea4721e94cb64e40" title="TRUE if PRI congestion/busy indications are sent out-of-band.">priindication_oob</a> = 1;
<a name="l16675"></a>16675             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;inband&quot;</span>))
<a name="l16676"></a>16676                confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#ab7d3c3f03d40ad5cea4721e94cb64e40" title="TRUE if PRI congestion/busy indications are sent out-of-band.">priindication_oob</a> = 0;
<a name="l16677"></a>16677             <span class="keywordflow">else</span>
<a name="l16678"></a>16678                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;&apos;%s&apos; is not a valid pri indication value, should be &apos;inband&apos; or &apos;outofband&apos; at line %d.\n&quot;</span>,
<a name="l16679"></a>16679                   v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l16680"></a>16680          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;priexclusive&quot;</span>)) {
<a name="l16681"></a>16681             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a6ae2ff84731ea1e81a24412800030423" title="TRUE if PRI B channels are always exclusively selected.">priexclusive</a> = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16682"></a>16682          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;internationalprefix&quot;</span>)) {
<a name="l16683"></a>16683             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(confp-&gt;pri.internationalprefix, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(confp-&gt;pri.internationalprefix));
<a name="l16684"></a>16684          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;nationalprefix&quot;</span>)) {
<a name="l16685"></a>16685             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(confp-&gt;pri.nationalprefix, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(confp-&gt;pri.nationalprefix));
<a name="l16686"></a>16686          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;localprefix&quot;</span>)) {
<a name="l16687"></a>16687             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(confp-&gt;pri.localprefix, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(confp-&gt;pri.localprefix));
<a name="l16688"></a>16688          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;privateprefix&quot;</span>)) {
<a name="l16689"></a>16689             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(confp-&gt;pri.privateprefix, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(confp-&gt;pri.privateprefix));
<a name="l16690"></a>16690          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;unknownprefix&quot;</span>)) {
<a name="l16691"></a>16691             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(confp-&gt;pri.unknownprefix, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(confp-&gt;pri.unknownprefix));
<a name="l16692"></a>16692          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;resetinterval&quot;</span>)) {
<a name="l16693"></a>16693             <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;never&quot;</span>))
<a name="l16694"></a>16694                confp-&gt;pri.resetinterval = -1;
<a name="l16695"></a>16695             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (atoi(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>) &gt;= 60)
<a name="l16696"></a>16696                confp-&gt;pri.resetinterval = atoi(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16697"></a>16697             <span class="keywordflow">else</span>
<a name="l16698"></a>16698                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;&apos;%s&apos; is not a valid reset interval, should be &gt;= 60 seconds or &apos;never&apos; at line %d.\n&quot;</span>,
<a name="l16699"></a>16699                   v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l16700"></a>16700          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;minunused&quot;</span>)) {
<a name="l16701"></a>16701             confp-&gt;pri.minunused = atoi(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16702"></a>16702          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;minidle&quot;</span>)) {
<a name="l16703"></a>16703             confp-&gt;pri.minidle = atoi(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16704"></a>16704          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;idleext&quot;</span>)) {
<a name="l16705"></a>16705             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(confp-&gt;pri.idleext, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(confp-&gt;pri.idleext));
<a name="l16706"></a>16706          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;idledial&quot;</span>)) {
<a name="l16707"></a>16707             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(confp-&gt;pri.idledial, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(confp-&gt;pri.idledial));
<a name="l16708"></a>16708          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;overlapdial&quot;</span>)) {
<a name="l16709"></a>16709             <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>)) {
<a name="l16710"></a>16710                confp-&gt;pri.overlapdial = <a class="code" href="chan__dahdi_8c.html#a6633b1ced0d29c25cfba81c2349db046">DAHDI_OVERLAPDIAL_BOTH</a>;
<a name="l16711"></a>16711             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;incoming&quot;</span>)) {
<a name="l16712"></a>16712                confp-&gt;pri.overlapdial = <a class="code" href="chan__dahdi_8c.html#ab30dead77fa070cbe51316f43fcea8a2">DAHDI_OVERLAPDIAL_INCOMING</a>;
<a name="l16713"></a>16713             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;outgoing&quot;</span>)) {
<a name="l16714"></a>16714                confp-&gt;pri.overlapdial = <a class="code" href="chan__dahdi_8c.html#a4bccf90ead0cf7c93b177e59cbe5b3be">DAHDI_OVERLAPDIAL_OUTGOING</a>;
<a name="l16715"></a>16715             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;both&quot;</span>) || <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>)) {
<a name="l16716"></a>16716                confp-&gt;pri.overlapdial = <a class="code" href="chan__dahdi_8c.html#a6633b1ced0d29c25cfba81c2349db046">DAHDI_OVERLAPDIAL_BOTH</a>;
<a name="l16717"></a>16717             } <span class="keywordflow">else</span> {
<a name="l16718"></a>16718                confp-&gt;pri.overlapdial = <a class="code" href="chan__dahdi_8c.html#a90cfffbd61222b99c247c74dd67a361a">DAHDI_OVERLAPDIAL_NONE</a>;
<a name="l16719"></a>16719             }
<a name="l16720"></a>16720 <span class="preprocessor">#ifdef HAVE_PRI_PROG_W_CAUSE</span>
<a name="l16721"></a>16721 <span class="preprocessor"></span>         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;qsigchannelmapping&quot;</span>)) {
<a name="l16722"></a>16722             <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;logical&quot;</span>)) {
<a name="l16723"></a>16723                confp-&gt;pri.qsigchannelmapping = <a class="code" href="chan__dahdi_8c.html#aa65ac97c8c851bb8c7e1b80c523670f2">DAHDI_CHAN_MAPPING_LOGICAL</a>;
<a name="l16724"></a>16724             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;physical&quot;</span>)) {
<a name="l16725"></a>16725                confp-&gt;pri.qsigchannelmapping = <a class="code" href="chan__dahdi_8c.html#af23a6a3582578bef25f1062d0dea1fc9">DAHDI_CHAN_MAPPING_PHYSICAL</a>;
<a name="l16726"></a>16726             } <span class="keywordflow">else</span> {
<a name="l16727"></a>16727                confp-&gt;pri.qsigchannelmapping = <a class="code" href="chan__dahdi_8c.html#af23a6a3582578bef25f1062d0dea1fc9">DAHDI_CHAN_MAPPING_PHYSICAL</a>;
<a name="l16728"></a>16728             }
<a name="l16729"></a>16729 <span class="preprocessor">#endif</span>
<a name="l16730"></a>16730 <span class="preprocessor"></span>         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;discardremoteholdretrieval&quot;</span>)) {
<a name="l16731"></a>16731             confp-&gt;pri.discardremoteholdretrieval = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16732"></a>16732 <span class="preprocessor">#ifdef HAVE_PRI_INBANDDISCONNECT</span>
<a name="l16733"></a>16733 <span class="preprocessor"></span>         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;inbanddisconnect&quot;</span>)) {
<a name="l16734"></a>16734             confp-&gt;pri.inbanddisconnect = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16735"></a>16735 <span class="preprocessor">#endif</span>
<a name="l16736"></a>16736 <span class="preprocessor"></span>         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;pritimer&quot;</span>)) {
<a name="l16737"></a>16737 <span class="preprocessor">#ifdef PRI_GETSET_TIMERS</span>
<a name="l16738"></a>16738 <span class="preprocessor"></span>            <span class="keywordtype">char</span> tmp[20];
<a name="l16739"></a>16739             <span class="keywordtype">char</span> *timerc;
<a name="l16740"></a>16740             <span class="keywordtype">char</span> *c;
<a name="l16741"></a>16741             <span class="keywordtype">int</span> <a class="code" href="chan__iax2_8c.html#a9aed6490b63794e6c9c00af4533f255f">timer</a>;
<a name="l16742"></a>16742             <span class="keywordtype">int</span> timeridx;
<a name="l16743"></a>16743 
<a name="l16744"></a>16744             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmp, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(tmp));
<a name="l16745"></a>16745             c = tmp;
<a name="l16746"></a>16746             timerc = <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;c, <span class="stringliteral">&quot;,&quot;</span>);
<a name="l16747"></a>16747             <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(timerc) &amp;&amp; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(c)) {
<a name="l16748"></a>16748                timeridx = pri_timer2idx(timerc);
<a name="l16749"></a>16749                timer = atoi(c);
<a name="l16750"></a>16750                <span class="keywordflow">if</span> (timeridx &lt; 0 || PRI_MAX_TIMERS &lt;= timeridx) {
<a name="l16751"></a>16751                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,
<a name="l16752"></a>16752                      <span class="stringliteral">&quot;&apos;%s&apos; is not a valid ISDN timer at line %d.\n&quot;</span>, timerc,
<a name="l16753"></a>16753                      v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l16754"></a>16754                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!timer) {
<a name="l16755"></a>16755                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,
<a name="l16756"></a>16756                      <span class="stringliteral">&quot;&apos;%s&apos; is not a valid value for ISDN timer &apos;%s&apos; at line %d.\n&quot;</span>,
<a name="l16757"></a>16757                      c, timerc, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l16758"></a>16758                } <span class="keywordflow">else</span> {
<a name="l16759"></a>16759                   pritimers[timeridx] = timer;
<a name="l16760"></a>16760                }
<a name="l16761"></a>16761             } <span class="keywordflow">else</span> {
<a name="l16762"></a>16762                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,
<a name="l16763"></a>16763                   <span class="stringliteral">&quot;&apos;%s&apos; is not a valid ISDN timer configuration string at line %d.\n&quot;</span>,
<a name="l16764"></a>16764                   v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l16765"></a>16765             }
<a name="l16766"></a>16766 
<a name="l16767"></a>16767          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;facilityenable&quot;</span>)) {
<a name="l16768"></a>16768             confp-&gt;pri.facilityenable = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16769"></a>16769 <span class="preprocessor">#endif </span><span class="comment">/* PRI_GETSET_TIMERS */</span>
<a name="l16770"></a>16770 <span class="preprocessor">#endif </span><span class="comment">/* HAVE_PRI */</span>
<a name="l16771"></a>16771 <span class="preprocessor">#ifdef HAVE_SS7</span>
<a name="l16772"></a>16772 <span class="preprocessor"></span>         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;ss7type&quot;</span>)) {
<a name="l16773"></a>16773             <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;itu&quot;</span>)) {
<a name="l16774"></a>16774                cur_ss7type = SS7_ITU;
<a name="l16775"></a>16775             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;ansi&quot;</span>)) {
<a name="l16776"></a>16776                cur_ss7type = SS7_ANSI;
<a name="l16777"></a>16777             } <span class="keywordflow">else</span>
<a name="l16778"></a>16778                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;&apos;%s&apos; is an unknown ss7 switch type at line %d.!\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l16779"></a>16779          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;linkset&quot;</span>)) {
<a name="l16780"></a>16780             cur_linkset = atoi(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16781"></a>16781          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;pointcode&quot;</span>)) {
<a name="l16782"></a>16782             cur_pointcode = parse_pointcode(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16783"></a>16783          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;adjpointcode&quot;</span>)) {
<a name="l16784"></a>16784             cur_adjpointcode = parse_pointcode(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16785"></a>16785          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;defaultdpc&quot;</span>)) {
<a name="l16786"></a>16786             cur_defaultdpc = parse_pointcode(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16787"></a>16787          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;cicbeginswith&quot;</span>)) {
<a name="l16788"></a>16788             cur_cicbeginswith = atoi(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16789"></a>16789          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;networkindicator&quot;</span>)) {
<a name="l16790"></a>16790             <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;national&quot;</span>))
<a name="l16791"></a>16791                cur_networkindicator = SS7_NI_NAT;
<a name="l16792"></a>16792             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;national_spare&quot;</span>))
<a name="l16793"></a>16793                cur_networkindicator = SS7_NI_NAT_SPARE;
<a name="l16794"></a>16794             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;international&quot;</span>))
<a name="l16795"></a>16795                cur_networkindicator = SS7_NI_INT;
<a name="l16796"></a>16796             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;international_spare&quot;</span>))
<a name="l16797"></a>16797                cur_networkindicator = SS7_NI_INT_SPARE;
<a name="l16798"></a>16798             <span class="keywordflow">else</span>
<a name="l16799"></a>16799                cur_networkindicator = -1;
<a name="l16800"></a>16800          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;ss7_internationalprefix&quot;</span>)) {
<a name="l16801"></a>16801             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(confp-&gt;ss7.internationalprefix, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(confp-&gt;ss7.internationalprefix));
<a name="l16802"></a>16802          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;ss7_nationalprefix&quot;</span>)) {
<a name="l16803"></a>16803             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(confp-&gt;ss7.nationalprefix, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(confp-&gt;ss7.nationalprefix));
<a name="l16804"></a>16804          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;ss7_subscriberprefix&quot;</span>)) {
<a name="l16805"></a>16805             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(confp-&gt;ss7.subscriberprefix, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(confp-&gt;ss7.subscriberprefix));
<a name="l16806"></a>16806          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;ss7_unknownprefix&quot;</span>)) {
<a name="l16807"></a>16807             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(confp-&gt;ss7.unknownprefix, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(confp-&gt;ss7.unknownprefix));
<a name="l16808"></a>16808          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;ss7_called_nai&quot;</span>)) {
<a name="l16809"></a>16809             <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;national&quot;</span>)) {
<a name="l16810"></a>16810                confp-&gt;ss7.called_nai = SS7_NAI_NATIONAL;
<a name="l16811"></a>16811             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;international&quot;</span>)) {
<a name="l16812"></a>16812                confp-&gt;ss7.called_nai = SS7_NAI_INTERNATIONAL;
<a name="l16813"></a>16813             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;subscriber&quot;</span>)) {
<a name="l16814"></a>16814                confp-&gt;ss7.called_nai = SS7_NAI_SUBSCRIBER;
<a name="l16815"></a>16815             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;dynamic&quot;</span>)) {
<a name="l16816"></a>16816                confp-&gt;ss7.called_nai = SS7_NAI_DYNAMIC;
<a name="l16817"></a>16817             } <span class="keywordflow">else</span> {
<a name="l16818"></a>16818                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unknown SS7 called_nai &apos;%s&apos; at line %d.\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l16819"></a>16819             }
<a name="l16820"></a>16820          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;ss7_calling_nai&quot;</span>)) {
<a name="l16821"></a>16821             <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;national&quot;</span>)) {
<a name="l16822"></a>16822                confp-&gt;ss7.calling_nai = SS7_NAI_NATIONAL;
<a name="l16823"></a>16823             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;international&quot;</span>)) {
<a name="l16824"></a>16824                confp-&gt;ss7.calling_nai = SS7_NAI_INTERNATIONAL;
<a name="l16825"></a>16825             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;subscriber&quot;</span>)) {
<a name="l16826"></a>16826                confp-&gt;ss7.calling_nai = SS7_NAI_SUBSCRIBER;
<a name="l16827"></a>16827             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;dynamic&quot;</span>)) {
<a name="l16828"></a>16828                confp-&gt;ss7.calling_nai = SS7_NAI_DYNAMIC;
<a name="l16829"></a>16829             } <span class="keywordflow">else</span> {
<a name="l16830"></a>16830                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unknown SS7 calling_nai &apos;%s&apos; at line %d.\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l16831"></a>16831             }
<a name="l16832"></a>16832          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;sigchan&quot;</span>)) {
<a name="l16833"></a>16833             <span class="keywordtype">int</span> sigchan, res;
<a name="l16834"></a>16834             sigchan = atoi(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16835"></a>16835             res = linkset_addsigchan(sigchan);
<a name="l16836"></a>16836             <span class="keywordflow">if</span> (res &lt; 0)
<a name="l16837"></a>16837                <span class="keywordflow">return</span> -1;
<a name="l16838"></a>16838 
<a name="l16839"></a>16839          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;ss7_explicitacm&quot;</span>)) {
<a name="l16840"></a>16840             <span class="keyword">struct </span>dahdi_ss7 *link;
<a name="l16841"></a>16841             link = ss7_resolve_linkset(cur_linkset);
<a name="l16842"></a>16842             <span class="keywordflow">if</span> (!link) {
<a name="l16843"></a>16843                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Invalid linkset number.  Must be between 1 and %d\n&quot;</span>, <a class="code" href="chan__dahdi_8c.html#a80bfdd8adbffe226265cd729655a7268">NUM_SPANS</a> + 1);
<a name="l16844"></a>16844                <span class="keywordflow">return</span> -1;
<a name="l16845"></a>16845             }
<a name="l16846"></a>16846             <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>))
<a name="l16847"></a>16847                link-&gt;flags |= LINKSET_FLAG_EXPLICITACM;
<a name="l16848"></a>16848 <span class="preprocessor">#endif </span><span class="comment">/* HAVE_SS7 */</span>
<a name="l16849"></a>16849 <span class="preprocessor">#ifdef HAVE_OPENR2</span>
<a name="l16850"></a>16850 <span class="preprocessor"></span>         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;mfcr2_advanced_protocol_file&quot;</span>)) {
<a name="l16851"></a>16851             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(confp-&gt;mfcr2.r2proto_file, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(confp-&gt;mfcr2.r2proto_file));
<a name="l16852"></a>16852             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;MFC/R2 Protocol file &apos;%s&apos; will be used, you only should use this if you *REALLY KNOW WHAT YOU ARE DOING*.\n&quot;</span>, confp-&gt;mfcr2.r2proto_file);
<a name="l16853"></a>16853          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;mfcr2_logdir&quot;</span>)) {
<a name="l16854"></a>16854             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(confp-&gt;mfcr2.logdir, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(confp-&gt;mfcr2.logdir));
<a name="l16855"></a>16855          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;mfcr2_variant&quot;</span>)) {
<a name="l16856"></a>16856             confp-&gt;mfcr2.variant = openr2_proto_get_variant(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16857"></a>16857             <span class="keywordflow">if</span> (OR2_VAR_UNKNOWN == confp-&gt;mfcr2.variant) {
<a name="l16858"></a>16858                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unknown MFC/R2 variant &apos;%s&apos; at line %d, defaulting to ITU.\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l16859"></a>16859                confp-&gt;mfcr2.variant = OR2_VAR_ITU;
<a name="l16860"></a>16860             }
<a name="l16861"></a>16861          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;mfcr2_mfback_timeout&quot;</span>)) {
<a name="l16862"></a>16862             confp-&gt;mfcr2.mfback_timeout = atoi(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16863"></a>16863             <span class="keywordflow">if</span> (!confp-&gt;mfcr2.mfback_timeout) {
<a name="l16864"></a>16864                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;MF timeout of 0? hum, I will protect you from your ignorance. Setting default.\n&quot;</span>);
<a name="l16865"></a>16865                confp-&gt;mfcr2.mfback_timeout = -1;
<a name="l16866"></a>16866             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (confp-&gt;mfcr2.mfback_timeout &gt; 0 &amp;&amp; confp-&gt;mfcr2.mfback_timeout &lt; 500) {
<a name="l16867"></a>16867                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;MF timeout less than 500ms is not recommended, you have been warned!\n&quot;</span>);
<a name="l16868"></a>16868             }
<a name="l16869"></a>16869          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;mfcr2_metering_pulse_timeout&quot;</span>)) {
<a name="l16870"></a>16870             confp-&gt;mfcr2.metering_pulse_timeout = atoi(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16871"></a>16871             <span class="keywordflow">if</span> (confp-&gt;mfcr2.metering_pulse_timeout &gt; 500) {
<a name="l16872"></a>16872                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Metering pulse timeout greater than 500ms is not recommended, you have been warned!\n&quot;</span>);
<a name="l16873"></a>16873             }
<a name="l16874"></a>16874          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;mfcr2_get_ani_first&quot;</span>)) {
<a name="l16875"></a>16875             confp-&gt;mfcr2.get_ani_first = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>) ? 1 : 0;
<a name="l16876"></a>16876          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;mfcr2_double_answer&quot;</span>)) {
<a name="l16877"></a>16877             confp-&gt;mfcr2.double_answer = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>) ? 1 : 0;
<a name="l16878"></a>16878          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;mfcr2_charge_calls&quot;</span>)) {
<a name="l16879"></a>16879             confp-&gt;mfcr2.charge_calls = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>) ? 1 : 0;
<a name="l16880"></a>16880          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;mfcr2_accept_on_offer&quot;</span>)) {
<a name="l16881"></a>16881             confp-&gt;mfcr2.accept_on_offer = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>) ? 1 : 0;
<a name="l16882"></a>16882          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;mfcr2_allow_collect_calls&quot;</span>)) {
<a name="l16883"></a>16883             confp-&gt;mfcr2.allow_collect_calls = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>) ? 1 : 0;
<a name="l16884"></a>16884          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;mfcr2_forced_release&quot;</span>)) {
<a name="l16885"></a>16885             confp-&gt;mfcr2.forced_release = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>) ? 1 : 0;
<a name="l16886"></a>16886          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;mfcr2_immediate_accept&quot;</span>)) {
<a name="l16887"></a>16887             confp-&gt;mfcr2.immediate_accept = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>) ? 1 : 0;
<a name="l16888"></a>16888          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;mfcr2_call_files&quot;</span>)) {
<a name="l16889"></a>16889             confp-&gt;mfcr2.call_files = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>) ? 1 : 0;
<a name="l16890"></a>16890          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;mfcr2_max_ani&quot;</span>)) {
<a name="l16891"></a>16891             confp-&gt;mfcr2.max_ani = atoi(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16892"></a>16892             <span class="keywordflow">if</span> (confp-&gt;mfcr2.max_ani &gt;= <a class="code" href="channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a>){
<a name="l16893"></a>16893                confp-&gt;mfcr2.max_ani = <a class="code" href="channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a> - 1;
<a name="l16894"></a>16894             }
<a name="l16895"></a>16895          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;mfcr2_max_dnis&quot;</span>)) {
<a name="l16896"></a>16896             confp-&gt;mfcr2.max_dnis = atoi(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16897"></a>16897             <span class="keywordflow">if</span> (confp-&gt;mfcr2.max_dnis &gt;= <a class="code" href="channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a>){
<a name="l16898"></a>16898                confp-&gt;mfcr2.max_dnis = <a class="code" href="channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a> - 1;
<a name="l16899"></a>16899             }
<a name="l16900"></a>16900          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;mfcr2_category&quot;</span>)) {
<a name="l16901"></a>16901             confp-&gt;mfcr2.category = openr2_proto_get_category(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16902"></a>16902             <span class="keywordflow">if</span> (OR2_CALLING_PARTY_CATEGORY_UNKNOWN == confp-&gt;mfcr2.category) {
<a name="l16903"></a>16903                confp-&gt;mfcr2.category = OR2_CALLING_PARTY_CATEGORY_NATIONAL_SUBSCRIBER;
<a name="l16904"></a>16904                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid MFC/R2 caller category &apos;%s&apos; at line %d. Using national subscriber as default.\n&quot;</span>,
<a name="l16905"></a>16905                      v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l16906"></a>16906             }
<a name="l16907"></a>16907          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;mfcr2_logging&quot;</span>)) {
<a name="l16908"></a>16908             openr2_log_level_t tmplevel;
<a name="l16909"></a>16909             <span class="keywordtype">char</span> *clevel;
<a name="l16910"></a>16910             <span class="keywordtype">char</span> *logval = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l16911"></a>16911             <span class="keywordflow">while</span> (logval) {
<a name="l16912"></a>16912                clevel = <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;logval,<span class="stringliteral">&quot;,&quot;</span>);
<a name="l16913"></a>16913                <span class="keywordflow">if</span> (-1 == (tmplevel = openr2_log_get_level(clevel))) {
<a name="l16914"></a>16914                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Ignoring invalid logging level: &apos;%s&apos; at line %d.\n&quot;</span>, clevel, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l16915"></a>16915                   <span class="keywordflow">continue</span>;
<a name="l16916"></a>16916                }
<a name="l16917"></a>16917                confp-&gt;mfcr2.loglevel |= tmplevel;
<a name="l16918"></a>16918             }
<a name="l16919"></a>16919 <span class="preprocessor">#endif </span><span class="comment">/* HAVE_OPENR2 */</span>
<a name="l16920"></a>16920          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;cadence&quot;</span>)) {
<a name="l16921"></a>16921             <span class="comment">/* setup to scan our argument */</span>
<a name="l16922"></a>16922             <span class="keywordtype">int</span> element_count, c[16] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
<a name="l16923"></a>16923             <span class="keywordtype">int</span> i;
<a name="l16924"></a>16924             <span class="keyword">struct </span>dahdi_ring_cadence new_cadence;
<a name="l16925"></a>16925             <span class="keywordtype">int</span> cid_location = -1;
<a name="l16926"></a>16926             <span class="keywordtype">int</span> firstcadencepos = 0;
<a name="l16927"></a>16927             <span class="keywordtype">char</span> original_args[80];
<a name="l16928"></a>16928             <span class="keywordtype">int</span> cadence_is_ok = 1;
<a name="l16929"></a>16929 
<a name="l16930"></a>16930             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(original_args, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(original_args));
<a name="l16931"></a>16931             <span class="comment">/* 16 cadences allowed (8 pairs) */</span>
<a name="l16932"></a>16932             element_count = sscanf(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;%30d,%30d,%30d,%30d,%30d,%30d,%30d,%30d,%30d,%30d,%30d,%30d,%30d,%30d,%30d,%30d&quot;</span>, &amp;c[0], &amp;c[1], &amp;c[2], &amp;c[3], &amp;c[4], &amp;c[5], &amp;c[6], &amp;c[7], &amp;c[8], &amp;c[9], &amp;c[10], &amp;c[11], &amp;c[12], &amp;c[13], &amp;c[14], &amp;c[15]);
<a name="l16933"></a>16933 
<a name="l16934"></a>16934             <span class="comment">/* Cadence must be even (on/off) */</span>
<a name="l16935"></a>16935             <span class="keywordflow">if</span> (element_count % 2 == 1) {
<a name="l16936"></a>16936                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Must be a silence duration for each ring duration: %s at line %d.\n&quot;</span>, original_args, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l16937"></a>16937                cadence_is_ok = 0;
<a name="l16938"></a>16938             }
<a name="l16939"></a>16939 
<a name="l16940"></a>16940             <span class="comment">/* Ring cadences cannot be negative */</span>
<a name="l16941"></a>16941             <span class="keywordflow">for</span> (i = 0; i &lt; element_count; i++) {
<a name="l16942"></a>16942                <span class="keywordflow">if</span> (c[i] == 0) {
<a name="l16943"></a>16943                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Ring or silence duration cannot be zero: %s at line %d.\n&quot;</span>, original_args, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l16944"></a>16944                   cadence_is_ok = 0;
<a name="l16945"></a>16945                   <span class="keywordflow">break</span>;
<a name="l16946"></a>16946                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c[i] &lt; 0) {
<a name="l16947"></a>16947                   <span class="keywordflow">if</span> (i % 2 == 1) {
<a name="l16948"></a>16948                      <span class="comment">/* Silence duration, negative possibly okay */</span>
<a name="l16949"></a>16949                      <span class="keywordflow">if</span> (cid_location == -1) {
<a name="l16950"></a>16950                         cid_location = i;
<a name="l16951"></a>16951                         c[i] *= -1;
<a name="l16952"></a>16952                      } <span class="keywordflow">else</span> {
<a name="l16953"></a>16953                         <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;CID location specified twice: %s at line %d.\n&quot;</span>, original_args, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l16954"></a>16954                         cadence_is_ok = 0;
<a name="l16955"></a>16955                         <span class="keywordflow">break</span>;
<a name="l16956"></a>16956                      }
<a name="l16957"></a>16957                   } <span class="keywordflow">else</span> {
<a name="l16958"></a>16958                      <span class="keywordflow">if</span> (firstcadencepos == 0) {
<a name="l16959"></a>16959                         firstcadencepos = i; <span class="comment">/* only recorded to avoid duplicate specification */</span>
<a name="l16960"></a>16960                                  <span class="comment">/* duration will be passed negative to the DAHDI driver */</span>
<a name="l16961"></a>16961                      } <span class="keywordflow">else</span> {
<a name="l16962"></a>16962                          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;First cadence position specified twice: %s at line %d.\n&quot;</span>, original_args, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l16963"></a>16963                         cadence_is_ok = 0;
<a name="l16964"></a>16964                         <span class="keywordflow">break</span>;
<a name="l16965"></a>16965                      }
<a name="l16966"></a>16966                   }
<a name="l16967"></a>16967                }
<a name="l16968"></a>16968             }
<a name="l16969"></a>16969 
<a name="l16970"></a>16970             <span class="comment">/* Substitute our scanned cadence */</span>
<a name="l16971"></a>16971             <span class="keywordflow">for</span> (i = 0; i &lt; 16; i++) {
<a name="l16972"></a>16972                new_cadence.ringcadence[i] = c[i];
<a name="l16973"></a>16973             }
<a name="l16974"></a>16974 
<a name="l16975"></a>16975             <span class="keywordflow">if</span> (cadence_is_ok) {
<a name="l16976"></a>16976                <span class="comment">/* ---we scanned it without getting annoyed; now some sanity checks--- */</span>
<a name="l16977"></a>16977                <span class="keywordflow">if</span> (element_count &lt; 2) {
<a name="l16978"></a>16978                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Minimum cadence is ring,pause: %s at line %d.\n&quot;</span>, original_args, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l16979"></a>16979                } <span class="keywordflow">else</span> {
<a name="l16980"></a>16980                   <span class="keywordflow">if</span> (cid_location == -1) {
<a name="l16981"></a>16981                      <span class="comment">/* user didn&apos;t say; default to first pause */</span>
<a name="l16982"></a>16982                      cid_location = 1;
<a name="l16983"></a>16983                   } <span class="keywordflow">else</span> {
<a name="l16984"></a>16984                      <span class="comment">/* convert element_index to cidrings value */</span>
<a name="l16985"></a>16985                      cid_location = (cid_location + 1) / 2;
<a name="l16986"></a>16986                   }
<a name="l16987"></a>16987                   <span class="comment">/* ---we like their cadence; try to install it--- */</span>
<a name="l16988"></a>16988                   <span class="keywordflow">if</span> (!<a class="code" href="chan__dahdi_8c.html#a5143feca9ab414072f121c6b07619bdd">user_has_defined_cadences</a>++)
<a name="l16989"></a>16989                      <span class="comment">/* this is the first user-defined cadence; clear the default user cadences */</span>
<a name="l16990"></a>16990                      <a class="code" href="chan__dahdi_8c.html#ad53fcc6c04d1c32732efa069a128136b">num_cadence</a> = 0;
<a name="l16991"></a>16991                   <span class="keywordflow">if</span> ((<a class="code" href="chan__dahdi_8c.html#ad53fcc6c04d1c32732efa069a128136b">num_cadence</a>+1) &gt;= <a class="code" href="chan__dahdi_8c.html#afa0bff4fd3f279871e101c0158c5a81a">NUM_CADENCE_MAX</a>)
<a name="l16992"></a>16992                      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Already %d cadences; can&apos;t add another: %s at line %d.\n&quot;</span>, <a class="code" href="chan__dahdi_8c.html#afa0bff4fd3f279871e101c0158c5a81a">NUM_CADENCE_MAX</a>, original_args, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l16993"></a>16993                   <span class="keywordflow">else</span> {
<a name="l16994"></a>16994                      <a class="code" href="chan__dahdi_8c.html#ad07d646abd9d3f187412ff33dc665aee">cadences</a>[<a class="code" href="chan__dahdi_8c.html#ad53fcc6c04d1c32732efa069a128136b">num_cadence</a>] = new_cadence;
<a name="l16995"></a>16995                      <a class="code" href="chan__dahdi_8c.html#a441c14817877dfc3ae49ff3aa2907400" title="cidrings says in which pause to transmit the cid information, where the first pause...">cidrings</a>[<a class="code" href="chan__dahdi_8c.html#ad53fcc6c04d1c32732efa069a128136b">num_cadence</a>++] = cid_location;
<a name="l16996"></a>16996                      <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;cadence &apos;r%d&apos; added: %s\n&quot;</span>,<a class="code" href="chan__dahdi_8c.html#ad53fcc6c04d1c32732efa069a128136b">num_cadence</a>,original_args);
<a name="l16997"></a>16997                   }
<a name="l16998"></a>16998                }
<a name="l16999"></a>16999             }
<a name="l17000"></a>17000          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;ringtimeout&quot;</span>)) {
<a name="l17001"></a>17001             <a class="code" href="chan__dahdi_8c.html#aadc5d8714afe5d456c8f17db3abf7f20" title="Configured ring timeout base.">ringt_base</a> = (atoi(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>) * 8) / <a class="code" href="chan__dahdi_8c.html#a86e1969b50e55e5d506233078ca0fa4c">READ_SIZE</a>;
<a name="l17002"></a>17002          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;prewink&quot;</span>)) {
<a name="l17003"></a>17003             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a40775f53eef5801fc139a021dc8ca589">timing</a>.prewinktime = atoi(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l17004"></a>17004          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;preflash&quot;</span>)) {
<a name="l17005"></a>17005             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a40775f53eef5801fc139a021dc8ca589">timing</a>.preflashtime = atoi(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l17006"></a>17006          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;wink&quot;</span>)) {
<a name="l17007"></a>17007             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a40775f53eef5801fc139a021dc8ca589">timing</a>.winktime = atoi(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l17008"></a>17008          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;flash&quot;</span>)) {
<a name="l17009"></a>17009             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a40775f53eef5801fc139a021dc8ca589">timing</a>.flashtime = atoi(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l17010"></a>17010          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;start&quot;</span>)) {
<a name="l17011"></a>17011             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a40775f53eef5801fc139a021dc8ca589">timing</a>.starttime = atoi(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l17012"></a>17012          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;rxwink&quot;</span>)) {
<a name="l17013"></a>17013             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a40775f53eef5801fc139a021dc8ca589">timing</a>.rxwinktime = atoi(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l17014"></a>17014          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;rxflash&quot;</span>)) {
<a name="l17015"></a>17015             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a40775f53eef5801fc139a021dc8ca589">timing</a>.rxflashtime = atoi(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l17016"></a>17016          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;debounce&quot;</span>)) {
<a name="l17017"></a>17017             confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a40775f53eef5801fc139a021dc8ca589">timing</a>.debouncetime = atoi(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l17018"></a>17018          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;toneduration&quot;</span>)) {
<a name="l17019"></a>17019             <span class="keywordtype">int</span> toneduration;
<a name="l17020"></a>17020             <span class="keywordtype">int</span> ctlfd;
<a name="l17021"></a>17021             <span class="keywordtype">int</span> res;
<a name="l17022"></a>17022             <span class="keyword">struct </span>dahdi_dialparams dps;
<a name="l17023"></a>17023 
<a name="l17024"></a>17024             ctlfd = open(<span class="stringliteral">&quot;/dev/dahdi/ctl&quot;</span>, O_RDWR);
<a name="l17025"></a>17025             <span class="keywordflow">if</span> (ctlfd == -1) {
<a name="l17026"></a>17026                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to open /dev/dahdi/ctl to set toneduration at line %d.\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l17027"></a>17027                <span class="keywordflow">return</span> -1;
<a name="l17028"></a>17028             }
<a name="l17029"></a>17029 
<a name="l17030"></a>17030             toneduration = atoi(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l17031"></a>17031             <span class="keywordflow">if</span> (toneduration &gt; -1) {
<a name="l17032"></a>17032                memset(&amp;dps, 0, <span class="keyword">sizeof</span>(dps));
<a name="l17033"></a>17033 
<a name="l17034"></a>17034                dps.dtmf_tonelen = dps.mfv1_tonelen = toneduration;
<a name="l17035"></a>17035                res = ioctl(ctlfd, DAHDI_SET_DIALPARAMS, &amp;dps);
<a name="l17036"></a>17036                <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l17037"></a>17037                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Invalid tone duration: %d ms at line %d: %s\n&quot;</span>, toneduration, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>, strerror(errno));
<a name="l17038"></a>17038                   <span class="keywordflow">return</span> -1;
<a name="l17039"></a>17039                }
<a name="l17040"></a>17040             }
<a name="l17041"></a>17041             close(ctlfd);
<a name="l17042"></a>17042          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;defaultcic&quot;</span>)) {
<a name="l17043"></a>17043             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="chan__dahdi_8c.html#a9ddac9567291bb4eb61b3989fae45780">defaultcic</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(<a class="code" href="chan__dahdi_8c.html#a9ddac9567291bb4eb61b3989fae45780">defaultcic</a>));
<a name="l17044"></a>17044          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;defaultozz&quot;</span>)) {
<a name="l17045"></a>17045             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="chan__dahdi_8c.html#ad7f989de9c9e4e717bf8991708c9814d">defaultozz</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(<a class="code" href="chan__dahdi_8c.html#ad7f989de9c9e4e717bf8991708c9814d">defaultozz</a>));
<a name="l17046"></a>17046          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;mwilevel&quot;</span>)) {
<a name="l17047"></a>17047             <a class="code" href="chan__dahdi_8c.html#a94ca20b7d80fbc4e7d2b1ea50e937243">mwilevel</a> = atoi(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l17048"></a>17048          }
<a name="l17049"></a>17049       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!(options &amp; <a class="code" href="chan__dahdi_8c.html#ac0fd63b3569161611cb73dcd4af16570">PROC_DAHDI_OPT_NOWARN</a>) )
<a name="l17050"></a>17050          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Ignoring any changes to &apos;%s&apos; (on reload) at line %d.\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l17051"></a>17051    }
<a name="l17052"></a>17052    <span class="keywordflow">if</span> (dahdichan[0]) {
<a name="l17053"></a>17053       <span class="comment">/* The user has set &apos;dahdichan&apos; */</span>
<a name="l17054"></a>17054       <span class="comment">/*&lt; \todo pass proper line number instead of 0 */</span>
<a name="l17055"></a>17055       <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#a00c626d9ce33144ed09b620b14afe56d">build_channels</a>(confp, 0, dahdichan, <a class="code" href="chan__dahdi_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a>, 0, &amp;found_pseudo)) {
<a name="l17056"></a>17056          <span class="keywordflow">return</span> -1;
<a name="l17057"></a>17057       }
<a name="l17058"></a>17058    }
<a name="l17059"></a>17059    <span class="comment">/*&lt; \todo why check for the pseudo in the per-channel section.</span>
<a name="l17060"></a>17060 <span class="comment">    * Any actual use for manual setup of the pseudo channel? */</span>
<a name="l17061"></a>17061    <span class="keywordflow">if</span> (!found_pseudo &amp;&amp; <a class="code" href="chan__dahdi_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a> != 1) {
<a name="l17062"></a>17062       <span class="comment">/* use the default configuration for a channel, so</span>
<a name="l17063"></a>17063 <span class="comment">         that any settings from real configured channels</span>
<a name="l17064"></a>17064 <span class="comment">         don&apos;t &quot;leak&quot; into the pseudo channel config</span>
<a name="l17065"></a>17065 <span class="comment">      */</span>
<a name="l17066"></a>17066       <span class="keyword">struct </span><a class="code" href="structdahdi__chan__conf.html" title="Channel configuration from chan_dahdi.conf . This struct is used for parsing the...">dahdi_chan_conf</a> conf = <a class="code" href="chan__dahdi_8c.html#aa9cd3a63b87d28e1862e023bfd8a9cbb">dahdi_chan_conf_default</a>();
<a name="l17067"></a>17067 
<a name="l17068"></a>17068       tmp = <a class="code" href="chan__dahdi_8c.html#aa7f4f5b8e2e3a682de5734874521d060">mkintf</a>(<a class="code" href="chan__dahdi_8c.html#ada02a3fa3d2da06560df664c7228a559">CHAN_PSEUDO</a>, &amp;conf, NULL, <a class="code" href="chan__dahdi_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a>);
<a name="l17069"></a>17069 
<a name="l17070"></a>17070       <span class="keywordflow">if</span> (tmp) {
<a name="l17071"></a>17071          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Automatically generated pseudo channel\n&quot;</span>);
<a name="l17072"></a>17072       } <span class="keywordflow">else</span> {
<a name="l17073"></a>17073          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to register pseudo channel!\n&quot;</span>);
<a name="l17074"></a>17074       }
<a name="l17075"></a>17075    }
<a name="l17076"></a>17076    <span class="keywordflow">return</span> 0;
<a name="l17077"></a>17077 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa1169f419df0c4b3f0b71deaf0506ec1"></a><!-- doxytag: member="chan_dahdi.c::process_echocancel" ref="aa1169f419df0c4b3f0b71deaf0506ec1" args="(struct dahdi_chan_conf *confp, const char *data, unsigned int line)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void process_echocancel </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__chan__conf.html">dahdi_chan_conf</a> *&nbsp;</td>
          <td class="paramname"> <em>confp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>line</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l16040">16040</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="app_8h_source.html#l00423">ast_app_separate_args</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="utils_8c_source.html#l01311">ast_true()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01243">dahdi_chan_conf::chan</a>, <a class="el" href="structdahdi__pvt.html#a12f1128b223526997d1601ee6e33325d">dahdi_pvt::echocancel</a>, <a class="el" href="chan__dahdi_8c_source.html#l01075">dahdi_pvt::head</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="cdr__adaptive__odbc_8c_source.html#l00053">name</a>, and <a class="el" href="chan__dahdi_8c_source.html#l01076">dahdi_pvt::params</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l16041"></a>16041 {
<a name="l16042"></a>16042    <span class="keywordtype">char</span> *<a class="code" href="chan__mgcp_8c.html#a2e006acff60d9b3d65d7d60f975d6747">parse</a> = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(data);
<a name="l16043"></a>16043    <span class="keywordtype">char</span> *params[DAHDI_MAX_ECHOCANPARAMS + 1];
<a name="l16044"></a>16044    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> param_count;
<a name="l16045"></a>16045    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x;
<a name="l16046"></a>16046 
<a name="l16047"></a>16047    <span class="keywordflow">if</span> (!(param_count = <a class="code" href="app_8h.html#a588ed7395623b8493efcf229024af9c5">ast_app_separate_args</a>(parse, <span class="charliteral">&apos;,&apos;</span>, params, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(params))))
<a name="l16048"></a>16048       <span class="keywordflow">return</span>;
<a name="l16049"></a>16049 
<a name="l16050"></a>16050    memset(&amp;confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a12f1128b223526997d1601ee6e33325d" title="Echo cancel parameters.">echocancel</a>, 0, <span class="keyword">sizeof</span>(confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a12f1128b223526997d1601ee6e33325d" title="Echo cancel parameters.">echocancel</a>));
<a name="l16051"></a>16051 
<a name="l16052"></a>16052    <span class="comment">/* first parameter is tap length, process it here */</span>
<a name="l16053"></a>16053 
<a name="l16054"></a>16054    x = <a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(params[0]) ? 0 : atoi(params[0]);
<a name="l16055"></a>16055 
<a name="l16056"></a>16056    <span class="keywordflow">if</span> ((x == 32) || (x == 64) || (x == 128) || (x == 256) || (x == 512) || (x == 1024))
<a name="l16057"></a>16057       confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a12f1128b223526997d1601ee6e33325d" title="Echo cancel parameters.">echocancel</a>.<a class="code" href="structdahdi__pvt.html#ad4baed46a5922e2eecd2876f455dc726">head</a>.tap_length = x;
<a name="l16058"></a>16058    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a12f1128b223526997d1601ee6e33325d" title="Echo cancel parameters.">echocancel</a>.<a class="code" href="structdahdi__pvt.html#ad4baed46a5922e2eecd2876f455dc726">head</a>.tap_length = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(params[0])))
<a name="l16059"></a>16059       confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a12f1128b223526997d1601ee6e33325d" title="Echo cancel parameters.">echocancel</a>.<a class="code" href="structdahdi__pvt.html#ad4baed46a5922e2eecd2876f455dc726">head</a>.tap_length = 128;
<a name="l16060"></a>16060 
<a name="l16061"></a>16061    <span class="comment">/* now process any remaining parameters */</span>
<a name="l16062"></a>16062 
<a name="l16063"></a>16063    <span class="keywordflow">for</span> (x = 1; x &lt; param_count; x++) {
<a name="l16064"></a>16064       <span class="keyword">struct </span>{
<a name="l16065"></a>16065          <span class="keywordtype">char</span> *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>;
<a name="l16066"></a>16066          <span class="keywordtype">char</span> *value;
<a name="l16067"></a>16067       } param;
<a name="l16068"></a>16068 
<a name="l16069"></a>16069       <span class="keywordflow">if</span> (<a class="code" href="app_8h.html#a588ed7395623b8493efcf229024af9c5">ast_app_separate_args</a>(params[x], <span class="charliteral">&apos;=&apos;</span>, (<span class="keywordtype">char</span> **) &amp;param, 2) &lt; 1) {
<a name="l16070"></a>16070          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid echocancel parameter supplied at line %d: &apos;%s&apos;\n&quot;</span>, line, params[x]);
<a name="l16071"></a>16071          <span class="keywordflow">continue</span>;
<a name="l16072"></a>16072       }
<a name="l16073"></a>16073 
<a name="l16074"></a>16074       <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(param.name) || (strlen(param.name) &gt; <span class="keyword">sizeof</span>(confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a12f1128b223526997d1601ee6e33325d" title="Echo cancel parameters.">echocancel</a>.<a class="code" href="structdahdi__pvt.html#a8e87da14ae6e04958083ea33979d78dc">params</a>[0].name)-1)) {
<a name="l16075"></a>16075          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid echocancel parameter supplied at line %d: &apos;%s&apos;\n&quot;</span>, line, param.name);
<a name="l16076"></a>16076          <span class="keywordflow">continue</span>;
<a name="l16077"></a>16077       }
<a name="l16078"></a>16078 
<a name="l16079"></a>16079       strcpy(confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a12f1128b223526997d1601ee6e33325d" title="Echo cancel parameters.">echocancel</a>.<a class="code" href="structdahdi__pvt.html#a8e87da14ae6e04958083ea33979d78dc">params</a>[confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a12f1128b223526997d1601ee6e33325d" title="Echo cancel parameters.">echocancel</a>.<a class="code" href="structdahdi__pvt.html#ad4baed46a5922e2eecd2876f455dc726">head</a>.param_count].name, param.name);
<a name="l16080"></a>16080 
<a name="l16081"></a>16081       <span class="keywordflow">if</span> (param.value) {
<a name="l16082"></a>16082          <span class="keywordflow">if</span> (sscanf(param.value, <span class="stringliteral">&quot;%30d&quot;</span>, &amp;confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a12f1128b223526997d1601ee6e33325d" title="Echo cancel parameters.">echocancel</a>.<a class="code" href="structdahdi__pvt.html#a8e87da14ae6e04958083ea33979d78dc">params</a>[confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a12f1128b223526997d1601ee6e33325d" title="Echo cancel parameters.">echocancel</a>.<a class="code" href="structdahdi__pvt.html#ad4baed46a5922e2eecd2876f455dc726">head</a>.param_count].value) != 1) {
<a name="l16083"></a>16083             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid echocancel parameter value supplied at line %d: &apos;%s&apos;\n&quot;</span>, line, param.value);
<a name="l16084"></a>16084             <span class="keywordflow">continue</span>;
<a name="l16085"></a>16085          }
<a name="l16086"></a>16086       }
<a name="l16087"></a>16087       confp-&gt;<a class="code" href="structdahdi__chan__conf.html#a8fa75bf121cc1d24ec15c38c71e92fce">chan</a>.<a class="code" href="structdahdi__pvt.html#a12f1128b223526997d1601ee6e33325d" title="Echo cancel parameters.">echocancel</a>.<a class="code" href="structdahdi__pvt.html#ad4baed46a5922e2eecd2876f455dc726">head</a>.param_count++;
<a name="l16088"></a>16088    }
<a name="l16089"></a>16089 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad1982509765f4870f1f63412a53ea668"></a><!-- doxytag: member="chan_dahdi.c::reload" ref="ad1982509765f4870f1f63412a53ea668" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int reload </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l17480">17480</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, and <a class="el" href="chan__dahdi_8c_source.html#l17079">setup_dahdi()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l17481"></a>17481 {
<a name="l17482"></a>17482    <span class="keywordtype">int</span> res = 0;
<a name="l17483"></a>17483 
<a name="l17484"></a>17484    res = <a class="code" href="chan__dahdi_8c.html#a90c93221b85857ca4af2b1097d267603">setup_dahdi</a>(1);
<a name="l17485"></a>17485    <span class="keywordflow">if</span> (res) {
<a name="l17486"></a>17486       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Reload of chan_dahdi.so is unsuccessful!\n&quot;</span>);
<a name="l17487"></a>17487       <span class="keywordflow">return</span> -1;
<a name="l17488"></a>17488    }
<a name="l17489"></a>17489    <span class="keywordflow">return</span> 0;
<a name="l17490"></a>17490 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1938310c1b6ab72fec5619a2ed69c92d"></a><!-- doxytag: member="chan_dahdi.c::reset_conf" ref="a1938310c1b6ab72fec5619a2ed69c92d" args="(struct dahdi_pvt *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int reset_conf </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l02590">2590</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="chan__dahdi_8c_source.html#l01023">dahdi_pvt::confno</a>, <a class="el" href="chan__dahdi_8c_source.html#l00622">dahdi_subchannel::curconf</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l04313">dahdi_hangup()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02591"></a>02591 {
<a name="l02592"></a>02592    p-&gt;<a class="code" href="structdahdi__pvt.html#aa9d25d217a303c512db5f8bd7fabd587">confno</a> = -1;
<a name="l02593"></a>02593    memset(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#ac50efd693f9db4d9cc6d1e1287791824">curconf</a>, 0, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#ac50efd693f9db4d9cc6d1e1287791824">curconf</a>));
<a name="l02594"></a>02594    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a> &gt; -1) {
<a name="l02595"></a>02595       <span class="keyword">struct </span>dahdi_confinfo zi;
<a name="l02596"></a>02596 
<a name="l02597"></a>02597       memset(&amp;zi, 0, <span class="keyword">sizeof</span>(zi));
<a name="l02598"></a>02598       <span class="keywordflow">if</span> (ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_SETCONF, &amp;zi))
<a name="l02599"></a>02599          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to reset conferencing on channel %d: %s\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, strerror(errno));
<a name="l02600"></a>02600    }
<a name="l02601"></a>02601    <span class="keywordflow">return</span> 0;
<a name="l02602"></a>02602 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a83af94bb19a421cb25ca02d16fa5ba9c"></a><!-- doxytag: member="chan_dahdi.c::restart_monitor" ref="a83af94bb19a421cb25ca02d16fa5ba9c" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int restart_monitor </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l09705">9705</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="utils_8h_source.html#l00384">ast_pthread_create_background</a>, <a class="el" href="lock_8h_source.html#l00082">AST_PTHREADT_NULL</a>, <a class="el" href="lock_8h_source.html#l00083">AST_PTHREADT_STOP</a>, <a class="el" href="chan__dahdi_8c_source.html#l09496">do_monitor()</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, and <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l04313">dahdi_hangup()</a>, <a class="el" href="chan__dahdi_8c_source.html#l10834">dahdi_request()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l17079">setup_dahdi()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09706"></a>09706 {
<a name="l09707"></a>09707    <span class="comment">/* If we&apos;re supposed to be stopped -- stay stopped */</span>
<a name="l09708"></a>09708    <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#afbd6fc6e0ab3c1a04a518f19c21d4503" title="This is the thread for the monitor which checks for input on the channels which are...">monitor_thread</a> == <a class="code" href="lock_8h.html#a873a83eb8196323194aac2bea23d794e">AST_PTHREADT_STOP</a>)
<a name="l09709"></a>09709       <span class="keywordflow">return</span> 0;
<a name="l09710"></a>09710    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;monlock);
<a name="l09711"></a>09711    <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#afbd6fc6e0ab3c1a04a518f19c21d4503" title="This is the thread for the monitor which checks for input on the channels which are...">monitor_thread</a> == pthread_self()) {
<a name="l09712"></a>09712       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;monlock);
<a name="l09713"></a>09713       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Cannot kill myself\n&quot;</span>);
<a name="l09714"></a>09714       <span class="keywordflow">return</span> -1;
<a name="l09715"></a>09715    }
<a name="l09716"></a>09716    <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#afbd6fc6e0ab3c1a04a518f19c21d4503" title="This is the thread for the monitor which checks for input on the channels which are...">monitor_thread</a> != <a class="code" href="lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>) {
<a name="l09717"></a>09717       <span class="comment">/* Wake up the thread */</span>
<a name="l09718"></a>09718       pthread_kill(<a class="code" href="chan__dahdi_8c.html#afbd6fc6e0ab3c1a04a518f19c21d4503" title="This is the thread for the monitor which checks for input on the channels which are...">monitor_thread</a>, SIGURG);
<a name="l09719"></a>09719    } <span class="keywordflow">else</span> {
<a name="l09720"></a>09720       <span class="comment">/* Start a new monitor */</span>
<a name="l09721"></a>09721       <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a595e2f8aa398f4bd21e381c3211235fe">ast_pthread_create_background</a>(&amp;<a class="code" href="chan__dahdi_8c.html#afbd6fc6e0ab3c1a04a518f19c21d4503" title="This is the thread for the monitor which checks for input on the channels which are...">monitor_thread</a>, NULL, <a class="code" href="chan__dahdi_8c.html#a02d8db6086b4a18353b82ebcad631ff6">do_monitor</a>, NULL) &lt; 0) {
<a name="l09722"></a>09722          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;monlock);
<a name="l09723"></a>09723          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to start monitor thread.\n&quot;</span>);
<a name="l09724"></a>09724          <span class="keywordflow">return</span> -1;
<a name="l09725"></a>09725       }
<a name="l09726"></a>09726    }
<a name="l09727"></a>09727    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;monlock);
<a name="l09728"></a>09728    <span class="keywordflow">return</span> 0;
<a name="l09729"></a>09729 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a128443b4d6aa50b91bcd4668d582095f"></a><!-- doxytag: member="chan_dahdi.c::restore_conference" ref="a128443b4d6aa50b91bcd4668d582095f" args="(struct dahdi_pvt *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int restore_conference </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l02969">2969</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__dahdi_8c_source.html#l00655">dahdi_pvt::saveconf</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l06717">dahdi_read()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l03026">send_callerid()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02970"></a>02970 {
<a name="l02971"></a>02971    <span class="keywordtype">int</span> res;
<a name="l02972"></a>02972    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a66d56f1651cd597660ec33bc653e3ffd">saveconf</a>.confmode) {
<a name="l02973"></a>02973       res = ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_SETCONF, &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a66d56f1651cd597660ec33bc653e3ffd">saveconf</a>);
<a name="l02974"></a>02974       p-&gt;<a class="code" href="structdahdi__pvt.html#a66d56f1651cd597660ec33bc653e3ffd">saveconf</a>.confmode = 0;
<a name="l02975"></a>02975       <span class="keywordflow">if</span> (res) {
<a name="l02976"></a>02976          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to restore conference info: %s\n&quot;</span>, strerror(errno));
<a name="l02977"></a>02977          <span class="keywordflow">return</span> -1;
<a name="l02978"></a>02978       }
<a name="l02979"></a>02979    }
<a name="l02980"></a>02980    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Restored conferencing\n&quot;</span>);
<a name="l02981"></a>02981    <span class="keywordflow">return</span> 0;
<a name="l02982"></a>02982 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0ac913fed804e8326af276cfa450ed03"></a><!-- doxytag: member="chan_dahdi.c::restore_gains" ref="a0ac913fed804e8326af276cfa450ed03" args="(struct dahdi_pvt *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int restore_gains </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l02850">2850</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="chan__dahdi_8c_source.html#l01022">dahdi_pvt::law</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__dahdi_8c_source.html#l00678">dahdi_pvt::rxgain</a>, <a class="el" href="chan__dahdi_8c_source.html#l02831">set_actual_gain()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00680">dahdi_pvt::txgain</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l04313">dahdi_hangup()</a>, <a class="el" href="chan__dahdi_8c_source.html#l08925">mwi_thread()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02851"></a>02851 {
<a name="l02852"></a>02852    <span class="keywordtype">int</span> res;
<a name="l02853"></a>02853 
<a name="l02854"></a>02854    res = <a class="code" href="chan__dahdi_8c.html#a6abcbfc59e4d42646f31142d7dd2b830">set_actual_gain</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, 0, p-&gt;<a class="code" href="structdahdi__pvt.html#aeebb464c72892c9f3ddafed5ade720ee" title="Rx gain set by chan_dahdi.conf.">rxgain</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#ad291967734f3b7bee3ec179278a1f76f" title="Tx gain set by chan_dahdi.conf.">txgain</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#a17dd7b17c0e736754e01e575ca8d8cb8" title="Active PCM encoding format: DAHDI_LAW_ALAW or DAHDI_LAW_MULAW.">law</a>);
<a name="l02855"></a>02855    <span class="keywordflow">if</span> (res) {
<a name="l02856"></a>02856       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to restore gains: %s\n&quot;</span>, strerror(errno));
<a name="l02857"></a>02857       <span class="keywordflow">return</span> -1;
<a name="l02858"></a>02858    }
<a name="l02859"></a>02859 
<a name="l02860"></a>02860    <span class="keywordflow">return</span> 0;
<a name="l02861"></a>02861 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a756c4e1d2909416c454b6e63d28f1db1"></a><!-- doxytag: member="chan_dahdi.c::save_conference" ref="a756c4e1d2909416c454b6e63d28f1db1" args="(struct dahdi_pvt *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int save_conference </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l02896">2896</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__dahdi_8c_source.html#l00655">dahdi_pvt::saveconf</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l03059">dahdi_callwait()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02897"></a>02897 {
<a name="l02898"></a>02898    <span class="keyword">struct </span>dahdi_confinfo c;
<a name="l02899"></a>02899    <span class="keywordtype">int</span> res;
<a name="l02900"></a>02900    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a66d56f1651cd597660ec33bc653e3ffd">saveconf</a>.confmode) {
<a name="l02901"></a>02901       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Can&apos;t save conference -- already in use\n&quot;</span>);
<a name="l02902"></a>02902       <span class="keywordflow">return</span> -1;
<a name="l02903"></a>02903    }
<a name="l02904"></a>02904    p-&gt;<a class="code" href="structdahdi__pvt.html#a66d56f1651cd597660ec33bc653e3ffd">saveconf</a>.chan = 0;
<a name="l02905"></a>02905    res = ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_GETCONF, &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a66d56f1651cd597660ec33bc653e3ffd">saveconf</a>);
<a name="l02906"></a>02906    <span class="keywordflow">if</span> (res) {
<a name="l02907"></a>02907       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to get conference info: %s\n&quot;</span>, strerror(errno));
<a name="l02908"></a>02908       p-&gt;<a class="code" href="structdahdi__pvt.html#a66d56f1651cd597660ec33bc653e3ffd">saveconf</a>.confmode = 0;
<a name="l02909"></a>02909       <span class="keywordflow">return</span> -1;
<a name="l02910"></a>02910    }
<a name="l02911"></a>02911    memset(&amp;c, 0, <span class="keyword">sizeof</span>(c));
<a name="l02912"></a>02912    c.confmode = DAHDI_CONF_NORMAL;
<a name="l02913"></a>02913    res = ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_SETCONF, &amp;c);
<a name="l02914"></a>02914    <span class="keywordflow">if</span> (res) {
<a name="l02915"></a>02915       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to set conference info: %s\n&quot;</span>, strerror(errno));
<a name="l02916"></a>02916       <span class="keywordflow">return</span> -1;
<a name="l02917"></a>02917    }
<a name="l02918"></a>02918    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Disabled conferencing\n&quot;</span>);
<a name="l02919"></a>02919    <span class="keywordflow">return</span> 0;
<a name="l02920"></a>02920 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae39659603ab09eecffce6638832c5b73"></a><!-- doxytag: member="chan_dahdi.c::send_callerid" ref="ae39659603ab09eecffce6638832c5b73" args="(struct dahdi_pvt *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int send_callerid </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l03026">3026</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01070">dahdi_pvt::callwaitcas</a>, <a class="el" href="chan__dahdi_8c_source.html#l00404">CIDCW_EXPIRE_SAMPLES</a>, <a class="el" href="chan__dahdi_8c_source.html#l01048">dahdi_pvt::cidcwexpire</a>, <a class="el" href="chan__dahdi_8c_source.html#l01054">dahdi_pvt::cidlen</a>, <a class="el" href="chan__dahdi_8c_source.html#l01052">dahdi_pvt::cidpos</a>, <a class="el" href="chan__dahdi_8c_source.html#l01050">dahdi_pvt::cidspill</a>, <a class="el" href="chan__dahdi_8c_source.html#l02165">dahdi_setlinear()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="chan__dahdi_8c_source.html#l00620">dahdi_subchannel::linear</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__dahdi_8c_source.html#l02969">restore_conference()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l03101">dahdi_call()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03059">dahdi_callwait()</a>, <a class="el" href="chan__dahdi_8c_source.html#l06717">dahdi_read()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l02986">send_cwcidspill()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03027"></a>03027 {
<a name="l03028"></a>03028    <span class="comment">/* Assumes spill in p-&gt;cidspill, p-&gt;cidlen in length and we&apos;re p-&gt;cidpos into it */</span>
<a name="l03029"></a>03029    <span class="keywordtype">int</span> res;
<a name="l03030"></a>03030    <span class="comment">/* Take out of linear mode if necessary */</span>
<a name="l03031"></a>03031    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a2de30c0a559b0df57ba137153a1370ea">linear</a>) {
<a name="l03032"></a>03032       p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a2de30c0a559b0df57ba137153a1370ea">linear</a> = 0;
<a name="l03033"></a>03033       <a class="code" href="chan__dahdi_8c.html#a8392b32cf7d3daa7b45154b7001460df">dahdi_setlinear</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, 0);
<a name="l03034"></a>03034    }
<a name="l03035"></a>03035    <span class="keywordflow">while</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#ac0df3c8f4391be85a4d95a23866d4313" title="Position in the cidspill buffer to send out next.">cidpos</a> &lt; p-&gt;<a class="code" href="structdahdi__pvt.html#a241dcb75aa2cae2b5c7b899eb95079d0" title="Length of the cidspill buffer containing samples.">cidlen</a>) {
<a name="l03036"></a>03036       res = write(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a> + p-&gt;<a class="code" href="structdahdi__pvt.html#ac0df3c8f4391be85a4d95a23866d4313" title="Position in the cidspill buffer to send out next.">cidpos</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#a241dcb75aa2cae2b5c7b899eb95079d0" title="Length of the cidspill buffer containing samples.">cidlen</a> - p-&gt;<a class="code" href="structdahdi__pvt.html#ac0df3c8f4391be85a4d95a23866d4313" title="Position in the cidspill buffer to send out next.">cidpos</a>);
<a name="l03037"></a>03037       <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l03038"></a>03038          <span class="keywordflow">if</span> (errno == EAGAIN)
<a name="l03039"></a>03039             <span class="keywordflow">return</span> 0;
<a name="l03040"></a>03040          <span class="keywordflow">else</span> {
<a name="l03041"></a>03041             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;write failed: %s\n&quot;</span>, strerror(errno));
<a name="l03042"></a>03042             <span class="keywordflow">return</span> -1;
<a name="l03043"></a>03043          }
<a name="l03044"></a>03044       }
<a name="l03045"></a>03045       <span class="keywordflow">if</span> (!res)
<a name="l03046"></a>03046          <span class="keywordflow">return</span> 0;
<a name="l03047"></a>03047       p-&gt;<a class="code" href="structdahdi__pvt.html#ac0df3c8f4391be85a4d95a23866d4313" title="Position in the cidspill buffer to send out next.">cidpos</a> += res;
<a name="l03048"></a>03048    }
<a name="l03049"></a>03049    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a>);
<a name="l03050"></a>03050    p-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a> = NULL;
<a name="l03051"></a>03051    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a7a4e9b0410dd0636d8f10df9ff51e0a3" title="BOOLEAN. XXX Meaning what??">callwaitcas</a>) {
<a name="l03052"></a>03052       <span class="comment">/* Wait for CID/CW to expire */</span>
<a name="l03053"></a>03053       p-&gt;<a class="code" href="structdahdi__pvt.html#ac8c4841c7cad35c09ddbd28ede1c4cfe">cidcwexpire</a> = <a class="code" href="chan__dahdi_8c.html#a1117129c7428d435d09423775904f91a">CIDCW_EXPIRE_SAMPLES</a>;
<a name="l03054"></a>03054    } <span class="keywordflow">else</span>
<a name="l03055"></a>03055       <a class="code" href="chan__dahdi_8c.html#a128443b4d6aa50b91bcd4668d582095f">restore_conference</a>(p);
<a name="l03056"></a>03056    <span class="keywordflow">return</span> 0;
<a name="l03057"></a>03057 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="acf3dec3a37d62f9b0e7691747a5c37ee"></a><!-- doxytag: member="chan_dahdi.c::send_cwcidspill" ref="acf3dec3a37d62f9b0e7691747a5c37ee" args="(struct dahdi_pvt *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int send_cwcidspill </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l02986">2986</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="callerid_8c_source.html#l01067">ast_callerid_callwaiting_generate()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00209">AST_LAW</a>, <a class="el" href="astmm_8h_source.html#l00081">ast_malloc</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="chan__dahdi_8c_source.html#l01011">dahdi_pvt::callwait_name</a>, <a class="el" href="chan__dahdi_8c_source.html#l01009">dahdi_pvt::callwait_num</a>, <a class="el" href="chan__dahdi_8c_source.html#l01070">dahdi_pvt::callwaitcas</a>, <a class="el" href="chan__dahdi_8c_source.html#l01048">dahdi_pvt::cidcwexpire</a>, <a class="el" href="chan__dahdi_8c_source.html#l01054">dahdi_pvt::cidlen</a>, <a class="el" href="chan__dahdi_8c_source.html#l01052">dahdi_pvt::cidpos</a>, <a class="el" href="chan__dahdi_8c_source.html#l01050">dahdi_pvt::cidspill</a>, <a class="el" href="callerid_8h_source.html#l00048">MAX_CALLERID_SIZE</a>, <a class="el" href="chan__dahdi_8c_source.html#l00397">READ_SIZE</a>, and <a class="el" href="chan__dahdi_8c_source.html#l03026">send_callerid()</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l05607">dahdi_handle_dtmfup()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02987"></a>02987 {
<a name="l02988"></a>02988    p-&gt;<a class="code" href="structdahdi__pvt.html#a7a4e9b0410dd0636d8f10df9ff51e0a3" title="BOOLEAN. XXX Meaning what??">callwaitcas</a> = 0;
<a name="l02989"></a>02989    p-&gt;<a class="code" href="structdahdi__pvt.html#ac8c4841c7cad35c09ddbd28ede1c4cfe">cidcwexpire</a> = 0;
<a name="l02990"></a>02990    <span class="keywordflow">if</span> (!(p-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a> = <a class="code" href="astmm_8h.html#a64a0e7a3ab511a3777ac56f5d43c628e">ast_malloc</a>(<a class="code" href="callerid_8h.html#a532bcb39ca48d514d3765747d5c91f25">MAX_CALLERID_SIZE</a>)))
<a name="l02991"></a>02991       <span class="keywordflow">return</span> -1;
<a name="l02992"></a>02992    p-&gt;<a class="code" href="structdahdi__pvt.html#a241dcb75aa2cae2b5c7b899eb95079d0" title="Length of the cidspill buffer containing samples.">cidlen</a> = <a class="code" href="callerid_8h.html#adaee7c971091adf49557cf4b7a0ffa3d" title="Generate Caller-ID spill but in a format suitable for Call Waiting(tm)&amp;#39;s Caller*ID(tm)...">ast_callerid_callwaiting_generate</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a1feb446376d763ef9b41dcff786f8958" title="Analog caller ID waveform sample buffer.">cidspill</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#af6279f03935b629298857a9d76d7e49d" title="Call waiting name.">callwait_name</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#a700ba82d6275fe8b33711eca4907b028" title="Call waiting number.">callwait_num</a>, <a class="code" href="chan__dahdi_8c.html#a830b5fdb3ba653640d3f5044192d82bf">AST_LAW</a>(p));
<a name="l02993"></a>02993    <span class="comment">/* Make sure we account for the end */</span>
<a name="l02994"></a>02994    p-&gt;<a class="code" href="structdahdi__pvt.html#a241dcb75aa2cae2b5c7b899eb95079d0" title="Length of the cidspill buffer containing samples.">cidlen</a> += <a class="code" href="chan__dahdi_8c.html#a86e1969b50e55e5d506233078ca0fa4c">READ_SIZE</a> * 4;
<a name="l02995"></a>02995    p-&gt;<a class="code" href="structdahdi__pvt.html#ac0df3c8f4391be85a4d95a23866d4313" title="Position in the cidspill buffer to send out next.">cidpos</a> = 0;
<a name="l02996"></a>02996    <a class="code" href="chan__dahdi_8c.html#ae39659603ab09eecffce6638832c5b73">send_callerid</a>(p);
<a name="l02997"></a>02997    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;CPE supports Call Waiting Caller*ID.  Sending &apos;%s/%s&apos;\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#af6279f03935b629298857a9d76d7e49d" title="Call waiting name.">callwait_name</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#a700ba82d6275fe8b33711eca4907b028" title="Call waiting number.">callwait_num</a>);
<a name="l02998"></a>02998    <span class="keywordflow">return</span> 0;
<a name="l02999"></a>02999 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6abcbfc59e4d42646f31142d7dd2b830"></a><!-- doxytag: member="chan_dahdi.c::set_actual_gain" ref="a6abcbfc59e4d42646f31142d7dd2b830" args="(int fd, int chan, float rxgain, float txgain, int law)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int set_actual_gain </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>rxgain</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>txgain</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>law</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l02831">2831</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="chan__dahdi_8c_source.html#l02813">set_actual_rxgain()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l02795">set_actual_txgain()</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l02836">bump_gains()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03101">dahdi_call()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l02850">restore_gains()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02832"></a>02832 {
<a name="l02833"></a>02833    <span class="keywordflow">return</span> <a class="code" href="chan__dahdi_8c.html#a7327b1abb40a4d2dfcb05a13e132371f">set_actual_txgain</a>(fd, <a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, txgain, law) | <a class="code" href="chan__dahdi_8c.html#a199b65731d7c30946121938cc548b69c">set_actual_rxgain</a>(fd, <a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, rxgain, law);
<a name="l02834"></a>02834 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a199b65731d7c30946121938cc548b69c"></a><!-- doxytag: member="chan_dahdi.c::set_actual_rxgain" ref="a199b65731d7c30946121938cc548b69c" args="(int fd, int chan, float gain, int law)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int set_actual_rxgain </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>gain</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>law</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l02813">2813</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, and <a class="el" href="chan__dahdi_8c_source.html#l02761">fill_rxgain()</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l15038">dahdi_set_swgain()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04837">dahdi_setoption()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l02831">set_actual_gain()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02814"></a>02814 {
<a name="l02815"></a>02815    <span class="keyword">struct </span>dahdi_gains g;
<a name="l02816"></a>02816    <span class="keywordtype">int</span> res;
<a name="l02817"></a>02817 
<a name="l02818"></a>02818    memset(&amp;g, 0, <span class="keyword">sizeof</span>(g));
<a name="l02819"></a>02819    g.chan = <a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>;
<a name="l02820"></a>02820    res = ioctl(fd, DAHDI_GETGAINS, &amp;g);
<a name="l02821"></a>02821    <span class="keywordflow">if</span> (res) {
<a name="l02822"></a>02822       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Failed to read gains: %s\n&quot;</span>, strerror(errno));
<a name="l02823"></a>02823       <span class="keywordflow">return</span> res;
<a name="l02824"></a>02824    }
<a name="l02825"></a>02825 
<a name="l02826"></a>02826    <a class="code" href="chan__dahdi_8c.html#a186539eb5b78bd0849d09b4543ff47ef">fill_rxgain</a>(&amp;g, gain, law);
<a name="l02827"></a>02827 
<a name="l02828"></a>02828    <span class="keywordflow">return</span> ioctl(fd, DAHDI_SETGAINS, &amp;g);
<a name="l02829"></a>02829 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7327b1abb40a4d2dfcb05a13e132371f"></a><!-- doxytag: member="chan_dahdi.c::set_actual_txgain" ref="a7327b1abb40a4d2dfcb05a13e132371f" args="(int fd, int chan, float gain, int law)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int set_actual_txgain </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>gain</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>law</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l02795">2795</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, and <a class="el" href="chan__dahdi_8c_source.html#l02727">fill_txgain()</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l15038">dahdi_set_swgain()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04837">dahdi_setoption()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l02831">set_actual_gain()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02796"></a>02796 {
<a name="l02797"></a>02797    <span class="keyword">struct </span>dahdi_gains g;
<a name="l02798"></a>02798    <span class="keywordtype">int</span> res;
<a name="l02799"></a>02799 
<a name="l02800"></a>02800    memset(&amp;g, 0, <span class="keyword">sizeof</span>(g));
<a name="l02801"></a>02801    g.chan = <a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>;
<a name="l02802"></a>02802    res = ioctl(fd, DAHDI_GETGAINS, &amp;g);
<a name="l02803"></a>02803    <span class="keywordflow">if</span> (res) {
<a name="l02804"></a>02804       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Failed to read gains: %s\n&quot;</span>, strerror(errno));
<a name="l02805"></a>02805       <span class="keywordflow">return</span> res;
<a name="l02806"></a>02806    }
<a name="l02807"></a>02807 
<a name="l02808"></a>02808    <a class="code" href="chan__dahdi_8c.html#a6fac5af64b9b77c5d2c485bd3b70ea4d">fill_txgain</a>(&amp;g, gain, law);
<a name="l02809"></a>02809 
<a name="l02810"></a>02810    <span class="keywordflow">return</span> ioctl(fd, DAHDI_SETGAINS, &amp;g);
<a name="l02811"></a>02811 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a90c93221b85857ca4af2b1097d267603"></a><!-- doxytag: member="chan_dahdi.c::setup_dahdi" ref="a90c93221b85857ca4af2b1097d267603" args="(int reload)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int setup_dahdi </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>reload</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l17079">17079</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="config_8c_source.html#l00613">ast_category_browse()</a>, <a class="el" href="utils_8h_source.html#l00075">ast_clear_flag</a>, <a class="el" href="config_8c_source.html#l00827">ast_config_destroy()</a>, <a class="el" href="config_8h_source.html#l00139">ast_config_load</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="utils_8h_source.html#l00376">ast_pthread_create</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="config_8c_source.html#l00411">ast_variable_browse()</a>, <a class="el" href="config_8c_source.html#l00435">ast_variable_retrieve()</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="config_8h_source.html#l00043">CONFIG_FLAG_FILEUNCHANGED</a>, <a class="el" href="config_8h_source.html#l00050">CONFIG_STATUS_FILEINVALID</a>, <a class="el" href="config_8h_source.html#l00049">CONFIG_STATUS_FILEUNCHANGED</a>, <a class="el" href="chan__dahdi_8c_source.html#l01266">dahdi_chan_conf_default()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00181">global_jbconf</a>, <a class="el" href="config_8h_source.html#l00081">ast_variable::lineno</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="cdr__custom_8c_source.html#l00057">master</a>, <a class="el" href="config_8h_source.html#l00075">ast_variable::name</a>, <a class="el" href="config_8h_source.html#l00077">ast_variable::next</a>, <a class="el" href="chan__dahdi_8c_source.html#l16092">PROC_DAHDI_OPT_NOCHAN</a>, <a class="el" href="chan__dahdi_8c_source.html#l16094">PROC_DAHDI_OPT_NOWARN</a>, <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>, <a class="el" href="chan__console_8c_source.html#l00165">pvts</a>, <a class="el" href="chan__dahdi_8c_source.html#l09705">restart_monitor()</a>, and <a class="el" href="config_8h_source.html#l00076">ast_variable::value</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l14338">dahdi_restart()</a>, <a class="el" href="chan__dahdi_8c_source.html#l17308">load_module()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l17480">reload()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l17080"></a>17080 {
<a name="l17081"></a>17081    <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *cfg, *ucfg;
<a name="l17082"></a>17082    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *v;
<a name="l17083"></a>17083    <span class="keyword">struct </span><a class="code" href="structdahdi__chan__conf.html" title="Channel configuration from chan_dahdi.conf . This struct is used for parsing the...">dahdi_chan_conf</a> base_conf = <a class="code" href="chan__dahdi_8c.html#aa9cd3a63b87d28e1862e023bfd8a9cbb">dahdi_chan_conf_default</a>();
<a name="l17084"></a>17084    <span class="keyword">struct </span><a class="code" href="structdahdi__chan__conf.html" title="Channel configuration from chan_dahdi.conf . This struct is used for parsing the...">dahdi_chan_conf</a> conf;
<a name="l17085"></a>17085    <span class="keyword">struct </span><a class="code" href="structast__flags.html" title="Structure used to handle boolean flags.">ast_flags</a> <a class="code" href="app__rpt_8c.html#a1f57f20c1f46890828791a4827fe8752">config_flags</a> = { <a class="code" href="chan__dahdi_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a> == 1 ? <a class="code" href="config_8h.html#a2d5492e116eebd5075f247d21fb9db26afa887389dc380bbdcffb65fec379f037">CONFIG_FLAG_FILEUNCHANGED</a> : 0 };
<a name="l17086"></a>17086    <span class="keyword">const</span> <span class="keywordtype">char</span> *cat;
<a name="l17087"></a>17087    <span class="keywordtype">int</span> res;
<a name="l17088"></a>17088 
<a name="l17089"></a>17089 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l17090"></a>17090 <span class="preprocessor"></span>   <span class="keywordtype">char</span> *c;
<a name="l17091"></a>17091    <span class="keywordtype">int</span> spanno;
<a name="l17092"></a>17092    <span class="keywordtype">int</span> i;
<a name="l17093"></a>17093    <span class="keywordtype">int</span> logicalspan;
<a name="l17094"></a>17094    <span class="keywordtype">int</span> trunkgroup;
<a name="l17095"></a>17095    <span class="keywordtype">int</span> dchannels[<a class="code" href="chan__dahdi_8c.html#aaad94eef7bd74293b956f6de74a62d0f">NUM_DCHANS</a>];
<a name="l17096"></a>17096 <span class="preprocessor">#endif</span>
<a name="l17097"></a>17097 <span class="preprocessor"></span>
<a name="l17098"></a>17098    cfg = <a class="code" href="config_8h.html#a0a07ddd6bbcf44485e01c14c96109482">ast_config_load</a>(<a class="code" href="chan__dahdi_8c.html#a9ee8d742a1fbcff45f97842b92952610">config</a>, config_flags);
<a name="l17099"></a>17099 
<a name="l17100"></a>17100    <span class="comment">/* Error if we have no config file */</span>
<a name="l17101"></a>17101    <span class="keywordflow">if</span> (!cfg) {
<a name="l17102"></a>17102       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to load config %s\n&quot;</span>, <a class="code" href="chan__dahdi_8c.html#a9ee8d742a1fbcff45f97842b92952610">config</a>);
<a name="l17103"></a>17103       <span class="keywordflow">return</span> 0;
<a name="l17104"></a>17104    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cfg == <a class="code" href="config_8h.html#a846844eb2c4eb44554445936b3770711">CONFIG_STATUS_FILEUNCHANGED</a>) {
<a name="l17105"></a>17105       ucfg = <a class="code" href="config_8h.html#a0a07ddd6bbcf44485e01c14c96109482">ast_config_load</a>(<span class="stringliteral">&quot;users.conf&quot;</span>, config_flags);
<a name="l17106"></a>17106       <span class="keywordflow">if</span> (ucfg == <a class="code" href="config_8h.html#a846844eb2c4eb44554445936b3770711">CONFIG_STATUS_FILEUNCHANGED</a>) {
<a name="l17107"></a>17107          <span class="keywordflow">return</span> 0;
<a name="l17108"></a>17108       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ucfg == <a class="code" href="config_8h.html#a8d1a63cdf2c7aff22a77b6e75d93b377">CONFIG_STATUS_FILEINVALID</a>) {
<a name="l17109"></a>17109          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;File users.conf cannot be parsed.  Aborting.\n&quot;</span>);
<a name="l17110"></a>17110          <span class="keywordflow">return</span> 0;
<a name="l17111"></a>17111       }
<a name="l17112"></a>17112       <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(&amp;config_flags, <a class="code" href="config_8h.html#a2d5492e116eebd5075f247d21fb9db26afa887389dc380bbdcffb65fec379f037">CONFIG_FLAG_FILEUNCHANGED</a>);
<a name="l17113"></a>17113       <span class="keywordflow">if</span> ((cfg = <a class="code" href="config_8h.html#a0a07ddd6bbcf44485e01c14c96109482">ast_config_load</a>(<a class="code" href="chan__dahdi_8c.html#a9ee8d742a1fbcff45f97842b92952610">config</a>, config_flags)) == <a class="code" href="config_8h.html#a8d1a63cdf2c7aff22a77b6e75d93b377">CONFIG_STATUS_FILEINVALID</a>) {
<a name="l17114"></a>17114          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;File %s cannot be parsed.  Aborting.\n&quot;</span>, <a class="code" href="chan__dahdi_8c.html#a9ee8d742a1fbcff45f97842b92952610">config</a>);
<a name="l17115"></a>17115          <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(ucfg);
<a name="l17116"></a>17116          <span class="keywordflow">return</span> 0;
<a name="l17117"></a>17117       }
<a name="l17118"></a>17118    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cfg == <a class="code" href="config_8h.html#a8d1a63cdf2c7aff22a77b6e75d93b377">CONFIG_STATUS_FILEINVALID</a>) {
<a name="l17119"></a>17119       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;File %s cannot be parsed.  Aborting.\n&quot;</span>, <a class="code" href="chan__dahdi_8c.html#a9ee8d742a1fbcff45f97842b92952610">config</a>);
<a name="l17120"></a>17120       <span class="keywordflow">return</span> 0;
<a name="l17121"></a>17121    } <span class="keywordflow">else</span> {
<a name="l17122"></a>17122       <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(&amp;config_flags, <a class="code" href="config_8h.html#a2d5492e116eebd5075f247d21fb9db26afa887389dc380bbdcffb65fec379f037">CONFIG_FLAG_FILEUNCHANGED</a>);
<a name="l17123"></a>17123       <span class="keywordflow">if</span> ((ucfg = <a class="code" href="config_8h.html#a0a07ddd6bbcf44485e01c14c96109482">ast_config_load</a>(<span class="stringliteral">&quot;users.conf&quot;</span>, config_flags)) == <a class="code" href="config_8h.html#a8d1a63cdf2c7aff22a77b6e75d93b377">CONFIG_STATUS_FILEINVALID</a>) {
<a name="l17124"></a>17124          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;File users.conf cannot be parsed.  Aborting.\n&quot;</span>);
<a name="l17125"></a>17125          <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(cfg);
<a name="l17126"></a>17126          <span class="keywordflow">return</span> 0;
<a name="l17127"></a>17127       }
<a name="l17128"></a>17128    }
<a name="l17129"></a>17129 
<a name="l17130"></a>17130    <span class="comment">/* It&apos;s a little silly to lock it, but we mind as well just to be sure */</span>
<a name="l17131"></a>17131    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;iflock);
<a name="l17132"></a>17132 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l17133"></a>17133 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a> != 1) {
<a name="l17134"></a>17134       <span class="comment">/* Process trunkgroups first */</span>
<a name="l17135"></a>17135       v = <a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(cfg, <span class="stringliteral">&quot;trunkgroups&quot;</span>);
<a name="l17136"></a>17136       <span class="keywordflow">while</span> (v) {
<a name="l17137"></a>17137          <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;trunkgroup&quot;</span>)) {
<a name="l17138"></a>17138             trunkgroup = atoi(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l17139"></a>17139             <span class="keywordflow">if</span> (trunkgroup &gt; 0) {
<a name="l17140"></a>17140                <span class="keywordflow">if</span> ((c = strchr(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="charliteral">&apos;,&apos;</span>))) {
<a name="l17141"></a>17141                   i = 0;
<a name="l17142"></a>17142                   memset(dchannels, 0, <span class="keyword">sizeof</span>(dchannels));
<a name="l17143"></a>17143                   <span class="keywordflow">while</span> (c &amp;&amp; (i &lt; <a class="code" href="chan__dahdi_8c.html#aaad94eef7bd74293b956f6de74a62d0f">NUM_DCHANS</a>)) {
<a name="l17144"></a>17144                      dchannels[i] = atoi(c + 1);
<a name="l17145"></a>17145                      <span class="keywordflow">if</span> (dchannels[i] &lt; 0) {
<a name="l17146"></a>17146                         <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;D-channel for trunk group %d must be a postiive number at line %d of chan_dahdi.conf\n&quot;</span>, trunkgroup, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l17147"></a>17147                      } <span class="keywordflow">else</span>
<a name="l17148"></a>17148                         i++;
<a name="l17149"></a>17149                      c = strchr(c + 1, <span class="charliteral">&apos;,&apos;</span>);
<a name="l17150"></a>17150                   }
<a name="l17151"></a>17151                   <span class="keywordflow">if</span> (i) {
<a name="l17152"></a>17152                      <span class="keywordflow">if</span> (pri_create_trunkgroup(trunkgroup, dchannels)) {
<a name="l17153"></a>17153                         <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create trunk group %d with Primary D-channel %d at line %d of chan_dahdi.conf\n&quot;</span>, trunkgroup, dchannels[0], v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l17154"></a>17154                   } <span class="keywordflow">else</span>
<a name="l17155"></a>17155                         <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Created trunk group %d with Primary D-channel %d and %d backup%s\n&quot;</span>, trunkgroup, dchannels[0], i - 1, (i == 1) ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;s&quot;</span>);
<a name="l17156"></a>17156                   } <span class="keywordflow">else</span>
<a name="l17157"></a>17157                      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Trunk group %d lacks any valid D-channels at line %d of chan_dahdi.conf\n&quot;</span>, trunkgroup, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l17158"></a>17158                } <span class="keywordflow">else</span>
<a name="l17159"></a>17159                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Trunk group %d lacks a primary D-channel at line %d of chan_dahdi.conf\n&quot;</span>, trunkgroup, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l17160"></a>17160             } <span class="keywordflow">else</span>
<a name="l17161"></a>17161                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Trunk group identifier must be a positive integer at line %d of chan_dahdi.conf\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l17162"></a>17162          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;spanmap&quot;</span>)) {
<a name="l17163"></a>17163             spanno = atoi(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l17164"></a>17164             <span class="keywordflow">if</span> (spanno &gt; 0) {
<a name="l17165"></a>17165                <span class="keywordflow">if</span> ((c = strchr(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="charliteral">&apos;,&apos;</span>))) {
<a name="l17166"></a>17166                   trunkgroup = atoi(c + 1);
<a name="l17167"></a>17167                   <span class="keywordflow">if</span> (trunkgroup &gt; 0) {
<a name="l17168"></a>17168                      <span class="keywordflow">if</span> ((c = strchr(c + 1, <span class="charliteral">&apos;,&apos;</span>)))
<a name="l17169"></a>17169                         logicalspan = atoi(c + 1);
<a name="l17170"></a>17170                      <span class="keywordflow">else</span>
<a name="l17171"></a>17171                         logicalspan = 0;
<a name="l17172"></a>17172                      <span class="keywordflow">if</span> (logicalspan &gt;= 0) {
<a name="l17173"></a>17173                         <span class="keywordflow">if</span> (pri_create_spanmap(spanno - 1, trunkgroup, logicalspan)) {
<a name="l17174"></a>17174                            <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to map span %d to trunk group %d (logical span %d)\n&quot;</span>, spanno, trunkgroup, logicalspan);
<a name="l17175"></a>17175                      } <span class="keywordflow">else</span>
<a name="l17176"></a>17176                            <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Mapped span %d to trunk group %d (logical span %d)\n&quot;</span>, spanno, trunkgroup, logicalspan);
<a name="l17177"></a>17177                      } <span class="keywordflow">else</span>
<a name="l17178"></a>17178                         <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Logical span must be a postive number, or &apos;0&apos; (for unspecified) at line %d of chan_dahdi.conf\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l17179"></a>17179                   } <span class="keywordflow">else</span>
<a name="l17180"></a>17180                      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Trunk group must be a postive number at line %d of chan_dahdi.conf\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l17181"></a>17181                } <span class="keywordflow">else</span>
<a name="l17182"></a>17182                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Missing trunk group for span map at line %d of chan_dahdi.conf\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l17183"></a>17183             } <span class="keywordflow">else</span>
<a name="l17184"></a>17184                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Span number must be a postive integer at line %d of chan_dahdi.conf\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l17185"></a>17185          } <span class="keywordflow">else</span> {
<a name="l17186"></a>17186             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Ignoring unknown keyword &apos;%s&apos; in trunkgroups\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);
<a name="l17187"></a>17187          }
<a name="l17188"></a>17188          v = v-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>;
<a name="l17189"></a>17189       }
<a name="l17190"></a>17190    }
<a name="l17191"></a>17191 <span class="preprocessor">#endif</span>
<a name="l17192"></a>17192 <span class="preprocessor"></span>
<a name="l17193"></a>17193    <span class="comment">/* Copy the default jb config over global_jbconf */</span>
<a name="l17194"></a>17194    memcpy(&amp;<a class="code" href="chan__dahdi_8c.html#abaabcb7f4349cc632dde3af5c6a5e1bd">global_jbconf</a>, &amp;<a class="code" href="chan__dahdi_8c.html#a2d8d5920e90ccbad7832926becdadb29">default_jbconf</a>, <span class="keyword">sizeof</span>(<a class="code" href="chan__dahdi_8c.html#abaabcb7f4349cc632dde3af5c6a5e1bd">global_jbconf</a>));
<a name="l17195"></a>17195 
<a name="l17196"></a>17196    <a class="code" href="chan__dahdi_8c.html#a200370774ee53e137af5d8d7932b7acc">mwimonitornotify</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l17197"></a>17197 
<a name="l17198"></a>17198    v = <a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(cfg, <span class="stringliteral">&quot;channels&quot;</span>);
<a name="l17199"></a>17199    <span class="keywordflow">if</span> ((res = <a class="code" href="chan__dahdi_8c.html#ad19a2de7bce089d3d6e11d7dfb487802">process_dahdi</a>(&amp;base_conf, <span class="stringliteral">&quot;&quot;</span>, v, <a class="code" href="chan__dahdi_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a>, 0))) {
<a name="l17200"></a>17200       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;iflock);
<a name="l17201"></a>17201       <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(cfg);
<a name="l17202"></a>17202       <span class="keywordflow">if</span> (ucfg) {
<a name="l17203"></a>17203          <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(ucfg);
<a name="l17204"></a>17204       }
<a name="l17205"></a>17205       <span class="keywordflow">return</span> res;
<a name="l17206"></a>17206    }
<a name="l17207"></a>17207 
<a name="l17208"></a>17208    <span class="comment">/* Now get configuration from all normal sections in chan_dahdi.conf: */</span>
<a name="l17209"></a>17209    <span class="keywordflow">for</span> (cat = <a class="code" href="config_8h.html#a611776300f941a63266cb220ac62b4db" title="Goes through categories.">ast_category_browse</a>(cfg, NULL); cat ; cat = <a class="code" href="config_8h.html#a611776300f941a63266cb220ac62b4db" title="Goes through categories.">ast_category_browse</a>(cfg, cat)) {
<a name="l17210"></a>17210       <span class="comment">/* [channels] and [trunkgroups] are used. Let&apos;s also reserve</span>
<a name="l17211"></a>17211 <span class="comment">       * [globals] and [general] for future use</span>
<a name="l17212"></a>17212 <span class="comment">       */</span>
<a name="l17213"></a>17213       <span class="keywordflow">if</span> (!strcasecmp(cat, <span class="stringliteral">&quot;general&quot;</span>) ||
<a name="l17214"></a>17214          !strcasecmp(cat, <span class="stringliteral">&quot;trunkgroups&quot;</span>) ||
<a name="l17215"></a>17215          !strcasecmp(cat, <span class="stringliteral">&quot;globals&quot;</span>) ||
<a name="l17216"></a>17216          !strcasecmp(cat, <span class="stringliteral">&quot;channels&quot;</span>)) {
<a name="l17217"></a>17217          <span class="keywordflow">continue</span>;
<a name="l17218"></a>17218       }
<a name="l17219"></a>17219 
<a name="l17220"></a>17220       memcpy(&amp;conf, &amp;base_conf, <span class="keyword">sizeof</span>(conf));
<a name="l17221"></a>17221 
<a name="l17222"></a>17222       <span class="keywordflow">if</span> ((res = <a class="code" href="chan__dahdi_8c.html#ad19a2de7bce089d3d6e11d7dfb487802">process_dahdi</a>(&amp;conf, cat, <a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(cfg, cat), <a class="code" href="chan__dahdi_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a>, <a class="code" href="chan__dahdi_8c.html#a6743ea33516885eca81012e31dfb7d09">PROC_DAHDI_OPT_NOCHAN</a>))) {
<a name="l17223"></a>17223          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;iflock);
<a name="l17224"></a>17224          <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(cfg);
<a name="l17225"></a>17225          <span class="keywordflow">if</span> (ucfg) {
<a name="l17226"></a>17226             <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(cfg);
<a name="l17227"></a>17227          }
<a name="l17228"></a>17228          <span class="keywordflow">return</span> res;
<a name="l17229"></a>17229       }
<a name="l17230"></a>17230    }
<a name="l17231"></a>17231 
<a name="l17232"></a>17232    <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(cfg);
<a name="l17233"></a>17233 
<a name="l17234"></a>17234    <span class="keywordflow">if</span> (ucfg) {
<a name="l17235"></a>17235       <span class="keyword">const</span> <span class="keywordtype">char</span> *chans;
<a name="l17236"></a>17236 
<a name="l17237"></a>17237       <a class="code" href="chan__dahdi_8c.html#ad19a2de7bce089d3d6e11d7dfb487802">process_dahdi</a>(&amp;base_conf, <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(ucfg, <span class="stringliteral">&quot;general&quot;</span>), 1, 0);
<a name="l17238"></a>17238 
<a name="l17239"></a>17239       <span class="keywordflow">for</span> (cat = <a class="code" href="config_8h.html#a611776300f941a63266cb220ac62b4db" title="Goes through categories.">ast_category_browse</a>(ucfg, NULL); cat ; cat = <a class="code" href="config_8h.html#a611776300f941a63266cb220ac62b4db" title="Goes through categories.">ast_category_browse</a>(ucfg, cat)) {
<a name="l17240"></a>17240          <span class="keywordflow">if</span> (!strcasecmp(cat, <span class="stringliteral">&quot;general&quot;</span>)) {
<a name="l17241"></a>17241             <span class="keywordflow">continue</span>;
<a name="l17242"></a>17242          }
<a name="l17243"></a>17243 
<a name="l17244"></a>17244          chans = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(ucfg, cat, <span class="stringliteral">&quot;dahdichan&quot;</span>);
<a name="l17245"></a>17245 
<a name="l17246"></a>17246          <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(chans)) {
<a name="l17247"></a>17247             <span class="keywordflow">continue</span>;
<a name="l17248"></a>17248          }
<a name="l17249"></a>17249 
<a name="l17250"></a>17250          memcpy(&amp;conf, &amp;base_conf, <span class="keyword">sizeof</span>(conf));
<a name="l17251"></a>17251 
<a name="l17252"></a>17252          <span class="keywordflow">if</span> ((res = <a class="code" href="chan__dahdi_8c.html#ad19a2de7bce089d3d6e11d7dfb487802">process_dahdi</a>(&amp;conf, cat, <a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(ucfg, cat), <a class="code" href="chan__dahdi_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a>, <a class="code" href="chan__dahdi_8c.html#a6743ea33516885eca81012e31dfb7d09">PROC_DAHDI_OPT_NOCHAN</a> | <a class="code" href="chan__dahdi_8c.html#ac0fd63b3569161611cb73dcd4af16570">PROC_DAHDI_OPT_NOWARN</a>))) {
<a name="l17253"></a>17253             <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(ucfg);
<a name="l17254"></a>17254             <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;iflock);
<a name="l17255"></a>17255             <span class="keywordflow">return</span> res;
<a name="l17256"></a>17256          }
<a name="l17257"></a>17257       }
<a name="l17258"></a>17258       <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(ucfg);
<a name="l17259"></a>17259    }
<a name="l17260"></a>17260    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;iflock);
<a name="l17261"></a>17261 
<a name="l17262"></a>17262 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l17263"></a>17263 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a> != 1) {
<a name="l17264"></a>17264       <span class="keywordtype">int</span> x;
<a name="l17265"></a>17265       <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="chan__dahdi_8c.html#a80bfdd8adbffe226265cd729655a7268">NUM_SPANS</a>; x++) {
<a name="l17266"></a>17266          <span class="keywordflow">if</span> (pris[x].<a class="code" href="chan__console_8c.html#a8088707c252266a9c68cca9355920c4f">pvts</a>[0]) {
<a name="l17267"></a>17267             <span class="keywordflow">if</span> (start_pri(pris + x)) {
<a name="l17268"></a>17268                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to start D-channel on span %d\n&quot;</span>, x + 1);
<a name="l17269"></a>17269                <span class="keywordflow">return</span> -1;
<a name="l17270"></a>17270             } <span class="keywordflow">else</span>
<a name="l17271"></a>17271                <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Starting D-Channel on span %d\n&quot;</span>, x + 1);
<a name="l17272"></a>17272          }
<a name="l17273"></a>17273       }
<a name="l17274"></a>17274    }
<a name="l17275"></a>17275 <span class="preprocessor">#endif</span>
<a name="l17276"></a>17276 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_SS7</span>
<a name="l17277"></a>17277 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a> != 1) {
<a name="l17278"></a>17278       <span class="keywordtype">int</span> x;
<a name="l17279"></a>17279       <span class="keywordflow">for</span> (x = 0; x &lt; NUM_SPANS; x++) {
<a name="l17280"></a>17280          <span class="keywordflow">if</span> (linksets[x].ss7) {
<a name="l17281"></a>17281             <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a4781fd54a4ca8c7f0f8a32a6cce503c0">ast_pthread_create</a>(&amp;linksets[x].<a class="code" href="cdr__custom_8c.html#ac4cd676396d9d62ba95a047806668d90">master</a>, NULL, ss7_linkset, &amp;linksets[x])) {
<a name="l17282"></a>17282                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to start SS7 linkset on span %d\n&quot;</span>, x + 1);
<a name="l17283"></a>17283                <span class="keywordflow">return</span> -1;
<a name="l17284"></a>17284             } <span class="keywordflow">else</span>
<a name="l17285"></a>17285                <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Starting SS7 linkset on span %d\n&quot;</span>, x + 1);
<a name="l17286"></a>17286          }
<a name="l17287"></a>17287       }
<a name="l17288"></a>17288    }
<a name="l17289"></a>17289 <span class="preprocessor">#endif</span>
<a name="l17290"></a>17290 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_OPENR2</span>
<a name="l17291"></a>17291 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a> != 1) {
<a name="l17292"></a>17292       <span class="keywordtype">int</span> x;
<a name="l17293"></a>17293       <span class="keywordflow">for</span> (x = 0; x &lt; r2links_count; x++) {
<a name="l17294"></a>17294          <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a4781fd54a4ca8c7f0f8a32a6cce503c0">ast_pthread_create</a>(&amp;r2links[x]-&gt;r2master, NULL, mfcr2_monitor, r2links[x])) {
<a name="l17295"></a>17295             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to start R2 monitor on channel group %d\n&quot;</span>, x + 1);
<a name="l17296"></a>17296             <span class="keywordflow">return</span> -1;
<a name="l17297"></a>17297          } <span class="keywordflow">else</span> {
<a name="l17298"></a>17298             <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Starting R2 monitor on channel group %d\n&quot;</span>, x + 1);
<a name="l17299"></a>17299          }
<a name="l17300"></a>17300       }
<a name="l17301"></a>17301    }
<a name="l17302"></a>17302 <span class="preprocessor">#endif</span>
<a name="l17303"></a>17303 <span class="preprocessor"></span>   <span class="comment">/* And start the monitor for the first time */</span>
<a name="l17304"></a>17304    <a class="code" href="chan__dahdi_8c.html#a83af94bb19a421cb25ca02d16fa5ba9c">restart_monitor</a>();
<a name="l17305"></a>17305    <span class="keywordflow">return</span> 0;
<a name="l17306"></a>17306 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a898cf004da2556cf2cdd9119a6fcb7e8"></a><!-- doxytag: member="chan_dahdi.c::sigtype_to_signalling" ref="a898cf004da2556cf2cdd9119a6fcb7e8" args="(int sigtype)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int sigtype_to_signalling </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>sigtype</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l09985">9985</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09986"></a>09986 {
<a name="l09987"></a>09987    <span class="keywordflow">return</span> sigtype;
<a name="l09988"></a>09988 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0d1f78e604903f5ef4e42bf961f4df95"></a><!-- doxytag: member="chan_dahdi.c::ss_thread" ref="a0d1f78e604903f5ef4e42bf961f4df95" args="(void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void * ss_thread </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l07675">7675</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00469">ast_channel::_state</a>, <a class="el" href="chan__dahdi_8c_source.html#l02175">alloc_sub()</a>, <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="channel_8c_source.html#l04733">ast_bridged_channel()</a>, <a class="el" href="pbx_8c_source.html#l04158">ast_canmatch_extension()</a>, <a class="el" href="causes_8h_source.html#l00097">AST_CAUSE_UNALLOCATED</a>, <a class="el" href="lock_8h_source.html#l01734">ast_cond_signal()</a>, <a class="el" href="frame_8h_source.html#l00299">AST_CONTROL_RING</a>, <a class="el" href="frame_8h_source.html#l00314">AST_CONTROL_UNHOLD</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="db_8c_source.html#l00138">ast_db_put()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="dsp_8c_source.html#l01583">ast_dsp_digitreset()</a>, <a class="el" href="dsp_8c_source.html#l01545">ast_dsp_free()</a>, <a class="el" href="dsp_8c_source.html#l01628">ast_dsp_set_digitmode()</a>, <a class="el" href="pbx_8c_source.html#l04143">ast_exists_extension()</a>, <a class="el" href="frame_8h_source.html#l00105">AST_FRAME_CONTROL</a>, <a class="el" href="frame_8h_source.html#l00124">AST_FRAME_DTMF</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="frame_8h_source.html#l00462">ast_frfree</a>, <a class="el" href="channel_8c_source.html#l01690">ast_hangup()</a>, <a class="el" href="pbx_8c_source.html#l07267">ast_ignore_pattern()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00209">AST_LAW</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="features_8c_source.html#l00894">ast_masq_park_call()</a>, <a class="el" href="pbx_8c_source.html#l04163">ast_matchmore_extension()</a>, <a class="el" href="channel_8h_source.html#l00134">AST_MAX_EXTENSION</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="features_8c_source.html#l00315">ast_parking_ext()</a>, <a class="el" href="pbx_8c_source.html#l04596">ast_pbx_run()</a>, <a class="el" href="features_8c_source.html#l04475">ast_pickup_call()</a>, <a class="el" href="features_8c_source.html#l00320">ast_pickup_ext()</a>, <a class="el" href="channel_8c_source.html#l01123">ast_queue_control()</a>, <a class="el" href="channel_8c_source.html#l03100">ast_read()</a>, <a class="el" href="channel_8c_source.html#l01367">ast_safe_sleep()</a>, <a class="el" href="channel_8c_source.html#l05833">ast_say_digit_str()</a>, <a class="el" href="channel_8c_source.html#l04670">ast_set_callerid()</a>, <a class="el" href="channel_8c_source.html#l04695">ast_setstate()</a>, <a class="el" href="callerid_8c_source.html#l00929">ast_shrink_phone_number()</a>, <a class="el" href="res__smdi_8c_source.html#l00725">ast_smdi_md_message_destroy()</a>, <a class="el" href="res__smdi_8c_source.html#l00504">ast_smdi_md_message_wait()</a>, <a class="el" href="channel_8h_source.html#l00368">AST_STATE_PRERING</a>, <a class="el" href="channel_8h_source.html#l00363">AST_STATE_RING</a>, <a class="el" href="channel_8h_source.html#l00364">AST_STATE_RINGING</a>, <a class="el" href="file_8c_source.html#l00943">ast_streamfile()</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="channel_8c_source.html#l02389">ast_waitfor()</a>, <a class="el" href="channel_8c_source.html#l02400">ast_waitfordigit()</a>, <a class="el" href="file_8c_source.html#l01315">ast_waitstream()</a>, <a class="el" href="astobj_8h_source.html#l00218">ASTOBJ_UNREF</a>, <a class="el" href="adsistub_8c_source.html#l00059">buf</a>, <a class="el" href="chan__dahdi_8c_source.html#l02836">bump_gains()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01124">dahdi_pvt::call_forward</a>, <a class="el" href="callerid_8c_source.html#l00542">callerid_feed()</a>, <a class="el" href="callerid_8c_source.html#l00303">callerid_feed_jp()</a>, <a class="el" href="callerid_8c_source.html#l00718">callerid_free()</a>, <a class="el" href="callerid_8c_source.html#l00185">callerid_get()</a>, <a class="el" href="callerid_8c_source.html#l00198">callerid_get_dtmf()</a>, <a class="el" href="callerid_8c_source.html#l00126">callerid_new()</a>, <a class="el" href="smdi_8h_source.html#l00073">ast_smdi_md_message::calling_st</a>, <a class="el" href="chan__dahdi_8c_source.html#l00709">dahdi_pvt::callreturn</a>, <a class="el" href="chan__dahdi_8c_source.html#l00716">dahdi_pvt::callwaiting</a>, <a class="el" href="chan__dahdi_8c_source.html#l00728">dahdi_pvt::cancallforward</a>, <a class="el" href="chan__dahdi_8c_source.html#l00733">dahdi_pvt::canpark</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="channel_8h_source.html#l00444">ast_channel::cid</a>, <a class="el" href="callerid_8h_source.html#l00054">CID_MSGWAITING</a>, <a class="el" href="channel_8h_source.html#l00204">ast_callerid::cid_name</a>, <a class="el" href="chan__dahdi_8c_source.html#l01001">dahdi_pvt::cid_name</a>, <a class="el" href="callerid_8h_source.html#l00055">CID_NOMSGWAITING</a>, <a class="el" href="channel_8h_source.html#l00203">ast_callerid::cid_num</a>, <a class="el" href="chan__dahdi_8c_source.html#l00997">dahdi_pvt::cid_num</a>, <a class="el" href="callerid_8h_source.html#l00059">CID_SIG_DTMF</a>, <a class="el" href="callerid_8h_source.html#l00061">CID_SIG_SMDI</a>, <a class="el" href="callerid_8h_source.html#l00058">CID_SIG_V23</a>, <a class="el" href="callerid_8h_source.html#l00060">CID_SIG_V23_JP</a>, <a class="el" href="chan__dahdi_8c_source.html#l01044">dahdi_pvt::cid_signalling</a>, <a class="el" href="chan__dahdi_8c_source.html#l01045">dahdi_pvt::cid_start</a>, <a class="el" href="callerid_8h_source.html#l00064">CID_START_POLARITY</a>, <a class="el" href="callerid_8h_source.html#l00065">CID_START_POLARITY_IN</a>, <a class="el" href="callerid_8h_source.html#l00063">CID_START_RING</a>, <a class="el" href="chan__dahdi_8c_source.html#l00967">dahdi_pvt::context</a>, <a class="el" href="channel_8h_source.html#l00503">ast_channel::context</a>, <a class="el" href="chan__dahdi_8c_source.html#l00593">ringContextData::contextData</a>, <a class="el" href="chan__dahdi_8c_source.html#l07662">dahdi_dnd()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02660">dahdi_enable_ec()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00376">dahdi_get_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01503">dahdi_get_index()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00288">DAHDI_OVERLAPDIAL_INCOMING</a>, <a class="el" href="chan__dahdi_8c_source.html#l02863">dahdi_set_hook()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02165">dahdi_setlinear()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00385">dahdi_wait_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07635">dahdi_wink()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00971">dahdi_pvt::defcontext</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="chan__dahdi_8c_source.html#l01116">dahdi_pvt::dop</a>, <a class="el" href="chan__dahdi_8c_source.html#l00961">dahdi_pvt::drings</a>, <a class="el" href="chan__dahdi_8c_source.html#l01113">dahdi_pvt::dsp</a>, <a class="el" href="dsp_8h_source.html#l00031">DSP_DIGITMODE_DTMF</a>, <a class="el" href="dsp_8h_source.html#l00032">DSP_DIGITMODE_MF</a>, <a class="el" href="chan__dahdi_8c_source.html#l01147">dahdi_pvt::dtmfrelax</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="chan__dahdi_8c_source.html#l02389">event2str()</a>, <a class="el" href="channel_8h_source.html#l00504">ast_channel::exten</a>, <a class="el" href="chan__dahdi_8c_source.html#l00973">dahdi_pvt::exten</a>, <a class="el" href="chan__alsa_8c_source.html#l00107">exten</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="smdi_8h_source.html#l00072">ast_smdi_md_message::fwd_st</a>, <a class="el" href="channel_8h_source.html#l00479">ast_channel::hangupcause</a>, <a class="el" href="chan__dahdi_8c_source.html#l00772">dahdi_pvt::hanguponpolarityswitch</a>, <a class="el" href="chan__dahdi_8c_source.html#l00774">dahdi_pvt::hardwaredtmf</a>, <a class="el" href="chan__dahdi_8c_source.html#l00781">dahdi_pvt::hidecallerid</a>, <a class="el" href="chan__dahdi_8c_source.html#l00795">dahdi_pvt::immediate</a>, <a class="el" href="chan__dahdi_8c_source.html#l00797">dahdi_pvt::inalarm</a>, <a class="el" href="chan__dahdi_8c_source.html#l01497">ISTRUNK</a>, <a class="el" href="chan__dahdi_8c_source.html#l01003">dahdi_pvt::lastcid_num</a>, <a class="el" href="func__strings_8c_source.html#l00821">len()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00620">dahdi_subchannel::linear</a>, <a class="el" href="logger_8h_source.html#l00119">LOG_DEBUG</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__dahdi_8c_source.html#l01129">dahdi_pvt::mailbox</a>, <a class="el" href="chan__dahdi_8c_source.html#l00898">dahdi_pvt::mwimonitor_rpas</a>, <a class="el" href="chan__dahdi_8c_source.html#l07616">my_getsigstr()</a>, <a class="el" href="cdr__adaptive__odbc_8c_source.html#l00053">name</a>, <a class="el" href="chan__dahdi_8c_source.html#l00213">NEED_MFDETECT</a>, <a class="el" href="chan__dahdi_8c_source.html#l02940">notify_message()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00650">dahdi_pvt::owner</a>, <a class="el" href="chan__dahdi_8c_source.html#l00608">dahdi_subchannel::owner</a>, <a class="el" href="pbx_8c_source.html#l09023">pbx_builtin_setvar_helper()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01177">dahdi_pvt::polarity</a>, <a class="el" href="chan__dahdi_8c_source.html#l00584">POLARITY_IDLE</a>, <a class="el" href="chan__dahdi_8c_source.html#l00585">POLARITY_REV</a>, <a class="el" href="pbx__gtkconsole_8c_source.html#l00059">quit</a>, <a class="el" href="chan__dahdi_8c_source.html#l00590">distRingData::range</a>, <a class="el" href="chan__dahdi_8c_source.html#l02850">restore_gains()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00589">distRingData::ring</a>, <a class="el" href="chan__dahdi_8c_source.html#l00597">dahdi_distRings::ringContext</a>, <a class="el" href="chan__dahdi_8c_source.html#l00596">dahdi_distRings::ringnum</a>, <a class="el" href="channel_8h_source.html#l00470">ast_channel::rings</a>, <a class="el" href="chan__dahdi_8c_source.html#l01056">dahdi_pvt::ringt</a>, <a class="el" href="chan__dahdi_8c_source.html#l01061">dahdi_pvt::ringt_base</a>, <a class="el" href="chan__dahdi_8c_source.html#l00666">dahdi_pvt::sig</a>, <a class="el" href="chan__dahdi_8c_source.html#l02476">sig2str</a>, <a class="el" href="chan__dahdi_8c_source.html#l00256">SIG_BRI</a>, <a class="el" href="chan__dahdi_8c_source.html#l00257">SIG_BRI_PTMP</a>, <a class="el" href="chan__dahdi_8c_source.html#l00245">SIG_E911</a>, <a class="el" href="chan__dahdi_8c_source.html#l00240">SIG_EM</a>, <a class="el" href="chan__dahdi_8c_source.html#l00265">SIG_EM_E1</a>, <a class="el" href="chan__dahdi_8c_source.html#l00241">SIG_EMWINK</a>, <a class="el" href="chan__dahdi_8c_source.html#l00244">SIG_FEATB</a>, <a class="el" href="chan__dahdi_8c_source.html#l00242">SIG_FEATD</a>, <a class="el" href="chan__dahdi_8c_source.html#l00243">SIG_FEATDMF</a>, <a class="el" href="chan__dahdi_8c_source.html#l00246">SIG_FEATDMF_TA</a>, <a class="el" href="chan__dahdi_8c_source.html#l00247">SIG_FGC_CAMA</a>, <a class="el" href="chan__dahdi_8c_source.html#l00248">SIG_FGC_CAMAMF</a>, <a class="el" href="chan__dahdi_8c_source.html#l00253">SIG_FXOGS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00254">SIG_FXOKS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00252">SIG_FXOLS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00250">SIG_FXSGS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00251">SIG_FXSKS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00249">SIG_FXSLS</a>, <a class="el" href="chan__dahdi_8c_source.html#l00255">SIG_PRI</a>, <a class="el" href="chan__dahdi_8c_source.html#l00260">SIG_SF</a>, <a class="el" href="chan__dahdi_8c_source.html#l00264">SIG_SF_FEATB</a>, <a class="el" href="chan__dahdi_8c_source.html#l00262">SIG_SF_FEATD</a>, <a class="el" href="chan__dahdi_8c_source.html#l00263">SIG_SF_FEATDMF</a>, <a class="el" href="chan__dahdi_8c_source.html#l00261">SIG_SFWINK</a>, <a class="el" href="chan__dahdi_8c_source.html#l00958">dahdi_pvt::smdi_iface</a>, <a class="el" href="chan__dahdi_8c_source.html#l00159">SMDI_MD_WAIT_TIMEOUT</a>, <a class="el" href="chan__dahdi_8c_source.html#l01042">dahdi_pvt::span</a>, <a class="el" href="agi_2strcompat_8c_source.html#l00027">strsep()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00580">SUB_CALLWAIT</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, <a class="el" href="chan__dahdi_8c_source.html#l00581">SUB_THREEWAY</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>, <a class="el" href="chan__dahdi_8c_source.html#l02062">swap_subs()</a>, <a class="el" href="channel_8h_source.html#l00400">ast_channel::tech</a>, <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>, <a class="el" href="chan__dahdi_8c_source.html#l00851">dahdi_pvt::transfer</a>, <a class="el" href="smdi_8h_source.html#l00074">ast_smdi_md_message::type</a>, <a class="el" href="chan__dahdi_8c_source.html#l02212">unalloc_sub()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00859">dahdi_pvt::use_callerid</a>, <a class="el" href="chan__dahdi_8c_source.html#l00955">dahdi_pvt::use_smdi</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00872">dahdi_pvt::usedistinctiveringdetection</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09269">handle_init_event()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l08925">mwi_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l07676"></a>07676 {
<a name="l07677"></a>07677    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a> = <a class="code" href="structast__channel.html#a8f64897c7ccc5c13f276d1d07c4e7095">data</a>;
<a name="l07678"></a>07678    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *p = chan-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l07679"></a>07679    <span class="keywordtype">char</span> <a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>[<a class="code" href="channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a>] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l07680"></a>07680    <span class="keywordtype">char</span> exten2[<a class="code" href="channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a>] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l07681"></a>07681    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[256];
<a name="l07682"></a>07682    <span class="keywordtype">char</span> dtmfcid[300];
<a name="l07683"></a>07683    <span class="keywordtype">char</span> dtmfbuf[300];
<a name="l07684"></a>07684    <span class="keyword">struct </span><a class="code" href="structcallerid__state.html">callerid_state</a> *cs = NULL;
<a name="l07685"></a>07685    <span class="keywordtype">char</span> *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a> = NULL, *<a class="code" href="structnumber.html" title="Number structure.">number</a> = NULL;
<a name="l07686"></a>07686    <span class="keywordtype">int</span> distMatches;
<a name="l07687"></a>07687    <span class="keywordtype">int</span> curRingData[3];
<a name="l07688"></a>07688    <span class="keywordtype">int</span> receivedRingT;
<a name="l07689"></a>07689    <span class="keywordtype">int</span> counter1;
<a name="l07690"></a>07690    <span class="keywordtype">int</span> counter;
<a name="l07691"></a>07691    <span class="keywordtype">int</span> samples = 0;
<a name="l07692"></a>07692    <span class="keyword">struct </span><a class="code" href="structast__smdi__md__message.html" title="An SMDI message desk message.">ast_smdi_md_message</a> *smdi_msg = NULL;
<a name="l07693"></a>07693    <span class="keywordtype">int</span> flags = 0;
<a name="l07694"></a>07694    <span class="keywordtype">int</span> i;
<a name="l07695"></a>07695    <span class="keywordtype">int</span> timeout;
<a name="l07696"></a>07696    <span class="keywordtype">int</span> getforward = 0;
<a name="l07697"></a>07697    <span class="keywordtype">char</span> *s1, *s2;
<a name="l07698"></a>07698    <span class="keywordtype">int</span> <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> = 0;
<a name="l07699"></a>07699    <span class="keywordtype">int</span> res;
<a name="l07700"></a>07700    <span class="keywordtype">int</span> idx;
<a name="l07701"></a>07701 
<a name="l07702"></a>07702    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;ss_thread_lock);
<a name="l07703"></a>07703    <a class="code" href="chan__dahdi_8c.html#aec2d8d3ba7708b470105092c392b9b0a">ss_thread_count</a>++;
<a name="l07704"></a>07704    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;ss_thread_lock);
<a name="l07705"></a>07705    <span class="comment">/* in the bizarre case where the channel has become a zombie before we</span>
<a name="l07706"></a>07706 <span class="comment">      even get started here, abort safely</span>
<a name="l07707"></a>07707 <span class="comment">   */</span>
<a name="l07708"></a>07708    <span class="keywordflow">if</span> (!p) {
<a name="l07709"></a>07709       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Channel became a zombie before simple switch could be started (%s)\n&quot;</span>, chan-&gt;name);
<a name="l07710"></a>07710       <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l07711"></a>07711       <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l07712"></a>07712    }
<a name="l07713"></a>07713    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Starting simple switch on &apos;%s&apos;\n&quot;</span>, chan-&gt;name);
<a name="l07714"></a>07714    idx = <a class="code" href="chan__dahdi_8c.html#a62c8e3f411fb9e5ec62a1e77c152c2df">dahdi_get_index</a>(chan, p, 1);
<a name="l07715"></a>07715    <span class="keywordflow">if</span> (idx &lt; 0) {
<a name="l07716"></a>07716       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Huh?\n&quot;</span>);
<a name="l07717"></a>07717       <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l07718"></a>07718       <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l07719"></a>07719    }
<a name="l07720"></a>07720    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>)
<a name="l07721"></a>07721       <a class="code" href="dsp_8h.html#a45fbc637da9251814352c97382f24d40" title="Reset DTMF detector.">ast_dsp_digitreset</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>);
<a name="l07722"></a>07722    <span class="keywordflow">switch</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a>) {
<a name="l07723"></a>07723 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l07724"></a>07724 <span class="preprocessor"></span>   <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ae9ab0c9508fca045a06730533be276a5">SIG_PRI</a>:
<a name="l07725"></a>07725    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ab5bfeaf991c23c5b6510ace44ae79ce9">SIG_BRI</a>:
<a name="l07726"></a>07726    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#abcfd568d75fdb269f9c69cc5c6d980cd">SIG_BRI_PTMP</a>:
<a name="l07727"></a>07727       <span class="comment">/* Now loop looking for an extension */</span>
<a name="l07728"></a>07728       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(exten, p-&gt;<a class="code" href="structdahdi__pvt.html#a78d4847658b695383d849efd12399b38" title="Extension to use in the dialplan.">exten</a>, <span class="keyword">sizeof</span>(exten));
<a name="l07729"></a>07729       len = strlen(exten);
<a name="l07730"></a>07730       res = 0;
<a name="l07731"></a>07731       <span class="keywordflow">while</span> ((len &lt; <a class="code" href="channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a>-1) &amp;&amp; <a class="code" href="pbx_8h.html#ac359af75b9494f50904583d2168a7577" title="Looks to see if adding anything to this extension might match something. (exists...">ast_matchmore_extension</a>(chan, chan-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, exten, 1, p-&gt;<a class="code" href="structdahdi__pvt.html#a29e973bd94bfbaf59d939bd1bc988c32" title="Caller ID number from an incoming call.">cid_num</a>)) {
<a name="l07732"></a>07732          <span class="keywordflow">if</span> (len &amp;&amp; !<a class="code" href="pbx_8h.html#aa73d176ed4f1ce51e5db6beafba45fe3" title="Checks to see if a number should be ignored.">ast_ignore_pattern</a>(chan-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, exten))
<a name="l07733"></a>07733             tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, -1);
<a name="l07734"></a>07734          <span class="keywordflow">else</span>
<a name="l07735"></a>07735             tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_DIALTONE);
<a name="l07736"></a>07736          <span class="keywordflow">if</span> (<a class="code" href="pbx_8h.html#a64a5b8fdc919806135ad427aca9e71b7" title="Determine whether an extension exists.">ast_exists_extension</a>(chan, chan-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, exten, 1, p-&gt;<a class="code" href="structdahdi__pvt.html#a29e973bd94bfbaf59d939bd1bc988c32" title="Caller ID number from an incoming call.">cid_num</a>))
<a name="l07737"></a>07737             timeout = <a class="code" href="chan__dahdi_8c.html#a24514343553b05c66e5b7d16e2df45cc" title="How long to wait for an extra digit, if there is an ambiguous match.">matchdigittimeout</a>;
<a name="l07738"></a>07738          <span class="keywordflow">else</span>
<a name="l07739"></a>07739             timeout = <a class="code" href="chan__dahdi_8c.html#aa319ef1606201db158ce7195fb8eed45" title="How long to wait for following digits (FXO logic).">gendigittimeout</a>;
<a name="l07740"></a>07740          res = <a class="code" href="channel_8h.html#a050bec9a4abc1a599b6573a6091b080c" title="Waits for a digit.">ast_waitfordigit</a>(chan, timeout);
<a name="l07741"></a>07741          <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l07742"></a>07742             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;waitfordigit returned &lt; 0...\n&quot;</span>);
<a name="l07743"></a>07743             <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l07744"></a>07744             <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l07745"></a>07745          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res) {
<a name="l07746"></a>07746             exten[len++] = res;
<a name="l07747"></a>07747             exten[len] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l07748"></a>07748          } <span class="keywordflow">else</span>
<a name="l07749"></a>07749             <span class="keywordflow">break</span>;
<a name="l07750"></a>07750       }
<a name="l07751"></a>07751       <span class="comment">/* if no extension was received (&apos;unspecified&apos;) on overlap call, use the &apos;s&apos; extension */</span>
<a name="l07752"></a>07752       <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(exten)) {
<a name="l07753"></a>07753          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Going to extension s|1 because of empty extension received on overlap call\n&quot;</span>);
<a name="l07754"></a>07754          exten[0] = <span class="charliteral">&apos;s&apos;</span>;
<a name="l07755"></a>07755          exten[1] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l07756"></a>07756       }
<a name="l07757"></a>07757       tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, -1);
<a name="l07758"></a>07758       <span class="keywordflow">if</span> (<a class="code" href="pbx_8h.html#a64a5b8fdc919806135ad427aca9e71b7" title="Determine whether an extension exists.">ast_exists_extension</a>(chan, chan-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, exten, 1, p-&gt;<a class="code" href="structdahdi__pvt.html#a29e973bd94bfbaf59d939bd1bc988c32" title="Caller ID number from an incoming call.">cid_num</a>)) {
<a name="l07759"></a>07759          <span class="comment">/* Start the real PBX */</span>
<a name="l07760"></a>07760          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(chan-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>, exten, <span class="keyword">sizeof</span>(chan-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>));
<a name="l07761"></a>07761          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>) {
<a name="l07762"></a>07762             <a class="code" href="dsp_8h.html#a45fbc637da9251814352c97382f24d40" title="Reset DTMF detector.">ast_dsp_digitreset</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>);
<a name="l07763"></a>07763          }
<a name="l07764"></a>07764          <span class="keywordflow">if</span> (p-&gt;pri-&gt;overlapdial &amp; <a class="code" href="chan__dahdi_8c.html#ab30dead77fa070cbe51316f43fcea8a2">DAHDI_OVERLAPDIAL_INCOMING</a>) {
<a name="l07765"></a>07765             <span class="keywordflow">if</span> (p-&gt;pri-&gt;pri) {      
<a name="l07766"></a>07766                <span class="keywordflow">if</span> (!pri_grab(p, p-&gt;pri)) {
<a name="l07767"></a>07767                   pri_proceeding(p-&gt;pri-&gt;pri, p-&gt;call, PVT_TO_CHANNEL(p), 0);
<a name="l07768"></a>07768                   p-&gt;proceeding = 1;
<a name="l07769"></a>07769                   pri_rel(p-&gt;pri);
<a name="l07770"></a>07770                } <span class="keywordflow">else</span> {
<a name="l07771"></a>07771                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to grab PRI on span %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#a63fc22149930803b4e3fb4c453177e5e">span</a>);
<a name="l07772"></a>07772                }
<a name="l07773"></a>07773             }
<a name="l07774"></a>07774          }
<a name="l07775"></a>07775          <a class="code" href="chan__dahdi_8c.html#a8c34a5bce2b26d056942349217806312">dahdi_enable_ec</a>(p);
<a name="l07776"></a>07776          <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(chan, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a>);
<a name="l07777"></a>07777          res = <a class="code" href="pbx_8h.html#a44b6406c9220f7f2b610ac712369f405" title="Execute the PBX in the current thread.">ast_pbx_run</a>(chan);
<a name="l07778"></a>07778          <span class="keywordflow">if</span> (res) {
<a name="l07779"></a>07779             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;PBX exited non-zero!\n&quot;</span>);
<a name="l07780"></a>07780          }
<a name="l07781"></a>07781       } <span class="keywordflow">else</span> {
<a name="l07782"></a>07782          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;No such possible extension &apos;%s&apos; in context &apos;%s&apos;\n&quot;</span>, exten, chan-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>);
<a name="l07783"></a>07783          chan-&gt;<a class="code" href="structast__channel.html#aa4261b664d6712ba8551bde24ad17382">hangupcause</a> = <a class="code" href="causes_8h.html#a131d8780af378d0c4ef5075949902785">AST_CAUSE_UNALLOCATED</a>;
<a name="l07784"></a>07784          <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l07785"></a>07785          p-&gt;<a class="code" href="structdahdi__pvt.html#a78d4847658b695383d849efd12399b38" title="Extension to use in the dialplan.">exten</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l07786"></a>07786          <span class="comment">/* Since we send release complete here, we won&apos;t get one */</span>
<a name="l07787"></a>07787          p-&gt;call = NULL;
<a name="l07788"></a>07788       }
<a name="l07789"></a>07789       <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l07790"></a>07790       <span class="keywordflow">break</span>;
<a name="l07791"></a>07791 <span class="preprocessor">#endif</span>
<a name="l07792"></a>07792 <span class="preprocessor"></span>   <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ab79873391af2857a602e1eff68606f23">SIG_FEATD</a>:
<a name="l07793"></a>07793    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a98d4710afc1fcb2ff110eabb4fbcc308">SIG_FEATDMF</a>:
<a name="l07794"></a>07794    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ac0c40f74945ed15aa82cd9fedc304e55">SIG_FEATDMF_TA</a>:
<a name="l07795"></a>07795    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#adfdd0e4d05281d354c15ef1a5d158cd6">SIG_E911</a>:
<a name="l07796"></a>07796    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a945e2b5f225d3abdc57b5dcc53daa62a">SIG_FGC_CAMAMF</a>:
<a name="l07797"></a>07797    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a0ba8ec199f5fb4f2be64144be0bd13b1">SIG_FEATB</a>:
<a name="l07798"></a>07798    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a1ba988b93fce049075b7c2ef6c931cf9">SIG_EMWINK</a>:
<a name="l07799"></a>07799    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#aac334a7f88651d9e44499897386d2cfd">SIG_SF_FEATD</a>:
<a name="l07800"></a>07800    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a4625d3aba972e102c8460a9f16af0fc7">SIG_SF_FEATDMF</a>:
<a name="l07801"></a>07801    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a33a2f70a24e9f8ccfcc1e76f208b1ab6">SIG_SF_FEATB</a>:
<a name="l07802"></a>07802    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a193853e7e76cff05d51425eba48d030f">SIG_SFWINK</a>:
<a name="l07803"></a>07803       <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#a861b167aa5283df4f8153393acb50bbb">dahdi_wink</a>(p, idx))
<a name="l07804"></a>07804          <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l07805"></a>07805       <span class="comment">/* Fall through */</span>
<a name="l07806"></a>07806    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#afa7547cd2cee1bae7734206102635216">SIG_EM</a>:
<a name="l07807"></a>07807    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#aa7b59772722b794c5218768dac3ee419">SIG_EM_E1</a>:
<a name="l07808"></a>07808    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#afacb372d32fba2192ed6a2989c54fbda">SIG_SF</a>:
<a name="l07809"></a>07809    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a167056b2763a4897838c7115efc1f9fc">SIG_FGC_CAMA</a>:
<a name="l07810"></a>07810       res = tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, -1);
<a name="l07811"></a>07811       <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>)
<a name="l07812"></a>07812          <a class="code" href="dsp_8h.html#a45fbc637da9251814352c97382f24d40" title="Reset DTMF detector.">ast_dsp_digitreset</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>);
<a name="l07813"></a>07813       <span class="comment">/* set digit mode appropriately */</span>
<a name="l07814"></a>07814       <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>) {
<a name="l07815"></a>07815          <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#a97fec6c0baa06f18539a7c8165314210" title="Signaling types that need to use MF detection should be placed in this macro.">NEED_MFDETECT</a>(p))
<a name="l07816"></a>07816             <a class="code" href="dsp_8h.html#aa28ffa065bd46d09b5b06de2f77183b0" title="Set digit mode.">ast_dsp_set_digitmode</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>, <a class="code" href="dsp_8h.html#a5c7b41ef167d85ab193697e010dce94b">DSP_DIGITMODE_MF</a> | p-&gt;<a class="code" href="structdahdi__pvt.html#a6829c6ed48c184cbd85055163786a7eb">dtmfrelax</a>);
<a name="l07817"></a>07817          <span class="keywordflow">else</span>
<a name="l07818"></a>07818             <a class="code" href="dsp_8h.html#aa28ffa065bd46d09b5b06de2f77183b0" title="Set digit mode.">ast_dsp_set_digitmode</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>, <a class="code" href="dsp_8h.html#af0e16e88030540319d8a545dd7c2576c">DSP_DIGITMODE_DTMF</a> | p-&gt;<a class="code" href="structdahdi__pvt.html#a6829c6ed48c184cbd85055163786a7eb">dtmfrelax</a>);
<a name="l07819"></a>07819       }
<a name="l07820"></a>07820       memset(dtmfbuf, 0, <span class="keyword">sizeof</span>(dtmfbuf));
<a name="l07821"></a>07821       <span class="comment">/* Wait for the first digit only if immediate=no */</span>
<a name="l07822"></a>07822       <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="structdahdi__pvt.html#a04e3105c0481dfd78913d4bc9796f1c3" title="TRUE if the channel should be answered immediately without attempting to gather any...">immediate</a>)
<a name="l07823"></a>07823          <span class="comment">/* Wait for the first digit (up to 5 seconds). */</span>
<a name="l07824"></a>07824          res = <a class="code" href="channel_8h.html#a050bec9a4abc1a599b6573a6091b080c" title="Waits for a digit.">ast_waitfordigit</a>(chan, 5000);
<a name="l07825"></a>07825       <span class="keywordflow">else</span>
<a name="l07826"></a>07826          res = 0;
<a name="l07827"></a>07827       <span class="keywordflow">if</span> (res &gt; 0) {
<a name="l07828"></a>07828          <span class="comment">/* save first char */</span>
<a name="l07829"></a>07829          dtmfbuf[0] = res;
<a name="l07830"></a>07830          <span class="keywordflow">switch</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a>) {
<a name="l07831"></a>07831          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ab79873391af2857a602e1eff68606f23">SIG_FEATD</a>:
<a name="l07832"></a>07832          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#aac334a7f88651d9e44499897386d2cfd">SIG_SF_FEATD</a>:
<a name="l07833"></a>07833             res = <a class="code" href="chan__dahdi_8c.html#a9a611d7601630c4b1549fd303f6092a0">my_getsigstr</a>(chan, dtmfbuf + 1, <span class="stringliteral">&quot;*&quot;</span>, 3000);
<a name="l07834"></a>07834             <span class="keywordflow">if</span> (res &gt; 0)
<a name="l07835"></a>07835                res = <a class="code" href="chan__dahdi_8c.html#a9a611d7601630c4b1549fd303f6092a0">my_getsigstr</a>(chan, dtmfbuf + strlen(dtmfbuf), <span class="stringliteral">&quot;*&quot;</span>, 3000);
<a name="l07836"></a>07836             <span class="keywordflow">if</span> ((res &lt; 1) &amp;&amp; (p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>)) <a class="code" href="dsp_8h.html#a45fbc637da9251814352c97382f24d40" title="Reset DTMF detector.">ast_dsp_digitreset</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>);
<a name="l07837"></a>07837             <span class="keywordflow">break</span>;
<a name="l07838"></a>07838          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#ac0c40f74945ed15aa82cd9fedc304e55">SIG_FEATDMF_TA</a>:
<a name="l07839"></a>07839             res = <a class="code" href="chan__dahdi_8c.html#a9a611d7601630c4b1549fd303f6092a0">my_getsigstr</a>(chan, dtmfbuf + 1, <span class="stringliteral">&quot;#&quot;</span>, 3000);
<a name="l07840"></a>07840             <span class="keywordflow">if</span> ((res &lt; 1) &amp;&amp; (p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>)) <a class="code" href="dsp_8h.html#a45fbc637da9251814352c97382f24d40" title="Reset DTMF detector.">ast_dsp_digitreset</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>);
<a name="l07841"></a>07841             <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#a861b167aa5283df4f8153393acb50bbb">dahdi_wink</a>(p, idx)) <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l07842"></a>07842             dtmfbuf[0] = 0;
<a name="l07843"></a>07843             <span class="comment">/* Wait for the first digit (up to 5 seconds). */</span>
<a name="l07844"></a>07844             res = <a class="code" href="channel_8h.html#a050bec9a4abc1a599b6573a6091b080c" title="Waits for a digit.">ast_waitfordigit</a>(chan, 5000);
<a name="l07845"></a>07845             <span class="keywordflow">if</span> (res &lt;= 0) <span class="keywordflow">break</span>;
<a name="l07846"></a>07846             dtmfbuf[0] = res;
<a name="l07847"></a>07847             <span class="comment">/* fall through intentionally */</span>
<a name="l07848"></a>07848          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a98d4710afc1fcb2ff110eabb4fbcc308">SIG_FEATDMF</a>:
<a name="l07849"></a>07849          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#adfdd0e4d05281d354c15ef1a5d158cd6">SIG_E911</a>:
<a name="l07850"></a>07850          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a945e2b5f225d3abdc57b5dcc53daa62a">SIG_FGC_CAMAMF</a>:
<a name="l07851"></a>07851          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a4625d3aba972e102c8460a9f16af0fc7">SIG_SF_FEATDMF</a>:
<a name="l07852"></a>07852             res = <a class="code" href="chan__dahdi_8c.html#a9a611d7601630c4b1549fd303f6092a0">my_getsigstr</a>(chan, dtmfbuf + 1, <span class="stringliteral">&quot;#&quot;</span>, 3000);
<a name="l07853"></a>07853             <span class="comment">/* if international caca, do it again to get real ANO */</span>
<a name="l07854"></a>07854             <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#a98d4710afc1fcb2ff110eabb4fbcc308">SIG_FEATDMF</a>) &amp;&amp; (dtmfbuf[1] != <span class="charliteral">&apos;0&apos;</span>) &amp;&amp; (strlen(dtmfbuf) != 14))
<a name="l07855"></a>07855             {
<a name="l07856"></a>07856                <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#a861b167aa5283df4f8153393acb50bbb">dahdi_wink</a>(p, idx)) <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l07857"></a>07857                dtmfbuf[0] = 0;
<a name="l07858"></a>07858                <span class="comment">/* Wait for the first digit (up to 5 seconds). */</span>
<a name="l07859"></a>07859                res = <a class="code" href="channel_8h.html#a050bec9a4abc1a599b6573a6091b080c" title="Waits for a digit.">ast_waitfordigit</a>(chan, 5000);
<a name="l07860"></a>07860                <span class="keywordflow">if</span> (res &lt;= 0) <span class="keywordflow">break</span>;
<a name="l07861"></a>07861                dtmfbuf[0] = res;
<a name="l07862"></a>07862                res = <a class="code" href="chan__dahdi_8c.html#a9a611d7601630c4b1549fd303f6092a0">my_getsigstr</a>(chan, dtmfbuf + 1, <span class="stringliteral">&quot;#&quot;</span>, 3000);
<a name="l07863"></a>07863             }
<a name="l07864"></a>07864             <span class="keywordflow">if</span> (res &gt; 0) {
<a name="l07865"></a>07865                <span class="comment">/* if E911, take off hook */</span>
<a name="l07866"></a>07866                <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#adfdd0e4d05281d354c15ef1a5d158cd6">SIG_E911</a>)
<a name="l07867"></a>07867                   <a class="code" href="chan__dahdi_8c.html#a7c65e6943db828524ea6c9215b8bf696">dahdi_set_hook</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_OFFHOOK);
<a name="l07868"></a>07868                res = <a class="code" href="chan__dahdi_8c.html#a9a611d7601630c4b1549fd303f6092a0">my_getsigstr</a>(chan, dtmfbuf + strlen(dtmfbuf), <span class="stringliteral">&quot;#&quot;</span>, 3000);
<a name="l07869"></a>07869             }
<a name="l07870"></a>07870             <span class="keywordflow">if</span> ((res &lt; 1) &amp;&amp; (p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>)) <a class="code" href="dsp_8h.html#a45fbc637da9251814352c97382f24d40" title="Reset DTMF detector.">ast_dsp_digitreset</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>);
<a name="l07871"></a>07871             <span class="keywordflow">break</span>;
<a name="l07872"></a>07872          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a0ba8ec199f5fb4f2be64144be0bd13b1">SIG_FEATB</a>:
<a name="l07873"></a>07873          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a33a2f70a24e9f8ccfcc1e76f208b1ab6">SIG_SF_FEATB</a>:
<a name="l07874"></a>07874             res = <a class="code" href="chan__dahdi_8c.html#a9a611d7601630c4b1549fd303f6092a0">my_getsigstr</a>(chan, dtmfbuf + 1, <span class="stringliteral">&quot;#&quot;</span>, 3000);
<a name="l07875"></a>07875             <span class="keywordflow">if</span> ((res &lt; 1) &amp;&amp; (p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>)) <a class="code" href="dsp_8h.html#a45fbc637da9251814352c97382f24d40" title="Reset DTMF detector.">ast_dsp_digitreset</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>);
<a name="l07876"></a>07876             <span class="keywordflow">break</span>;
<a name="l07877"></a>07877          <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a1ba988b93fce049075b7c2ef6c931cf9">SIG_EMWINK</a>:
<a name="l07878"></a>07878             <span class="comment">/* if we received a &apos;*&apos;, we are actually receiving Feature Group D</span>
<a name="l07879"></a>07879 <span class="comment">               dial syntax, so use that mode; otherwise, fall through to normal</span>
<a name="l07880"></a>07880 <span class="comment">               mode</span>
<a name="l07881"></a>07881 <span class="comment">            */</span>
<a name="l07882"></a>07882             <span class="keywordflow">if</span> (res == <span class="charliteral">&apos;*&apos;</span>) {
<a name="l07883"></a>07883                res = <a class="code" href="chan__dahdi_8c.html#a9a611d7601630c4b1549fd303f6092a0">my_getsigstr</a>(chan, dtmfbuf + 1, <span class="stringliteral">&quot;*&quot;</span>, 3000);
<a name="l07884"></a>07884                <span class="keywordflow">if</span> (res &gt; 0)
<a name="l07885"></a>07885                   res = <a class="code" href="chan__dahdi_8c.html#a9a611d7601630c4b1549fd303f6092a0">my_getsigstr</a>(chan, dtmfbuf + strlen(dtmfbuf), <span class="stringliteral">&quot;*&quot;</span>, 3000);
<a name="l07886"></a>07886                <span class="keywordflow">if</span> ((res &lt; 1) &amp;&amp; (p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>)) <a class="code" href="dsp_8h.html#a45fbc637da9251814352c97382f24d40" title="Reset DTMF detector.">ast_dsp_digitreset</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>);
<a name="l07887"></a>07887                <span class="keywordflow">break</span>;
<a name="l07888"></a>07888             }
<a name="l07889"></a>07889          <span class="keywordflow">default</span>:
<a name="l07890"></a>07890             <span class="comment">/* If we got the first digit, get the rest */</span>
<a name="l07891"></a>07891             len = 1;
<a name="l07892"></a>07892             dtmfbuf[len] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l07893"></a>07893             <span class="keywordflow">while</span> ((len &lt; <a class="code" href="channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a>-1) &amp;&amp; <a class="code" href="pbx_8h.html#ac359af75b9494f50904583d2168a7577" title="Looks to see if adding anything to this extension might match something. (exists...">ast_matchmore_extension</a>(chan, chan-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, dtmfbuf, 1, p-&gt;<a class="code" href="structdahdi__pvt.html#a29e973bd94bfbaf59d939bd1bc988c32" title="Caller ID number from an incoming call.">cid_num</a>)) {
<a name="l07894"></a>07894                <span class="keywordflow">if</span> (<a class="code" href="pbx_8h.html#a64a5b8fdc919806135ad427aca9e71b7" title="Determine whether an extension exists.">ast_exists_extension</a>(chan, chan-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, dtmfbuf, 1, p-&gt;<a class="code" href="structdahdi__pvt.html#a29e973bd94bfbaf59d939bd1bc988c32" title="Caller ID number from an incoming call.">cid_num</a>)) {
<a name="l07895"></a>07895                   timeout = <a class="code" href="chan__dahdi_8c.html#a24514343553b05c66e5b7d16e2df45cc" title="How long to wait for an extra digit, if there is an ambiguous match.">matchdigittimeout</a>;
<a name="l07896"></a>07896                } <span class="keywordflow">else</span> {
<a name="l07897"></a>07897                   timeout = <a class="code" href="chan__dahdi_8c.html#aa319ef1606201db158ce7195fb8eed45" title="How long to wait for following digits (FXO logic).">gendigittimeout</a>;
<a name="l07898"></a>07898                }
<a name="l07899"></a>07899                res = <a class="code" href="channel_8h.html#a050bec9a4abc1a599b6573a6091b080c" title="Waits for a digit.">ast_waitfordigit</a>(chan, timeout);
<a name="l07900"></a>07900                <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l07901"></a>07901                   <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;waitfordigit returned &lt; 0...\n&quot;</span>);
<a name="l07902"></a>07902                   <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l07903"></a>07903                   <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l07904"></a>07904                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res) {
<a name="l07905"></a>07905                   dtmfbuf[len++] = res;
<a name="l07906"></a>07906                   dtmfbuf[len] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l07907"></a>07907                } <span class="keywordflow">else</span> {
<a name="l07908"></a>07908                   <span class="keywordflow">break</span>;
<a name="l07909"></a>07909                }
<a name="l07910"></a>07910             }
<a name="l07911"></a>07911             <span class="keywordflow">break</span>;
<a name="l07912"></a>07912          }
<a name="l07913"></a>07913       }
<a name="l07914"></a>07914       <span class="keywordflow">if</span> (res == -1) {
<a name="l07915"></a>07915          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;getdtmf on channel %d: %s\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, strerror(errno));
<a name="l07916"></a>07916          <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l07917"></a>07917          <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l07918"></a>07918       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l07919"></a>07919          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Got hung up before digits finished\n&quot;</span>);
<a name="l07920"></a>07920          <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l07921"></a>07921          <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l07922"></a>07922       }
<a name="l07923"></a>07923 
<a name="l07924"></a>07924       <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#a167056b2763a4897838c7115efc1f9fc">SIG_FGC_CAMA</a>) {
<a name="l07925"></a>07925          <span class="keywordtype">char</span> anibuf[100];
<a name="l07926"></a>07926 
<a name="l07927"></a>07927          <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#af10e3bd01602095e1908d3926afc3b76" title="Wait for a specified amount of time, looking for hangups.">ast_safe_sleep</a>(chan,1000) == -1) {
<a name="l07928"></a>07928             <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l07929"></a>07929             <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l07930"></a>07930          }
<a name="l07931"></a>07931          <a class="code" href="chan__dahdi_8c.html#a7c65e6943db828524ea6c9215b8bf696">dahdi_set_hook</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_OFFHOOK);
<a name="l07932"></a>07932          <a class="code" href="dsp_8h.html#aa28ffa065bd46d09b5b06de2f77183b0" title="Set digit mode.">ast_dsp_set_digitmode</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>, <a class="code" href="dsp_8h.html#a5c7b41ef167d85ab193697e010dce94b">DSP_DIGITMODE_MF</a> | p-&gt;<a class="code" href="structdahdi__pvt.html#a6829c6ed48c184cbd85055163786a7eb">dtmfrelax</a>);
<a name="l07933"></a>07933          res = <a class="code" href="chan__dahdi_8c.html#a9a611d7601630c4b1549fd303f6092a0">my_getsigstr</a>(chan, anibuf, <span class="stringliteral">&quot;#&quot;</span>, 10000);
<a name="l07934"></a>07934          <span class="keywordflow">if</span> ((res &gt; 0) &amp;&amp; (strlen(anibuf) &gt; 2)) {
<a name="l07935"></a>07935             <span class="keywordflow">if</span> (anibuf[strlen(anibuf) - 1] == <span class="charliteral">&apos;#&apos;</span>)
<a name="l07936"></a>07936                anibuf[strlen(anibuf) - 1] = 0;
<a name="l07937"></a>07937             <a class="code" href="channel_8h.html#a88d833a56ea7de33e230281c5c12b75d" title="Set caller ID number, name and ANI.">ast_set_callerid</a>(chan, anibuf + 2, NULL, anibuf + 2);
<a name="l07938"></a>07938          }
<a name="l07939"></a>07939          <a class="code" href="dsp_8h.html#aa28ffa065bd46d09b5b06de2f77183b0" title="Set digit mode.">ast_dsp_set_digitmode</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>, <a class="code" href="dsp_8h.html#af0e16e88030540319d8a545dd7c2576c">DSP_DIGITMODE_DTMF</a> | p-&gt;<a class="code" href="structdahdi__pvt.html#a6829c6ed48c184cbd85055163786a7eb">dtmfrelax</a>);
<a name="l07940"></a>07940       }
<a name="l07941"></a>07941 
<a name="l07942"></a>07942       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(exten, dtmfbuf, <span class="keyword">sizeof</span>(exten));
<a name="l07943"></a>07943       <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(exten))
<a name="l07944"></a>07944          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(exten, <span class="stringliteral">&quot;s&quot;</span>, <span class="keyword">sizeof</span>(exten));
<a name="l07945"></a>07945       <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#ab79873391af2857a602e1eff68606f23">SIG_FEATD</a> || p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#a1ba988b93fce049075b7c2ef6c931cf9">SIG_EMWINK</a>) {
<a name="l07946"></a>07946          <span class="comment">/* Look for Feature Group D on all E&amp;M Wink and Feature Group D trunks */</span>
<a name="l07947"></a>07947          <span class="keywordflow">if</span> (exten[0] == <span class="charliteral">&apos;*&apos;</span>) {
<a name="l07948"></a>07948             <span class="keywordtype">char</span> *stringp=NULL;
<a name="l07949"></a>07949             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(exten2, exten, <span class="keyword">sizeof</span>(exten2));
<a name="l07950"></a>07950             <span class="comment">/* Parse out extension and callerid */</span>
<a name="l07951"></a>07951             stringp=exten2 +1;
<a name="l07952"></a>07952             s1 = <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;stringp, <span class="stringliteral">&quot;*&quot;</span>);
<a name="l07953"></a>07953             s2 = <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;stringp, <span class="stringliteral">&quot;*&quot;</span>);
<a name="l07954"></a>07954             <span class="keywordflow">if</span> (s2) {
<a name="l07955"></a>07955                <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a29e973bd94bfbaf59d939bd1bc988c32" title="Caller ID number from an incoming call.">cid_num</a>))
<a name="l07956"></a>07956                   <a class="code" href="channel_8h.html#a88d833a56ea7de33e230281c5c12b75d" title="Set caller ID number, name and ANI.">ast_set_callerid</a>(chan, p-&gt;<a class="code" href="structdahdi__pvt.html#a29e973bd94bfbaf59d939bd1bc988c32" title="Caller ID number from an incoming call.">cid_num</a>, NULL, p-&gt;<a class="code" href="structdahdi__pvt.html#a29e973bd94bfbaf59d939bd1bc988c32" title="Caller ID number from an incoming call.">cid_num</a>);
<a name="l07957"></a>07957                <span class="keywordflow">else</span>
<a name="l07958"></a>07958                   <a class="code" href="channel_8h.html#a88d833a56ea7de33e230281c5c12b75d" title="Set caller ID number, name and ANI.">ast_set_callerid</a>(chan, s1, NULL, s1);
<a name="l07959"></a>07959                <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(exten, s2, <span class="keyword">sizeof</span>(exten));
<a name="l07960"></a>07960             } <span class="keywordflow">else</span>
<a name="l07961"></a>07961                <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(exten, s1, <span class="keyword">sizeof</span>(exten));
<a name="l07962"></a>07962          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#ab79873391af2857a602e1eff68606f23">SIG_FEATD</a>)
<a name="l07963"></a>07963             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Got a non-Feature Group D input on channel %d.  Assuming E&amp;M Wink instead\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l07964"></a>07964       }
<a name="l07965"></a>07965       <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#a98d4710afc1fcb2ff110eabb4fbcc308">SIG_FEATDMF</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#ac0c40f74945ed15aa82cd9fedc304e55">SIG_FEATDMF_TA</a>)) {
<a name="l07966"></a>07966          <span class="keywordflow">if</span> (exten[0] == <span class="charliteral">&apos;*&apos;</span>) {
<a name="l07967"></a>07967             <span class="keywordtype">char</span> *stringp=NULL;
<a name="l07968"></a>07968             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(exten2, exten, <span class="keyword">sizeof</span>(exten2));
<a name="l07969"></a>07969             <span class="comment">/* Parse out extension and callerid */</span>
<a name="l07970"></a>07970             stringp=exten2 +1;
<a name="l07971"></a>07971             s1 = <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;stringp, <span class="stringliteral">&quot;#&quot;</span>);
<a name="l07972"></a>07972             s2 = <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;stringp, <span class="stringliteral">&quot;#&quot;</span>);
<a name="l07973"></a>07973             <span class="keywordflow">if</span> (s2) {
<a name="l07974"></a>07974                <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a29e973bd94bfbaf59d939bd1bc988c32" title="Caller ID number from an incoming call.">cid_num</a>))
<a name="l07975"></a>07975                   <a class="code" href="channel_8h.html#a88d833a56ea7de33e230281c5c12b75d" title="Set caller ID number, name and ANI.">ast_set_callerid</a>(chan, p-&gt;<a class="code" href="structdahdi__pvt.html#a29e973bd94bfbaf59d939bd1bc988c32" title="Caller ID number from an incoming call.">cid_num</a>, NULL, p-&gt;<a class="code" href="structdahdi__pvt.html#a29e973bd94bfbaf59d939bd1bc988c32" title="Caller ID number from an incoming call.">cid_num</a>);
<a name="l07976"></a>07976                <span class="keywordflow">else</span>
<a name="l07977"></a>07977                   <span class="keywordflow">if</span> (*(s1 + 2))
<a name="l07978"></a>07978                      <a class="code" href="channel_8h.html#a88d833a56ea7de33e230281c5c12b75d" title="Set caller ID number, name and ANI.">ast_set_callerid</a>(chan, s1 + 2, NULL, s1 + 2);
<a name="l07979"></a>07979                <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(exten, s2 + 1, <span class="keyword">sizeof</span>(exten));
<a name="l07980"></a>07980             } <span class="keywordflow">else</span>
<a name="l07981"></a>07981                <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(exten, s1 + 2, <span class="keyword">sizeof</span>(exten));
<a name="l07982"></a>07982          } <span class="keywordflow">else</span>
<a name="l07983"></a>07983             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Got a non-Feature Group D input on channel %d.  Assuming E&amp;M Wink instead\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l07984"></a>07984       }
<a name="l07985"></a>07985       <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#adfdd0e4d05281d354c15ef1a5d158cd6">SIG_E911</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#a945e2b5f225d3abdc57b5dcc53daa62a">SIG_FGC_CAMAMF</a>)) {
<a name="l07986"></a>07986          <span class="keywordflow">if</span> (exten[0] == <span class="charliteral">&apos;*&apos;</span>) {
<a name="l07987"></a>07987             <span class="keywordtype">char</span> *stringp=NULL;
<a name="l07988"></a>07988             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(exten2, exten, <span class="keyword">sizeof</span>(exten2));
<a name="l07989"></a>07989             <span class="comment">/* Parse out extension and callerid */</span>
<a name="l07990"></a>07990             stringp=exten2 +1;
<a name="l07991"></a>07991             s1 = <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;stringp, <span class="stringliteral">&quot;#&quot;</span>);
<a name="l07992"></a>07992             s2 = <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;stringp, <span class="stringliteral">&quot;#&quot;</span>);
<a name="l07993"></a>07993             <span class="keywordflow">if</span> (s2 &amp;&amp; (*(s2 + 1) == <span class="charliteral">&apos;0&apos;</span>)) {
<a name="l07994"></a>07994                <span class="keywordflow">if</span> (*(s2 + 2))
<a name="l07995"></a>07995                   <a class="code" href="channel_8h.html#a88d833a56ea7de33e230281c5c12b75d" title="Set caller ID number, name and ANI.">ast_set_callerid</a>(chan, s2 + 2, NULL, s2 + 2);
<a name="l07996"></a>07996             }
<a name="l07997"></a>07997             <span class="keywordflow">if</span> (s1)  <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(exten, s1, <span class="keyword">sizeof</span>(exten));
<a name="l07998"></a>07998             <span class="keywordflow">else</span> <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(exten, <span class="stringliteral">&quot;911&quot;</span>, <span class="keyword">sizeof</span>(exten));
<a name="l07999"></a>07999          } <span class="keywordflow">else</span>
<a name="l08000"></a>08000             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Got a non-E911/FGC CAMA input on channel %d.  Assuming E&amp;M Wink instead\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l08001"></a>08001       }
<a name="l08002"></a>08002       <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#a0ba8ec199f5fb4f2be64144be0bd13b1">SIG_FEATB</a>) {
<a name="l08003"></a>08003          <span class="keywordflow">if</span> (exten[0] == <span class="charliteral">&apos;*&apos;</span>) {
<a name="l08004"></a>08004             <span class="keywordtype">char</span> *stringp=NULL;
<a name="l08005"></a>08005             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(exten2, exten, <span class="keyword">sizeof</span>(exten2));
<a name="l08006"></a>08006             <span class="comment">/* Parse out extension and callerid */</span>
<a name="l08007"></a>08007             stringp=exten2 +1;
<a name="l08008"></a>08008             s1 = <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;stringp, <span class="stringliteral">&quot;#&quot;</span>);
<a name="l08009"></a>08009             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(exten, exten2 + 1, <span class="keyword">sizeof</span>(exten));
<a name="l08010"></a>08010          } <span class="keywordflow">else</span>
<a name="l08011"></a>08011             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Got a non-Feature Group B input on channel %d.  Assuming E&amp;M Wink instead\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l08012"></a>08012       }
<a name="l08013"></a>08013       <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#a98d4710afc1fcb2ff110eabb4fbcc308">SIG_FEATDMF</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a> == <a class="code" href="chan__dahdi_8c.html#ac0c40f74945ed15aa82cd9fedc304e55">SIG_FEATDMF_TA</a>)) {
<a name="l08014"></a>08014          <a class="code" href="chan__dahdi_8c.html#a861b167aa5283df4f8153393acb50bbb">dahdi_wink</a>(p, idx);
<a name="l08015"></a>08015          <span class="comment">/* some switches require a minimum guard time between</span>
<a name="l08016"></a>08016 <span class="comment">            the last FGD wink and something that answers</span>
<a name="l08017"></a>08017 <span class="comment">            immediately. This ensures it */</span>
<a name="l08018"></a>08018          <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#af10e3bd01602095e1908d3926afc3b76" title="Wait for a specified amount of time, looking for hangups.">ast_safe_sleep</a>(chan,100)) <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l08019"></a>08019       }
<a name="l08020"></a>08020       <a class="code" href="chan__dahdi_8c.html#a8c34a5bce2b26d056942349217806312">dahdi_enable_ec</a>(p);
<a name="l08021"></a>08021       <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#a97fec6c0baa06f18539a7c8165314210" title="Signaling types that need to use MF detection should be placed in this macro.">NEED_MFDETECT</a>(p)) {
<a name="l08022"></a>08022          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>) {
<a name="l08023"></a>08023             <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="structdahdi__pvt.html#acb50d09ad188475206ff2f852afb6831" title="TRUE if DTMF detection needs to be done by hardware.">hardwaredtmf</a>)
<a name="l08024"></a>08024                <a class="code" href="dsp_8h.html#aa28ffa065bd46d09b5b06de2f77183b0" title="Set digit mode.">ast_dsp_set_digitmode</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>, <a class="code" href="dsp_8h.html#af0e16e88030540319d8a545dd7c2576c">DSP_DIGITMODE_DTMF</a> | p-&gt;<a class="code" href="structdahdi__pvt.html#a6829c6ed48c184cbd85055163786a7eb">dtmfrelax</a>);
<a name="l08025"></a>08025             <span class="keywordflow">else</span> {
<a name="l08026"></a>08026                <a class="code" href="dsp_8h.html#a0a57a1e374549eb2705068688f4046db">ast_dsp_free</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>);
<a name="l08027"></a>08027                p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a> = NULL;
<a name="l08028"></a>08028             }
<a name="l08029"></a>08029          }
<a name="l08030"></a>08030       }
<a name="l08031"></a>08031 
<a name="l08032"></a>08032       <span class="keywordflow">if</span> (<a class="code" href="pbx_8h.html#a64a5b8fdc919806135ad427aca9e71b7" title="Determine whether an extension exists.">ast_exists_extension</a>(chan, chan-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, exten, 1, chan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>)) {
<a name="l08033"></a>08033          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(chan-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>, exten, <span class="keyword">sizeof</span>(chan-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>));
<a name="l08034"></a>08034          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>) <a class="code" href="dsp_8h.html#a45fbc637da9251814352c97382f24d40" title="Reset DTMF detector.">ast_dsp_digitreset</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d" title="Opaque DSP configuration structure.">dsp</a>);
<a name="l08035"></a>08035          res = <a class="code" href="pbx_8h.html#a44b6406c9220f7f2b610ac712369f405" title="Execute the PBX in the current thread.">ast_pbx_run</a>(chan);
<a name="l08036"></a>08036          <span class="keywordflow">if</span> (res) {
<a name="l08037"></a>08037             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;PBX exited non-zero\n&quot;</span>);
<a name="l08038"></a>08038             res = tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_CONGESTION);
<a name="l08039"></a>08039          }
<a name="l08040"></a>08040          <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l08041"></a>08041       } <span class="keywordflow">else</span> {
<a name="l08042"></a>08042          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Unknown extension &apos;%s&apos; in context &apos;%s&apos; requested\n&quot;</span>, exten, chan-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>);
<a name="l08043"></a>08043          sleep(2);
<a name="l08044"></a>08044          res = tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_INFO);
<a name="l08045"></a>08045          <span class="keywordflow">if</span> (res &lt; 0)
<a name="l08046"></a>08046             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to start special tone on %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l08047"></a>08047          <span class="keywordflow">else</span>
<a name="l08048"></a>08048             sleep(1);
<a name="l08049"></a>08049          res = <a class="code" href="file_8h.html#a67c7e271b4ca70aca6d48fd48d121857" title="Streams a file.">ast_streamfile</a>(chan, <span class="stringliteral">&quot;ss-noservice&quot;</span>, chan-&gt;language);
<a name="l08050"></a>08050          <span class="keywordflow">if</span> (res &gt;= 0)
<a name="l08051"></a>08051             <a class="code" href="file_8h.html#affc21cb57c6bf72a2cb7ec8a379b2137" title="Waits for a stream to stop or digit to be pressed.">ast_waitstream</a>(chan, <span class="stringliteral">&quot;&quot;</span>);
<a name="l08052"></a>08052          res = tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_CONGESTION);
<a name="l08053"></a>08053          <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l08054"></a>08054          <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l08055"></a>08055       }
<a name="l08056"></a>08056       <span class="keywordflow">break</span>;
<a name="l08057"></a>08057    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#adb40571aa5ff846fc334be5260eab257">SIG_FXOLS</a>:
<a name="l08058"></a>08058    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a3dcffbaf4a26f2b7b792998df1eea27b">SIG_FXOGS</a>:
<a name="l08059"></a>08059    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a7c9b3bb8225896ff2b9aed27e6f80f10">SIG_FXOKS</a>:
<a name="l08060"></a>08060       <span class="comment">/* Read the first digit */</span>
<a name="l08061"></a>08061       timeout = <a class="code" href="chan__dahdi_8c.html#afd3be8e865f060b68db4d7c966489e0a" title="Wait up to 16 seconds for first digit (FXO logic).">firstdigittimeout</a>;
<a name="l08062"></a>08062       <span class="comment">/* If starting a threeway call, never timeout on the first digit so someone</span>
<a name="l08063"></a>08063 <span class="comment">         can use flash-hook as a &quot;hold&quot; feature */</span>
<a name="l08064"></a>08064       <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)
<a name="l08065"></a>08065          timeout = 999999;
<a name="l08066"></a>08066       <span class="keywordflow">while</span> (len &lt; <a class="code" href="channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a>-1) {
<a name="l08067"></a>08067          <span class="comment">/* Read digit unless it&apos;s supposed to be immediate, in which case the</span>
<a name="l08068"></a>08068 <span class="comment">            only answer is &apos;s&apos; */</span>
<a name="l08069"></a>08069          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a04e3105c0481dfd78913d4bc9796f1c3" title="TRUE if the channel should be answered immediately without attempting to gather any...">immediate</a>)
<a name="l08070"></a>08070             res = <span class="charliteral">&apos;s&apos;</span>;
<a name="l08071"></a>08071          <span class="keywordflow">else</span>
<a name="l08072"></a>08072             res = <a class="code" href="channel_8h.html#a050bec9a4abc1a599b6573a6091b080c" title="Waits for a digit.">ast_waitfordigit</a>(chan, timeout);
<a name="l08073"></a>08073          timeout = 0;
<a name="l08074"></a>08074          <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l08075"></a>08075             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;waitfordigit returned &lt; 0...\n&quot;</span>);
<a name="l08076"></a>08076             res = tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, -1);
<a name="l08077"></a>08077             <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l08078"></a>08078             <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l08079"></a>08079          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res) {
<a name="l08080"></a>08080             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1,<span class="stringliteral">&quot;waitfordigit returned &apos;%c&apos; (%d), timeout = %d\n&quot;</span>, res, res, timeout);
<a name="l08081"></a>08081             exten[len++]=res;
<a name="l08082"></a>08082             exten[len] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l08083"></a>08083          }
<a name="l08084"></a>08084          <span class="keywordflow">if</span> (!<a class="code" href="pbx_8h.html#aa73d176ed4f1ce51e5db6beafba45fe3" title="Checks to see if a number should be ignored.">ast_ignore_pattern</a>(chan-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, exten))
<a name="l08085"></a>08085             tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, -1);
<a name="l08086"></a>08086          <span class="keywordflow">else</span>
<a name="l08087"></a>08087             tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_DIALTONE);
<a name="l08088"></a>08088          <span class="keywordflow">if</span> (<a class="code" href="pbx_8h.html#a64a5b8fdc919806135ad427aca9e71b7" title="Determine whether an extension exists.">ast_exists_extension</a>(chan, chan-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, exten, 1, p-&gt;<a class="code" href="structdahdi__pvt.html#a29e973bd94bfbaf59d939bd1bc988c32" title="Caller ID number from an incoming call.">cid_num</a>) &amp;&amp; strcmp(exten, <a class="code" href="features_8h.html#a716860609c92cd4b7fb8f6eb724ac700" title="Determine system parking extension.">ast_parking_ext</a>())) {
<a name="l08089"></a>08089             <span class="keywordflow">if</span> (!res || !<a class="code" href="pbx_8h.html#ac359af75b9494f50904583d2168a7577" title="Looks to see if adding anything to this extension might match something. (exists...">ast_matchmore_extension</a>(chan, chan-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, exten, 1, p-&gt;<a class="code" href="structdahdi__pvt.html#a29e973bd94bfbaf59d939bd1bc988c32" title="Caller ID number from an incoming call.">cid_num</a>)) {
<a name="l08090"></a>08090                <span class="keywordflow">if</span> (getforward) {
<a name="l08091"></a>08091                   <span class="comment">/* Record this as the forwarding extension */</span>
<a name="l08092"></a>08092                   <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a82162415ab1c1e6d5ee85973d68b3655" title="Accumulated call forwarding number.">call_forward</a>, exten, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structdahdi__pvt.html#a82162415ab1c1e6d5ee85973d68b3655" title="Accumulated call forwarding number.">call_forward</a>));
<a name="l08093"></a>08093                   <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Setting call forward to &apos;%s&apos; on channel %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#a82162415ab1c1e6d5ee85973d68b3655" title="Accumulated call forwarding number.">call_forward</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l08094"></a>08094                   res = tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_DIALRECALL);
<a name="l08095"></a>08095                   <span class="keywordflow">if</span> (res)
<a name="l08096"></a>08096                      <span class="keywordflow">break</span>;
<a name="l08097"></a>08097                   usleep(500000);
<a name="l08098"></a>08098                   res = tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, -1);
<a name="l08099"></a>08099                   sleep(1);
<a name="l08100"></a>08100                   memset(exten, 0, <span class="keyword">sizeof</span>(exten));
<a name="l08101"></a>08101                   res = tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_DIALTONE);
<a name="l08102"></a>08102                   len = 0;
<a name="l08103"></a>08103                   getforward = 0;
<a name="l08104"></a>08104                } <span class="keywordflow">else</span> {
<a name="l08105"></a>08105                   res = tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, -1);
<a name="l08106"></a>08106                   <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(chan-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>, exten, <span class="keyword">sizeof</span>(chan-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>));
<a name="l08107"></a>08107                   <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a29e973bd94bfbaf59d939bd1bc988c32" title="Caller ID number from an incoming call.">cid_num</a>)) {
<a name="l08108"></a>08108                      <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="structdahdi__pvt.html#a8c5bb01611cd9890c062782fa0366459" title="TRUE if the outgoing caller ID is blocked/hidden.">hidecallerid</a>)
<a name="l08109"></a>08109                         <a class="code" href="channel_8h.html#a88d833a56ea7de33e230281c5c12b75d" title="Set caller ID number, name and ANI.">ast_set_callerid</a>(chan, p-&gt;<a class="code" href="structdahdi__pvt.html#a29e973bd94bfbaf59d939bd1bc988c32" title="Caller ID number from an incoming call.">cid_num</a>, NULL, p-&gt;<a class="code" href="structdahdi__pvt.html#a29e973bd94bfbaf59d939bd1bc988c32" title="Caller ID number from an incoming call.">cid_num</a>);
<a name="l08110"></a>08110                      <span class="keywordflow">else</span>
<a name="l08111"></a>08111                         <a class="code" href="channel_8h.html#a88d833a56ea7de33e230281c5c12b75d" title="Set caller ID number, name and ANI.">ast_set_callerid</a>(chan, NULL, NULL, p-&gt;<a class="code" href="structdahdi__pvt.html#a29e973bd94bfbaf59d939bd1bc988c32" title="Caller ID number from an incoming call.">cid_num</a>);
<a name="l08112"></a>08112                   }
<a name="l08113"></a>08113                   <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ade5a89f9bee15a492c760ec1765a292d" title="Caller ID name from an incoming call.">cid_name</a>)) {
<a name="l08114"></a>08114                      <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="structdahdi__pvt.html#a8c5bb01611cd9890c062782fa0366459" title="TRUE if the outgoing caller ID is blocked/hidden.">hidecallerid</a>)
<a name="l08115"></a>08115                         <a class="code" href="channel_8h.html#a88d833a56ea7de33e230281c5c12b75d" title="Set caller ID number, name and ANI.">ast_set_callerid</a>(chan, NULL, p-&gt;<a class="code" href="structdahdi__pvt.html#ade5a89f9bee15a492c760ec1765a292d" title="Caller ID name from an incoming call.">cid_name</a>, NULL);
<a name="l08116"></a>08116                   }
<a name="l08117"></a>08117                   <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(chan, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a>);
<a name="l08118"></a>08118                   <a class="code" href="chan__dahdi_8c.html#a8c34a5bce2b26d056942349217806312">dahdi_enable_ec</a>(p);
<a name="l08119"></a>08119                   res = <a class="code" href="pbx_8h.html#a44b6406c9220f7f2b610ac712369f405" title="Execute the PBX in the current thread.">ast_pbx_run</a>(chan);
<a name="l08120"></a>08120                   <span class="keywordflow">if</span> (res) {
<a name="l08121"></a>08121                      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;PBX exited non-zero\n&quot;</span>);
<a name="l08122"></a>08122                      res = tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_CONGESTION);
<a name="l08123"></a>08123                   }
<a name="l08124"></a>08124                   <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l08125"></a>08125                }
<a name="l08126"></a>08126             } <span class="keywordflow">else</span> {
<a name="l08127"></a>08127                <span class="comment">/* It&apos;s a match, but they just typed a digit, and there is an ambiguous match,</span>
<a name="l08128"></a>08128 <span class="comment">                  so just set the timeout to matchdigittimeout and wait some more */</span>
<a name="l08129"></a>08129                timeout = <a class="code" href="chan__dahdi_8c.html#a24514343553b05c66e5b7d16e2df45cc" title="How long to wait for an extra digit, if there is an ambiguous match.">matchdigittimeout</a>;
<a name="l08130"></a>08130             }
<a name="l08131"></a>08131          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res == 0) {
<a name="l08132"></a>08132             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;not enough digits (and no ambiguous match)...\n&quot;</span>);
<a name="l08133"></a>08133             res = tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_CONGESTION);
<a name="l08134"></a>08134             <a class="code" href="chan__dahdi_8c.html#a497fdd00b631dd33acca24f8178cbd9d" title="Avoid the silly dahdi_waitevent which ignores a bunch of events.">dahdi_wait_event</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>);
<a name="l08135"></a>08135             <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l08136"></a>08136             <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l08137"></a>08137          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a76742560de0554db5b0b59591ba93adc" title="TRUE if busy extensions will hear the call-waiting tone and can use hook-flash to...">callwaiting</a> &amp;&amp; !strcmp(exten, <span class="stringliteral">&quot;*70&quot;</span>)) {
<a name="l08138"></a>08138             <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Disabling call waiting on %s\n&quot;</span>, chan-&gt;name);
<a name="l08139"></a>08139             <span class="comment">/* Disable call waiting if enabled */</span>
<a name="l08140"></a>08140             p-&gt;<a class="code" href="structdahdi__pvt.html#a76742560de0554db5b0b59591ba93adc" title="TRUE if busy extensions will hear the call-waiting tone and can use hook-flash to...">callwaiting</a> = 0;
<a name="l08141"></a>08141             res = tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_DIALRECALL);
<a name="l08142"></a>08142             <span class="keywordflow">if</span> (res) {
<a name="l08143"></a>08143                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to do dial recall on channel %s: %s\n&quot;</span>,
<a name="l08144"></a>08144                   chan-&gt;name, strerror(errno));
<a name="l08145"></a>08145             }
<a name="l08146"></a>08146             len = 0;
<a name="l08147"></a>08147             ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>,DAHDI_CONFDIAG,&amp;len);
<a name="l08148"></a>08148             memset(exten, 0, <span class="keyword">sizeof</span>(exten));
<a name="l08149"></a>08149             timeout = <a class="code" href="chan__dahdi_8c.html#afd3be8e865f060b68db4d7c966489e0a" title="Wait up to 16 seconds for first digit (FXO logic).">firstdigittimeout</a>;
<a name="l08150"></a>08150 
<a name="l08151"></a>08151          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(exten,<a class="code" href="features_8h.html#a849b0c1bd72a0339408c7e6026768e40" title="Determine system call pickup extension.">ast_pickup_ext</a>())) {
<a name="l08152"></a>08152             <span class="comment">/* Scan all channels and see if there are any</span>
<a name="l08153"></a>08153 <span class="comment">             * ringing channels that have call groups</span>
<a name="l08154"></a>08154 <span class="comment">             * that equal this channels pickup group</span>
<a name="l08155"></a>08155 <span class="comment">             */</span>
<a name="l08156"></a>08156             <span class="keywordflow">if</span> (idx == <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>) {
<a name="l08157"></a>08157                <span class="comment">/* Switch us from Third call to Call Wait */</span>
<a name="l08158"></a>08158                <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l08159"></a>08159                   <span class="comment">/* If you make a threeway call and the *8# a call, it should actually</span>
<a name="l08160"></a>08160 <span class="comment">                     look like a callwait */</span>
<a name="l08161"></a>08161                   <a class="code" href="chan__dahdi_8c.html#a8d921023bd460fd8278825f8f360f918">alloc_sub</a>(p, <a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>);
<a name="l08162"></a>08162                   <a class="code" href="chan__dahdi_8c.html#aaa6e6b7fe5725465004d3fabf351620e">swap_subs</a>(p, <a class="code" href="chan__dahdi_8c.html#a5f4a19cf3d298b91b849f92ca1f834a0">SUB_CALLWAIT</a>, <a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>);
<a name="l08163"></a>08163                   <a class="code" href="chan__dahdi_8c.html#a164404a295fbba4f9d3c2c6cf123468f">unalloc_sub</a>(p, <a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>);
<a name="l08164"></a>08164                }
<a name="l08165"></a>08165                <a class="code" href="chan__dahdi_8c.html#a8c34a5bce2b26d056942349217806312">dahdi_enable_ec</a>(p);
<a name="l08166"></a>08166                <span class="keywordflow">if</span> (<a class="code" href="features_8h.html#a4890be42c2add5f52028705d6bc02201" title="Pickup a call.">ast_pickup_call</a>(chan)) {
<a name="l08167"></a>08167                   <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;No call pickup possible...\n&quot;</span>);
<a name="l08168"></a>08168                   res = tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_CONGESTION);
<a name="l08169"></a>08169                   <a class="code" href="chan__dahdi_8c.html#a497fdd00b631dd33acca24f8178cbd9d" title="Avoid the silly dahdi_waitevent which ignores a bunch of events.">dahdi_wait_event</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>);
<a name="l08170"></a>08170                }
<a name="l08171"></a>08171                <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l08172"></a>08172                <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l08173"></a>08173             } <span class="keywordflow">else</span> {
<a name="l08174"></a>08174                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Huh?  Got *8# on call not on real\n&quot;</span>);
<a name="l08175"></a>08175                <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l08176"></a>08176                <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l08177"></a>08177             }
<a name="l08178"></a>08178 
<a name="l08179"></a>08179          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="structdahdi__pvt.html#a8c5bb01611cd9890c062782fa0366459" title="TRUE if the outgoing caller ID is blocked/hidden.">hidecallerid</a> &amp;&amp; !strcmp(exten, <span class="stringliteral">&quot;*67&quot;</span>)) {
<a name="l08180"></a>08180             <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Disabling Caller*ID on %s\n&quot;</span>, chan-&gt;name);
<a name="l08181"></a>08181             <span class="comment">/* Disable Caller*ID if enabled */</span>
<a name="l08182"></a>08182             p-&gt;<a class="code" href="structdahdi__pvt.html#a8c5bb01611cd9890c062782fa0366459" title="TRUE if the outgoing caller ID is blocked/hidden.">hidecallerid</a> = 1;
<a name="l08183"></a>08183             <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>)
<a name="l08184"></a>08184                <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(chan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>);
<a name="l08185"></a>08185             chan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a> = NULL;
<a name="l08186"></a>08186             <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ab2461abe6e234fe4f763b0a2179184b5">cid_name</a>)
<a name="l08187"></a>08187                <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(chan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ab2461abe6e234fe4f763b0a2179184b5">cid_name</a>);
<a name="l08188"></a>08188             chan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ab2461abe6e234fe4f763b0a2179184b5">cid_name</a> = NULL;
<a name="l08189"></a>08189             res = tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_DIALRECALL);
<a name="l08190"></a>08190             <span class="keywordflow">if</span> (res) {
<a name="l08191"></a>08191                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to do dial recall on channel %s: %s\n&quot;</span>,
<a name="l08192"></a>08192                   chan-&gt;name, strerror(errno));
<a name="l08193"></a>08193             }
<a name="l08194"></a>08194             len = 0;
<a name="l08195"></a>08195             memset(exten, 0, <span class="keyword">sizeof</span>(exten));
<a name="l08196"></a>08196             timeout = <a class="code" href="chan__dahdi_8c.html#afd3be8e865f060b68db4d7c966489e0a" title="Wait up to 16 seconds for first digit (FXO logic).">firstdigittimeout</a>;
<a name="l08197"></a>08197          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a8f5bca0f17b0735bf05517a0b7e18ebd" title="TRUE if call return is enabled. (*69, if your dialplan doesn&amp;#39;t catch this first)...">callreturn</a> &amp;&amp; !strcmp(exten, <span class="stringliteral">&quot;*69&quot;</span>)) {
<a name="l08198"></a>08198             res = 0;
<a name="l08199"></a>08199             <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ac6d55b34cf1c26bff3d105f067f16439" title="Last Caller ID number from an incoming call.">lastcid_num</a>)) {
<a name="l08200"></a>08200                res = <a class="code" href="say_8h.html#ac8bd6c34b6aa664adb9ebfab68a500ce" title="says digits of a string">ast_say_digit_str</a>(chan, p-&gt;<a class="code" href="structdahdi__pvt.html#ac6d55b34cf1c26bff3d105f067f16439" title="Last Caller ID number from an incoming call.">lastcid_num</a>, <span class="stringliteral">&quot;&quot;</span>, chan-&gt;language);
<a name="l08201"></a>08201             }
<a name="l08202"></a>08202             <span class="keywordflow">if</span> (!res)
<a name="l08203"></a>08203                res = tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_DIALRECALL);
<a name="l08204"></a>08204             <span class="keywordflow">break</span>;
<a name="l08205"></a>08205          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(exten, <span class="stringliteral">&quot;*78&quot;</span>)) {
<a name="l08206"></a>08206             <a class="code" href="chan__dahdi_8c.html#a4a0331eaa4997597bbca98a66c514bcd" title="enable or disable the chan_dahdi Do-Not-Disturb mode for a DAHDI channel">dahdi_dnd</a>(p, 1);
<a name="l08207"></a>08207             <span class="comment">/* Do not disturb */</span>
<a name="l08208"></a>08208             res = tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_DIALRECALL);
<a name="l08209"></a>08209             getforward = 0;
<a name="l08210"></a>08210             memset(exten, 0, <span class="keyword">sizeof</span>(exten));
<a name="l08211"></a>08211             len = 0;
<a name="l08212"></a>08212          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(exten, <span class="stringliteral">&quot;*79&quot;</span>)) {
<a name="l08213"></a>08213             <a class="code" href="chan__dahdi_8c.html#a4a0331eaa4997597bbca98a66c514bcd" title="enable or disable the chan_dahdi Do-Not-Disturb mode for a DAHDI channel">dahdi_dnd</a>(p, 0);
<a name="l08214"></a>08214             <span class="comment">/* Do not disturb */</span>
<a name="l08215"></a>08215             res = tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_DIALRECALL);
<a name="l08216"></a>08216             getforward = 0;
<a name="l08217"></a>08217             memset(exten, 0, <span class="keyword">sizeof</span>(exten));
<a name="l08218"></a>08218             len = 0;
<a name="l08219"></a>08219          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#ac4e156067fb7e78b012fa7e35dafc887" title="TRUE if support for call forwarding enabled. Dial *72 to enable call forwarding....">cancallforward</a> &amp;&amp; !strcmp(exten, <span class="stringliteral">&quot;*72&quot;</span>)) {
<a name="l08220"></a>08220             res = tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_DIALRECALL);
<a name="l08221"></a>08221             getforward = 1;
<a name="l08222"></a>08222             memset(exten, 0, <span class="keyword">sizeof</span>(exten));
<a name="l08223"></a>08223             len = 0;
<a name="l08224"></a>08224          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#ac4e156067fb7e78b012fa7e35dafc887" title="TRUE if support for call forwarding enabled. Dial *72 to enable call forwarding....">cancallforward</a> &amp;&amp; !strcmp(exten, <span class="stringliteral">&quot;*73&quot;</span>)) {
<a name="l08225"></a>08225             <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Cancelling call forwarding on channel %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l08226"></a>08226             res = tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_DIALRECALL);
<a name="l08227"></a>08227             memset(p-&gt;<a class="code" href="structdahdi__pvt.html#a82162415ab1c1e6d5ee85973d68b3655" title="Accumulated call forwarding number.">call_forward</a>, 0, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structdahdi__pvt.html#a82162415ab1c1e6d5ee85973d68b3655" title="Accumulated call forwarding number.">call_forward</a>));
<a name="l08228"></a>08228             getforward = 0;
<a name="l08229"></a>08229             memset(exten, 0, <span class="keyword">sizeof</span>(exten));
<a name="l08230"></a>08230             len = 0;
<a name="l08231"></a>08231          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structdahdi__pvt.html#ad9e41a9a2b63c1e9bad00df4c2bfc92e" title="TRUE if call transfer is enabled.">transfer</a> || p-&gt;<a class="code" href="structdahdi__pvt.html#a17706e8df212b8e7d0aaf7d13027bf8d" title="TRUE if support for call parking is enabled.">canpark</a>) &amp;&amp; !strcmp(exten, <a class="code" href="features_8h.html#a716860609c92cd4b7fb8f6eb724ac700" title="Determine system parking extension.">ast_parking_ext</a>()) &amp;&amp;
<a name="l08232"></a>08232                   p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> &amp;&amp;
<a name="l08233"></a>08233                   <a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)) {
<a name="l08234"></a>08234             <span class="comment">/* This is a three way call, the main call being a real channel,</span>
<a name="l08235"></a>08235 <span class="comment">               and we&apos;re parking the first call. */</span>
<a name="l08236"></a>08236             <a class="code" href="features_8h.html#a70a2de2bf789996ae5e66142294ca18f" title="Park a call via a masqueraded channel.">ast_masq_park_call</a>(<a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>), chan, 0, NULL);
<a name="l08237"></a>08237             <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Parking call to &apos;%s&apos;\n&quot;</span>, chan-&gt;name);
<a name="l08238"></a>08238             <span class="keywordflow">break</span>;
<a name="l08239"></a>08239          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ac6d55b34cf1c26bff3d105f067f16439" title="Last Caller ID number from an incoming call.">lastcid_num</a>) &amp;&amp; !strcmp(exten, <span class="stringliteral">&quot;*60&quot;</span>)) {
<a name="l08240"></a>08240             <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Blacklisting number %s\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#ac6d55b34cf1c26bff3d105f067f16439" title="Last Caller ID number from an incoming call.">lastcid_num</a>);
<a name="l08241"></a>08241             res = <a class="code" href="astdb_8h.html#a0f14f6bff4f412c88b50aba34d3a5e35" title="Store value addressed by family/key.">ast_db_put</a>(<span class="stringliteral">&quot;blacklist&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#ac6d55b34cf1c26bff3d105f067f16439" title="Last Caller ID number from an incoming call.">lastcid_num</a>, <span class="stringliteral">&quot;1&quot;</span>);
<a name="l08242"></a>08242             <span class="keywordflow">if</span> (!res) {
<a name="l08243"></a>08243                res = tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_DIALRECALL);
<a name="l08244"></a>08244                memset(exten, 0, <span class="keyword">sizeof</span>(exten));
<a name="l08245"></a>08245                len = 0;
<a name="l08246"></a>08246             }
<a name="l08247"></a>08247          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a8c5bb01611cd9890c062782fa0366459" title="TRUE if the outgoing caller ID is blocked/hidden.">hidecallerid</a> &amp;&amp; !strcmp(exten, <span class="stringliteral">&quot;*82&quot;</span>)) {
<a name="l08248"></a>08248             <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Enabling Caller*ID on %s\n&quot;</span>, chan-&gt;name);
<a name="l08249"></a>08249             <span class="comment">/* Enable Caller*ID if enabled */</span>
<a name="l08250"></a>08250             p-&gt;<a class="code" href="structdahdi__pvt.html#a8c5bb01611cd9890c062782fa0366459" title="TRUE if the outgoing caller ID is blocked/hidden.">hidecallerid</a> = 0;
<a name="l08251"></a>08251             <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>)
<a name="l08252"></a>08252                <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(chan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>);
<a name="l08253"></a>08253             chan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a> = NULL;
<a name="l08254"></a>08254             <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ab2461abe6e234fe4f763b0a2179184b5">cid_name</a>)
<a name="l08255"></a>08255                <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(chan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ab2461abe6e234fe4f763b0a2179184b5">cid_name</a>);
<a name="l08256"></a>08256             chan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ab2461abe6e234fe4f763b0a2179184b5">cid_name</a> = NULL;
<a name="l08257"></a>08257             <a class="code" href="channel_8h.html#a88d833a56ea7de33e230281c5c12b75d" title="Set caller ID number, name and ANI.">ast_set_callerid</a>(chan, p-&gt;<a class="code" href="structdahdi__pvt.html#a29e973bd94bfbaf59d939bd1bc988c32" title="Caller ID number from an incoming call.">cid_num</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#ade5a89f9bee15a492c760ec1765a292d" title="Caller ID name from an incoming call.">cid_name</a>, NULL);
<a name="l08258"></a>08258             res = tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_DIALRECALL);
<a name="l08259"></a>08259             <span class="keywordflow">if</span> (res) {
<a name="l08260"></a>08260                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to do dial recall on channel %s: %s\n&quot;</span>,
<a name="l08261"></a>08261                   chan-&gt;name, strerror(errno));
<a name="l08262"></a>08262             }
<a name="l08263"></a>08263             len = 0;
<a name="l08264"></a>08264             memset(exten, 0, <span class="keyword">sizeof</span>(exten));
<a name="l08265"></a>08265             timeout = <a class="code" href="chan__dahdi_8c.html#afd3be8e865f060b68db4d7c966489e0a" title="Wait up to 16 seconds for first digit (FXO logic).">firstdigittimeout</a>;
<a name="l08266"></a>08266          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(exten, <span class="stringliteral">&quot;*0&quot;</span>)) {
<a name="l08267"></a>08267             <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *nbridge =
<a name="l08268"></a>08268                p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;
<a name="l08269"></a>08269             <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *pbridge = NULL;
<a name="l08270"></a>08270             <span class="comment">/* set up the private struct of the bridged one, if any */</span>
<a name="l08271"></a>08271             <span class="keywordflow">if</span> (nbridge &amp;&amp; <a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(nbridge))
<a name="l08272"></a>08272                pbridge = <a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(nbridge)-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l08273"></a>08273             <span class="keywordflow">if</span> (nbridge &amp;&amp; pbridge &amp;&amp;
<a name="l08274"></a>08274                (nbridge-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a> == &amp;<a class="code" href="chan__dahdi_8c.html#abaaa1bdd4fa7ebb3e41873b18bda7170">dahdi_tech</a>) &amp;&amp;
<a name="l08275"></a>08275                (<a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(nbridge)-&gt;tech == &amp;<a class="code" href="chan__dahdi_8c.html#abaaa1bdd4fa7ebb3e41873b18bda7170">dahdi_tech</a>) &amp;&amp;
<a name="l08276"></a>08276                <a class="code" href="chan__dahdi_8c.html#aaba53263d23f0d5fc75b177b9adfc851">ISTRUNK</a>(pbridge)) {
<a name="l08277"></a>08277                <span class="keywordtype">int</span> func = DAHDI_FLASH;
<a name="l08278"></a>08278                <span class="comment">/* Clear out the dial buffer */</span>
<a name="l08279"></a>08279                p-&gt;<a class="code" href="structdahdi__pvt.html#a1cbc6bb40ef7c629159c6dbf795ebe29" title="DAHDI dial operation command struct for ioctl() call.">dop</a>.dialstr[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l08280"></a>08280                <span class="comment">/* flash hookswitch */</span>
<a name="l08281"></a>08281                <span class="keywordflow">if</span> ((ioctl(pbridge-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>,DAHDI_HOOK,&amp;func) == -1) &amp;&amp; (errno != EINPROGRESS)) {
<a name="l08282"></a>08282                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to flash external trunk on channel %s: %s\n&quot;</span>,
<a name="l08283"></a>08283                      nbridge-&gt;name, strerror(errno));
<a name="l08284"></a>08284                }
<a name="l08285"></a>08285                <a class="code" href="chan__dahdi_8c.html#aaa6e6b7fe5725465004d3fabf351620e">swap_subs</a>(p, <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>, <a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>);
<a name="l08286"></a>08286                <a class="code" href="chan__dahdi_8c.html#a164404a295fbba4f9d3c2c6cf123468f">unalloc_sub</a>(p, <a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>);
<a name="l08287"></a>08287                p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;
<a name="l08288"></a>08288                <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>))
<a name="l08289"></a>08289                   <a class="code" href="channel_8h.html#a60f9d2b0ab8b7a839902313321163b28" title="Queue a control frame with payload.">ast_queue_control</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a3e7629b5f7e39f1cc8ad2e51e266f91e">AST_CONTROL_UNHOLD</a>);
<a name="l08290"></a>08290                <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l08291"></a>08291                <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l08292"></a>08292             } <span class="keywordflow">else</span> {
<a name="l08293"></a>08293                tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_CONGESTION);
<a name="l08294"></a>08294                <a class="code" href="chan__dahdi_8c.html#a497fdd00b631dd33acca24f8178cbd9d" title="Avoid the silly dahdi_waitevent which ignores a bunch of events.">dahdi_wait_event</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>);
<a name="l08295"></a>08295                tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, -1);
<a name="l08296"></a>08296                <a class="code" href="chan__dahdi_8c.html#aaa6e6b7fe5725465004d3fabf351620e">swap_subs</a>(p, <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>, <a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>);
<a name="l08297"></a>08297                <a class="code" href="chan__dahdi_8c.html#a164404a295fbba4f9d3c2c6cf123468f">unalloc_sub</a>(p, <a class="code" href="chan__dahdi_8c.html#a4d6715f8ca4081df6121ac5442da521b">SUB_THREEWAY</a>);
<a name="l08298"></a>08298                p-&gt;<a class="code" href="structdahdi__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;
<a name="l08299"></a>08299                <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l08300"></a>08300                <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l08301"></a>08301             }
<a name="l08302"></a>08302          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="pbx_8h.html#a93f9868530c1e8a9d9d367d1ead8782e" title="Looks for a valid matching extension.">ast_canmatch_extension</a>(chan, chan-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, exten, 1, chan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>) &amp;&amp;
<a name="l08303"></a>08303                      ((exten[0] != <span class="charliteral">&apos;*&apos;</span>) || (strlen(exten) &gt; 2))) {
<a name="l08304"></a>08304             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Can&apos;t match %s from &apos;%s&apos; in context %s\n&quot;</span>, exten, chan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a> ? chan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a> : <span class="stringliteral">&quot;&lt;Unknown Caller&gt;&quot;</span>, chan-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>);
<a name="l08305"></a>08305             <span class="keywordflow">break</span>;
<a name="l08306"></a>08306          }
<a name="l08307"></a>08307          <span class="keywordflow">if</span> (!timeout)
<a name="l08308"></a>08308             timeout = <a class="code" href="chan__dahdi_8c.html#aa319ef1606201db158ce7195fb8eed45" title="How long to wait for following digits (FXO logic).">gendigittimeout</a>;
<a name="l08309"></a>08309          <span class="keywordflow">if</span> (len &amp;&amp; !<a class="code" href="pbx_8h.html#aa73d176ed4f1ce51e5db6beafba45fe3" title="Checks to see if a number should be ignored.">ast_ignore_pattern</a>(chan-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, exten))
<a name="l08310"></a>08310             tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, -1);
<a name="l08311"></a>08311       }
<a name="l08312"></a>08312       <span class="keywordflow">break</span>;
<a name="l08313"></a>08313    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a1dc50a07aef86c90ab94f1583c35a265">SIG_FXSLS</a>:
<a name="l08314"></a>08314    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a97e4c6fb4680984aafc6e0e55a2b6cb4">SIG_FXSGS</a>:
<a name="l08315"></a>08315    <span class="keywordflow">case</span> <a class="code" href="chan__dahdi_8c.html#a38139ec369c0243f4324eb4eb0c2f004">SIG_FXSKS</a>:
<a name="l08316"></a>08316 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l08317"></a>08317 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (p-&gt;pri) {
<a name="l08318"></a>08318          <span class="comment">/* This is a GR-303 trunk actually.  Wait for the first ring... */</span>
<a name="l08319"></a>08319          <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l08320"></a>08320          <span class="keywordtype">int</span> res;
<a name="l08321"></a>08321          time_t start;
<a name="l08322"></a>08322 
<a name="l08323"></a>08323          time(&amp;start);
<a name="l08324"></a>08324          <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(chan, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a>);
<a name="l08325"></a>08325          <span class="keywordflow">while</span> (time(NULL) &lt; start + 3) {
<a name="l08326"></a>08326             res = <a class="code" href="channel_8h.html#a60e0bcaed001e8d5ed1ba0eb2644b3cc" title="Wait for input on a channel.">ast_waitfor</a>(chan, 1000);
<a name="l08327"></a>08327             <span class="keywordflow">if</span> (res) {
<a name="l08328"></a>08328                f = <a class="code" href="channel_8h.html#a7ef6737309dc9e8b6c4a7cb4800638b1" title="Reads a frame.">ast_read</a>(chan);
<a name="l08329"></a>08329                <span class="keywordflow">if</span> (!f) {
<a name="l08330"></a>08330                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Whoa, hangup while waiting for first ring!\n&quot;</span>);
<a name="l08331"></a>08331                   <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l08332"></a>08332                   <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l08333"></a>08333                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>) &amp;&amp; (f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> == <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a00675bfb8c64b2be86297fe4cba51fa2">AST_CONTROL_RING</a>)) {
<a name="l08334"></a>08334                   res = 1;
<a name="l08335"></a>08335                } <span class="keywordflow">else</span>
<a name="l08336"></a>08336                   res = 0;
<a name="l08337"></a>08337                <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l08338"></a>08338                <span class="keywordflow">if</span> (res) {
<a name="l08339"></a>08339                   <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Got ring!\n&quot;</span>);
<a name="l08340"></a>08340                   res = 0;
<a name="l08341"></a>08341                   <span class="keywordflow">break</span>;
<a name="l08342"></a>08342                }
<a name="l08343"></a>08343             }
<a name="l08344"></a>08344          }
<a name="l08345"></a>08345       }
<a name="l08346"></a>08346 <span class="preprocessor">#endif</span>
<a name="l08347"></a>08347 <span class="preprocessor"></span>      <span class="comment">/* check for SMDI messages */</span>
<a name="l08348"></a>08348       <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a93dcf4e5286d88e9c218bbc521584784" title="TRUE if SMDI (Simplified Message Desk Interface) is enabled.">use_smdi</a> &amp;&amp; p-&gt;<a class="code" href="structdahdi__pvt.html#af9bb0c022848cf3af1e8e51ae3c18e06" title="The serial port to listen for SMDI data on.">smdi_iface</a>) {
<a name="l08349"></a>08349          smdi_msg = <a class="code" href="smdi_8h.html#aa546cb4eb2d13140010800f1dd929dac" title="Get the next SMDI message from the queue.">ast_smdi_md_message_wait</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#af9bb0c022848cf3af1e8e51ae3c18e06" title="The serial port to listen for SMDI data on.">smdi_iface</a>, <a class="code" href="chan__dahdi_8c.html#aa23909e437da8e1a5b8bf9b1b1e7fcdc">SMDI_MD_WAIT_TIMEOUT</a>);
<a name="l08350"></a>08350 
<a name="l08351"></a>08351          <span class="keywordflow">if</span> (smdi_msg != NULL) {
<a name="l08352"></a>08352             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(chan-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>, smdi_msg-&gt;<a class="code" href="structast__smdi__md__message.html#aa117f98c3165cac31c1cb2da17475fcf">fwd_st</a>, <span class="keyword">sizeof</span>(chan-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>));
<a name="l08353"></a>08353 
<a name="l08354"></a>08354             <span class="keywordflow">if</span> (smdi_msg-&gt;<a class="code" href="structast__smdi__md__message.html#aff17911edc8208aa8ddb1c7c52c78389">type</a> == <span class="charliteral">&apos;B&apos;</span>)
<a name="l08355"></a>08355                <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;_SMDI_VM_TYPE&quot;</span>, <span class="stringliteral">&quot;b&quot;</span>);
<a name="l08356"></a>08356             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (smdi_msg-&gt;<a class="code" href="structast__smdi__md__message.html#aff17911edc8208aa8ddb1c7c52c78389">type</a> == <span class="charliteral">&apos;N&apos;</span>)
<a name="l08357"></a>08357                <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;_SMDI_VM_TYPE&quot;</span>, <span class="stringliteral">&quot;u&quot;</span>);
<a name="l08358"></a>08358 
<a name="l08359"></a>08359             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Received SMDI message on %s\n&quot;</span>, chan-&gt;name);
<a name="l08360"></a>08360          } <span class="keywordflow">else</span> {
<a name="l08361"></a>08361             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;SMDI enabled but no SMDI message present\n&quot;</span>);
<a name="l08362"></a>08362          }
<a name="l08363"></a>08363       }
<a name="l08364"></a>08364 
<a name="l08365"></a>08365       <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#aee1feef8ad729d208a3ab28f0de46658" title="TRUE if caller ID is used on this channel.">use_callerid</a> &amp;&amp; (p-&gt;<a class="code" href="structdahdi__pvt.html#ad7f246923324f9b4186b3ee50de56c36">cid_signalling</a> == <a class="code" href="callerid_8h.html#a184ebb33d2f7bd0bf257356761404aa7">CID_SIG_SMDI</a> &amp;&amp; smdi_msg)) {
<a name="l08366"></a>08366          number = smdi_msg-&gt;<a class="code" href="structast__smdi__md__message.html#a35dcfe0bcfb5c95e42fd180e23d89990">calling_st</a>;
<a name="l08367"></a>08367 
<a name="l08368"></a>08368       <span class="comment">/* If we want caller id, we&apos;re in a prering state due to a polarity reversal</span>
<a name="l08369"></a>08369 <span class="comment">       * and we&apos;re set to use a polarity reversal to trigger the start of caller id,</span>
<a name="l08370"></a>08370 <span class="comment">       * grab the caller id and wait for ringing to start... */</span>
<a name="l08371"></a>08371       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#aee1feef8ad729d208a3ab28f0de46658" title="TRUE if caller ID is used on this channel.">use_callerid</a> &amp;&amp; (chan-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a70a2b40aa2ec0f6f0e7378df7a0810db">AST_STATE_PRERING</a> &amp;&amp; (p-&gt;<a class="code" href="structdahdi__pvt.html#aafa12631e52b2af7ee7a6ab7bf554ed2">cid_start</a> == <a class="code" href="callerid_8h.html#ac420c8a2c16e140da85ba27d43bb72ac">CID_START_POLARITY</a> || p-&gt;<a class="code" href="structdahdi__pvt.html#aafa12631e52b2af7ee7a6ab7bf554ed2">cid_start</a> == <a class="code" href="callerid_8h.html#ae09f76d7a76cca0f6ba8cc074828ba70">CID_START_POLARITY_IN</a>))) {
<a name="l08372"></a>08372          <span class="comment">/* If set to use DTMF CID signalling, listen for DTMF */</span>
<a name="l08373"></a>08373          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#ad7f246923324f9b4186b3ee50de56c36">cid_signalling</a> == <a class="code" href="callerid_8h.html#a8503fd7168b61fb6b75cbc73ddec4d4a">CID_SIG_DTMF</a>) {
<a name="l08374"></a>08374             <span class="keywordtype">int</span> k = 0;
<a name="l08375"></a>08375             cs = NULL;
<a name="l08376"></a>08376             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Receiving DTMF cid on &quot;</span>
<a name="l08377"></a>08377                <span class="stringliteral">&quot;channel %s\n&quot;</span>, chan-&gt;name);
<a name="l08378"></a>08378             <a class="code" href="chan__dahdi_8c.html#a8392b32cf7d3daa7b45154b7001460df">dahdi_setlinear</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, 0);
<a name="l08379"></a>08379             res = 2000;
<a name="l08380"></a>08380             <span class="keywordflow">for</span> (;;) {
<a name="l08381"></a>08381                <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *f;
<a name="l08382"></a>08382                res = <a class="code" href="channel_8h.html#a60e0bcaed001e8d5ed1ba0eb2644b3cc" title="Wait for input on a channel.">ast_waitfor</a>(chan, res);
<a name="l08383"></a>08383                <span class="keywordflow">if</span> (res &lt;= 0) {
<a name="l08384"></a>08384                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;DTMFCID timed out waiting for ring. &quot;</span>
<a name="l08385"></a>08385                      <span class="stringliteral">&quot;Exiting simple switch\n&quot;</span>);
<a name="l08386"></a>08386                   <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l08387"></a>08387                   <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l08388"></a>08388                }
<a name="l08389"></a>08389                f = <a class="code" href="channel_8h.html#a7ef6737309dc9e8b6c4a7cb4800638b1" title="Reads a frame.">ast_read</a>(chan);
<a name="l08390"></a>08390                <span class="keywordflow">if</span> (!f)
<a name="l08391"></a>08391                   <span class="keywordflow">break</span>;
<a name="l08392"></a>08392                <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#a248afd6c02044259a386f6b7aee922a2">AST_FRAME_DTMF</a>) {
<a name="l08393"></a>08393                   dtmfbuf[k++] = f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>;
<a name="l08394"></a>08394                   <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;CID got digit &apos;%c&apos;\n&quot;</span>, f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>);
<a name="l08395"></a>08395                   res = 2000;
<a name="l08396"></a>08396                }
<a name="l08397"></a>08397                <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l08398"></a>08398                <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a> ||
<a name="l08399"></a>08399                   chan-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa">AST_STATE_RINGING</a>)
<a name="l08400"></a>08400                   <span class="keywordflow">break</span>; <span class="comment">/* Got ring */</span>
<a name="l08401"></a>08401             }
<a name="l08402"></a>08402             dtmfbuf[k] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l08403"></a>08403             <a class="code" href="chan__dahdi_8c.html#a8392b32cf7d3daa7b45154b7001460df">dahdi_setlinear</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a2de30c0a559b0df57ba137153a1370ea">linear</a>);
<a name="l08404"></a>08404             <span class="comment">/* Got cid and ring. */</span>
<a name="l08405"></a>08405             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;CID got string &apos;%s&apos;\n&quot;</span>, dtmfbuf);
<a name="l08406"></a>08406             <a class="code" href="callerid_8h.html#ab5fe1d08c3e1f692c09923587e1cce70">callerid_get_dtmf</a>(dtmfbuf, dtmfcid, &amp;flags);
<a name="l08407"></a>08407             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;CID is &apos;%s&apos;, flags %d\n&quot;</span>,
<a name="l08408"></a>08408                dtmfcid, flags);
<a name="l08409"></a>08409             <span class="comment">/* If first byte is NULL, we have no cid */</span>
<a name="l08410"></a>08410             <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(dtmfcid))
<a name="l08411"></a>08411                number = dtmfcid;
<a name="l08412"></a>08412             <span class="keywordflow">else</span>
<a name="l08413"></a>08413                number = NULL;
<a name="l08414"></a>08414          <span class="comment">/* If set to use V23 Signalling, launch our FSK gubbins and listen for it */</span>
<a name="l08415"></a>08415          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structdahdi__pvt.html#ad7f246923324f9b4186b3ee50de56c36">cid_signalling</a> == <a class="code" href="callerid_8h.html#aa3d409629df5696c54157649828f175b">CID_SIG_V23</a>) || (p-&gt;<a class="code" href="structdahdi__pvt.html#ad7f246923324f9b4186b3ee50de56c36">cid_signalling</a> == <a class="code" href="callerid_8h.html#a0b354e4ddad912bb5b23fbee06537104">CID_SIG_V23_JP</a>)) {
<a name="l08416"></a>08416             cs = <a class="code" href="callerid_8h.html#ae48529c2f2ea547ec29a2451b8fef8a2" title="Create a callerID state machine.">callerid_new</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ad7f246923324f9b4186b3ee50de56c36">cid_signalling</a>);
<a name="l08417"></a>08417             <span class="keywordflow">if</span> (cs) {
<a name="l08418"></a>08418                samples = 0;
<a name="l08419"></a>08419 <span class="preprocessor">#if 1</span>
<a name="l08420"></a>08420 <span class="preprocessor"></span>               <a class="code" href="chan__dahdi_8c.html#a74f7e3c2c3944147a9ae2d1f6aceb71e">bump_gains</a>(p);
<a name="l08421"></a>08421 <span class="preprocessor">#endif</span>
<a name="l08422"></a>08422 <span class="preprocessor"></span>               <span class="comment">/* Take out of linear mode for Caller*ID processing */</span>
<a name="l08423"></a>08423                <a class="code" href="chan__dahdi_8c.html#a8392b32cf7d3daa7b45154b7001460df">dahdi_setlinear</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, 0);
<a name="l08424"></a>08424 
<a name="l08425"></a>08425                <span class="comment">/* First we wait and listen for the Caller*ID */</span>
<a name="l08426"></a>08426                <span class="keywordflow">for</span> (;;) {
<a name="l08427"></a>08427                   i = DAHDI_IOMUX_READ | DAHDI_IOMUX_SIGEVENT;
<a name="l08428"></a>08428                   <span class="keywordflow">if</span> ((res = ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_IOMUX, &amp;i))) {
<a name="l08429"></a>08429                      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;I/O MUX failed: %s\n&quot;</span>, strerror(errno));
<a name="l08430"></a>08430                      <a class="code" href="callerid_8h.html#a4d792e593d99c8b5b3a5534e73082c9d" title="Free a callerID state.">callerid_free</a>(cs);
<a name="l08431"></a>08431                      <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l08432"></a>08432                      <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l08433"></a>08433                   }
<a name="l08434"></a>08434                   <span class="keywordflow">if</span> (i &amp; DAHDI_IOMUX_SIGEVENT) {
<a name="l08435"></a>08435                      res = <a class="code" href="chan__dahdi_8c.html#aad4a9758fbc62380e70cbbcbb31311a4" title="Avoid the silly dahdi_getevent which ignores a bunch of events.">dahdi_get_event</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>);
<a name="l08436"></a>08436                      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Got event %d (%s)...\n&quot;</span>, res, <a class="code" href="chan__dahdi_8c.html#a92fb0724a6e93f69cec9d6e83cdcc3f3">event2str</a>(res));
<a name="l08437"></a>08437                      <span class="keywordflow">if</span> (res == DAHDI_EVENT_NOALARM) {
<a name="l08438"></a>08438                         p-&gt;<a class="code" href="structdahdi__pvt.html#adbe10c4b12619d6cb58b1ad14bc437af" title="TRUE if in an alarm condition.">inalarm</a> = 0;
<a name="l08439"></a>08439                      }
<a name="l08440"></a>08440 
<a name="l08441"></a>08441                      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#ad7f246923324f9b4186b3ee50de56c36">cid_signalling</a> == <a class="code" href="callerid_8h.html#a0b354e4ddad912bb5b23fbee06537104">CID_SIG_V23_JP</a>) {
<a name="l08442"></a>08442                         <span class="keywordflow">if</span> (res == DAHDI_EVENT_RINGBEGIN) {
<a name="l08443"></a>08443                            res = <a class="code" href="chan__dahdi_8c.html#a7c65e6943db828524ea6c9215b8bf696">dahdi_set_hook</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_OFFHOOK);
<a name="l08444"></a>08444                            usleep(1);
<a name="l08445"></a>08445                         }
<a name="l08446"></a>08446                      } <span class="keywordflow">else</span> {
<a name="l08447"></a>08447                         res = 0;
<a name="l08448"></a>08448                         <span class="keywordflow">break</span>;
<a name="l08449"></a>08449                      }
<a name="l08450"></a>08450                   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i &amp; DAHDI_IOMUX_READ) {
<a name="l08451"></a>08451                      res = read(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, buf, <span class="keyword">sizeof</span>(buf));
<a name="l08452"></a>08452                      <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l08453"></a>08453                         <span class="keywordflow">if</span> (errno != ELAST) {
<a name="l08454"></a>08454                            <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;read returned error: %s\n&quot;</span>, strerror(errno));
<a name="l08455"></a>08455                            <a class="code" href="callerid_8h.html#a4d792e593d99c8b5b3a5534e73082c9d" title="Free a callerID state.">callerid_free</a>(cs);
<a name="l08456"></a>08456                            <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l08457"></a>08457                            <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l08458"></a>08458                         }
<a name="l08459"></a>08459                         <span class="keywordflow">break</span>;
<a name="l08460"></a>08460                      }
<a name="l08461"></a>08461                      samples += res;
<a name="l08462"></a>08462 
<a name="l08463"></a>08463                      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#ad7f246923324f9b4186b3ee50de56c36">cid_signalling</a> == <a class="code" href="callerid_8h.html#a0b354e4ddad912bb5b23fbee06537104">CID_SIG_V23_JP</a>) {
<a name="l08464"></a>08464                         res = <a class="code" href="callerid_8h.html#a6864e370d01cb62e12a7306beafd919a" title="Read samples into the state machine.">callerid_feed_jp</a>(cs, buf, res, <a class="code" href="chan__dahdi_8c.html#a830b5fdb3ba653640d3f5044192d82bf">AST_LAW</a>(p));
<a name="l08465"></a>08465                      } <span class="keywordflow">else</span> {
<a name="l08466"></a>08466                         res = <a class="code" href="callerid_8h.html#a873803a7ac6ffd08fe0aca90b192e0ca" title="Read samples into the state machine.">callerid_feed</a>(cs, buf, res, <a class="code" href="chan__dahdi_8c.html#a830b5fdb3ba653640d3f5044192d82bf">AST_LAW</a>(p));
<a name="l08467"></a>08467                      }
<a name="l08468"></a>08468 
<a name="l08469"></a>08469                      <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l08470"></a>08470                         <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;CallerID feed failed on channel &apos;%s&apos;\n&quot;</span>, chan-&gt;name);
<a name="l08471"></a>08471                         <span class="keywordflow">break</span>;
<a name="l08472"></a>08472                      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res)
<a name="l08473"></a>08473                         <span class="keywordflow">break</span>;
<a name="l08474"></a>08474                      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (samples &gt; (8000 * 10))
<a name="l08475"></a>08475                         <span class="keywordflow">break</span>;
<a name="l08476"></a>08476                   }
<a name="l08477"></a>08477                }
<a name="l08478"></a>08478                <span class="keywordflow">if</span> (res == 1) {
<a name="l08479"></a>08479                   <a class="code" href="callerid_8h.html#ae05580f722c821a76a7f52831721d3f4" title="Extract info out of callerID state machine. Flags are listed above.">callerid_get</a>(cs, &amp;name, &amp;number, &amp;flags);
<a name="l08480"></a>08480                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;CallerID number: %s, name: %s, flags=%d\n&quot;</span>, number, name, flags);
<a name="l08481"></a>08481                }
<a name="l08482"></a>08482 
<a name="l08483"></a>08483                <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#ad7f246923324f9b4186b3ee50de56c36">cid_signalling</a> == <a class="code" href="callerid_8h.html#a0b354e4ddad912bb5b23fbee06537104">CID_SIG_V23_JP</a>) {
<a name="l08484"></a>08484                   res = <a class="code" href="chan__dahdi_8c.html#a7c65e6943db828524ea6c9215b8bf696">dahdi_set_hook</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_ONHOOK);
<a name="l08485"></a>08485                   usleep(1);
<a name="l08486"></a>08486                   res = 4000;
<a name="l08487"></a>08487                } <span class="keywordflow">else</span> {
<a name="l08488"></a>08488 
<a name="l08489"></a>08489                   <span class="comment">/* Finished with Caller*ID, now wait for a ring to make sure there really is a call coming */</span>
<a name="l08490"></a>08490                   res = 2000;
<a name="l08491"></a>08491                }
<a name="l08492"></a>08492 
<a name="l08493"></a>08493                <span class="keywordflow">for</span> (;;) {
<a name="l08494"></a>08494                   <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *f;
<a name="l08495"></a>08495                   res = <a class="code" href="channel_8h.html#a60e0bcaed001e8d5ed1ba0eb2644b3cc" title="Wait for input on a channel.">ast_waitfor</a>(chan, res);
<a name="l08496"></a>08496                   <span class="keywordflow">if</span> (res &lt;= 0) {
<a name="l08497"></a>08497                      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;CID timed out waiting for ring. &quot;</span>
<a name="l08498"></a>08498                         <span class="stringliteral">&quot;Exiting simple switch\n&quot;</span>);
<a name="l08499"></a>08499                      <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l08500"></a>08500                      <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l08501"></a>08501                   }
<a name="l08502"></a>08502                   <span class="keywordflow">if</span> (!(f = <a class="code" href="channel_8h.html#a7ef6737309dc9e8b6c4a7cb4800638b1" title="Reads a frame.">ast_read</a>(chan))) {
<a name="l08503"></a>08503                      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Hangup received waiting for ring. Exiting simple switch\n&quot;</span>);
<a name="l08504"></a>08504                      <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l08505"></a>08505                      <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l08506"></a>08506                   }
<a name="l08507"></a>08507                   <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l08508"></a>08508                   <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a> ||
<a name="l08509"></a>08509                      chan-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa">AST_STATE_RINGING</a>)
<a name="l08510"></a>08510                      <span class="keywordflow">break</span>; <span class="comment">/* Got ring */</span>
<a name="l08511"></a>08511                }
<a name="l08512"></a>08512 
<a name="l08513"></a>08513                <span class="comment">/* We must have a ring by now, so, if configured, lets try to listen for</span>
<a name="l08514"></a>08514 <span class="comment">                * distinctive ringing */</span>
<a name="l08515"></a>08515                <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a59551a5cbca312a8fc3cc38f0af80637" title="TRUE if distinctive rings are to be detected.">usedistinctiveringdetection</a>) {
<a name="l08516"></a>08516                   len = 0;
<a name="l08517"></a>08517                   distMatches = 0;
<a name="l08518"></a>08518                   <span class="comment">/* Clear the current ring data array so we dont have old data in it. */</span>
<a name="l08519"></a>08519                   <span class="keywordflow">for</span> (receivedRingT = 0; receivedRingT &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(curRingData); receivedRingT++)
<a name="l08520"></a>08520                      curRingData[receivedRingT] = 0;
<a name="l08521"></a>08521                   receivedRingT = 0;
<a name="l08522"></a>08522                   counter = 0;
<a name="l08523"></a>08523                   counter1 = 0;
<a name="l08524"></a>08524                   <span class="comment">/* Check to see if context is what it should be, if not set to be. */</span>
<a name="l08525"></a>08525                   <span class="keywordflow">if</span> (strcmp(p-&gt;<a class="code" href="structdahdi__pvt.html#ac25ea00ee3f082df06e0cf468cbde240" title="The configured context for incoming calls.">context</a>,p-&gt;<a class="code" href="structdahdi__pvt.html#ab56885da69b74c7fad6a1075b5a296dc" title="Saved context string.">defcontext</a>) != 0) {
<a name="l08526"></a>08526                      <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ac25ea00ee3f082df06e0cf468cbde240" title="The configured context for incoming calls.">context</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#ab56885da69b74c7fad6a1075b5a296dc" title="Saved context string.">defcontext</a>, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structdahdi__pvt.html#ac25ea00ee3f082df06e0cf468cbde240" title="The configured context for incoming calls.">context</a>));
<a name="l08527"></a>08527                      <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(chan-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>,p-&gt;<a class="code" href="structdahdi__pvt.html#ab56885da69b74c7fad6a1075b5a296dc" title="Saved context string.">defcontext</a>,<span class="keyword">sizeof</span>(chan-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>));
<a name="l08528"></a>08528                   }
<a name="l08529"></a>08529 
<a name="l08530"></a>08530                   <span class="keywordflow">for</span> (;;) {
<a name="l08531"></a>08531                      i = DAHDI_IOMUX_READ | DAHDI_IOMUX_SIGEVENT;
<a name="l08532"></a>08532                      <span class="keywordflow">if</span> ((res = ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_IOMUX, &amp;i))) {
<a name="l08533"></a>08533                         <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;I/O MUX failed: %s\n&quot;</span>, strerror(errno));
<a name="l08534"></a>08534                         <a class="code" href="callerid_8h.html#a4d792e593d99c8b5b3a5534e73082c9d" title="Free a callerID state.">callerid_free</a>(cs);
<a name="l08535"></a>08535                         <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l08536"></a>08536                         <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l08537"></a>08537                      }
<a name="l08538"></a>08538                      <span class="keywordflow">if</span> (i &amp; DAHDI_IOMUX_SIGEVENT) {
<a name="l08539"></a>08539                         res = <a class="code" href="chan__dahdi_8c.html#aad4a9758fbc62380e70cbbcbb31311a4" title="Avoid the silly dahdi_getevent which ignores a bunch of events.">dahdi_get_event</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>);
<a name="l08540"></a>08540                         <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Got event %d (%s)...\n&quot;</span>, res, <a class="code" href="chan__dahdi_8c.html#a92fb0724a6e93f69cec9d6e83cdcc3f3">event2str</a>(res));
<a name="l08541"></a>08541                         <span class="keywordflow">if</span> (res == DAHDI_EVENT_NOALARM) {
<a name="l08542"></a>08542                            p-&gt;<a class="code" href="structdahdi__pvt.html#adbe10c4b12619d6cb58b1ad14bc437af" title="TRUE if in an alarm condition.">inalarm</a> = 0;
<a name="l08543"></a>08543                         }
<a name="l08544"></a>08544                         res = 0;
<a name="l08545"></a>08545                         <span class="comment">/* Let us detect distinctive ring */</span>
<a name="l08546"></a>08546 
<a name="l08547"></a>08547                         curRingData[receivedRingT] = p-&gt;<a class="code" href="structdahdi__pvt.html#a2ecae7dca8c46e1948d9117eee9a15e4" title="Ring timeout timer??">ringt</a>;
<a name="l08548"></a>08548 
<a name="l08549"></a>08549                         <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a2ecae7dca8c46e1948d9117eee9a15e4" title="Ring timeout timer??">ringt</a> &lt; p-&gt;<a class="code" href="structdahdi__pvt.html#aadc5d8714afe5d456c8f17db3abf7f20" title="Ring timeout base.">ringt_base</a>/2)
<a name="l08550"></a>08550                            <span class="keywordflow">break</span>;
<a name="l08551"></a>08551                         <span class="comment">/* Increment the ringT counter so we can match it against</span>
<a name="l08552"></a>08552 <span class="comment">                           values in chan_dahdi.conf for distinctive ring */</span>
<a name="l08553"></a>08553                         <span class="keywordflow">if</span> (++receivedRingT == <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(curRingData))
<a name="l08554"></a>08554                            <span class="keywordflow">break</span>;
<a name="l08555"></a>08555                      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i &amp; DAHDI_IOMUX_READ) {
<a name="l08556"></a>08556                         res = read(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, buf, <span class="keyword">sizeof</span>(buf));
<a name="l08557"></a>08557                         <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l08558"></a>08558                            <span class="keywordflow">if</span> (errno != ELAST) {
<a name="l08559"></a>08559                               <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;read returned error: %s\n&quot;</span>, strerror(errno));
<a name="l08560"></a>08560                               <a class="code" href="callerid_8h.html#a4d792e593d99c8b5b3a5534e73082c9d" title="Free a callerID state.">callerid_free</a>(cs);
<a name="l08561"></a>08561                               <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l08562"></a>08562                               <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l08563"></a>08563                            }
<a name="l08564"></a>08564                            <span class="keywordflow">break</span>;
<a name="l08565"></a>08565                         }
<a name="l08566"></a>08566                         <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a2ecae7dca8c46e1948d9117eee9a15e4" title="Ring timeout timer??">ringt</a>)
<a name="l08567"></a>08567                            p-&gt;<a class="code" href="structdahdi__pvt.html#a2ecae7dca8c46e1948d9117eee9a15e4" title="Ring timeout timer??">ringt</a>--;
<a name="l08568"></a>08568                         <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a2ecae7dca8c46e1948d9117eee9a15e4" title="Ring timeout timer??">ringt</a> == 1) {
<a name="l08569"></a>08569                            res = -1;
<a name="l08570"></a>08570                            <span class="keywordflow">break</span>;
<a name="l08571"></a>08571                         }
<a name="l08572"></a>08572                      }
<a name="l08573"></a>08573                   }
<a name="l08574"></a>08574                      <span class="comment">/* this only shows up if you have n of the dring patterns filled in */</span>
<a name="l08575"></a>08575                   <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Detected ring pattern: %d,%d,%d\n&quot;</span>,curRingData[0],curRingData[1],curRingData[2]);
<a name="l08576"></a>08576                   <span class="keywordflow">for</span> (counter = 0; counter &lt; 3; counter++) {
<a name="l08577"></a>08577                      <span class="comment">/* Check to see if the rings we received match any of the ones in chan_dahdi.conf for this</span>
<a name="l08578"></a>08578 <span class="comment">                     channel */</span>
<a name="l08579"></a>08579                      distMatches = 0;
<a name="l08580"></a>08580                      <span class="keywordflow">for</span> (counter1 = 0; counter1 &lt; 3; counter1++) {
<a name="l08581"></a>08581                         <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Ring pattern check range: %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[counter].<a class="code" href="structdistRingData.html#a037e8e370380046bec287bdc96942091">range</a>);
<a name="l08582"></a>08582                         <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[counter].<a class="code" href="structdistRingData.html#ae366f207b91c81a710dc73af8a6f6f52">ring</a>[counter1] == -1) {
<a name="l08583"></a>08583                            <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Pattern ignore (-1) detected, so matching pattern %d regardless.\n&quot;</span>,
<a name="l08584"></a>08584                            curRingData[counter1]);
<a name="l08585"></a>08585                            distMatches++;
<a name="l08586"></a>08586                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (curRingData[counter1] &lt;= (p-&gt;<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[counter].<a class="code" href="structdistRingData.html#ae366f207b91c81a710dc73af8a6f6f52">ring</a>[counter1] + p-&gt;<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[counter].<a class="code" href="structdistRingData.html#a037e8e370380046bec287bdc96942091">range</a>) &amp;&amp;
<a name="l08587"></a>08587                               curRingData[counter1] &gt;= (p-&gt;<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[counter].<a class="code" href="structdistRingData.html#ae366f207b91c81a710dc73af8a6f6f52">ring</a>[counter1] - p-&gt;<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[counter].<a class="code" href="structdistRingData.html#a037e8e370380046bec287bdc96942091">range</a>)) {
<a name="l08588"></a>08588                            <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Ring pattern matched in range: %d to %d\n&quot;</span>,
<a name="l08589"></a>08589                            (p-&gt;<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[counter].<a class="code" href="structdistRingData.html#ae366f207b91c81a710dc73af8a6f6f52">ring</a>[counter1] - p-&gt;<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[counter].<a class="code" href="structdistRingData.html#a037e8e370380046bec287bdc96942091">range</a>),
<a name="l08590"></a>08590                            (p-&gt;<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[counter].<a class="code" href="structdistRingData.html#ae366f207b91c81a710dc73af8a6f6f52">ring</a>[counter1] + p-&gt;<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[counter].<a class="code" href="structdistRingData.html#a037e8e370380046bec287bdc96942091">range</a>));
<a name="l08591"></a>08591                            distMatches++;
<a name="l08592"></a>08592                         }
<a name="l08593"></a>08593                      }
<a name="l08594"></a>08594 
<a name="l08595"></a>08595                      <span class="keywordflow">if</span> (distMatches == 3) {
<a name="l08596"></a>08596                         <span class="comment">/* The ring matches, set the context to whatever is for distinctive ring.. */</span>
<a name="l08597"></a>08597                         <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ac25ea00ee3f082df06e0cf468cbde240" title="The configured context for incoming calls.">context</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#a4048e79457b9638e0cc206baea4cf1b3">ringContext</a>[counter].<a class="code" href="structringContextData.html#a96f75d718104e470aa3c3fc8e3a1257e">contextData</a>, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structdahdi__pvt.html#ac25ea00ee3f082df06e0cf468cbde240" title="The configured context for incoming calls.">context</a>));
<a name="l08598"></a>08598                         <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(chan-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#a4048e79457b9638e0cc206baea4cf1b3">ringContext</a>[counter].<a class="code" href="structringContextData.html#a96f75d718104e470aa3c3fc8e3a1257e">contextData</a>, <span class="keyword">sizeof</span>(chan-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>));
<a name="l08599"></a>08599                         <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Distinctive Ring matched context %s\n&quot;</span>,p-&gt;<a class="code" href="structdahdi__pvt.html#ac25ea00ee3f082df06e0cf468cbde240" title="The configured context for incoming calls.">context</a>);
<a name="l08600"></a>08600                         <span class="keywordflow">break</span>;
<a name="l08601"></a>08601                      }
<a name="l08602"></a>08602                   }
<a name="l08603"></a>08603                }
<a name="l08604"></a>08604                <span class="comment">/* Restore linear mode (if appropriate) for Caller*ID processing */</span>
<a name="l08605"></a>08605                <a class="code" href="chan__dahdi_8c.html#a8392b32cf7d3daa7b45154b7001460df">dahdi_setlinear</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a2de30c0a559b0df57ba137153a1370ea">linear</a>);
<a name="l08606"></a>08606 <span class="preprocessor">#if 1</span>
<a name="l08607"></a>08607 <span class="preprocessor"></span>               <a class="code" href="chan__dahdi_8c.html#a0ac913fed804e8326af276cfa450ed03">restore_gains</a>(p);
<a name="l08608"></a>08608 <span class="preprocessor">#endif</span>
<a name="l08609"></a>08609 <span class="preprocessor"></span>            } <span class="keywordflow">else</span>
<a name="l08610"></a>08610                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to get caller ID space\n&quot;</span>);
<a name="l08611"></a>08611          } <span class="keywordflow">else</span> {
<a name="l08612"></a>08612             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Channel %s in prering &quot;</span>
<a name="l08613"></a>08613                <span class="stringliteral">&quot;state, but I have nothing to do. &quot;</span>
<a name="l08614"></a>08614                <span class="stringliteral">&quot;Terminating simple switch, should be &quot;</span>
<a name="l08615"></a>08615                <span class="stringliteral">&quot;restarted by the actual ring.\n&quot;</span>,
<a name="l08616"></a>08616                chan-&gt;name);
<a name="l08617"></a>08617             <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l08618"></a>08618             <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l08619"></a>08619          }
<a name="l08620"></a>08620       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#aee1feef8ad729d208a3ab28f0de46658" title="TRUE if caller ID is used on this channel.">use_callerid</a> &amp;&amp; p-&gt;<a class="code" href="structdahdi__pvt.html#aafa12631e52b2af7ee7a6ab7bf554ed2">cid_start</a> == <a class="code" href="callerid_8h.html#ab95ac6538ec3b930163ffd43f62063de">CID_START_RING</a>) {
<a name="l08621"></a>08621          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#ad7f246923324f9b4186b3ee50de56c36">cid_signalling</a> == <a class="code" href="callerid_8h.html#a8503fd7168b61fb6b75cbc73ddec4d4a">CID_SIG_DTMF</a>) {
<a name="l08622"></a>08622             <span class="keywordtype">int</span> k = 0;
<a name="l08623"></a>08623             cs = NULL;
<a name="l08624"></a>08624             <a class="code" href="chan__dahdi_8c.html#a8392b32cf7d3daa7b45154b7001460df">dahdi_setlinear</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, 0);
<a name="l08625"></a>08625             res = 2000;
<a name="l08626"></a>08626             <span class="keywordflow">for</span> (;;) {
<a name="l08627"></a>08627                <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *f;
<a name="l08628"></a>08628                res = <a class="code" href="channel_8h.html#a60e0bcaed001e8d5ed1ba0eb2644b3cc" title="Wait for input on a channel.">ast_waitfor</a>(chan, res);
<a name="l08629"></a>08629                <span class="keywordflow">if</span> (res &lt;= 0) {
<a name="l08630"></a>08630                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;DTMFCID timed out waiting for ring. &quot;</span>
<a name="l08631"></a>08631                      <span class="stringliteral">&quot;Exiting simple switch\n&quot;</span>);
<a name="l08632"></a>08632                   <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l08633"></a>08633                   <span class="keywordflow">return</span> NULL;
<a name="l08634"></a>08634                }
<a name="l08635"></a>08635                f = <a class="code" href="channel_8h.html#a7ef6737309dc9e8b6c4a7cb4800638b1" title="Reads a frame.">ast_read</a>(chan);
<a name="l08636"></a>08636                <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#a248afd6c02044259a386f6b7aee922a2">AST_FRAME_DTMF</a>) {
<a name="l08637"></a>08637                   dtmfbuf[k++] = f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>;
<a name="l08638"></a>08638                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;CID got digit &apos;%c&apos;\n&quot;</span>, f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>);
<a name="l08639"></a>08639                   res = 2000;
<a name="l08640"></a>08640                }
<a name="l08641"></a>08641                <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l08642"></a>08642 
<a name="l08643"></a>08643                <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#aadc5d8714afe5d456c8f17db3abf7f20" title="Ring timeout base.">ringt_base</a> == p-&gt;<a class="code" href="structdahdi__pvt.html#a2ecae7dca8c46e1948d9117eee9a15e4" title="Ring timeout timer??">ringt</a>)
<a name="l08644"></a>08644                   <span class="keywordflow">break</span>;
<a name="l08645"></a>08645             }
<a name="l08646"></a>08646             dtmfbuf[k] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l08647"></a>08647             <a class="code" href="chan__dahdi_8c.html#a8392b32cf7d3daa7b45154b7001460df">dahdi_setlinear</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a2de30c0a559b0df57ba137153a1370ea">linear</a>);
<a name="l08648"></a>08648             <span class="comment">/* Got cid and ring. */</span>
<a name="l08649"></a>08649             <a class="code" href="callerid_8h.html#ab5fe1d08c3e1f692c09923587e1cce70">callerid_get_dtmf</a>(dtmfbuf, dtmfcid, &amp;flags);
<a name="l08650"></a>08650             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;CID is &apos;%s&apos;, flags %d\n&quot;</span>,
<a name="l08651"></a>08651                dtmfcid, flags);
<a name="l08652"></a>08652             <span class="comment">/* If first byte is NULL, we have no cid */</span>
<a name="l08653"></a>08653             <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(dtmfcid))
<a name="l08654"></a>08654                number = dtmfcid;
<a name="l08655"></a>08655             <span class="keywordflow">else</span>
<a name="l08656"></a>08656                number = NULL;
<a name="l08657"></a>08657             <span class="comment">/* If set to use V23 Signalling, launch our FSK gubbins and listen for it */</span>
<a name="l08658"></a>08658          } <span class="keywordflow">else</span> {
<a name="l08659"></a>08659             <span class="comment">/* FSK Bell202 callerID */</span>
<a name="l08660"></a>08660             cs = <a class="code" href="callerid_8h.html#ae48529c2f2ea547ec29a2451b8fef8a2" title="Create a callerID state machine.">callerid_new</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ad7f246923324f9b4186b3ee50de56c36">cid_signalling</a>);
<a name="l08661"></a>08661             <span class="keywordflow">if</span> (cs) {
<a name="l08662"></a>08662 <span class="preprocessor">#if 1</span>
<a name="l08663"></a>08663 <span class="preprocessor"></span>               <a class="code" href="chan__dahdi_8c.html#a74f7e3c2c3944147a9ae2d1f6aceb71e">bump_gains</a>(p);
<a name="l08664"></a>08664 <span class="preprocessor">#endif</span>
<a name="l08665"></a>08665 <span class="preprocessor"></span>               samples = 0;
<a name="l08666"></a>08666                len = 0;
<a name="l08667"></a>08667                distMatches = 0;
<a name="l08668"></a>08668                <span class="comment">/* Clear the current ring data array so we dont have old data in it. */</span>
<a name="l08669"></a>08669                <span class="keywordflow">for</span> (receivedRingT = 0; receivedRingT &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(curRingData); receivedRingT++)
<a name="l08670"></a>08670                   curRingData[receivedRingT] = 0;
<a name="l08671"></a>08671                receivedRingT = 0;
<a name="l08672"></a>08672                counter = 0;
<a name="l08673"></a>08673                counter1 = 0;
<a name="l08674"></a>08674                <span class="comment">/* Check to see if context is what it should be, if not set to be. */</span>
<a name="l08675"></a>08675                <span class="keywordflow">if</span> (strcmp(p-&gt;<a class="code" href="structdahdi__pvt.html#ac25ea00ee3f082df06e0cf468cbde240" title="The configured context for incoming calls.">context</a>,p-&gt;<a class="code" href="structdahdi__pvt.html#ab56885da69b74c7fad6a1075b5a296dc" title="Saved context string.">defcontext</a>) != 0) {
<a name="l08676"></a>08676                   <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ac25ea00ee3f082df06e0cf468cbde240" title="The configured context for incoming calls.">context</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#ab56885da69b74c7fad6a1075b5a296dc" title="Saved context string.">defcontext</a>, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structdahdi__pvt.html#ac25ea00ee3f082df06e0cf468cbde240" title="The configured context for incoming calls.">context</a>));
<a name="l08677"></a>08677                   <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(chan-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>,p-&gt;<a class="code" href="structdahdi__pvt.html#ab56885da69b74c7fad6a1075b5a296dc" title="Saved context string.">defcontext</a>,<span class="keyword">sizeof</span>(chan-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>));
<a name="l08678"></a>08678                }
<a name="l08679"></a>08679 
<a name="l08680"></a>08680                <span class="comment">/* Take out of linear mode for Caller*ID processing */</span>
<a name="l08681"></a>08681                <a class="code" href="chan__dahdi_8c.html#a8392b32cf7d3daa7b45154b7001460df">dahdi_setlinear</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, 0);
<a name="l08682"></a>08682                <span class="keywordflow">for</span> (;;) {
<a name="l08683"></a>08683                   i = DAHDI_IOMUX_READ | DAHDI_IOMUX_SIGEVENT;
<a name="l08684"></a>08684                   <span class="keywordflow">if</span> ((res = ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_IOMUX, &amp;i))) {
<a name="l08685"></a>08685                      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;I/O MUX failed: %s\n&quot;</span>, strerror(errno));
<a name="l08686"></a>08686                      <a class="code" href="callerid_8h.html#a4d792e593d99c8b5b3a5534e73082c9d" title="Free a callerID state.">callerid_free</a>(cs);
<a name="l08687"></a>08687                      <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l08688"></a>08688                      <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l08689"></a>08689                   }
<a name="l08690"></a>08690                   <span class="keywordflow">if</span> (i &amp; DAHDI_IOMUX_SIGEVENT) {
<a name="l08691"></a>08691                      res = <a class="code" href="chan__dahdi_8c.html#aad4a9758fbc62380e70cbbcbb31311a4" title="Avoid the silly dahdi_getevent which ignores a bunch of events.">dahdi_get_event</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>);
<a name="l08692"></a>08692                      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Got event %d (%s)...\n&quot;</span>, res, <a class="code" href="chan__dahdi_8c.html#a92fb0724a6e93f69cec9d6e83cdcc3f3">event2str</a>(res));
<a name="l08693"></a>08693                      <span class="keywordflow">if</span> (res == DAHDI_EVENT_NOALARM) {
<a name="l08694"></a>08694                         p-&gt;<a class="code" href="structdahdi__pvt.html#adbe10c4b12619d6cb58b1ad14bc437af" title="TRUE if in an alarm condition.">inalarm</a> = 0;
<a name="l08695"></a>08695                      }
<a name="l08696"></a>08696                      <span class="comment">/* If we get a PR event, they hung up while processing calerid */</span>
<a name="l08697"></a>08697                      <span class="keywordflow">if</span> ( res == DAHDI_EVENT_POLARITY &amp;&amp; p-&gt;<a class="code" href="structdahdi__pvt.html#a7bc13c53b24817de617833097a940350" title="TRUE if the call will be considered &amp;quot;hung up&amp;quot; on a polarity reversal.">hanguponpolarityswitch</a> &amp;&amp; p-&gt;<a class="code" href="structdahdi__pvt.html#aeffac59edf881b639bb5e7c7137a7312" title="Current line interface polarity. POLARITY_IDLE, POLARITY_REV.">polarity</a> == <a class="code" href="chan__dahdi_8c.html#aeba680adad3f0d1146c8e5003f6a44f2">POLARITY_REV</a>) {
<a name="l08698"></a>08698                         <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;Hanging up due to polarity reversal on channel %d while detecting callerid\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l08699"></a>08699                         p-&gt;<a class="code" href="structdahdi__pvt.html#aeffac59edf881b639bb5e7c7137a7312" title="Current line interface polarity. POLARITY_IDLE, POLARITY_REV.">polarity</a> = <a class="code" href="chan__dahdi_8c.html#ad35015bf9d15c7474a4fef58ed0dcab2">POLARITY_IDLE</a>;
<a name="l08700"></a>08700                         <a class="code" href="callerid_8h.html#a4d792e593d99c8b5b3a5534e73082c9d" title="Free a callerID state.">callerid_free</a>(cs);
<a name="l08701"></a>08701                         <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l08702"></a>08702                         <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l08703"></a>08703                      }
<a name="l08704"></a>08704                      res = 0;
<a name="l08705"></a>08705                      <span class="comment">/* Let us detect callerid when the telco uses distinctive ring */</span>
<a name="l08706"></a>08706 
<a name="l08707"></a>08707                      curRingData[receivedRingT] = p-&gt;<a class="code" href="structdahdi__pvt.html#a2ecae7dca8c46e1948d9117eee9a15e4" title="Ring timeout timer??">ringt</a>;
<a name="l08708"></a>08708 
<a name="l08709"></a>08709                      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a2ecae7dca8c46e1948d9117eee9a15e4" title="Ring timeout timer??">ringt</a> &lt; p-&gt;<a class="code" href="structdahdi__pvt.html#aadc5d8714afe5d456c8f17db3abf7f20" title="Ring timeout base.">ringt_base</a>/2)
<a name="l08710"></a>08710                         <span class="keywordflow">break</span>;
<a name="l08711"></a>08711                      <span class="comment">/* Increment the ringT counter so we can match it against</span>
<a name="l08712"></a>08712 <span class="comment">                        values in chan_dahdi.conf for distinctive ring */</span>
<a name="l08713"></a>08713                      <span class="keywordflow">if</span> (++receivedRingT == <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(curRingData))
<a name="l08714"></a>08714                         <span class="keywordflow">break</span>;
<a name="l08715"></a>08715                   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i &amp; DAHDI_IOMUX_READ) {
<a name="l08716"></a>08716                      res = read(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, buf, <span class="keyword">sizeof</span>(buf));
<a name="l08717"></a>08717                      <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l08718"></a>08718                         <span class="keywordflow">if</span> (errno != ELAST) {
<a name="l08719"></a>08719                            <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;read returned error: %s\n&quot;</span>, strerror(errno));
<a name="l08720"></a>08720                            <a class="code" href="callerid_8h.html#a4d792e593d99c8b5b3a5534e73082c9d" title="Free a callerID state.">callerid_free</a>(cs);
<a name="l08721"></a>08721                            <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l08722"></a>08722                            <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l08723"></a>08723                         }
<a name="l08724"></a>08724                         <span class="keywordflow">break</span>;
<a name="l08725"></a>08725                      }
<a name="l08726"></a>08726                      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a2ecae7dca8c46e1948d9117eee9a15e4" title="Ring timeout timer??">ringt</a>)
<a name="l08727"></a>08727                         p-&gt;<a class="code" href="structdahdi__pvt.html#a2ecae7dca8c46e1948d9117eee9a15e4" title="Ring timeout timer??">ringt</a>--;
<a name="l08728"></a>08728                      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a2ecae7dca8c46e1948d9117eee9a15e4" title="Ring timeout timer??">ringt</a> == 1) {
<a name="l08729"></a>08729                         res = -1;
<a name="l08730"></a>08730                         <span class="keywordflow">break</span>;
<a name="l08731"></a>08731                      }
<a name="l08732"></a>08732                      samples += res;
<a name="l08733"></a>08733                      res = <a class="code" href="callerid_8h.html#a873803a7ac6ffd08fe0aca90b192e0ca" title="Read samples into the state machine.">callerid_feed</a>(cs, buf, res, <a class="code" href="chan__dahdi_8c.html#a830b5fdb3ba653640d3f5044192d82bf">AST_LAW</a>(p));
<a name="l08734"></a>08734                      <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l08735"></a>08735                         <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;CallerID feed failed: %s\n&quot;</span>, strerror(errno));
<a name="l08736"></a>08736                         <span class="keywordflow">break</span>;
<a name="l08737"></a>08737                      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res)
<a name="l08738"></a>08738                         <span class="keywordflow">break</span>;
<a name="l08739"></a>08739                      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (samples &gt; (8000 * 10))
<a name="l08740"></a>08740                         <span class="keywordflow">break</span>;
<a name="l08741"></a>08741                   }
<a name="l08742"></a>08742                }
<a name="l08743"></a>08743                <span class="keywordflow">if</span> (res == 1) {
<a name="l08744"></a>08744                   <a class="code" href="callerid_8h.html#ae05580f722c821a76a7f52831721d3f4" title="Extract info out of callerID state machine. Flags are listed above.">callerid_get</a>(cs, &amp;name, &amp;number, &amp;flags);
<a name="l08745"></a>08745                   <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;CallerID number: %s, name: %s, flags=%d\n&quot;</span>, number, name, flags);
<a name="l08746"></a>08746                }
<a name="l08747"></a>08747                <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#a57a2f035f40dcb6566153f7bd5db136e">distinctiveringaftercid</a> == 1) {
<a name="l08748"></a>08748                   <span class="comment">/* Clear the current ring data array so we dont have old data in it. */</span>
<a name="l08749"></a>08749                   <span class="keywordflow">for</span> (receivedRingT = 0; receivedRingT &lt; 3; receivedRingT++) {
<a name="l08750"></a>08750                      curRingData[receivedRingT] = 0;
<a name="l08751"></a>08751                   }
<a name="l08752"></a>08752                   receivedRingT = 0;
<a name="l08753"></a>08753                   <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Detecting post-CID distinctive ring\n&quot;</span>);
<a name="l08754"></a>08754                   <span class="keywordflow">for</span> (;;) {
<a name="l08755"></a>08755                      i = DAHDI_IOMUX_READ | DAHDI_IOMUX_SIGEVENT;
<a name="l08756"></a>08756                      <span class="keywordflow">if</span> ((res = ioctl(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_IOMUX, &amp;i))) {
<a name="l08757"></a>08757                         <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;I/O MUX failed: %s\n&quot;</span>, strerror(errno));
<a name="l08758"></a>08758                         <a class="code" href="callerid_8h.html#a4d792e593d99c8b5b3a5534e73082c9d" title="Free a callerID state.">callerid_free</a>(cs);
<a name="l08759"></a>08759                         <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l08760"></a>08760                         <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l08761"></a>08761                      }
<a name="l08762"></a>08762                      <span class="keywordflow">if</span> (i &amp; DAHDI_IOMUX_SIGEVENT) {
<a name="l08763"></a>08763                         res = <a class="code" href="chan__dahdi_8c.html#aad4a9758fbc62380e70cbbcbb31311a4" title="Avoid the silly dahdi_getevent which ignores a bunch of events.">dahdi_get_event</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>);
<a name="l08764"></a>08764                         <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Got event %d (%s)...\n&quot;</span>, res, <a class="code" href="chan__dahdi_8c.html#a92fb0724a6e93f69cec9d6e83cdcc3f3">event2str</a>(res));
<a name="l08765"></a>08765                         <span class="keywordflow">if</span> (res == DAHDI_EVENT_NOALARM) {
<a name="l08766"></a>08766                            p-&gt;<a class="code" href="structdahdi__pvt.html#adbe10c4b12619d6cb58b1ad14bc437af" title="TRUE if in an alarm condition.">inalarm</a> = 0;
<a name="l08767"></a>08767                         }
<a name="l08768"></a>08768                         res = 0;
<a name="l08769"></a>08769                         <span class="comment">/* Let us detect callerid when the telco uses distinctive ring */</span>
<a name="l08770"></a>08770 
<a name="l08771"></a>08771                         curRingData[receivedRingT] = p-&gt;<a class="code" href="structdahdi__pvt.html#a2ecae7dca8c46e1948d9117eee9a15e4" title="Ring timeout timer??">ringt</a>;
<a name="l08772"></a>08772 
<a name="l08773"></a>08773                         <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a2ecae7dca8c46e1948d9117eee9a15e4" title="Ring timeout timer??">ringt</a> &lt; p-&gt;<a class="code" href="structdahdi__pvt.html#aadc5d8714afe5d456c8f17db3abf7f20" title="Ring timeout base.">ringt_base</a>/2)
<a name="l08774"></a>08774                            <span class="keywordflow">break</span>;
<a name="l08775"></a>08775                         <span class="comment">/* Increment the ringT counter so we can match it against</span>
<a name="l08776"></a>08776 <span class="comment">                           values in chan_dahdi.conf for distinctive ring */</span>
<a name="l08777"></a>08777                         <span class="keywordflow">if</span> (++receivedRingT == <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(curRingData))
<a name="l08778"></a>08778                            <span class="keywordflow">break</span>;
<a name="l08779"></a>08779                      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i &amp; DAHDI_IOMUX_READ) {
<a name="l08780"></a>08780                         res = read(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, buf, <span class="keyword">sizeof</span>(buf));
<a name="l08781"></a>08781                         <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l08782"></a>08782                            <span class="keywordflow">if</span> (errno != ELAST) {
<a name="l08783"></a>08783                               <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;read returned error: %s\n&quot;</span>, strerror(errno));
<a name="l08784"></a>08784                               <a class="code" href="callerid_8h.html#a4d792e593d99c8b5b3a5534e73082c9d" title="Free a callerID state.">callerid_free</a>(cs);
<a name="l08785"></a>08785                               <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l08786"></a>08786                               <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l08787"></a>08787                            }
<a name="l08788"></a>08788                            <span class="keywordflow">break</span>;
<a name="l08789"></a>08789                         }
<a name="l08790"></a>08790                      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a2ecae7dca8c46e1948d9117eee9a15e4" title="Ring timeout timer??">ringt</a>)
<a name="l08791"></a>08791                         p-&gt;<a class="code" href="structdahdi__pvt.html#a2ecae7dca8c46e1948d9117eee9a15e4" title="Ring timeout timer??">ringt</a>--;
<a name="l08792"></a>08792                         <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a2ecae7dca8c46e1948d9117eee9a15e4" title="Ring timeout timer??">ringt</a> == 1) {
<a name="l08793"></a>08793                            res = -1;
<a name="l08794"></a>08794                            <span class="keywordflow">break</span>;
<a name="l08795"></a>08795                         }
<a name="l08796"></a>08796                      }
<a name="l08797"></a>08797                   }
<a name="l08798"></a>08798                }
<a name="l08799"></a>08799                <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a59551a5cbca312a8fc3cc38f0af80637" title="TRUE if distinctive rings are to be detected.">usedistinctiveringdetection</a>) {
<a name="l08800"></a>08800                   <span class="comment">/* this only shows up if you have n of the dring patterns filled in */</span>
<a name="l08801"></a>08801                   <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Detected ring pattern: %d,%d,%d\n&quot;</span>,curRingData[0],curRingData[1],curRingData[2]);
<a name="l08802"></a>08802 
<a name="l08803"></a>08803                   <span class="keywordflow">for</span> (counter = 0; counter &lt; 3; counter++) {
<a name="l08804"></a>08804                      <span class="comment">/* Check to see if the rings we received match any of the ones in chan_dahdi.conf for this</span>
<a name="l08805"></a>08805 <span class="comment">                     channel */</span>
<a name="l08806"></a>08806                      <span class="comment">/* this only shows up if you have n of the dring patterns filled in */</span>
<a name="l08807"></a>08807                      <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Checking %d,%d,%d\n&quot;</span>,
<a name="l08808"></a>08808                            p-&gt;<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[counter].<a class="code" href="structdistRingData.html#ae366f207b91c81a710dc73af8a6f6f52">ring</a>[0],
<a name="l08809"></a>08809                            p-&gt;<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[counter].<a class="code" href="structdistRingData.html#ae366f207b91c81a710dc73af8a6f6f52">ring</a>[1],
<a name="l08810"></a>08810                            p-&gt;<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[counter].<a class="code" href="structdistRingData.html#ae366f207b91c81a710dc73af8a6f6f52">ring</a>[2]);
<a name="l08811"></a>08811                      distMatches = 0;
<a name="l08812"></a>08812                      <span class="keywordflow">for</span> (counter1 = 0; counter1 &lt; 3; counter1++) {
<a name="l08813"></a>08813                         <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Ring pattern check range: %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[counter].<a class="code" href="structdistRingData.html#a037e8e370380046bec287bdc96942091">range</a>);
<a name="l08814"></a>08814                         <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[counter].<a class="code" href="structdistRingData.html#ae366f207b91c81a710dc73af8a6f6f52">ring</a>[counter1] == -1) {
<a name="l08815"></a>08815                            <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Pattern ignore (-1) detected, so matching pattern %d regardless.\n&quot;</span>,
<a name="l08816"></a>08816                            curRingData[counter1]);
<a name="l08817"></a>08817                            distMatches++;
<a name="l08818"></a>08818                         }
<a name="l08819"></a>08819                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (curRingData[counter1] &lt;= (p-&gt;<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[counter].<a class="code" href="structdistRingData.html#ae366f207b91c81a710dc73af8a6f6f52">ring</a>[counter1] + p-&gt;<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[counter].<a class="code" href="structdistRingData.html#a037e8e370380046bec287bdc96942091">range</a>) &amp;&amp;
<a name="l08820"></a>08820                            curRingData[counter1] &gt;= (p-&gt;<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[counter].<a class="code" href="structdistRingData.html#ae366f207b91c81a710dc73af8a6f6f52">ring</a>[counter1] - p-&gt;<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[counter].<a class="code" href="structdistRingData.html#a037e8e370380046bec287bdc96942091">range</a>)) {
<a name="l08821"></a>08821                            <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Ring pattern matched in range: %d to %d\n&quot;</span>,
<a name="l08822"></a>08822                            (p-&gt;<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[counter].<a class="code" href="structdistRingData.html#ae366f207b91c81a710dc73af8a6f6f52">ring</a>[counter1] - p-&gt;<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[counter].<a class="code" href="structdistRingData.html#a037e8e370380046bec287bdc96942091">range</a>),
<a name="l08823"></a>08823                            (p-&gt;<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[counter].<a class="code" href="structdistRingData.html#ae366f207b91c81a710dc73af8a6f6f52">ring</a>[counter1] + p-&gt;<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#ac9a29f1a3805d4bdfaeccf4472f92e35">ringnum</a>[counter].<a class="code" href="structdistRingData.html#a037e8e370380046bec287bdc96942091">range</a>));
<a name="l08824"></a>08824                            distMatches++;
<a name="l08825"></a>08825                         }
<a name="l08826"></a>08826                      }
<a name="l08827"></a>08827                      <span class="keywordflow">if</span> (distMatches == 3) {
<a name="l08828"></a>08828                         <span class="comment">/* The ring matches, set the context to whatever is for distinctive ring.. */</span>
<a name="l08829"></a>08829                         <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ac25ea00ee3f082df06e0cf468cbde240" title="The configured context for incoming calls.">context</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#a4048e79457b9638e0cc206baea4cf1b3">ringContext</a>[counter].<a class="code" href="structringContextData.html#a96f75d718104e470aa3c3fc8e3a1257e">contextData</a>, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structdahdi__pvt.html#ac25ea00ee3f082df06e0cf468cbde240" title="The configured context for incoming calls.">context</a>));
<a name="l08830"></a>08830                         <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(chan-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#a12c213057d547cb4db9e0ae2f2209556" title="Distinctive Ring data.">drings</a>.<a class="code" href="structdahdi__distRings.html#a4048e79457b9638e0cc206baea4cf1b3">ringContext</a>[counter].<a class="code" href="structringContextData.html#a96f75d718104e470aa3c3fc8e3a1257e">contextData</a>, <span class="keyword">sizeof</span>(chan-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>));
<a name="l08831"></a>08831                         <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Distinctive Ring matched context %s\n&quot;</span>,p-&gt;<a class="code" href="structdahdi__pvt.html#ac25ea00ee3f082df06e0cf468cbde240" title="The configured context for incoming calls.">context</a>);
<a name="l08832"></a>08832                         <span class="keywordflow">break</span>;
<a name="l08833"></a>08833                      }
<a name="l08834"></a>08834                   }
<a name="l08835"></a>08835                }
<a name="l08836"></a>08836                <span class="comment">/* Restore linear mode (if appropriate) for Caller*ID processing */</span>
<a name="l08837"></a>08837                <a class="code" href="chan__dahdi_8c.html#a8392b32cf7d3daa7b45154b7001460df">dahdi_setlinear</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a2de30c0a559b0df57ba137153a1370ea">linear</a>);
<a name="l08838"></a>08838 <span class="preprocessor">#if 1</span>
<a name="l08839"></a>08839 <span class="preprocessor"></span>               <a class="code" href="chan__dahdi_8c.html#a0ac913fed804e8326af276cfa450ed03">restore_gains</a>(p);
<a name="l08840"></a>08840 <span class="preprocessor">#endif</span>
<a name="l08841"></a>08841 <span class="preprocessor"></span>               <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l08842"></a>08842                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;CallerID returned with error on channel &apos;%s&apos;\n&quot;</span>, chan-&gt;name);
<a name="l08843"></a>08843                }
<a name="l08844"></a>08844             } <span class="keywordflow">else</span>
<a name="l08845"></a>08845                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to get caller ID space\n&quot;</span>);
<a name="l08846"></a>08846          }
<a name="l08847"></a>08847       } <span class="keywordflow">else</span>
<a name="l08848"></a>08848          cs = NULL;
<a name="l08849"></a>08849 
<a name="l08850"></a>08850       <span class="keywordflow">if</span> (number)
<a name="l08851"></a>08851          <a class="code" href="callerid_8h.html#a6a61669b28d0f994e44db5e3baab6ef2" title="Shrink a phone number in place to just digits (more accurately it just removes ()&amp;#39;s...">ast_shrink_phone_number</a>(number);
<a name="l08852"></a>08852       <a class="code" href="channel_8h.html#a88d833a56ea7de33e230281c5c12b75d" title="Set caller ID number, name and ANI.">ast_set_callerid</a>(chan, number, name, number);
<a name="l08853"></a>08853 
<a name="l08854"></a>08854       <span class="keywordflow">if</span> (smdi_msg)
<a name="l08855"></a>08855          <a class="code" href="astobj_8h.html#aed02826b481ce75ec710c1184ac8f059" title="Decrement the reference count on an object.">ASTOBJ_UNREF</a>(smdi_msg, <a class="code" href="smdi_8h.html#a408e56a27064d1537eb6e4accf73e6bf" title="ast_smdi_md_message destructor.">ast_smdi_md_message_destroy</a>);
<a name="l08856"></a>08856 
<a name="l08857"></a>08857       <span class="keywordflow">if</span> (cs)
<a name="l08858"></a>08858          <a class="code" href="callerid_8h.html#a4d792e593d99c8b5b3a5534e73082c9d" title="Free a callerID state.">callerid_free</a>(cs);
<a name="l08859"></a>08859       <span class="comment">/* If the CID had Message waiting payload, assume that this for MWI only and hangup the call */</span>
<a name="l08860"></a>08860       <span class="keywordflow">if</span> (flags &amp; <a class="code" href="callerid_8h.html#a9c4dfda5214a190d972ea14ae5055378">CID_MSGWAITING</a>) {
<a name="l08861"></a>08861          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;MWI: Channel %d message waiting!\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l08862"></a>08862          <a class="code" href="chan__dahdi_8c.html#a3cd48b46cf8ee3ffc97d1f15fb53aaad" title="Send MWI state change.">notify_message</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ac81f44f4f22dee90de5975cf8fa4641b" title="Voice mailbox location.">mailbox</a>, 1);
<a name="l08863"></a>08863          <span class="comment">/* If generated using Ring Pulse Alert, then ring has been answered as a call and needs to be hungup */</span>
<a name="l08864"></a>08864          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a3dc50dfe697cc83ee35e72ea27025724" title="TRUE if the FXO port monitors for rpas precursor to fsk MWI indications from the...">mwimonitor_rpas</a>) {
<a name="l08865"></a>08865             <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l08866"></a>08866             <span class="keywordflow">return</span> NULL;
<a name="l08867"></a>08867          }
<a name="l08868"></a>08868       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (flags &amp; <a class="code" href="callerid_8h.html#a826d6ae29e47b657de576a044828734a">CID_NOMSGWAITING</a>) {
<a name="l08869"></a>08869          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;MWI: Channel %d no message waiting!\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l08870"></a>08870          <a class="code" href="chan__dahdi_8c.html#a3cd48b46cf8ee3ffc97d1f15fb53aaad" title="Send MWI state change.">notify_message</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#ac81f44f4f22dee90de5975cf8fa4641b" title="Voice mailbox location.">mailbox</a>, 0);
<a name="l08871"></a>08871          <span class="comment">/* If generated using Ring Pulse Alert, then ring has been answered as a call and needs to be hungup */</span>
<a name="l08872"></a>08872          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a3dc50dfe697cc83ee35e72ea27025724" title="TRUE if the FXO port monitors for rpas precursor to fsk MWI indications from the...">mwimonitor_rpas</a>) {
<a name="l08873"></a>08873             <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l08874"></a>08874             <span class="keywordflow">return</span> NULL;
<a name="l08875"></a>08875          }
<a name="l08876"></a>08876       }
<a name="l08877"></a>08877 
<a name="l08878"></a>08878       <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(chan, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a>);
<a name="l08879"></a>08879       chan-&gt;<a class="code" href="structast__channel.html#a358fd14658a0c5276190e48f1b1f251a">rings</a> = 1;
<a name="l08880"></a>08880       p-&gt;<a class="code" href="structdahdi__pvt.html#a2ecae7dca8c46e1948d9117eee9a15e4" title="Ring timeout timer??">ringt</a> = p-&gt;<a class="code" href="structdahdi__pvt.html#aadc5d8714afe5d456c8f17db3abf7f20" title="Ring timeout base.">ringt_base</a>;
<a name="l08881"></a>08881       res = <a class="code" href="pbx_8h.html#a44b6406c9220f7f2b610ac712369f405" title="Execute the PBX in the current thread.">ast_pbx_run</a>(chan);
<a name="l08882"></a>08882       <span class="keywordflow">if</span> (res) {
<a name="l08883"></a>08883          <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l08884"></a>08884          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;PBX exited non-zero\n&quot;</span>);
<a name="l08885"></a>08885       }
<a name="l08886"></a>08886       <span class="keywordflow">goto</span> <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>;
<a name="l08887"></a>08887    <span class="keywordflow">default</span>:
<a name="l08888"></a>08888       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Don&apos;t know how to handle simple switch with signalling %s on channel %d\n&quot;</span>, <a class="code" href="chan__dahdi_8c.html#ac36e4cc782493e37064405666f5e4fdd">sig2str</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a68be1f65e6d1f2949835d9b6b44bcf8e">sig</a>), p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l08889"></a>08889       res = tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_CONGESTION);
<a name="l08890"></a>08890       <span class="keywordflow">if</span> (res &lt; 0)
<a name="l08891"></a>08891             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to play congestion tone on channel %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l08892"></a>08892    }
<a name="l08893"></a>08893    res = tone_zone_play_tone(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[idx].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>, DAHDI_TONE_CONGESTION);
<a name="l08894"></a>08894    <span class="keywordflow">if</span> (res &lt; 0)
<a name="l08895"></a>08895          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to play congestion tone on channel %d\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l08896"></a>08896    <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l08897"></a>08897 <a class="code" href="pbx__gtkconsole_8c.html#a1a178011116b4794df2c3dd41be5e9ed">quit</a>:
<a name="l08898"></a>08898    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;ss_thread_lock);
<a name="l08899"></a>08899    <a class="code" href="chan__dahdi_8c.html#aec2d8d3ba7708b470105092c392b9b0a">ss_thread_count</a>--;
<a name="l08900"></a>08900    <a class="code" href="lock_8h.html#a02a91e30acdea6d13208d23636d37c87">ast_cond_signal</a>(&amp;<a class="code" href="chan__dahdi_8c.html#aa0eccd1394a26a586074c22fe8d0ff43">ss_thread_complete</a>);
<a name="l08901"></a>08901    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;ss_thread_lock);
<a name="l08902"></a>08902    <span class="keywordflow">return</span> NULL;
<a name="l08903"></a>08903 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aaa6e6b7fe5725465004d3fabf351620e"></a><!-- doxytag: member="chan_dahdi.c::swap_subs" ref="aaa6e6b7fe5725465004d3fabf351620e" args="(struct dahdi_pvt *p, int a, int b)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void swap_subs </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>b</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l02062">2062</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l01576">ast_channel_set_fd()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="chan__dahdi_8c_source.html#l00609">dahdi_subchannel::chan</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="chan__dahdi_8c_source.html#l00621">dahdi_subchannel::inthreeway</a>, <a class="el" href="chan__dahdi_8c_source.html#l00608">dahdi_subchannel::owner</a>, <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>, and <a class="el" href="chan__dahdi_8c_source.html#l01520">wakeup_sub()</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l05502">attempt_transfer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04718">dahdi_answer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04313">dahdi_hangup()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02063"></a>02063 {
<a name="l02064"></a>02064    <span class="keywordtype">int</span> tchan;
<a name="l02065"></a>02065    <span class="keywordtype">int</span> tinthreeway;
<a name="l02066"></a>02066    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *towner;
<a name="l02067"></a>02067 
<a name="l02068"></a>02068    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Swapping %d and %d\n&quot;</span>, a, b);
<a name="l02069"></a>02069 
<a name="l02070"></a>02070    tchan = p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[a].<a class="code" href="structdahdi__subchannel.html#a029c258ce4f699b778c719cd0ef54d1b">chan</a>;
<a name="l02071"></a>02071    towner = p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[a].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;
<a name="l02072"></a>02072    tinthreeway = p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[a].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a>;
<a name="l02073"></a>02073 
<a name="l02074"></a>02074    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[a].<a class="code" href="structdahdi__subchannel.html#a029c258ce4f699b778c719cd0ef54d1b">chan</a> = p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[b].<a class="code" href="structdahdi__subchannel.html#a029c258ce4f699b778c719cd0ef54d1b">chan</a>;
<a name="l02075"></a>02075    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[a].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[b].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;
<a name="l02076"></a>02076    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[a].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a> = p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[b].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a>;
<a name="l02077"></a>02077 
<a name="l02078"></a>02078    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[b].<a class="code" href="structdahdi__subchannel.html#a029c258ce4f699b778c719cd0ef54d1b">chan</a> = tchan;
<a name="l02079"></a>02079    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[b].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = towner;
<a name="l02080"></a>02080    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[b].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a> = tinthreeway;
<a name="l02081"></a>02081 
<a name="l02082"></a>02082    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[a].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)
<a name="l02083"></a>02083       <a class="code" href="channel_8h.html#aca37ca2f3d55a223d26617329ed48a3e">ast_channel_set_fd</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[a].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, 0, p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[a].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>);
<a name="l02084"></a>02084    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[b].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)
<a name="l02085"></a>02085       <a class="code" href="channel_8h.html#aca37ca2f3d55a223d26617329ed48a3e">ast_channel_set_fd</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[b].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, 0, p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[b].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a>);
<a name="l02086"></a>02086    <a class="code" href="chan__dahdi_8c.html#ae4d8c96f36d4b775d4806d13fdd8afd5">wakeup_sub</a>(p, a, NULL);
<a name="l02087"></a>02087    <a class="code" href="chan__dahdi_8c.html#ae4d8c96f36d4b775d4806d13fdd8afd5">wakeup_sub</a>(p, b, NULL);
<a name="l02088"></a>02088 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a164404a295fbba4f9d3c2c6cf123468f"></a><!-- doxytag: member="chan_dahdi.c::unalloc_sub" ref="a164404a295fbba4f9d3c2c6cf123468f" args="(struct dahdi_pvt *p, int x)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int unalloc_sub </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>x</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l02212">2212</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00609">dahdi_subchannel::chan</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="chan__dahdi_8c_source.html#l00622">dahdi_subchannel::curconf</a>, <a class="el" href="chan__dahdi_8c_source.html#l02143">dahdi_close_sub()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00621">dahdi_subchannel::inthreeway</a>, <a class="el" href="chan__dahdi_8c_source.html#l00620">dahdi_subchannel::linear</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__dahdi_8c_source.html#l00608">dahdi_subchannel::owner</a>, <a class="el" href="chan__dahdi_8c_source.html#l01177">dahdi_pvt::polarity</a>, <a class="el" href="chan__dahdi_8c_source.html#l00584">POLARITY_IDLE</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l05502">attempt_transfer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04313">dahdi_hangup()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02213"></a>02213 {
<a name="l02214"></a>02214    <span class="keywordflow">if</span> (!x) {
<a name="l02215"></a>02215       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Trying to unalloc the real channel %d?!?\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l02216"></a>02216       <span class="keywordflow">return</span> -1;
<a name="l02217"></a>02217    }
<a name="l02218"></a>02218    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Released sub %d of channel %d\n&quot;</span>, x, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>);
<a name="l02219"></a>02219    <a class="code" href="chan__dahdi_8c.html#aa677933b22aeb7b907176d84357464c0">dahdi_close_sub</a>(p, x);
<a name="l02220"></a>02220    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[x].<a class="code" href="structdahdi__subchannel.html#a2de30c0a559b0df57ba137153a1370ea">linear</a> = 0;
<a name="l02221"></a>02221    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[x].<a class="code" href="structdahdi__subchannel.html#a029c258ce4f699b778c719cd0ef54d1b">chan</a> = 0;
<a name="l02222"></a>02222    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[x].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = NULL;
<a name="l02223"></a>02223    p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[x].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a> = 0;
<a name="l02224"></a>02224    p-&gt;<a class="code" href="structdahdi__pvt.html#aeffac59edf881b639bb5e7c7137a7312" title="Current line interface polarity. POLARITY_IDLE, POLARITY_REV.">polarity</a> = <a class="code" href="chan__dahdi_8c.html#ad35015bf9d15c7474a4fef58ed0dcab2">POLARITY_IDLE</a>;
<a name="l02225"></a>02225    memset(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[x].<a class="code" href="structdahdi__subchannel.html#ac50efd693f9db4d9cc6d1e1287791824">curconf</a>, 0, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[x].<a class="code" href="structdahdi__subchannel.html#ac50efd693f9db4d9cc6d1e1287791824">curconf</a>));
<a name="l02226"></a>02226    <span class="keywordflow">return</span> 0;
<a name="l02227"></a>02227 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad09fa931f468002152a3cc2d5ce25eae"></a><!-- doxytag: member="chan_dahdi.c::unload_module" ref="ad09fa931f468002152a3cc2d5ce25eae" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int unload_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l15932">15932</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="chan__dahdi_8c_source.html#l15849">__unload_module()</a>, <a class="el" href="lock_8h_source.html#l01712">ast_mutex_destroy()</a>, and <a class="el" href="app__meetme_8c_source.html#l00842">lock</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l15933"></a>15933 {
<a name="l15934"></a>15934 <span class="preprocessor">#if defined(HAVE_PRI) || defined(HAVE_SS7)</span>
<a name="l15935"></a>15935 <span class="preprocessor"></span>   <span class="keywordtype">int</span> y;
<a name="l15936"></a>15936 <span class="preprocessor">#endif</span>
<a name="l15937"></a>15937 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l15938"></a>15938 <span class="preprocessor"></span>   <span class="keywordflow">for</span> (y = 0; y &lt; <a class="code" href="chan__dahdi_8c.html#a80bfdd8adbffe226265cd729655a7268">NUM_SPANS</a>; y++)
<a name="l15939"></a>15939       <a class="code" href="lock_8h.html#ab237e70b569019bfb490ab0c3c09b8c5">ast_mutex_destroy</a>(&amp;pris[y].<a class="code" href="app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l15940"></a>15940 <span class="preprocessor">#endif</span>
<a name="l15941"></a>15941 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_SS7</span>
<a name="l15942"></a>15942 <span class="preprocessor"></span>   <span class="keywordflow">for</span> (y = 0; y &lt; NUM_SPANS; y++)
<a name="l15943"></a>15943       <a class="code" href="lock_8h.html#ab237e70b569019bfb490ab0c3c09b8c5">ast_mutex_destroy</a>(&amp;linksets[y].lock);
<a name="l15944"></a>15944 <span class="preprocessor">#endif </span><span class="comment">/* HAVE_SS7 */</span>
<a name="l15945"></a>15945    <span class="keywordflow">return</span> <a class="code" href="chan__dahdi_8c.html#a2fd806029fe936c297e52d2236092fc0">__unload_module</a>();
<a name="l15946"></a>15946 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac56c05fde8bc30c71af46502e97fae3b"></a><!-- doxytag: member="chan_dahdi.c::update_conf" ref="ac56c05fde8bc30c71af46502e97fae3b" args="(struct dahdi_pvt *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int update_conf </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l02604">2604</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="chan__dahdi_8c_source.html#l01041">dahdi_pvt::channel</a>, <a class="el" href="chan__dahdi_8c_source.html#l02478">conf_add()</a>, <a class="el" href="chan__dahdi_8c_source.html#l02527">conf_del()</a>, <a class="el" href="chan__dahdi_8c_source.html#l01023">dahdi_pvt::confno</a>, <a class="el" href="chan__dahdi_8c_source.html#l00607">dahdi_subchannel::dfd</a>, <a class="el" href="chan__dahdi_8c_source.html#l01425">GET_CHANNEL</a>, <a class="el" href="chan__dahdi_8c_source.html#l00659">dahdi_pvt::inconference</a>, <a class="el" href="chan__dahdi_8c_source.html#l00621">dahdi_subchannel::inthreeway</a>, <a class="el" href="chan__dahdi_8c_source.html#l02546">isslavenative()</a>, <a class="el" href="chan__dahdi_8c_source.html#l00658">dahdi_pvt::master</a>, <a class="el" href="chan__dahdi_8c_source.html#l00628">MAX_SLAVES</a>, <a class="el" href="chan__dahdi_8c_source.html#l00657">dahdi_pvt::slaves</a>, <a class="el" href="chan__dahdi_8c_source.html#l00579">SUB_REAL</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l06601">__dahdi_exception()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05156">dahdi_bridge()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05448">dahdi_fixup()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05699">dahdi_handle_event()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04313">dahdi_hangup()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05044">dahdi_unlink()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02605"></a>02605 {
<a name="l02606"></a>02606    <span class="keywordtype">int</span> needconf = 0;
<a name="l02607"></a>02607    <span class="keywordtype">int</span> x;
<a name="l02608"></a>02608    <span class="keywordtype">int</span> useslavenative;
<a name="l02609"></a>02609    <span class="keyword">struct </span><a class="code" href="structdahdi__pvt.html">dahdi_pvt</a> *slave = NULL;
<a name="l02610"></a>02610 
<a name="l02611"></a>02611    useslavenative = <a class="code" href="chan__dahdi_8c.html#a1d078823a0af683aaa01d964f8a62039">isslavenative</a>(p, &amp;slave);
<a name="l02612"></a>02612    <span class="comment">/* Start with the obvious, general stuff */</span>
<a name="l02613"></a>02613    <span class="keywordflow">for</span> (x = 0; x &lt; 3; x++) {
<a name="l02614"></a>02614       <span class="comment">/* Look for three way calls */</span>
<a name="l02615"></a>02615       <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[x].<a class="code" href="structdahdi__subchannel.html#a89dd9b1a181d29e770ccf16b5a12bf03">dfd</a> &gt; -1) &amp;&amp; p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[x].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a>) {
<a name="l02616"></a>02616          <a class="code" href="chan__dahdi_8c.html#a59a7383df35eebc13f65625074a30353">conf_add</a>(p, &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[x], x, 0);
<a name="l02617"></a>02617          needconf++;
<a name="l02618"></a>02618       } <span class="keywordflow">else</span> {
<a name="l02619"></a>02619          <a class="code" href="chan__dahdi_8c.html#aa44456edf36cac7dde2531aef042ec1c">conf_del</a>(p, &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[x], x);
<a name="l02620"></a>02620       }
<a name="l02621"></a>02621    }
<a name="l02622"></a>02622    <span class="comment">/* If we have a slave, add him to our conference now. or DAX</span>
<a name="l02623"></a>02623 <span class="comment">      if this is slave native */</span>
<a name="l02624"></a>02624    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="chan__dahdi_8c.html#a2a3c5190bdbe2a4780a460383970aa92">MAX_SLAVES</a>; x++) {
<a name="l02625"></a>02625       <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#aa607a8a226852c168c96a4d0f3001c88">slaves</a>[x]) {
<a name="l02626"></a>02626          <span class="keywordflow">if</span> (useslavenative)
<a name="l02627"></a>02627             <a class="code" href="chan__dahdi_8c.html#a59a7383df35eebc13f65625074a30353">conf_add</a>(p, &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#aa607a8a226852c168c96a4d0f3001c88">slaves</a>[x]-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>], SUB_REAL, <a class="code" href="chan__dahdi_8c.html#a93559b640fd4e3fad51f56745e05d2cf">GET_CHANNEL</a>(p));
<a name="l02628"></a>02628          <span class="keywordflow">else</span> {
<a name="l02629"></a>02629             <a class="code" href="chan__dahdi_8c.html#a59a7383df35eebc13f65625074a30353">conf_add</a>(p, &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#aa607a8a226852c168c96a4d0f3001c88">slaves</a>[x]-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[SUB_REAL], SUB_REAL, 0);
<a name="l02630"></a>02630             needconf++;
<a name="l02631"></a>02631          }
<a name="l02632"></a>02632       }
<a name="l02633"></a>02633    }
<a name="l02634"></a>02634    <span class="comment">/* If we&apos;re supposed to be in there, do so now */</span>
<a name="l02635"></a>02635    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#afa5f2dbd816e7f6141e6932e94b8eedd">inconference</a> &amp;&amp; !p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>].<a class="code" href="structdahdi__subchannel.html#a8d8a0fabac2b6dc734d215d4cf226442">inthreeway</a>) {
<a name="l02636"></a>02636       <span class="keywordflow">if</span> (useslavenative)
<a name="l02637"></a>02637          <a class="code" href="chan__dahdi_8c.html#a59a7383df35eebc13f65625074a30353">conf_add</a>(p, &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>], <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>, <a class="code" href="chan__dahdi_8c.html#a93559b640fd4e3fad51f56745e05d2cf">GET_CHANNEL</a>(slave));
<a name="l02638"></a>02638       <span class="keywordflow">else</span> {
<a name="l02639"></a>02639          <a class="code" href="chan__dahdi_8c.html#a59a7383df35eebc13f65625074a30353">conf_add</a>(p, &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>], <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>, 0);
<a name="l02640"></a>02640          needconf++;
<a name="l02641"></a>02641       }
<a name="l02642"></a>02642    }
<a name="l02643"></a>02643    <span class="comment">/* If we have a master, add ourselves to his conference */</span>
<a name="l02644"></a>02644    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a3e30e79b4679785034d55aff6a17e41b">master</a>) {
<a name="l02645"></a>02645       <span class="keywordflow">if</span> (<a class="code" href="chan__dahdi_8c.html#a1d078823a0af683aaa01d964f8a62039">isslavenative</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a3e30e79b4679785034d55aff6a17e41b">master</a>, NULL)) {
<a name="l02646"></a>02646          <a class="code" href="chan__dahdi_8c.html#a59a7383df35eebc13f65625074a30353">conf_add</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a3e30e79b4679785034d55aff6a17e41b">master</a>, &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>], <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>, <a class="code" href="chan__dahdi_8c.html#a93559b640fd4e3fad51f56745e05d2cf">GET_CHANNEL</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a3e30e79b4679785034d55aff6a17e41b">master</a>));
<a name="l02647"></a>02647       } <span class="keywordflow">else</span> {
<a name="l02648"></a>02648          <a class="code" href="chan__dahdi_8c.html#a59a7383df35eebc13f65625074a30353">conf_add</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a3e30e79b4679785034d55aff6a17e41b">master</a>, &amp;p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[<a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>], <a class="code" href="chan__dahdi_8c.html#a3f9523eb1c7c6620e8a9fddde066c2ff">SUB_REAL</a>, 0);
<a name="l02649"></a>02649       }
<a name="l02650"></a>02650    }
<a name="l02651"></a>02651    <span class="keywordflow">if</span> (!needconf) {
<a name="l02652"></a>02652       <span class="comment">/* Nobody is left (or should be left) in our conference.</span>
<a name="l02653"></a>02653 <span class="comment">         Kill it. */</span>
<a name="l02654"></a>02654       p-&gt;<a class="code" href="structdahdi__pvt.html#aa9d25d217a303c512db5f8bd7fabd587">confno</a> = -1;
<a name="l02655"></a>02655    }
<a name="l02656"></a>02656    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Updated conferencing on %d, with %d conference users\n&quot;</span>, p-&gt;<a class="code" href="structdahdi__pvt.html#adf7dff2c57c0da9a4a2b70e3e815be31">channel</a>, needconf);
<a name="l02657"></a>02657    <span class="keywordflow">return</span> 0;
<a name="l02658"></a>02658 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae4d8c96f36d4b775d4806d13fdd8afd5"></a><!-- doxytag: member="chan_dahdi.c::wakeup_sub" ref="ae4d8c96f36d4b775d4806d13fdd8afd5" args="(struct dahdi_pvt *p, int a, struct dahdi_pri *pri)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void wakeup_sub </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct dahdi_pri *&nbsp;</td>
          <td class="paramname"> <em>pri</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l01520">1520</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l02037">ast_channel_trylock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="frame_8c_source.html#l00124">ast_null_frame</a>, <a class="el" href="channel_8c_source.html#l01080">ast_queue_frame()</a>, <a class="el" href="lock_8h_source.html#l01676">DEADLOCK_AVOIDANCE</a>, <a class="el" href="chan__dahdi_8c_source.html#l00649">dahdi_pvt::lock</a>, <a class="el" href="chan__dahdi_8c_source.html#l00608">dahdi_subchannel::owner</a>, and <a class="el" href="chan__dahdi_8c_source.html#l00654">dahdi_pvt::subs</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l02062">swap_subs()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01521"></a>01521 {
<a name="l01522"></a>01522 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l01523"></a>01523 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (pri)
<a name="l01524"></a>01524       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;pri-&gt;lock);
<a name="l01525"></a>01525 <span class="preprocessor">#endif</span>
<a name="l01526"></a>01526 <span class="preprocessor"></span>   <span class="keywordflow">for</span> (;;) {
<a name="l01527"></a>01527       <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[a].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l01528"></a>01528          <span class="keywordflow">if</span> (<a class="code" href="lock_8h.html#a8b8532d377bd19e8411000ddccfa6607" title="Try locking a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_trylock</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[a].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)) {
<a name="l01529"></a>01529             <a class="code" href="lock_8h.html#a851106e971b4611a38cb4be8b39d9fcf">DEADLOCK_AVOIDANCE</a>(&amp;p-&gt;<a class="code" href="structdahdi__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01530"></a>01530          } <span class="keywordflow">else</span> {
<a name="l01531"></a>01531             <a class="code" href="channel_8h.html#a6cbcba5661d55216968cde8fdf913c89" title="Queue one or more frames to a channel&amp;#39;s frame queue.">ast_queue_frame</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[a].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>);
<a name="l01532"></a>01532             <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(p-&gt;<a class="code" href="structdahdi__pvt.html#a61dfcad070af2061195aff40845e8817">subs</a>[a].<a class="code" href="structdahdi__subchannel.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l01533"></a>01533             <span class="keywordflow">break</span>;
<a name="l01534"></a>01534          }
<a name="l01535"></a>01535       } <span class="keywordflow">else</span>
<a name="l01536"></a>01536          <span class="keywordflow">break</span>;
<a name="l01537"></a>01537    }
<a name="l01538"></a>01538 <span class="preprocessor">#ifdef HAVE_PRI</span>
<a name="l01539"></a>01539 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (pri)
<a name="l01540"></a>01540       <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;pri-&gt;lock);
<a name="l01541"></a>01541 <span class="preprocessor">#endif</span>
<a name="l01542"></a>01542 <span class="preprocessor"></span>}
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a9e3b50e48c757ee5067da367f779839a"></a><!-- doxytag: member="chan_dahdi.c::alarm" ref="a9e3b50e48c757ee5067da367f779839a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="chan__dahdi_8c.html#a9e3b50e48c757ee5067da367f779839a">alarm</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l02367">2367</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="a018cba1c176ebc50102982fad2d404dc"></a><!-- doxytag: member="chan_dahdi.c::alarms" ref="a018cba1c176ebc50102982fad2d404dc" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct { ... }   <a class="el" href="chan__dahdi_8c.html#a018cba1c176ebc50102982fad2d404dc">alarms</a>[]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l02379">alarm2str()</a>.</p>

</div>
</div>
<a class="anchor" id="a7e5dcc799403137bdce59f53d7137385"></a><!-- doxytag: member="chan_dahdi.c::AS_RP_cadence" ref="a7e5dcc799403137bdce59f53d7137385" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct dahdi_ring_cadence <a class="el" href="chan__dahdi_8c.html#a7e5dcc799403137bdce59f53d7137385">AS_RP_cadence</a> = {{250, 10000}}<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l01495">1495</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad07d646abd9d3f187412ff33dc665aee"></a><!-- doxytag: member="chan_dahdi.c::cadences" ref="ad07d646abd9d3f187412ff33dc665aee" args="[NUM_CADENCE_MAX]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct dahdi_ring_cadence <a class="el" href="chan__dahdi_8c.html#ad07d646abd9d3f187412ff33dc665aee">cadences</a>[NUM_CADENCE_MAX]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l01476">1476</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="a441c14817877dfc3ae49ff3aa2907400"></a><!-- doxytag: member="chan_dahdi.c::cidrings" ref="a441c14817877dfc3ae49ff3aa2907400" args="[NUM_CADENCE_MAX]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="chan__dahdi_8c.html#a441c14817877dfc3ae49ff3aa2907400">cidrings</a>[NUM_CADENCE_MAX]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>cidrings says in which pause to transmit the cid information, where the first pause is 1, the second pause is 2 and so on. </p>

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l01487">1487</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="a9ee8d742a1fbcff45f97842b92952610"></a><!-- doxytag: member="chan_dahdi.c::config" ref="a9ee8d742a1fbcff45f97842b92952610" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char <a class="el" href="pbx__lua_8c.html#a74bb62276efdf39dd94048e007fca05b">config</a>[] = &quot;chan_dahdi.conf&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00238">238</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad34f2f8582cb6f9118dbd230b6636f2d"></a><!-- doxytag: member="chan_dahdi.c::dahdi_cli" ref="ad34f2f8582cb6f9118dbd230b6636f2d" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> <a class="el" href="chan__dahdi_8c.html#ad34f2f8582cb6f9118dbd230b6636f2d">dahdi_cli</a>[]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l15169">15169</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="abaaa1bdd4fa7ebb3e41873b18bda7170"></a><!-- doxytag: member="chan_dahdi.c::dahdi_tech" ref="abaaa1bdd4fa7ebb3e41873b18bda7170" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__channel__tech.html">ast_channel_tech</a> <a class="el" href="chan__dahdi_8c.html#abaaa1bdd4fa7ebb3e41873b18bda7170">dahdi_tech</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l01401">1401</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="a2d8d5920e90ccbad7832926becdadb29"></a><!-- doxytag: member="chan_dahdi.c::default_jbconf" ref="a2d8d5920e90ccbad7832926becdadb29" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__jb__conf.html">ast_jb_conf</a> <a class="el" href="misdn__config_8c.html#a2d8d5920e90ccbad7832926becdadb29">default_jbconf</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Global jitterbuffer configuration - by default, jb is disabled </p>

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00173">173</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="a9ddac9567291bb4eb61b3989fae45780"></a><!-- doxytag: member="chan_dahdi.c::defaultcic" ref="a9ddac9567291bb4eb61b3989fae45780" args="[64]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="chan__dahdi_8c.html#a9ddac9567291bb4eb61b3989fae45780">defaultcic</a>[64] = &quot;&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00296">296</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad7f989de9c9e4e717bf8991708c9814d"></a><!-- doxytag: member="chan_dahdi.c::defaultozz" ref="ad7f989de9c9e4e717bf8991708c9814d" args="[64]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="chan__dahdi_8c.html#ad7f989de9c9e4e717bf8991708c9814d">defaultozz</a>[64] = &quot;&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00297">297</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="a57a2f035f40dcb6566153f7bd5db136e"></a><!-- doxytag: member="chan_dahdi.c::distinctiveringaftercid" ref="a57a2f035f40dcb6566153f7bd5db136e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="chan__dahdi_8c.html#a57a2f035f40dcb6566153f7bd5db136e">distinctiveringaftercid</a> = 0<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00310">310</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="aff2cd0cadc675280f2ee4b7c45bb9944"></a><!-- doxytag: member="chan_dahdi.c::events" ref="aff2cd0cadc675280f2ee4b7c45bb9944" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* <a class="el" href="chan__dahdi_8c.html#aff2cd0cadc675280f2ee4b7c45bb9944">events</a>[]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l02344">2344</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="afd3be8e865f060b68db4d7c966489e0a"></a><!-- doxytag: member="chan_dahdi.c::firstdigittimeout" ref="afd3be8e865f060b68db4d7c966489e0a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="chan__skinny_8c.html#afd3be8e865f060b68db4d7c966489e0a">firstdigittimeout</a> = 16000<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Wait up to 16 seconds for first digit (FXO logic). </p>

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00326">326</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="app__disa_8c_source.html#l00143">disa_exec()</a>.</p>

</div>
</div>
<a class="anchor" id="aa319ef1606201db158ce7195fb8eed45"></a><!-- doxytag: member="chan_dahdi.c::gendigittimeout" ref="aa319ef1606201db158ce7195fb8eed45" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="chan__skinny_8c.html#aa319ef1606201db158ce7195fb8eed45">gendigittimeout</a> = 8000<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>How long to wait for following digits (FXO logic). </p>

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00329">329</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="abaabcb7f4349cc632dde3af5c6a5e1bd"></a><!-- doxytag: member="chan_dahdi.c::global_jbconf" ref="abaabcb7f4349cc632dde3af5c6a5e1bd" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__jb__conf.html">ast_jb_conf</a> <a class="el" href="misdn__config_8c.html#abaabcb7f4349cc632dde3af5c6a5e1bd">global_jbconf</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00181">181</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l07417">dahdi_new()</a>, <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l17079">setup_dahdi()</a>.</p>

</div>
</div>
<a class="anchor" id="af7b23639f050bf4be75e75d2a11cefc9"></a><!-- doxytag: member="chan_dahdi.c::ifcount" ref="af7b23639f050bf4be75e75d2a11cefc9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="chan__dahdi_8c.html#af7b23639f050bf4be75e75d2a11cefc9">ifcount</a> = 0<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00342">342</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="af06d42bbf0081c1eb058b893305b4e85"></a><!-- doxytag: member="chan_dahdi.c::ifend" ref="af06d42bbf0081c1eb058b893305b4e85" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> * <a class="el" href="chan__dahdi_8c.html#af06d42bbf0081c1eb058b893305b4e85">ifend</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a38bc838f6d206eef6a7a7ca87f5848e7"></a><!-- doxytag: member="chan_dahdi.c::iflist" ref="a38bc838f6d206eef6a7a7ca87f5848e7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a> * <a class="el" href="chan__phone_8c.html#a2369193a6501251a9a3fd53e44556758">iflist</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l15849">__unload_module()</a>, <a class="el" href="chan__dahdi_8c_source.html#l15321">action_dahdishowchannels()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09249">dahdi_destroy_channel_bynum()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04313">dahdi_hangup()</a>, <a class="el" href="chan__dahdi_8c_source.html#l10834">dahdi_request()</a>, <a class="el" href="chan__dahdi_8c_source.html#l14338">dahdi_restart()</a>, <a class="el" href="chan__dahdi_8c_source.html#l15112">dahdi_set_dnd()</a>, <a class="el" href="chan__dahdi_8c_source.html#l14969">dahdi_set_hwgain()</a>, <a class="el" href="chan__dahdi_8c_source.html#l15038">dahdi_set_swgain()</a>, <a class="el" href="chan__dahdi_8c_source.html#l14609">dahdi_show_channel()</a>, <a class="el" href="chan__dahdi_8c_source.html#l14485">dahdi_show_channels()</a>, <a class="el" href="chan__dahdi_8c_source.html#l14309">dahdi_softhangup_all()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03929">destroy_all_channels()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03879">destroy_channel()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09496">do_monitor()</a>, <a class="el" href="chan__dahdi_8c_source.html#l10771">duplicate_pseudo()</a>, <a class="el" href="chan__dahdi_8c_source.html#l15201">find_channel()</a>, <a class="el" href="chan__phone_8c_source.html#l01339">load_module()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09990">mkintf()</a>, and <a class="el" href="chan__phone_8c_source.html#l01214">phone_request()</a>.</p>

</div>
</div>
<a class="anchor" id="a9dbc679cbf3418ca12b70a64acfbf03c"></a><!-- doxytag: member="chan_dahdi.c::lbostr" ref="a9dbc679cbf3418ca12b70a64acfbf03c" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="chan__dahdi_8c.html#a9dbc679cbf3418ca12b70a64acfbf03c">lbostr</a>[]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00161">161</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="a24514343553b05c66e5b7d16e2df45cc"></a><!-- doxytag: member="chan_dahdi.c::matchdigittimeout" ref="a24514343553b05c66e5b7d16e2df45cc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="chan__skinny_8c.html#a24514343553b05c66e5b7d16e2df45cc">matchdigittimeout</a> = 3000<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>How long to wait for an extra digit, if there is an ambiguous match. </p>

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00332">332</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="afbd6fc6e0ab3c1a04a518f19c21d4503"></a><!-- doxytag: member="chan_dahdi.c::monitor_thread" ref="afbd6fc6e0ab3c1a04a518f19c21d4503" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_t <a class="el" href="chan__unistim_8c.html#afbd6fc6e0ab3c1a04a518f19c21d4503">monitor_thread</a> = AST_PTHREADT_NULL<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This is the thread for the monitor which checks for input on the <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> which are not currently in use. </p>

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00354">354</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="a94ca20b7d80fbc4e7d2b1ea50e937243"></a><!-- doxytag: member="chan_dahdi.c::mwilevel" ref="a94ca20b7d80fbc4e7d2b1ea50e937243" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="chan__dahdi_8c.html#a94ca20b7d80fbc4e7d2b1ea50e937243">mwilevel</a> = 512<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00314">314</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="a200370774ee53e137af5d8d7932b7acc"></a><!-- doxytag: member="chan_dahdi.c::mwimonitornotify" ref="a200370774ee53e137af5d8d7932b7acc" args="[PATH_MAX]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="chan__dahdi_8c.html#a200370774ee53e137af5d8d7932b7acc">mwimonitornotify</a>[PATH_MAX] = &quot;&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Run this script when the MWI <a class="el" href="structstate.html">state</a> changes on an FXO line, if mwimonitor is enabled </p>

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00302">302</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="a3ae0342ed2b020e1e4cc4483e3fa55a6"></a><!-- doxytag: member="chan_dahdi.c::mwisend_rpas" ref="a3ae0342ed2b020e1e4cc4483e3fa55a6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="chan__dahdi_8c.html#a3ae0342ed2b020e1e4cc4483e3fa55a6">mwisend_rpas</a> = 0<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00304">304</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="a5ac083a645d964373f022d03df4849c8"></a><!-- doxytag: member="chan_dahdi.c::name" ref="a5ac083a645d964373f022d03df4849c8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* <a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l02368">2368</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad53fcc6c04d1c32732efa069a128136b"></a><!-- doxytag: member="chan_dahdi.c::num_cadence" ref="ad53fcc6c04d1c32732efa069a128136b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="chan__dahdi_8c.html#ad53fcc6c04d1c32732efa069a128136b">num_cadence</a> = 4<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l01473">1473</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="a4e11ab7baf933c0b5151114a755704a5"></a><!-- doxytag: member="chan_dahdi.c::num_restart_pending" ref="a4e11ab7baf933c0b5151114a755704a5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="chan__dahdi_8c.html#a4e11ab7baf933c0b5151114a755704a5">num_restart_pending</a> = 0<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00359">359</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="a1c57b0f6ff35a4eed5cd50a0d0c313ba"></a><!-- doxytag: member="chan_dahdi.c::numbufs" ref="a1c57b0f6ff35a4eed5cd50a0d0c313ba" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="chan__dahdi_8c.html#a1c57b0f6ff35a4eed5cd50a0d0c313ba">numbufs</a> = 4<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00312">312</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="ac59e01fcfbc9801f87f28f6b60957a24"></a><!-- doxytag: member="chan_dahdi.c::parkinglot" ref="ac59e01fcfbc9801f87f28f6b60957a24" args="[AST_MAX_EXTENSION]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="chan__mgcp_8c.html#a6b31bfcc769a5b5c31e13aa6d8a9a286">parkinglot</a>[AST_MAX_EXTENSION] = &quot;&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Default parking lot for this channel </p>

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00299">299</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="chan__iax2_8c_source.html#l02580">__find_callno()</a>, <a class="el" href="chan__iax2_8c_source.html#l05415">ast_iax2_new()</a>, <a class="el" href="res__features_8c_source.html#l03554">build_parkinglot()</a>, <a class="el" href="chan__sip_8c_source.html#l23690">build_peer()</a>, <a class="el" href="chan__iax2_8c_source.html#l12156">build_user()</a>, <a class="el" href="chan__iax2_8c_source.html#l07197">check_access()</a>, <a class="el" href="chan__sip_8c_source.html#l13923">check_peer_ok()</a>, <a class="el" href="chan__sip_8c_source.html#l05102">create_addr_from_peer()</a>, <a class="el" href="res__features_8c_source.html#l03224">find_parkinglot()</a>, <a class="el" href="res__features_8c_source.html#l00493">findparkinglotname()</a>, <a class="el" href="func__channel_8c_source.html#l00280">func_channel_write()</a>, <a class="el" href="chan__gtalk_8c_source.html#l01901">gtalk_load_config()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00989">gtalk_new()</a>, <a class="el" href="res__features_8c_source.html#l00566">park_space_reserve()</a>, <a class="el" href="res__features_8c_source.html#l00340">parkinglot_cmp_cb()</a>, <a class="el" href="res__features_8c_source.html#l00333">parkinglot_hash_cb()</a>, <a class="el" href="chan__console_8c_source.html#l01229">set_pvt_defaults()</a>, <a class="el" href="chan__sip_8c_source.html#l07151">sip_alloc()</a>, <a class="el" href="chan__sip_8c_source.html#l06599">sip_new()</a>, <a class="el" href="chan__sip_8c_source.html#l18778">sip_park()</a>, <a class="el" href="chan__skinny_8c_source.html#l04268">skinny_new()</a>, and <a class="el" href="chan__console_8c_source.html#l01277">store_config_core()</a>.</p>

</div>
</div>
<a class="anchor" id="ac3217a28bcd501a0e91a5337210750fb"></a><!-- doxytag: member="chan_dahdi.c::progzone" ref="ac3217a28bcd501a0e91a5337210750fb" args="[10]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="chan__dahdi_8c.html#ac3217a28bcd501a0e91a5337210750fb">progzone</a>[10] = &quot;&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00307">307</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="aadc5d8714afe5d456c8f17db3abf7f20"></a><!-- doxytag: member="chan_dahdi.c::ringt_base" ref="aadc5d8714afe5d456c8f17db3abf7f20" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="chan__dahdi_8c.html#aadc5d8714afe5d456c8f17db3abf7f20">ringt_base</a> = DEFAULT_RINGT<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Configured ring timeout base. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>Value computed from "ringtimeout" read in from chan_dahdi.conf if it exists. </dd></dl>

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00414">414</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad0a20124e90818c18842fd086b848e65"></a><!-- doxytag: member="chan_dahdi.c::round_robin" ref="ad0a20124e90818c18842fd086b848e65" args="[32]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structdahdi__pvt.html">dahdi_pvt</a>* <a class="el" href="chan__dahdi_8c.html#ad0a20124e90818c18842fd086b848e65">round_robin</a>[32]</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l01428">1428</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="aa0eccd1394a26a586074c22fe8d0ff43"></a><!-- doxytag: member="chan_dahdi.c::ss_thread_complete" ref="aa0eccd1394a26a586074c22fe8d0ff43" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="lock_8h.html#ab134d98cdfe7de0f7a72b377c0765dc7">ast_cond_t</a> <a class="el" href="chan__dahdi_8c.html#aa0eccd1394a26a586074c22fe8d0ff43">ss_thread_complete</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00355">355</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="aec2d8d3ba7708b470105092c392b9b0a"></a><!-- doxytag: member="chan_dahdi.c::ss_thread_count" ref="aec2d8d3ba7708b470105092c392b9b0a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="chan__dahdi_8c.html#aec2d8d3ba7708b470105092c392b9b0a">ss_thread_count</a> = 0<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00358">358</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="a1f86ec72c5397a22d1b0e29e47635f04"></a><!-- doxytag: member="chan_dahdi.c::subnames" ref="a1f86ec72c5397a22d1b0e29e47635f04" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* <a class="el" href="chan__dahdi_8c.html#a1f86ec72c5397a22d1b0e29e47635f04">subnames</a>[]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
   <span class="stringliteral">&quot;Real&quot;</span>,
   <span class="stringliteral">&quot;Callwait&quot;</span>,
   <span class="stringliteral">&quot;Threeway&quot;</span>
}
</pre></div>
<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00600">600</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="a71535bf985a1a06d548fd73a0a0ec32c"></a><!-- doxytag: member="chan_dahdi.c::tdesc" ref="a71535bf985a1a06d548fd73a0a0ec32c" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char <a class="el" href="chan__usbradio_8c.html#a206197bcdc50090e511e22b33a2166a9">tdesc</a>[] = &quot;DAHDI Telephony Driver&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00215">215</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="adbb77dd3bae219ee6a026c9bfa5a5242"></a><!-- doxytag: member="chan_dahdi.c::usedistinctiveringdetection" ref="adbb77dd3bae219ee6a026c9bfa5a5242" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="chan__dahdi_8c.html#adbb77dd3bae219ee6a026c9bfa5a5242">usedistinctiveringdetection</a> = 0<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l00309">309</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="a5143feca9ab414072f121c6b07619bdd"></a><!-- doxytag: member="chan_dahdi.c::user_has_defined_cadences" ref="a5143feca9ab414072f121c6b07619bdd" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="chan__dahdi_8c.html#a5143feca9ab414072f121c6b07619bdd">user_has_defined_cadences</a> = 0<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__dahdi_8c_source.html#l01474">1474</a> of file <a class="el" href="chan__dahdi_8c_source.html">chan_dahdi.c</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:19:56 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
