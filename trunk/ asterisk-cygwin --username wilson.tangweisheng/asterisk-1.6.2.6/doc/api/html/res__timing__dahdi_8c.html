<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:23:17 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_318a70d4e812a718d9ecaeea98fff199.html">res</a>
  </div>
</div>
<div class="contents">
<h1>res_timing_dahdi.c File Reference</h1>
<p>DAHDI timing interface.  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="asterisk_8h_source.html">asterisk.h</a>&quot;</code><br/>
<code>#include &lt;sys/types.h&gt;</code><br/>
<code>#include &lt;sys/stat.h&gt;</code><br/>
<code>#include &lt;fcntl.h&gt;</code><br/>
<code>#include &lt;math.h&gt;</code><br/>
<code>#include &lt;dahdi/user.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="module_8h_source.html">asterisk/module.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="timing_8h_source.html">asterisk/timing.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="utils_8h_source.html">asterisk/utils.h</a>&quot;</code><br/>

<p><a href="res__timing__dahdi_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__dahdi_8c.html#a61fe9155700a8ee38eeede4b077babe7">SEE_TIMING</a>&nbsp;&nbsp;&nbsp;&quot;For more information on Asterisk timing <a class="el" href="pbx__gtkconsole_8c.html#aa308c88ec23cbe0cb2ac92091eda1d29">modules</a>, including ways to potentially fix this problem, please see doc/timing.txt\n&quot;</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__dahdi_8c.html#a88b7c88fed6b80fd18f34f97757dfc04">__reg_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__dahdi_8c.html#afeab1257bd17282b95875499393a147a">__unreg_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__dahdi_8c.html#afac60b5ee746ee5c2137bcf259357d49">ASTERISK_FILE_VERSION</a> (__FILE__,&quot;$Revision: 199744 $&quot;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__dahdi_8c.html#add7d6dc94ad48c2f2a24bfc94c008821">dahdi_test_timer</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__dahdi_8c.html#ad4948b222e34bf1df3098f70c134a135">dahdi_timer_ack</a> (int handle, unsigned int quantity)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__dahdi_8c.html#aaaa964e077ab4e247985804d5275dab0">dahdi_timer_close</a> (int handle)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__dahdi_8c.html#a7a9e21c4d22f91862e6922962b4374db">dahdi_timer_disable_continuous</a> (int handle)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__dahdi_8c.html#ae7fcc2eb8a386890ef6de2c731ce19cf">dahdi_timer_enable_continuous</a> (int handle)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="timing_8h.html#aa21078cc57057eeda614cb7780bdc60a">ast_timer_event</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__dahdi_8c.html#ae4253f89c7c192971b8077c26f14b94f">dahdi_timer_get_event</a> (int handle)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__dahdi_8c.html#ac2bfa7430870778aaa81eeccd0e55b8e">dahdi_timer_get_max_rate</a> (int handle)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__dahdi_8c.html#a913fabdf61470d1a2e15a3ec2d63f6a7">dahdi_timer_open</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__dahdi_8c.html#a14b55117658c1c68a7240b9f52497ff9">dahdi_timer_set_rate</a> (int handle, unsigned int rate)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__dahdi_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__dahdi_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a> (void)</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__module__info.html">ast_module_info</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__dahdi_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a> = { .<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = AST_MODULE, .flags = AST_MODFLAG_LOAD_ORDER , .<a class="el" href="callerid_8c.html#a68344fa88cf4e86b5079fd69a5c22d57">description</a> = &quot;DAHDI Timing Interface&quot; , .key = &quot;This paragraph is copyright (c) 2006 by Digium, Inc. \In order for your module to load, it must return this \key via a function called \&quot;key\&quot;. Any code which \includes this paragraph must be licensed under the GNU \General Public License <a class="el" href="res__config__pgsql_8c.html#aad880fc4455c253781e8968f2239d56f">version</a> 2 or later (at your \option). In addition to Digium's general reservations \of rights, Digium expressly reserves the right to \allow other parties to license this paragraph under \different terms. Any use of Digium, Inc. trademarks or \logos (including \&quot;Asterisk\&quot; or \&quot;Digium\&quot;) without \express written <a class="el" href="structpermission.html">permission</a> of Digium, Inc. is prohibited.\n&quot; , .buildopt_sum = &quot;aefddfaffd51bc118c14a748e96eb9a0&quot; , .load = load_module, .unload = unload_module, .load_pri = 10, }</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__module__info.html">ast_module_info</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__dahdi_8c.html#ae25b9f3970870610911f8850897e8ead">ast_module_info</a> = &amp;<a class="el" href="res__timing__timerfd_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__timing__interface.html">ast_timing_interface</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__dahdi_8c.html#a08e1e5b24d2bb8bc3e643dda24d446f0">dahdi_timing</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__dahdi_8c.html#ac5071f22a1a673d4f64d2d7b86a72846">timing_funcs_handle</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>DAHDI timing interface. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Russell Bryant &lt;<a href="mailto:russell@digium.com">russell@digium.com</a>&gt; </dd></dl>

<p>Definition in file <a class="el" href="res__timing__dahdi_8c_source.html">res_timing_dahdi.c</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a61fe9155700a8ee38eeede4b077babe7"></a><!-- doxytag: member="res_timing_dahdi.c::SEE_TIMING" ref="a61fe9155700a8ee38eeede4b077babe7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SEE_TIMING&nbsp;&nbsp;&nbsp;&quot;For more information on Asterisk timing <a class="el" href="pbx__gtkconsole_8c.html#aa308c88ec23cbe0cb2ac92091eda1d29">modules</a>, including ways to potentially fix this problem, please see doc/timing.txt\n&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__timing__dahdi_8c_source.html#l00140">140</a> of file <a class="el" href="res__timing__dahdi_8c_source.html">res_timing_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="res__timing__dahdi_8c_source.html#l00142">dahdi_test_timer()</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a88b7c88fed6b80fd18f34f97757dfc04"></a><!-- doxytag: member="res_timing_dahdi.c::__reg_module" ref="a88b7c88fed6b80fd18f34f97757dfc04" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void __reg_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__timing__dahdi_8c_source.html#l00206">206</a> of file <a class="el" href="res__timing__dahdi_8c_source.html">res_timing_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="afeab1257bd17282b95875499393a147a"></a><!-- doxytag: member="res_timing_dahdi.c::__unreg_module" ref="afeab1257bd17282b95875499393a147a" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void __unreg_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__timing__dahdi_8c_source.html#l00206">206</a> of file <a class="el" href="res__timing__dahdi_8c_source.html">res_timing_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="afac60b5ee746ee5c2137bcf259357d49"></a><!-- doxytag: member="res_timing_dahdi.c::ASTERISK_FILE_VERSION" ref="afac60b5ee746ee5c2137bcf259357d49" args="(__FILE__,&quot;$Revision: 199744 $&quot;)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ASTERISK_FILE_VERSION </td>
          <td>(</td>
          <td class="paramtype">__FILE__&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&quot;$Revision: 199744 $&quot;&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="add7d6dc94ad48c2f2a24bfc94c008821"></a><!-- doxytag: member="res_timing_dahdi.c::dahdi_test_timer" ref="add7d6dc94ad48c2f2a24bfc94c008821" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int dahdi_test_timer </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__timing__dahdi_8c_source.html#l00142">142</a> of file <a class="el" href="res__timing__dahdi_8c_source.html">res_timing_dahdi.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="utils_8c_source.html#l01051">ast_wait_for_input()</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, and <a class="el" href="res__timing__dahdi_8c_source.html#l00140">SEE_TIMING</a>.</p>

<p>Referenced by <a class="el" href="res__timing__dahdi_8c_source.html#l00183">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00143"></a>00143 {
<a name="l00144"></a>00144    <span class="keywordtype">int</span> fd;
<a name="l00145"></a>00145    <span class="keywordtype">int</span> x = 160;
<a name="l00146"></a>00146    
<a name="l00147"></a>00147    fd = open(<span class="stringliteral">&quot;/dev/dahdi/timer&quot;</span>, O_RDWR);
<a name="l00148"></a>00148 
<a name="l00149"></a>00149    <span class="keywordflow">if</span> (fd &lt; 0) {
<a name="l00150"></a>00150       <span class="keywordflow">return</span> -1;
<a name="l00151"></a>00151    }
<a name="l00152"></a>00152 
<a name="l00153"></a>00153    <span class="keywordflow">if</span> (ioctl(fd, DAHDI_TIMERCONFIG, &amp;x)) {
<a name="l00154"></a>00154       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;You have DAHDI built and drivers loaded, but the DAHDI timer test failed to set DAHDI_TIMERCONFIG to %d.\n&quot;</span> <a class="code" href="res__timing__dahdi_8c.html#a61fe9155700a8ee38eeede4b077babe7">SEE_TIMING</a>, x);
<a name="l00155"></a>00155       close(fd);
<a name="l00156"></a>00156       <span class="keywordflow">return</span> -1;
<a name="l00157"></a>00157    }
<a name="l00158"></a>00158 
<a name="l00159"></a>00159    <span class="keywordflow">if</span> ((x = <a class="code" href="utils_8h.html#a60404ef44696316455e79c3a002cc71e">ast_wait_for_input</a>(fd, 300)) &lt; 0) {
<a name="l00160"></a>00160       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;You have DAHDI built and drivers loaded, but the DAHDI timer could not be polled during the DAHDI timer test.\n&quot;</span> <a class="code" href="res__timing__dahdi_8c.html#a61fe9155700a8ee38eeede4b077babe7">SEE_TIMING</a>);
<a name="l00161"></a>00161       close(fd);
<a name="l00162"></a>00162       <span class="keywordflow">return</span> -1;
<a name="l00163"></a>00163    }
<a name="l00164"></a>00164 
<a name="l00165"></a>00165    <span class="keywordflow">if</span> (!x) {
<a name="l00166"></a>00166       <span class="keyword">const</span> <span class="keywordtype">char</span> dahdi_timer_error[] = {
<a name="l00167"></a>00167          <span class="stringliteral">&quot;Asterisk has detected a problem with your DAHDI configuration and will shutdown for your protection.  You have options:&quot;</span>
<a name="l00168"></a>00168          <span class="stringliteral">&quot;\n\t1. You only have to compile DAHDI support into Asterisk if you need it.  One option is to recompile without DAHDI support.&quot;</span>
<a name="l00169"></a>00169          <span class="stringliteral">&quot;\n\t2. You only have to load DAHDI drivers if you want to take advantage of DAHDI services.  One option is to unload DAHDI modules if you don&apos;t need them.&quot;</span>
<a name="l00170"></a>00170          <span class="stringliteral">&quot;\n\t3. If you need DAHDI services, you must correctly configure DAHDI.&quot;</span>
<a name="l00171"></a>00171       };
<a name="l00172"></a>00172       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;%s\n&quot;</span> <a class="code" href="res__timing__dahdi_8c.html#a61fe9155700a8ee38eeede4b077babe7">SEE_TIMING</a>, dahdi_timer_error);
<a name="l00173"></a>00173       usleep(100);
<a name="l00174"></a>00174       close(fd);
<a name="l00175"></a>00175       <span class="keywordflow">return</span> -1;
<a name="l00176"></a>00176    }
<a name="l00177"></a>00177 
<a name="l00178"></a>00178    close(fd);
<a name="l00179"></a>00179 
<a name="l00180"></a>00180    <span class="keywordflow">return</span> 0;
<a name="l00181"></a>00181 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad4948b222e34bf1df3098f70c134a135"></a><!-- doxytag: member="res_timing_dahdi.c::dahdi_timer_ack" ref="ad4948b222e34bf1df3098f70c134a135" args="(int handle, unsigned int quantity)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void dahdi_timer_ack </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>quantity</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__timing__dahdi_8c_source.html#l00096">96</a> of file <a class="el" href="res__timing__dahdi_8c_source.html">res_timing_dahdi.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00097"></a>00097 {
<a name="l00098"></a>00098    ioctl(handle, DAHDI_TIMERACK, &amp;quantity);
<a name="l00099"></a>00099 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aaaa964e077ab4e247985804d5275dab0"></a><!-- doxytag: member="res_timing_dahdi.c::dahdi_timer_close" ref="aaaa964e077ab4e247985804d5275dab0" args="(int handle)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void dahdi_timer_close </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>handle</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__timing__dahdi_8c_source.html#l00074">74</a> of file <a class="el" href="res__timing__dahdi_8c_source.html">res_timing_dahdi.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00075"></a>00075 {
<a name="l00076"></a>00076    close(handle);
<a name="l00077"></a>00077 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7a9e21c4d22f91862e6922962b4374db"></a><!-- doxytag: member="res_timing_dahdi.c::dahdi_timer_disable_continuous" ref="a7a9e21c4d22f91862e6922962b4374db" args="(int handle)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int dahdi_timer_disable_continuous </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>handle</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__timing__dahdi_8c_source.html#l00108">108</a> of file <a class="el" href="res__timing__dahdi_8c_source.html">res_timing_dahdi.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00109"></a>00109 {
<a name="l00110"></a>00110    <span class="keywordtype">int</span> flags = -1;
<a name="l00111"></a>00111 
<a name="l00112"></a>00112    <span class="keywordflow">return</span> ioctl(handle, DAHDI_TIMERPONG, &amp;flags) ? -1 : 0;
<a name="l00113"></a>00113 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae7fcc2eb8a386890ef6de2c731ce19cf"></a><!-- doxytag: member="res_timing_dahdi.c::dahdi_timer_enable_continuous" ref="ae7fcc2eb8a386890ef6de2c731ce19cf" args="(int handle)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int dahdi_timer_enable_continuous </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>handle</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__timing__dahdi_8c_source.html#l00101">101</a> of file <a class="el" href="res__timing__dahdi_8c_source.html">res_timing_dahdi.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00102"></a>00102 {
<a name="l00103"></a>00103    <span class="keywordtype">int</span> flags = 1;
<a name="l00104"></a>00104 
<a name="l00105"></a>00105    <span class="keywordflow">return</span> ioctl(handle, DAHDI_TIMERPING, &amp;flags) ? -1 : 0;
<a name="l00106"></a>00106 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae4253f89c7c192971b8077c26f14b94f"></a><!-- doxytag: member="res_timing_dahdi.c::dahdi_timer_get_event" ref="ae4253f89c7c192971b8077c26f14b94f" args="(int handle)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="timing_8h.html#aa21078cc57057eeda614cb7780bdc60a">ast_timer_event</a> dahdi_timer_get_event </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>handle</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__timing__dahdi_8c_source.html#l00115">115</a> of file <a class="el" href="res__timing__dahdi_8c_source.html">res_timing_dahdi.c</a>.</p>

<p>References <a class="el" href="timing_8h_source.html#l00059">AST_TIMING_EVENT_CONTINUOUS</a>, and <a class="el" href="timing_8h_source.html#l00058">AST_TIMING_EVENT_EXPIRED</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00116"></a>00116 {
<a name="l00117"></a>00117    <span class="keywordtype">int</span> res;
<a name="l00118"></a>00118    <span class="keywordtype">int</span> event;
<a name="l00119"></a>00119 
<a name="l00120"></a>00120    res = ioctl(handle, DAHDI_GETEVENT, &amp;event);
<a name="l00121"></a>00121 
<a name="l00122"></a>00122    <span class="keywordflow">if</span> (res) {
<a name="l00123"></a>00123       <span class="keyword">event</span> = DAHDI_EVENT_TIMER_EXPIRED;
<a name="l00124"></a>00124    }
<a name="l00125"></a>00125 
<a name="l00126"></a>00126    <span class="keywordflow">switch</span> (event) {
<a name="l00127"></a>00127    <span class="keywordflow">case</span> DAHDI_EVENT_TIMER_PING:
<a name="l00128"></a>00128       <span class="keywordflow">return</span> <a class="code" href="timing_8h.html#aa21078cc57057eeda614cb7780bdc60aa2f1a45286f54b8f415b28dc072b931e6">AST_TIMING_EVENT_CONTINUOUS</a>;
<a name="l00129"></a>00129    <span class="keywordflow">case</span> DAHDI_EVENT_TIMER_EXPIRED:
<a name="l00130"></a>00130    <span class="keywordflow">default</span>:
<a name="l00131"></a>00131       <span class="keywordflow">return</span> <a class="code" href="timing_8h.html#aa21078cc57057eeda614cb7780bdc60aa6338cdd939adbc65d20e3412bf11fc3c">AST_TIMING_EVENT_EXPIRED</a>; 
<a name="l00132"></a>00132    }
<a name="l00133"></a>00133 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac2bfa7430870778aaa81eeccd0e55b8e"></a><!-- doxytag: member="res_timing_dahdi.c::dahdi_timer_get_max_rate" ref="ac2bfa7430870778aaa81eeccd0e55b8e" args="(int handle)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static unsigned int dahdi_timer_get_max_rate </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>handle</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__timing__dahdi_8c_source.html#l00135">135</a> of file <a class="el" href="res__timing__dahdi_8c_source.html">res_timing_dahdi.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00136"></a>00136 {
<a name="l00137"></a>00137    <span class="keywordflow">return</span> 1000;
<a name="l00138"></a>00138 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a913fabdf61470d1a2e15a3ec2d63f6a7"></a><!-- doxytag: member="res_timing_dahdi.c::dahdi_timer_open" ref="a913fabdf61470d1a2e15a3ec2d63f6a7" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int dahdi_timer_open </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__timing__dahdi_8c_source.html#l00069">69</a> of file <a class="el" href="res__timing__dahdi_8c_source.html">res_timing_dahdi.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00070"></a>00070 {
<a name="l00071"></a>00071    <span class="keywordflow">return</span> open(<span class="stringliteral">&quot;/dev/dahdi/timer&quot;</span>, O_RDWR);
<a name="l00072"></a>00072 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a14b55117658c1c68a7240b9f52497ff9"></a><!-- doxytag: member="res_timing_dahdi.c::dahdi_timer_set_rate" ref="a14b55117658c1c68a7240b9f52497ff9" args="(int handle, unsigned int rate)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int dahdi_timer_set_rate </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>rate</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__timing__dahdi_8c_source.html#l00079">79</a> of file <a class="el" href="res__timing__dahdi_8c_source.html">res_timing_dahdi.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, and <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00080"></a>00080 {
<a name="l00081"></a>00081    <span class="keywordtype">int</span> samples;
<a name="l00082"></a>00082 
<a name="l00083"></a>00083    <span class="comment">/* DAHDI timers are configured using a number of samples,</span>
<a name="l00084"></a>00084 <span class="comment">    * based on an 8 kHz sample rate. */</span>
<a name="l00085"></a>00085    samples = (<span class="keywordtype">unsigned</span> int) roundf((8000.0 / ((<span class="keywordtype">float</span>) rate)));
<a name="l00086"></a>00086 
<a name="l00087"></a>00087    <span class="keywordflow">if</span> (ioctl(handle, DAHDI_TIMERCONFIG, &amp;samples)) {
<a name="l00088"></a>00088       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to configure DAHDI timing fd for %u sample timer ticks\n&quot;</span>,
<a name="l00089"></a>00089          samples);
<a name="l00090"></a>00090       <span class="keywordflow">return</span> -1;
<a name="l00091"></a>00091    }
<a name="l00092"></a>00092 
<a name="l00093"></a>00093    <span class="keywordflow">return</span> 0;
<a name="l00094"></a>00094 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac3382bf6da54c56b37069bd76bbdf4f9"></a><!-- doxytag: member="res_timing_dahdi.c::load_module" ref="ac3382bf6da54c56b37069bd76bbdf4f9" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int load_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__timing__dahdi_8c_source.html#l00183">183</a> of file <a class="el" href="res__timing__dahdi_8c_source.html">res_timing_dahdi.c</a>.</p>

<p>References <a class="el" href="module_8h_source.html#l00062">AST_MODULE_LOAD_DECLINE</a>, <a class="el" href="module_8h_source.html#l00061">AST_MODULE_LOAD_SUCCESS</a>, <a class="el" href="timing_8h_source.html#l00094">ast_register_timing_interface</a>, <a class="el" href="res__timing__dahdi_8c_source.html#l00142">dahdi_test_timer()</a>, and <a class="el" href="res__timing__dahdi_8c_source.html#l00045">timing_funcs_handle</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00184"></a>00184 {
<a name="l00185"></a>00185    <span class="keywordflow">if</span> (<a class="code" href="res__timing__dahdi_8c.html#add7d6dc94ad48c2f2a24bfc94c008821">dahdi_test_timer</a>()) {
<a name="l00186"></a>00186       <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;
<a name="l00187"></a>00187    }
<a name="l00188"></a>00188 
<a name="l00189"></a>00189    <span class="keywordflow">return</span> (<a class="code" href="res__timing__dahdi_8c.html#ac5071f22a1a673d4f64d2d7b86a72846">timing_funcs_handle</a> = <a class="code" href="timing_8h.html#a3f3f2e1390eb451dcc88dc09b0511af2" title="Register a set of timing functions.">ast_register_timing_interface</a>(&amp;<a class="code" href="res__timing__dahdi_8c.html#a08e1e5b24d2bb8bc3e643dda24d446f0">dahdi_timing</a>)) ?
<a name="l00190"></a>00190       <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a> : <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;
<a name="l00191"></a>00191 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad09fa931f468002152a3cc2d5ce25eae"></a><!-- doxytag: member="res_timing_dahdi.c::unload_module" ref="ad09fa931f468002152a3cc2d5ce25eae" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int unload_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__timing__dahdi_8c_source.html#l00193">193</a> of file <a class="el" href="res__timing__dahdi_8c_source.html">res_timing_dahdi.c</a>.</p>

<p>References <a class="el" href="timing_8c_source.html#l00101">ast_unregister_timing_interface()</a>, and <a class="el" href="res__timing__dahdi_8c_source.html#l00045">timing_funcs_handle</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00194"></a>00194 {
<a name="l00195"></a>00195    <span class="keywordflow">if</span> (<a class="code" href="res__timing__dahdi_8c.html#ac5071f22a1a673d4f64d2d7b86a72846">timing_funcs_handle</a>) {
<a name="l00196"></a>00196       <span class="keywordflow">return</span> <a class="code" href="timing_8h.html#a5959c36b6984c24360cf99aaef9b2677" title="Unregister a previously registered timing interface.">ast_unregister_timing_interface</a>(<a class="code" href="res__timing__dahdi_8c.html#ac5071f22a1a673d4f64d2d7b86a72846">timing_funcs_handle</a>);
<a name="l00197"></a>00197    }
<a name="l00198"></a>00198 
<a name="l00199"></a>00199    <span class="keywordflow">return</span> 0;
<a name="l00200"></a>00200 }
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="ab22f32016155f7f403e7178767163d7d"></a><!-- doxytag: member="res_timing_dahdi.c::__mod_info" ref="ab22f32016155f7f403e7178767163d7d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__module__info.html">ast_module_info</a> <a class="el" href="res__timing__timerfd_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a> = { .<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = AST_MODULE, .flags = AST_MODFLAG_LOAD_ORDER , .<a class="el" href="callerid_8c.html#a68344fa88cf4e86b5079fd69a5c22d57">description</a> = &quot;DAHDI Timing Interface&quot; , .key = &quot;This paragraph is copyright (c) 2006 by Digium, Inc. \In order for your module to load, it must return this \key via a function called \&quot;key\&quot;. Any code which \includes this paragraph must be licensed under the GNU \General Public License <a class="el" href="res__config__pgsql_8c.html#aad880fc4455c253781e8968f2239d56f">version</a> 2 or later (at your \option). In addition to Digium's general reservations \of rights, Digium expressly reserves the right to \allow other parties to license this paragraph under \different terms. Any use of Digium, Inc. trademarks or \logos (including \&quot;Asterisk\&quot; or \&quot;Digium\&quot;) without \express written <a class="el" href="structpermission.html">permission</a> of Digium, Inc. is prohibited.\n&quot; , .buildopt_sum = &quot;aefddfaffd51bc118c14a748e96eb9a0&quot; , .load = load_module, .unload = unload_module, .load_pri = 10, }<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__timing__dahdi_8c_source.html#l00206">206</a> of file <a class="el" href="res__timing__dahdi_8c_source.html">res_timing_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae25b9f3970870610911f8850897e8ead"></a><!-- doxytag: member="res_timing_dahdi.c::ast_module_info" ref="ae25b9f3970870610911f8850897e8ead" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__module__info.html">ast_module_info</a>* <a class="el" href="structast__module__info.html">ast_module_info</a> = &amp;<a class="el" href="res__timing__timerfd_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__timing__dahdi_8c_source.html#l00206">206</a> of file <a class="el" href="res__timing__dahdi_8c_source.html">res_timing_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="a08e1e5b24d2bb8bc3e643dda24d446f0"></a><!-- doxytag: member="res_timing_dahdi.c::dahdi_timing" ref="a08e1e5b24d2bb8bc3e643dda24d446f0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__timing__interface.html">ast_timing_interface</a> <a class="el" href="res__timing__dahdi_8c.html#a08e1e5b24d2bb8bc3e643dda24d446f0">dahdi_timing</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__timing__dahdi_8c_source.html#l00056">56</a> of file <a class="el" href="res__timing__dahdi_8c_source.html">res_timing_dahdi.c</a>.</p>

</div>
</div>
<a class="anchor" id="ac5071f22a1a673d4f64d2d7b86a72846"></a><!-- doxytag: member="res_timing_dahdi.c::timing_funcs_handle" ref="ac5071f22a1a673d4f64d2d7b86a72846" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* <a class="el" href="res__timing__timerfd_8c.html#ac5071f22a1a673d4f64d2d7b86a72846">timing_funcs_handle</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__timing__dahdi_8c_source.html#l00045">45</a> of file <a class="el" href="res__timing__dahdi_8c_source.html">res_timing_dahdi.c</a>.</p>

<p>Referenced by <a class="el" href="res__timing__dahdi_8c_source.html#l00183">load_module()</a>, and <a class="el" href="res__timing__dahdi_8c_source.html#l00193">unload_module()</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:23:17 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
