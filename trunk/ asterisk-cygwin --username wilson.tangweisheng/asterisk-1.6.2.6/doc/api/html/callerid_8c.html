<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:19:41 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_afe38fc0ccf2e9eefca5d5c6b03503d9.html">main</a>
  </div>
</div>
<div class="contents">
<h1>callerid.c File Reference</h1>
<p>CallerID Generation support.  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="asterisk_8h_source.html">asterisk.h</a>&quot;</code><br/>
<code>#include &lt;<a class="el" href="time_8h_source.html">time.h</a>&gt;</code><br/>
<code>#include &lt;math.h&gt;</code><br/>
<code>#include &lt;ctype.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="ulaw_8h_source.html">asterisk/ulaw.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="alaw_8h_source.html">asterisk/alaw.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="frame_8h_source.html">asterisk/frame.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="channel_8h_source.html">asterisk/channel.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="callerid_8h_source.html">asterisk/callerid.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="fskmodem_8h_source.html">asterisk/fskmodem.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="utils_8h_source.html">asterisk/utils.h</a>&quot;</code><br/>

<p><a href="callerid_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcallerid__state.html">callerid_state</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#af0451163d41eba078d01949d368cae8f">AST_CALLERID_UNKNOWN</a>&nbsp;&nbsp;&nbsp;&quot;&lt;unknown&gt;&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#aa77a53334827b801fa3f5865c26ab6e0">CALLERID_MARK</a>&nbsp;&nbsp;&nbsp;1200.0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#ae22e91b5117c723dd02bfcc5e382bdd7">CALLERID_SPACE</a>&nbsp;&nbsp;&nbsp;2200.0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#a8f2259fb59644af478715f091739ade8">CAS_FREQ1</a>&nbsp;&nbsp;&nbsp;2130.0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#a69603be4978e9a144bef1b7e29630008">CAS_FREQ2</a>&nbsp;&nbsp;&nbsp;2750.0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#a17433d3c64fa04166b2585cad952a436">SAS_FREQ</a>&nbsp;&nbsp;&nbsp;440.0</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#a90dc7c71024950ef138b50f0cf73fe05">__ast_callerid_generate</a> (unsigned char *<a class="el" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, const char *<a class="el" href="structnumber.html">number</a>, int <a class="el" href="chan__mgcp_8c.html#a50ea1ecd6da04bb18650fe24943d23d1">callwaiting</a>, int codec)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#adaee7c971091adf49557cf4b7a0ffa3d">ast_callerid_callwaiting_generate</a> (unsigned char *<a class="el" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, const char *<a class="el" href="structnumber.html">number</a>, int codec)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Generate Caller-ID spill but in a format suitable for Call Waiting(tm)'s Caller*ID(tm) See <a class="el" href="callerid_8h.html#a9700baf9deee60587fa1ef9b7bb9987b" title="Generate Caller-ID spill from the &quot;callerid&quot; field of asterisk (in e-mail...">ast_callerid_generate()</a> for other details.  <a href="#adaee7c971091adf49557cf4b7a0ffa3d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#a9700baf9deee60587fa1ef9b7bb9987b">ast_callerid_generate</a> (unsigned char *<a class="el" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, const char *<a class="el" href="structnumber.html">number</a>, int codec)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Generate Caller-ID spill from the "callerid" field of asterisk (in e-mail address like format).  <a href="#a9700baf9deee60587fa1ef9b7bb9987b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#a1c25633b1ed63682c95ec613d7cbe559">ast_callerid_merge</a> (char *<a class="el" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, int bufsiz, const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, const char *<a class="el" href="adsistub_8c.html#af6fc584548091f45267cfaf7066119bd">num</a>, const char *unknown)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#a39e03ca4e8df3a1d2c75e888d76201df">ast_callerid_parse</a> (char *instr, char **<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, char **location)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Destructively parse instr for caller id information.  <a href="#a39e03ca4e8df3a1d2c75e888d76201df"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#ae198fa9405854429974768ad54edd05d">ast_callerid_split</a> (const char *<a class="el" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, int namelen, char *<a class="el" href="adsistub_8c.html#af6fc584548091f45267cfaf7066119bd">num</a>, int numlen)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#a4b8a5c3b5ed37a9e1396ddef68ac7846">ast_describe_caller_presentation</a> (int data)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Convert caller ID pres value to explanatory string.  <a href="#a4b8a5c3b5ed37a9e1396ddef68ac7846"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#aa5ef2658f11c1c40e3443216f87397da">ast_gen_cas</a> (unsigned char *outbuf, int sendsas, int len, int codec)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#ae9c1fe6ac3c381fd57719a1a19182225">ast_is_shrinkable_phonenumber</a> (const char *<a class="el" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">checks if string consists only of digits and ( ) - * # and + Pre-qualifies the string for <a class="el" href="callerid_8h.html#a6a61669b28d0f994e44db5e3baab6ef2" title="Shrink a phone number in place to just digits (more accurately it just removes ()&#39;s...">ast_shrink_phone_number()</a>  <a href="#ae9c1fe6ac3c381fd57719a1a19182225"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#a6aadfef3ff9c0b25b909909dadc92a90">ast_is_valid_string</a> (const char *<a class="el" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, const char *valid)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Checks if phone <a class="el" href="structnumber.html" title="Number structure.">number</a> consists of valid characters.  <a href="#a6aadfef3ff9c0b25b909909dadc92a90"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#abbaf2d96bf4d17406d600876364c1133">ast_isphonenumber</a> (const char *n)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">checks if string consists only of digits and * # and +  <a href="#abbaf2d96bf4d17406d600876364c1133"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#ac1391d3fb87904ae33a70839451ca6bb">ast_named_caller_presentation</a> (int data)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Convert caller ID pres value to text code.  <a href="#ac1391d3fb87904ae33a70839451ca6bb"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#a13d412653c31f84508b594005292a52c">ast_parse_caller_presentation</a> (const char *data)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Convert caller ID text code to value used in config file parsing.  <a href="#a13d412653c31f84508b594005292a52c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#a6a61669b28d0f994e44db5e3baab6ef2">ast_shrink_phone_number</a> (char *n)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Clean up phone string remove '(', ' ', ')', non-trailing '.', and '-' not in square brackets. Basically, remove anything that could be invalid in a pattern.  <a href="#a6a61669b28d0f994e44db5e3baab6ef2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static unsigned short&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#a3faa215563ac24dec8ae8906dabafd3e">calc_crc</a> (unsigned short crc, unsigned char data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#a6c593ce4925117f97e754a735608da16">callerid_feed</a> (struct <a class="el" href="structcallerid__state.html">callerid_state</a> *cid, unsigned char *ubuf, int len, int codec)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read samples into the <a class="el" href="structstate.html">state</a> machine.  <a href="#a6c593ce4925117f97e754a735608da16"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#a3fffc9efa1b0586f0a1420fbba64196e">callerid_feed_jp</a> (struct <a class="el" href="structcallerid__state.html">callerid_state</a> *cid, unsigned char *ubuf, int len, int codec)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read samples into the <a class="el" href="structstate.html">state</a> machine.  <a href="#a3fffc9efa1b0586f0a1420fbba64196e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#a4d792e593d99c8b5b3a5534e73082c9d">callerid_free</a> (struct <a class="el" href="structcallerid__state.html">callerid_state</a> *cid)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Free a callerID <a class="el" href="structstate.html">state</a>.  <a href="#a4d792e593d99c8b5b3a5534e73082c9d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#a0976c857568032bd94e16c789bcfa213">callerid_generate</a> (unsigned char *<a class="el" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, const char *<a class="el" href="structnumber.html">number</a>, const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, int flags, int <a class="el" href="chan__mgcp_8c.html#a50ea1ecd6da04bb18650fe24943d23d1">callwaiting</a>, int codec)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Generates a CallerID FSK stream in ulaw format suitable for transmission.  <a href="#a0976c857568032bd94e16c789bcfa213"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#a315d5278c97c5c96bfe89c6d0e24fd42">callerid_genmsg</a> (char *<a class="el" href="adsistub_8c.html#a0dee90db1d6eb30329bee1ae6cec036a">msg</a>, int size, const char *<a class="el" href="structnumber.html">number</a>, const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, int flags)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#afed6bec2ec821870918daf8f6d7ea832">callerid_get</a> (struct <a class="el" href="structcallerid__state.html">callerid_state</a> *cid, char **<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, char **<a class="el" href="structnumber.html">number</a>, int *flags)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Extract info out of callerID <a class="el" href="structstate.html">state</a> machine. Flags are listed above.  <a href="#afed6bec2ec821870918daf8f6d7ea832"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#ab5fe1d08c3e1f692c09923587e1cce70">callerid_get_dtmf</a> (char *cidstring, char *<a class="el" href="structnumber.html">number</a>, int *flags)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#a9c1767ffd4ca30651bcc241c16d1f071">callerid_init</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize stuff for inverse FFT.  <a href="#a9c1767ffd4ca30651bcc241c16d1f071"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structcallerid__state.html">callerid_state</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#ae48529c2f2ea547ec29a2451b8fef8a2">callerid_new</a> (int cid_signalling)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create a callerID <a class="el" href="structstate.html">state</a> machine.  <a href="#ae48529c2f2ea547ec29a2451b8fef8a2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#a08b47682e1d5e73068da4fa2344284a0">gen_tone</a> (unsigned char *<a class="el" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, int len, int codec, float ddr1, float ddi1, float *cr1, float *ci1)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#a0f5e4eef0eeba71986c4df9f4a9ada41">gen_tones</a> (unsigned char *<a class="el" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, int len, int codec, float ddr1, float ddi1, float ddr2, float ddi2, float *cr1, float *ci1, float *cr2, float *ci2)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#a8b49195fa90c382bda46882ffabfe0a2">vmwi_generate</a> (unsigned char *<a class="el" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, int active, int <a class="el" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>, int codec, const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, const char *<a class="el" href="structnumber.html">number</a>, int flags)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Generate <a class="el" href="structmessage.html">message</a> waiting indicator.  <a href="#a8b49195fa90c382bda46882ffabfe0a2"></a><br/></td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">float&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#a1fc9110f09a12aef8ba8a94479dc03c3">casdi1</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">float&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#ac4647d3812e6efba4e068f86b2ab2574">casdi2</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">float&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#acffc1e68a433ac6fd82d29d859805971">casdr1</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">float&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#acb906a5386153c9b5cb1d078fb033443">casdr2</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">float&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#ae28e7a746ab99a470a022ff2eba08a88">cid_di</a> [4]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">float&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#a271c1c132faed1b658e2fba40c41b868">cid_dr</a> [4]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">float&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#af30a3f664009e7371f3dca3231f9fd8d">clidsb</a> = 8000.0 / 1200.0</td></tr>
<tr><td class="memItemLeft" >struct {</td></tr>
<tr><td class="memItemLeft" >&nbsp;&nbsp;&nbsp;const char *&nbsp;&nbsp;&nbsp;<a class="el" href="callerid_8c.html#a68344fa88cf4e86b5079fd69a5c22d57">description</a></td></tr>
<tr><td class="memItemLeft" >&nbsp;&nbsp;&nbsp;const char *&nbsp;&nbsp;&nbsp;<a class="el" href="callerid_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a></td></tr>
<tr><td class="memItemLeft" >&nbsp;&nbsp;&nbsp;int&nbsp;&nbsp;&nbsp;<a class="el" href="callerid_8c.html#aa0ccb5ee6d882ee3605ff47745c6467b">val</a></td></tr>
<tr><td class="memItemLeft" valign="top">}&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#a82a1d1b75a9c8c801ca76119815f11b9">pres_types</a> []</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Translation table for Caller ID Presentation settings.  <a href="#a82a1d1b75a9c8c801ca76119815f11b9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">float&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#ae81f6b006f99cb8e2a8dca1b21eda4be">sasdi</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">float&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="callerid_8c.html#a37d6e99cad72f8884d9c575ac45badb9">sasdr</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>CallerID Generation support. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Mark Spencer &lt;<a href="mailto:markster@digium.com">markster@digium.com</a>&gt; </dd></dl>

<p>Definition in file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="af0451163d41eba078d01949d368cae8f"></a><!-- doxytag: member="callerid.c::AST_CALLERID_UNKNOWN" ref="af0451163d41eba078d01949d368cae8f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_CALLERID_UNKNOWN&nbsp;&nbsp;&nbsp;&quot;&lt;unknown&gt;&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="callerid_8c_source.html#l00072">72</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

</div>
</div>
<a class="anchor" id="aa77a53334827b801fa3f5865c26ab6e0"></a><!-- doxytag: member="callerid.c::CALLERID_MARK" ref="aa77a53334827b801fa3f5865c26ab6e0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CALLERID_MARK&nbsp;&nbsp;&nbsp;1200.0</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>1200 hz for "1" </p>

<p>Definition at line <a class="el" href="callerid_8c_source.html#l00067">67</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

<p>Referenced by <a class="el" href="callerid_8c_source.html#l00112">callerid_init()</a>.</p>

</div>
</div>
<a class="anchor" id="ae22e91b5117c723dd02bfcc5e382bdd7"></a><!-- doxytag: member="callerid.c::CALLERID_SPACE" ref="ae22e91b5117c723dd02bfcc5e382bdd7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CALLERID_SPACE&nbsp;&nbsp;&nbsp;2200.0</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>2200 hz for "0" </p>

<p>Definition at line <a class="el" href="callerid_8c_source.html#l00066">66</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

<p>Referenced by <a class="el" href="callerid_8c_source.html#l00112">callerid_init()</a>.</p>

</div>
</div>
<a class="anchor" id="a8f2259fb59644af478715f091739ade8"></a><!-- doxytag: member="callerid.c::CAS_FREQ1" ref="a8f2259fb59644af478715f091739ade8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CAS_FREQ1&nbsp;&nbsp;&nbsp;2130.0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="callerid_8c_source.html#l00069">69</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

<p>Referenced by <a class="el" href="callerid_8c_source.html#l00112">callerid_init()</a>.</p>

</div>
</div>
<a class="anchor" id="a69603be4978e9a144bef1b7e29630008"></a><!-- doxytag: member="callerid.c::CAS_FREQ2" ref="a69603be4978e9a144bef1b7e29630008" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CAS_FREQ2&nbsp;&nbsp;&nbsp;2750.0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="callerid_8c_source.html#l00070">70</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

<p>Referenced by <a class="el" href="callerid_8c_source.html#l00112">callerid_init()</a>.</p>

</div>
</div>
<a class="anchor" id="a17433d3c64fa04166b2585cad952a436"></a><!-- doxytag: member="callerid.c::SAS_FREQ" ref="a17433d3c64fa04166b2585cad952a436" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SAS_FREQ&nbsp;&nbsp;&nbsp;440.0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="callerid_8c_source.html#l00068">68</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

<p>Referenced by <a class="el" href="callerid_8c_source.html#l00112">callerid_init()</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a90dc7c71024950ef138b50f0cf73fe05"></a><!-- doxytag: member="callerid.c::__ast_callerid_generate" ref="a90dc7c71024950ef138b50f0cf73fe05" args="(unsigned char *buf, const char *name, const char *number, int callwaiting, int codec)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int __ast_callerid_generate </td>
          <td>(</td>
          <td class="paramtype">unsigned char *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>number</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>callwaiting</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>codec</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="callerid_8c_source.html#l01053">1053</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

<p>References <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, and <a class="el" href="callerid_8c_source.html#l00882">callerid_generate()</a>.</p>

<p>Referenced by <a class="el" href="callerid_8c_source.html#l01067">ast_callerid_callwaiting_generate()</a>, and <a class="el" href="callerid_8c_source.html#l01062">ast_callerid_generate()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01054"></a>01054 {
<a name="l01055"></a>01055    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>))
<a name="l01056"></a>01056       <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a> = NULL;
<a name="l01057"></a>01057    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="structnumber.html" title="Number structure.">number</a>))
<a name="l01058"></a>01058       <a class="code" href="structnumber.html" title="Number structure.">number</a> = NULL;
<a name="l01059"></a>01059    <span class="keywordflow">return</span> <a class="code" href="callerid_8h.html#a0976c857568032bd94e16c789bcfa213" title="Generates a CallerID FSK stream in ulaw format suitable for transmission.">callerid_generate</a>(<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <a class="code" href="structnumber.html" title="Number structure.">number</a>, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, 0, <a class="code" href="chan__mgcp_8c.html#a50ea1ecd6da04bb18650fe24943d23d1">callwaiting</a>, codec);
<a name="l01060"></a>01060 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="adaee7c971091adf49557cf4b7a0ffa3d"></a><!-- doxytag: member="callerid.c::ast_callerid_callwaiting_generate" ref="adaee7c971091adf49557cf4b7a0ffa3d" args="(unsigned char *buf, const char *name, const char *number, int codec)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_callerid_callwaiting_generate </td>
          <td>(</td>
          <td class="paramtype">unsigned char *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>number</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>codec</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Generate Caller-ID spill but in a format suitable for Call Waiting(tm)'s Caller*ID(tm) See <a class="el" href="callerid_8h.html#a9700baf9deee60587fa1ef9b7bb9987b" title="Generate Caller-ID spill from the &quot;callerid&quot; field of asterisk (in e-mail...">ast_callerid_generate()</a> for other details. </p>

<p>Definition at line <a class="el" href="callerid_8c_source.html#l01067">1067</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

<p>References <a class="el" href="callerid_8c_source.html#l01053">__ast_callerid_generate()</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l02986">send_cwcidspill()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01068"></a>01068 {
<a name="l01069"></a>01069    <span class="keywordflow">return</span> <a class="code" href="callerid_8c.html#a90dc7c71024950ef138b50f0cf73fe05">__ast_callerid_generate</a>(<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <a class="code" href="structnumber.html" title="Number structure.">number</a>, 1, codec);
<a name="l01070"></a>01070 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9700baf9deee60587fa1ef9b7bb9987b"></a><!-- doxytag: member="callerid.c::ast_callerid_generate" ref="a9700baf9deee60587fa1ef9b7bb9987b" args="(unsigned char *buf, const char *name, const char *number, int codec)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_callerid_generate </td>
          <td>(</td>
          <td class="paramtype">unsigned char *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>number</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>codec</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Generate Caller-ID spill from the "callerid" field of asterisk (in e-mail address like format). </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>buf</em>&nbsp;</td><td>buffer for output samples. See <a class="el" href="callerid_8h.html#a0976c857568032bd94e16c789bcfa213" title="Generates a CallerID FSK stream in ulaw format suitable for transmission.">callerid_generate()</a> for details regarding buffer. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>Caller-ID Name </td></tr>
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structnumber.html" title="Number structure.">number</a></em>&nbsp;</td><td>Caller-ID Number </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>codec</em>&nbsp;</td><td>Asterisk codec (either AST_FORMAT_ALAW or AST_FORMAT_ULAW)</td></tr>
  </table>
  </dd>
</dl>
<p>Acts like callerid_generate except uses an asterisk format callerid string. </p>

<p>Definition at line <a class="el" href="callerid_8c_source.html#l01062">1062</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

<p>References <a class="el" href="callerid_8c_source.html#l01053">__ast_callerid_generate()</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l03101">dahdi_call()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01063"></a>01063 {
<a name="l01064"></a>01064    <span class="keywordflow">return</span> <a class="code" href="callerid_8c.html#a90dc7c71024950ef138b50f0cf73fe05">__ast_callerid_generate</a>(<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <a class="code" href="structnumber.html" title="Number structure.">number</a>, 0, codec);
<a name="l01065"></a>01065 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1c25633b1ed63682c95ec613d7cbe559"></a><!-- doxytag: member="callerid.c::ast_callerid_merge" ref="a1c25633b1ed63682c95ec613d7cbe559" args="(char *buf, int bufsiz, const char *name, const char *num, const char *unknown)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* ast_callerid_merge </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>bufsiz</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>unknown</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="callerid_8c_source.html#l01072">1072</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

<p>References <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l15349">_sip_show_peer()</a>, <a class="el" href="chan__skinny_8c_source.html#l03337">_skinny_show_line()</a>, <a class="el" href="chan__iax2_8c_source.html#l03568">handle_cli_iax2_show_peer()</a>, <a class="el" href="app__minivm_8c_source.html#l01604">leave_voicemail()</a>, <a class="el" href="app__minivm_8c_source.html#l00875">prep_email_sub_vars()</a>, and <a class="el" href="chan__sip_8c_source.html#l15630">sip_show_user()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01073"></a>01073 {
<a name="l01074"></a>01074    <span class="keywordflow">if</span> (!unknown)
<a name="l01075"></a>01075       unknown = <span class="stringliteral">&quot;&lt;unknown&gt;&quot;</span>;
<a name="l01076"></a>01076    <span class="keywordflow">if</span> (<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a> &amp;&amp; <a class="code" href="adsistub_8c.html#af6fc584548091f45267cfaf7066119bd">num</a>)
<a name="l01077"></a>01077       snprintf(<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, bufsiz, <span class="stringliteral">&quot;\&quot;%s\&quot; &lt;%s&gt;&quot;</span>, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <a class="code" href="adsistub_8c.html#af6fc584548091f45267cfaf7066119bd">num</a>);
<a name="l01078"></a>01078    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>) 
<a name="l01079"></a>01079       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, bufsiz);
<a name="l01080"></a>01080    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="adsistub_8c.html#af6fc584548091f45267cfaf7066119bd">num</a>)
<a name="l01081"></a>01081       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <a class="code" href="adsistub_8c.html#af6fc584548091f45267cfaf7066119bd">num</a>, bufsiz);
<a name="l01082"></a>01082    <span class="keywordflow">else</span>
<a name="l01083"></a>01083       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, unknown, bufsiz);
<a name="l01084"></a>01084    <span class="keywordflow">return</span> <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>;
<a name="l01085"></a>01085 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a39e03ca4e8df3a1d2c75e888d76201df"></a><!-- doxytag: member="callerid.c::ast_callerid_parse" ref="a39e03ca4e8df3a1d2c75e888d76201df" args="(char *instr, char **name, char **location)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_callerid_parse </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>instr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&nbsp;</td>
          <td class="paramname"> <em>location</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Destructively parse instr for caller id information. </p>
<p>Destructively parse inbuf into name and location (or <a class="el" href="structnumber.html" title="Number structure.">number</a>) Parses callerid stream from inbuf and changes into useable form, outputed in name and location.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>always returns 0, as the code always returns something. </dd></dl>
<dl class="note"><dt><b>Note:</b></dt><dd>XXX 'name' is not parsed consistently e.g. we have input location name " foo bar " &lt;123&gt; 123 ' foo bar ' (with spaces around) " foo bar " NULL 'foo bar' (without spaces around) The parsing of leading and trailing space/quotes should be more consistent. </dd></dl>

<p>Definition at line <a class="el" href="callerid_8c_source.html#l01006">1006</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

<p>References <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="callerid_8c_source.html#l00982">ast_isphonenumber()</a>, <a class="el" href="callerid_8c_source.html#l00929">ast_shrink_phone_number()</a>, <a class="el" href="strings_8h_source.html#l00092">ast_skip_blanks()</a>, and <a class="el" href="strings_8h_source.html#l00117">ast_trim_blanks()</a>.</p>

<p>Referenced by <a class="el" href="manager_8c_source.html#l02392">action_originate()</a>, <a class="el" href="app__voicemail_8c_source.html#l05975">adsi_message()</a>, <a class="el" href="app__voicemail_8c_source.html#l11416">advanced_options()</a>, <a class="el" href="callerid_8c_source.html#l01087">ast_callerid_split()</a>, <a class="el" href="privacy_8c_source.html#l00044">ast_privacy_check()</a>, <a class="el" href="privacy_8c_source.html#l00080">ast_privacy_set()</a>, <a class="el" href="res__agi_8c_source.html#l01765">handle_setcallerid()</a>, <a class="el" href="chan__misdn_8c_source.html#l03705">misdn_new()</a>, <a class="el" href="app__voicemail_8c_source.html#l06937">play_message_callerid()</a>, <a class="el" href="app__rpt_8c_source.html#l05280">rpt_call()</a>, <a class="el" href="app__rpt_8c_source.html#l13122">rpt_exec()</a>, <a class="el" href="chan__unistim_8c_source.html#l04422">unistim_new()</a>, and <a class="el" href="app__alarmreceiver_8c_source.html#l00296">write_metadata()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01007"></a>01007 {
<a name="l01008"></a>01008    <span class="keywordtype">char</span> *ns, *ne, *ls, *le;
<a name="l01009"></a>01009 
<a name="l01010"></a>01010    <span class="comment">/* Try &quot;name&quot; &lt;location&gt; format or name &lt;location&gt; format */</span>
<a name="l01011"></a>01011    <span class="keywordflow">if</span> ((ls = strrchr(instr, <span class="charliteral">&apos;&lt;&apos;</span>)) &amp;&amp; (le = strrchr(ls, <span class="charliteral">&apos;&gt;&apos;</span>))) {
<a name="l01012"></a>01012       *ls = *le = <span class="charliteral">&apos;\0&apos;</span>; <span class="comment">/* location found, trim off the brackets */</span>
<a name="l01013"></a>01013       *location = ls + 1;  <span class="comment">/* and this is the result */</span>
<a name="l01014"></a>01014       <span class="keywordflow">if</span> ((ns = strchr(instr, <span class="charliteral">&apos;&quot;&apos;</span>)) &amp;&amp; (ne = strchr(ns + 1, <span class="charliteral">&apos;&quot;&apos;</span>))) {
<a name="l01015"></a>01015          *ns = *ne = <span class="charliteral">&apos;\0&apos;</span>; <span class="comment">/* trim off the quotes */</span>
<a name="l01016"></a>01016          *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a> = ns + 1;      <span class="comment">/* and this is the name */</span>
<a name="l01017"></a>01017       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ns) {
<a name="l01018"></a>01018          <span class="comment">/* An opening quote was found but no closing quote was. The closing</span>
<a name="l01019"></a>01019 <span class="comment">          * quote may actually be after the end of the bracketed number</span>
<a name="l01020"></a>01020 <span class="comment">          */</span>
<a name="l01021"></a>01021          <span class="keywordflow">if</span> (strchr(le + 1, <span class="charliteral">&apos;\&quot;&apos;</span>)) {
<a name="l01022"></a>01022             *ns = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01023"></a>01023             *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a> = ns + 1;
<a name="l01024"></a>01024             <a class="code" href="strings_8h.html#ac5899ca9e586caf3041865762e770550" title="Trims trailing whitespace characters from a string.">ast_trim_blanks</a>(*<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l01025"></a>01025          }
<a name="l01026"></a>01026       } <span class="keywordflow">else</span> { <span class="comment">/* no quotes, trim off leading and trailing spaces */</span>
<a name="l01027"></a>01027          *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a> = <a class="code" href="strings_8h.html#aba29020090d7b4238027c5746e7ad722" title="Gets a pointer to the first non-whitespace character in a string.">ast_skip_blanks</a>(instr);
<a name="l01028"></a>01028          <a class="code" href="strings_8h.html#ac5899ca9e586caf3041865762e770550" title="Trims trailing whitespace characters from a string.">ast_trim_blanks</a>(*<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l01029"></a>01029       }
<a name="l01030"></a>01030    } <span class="keywordflow">else</span> { <span class="comment">/* no valid brackets */</span>
<a name="l01031"></a>01031       <span class="keywordtype">char</span> tmp[256];
<a name="l01032"></a>01032 
<a name="l01033"></a>01033       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmp, instr, <span class="keyword">sizeof</span>(tmp));
<a name="l01034"></a>01034       <a class="code" href="callerid_8h.html#a6a61669b28d0f994e44db5e3baab6ef2" title="Shrink a phone number in place to just digits (more accurately it just removes ()&amp;#39;s...">ast_shrink_phone_number</a>(tmp);
<a name="l01035"></a>01035       <span class="keywordflow">if</span> (<a class="code" href="callerid_8h.html#abbaf2d96bf4d17406d600876364c1133" title="Check if a string consists only of digits and + #.">ast_isphonenumber</a>(tmp)) { <span class="comment">/* Assume it&apos;s just a location */</span>
<a name="l01036"></a>01036          *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a> = NULL;
<a name="l01037"></a>01037          strcpy(instr, tmp); <span class="comment">/* safe, because tmp will always be the same size or smaller than instr */</span>
<a name="l01038"></a>01038          *location = instr;
<a name="l01039"></a>01039       } <span class="keywordflow">else</span> { <span class="comment">/* Assume it&apos;s just a name. */</span>
<a name="l01040"></a>01040          *location = NULL;
<a name="l01041"></a>01041          <span class="keywordflow">if</span> ((ns = strchr(instr, <span class="charliteral">&apos;&quot;&apos;</span>)) &amp;&amp; (ne = strchr(ns + 1, <span class="charliteral">&apos;&quot;&apos;</span>))) {
<a name="l01042"></a>01042             *ns = *ne = <span class="charliteral">&apos;\0&apos;</span>; <span class="comment">/* trim off the quotes */</span>
<a name="l01043"></a>01043             *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a> = ns + 1;      <span class="comment">/* and this is the name */</span>
<a name="l01044"></a>01044          } <span class="keywordflow">else</span> { <span class="comment">/* no quotes, trim off leading and trailing spaces */</span>
<a name="l01045"></a>01045             *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a> = <a class="code" href="strings_8h.html#aba29020090d7b4238027c5746e7ad722" title="Gets a pointer to the first non-whitespace character in a string.">ast_skip_blanks</a>(instr);
<a name="l01046"></a>01046             <a class="code" href="strings_8h.html#ac5899ca9e586caf3041865762e770550" title="Trims trailing whitespace characters from a string.">ast_trim_blanks</a>(*<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l01047"></a>01047          }
<a name="l01048"></a>01048       }
<a name="l01049"></a>01049    }
<a name="l01050"></a>01050    <span class="keywordflow">return</span> 0;
<a name="l01051"></a>01051 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae198fa9405854429974768ad54edd05d"></a><!-- doxytag: member="callerid.c::ast_callerid_split" ref="ae198fa9405854429974768ad54edd05d" args="(const char *buf, char *name, int namelen, char *num, int numlen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_callerid_split </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>namelen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>numlen</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="callerid_8c_source.html#l01087">1087</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

<p>References <a class="el" href="callerid_8c_source.html#l01006">ast_callerid_parse()</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="callerid_8c_source.html#l00929">ast_shrink_phone_number()</a>, and <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>.</p>

<p>Referenced by <a class="el" href="pbx__spool_8c_source.html#l00110">apply_outgoing()</a>, <a class="el" href="chan__mgcp_8c_source.html#l03552">build_gateway()</a>, <a class="el" href="chan__iax2_8c_source.html#l11880">build_peer()</a>, <a class="el" href="chan__iax2_8c_source.html#l12156">build_user()</a>, <a class="el" href="func__callerid_8c_source.html#l00120">callerid_read()</a>, <a class="el" href="func__callerid_8c_source.html#l00191">callerid_write()</a>, <a class="el" href="chan__skinny_8c_source.html#l06537">config_parse_variables()</a>, <a class="el" href="app__disa_8c_source.html#l00143">disa_exec()</a>, <a class="el" href="chan__phone_8c_source.html#l01339">load_module()</a>, <a class="el" href="app__voicemail_8c_source.html#l03977">prep_email_sub_vars()</a>, <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>, <a class="el" href="chan__console_8c_source.html#l01260">store_callerid()</a>, and <a class="el" href="chan__h323_8c_source.html#l01251">update_common_options()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01088"></a>01088 {
<a name="l01089"></a>01089    <span class="keywordtype">char</span> *tmp;
<a name="l01090"></a>01090    <span class="keywordtype">char</span> *l = NULL, *n = NULL;
<a name="l01091"></a>01091 
<a name="l01092"></a>01092    tmp = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>);
<a name="l01093"></a>01093    <a class="code" href="callerid_8h.html#a39e03ca4e8df3a1d2c75e888d76201df" title="Destructively parse inbuf into name and location (or number) Parses callerid stream...">ast_callerid_parse</a>(tmp, &amp;n, &amp;l);
<a name="l01094"></a>01094    <span class="keywordflow">if</span> (n)
<a name="l01095"></a>01095       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, n, namelen);
<a name="l01096"></a>01096    <span class="keywordflow">else</span>
<a name="l01097"></a>01097       <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01098"></a>01098    <span class="keywordflow">if</span> (l) {
<a name="l01099"></a>01099       <a class="code" href="callerid_8h.html#a6a61669b28d0f994e44db5e3baab6ef2" title="Shrink a phone number in place to just digits (more accurately it just removes ()&amp;#39;s...">ast_shrink_phone_number</a>(l);
<a name="l01100"></a>01100       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="adsistub_8c.html#af6fc584548091f45267cfaf7066119bd">num</a>, l, numlen);
<a name="l01101"></a>01101    } <span class="keywordflow">else</span>
<a name="l01102"></a>01102       <a class="code" href="adsistub_8c.html#af6fc584548091f45267cfaf7066119bd">num</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01103"></a>01103    <span class="keywordflow">return</span> 0;
<a name="l01104"></a>01104 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4b8a5c3b5ed37a9e1396ddef68ac7846"></a><!-- doxytag: member="callerid.c::ast_describe_caller_presentation" ref="a4b8a5c3b5ed37a9e1396ddef68ac7846" args="(int data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* ast_describe_caller_presentation </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>data</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Convert caller ID pres value to explanatory string. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>value (see <a class="el" href="callerid_8h.html" title="CallerID (and other GR30) management and generation Includes code and algorithms...">callerid.h</a> AST_PRES_ ) </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>string for human presentation </dd></dl>

<p>Definition at line <a class="el" href="callerid_8c_source.html#l01147">1147</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, and <a class="el" href="callerid_8c.html#a82a1d1b75a9c8c801ca76119815f11b9">pres_types</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l15349">_sip_show_peer()</a>, <a class="el" href="channel_8c_source.html#l04371">report_new_callerid()</a>, and <a class="el" href="chan__sip_8c_source.html#l15630">sip_show_user()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01148"></a>01148 {
<a name="l01149"></a>01149    <span class="keywordtype">int</span> i;
<a name="l01150"></a>01150 
<a name="l01151"></a>01151    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="callerid_8c.html#a82a1d1b75a9c8c801ca76119815f11b9" title="Translation table for Caller ID Presentation settings.">pres_types</a>); i++) {
<a name="l01152"></a>01152       <span class="keywordflow">if</span> (<a class="code" href="callerid_8c.html#a82a1d1b75a9c8c801ca76119815f11b9" title="Translation table for Caller ID Presentation settings.">pres_types</a>[i].<a class="code" href="structval.html">val</a> == data)
<a name="l01153"></a>01153          <span class="keywordflow">return</span> <a class="code" href="callerid_8c.html#a82a1d1b75a9c8c801ca76119815f11b9" title="Translation table for Caller ID Presentation settings.">pres_types</a>[i].description;
<a name="l01154"></a>01154    }
<a name="l01155"></a>01155 
<a name="l01156"></a>01156    <span class="keywordflow">return</span> <span class="stringliteral">&quot;unknown&quot;</span>;
<a name="l01157"></a>01157 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa5ef2658f11c1c40e3443216f87397da"></a><!-- doxytag: member="callerid.c::ast_gen_cas" ref="aa5ef2658f11c1c40e3443216f87397da" args="(unsigned char *outbuf, int sendsas, int len, int codec)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_gen_cas </td>
          <td>(</td>
          <td class="paramtype">unsigned char *&nbsp;</td>
          <td class="paramname"> <em>outbuf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>sas</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>codec</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Generate a CAS (CPE Alert Signal) tone for 'n' samples</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>outbuf</em>&nbsp;</td><td>Allocated buffer for data. Must be at least 2400 bytes unless no SAS is desired </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>sas</em>&nbsp;</td><td>Non-zero if CAS should be preceeded by SAS </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>len</em>&nbsp;</td><td>How many samples to generate. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>codec</em>&nbsp;</td><td>Which codec (AST_FORMAT_ALAW or AST_FORMAT_ULAW) </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns -1 on error (if len is less than 2400), 0 on success. </dd></dl>

<p>Definition at line <a class="el" href="callerid_8c_source.html#l00258">258</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

<p>References <a class="el" href="callerid_8c_source.html#l00096">gen_tone()</a>, <a class="el" href="callerid_8c_source.html#l00074">gen_tones()</a>, and <a class="el" href="callerid_8c_source.html#l00047">callerid_state::pos</a>.</p>

<p>Referenced by <a class="el" href="res__adsi_8c_source.html#l00193">__adsi_transmit_messages()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l03059">dahdi_callwait()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00259"></a>00259 {
<a name="l00260"></a>00260    <span class="keywordtype">int</span> pos = 0;
<a name="l00261"></a>00261    <span class="keywordtype">int</span> saslen = 2400;
<a name="l00262"></a>00262    <span class="keywordtype">float</span> cr1 = 1.0;
<a name="l00263"></a>00263    <span class="keywordtype">float</span> ci1 = 0.0;
<a name="l00264"></a>00264    <span class="keywordtype">float</span> cr2 = 1.0;
<a name="l00265"></a>00265    <span class="keywordtype">float</span> ci2 = 0.0;
<a name="l00266"></a>00266 
<a name="l00267"></a>00267    <span class="keywordflow">if</span> (sendsas) {
<a name="l00268"></a>00268       <span class="keywordflow">if</span> (<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> &lt; saslen)
<a name="l00269"></a>00269          <span class="keywordflow">return</span> -1;
<a name="l00270"></a>00270       <a class="code" href="callerid_8c.html#a08b47682e1d5e73068da4fa2344284a0">gen_tone</a>(outbuf, saslen, codec, <a class="code" href="callerid_8c.html#a37d6e99cad72f8884d9c575ac45badb9">sasdr</a>, <a class="code" href="callerid_8c.html#ae81f6b006f99cb8e2a8dca1b21eda4be">sasdi</a>, &amp;cr1, &amp;ci1);
<a name="l00271"></a>00271       <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> -= saslen;
<a name="l00272"></a>00272       pos += saslen;
<a name="l00273"></a>00273       cr2 = cr1;
<a name="l00274"></a>00274       ci2 = ci1;
<a name="l00275"></a>00275    }
<a name="l00276"></a>00276    <a class="code" href="callerid_8c.html#a0f5e4eef0eeba71986c4df9f4a9ada41">gen_tones</a>(outbuf + pos, <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, codec, <a class="code" href="callerid_8c.html#acffc1e68a433ac6fd82d29d859805971">casdr1</a>, <a class="code" href="callerid_8c.html#a1fc9110f09a12aef8ba8a94479dc03c3">casdi1</a>, <a class="code" href="callerid_8c.html#acb906a5386153c9b5cb1d078fb033443">casdr2</a>, <a class="code" href="callerid_8c.html#ac4647d3812e6efba4e068f86b2ab2574">casdi2</a>, &amp;cr1, &amp;ci1, &amp;cr2, &amp;ci2);
<a name="l00277"></a>00277    <span class="keywordflow">return</span> 0;
<a name="l00278"></a>00278 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae9c1fe6ac3c381fd57719a1a19182225"></a><!-- doxytag: member="callerid.c::ast_is_shrinkable_phonenumber" ref="ae9c1fe6ac3c381fd57719a1a19182225" args="(const char *exten)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_is_shrinkable_phonenumber </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>exten</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>checks if string consists only of digits and ( ) - * # and + Pre-qualifies the string for <a class="el" href="callerid_8h.html#a6a61669b28d0f994e44db5e3baab6ef2" title="Shrink a phone number in place to just digits (more accurately it just removes ()&#39;s...">ast_shrink_phone_number()</a> </p>
<p>Check if a string consists only of digits and and + # ( ) - . (meaning it can be cleaned with ast_shrink_phone_number).</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>1 if string is valid AST shrinkable phone <a class="el" href="structnumber.html" title="Number structure.">number</a> </dd>
<dd>
0 if not </dd></dl>

<p>Definition at line <a class="el" href="callerid_8c_source.html#l00992">992</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

<p>References <a class="el" href="callerid_8c_source.html#l00966">ast_is_valid_string()</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l13923">check_peer_ok()</a>, <a class="el" href="chan__sip_8c_source.html#l14088">check_user_full()</a>, and <a class="el" href="chan__sip_8c_source.html#l13909">replace_cid()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00993"></a>00993 {
<a name="l00994"></a>00994    <span class="keywordflow">return</span> <a class="code" href="callerid_8c.html#a6aadfef3ff9c0b25b909909dadc92a90" title="Checks if phone number consists of valid characters.">ast_is_valid_string</a>(<a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, <span class="stringliteral">&quot;0123456789*#+()-.&quot;</span>);
<a name="l00995"></a>00995 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6aadfef3ff9c0b25b909909dadc92a90"></a><!-- doxytag: member="callerid.c::ast_is_valid_string" ref="a6aadfef3ff9c0b25b909909dadc92a90" args="(const char *exten, const char *valid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ast_is_valid_string </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>exten</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>valid</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Checks if phone <a class="el" href="structnumber.html" title="Number structure.">number</a> consists of valid characters. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>exten</em>&nbsp;</td><td>String that needs to be checked </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>valid</em>&nbsp;</td><td>Valid characters in string </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>1 if valid string, 0 if string contains invalid characters </dd></dl>

<p>Definition at line <a class="el" href="callerid_8c_source.html#l00966">966</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

<p>References <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>.</p>

<p>Referenced by <a class="el" href="callerid_8c_source.html#l00992">ast_is_shrinkable_phonenumber()</a>, and <a class="el" href="callerid_8c_source.html#l00982">ast_isphonenumber()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00967"></a>00967 {
<a name="l00968"></a>00968    <span class="keywordtype">int</span> x;
<a name="l00969"></a>00969 
<a name="l00970"></a>00970    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>))
<a name="l00971"></a>00971       <span class="keywordflow">return</span> 0;
<a name="l00972"></a>00972    <span class="keywordflow">for</span> (x = 0; <a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>[x]; x++)
<a name="l00973"></a>00973       <span class="keywordflow">if</span> (!strchr(valid, <a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>[x]))
<a name="l00974"></a>00974          <span class="keywordflow">return</span> 0;
<a name="l00975"></a>00975    <span class="keywordflow">return</span> 1;
<a name="l00976"></a>00976 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="abbaf2d96bf4d17406d600876364c1133"></a><!-- doxytag: member="callerid.c::ast_isphonenumber" ref="abbaf2d96bf4d17406d600876364c1133" args="(const char *n)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_isphonenumber </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>n</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>checks if string consists only of digits and * # and + </p>
<p>Check if a string consists only of digits and + #.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>1 if string is valid AST phone <a class="el" href="structnumber.html" title="Number structure.">number</a> </dd>
<dd>
0 if not </dd></dl>

<p>Definition at line <a class="el" href="callerid_8c_source.html#l00982">982</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

<p>References <a class="el" href="callerid_8c_source.html#l00966">ast_is_valid_string()</a>.</p>

<p>Referenced by <a class="el" href="callerid_8c_source.html#l01006">ast_callerid_parse()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00983"></a>00983 {
<a name="l00984"></a>00984    <span class="keywordflow">return</span> <a class="code" href="callerid_8c.html#a6aadfef3ff9c0b25b909909dadc92a90" title="Checks if phone number consists of valid characters.">ast_is_valid_string</a>(n, <span class="stringliteral">&quot;0123456789*#+&quot;</span>);
<a name="l00985"></a>00985 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac1391d3fb87904ae33a70839451ca6bb"></a><!-- doxytag: member="callerid.c::ast_named_caller_presentation" ref="ac1391d3fb87904ae33a70839451ca6bb" args="(int data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* ast_named_caller_presentation </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>data</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Convert caller ID pres value to text code. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>text string </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>string for config file </dd></dl>

<p>Definition at line <a class="el" href="callerid_8c_source.html#l01163">1163</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, and <a class="el" href="callerid_8c.html#a82a1d1b75a9c8c801ca76119815f11b9">pres_types</a>.</p>

<p>Referenced by <a class="el" href="func__callerid_8c_source.html#l00120">callerid_read()</a>, and <a class="el" href="func__callerid_8c_source.html#l00104">callerpres_read()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01164"></a>01164 {
<a name="l01165"></a>01165    <span class="keywordtype">int</span> i;
<a name="l01166"></a>01166 
<a name="l01167"></a>01167    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="callerid_8c.html#a82a1d1b75a9c8c801ca76119815f11b9" title="Translation table for Caller ID Presentation settings.">pres_types</a>); i++) {
<a name="l01168"></a>01168       <span class="keywordflow">if</span> (<a class="code" href="callerid_8c.html#a82a1d1b75a9c8c801ca76119815f11b9" title="Translation table for Caller ID Presentation settings.">pres_types</a>[i].<a class="code" href="structval.html">val</a> == data)
<a name="l01169"></a>01169          <span class="keywordflow">return</span> <a class="code" href="callerid_8c.html#a82a1d1b75a9c8c801ca76119815f11b9" title="Translation table for Caller ID Presentation settings.">pres_types</a>[i].name;
<a name="l01170"></a>01170    }
<a name="l01171"></a>01171 
<a name="l01172"></a>01172    <span class="keywordflow">return</span> <span class="stringliteral">&quot;unknown&quot;</span>;
<a name="l01173"></a>01173 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a13d412653c31f84508b594005292a52c"></a><!-- doxytag: member="callerid.c::ast_parse_caller_presentation" ref="a13d412653c31f84508b594005292a52c" args="(const char *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_parse_caller_presentation </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>data</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Convert caller ID text code to value used in config file parsing. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>text string </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>value AST_PRES_ from <a class="el" href="callerid_8h.html" title="CallerID (and other GR30) management and generation Includes code and algorithms...">callerid.h</a> </dd></dl>

<p>Definition at line <a class="el" href="callerid_8c_source.html#l01128">1128</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="cdr__adaptive__odbc_8c_source.html#l00053">name</a>, and <a class="el" href="callerid_8c.html#a82a1d1b75a9c8c801ca76119815f11b9">pres_types</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l23690">build_peer()</a>, <a class="el" href="func__callerid_8c_source.html#l00191">callerid_write()</a>, <a class="el" href="func__callerid_8c_source.html#l00110">callerpres_write()</a>, and <a class="el" href="app__setcallerid_8c_source.html#l00087">setcallerid_pres_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01129"></a>01129 {
<a name="l01130"></a>01130    <span class="keywordtype">int</span> i;
<a name="l01131"></a>01131    <span class="keywordflow">if</span> (!data) {
<a name="l01132"></a>01132       <span class="keywordflow">return</span> -1;
<a name="l01133"></a>01133    }
<a name="l01134"></a>01134 
<a name="l01135"></a>01135    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="callerid_8c.html#a82a1d1b75a9c8c801ca76119815f11b9" title="Translation table for Caller ID Presentation settings.">pres_types</a>); i++) {
<a name="l01136"></a>01136       <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="callerid_8c.html#a82a1d1b75a9c8c801ca76119815f11b9" title="Translation table for Caller ID Presentation settings.">pres_types</a>[i].<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, data))
<a name="l01137"></a>01137          <span class="keywordflow">return</span> <a class="code" href="callerid_8c.html#a82a1d1b75a9c8c801ca76119815f11b9" title="Translation table for Caller ID Presentation settings.">pres_types</a>[i].<a class="code" href="structval.html">val</a>;
<a name="l01138"></a>01138    }
<a name="l01139"></a>01139 
<a name="l01140"></a>01140    <span class="keywordflow">return</span> -1;
<a name="l01141"></a>01141 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6a61669b28d0f994e44db5e3baab6ef2"></a><!-- doxytag: member="callerid.c::ast_shrink_phone_number" ref="a6a61669b28d0f994e44db5e3baab6ef2" args="(char *n)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_shrink_phone_number </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>n</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Clean up phone string remove '(', ' ', ')', non-trailing '.', and '-' not in square brackets. Basically, remove anything that could be invalid in a pattern. </p>
<p>Shrink a phone <a class="el" href="structnumber.html" title="Number structure.">number</a> in place to just digits (more accurately it just removes ()'s, .'s, and -'s... </p>

<p>Definition at line <a class="el" href="callerid_8c_source.html#l00929">929</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

<p>Referenced by <a class="el" href="manager_8c_source.html#l02392">action_originate()</a>, <a class="el" href="callerid_8c_source.html#l01006">ast_callerid_parse()</a>, <a class="el" href="callerid_8c_source.html#l01087">ast_callerid_split()</a>, <a class="el" href="privacy_8c_source.html#l00044">ast_privacy_check()</a>, <a class="el" href="privacy_8c_source.html#l00080">ast_privacy_set()</a>, <a class="el" href="chan__iax2_8c_source.html#l07197">check_access()</a>, <a class="el" href="chan__sip_8c_source.html#l13923">check_peer_ok()</a>, <a class="el" href="chan__sip_8c_source.html#l14088">check_user_full()</a>, <a class="el" href="res__agi_8c_source.html#l01765">handle_setcallerid()</a>, <a class="el" href="pbx__config_8c_source.html#l01367">pbx_load_config()</a>, <a class="el" href="chan__sip_8c_source.html#l13909">replace_cid()</a>, <a class="el" href="app__rpt_8c_source.html#l13122">rpt_exec()</a>, <a class="el" href="app__dial_8c_source.html#l01385">setup_privacy_args()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>, and <a class="el" href="app__alarmreceiver_8c_source.html#l00296">write_metadata()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00930"></a>00930 {
<a name="l00931"></a>00931    <span class="keywordtype">int</span> x, y = 0;
<a name="l00932"></a>00932    <span class="keywordtype">int</span> bracketed = 0;
<a name="l00933"></a>00933 
<a name="l00934"></a>00934    <span class="keywordflow">for</span> (x = 0; n[x]; x++) {
<a name="l00935"></a>00935       <span class="keywordflow">switch</span> (n[x]) {
<a name="l00936"></a>00936       <span class="keywordflow">case</span> <span class="charliteral">&apos;[&apos;</span>:
<a name="l00937"></a>00937          bracketed++;
<a name="l00938"></a>00938          n[y++] = n[x];
<a name="l00939"></a>00939          <span class="keywordflow">break</span>;
<a name="l00940"></a>00940       <span class="keywordflow">case</span> <span class="charliteral">&apos;]&apos;</span>:
<a name="l00941"></a>00941          bracketed--;
<a name="l00942"></a>00942          n[y++] = n[x];
<a name="l00943"></a>00943          <span class="keywordflow">break</span>;
<a name="l00944"></a>00944       <span class="keywordflow">case</span> <span class="charliteral">&apos;-&apos;</span>:
<a name="l00945"></a>00945          <span class="keywordflow">if</span> (bracketed)
<a name="l00946"></a>00946             n[y++] = n[x];
<a name="l00947"></a>00947          <span class="keywordflow">break</span>;
<a name="l00948"></a>00948       <span class="keywordflow">case</span> <span class="charliteral">&apos;.&apos;</span>:
<a name="l00949"></a>00949          <span class="keywordflow">if</span> (!n[x+1])
<a name="l00950"></a>00950             n[y++] = n[x];
<a name="l00951"></a>00951          <span class="keywordflow">break</span>;
<a name="l00952"></a>00952       <span class="keywordflow">default</span>:
<a name="l00953"></a>00953          <span class="comment">/* ignore parenthesis and whitespace */</span>
<a name="l00954"></a>00954          <span class="keywordflow">if</span> (!strchr(<span class="stringliteral">&quot;( )&quot;</span>, n[x]))
<a name="l00955"></a>00955             n[y++] = n[x];
<a name="l00956"></a>00956       }
<a name="l00957"></a>00957    }
<a name="l00958"></a>00958    n[y] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00959"></a>00959 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3faa215563ac24dec8ae8906dabafd3e"></a><!-- doxytag: member="callerid.c::calc_crc" ref="a3faa215563ac24dec8ae8906dabafd3e" args="(unsigned short crc, unsigned char data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static unsigned short calc_crc </td>
          <td>(</td>
          <td class="paramtype">unsigned short&nbsp;</td>
          <td class="paramname"> <em>crc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="callerid_8c_source.html#l00280">280</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

<p>References <a class="el" href="pbx__dundi_8c_source.html#l00192">org</a>.</p>

<p>Referenced by <a class="el" href="callerid_8c_source.html#l00303">callerid_feed_jp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00281"></a>00281 {
<a name="l00282"></a>00282    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i, j, <a class="code" href="pbx__dundi_8c.html#ad51e32c16369e570e5b8eeac50679e74">org</a>, dst;
<a name="l00283"></a>00283    org = data;
<a name="l00284"></a>00284    dst = 0;
<a name="l00285"></a>00285 
<a name="l00286"></a>00286    <span class="keywordflow">for</span> (i = 0; i &lt; CHAR_BIT; i++) {
<a name="l00287"></a>00287       org &lt;&lt;= 1;
<a name="l00288"></a>00288       dst &gt;&gt;= 1;
<a name="l00289"></a>00289       <span class="keywordflow">if</span> (org &amp; 0x100) 
<a name="l00290"></a>00290          dst |= 0x80;
<a name="l00291"></a>00291    }
<a name="l00292"></a>00292    data = (<span class="keywordtype">unsigned</span> char) dst;
<a name="l00293"></a>00293    crc ^= (<span class="keywordtype">unsigned</span> int) data &lt;&lt; (16 - CHAR_BIT);
<a name="l00294"></a>00294    <span class="keywordflow">for</span> (j = 0; j &lt; CHAR_BIT; j++) {
<a name="l00295"></a>00295       <span class="keywordflow">if</span> (crc &amp; 0x8000U)
<a name="l00296"></a>00296          crc = (crc &lt;&lt; 1) ^ 0x1021U ;
<a name="l00297"></a>00297       <span class="keywordflow">else</span>
<a name="l00298"></a>00298          crc &lt;&lt;= 1 ;
<a name="l00299"></a>00299    }
<a name="l00300"></a>00300       <span class="keywordflow">return</span> crc;
<a name="l00301"></a>00301 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6c593ce4925117f97e754a735608da16"></a><!-- doxytag: member="callerid.c::callerid_feed" ref="a6c593ce4925117f97e754a735608da16" args="(struct callerid_state *cid, unsigned char *ubuf, int len, int codec)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int callerid_feed </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structcallerid__state.html">callerid_state</a> *&nbsp;</td>
          <td class="paramname"> <em>cid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&nbsp;</td>
          <td class="paramname"> <em>ubuf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>samples</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>codec</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Read samples into the <a class="el" href="structstate.html">state</a> machine. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>cid</em>&nbsp;</td><td>Which <a class="el" href="structstate.html">state</a> machine to act upon </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ubuf</em>&nbsp;</td><td>containing your samples </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>samples</em>&nbsp;</td><td><a class="el" href="structnumber.html" title="Number structure.">number</a> of samples contained within the buffer. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>codec</em>&nbsp;</td><td>which codec (AST_FORMAT_ALAW or AST_FORMAT_ULAW)</td></tr>
  </table>
  </dd>
</dl>
<p>Send received audio to the Caller*ID demodulator. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns -1 on error, 0 for "needs more samples", and 1 if the CallerID spill reception is complete. </dd></dl>

<p>Definition at line <a class="el" href="callerid_8c_source.html#l00542">542</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

<p>References <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="callerid_8h_source.html#l00076">AST_XLAW</a>, <a class="el" href="adsistub_8c_source.html#l00059">buf</a>, <a class="el" href="callerid_8h_source.html#l00054">CID_MSGWAITING</a>, <a class="el" href="callerid_8h_source.html#l00055">CID_NOMSGWAITING</a>, <a class="el" href="callerid_8h_source.html#l00050">CID_PRIVATE_NAME</a>, <a class="el" href="callerid_8h_source.html#l00051">CID_PRIVATE_NUMBER</a>, <a class="el" href="callerid_8h_source.html#l00052">CID_UNKNOWN_NAME</a>, <a class="el" href="callerid_8h_source.html#l00053">CID_UNKNOWN_NUMBER</a>, <a class="el" href="callerid_8c_source.html#l00049">callerid_state::cksum</a>, <a class="el" href="callerid_8c_source.html#l00052">callerid_state::flags</a>, <a class="el" href="fskmodem__float_8c_source.html#l00222">fsk_serial()</a>, <a class="el" href="callerid_8c_source.html#l00043">callerid_state::fskd</a>, <a class="el" href="callerid_8c_source.html#l00054">callerid_state::len</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="callerid_8c_source.html#l00050">callerid_state::name</a>, <a class="el" href="callerid_8c_source.html#l00051">callerid_state::number</a>, <a class="el" href="callerid_8c_source.html#l00046">callerid_state::oldlen</a>, <a class="el" href="callerid_8c_source.html#l00045">callerid_state::oldstuff</a>, <a class="el" href="callerid_8c_source.html#l00047">callerid_state::pos</a>, <a class="el" href="callerid_8c_source.html#l00044">callerid_state::rawdata</a>, <a class="el" href="callerid_8c_source.html#l00053">callerid_state::sawflag</a>, and <a class="el" href="callerid_8c_source.html#l00048">callerid_state::type</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l08925">mwi_thread()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00543"></a>00543 {
<a name="l00544"></a>00544    <span class="keywordtype">int</span> mylen = <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>;
<a name="l00545"></a>00545    <span class="keywordtype">int</span> olen;
<a name="l00546"></a>00546    <span class="keywordtype">int</span> b = <span class="charliteral">&apos;X&apos;</span>;
<a name="l00547"></a>00547    <span class="keywordtype">int</span> res;
<a name="l00548"></a>00548    <span class="keywordtype">int</span> x;
<a name="l00549"></a>00549    <span class="keywordtype">short</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>;
<a name="l00550"></a>00550 
<a name="l00551"></a>00551    buf = alloca(2 * <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> + cid-&gt;<a class="code" href="structcallerid__state.html#a867bf9ceda87a78eff00c671640f3043">oldlen</a>);
<a name="l00552"></a>00552 
<a name="l00553"></a>00553    memcpy(buf, cid-&gt;<a class="code" href="structcallerid__state.html#ad11068e3f0f16b0b1eed6eb357e7fdb7">oldstuff</a>, cid-&gt;<a class="code" href="structcallerid__state.html#a867bf9ceda87a78eff00c671640f3043">oldlen</a>);
<a name="l00554"></a>00554    mylen += cid-&gt;<a class="code" href="structcallerid__state.html#a867bf9ceda87a78eff00c671640f3043">oldlen</a>/2;
<a name="l00555"></a>00555 
<a name="l00556"></a>00556    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>; x++) 
<a name="l00557"></a>00557       buf[x+cid-&gt;<a class="code" href="structcallerid__state.html#a867bf9ceda87a78eff00c671640f3043">oldlen</a>/2] = <a class="code" href="callerid_8h.html#ad9a6e3dea5cb07f976f8641770add81b">AST_XLAW</a>(ubuf[x]);
<a name="l00558"></a>00558    <span class="keywordflow">while</span> (mylen &gt;= 160) {
<a name="l00559"></a>00559       olen = mylen;
<a name="l00560"></a>00560       res = <a class="code" href="fskmodem__float_8h.html#a6315165519388f15eccffd8103769ee3">fsk_serial</a>(&amp;cid-&gt;<a class="code" href="structcallerid__state.html#a89025e7d3ea985fe597c69e2d26c26ec">fskd</a>, buf, &amp;mylen, &amp;b);
<a name="l00561"></a>00561       <span class="keywordflow">if</span> (mylen &lt; 0) {
<a name="l00562"></a>00562          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;No start bit found in fsk data.\n&quot;</span>);
<a name="l00563"></a>00563          <span class="keywordflow">return</span> -1;
<a name="l00564"></a>00564       }
<a name="l00565"></a>00565       buf += (olen - mylen);
<a name="l00566"></a>00566       <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l00567"></a>00567          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;fsk_serial failed\n&quot;</span>);
<a name="l00568"></a>00568          <span class="keywordflow">return</span> -1;
<a name="l00569"></a>00569       }
<a name="l00570"></a>00570       <span class="keywordflow">if</span> (res == 1) {
<a name="l00571"></a>00571          <span class="comment">/* Ignore invalid bytes */</span>
<a name="l00572"></a>00572          <span class="keywordflow">if</span> (b &gt; 0xff)
<a name="l00573"></a>00573             <span class="keywordflow">continue</span>;
<a name="l00574"></a>00574          <span class="keywordflow">switch</span> (cid-&gt;<a class="code" href="structcallerid__state.html#ab42e79f596ce4d812d8bf08468f9855d">sawflag</a>) {
<a name="l00575"></a>00575          <span class="keywordflow">case</span> 0: <span class="comment">/* Look for flag */</span>
<a name="l00576"></a>00576             <span class="keywordflow">if</span> (b == <span class="charliteral">&apos;U&apos;</span>)
<a name="l00577"></a>00577                cid-&gt;<a class="code" href="structcallerid__state.html#ab42e79f596ce4d812d8bf08468f9855d">sawflag</a> = 2;
<a name="l00578"></a>00578             <span class="keywordflow">break</span>;
<a name="l00579"></a>00579          <span class="keywordflow">case</span> 2: <span class="comment">/* Get lead-in */</span>
<a name="l00580"></a>00580             <span class="keywordflow">if</span> ((b == 0x04) || (b == 0x80) || (b == 0x06) || (b == 0x82)) {
<a name="l00581"></a>00581                cid-&gt;<a class="code" href="structcallerid__state.html#ac765329451135abec74c45e1897abf26">type</a> = b;
<a name="l00582"></a>00582                cid-&gt;<a class="code" href="structcallerid__state.html#ab42e79f596ce4d812d8bf08468f9855d">sawflag</a> = 3;
<a name="l00583"></a>00583                cid-&gt;<a class="code" href="structcallerid__state.html#a4f533d7ca3de0b7d7ecc95de785b4d2c">cksum</a> = b;
<a name="l00584"></a>00584             }
<a name="l00585"></a>00585             <span class="keywordflow">break</span>;
<a name="l00586"></a>00586          <span class="keywordflow">case</span> 3:  <span class="comment">/* Get length */</span>
<a name="l00587"></a>00587             <span class="comment">/* Not a lead in.  We&apos;re ready  */</span>
<a name="l00588"></a>00588             cid-&gt;<a class="code" href="structcallerid__state.html#ab42e79f596ce4d812d8bf08468f9855d">sawflag</a> = 4;
<a name="l00589"></a>00589             cid-&gt;<a class="code" href="structcallerid__state.html#afed088663f8704004425cdae2120b9b3">len</a> = b;
<a name="l00590"></a>00590             cid-&gt;<a class="code" href="structcallerid__state.html#a1910d262855b71da353ed0d07a6c7823">pos</a> = 0;
<a name="l00591"></a>00591             cid-&gt;<a class="code" href="structcallerid__state.html#a4f533d7ca3de0b7d7ecc95de785b4d2c">cksum</a> += b;
<a name="l00592"></a>00592             <span class="keywordflow">break</span>;
<a name="l00593"></a>00593          <span class="keywordflow">case</span> 4: <span class="comment">/* Retrieve message */</span>
<a name="l00594"></a>00594             <span class="keywordflow">if</span> (cid-&gt;<a class="code" href="structcallerid__state.html#a1910d262855b71da353ed0d07a6c7823">pos</a> &gt;= 128) {
<a name="l00595"></a>00595                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Caller ID too long???\n&quot;</span>);
<a name="l00596"></a>00596                <span class="keywordflow">return</span> -1;
<a name="l00597"></a>00597             }
<a name="l00598"></a>00598             cid-&gt;<a class="code" href="structcallerid__state.html#a206c088624d4566f4e1f629e1caf7dfa">rawdata</a>[cid-&gt;<a class="code" href="structcallerid__state.html#a1910d262855b71da353ed0d07a6c7823">pos</a>++] = b;
<a name="l00599"></a>00599             cid-&gt;<a class="code" href="structcallerid__state.html#afed088663f8704004425cdae2120b9b3">len</a>--;
<a name="l00600"></a>00600             cid-&gt;<a class="code" href="structcallerid__state.html#a4f533d7ca3de0b7d7ecc95de785b4d2c">cksum</a> += b;
<a name="l00601"></a>00601             <span class="keywordflow">if</span> (!cid-&gt;<a class="code" href="structcallerid__state.html#afed088663f8704004425cdae2120b9b3">len</a>) {
<a name="l00602"></a>00602                cid-&gt;<a class="code" href="structcallerid__state.html#a206c088624d4566f4e1f629e1caf7dfa">rawdata</a>[cid-&gt;<a class="code" href="structcallerid__state.html#a1910d262855b71da353ed0d07a6c7823">pos</a>] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00603"></a>00603                cid-&gt;<a class="code" href="structcallerid__state.html#ab42e79f596ce4d812d8bf08468f9855d">sawflag</a> = 5;
<a name="l00604"></a>00604             }
<a name="l00605"></a>00605             <span class="keywordflow">break</span>;
<a name="l00606"></a>00606          <span class="keywordflow">case</span> 5: <span class="comment">/* Check checksum */</span>
<a name="l00607"></a>00607             <span class="keywordflow">if</span> (b != (256 - (cid-&gt;<a class="code" href="structcallerid__state.html#a4f533d7ca3de0b7d7ecc95de785b4d2c">cksum</a> &amp; 0xff))) {
<a name="l00608"></a>00608                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Caller*ID failed checksum\n&quot;</span>);
<a name="l00609"></a>00609                <span class="comment">/* Try again */</span>
<a name="l00610"></a>00610                cid-&gt;<a class="code" href="structcallerid__state.html#ab42e79f596ce4d812d8bf08468f9855d">sawflag</a> = 0;
<a name="l00611"></a>00611                <span class="keywordflow">break</span>;
<a name="l00612"></a>00612             }
<a name="l00613"></a>00613       
<a name="l00614"></a>00614             cid-&gt;<a class="code" href="structcallerid__state.html#a5d40e881ec298b08348b3e355222c685">number</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00615"></a>00615             cid-&gt;<a class="code" href="structcallerid__state.html#ad53db8acabbf75e31bf23d9f20a2c847">name</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00616"></a>00616             <span class="comment">/* Update flags */</span>
<a name="l00617"></a>00617             cid-&gt;<a class="code" href="structcallerid__state.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> = 0;
<a name="l00618"></a>00618             <span class="comment">/* If we get this far we&apos;re fine.  */</span>
<a name="l00619"></a>00619             <span class="keywordflow">if</span> ((cid-&gt;<a class="code" href="structcallerid__state.html#ac765329451135abec74c45e1897abf26">type</a> == 0x80) || (cid-&gt;<a class="code" href="structcallerid__state.html#ac765329451135abec74c45e1897abf26">type</a> == 0x82)) {
<a name="l00620"></a>00620                <span class="comment">/* MDMF */</span>
<a name="l00621"></a>00621                <span class="comment">/* Go through each element and process */</span>
<a name="l00622"></a>00622                <span class="keywordflow">for</span> (x = 0; x &lt; cid-&gt;<a class="code" href="structcallerid__state.html#a1910d262855b71da353ed0d07a6c7823">pos</a>;) {
<a name="l00623"></a>00623                   <span class="keywordflow">switch</span> (cid-&gt;<a class="code" href="structcallerid__state.html#a206c088624d4566f4e1f629e1caf7dfa">rawdata</a>[x++]) {
<a name="l00624"></a>00624                   <span class="keywordflow">case</span> 1:
<a name="l00625"></a>00625                      <span class="comment">/* Date */</span>
<a name="l00626"></a>00626                      <span class="keywordflow">break</span>;
<a name="l00627"></a>00627                   <span class="keywordflow">case</span> 2: <span class="comment">/* Number */</span>
<a name="l00628"></a>00628                   <span class="keywordflow">case</span> 3: <span class="comment">/* Number (for Zebble) */</span>
<a name="l00629"></a>00629                   <span class="keywordflow">case</span> 4: <span class="comment">/* Number */</span>
<a name="l00630"></a>00630                      res = cid-&gt;<a class="code" href="structcallerid__state.html#a206c088624d4566f4e1f629e1caf7dfa">rawdata</a>[x];
<a name="l00631"></a>00631                      <span class="keywordflow">if</span> (res &gt; 32) {
<a name="l00632"></a>00632                         <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Truncating long caller ID number from %d bytes to 32\n&quot;</span>, cid-&gt;<a class="code" href="structcallerid__state.html#a206c088624d4566f4e1f629e1caf7dfa">rawdata</a>[x]);
<a name="l00633"></a>00633                         res = 32; 
<a name="l00634"></a>00634                      }
<a name="l00635"></a>00635                      <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(cid-&gt;<a class="code" href="structcallerid__state.html#a5d40e881ec298b08348b3e355222c685">number</a>)) {
<a name="l00636"></a>00636                         memcpy(cid-&gt;<a class="code" href="structcallerid__state.html#a5d40e881ec298b08348b3e355222c685">number</a>, cid-&gt;<a class="code" href="structcallerid__state.html#a206c088624d4566f4e1f629e1caf7dfa">rawdata</a> + x + 1, res);
<a name="l00637"></a>00637                         <span class="comment">/* Null terminate */</span>
<a name="l00638"></a>00638                         cid-&gt;<a class="code" href="structcallerid__state.html#a5d40e881ec298b08348b3e355222c685">number</a>[res] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00639"></a>00639                      }
<a name="l00640"></a>00640                      <span class="keywordflow">break</span>;
<a name="l00641"></a>00641                   <span class="keywordflow">case</span> 6: <span class="comment">/* Stentor Call Qualifier (ie. Long Distance call) */</span>
<a name="l00642"></a>00642                      <span class="keywordflow">break</span>;
<a name="l00643"></a>00643                   <span class="keywordflow">case</span> 7: <span class="comment">/* Name */</span>
<a name="l00644"></a>00644                   <span class="keywordflow">case</span> 8: <span class="comment">/* Name */</span>
<a name="l00645"></a>00645                      res = cid-&gt;<a class="code" href="structcallerid__state.html#a206c088624d4566f4e1f629e1caf7dfa">rawdata</a>[x];
<a name="l00646"></a>00646                      <span class="keywordflow">if</span> (res &gt; 32) {
<a name="l00647"></a>00647                         <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Truncating long caller ID name from %d bytes to 32\n&quot;</span>, cid-&gt;<a class="code" href="structcallerid__state.html#a206c088624d4566f4e1f629e1caf7dfa">rawdata</a>[x]);
<a name="l00648"></a>00648                         res = 32; 
<a name="l00649"></a>00649                      }
<a name="l00650"></a>00650                      memcpy(cid-&gt;<a class="code" href="structcallerid__state.html#ad53db8acabbf75e31bf23d9f20a2c847">name</a>, cid-&gt;<a class="code" href="structcallerid__state.html#a206c088624d4566f4e1f629e1caf7dfa">rawdata</a> + x + 1, res);
<a name="l00651"></a>00651                      cid-&gt;<a class="code" href="structcallerid__state.html#ad53db8acabbf75e31bf23d9f20a2c847">name</a>[res] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00652"></a>00652                      <span class="keywordflow">break</span>;
<a name="l00653"></a>00653                   <span class="keywordflow">case</span> 11: <span class="comment">/* Message Waiting */</span>
<a name="l00654"></a>00654                      res = cid-&gt;<a class="code" href="structcallerid__state.html#a206c088624d4566f4e1f629e1caf7dfa">rawdata</a>[x + 1];
<a name="l00655"></a>00655                      <span class="keywordflow">if</span> (res)
<a name="l00656"></a>00656                         cid-&gt;<a class="code" href="structcallerid__state.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> |= <a class="code" href="callerid_8h.html#a9c4dfda5214a190d972ea14ae5055378">CID_MSGWAITING</a>;
<a name="l00657"></a>00657                      <span class="keywordflow">else</span>
<a name="l00658"></a>00658                         cid-&gt;<a class="code" href="structcallerid__state.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> |= <a class="code" href="callerid_8h.html#a826d6ae29e47b657de576a044828734a">CID_NOMSGWAITING</a>;
<a name="l00659"></a>00659                      <span class="keywordflow">break</span>;
<a name="l00660"></a>00660                   <span class="keywordflow">case</span> 17: <span class="comment">/* UK: Call type, 1=Voice Call, 2=Ringback when free, 129=Message waiting  */</span>
<a name="l00661"></a>00661                   <span class="keywordflow">case</span> 19: <span class="comment">/* UK: Network message system status (Number of messages waiting) */</span>
<a name="l00662"></a>00662                   <span class="keywordflow">case</span> 22: <span class="comment">/* Something French */</span>
<a name="l00663"></a>00663                      <span class="keywordflow">break</span>;
<a name="l00664"></a>00664                   <span class="keywordflow">default</span>:
<a name="l00665"></a>00665                      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Unknown IE %d\n&quot;</span>, cid-&gt;<a class="code" href="structcallerid__state.html#a206c088624d4566f4e1f629e1caf7dfa">rawdata</a>[x - 1]);
<a name="l00666"></a>00666                   }
<a name="l00667"></a>00667                   res = cid-&gt;<a class="code" href="structcallerid__state.html#a206c088624d4566f4e1f629e1caf7dfa">rawdata</a>[x];
<a name="l00668"></a>00668                   <span class="keywordflow">if</span> (0 &gt; res){  <span class="comment">/* Negative offset in the CID Spill */</span>
<a name="l00669"></a>00669                      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;IE %d has bad field length of %d at offset %d\n&quot;</span>, cid-&gt;<a class="code" href="structcallerid__state.html#a206c088624d4566f4e1f629e1caf7dfa">rawdata</a>[x-1], cid-&gt;<a class="code" href="structcallerid__state.html#a206c088624d4566f4e1f629e1caf7dfa">rawdata</a>[x], x);
<a name="l00670"></a>00670                      <span class="comment">/* Try again */</span>
<a name="l00671"></a>00671                      cid-&gt;<a class="code" href="structcallerid__state.html#ab42e79f596ce4d812d8bf08468f9855d">sawflag</a> = 0;
<a name="l00672"></a>00672                      <span class="keywordflow">break</span>;   <span class="comment">/* Exit the loop */</span>
<a name="l00673"></a>00673                   }
<a name="l00674"></a>00674                   x += cid-&gt;<a class="code" href="structcallerid__state.html#a206c088624d4566f4e1f629e1caf7dfa">rawdata</a>[x];
<a name="l00675"></a>00675                   x++;
<a name="l00676"></a>00676                }
<a name="l00677"></a>00677             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cid-&gt;<a class="code" href="structcallerid__state.html#ac765329451135abec74c45e1897abf26">type</a> == 0x6) {
<a name="l00678"></a>00678                <span class="comment">/* VMWI SDMF */</span>
<a name="l00679"></a>00679                <span class="keywordflow">if</span> (cid-&gt;<a class="code" href="structcallerid__state.html#a206c088624d4566f4e1f629e1caf7dfa">rawdata</a>[2] == 0x42) {
<a name="l00680"></a>00680                   cid-&gt;<a class="code" href="structcallerid__state.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> |= <a class="code" href="callerid_8h.html#a9c4dfda5214a190d972ea14ae5055378">CID_MSGWAITING</a>;
<a name="l00681"></a>00681                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cid-&gt;<a class="code" href="structcallerid__state.html#a206c088624d4566f4e1f629e1caf7dfa">rawdata</a>[2] == 0x6f) {
<a name="l00682"></a>00682                   cid-&gt;<a class="code" href="structcallerid__state.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> |= <a class="code" href="callerid_8h.html#a826d6ae29e47b657de576a044828734a">CID_NOMSGWAITING</a>;
<a name="l00683"></a>00683                }
<a name="l00684"></a>00684             } <span class="keywordflow">else</span> {
<a name="l00685"></a>00685                <span class="comment">/* SDMF */</span>
<a name="l00686"></a>00686                <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(cid-&gt;<a class="code" href="structcallerid__state.html#a5d40e881ec298b08348b3e355222c685">number</a>, cid-&gt;<a class="code" href="structcallerid__state.html#a206c088624d4566f4e1f629e1caf7dfa">rawdata</a> + 8, <span class="keyword">sizeof</span>(cid-&gt;<a class="code" href="structcallerid__state.html#a5d40e881ec298b08348b3e355222c685">number</a>));
<a name="l00687"></a>00687             }
<a name="l00688"></a>00688             <span class="keywordflow">if</span> (!strcmp(cid-&gt;<a class="code" href="structcallerid__state.html#a5d40e881ec298b08348b3e355222c685">number</a>, <span class="stringliteral">&quot;P&quot;</span>)) {
<a name="l00689"></a>00689                strcpy(cid-&gt;<a class="code" href="structcallerid__state.html#a5d40e881ec298b08348b3e355222c685">number</a>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00690"></a>00690                cid-&gt;<a class="code" href="structcallerid__state.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> |= <a class="code" href="callerid_8h.html#a89ec835ed3bca0bf18b83d753daeecbd">CID_PRIVATE_NUMBER</a>;
<a name="l00691"></a>00691             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(cid-&gt;<a class="code" href="structcallerid__state.html#a5d40e881ec298b08348b3e355222c685">number</a>, <span class="stringliteral">&quot;O&quot;</span>) || <a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(cid-&gt;<a class="code" href="structcallerid__state.html#a5d40e881ec298b08348b3e355222c685">number</a>)) {
<a name="l00692"></a>00692                strcpy(cid-&gt;<a class="code" href="structcallerid__state.html#a5d40e881ec298b08348b3e355222c685">number</a>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00693"></a>00693                cid-&gt;<a class="code" href="structcallerid__state.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> |= <a class="code" href="callerid_8h.html#a1290504d77210103d8553593671cc3c2">CID_UNKNOWN_NUMBER</a>;
<a name="l00694"></a>00694             }
<a name="l00695"></a>00695             <span class="keywordflow">if</span> (!strcmp(cid-&gt;<a class="code" href="structcallerid__state.html#ad53db8acabbf75e31bf23d9f20a2c847">name</a>, <span class="stringliteral">&quot;P&quot;</span>)) {
<a name="l00696"></a>00696                strcpy(cid-&gt;<a class="code" href="structcallerid__state.html#ad53db8acabbf75e31bf23d9f20a2c847">name</a>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00697"></a>00697                cid-&gt;<a class="code" href="structcallerid__state.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> |= <a class="code" href="callerid_8h.html#a75e6d6b2c4ea5b399d5a5b42f7be15c0">CID_PRIVATE_NAME</a>;
<a name="l00698"></a>00698             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(cid-&gt;<a class="code" href="structcallerid__state.html#ad53db8acabbf75e31bf23d9f20a2c847">name</a>, <span class="stringliteral">&quot;O&quot;</span>) || <a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(cid-&gt;<a class="code" href="structcallerid__state.html#ad53db8acabbf75e31bf23d9f20a2c847">name</a>)) {
<a name="l00699"></a>00699                strcpy(cid-&gt;<a class="code" href="structcallerid__state.html#ad53db8acabbf75e31bf23d9f20a2c847">name</a>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00700"></a>00700                cid-&gt;<a class="code" href="structcallerid__state.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> |= <a class="code" href="callerid_8h.html#a30f6e6391969dd024122f1fc9203b273">CID_UNKNOWN_NAME</a>;
<a name="l00701"></a>00701             }
<a name="l00702"></a>00702             <span class="keywordflow">return</span> 1;
<a name="l00703"></a>00703             <span class="keywordflow">break</span>;
<a name="l00704"></a>00704          <span class="keywordflow">default</span>:
<a name="l00705"></a>00705             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Dunno what to do with a digit in sawflag %d\n&quot;</span>, cid-&gt;<a class="code" href="structcallerid__state.html#ab42e79f596ce4d812d8bf08468f9855d">sawflag</a>);
<a name="l00706"></a>00706          }
<a name="l00707"></a>00707       }
<a name="l00708"></a>00708    }
<a name="l00709"></a>00709    <span class="keywordflow">if</span> (mylen) {
<a name="l00710"></a>00710       memcpy(cid-&gt;<a class="code" href="structcallerid__state.html#ad11068e3f0f16b0b1eed6eb357e7fdb7">oldstuff</a>, buf, mylen * 2);
<a name="l00711"></a>00711       cid-&gt;<a class="code" href="structcallerid__state.html#a867bf9ceda87a78eff00c671640f3043">oldlen</a> = mylen * 2;
<a name="l00712"></a>00712    } <span class="keywordflow">else</span>
<a name="l00713"></a>00713       cid-&gt;<a class="code" href="structcallerid__state.html#a867bf9ceda87a78eff00c671640f3043">oldlen</a> = 0;
<a name="l00714"></a>00714 
<a name="l00715"></a>00715    <span class="keywordflow">return</span> 0;
<a name="l00716"></a>00716 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3fffc9efa1b0586f0a1420fbba64196e"></a><!-- doxytag: member="callerid.c::callerid_feed_jp" ref="a3fffc9efa1b0586f0a1420fbba64196e" args="(struct callerid_state *cid, unsigned char *ubuf, int len, int codec)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int callerid_feed_jp </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structcallerid__state.html">callerid_state</a> *&nbsp;</td>
          <td class="paramname"> <em>cid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&nbsp;</td>
          <td class="paramname"> <em>ubuf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>samples</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>codec</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Read samples into the <a class="el" href="structstate.html">state</a> machine. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>cid</em>&nbsp;</td><td>Which <a class="el" href="structstate.html">state</a> machine to act upon </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ubuf</em>&nbsp;</td><td>containing your samples </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>samples</em>&nbsp;</td><td><a class="el" href="structnumber.html" title="Number structure.">number</a> of samples contained within the buffer. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>codec</em>&nbsp;</td><td>which codec (AST_FORMAT_ALAW or AST_FORMAT_ULAW)</td></tr>
  </table>
  </dd>
</dl>
<p>Send received audio to the Caller*ID demodulator (for japanese style lines). </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns -1 on error, 0 for "needs more samples", and 1 if the CallerID spill reception is complete. </dd></dl>

<p>Definition at line <a class="el" href="callerid_8c_source.html#l00303">303</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

<p>References <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="callerid_8h_source.html#l00076">AST_XLAW</a>, <a class="el" href="adsistub_8c_source.html#l00059">buf</a>, <a class="el" href="callerid_8c_source.html#l00280">calc_crc()</a>, <a class="el" href="callerid_8h_source.html#l00053">CID_UNKNOWN_NUMBER</a>, <a class="el" href="callerid_8c_source.html#l00057">callerid_state::crc</a>, <a class="el" href="callerid_8c_source.html#l00052">callerid_state::flags</a>, <a class="el" href="fskmodem__float_8c_source.html#l00222">fsk_serial()</a>, <a class="el" href="callerid_8c_source.html#l00043">callerid_state::fskd</a>, <a class="el" href="callerid_8c_source.html#l00054">callerid_state::len</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="callerid_8c_source.html#l00050">callerid_state::name</a>, <a class="el" href="callerid_8c_source.html#l00051">callerid_state::number</a>, <a class="el" href="callerid_8c_source.html#l00046">callerid_state::oldlen</a>, <a class="el" href="callerid_8c_source.html#l00045">callerid_state::oldstuff</a>, <a class="el" href="asterisk_8c_source.html#l00175">option_debug</a>, <a class="el" href="callerid_8c_source.html#l00047">callerid_state::pos</a>, <a class="el" href="callerid_8c_source.html#l00044">callerid_state::rawdata</a>, <a class="el" href="callerid_8c_source.html#l00053">callerid_state::sawflag</a>, and <a class="el" href="callerid_8c_source.html#l00056">callerid_state::skipflag</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00304"></a>00304 {
<a name="l00305"></a>00305    <span class="keywordtype">int</span> mylen = <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>;
<a name="l00306"></a>00306    <span class="keywordtype">int</span> olen;
<a name="l00307"></a>00307    <span class="keywordtype">int</span> b = <span class="charliteral">&apos;X&apos;</span>;
<a name="l00308"></a>00308    <span class="keywordtype">int</span> b2;
<a name="l00309"></a>00309    <span class="keywordtype">int</span> res;
<a name="l00310"></a>00310    <span class="keywordtype">int</span> x;
<a name="l00311"></a>00311    <span class="keywordtype">short</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>;
<a name="l00312"></a>00312 
<a name="l00313"></a>00313    buf = alloca(2 * <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> + cid-&gt;<a class="code" href="structcallerid__state.html#a867bf9ceda87a78eff00c671640f3043">oldlen</a>);
<a name="l00314"></a>00314 
<a name="l00315"></a>00315    memcpy(buf, cid-&gt;<a class="code" href="structcallerid__state.html#ad11068e3f0f16b0b1eed6eb357e7fdb7">oldstuff</a>, cid-&gt;<a class="code" href="structcallerid__state.html#a867bf9ceda87a78eff00c671640f3043">oldlen</a>);
<a name="l00316"></a>00316    mylen += cid-&gt;<a class="code" href="structcallerid__state.html#a867bf9ceda87a78eff00c671640f3043">oldlen</a> / 2;
<a name="l00317"></a>00317 
<a name="l00318"></a>00318    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>; x++) 
<a name="l00319"></a>00319       buf[x+cid-&gt;<a class="code" href="structcallerid__state.html#a867bf9ceda87a78eff00c671640f3043">oldlen</a>/2] = <a class="code" href="callerid_8h.html#ad9a6e3dea5cb07f976f8641770add81b">AST_XLAW</a>(ubuf[x]);
<a name="l00320"></a>00320 
<a name="l00321"></a>00321    <span class="keywordflow">while</span> (mylen &gt;= 160) {
<a name="l00322"></a>00322       b = b2 = 0;
<a name="l00323"></a>00323       olen = mylen;
<a name="l00324"></a>00324       res = <a class="code" href="fskmodem__float_8h.html#a6315165519388f15eccffd8103769ee3">fsk_serial</a>(&amp;cid-&gt;<a class="code" href="structcallerid__state.html#a89025e7d3ea985fe597c69e2d26c26ec">fskd</a>, buf, &amp;mylen, &amp;b);
<a name="l00325"></a>00325 
<a name="l00326"></a>00326       <span class="keywordflow">if</span> (mylen &lt; 0) {
<a name="l00327"></a>00327          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;No start bit found in fsk data.\n&quot;</span>);
<a name="l00328"></a>00328          <span class="keywordflow">return</span> -1;
<a name="l00329"></a>00329       }
<a name="l00330"></a>00330 
<a name="l00331"></a>00331       buf += (olen - mylen);
<a name="l00332"></a>00332 
<a name="l00333"></a>00333       <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l00334"></a>00334          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;fsk_serial failed\n&quot;</span>);
<a name="l00335"></a>00335          <span class="keywordflow">return</span> -1;
<a name="l00336"></a>00336       }
<a name="l00337"></a>00337 
<a name="l00338"></a>00338       <span class="keywordflow">if</span> (res == 1) {
<a name="l00339"></a>00339          b2 = b;
<a name="l00340"></a>00340          b  &amp;= 0x7f;
<a name="l00341"></a>00341 
<a name="l00342"></a>00342          <span class="comment">/* crc checksum calculation */</span>
<a name="l00343"></a>00343          <span class="keywordflow">if</span> (cid-&gt;<a class="code" href="structcallerid__state.html#ab42e79f596ce4d812d8bf08468f9855d">sawflag</a> &gt; 1)
<a name="l00344"></a>00344             cid-&gt;<a class="code" href="structcallerid__state.html#a0e34886f35a1dc651e0caf46a73e27ab">crc</a> = <a class="code" href="callerid_8c.html#a3faa215563ac24dec8ae8906dabafd3e">calc_crc</a>(cid-&gt;<a class="code" href="structcallerid__state.html#a0e34886f35a1dc651e0caf46a73e27ab">crc</a>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>) b2);
<a name="l00345"></a>00345 
<a name="l00346"></a>00346          <span class="comment">/* Ignore invalid bytes */</span>
<a name="l00347"></a>00347          <span class="keywordflow">if</span> (b &gt; 0xff)
<a name="l00348"></a>00348             <span class="keywordflow">continue</span>;
<a name="l00349"></a>00349 
<a name="l00350"></a>00350          <span class="comment">/* skip DLE if needed */</span>
<a name="l00351"></a>00351          <span class="keywordflow">if</span> (cid-&gt;<a class="code" href="structcallerid__state.html#ab42e79f596ce4d812d8bf08468f9855d">sawflag</a> &gt; 0) {
<a name="l00352"></a>00352             <span class="keywordflow">if</span> (cid-&gt;<a class="code" href="structcallerid__state.html#ab42e79f596ce4d812d8bf08468f9855d">sawflag</a> != 5 &amp;&amp; cid-&gt;<a class="code" href="structcallerid__state.html#a8f054ca18f780062a4bf92f2c265d93b">skipflag</a> == 0 &amp;&amp; b == 0x10) {
<a name="l00353"></a>00353                cid-&gt;<a class="code" href="structcallerid__state.html#a8f054ca18f780062a4bf92f2c265d93b">skipflag</a> = 1 ;
<a name="l00354"></a>00354                continue ;
<a name="l00355"></a>00355             }
<a name="l00356"></a>00356          }
<a name="l00357"></a>00357          <span class="keywordflow">if</span> (cid-&gt;<a class="code" href="structcallerid__state.html#a8f054ca18f780062a4bf92f2c265d93b">skipflag</a> == 1)
<a name="l00358"></a>00358             cid-&gt;<a class="code" href="structcallerid__state.html#a8f054ca18f780062a4bf92f2c265d93b">skipflag</a> = 0 ;
<a name="l00359"></a>00359 
<a name="l00360"></a>00360          <span class="comment">/* caller id retrieval */</span>
<a name="l00361"></a>00361          <span class="keywordflow">switch</span> (cid-&gt;<a class="code" href="structcallerid__state.html#ab42e79f596ce4d812d8bf08468f9855d">sawflag</a>) {
<a name="l00362"></a>00362          <span class="keywordflow">case</span> 0: <span class="comment">/* DLE */</span>
<a name="l00363"></a>00363             <span class="keywordflow">if</span> (b == 0x10) {
<a name="l00364"></a>00364                cid-&gt;<a class="code" href="structcallerid__state.html#ab42e79f596ce4d812d8bf08468f9855d">sawflag</a> = 1;
<a name="l00365"></a>00365                cid-&gt;<a class="code" href="structcallerid__state.html#a8f054ca18f780062a4bf92f2c265d93b">skipflag</a> = 0;
<a name="l00366"></a>00366                cid-&gt;<a class="code" href="structcallerid__state.html#a0e34886f35a1dc651e0caf46a73e27ab">crc</a> = 0;
<a name="l00367"></a>00367             }
<a name="l00368"></a>00368             <span class="keywordflow">break</span>;
<a name="l00369"></a>00369          <span class="keywordflow">case</span> 1: <span class="comment">/* SOH */</span>
<a name="l00370"></a>00370             <span class="keywordflow">if</span> (b == 0x01) 
<a name="l00371"></a>00371                cid-&gt;<a class="code" href="structcallerid__state.html#ab42e79f596ce4d812d8bf08468f9855d">sawflag</a> = 2;
<a name="l00372"></a>00372             break ;
<a name="l00373"></a>00373          <span class="keywordflow">case</span> 2: <span class="comment">/* HEADER */</span>
<a name="l00374"></a>00374             <span class="keywordflow">if</span> (b == 0x07) 
<a name="l00375"></a>00375                cid-&gt;<a class="code" href="structcallerid__state.html#ab42e79f596ce4d812d8bf08468f9855d">sawflag</a> = 3;
<a name="l00376"></a>00376             <span class="keywordflow">break</span>;
<a name="l00377"></a>00377          <span class="keywordflow">case</span> 3: <span class="comment">/* STX */</span>
<a name="l00378"></a>00378             <span class="keywordflow">if</span> (b == 0x02) 
<a name="l00379"></a>00379                cid-&gt;<a class="code" href="structcallerid__state.html#ab42e79f596ce4d812d8bf08468f9855d">sawflag</a> = 4;
<a name="l00380"></a>00380             <span class="keywordflow">break</span>;
<a name="l00381"></a>00381          <span class="keywordflow">case</span> 4: <span class="comment">/* SERVICE TYPE */</span>
<a name="l00382"></a>00382             <span class="keywordflow">if</span> (b == 0x40) 
<a name="l00383"></a>00383                cid-&gt;<a class="code" href="structcallerid__state.html#ab42e79f596ce4d812d8bf08468f9855d">sawflag</a> = 5;
<a name="l00384"></a>00384             <span class="keywordflow">break</span>;
<a name="l00385"></a>00385          <span class="keywordflow">case</span> 5: <span class="comment">/* Frame Length */</span>
<a name="l00386"></a>00386             cid-&gt;<a class="code" href="structcallerid__state.html#ab42e79f596ce4d812d8bf08468f9855d">sawflag</a> = 6;
<a name="l00387"></a>00387             <span class="keywordflow">break</span>;   
<a name="l00388"></a>00388          <span class="keywordflow">case</span> 6: <span class="comment">/* NUMBER TYPE */</span>
<a name="l00389"></a>00389             cid-&gt;<a class="code" href="structcallerid__state.html#ab42e79f596ce4d812d8bf08468f9855d">sawflag</a> = 7;
<a name="l00390"></a>00390             cid-&gt;<a class="code" href="structcallerid__state.html#a1910d262855b71da353ed0d07a6c7823">pos</a> = 0;
<a name="l00391"></a>00391             cid-&gt;<a class="code" href="structcallerid__state.html#a206c088624d4566f4e1f629e1caf7dfa">rawdata</a>[cid-&gt;<a class="code" href="structcallerid__state.html#a1910d262855b71da353ed0d07a6c7823">pos</a>++] = b;
<a name="l00392"></a>00392             <span class="keywordflow">break</span>;
<a name="l00393"></a>00393          <span class="keywordflow">case</span> 7:  <span class="comment">/* NUMBER LENGTH */</span>
<a name="l00394"></a>00394             cid-&gt;<a class="code" href="structcallerid__state.html#ab42e79f596ce4d812d8bf08468f9855d">sawflag</a> = 8;
<a name="l00395"></a>00395             cid-&gt;<a class="code" href="structcallerid__state.html#afed088663f8704004425cdae2120b9b3">len</a> = b;
<a name="l00396"></a>00396             <span class="keywordflow">if</span> ((cid-&gt;<a class="code" href="structcallerid__state.html#afed088663f8704004425cdae2120b9b3">len</a>+2) &gt;= <span class="keyword">sizeof</span>(cid-&gt;<a class="code" href="structcallerid__state.html#a206c088624d4566f4e1f629e1caf7dfa">rawdata</a>)) {
<a name="l00397"></a>00397                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;too long caller id string\n&quot;</span>) ;
<a name="l00398"></a>00398                <span class="keywordflow">return</span> -1;
<a name="l00399"></a>00399             }
<a name="l00400"></a>00400             cid-&gt;<a class="code" href="structcallerid__state.html#a206c088624d4566f4e1f629e1caf7dfa">rawdata</a>[cid-&gt;<a class="code" href="structcallerid__state.html#a1910d262855b71da353ed0d07a6c7823">pos</a>++] = b;
<a name="l00401"></a>00401             <span class="keywordflow">break</span>;
<a name="l00402"></a>00402          <span class="keywordflow">case</span> 8:  <span class="comment">/* Retrieve message */</span>
<a name="l00403"></a>00403             cid-&gt;<a class="code" href="structcallerid__state.html#a206c088624d4566f4e1f629e1caf7dfa">rawdata</a>[cid-&gt;<a class="code" href="structcallerid__state.html#a1910d262855b71da353ed0d07a6c7823">pos</a>++] = b;
<a name="l00404"></a>00404             cid-&gt;<a class="code" href="structcallerid__state.html#afed088663f8704004425cdae2120b9b3">len</a>--;
<a name="l00405"></a>00405             <span class="keywordflow">if</span> (cid-&gt;<a class="code" href="structcallerid__state.html#afed088663f8704004425cdae2120b9b3">len</a>&lt;=0) {
<a name="l00406"></a>00406                cid-&gt;<a class="code" href="structcallerid__state.html#a206c088624d4566f4e1f629e1caf7dfa">rawdata</a>[cid-&gt;<a class="code" href="structcallerid__state.html#a1910d262855b71da353ed0d07a6c7823">pos</a>] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00407"></a>00407                cid-&gt;<a class="code" href="structcallerid__state.html#ab42e79f596ce4d812d8bf08468f9855d">sawflag</a> = 9;
<a name="l00408"></a>00408             }
<a name="l00409"></a>00409             <span class="keywordflow">break</span>;
<a name="l00410"></a>00410          <span class="keywordflow">case</span> 9:  <span class="comment">/* ETX */</span>
<a name="l00411"></a>00411             cid-&gt;<a class="code" href="structcallerid__state.html#ab42e79f596ce4d812d8bf08468f9855d">sawflag</a> = 10;
<a name="l00412"></a>00412             <span class="keywordflow">break</span>;
<a name="l00413"></a>00413          <span class="keywordflow">case</span> 10: <span class="comment">/* CRC Checksum 1 */</span>
<a name="l00414"></a>00414             cid-&gt;<a class="code" href="structcallerid__state.html#ab42e79f596ce4d812d8bf08468f9855d">sawflag</a> = 11;
<a name="l00415"></a>00415             <span class="keywordflow">break</span>;
<a name="l00416"></a>00416          <span class="keywordflow">case</span> 11: <span class="comment">/* CRC Checksum 2 */</span>
<a name="l00417"></a>00417             cid-&gt;<a class="code" href="structcallerid__state.html#ab42e79f596ce4d812d8bf08468f9855d">sawflag</a> = 12;
<a name="l00418"></a>00418             <span class="keywordflow">if</span> (cid-&gt;<a class="code" href="structcallerid__state.html#a0e34886f35a1dc651e0caf46a73e27ab">crc</a> != 0) {
<a name="l00419"></a>00419                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;crc checksum error\n&quot;</span>) ;
<a name="l00420"></a>00420                <span class="keywordflow">return</span> -1;
<a name="l00421"></a>00421             } 
<a name="l00422"></a>00422             <span class="comment">/* extract caller id data */</span>
<a name="l00423"></a>00423             <span class="keywordflow">for</span> (x = 0; x &lt; cid-&gt;<a class="code" href="structcallerid__state.html#a1910d262855b71da353ed0d07a6c7823">pos</a>;) {
<a name="l00424"></a>00424                <span class="keywordflow">switch</span> (cid-&gt;<a class="code" href="structcallerid__state.html#a206c088624d4566f4e1f629e1caf7dfa">rawdata</a>[x++]) {
<a name="l00425"></a>00425                <span class="keywordflow">case</span> 0x02: <span class="comment">/* caller id  number */</span>
<a name="l00426"></a>00426                   cid-&gt;<a class="code" href="structcallerid__state.html#a5d40e881ec298b08348b3e355222c685">number</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00427"></a>00427                   cid-&gt;<a class="code" href="structcallerid__state.html#ad53db8acabbf75e31bf23d9f20a2c847">name</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00428"></a>00428                   cid-&gt;<a class="code" href="structcallerid__state.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> = 0;
<a name="l00429"></a>00429                   res = cid-&gt;<a class="code" href="structcallerid__state.html#a206c088624d4566f4e1f629e1caf7dfa">rawdata</a>[x++];
<a name="l00430"></a>00430                   <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(cid-&gt;<a class="code" href="structcallerid__state.html#a5d40e881ec298b08348b3e355222c685">number</a>, &amp;cid-&gt;<a class="code" href="structcallerid__state.html#a206c088624d4566f4e1f629e1caf7dfa">rawdata</a>[x], res+1);
<a name="l00431"></a>00431                   x += res;
<a name="l00432"></a>00432                   <span class="keywordflow">break</span>;
<a name="l00433"></a>00433                <span class="keywordflow">case</span> 0x21: <span class="comment">/* additional information */</span>
<a name="l00434"></a>00434                   <span class="comment">/* length */</span>
<a name="l00435"></a>00435                   x++; 
<a name="l00436"></a>00436                   <span class="comment">/* number type */</span>
<a name="l00437"></a>00437                   <span class="keywordflow">switch</span> (cid-&gt;<a class="code" href="structcallerid__state.html#a206c088624d4566f4e1f629e1caf7dfa">rawdata</a>[x]) { 
<a name="l00438"></a>00438                   <span class="keywordflow">case</span> 0x00: <span class="comment">/* unknown */</span>
<a name="l00439"></a>00439                   <span class="keywordflow">case</span> 0x01: <span class="comment">/* international number */</span>
<a name="l00440"></a>00440                   <span class="keywordflow">case</span> 0x02: <span class="comment">/* domestic number */</span>
<a name="l00441"></a>00441                   <span class="keywordflow">case</span> 0x03: <span class="comment">/* network */</span>
<a name="l00442"></a>00442                   <span class="keywordflow">case</span> 0x04: <span class="comment">/* local call */</span>
<a name="l00443"></a>00443                   <span class="keywordflow">case</span> 0x06: <span class="comment">/* short dial number */</span>
<a name="l00444"></a>00444                   <span class="keywordflow">case</span> 0x07: <span class="comment">/* reserved */</span>
<a name="l00445"></a>00445                   <span class="keywordflow">default</span>:   <span class="comment">/* reserved */</span>
<a name="l00446"></a>00446                      <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;cid info:#1=%X\n&quot;</span>, cid-&gt;<a class="code" href="structcallerid__state.html#a206c088624d4566f4e1f629e1caf7dfa">rawdata</a>[x]);
<a name="l00447"></a>00447                      break ;
<a name="l00448"></a>00448                   }
<a name="l00449"></a>00449                   x++; 
<a name="l00450"></a>00450                   <span class="comment">/* numbering plan octed 4 */</span>
<a name="l00451"></a>00451                   x++; 
<a name="l00452"></a>00452                   <span class="comment">/* numbering plan octed 5 */</span>
<a name="l00453"></a>00453                   <span class="keywordflow">switch</span> (cid-&gt;<a class="code" href="structcallerid__state.html#a206c088624d4566f4e1f629e1caf7dfa">rawdata</a>[x]) { 
<a name="l00454"></a>00454                   <span class="keywordflow">case</span> 0x00: <span class="comment">/* unknown */</span>
<a name="l00455"></a>00455                   <span class="keywordflow">case</span> 0x01: <span class="comment">/* recommendation E.164 ISDN */</span>
<a name="l00456"></a>00456                   <span class="keywordflow">case</span> 0x03: <span class="comment">/* recommendation X.121 */</span>
<a name="l00457"></a>00457                   <span class="keywordflow">case</span> 0x04: <span class="comment">/* telex dial plan */</span>
<a name="l00458"></a>00458                   <span class="keywordflow">case</span> 0x08: <span class="comment">/* domestic dial plan */</span>
<a name="l00459"></a>00459                   <span class="keywordflow">case</span> 0x09: <span class="comment">/* private dial plan */</span>
<a name="l00460"></a>00460                   <span class="keywordflow">case</span> 0x05: <span class="comment">/* reserved */</span>
<a name="l00461"></a>00461                   <span class="keywordflow">default</span>:   <span class="comment">/* reserved */</span>
<a name="l00462"></a>00462                      <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;cid info:#2=%X\n&quot;</span>, cid-&gt;<a class="code" href="structcallerid__state.html#a206c088624d4566f4e1f629e1caf7dfa">rawdata</a>[x]);
<a name="l00463"></a>00463                      break ;
<a name="l00464"></a>00464                   }
<a name="l00465"></a>00465                   x++; 
<a name="l00466"></a>00466                   break ;
<a name="l00467"></a>00467                <span class="keywordflow">case</span> 0x04: <span class="comment">/* no callerid reason */</span>
<a name="l00468"></a>00468                   <span class="comment">/* length */</span>
<a name="l00469"></a>00469                   x++; 
<a name="l00470"></a>00470                   <span class="comment">/* no callerid reason code */</span>
<a name="l00471"></a>00471                   <span class="keywordflow">switch</span> (cid-&gt;<a class="code" href="structcallerid__state.html#a206c088624d4566f4e1f629e1caf7dfa">rawdata</a>[x]) {
<a name="l00472"></a>00472                   <span class="keywordflow">case</span> <span class="charliteral">&apos;P&apos;</span>: <span class="comment">/* caller id denied by user */</span>
<a name="l00473"></a>00473                   <span class="keywordflow">case</span> <span class="charliteral">&apos;O&apos;</span>: <span class="comment">/* service not available */</span>
<a name="l00474"></a>00474                   <span class="keywordflow">case</span> <span class="charliteral">&apos;C&apos;</span>: <span class="comment">/* pay phone */</span>
<a name="l00475"></a>00475                   <span class="keywordflow">case</span> <span class="charliteral">&apos;S&apos;</span>: <span class="comment">/* service congested */</span>
<a name="l00476"></a>00476                      cid-&gt;<a class="code" href="structcallerid__state.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> |= <a class="code" href="callerid_8h.html#a1290504d77210103d8553593671cc3c2">CID_UNKNOWN_NUMBER</a>;
<a name="l00477"></a>00477                      <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;no cid reason:%c\n&quot;</span>, cid-&gt;<a class="code" href="structcallerid__state.html#a206c088624d4566f4e1f629e1caf7dfa">rawdata</a>[x]);
<a name="l00478"></a>00478                      break ;
<a name="l00479"></a>00479                   }
<a name="l00480"></a>00480                   x++; 
<a name="l00481"></a>00481                   break ;
<a name="l00482"></a>00482                <span class="keywordflow">case</span> 0x09: <span class="comment">/* dialed number */</span>
<a name="l00483"></a>00483                   <span class="comment">/* length */</span>
<a name="l00484"></a>00484                   res = cid-&gt;<a class="code" href="structcallerid__state.html#a206c088624d4566f4e1f629e1caf7dfa">rawdata</a>[x++];
<a name="l00485"></a>00485                   <span class="comment">/* dialed number */</span>
<a name="l00486"></a>00486                   x += res;
<a name="l00487"></a>00487                   break ;
<a name="l00488"></a>00488                <span class="keywordflow">case</span> 0x22: <span class="comment">/* dialed number additional information */</span>
<a name="l00489"></a>00489                   <span class="comment">/* length */</span>
<a name="l00490"></a>00490                   x++;
<a name="l00491"></a>00491                   <span class="comment">/* number type */</span>
<a name="l00492"></a>00492                   <span class="keywordflow">switch</span> (cid-&gt;<a class="code" href="structcallerid__state.html#a206c088624d4566f4e1f629e1caf7dfa">rawdata</a>[x]) {
<a name="l00493"></a>00493                   <span class="keywordflow">case</span> 0x00: <span class="comment">/* unknown */</span>
<a name="l00494"></a>00494                   <span class="keywordflow">case</span> 0x01: <span class="comment">/* international number */</span>
<a name="l00495"></a>00495                   <span class="keywordflow">case</span> 0x02: <span class="comment">/* domestic number */</span>
<a name="l00496"></a>00496                   <span class="keywordflow">case</span> 0x03: <span class="comment">/* network */</span>
<a name="l00497"></a>00497                   <span class="keywordflow">case</span> 0x04: <span class="comment">/* local call */</span>
<a name="l00498"></a>00498                   <span class="keywordflow">case</span> 0x06: <span class="comment">/* short dial number */</span>
<a name="l00499"></a>00499                   <span class="keywordflow">case</span> 0x07: <span class="comment">/* reserved */</span>
<a name="l00500"></a>00500                   <span class="keywordflow">default</span>:   <span class="comment">/* reserved */</span>
<a name="l00501"></a>00501                      <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#ga40f8fb2e731031d99f732f515cec680f">option_debug</a> &gt; 1)
<a name="l00502"></a>00502                         <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;did info:#1=%X\n&quot;</span>, cid-&gt;<a class="code" href="structcallerid__state.html#a206c088624d4566f4e1f629e1caf7dfa">rawdata</a>[x]);
<a name="l00503"></a>00503                      break ;
<a name="l00504"></a>00504                   }
<a name="l00505"></a>00505                   x++;
<a name="l00506"></a>00506                   <span class="comment">/* numbering plan octed 4 */</span>
<a name="l00507"></a>00507                   x++;
<a name="l00508"></a>00508                   <span class="comment">/* numbering plan octed 5 */</span>
<a name="l00509"></a>00509                   <span class="keywordflow">switch</span> (cid-&gt;<a class="code" href="structcallerid__state.html#a206c088624d4566f4e1f629e1caf7dfa">rawdata</a>[x]) {
<a name="l00510"></a>00510                   <span class="keywordflow">case</span> 0x00: <span class="comment">/* unknown */</span>
<a name="l00511"></a>00511                   <span class="keywordflow">case</span> 0x01: <span class="comment">/* recommendation E.164 ISDN */</span>
<a name="l00512"></a>00512                   <span class="keywordflow">case</span> 0x03: <span class="comment">/* recommendation X.121 */</span>
<a name="l00513"></a>00513                   <span class="keywordflow">case</span> 0x04: <span class="comment">/* telex dial plan */</span>
<a name="l00514"></a>00514                   <span class="keywordflow">case</span> 0x08: <span class="comment">/* domestic dial plan */</span>
<a name="l00515"></a>00515                   <span class="keywordflow">case</span> 0x09: <span class="comment">/* private dial plan */</span>
<a name="l00516"></a>00516                   <span class="keywordflow">case</span> 0x05: <span class="comment">/* reserved */</span>
<a name="l00517"></a>00517                   <span class="keywordflow">default</span>:   <span class="comment">/* reserved */</span>
<a name="l00518"></a>00518                      <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;did info:#2=%X\n&quot;</span>, cid-&gt;<a class="code" href="structcallerid__state.html#a206c088624d4566f4e1f629e1caf7dfa">rawdata</a>[x]);
<a name="l00519"></a>00519                      break ;
<a name="l00520"></a>00520                   }
<a name="l00521"></a>00521                   x++;
<a name="l00522"></a>00522                   break ;
<a name="l00523"></a>00523                }
<a name="l00524"></a>00524             }
<a name="l00525"></a>00525             <span class="keywordflow">return</span> 1;
<a name="l00526"></a>00526             <span class="keywordflow">break</span>;
<a name="l00527"></a>00527          <span class="keywordflow">default</span>:
<a name="l00528"></a>00528             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;invalid value in sawflag %d\n&quot;</span>, cid-&gt;<a class="code" href="structcallerid__state.html#ab42e79f596ce4d812d8bf08468f9855d">sawflag</a>);
<a name="l00529"></a>00529          }
<a name="l00530"></a>00530       }
<a name="l00531"></a>00531    }
<a name="l00532"></a>00532    <span class="keywordflow">if</span> (mylen) {
<a name="l00533"></a>00533       memcpy(cid-&gt;<a class="code" href="structcallerid__state.html#ad11068e3f0f16b0b1eed6eb357e7fdb7">oldstuff</a>, buf, mylen * 2);
<a name="l00534"></a>00534       cid-&gt;<a class="code" href="structcallerid__state.html#a867bf9ceda87a78eff00c671640f3043">oldlen</a> = mylen * 2;
<a name="l00535"></a>00535    } <span class="keywordflow">else</span>
<a name="l00536"></a>00536       cid-&gt;<a class="code" href="structcallerid__state.html#a867bf9ceda87a78eff00c671640f3043">oldlen</a> = 0;
<a name="l00537"></a>00537    
<a name="l00538"></a>00538    <span class="keywordflow">return</span> 0;
<a name="l00539"></a>00539 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4d792e593d99c8b5b3a5534e73082c9d"></a><!-- doxytag: member="callerid.c::callerid_free" ref="a4d792e593d99c8b5b3a5534e73082c9d" args="(struct callerid_state *cid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void callerid_free </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structcallerid__state.html">callerid_state</a> *&nbsp;</td>
          <td class="paramname"> <em>cid</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Free a callerID <a class="el" href="structstate.html">state</a>. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>cid</em>&nbsp;</td><td>This is the <a class="el" href="structcallerid__state.html">callerid_state</a> <a class="el" href="structstate.html">state</a> machine to free This function frees <a class="el" href="structcallerid__state.html">callerid_state</a> cid. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="callerid_8c_source.html#l00718">718</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l08925">mwi_thread()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00719"></a>00719 {
<a name="l00720"></a>00720    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(cid);
<a name="l00721"></a>00721 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0976c857568032bd94e16c789bcfa213"></a><!-- doxytag: member="callerid.c::callerid_generate" ref="a0976c857568032bd94e16c789bcfa213" args="(unsigned char *buf, const char *number, const char *name, int flags, int callwaiting, int codec)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int callerid_generate </td>
          <td>(</td>
          <td class="paramtype">unsigned char *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>number</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>callwaiting</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>codec</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Generates a CallerID FSK stream in ulaw format suitable for transmission. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>buf</em>&nbsp;</td><td>Buffer to use. If "buf" is supplied, it will use that buffer instead of allocating its own. "buf" must be at least 32000 bytes in size of you want to be sure you don't have an overrun. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structnumber.html" title="Number structure.">number</a></em>&nbsp;</td><td>Use NULL for no <a class="el" href="structnumber.html" title="Number structure.">number</a> or "P" for "private" </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>name to be used </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>flags</em>&nbsp;</td><td>passed flags </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>callwaiting</em>&nbsp;</td><td>callwaiting flag </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>codec</em>&nbsp;</td><td>-- either AST_FORMAT_ULAW or AST_FORMAT_ALAW This function creates a stream of callerid (a callerid spill) data in ulaw format. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>It returns the size (in bytes) of the data (if it returns a size of 0, there is probably an error) </dd></dl>

<p>Definition at line <a class="el" href="callerid_8c_source.html#l00882">882</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

<p>References <a class="el" href="callerid_8c_source.html#l00723">callerid_genmsg()</a>, <a class="el" href="func__strings_8c_source.html#l00821">len()</a>, <a class="el" href="adsistub_8c_source.html#l00055">msg</a>, <a class="el" href="callerid_8h_source.html#l00253">PUT_BYTE</a>, <a class="el" href="callerid_8h_source.html#l00279">PUT_CLID</a>, and <a class="el" href="callerid_8h_source.html#l00264">PUT_CLID_MARKMS</a>.</p>

<p>Referenced by <a class="el" href="callerid_8c_source.html#l01053">__ast_callerid_generate()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00883"></a>00883 {
<a name="l00884"></a>00884    <span class="keywordtype">int</span> bytes = 0;
<a name="l00885"></a>00885    <span class="keywordtype">int</span> x, sum;
<a name="l00886"></a>00886    <span class="keywordtype">int</span> <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>;
<a name="l00887"></a>00887 
<a name="l00888"></a>00888    <span class="comment">/* Initial carriers (real/imaginary) */</span>
<a name="l00889"></a>00889    <span class="keywordtype">float</span> cr = 1.0;
<a name="l00890"></a>00890    <span class="keywordtype">float</span> ci = 0.0;
<a name="l00891"></a>00891    <span class="keywordtype">float</span> scont = 0.0;
<a name="l00892"></a>00892    <span class="keywordtype">char</span> <a class="code" href="adsistub_8c.html#a0dee90db1d6eb30329bee1ae6cec036a">msg</a>[256];
<a name="l00893"></a>00893    len = <a class="code" href="callerid_8c.html#a315d5278c97c5c96bfe89c6d0e24fd42">callerid_genmsg</a>(msg, <span class="keyword">sizeof</span>(msg), <a class="code" href="structnumber.html" title="Number structure.">number</a>, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, flags);
<a name="l00894"></a>00894    <span class="keywordflow">if</span> (!<a class="code" href="chan__mgcp_8c.html#a50ea1ecd6da04bb18650fe24943d23d1">callwaiting</a>) {
<a name="l00895"></a>00895       <span class="comment">/* Wait a half a second */</span>
<a name="l00896"></a>00896       <span class="keywordflow">for</span> (x = 0; x &lt; 4000; x++)
<a name="l00897"></a>00897          <a class="code" href="callerid_8h.html#a32e0652e615f27aef195c93a80f756b9">PUT_BYTE</a>(0x7f);
<a name="l00898"></a>00898       <span class="comment">/* Transmit 30 0x55&apos;s (looks like a square wave) for channel seizure */</span>
<a name="l00899"></a>00899       <span class="keywordflow">for</span> (x = 0; x &lt; 30; x++)
<a name="l00900"></a>00900          <a class="code" href="callerid_8h.html#a02c7254b3ec648f815c15bd6f8cce39b">PUT_CLID</a>(0x55);
<a name="l00901"></a>00901    }
<a name="l00902"></a>00902    <span class="comment">/* Send 150ms of callerid marks */</span>
<a name="l00903"></a>00903    <span class="keywordflow">for</span> (x = 0; x &lt; 150; x++)
<a name="l00904"></a>00904       <a class="code" href="callerid_8h.html#a7ce7cf8db165eb44e64e704c3ced9774">PUT_CLID_MARKMS</a>;
<a name="l00905"></a>00905    <span class="comment">/* Send 0x80 indicating MDMF format */</span>
<a name="l00906"></a>00906    <a class="code" href="callerid_8h.html#a02c7254b3ec648f815c15bd6f8cce39b">PUT_CLID</a>(0x80);
<a name="l00907"></a>00907    <span class="comment">/* Put length of whole message */</span>
<a name="l00908"></a>00908    <a class="code" href="callerid_8h.html#a02c7254b3ec648f815c15bd6f8cce39b">PUT_CLID</a>(len);
<a name="l00909"></a>00909    sum = 0x80 + strlen(msg);
<a name="l00910"></a>00910    <span class="comment">/* Put each character of message and update checksum */</span>
<a name="l00911"></a>00911    <span class="keywordflow">for</span> (x = 0; x &lt; len; x++) {
<a name="l00912"></a>00912       <a class="code" href="callerid_8h.html#a02c7254b3ec648f815c15bd6f8cce39b">PUT_CLID</a>(msg[x]);
<a name="l00913"></a>00913       sum += msg[x];
<a name="l00914"></a>00914    }
<a name="l00915"></a>00915    <span class="comment">/* Send 2&apos;s compliment of sum */</span>
<a name="l00916"></a>00916    <a class="code" href="callerid_8h.html#a02c7254b3ec648f815c15bd6f8cce39b">PUT_CLID</a>(256 - (sum &amp; 255));
<a name="l00917"></a>00917 
<a name="l00918"></a>00918    <span class="comment">/* Send 50 more ms of marks */</span>
<a name="l00919"></a>00919    <span class="keywordflow">for</span> (x = 0; x &lt; 50; x++)
<a name="l00920"></a>00920       <a class="code" href="callerid_8h.html#a7ce7cf8db165eb44e64e704c3ced9774">PUT_CLID_MARKMS</a>;
<a name="l00921"></a>00921    
<a name="l00922"></a>00922    <span class="keywordflow">return</span> bytes;
<a name="l00923"></a>00923 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a315d5278c97c5c96bfe89c6d0e24fd42"></a><!-- doxytag: member="callerid.c::callerid_genmsg" ref="a315d5278c97c5c96bfe89c6d0e24fd42" args="(char *msg, int size, const char *number, const char *name, int flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int callerid_genmsg </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>number</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="callerid_8c_source.html#l00723">723</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

<p>References <a class="el" href="localtime_8c_source.html#l01305">ast_localtime()</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="callerid_8h_source.html#l00050">CID_PRIVATE_NAME</a>, <a class="el" href="callerid_8h_source.html#l00051">CID_PRIVATE_NUMBER</a>, <a class="el" href="callerid_8h_source.html#l00052">CID_UNKNOWN_NAME</a>, <a class="el" href="callerid_8h_source.html#l00053">CID_UNKNOWN_NUMBER</a>, <a class="el" href="localtime_8h_source.html#l00030">ast_tm::tm_hour</a>, <a class="el" href="localtime_8h_source.html#l00031">ast_tm::tm_mday</a>, <a class="el" href="localtime_8h_source.html#l00029">ast_tm::tm_min</a>, and <a class="el" href="localtime_8h_source.html#l00032">ast_tm::tm_mon</a>.</p>

<p>Referenced by <a class="el" href="callerid_8c_source.html#l00882">callerid_generate()</a>, and <a class="el" href="callerid_8c_source.html#l00794">vmwi_generate()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00724"></a>00724 {
<a name="l00725"></a>00725    <span class="keyword">struct </span>timeval now = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l00726"></a>00726    <span class="keyword">struct </span><a class="code" href="structast__tm.html">ast_tm</a> tm;
<a name="l00727"></a>00727    <span class="keywordtype">char</span> *ptr;
<a name="l00728"></a>00728    <span class="keywordtype">int</span> res;
<a name="l00729"></a>00729    <span class="keywordtype">int</span> i, x;
<a name="l00730"></a>00730 
<a name="l00731"></a>00731    <span class="comment">/* Get the time */</span>
<a name="l00732"></a>00732    <a class="code" href="localtime_8h.html#ae9fbda728350a9a5b9c09b29214d718e" title="Timezone-independent version of localtime_r(3).">ast_localtime</a>(&amp;now, &amp;tm, NULL);
<a name="l00733"></a>00733    
<a name="l00734"></a>00734    ptr = <a class="code" href="adsistub_8c.html#a0dee90db1d6eb30329bee1ae6cec036a">msg</a>;
<a name="l00735"></a>00735    
<a name="l00736"></a>00736    <span class="comment">/* Format time and message header */</span>
<a name="l00737"></a>00737    res = snprintf(ptr, size, <span class="stringliteral">&quot;\001\010%02d%02d%02d%02d&quot;</span>, tm.tm_mon + 1,
<a name="l00738"></a>00738             tm.tm_mday, tm.tm_hour, tm.tm_min);
<a name="l00739"></a>00739    size -= res;
<a name="l00740"></a>00740    ptr += res;
<a name="l00741"></a>00741    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="structnumber.html" title="Number structure.">number</a>) || (flags &amp; <a class="code" href="callerid_8h.html#a1290504d77210103d8553593671cc3c2">CID_UNKNOWN_NUMBER</a>)) {
<a name="l00742"></a>00742       <span class="comment">/* Indicate number not known */</span>
<a name="l00743"></a>00743       res = snprintf(ptr, size, <span class="stringliteral">&quot;\004\001O&quot;</span>);
<a name="l00744"></a>00744       size -= res;
<a name="l00745"></a>00745       ptr += res;
<a name="l00746"></a>00746    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (flags &amp; <a class="code" href="callerid_8h.html#a89ec835ed3bca0bf18b83d753daeecbd">CID_PRIVATE_NUMBER</a>) {
<a name="l00747"></a>00747       <span class="comment">/* Indicate number is private */</span>
<a name="l00748"></a>00748       res = snprintf(ptr, size, <span class="stringliteral">&quot;\004\001P&quot;</span>);
<a name="l00749"></a>00749       size -= res;
<a name="l00750"></a>00750       ptr += res;
<a name="l00751"></a>00751    } <span class="keywordflow">else</span> {
<a name="l00752"></a>00752       <span class="comment">/* Send up to 16 digits of number MAX */</span>
<a name="l00753"></a>00753       i = strlen(<a class="code" href="structnumber.html" title="Number structure.">number</a>);
<a name="l00754"></a>00754       <span class="keywordflow">if</span> (i &gt; 16)
<a name="l00755"></a>00755          i = 16;
<a name="l00756"></a>00756       res = snprintf(ptr, size, <span class="stringliteral">&quot;\002%c&quot;</span>, i);
<a name="l00757"></a>00757       size -= res;
<a name="l00758"></a>00758       ptr += res;
<a name="l00759"></a>00759       <span class="keywordflow">for</span> (x = 0; x &lt; i; x++)
<a name="l00760"></a>00760          ptr[x] = <a class="code" href="structnumber.html" title="Number structure.">number</a>[x];
<a name="l00761"></a>00761       ptr[i] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00762"></a>00762       ptr += i;
<a name="l00763"></a>00763       size -= i;
<a name="l00764"></a>00764    }
<a name="l00765"></a>00765 
<a name="l00766"></a>00766    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>) || (flags &amp; <a class="code" href="callerid_8h.html#a30f6e6391969dd024122f1fc9203b273">CID_UNKNOWN_NAME</a>)) {
<a name="l00767"></a>00767       <span class="comment">/* Indicate name not known */</span>
<a name="l00768"></a>00768       res = snprintf(ptr, size, <span class="stringliteral">&quot;\010\001O&quot;</span>);
<a name="l00769"></a>00769       size -= res;
<a name="l00770"></a>00770       ptr += res;
<a name="l00771"></a>00771    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (flags &amp; <a class="code" href="callerid_8h.html#a75e6d6b2c4ea5b399d5a5b42f7be15c0">CID_PRIVATE_NAME</a>) {
<a name="l00772"></a>00772       <span class="comment">/* Indicate name is private */</span>
<a name="l00773"></a>00773       res = snprintf(ptr, size, <span class="stringliteral">&quot;\010\001P&quot;</span>);
<a name="l00774"></a>00774       size -= res;
<a name="l00775"></a>00775       ptr += res;
<a name="l00776"></a>00776    } <span class="keywordflow">else</span> {
<a name="l00777"></a>00777       <span class="comment">/* Send up to 16 digits of name MAX */</span>
<a name="l00778"></a>00778       i = strlen(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l00779"></a>00779       <span class="keywordflow">if</span> (i &gt; 16)
<a name="l00780"></a>00780          i = 16;
<a name="l00781"></a>00781       res = snprintf(ptr, size, <span class="stringliteral">&quot;\007%c&quot;</span>, i);
<a name="l00782"></a>00782       size -= res;
<a name="l00783"></a>00783       ptr += res;
<a name="l00784"></a>00784       <span class="keywordflow">for</span> (x = 0; x &lt; i; x++)
<a name="l00785"></a>00785          ptr[x] = <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>[x];
<a name="l00786"></a>00786       ptr[i] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00787"></a>00787       ptr += i;
<a name="l00788"></a>00788       size -= i;
<a name="l00789"></a>00789    }
<a name="l00790"></a>00790    <span class="keywordflow">return</span> (ptr - <a class="code" href="adsistub_8c.html#a0dee90db1d6eb30329bee1ae6cec036a">msg</a>);
<a name="l00791"></a>00791    
<a name="l00792"></a>00792 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="afed6bec2ec821870918daf8f6d7ea832"></a><!-- doxytag: member="callerid.c::callerid_get" ref="afed6bec2ec821870918daf8f6d7ea832" args="(struct callerid_state *cid, char **name, char **number, int *flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void callerid_get </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structcallerid__state.html">callerid_state</a> *&nbsp;</td>
          <td class="paramname"> <em>cid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&nbsp;</td>
          <td class="paramname"> <em>number</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Extract info out of callerID <a class="el" href="structstate.html">state</a> machine. Flags are listed above. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>cid</em>&nbsp;</td><td>Callerid <a class="el" href="structstate.html">state</a> machine to act upon </td></tr>
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structnumber.html" title="Number structure.">number</a></em>&nbsp;</td><td>Pass the address of a pointer-to-char (will contain the phone <a class="el" href="structnumber.html" title="Number structure.">number</a>) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>Pass the address of a pointer-to-char (will contain the name) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>flags</em>&nbsp;</td><td>Pass the address of an int variable(will contain the various callerid flags)</td></tr>
  </table>
  </dd>
</dl>
<p>This function extracts a callerid string out of a <a class="el" href="structcallerid__state.html">callerid_state</a> <a class="el" href="structstate.html">state</a> machine. If no <a class="el" href="structnumber.html" title="Number structure.">number</a> is found, *number will be set to NULL. Likewise for the name. Flags can contain any of the following:</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns nothing. </dd></dl>

<p>Definition at line <a class="el" href="callerid_8c_source.html#l00185">185</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

<p>References <a class="el" href="callerid_8h_source.html#l00050">CID_PRIVATE_NAME</a>, <a class="el" href="callerid_8h_source.html#l00051">CID_PRIVATE_NUMBER</a>, <a class="el" href="callerid_8h_source.html#l00052">CID_UNKNOWN_NAME</a>, <a class="el" href="callerid_8h_source.html#l00053">CID_UNKNOWN_NUMBER</a>, <a class="el" href="callerid_8c_source.html#l00052">callerid_state::flags</a>, <a class="el" href="callerid_8c_source.html#l00050">callerid_state::name</a>, and <a class="el" href="callerid_8c_source.html#l00051">callerid_state::number</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l08925">mwi_thread()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00186"></a>00186 {
<a name="l00187"></a>00187    *flags = cid-&gt;<a class="code" href="structcallerid__state.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a>;
<a name="l00188"></a>00188    <span class="keywordflow">if</span> (cid-&gt;<a class="code" href="structcallerid__state.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> &amp; (<a class="code" href="callerid_8h.html#a30f6e6391969dd024122f1fc9203b273">CID_UNKNOWN_NAME</a> | <a class="code" href="callerid_8h.html#a75e6d6b2c4ea5b399d5a5b42f7be15c0">CID_PRIVATE_NAME</a>))
<a name="l00189"></a>00189       *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a> = NULL;
<a name="l00190"></a>00190    <span class="keywordflow">else</span>
<a name="l00191"></a>00191       *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a> = cid-&gt;<a class="code" href="structcallerid__state.html#ad53db8acabbf75e31bf23d9f20a2c847">name</a>;
<a name="l00192"></a>00192    <span class="keywordflow">if</span> (cid-&gt;<a class="code" href="structcallerid__state.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> &amp; (<a class="code" href="callerid_8h.html#a1290504d77210103d8553593671cc3c2">CID_UNKNOWN_NUMBER</a> | <a class="code" href="callerid_8h.html#a89ec835ed3bca0bf18b83d753daeecbd">CID_PRIVATE_NUMBER</a>))
<a name="l00193"></a>00193       *<a class="code" href="structnumber.html" title="Number structure.">number</a> = NULL;
<a name="l00194"></a>00194    <span class="keywordflow">else</span>
<a name="l00195"></a>00195       *<a class="code" href="structnumber.html" title="Number structure.">number</a> = cid-&gt;<a class="code" href="structcallerid__state.html#a5d40e881ec298b08348b3e355222c685">number</a>;
<a name="l00196"></a>00196 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab5fe1d08c3e1f692c09923587e1cce70"></a><!-- doxytag: member="callerid.c::callerid_get_dtmf" ref="ab5fe1d08c3e1f692c09923587e1cce70" args="(char *cidstring, char *number, int *flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void callerid_get_dtmf </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>cidstring</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>number</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Get and parse DTMF-based callerid</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>cidstring</em>&nbsp;</td><td>The actual transmitted string. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structnumber.html" title="Number structure.">number</a></em>&nbsp;</td><td>The cid <a class="el" href="structnumber.html" title="Number structure.">number</a> is returned here. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>flags</em>&nbsp;</td><td>The cid flags are returned here. This function parses DTMF callerid. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="callerid_8c_source.html#l00198">198</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="callerid_8h_source.html#l00051">CID_PRIVATE_NUMBER</a>, <a class="el" href="callerid_8h_source.html#l00053">CID_UNKNOWN_NUMBER</a>, and <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00199"></a>00199 {
<a name="l00200"></a>00200    <span class="keywordtype">int</span> i;
<a name="l00201"></a>00201    <span class="keywordtype">int</span> code;
<a name="l00202"></a>00202 
<a name="l00203"></a>00203    <span class="comment">/* &quot;Clear&quot; the number-buffer. */</span>
<a name="l00204"></a>00204    <a class="code" href="structnumber.html" title="Number structure.">number</a>[0] = 0;
<a name="l00205"></a>00205 
<a name="l00206"></a>00206    <span class="keywordflow">if</span> (strlen(cidstring) &lt; 2) {
<a name="l00207"></a>00207       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;No cid detected\n&quot;</span>);
<a name="l00208"></a>00208       *flags = <a class="code" href="callerid_8h.html#a1290504d77210103d8553593671cc3c2">CID_UNKNOWN_NUMBER</a>;
<a name="l00209"></a>00209       <span class="keywordflow">return</span>;
<a name="l00210"></a>00210    }
<a name="l00211"></a>00211    
<a name="l00212"></a>00212    <span class="comment">/* Detect protocol and special types */</span>
<a name="l00213"></a>00213    <span class="keywordflow">if</span> (cidstring[0] == <span class="charliteral">&apos;B&apos;</span>) {
<a name="l00214"></a>00214       <span class="comment">/* Handle special codes */</span>
<a name="l00215"></a>00215       code = atoi(&amp;cidstring[1]);
<a name="l00216"></a>00216       <span class="keywordflow">if</span> (code == 0)
<a name="l00217"></a>00217          *flags = <a class="code" href="callerid_8h.html#a1290504d77210103d8553593671cc3c2">CID_UNKNOWN_NUMBER</a>;
<a name="l00218"></a>00218       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (code == 10) 
<a name="l00219"></a>00219          *flags = <a class="code" href="callerid_8h.html#a89ec835ed3bca0bf18b83d753daeecbd">CID_PRIVATE_NUMBER</a>;
<a name="l00220"></a>00220       <span class="keywordflow">else</span>
<a name="l00221"></a>00221          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Unknown DTMF code %d\n&quot;</span>, code);
<a name="l00222"></a>00222    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cidstring[0] == <span class="charliteral">&apos;D&apos;</span> &amp;&amp; cidstring[2] == <span class="charliteral">&apos;#&apos;</span>) {
<a name="l00223"></a>00223       <span class="comment">/* .DK special code */</span>
<a name="l00224"></a>00224       <span class="keywordflow">if</span> (cidstring[1] == <span class="charliteral">&apos;1&apos;</span>)
<a name="l00225"></a>00225          *flags = <a class="code" href="callerid_8h.html#a89ec835ed3bca0bf18b83d753daeecbd">CID_PRIVATE_NUMBER</a>;
<a name="l00226"></a>00226       <span class="keywordflow">if</span> (cidstring[1] == <span class="charliteral">&apos;2&apos;</span> || cidstring[1] == <span class="charliteral">&apos;3&apos;</span>)
<a name="l00227"></a>00227          *flags = <a class="code" href="callerid_8h.html#a1290504d77210103d8553593671cc3c2">CID_UNKNOWN_NUMBER</a>;
<a name="l00228"></a>00228    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cidstring[0] == <span class="charliteral">&apos;D&apos;</span> || cidstring[0] == <span class="charliteral">&apos;A&apos;</span>) {
<a name="l00229"></a>00229       <span class="comment">/* &quot;Standard&quot; callerid */</span>
<a name="l00230"></a>00230       <span class="keywordflow">for</span> (i = 1; i &lt; strlen(cidstring); i++) {
<a name="l00231"></a>00231          <span class="keywordflow">if</span> (cidstring[i] == <span class="charliteral">&apos;C&apos;</span> || cidstring[i] == <span class="charliteral">&apos;#&apos;</span>)
<a name="l00232"></a>00232             <span class="keywordflow">break</span>;
<a name="l00233"></a>00233          <span class="keywordflow">if</span> (isdigit(cidstring[i]))
<a name="l00234"></a>00234             <a class="code" href="structnumber.html" title="Number structure.">number</a>[i-1] = cidstring[i];
<a name="l00235"></a>00235          <span class="keywordflow">else</span>
<a name="l00236"></a>00236             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Unknown CID digit &apos;%c&apos;\n&quot;</span>,
<a name="l00237"></a>00237                cidstring[i]);
<a name="l00238"></a>00238       }
<a name="l00239"></a>00239       <a class="code" href="structnumber.html" title="Number structure.">number</a>[i-1] = 0;
<a name="l00240"></a>00240    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isdigit(cidstring[0])) {
<a name="l00241"></a>00241       <span class="comment">/* It begins with a digit, so we parse it as a number and hope</span>
<a name="l00242"></a>00242 <span class="comment">       * for the best */</span>
<a name="l00243"></a>00243       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Couldn&apos;t detect start-character. CID &quot;</span>
<a name="l00244"></a>00244          <span class="stringliteral">&quot;parsing might be unreliable\n&quot;</span>);
<a name="l00245"></a>00245       <span class="keywordflow">for</span> (i = 0; i &lt; strlen(cidstring); i++) {
<a name="l00246"></a>00246          <span class="keywordflow">if</span> (isdigit(cidstring[i]))
<a name="l00247"></a>00247             <a class="code" href="structnumber.html" title="Number structure.">number</a>[i] = cidstring[i];
<a name="l00248"></a>00248          <span class="keywordflow">else</span>
<a name="l00249"></a>00249             <span class="keywordflow">break</span>;
<a name="l00250"></a>00250       }
<a name="l00251"></a>00251       <a class="code" href="structnumber.html" title="Number structure.">number</a>[i] = 0;
<a name="l00252"></a>00252    } <span class="keywordflow">else</span> {
<a name="l00253"></a>00253       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Unknown CID protocol, start digit &apos;%c&apos;\n&quot;</span>, cidstring[0]);
<a name="l00254"></a>00254       *flags = <a class="code" href="callerid_8h.html#a1290504d77210103d8553593671cc3c2">CID_UNKNOWN_NUMBER</a>;
<a name="l00255"></a>00255    }
<a name="l00256"></a>00256 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9c1767ffd4ca30651bcc241c16d1f071"></a><!-- doxytag: member="callerid.c::callerid_init" ref="a9c1767ffd4ca30651bcc241c16d1f071" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void callerid_init </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize stuff for inverse FFT. </p>
<p>CallerID Initialization. </p>

<p>Definition at line <a class="el" href="callerid_8c_source.html#l00112">112</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

<p>References <a class="el" href="callerid_8c_source.html#l00067">CALLERID_MARK</a>, <a class="el" href="callerid_8c_source.html#l00066">CALLERID_SPACE</a>, <a class="el" href="callerid_8c_source.html#l00069">CAS_FREQ1</a>, <a class="el" href="callerid_8c_source.html#l00070">CAS_FREQ2</a>, <a class="el" href="chan__h323_8c_source.html#l00144">cos</a>, and <a class="el" href="callerid_8c_source.html#l00068">SAS_FREQ</a>.</p>

<p>Referenced by <a class="el" href="asterisk_8c_source.html#l03095">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00113"></a>00113 {
<a name="l00114"></a>00114    <a class="code" href="callerid_8h.html#a271c1c132faed1b658e2fba40c41b868">cid_dr</a>[0] = <a class="code" href="chan__h323_8c.html#ae91dad65f553f7afebe4af507803bc7f">cos</a>(<a class="code" href="callerid_8c.html#ae22e91b5117c723dd02bfcc5e382bdd7">CALLERID_SPACE</a> * 2.0 * M_PI / 8000.0);
<a name="l00115"></a>00115    <a class="code" href="callerid_8h.html#ae28e7a746ab99a470a022ff2eba08a88">cid_di</a>[0] = sin(<a class="code" href="callerid_8c.html#ae22e91b5117c723dd02bfcc5e382bdd7">CALLERID_SPACE</a> * 2.0 * M_PI / 8000.0);
<a name="l00116"></a>00116    <a class="code" href="callerid_8h.html#a271c1c132faed1b658e2fba40c41b868">cid_dr</a>[1] = <a class="code" href="chan__h323_8c.html#ae91dad65f553f7afebe4af507803bc7f">cos</a>(<a class="code" href="callerid_8c.html#aa77a53334827b801fa3f5865c26ab6e0">CALLERID_MARK</a> * 2.0 * M_PI / 8000.0);
<a name="l00117"></a>00117    <a class="code" href="callerid_8h.html#ae28e7a746ab99a470a022ff2eba08a88">cid_di</a>[1] = sin(<a class="code" href="callerid_8c.html#aa77a53334827b801fa3f5865c26ab6e0">CALLERID_MARK</a> * 2.0 * M_PI / 8000.0);
<a name="l00118"></a>00118    <a class="code" href="callerid_8c.html#a37d6e99cad72f8884d9c575ac45badb9">sasdr</a> = <a class="code" href="chan__h323_8c.html#ae91dad65f553f7afebe4af507803bc7f">cos</a>(<a class="code" href="callerid_8c.html#a17433d3c64fa04166b2585cad952a436">SAS_FREQ</a> * 2.0 * M_PI / 8000.0);
<a name="l00119"></a>00119    <a class="code" href="callerid_8c.html#ae81f6b006f99cb8e2a8dca1b21eda4be">sasdi</a> = sin(<a class="code" href="callerid_8c.html#a17433d3c64fa04166b2585cad952a436">SAS_FREQ</a> * 2.0 * M_PI / 8000.0);
<a name="l00120"></a>00120    <a class="code" href="callerid_8c.html#acffc1e68a433ac6fd82d29d859805971">casdr1</a> = <a class="code" href="chan__h323_8c.html#ae91dad65f553f7afebe4af507803bc7f">cos</a>(<a class="code" href="callerid_8c.html#a8f2259fb59644af478715f091739ade8">CAS_FREQ1</a> * 2.0 * M_PI / 8000.0);
<a name="l00121"></a>00121    <a class="code" href="callerid_8c.html#a1fc9110f09a12aef8ba8a94479dc03c3">casdi1</a> = sin(<a class="code" href="callerid_8c.html#a8f2259fb59644af478715f091739ade8">CAS_FREQ1</a> * 2.0 * M_PI / 8000.0);
<a name="l00122"></a>00122    <a class="code" href="callerid_8c.html#acb906a5386153c9b5cb1d078fb033443">casdr2</a> = <a class="code" href="chan__h323_8c.html#ae91dad65f553f7afebe4af507803bc7f">cos</a>(<a class="code" href="callerid_8c.html#a69603be4978e9a144bef1b7e29630008">CAS_FREQ2</a> * 2.0 * M_PI / 8000.0);
<a name="l00123"></a>00123    <a class="code" href="callerid_8c.html#ac4647d3812e6efba4e068f86b2ab2574">casdi2</a> = sin(<a class="code" href="callerid_8c.html#a69603be4978e9a144bef1b7e29630008">CAS_FREQ2</a> * 2.0 * M_PI / 8000.0);
<a name="l00124"></a>00124 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae48529c2f2ea547ec29a2451b8fef8a2"></a><!-- doxytag: member="callerid.c::callerid_new" ref="ae48529c2f2ea547ec29a2451b8fef8a2" args="(int cid_signalling)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structcallerid__state.html">callerid_state</a>* callerid_new </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cid_signalling</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Create a callerID <a class="el" href="structstate.html">state</a> machine. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>cid_signalling</em>&nbsp;</td><td>Type of signalling in use</td></tr>
  </table>
  </dd>
</dl>
<p>This function returns a malloc'd instance of the <a class="el" href="structcallerid__state.html">callerid_state</a> data structure. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns a pointer to a malloc'd <a class="el" href="structcallerid__state.html">callerid_state</a> structure, or NULL on error. </dd></dl>

<p>Definition at line <a class="el" href="callerid_8c_source.html#l00126">126</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="fskmodem__float_8h_source.html#l00044">fsk_data::bw</a>, <a class="el" href="callerid_8h_source.html#l00052">CID_UNKNOWN_NAME</a>, <a class="el" href="callerid_8h_source.html#l00053">CID_UNKNOWN_NUMBER</a>, <a class="el" href="fskmodem__float_8h_source.html#l00051">fsk_data::f_mark_idx</a>, <a class="el" href="fskmodem__float_8h_source.html#l00052">fsk_data::f_space_idx</a>, <a class="el" href="callerid_8c_source.html#l00052">callerid_state::flags</a>, <a class="el" href="callerid_8c_source.html#l00043">callerid_state::fskd</a>, <a class="el" href="fskmodem__int_8c_source.html#l00193">fskmodem_init()</a>, <a class="el" href="fskmodem__int_8h_source.html#l00053">fsk_data::icont</a>, <a class="el" href="fskmodem__int_8h_source.html#l00046">fsk_data::instop</a>, <a class="el" href="fskmodem__int_8h_source.html#l00052">fsk_data::ispb</a>, <a class="el" href="fskmodem__float_8h_source.html#l00036">fsk_data::nbit</a>, <a class="el" href="fskmodem__float_8h_source.html#l00037">fsk_data::nstop</a>, <a class="el" href="fskmodem__int_8h_source.html#l00060">fsk_data::pllids</a>, <a class="el" href="fskmodem__int_8h_source.html#l00059">fsk_data::pllispb</a>, <a class="el" href="fskmodem__int_8h_source.html#l00061">fsk_data::pllispb2</a>, and <a class="el" href="fskmodem__float_8h_source.html#l00035">fsk_data::spb</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l08925">mwi_thread()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00127"></a>00127 {
<a name="l00128"></a>00128    <span class="keyword">struct </span><a class="code" href="structcallerid__state.html">callerid_state</a> *cid;
<a name="l00129"></a>00129 
<a name="l00130"></a>00130    <span class="keywordflow">if</span> ((cid = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*cid)))) {
<a name="l00131"></a>00131 <span class="preprocessor">#ifdef INTEGER_CALLERID</span>
<a name="l00132"></a>00132 <span class="preprocessor"></span>      cid-&gt;<a class="code" href="structcallerid__state.html#a89025e7d3ea985fe597c69e2d26c26ec">fskd</a>.<a class="code" href="structfsk__data.html#a00899d7313f0bcad57ed0a95a3dd6f97">ispb</a> = 7;           <span class="comment">/* 1200 baud */</span>   
<a name="l00133"></a>00133       <span class="comment">/* Set up for 1200 / 8000 freq *32 to allow ints */</span>
<a name="l00134"></a>00134       cid-&gt;<a class="code" href="structcallerid__state.html#a89025e7d3ea985fe597c69e2d26c26ec">fskd</a>.<a class="code" href="structfsk__data.html#a9272af2c74dc6b5e741fe38267b0a748">pllispb</a>  = (int)(8000 * 32  / 1200);
<a name="l00135"></a>00135       cid-&gt;<a class="code" href="structcallerid__state.html#a89025e7d3ea985fe597c69e2d26c26ec">fskd</a>.<a class="code" href="structfsk__data.html#aa619b3c011d659441b1d906ef66b58c6">pllids</a>   = cid-&gt;<a class="code" href="structcallerid__state.html#a89025e7d3ea985fe597c69e2d26c26ec">fskd</a>.<a class="code" href="structfsk__data.html#a9272af2c74dc6b5e741fe38267b0a748">pllispb</a>/32;
<a name="l00136"></a>00136       cid-&gt;<a class="code" href="structcallerid__state.html#a89025e7d3ea985fe597c69e2d26c26ec">fskd</a>.<a class="code" href="structfsk__data.html#a755ded0cbde6a60feae7ad6113b8057c">pllispb2</a> = cid-&gt;<a class="code" href="structcallerid__state.html#a89025e7d3ea985fe597c69e2d26c26ec">fskd</a>.<a class="code" href="structfsk__data.html#a9272af2c74dc6b5e741fe38267b0a748">pllispb</a>/2;
<a name="l00137"></a>00137       
<a name="l00138"></a>00138       cid-&gt;<a class="code" href="structcallerid__state.html#a89025e7d3ea985fe597c69e2d26c26ec">fskd</a>.<a class="code" href="structfsk__data.html#ae349656d51d3dfa03fd4ba13cf338e5a">icont</a> = 0;           <span class="comment">/* PLL REset */</span>
<a name="l00139"></a>00139       <span class="comment">/* cid-&gt;fskd.hdlc = 0; */</span>        <span class="comment">/* Async */</span>
<a name="l00140"></a>00140       cid-&gt;<a class="code" href="structcallerid__state.html#a89025e7d3ea985fe597c69e2d26c26ec">fskd</a>.<a class="code" href="structfsk__data.html#abe6ea42d56bb6b1cf335146f0877d7a9">nbit</a> = 8;              <span class="comment">/* 8 bits */</span>
<a name="l00141"></a>00141       cid-&gt;<a class="code" href="structcallerid__state.html#a89025e7d3ea985fe597c69e2d26c26ec">fskd</a>.<a class="code" href="structfsk__data.html#a8a334a19512bd0e0d3e322210ea86047">instop</a> = 1;         <span class="comment">/* 1 stop bit */</span>
<a name="l00142"></a>00142       <span class="comment">/* cid-&gt;fskd.paridad = 0; */</span>     <span class="comment">/* No parity */</span>
<a name="l00143"></a>00143       cid-&gt;<a class="code" href="structcallerid__state.html#a89025e7d3ea985fe597c69e2d26c26ec">fskd</a>.<a class="code" href="structfsk__data.html#a09f48e0ccba89e108e701fa07300d102">bw</a> = 1;                <span class="comment">/* Filter 800 Hz */</span>
<a name="l00144"></a>00144       <span class="keywordflow">if</span> (cid_signalling == 2) {       <span class="comment">/* v23 signalling */</span>
<a name="l00145"></a>00145          cid-&gt;<a class="code" href="structcallerid__state.html#a89025e7d3ea985fe597c69e2d26c26ec">fskd</a>.<a class="code" href="structfsk__data.html#a55000e3ae1765fc3bcafb33740be41a9">f_mark_idx</a>  = 4; <span class="comment">/* 1300 Hz */</span>
<a name="l00146"></a>00146          cid-&gt;<a class="code" href="structcallerid__state.html#a89025e7d3ea985fe597c69e2d26c26ec">fskd</a>.<a class="code" href="structfsk__data.html#aee1863152c02a253f722ffb0fda8251d">f_space_idx</a> = 5; <span class="comment">/* 2100 Hz */</span>
<a name="l00147"></a>00147       } <span class="keywordflow">else</span> {                         <span class="comment">/* Bell 202 signalling as default */</span>
<a name="l00148"></a>00148          cid-&gt;<a class="code" href="structcallerid__state.html#a89025e7d3ea985fe597c69e2d26c26ec">fskd</a>.<a class="code" href="structfsk__data.html#a55000e3ae1765fc3bcafb33740be41a9">f_mark_idx</a>  = 2; <span class="comment">/* 1200 Hz */</span>
<a name="l00149"></a>00149          cid-&gt;<a class="code" href="structcallerid__state.html#a89025e7d3ea985fe597c69e2d26c26ec">fskd</a>.<a class="code" href="structfsk__data.html#aee1863152c02a253f722ffb0fda8251d">f_space_idx</a> = 3; <span class="comment">/* 2200 Hz */</span>
<a name="l00150"></a>00150       }
<a name="l00151"></a>00151       <span class="comment">/* cid-&gt;fskd.pcola = 0; */</span>       <span class="comment">/* No clue */</span>
<a name="l00152"></a>00152       <span class="comment">/* cid-&gt;fskd.cont = 0.0; */</span>      <span class="comment">/* Digital PLL reset */</span>
<a name="l00153"></a>00153       <span class="comment">/* cid-&gt;fskd.x0 = 0.0; */</span>
<a name="l00154"></a>00154       <span class="comment">/* cid-&gt;fskd.state = 0; */</span>
<a name="l00155"></a>00155       cid-&gt;<a class="code" href="structcallerid__state.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> = <a class="code" href="callerid_8h.html#a30f6e6391969dd024122f1fc9203b273">CID_UNKNOWN_NAME</a> | <a class="code" href="callerid_8h.html#a1290504d77210103d8553593671cc3c2">CID_UNKNOWN_NUMBER</a>;
<a name="l00156"></a>00156       <span class="comment">/* cid-&gt;pos = 0; */</span>
<a name="l00157"></a>00157 
<a name="l00158"></a>00158       <a class="code" href="fskmodem__int_8h.html#a183afaf79ee92e26e8aacd129d9be3cb">fskmodem_init</a>(&amp;cid-&gt;<a class="code" href="structcallerid__state.html#a89025e7d3ea985fe597c69e2d26c26ec">fskd</a>);
<a name="l00159"></a>00159 <span class="preprocessor">#else</span>
<a name="l00160"></a>00160 <span class="preprocessor"></span>      cid-&gt;<a class="code" href="structcallerid__state.html#a89025e7d3ea985fe597c69e2d26c26ec">fskd</a>.<a class="code" href="structfsk__data.html#a47e2a2415d4ac2c2f1b3303b23dd35a6">spb</a> = 7.0;             <span class="comment">/* 1200 baud */</span>
<a name="l00161"></a>00161       <span class="comment">/* cid-&gt;fskd.hdlc = 0; */</span>        <span class="comment">/* Async */</span>
<a name="l00162"></a>00162       cid-&gt;<a class="code" href="structcallerid__state.html#a89025e7d3ea985fe597c69e2d26c26ec">fskd</a>.<a class="code" href="structfsk__data.html#abe6ea42d56bb6b1cf335146f0877d7a9">nbit</a> = 8;              <span class="comment">/* 8 bits */</span>
<a name="l00163"></a>00163       cid-&gt;<a class="code" href="structcallerid__state.html#a89025e7d3ea985fe597c69e2d26c26ec">fskd</a>.<a class="code" href="structfsk__data.html#a7161c14fc5f3607c82bc97762fca2262">nstop</a> = 1.0;           <span class="comment">/* 1 stop bit */</span>
<a name="l00164"></a>00164       <span class="comment">/* cid-&gt;fskd.paridad = 0; */</span>     <span class="comment">/* No parity */</span>
<a name="l00165"></a>00165       cid-&gt;<a class="code" href="structcallerid__state.html#a89025e7d3ea985fe597c69e2d26c26ec">fskd</a>.<a class="code" href="structfsk__data.html#a09f48e0ccba89e108e701fa07300d102">bw</a> = 1;                <span class="comment">/* Filter 800 Hz */</span>
<a name="l00166"></a>00166       <span class="keywordflow">if</span> (cid_signalling == 2) {       <span class="comment">/* v23 signalling */</span>
<a name="l00167"></a>00167          cid-&gt;<a class="code" href="structcallerid__state.html#a89025e7d3ea985fe597c69e2d26c26ec">fskd</a>.<a class="code" href="structfsk__data.html#a55000e3ae1765fc3bcafb33740be41a9">f_mark_idx</a> =  4; <span class="comment">/* 1300 Hz */</span>
<a name="l00168"></a>00168          cid-&gt;<a class="code" href="structcallerid__state.html#a89025e7d3ea985fe597c69e2d26c26ec">fskd</a>.<a class="code" href="structfsk__data.html#aee1863152c02a253f722ffb0fda8251d">f_space_idx</a> = 5; <span class="comment">/* 2100 Hz */</span>
<a name="l00169"></a>00169       } <span class="keywordflow">else</span> {                         <span class="comment">/* Bell 202 signalling as default */</span>
<a name="l00170"></a>00170          cid-&gt;<a class="code" href="structcallerid__state.html#a89025e7d3ea985fe597c69e2d26c26ec">fskd</a>.<a class="code" href="structfsk__data.html#a55000e3ae1765fc3bcafb33740be41a9">f_mark_idx</a> =  2; <span class="comment">/* 1200 Hz */</span>
<a name="l00171"></a>00171          cid-&gt;<a class="code" href="structcallerid__state.html#a89025e7d3ea985fe597c69e2d26c26ec">fskd</a>.<a class="code" href="structfsk__data.html#aee1863152c02a253f722ffb0fda8251d">f_space_idx</a> = 3; <span class="comment">/* 2200 Hz */</span>
<a name="l00172"></a>00172       }
<a name="l00173"></a>00173       <span class="comment">/* cid-&gt;fskd.pcola = 0; */</span>       <span class="comment">/* No clue */</span>
<a name="l00174"></a>00174       <span class="comment">/* cid-&gt;fskd.cont = 0.0; */</span>      <span class="comment">/* Digital PLL reset */</span>
<a name="l00175"></a>00175       <span class="comment">/* cid-&gt;fskd.x0 = 0.0; */</span>
<a name="l00176"></a>00176       <span class="comment">/* cid-&gt;fskd.state = 0; */</span>
<a name="l00177"></a>00177       cid-&gt;<a class="code" href="structcallerid__state.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> = <a class="code" href="callerid_8h.html#a30f6e6391969dd024122f1fc9203b273">CID_UNKNOWN_NAME</a> | <a class="code" href="callerid_8h.html#a1290504d77210103d8553593671cc3c2">CID_UNKNOWN_NUMBER</a>;
<a name="l00178"></a>00178       <span class="comment">/* cid-&gt;pos = 0; */</span>
<a name="l00179"></a>00179 <span class="preprocessor">#endif</span>
<a name="l00180"></a>00180 <span class="preprocessor"></span>   }
<a name="l00181"></a>00181 
<a name="l00182"></a>00182    <span class="keywordflow">return</span> cid;
<a name="l00183"></a>00183 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a08b47682e1d5e73068da4fa2344284a0"></a><!-- doxytag: member="callerid.c::gen_tone" ref="a08b47682e1d5e73068da4fa2344284a0" args="(unsigned char *buf, int len, int codec, float ddr1, float ddi1, float *cr1, float *ci1)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void gen_tone </td>
          <td>(</td>
          <td class="paramtype">unsigned char *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>codec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>ddr1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>ddi1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&nbsp;</td>
          <td class="paramname"> <em>cr1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&nbsp;</td>
          <td class="paramname"> <em>ci1</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="callerid_8c_source.html#l00096">96</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

<p>References <a class="el" href="callerid_8h_source.html#l00075">AST_LIN2X</a>.</p>

<p>Referenced by <a class="el" href="callerid_8c_source.html#l00258">ast_gen_cas()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00097"></a>00097 {
<a name="l00098"></a>00098    <span class="keywordtype">int</span> x;
<a name="l00099"></a>00099    <span class="keywordtype">float</span> t;
<a name="l00100"></a>00100    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>; x++) {
<a name="l00101"></a>00101       t = *cr1 * ddr1 - *ci1 * ddi1;
<a name="l00102"></a>00102       *ci1 = *cr1 * ddi1 + *ci1 * ddr1;
<a name="l00103"></a>00103       *cr1 = t;
<a name="l00104"></a>00104       t = 2.0 - (*cr1 * *cr1 + *ci1 * *ci1);
<a name="l00105"></a>00105       *cr1 *= t;
<a name="l00106"></a>00106       *ci1 *= t;  
<a name="l00107"></a>00107       <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[x] = <a class="code" href="callerid_8h.html#afec677970850757078d74b852cbcd0ad">AST_LIN2X</a>(*cr1 * 8192.0);
<a name="l00108"></a>00108    }
<a name="l00109"></a>00109 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0f5e4eef0eeba71986c4df9f4a9ada41"></a><!-- doxytag: member="callerid.c::gen_tones" ref="a0f5e4eef0eeba71986c4df9f4a9ada41" args="(unsigned char *buf, int len, int codec, float ddr1, float ddi1, float ddr2, float ddi2, float *cr1, float *ci1, float *cr2, float *ci2)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void gen_tones </td>
          <td>(</td>
          <td class="paramtype">unsigned char *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>codec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>ddr1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>ddi1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>ddr2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&nbsp;</td>
          <td class="paramname"> <em>ddi2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&nbsp;</td>
          <td class="paramname"> <em>cr1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&nbsp;</td>
          <td class="paramname"> <em>ci1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&nbsp;</td>
          <td class="paramname"> <em>cr2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&nbsp;</td>
          <td class="paramname"> <em>ci2</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline, static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="callerid_8c_source.html#l00074">74</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

<p>References <a class="el" href="callerid_8h_source.html#l00075">AST_LIN2X</a>.</p>

<p>Referenced by <a class="el" href="callerid_8c_source.html#l00258">ast_gen_cas()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00075"></a>00075 {
<a name="l00076"></a>00076    <span class="keywordtype">int</span> x;
<a name="l00077"></a>00077    <span class="keywordtype">float</span> t;
<a name="l00078"></a>00078    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>; x++) {
<a name="l00079"></a>00079       t = *cr1 * ddr1 - *ci1 * ddi1;
<a name="l00080"></a>00080       *ci1 = *cr1 * ddi1 + *ci1 * ddr1;
<a name="l00081"></a>00081       *cr1 = t;
<a name="l00082"></a>00082       t = 2.0 - (*cr1 * *cr1 + *ci1 * *ci1);
<a name="l00083"></a>00083       *cr1 *= t;
<a name="l00084"></a>00084       *ci1 *= t;  
<a name="l00085"></a>00085 
<a name="l00086"></a>00086       t = *cr2 * ddr2 - *ci2 * ddi2;
<a name="l00087"></a>00087       *ci2 = *cr2 * ddi2 + *ci2 * ddr2;
<a name="l00088"></a>00088       *cr2 = t;
<a name="l00089"></a>00089       t = 2.0 - (*cr2 * *cr2 + *ci2 * *ci2);
<a name="l00090"></a>00090       *cr2 *= t;
<a name="l00091"></a>00091       *ci2 *= t;  
<a name="l00092"></a>00092       <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[x] = <a class="code" href="callerid_8h.html#afec677970850757078d74b852cbcd0ad">AST_LIN2X</a>((*cr1 + *cr2) * 2048.0);
<a name="l00093"></a>00093    }
<a name="l00094"></a>00094 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8b49195fa90c382bda46882ffabfe0a2"></a><!-- doxytag: member="callerid.c::vmwi_generate" ref="a8b49195fa90c382bda46882ffabfe0a2" args="(unsigned char *buf, int active, int type, int codec, const char *name, const char *number, int flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int vmwi_generate </td>
          <td>(</td>
          <td class="paramtype">unsigned char *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>active</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>codec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>number</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Generate <a class="el" href="structmessage.html">message</a> waiting indicator. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>active</em>&nbsp;</td><td>The <a class="el" href="structmessage.html">message</a> indicator <a class="el" href="structstate.html">state</a> -- either 0 no messages in mailbox or 1 messages in mailbox </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>type</em>&nbsp;</td><td>Format of <a class="el" href="structmessage.html">message</a> (any of CID_MWI_TYPE_*) </td></tr>
  </table>
  </dd>
</dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="callerid_8h.html#a0976c857568032bd94e16c789bcfa213" title="Generates a CallerID FSK stream in ulaw format suitable for transmission.">callerid_generate()</a> for more info as it use the same encoding </dd></dl>
<dl class="version"><dt><b>Version:</b></dt><dd>1.6.1 changed mdmf parameter to type, added name, <a class="el" href="structnumber.html" title="Number structure.">number</a> and flags for caller id <a class="el" href="structmessage.html">message</a> generation </dd></dl>

<p>Definition at line <a class="el" href="callerid_8c_source.html#l00794">794</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

<p>References <a class="el" href="callerid_8c_source.html#l00723">callerid_genmsg()</a>, <a class="el" href="callerid_8h_source.html#l00071">CID_MWI_TYPE_MDMF</a>, <a class="el" href="callerid_8h_source.html#l00073">CID_MWI_TYPE_MDMF_FULL</a>, <a class="el" href="func__strings_8c_source.html#l00821">len()</a>, <a class="el" href="adsistub_8c_source.html#l00055">msg</a>, <a class="el" href="callerid_8h_source.html#l00253">PUT_BYTE</a>, <a class="el" href="callerid_8h_source.html#l00279">PUT_CLID</a>, and <a class="el" href="callerid_8h_source.html#l00264">PUT_CLID_MARKMS</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l09063">mwi_send_init()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00796"></a>00796 {
<a name="l00797"></a>00797    <span class="keywordtype">char</span> <a class="code" href="adsistub_8c.html#a0dee90db1d6eb30329bee1ae6cec036a">msg</a>[256];
<a name="l00798"></a>00798    <span class="keywordtype">int</span> <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> = 0;
<a name="l00799"></a>00799    <span class="keywordtype">int</span> sum;
<a name="l00800"></a>00800    <span class="keywordtype">int</span> x;
<a name="l00801"></a>00801    <span class="keywordtype">int</span> bytes = 0;
<a name="l00802"></a>00802    <span class="keywordtype">float</span> cr = 1.0;
<a name="l00803"></a>00803    <span class="keywordtype">float</span> ci = 0.0;
<a name="l00804"></a>00804    <span class="keywordtype">float</span> scont = 0.0;
<a name="l00805"></a>00805    
<a name="l00806"></a>00806    <span class="keywordflow">if</span> (<a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a> == <a class="code" href="callerid_8h.html#aacdaed00a37721d3ab3a861627af9222">CID_MWI_TYPE_MDMF_FULL</a>) {
<a name="l00807"></a>00807       <span class="comment">/* MDMF Message waiting with date, number, name and MWI parameter */</span>
<a name="l00808"></a>00808       msg[0] = 0x82;
<a name="l00809"></a>00809 
<a name="l00810"></a>00810       <span class="comment">/* put date, number info at the right place */</span>
<a name="l00811"></a>00811       len = <a class="code" href="callerid_8c.html#a315d5278c97c5c96bfe89c6d0e24fd42">callerid_genmsg</a>(msg+2, <span class="keyword">sizeof</span>(msg)-2, <a class="code" href="structnumber.html" title="Number structure.">number</a>, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <a class="code" href="structcallerid__state.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a>); 
<a name="l00812"></a>00812       
<a name="l00813"></a>00813       <span class="comment">/* length of MDMF CLI plus Message Waiting Structure */</span>
<a name="l00814"></a>00814       msg[1] = len+3;
<a name="l00815"></a>00815       
<a name="l00816"></a>00816       <span class="comment">/* Go to the position to write to */</span>
<a name="l00817"></a>00817       len = len+2;
<a name="l00818"></a>00818       
<a name="l00819"></a>00819       <span class="comment">/* &quot;Message Waiting Parameter&quot; */</span>
<a name="l00820"></a>00820       msg[len++] = 0x0b;
<a name="l00821"></a>00821       <span class="comment">/* Length of IE is one */</span>
<a name="l00822"></a>00822       msg[len++] = 1;
<a name="l00823"></a>00823       <span class="comment">/* Active or not */</span>
<a name="l00824"></a>00824       <span class="keywordflow">if</span> (active)
<a name="l00825"></a>00825          msg[len++] = 0xff;
<a name="l00826"></a>00826       <span class="keywordflow">else</span>
<a name="l00827"></a>00827          msg[len++] = 0x00;
<a name="l00828"></a>00828       
<a name="l00829"></a>00829    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a> == <a class="code" href="callerid_8h.html#a540c45fbdf71614d56e99cb84f5a2c00">CID_MWI_TYPE_MDMF</a>) {
<a name="l00830"></a>00830       <span class="comment">/* MDMF Message waiting only */</span>
<a name="l00831"></a>00831       <span class="comment">/* same as above except that the we only put MWI parameter */</span>
<a name="l00832"></a>00832       msg[len++] = 0x82;
<a name="l00833"></a>00833       <span class="comment">/* Length is 3 */</span>
<a name="l00834"></a>00834       msg[len++] = 3;
<a name="l00835"></a>00835       <span class="comment">/* IE is &quot;Message Waiting Parameter&quot; */</span>
<a name="l00836"></a>00836       msg[len++] = 0x0b;
<a name="l00837"></a>00837       <span class="comment">/* Length of IE is one */</span>
<a name="l00838"></a>00838       msg[len++] = 1;
<a name="l00839"></a>00839       <span class="comment">/* Active or not */</span>
<a name="l00840"></a>00840       <span class="keywordflow">if</span> (active)
<a name="l00841"></a>00841          msg[len++] = 0xff;
<a name="l00842"></a>00842       <span class="keywordflow">else</span>
<a name="l00843"></a>00843          msg[len++] = 0x00;
<a name="l00844"></a>00844    } <span class="keywordflow">else</span> {
<a name="l00845"></a>00845       <span class="comment">/* SDMF Message waiting */</span>
<a name="l00846"></a>00846       msg[len++] = 0x6;
<a name="l00847"></a>00847       <span class="comment">/* Length is 3 */</span>
<a name="l00848"></a>00848       msg[len++] = 3;
<a name="l00849"></a>00849       <span class="keywordflow">if</span> (active) {
<a name="l00850"></a>00850          msg[len++] = 0x42;
<a name="l00851"></a>00851          msg[len++] = 0x42;
<a name="l00852"></a>00852          msg[len++] = 0x42;
<a name="l00853"></a>00853       } <span class="keywordflow">else</span> {
<a name="l00854"></a>00854          msg[len++] = 0x6f;
<a name="l00855"></a>00855          msg[len++] = 0x6f;
<a name="l00856"></a>00856          msg[len++] = 0x6f;
<a name="l00857"></a>00857       }
<a name="l00858"></a>00858    }
<a name="l00859"></a>00859    sum = 0;
<a name="l00860"></a>00860    <span class="keywordflow">for</span> (x = 0; x &lt; len; x++)
<a name="l00861"></a>00861       sum += msg[x];
<a name="l00862"></a>00862    sum = (256 - (sum &amp; 255));
<a name="l00863"></a>00863    msg[len++] = sum;
<a name="l00864"></a>00864    <span class="comment">/* Wait a half a second */</span>
<a name="l00865"></a>00865    <span class="keywordflow">for</span> (x = 0; x &lt; 4000; x++)
<a name="l00866"></a>00866       <a class="code" href="callerid_8h.html#a32e0652e615f27aef195c93a80f756b9">PUT_BYTE</a>(0x7f);
<a name="l00867"></a>00867    <span class="comment">/* Transmit 30 0x55&apos;s (looks like a square wave) for channel seizure */</span>
<a name="l00868"></a>00868    <span class="keywordflow">for</span> (x = 0; x &lt; 30; x++)
<a name="l00869"></a>00869       <a class="code" href="callerid_8h.html#a02c7254b3ec648f815c15bd6f8cce39b">PUT_CLID</a>(0x55);
<a name="l00870"></a>00870    <span class="comment">/* Send 170ms of callerid marks */</span>
<a name="l00871"></a>00871    <span class="keywordflow">for</span> (x = 0; x &lt; 170; x++)
<a name="l00872"></a>00872       <a class="code" href="callerid_8h.html#a7ce7cf8db165eb44e64e704c3ced9774">PUT_CLID_MARKMS</a>;
<a name="l00873"></a>00873    <span class="keywordflow">for</span> (x = 0; x &lt; len; x++) {
<a name="l00874"></a>00874       <a class="code" href="callerid_8h.html#a02c7254b3ec648f815c15bd6f8cce39b">PUT_CLID</a>(msg[x]);
<a name="l00875"></a>00875    }
<a name="l00876"></a>00876    <span class="comment">/* Send 50 more ms of marks */</span>
<a name="l00877"></a>00877    <span class="keywordflow">for</span> (x = 0; x &lt; 50; x++)
<a name="l00878"></a>00878       <a class="code" href="callerid_8h.html#a7ce7cf8db165eb44e64e704c3ced9774">PUT_CLID_MARKMS</a>;
<a name="l00879"></a>00879    <span class="keywordflow">return</span> bytes;
<a name="l00880"></a>00880 }
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a1fc9110f09a12aef8ba8a94479dc03c3"></a><!-- doxytag: member="callerid.c::casdi1" ref="a1fc9110f09a12aef8ba8a94479dc03c3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float <a class="el" href="callerid_8c.html#a1fc9110f09a12aef8ba8a94479dc03c3">casdi1</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="callerid_8c_source.html#l00064">64</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

</div>
</div>
<a class="anchor" id="ac4647d3812e6efba4e068f86b2ab2574"></a><!-- doxytag: member="callerid.c::casdi2" ref="ac4647d3812e6efba4e068f86b2ab2574" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float <a class="el" href="callerid_8c.html#ac4647d3812e6efba4e068f86b2ab2574">casdi2</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="callerid_8c_source.html#l00064">64</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

</div>
</div>
<a class="anchor" id="acffc1e68a433ac6fd82d29d859805971"></a><!-- doxytag: member="callerid.c::casdr1" ref="acffc1e68a433ac6fd82d29d859805971" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float <a class="el" href="callerid_8c.html#acffc1e68a433ac6fd82d29d859805971">casdr1</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="callerid_8c_source.html#l00064">64</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

</div>
</div>
<a class="anchor" id="acb906a5386153c9b5cb1d078fb033443"></a><!-- doxytag: member="callerid.c::casdr2" ref="acb906a5386153c9b5cb1d078fb033443" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float <a class="el" href="callerid_8c.html#acb906a5386153c9b5cb1d078fb033443">casdr2</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="callerid_8c_source.html#l00064">64</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae28e7a746ab99a470a022ff2eba08a88"></a><!-- doxytag: member="callerid.c::cid_di" ref="ae28e7a746ab99a470a022ff2eba08a88" args="[4]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float <a class="el" href="callerid_8c.html#ae28e7a746ab99a470a022ff2eba08a88">cid_di</a>[4]</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="callerid_8c_source.html#l00061">61</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

<p>Referenced by <a class="el" href="callerid_8h_source.html#l00239">callerid_getcarrier()</a>.</p>

</div>
</div>
<a class="anchor" id="a271c1c132faed1b658e2fba40c41b868"></a><!-- doxytag: member="callerid.c::cid_dr" ref="a271c1c132faed1b658e2fba40c41b868" args="[4]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float <a class="el" href="callerid_8c.html#a271c1c132faed1b658e2fba40c41b868">cid_dr</a>[4]</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="callerid_8c_source.html#l00061">61</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

<p>Referenced by <a class="el" href="callerid_8h_source.html#l00239">callerid_getcarrier()</a>.</p>

</div>
</div>
<a class="anchor" id="af30a3f664009e7371f3dca3231f9fd8d"></a><!-- doxytag: member="callerid.c::clidsb" ref="af30a3f664009e7371f3dca3231f9fd8d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float <a class="el" href="callerid_8c.html#af30a3f664009e7371f3dca3231f9fd8d">clidsb</a> = 8000.0 / 1200.0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="callerid_8c_source.html#l00062">62</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

</div>
</div>
<a class="anchor" id="a68344fa88cf4e86b5079fd69a5c22d57"></a><!-- doxytag: member="callerid.c::description" ref="a68344fa88cf4e86b5079fd69a5c22d57" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="callerid_8c.html#a68344fa88cf4e86b5079fd69a5c22d57">description</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="callerid_8c_source.html#l01110">1110</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

<p>Referenced by <a class="el" href="res__agi_8c_source.html#l02996">handle_cli_agi_show()</a>, <a class="el" href="pbx_8c_source.html#l03095">handle_show_function()</a>, <a class="el" href="chan__jingle_8c_source.html#l00954">jingle_newcall()</a>, <a class="el" href="chan__jingle_8c_source.html#l01346">jingle_transmit_invite()</a>, and <a class="el" href="pbx_8c_source.html#l05186">print_app_docs()</a>.</p>

</div>
</div>
<a class="anchor" id="a8f8f80d37794cde9472343e4487ba3eb"></a><!-- doxytag: member="callerid.c::name" ref="a8f8f80d37794cde9472343e4487ba3eb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="callerid_8c_source.html#l01109">1109</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

</div>
</div>
<a class="anchor" id="a82a1d1b75a9c8c801ca76119815f11b9"></a><!-- doxytag: member="callerid.c::pres_types" ref="a82a1d1b75a9c8c801ca76119815f11b9" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct { ... }   <a class="el" href="callerid_8c.html#a82a1d1b75a9c8c801ca76119815f11b9">pres_types</a>[]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Translation table for Caller ID Presentation settings. </p>

<p>Referenced by <a class="el" href="callerid_8c_source.html#l01147">ast_describe_caller_presentation()</a>, <a class="el" href="callerid_8c_source.html#l01163">ast_named_caller_presentation()</a>, and <a class="el" href="callerid_8c_source.html#l01128">ast_parse_caller_presentation()</a>.</p>

</div>
</div>
<a class="anchor" id="ae81f6b006f99cb8e2a8dca1b21eda4be"></a><!-- doxytag: member="callerid.c::sasdi" ref="ae81f6b006f99cb8e2a8dca1b21eda4be" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float <a class="el" href="callerid_8c.html#ae81f6b006f99cb8e2a8dca1b21eda4be">sasdi</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="callerid_8c_source.html#l00063">63</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

</div>
</div>
<a class="anchor" id="a37d6e99cad72f8884d9c575ac45badb9"></a><!-- doxytag: member="callerid.c::sasdr" ref="a37d6e99cad72f8884d9c575ac45badb9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float <a class="el" href="callerid_8c.html#a37d6e99cad72f8884d9c575ac45badb9">sasdr</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="callerid_8c_source.html#l00063">63</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

</div>
</div>
<a class="anchor" id="aa0ccb5ee6d882ee3605ff47745c6467b"></a><!-- doxytag: member="callerid.c::val" ref="aa0ccb5ee6d882ee3605ff47745c6467b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="structval.html">val</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="callerid_8c_source.html#l01108">1108</a> of file <a class="el" href="callerid_8c_source.html">callerid.c</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:19:42 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
