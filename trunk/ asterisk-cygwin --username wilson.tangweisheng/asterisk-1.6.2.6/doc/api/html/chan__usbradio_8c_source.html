<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:18:37 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_0ca6ff3bf6b340411b2c6edd15b1a34d.html">channels</a>
  </div>
</div>
<div class="contents">
<h1>chan_usbradio.c</h1><a href="chan__usbradio_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a><a class="code" href="chan__usbradio_8c.html#ab182d8a1f49d22338790239a6446929d">00001</a> <span class="preprocessor">#define  NEW_ASTERISK</span>
<a name="l00002"></a>00002 <span class="preprocessor"></span><span class="comment">/*</span>
<a name="l00003"></a>00003 <span class="comment"> * Asterisk -- An open source telephony toolkit.</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> * Copyright (C) 1999 - 2005, Digium, Inc.</span>
<a name="l00006"></a>00006 <span class="comment"> * Copyright (C) 2007 - 2008, Jim Dixon</span>
<a name="l00007"></a>00007 <span class="comment"> *</span>
<a name="l00008"></a>00008 <span class="comment"> * Jim Dixon, WB6NIL &lt;jim@lambdatel.com&gt;</span>
<a name="l00009"></a>00009 <span class="comment"> * Steve Henke, W9SH  &lt;w9sh@arrl.net&gt;</span>
<a name="l00010"></a>00010 <span class="comment"> * Based upon work by Mark Spencer &lt;markster@digium.com&gt; and Luigi Rizzo</span>
<a name="l00011"></a>00011 <span class="comment"> *</span>
<a name="l00012"></a>00012 <span class="comment"> * See http://www.asterisk.org for more information about</span>
<a name="l00013"></a>00013 <span class="comment"> * the Asterisk project. Please do not directly contact</span>
<a name="l00014"></a>00014 <span class="comment"> * any of the maintainers of this project for assistance;</span>
<a name="l00015"></a>00015 <span class="comment"> * the project provides a web site, mailing lists and IRC</span>
<a name="l00016"></a>00016 <span class="comment"> * channels for your use.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * This program is free software, distributed under the terms of</span>
<a name="l00019"></a>00019 <span class="comment"> * the GNU General Public License Version 2. See the LICENSE file</span>
<a name="l00020"></a>00020 <span class="comment">  * at the top of the source tree.</span>
<a name="l00021"></a>00021 <span class="comment"> */</span>
<a name="l00022"></a>00022 <span class="comment"></span>
<a name="l00023"></a>00023 <span class="comment">/*! \file</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> * \brief Channel driver for CM108 USB Cards with Radio Interface</span>
<a name="l00026"></a>00026 <span class="comment"> *</span>
<a name="l00027"></a>00027 <span class="comment"> * \author Jim Dixon  &lt;jim@lambdatel.com&gt;</span>
<a name="l00028"></a>00028 <span class="comment"> * \author Steve Henke  &lt;w9sh@arrl.net&gt;</span>
<a name="l00029"></a>00029 <span class="comment"> *</span>
<a name="l00030"></a>00030 <span class="comment"> * \par See also</span>
<a name="l00031"></a>00031 <span class="comment"> * \arg \ref Config_usbradio</span>
<a name="l00032"></a>00032 <span class="comment"> *</span>
<a name="l00033"></a>00033 <span class="comment"> * \ingroup channel_drivers</span>
<a name="l00034"></a>00034 <span class="comment"> */</span>
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="comment">/*** MODULEINFO</span>
<a name="l00037"></a>00037 <span class="comment">   &lt;depend&gt;oss&lt;/depend&gt;</span>
<a name="l00038"></a>00038 <span class="comment">   &lt;depend&gt;usb&lt;/depend&gt;</span>
<a name="l00039"></a>00039 <span class="comment">   &lt;defaultenabled&gt;no&lt;/defaultenabled&gt;</span>
<a name="l00040"></a>00040 <span class="comment"> ***/</span>
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 <span class="comment">/*** MAKEOPTS</span>
<a name="l00043"></a>00043 <span class="comment">&lt;category name=&quot;MENUSELECT_CFLAGS&quot; displayname=&quot;Compiler Flags&quot; positive_output=&quot;yes&quot; remove_on_change=&quot;.lastclean&quot;&gt;</span>
<a name="l00044"></a>00044 <span class="comment">   &lt;member name=&quot;RADIO_RTX&quot; displayname=&quot;Build RTX/DTX Radio Programming&quot;&gt;</span>
<a name="l00045"></a>00045 <span class="comment">      &lt;defaultenabled&gt;no&lt;/defaultenabled&gt;</span>
<a name="l00046"></a>00046 <span class="comment">      &lt;depend&gt;chan_usbradio&lt;/depend&gt;</span>
<a name="l00047"></a>00047 <span class="comment">   &lt;/member&gt;</span>
<a name="l00048"></a>00048 <span class="comment">   &lt;member name=&quot;RADIO_XPMRX&quot; displayname=&quot;Build Experimental Radio Protocols&quot;&gt;</span>
<a name="l00049"></a>00049 <span class="comment">      &lt;defaultenabled&gt;no&lt;/defaultenabled&gt;</span>
<a name="l00050"></a>00050 <span class="comment">      &lt;depend&gt;chan_usbradio&lt;/depend&gt;</span>
<a name="l00051"></a>00051 <span class="comment">   &lt;/member&gt;</span>
<a name="l00052"></a>00052 <span class="comment">&lt;/category&gt;</span>
<a name="l00053"></a>00053 <span class="comment"> ***/</span>
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 <span class="comment">// 20070918 1600 EDT sph@xelatec.com changing to rx driven streams</span>
<a name="l00056"></a>00056 
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="asterisk_8h.html" title="Asterisk main include file. File version handling, generic pbx functions.">asterisk.h</a>&quot;</span>
<a name="l00058"></a>00058 
<a name="l00059"></a>00059 <a class="code" href="asterisk_8h.html#ab0390be60f8c539a2662df2faf9985c7" title="Register/unregister a source code file with the core.">ASTERISK_FILE_VERSION</a>(__FILE__, <span class="stringliteral">&quot;$Revision: 249895 $&quot;</span>)
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00062"></a>00062 <span class="preprocessor"></span><span class="preprocessor">#include &lt;ctype.h&gt;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
<a name="l00066"></a>00066 <span class="preprocessor">#ifdef HAVE_SYS_IO_H</span>
<a name="l00067"></a>00067 <span class="preprocessor"></span><span class="preprocessor">#include &lt;sys/io.h&gt;</span>
<a name="l00068"></a>00068 <span class="preprocessor">#endif</span>
<a name="l00069"></a>00069 <span class="preprocessor"></span><span class="preprocessor">#include &lt;sys/ioctl.h&gt;</span>
<a name="l00070"></a>00070 <span class="preprocessor">#include &lt;fcntl.h&gt;</span>
<a name="l00071"></a>00071 <span class="preprocessor">#include &lt;sys/time.h&gt;</span>
<a name="l00072"></a>00072 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00073"></a>00073 <span class="preprocessor">#include &lt;errno.h&gt;</span>
<a name="l00074"></a>00074 <span class="preprocessor">#include &lt;usb.h&gt;</span>
<a name="l00075"></a>00075 <span class="preprocessor">#include &lt;alsa/asoundlib.h&gt;</span>
<a name="l00076"></a>00076 
<a name="l00077"></a>00077 <span class="comment">//#define HAVE_XPMRX          1</span>
<a name="l00078"></a>00078 <span class="preprocessor">#ifdef RADIO_XPMRX</span>
<a name="l00079"></a>00079 <span class="preprocessor"></span><span class="preprocessor">#define HAVE_XPMRX            1</span>
<a name="l00080"></a>00080 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00081"></a>00081 <span class="preprocessor"></span>
<a name="l00082"></a><a class="code" href="chan__usbradio_8c.html#a47cae2e3a19f5a07b75d285f8db61592">00082</a> <span class="preprocessor">#define CHAN_USBRADIO           1</span>
<a name="l00083"></a><a class="code" href="chan__usbradio_8c.html#a2ae1aa78c091791f02cb87444379561d">00083</a> <span class="preprocessor"></span><span class="preprocessor">#define DEBUG_USBRADIO          0   </span>
<a name="l00084"></a><a class="code" href="chan__usbradio_8c.html#a7e7d8e51cb84bf37ec505930ffb3a534">00084</a> <span class="preprocessor"></span><span class="preprocessor">#define DEBUG_CAPTURES        1</span>
<a name="l00085"></a><a class="code" href="chan__usbradio_8c.html#a925ba77480e59df1933d3b871a2e3c19">00085</a> <span class="preprocessor"></span><span class="preprocessor">#define DEBUG_CAP_RX_OUT      0        </span>
<a name="l00086"></a><a class="code" href="chan__usbradio_8c.html#a2800dfd9cfd91eb3bb9c7245f8efc544">00086</a> <span class="preprocessor"></span><span class="preprocessor">#define DEBUG_CAP_TX_OUT       0       </span>
<a name="l00087"></a><a class="code" href="chan__usbradio_8c.html#a2ada0acd681d2b5c269caadde660802e">00087</a> <span class="preprocessor"></span><span class="preprocessor">#define DEBUG_FILETEST        0         </span>
<a name="l00088"></a>00088 <span class="preprocessor"></span>
<a name="l00089"></a><a class="code" href="chan__usbradio_8c.html#a474f3f93f52d6f6b47704bba67b4c7b0">00089</a> <span class="preprocessor">#define RX_CAP_RAW_FILE       &quot;/tmp/rx_cap_in.pcm&quot;</span>
<a name="l00090"></a><a class="code" href="chan__usbradio_8c.html#a562d1f506b1890e3762ea5f6e135e4cf">00090</a> <span class="preprocessor"></span><span class="preprocessor">#define RX_CAP_TRACE_FILE     &quot;/tmp/rx_trace.pcm&quot;</span>
<a name="l00091"></a><a class="code" href="chan__usbradio_8c.html#a5ae02857e8ff8c543c3e78aad09aceba">00091</a> <span class="preprocessor"></span><span class="preprocessor">#define RX_CAP_OUT_FILE       &quot;/tmp/rx_cap_out.pcm&quot;</span>
<a name="l00092"></a>00092 <span class="preprocessor"></span>
<a name="l00093"></a><a class="code" href="chan__usbradio_8c.html#ab9127b328544e9ace5c706d2389b4e31">00093</a> <span class="preprocessor">#define TX_CAP_RAW_FILE       &quot;/tmp/tx_cap_in.pcm&quot;</span>
<a name="l00094"></a><a class="code" href="chan__usbradio_8c.html#ad68b53d74eb2b7d824a5138673ee33e5">00094</a> <span class="preprocessor"></span><span class="preprocessor">#define TX_CAP_TRACE_FILE     &quot;/tmp/tx_trace.pcm&quot;</span>
<a name="l00095"></a><a class="code" href="chan__usbradio_8c.html#afda5434c2b0af3f82ddf8fda79f5d4ef">00095</a> <span class="preprocessor"></span><span class="preprocessor">#define TX_CAP_OUT_FILE       &quot;/tmp/tx_cap_out.pcm&quot;</span>
<a name="l00096"></a>00096 <span class="preprocessor"></span>
<a name="l00097"></a><a class="code" href="chan__usbradio_8c.html#a6aa4920a9b490eaca041cb984eba5dab">00097</a> <span class="preprocessor">#define  MIXER_PARAM_MIC_PLAYBACK_SW &quot;Mic Playback Switch&quot;</span>
<a name="l00098"></a><a class="code" href="chan__usbradio_8c.html#a2b13370bbcd89b6232752305f16af2c6">00098</a> <span class="preprocessor"></span><span class="preprocessor">#define MIXER_PARAM_MIC_PLAYBACK_VOL &quot;Mic Playback Volume&quot;</span>
<a name="l00099"></a><a class="code" href="chan__usbradio_8c.html#abfc3705afb95d69707788ab111be693e">00099</a> <span class="preprocessor"></span><span class="preprocessor">#define  MIXER_PARAM_MIC_CAPTURE_SW &quot;Mic Capture Switch&quot;</span>
<a name="l00100"></a><a class="code" href="chan__usbradio_8c.html#acdbe8da16d20178447b63f536bf8b9f9">00100</a> <span class="preprocessor"></span><span class="preprocessor">#define  MIXER_PARAM_MIC_CAPTURE_VOL &quot;Mic Capture Volume&quot;</span>
<a name="l00101"></a><a class="code" href="chan__usbradio_8c.html#a99390fc3e67665c7b237060a74bff67c">00101</a> <span class="preprocessor"></span><span class="preprocessor">#define  MIXER_PARAM_MIC_BOOST &quot;Auto Gain Control&quot;</span>
<a name="l00102"></a><a class="code" href="chan__usbradio_8c.html#a48aae02ce5d047e71d09ae22a396c756">00102</a> <span class="preprocessor"></span><span class="preprocessor">#define  MIXER_PARAM_SPKR_PLAYBACK_SW &quot;Speaker Playback Switch&quot;</span>
<a name="l00103"></a><a class="code" href="chan__usbradio_8c.html#ad1cc3a63000c040db5c5e20836d039ae">00103</a> <span class="preprocessor"></span><span class="preprocessor">#define  MIXER_PARAM_SPKR_PLAYBACK_VOL &quot;Speaker Playback Volume&quot;</span>
<a name="l00104"></a>00104 <span class="preprocessor"></span>
<a name="l00105"></a><a class="code" href="chan__usbradio_8c.html#abc0b3b46c37f2eac1a2bf215b0ec9f43">00105</a> <span class="preprocessor">#define  DELIMCHR &apos;,&apos;</span>
<a name="l00106"></a><a class="code" href="chan__usbradio_8c.html#a08e7363bdfe2e8a2d3d03fbf95bdebda">00106</a> <span class="preprocessor"></span><span class="preprocessor">#define  QUOTECHR 34</span>
<a name="l00107"></a>00107 <span class="preprocessor"></span>
<a name="l00108"></a><a class="code" href="chan__usbradio_8c.html#ad4a78a85664f81bdf5fc49fb307b4e6f">00108</a> <span class="preprocessor">#define  READERR_THRESHOLD 50</span>
<a name="l00109"></a>00109 <span class="preprocessor"></span>
<a name="l00110"></a>00110 <span class="preprocessor">#include &quot;./xpmr/xpmr.h&quot;</span>
<a name="l00111"></a>00111 <span class="preprocessor">#ifdef HAVE_XPMRX</span>
<a name="l00112"></a>00112 <span class="preprocessor"></span><span class="preprocessor">#include &quot;./xpmrx/xpmrx.h&quot;</span>
<a name="l00113"></a>00113 <span class="preprocessor">#include &quot;./xpmrx/bitweight.h&quot;</span>
<a name="l00114"></a>00114 <span class="preprocessor">#endif</span>
<a name="l00115"></a>00115 <span class="preprocessor"></span>
<a name="l00116"></a>00116 <span class="preprocessor">#if 0</span>
<a name="l00117"></a>00117 <span class="preprocessor"></span><span class="preprocessor">#define traceusb1(a) {printf a;}</span>
<a name="l00118"></a>00118 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00119"></a><a class="code" href="chan__usbradio_8c.html#ab8b71b2cbec55b695df88902fb911db3">00119</a> <span class="preprocessor"></span><span class="preprocessor">#define traceusb1(a)</span>
<a name="l00120"></a>00120 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00121"></a>00121 <span class="preprocessor"></span>
<a name="l00122"></a>00122 <span class="preprocessor">#if 0</span>
<a name="l00123"></a>00123 <span class="preprocessor"></span><span class="preprocessor">#define traceusb2(a) {printf a;}</span>
<a name="l00124"></a>00124 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00125"></a><a class="code" href="chan__usbradio_8c.html#ab7c6d9dd18ab648a0a772a28ee364c9f">00125</a> <span class="preprocessor"></span><span class="preprocessor">#define traceusb2(a)</span>
<a name="l00126"></a>00126 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00127"></a>00127 <span class="preprocessor"></span>
<a name="l00128"></a>00128 <span class="preprocessor">#ifdef __linux</span>
<a name="l00129"></a>00129 <span class="preprocessor"></span><span class="preprocessor">#include &lt;linux/soundcard.h&gt;</span>
<a name="l00130"></a>00130 <span class="preprocessor">#elif defined(__FreeBSD__)</span>
<a name="l00131"></a>00131 <span class="preprocessor"></span><span class="preprocessor">#include &lt;sys/soundcard.h&gt;</span>
<a name="l00132"></a>00132 <span class="preprocessor">#else</span>
<a name="l00133"></a>00133 <span class="preprocessor"></span><span class="preprocessor">#include &lt;soundcard.h&gt;</span>
<a name="l00134"></a>00134 <span class="preprocessor">#endif</span>
<a name="l00135"></a>00135 <span class="preprocessor"></span>
<a name="l00136"></a>00136 <span class="preprocessor">#include &quot;<a class="code" href="lock_8h.html" title="Asterisk locking-related definitions:ast_mutext_t, ast_rwlock_t and related functions;atomic...">asterisk/lock.h</a>&quot;</span>
<a name="l00137"></a>00137 <span class="preprocessor">#include &quot;<a class="code" href="frame_8h.html" title="Asterisk internal frame definitions.">asterisk/frame.h</a>&quot;</span>
<a name="l00138"></a>00138 <span class="preprocessor">#include &quot;<a class="code" href="logger_8h.html" title="Support for logging to various files, console and syslog Configuration in file logger...">asterisk/logger.h</a>&quot;</span>
<a name="l00139"></a>00139 <span class="preprocessor">#include &quot;<a class="code" href="callerid_8h.html" title="CallerID (and other GR30) management and generation Includes code and algorithms...">asterisk/callerid.h</a>&quot;</span>
<a name="l00140"></a>00140 <span class="preprocessor">#include &quot;<a class="code" href="channel_8h.html" title="General Asterisk PBX channel definitions.">asterisk/channel.h</a>&quot;</span>
<a name="l00141"></a>00141 <span class="preprocessor">#include &quot;<a class="code" href="module_8h.html" title="Asterisk module definitions.">asterisk/module.h</a>&quot;</span>
<a name="l00142"></a>00142 <span class="preprocessor">#include &quot;<a class="code" href="options_8h.html" title="Options provided by main asterisk program.">asterisk/options.h</a>&quot;</span>
<a name="l00143"></a>00143 <span class="preprocessor">#include &quot;<a class="code" href="pbx_8h.html" title="Core PBX routines and definitions.">asterisk/pbx.h</a>&quot;</span>
<a name="l00144"></a>00144 <span class="preprocessor">#include &quot;<a class="code" href="config_8h.html" title="Configuration File Parser.">asterisk/config.h</a>&quot;</span>
<a name="l00145"></a>00145 <span class="preprocessor">#include &quot;<a class="code" href="cli_8h.html" title="Standard Command Line Interface.">asterisk/cli.h</a>&quot;</span>
<a name="l00146"></a>00146 <span class="preprocessor">#include &quot;<a class="code" href="utils_8h.html" title="Utility functions.">asterisk/utils.h</a>&quot;</span>
<a name="l00147"></a>00147 <span class="preprocessor">#include &quot;<a class="code" href="causes_8h.html" title="Internal Asterisk hangup causes.">asterisk/causes.h</a>&quot;</span>
<a name="l00148"></a>00148 <span class="preprocessor">#include &quot;<a class="code" href="endian_8h.html" title="Asterisk architecture endianess compatibility definitions.">asterisk/endian.h</a>&quot;</span>
<a name="l00149"></a>00149 <span class="preprocessor">#include &quot;<a class="code" href="stringfields_8h.html" title="String fields in structures.">asterisk/stringfields.h</a>&quot;</span>
<a name="l00150"></a>00150 <span class="preprocessor">#include &quot;<a class="code" href="abstract__jb_8h.html" title="Common implementation-independent jitterbuffer stuff.">asterisk/abstract_jb.h</a>&quot;</span>
<a name="l00151"></a>00151 <span class="preprocessor">#include &quot;<a class="code" href="musiconhold_8h.html" title="Music on hold handling.">asterisk/musiconhold.h</a>&quot;</span>
<a name="l00152"></a>00152 <span class="preprocessor">#include &quot;<a class="code" href="dsp_8h.html" title="Convenient Signal Processing routines.">asterisk/dsp.h</a>&quot;</span>
<a name="l00153"></a>00153 
<a name="l00154"></a>00154 <span class="preprocessor">#ifndef  NEW_ASTERISK</span>
<a name="l00155"></a>00155 <span class="preprocessor"></span>
<a name="l00156"></a>00156 <span class="comment">/* ringtones we use */</span>
<a name="l00157"></a>00157 <span class="preprocessor">#include &quot;busy.h&quot;</span>
<a name="l00158"></a>00158 <span class="preprocessor">#include &quot;ringtone.h&quot;</span>
<a name="l00159"></a>00159 <span class="preprocessor">#include &quot;ring10.h&quot;</span>
<a name="l00160"></a>00160 <span class="preprocessor">#include &quot;answer.h&quot;</span>
<a name="l00161"></a>00161 
<a name="l00162"></a>00162 <span class="preprocessor">#endif</span>
<a name="l00163"></a>00163 <span class="preprocessor"></span>
<a name="l00164"></a><a class="code" href="chan__usbradio_8c.html#a7fe311f41d061c3de16725515151850b">00164</a> <span class="preprocessor">#define C108_VENDOR_ID     0x0d8c</span>
<a name="l00165"></a><a class="code" href="chan__usbradio_8c.html#abda026ecd94755bcc0907bc6c5e41c9d">00165</a> <span class="preprocessor"></span><span class="preprocessor">#define C108_PRODUCT_ID    0x000c</span>
<a name="l00166"></a><a class="code" href="chan__usbradio_8c.html#a82855a6adac1c229cd7d6e7d89365776">00166</a> <span class="preprocessor"></span><span class="preprocessor">#define C108_HID_INTERFACE 3</span>
<a name="l00167"></a>00167 <span class="preprocessor"></span>
<a name="l00168"></a><a class="code" href="chan__usbradio_8c.html#a282d010f33df3170bcca5bf3e42afd71">00168</a> <span class="preprocessor">#define HID_REPORT_GET     0x01</span>
<a name="l00169"></a><a class="code" href="chan__usbradio_8c.html#a4d4af2232afa1d37615004b9821682ab">00169</a> <span class="preprocessor"></span><span class="preprocessor">#define HID_REPORT_SET     0x09</span>
<a name="l00170"></a>00170 <span class="preprocessor"></span>
<a name="l00171"></a><a class="code" href="chan__usbradio_8c.html#a2991b100ecafed2278c8a215a148c1cf">00171</a> <span class="preprocessor">#define HID_RT_INPUT    0x01</span>
<a name="l00172"></a><a class="code" href="chan__usbradio_8c.html#a21d0261b1d98b389cf94b73455d8e3f0">00172</a> <span class="preprocessor"></span><span class="preprocessor">#define HID_RT_OUTPUT      0x02</span>
<a name="l00173"></a>00173 <span class="preprocessor"></span>
<a name="l00174"></a><a class="code" href="chan__usbradio_8c.html#ab5c3d2d745d2a94c1f9937a440aa2ae9">00174</a> <span class="preprocessor">#define  EEPROM_START_ADDR 6</span>
<a name="l00175"></a><a class="code" href="chan__usbradio_8c.html#a234e4f1294ec845752e1cb4b1dcd7add">00175</a> <span class="preprocessor"></span><span class="preprocessor">#define  EEPROM_END_ADDR      63</span>
<a name="l00176"></a><a class="code" href="chan__usbradio_8c.html#a35ad18646ea93da91a36062f911d949a">00176</a> <span class="preprocessor"></span><span class="preprocessor">#define  EEPROM_PHYSICAL_LEN  64</span>
<a name="l00177"></a><a class="code" href="chan__usbradio_8c.html#ab5435168fb1ad8a2a0166dd9a3187674">00177</a> <span class="preprocessor"></span><span class="preprocessor">#define EEPROM_TEST_ADDR   EEPROM_END_ADDR</span>
<a name="l00178"></a><a class="code" href="chan__usbradio_8c.html#a2527414458decfaeb83335c0a1b7f83e">00178</a> <span class="preprocessor"></span><span class="preprocessor">#define  EEPROM_MAGIC_ADDR 6</span>
<a name="l00179"></a><a class="code" href="chan__usbradio_8c.html#aea81e3080d5a5edd34913f1963b5a790">00179</a> <span class="preprocessor"></span><span class="preprocessor">#define  EEPROM_MAGIC      34329</span>
<a name="l00180"></a><a class="code" href="chan__usbradio_8c.html#ace660bf98fac4830b51d09c5a5f5cf3d">00180</a> <span class="preprocessor"></span><span class="preprocessor">#define  EEPROM_CS_ADDR    62</span>
<a name="l00181"></a><a class="code" href="chan__usbradio_8c.html#ad366055db4b38c2d08fa4773bec2d17a">00181</a> <span class="preprocessor"></span><span class="preprocessor">#define  EEPROM_RXMIXERSET 8</span>
<a name="l00182"></a><a class="code" href="chan__usbradio_8c.html#a93f87606ce71cf06fc9469404bcd2f8e">00182</a> <span class="preprocessor"></span><span class="preprocessor">#define  EEPROM_TXMIXASET  9</span>
<a name="l00183"></a><a class="code" href="chan__usbradio_8c.html#a439cb7d09b0d38aa956758d174935074">00183</a> <span class="preprocessor"></span><span class="preprocessor">#define  EEPROM_TXMIXBSET  10</span>
<a name="l00184"></a><a class="code" href="chan__usbradio_8c.html#a7d5f33700253c5914fac418bde3482b7">00184</a> <span class="preprocessor"></span><span class="preprocessor">#define  EEPROM_RXVOICEADJ 11</span>
<a name="l00185"></a><a class="code" href="chan__usbradio_8c.html#a15e2375389dc1811e52506c4cea0fd6d">00185</a> <span class="preprocessor"></span><span class="preprocessor">#define  EEPROM_RXCTCSSADJ 13</span>
<a name="l00186"></a><a class="code" href="chan__usbradio_8c.html#a23c8442c744ec0f73f5d825fa470c704">00186</a> <span class="preprocessor"></span><span class="preprocessor">#define  EEPROM_TXCTCSSADJ 15</span>
<a name="l00187"></a><a class="code" href="chan__usbradio_8c.html#ae4b084ebdee2a0b600e62d67a71f3f94">00187</a> <span class="preprocessor"></span><span class="preprocessor">#define  EEPROM_RXSQUELCHADJ  16</span>
<a name="l00188"></a>00188 <span class="preprocessor"></span><span class="comment"></span>
<a name="l00189"></a>00189 <span class="comment">/*! Global jitterbuffer configuration - by default, jb is disabled */</span>
<a name="l00190"></a><a class="code" href="chan__usbradio_8c.html#a2d8d5920e90ccbad7832926becdadb29">00190</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structast__jb__conf.html" title="General jitterbuffer configuration.">ast_jb_conf</a> <a class="code" href="chan__usbradio_8c.html#a2d8d5920e90ccbad7832926becdadb29">default_jbconf</a> =
<a name="l00191"></a>00191 {
<a name="l00192"></a>00192    .<a class="code" href="structast__jb__conf.html#ac92588540e8c1d014a08cd8a45462b19" title="Combination of the AST_JB_ENABLED, AST_JB_FORCED and AST_JB_LOG flags.">flags</a> = 0,
<a name="l00193"></a>00193    .max_size = -1,
<a name="l00194"></a>00194    .resync_threshold = -1,
<a name="l00195"></a>00195    .impl = <span class="stringliteral">&quot;&quot;</span>,
<a name="l00196"></a>00196    .target_extra = -1,
<a name="l00197"></a>00197 };
<a name="l00198"></a><a class="code" href="chan__usbradio_8c.html#abaabcb7f4349cc632dde3af5c6a5e1bd">00198</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structast__jb__conf.html" title="General jitterbuffer configuration.">ast_jb_conf</a> <a class="code" href="chan__usbradio_8c.html#abaabcb7f4349cc632dde3af5c6a5e1bd">global_jbconf</a>;
<a name="l00199"></a>00199 
<a name="l00200"></a>00200 <span class="comment">/*</span>
<a name="l00201"></a>00201 <span class="comment"> * usbradio.conf parameters are</span>
<a name="l00202"></a>00202 <span class="comment">START_CONFIG</span>
<a name="l00203"></a>00203 <span class="comment"></span>
<a name="l00204"></a>00204 <span class="comment">[general]</span>
<a name="l00205"></a>00205 <span class="comment">    ; General config options which propigate to all devices, with</span>
<a name="l00206"></a>00206 <span class="comment">    ; default values shown. You may have as many devices as the</span>
<a name="l00207"></a>00207 <span class="comment">    ; system will allow. You must use one section per device, with</span>
<a name="l00208"></a>00208 <span class="comment">    ; [usb] generally (although its up to you) being the first device.</span>
<a name="l00209"></a>00209 <span class="comment">    ;</span>
<a name="l00210"></a>00210 <span class="comment">    ;</span>
<a name="l00211"></a>00211 <span class="comment">    ; debug = 0x0    ; misc debug flags, default is 0</span>
<a name="l00212"></a>00212 <span class="comment"></span>
<a name="l00213"></a>00213 <span class="comment">   ; Set the device to use for I/O</span>
<a name="l00214"></a>00214 <span class="comment">   ; devicenum = 0</span>
<a name="l00215"></a>00215 <span class="comment">   ; Set hardware type here</span>
<a name="l00216"></a>00216 <span class="comment">   ; hdwtype=0               ; 0=limey, 1=sph</span>
<a name="l00217"></a>00217 <span class="comment"></span>
<a name="l00218"></a>00218 <span class="comment">   ; rxboost=0          ; no rx gain boost</span>
<a name="l00219"></a>00219 <span class="comment">   ; rxctcssrelax=1        ; reduce talkoff from radios w/o CTCSS Tx HPF</span>
<a name="l00220"></a>00220 <span class="comment">   ; rxctcssfreqs=100.0,123.0      ; list of rx ctcss freq in floating point. must be in table</span>
<a name="l00221"></a>00221 <span class="comment">   ; txctcssfreqs=100.0,123.0      ; list tx ctcss freq, any frequency permitted</span>
<a name="l00222"></a>00222 <span class="comment">   ; txctcssdefault=100.0      ; default tx ctcss freq, any frequency permitted</span>
<a name="l00223"></a>00223 <span class="comment"></span>
<a name="l00224"></a>00224 <span class="comment">   ; carrierfrom=dsp     ;no,usb,usbinvert,dsp,vox</span>
<a name="l00225"></a>00225 <span class="comment">   ; ctcssfrom=dsp       ;no,usb,dsp</span>
<a name="l00226"></a>00226 <span class="comment"></span>
<a name="l00227"></a>00227 <span class="comment">   ; rxdemod=flat            ; input type from radio: no,speaker,flat</span>
<a name="l00228"></a>00228 <span class="comment">   ; txprelim=yes            ; output is pre-emphasised and limited</span>
<a name="l00229"></a>00229 <span class="comment">   ; txtoctype=no            ; no,phase,notone</span>
<a name="l00230"></a>00230 <span class="comment"></span>
<a name="l00231"></a>00231 <span class="comment">   ; txmixa=composite        ;no,voice,tone,composite,auxvoice</span>
<a name="l00232"></a>00232 <span class="comment">   ; txmixb=no               ;no,voice,tone,composite,auxvoice</span>
<a name="l00233"></a>00233 <span class="comment"></span>
<a name="l00234"></a>00234 <span class="comment">   ; invertptt=0</span>
<a name="l00235"></a>00235 <span class="comment"></span>
<a name="l00236"></a>00236 <span class="comment">    ;------------------------------ JITTER BUFFER CONFIGURATION --------------------------</span>
<a name="l00237"></a>00237 <span class="comment">    ; jbenable = yes              ; Enables the use of a jitterbuffer on the receiving side of an</span>
<a name="l00238"></a>00238 <span class="comment">                                  ; USBRADIO channel. Defaults to &quot;no&quot;. An enabled jitterbuffer will</span>
<a name="l00239"></a>00239 <span class="comment">                                  ; be used only if the sending side can create and the receiving</span>
<a name="l00240"></a>00240 <span class="comment">                                  ; side can not accept jitter. The USBRADIO channel can&apos;t accept jitter,</span>
<a name="l00241"></a>00241 <span class="comment">                                  ; thus an enabled jitterbuffer on the receive USBRADIO side will always</span>
<a name="l00242"></a>00242 <span class="comment">                                  ; be used if the sending side can create jitter.</span>
<a name="l00243"></a>00243 <span class="comment"></span>
<a name="l00244"></a>00244 <span class="comment">    ; jbmaxsize = 200             ; Max length of the jitterbuffer in milliseconds.</span>
<a name="l00245"></a>00245 <span class="comment"></span>
<a name="l00246"></a>00246 <span class="comment">    ; jbresyncthreshold = 1000    ; Jump in the frame timestamps over which the jitterbuffer is</span>
<a name="l00247"></a>00247 <span class="comment">                                  ; resynchronized. Useful to improve the quality of the voice, with</span>
<a name="l00248"></a>00248 <span class="comment">                                  ; big jumps in/broken timestamps, usualy sent from exotic devices</span>
<a name="l00249"></a>00249 <span class="comment">                                  ; and programs. Defaults to 1000.</span>
<a name="l00250"></a>00250 <span class="comment"></span>
<a name="l00251"></a>00251 <span class="comment">    ; jbimpl = fixed              ; Jitterbuffer implementation, used on the receiving side of an USBRADIO</span>
<a name="l00252"></a>00252 <span class="comment">                                  ; channel. Two implementations are currenlty available - &quot;fixed&quot;</span>
<a name="l00253"></a>00253 <span class="comment">                                  ; (with size always equals to jbmax-size) and &quot;adaptive&quot; (with</span>
<a name="l00254"></a>00254 <span class="comment">                                  ; variable size, actually the new jb of IAX2). Defaults to fixed.</span>
<a name="l00255"></a>00255 <span class="comment"></span>
<a name="l00256"></a>00256 <span class="comment">    ; jblog = no                  ; Enables jitterbuffer frame logging. Defaults to &quot;no&quot;.</span>
<a name="l00257"></a>00257 <span class="comment">    ;-----------------------------------------------------------------------------------</span>
<a name="l00258"></a>00258 <span class="comment"></span>
<a name="l00259"></a>00259 <span class="comment">[usb]</span>
<a name="l00260"></a>00260 <span class="comment"></span>
<a name="l00261"></a>00261 <span class="comment">; First channel unique config</span>
<a name="l00262"></a>00262 <span class="comment"></span>
<a name="l00263"></a>00263 <span class="comment">[usb1]</span>
<a name="l00264"></a>00264 <span class="comment"></span>
<a name="l00265"></a>00265 <span class="comment">; Second channel config</span>
<a name="l00266"></a>00266 <span class="comment"></span>
<a name="l00267"></a>00267 <span class="comment">END_CONFIG</span>
<a name="l00268"></a>00268 <span class="comment"></span>
<a name="l00269"></a>00269 <span class="comment"> */</span>
<a name="l00270"></a>00270 
<a name="l00271"></a>00271 <span class="comment">/*</span>
<a name="l00272"></a>00272 <span class="comment"> * Helper macros to parse config arguments. They will go in a common</span>
<a name="l00273"></a>00273 <span class="comment"> * header file if their usage is globally accepted. In the meantime,</span>
<a name="l00274"></a>00274 <span class="comment"> * we define them here. Typical usage is as below.</span>
<a name="l00275"></a>00275 <span class="comment"> * Remember to open a block right before M_START (as it declares</span>
<a name="l00276"></a>00276 <span class="comment"> * some variables) and use the M_* macros WITHOUT A SEMICOLON:</span>
<a name="l00277"></a>00277 <span class="comment"> *</span>
<a name="l00278"></a>00278 <span class="comment"> * {</span>
<a name="l00279"></a>00279 <span class="comment"> *    M_START(v-&gt;name, v-&gt;value) </span>
<a name="l00280"></a>00280 <span class="comment"> *</span>
<a name="l00281"></a>00281 <span class="comment"> *    M_BOOL(&quot;dothis&quot;, x-&gt;flag1)</span>
<a name="l00282"></a>00282 <span class="comment"> *    M_STR(&quot;name&quot;, x-&gt;somestring)</span>
<a name="l00283"></a>00283 <span class="comment"> *    M_F(&quot;bar&quot;, some_c_code)</span>
<a name="l00284"></a>00284 <span class="comment"> *    M_END(some_final_statement)</span>
<a name="l00285"></a>00285 <span class="comment"> *    ... other code in the block</span>
<a name="l00286"></a>00286 <span class="comment"> * }</span>
<a name="l00287"></a>00287 <span class="comment"> *</span>
<a name="l00288"></a>00288 <span class="comment"> * XXX NOTE these macros should NOT be replicated in other parts of asterisk. </span>
<a name="l00289"></a>00289 <span class="comment"> * Likely we will come up with a better way of doing config file parsing.</span>
<a name="l00290"></a>00290 <span class="comment"> */</span>
<a name="l00291"></a><a class="code" href="chan__usbradio_8c.html#aa8507593fc6a5ac8a4dda99c3ac5e024">00291</a> <span class="preprocessor">#define M_START(var, val) \</span>
<a name="l00292"></a>00292 <span class="preprocessor">        char *__s = var; char *__val = val;</span>
<a name="l00293"></a><a class="code" href="chan__usbradio_8c.html#a93b8a223d68be1e0f2262e0ffe7f3dfc">00293</a> <span class="preprocessor"></span><span class="preprocessor">#define M_END(x)   x;</span>
<a name="l00294"></a><a class="code" href="chan__usbradio_8c.html#a7772197db782e85b4e2fba2d641b592d">00294</a> <span class="preprocessor"></span><span class="preprocessor">#define M_F(tag, f)        if (!strcasecmp((__s), tag)) { f; } else</span>
<a name="l00295"></a><a class="code" href="chan__usbradio_8c.html#a9cf2eee5dda3e750f9e6f1cb3e7a09a2">00295</a> <span class="preprocessor"></span><span class="preprocessor">#define M_BOOL(tag, dst)   M_F(tag, (dst) = ast_true(__val) )</span>
<a name="l00296"></a><a class="code" href="chan__usbradio_8c.html#aba0c95c713354abf6c6577ed3c110be5">00296</a> <span class="preprocessor"></span><span class="preprocessor">#define M_UINT(tag, dst)   M_F(tag, (dst) = strtoul(__val, NULL, 0) )</span>
<a name="l00297"></a><a class="code" href="chan__usbradio_8c.html#a1dbce7eba2a5b0b4aa5905af98dbc9b6">00297</a> <span class="preprocessor"></span><span class="preprocessor">#define M_STR(tag, dst)    M_F(tag, ast_copy_string(dst, __val, sizeof(dst)))</span>
<a name="l00298"></a>00298 <span class="preprocessor"></span>
<a name="l00299"></a>00299 <span class="comment">/*</span>
<a name="l00300"></a>00300 <span class="comment"> * The following parameters are used in the driver:</span>
<a name="l00301"></a>00301 <span class="comment"> *</span>
<a name="l00302"></a>00302 <span class="comment"> *  FRAME_SIZE the size of an audio frame, in samples.</span>
<a name="l00303"></a>00303 <span class="comment"> *    160 is used almost universally, so you should not change it.</span>
<a name="l00304"></a>00304 <span class="comment"> *</span>
<a name="l00305"></a>00305 <span class="comment"> *  FRAGS   the argument for the SETFRAGMENT ioctl.</span>
<a name="l00306"></a>00306 <span class="comment"> *    Overridden by the &apos;frags&apos; parameter in usbradio.conf</span>
<a name="l00307"></a>00307 <span class="comment"> *</span>
<a name="l00308"></a>00308 <span class="comment"> *    Bits 0-7 are the base-2 log of the device&apos;s block size,</span>
<a name="l00309"></a>00309 <span class="comment"> *    bits 16-31 are the number of blocks in the driver&apos;s queue.</span>
<a name="l00310"></a>00310 <span class="comment"> *    There are a lot of differences in the way this parameter</span>
<a name="l00311"></a>00311 <span class="comment"> *    is supported by different drivers, so you may need to</span>
<a name="l00312"></a>00312 <span class="comment"> *    experiment a bit with the value.</span>
<a name="l00313"></a>00313 <span class="comment"> *    A good default for linux is 30 blocks of 64 bytes, which</span>
<a name="l00314"></a>00314 <span class="comment"> *    results in 6 frames of 320 bytes (160 samples).</span>
<a name="l00315"></a>00315 <span class="comment"> *    FreeBSD works decently with blocks of 256 or 512 bytes,</span>
<a name="l00316"></a>00316 <span class="comment"> *    leaving the number unspecified.</span>
<a name="l00317"></a>00317 <span class="comment"> *    Note that this only refers to the device buffer size,</span>
<a name="l00318"></a>00318 <span class="comment"> *    this module will then try to keep the lenght of audio</span>
<a name="l00319"></a>00319 <span class="comment"> *    buffered within small constraints.</span>
<a name="l00320"></a>00320 <span class="comment"> *</span>
<a name="l00321"></a>00321 <span class="comment"> *  QUEUE_SIZE The max number of blocks actually allowed in the device</span>
<a name="l00322"></a>00322 <span class="comment"> *    driver&apos;s buffer, irrespective of the available number.</span>
<a name="l00323"></a>00323 <span class="comment"> *    Overridden by the &apos;queuesize&apos; parameter in usbradio.conf</span>
<a name="l00324"></a>00324 <span class="comment"> *</span>
<a name="l00325"></a>00325 <span class="comment"> *    Should be &gt;=2, and at most as large as the hw queue above</span>
<a name="l00326"></a>00326 <span class="comment"> *    (otherwise it will never be full).</span>
<a name="l00327"></a>00327 <span class="comment"> */</span>
<a name="l00328"></a>00328 
<a name="l00329"></a><a class="code" href="chan__usbradio_8c.html#af9b1b2ba12857a4bf11289dac8c5462d">00329</a> <span class="preprocessor">#define FRAME_SIZE   160</span>
<a name="l00330"></a><a class="code" href="chan__usbradio_8c.html#a142810068f1b99cd93d3fc9f0e160e02">00330</a> <span class="preprocessor"></span><span class="preprocessor">#define  QUEUE_SIZE  2           </span>
<a name="l00331"></a>00331 <span class="preprocessor"></span>
<a name="l00332"></a>00332 <span class="preprocessor">#if defined(__FreeBSD__)</span>
<a name="l00333"></a>00333 <span class="preprocessor"></span><span class="preprocessor">#define  FRAGS 0x8</span>
<a name="l00334"></a>00334 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00335"></a><a class="code" href="chan__usbradio_8c.html#a44f658797e1982f579580823c8fcf8f8">00335</a> <span class="preprocessor"></span><span class="preprocessor">#define  FRAGS ( ( (6 * 5) &lt;&lt; 16 ) | 0xc )</span>
<a name="l00336"></a>00336 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00337"></a>00337 <span class="preprocessor"></span>
<a name="l00338"></a>00338 <span class="comment">/*</span>
<a name="l00339"></a>00339 <span class="comment"> * XXX text message sizes are probably 256 chars, but i am</span>
<a name="l00340"></a>00340 <span class="comment"> * not sure if there is a suitable definition anywhere.</span>
<a name="l00341"></a>00341 <span class="comment"> */</span>
<a name="l00342"></a><a class="code" href="chan__usbradio_8c.html#afb6f36d91ffbf947cfa3f1114ca79764">00342</a> <span class="preprocessor">#define TEXT_SIZE 256</span>
<a name="l00343"></a>00343 <span class="preprocessor"></span>
<a name="l00344"></a>00344 <span class="preprocessor">#if 0</span>
<a name="l00345"></a>00345 <span class="preprocessor"></span><span class="preprocessor">#define  TRYOPEN  1           </span><span class="comment">/* try to open on startup */</span>
<a name="l00346"></a>00346 <span class="preprocessor">#endif</span>
<a name="l00347"></a><a class="code" href="chan__usbradio_8c.html#a9d6bb64b7e9ca3602a00db074a84103d">00347</a> <span class="preprocessor"></span><span class="preprocessor">#define  O_CLOSE  0x444       </span><span class="comment">/* special &apos;close&apos; mode for device */</span>
<a name="l00348"></a>00348 <span class="comment">/* Which device to use */</span>
<a name="l00349"></a>00349 <span class="preprocessor">#if defined( __OpenBSD__ ) || defined( __NetBSD__ )</span>
<a name="l00350"></a>00350 <span class="preprocessor"></span><span class="preprocessor">#define DEV_DSP &quot;/dev/audio&quot;</span>
<a name="l00351"></a>00351 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00352"></a><a class="code" href="chan__usbradio_8c.html#a6be84301906dae965d8f760e7779161a">00352</a> <span class="preprocessor"></span><span class="preprocessor">#define DEV_DSP &quot;/dev/dsp&quot;</span>
<a name="l00353"></a>00353 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00354"></a>00354 <span class="preprocessor"></span>
<a name="l00355"></a><a class="code" href="chan__usbradio_8c.html#a65e5109273690c9fa64f70d4860c6647">00355</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="chan__usbradio_8c.html#a65e5109273690c9fa64f70d4860c6647">config</a> = <span class="stringliteral">&quot;usbradio.conf&quot;</span>; <span class="comment">/* default config file */</span>
<a name="l00356"></a><a class="code" href="chan__usbradio_8c.html#a06ca1079ac177d8beaafa3286da25297">00356</a> <span class="preprocessor">#define config1 &quot;usbradio_tune_%s.conf&quot;    </span><span class="comment">/* tune config file */</span>
<a name="l00357"></a>00357 
<a name="l00358"></a><a class="code" href="chan__usbradio_8c.html#a2fc960e3905be48a6bfbac67bae23df7">00358</a> <span class="keyword">static</span> FILE *<a class="code" href="chan__usbradio_8c.html#afe2aef7418ef6605f4ec07e98bc6bd9a">frxcapraw</a> = NULL, *<a class="code" href="chan__usbradio_8c.html#af104767a1754875b1d4862e8b068cd29">frxcaptrace</a> = NULL, *<a class="code" href="chan__usbradio_8c.html#a2fc960e3905be48a6bfbac67bae23df7">frxoutraw</a> = NULL;
<a name="l00359"></a><a class="code" href="chan__usbradio_8c.html#a90692fb318f089d748b3608bab01ab35">00359</a> <span class="keyword">static</span> FILE *<a class="code" href="chan__usbradio_8c.html#ae462a3ce14cfcf4a57a4c57949e5a816">ftxcapraw</a> = NULL, *<a class="code" href="chan__usbradio_8c.html#ad6e1387db036f6b790788154897f5ddc">ftxcaptrace</a> = NULL, *<a class="code" href="chan__usbradio_8c.html#a90692fb318f089d748b3608bab01ab35">ftxoutraw</a> = NULL;
<a name="l00360"></a>00360 
<a name="l00361"></a><a class="code" href="chan__usbradio_8c.html#abb9c5a7607c180d987574d63ab2a6a74">00361</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="chan__usbradio_8c.html#abb9c5a7607c180d987574d63ab2a6a74">usb_device_list</a> = NULL;
<a name="l00362"></a><a class="code" href="chan__usbradio_8c.html#aaded61aef81717a32bce8995bdb75487">00362</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#aaded61aef81717a32bce8995bdb75487">usb_device_list_size</a> = 0;
<a name="l00363"></a>00363 
<a name="l00364"></a><a class="code" href="chan__usbradio_8c.html#ad0070ae9917bc6b4d2d4d3bb5bf51b9e">00364</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#ad0070ae9917bc6b4d2d4d3bb5bf51b9e">usbradio_debug</a>;
<a name="l00365"></a>00365 <span class="preprocessor">#if 0 //maw asdf sph</span>
<a name="l00366"></a>00366 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">int</span> usbradio_debug_level = 0;
<a name="l00367"></a>00367 <span class="preprocessor">#endif</span>
<a name="l00368"></a>00368 <span class="preprocessor"></span>
<a name="l00369"></a><a class="code" href="chan__usbradio_8c.html#a83e8bc15645f9d99ab91a152bb3dc8ceacceada590b9f7e7694e546550b0cba74">00369</a> <span class="keyword">enum</span> {<a class="code" href="chan__usbradio_8c.html#a83e8bc15645f9d99ab91a152bb3dc8cead172bb1b89a45791c6145692cf3b4fac">RX_AUDIO_NONE</a>,<a class="code" href="chan__usbradio_8c.html#a83e8bc15645f9d99ab91a152bb3dc8ceacceada590b9f7e7694e546550b0cba74">RX_AUDIO_SPEAKER</a>,<a class="code" href="chan__usbradio_8c.html#a83e8bc15645f9d99ab91a152bb3dc8cead2f329eb79309c5c7ed7ba7cec2681ff">RX_AUDIO_FLAT</a>};
<a name="l00370"></a><a class="code" href="chan__usbradio_8c.html#a68c01102755fc7d1c810bb0b0635fa90ac3d0b3b9bd7c9d801dd2d7a3f1434f2b">00370</a> <span class="keyword">enum</span> {<a class="code" href="chan__usbradio_8c.html#a68c01102755fc7d1c810bb0b0635fa90abe9a656b626b31aa9c2c6b9908b4ed28">CD_IGNORE</a>,<a class="code" href="chan__usbradio_8c.html#a68c01102755fc7d1c810bb0b0635fa90a458efb22943bcf8e0e9bb22290294ff2">CD_XPMR_NOISE</a>,<a class="code" href="chan__usbradio_8c.html#a68c01102755fc7d1c810bb0b0635fa90ac3d0b3b9bd7c9d801dd2d7a3f1434f2b">CD_XPMR_VOX</a>,<a class="code" href="chan__usbradio_8c.html#a68c01102755fc7d1c810bb0b0635fa90a3decc0a04d3b0418061d3edffc567dbf">CD_HID</a>,<a class="code" href="chan__usbradio_8c.html#a68c01102755fc7d1c810bb0b0635fa90a4e320acd2108cbf05d76b78fdc9afac1">CD_HID_INVERT</a>};
<a name="l00371"></a><a class="code" href="chan__usbradio_8c.html#aa618c4d8c29ef4efe6f10c741fb1f47aa8f2a8e795ef07b87cc9888c160e04b2f">00371</a> <span class="keyword">enum</span> {<a class="code" href="chan__usbradio_8c.html#aa618c4d8c29ef4efe6f10c741fb1f47aa3ba1200323ee3d30a468da96d71653c3">SD_IGNORE</a>,<a class="code" href="chan__usbradio_8c.html#aa618c4d8c29ef4efe6f10c741fb1f47aa7bd439426427f9eefd076a49b04e6ea7">SD_HID</a>,<a class="code" href="chan__usbradio_8c.html#aa618c4d8c29ef4efe6f10c741fb1f47aa3a5d0d2435fca1bac96577cf151cf27b">SD_HID_INVERT</a>,<a class="code" href="chan__usbradio_8c.html#aa618c4d8c29ef4efe6f10c741fb1f47aa8f2a8e795ef07b87cc9888c160e04b2f">SD_XPMR</a>};               <span class="comment">// no,external,externalinvert,software</span>
<a name="l00372"></a><a class="code" href="chan__usbradio_8c.html#ad63240694c6dc2a28c24bfc2db90ad7aa43555ec538479cd99f9dba733956a9fd">00372</a> <span class="keyword">enum</span> {<a class="code" href="chan__usbradio_8c.html#ad63240694c6dc2a28c24bfc2db90ad7aa46c867906eeb1f53c0824927d3503842">RX_KEY_CARRIER</a>,<a class="code" href="chan__usbradio_8c.html#ad63240694c6dc2a28c24bfc2db90ad7aa43555ec538479cd99f9dba733956a9fd">RX_KEY_CARRIER_CODE</a>};
<a name="l00373"></a><a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051eaccdce3522c59395383ad570f8ee57acd">00373</a> <span class="keyword">enum</span> {<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051ea93bd99aa973ca72a6d778f6acbde4799">TX_OUT_OFF</a>,<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051eaccdce3522c59395383ad570f8ee57acd">TX_OUT_VOICE</a>,<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051ea10815a225284305f3f93416f07a85cb7">TX_OUT_LSD</a>,<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051eaea61167af07104aee49cea1568e356ec">TX_OUT_COMPOSITE</a>,<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051ea40abd0b87cb8a3bd0d80c4732dad35e8">TX_OUT_AUX</a>};
<a name="l00374"></a><a class="code" href="chan__usbradio_8c.html#a79e9f285d34216706a748fd7ba8941b7ad031f6177bb928acd65b32177c84f14a">00374</a> <span class="keyword">enum</span> {<a class="code" href="chan__usbradio_8c.html#a79e9f285d34216706a748fd7ba8941b7a22a2e6eabfd060ff0c88d05f654a1649">TOC_NONE</a>,<a class="code" href="chan__usbradio_8c.html#a79e9f285d34216706a748fd7ba8941b7ad031f6177bb928acd65b32177c84f14a">TOC_PHASE</a>,<a class="code" href="chan__usbradio_8c.html#a79e9f285d34216706a748fd7ba8941b7a0dff75ff110b842fa3575e1ad2118a96">TOC_NOTONE</a>};
<a name="l00375"></a>00375 
<a name="l00376"></a>00376 <span class="comment">/* DECLARE STRUCTURES */</span>
<a name="l00377"></a>00377 
<a name="l00378"></a>00378 <span class="comment">/*</span>
<a name="l00379"></a>00379 <span class="comment"> * Each sound is made of &apos;datalen&apos; samples of sound, repeated as needed to</span>
<a name="l00380"></a>00380 <span class="comment"> * generate &apos;samplen&apos; samples of data, then followed by &apos;silencelen&apos; samples</span>
<a name="l00381"></a>00381 <span class="comment"> * of silence. The loop is repeated if &apos;repeat&apos; is set.</span>
<a name="l00382"></a>00382 <span class="comment"> */</span>
<a name="l00383"></a><a class="code" href="structsound.html">00383</a> <span class="keyword">struct </span><a class="code" href="structsound.html">sound</a> {
<a name="l00384"></a><a class="code" href="structsound.html#a4b00721003b8d35559a55c9098ff36c5">00384</a>    <span class="keywordtype">int</span> <a class="code" href="structsound.html#a4b00721003b8d35559a55c9098ff36c5">ind</a>;
<a name="l00385"></a><a class="code" href="structsound.html#a3aad16fd4bea1b9717f232ea75ad6449">00385</a>    <span class="keywordtype">char</span> *<a class="code" href="structsound.html#a3aad16fd4bea1b9717f232ea75ad6449">desc</a>;
<a name="l00386"></a><a class="code" href="structsound.html#a5b5b032f747e9383fc0d98f7054e258f">00386</a>    <span class="keywordtype">short</span> *<a class="code" href="structsound.html#a5b5b032f747e9383fc0d98f7054e258f">data</a>;
<a name="l00387"></a><a class="code" href="structsound.html#ad67e07841d1233e596e6f822a3c81f6b">00387</a>    <span class="keywordtype">int</span> <a class="code" href="structsound.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>;
<a name="l00388"></a><a class="code" href="structsound.html#ac65e0a7e9609ebd62a1863960b2fa0a8">00388</a>    <span class="keywordtype">int</span> <a class="code" href="structsound.html#ac65e0a7e9609ebd62a1863960b2fa0a8">samplen</a>;
<a name="l00389"></a><a class="code" href="structsound.html#a0c0d26eb12ca48d8e332aa9fd547afb3">00389</a>    <span class="keywordtype">int</span> <a class="code" href="structsound.html#a0c0d26eb12ca48d8e332aa9fd547afb3">silencelen</a>;
<a name="l00390"></a><a class="code" href="structsound.html#aa85ffe7728fe6b62d593de58cb66f232">00390</a>    <span class="keywordtype">int</span> <a class="code" href="structsound.html#aa85ffe7728fe6b62d593de58cb66f232">repeat</a>;
<a name="l00391"></a>00391 };
<a name="l00392"></a>00392 
<a name="l00393"></a>00393 <span class="preprocessor">#ifndef  NEW_ASTERISK</span>
<a name="l00394"></a>00394 <span class="preprocessor"></span>
<a name="l00395"></a>00395 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structsound.html">sound</a> sounds[] = {
<a name="l00396"></a>00396    { <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa5814e690c23b590bcd4eb43535907a1">AST_CONTROL_RINGING</a>, <span class="stringliteral">&quot;RINGING&quot;</span>, ringtone, <span class="keyword">sizeof</span>(ringtone)/2, 16000, 32000, 1 },
<a name="l00397"></a>00397    { <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a387635982df3d2edb669a1eece92c875">AST_CONTROL_BUSY</a>, <span class="stringliteral">&quot;BUSY&quot;</span>, busy, <span class="keyword">sizeof</span>(busy)/2, 4000, 4000, 1 },
<a name="l00398"></a>00398    { <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a850bb06a1702741c93a3fd67cc9637ab">AST_CONTROL_CONGESTION</a>, <span class="stringliteral">&quot;CONGESTION&quot;</span>, busy, <span class="keyword">sizeof</span>(busy)/2, 2000, 2000, 1 },
<a name="l00399"></a>00399    { <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a00675bfb8c64b2be86297fe4cba51fa2">AST_CONTROL_RING</a>, <span class="stringliteral">&quot;RING10&quot;</span>, ring10, <span class="keyword">sizeof</span>(ring10)/2, 16000, 32000, 1 },
<a name="l00400"></a>00400    { <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe">AST_CONTROL_ANSWER</a>, <span class="stringliteral">&quot;ANSWER&quot;</span>, answer, <span class="keyword">sizeof</span>(answer)/2, 2200, 0, 0 },
<a name="l00401"></a>00401    { -1, NULL, 0, 0, 0, 0 },  <span class="comment">/* end marker */</span>
<a name="l00402"></a>00402 };
<a name="l00403"></a>00403 
<a name="l00404"></a>00404 <span class="preprocessor">#endif</span>
<a name="l00405"></a>00405 <span class="preprocessor"></span>
<a name="l00406"></a>00406 <span class="comment">/*</span>
<a name="l00407"></a>00407 <span class="comment"> * descriptor for one of our channels.</span>
<a name="l00408"></a>00408 <span class="comment"> * There is one used for &apos;default&apos; values (from the [general] entry in</span>
<a name="l00409"></a>00409 <span class="comment"> * the configuration file), and then one instance for each device</span>
<a name="l00410"></a>00410 <span class="comment"> * (the default is cloned from [general], others are only created</span>
<a name="l00411"></a>00411 <span class="comment"> * if the relevant section exists).</span>
<a name="l00412"></a>00412 <span class="comment"> */</span>
<a name="l00413"></a><a class="code" href="structchan__usbradio__pvt.html">00413</a> <span class="keyword">struct </span><a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> {
<a name="l00414"></a><a class="code" href="structchan__usbradio__pvt.html#a9f87d8717635cfb958525ea3b179ff4f">00414</a>    <span class="keyword">struct </span><a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *<a class="code" href="structchan__usbradio__pvt.html#a9f87d8717635cfb958525ea3b179ff4f">next</a>;
<a name="l00415"></a>00415 
<a name="l00416"></a><a class="code" href="structchan__usbradio__pvt.html#a5ac083a645d964373f022d03df4849c8">00416</a>    <span class="keywordtype">char</span> *<a class="code" href="structchan__usbradio__pvt.html#a5ac083a645d964373f022d03df4849c8">name</a>;
<a name="l00417"></a>00417 <span class="preprocessor">#ifndef  NEW_ASTERISK</span>
<a name="l00418"></a>00418 <span class="preprocessor"></span>   <span class="comment">/*</span>
<a name="l00419"></a>00419 <span class="comment">    * cursound indicates which in struct sound we play. -1 means nothing,</span>
<a name="l00420"></a>00420 <span class="comment">    * any other value is a valid sound, in which case sampsent indicates</span>
<a name="l00421"></a>00421 <span class="comment">    * the next sample to send in [0..samplen + silencelen]</span>
<a name="l00422"></a>00422 <span class="comment">    * nosound is set to disable the audio data from the channel</span>
<a name="l00423"></a>00423 <span class="comment">    * (so we can play the tones etc.).</span>
<a name="l00424"></a>00424 <span class="comment">    */</span>
<a name="l00425"></a>00425    <span class="keywordtype">int</span> sndcmd[2];          <span class="comment">/* Sound command pipe */</span>
<a name="l00426"></a>00426    <span class="keywordtype">int</span> cursound;           <span class="comment">/* index of sound to send */</span>
<a name="l00427"></a>00427    <span class="keywordtype">int</span> sampsent;           <span class="comment">/* # of sound samples sent  */</span>
<a name="l00428"></a>00428    <span class="keywordtype">int</span> nosound;            <span class="comment">/* set to block audio from the PBX */</span>
<a name="l00429"></a>00429 <span class="preprocessor">#endif</span>
<a name="l00430"></a>00430 <span class="preprocessor"></span>
<a name="l00431"></a><a class="code" href="structchan__usbradio__pvt.html#af1f2cc7eff55caf1c549b336a065689a">00431</a>    <span class="keywordtype">int</span> <a class="code" href="structchan__usbradio__pvt.html#af1f2cc7eff55caf1c549b336a065689a">pttkick</a>[2];
<a name="l00432"></a><a class="code" href="structchan__usbradio__pvt.html#a665434db7b1be9dbe9d9729696eaa857">00432</a>    <span class="keywordtype">int</span> <a class="code" href="structchan__usbradio__pvt.html#a665434db7b1be9dbe9d9729696eaa857">total_blocks</a>;       <span class="comment">/* total blocks in the output device */</span>
<a name="l00433"></a><a class="code" href="structchan__usbradio__pvt.html#ac3fb672ce98321ddfeba0b02fba73298">00433</a>    <span class="keywordtype">int</span> <a class="code" href="structchan__usbradio__pvt.html#ac3fb672ce98321ddfeba0b02fba73298">sounddev</a>;
<a name="l00434"></a><a class="code" href="structchan__usbradio__pvt.html#abe974f22edeef8189603ba75fd90ff3ca7af369c035a45a9babde5a9443b5ef01">00434</a>    <span class="keyword">enum</span> { <a class="code" href="structchan__usbradio__pvt.html#abe974f22edeef8189603ba75fd90ff3ca89ae3203603c2cd0eecb06b10597f94f">M_UNSET</a>, <a class="code" href="structchan__usbradio__pvt.html#abe974f22edeef8189603ba75fd90ff3ca4d444b330d2372546edf9ba1dc8f85e7">M_FULL</a>, <a class="code" href="structchan__usbradio__pvt.html#abe974f22edeef8189603ba75fd90ff3ca0cb0be5475011ea9319ce55b30e74634">M_READ</a>, <a class="code" href="structchan__usbradio__pvt.html#abe974f22edeef8189603ba75fd90ff3ca7af369c035a45a9babde5a9443b5ef01">M_WRITE</a> } <a class="code" href="structchan__usbradio__pvt.html#aeffa2366fd7f07a4bf00a7489df44977">duplex</a>;
<a name="l00435"></a><a class="code" href="structchan__usbradio__pvt.html#a9ec8d9e6a4bfe1c888b72bb3b78a7087">00435</a>    i16 <a class="code" href="structchan__usbradio__pvt.html#a9ec8d9e6a4bfe1c888b72bb3b78a7087">cdMethod</a>;
<a name="l00436"></a><a class="code" href="structchan__usbradio__pvt.html#aa682db27c8180700165db1398964b3c8">00436</a>    <span class="keywordtype">int</span> <a class="code" href="structchan__usbradio__pvt.html#aa682db27c8180700165db1398964b3c8">autoanswer</a>;
<a name="l00437"></a><a class="code" href="structchan__usbradio__pvt.html#a56c3f16f4a1c55d1d95c6a9523cd65ca">00437</a>    <span class="keywordtype">int</span> <a class="code" href="structchan__usbradio__pvt.html#a56c3f16f4a1c55d1d95c6a9523cd65ca">autohangup</a>;
<a name="l00438"></a><a class="code" href="structchan__usbradio__pvt.html#a6ec03f2e1f4b9ef754003a0019a410a2">00438</a>    <span class="keywordtype">int</span> <a class="code" href="structchan__usbradio__pvt.html#a6ec03f2e1f4b9ef754003a0019a410a2">hookstate</a>;
<a name="l00439"></a><a class="code" href="structchan__usbradio__pvt.html#a33e55b30ec9ce66362b23d8fb1582630">00439</a>    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structchan__usbradio__pvt.html#a33e55b30ec9ce66362b23d8fb1582630">queuesize</a>;    <span class="comment">/* max fragments in queue */</span>
<a name="l00440"></a><a class="code" href="structchan__usbradio__pvt.html#a2f37ac27c86df549c61c5dcdc26de20d">00440</a>    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structchan__usbradio__pvt.html#a2f37ac27c86df549c61c5dcdc26de20d">frags</a>;        <span class="comment">/* parameter for SETFRAGMENT */</span>
<a name="l00441"></a>00441 
<a name="l00442"></a><a class="code" href="structchan__usbradio__pvt.html#a873db0c09e74a379eb9c741329f126f3">00442</a>    <span class="keywordtype">int</span> <a class="code" href="structchan__usbradio__pvt.html#a873db0c09e74a379eb9c741329f126f3">warned</a>;             <span class="comment">/* various flags used for warnings */</span>
<a name="l00443"></a><a class="code" href="chan__usbradio_8c.html#a11aaf77355342e1ba8feee89c4d66e51">00443</a> <span class="preprocessor">#define WARN_used_blocks   1</span>
<a name="l00444"></a><a class="code" href="chan__usbradio_8c.html#a93bf0c7c887e8b899663f17882cf5b40">00444</a> <span class="preprocessor"></span><span class="preprocessor">#define WARN_speed      2</span>
<a name="l00445"></a><a class="code" href="chan__usbradio_8c.html#a422b43626fc2d780dad3ca0280b79225">00445</a> <span class="preprocessor"></span><span class="preprocessor">#define WARN_frag    4</span>
<a name="l00446"></a><a class="code" href="structchan__usbradio__pvt.html#af9377710db171b729a953696795e29b3">00446</a> <span class="preprocessor"></span>   <span class="keywordtype">int</span> <a class="code" href="structchan__usbradio__pvt.html#af9377710db171b729a953696795e29b3">w_errors</a>;           <span class="comment">/* overfull in the write path */</span>
<a name="l00447"></a><a class="code" href="structchan__usbradio__pvt.html#a335ae1f9f7ea2bc5d6cd92a35bb675c3">00447</a>    <span class="keyword">struct </span>timeval <a class="code" href="structchan__usbradio__pvt.html#a335ae1f9f7ea2bc5d6cd92a35bb675c3">lastopen</a>;
<a name="l00448"></a>00448 
<a name="l00449"></a><a class="code" href="structchan__usbradio__pvt.html#a4eedfe56e88e9cb9777a619c022fe6a8">00449</a>    <span class="keywordtype">int</span> <a class="code" href="structchan__usbradio__pvt.html#a4eedfe56e88e9cb9777a619c022fe6a8">overridecontext</a>;
<a name="l00450"></a><a class="code" href="structchan__usbradio__pvt.html#a29128ae5c15a12dea5fe4f263ba6cec1">00450</a>    <span class="keywordtype">int</span> <a class="code" href="structchan__usbradio__pvt.html#a29128ae5c15a12dea5fe4f263ba6cec1">mute</a>;
<a name="l00451"></a>00451 
<a name="l00452"></a>00452    <span class="comment">/* boost support. BOOST_SCALE * 10 ^(BOOST_MAX/20) must</span>
<a name="l00453"></a>00453 <span class="comment">    * be representable in 16 bits to avoid overflows.</span>
<a name="l00454"></a>00454 <span class="comment">    */</span>
<a name="l00455"></a><a class="code" href="chan__usbradio_8c.html#a7b687e61ed66e74f77982bc22fd0c446">00455</a> <span class="preprocessor">#define  BOOST_SCALE (1&lt;&lt;9)</span>
<a name="l00456"></a><a class="code" href="chan__usbradio_8c.html#a54f5d9a8e570842ff9e4aac3157907c0">00456</a> <span class="preprocessor"></span><span class="preprocessor">#define  BOOST_MAX   40       </span><span class="comment">/* slightly less than 7 bits */</span>
<a name="l00457"></a><a class="code" href="structchan__usbradio__pvt.html#acd32205748f53b345085531047aefa00">00457</a>    <span class="keywordtype">int</span> <a class="code" href="structchan__usbradio__pvt.html#acd32205748f53b345085531047aefa00">boost</a>;              <span class="comment">/* input boost, scaled by BOOST_SCALE */</span>
<a name="l00458"></a><a class="code" href="structchan__usbradio__pvt.html#a7d942ce6a2ddec93dc13684d61b1750d">00458</a>    <span class="keywordtype">char</span> <a class="code" href="structchan__usbradio__pvt.html#a7d942ce6a2ddec93dc13684d61b1750d">devicenum</a>;
<a name="l00459"></a><a class="code" href="structchan__usbradio__pvt.html#ae0013a0ec03c2c35c2966c6aa3147abd">00459</a>    <span class="keywordtype">char</span> <a class="code" href="structchan__usbradio__pvt.html#ae0013a0ec03c2c35c2966c6aa3147abd">devstr</a>[128];
<a name="l00460"></a><a class="code" href="structchan__usbradio__pvt.html#a726770ecafcfd5375796acf427cde947">00460</a>    <span class="keywordtype">int</span> <a class="code" href="structchan__usbradio__pvt.html#a726770ecafcfd5375796acf427cde947">spkrmax</a>;
<a name="l00461"></a><a class="code" href="structchan__usbradio__pvt.html#ad73045328563e3ea5f9fbc8c3ce9ad09">00461</a>    <span class="keywordtype">int</span> <a class="code" href="structchan__usbradio__pvt.html#ad73045328563e3ea5f9fbc8c3ce9ad09">micmax</a>;
<a name="l00462"></a>00462 
<a name="l00463"></a>00463 <span class="preprocessor">#ifndef  NEW_ASTERISK</span>
<a name="l00464"></a>00464 <span class="preprocessor"></span>   pthread_t sthread;
<a name="l00465"></a>00465 <span class="preprocessor">#endif</span>
<a name="l00466"></a><a class="code" href="structchan__usbradio__pvt.html#a5825b205dd44a058bfe41b597755155b">00466</a> <span class="preprocessor"></span>   pthread_t <a class="code" href="structchan__usbradio__pvt.html#a5825b205dd44a058bfe41b597755155b">hidthread</a>;
<a name="l00467"></a>00467 
<a name="l00468"></a><a class="code" href="structchan__usbradio__pvt.html#a81ba3b4ebe2534f4cfc69a57a2d7debe">00468</a>    <span class="keywordtype">int</span> <a class="code" href="structchan__usbradio__pvt.html#a81ba3b4ebe2534f4cfc69a57a2d7debe">stophid</a>;
<a name="l00469"></a><a class="code" href="structchan__usbradio__pvt.html#ac41e466f46d7d5edef034a776ea6c9cd">00469</a>    FILE *<a class="code" href="structchan__usbradio__pvt.html#ac41e466f46d7d5edef034a776ea6c9cd">hkickhid</a>;
<a name="l00470"></a>00470 
<a name="l00471"></a><a class="code" href="structchan__usbradio__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">00471</a>    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="structchan__usbradio__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;
<a name="l00472"></a><a class="code" href="structchan__usbradio__pvt.html#a1ad093b5bae14543eb7fe9f409d9c83b">00472</a>    <span class="keywordtype">char</span> <a class="code" href="structchan__usbradio__pvt.html#a1ad093b5bae14543eb7fe9f409d9c83b">ext</a>[<a class="code" href="channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a>];
<a name="l00473"></a><a class="code" href="structchan__usbradio__pvt.html#a02d0db19ebec1fa1e0d29bda775c1096">00473</a>    <span class="keywordtype">char</span> <a class="code" href="structchan__usbradio__pvt.html#a02d0db19ebec1fa1e0d29bda775c1096">ctx</a>[<a class="code" href="channel_8h.html#abcf1aea85b924e9cd605040b86241e2a">AST_MAX_CONTEXT</a>];
<a name="l00474"></a><a class="code" href="structchan__usbradio__pvt.html#adf416dc058363e2fd5750c77e2d78bee">00474</a>    <span class="keywordtype">char</span> <a class="code" href="structchan__usbradio__pvt.html#adf416dc058363e2fd5750c77e2d78bee">language</a>[<a class="code" href="channel_8h.html#a9238c3318ae8d3bea2cbbe1d1e459eb7">MAX_LANGUAGE</a>];
<a name="l00475"></a><a class="code" href="structchan__usbradio__pvt.html#a2916929201e1417f4ea335e9276aa382">00475</a>    <span class="keywordtype">char</span> <a class="code" href="structchan__usbradio__pvt.html#a2916929201e1417f4ea335e9276aa382">cid_name</a>[256];        <span class="comment">/*XXX */</span>
<a name="l00476"></a><a class="code" href="structchan__usbradio__pvt.html#a557b0d5a633c0a98162e973793689380">00476</a>    <span class="keywordtype">char</span> <a class="code" href="structchan__usbradio__pvt.html#a557b0d5a633c0a98162e973793689380">cid_num</a>[256];         <span class="comment">/*XXX */</span>
<a name="l00477"></a><a class="code" href="structchan__usbradio__pvt.html#af689da2b77d1265192a78a5b0994a1d5">00477</a>    <span class="keywordtype">char</span> <a class="code" href="structchan__usbradio__pvt.html#af689da2b77d1265192a78a5b0994a1d5">mohinterpret</a>[<a class="code" href="channel_8h.html#afb2ae2e53d6676f3ca44a98aa3f92a2c">MAX_MUSICCLASS</a>];
<a name="l00478"></a>00478 
<a name="l00479"></a>00479    <span class="comment">/* buffers used in usbradio_write, 2 per int by 2 channels by 6 times oversampling (48KS/s) */</span>
<a name="l00480"></a><a class="code" href="structchan__usbradio__pvt.html#acb14ce5d6a9719a07a3035c12f50a721">00480</a>    <span class="keywordtype">char</span> <a class="code" href="structchan__usbradio__pvt.html#acb14ce5d6a9719a07a3035c12f50a721">usbradio_write_buf</a>[<a class="code" href="chan__alsa_8c.html#af9b1b2ba12857a4bf11289dac8c5462d">FRAME_SIZE</a> * 2 * 2 * 6];    
<a name="l00481"></a><a class="code" href="structchan__usbradio__pvt.html#a1924c47e68051ef018be967998a4932d">00481</a>    <span class="keywordtype">char</span> <a class="code" href="structchan__usbradio__pvt.html#a1924c47e68051ef018be967998a4932d">usbradio_write_buf_1</a>[<a class="code" href="chan__alsa_8c.html#af9b1b2ba12857a4bf11289dac8c5462d">FRAME_SIZE</a> * 2 * 2* 6];
<a name="l00482"></a>00482 
<a name="l00483"></a><a class="code" href="structchan__usbradio__pvt.html#ab837acb75fa579ebfad5014e50bafd9a">00483</a>    <span class="keywordtype">int</span> <a class="code" href="structchan__usbradio__pvt.html#ab837acb75fa579ebfad5014e50bafd9a">usbradio_write_dst</a>;
<a name="l00484"></a>00484    <span class="comment">/* buffers used in usbradio_read - AST_FRIENDLY_OFFSET space for headers</span>
<a name="l00485"></a>00485 <span class="comment">    * plus enough room for a full frame</span>
<a name="l00486"></a>00486 <span class="comment">    */</span>
<a name="l00487"></a><a class="code" href="structchan__usbradio__pvt.html#a738bd0c9fee5e7ccf37f2a7cf84662e1">00487</a>    <span class="keywordtype">char</span> <a class="code" href="structchan__usbradio__pvt.html#a738bd0c9fee5e7ccf37f2a7cf84662e1">usbradio_read_buf</a>[<a class="code" href="chan__alsa_8c.html#af9b1b2ba12857a4bf11289dac8c5462d">FRAME_SIZE</a> * (2 * 12) + <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>];
<a name="l00488"></a><a class="code" href="structchan__usbradio__pvt.html#a811d09a2bb7bdac7f3d06c292ba2bf82">00488</a>    <span class="keywordtype">char</span> <a class="code" href="structchan__usbradio__pvt.html#a811d09a2bb7bdac7f3d06c292ba2bf82">usbradio_read_buf_8k</a>[<a class="code" href="chan__alsa_8c.html#af9b1b2ba12857a4bf11289dac8c5462d">FRAME_SIZE</a> * 2 + <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>];
<a name="l00489"></a><a class="code" href="structchan__usbradio__pvt.html#a6bf189efc18e1f2c352c562b85bf851f">00489</a>    <span class="keywordtype">int</span> <a class="code" href="structchan__usbradio__pvt.html#a6bf189efc18e1f2c352c562b85bf851f">readpos</a>;            <span class="comment">/* read position above */</span>
<a name="l00490"></a><a class="code" href="structchan__usbradio__pvt.html#ae76466f730a632fe0cbebdf16c61d228">00490</a>    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> <a class="code" href="structchan__usbradio__pvt.html#ae76466f730a632fe0cbebdf16c61d228">read_f</a>;   <span class="comment">/* returned by usbradio_read */</span>
<a name="l00491"></a>00491 
<a name="l00492"></a><a class="code" href="structchan__usbradio__pvt.html#a8bc52eafdec6e1ab31955b8e407746ba">00492</a>    <span class="keywordtype">char</span>  <a class="code" href="structchan__usbradio__pvt.html#a8bc52eafdec6e1ab31955b8e407746ba">debuglevel</a>;
<a name="l00493"></a><a class="code" href="structchan__usbradio__pvt.html#a49cf136c1442f0e05adaf095f3dfb06d">00493</a>    <span class="keywordtype">char</span>  <a class="code" href="structchan__usbradio__pvt.html#a49cf136c1442f0e05adaf095f3dfb06d">radioduplex</a>;         <span class="comment">// </span>
<a name="l00494"></a><a class="code" href="structchan__usbradio__pvt.html#ae6df055b2352a39c3f2f781a17c6ba62">00494</a>    <span class="keywordtype">char</span>    <a class="code" href="structchan__usbradio__pvt.html#ae6df055b2352a39c3f2f781a17c6ba62">wanteeprom</a>;
<a name="l00495"></a>00495 
<a name="l00496"></a><a class="code" href="structchan__usbradio__pvt.html#a7fd8a8f77cb943a60709a60b82af18cd">00496</a>    <span class="keywordtype">int</span>   <a class="code" href="structchan__usbradio__pvt.html#a7fd8a8f77cb943a60709a60b82af18cd">tracetype</a>;
<a name="l00497"></a><a class="code" href="structchan__usbradio__pvt.html#ad04598f0e808d02ac2f9d27f8f3ced05">00497</a>    <span class="keywordtype">int</span>     <a class="code" href="structchan__usbradio__pvt.html#ad04598f0e808d02ac2f9d27f8f3ced05">tracelevel</a>;
<a name="l00498"></a><a class="code" href="structchan__usbradio__pvt.html#aa4e3a1097557045b9c15a09117871dc7">00498</a>    <span class="keywordtype">char</span>    <a class="code" href="structchan__usbradio__pvt.html#aa4e3a1097557045b9c15a09117871dc7">area</a>;
<a name="l00499"></a><a class="code" href="structchan__usbradio__pvt.html#a82b1c271bbb3d4dab02712eb367e72e3">00499</a>    <span class="keywordtype">char</span>  <a class="code" href="structchan__usbradio__pvt.html#a82b1c271bbb3d4dab02712eb367e72e3">rptnum</a>;
<a name="l00500"></a><a class="code" href="structchan__usbradio__pvt.html#ad45b11585c85aeaafbc94e28684c3e85">00500</a>    <span class="keywordtype">int</span>     <a class="code" href="structchan__usbradio__pvt.html#ad45b11585c85aeaafbc94e28684c3e85">idleinterval</a>;
<a name="l00501"></a><a class="code" href="structchan__usbradio__pvt.html#aaf7419abda44cc59ccdbadacf6a250a9">00501</a>    <span class="keywordtype">int</span>      <a class="code" href="structchan__usbradio__pvt.html#aaf7419abda44cc59ccdbadacf6a250a9">turnoffs</a>;
<a name="l00502"></a><a class="code" href="structchan__usbradio__pvt.html#a4dbf7524c8b604e6ccc0823482472217">00502</a>    <span class="keywordtype">int</span>   <a class="code" href="structchan__usbradio__pvt.html#a4dbf7524c8b604e6ccc0823482472217">txsettletime</a>;
<a name="l00503"></a><a class="code" href="structchan__usbradio__pvt.html#a831424615eef40aa8601615107391569">00503</a>    <span class="keywordtype">char</span>    <a class="code" href="structchan__usbradio__pvt.html#a831424615eef40aa8601615107391569">ukey</a>[48];
<a name="l00504"></a>00504 
<a name="l00505"></a><a class="code" href="structchan__usbradio__pvt.html#adde6596829678336b403631181c14365">00505</a>    <span class="keywordtype">char</span> <a class="code" href="structchan__usbradio__pvt.html#adde6596829678336b403631181c14365">lastrx</a>;
<a name="l00506"></a><a class="code" href="structchan__usbradio__pvt.html#a31415c43e2f6cb3eefc6f0b86dec2b21">00506</a>    <span class="keywordtype">char</span> <a class="code" href="structchan__usbradio__pvt.html#a31415c43e2f6cb3eefc6f0b86dec2b21">rxhidsq</a>;
<a name="l00507"></a><a class="code" href="structchan__usbradio__pvt.html#a30bba200e14359fdf104099a69034d02">00507</a>    <span class="keywordtype">char</span> <a class="code" href="structchan__usbradio__pvt.html#a30bba200e14359fdf104099a69034d02">rxcarrierdetect</a>;      <span class="comment">// status from pmr channel</span>
<a name="l00508"></a><a class="code" href="structchan__usbradio__pvt.html#ae1ce53e0b0e78d89254782c9a2bcfe0d">00508</a>    <span class="keywordtype">char</span> <a class="code" href="structchan__usbradio__pvt.html#ae1ce53e0b0e78d89254782c9a2bcfe0d">rxctcssdecode</a>;        <span class="comment">// status from pmr channel</span>
<a name="l00509"></a>00509 
<a name="l00510"></a><a class="code" href="structchan__usbradio__pvt.html#a938f3e7db5867fc985b1b1ba581e3838">00510</a>    <span class="keywordtype">int</span>  <a class="code" href="structchan__usbradio__pvt.html#a938f3e7db5867fc985b1b1ba581e3838">rxdcsdecode</a>;
<a name="l00511"></a><a class="code" href="structchan__usbradio__pvt.html#a0ba847ffbd7b9929dc5022c3e25ffde1">00511</a>    <span class="keywordtype">int</span>  <a class="code" href="structchan__usbradio__pvt.html#a0ba847ffbd7b9929dc5022c3e25ffde1">rxlsddecode</a>;
<a name="l00512"></a>00512 
<a name="l00513"></a><a class="code" href="structchan__usbradio__pvt.html#a310ebcba47f995164c905b62c7b25151">00513</a>    <span class="keywordtype">char</span> <a class="code" href="structchan__usbradio__pvt.html#a310ebcba47f995164c905b62c7b25151">rxkeytype</a>;
<a name="l00514"></a><a class="code" href="structchan__usbradio__pvt.html#a9ffbd20ba016d188e8447f13a368bfe4">00514</a>    <span class="keywordtype">char</span> <a class="code" href="structchan__usbradio__pvt.html#a9ffbd20ba016d188e8447f13a368bfe4">rxkeyed</a>;           <span class="comment">// indicates rx signal present</span>
<a name="l00515"></a>00515 
<a name="l00516"></a><a class="code" href="structchan__usbradio__pvt.html#ae7c1bd7aa1c831e7d13648fd13e1b6a6">00516</a>    <span class="keywordtype">char</span> <a class="code" href="structchan__usbradio__pvt.html#ae7c1bd7aa1c831e7d13648fd13e1b6a6">lasttx</a>;
<a name="l00517"></a><a class="code" href="structchan__usbradio__pvt.html#ab567e67bb38d5cb120f53e25d709377f">00517</a>    <span class="keywordtype">char</span> <a class="code" href="structchan__usbradio__pvt.html#ab567e67bb38d5cb120f53e25d709377f">txkeyed</a>;           <span class="comment">// tx key request from upper layers </span>
<a name="l00518"></a><a class="code" href="structchan__usbradio__pvt.html#a61103af29ce88bb2c37a97fee4c37cea">00518</a>    <span class="keywordtype">char</span> <a class="code" href="structchan__usbradio__pvt.html#a61103af29ce88bb2c37a97fee4c37cea">txchankey</a>;
<a name="l00519"></a><a class="code" href="structchan__usbradio__pvt.html#a633a737f50a6fd3c20783e59ada69952">00519</a>    <span class="keywordtype">char</span> <a class="code" href="structchan__usbradio__pvt.html#a633a737f50a6fd3c20783e59ada69952">txtestkey</a>;
<a name="l00520"></a>00520 
<a name="l00521"></a><a class="code" href="structchan__usbradio__pvt.html#ad1acec14ee8fb8cd2c5ec8d095029f91">00521</a>    time_t <a class="code" href="structchan__usbradio__pvt.html#ad1acec14ee8fb8cd2c5ec8d095029f91">lasthidtime</a>;
<a name="l00522"></a><a class="code" href="structchan__usbradio__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d">00522</a>     <span class="keyword">struct </span><a class="code" href="structast__dsp.html">ast_dsp</a> *<a class="code" href="structchan__usbradio__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d">dsp</a>;
<a name="l00523"></a>00523 
<a name="l00524"></a><a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">00524</a>    t_pmr_chan  *<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>;
<a name="l00525"></a>00525 
<a name="l00526"></a><a class="code" href="structchan__usbradio__pvt.html#ac1ba9d4ea02ed0233e32f29f904ba717">00526</a>    <span class="keywordtype">char</span>    <a class="code" href="structchan__usbradio__pvt.html#ac1ba9d4ea02ed0233e32f29f904ba717">rxcpusaver</a>;
<a name="l00527"></a><a class="code" href="structchan__usbradio__pvt.html#a599ff3f902292ed29218ddea9ec3945e">00527</a>    <span class="keywordtype">char</span>    <a class="code" href="structchan__usbradio__pvt.html#a599ff3f902292ed29218ddea9ec3945e">txcpusaver</a>;
<a name="l00528"></a>00528 
<a name="l00529"></a><a class="code" href="structchan__usbradio__pvt.html#a192b610a400b0092bbf865fa8cd60a44">00529</a>    <span class="keywordtype">char</span>  <a class="code" href="structchan__usbradio__pvt.html#a192b610a400b0092bbf865fa8cd60a44">rxdemod</a>;
<a name="l00530"></a><a class="code" href="structchan__usbradio__pvt.html#aeebb464c72892c9f3ddafed5ade720ee">00530</a>    <span class="keywordtype">float</span> <a class="code" href="structchan__usbradio__pvt.html#aeebb464c72892c9f3ddafed5ade720ee">rxgain</a>;
<a name="l00531"></a><a class="code" href="structchan__usbradio__pvt.html#af7351b2441759672562708b11cd8fedd">00531</a>    <span class="keywordtype">char</span>  <a class="code" href="structchan__usbradio__pvt.html#af7351b2441759672562708b11cd8fedd">rxcdtype</a>;
<a name="l00532"></a><a class="code" href="structchan__usbradio__pvt.html#aeb14af6032352ae6255ee5a59bd10d55">00532</a>    <span class="keywordtype">char</span>  <a class="code" href="structchan__usbradio__pvt.html#aeb14af6032352ae6255ee5a59bd10d55">rxsdtype</a>;
<a name="l00533"></a><a class="code" href="structchan__usbradio__pvt.html#a1745424fe0dd99b7d3a778a253a5d686">00533</a>    <span class="keywordtype">int</span>      <a class="code" href="structchan__usbradio__pvt.html#a1745424fe0dd99b7d3a778a253a5d686">rxsquelchadj</a>;   <span class="comment">/* this copy needs to be here for initialization */</span>
<a name="l00534"></a><a class="code" href="structchan__usbradio__pvt.html#a4dc1e577c75292544b37eb803938b63b">00534</a>    <span class="keywordtype">int</span>     <a class="code" href="structchan__usbradio__pvt.html#a4dc1e577c75292544b37eb803938b63b">rxsqvoxadj</a>;
<a name="l00535"></a><a class="code" href="structchan__usbradio__pvt.html#a543f5a1359459a66235d463f755245e3">00535</a>    <span class="keywordtype">char</span>  <a class="code" href="structchan__usbradio__pvt.html#a543f5a1359459a66235d463f755245e3">txtoctype</a>;
<a name="l00536"></a>00536 
<a name="l00537"></a><a class="code" href="structchan__usbradio__pvt.html#ad75faa99a995d1f7847a2c0ae50b58df">00537</a>    <span class="keywordtype">char</span>    <a class="code" href="structchan__usbradio__pvt.html#ad75faa99a995d1f7847a2c0ae50b58df">txprelim</a>;
<a name="l00538"></a><a class="code" href="structchan__usbradio__pvt.html#a152ab82812cdc27d72fa4384f1c7358d">00538</a>    <span class="keywordtype">float</span> <a class="code" href="structchan__usbradio__pvt.html#a152ab82812cdc27d72fa4384f1c7358d">txctcssgain</a>;
<a name="l00539"></a><a class="code" href="structchan__usbradio__pvt.html#a95a57d28620e96b54f510eb9a543ddfc">00539</a>    <span class="keywordtype">char</span>  <a class="code" href="structchan__usbradio__pvt.html#a95a57d28620e96b54f510eb9a543ddfc">txmixa</a>;
<a name="l00540"></a><a class="code" href="structchan__usbradio__pvt.html#a6cf7fb2913ee1a3c50247dd8f6ea32a4">00540</a>    <span class="keywordtype">char</span>  <a class="code" href="structchan__usbradio__pvt.html#a6cf7fb2913ee1a3c50247dd8f6ea32a4">txmixb</a>;
<a name="l00541"></a>00541 
<a name="l00542"></a><a class="code" href="structchan__usbradio__pvt.html#a16bef002aa5c9dc00ccd30bd1638cd73">00542</a>    <span class="keywordtype">char</span>  <a class="code" href="structchan__usbradio__pvt.html#a16bef002aa5c9dc00ccd30bd1638cd73">invertptt</a>;
<a name="l00543"></a>00543 
<a name="l00544"></a><a class="code" href="structchan__usbradio__pvt.html#a0ef47a421f5dd8fd85a847519642615f">00544</a>    <span class="keywordtype">char</span>  <a class="code" href="structchan__usbradio__pvt.html#a0ef47a421f5dd8fd85a847519642615f">rxctcssrelax</a>;
<a name="l00545"></a><a class="code" href="structchan__usbradio__pvt.html#ae74884485b958f7397852bbd8b5423e1">00545</a>    <span class="keywordtype">float</span> <a class="code" href="structchan__usbradio__pvt.html#ae74884485b958f7397852bbd8b5423e1">rxctcssgain</a>;
<a name="l00546"></a>00546 
<a name="l00547"></a><a class="code" href="structchan__usbradio__pvt.html#aac82d4d77ee6a45db6720b0a47f9f052">00547</a>    <span class="keywordtype">char</span>    <a class="code" href="structchan__usbradio__pvt.html#aac82d4d77ee6a45db6720b0a47f9f052">txctcssdefault</a>[16];            <span class="comment">// for repeater operation</span>
<a name="l00548"></a><a class="code" href="structchan__usbradio__pvt.html#af828234faebaeded2f34d586b3402407">00548</a>    <span class="keywordtype">char</span>  <a class="code" href="structchan__usbradio__pvt.html#af828234faebaeded2f34d586b3402407">rxctcssfreqs</a>[512];            <span class="comment">// a string</span>
<a name="l00549"></a><a class="code" href="structchan__usbradio__pvt.html#af02b209a6fcc5a72be847eb6ff43a200">00549</a>    <span class="keywordtype">char</span>    <a class="code" href="structchan__usbradio__pvt.html#af02b209a6fcc5a72be847eb6ff43a200">txctcssfreqs</a>[512];
<a name="l00550"></a>00550 
<a name="l00551"></a><a class="code" href="structchan__usbradio__pvt.html#a020b18a1a2da0a7290a6ad0547ff1070">00551</a>    <span class="keywordtype">char</span>  <a class="code" href="structchan__usbradio__pvt.html#a020b18a1a2da0a7290a6ad0547ff1070">txctcssfreq</a>[32];           <span class="comment">// encode now</span>
<a name="l00552"></a><a class="code" href="structchan__usbradio__pvt.html#a9a1d72568062b00a6c0908bbee9a3f9b">00552</a>    <span class="keywordtype">char</span>  <a class="code" href="structchan__usbradio__pvt.html#a9a1d72568062b00a6c0908bbee9a3f9b">rxctcssfreq</a>[32];           <span class="comment">// decode now</span>
<a name="l00553"></a>00553 
<a name="l00554"></a><a class="code" href="structchan__usbradio__pvt.html#a460732a473feeae83d1e9236060f92e6">00554</a>    <span class="keywordtype">char</span>    <a class="code" href="structchan__usbradio__pvt.html#a460732a473feeae83d1e9236060f92e6">numrxctcssfreqs</a>;            <span class="comment">// how many</span>
<a name="l00555"></a><a class="code" href="structchan__usbradio__pvt.html#a072cec432beeeb7f5f7482b84b425930">00555</a>    <span class="keywordtype">char</span>    <a class="code" href="structchan__usbradio__pvt.html#a072cec432beeeb7f5f7482b84b425930">numtxctcssfreqs</a>;
<a name="l00556"></a>00556 
<a name="l00557"></a><a class="code" href="structchan__usbradio__pvt.html#aa0ae57dfcf5f6bbd63240001a9db1367">00557</a>    <span class="keywordtype">char</span>    *<a class="code" href="structchan__usbradio__pvt.html#aa0ae57dfcf5f6bbd63240001a9db1367">rxctcss</a>[CTCSS_NUM_CODES];     <span class="comment">// pointers to strings</span>
<a name="l00558"></a><a class="code" href="structchan__usbradio__pvt.html#af788c8332d3a734b5bcc78ce098f9bf4">00558</a>    <span class="keywordtype">char</span>    *<a class="code" href="structchan__usbradio__pvt.html#af788c8332d3a734b5bcc78ce098f9bf4">txctcss</a>[CTCSS_NUM_CODES];
<a name="l00559"></a>00559 
<a name="l00560"></a><a class="code" href="structchan__usbradio__pvt.html#aeef37cee21cac9eb3f9d12ff7ddad450">00560</a>    <span class="keywordtype">int</span>      <a class="code" href="structchan__usbradio__pvt.html#aeef37cee21cac9eb3f9d12ff7ddad450">txfreq</a>;                    <span class="comment">// in Hz</span>
<a name="l00561"></a><a class="code" href="structchan__usbradio__pvt.html#a7033bb3c7ea0c75b12123d732c0ae023">00561</a>    <span class="keywordtype">int</span>     <a class="code" href="structchan__usbradio__pvt.html#a7033bb3c7ea0c75b12123d732c0ae023">rxfreq</a>;
<a name="l00562"></a>00562 
<a name="l00563"></a>00563    <span class="comment">//       start remote operation info</span>
<a name="l00564"></a><a class="code" href="structchan__usbradio__pvt.html#aefc7b481c241afc76ed37d2c3fe2695d">00564</a>    <span class="keywordtype">char</span>    <a class="code" href="structchan__usbradio__pvt.html#aefc7b481c241afc76ed37d2c3fe2695d">set_txctcssdefault</a>[16];           <span class="comment">// for remote operation</span>
<a name="l00565"></a><a class="code" href="structchan__usbradio__pvt.html#a7299f26437842448ed0b2695ae32132c">00565</a>    <span class="keywordtype">char</span>  <a class="code" href="structchan__usbradio__pvt.html#a7299f26437842448ed0b2695ae32132c">set_txctcssfreq</a>[16];          <span class="comment">// encode now</span>
<a name="l00566"></a><a class="code" href="structchan__usbradio__pvt.html#a037dfeabbea7b1c40781bf6ab8bf13ba">00566</a>    <span class="keywordtype">char</span>  <a class="code" href="structchan__usbradio__pvt.html#a037dfeabbea7b1c40781bf6ab8bf13ba">set_rxctcssfreq</a>[16];          <span class="comment">// decode now</span>
<a name="l00567"></a>00567 
<a name="l00568"></a><a class="code" href="structchan__usbradio__pvt.html#a99385a6b06571bb9e86a8e289868d252">00568</a>    <span class="keywordtype">char</span>    <a class="code" href="structchan__usbradio__pvt.html#a99385a6b06571bb9e86a8e289868d252">set_numrxctcssfreqs</a>;           <span class="comment">// how many</span>
<a name="l00569"></a><a class="code" href="structchan__usbradio__pvt.html#a6057d780b74b0877a6b91f9883fa0816">00569</a>    <span class="keywordtype">char</span>    <a class="code" href="structchan__usbradio__pvt.html#a6057d780b74b0877a6b91f9883fa0816">set_numtxctcssfreqs</a>;
<a name="l00570"></a>00570 
<a name="l00571"></a><a class="code" href="structchan__usbradio__pvt.html#a36bb704870959c8638d2a7f438ce528e">00571</a>    <span class="keywordtype">char</span>  <a class="code" href="structchan__usbradio__pvt.html#a36bb704870959c8638d2a7f438ce528e">set_rxctcssfreqs</a>[16];            <span class="comment">// a string</span>
<a name="l00572"></a><a class="code" href="structchan__usbradio__pvt.html#a9df6c1ad2df4cdc5c71c38034d5d2c9c">00572</a>    <span class="keywordtype">char</span>    <a class="code" href="structchan__usbradio__pvt.html#a9df6c1ad2df4cdc5c71c38034d5d2c9c">set_txctcssfreqs</a>[16];
<a name="l00573"></a>00573 
<a name="l00574"></a><a class="code" href="structchan__usbradio__pvt.html#aed71bf4b74fd1a3e1eab681448f1e8f8">00574</a>    <span class="keywordtype">char</span>    *<a class="code" href="structchan__usbradio__pvt.html#aed71bf4b74fd1a3e1eab681448f1e8f8">set_rxctcss</a>;                   <span class="comment">// pointers to strings</span>
<a name="l00575"></a><a class="code" href="structchan__usbradio__pvt.html#a4dd67e6147a5d1f0738ee49ad3881481">00575</a>    <span class="keywordtype">char</span>    *<a class="code" href="structchan__usbradio__pvt.html#a4dd67e6147a5d1f0738ee49ad3881481">set_txctcss</a>;
<a name="l00576"></a>00576 
<a name="l00577"></a><a class="code" href="structchan__usbradio__pvt.html#a2c0e6eb590cb812c4b03c7a57be9656e">00577</a>    <span class="keywordtype">int</span>      <a class="code" href="structchan__usbradio__pvt.html#a2c0e6eb590cb812c4b03c7a57be9656e">set_txfreq</a>;                   <span class="comment">// in Hz</span>
<a name="l00578"></a><a class="code" href="structchan__usbradio__pvt.html#a0bafa0a226e4538d6f64cd522580d1cd">00578</a>    <span class="keywordtype">int</span>     <a class="code" href="structchan__usbradio__pvt.html#a0bafa0a226e4538d6f64cd522580d1cd">set_rxfreq</a>;
<a name="l00579"></a>00579    <span class="comment">//       end remote operation info</span>
<a name="l00580"></a>00580 
<a name="l00581"></a><a class="code" href="structchan__usbradio__pvt.html#a959ccc7bd4988d55f4115fd5b13e236e">00581</a>    <span class="keywordtype">int</span>         <a class="code" href="structchan__usbradio__pvt.html#a959ccc7bd4988d55f4115fd5b13e236e">rxmixerset</a>;       
<a name="l00582"></a><a class="code" href="structchan__usbradio__pvt.html#a2c9642c08c9342104a689c6bacff9160">00582</a>    <span class="keywordtype">int</span>   <a class="code" href="structchan__usbradio__pvt.html#a2c9642c08c9342104a689c6bacff9160">rxboostset</a>;
<a name="l00583"></a><a class="code" href="structchan__usbradio__pvt.html#a0d9da32dc6edbbd18f90722056331b65">00583</a>    <span class="keywordtype">float</span> <a class="code" href="structchan__usbradio__pvt.html#a0d9da32dc6edbbd18f90722056331b65">rxvoiceadj</a>;
<a name="l00584"></a><a class="code" href="structchan__usbradio__pvt.html#a0da461807e1a48746fd856ae6aa21499">00584</a>    <span class="keywordtype">float</span> <a class="code" href="structchan__usbradio__pvt.html#a0da461807e1a48746fd856ae6aa21499">rxctcssadj</a>;
<a name="l00585"></a><a class="code" href="structchan__usbradio__pvt.html#a5dca179fe41743d80bd66e6a21de9fac">00585</a>    <span class="keywordtype">int</span>   <a class="code" href="structchan__usbradio__pvt.html#a5dca179fe41743d80bd66e6a21de9fac">txmixaset</a>;
<a name="l00586"></a><a class="code" href="structchan__usbradio__pvt.html#ac2c2424ad6a5ca0a0c6f7026e74d7701">00586</a>    <span class="keywordtype">int</span>   <a class="code" href="structchan__usbradio__pvt.html#ac2c2424ad6a5ca0a0c6f7026e74d7701">txmixbset</a>;
<a name="l00587"></a><a class="code" href="structchan__usbradio__pvt.html#af559c722569892f0612ff5c65493fe7a">00587</a>    <span class="keywordtype">int</span>     <a class="code" href="structchan__usbradio__pvt.html#af559c722569892f0612ff5c65493fe7a">txctcssadj</a>;
<a name="l00588"></a>00588 
<a name="l00589"></a><a class="code" href="structchan__usbradio__pvt.html#a7d71a2812f8777ec95ca963a743f6f77">00589</a>    <span class="keywordtype">int</span>      <a class="code" href="structchan__usbradio__pvt.html#a7d71a2812f8777ec95ca963a743f6f77">hdwtype</a>;
<a name="l00590"></a><a class="code" href="structchan__usbradio__pvt.html#a4daaa2a04c1f3cef618b8f7f2b2dbc66">00590</a>    <span class="keywordtype">int</span>      <a class="code" href="structchan__usbradio__pvt.html#a4daaa2a04c1f3cef618b8f7f2b2dbc66">hid_gpio_ctl</a>;     
<a name="l00591"></a><a class="code" href="structchan__usbradio__pvt.html#a24fbd2c9b0fc7e56bcb66e0499333fec">00591</a>    <span class="keywordtype">int</span>      <a class="code" href="structchan__usbradio__pvt.html#a24fbd2c9b0fc7e56bcb66e0499333fec">hid_gpio_ctl_loc</a>; 
<a name="l00592"></a><a class="code" href="structchan__usbradio__pvt.html#a7024a18b225ef731da6391ef59ffa0c1">00592</a>    <span class="keywordtype">int</span>      <a class="code" href="structchan__usbradio__pvt.html#a7024a18b225ef731da6391ef59ffa0c1">hid_io_cor</a>;       
<a name="l00593"></a><a class="code" href="structchan__usbradio__pvt.html#a0b6a895a9ef97321dfc53b56734efa20">00593</a>    <span class="keywordtype">int</span>      <a class="code" href="structchan__usbradio__pvt.html#a0b6a895a9ef97321dfc53b56734efa20">hid_io_cor_loc</a>;   
<a name="l00594"></a><a class="code" href="structchan__usbradio__pvt.html#a35363a0a3cf14f328c282aab15cee673">00594</a>    <span class="keywordtype">int</span>      <a class="code" href="structchan__usbradio__pvt.html#a35363a0a3cf14f328c282aab15cee673">hid_io_ctcss</a>;     
<a name="l00595"></a><a class="code" href="structchan__usbradio__pvt.html#a33d091fd8ddcd75e8db6c411e388558a">00595</a>    <span class="keywordtype">int</span>      <a class="code" href="structchan__usbradio__pvt.html#a33d091fd8ddcd75e8db6c411e388558a">hid_io_ctcss_loc</a>;    
<a name="l00596"></a><a class="code" href="structchan__usbradio__pvt.html#a986fd9e827a7571882f177c9b5598951">00596</a>    <span class="keywordtype">int</span>      <a class="code" href="structchan__usbradio__pvt.html#a986fd9e827a7571882f177c9b5598951">hid_io_ptt</a>;       
<a name="l00597"></a><a class="code" href="structchan__usbradio__pvt.html#afc21a1f1175ad7a1b6c3db6a23382ad4">00597</a>    <span class="keywordtype">int</span>      <a class="code" href="structchan__usbradio__pvt.html#afc21a1f1175ad7a1b6c3db6a23382ad4">hid_gpio_loc</a>;     
<a name="l00598"></a>00598 
<a name="l00599"></a>00599    <span class="keyword">struct </span>{
<a name="l00600"></a><a class="code" href="structchan__usbradio__pvt.html#a34f93defb00c007bb028c2fa93eac568">00600</a>        <span class="keywordtype">unsigned</span> <a class="code" href="structchan__usbradio__pvt.html#a34f93defb00c007bb028c2fa93eac568">rxcapraw</a>:1;
<a name="l00601"></a><a class="code" href="structchan__usbradio__pvt.html#a73d52d82e0d9d59647ad56302b908aa9">00601</a>       <span class="keywordtype">unsigned</span> <a class="code" href="structchan__usbradio__pvt.html#a73d52d82e0d9d59647ad56302b908aa9">txcapraw</a>:1;
<a name="l00602"></a><a class="code" href="structchan__usbradio__pvt.html#ae4e34f0e79fb4c42c3833cf4e3d44b70">00602</a>       <span class="keywordtype">unsigned</span> <a class="code" href="structchan__usbradio__pvt.html#ae4e34f0e79fb4c42c3833cf4e3d44b70">txcap2</a>:1;
<a name="l00603"></a><a class="code" href="structchan__usbradio__pvt.html#a0ffa6929db958c59e281798973c4ca2f">00603</a>       <span class="keywordtype">unsigned</span> <a class="code" href="structchan__usbradio__pvt.html#a0ffa6929db958c59e281798973c4ca2f">rxcap2</a>:1;
<a name="l00604"></a><a class="code" href="structchan__usbradio__pvt.html#a8387d78998b5c0b47bc17c291cac0739">00604</a>       <span class="keywordtype">unsigned</span> <a class="code" href="structchan__usbradio__pvt.html#a8387d78998b5c0b47bc17c291cac0739">rxplmon</a>:1;
<a name="l00605"></a><a class="code" href="structchan__usbradio__pvt.html#aef7ddb05106487178eb92abe88289e7f">00605</a>       <span class="keywordtype">unsigned</span> <a class="code" href="structchan__usbradio__pvt.html#aef7ddb05106487178eb92abe88289e7f">remoted</a>:1;
<a name="l00606"></a><a class="code" href="structchan__usbradio__pvt.html#a0501683ef8fd346ebdb84ca5cef9d8e8">00606</a>       <span class="keywordtype">unsigned</span> <a class="code" href="structchan__usbradio__pvt.html#a0501683ef8fd346ebdb84ca5cef9d8e8">txpolarity</a>:1;
<a name="l00607"></a><a class="code" href="structchan__usbradio__pvt.html#a8b35b6a9c58966a7570a6fde53c7d0b0">00607</a>       <span class="keywordtype">unsigned</span> <a class="code" href="structchan__usbradio__pvt.html#a8b35b6a9c58966a7570a6fde53c7d0b0">rxpolarity</a>:1;
<a name="l00608"></a><a class="code" href="structchan__usbradio__pvt.html#a8ce5dca9e30b5221ff181bda9359cfe3">00608</a>       <span class="keywordtype">unsigned</span> <a class="code" href="structchan__usbradio__pvt.html#a8ce5dca9e30b5221ff181bda9359cfe3">dcstxpolarity</a>:1;
<a name="l00609"></a><a class="code" href="structchan__usbradio__pvt.html#a90c8f70a4bf3a7bd25bc953b500a2769">00609</a>       <span class="keywordtype">unsigned</span> <a class="code" href="structchan__usbradio__pvt.html#a90c8f70a4bf3a7bd25bc953b500a2769">dcsrxpolarity</a>:1;
<a name="l00610"></a><a class="code" href="structchan__usbradio__pvt.html#ab175352db5d8fda4b8d7de3032cfa617">00610</a>       <span class="keywordtype">unsigned</span> <a class="code" href="structchan__usbradio__pvt.html#ab175352db5d8fda4b8d7de3032cfa617">lsdtxpolarity</a>:1;
<a name="l00611"></a><a class="code" href="structchan__usbradio__pvt.html#a17edb8653d5bca21fced0355dba0cd74">00611</a>       <span class="keywordtype">unsigned</span> <a class="code" href="structchan__usbradio__pvt.html#a17edb8653d5bca21fced0355dba0cd74">lsdrxpolarity</a>:1;
<a name="l00612"></a><a class="code" href="structchan__usbradio__pvt.html#a7e490416a9c7a4cd16c20073ebb848c0">00612</a>       <span class="keywordtype">unsigned</span> <a class="code" href="structchan__usbradio__pvt.html#a7e490416a9c7a4cd16c20073ebb848c0">loopback</a>:1;
<a name="l00613"></a><a class="code" href="structchan__usbradio__pvt.html#a698a1a571ceec928fdfc1f04b5ddd4c3">00613</a>       <span class="keywordtype">unsigned</span> <a class="code" href="structchan__usbradio__pvt.html#a698a1a571ceec928fdfc1f04b5ddd4c3">radioactive</a>:1;
<a name="l00614"></a>00614    }<a class="code" href="structchan__usbradio__pvt.html#a933ce66d291cb7d99d8693683d0a3f7d">b</a>;
<a name="l00615"></a><a class="code" href="structchan__usbradio__pvt.html#ac31262f80afbd912435464107e0d054d">00615</a>    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="structchan__usbradio__pvt.html#ac31262f80afbd912435464107e0d054d">eeprom</a>[<a class="code" href="chan__usbradio_8c.html#a35ad18646ea93da91a36062f911d949a">EEPROM_PHYSICAL_LEN</a>];
<a name="l00616"></a><a class="code" href="structchan__usbradio__pvt.html#aa4c4270e4903db2dcb2ee7e3a7966ca3">00616</a>    <span class="keywordtype">char</span> <a class="code" href="structchan__usbradio__pvt.html#aa4c4270e4903db2dcb2ee7e3a7966ca3">eepromctl</a>;
<a name="l00617"></a><a class="code" href="structchan__usbradio__pvt.html#a0cb029a4ba4ae628b6f5431a4cbb753f">00617</a>    <a class="code" href="lock_8h.html#a2d9118a2a8939f115eea771bce3a52f2">ast_mutex_t</a> <a class="code" href="structchan__usbradio__pvt.html#a0cb029a4ba4ae628b6f5431a4cbb753f">eepromlock</a>;
<a name="l00618"></a>00618 
<a name="l00619"></a><a class="code" href="structchan__usbradio__pvt.html#a80347ac068869204dca84f4608f8ea09">00619</a>    <span class="keyword">struct </span>usb_dev_handle *<a class="code" href="structchan__usbradio__pvt.html#a80347ac068869204dca84f4608f8ea09">usb_handle</a>;
<a name="l00620"></a><a class="code" href="structchan__usbradio__pvt.html#acd3415bdb0bfcdbc03825a1f6a2678c3">00620</a>    <span class="keywordtype">int</span> <a class="code" href="structchan__usbradio__pvt.html#acd3415bdb0bfcdbc03825a1f6a2678c3">readerrs</a>;
<a name="l00621"></a>00621 };
<a name="l00622"></a>00622 
<a name="l00623"></a>00623 <span class="comment">// maw add additional defaults !!!</span>
<a name="l00624"></a><a class="code" href="chan__usbradio_8c.html#aa37d3d44ac986c017204de5f3681ae54">00624</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> <a class="code" href="chan__usbradio_8c.html#aa37d3d44ac986c017204de5f3681ae54">usbradio_default</a> = {
<a name="l00625"></a>00625 <span class="preprocessor">#ifndef  NEW_ASTERISK</span>
<a name="l00626"></a>00626 <span class="preprocessor"></span>   .cursound = -1,
<a name="l00627"></a>00627 <span class="preprocessor">#endif</span>
<a name="l00628"></a>00628 <span class="preprocessor"></span>   .<a class="code" href="structchan__usbradio__pvt.html#ac3fb672ce98321ddfeba0b02fba73298">sounddev</a> = -1,
<a name="l00629"></a>00629    .duplex = <a class="code" href="structchan__usbradio__pvt.html#abe974f22edeef8189603ba75fd90ff3ca89ae3203603c2cd0eecb06b10597f94f">M_UNSET</a>,         <span class="comment">/* XXX check this */</span>
<a name="l00630"></a>00630    .autoanswer = 1,
<a name="l00631"></a>00631    .autohangup = 1,
<a name="l00632"></a>00632    .queuesize = <a class="code" href="chan__oss_8c.html#a142810068f1b99cd93d3fc9f0e160e02">QUEUE_SIZE</a>,
<a name="l00633"></a>00633    .frags = <a class="code" href="chan__oss_8c.html#a44f658797e1982f579580823c8fcf8f8">FRAGS</a>,
<a name="l00634"></a>00634    .ext = <span class="stringliteral">&quot;s&quot;</span>,
<a name="l00635"></a>00635    .ctx = <span class="stringliteral">&quot;default&quot;</span>,
<a name="l00636"></a>00636    .readpos = <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>,  <span class="comment">/* start here on reads */</span>
<a name="l00637"></a>00637    .lastopen = { 0, 0 },
<a name="l00638"></a>00638    .boost = <a class="code" href="chan__oss_8c.html#a7b687e61ed66e74f77982bc22fd0c446">BOOST_SCALE</a>,
<a name="l00639"></a>00639    .wanteeprom = 1,
<a name="l00640"></a>00640    .area = 0,
<a name="l00641"></a>00641    .rptnum = 0,
<a name="l00642"></a>00642 };
<a name="l00643"></a>00643 
<a name="l00644"></a>00644 <span class="comment">/* DECLARE FUNCTION PROTOTYPES   */</span>
<a name="l00645"></a>00645 
<a name="l00646"></a>00646 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__usbradio_8c.html#a6f6ab3f8ae560feac63fefa24e84c46b">store_txtoctype</a>(<span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o, <span class="keywordtype">char</span> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>);
<a name="l00647"></a>00647 <span class="keyword">static</span> <span class="keywordtype">int</span>  <a class="code" href="chan__usbradio_8c.html#a7dda562f378c1ca89125358f201373a0">hidhdwconfig</a>(<span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o);
<a name="l00648"></a>00648 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#abf334b349b8cb56932ef975dadfbb7df">set_txctcss_level</a>(<span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o);
<a name="l00649"></a>00649 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__usbradio_8c.html#a98be1c07bf1c76b0ede7c3cef6c21c4e">pmrdump</a>(<span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o);
<a name="l00650"></a>00650 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__usbradio_8c.html#acb41a83bcd08bfc92fb24c6ece7830c0">mult_set</a>(<span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o);
<a name="l00651"></a>00651 <span class="keyword">static</span> <span class="keywordtype">int</span>  <a class="code" href="chan__usbradio_8c.html#a4f3ff3365910baf3963bd847f8e7f962">mult_calc</a>(<span class="keywordtype">int</span> value);
<a name="l00652"></a>00652 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__usbradio_8c.html#aa2020bdc5a2688a4727e349befacb35d">mixer_write</a>(<span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o);
<a name="l00653"></a>00653 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__usbradio_8c.html#a64be783c23515f787fb2b093c2fce542">tune_rxinput</a>(<span class="keywordtype">int</span> fd, <span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o);
<a name="l00654"></a>00654 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__usbradio_8c.html#a888766fbac96eab38b64ab7d04c6d1e1">tune_rxvoice</a>(<span class="keywordtype">int</span> fd, <span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o);
<a name="l00655"></a>00655 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__usbradio_8c.html#a1e5dd762108ebc90c351cd91991aa3ad">tune_rxctcss</a>(<span class="keywordtype">int</span> fd, <span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o);
<a name="l00656"></a>00656 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__usbradio_8c.html#a24df517f036903ee52d886a2fef0d1c8">tune_txoutput</a>(<span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o, <span class="keywordtype">int</span> value, <span class="keywordtype">int</span> fd);
<a name="l00657"></a>00657 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__usbradio_8c.html#a7a5f435c891a0ebe13436cf941515a76">tune_write</a>(<span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o);
<a name="l00658"></a>00658 
<a name="l00659"></a><a class="code" href="chan__usbradio_8c.html#a7ca0a7a5e65744831f82c71f468385ea">00659</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="chan__usbradio_8c.html#a7ca0a7a5e65744831f82c71f468385ea">usbradio_active</a>;  <span class="comment">/* the active device */</span>
<a name="l00660"></a>00660 
<a name="l00661"></a>00661 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#a42967187d12d487ff0848ee5e9b12d8f">setformat</a>(<span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o, <span class="keywordtype">int</span> mode);
<a name="l00662"></a>00662 
<a name="l00663"></a>00663 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="chan__usbradio_8c.html#ab65cf11e464669e400b87541652510dd">usbradio_request</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>, <span class="keywordtype">int</span> <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>, <span class="keywordtype">void</span> *<a class="code" href="structast__channel.html#a8f64897c7ccc5c13f276d1d07c4e7095">data</a>
<a name="l00664"></a>00664 , <span class="keywordtype">int</span> *<a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a>);
<a name="l00665"></a>00665 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#ac7083072979a032dd3e4fad9ba8098c3">usbradio_digit_begin</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c, <span class="keywordtype">char</span> digit);
<a name="l00666"></a>00666 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#a3c9dcc9efc3aaf3f5609f47d015d0ce9">usbradio_digit_end</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c, <span class="keywordtype">char</span> digit, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> duration);
<a name="l00667"></a>00667 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#ad92360a30b8672357cf72d66078c4739">usbradio_text</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="app__queue_8c.html#a5633b1433389cec21ade3811bbe9ca5b">text</a>);
<a name="l00668"></a>00668 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#a216ea444f5b791482338a7644a50eb30">usbradio_hangup</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c);
<a name="l00669"></a>00669 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#a0566de6f425cddb922d952cb64615730">usbradio_answer</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c);
<a name="l00670"></a>00670 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="chan__usbradio_8c.html#a59939931e3e083c818521d85d8f10808">usbradio_read</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>);
<a name="l00671"></a>00671 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#a332ffd8c9846a82679afcf09e74d8b4b">usbradio_call</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c, <span class="keywordtype">char</span> *dest, <span class="keywordtype">int</span> timeout);
<a name="l00672"></a>00672 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#a2013fdf75a76d927a7008d6625cb2cf9">usbradio_write</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, <span class="keyword">struct</span> <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>);
<a name="l00673"></a>00673 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#abd3959dea3e40e21572fc37523428ab4">usbradio_indicate</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, <span class="keywordtype">int</span> <a class="code" href="app__meetme_8c.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>, <span class="keyword">const</span> <span class="keywordtype">void</span> *<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>, <span class="keywordtype">size_t</span> <a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>);
<a name="l00674"></a>00674 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#a8e2dba4d8df08b2bb756213fd5e97e5e">usbradio_fixup</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *oldchan, <span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *newchan);
<a name="l00675"></a>00675 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#a5f60010431301ac2b329a1910776855d">xpmr_config</a>(<span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o);
<a name="l00676"></a>00676 
<a name="l00677"></a>00677 <span class="preprocessor">#if   DEBUG_FILETEST == 1</span>
<a name="l00678"></a>00678 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">int</span> RxTestIt(<span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o);
<a name="l00679"></a>00679 <span class="preprocessor">#endif</span>
<a name="l00680"></a>00680 <span class="preprocessor"></span>
<a name="l00681"></a><a class="code" href="chan__usbradio_8c.html#a206197bcdc50090e511e22b33a2166a9">00681</a> <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="app__voicemail_8c.html#adb02bb3719cdf90c200c1ca30caa26a2">tdesc</a>[] = <span class="stringliteral">&quot;USB (CM108) Radio Channel Driver&quot;</span>;
<a name="l00682"></a>00682 
<a name="l00683"></a><a class="code" href="chan__usbradio_8c.html#a87d2bc4da35b7f7378f9c0ce66316f28">00683</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structast__channel__tech.html" title="Structure to describe a channel &amp;quot;technology&amp;quot;, ie a channel driver See for...">ast_channel_tech</a> <a class="code" href="chan__usbradio_8c.html#a87d2bc4da35b7f7378f9c0ce66316f28">usbradio_tech</a> = {
<a name="l00684"></a>00684    .<a class="code" href="structast__channel__tech.html#a8ff938fb2f815be425fd2859a21e6d61">type</a> = <span class="stringliteral">&quot;Radio&quot;</span>,
<a name="l00685"></a>00685    .description = tdesc,
<a name="l00686"></a>00686    .capabilities = <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>,
<a name="l00687"></a>00687    .requester = <a class="code" href="chan__usbradio_8c.html#ab65cf11e464669e400b87541652510dd">usbradio_request</a>,
<a name="l00688"></a>00688    .send_digit_begin = <a class="code" href="chan__usbradio_8c.html#ac7083072979a032dd3e4fad9ba8098c3">usbradio_digit_begin</a>,
<a name="l00689"></a>00689    .send_digit_end = <a class="code" href="chan__usbradio_8c.html#a3c9dcc9efc3aaf3f5609f47d015d0ce9">usbradio_digit_end</a>,
<a name="l00690"></a>00690    .send_text = <a class="code" href="chan__usbradio_8c.html#ad92360a30b8672357cf72d66078c4739">usbradio_text</a>,
<a name="l00691"></a>00691    .hangup = <a class="code" href="chan__usbradio_8c.html#a216ea444f5b791482338a7644a50eb30">usbradio_hangup</a>,
<a name="l00692"></a>00692    .answer = <a class="code" href="chan__usbradio_8c.html#a0566de6f425cddb922d952cb64615730">usbradio_answer</a>,
<a name="l00693"></a>00693    .read = <a class="code" href="chan__usbradio_8c.html#a59939931e3e083c818521d85d8f10808">usbradio_read</a>,
<a name="l00694"></a>00694    .call = <a class="code" href="chan__usbradio_8c.html#a332ffd8c9846a82679afcf09e74d8b4b">usbradio_call</a>,
<a name="l00695"></a>00695    .write = <a class="code" href="chan__usbradio_8c.html#a2013fdf75a76d927a7008d6625cb2cf9">usbradio_write</a>,
<a name="l00696"></a>00696    .indicate = <a class="code" href="chan__usbradio_8c.html#abd3959dea3e40e21572fc37523428ab4">usbradio_indicate</a>,
<a name="l00697"></a>00697    .fixup = <a class="code" href="chan__usbradio_8c.html#a8e2dba4d8df08b2bb756213fd5e97e5e">usbradio_fixup</a>,
<a name="l00698"></a>00698 };
<a name="l00699"></a>00699 
<a name="l00700"></a>00700 <span class="comment">/* Call with:  devnum: alsa major device number, param: ascii Formal</span>
<a name="l00701"></a>00701 <span class="comment">Parameter Name, val1, first or only value, val2 second value, or 0 </span>
<a name="l00702"></a>00702 <span class="comment">if only 1 value. Values: 0-99 (percent) or 0-1 for baboon.</span>
<a name="l00703"></a>00703 <span class="comment"></span>
<a name="l00704"></a>00704 <span class="comment">Note: must add -lasound to end of linkage */</span>
<a name="l00705"></a>00705 
<a name="l00706"></a><a class="code" href="chan__usbradio_8c.html#ae23fe39aa9a878be7a5330fe96f18146">00706</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#ae23fe39aa9a878be7a5330fe96f18146">amixer_max</a>(<span class="keywordtype">int</span> devnum,<span class="keywordtype">char</span> *param)
<a name="l00707"></a>00707 {
<a name="l00708"></a>00708 <span class="keywordtype">int</span>   rv,<a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>;
<a name="l00709"></a>00709 <span class="keywordtype">char</span>  <a class="code" href="app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>[100];
<a name="l00710"></a>00710 snd_hctl_t *hctl;
<a name="l00711"></a>00711 snd_ctl_elem_id_t *<a class="code" href="app__queue_8c.html#acd1f0e9b4730ec60f62cb0806cb06ef1">id</a>;
<a name="l00712"></a>00712 snd_hctl_elem_t *elem;
<a name="l00713"></a>00713 snd_ctl_elem_info_t *info;
<a name="l00714"></a>00714 
<a name="l00715"></a>00715    sprintf(str,<span class="stringliteral">&quot;hw:%d&quot;</span>,devnum);
<a name="l00716"></a>00716    <span class="keywordflow">if</span> (snd_hctl_open(&amp;hctl, str, 0)) <span class="keywordflow">return</span>(-1);
<a name="l00717"></a>00717    snd_hctl_load(hctl);
<a name="l00718"></a>00718    snd_ctl_elem_id_alloca(&amp;<span class="keywordtype">id</span>);
<a name="l00719"></a>00719    snd_ctl_elem_id_set_interface(<span class="keywordtype">id</span>, SND_CTL_ELEM_IFACE_MIXER);
<a name="l00720"></a>00720    snd_ctl_elem_id_set_name(<span class="keywordtype">id</span>, param);  
<a name="l00721"></a>00721    elem = snd_hctl_find_elem(hctl, <span class="keywordtype">id</span>);
<a name="l00722"></a>00722    <span class="keywordflow">if</span> (!elem)
<a name="l00723"></a>00723    {
<a name="l00724"></a>00724       snd_hctl_close(hctl);
<a name="l00725"></a>00725       <span class="keywordflow">return</span>(-1);
<a name="l00726"></a>00726    }
<a name="l00727"></a>00727    snd_ctl_elem_info_alloca(&amp;info);
<a name="l00728"></a>00728    snd_hctl_elem_info(elem,info);
<a name="l00729"></a>00729    type = snd_ctl_elem_info_get_type(info);
<a name="l00730"></a>00730    rv = 0;
<a name="l00731"></a>00731    <span class="keywordflow">switch</span>(type)
<a name="l00732"></a>00732    {
<a name="l00733"></a>00733        <span class="keywordflow">case</span> SND_CTL_ELEM_TYPE_INTEGER:
<a name="l00734"></a>00734       rv = snd_ctl_elem_info_get_max(info);
<a name="l00735"></a>00735       <span class="keywordflow">break</span>;
<a name="l00736"></a>00736        <span class="keywordflow">case</span> SND_CTL_ELEM_TYPE_BOOLEAN:
<a name="l00737"></a>00737       rv = 1;
<a name="l00738"></a>00738       <span class="keywordflow">break</span>;
<a name="l00739"></a>00739    }
<a name="l00740"></a>00740    snd_hctl_close(hctl);
<a name="l00741"></a>00741    <span class="keywordflow">return</span>(rv);
<a name="l00742"></a>00742 }
<a name="l00743"></a>00743 
<a name="l00744"></a>00744 <span class="comment">/* Call with:  devnum: alsa major device number, param: ascii Formal</span>
<a name="l00745"></a>00745 <span class="comment">Parameter Name, val1, first or only value, val2 second value, or 0 </span>
<a name="l00746"></a>00746 <span class="comment">if only 1 value. Values: 0-99 (percent) or 0-1 for baboon.</span>
<a name="l00747"></a>00747 <span class="comment"></span>
<a name="l00748"></a>00748 <span class="comment">Note: must add -lasound to end of linkage */</span>
<a name="l00749"></a>00749 
<a name="l00750"></a><a class="code" href="chan__usbradio_8c.html#a05443895be85616649ab5c6e76f8f241">00750</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#a05443895be85616649ab5c6e76f8f241">setamixer</a>(<span class="keywordtype">int</span> devnum,<span class="keywordtype">char</span> *param, <span class="keywordtype">int</span> v1, <span class="keywordtype">int</span> v2)
<a name="l00751"></a>00751 {
<a name="l00752"></a>00752 <span class="keywordtype">int</span>   <a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>;
<a name="l00753"></a>00753 <span class="keywordtype">char</span>  <a class="code" href="app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>[100];
<a name="l00754"></a>00754 snd_hctl_t *hctl;
<a name="l00755"></a>00755 snd_ctl_elem_id_t *<a class="code" href="app__queue_8c.html#acd1f0e9b4730ec60f62cb0806cb06ef1">id</a>;
<a name="l00756"></a>00756 snd_ctl_elem_value_t *control;
<a name="l00757"></a>00757 snd_hctl_elem_t *elem;
<a name="l00758"></a>00758 snd_ctl_elem_info_t *info;
<a name="l00759"></a>00759 
<a name="l00760"></a>00760    sprintf(str,<span class="stringliteral">&quot;hw:%d&quot;</span>,devnum);
<a name="l00761"></a>00761    <span class="keywordflow">if</span> (snd_hctl_open(&amp;hctl, str, 0)) <span class="keywordflow">return</span>(-1);
<a name="l00762"></a>00762    snd_hctl_load(hctl);
<a name="l00763"></a>00763    snd_ctl_elem_id_alloca(&amp;<span class="keywordtype">id</span>);
<a name="l00764"></a>00764    snd_ctl_elem_id_set_interface(<span class="keywordtype">id</span>, SND_CTL_ELEM_IFACE_MIXER);
<a name="l00765"></a>00765    snd_ctl_elem_id_set_name(<span class="keywordtype">id</span>, param);  
<a name="l00766"></a>00766    elem = snd_hctl_find_elem(hctl, <span class="keywordtype">id</span>);
<a name="l00767"></a>00767    <span class="keywordflow">if</span> (!elem)
<a name="l00768"></a>00768    {
<a name="l00769"></a>00769       snd_hctl_close(hctl);
<a name="l00770"></a>00770       <span class="keywordflow">return</span>(-1);
<a name="l00771"></a>00771    }
<a name="l00772"></a>00772    snd_ctl_elem_info_alloca(&amp;info);
<a name="l00773"></a>00773    snd_hctl_elem_info(elem,info);
<a name="l00774"></a>00774    type = snd_ctl_elem_info_get_type(info);
<a name="l00775"></a>00775    snd_ctl_elem_value_alloca(&amp;control);
<a name="l00776"></a>00776    snd_ctl_elem_value_set_id(control, <span class="keywordtype">id</span>);    
<a name="l00777"></a>00777    <span class="keywordflow">switch</span>(type)
<a name="l00778"></a>00778    {
<a name="l00779"></a>00779        <span class="keywordflow">case</span> SND_CTL_ELEM_TYPE_INTEGER:
<a name="l00780"></a>00780       snd_ctl_elem_value_set_integer(control, 0, v1);
<a name="l00781"></a>00781       <span class="keywordflow">if</span> (v2 &gt; 0) snd_ctl_elem_value_set_integer(control, 1, v2);
<a name="l00782"></a>00782       <span class="keywordflow">break</span>;
<a name="l00783"></a>00783        <span class="keywordflow">case</span> SND_CTL_ELEM_TYPE_BOOLEAN:
<a name="l00784"></a>00784       snd_ctl_elem_value_set_integer(control, 0, (v1 != 0));
<a name="l00785"></a>00785       <span class="keywordflow">break</span>;
<a name="l00786"></a>00786    }
<a name="l00787"></a>00787    <span class="keywordflow">if</span> (snd_hctl_elem_write(elem, control))
<a name="l00788"></a>00788    {
<a name="l00789"></a>00789       snd_hctl_close(hctl);
<a name="l00790"></a>00790       <span class="keywordflow">return</span>(-1);
<a name="l00791"></a>00791    }
<a name="l00792"></a>00792    snd_hctl_close(hctl);
<a name="l00793"></a>00793    <span class="keywordflow">return</span>(0);
<a name="l00794"></a>00794 }
<a name="l00795"></a>00795 
<a name="l00796"></a><a class="code" href="chan__usbradio_8c.html#ad8157eb0b78b43232433f943c3e48aaa">00796</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__usbradio_8c.html#ad8157eb0b78b43232433f943c3e48aaa">hid_set_outputs</a>(<span class="keyword">struct</span> usb_dev_handle *handle,
<a name="l00797"></a>00797          <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *outputs)
<a name="l00798"></a>00798 {
<a name="l00799"></a>00799    usleep(1500);
<a name="l00800"></a>00800    usb_control_msg(handle,
<a name="l00801"></a>00801          USB_ENDPOINT_OUT + USB_TYPE_CLASS + USB_RECIP_INTERFACE,
<a name="l00802"></a>00802          <a class="code" href="chan__usbradio_8c.html#a4d4af2232afa1d37615004b9821682ab">HID_REPORT_SET</a>,
<a name="l00803"></a>00803          0 + (<a class="code" href="chan__usbradio_8c.html#a21d0261b1d98b389cf94b73455d8e3f0">HID_RT_OUTPUT</a> &lt;&lt; 8),
<a name="l00804"></a>00804          <a class="code" href="chan__usbradio_8c.html#a82855a6adac1c229cd7d6e7d89365776">C108_HID_INTERFACE</a>,
<a name="l00805"></a>00805          (<span class="keywordtype">char</span>*)outputs, 4, 5000);
<a name="l00806"></a>00806 }
<a name="l00807"></a>00807 
<a name="l00808"></a><a class="code" href="chan__usbradio_8c.html#a28cc3dfb337dbda1fdfe0a81bf853b97">00808</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__usbradio_8c.html#a28cc3dfb337dbda1fdfe0a81bf853b97">hid_get_inputs</a>(<span class="keyword">struct</span> usb_dev_handle *handle,
<a name="l00809"></a>00809          <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *inputs)
<a name="l00810"></a>00810 {
<a name="l00811"></a>00811    usleep(1500);
<a name="l00812"></a>00812    usb_control_msg(handle,
<a name="l00813"></a>00813          USB_ENDPOINT_IN + USB_TYPE_CLASS + USB_RECIP_INTERFACE,
<a name="l00814"></a>00814          <a class="code" href="chan__usbradio_8c.html#a282d010f33df3170bcca5bf3e42afd71">HID_REPORT_GET</a>,
<a name="l00815"></a>00815          0 + (<a class="code" href="chan__usbradio_8c.html#a2991b100ecafed2278c8a215a148c1cf">HID_RT_INPUT</a> &lt;&lt; 8),
<a name="l00816"></a>00816          <a class="code" href="chan__usbradio_8c.html#a82855a6adac1c229cd7d6e7d89365776">C108_HID_INTERFACE</a>,
<a name="l00817"></a>00817          (<span class="keywordtype">char</span>*)inputs, 4, 5000);
<a name="l00818"></a>00818 }
<a name="l00819"></a>00819 
<a name="l00820"></a><a class="code" href="chan__usbradio_8c.html#a06aa13ddd6db83a15fd562c877634eb9">00820</a> <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="chan__usbradio_8c.html#a06aa13ddd6db83a15fd562c877634eb9">read_eeprom</a>(<span class="keyword">struct</span> usb_dev_handle *handle, <span class="keywordtype">int</span> addr)
<a name="l00821"></a>00821 {
<a name="l00822"></a>00822    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[4];
<a name="l00823"></a>00823 
<a name="l00824"></a>00824    buf[0] = 0x80;
<a name="l00825"></a>00825    buf[1] = 0;
<a name="l00826"></a>00826    buf[2] = 0;
<a name="l00827"></a>00827    buf[3] = 0x80 | (addr &amp; 0x3f);
<a name="l00828"></a>00828    <a class="code" href="chan__usbradio_8c.html#ad8157eb0b78b43232433f943c3e48aaa">hid_set_outputs</a>(handle,buf);
<a name="l00829"></a>00829    memset(buf,0,<span class="keyword">sizeof</span>(buf));
<a name="l00830"></a>00830    <a class="code" href="chan__usbradio_8c.html#a28cc3dfb337dbda1fdfe0a81bf853b97">hid_get_inputs</a>(handle,buf);
<a name="l00831"></a>00831    <span class="keywordflow">return</span>(buf[1] + (buf[2] &lt;&lt; 8));
<a name="l00832"></a>00832 }
<a name="l00833"></a>00833 
<a name="l00834"></a><a class="code" href="chan__usbradio_8c.html#ae55f85508bdb86d2020c3a1f7b3d823c">00834</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__usbradio_8c.html#ae55f85508bdb86d2020c3a1f7b3d823c">write_eeprom</a>(<span class="keyword">struct</span> usb_dev_handle *handle, <span class="keywordtype">int</span> addr, 
<a name="l00835"></a>00835    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> data)
<a name="l00836"></a>00836 {
<a name="l00837"></a>00837 
<a name="l00838"></a>00838    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[4];
<a name="l00839"></a>00839 
<a name="l00840"></a>00840    buf[0] = 0x80;
<a name="l00841"></a>00841    buf[1] = data &amp; 0xff;
<a name="l00842"></a>00842    buf[2] = data &gt;&gt; 8;
<a name="l00843"></a>00843    buf[3] = 0xc0 | (addr &amp; 0x3f);
<a name="l00844"></a>00844    <a class="code" href="chan__usbradio_8c.html#ad8157eb0b78b43232433f943c3e48aaa">hid_set_outputs</a>(handle,buf);
<a name="l00845"></a>00845 }
<a name="l00846"></a>00846 
<a name="l00847"></a><a class="code" href="chan__usbradio_8c.html#aa1f7f1e739ed9375a4c32a87546c48d3">00847</a> <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <a class="code" href="chan__usbradio_8c.html#aa1f7f1e739ed9375a4c32a87546c48d3">get_eeprom</a>(<span class="keyword">struct</span> usb_dev_handle *handle,
<a name="l00848"></a>00848    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>)
<a name="l00849"></a>00849 {
<a name="l00850"></a>00850 <span class="keywordtype">int</span>   i;
<a name="l00851"></a>00851 <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> cs;
<a name="l00852"></a>00852 
<a name="l00853"></a>00853    cs = 0xffff;
<a name="l00854"></a>00854    <span class="keywordflow">for</span>(i = <a class="code" href="chan__usbradio_8c.html#ab5c3d2d745d2a94c1f9937a440aa2ae9">EEPROM_START_ADDR</a>; i &lt; <a class="code" href="chan__usbradio_8c.html#a234e4f1294ec845752e1cb4b1dcd7add">EEPROM_END_ADDR</a>; i++)
<a name="l00855"></a>00855    {
<a name="l00856"></a>00856       cs += buf[i] = <a class="code" href="chan__usbradio_8c.html#a06aa13ddd6db83a15fd562c877634eb9">read_eeprom</a>(handle,i);
<a name="l00857"></a>00857    }
<a name="l00858"></a>00858    <span class="keywordflow">return</span>(cs);
<a name="l00859"></a>00859 }
<a name="l00860"></a>00860 
<a name="l00861"></a><a class="code" href="chan__usbradio_8c.html#a69e5b6b3bd9d19d3ad1b781730901b86">00861</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__usbradio_8c.html#a69e5b6b3bd9d19d3ad1b781730901b86">put_eeprom</a>(<span class="keyword">struct</span> usb_dev_handle *handle,<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>)
<a name="l00862"></a>00862 {
<a name="l00863"></a>00863 <span class="keywordtype">int</span>   i;
<a name="l00864"></a>00864 <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> cs;
<a name="l00865"></a>00865 
<a name="l00866"></a>00866    cs = 0xffff;
<a name="l00867"></a>00867    buf[<a class="code" href="chan__usbradio_8c.html#a2527414458decfaeb83335c0a1b7f83e">EEPROM_MAGIC_ADDR</a>] = <a class="code" href="chan__usbradio_8c.html#aea81e3080d5a5edd34913f1963b5a790">EEPROM_MAGIC</a>;
<a name="l00868"></a>00868    <span class="keywordflow">for</span>(i = <a class="code" href="chan__usbradio_8c.html#ab5c3d2d745d2a94c1f9937a440aa2ae9">EEPROM_START_ADDR</a>; i &lt; <a class="code" href="chan__usbradio_8c.html#ace660bf98fac4830b51d09c5a5f5cf3d">EEPROM_CS_ADDR</a>; i++)
<a name="l00869"></a>00869    {
<a name="l00870"></a>00870       <a class="code" href="chan__usbradio_8c.html#ae55f85508bdb86d2020c3a1f7b3d823c">write_eeprom</a>(handle,i,buf[i]);
<a name="l00871"></a>00871       cs += buf[i];
<a name="l00872"></a>00872    }
<a name="l00873"></a>00873    buf[EEPROM_CS_ADDR] = (65535 - cs) + 1;
<a name="l00874"></a>00874    <a class="code" href="chan__usbradio_8c.html#ae55f85508bdb86d2020c3a1f7b3d823c">write_eeprom</a>(handle,i,buf[EEPROM_CS_ADDR]);
<a name="l00875"></a>00875 }
<a name="l00876"></a>00876 
<a name="l00877"></a><a class="code" href="chan__usbradio_8c.html#a07a999973f172029333fd314780106e2">00877</a> <span class="keyword">static</span> <span class="keyword">struct </span>usb_device *<a class="code" href="chan__usbradio_8c.html#a07a999973f172029333fd314780106e2">hid_device_init</a>(<span class="keywordtype">char</span> *desired_device)
<a name="l00878"></a>00878 {
<a name="l00879"></a>00879     <span class="keyword">struct </span>usb_bus *usb_bus;
<a name="l00880"></a>00880     <span class="keyword">struct </span>usb_device *dev;
<a name="l00881"></a>00881     <span class="keywordtype">char</span> devstr[200],<a class="code" href="app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>[200],desdev[200],*cp;
<a name="l00882"></a>00882     <span class="keywordtype">int</span> i;
<a name="l00883"></a>00883     FILE *fp;
<a name="l00884"></a>00884 
<a name="l00885"></a>00885     usb_init();
<a name="l00886"></a>00886     usb_find_busses();
<a name="l00887"></a>00887     usb_find_devices();
<a name="l00888"></a>00888     <span class="keywordflow">for</span> (usb_bus = usb_busses;
<a name="l00889"></a>00889          usb_bus;
<a name="l00890"></a>00890          usb_bus = usb_bus-&gt;next) {
<a name="l00891"></a>00891         <span class="keywordflow">for</span> (dev = usb_bus-&gt;devices;
<a name="l00892"></a>00892              dev;
<a name="l00893"></a>00893              dev = dev-&gt;next) {
<a name="l00894"></a>00894             <span class="keywordflow">if</span> ((dev-&gt;descriptor.idVendor
<a name="l00895"></a>00895                   == <a class="code" href="chan__usbradio_8c.html#a7fe311f41d061c3de16725515151850b">C108_VENDOR_ID</a>) &amp;&amp;
<a name="l00896"></a>00896                 (dev-&gt;descriptor.idProduct
<a name="l00897"></a>00897                   == <a class="code" href="chan__usbradio_8c.html#abda026ecd94755bcc0907bc6c5e41c9d">C108_PRODUCT_ID</a>))
<a name="l00898"></a>00898       {
<a name="l00899"></a>00899                         sprintf(devstr,<span class="stringliteral">&quot;%s/%s&quot;</span>, usb_bus-&gt;dirname,dev-&gt;filename);
<a name="l00900"></a>00900          <span class="keywordflow">for</span>(i = 0; i &lt; 32; i++)
<a name="l00901"></a>00901          {
<a name="l00902"></a>00902             sprintf(str,<span class="stringliteral">&quot;/proc/asound/card%d/usbbus&quot;</span>,i);
<a name="l00903"></a>00903             fp = fopen(str,<span class="stringliteral">&quot;r&quot;</span>);
<a name="l00904"></a>00904             <span class="keywordflow">if</span> (!fp) <span class="keywordflow">continue</span>;
<a name="l00905"></a>00905             <span class="keywordflow">if</span> ((!fgets(desdev,<span class="keyword">sizeof</span>(desdev) - 1,fp)) || (!desdev[0]))
<a name="l00906"></a>00906             {
<a name="l00907"></a>00907                fclose(fp);
<a name="l00908"></a>00908                <span class="keywordflow">continue</span>;
<a name="l00909"></a>00909             }
<a name="l00910"></a>00910             fclose(fp);
<a name="l00911"></a>00911             <span class="keywordflow">if</span> (desdev[strlen(desdev) - 1] == <span class="charliteral">&apos;\n&apos;</span>)
<a name="l00912"></a>00912                   desdev[strlen(desdev) -1 ] = 0;
<a name="l00913"></a>00913             <span class="keywordflow">if</span> (strcasecmp(desdev,devstr)) <span class="keywordflow">continue</span>;
<a name="l00914"></a>00914             <span class="keywordflow">if</span> (i) sprintf(str,<span class="stringliteral">&quot;/sys/class/sound/dsp%d/device&quot;</span>,i);
<a name="l00915"></a>00915             <span class="keywordflow">else</span> strcpy(str,<span class="stringliteral">&quot;/sys/class/sound/dsp/device&quot;</span>);
<a name="l00916"></a>00916             memset(desdev,0,<span class="keyword">sizeof</span>(desdev));
<a name="l00917"></a>00917             <span class="keywordflow">if</span> (readlink(str,desdev,<span class="keyword">sizeof</span>(desdev) - 1) == -1)
<a name="l00918"></a>00918             {
<a name="l00919"></a>00919                sprintf(str,<span class="stringliteral">&quot;/sys/class/sound/controlC%d/device&quot;</span>,i);
<a name="l00920"></a>00920                memset(desdev,0,<span class="keyword">sizeof</span>(desdev));
<a name="l00921"></a>00921                <span class="keywordflow">if</span> (readlink(str,desdev,<span class="keyword">sizeof</span>(desdev) - 1) == -1) <span class="keywordflow">continue</span>;
<a name="l00922"></a>00922             }
<a name="l00923"></a>00923             cp = strrchr(desdev,<span class="charliteral">&apos;/&apos;</span>);
<a name="l00924"></a>00924             <span class="keywordflow">if</span> (cp) *cp = 0; <span class="keywordflow">else</span> <span class="keywordflow">continue</span>;
<a name="l00925"></a>00925             cp = strrchr(desdev,<span class="charliteral">&apos;/&apos;</span>);
<a name="l00926"></a>00926             <span class="keywordflow">if</span> (!cp) <span class="keywordflow">continue</span>;
<a name="l00927"></a>00927             cp++;
<a name="l00928"></a>00928             <span class="keywordflow">break</span>;
<a name="l00929"></a>00929          }
<a name="l00930"></a>00930          <span class="keywordflow">if</span> (i &gt;= 32) <span class="keywordflow">continue</span>;
<a name="l00931"></a>00931                         <span class="keywordflow">if</span> (!strcmp(cp,desired_device)) <span class="keywordflow">return</span> dev;
<a name="l00932"></a>00932       }
<a name="l00933"></a>00933 
<a name="l00934"></a>00934         }
<a name="l00935"></a>00935     }
<a name="l00936"></a>00936     <span class="keywordflow">return</span> NULL;
<a name="l00937"></a>00937 }
<a name="l00938"></a>00938 
<a name="l00939"></a><a class="code" href="chan__usbradio_8c.html#a9d38322b0cd6a6736d6cc6221a202594">00939</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#a9d38322b0cd6a6736d6cc6221a202594">hid_device_mklist</a>(<span class="keywordtype">void</span>)
<a name="l00940"></a>00940 {
<a name="l00941"></a>00941     <span class="keyword">struct </span>usb_bus *usb_bus;
<a name="l00942"></a>00942     <span class="keyword">struct </span>usb_device *dev;
<a name="l00943"></a>00943     <span class="keywordtype">char</span> devstr[200],<a class="code" href="app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>[200],desdev[200],*cp;
<a name="l00944"></a>00944     <span class="keywordtype">int</span> i;
<a name="l00945"></a>00945     FILE *fp;
<a name="l00946"></a>00946 
<a name="l00947"></a>00947     usb_device_list = <a class="code" href="astmm_8h.html#a64a0e7a3ab511a3777ac56f5d43c628e">ast_malloc</a>(2);
<a name="l00948"></a>00948     <span class="keywordflow">if</span> (!usb_device_list) <span class="keywordflow">return</span> -1;
<a name="l00949"></a>00949     memset(usb_device_list,0,2);
<a name="l00950"></a>00950 
<a name="l00951"></a>00951     usb_init();
<a name="l00952"></a>00952     usb_find_busses();
<a name="l00953"></a>00953     usb_find_devices();
<a name="l00954"></a>00954     <span class="keywordflow">for</span> (usb_bus = usb_busses;
<a name="l00955"></a>00955          usb_bus;
<a name="l00956"></a>00956          usb_bus = usb_bus-&gt;next) {
<a name="l00957"></a>00957         <span class="keywordflow">for</span> (dev = usb_bus-&gt;devices;
<a name="l00958"></a>00958              dev;
<a name="l00959"></a>00959              dev = dev-&gt;next) {
<a name="l00960"></a>00960             <span class="keywordflow">if</span> ((dev-&gt;descriptor.idVendor
<a name="l00961"></a>00961                   == <a class="code" href="chan__usbradio_8c.html#a7fe311f41d061c3de16725515151850b">C108_VENDOR_ID</a>) &amp;&amp;
<a name="l00962"></a>00962                 (dev-&gt;descriptor.idProduct
<a name="l00963"></a>00963                   == <a class="code" href="chan__usbradio_8c.html#abda026ecd94755bcc0907bc6c5e41c9d">C108_PRODUCT_ID</a>))
<a name="l00964"></a>00964       {
<a name="l00965"></a>00965                         sprintf(devstr,<span class="stringliteral">&quot;%s/%s&quot;</span>, usb_bus-&gt;dirname,dev-&gt;filename);
<a name="l00966"></a>00966          <span class="keywordflow">for</span>(i = 0;i &lt; 32; i++)
<a name="l00967"></a>00967          {
<a name="l00968"></a>00968             sprintf(str,<span class="stringliteral">&quot;/proc/asound/card%d/usbbus&quot;</span>,i);
<a name="l00969"></a>00969             fp = fopen(str,<span class="stringliteral">&quot;r&quot;</span>);
<a name="l00970"></a>00970             <span class="keywordflow">if</span> (!fp) <span class="keywordflow">continue</span>;
<a name="l00971"></a>00971             <span class="keywordflow">if</span> ((!fgets(desdev,<span class="keyword">sizeof</span>(desdev) - 1,fp)) || (!desdev[0]))
<a name="l00972"></a>00972             {
<a name="l00973"></a>00973                fclose(fp);
<a name="l00974"></a>00974                <span class="keywordflow">continue</span>;
<a name="l00975"></a>00975             }
<a name="l00976"></a>00976             fclose(fp);
<a name="l00977"></a>00977             <span class="keywordflow">if</span> (desdev[strlen(desdev) - 1] == <span class="charliteral">&apos;\n&apos;</span>)
<a name="l00978"></a>00978                   desdev[strlen(desdev) -1 ] = 0;
<a name="l00979"></a>00979             <span class="keywordflow">if</span> (strcasecmp(desdev,devstr)) <span class="keywordflow">continue</span>;
<a name="l00980"></a>00980             <span class="keywordflow">if</span> (i) sprintf(str,<span class="stringliteral">&quot;/sys/class/sound/dsp%d/device&quot;</span>,i);
<a name="l00981"></a>00981             <span class="keywordflow">else</span> strcpy(str,<span class="stringliteral">&quot;/sys/class/sound/dsp/device&quot;</span>);
<a name="l00982"></a>00982             memset(desdev,0,<span class="keyword">sizeof</span>(desdev));
<a name="l00983"></a>00983             <span class="keywordflow">if</span> (readlink(str,desdev,<span class="keyword">sizeof</span>(desdev) - 1) == -1)
<a name="l00984"></a>00984             {
<a name="l00985"></a>00985                sprintf(str,<span class="stringliteral">&quot;/sys/class/sound/controlC%d/device&quot;</span>,i);
<a name="l00986"></a>00986                memset(desdev,0,<span class="keyword">sizeof</span>(desdev));
<a name="l00987"></a>00987                <span class="keywordflow">if</span> (readlink(str,desdev,<span class="keyword">sizeof</span>(desdev) - 1) == -1) <span class="keywordflow">continue</span>;
<a name="l00988"></a>00988             }
<a name="l00989"></a>00989             cp = strrchr(desdev,<span class="charliteral">&apos;/&apos;</span>);
<a name="l00990"></a>00990             <span class="keywordflow">if</span> (cp) *cp = 0; <span class="keywordflow">else</span> <span class="keywordflow">continue</span>;
<a name="l00991"></a>00991             cp = strrchr(desdev,<span class="charliteral">&apos;/&apos;</span>);
<a name="l00992"></a>00992             <span class="keywordflow">if</span> (!cp) <span class="keywordflow">continue</span>;
<a name="l00993"></a>00993             cp++;
<a name="l00994"></a>00994             <span class="keywordflow">break</span>;
<a name="l00995"></a>00995          }
<a name="l00996"></a>00996          <span class="keywordflow">if</span> (i &gt;= 32) <span class="keywordflow">return</span> -1;
<a name="l00997"></a>00997          usb_device_list = <a class="code" href="astmm_8h.html#aa852314efa0cfeecee97ffc51b649734">ast_realloc</a>(usb_device_list,
<a name="l00998"></a>00998             usb_device_list_size + 2 +
<a name="l00999"></a>00999                strlen(cp));
<a name="l01000"></a>01000          <span class="keywordflow">if</span> (!usb_device_list) <span class="keywordflow">return</span> -1;
<a name="l01001"></a>01001          usb_device_list_size += strlen(cp) + 2;
<a name="l01002"></a>01002          i = 0;
<a name="l01003"></a>01003          <span class="keywordflow">while</span>(usb_device_list[i])
<a name="l01004"></a>01004          {
<a name="l01005"></a>01005             i += strlen(usb_device_list + i) + 1;
<a name="l01006"></a>01006          }
<a name="l01007"></a>01007          strcat(usb_device_list + i,cp);
<a name="l01008"></a>01008          usb_device_list[strlen(cp) + i + 1] = 0;
<a name="l01009"></a>01009       }
<a name="l01010"></a>01010 
<a name="l01011"></a>01011         }
<a name="l01012"></a>01012     }
<a name="l01013"></a>01013     <span class="keywordflow">return</span> 0;
<a name="l01014"></a>01014 }
<a name="l01015"></a>01015 
<a name="l01016"></a>01016 <span class="comment">/* returns internal formatted string from external one */</span>
<a name="l01017"></a><a class="code" href="chan__usbradio_8c.html#ac031edcda7e4fff124d7fd93f3a13f13">01017</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#ac031edcda7e4fff124d7fd93f3a13f13">usb_get_usbdev</a>(<span class="keywordtype">char</span> *devstr)
<a name="l01018"></a>01018 {
<a name="l01019"></a>01019 <span class="keywordtype">int</span>   i;
<a name="l01020"></a>01020 <span class="keywordtype">char</span>  <a class="code" href="app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>[200],desdev[200],*cp;
<a name="l01021"></a>01021 
<a name="l01022"></a>01022    <span class="keywordflow">for</span>(i = 0;i &lt; 32; i++)
<a name="l01023"></a>01023    {
<a name="l01024"></a>01024       <span class="keywordflow">if</span> (i) sprintf(str,<span class="stringliteral">&quot;/sys/class/sound/dsp%d/device&quot;</span>,i);
<a name="l01025"></a>01025       <span class="keywordflow">else</span> strcpy(str,<span class="stringliteral">&quot;/sys/class/sound/dsp/device&quot;</span>);
<a name="l01026"></a>01026       memset(desdev,0,<span class="keyword">sizeof</span>(desdev));
<a name="l01027"></a>01027       <span class="keywordflow">if</span> (readlink(str,desdev,<span class="keyword">sizeof</span>(desdev) - 1) == -1)
<a name="l01028"></a>01028       {
<a name="l01029"></a>01029          sprintf(str,<span class="stringliteral">&quot;/sys/class/sound/controlC%d/device&quot;</span>,i);
<a name="l01030"></a>01030          memset(desdev,0,<span class="keyword">sizeof</span>(desdev));
<a name="l01031"></a>01031          <span class="keywordflow">if</span> (readlink(str,desdev,<span class="keyword">sizeof</span>(desdev) - 1) == -1) <span class="keywordflow">continue</span>;
<a name="l01032"></a>01032       }
<a name="l01033"></a>01033       cp = strrchr(desdev,<span class="charliteral">&apos;/&apos;</span>);
<a name="l01034"></a>01034       <span class="keywordflow">if</span> (cp) *cp = 0; <span class="keywordflow">else</span> <span class="keywordflow">continue</span>;
<a name="l01035"></a>01035       cp = strrchr(desdev,<span class="charliteral">&apos;/&apos;</span>);
<a name="l01036"></a>01036       <span class="keywordflow">if</span> (!cp) <span class="keywordflow">continue</span>;
<a name="l01037"></a>01037       cp++;
<a name="l01038"></a>01038       <span class="keywordflow">if</span> (!strcasecmp(cp,devstr)) <span class="keywordflow">break</span>;
<a name="l01039"></a>01039    }
<a name="l01040"></a>01040    <span class="keywordflow">if</span> (i &gt;= 32) <span class="keywordflow">return</span> -1;
<a name="l01041"></a>01041    <span class="keywordflow">return</span> i;
<a name="l01042"></a>01042 
<a name="l01043"></a>01043 }
<a name="l01044"></a>01044 
<a name="l01045"></a><a class="code" href="chan__usbradio_8c.html#a76b23f8d7a6306e67da3636fa9e463f1">01045</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#a76b23f8d7a6306e67da3636fa9e463f1">usb_list_check</a>(<span class="keywordtype">char</span> *devstr)
<a name="l01046"></a>01046 {
<a name="l01047"></a>01047 
<a name="l01048"></a>01048 <span class="keywordtype">char</span> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a> = usb_device_list;
<a name="l01049"></a>01049 
<a name="l01050"></a>01050    <span class="keywordflow">if</span> (!s) <span class="keywordflow">return</span>(0);
<a name="l01051"></a>01051    <span class="keywordflow">while</span>(*s)
<a name="l01052"></a>01052    {
<a name="l01053"></a>01053       <span class="keywordflow">if</span> (!strcasecmp(s,devstr)) <span class="keywordflow">return</span>(1);
<a name="l01054"></a>01054       s += strlen(s) + 1;
<a name="l01055"></a>01055    }
<a name="l01056"></a>01056    <span class="keywordflow">return</span>(0);
<a name="l01057"></a>01057 }
<a name="l01058"></a>01058 
<a name="l01059"></a>01059 
<a name="l01060"></a><a class="code" href="chan__usbradio_8c.html#a7dda562f378c1ca89125358f201373a0">01060</a> <span class="keyword">static</span> <span class="keywordtype">int</span>  <a class="code" href="chan__usbradio_8c.html#a7dda562f378c1ca89125358f201373a0">hidhdwconfig</a>(<span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o)
<a name="l01061"></a>01061 {
<a name="l01062"></a>01062    <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a7d71a2812f8777ec95ca963a743f6f77">hdwtype</a>==1)   <span class="comment">//sphusb</span>
<a name="l01063"></a>01063    {
<a name="l01064"></a>01064       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a4daaa2a04c1f3cef618b8f7f2b2dbc66">hid_gpio_ctl</a>      =  0x08; <span class="comment">/* set GPIO4 to output mode */</span>
<a name="l01065"></a>01065       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a24fbd2c9b0fc7e56bcb66e0499333fec">hid_gpio_ctl_loc</a>  =  2;    <span class="comment">/* For CTL of GPIO */</span>
<a name="l01066"></a>01066       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a7024a18b225ef731da6391ef59ffa0c1">hid_io_cor</a>     =  4; <span class="comment">/* GPIO3 is COR */</span>
<a name="l01067"></a>01067       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0b6a895a9ef97321dfc53b56734efa20">hid_io_cor_loc</a> =  1; <span class="comment">/* GPIO3 is COR */</span>
<a name="l01068"></a>01068       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a35363a0a3cf14f328c282aab15cee673">hid_io_ctcss</a>      =  2;    <span class="comment">/* GPIO 2 is External CTCSS */</span>
<a name="l01069"></a>01069       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a33d091fd8ddcd75e8db6c411e388558a">hid_io_ctcss_loc</a> =  1;  <span class="comment">/* is GPIO 2 */</span>
<a name="l01070"></a>01070       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a986fd9e827a7571882f177c9b5598951">hid_io_ptt</a>     =  8;    <span class="comment">/* GPIO 4 is PTT */</span>
<a name="l01071"></a>01071       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#afc21a1f1175ad7a1b6c3db6a23382ad4">hid_gpio_loc</a>   =  1;    <span class="comment">/* For ALL GPIO */</span>
<a name="l01072"></a>01072    }
<a name="l01073"></a>01073    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a7d71a2812f8777ec95ca963a743f6f77">hdwtype</a>==0)  <span class="comment">//dudeusb</span>
<a name="l01074"></a>01074    {
<a name="l01075"></a>01075       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a4daaa2a04c1f3cef618b8f7f2b2dbc66">hid_gpio_ctl</a>      =  0x0c; <span class="comment">/* set GPIO 3 &amp; 4 to output mode */</span>
<a name="l01076"></a>01076       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a24fbd2c9b0fc7e56bcb66e0499333fec">hid_gpio_ctl_loc</a>  =  2;    <span class="comment">/* For CTL of GPIO */</span>
<a name="l01077"></a>01077       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a7024a18b225ef731da6391ef59ffa0c1">hid_io_cor</a>     =  2; <span class="comment">/* VOLD DN is COR */</span>
<a name="l01078"></a>01078       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0b6a895a9ef97321dfc53b56734efa20">hid_io_cor_loc</a> =  0; <span class="comment">/* VOL DN COR */</span>
<a name="l01079"></a>01079       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a35363a0a3cf14f328c282aab15cee673">hid_io_ctcss</a>      =  2;    <span class="comment">/* GPIO 2 is External CTCSS */</span>
<a name="l01080"></a>01080       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a33d091fd8ddcd75e8db6c411e388558a">hid_io_ctcss_loc</a> =  1;  <span class="comment">/* is GPIO 2 */</span>
<a name="l01081"></a>01081       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a986fd9e827a7571882f177c9b5598951">hid_io_ptt</a>     =  4;    <span class="comment">/* GPIO 3 is PTT */</span>
<a name="l01082"></a>01082       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#afc21a1f1175ad7a1b6c3db6a23382ad4">hid_gpio_loc</a>   =  1;    <span class="comment">/* For ALL GPIO */</span>
<a name="l01083"></a>01083    }
<a name="l01084"></a>01084    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a7d71a2812f8777ec95ca963a743f6f77">hdwtype</a>==3)  <span class="comment">// custom version</span>
<a name="l01085"></a>01085    {
<a name="l01086"></a>01086       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a4daaa2a04c1f3cef618b8f7f2b2dbc66">hid_gpio_ctl</a>      =  0x0c; <span class="comment">/* set GPIO 3 &amp; 4 to output mode */</span>
<a name="l01087"></a>01087       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a24fbd2c9b0fc7e56bcb66e0499333fec">hid_gpio_ctl_loc</a>  =  2;    <span class="comment">/* For CTL of GPIO */</span>
<a name="l01088"></a>01088       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a7024a18b225ef731da6391ef59ffa0c1">hid_io_cor</a>     =  2; <span class="comment">/* VOLD DN is COR */</span>
<a name="l01089"></a>01089       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0b6a895a9ef97321dfc53b56734efa20">hid_io_cor_loc</a> =  0; <span class="comment">/* VOL DN COR */</span>
<a name="l01090"></a>01090       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a35363a0a3cf14f328c282aab15cee673">hid_io_ctcss</a>      =  2;    <span class="comment">/* GPIO 2 is External CTCSS */</span>
<a name="l01091"></a>01091       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a33d091fd8ddcd75e8db6c411e388558a">hid_io_ctcss_loc</a> =  1;  <span class="comment">/* is GPIO 2 */</span>
<a name="l01092"></a>01092       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a986fd9e827a7571882f177c9b5598951">hid_io_ptt</a>     =  4;    <span class="comment">/* GPIO 3 is PTT */</span>
<a name="l01093"></a>01093       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#afc21a1f1175ad7a1b6c3db6a23382ad4">hid_gpio_loc</a>   =  1;    <span class="comment">/* For ALL GPIO */</span>
<a name="l01094"></a>01094    }
<a name="l01095"></a>01095 
<a name="l01096"></a>01096    <span class="keywordflow">return</span> 0;
<a name="l01097"></a>01097 }
<a name="l01098"></a>01098 <span class="comment">/*</span>
<a name="l01099"></a>01099 <span class="comment">*/</span>
<a name="l01100"></a><a class="code" href="chan__usbradio_8c.html#a56b8817c289bbdb4aaa42209a02ac5b5">01100</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__usbradio_8c.html#a56b8817c289bbdb4aaa42209a02ac5b5">kickptt</a>(<span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o)
<a name="l01101"></a>01101 {
<a name="l01102"></a>01102    <span class="keywordtype">char</span> c = 0;
<a name="l01103"></a>01103    <span class="comment">//printf(&quot;kickptt  %i  %i  %i\n&quot;,o-&gt;txkeyed,o-&gt;txchankey,o-&gt;txtestkey);</span>
<a name="l01104"></a>01104    <span class="keywordflow">if</span> (!o) <span class="keywordflow">return</span>;
<a name="l01105"></a>01105    <span class="keywordflow">if</span> (!o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af1f2cc7eff55caf1c549b336a065689a">pttkick</a>) <span class="keywordflow">return</span>;
<a name="l01106"></a>01106    <span class="keywordflow">if</span> (write(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af1f2cc7eff55caf1c549b336a065689a">pttkick</a>[1],&amp;c,1) &lt; 0) {
<a name="l01107"></a>01107       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;write() failed: %s\n&quot;</span>, strerror(<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l01108"></a>01108    }
<a name="l01109"></a>01109 }
<a name="l01110"></a>01110 <span class="comment">/*</span>
<a name="l01111"></a>01111 <span class="comment">*/</span>
<a name="l01112"></a><a class="code" href="chan__usbradio_8c.html#a391b2cd28c9f4bcdff19631cf45c4f0f">01112</a> <span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="chan__usbradio_8c.html#a391b2cd28c9f4bcdff19631cf45c4f0f">hidthread</a>(<span class="keywordtype">void</span> *arg)
<a name="l01113"></a>01113 {
<a name="l01114"></a>01114    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[4],bufsave[4],keyed;
<a name="l01115"></a>01115    <span class="keywordtype">char</span> lastrx, txtmp;
<a name="l01116"></a>01116    <span class="keywordtype">int</span> res;
<a name="l01117"></a>01117    <span class="keyword">struct </span>usb_device *usb_dev;
<a name="l01118"></a>01118    <span class="keyword">struct </span>usb_dev_handle *usb_handle;
<a name="l01119"></a>01119    <span class="keyword">struct </span><a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o = (<span class="keyword">struct </span><a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *) arg;
<a name="l01120"></a>01120    <span class="keyword">struct </span>timeval to;
<a name="l01121"></a>01121    fd_set rfds;
<a name="l01122"></a>01122 
<a name="l01123"></a>01123    usb_dev = <a class="code" href="chan__usbradio_8c.html#a07a999973f172029333fd314780106e2">hid_device_init</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ae0013a0ec03c2c35c2966c6aa3147abd">devstr</a>);
<a name="l01124"></a>01124    <span class="keywordflow">if</span> (usb_dev == NULL) {
<a name="l01125"></a>01125       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,<span class="stringliteral">&quot;USB HID device not found\n&quot;</span>);
<a name="l01126"></a>01126       pthread_exit(NULL);
<a name="l01127"></a>01127    }
<a name="l01128"></a>01128    usb_handle = usb_open(usb_dev);
<a name="l01129"></a>01129    <span class="keywordflow">if</span> (usb_handle == NULL) {
<a name="l01130"></a>01130            <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,<span class="stringliteral">&quot;Not able to open USB device\n&quot;</span>);
<a name="l01131"></a>01131       pthread_exit(NULL);
<a name="l01132"></a>01132    }
<a name="l01133"></a>01133    <span class="keywordflow">if</span> (usb_claim_interface(usb_handle,<a class="code" href="chan__usbradio_8c.html#a82855a6adac1c229cd7d6e7d89365776">C108_HID_INTERFACE</a>) &lt; 0)
<a name="l01134"></a>01134    {
<a name="l01135"></a>01135        <span class="keywordflow">if</span> (usb_detach_kernel_driver_np(usb_handle,<a class="code" href="chan__usbradio_8c.html#a82855a6adac1c229cd7d6e7d89365776">C108_HID_INTERFACE</a>) &lt; 0) {
<a name="l01136"></a>01136               <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,<span class="stringliteral">&quot;Not able to detach the USB device\n&quot;</span>);
<a name="l01137"></a>01137          pthread_exit(NULL);
<a name="l01138"></a>01138       }
<a name="l01139"></a>01139       <span class="keywordflow">if</span> (usb_claim_interface(usb_handle,<a class="code" href="chan__usbradio_8c.html#a82855a6adac1c229cd7d6e7d89365776">C108_HID_INTERFACE</a>) &lt; 0) {
<a name="l01140"></a>01140               <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,<span class="stringliteral">&quot;Not able to claim the USB device\n&quot;</span>);
<a name="l01141"></a>01141          pthread_exit(NULL);
<a name="l01142"></a>01142       }
<a name="l01143"></a>01143    }
<a name="l01144"></a>01144    memset(buf,0,<span class="keyword">sizeof</span>(buf));
<a name="l01145"></a>01145    buf[2] = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a4daaa2a04c1f3cef618b8f7f2b2dbc66">hid_gpio_ctl</a>;
<a name="l01146"></a>01146    buf[1] = 0;
<a name="l01147"></a>01147    <a class="code" href="chan__usbradio_8c.html#ad8157eb0b78b43232433f943c3e48aaa">hid_set_outputs</a>(usb_handle,buf);
<a name="l01148"></a>01148    memcpy(bufsave,buf,<span class="keyword">sizeof</span>(buf));
<a name="l01149"></a>01149    <span class="keywordflow">if</span> (pipe(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af1f2cc7eff55caf1c549b336a065689a">pttkick</a>) == -1)
<a name="l01150"></a>01150    {
<a name="l01151"></a>01151        <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,<span class="stringliteral">&quot;Not able to create pipe\n&quot;</span>);
<a name="l01152"></a>01152       pthread_exit(NULL);
<a name="l01153"></a>01153    }
<a name="l01154"></a>01154    <a class="code" href="chan__usbradio_8c.html#ab8b71b2cbec55b695df88902fb911db3">traceusb1</a>((<span class="stringliteral">&quot;hidthread: Starting normally on %s!!\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5ac083a645d964373f022d03df4849c8">name</a>));
<a name="l01155"></a>01155    lastrx = 0;
<a name="l01156"></a>01156    <span class="comment">// popen </span>
<a name="l01157"></a>01157    <span class="keywordflow">while</span>(!o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a81ba3b4ebe2534f4cfc69a57a2d7debe">stophid</a>)
<a name="l01158"></a>01158    {
<a name="l01159"></a>01159       to.tv_sec = 0;
<a name="l01160"></a>01160       to.tv_usec = 50000;   <span class="comment">// maw sph</span>
<a name="l01161"></a>01161 
<a name="l01162"></a>01162       FD_ZERO(&amp;rfds);
<a name="l01163"></a>01163       FD_SET(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af1f2cc7eff55caf1c549b336a065689a">pttkick</a>[0],&amp;rfds);
<a name="l01164"></a>01164       <span class="comment">/* ast_select emulates linux behaviour in terms of timeout handling */</span>
<a name="l01165"></a>01165       res = <a class="code" href="channel_8h.html#a056ed4f99440f01c251b2e8ca4501a56" title="Waits for activity on a group of channels.">ast_select</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af1f2cc7eff55caf1c549b336a065689a">pttkick</a>[0] + 1, &amp;rfds, NULL, NULL, &amp;to);
<a name="l01166"></a>01166       <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l01167"></a>01167          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;select failed: %s\n&quot;</span>, strerror(<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l01168"></a>01168          usleep(10000);
<a name="l01169"></a>01169          <span class="keywordflow">continue</span>;
<a name="l01170"></a>01170       }
<a name="l01171"></a>01171       <span class="keywordflow">if</span> (FD_ISSET(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af1f2cc7eff55caf1c549b336a065689a">pttkick</a>[0],&amp;rfds))
<a name="l01172"></a>01172       {
<a name="l01173"></a>01173          <span class="keywordtype">char</span> c;
<a name="l01174"></a>01174 
<a name="l01175"></a>01175          <span class="keywordflow">if</span> (read(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af1f2cc7eff55caf1c549b336a065689a">pttkick</a>[0],&amp;c,1) &lt; 0) {
<a name="l01176"></a>01176             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;read() failed: %s\n&quot;</span>, strerror(<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l01177"></a>01177          }
<a name="l01178"></a>01178       }
<a name="l01179"></a>01179       <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ae6df055b2352a39c3f2f781a17c6ba62">wanteeprom</a>)
<a name="l01180"></a>01180       {
<a name="l01181"></a>01181          <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0cb029a4ba4ae628b6f5431a4cbb753f">eepromlock</a>);
<a name="l01182"></a>01182          <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#aa4c4270e4903db2dcb2ee7e3a7966ca3">eepromctl</a> == 1)  <span class="comment">/* to read */</span>
<a name="l01183"></a>01183          {
<a name="l01184"></a>01184             <span class="comment">/* if CS okay */</span>
<a name="l01185"></a>01185             <span class="keywordflow">if</span> (!<a class="code" href="chan__usbradio_8c.html#aa1f7f1e739ed9375a4c32a87546c48d3">get_eeprom</a>(usb_handle,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac31262f80afbd912435464107e0d054d">eeprom</a>))
<a name="l01186"></a>01186             {
<a name="l01187"></a>01187                <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac31262f80afbd912435464107e0d054d">eeprom</a>[<a class="code" href="chan__usbradio_8c.html#a2527414458decfaeb83335c0a1b7f83e">EEPROM_MAGIC_ADDR</a>] != <a class="code" href="chan__usbradio_8c.html#aea81e3080d5a5edd34913f1963b5a790">EEPROM_MAGIC</a>)
<a name="l01188"></a>01188                {
<a name="l01189"></a>01189                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;UNSUCCESSFUL: EEPROM MAGIC NUMBER BAD on channel %s\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l01190"></a>01190                }
<a name="l01191"></a>01191                <span class="keywordflow">else</span>
<a name="l01192"></a>01192                {
<a name="l01193"></a>01193                   o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a959ccc7bd4988d55f4115fd5b13e236e">rxmixerset</a> = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac31262f80afbd912435464107e0d054d">eeprom</a>[<a class="code" href="chan__usbradio_8c.html#ad366055db4b38c2d08fa4773bec2d17a">EEPROM_RXMIXERSET</a>];
<a name="l01194"></a>01194                   o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5dca179fe41743d80bd66e6a21de9fac">txmixaset</a> =    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac31262f80afbd912435464107e0d054d">eeprom</a>[<a class="code" href="chan__usbradio_8c.html#a93f87606ce71cf06fc9469404bcd2f8e">EEPROM_TXMIXASET</a>];
<a name="l01195"></a>01195                   o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac2c2424ad6a5ca0a0c6f7026e74d7701">txmixbset</a> = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac31262f80afbd912435464107e0d054d">eeprom</a>[<a class="code" href="chan__usbradio_8c.html#a439cb7d09b0d38aa956758d174935074">EEPROM_TXMIXBSET</a>];
<a name="l01196"></a>01196                   memcpy(&amp;o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0d9da32dc6edbbd18f90722056331b65">rxvoiceadj</a>,&amp;o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac31262f80afbd912435464107e0d054d">eeprom</a>[<a class="code" href="chan__usbradio_8c.html#a7d5f33700253c5914fac418bde3482b7">EEPROM_RXVOICEADJ</a>],<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));
<a name="l01197"></a>01197                   memcpy(&amp;o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0da461807e1a48746fd856ae6aa21499">rxctcssadj</a>,&amp;o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac31262f80afbd912435464107e0d054d">eeprom</a>[<a class="code" href="chan__usbradio_8c.html#a15e2375389dc1811e52506c4cea0fd6d">EEPROM_RXCTCSSADJ</a>],<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));
<a name="l01198"></a>01198                   o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af559c722569892f0612ff5c65493fe7a">txctcssadj</a> = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac31262f80afbd912435464107e0d054d">eeprom</a>[<a class="code" href="chan__usbradio_8c.html#a23c8442c744ec0f73f5d825fa470c704">EEPROM_TXCTCSSADJ</a>];
<a name="l01199"></a>01199                   o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a1745424fe0dd99b7d3a778a253a5d686">rxsquelchadj</a> = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac31262f80afbd912435464107e0d054d">eeprom</a>[<a class="code" href="chan__usbradio_8c.html#ae4b084ebdee2a0b600e62d67a71f3f94">EEPROM_RXSQUELCHADJ</a>];
<a name="l01200"></a>01200                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;EEPROM Loaded on channel %s\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l01201"></a>01201                }
<a name="l01202"></a>01202             }
<a name="l01203"></a>01203             <span class="keywordflow">else</span>
<a name="l01204"></a>01204             {
<a name="l01205"></a>01205                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;USB Adapter has no EEPROM installed or Checksum BAD on channel %s\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l01206"></a>01206             }
<a name="l01207"></a>01207             <a class="code" href="chan__usbradio_8c.html#ad8157eb0b78b43232433f943c3e48aaa">hid_set_outputs</a>(usb_handle,bufsave);
<a name="l01208"></a>01208          } 
<a name="l01209"></a>01209          <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#aa4c4270e4903db2dcb2ee7e3a7966ca3">eepromctl</a> == 2) <span class="comment">/* to write */</span>
<a name="l01210"></a>01210          {
<a name="l01211"></a>01211             <a class="code" href="chan__usbradio_8c.html#a69e5b6b3bd9d19d3ad1b781730901b86">put_eeprom</a>(usb_handle,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac31262f80afbd912435464107e0d054d">eeprom</a>);
<a name="l01212"></a>01212             <a class="code" href="chan__usbradio_8c.html#ad8157eb0b78b43232433f943c3e48aaa">hid_set_outputs</a>(usb_handle,bufsave);
<a name="l01213"></a>01213             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;USB Parameters written to EEPROM on %s\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l01214"></a>01214          }
<a name="l01215"></a>01215          o-&gt;<a class="code" href="structchan__usbradio__pvt.html#aa4c4270e4903db2dcb2ee7e3a7966ca3">eepromctl</a> = 0;
<a name="l01216"></a>01216          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0cb029a4ba4ae628b6f5431a4cbb753f">eepromlock</a>);
<a name="l01217"></a>01217       }
<a name="l01218"></a>01218       buf[o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a24fbd2c9b0fc7e56bcb66e0499333fec">hid_gpio_ctl_loc</a>] = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a4daaa2a04c1f3cef618b8f7f2b2dbc66">hid_gpio_ctl</a>;
<a name="l01219"></a>01219       <a class="code" href="chan__usbradio_8c.html#a28cc3dfb337dbda1fdfe0a81bf853b97">hid_get_inputs</a>(usb_handle,buf);
<a name="l01220"></a>01220       keyed = !(buf[o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0b6a895a9ef97321dfc53b56734efa20">hid_io_cor_loc</a>] &amp; o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a7024a18b225ef731da6391ef59ffa0c1">hid_io_cor</a>);
<a name="l01221"></a>01221       <span class="keywordflow">if</span> (keyed != o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a31415c43e2f6cb3eefc6f0b86dec2b21">rxhidsq</a>)
<a name="l01222"></a>01222       {
<a name="l01223"></a>01223          <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a8bc52eafdec6e1ab31955b8e407746ba">debuglevel</a>)printf(<span class="stringliteral">&quot;chan_usbradio() hidthread: update rxhidsq = %d\n&quot;</span>,keyed);
<a name="l01224"></a>01224          o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a31415c43e2f6cb3eefc6f0b86dec2b21">rxhidsq</a>=keyed;
<a name="l01225"></a>01225       }
<a name="l01226"></a>01226 
<a name="l01227"></a>01227       <span class="comment">/* if change in tx state as controlled by xpmr */</span>
<a name="l01228"></a>01228       txtmp=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;txPttOut;
<a name="l01229"></a>01229             
<a name="l01230"></a>01230       <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ae7c1bd7aa1c831e7d13648fd13e1b6a6">lasttx</a> != txtmp)
<a name="l01231"></a>01231       {
<a name="l01232"></a>01232          o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;txPttHid=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ae7c1bd7aa1c831e7d13648fd13e1b6a6">lasttx</a> = txtmp;
<a name="l01233"></a>01233          <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a8bc52eafdec6e1ab31955b8e407746ba">debuglevel</a>)printf(<span class="stringliteral">&quot;hidthread: tx set to %d\n&quot;</span>,txtmp);
<a name="l01234"></a>01234          buf[o-&gt;<a class="code" href="structchan__usbradio__pvt.html#afc21a1f1175ad7a1b6c3db6a23382ad4">hid_gpio_loc</a>] = 0;
<a name="l01235"></a>01235          <span class="keywordflow">if</span> (!o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a16bef002aa5c9dc00ccd30bd1638cd73">invertptt</a>)
<a name="l01236"></a>01236          {
<a name="l01237"></a>01237             <span class="keywordflow">if</span> (txtmp) buf[o-&gt;<a class="code" href="structchan__usbradio__pvt.html#afc21a1f1175ad7a1b6c3db6a23382ad4">hid_gpio_loc</a>] = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a986fd9e827a7571882f177c9b5598951">hid_io_ptt</a>;
<a name="l01238"></a>01238          }
<a name="l01239"></a>01239          <span class="keywordflow">else</span>
<a name="l01240"></a>01240          {
<a name="l01241"></a>01241             <span class="keywordflow">if</span> (!txtmp) buf[o-&gt;<a class="code" href="structchan__usbradio__pvt.html#afc21a1f1175ad7a1b6c3db6a23382ad4">hid_gpio_loc</a>] = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a986fd9e827a7571882f177c9b5598951">hid_io_ptt</a>;
<a name="l01242"></a>01242          }
<a name="l01243"></a>01243          buf[o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a24fbd2c9b0fc7e56bcb66e0499333fec">hid_gpio_ctl_loc</a>] = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a4daaa2a04c1f3cef618b8f7f2b2dbc66">hid_gpio_ctl</a>;
<a name="l01244"></a>01244          memcpy(bufsave,buf,<span class="keyword">sizeof</span>(buf));
<a name="l01245"></a>01245          <a class="code" href="chan__usbradio_8c.html#ad8157eb0b78b43232433f943c3e48aaa">hid_set_outputs</a>(usb_handle,buf);
<a name="l01246"></a>01246       }
<a name="l01247"></a>01247       time(&amp;o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ad1acec14ee8fb8cd2c5ec8d095029f91">lasthidtime</a>);
<a name="l01248"></a>01248    }
<a name="l01249"></a>01249    buf[o-&gt;<a class="code" href="structchan__usbradio__pvt.html#afc21a1f1175ad7a1b6c3db6a23382ad4">hid_gpio_loc</a>] = 0;
<a name="l01250"></a>01250    <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a16bef002aa5c9dc00ccd30bd1638cd73">invertptt</a>) buf[o-&gt;<a class="code" href="structchan__usbradio__pvt.html#afc21a1f1175ad7a1b6c3db6a23382ad4">hid_gpio_loc</a>] = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a986fd9e827a7571882f177c9b5598951">hid_io_ptt</a>;
<a name="l01251"></a>01251    buf[o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a24fbd2c9b0fc7e56bcb66e0499333fec">hid_gpio_ctl_loc</a>] = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a4daaa2a04c1f3cef618b8f7f2b2dbc66">hid_gpio_ctl</a>;
<a name="l01252"></a>01252    <a class="code" href="chan__usbradio_8c.html#ad8157eb0b78b43232433f943c3e48aaa">hid_set_outputs</a>(usb_handle,buf);
<a name="l01253"></a>01253    pthread_exit(0);
<a name="l01254"></a>01254 }
<a name="l01255"></a>01255 
<a name="l01256"></a>01256 <span class="comment">/*</span>
<a name="l01257"></a>01257 <span class="comment"> * returns a pointer to the descriptor with the given name</span>
<a name="l01258"></a>01258 <span class="comment"> */</span>
<a name="l01259"></a><a class="code" href="chan__usbradio_8c.html#ac7145e9cf19c5cf2a51fcdb3e747eabe">01259</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *<a class="code" href="chan__usbradio_8c.html#ac7145e9cf19c5cf2a51fcdb3e747eabe">find_desc</a>(<span class="keywordtype">char</span> *dev)
<a name="l01260"></a>01260 {
<a name="l01261"></a>01261    <span class="keyword">struct </span><a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o = NULL;
<a name="l01262"></a>01262 
<a name="l01263"></a>01263    <span class="keywordflow">if</span> (!dev)
<a name="l01264"></a>01264       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;null dev\n&quot;</span>);
<a name="l01265"></a>01265 
<a name="l01266"></a>01266    <span class="keywordflow">for</span> (o = usbradio_default.<a class="code" href="structchan__usbradio__pvt.html#a9f87d8717635cfb958525ea3b179ff4f">next</a>; o &amp;&amp; o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5ac083a645d964373f022d03df4849c8">name</a> &amp;&amp; dev &amp;&amp; strcmp(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5ac083a645d964373f022d03df4849c8">name</a>, dev) != 0; o = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9f87d8717635cfb958525ea3b179ff4f">next</a>);
<a name="l01267"></a>01267    <span class="keywordflow">if</span> (!o)
<a name="l01268"></a>01268    {
<a name="l01269"></a>01269       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;could not find &lt;%s&gt;\n&quot;</span>, dev ? dev : <span class="stringliteral">&quot;--no-device--&quot;</span>);
<a name="l01270"></a>01270       pthread_exit(0);
<a name="l01271"></a>01271    }
<a name="l01272"></a>01272 
<a name="l01273"></a>01273    <span class="keywordflow">return</span> o;
<a name="l01274"></a>01274 }
<a name="l01275"></a>01275 
<a name="l01276"></a><a class="code" href="chan__usbradio_8c.html#a17bc28c0dd48dd624e682fd416c4754b">01276</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *<a class="code" href="chan__usbradio_8c.html#a17bc28c0dd48dd624e682fd416c4754b">find_desc_usb</a>(<span class="keywordtype">char</span> *<a class="code" href="structchan__usbradio__pvt.html#ae0013a0ec03c2c35c2966c6aa3147abd">devstr</a>)
<a name="l01277"></a>01277 {
<a name="l01278"></a>01278    <span class="keyword">struct </span><a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o = NULL;
<a name="l01279"></a>01279 
<a name="l01280"></a>01280    <span class="keywordflow">if</span> (!devstr)
<a name="l01281"></a>01281       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;null dev\n&quot;</span>);
<a name="l01282"></a>01282 
<a name="l01283"></a>01283    <span class="keywordflow">for</span> (o = usbradio_default.<a class="code" href="structchan__usbradio__pvt.html#a9f87d8717635cfb958525ea3b179ff4f">next</a>; o &amp;&amp; devstr &amp;&amp; strcmp(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ae0013a0ec03c2c35c2966c6aa3147abd">devstr</a>, devstr) != 0; o = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9f87d8717635cfb958525ea3b179ff4f">next</a>);
<a name="l01284"></a>01284 
<a name="l01285"></a>01285    <span class="keywordflow">return</span> o;
<a name="l01286"></a>01286 }
<a name="l01287"></a>01287 
<a name="l01288"></a>01288 <span class="comment">/*</span>
<a name="l01289"></a>01289 <span class="comment"> * split a string in extension-context, returns pointers to malloc&apos;ed</span>
<a name="l01290"></a>01290 <span class="comment"> * strings.</span>
<a name="l01291"></a>01291 <span class="comment"> * If we do not have &apos;overridecontext&apos; then the last @ is considered as</span>
<a name="l01292"></a>01292 <span class="comment"> * a context separator, and the context is overridden.</span>
<a name="l01293"></a>01293 <span class="comment"> * This is usually not very necessary as you can play with the dialplan,</span>
<a name="l01294"></a>01294 <span class="comment"> * and it is nice not to need it because you have &apos;@&apos; in SIP addresses.</span>
<a name="l01295"></a>01295 <span class="comment"> * Return value is the buffer address.</span>
<a name="l01296"></a>01296 <span class="comment"> */</span>
<a name="l01297"></a>01297 <span class="preprocessor">#if   0</span>
<a name="l01298"></a>01298 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="chan__console_8c.html#a0c59b17c122f75812a2f84030270ddb6">ast_ext_ctx</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *src, <span class="keywordtype">char</span> **<a class="code" href="http_8c.html#af9b32121c4ad80b0887a3d73fd24de5f">ext</a>, <span class="keywordtype">char</span> **<a class="code" href="structchan__usbradio__pvt.html#a02d0db19ebec1fa1e0d29bda775c1096">ctx</a>)
<a name="l01299"></a>01299 {
<a name="l01300"></a>01300    <span class="keyword">struct </span><a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o = <a class="code" href="chan__usbradio_8c.html#ac7145e9cf19c5cf2a51fcdb3e747eabe">find_desc</a>(usbradio_active);
<a name="l01301"></a>01301 
<a name="l01302"></a>01302    <span class="keywordflow">if</span> (ext == NULL || ctx == NULL)
<a name="l01303"></a>01303       <span class="keywordflow">return</span> NULL;         <span class="comment">/* error */</span>
<a name="l01304"></a>01304 
<a name="l01305"></a>01305    *ext = *ctx = NULL;
<a name="l01306"></a>01306 
<a name="l01307"></a>01307    <span class="keywordflow">if</span> (src &amp;&amp; *src != <span class="charliteral">&apos;\0&apos;</span>)
<a name="l01308"></a>01308       *ext = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(src);
<a name="l01309"></a>01309 
<a name="l01310"></a>01310    <span class="keywordflow">if</span> (*ext == NULL)
<a name="l01311"></a>01311       <span class="keywordflow">return</span> NULL;
<a name="l01312"></a>01312 
<a name="l01313"></a>01313    <span class="keywordflow">if</span> (!o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a4eedfe56e88e9cb9777a619c022fe6a8">overridecontext</a>) {
<a name="l01314"></a>01314       <span class="comment">/* parse from the right */</span>
<a name="l01315"></a>01315       *ctx = strrchr(*ext, <span class="charliteral">&apos;@&apos;</span>);
<a name="l01316"></a>01316       <span class="keywordflow">if</span> (*ctx)
<a name="l01317"></a>01317          *(*ctx)++ = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01318"></a>01318    }
<a name="l01319"></a>01319 
<a name="l01320"></a>01320    <span class="keywordflow">return</span> *ext;
<a name="l01321"></a>01321 }
<a name="l01322"></a>01322 <span class="preprocessor">#endif</span>
<a name="l01323"></a>01323 <span class="preprocessor"></span>
<a name="l01324"></a>01324 <span class="comment">/*</span>
<a name="l01325"></a>01325 <span class="comment"> * Returns the number of blocks used in the audio output channel</span>
<a name="l01326"></a>01326 <span class="comment"> */</span>
<a name="l01327"></a><a class="code" href="chan__usbradio_8c.html#a3aa70c635cff43301c5c36ae927eda07">01327</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#a3aa70c635cff43301c5c36ae927eda07">used_blocks</a>(<span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o)
<a name="l01328"></a>01328 {
<a name="l01329"></a>01329    <span class="keyword">struct </span>audio_buf_info info;
<a name="l01330"></a>01330 
<a name="l01331"></a>01331    <span class="keywordflow">if</span> (ioctl(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac3fb672ce98321ddfeba0b02fba73298">sounddev</a>, SNDCTL_DSP_GETOSPACE, &amp;info)) {
<a name="l01332"></a>01332       <span class="keywordflow">if</span> (!(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a873db0c09e74a379eb9c741329f126f3">warned</a> &amp; <a class="code" href="chan__oss_8c.html#a11aaf77355342e1ba8feee89c4d66e51">WARN_used_blocks</a>)) {
<a name="l01333"></a>01333          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Error reading output space\n&quot;</span>);
<a name="l01334"></a>01334          o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a873db0c09e74a379eb9c741329f126f3">warned</a> |= <a class="code" href="chan__oss_8c.html#a11aaf77355342e1ba8feee89c4d66e51">WARN_used_blocks</a>;
<a name="l01335"></a>01335       }
<a name="l01336"></a>01336       <span class="keywordflow">return</span> 1;
<a name="l01337"></a>01337    }
<a name="l01338"></a>01338 
<a name="l01339"></a>01339    <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a665434db7b1be9dbe9d9729696eaa857">total_blocks</a> == 0) {
<a name="l01340"></a>01340       <span class="keywordflow">if</span> (0)               <span class="comment">/* debugging */</span>
<a name="l01341"></a>01341          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;fragtotal %d size %d avail %d\n&quot;</span>, info.fragstotal, info.fragsize, info.fragments);
<a name="l01342"></a>01342       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a665434db7b1be9dbe9d9729696eaa857">total_blocks</a> = info.fragments;
<a name="l01343"></a>01343    }
<a name="l01344"></a>01344 
<a name="l01345"></a>01345    <span class="keywordflow">return</span> o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a665434db7b1be9dbe9d9729696eaa857">total_blocks</a> - info.fragments;
<a name="l01346"></a>01346 }
<a name="l01347"></a>01347 
<a name="l01348"></a>01348 <span class="comment">/* Write an exactly FRAME_SIZE sized frame */</span>
<a name="l01349"></a><a class="code" href="chan__usbradio_8c.html#ac027145f62b02322b98b86b3cf4cc9bd">01349</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#ac027145f62b02322b98b86b3cf4cc9bd">soundcard_writeframe</a>(<span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o, <span class="keywordtype">short</span> *data)
<a name="l01350"></a>01350 {
<a name="l01351"></a>01351    <span class="keywordtype">int</span> res;
<a name="l01352"></a>01352 
<a name="l01353"></a>01353    <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac3fb672ce98321ddfeba0b02fba73298">sounddev</a> &lt; 0)
<a name="l01354"></a>01354       <a class="code" href="chan__usbradio_8c.html#a42967187d12d487ff0848ee5e9b12d8f">setformat</a>(o, O_RDWR);
<a name="l01355"></a>01355    <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac3fb672ce98321ddfeba0b02fba73298">sounddev</a> &lt; 0)
<a name="l01356"></a>01356       <span class="keywordflow">return</span> 0;            <span class="comment">/* not fatal */</span>
<a name="l01357"></a>01357    <span class="comment">//  maw maw sph !!! may or may not be a good thing</span>
<a name="l01358"></a>01358    <span class="comment">//  drop the frame if not transmitting, this keeps from gradually</span>
<a name="l01359"></a>01359    <span class="comment">//  filling the buffer when asterisk clock &gt; usb sound clock</span>
<a name="l01360"></a>01360    <span class="keywordflow">if</span>(!o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;txPttIn &amp;&amp; !o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;txPttOut)
<a name="l01361"></a>01361    {
<a name="l01362"></a>01362       <span class="comment">//return 0;</span>
<a name="l01363"></a>01363    }
<a name="l01364"></a>01364    <span class="comment">/*</span>
<a name="l01365"></a>01365 <span class="comment">    * Nothing complex to manage the audio device queue.</span>
<a name="l01366"></a>01366 <span class="comment">    * If the buffer is full just drop the extra, otherwise write.</span>
<a name="l01367"></a>01367 <span class="comment">    * XXX in some cases it might be useful to write anyways after</span>
<a name="l01368"></a>01368 <span class="comment">    * a number of failures, to restart the output chain.</span>
<a name="l01369"></a>01369 <span class="comment">    */</span>
<a name="l01370"></a>01370    res = <a class="code" href="chan__usbradio_8c.html#a3aa70c635cff43301c5c36ae927eda07">used_blocks</a>(o);
<a name="l01371"></a>01371    <span class="keywordflow">if</span> (res &gt; o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a33e55b30ec9ce66362b23d8fb1582630">queuesize</a>) {  <span class="comment">/* no room to write a block */</span>
<a name="l01372"></a>01372        <span class="comment">// ast_log(LOG_WARNING, &quot;sound device write buffer overflow\n&quot;);</span>
<a name="l01373"></a>01373       <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af9377710db171b729a953696795e29b3">w_errors</a>++ == 0 &amp;&amp; (usbradio_debug &amp; 0x4))
<a name="l01374"></a>01374          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;write: used %d blocks (%d)\n&quot;</span>, res, o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af9377710db171b729a953696795e29b3">w_errors</a>);
<a name="l01375"></a>01375       <span class="keywordflow">return</span> 0;
<a name="l01376"></a>01376    }
<a name="l01377"></a>01377    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af9377710db171b729a953696795e29b3">w_errors</a> = 0;
<a name="l01378"></a>01378 
<a name="l01379"></a>01379    <span class="keywordflow">return</span> write(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac3fb672ce98321ddfeba0b02fba73298">sounddev</a>, ((<span class="keywordtype">void</span> *) data), <a class="code" href="chan__alsa_8c.html#af9b1b2ba12857a4bf11289dac8c5462d">FRAME_SIZE</a> * 2 * 12);
<a name="l01380"></a>01380 }
<a name="l01381"></a>01381 
<a name="l01382"></a>01382 <span class="preprocessor">#ifndef  NEW_ASTERISK</span>
<a name="l01383"></a>01383 <span class="preprocessor"></span>
<a name="l01384"></a>01384 <span class="comment">/*</span>
<a name="l01385"></a>01385 <span class="comment"> * Handler for &apos;sound writable&apos; events from the sound thread.</span>
<a name="l01386"></a>01386 <span class="comment"> * Builds a frame from the high level description of the sounds,</span>
<a name="l01387"></a>01387 <span class="comment"> * and passes it to the audio device.</span>
<a name="l01388"></a>01388 <span class="comment"> * The actual sound is made of 1 or more sequences of sound samples</span>
<a name="l01389"></a>01389 <span class="comment"> * (s-&gt;datalen, repeated to make s-&gt;samplen samples) followed by</span>
<a name="l01390"></a>01390 <span class="comment"> * s-&gt;silencelen samples of silence. The position in the sequence is stored</span>
<a name="l01391"></a>01391 <span class="comment"> * in o-&gt;sampsent, which goes between 0 .. s-&gt;samplen+s-&gt;silencelen.</span>
<a name="l01392"></a>01392 <span class="comment"> * In case we fail to write a frame, don&apos;t update o-&gt;sampsent.</span>
<a name="l01393"></a>01393 <span class="comment"> */</span>
<a name="l01394"></a>01394 <span class="keyword">static</span> <span class="keywordtype">void</span> send_sound(<span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o)
<a name="l01395"></a>01395 {
<a name="l01396"></a>01396    <span class="keywordtype">short</span> myframe[<a class="code" href="chan__alsa_8c.html#af9b1b2ba12857a4bf11289dac8c5462d">FRAME_SIZE</a>];
<a name="l01397"></a>01397    <span class="keywordtype">int</span> ofs, l, start;
<a name="l01398"></a>01398    <span class="keywordtype">int</span> l_sampsent = o-&gt;sampsent;
<a name="l01399"></a>01399    <span class="keyword">struct </span><a class="code" href="structsound.html">sound</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>;
<a name="l01400"></a>01400 
<a name="l01401"></a>01401    <span class="keywordflow">if</span> (o-&gt;cursound &lt; 0)    <span class="comment">/* no sound to send */</span>
<a name="l01402"></a>01402       <span class="keywordflow">return</span>;
<a name="l01403"></a>01403 
<a name="l01404"></a>01404    s = &amp;sounds[o-&gt;cursound];
<a name="l01405"></a>01405 
<a name="l01406"></a>01406    <span class="keywordflow">for</span> (ofs = 0; ofs &lt; <a class="code" href="chan__alsa_8c.html#af9b1b2ba12857a4bf11289dac8c5462d">FRAME_SIZE</a>; ofs += l) {
<a name="l01407"></a>01407       l = s-&gt;<a class="code" href="structsound.html#ac65e0a7e9609ebd62a1863960b2fa0a8">samplen</a> - l_sampsent;  <span class="comment">/* # of available samples */</span>
<a name="l01408"></a>01408       <span class="keywordflow">if</span> (l &gt; 0) {
<a name="l01409"></a>01409          start = l_sampsent % s-&gt;<a class="code" href="structsound.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>; <span class="comment">/* source offset */</span>
<a name="l01410"></a>01410          <span class="keywordflow">if</span> (l &gt; FRAME_SIZE - ofs)  <span class="comment">/* don&apos;t overflow the frame */</span>
<a name="l01411"></a>01411             l = FRAME_SIZE - ofs;
<a name="l01412"></a>01412          <span class="keywordflow">if</span> (l &gt; s-&gt;<a class="code" href="structsound.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> - start)   <span class="comment">/* don&apos;t overflow the source */</span>
<a name="l01413"></a>01413             l = s-&gt;<a class="code" href="structsound.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> - start;
<a name="l01414"></a>01414          memmove(myframe + ofs, s-&gt;<a class="code" href="structsound.html#a5b5b032f747e9383fc0d98f7054e258f">data</a> + start, l * 2);
<a name="l01415"></a>01415          <span class="keywordflow">if</span> (0)
<a name="l01416"></a>01416             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;send_sound sound %d/%d of %d into %d\n&quot;</span>, l_sampsent, l, s-&gt;<a class="code" href="structsound.html#ac65e0a7e9609ebd62a1863960b2fa0a8">samplen</a>, ofs);
<a name="l01417"></a>01417          l_sampsent += l;
<a name="l01418"></a>01418       } <span class="keywordflow">else</span> {          <span class="comment">/* end of samples, maybe some silence */</span>
<a name="l01419"></a>01419          <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">short</span> silence[FRAME_SIZE] = { 0, };
<a name="l01420"></a>01420 
<a name="l01421"></a>01421          l += s-&gt;<a class="code" href="structsound.html#a0c0d26eb12ca48d8e332aa9fd547afb3">silencelen</a>;
<a name="l01422"></a>01422          <span class="keywordflow">if</span> (l &gt; 0) {
<a name="l01423"></a>01423             <span class="keywordflow">if</span> (l &gt; FRAME_SIZE - ofs)
<a name="l01424"></a>01424                l = FRAME_SIZE - ofs;
<a name="l01425"></a>01425             memmove(myframe + ofs, silence, l * 2);
<a name="l01426"></a>01426             l_sampsent += l;
<a name="l01427"></a>01427          } <span class="keywordflow">else</span> {       <span class="comment">/* silence is over, restart sound if loop */</span>
<a name="l01428"></a>01428             <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structsound.html#aa85ffe7728fe6b62d593de58cb66f232">repeat</a> == 0) {   <span class="comment">/* last block */</span>
<a name="l01429"></a>01429                o-&gt;cursound = -1;
<a name="l01430"></a>01430                o-&gt;nosound = 0;   <span class="comment">/* allow audio data */</span>
<a name="l01431"></a>01431                <span class="keywordflow">if</span> (ofs &lt; FRAME_SIZE)   <span class="comment">/* pad with silence */</span>
<a name="l01432"></a>01432                   memmove(myframe + ofs, silence, (FRAME_SIZE - ofs) * 2);
<a name="l01433"></a>01433             }
<a name="l01434"></a>01434             l_sampsent = 0;
<a name="l01435"></a>01435          }
<a name="l01436"></a>01436       }
<a name="l01437"></a>01437    }
<a name="l01438"></a>01438    l = <a class="code" href="chan__usbradio_8c.html#ac027145f62b02322b98b86b3cf4cc9bd">soundcard_writeframe</a>(o, myframe);
<a name="l01439"></a>01439    <span class="keywordflow">if</span> (l &gt; 0)
<a name="l01440"></a>01440       o-&gt;sampsent = l_sampsent;  <span class="comment">/* update status */</span>
<a name="l01441"></a>01441 }
<a name="l01442"></a>01442 
<a name="l01443"></a>01443 <span class="keyword">static</span> <span class="keywordtype">void</span> *sound_thread(<span class="keywordtype">void</span> *arg)
<a name="l01444"></a>01444 {
<a name="l01445"></a>01445    <span class="keywordtype">char</span> ign[4096];
<a name="l01446"></a>01446    <span class="keyword">struct </span><a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o = (<span class="keyword">struct </span><a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *) arg;
<a name="l01447"></a>01447 
<a name="l01448"></a>01448    <span class="comment">/*</span>
<a name="l01449"></a>01449 <span class="comment">    * Just in case, kick the driver by trying to read from it.</span>
<a name="l01450"></a>01450 <span class="comment">    * Ignore errors - this read is almost guaranteed to fail.</span>
<a name="l01451"></a>01451 <span class="comment">    */</span>
<a name="l01452"></a>01452    read(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac3fb672ce98321ddfeba0b02fba73298">sounddev</a>, ign, <span class="keyword">sizeof</span>(ign));
<a name="l01453"></a>01453    <span class="keywordflow">for</span> (;;) {
<a name="l01454"></a>01454       fd_set rfds, wfds;
<a name="l01455"></a>01455       <span class="keywordtype">int</span> maxfd, res;
<a name="l01456"></a>01456 
<a name="l01457"></a>01457       FD_ZERO(&amp;rfds);
<a name="l01458"></a>01458       FD_ZERO(&amp;wfds);
<a name="l01459"></a>01459       FD_SET(o-&gt;sndcmd[0], &amp;rfds);
<a name="l01460"></a>01460       maxfd = o-&gt;sndcmd[0];   <span class="comment">/* pipe from the main process */</span>
<a name="l01461"></a>01461       <span class="keywordflow">if</span> (o-&gt;cursound &gt; -1 &amp;&amp; o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac3fb672ce98321ddfeba0b02fba73298">sounddev</a> &lt; 0)
<a name="l01462"></a>01462          <a class="code" href="chan__usbradio_8c.html#a42967187d12d487ff0848ee5e9b12d8f">setformat</a>(o, O_RDWR);   <span class="comment">/* need the channel, try to reopen */</span>
<a name="l01463"></a>01463       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (o-&gt;cursound == -1 &amp;&amp; o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> == NULL)
<a name="l01464"></a>01464       {
<a name="l01465"></a>01465          <a class="code" href="chan__usbradio_8c.html#a42967187d12d487ff0848ee5e9b12d8f">setformat</a>(o, <a class="code" href="chan__oss_8c.html#a9d6bb64b7e9ca3602a00db074a84103d">O_CLOSE</a>);  <span class="comment">/* can close */</span>
<a name="l01466"></a>01466       }
<a name="l01467"></a>01467       <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac3fb672ce98321ddfeba0b02fba73298">sounddev</a> &gt; -1) {
<a name="l01468"></a>01468          <span class="keywordflow">if</span> (!o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {  <span class="comment">/* no one owns the audio, so we must drain it */</span>
<a name="l01469"></a>01469             FD_SET(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac3fb672ce98321ddfeba0b02fba73298">sounddev</a>, &amp;rfds);
<a name="l01470"></a>01470             maxfd = <a class="code" href="utils_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac3fb672ce98321ddfeba0b02fba73298">sounddev</a>, maxfd);
<a name="l01471"></a>01471          }
<a name="l01472"></a>01472          <span class="keywordflow">if</span> (o-&gt;cursound &gt; -1) {
<a name="l01473"></a>01473             FD_SET(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac3fb672ce98321ddfeba0b02fba73298">sounddev</a>, &amp;wfds);
<a name="l01474"></a>01474             maxfd = <a class="code" href="utils_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac3fb672ce98321ddfeba0b02fba73298">sounddev</a>, maxfd);
<a name="l01475"></a>01475          }
<a name="l01476"></a>01476       }
<a name="l01477"></a>01477       <span class="comment">/* ast_select emulates linux behaviour in terms of timeout handling */</span>
<a name="l01478"></a>01478       res = <a class="code" href="channel_8h.html#a056ed4f99440f01c251b2e8ca4501a56" title="Waits for activity on a group of channels.">ast_select</a>(maxfd + 1, &amp;rfds, &amp;wfds, NULL, NULL);
<a name="l01479"></a>01479       <span class="keywordflow">if</span> (res &lt; 1) {
<a name="l01480"></a>01480          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;select failed: %s\n&quot;</span>, strerror(errno));
<a name="l01481"></a>01481          sleep(1);
<a name="l01482"></a>01482          <span class="keywordflow">continue</span>;
<a name="l01483"></a>01483       }
<a name="l01484"></a>01484       <span class="keywordflow">if</span> (FD_ISSET(o-&gt;sndcmd[0], &amp;rfds)) {
<a name="l01485"></a>01485          <span class="comment">/* read which sound to play from the pipe */</span>
<a name="l01486"></a>01486          <span class="keywordtype">int</span> i, what = -1;
<a name="l01487"></a>01487 
<a name="l01488"></a>01488          read(o-&gt;sndcmd[0], &amp;what, <span class="keyword">sizeof</span>(what));
<a name="l01489"></a>01489          <span class="keywordflow">for</span> (i = 0; sounds[i].<a class="code" href="structsound.html#a4b00721003b8d35559a55c9098ff36c5">ind</a> != -1; i++) {
<a name="l01490"></a>01490             <span class="keywordflow">if</span> (sounds[i].ind == what) {
<a name="l01491"></a>01491                o-&gt;cursound = i;
<a name="l01492"></a>01492                o-&gt;sampsent = 0;
<a name="l01493"></a>01493                o-&gt;nosound = 1;   <span class="comment">/* block audio from pbx */</span>
<a name="l01494"></a>01494                <span class="keywordflow">break</span>;
<a name="l01495"></a>01495             }
<a name="l01496"></a>01496          }
<a name="l01497"></a>01497          <span class="keywordflow">if</span> (sounds[i].ind == -1)
<a name="l01498"></a>01498             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;invalid sound index: %d\n&quot;</span>, what);
<a name="l01499"></a>01499       }
<a name="l01500"></a>01500       <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac3fb672ce98321ddfeba0b02fba73298">sounddev</a> &gt; -1) {
<a name="l01501"></a>01501          <span class="keywordflow">if</span> (FD_ISSET(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac3fb672ce98321ddfeba0b02fba73298">sounddev</a>, &amp;rfds))   <span class="comment">/* read and ignore errors */</span>
<a name="l01502"></a>01502             read(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac3fb672ce98321ddfeba0b02fba73298">sounddev</a>, ign, <span class="keyword">sizeof</span>(ign)); 
<a name="l01503"></a>01503          <span class="keywordflow">if</span> (FD_ISSET(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac3fb672ce98321ddfeba0b02fba73298">sounddev</a>, &amp;wfds))
<a name="l01504"></a>01504             send_sound(o);
<a name="l01505"></a>01505       }
<a name="l01506"></a>01506    }
<a name="l01507"></a>01507    <span class="keywordflow">return</span> NULL;            <span class="comment">/* Never reached */</span>
<a name="l01508"></a>01508 }
<a name="l01509"></a>01509 
<a name="l01510"></a>01510 <span class="preprocessor">#endif</span>
<a name="l01511"></a>01511 <span class="preprocessor"></span>
<a name="l01512"></a>01512 <span class="comment">/*</span>
<a name="l01513"></a>01513 <span class="comment"> * reset and close the device if opened,</span>
<a name="l01514"></a>01514 <span class="comment"> * then open and initialize it in the desired mode,</span>
<a name="l01515"></a>01515 <span class="comment"> * trigger reads and writes so we can start using it.</span>
<a name="l01516"></a>01516 <span class="comment"> */</span>
<a name="l01517"></a><a class="code" href="chan__usbradio_8c.html#a42967187d12d487ff0848ee5e9b12d8f">01517</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#a42967187d12d487ff0848ee5e9b12d8f">setformat</a>(<span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o, <span class="keywordtype">int</span> mode)
<a name="l01518"></a>01518 {
<a name="l01519"></a>01519    <span class="keywordtype">int</span> fmt, desired, res, fd;
<a name="l01520"></a>01520    <span class="keywordtype">char</span> device[100];
<a name="l01521"></a>01521 
<a name="l01522"></a>01522    <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac3fb672ce98321ddfeba0b02fba73298">sounddev</a> &gt;= 0) {
<a name="l01523"></a>01523       ioctl(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac3fb672ce98321ddfeba0b02fba73298">sounddev</a>, SNDCTL_DSP_RESET, 0);
<a name="l01524"></a>01524       close(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac3fb672ce98321ddfeba0b02fba73298">sounddev</a>);
<a name="l01525"></a>01525       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#aeffa2366fd7f07a4bf00a7489df44977">duplex</a> = <a class="code" href="structchan__usbradio__pvt.html#abe974f22edeef8189603ba75fd90ff3ca89ae3203603c2cd0eecb06b10597f94f">M_UNSET</a>;
<a name="l01526"></a>01526       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac3fb672ce98321ddfeba0b02fba73298">sounddev</a> = -1;
<a name="l01527"></a>01527    }
<a name="l01528"></a>01528    <span class="keywordflow">if</span> (mode == <a class="code" href="chan__oss_8c.html#a9d6bb64b7e9ca3602a00db074a84103d">O_CLOSE</a>)    <span class="comment">/* we are done */</span>
<a name="l01529"></a>01529       <span class="keywordflow">return</span> 0;
<a name="l01530"></a>01530    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a335ae1f9f7ea2bc5d6cd92a35bb675c3">lastopen</a> = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l01531"></a>01531    strcpy(device,<span class="stringliteral">&quot;/dev/dsp&quot;</span>);
<a name="l01532"></a>01532    <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a7d942ce6a2ddec93dc13684d61b1750d">devicenum</a>)
<a name="l01533"></a>01533       sprintf(device,<span class="stringliteral">&quot;/dev/dsp%d&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a7d942ce6a2ddec93dc13684d61b1750d">devicenum</a>);
<a name="l01534"></a>01534    fd = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac3fb672ce98321ddfeba0b02fba73298">sounddev</a> = open(device, mode | O_NONBLOCK);
<a name="l01535"></a>01535    <span class="keywordflow">if</span> (fd &lt; 0) {
<a name="l01536"></a>01536       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to re-open DSP device %d: %s\n&quot;</span>, o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a7d942ce6a2ddec93dc13684d61b1750d">devicenum</a>, strerror(<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l01537"></a>01537       <span class="keywordflow">return</span> -1;
<a name="l01538"></a>01538    }
<a name="l01539"></a>01539    <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)
<a name="l01540"></a>01540       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#aef68cd3879b791a3b6c12cdb750f8e6a">fds</a>[0] = fd;
<a name="l01541"></a>01541 
<a name="l01542"></a>01542 <span class="preprocessor">#if __BYTE_ORDER == __LITTLE_ENDIAN</span>
<a name="l01543"></a>01543 <span class="preprocessor"></span>   fmt = AFMT_S16_LE;
<a name="l01544"></a>01544 <span class="preprocessor">#else</span>
<a name="l01545"></a>01545 <span class="preprocessor"></span>   fmt = AFMT_S16_BE;
<a name="l01546"></a>01546 <span class="preprocessor">#endif</span>
<a name="l01547"></a>01547 <span class="preprocessor"></span>   res = ioctl(fd, SNDCTL_DSP_SETFMT, &amp;fmt);
<a name="l01548"></a>01548    <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l01549"></a>01549       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to set format to 16-bit signed\n&quot;</span>);
<a name="l01550"></a>01550       <span class="keywordflow">return</span> -1;
<a name="l01551"></a>01551    }
<a name="l01552"></a>01552    <span class="keywordflow">switch</span> (mode) {
<a name="l01553"></a>01553       <span class="keywordflow">case</span> O_RDWR:
<a name="l01554"></a>01554          res = ioctl(fd, SNDCTL_DSP_SETDUPLEX, 0);
<a name="l01555"></a>01555          <span class="comment">/* Check to see if duplex set (FreeBSD Bug) */</span>
<a name="l01556"></a>01556          res = ioctl(fd, SNDCTL_DSP_GETCAPS, &amp;fmt);
<a name="l01557"></a>01557          <span class="keywordflow">if</span> (res == 0 &amp;&amp; (fmt &amp; DSP_CAP_DUPLEX)) {
<a name="l01558"></a>01558             <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#gaa294d0efa6a89c1a3d162787cac4fff5">option_verbose</a> &gt; 1)
<a name="l01559"></a>01559                <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<a class="code" href="logger_8h.html#a5623b2747e49964e0eae2795057bc92e">VERBOSE_PREFIX_2</a> <span class="stringliteral">&quot;Console is full duplex\n&quot;</span>);
<a name="l01560"></a>01560             o-&gt;<a class="code" href="structchan__usbradio__pvt.html#aeffa2366fd7f07a4bf00a7489df44977">duplex</a> = <a class="code" href="structchan__usbradio__pvt.html#abe974f22edeef8189603ba75fd90ff3ca4d444b330d2372546edf9ba1dc8f85e7">M_FULL</a>;
<a name="l01561"></a>01561          };
<a name="l01562"></a>01562          <span class="keywordflow">break</span>;
<a name="l01563"></a>01563       <span class="keywordflow">case</span> O_WRONLY:
<a name="l01564"></a>01564          o-&gt;<a class="code" href="structchan__usbradio__pvt.html#aeffa2366fd7f07a4bf00a7489df44977">duplex</a> = <a class="code" href="structchan__usbradio__pvt.html#abe974f22edeef8189603ba75fd90ff3ca7af369c035a45a9babde5a9443b5ef01">M_WRITE</a>;
<a name="l01565"></a>01565          <span class="keywordflow">break</span>;
<a name="l01566"></a>01566       <span class="keywordflow">case</span> O_RDONLY:
<a name="l01567"></a>01567          o-&gt;<a class="code" href="structchan__usbradio__pvt.html#aeffa2366fd7f07a4bf00a7489df44977">duplex</a> = <a class="code" href="structchan__usbradio__pvt.html#abe974f22edeef8189603ba75fd90ff3ca0cb0be5475011ea9319ce55b30e74634">M_READ</a>;
<a name="l01568"></a>01568          <span class="keywordflow">break</span>;
<a name="l01569"></a>01569    }
<a name="l01570"></a>01570 
<a name="l01571"></a>01571    fmt = 1;
<a name="l01572"></a>01572    res = ioctl(fd, SNDCTL_DSP_STEREO, &amp;fmt);
<a name="l01573"></a>01573    <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l01574"></a>01574       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to set audio device to mono\n&quot;</span>);
<a name="l01575"></a>01575       <span class="keywordflow">return</span> -1;
<a name="l01576"></a>01576    }
<a name="l01577"></a>01577    fmt = desired = 48000;                    <span class="comment">/* 8000 Hz desired */</span>
<a name="l01578"></a>01578    res = ioctl(fd, SNDCTL_DSP_SPEED, &amp;fmt);
<a name="l01579"></a>01579 
<a name="l01580"></a>01580    <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l01581"></a>01581       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to set audio device to mono\n&quot;</span>);
<a name="l01582"></a>01582       <span class="keywordflow">return</span> -1;
<a name="l01583"></a>01583    }
<a name="l01584"></a>01584    <span class="keywordflow">if</span> (fmt != desired) {
<a name="l01585"></a>01585       <span class="keywordflow">if</span> (!(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a873db0c09e74a379eb9c741329f126f3">warned</a> &amp; <a class="code" href="chan__oss_8c.html#a93bf0c7c887e8b899663f17882cf5b40">WARN_speed</a>)) {
<a name="l01586"></a>01586          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,
<a name="l01587"></a>01587              <span class="stringliteral">&quot;Requested %d Hz, got %d Hz -- sound may be choppy\n&quot;</span>,
<a name="l01588"></a>01588              desired, fmt);
<a name="l01589"></a>01589          o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a873db0c09e74a379eb9c741329f126f3">warned</a> |= <a class="code" href="chan__oss_8c.html#a93bf0c7c887e8b899663f17882cf5b40">WARN_speed</a>;
<a name="l01590"></a>01590       }
<a name="l01591"></a>01591    }
<a name="l01592"></a>01592    <span class="comment">/*</span>
<a name="l01593"></a>01593 <span class="comment">    * on Freebsd, SETFRAGMENT does not work very well on some cards.</span>
<a name="l01594"></a>01594 <span class="comment">    * Default to use 256 bytes, let the user override</span>
<a name="l01595"></a>01595 <span class="comment">    */</span>
<a name="l01596"></a>01596    <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a2f37ac27c86df549c61c5dcdc26de20d">frags</a>) {
<a name="l01597"></a>01597       fmt = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a2f37ac27c86df549c61c5dcdc26de20d">frags</a>;
<a name="l01598"></a>01598       res = ioctl(fd, SNDCTL_DSP_SETFRAGMENT, &amp;fmt);
<a name="l01599"></a>01599       <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l01600"></a>01600          <span class="keywordflow">if</span> (!(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a873db0c09e74a379eb9c741329f126f3">warned</a> &amp; <a class="code" href="chan__oss_8c.html#a422b43626fc2d780dad3ca0280b79225">WARN_frag</a>)) {
<a name="l01601"></a>01601             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,
<a name="l01602"></a>01602                <span class="stringliteral">&quot;Unable to set fragment size -- sound may be choppy\n&quot;</span>);
<a name="l01603"></a>01603             o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a873db0c09e74a379eb9c741329f126f3">warned</a> |= <a class="code" href="chan__oss_8c.html#a422b43626fc2d780dad3ca0280b79225">WARN_frag</a>;
<a name="l01604"></a>01604          }
<a name="l01605"></a>01605       }
<a name="l01606"></a>01606    }
<a name="l01607"></a>01607    <span class="comment">/* on some cards, we need SNDCTL_DSP_SETTRIGGER to start outputting */</span>
<a name="l01608"></a>01608    res = PCM_ENABLE_INPUT | PCM_ENABLE_OUTPUT;
<a name="l01609"></a>01609    res = ioctl(fd, SNDCTL_DSP_SETTRIGGER, &amp;res);
<a name="l01610"></a>01610    <span class="comment">/* it may fail if we are in half duplex, never mind */</span>
<a name="l01611"></a>01611    <span class="keywordflow">return</span> 0;
<a name="l01612"></a>01612 }
<a name="l01613"></a>01613 
<a name="l01614"></a>01614 <span class="comment">/*</span>
<a name="l01615"></a>01615 <span class="comment"> * some of the standard methods supported by channels.</span>
<a name="l01616"></a>01616 <span class="comment"> */</span>
<a name="l01617"></a><a class="code" href="chan__usbradio_8c.html#ac7083072979a032dd3e4fad9ba8098c3">01617</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#ac7083072979a032dd3e4fad9ba8098c3">usbradio_digit_begin</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c, <span class="keywordtype">char</span> digit)
<a name="l01618"></a>01618 {
<a name="l01619"></a>01619    <span class="keywordflow">return</span> 0;
<a name="l01620"></a>01620 }
<a name="l01621"></a>01621 
<a name="l01622"></a><a class="code" href="chan__usbradio_8c.html#a3c9dcc9efc3aaf3f5609f47d015d0ce9">01622</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#a3c9dcc9efc3aaf3f5609f47d015d0ce9">usbradio_digit_end</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c, <span class="keywordtype">char</span> digit, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> duration)
<a name="l01623"></a>01623 {
<a name="l01624"></a>01624    <span class="comment">/* no better use for received digits than print them */</span>
<a name="l01625"></a>01625    <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot; &lt;&lt; Console Received digit %c of duration %u ms &gt;&gt; \n&quot;</span>, 
<a name="l01626"></a>01626       digit, duration);
<a name="l01627"></a>01627    <span class="keywordflow">return</span> 0;
<a name="l01628"></a>01628 }
<a name="l01629"></a>01629 <span class="comment">/*</span>
<a name="l01630"></a>01630 <span class="comment">   SETFREQ - sets spi programmable xcvr</span>
<a name="l01631"></a>01631 <span class="comment">   SETCHAN - sets binary parallel xcvr</span>
<a name="l01632"></a>01632 <span class="comment">*/</span>
<a name="l01633"></a><a class="code" href="chan__usbradio_8c.html#ad92360a30b8672357cf72d66078c4739">01633</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#ad92360a30b8672357cf72d66078c4739">usbradio_text</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="app__queue_8c.html#a5633b1433389cec21ade3811bbe9ca5b">text</a>)
<a name="l01634"></a>01634 {
<a name="l01635"></a>01635    <span class="keyword">struct </span><a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o = <a class="code" href="chan__usbradio_8c.html#ac7145e9cf19c5cf2a51fcdb3e747eabe">find_desc</a>(usbradio_active);
<a name="l01636"></a>01636    <span class="keywordtype">double</span> tx,rx;
<a name="l01637"></a>01637    <span class="keywordtype">char</span> cnt,rxs[16],txs[16],txpl[16],rxpl[16];
<a name="l01638"></a>01638    <span class="keywordtype">char</span> pwr,*cmd;
<a name="l01639"></a>01639 
<a name="l01640"></a>01640    cmd = alloca(strlen(text) + 10);
<a name="l01641"></a>01641 
<a name="l01642"></a>01642    <span class="comment">/* print received messages */</span>
<a name="l01643"></a>01643    <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a8bc52eafdec6e1ab31955b8e407746ba">debuglevel</a>)<a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot; &lt;&lt; Console Received usbradio text %s &gt;&gt; \n&quot;</span>, text);
<a name="l01644"></a>01644 
<a name="l01645"></a>01645    cnt = sscanf(text, <span class="stringliteral">&quot;%300s %15s %15s %15s %15s %1c&quot;</span>, cmd, rxs, txs, rxpl, txpl, &amp;pwr);
<a name="l01646"></a>01646 
<a name="l01647"></a>01647    <span class="keywordflow">if</span> (strcmp(cmd,<span class="stringliteral">&quot;SETCHAN&quot;</span>)==0)
<a name="l01648"></a>01648     { 
<a name="l01649"></a>01649       u8 <a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>;
<a name="l01650"></a>01650       chan=strtod(rxs,NULL);
<a name="l01651"></a>01651       ppbinout(chan);
<a name="l01652"></a>01652         <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a8bc52eafdec6e1ab31955b8e407746ba">debuglevel</a>)<a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;parse usbradio SETCHAN cmd: %s chan: %i\n&quot;</span>,text,chan);
<a name="l01653"></a>01653         <span class="keywordflow">return</span> 0;
<a name="l01654"></a>01654     }
<a name="l01655"></a>01655    
<a name="l01656"></a>01656     <span class="keywordflow">if</span> (cnt &lt; 6)
<a name="l01657"></a>01657     {
<a name="l01658"></a>01658        <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,<span class="stringliteral">&quot;Cannot parse usbradio text: %s\n&quot;</span>,text);
<a name="l01659"></a>01659        <span class="keywordflow">return</span> 0;
<a name="l01660"></a>01660     }
<a name="l01661"></a>01661    <span class="keywordflow">else</span>
<a name="l01662"></a>01662    {
<a name="l01663"></a>01663       <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a8bc52eafdec6e1ab31955b8e407746ba">debuglevel</a>)<a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot; &lt;&lt; %s %s %s %s %s %c &gt;&gt; \n&quot;</span>, cmd,rxs,txs,rxpl,txpl,pwr);   
<a name="l01664"></a>01664    }
<a name="l01665"></a>01665     
<a name="l01666"></a>01666     <span class="keywordflow">if</span> (strcmp(cmd,<span class="stringliteral">&quot;SETFREQ&quot;</span>)==0)
<a name="l01667"></a>01667     {
<a name="l01668"></a>01668         <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a8bc52eafdec6e1ab31955b8e407746ba">debuglevel</a>)<a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;parse usbradio SETFREQ cmd: %s\n&quot;</span>,text);
<a name="l01669"></a>01669       tx=strtod(txs,NULL);
<a name="l01670"></a>01670       rx=strtod(rxs,NULL);
<a name="l01671"></a>01671       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a2c0e6eb590cb812c4b03c7a57be9656e">set_txfreq</a> = round(tx * (<span class="keywordtype">double</span>)1000000);
<a name="l01672"></a>01672       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0bafa0a226e4538d6f64cd522580d1cd">set_rxfreq</a> = round(rx * (<span class="keywordtype">double</span>)1000000);
<a name="l01673"></a>01673       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;txpower = (pwr == <span class="charliteral">&apos;H&apos;</span>);
<a name="l01674"></a>01674       strcpy(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a36bb704870959c8638d2a7f438ce528e">set_rxctcssfreqs</a>,rxpl);
<a name="l01675"></a>01675       strcpy(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9df6c1ad2df4cdc5c71c38034d5d2c9c">set_txctcssfreqs</a>,txpl);
<a name="l01676"></a>01676    
<a name="l01677"></a>01677       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a933ce66d291cb7d99d8693683d0a3f7d">b</a>.<a class="code" href="structchan__usbradio__pvt.html#aef7ddb05106487178eb92abe88289e7f">remoted</a>=1;
<a name="l01678"></a>01678       <a class="code" href="chan__usbradio_8c.html#a5f60010431301ac2b329a1910776855d">xpmr_config</a>(o);
<a name="l01679"></a>01679         <span class="keywordflow">return</span> 0;
<a name="l01680"></a>01680     }
<a name="l01681"></a>01681    <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,<span class="stringliteral">&quot;Cannot parse usbradio cmd: %s\n&quot;</span>,text);
<a name="l01682"></a>01682    <span class="keywordflow">return</span> 0;
<a name="l01683"></a>01683 }
<a name="l01684"></a>01684 
<a name="l01685"></a>01685 <span class="comment">/* Play ringtone &apos;x&apos; on device &apos;o&apos; */</span>
<a name="l01686"></a><a class="code" href="chan__usbradio_8c.html#ac2043109d0094474173e42a642c1bd20">01686</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__usbradio_8c.html#ac2043109d0094474173e42a642c1bd20">ring</a>(<span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o, <span class="keywordtype">int</span> x)
<a name="l01687"></a>01687 {
<a name="l01688"></a>01688 <span class="preprocessor">#ifndef  NEW_ASTERISK</span>
<a name="l01689"></a>01689 <span class="preprocessor"></span>   write(o-&gt;sndcmd[1], &amp;x, <span class="keyword">sizeof</span>(x));
<a name="l01690"></a>01690 <span class="preprocessor">#endif</span>
<a name="l01691"></a>01691 <span class="preprocessor"></span>}
<a name="l01692"></a>01692 
<a name="l01693"></a>01693 <span class="comment">/*</span>
<a name="l01694"></a>01694 <span class="comment"> * handler for incoming calls. Either autoanswer, or start ringing</span>
<a name="l01695"></a>01695 <span class="comment"> */</span>
<a name="l01696"></a><a class="code" href="chan__usbradio_8c.html#a332ffd8c9846a82679afcf09e74d8b4b">01696</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#a332ffd8c9846a82679afcf09e74d8b4b">usbradio_call</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c, <span class="keywordtype">char</span> *dest, <span class="keywordtype">int</span> timeout)
<a name="l01697"></a>01697 {
<a name="l01698"></a>01698    <span class="keyword">struct </span><a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o = c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l01699"></a>01699 
<a name="l01700"></a>01700    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a81ba3b4ebe2534f4cfc69a57a2d7debe">stophid</a> = 0;
<a name="l01701"></a>01701    time(&amp;o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ad1acec14ee8fb8cd2c5ec8d095029f91">lasthidtime</a>);
<a name="l01702"></a>01702    <a class="code" href="utils_8h.html#a595e2f8aa398f4bd21e381c3211235fe">ast_pthread_create_background</a>(&amp;o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5825b205dd44a058bfe41b597755155b">hidthread</a>, NULL, <a class="code" href="chan__usbradio_8c.html#a391b2cd28c9f4bcdff19631cf45c4f0f">hidthread</a>, o);
<a name="l01703"></a>01703    <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(c, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>);
<a name="l01704"></a>01704    <span class="keywordflow">return</span> 0;
<a name="l01705"></a>01705 }
<a name="l01706"></a>01706 
<a name="l01707"></a>01707 <span class="comment">/*</span>
<a name="l01708"></a>01708 <span class="comment"> * remote side answered the phone</span>
<a name="l01709"></a>01709 <span class="comment"> */</span>
<a name="l01710"></a><a class="code" href="chan__usbradio_8c.html#a0566de6f425cddb922d952cb64615730">01710</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#a0566de6f425cddb922d952cb64615730">usbradio_answer</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c)
<a name="l01711"></a>01711 {
<a name="l01712"></a>01712 <span class="preprocessor">#ifndef  NEW_ASTERISK</span>
<a name="l01713"></a>01713 <span class="preprocessor"></span>   <span class="keyword">struct </span><a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o = c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l01714"></a>01714 <span class="preprocessor">#endif</span>
<a name="l01715"></a>01715 <span class="preprocessor"></span>
<a name="l01716"></a>01716    <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(c, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>);
<a name="l01717"></a>01717 <span class="preprocessor">#ifndef  NEW_ASTERISK</span>
<a name="l01718"></a>01718 <span class="preprocessor"></span>   o-&gt;cursound = -1;
<a name="l01719"></a>01719    o-&gt;nosound = 0;
<a name="l01720"></a>01720 <span class="preprocessor">#endif</span>
<a name="l01721"></a>01721 <span class="preprocessor"></span>   <span class="keywordflow">return</span> 0;
<a name="l01722"></a>01722 }
<a name="l01723"></a>01723 
<a name="l01724"></a><a class="code" href="chan__usbradio_8c.html#a216ea444f5b791482338a7644a50eb30">01724</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#a216ea444f5b791482338a7644a50eb30">usbradio_hangup</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c)
<a name="l01725"></a>01725 {
<a name="l01726"></a>01726    <span class="keyword">struct </span><a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o = c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l01727"></a>01727 
<a name="l01728"></a>01728    <span class="comment">//ast_log(LOG_NOTICE, &quot;usbradio_hangup()\n&quot;);</span>
<a name="l01729"></a>01729 <span class="preprocessor">#ifndef  NEW_ASTERISK</span>
<a name="l01730"></a>01730 <span class="preprocessor"></span>   o-&gt;cursound = -1;
<a name="l01731"></a>01731    o-&gt;nosound = 0;
<a name="l01732"></a>01732 <span class="preprocessor">#endif</span>
<a name="l01733"></a>01733 <span class="preprocessor"></span>   c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a> = NULL;
<a name="l01734"></a>01734    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = NULL;
<a name="l01735"></a>01735    <a class="code" href="module_8h.html#ac65fa15b16dbc563a2424af744ab003d">ast_module_unref</a>(<a class="code" href="structast__module__info.html">ast_module_info</a>-&gt;self);
<a name="l01736"></a>01736    <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a6ec03f2e1f4b9ef754003a0019a410a2">hookstate</a>) {
<a name="l01737"></a>01737       <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#aa682db27c8180700165db1398964b3c8">autoanswer</a> || o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a56c3f16f4a1c55d1d95c6a9523cd65ca">autohangup</a>) {
<a name="l01738"></a>01738          <span class="comment">/* Assume auto-hangup too */</span>
<a name="l01739"></a>01739          o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a6ec03f2e1f4b9ef754003a0019a410a2">hookstate</a> = 0;
<a name="l01740"></a>01740          <a class="code" href="chan__usbradio_8c.html#a42967187d12d487ff0848ee5e9b12d8f">setformat</a>(o, <a class="code" href="chan__oss_8c.html#a9d6bb64b7e9ca3602a00db074a84103d">O_CLOSE</a>);
<a name="l01741"></a>01741       } <span class="keywordflow">else</span> {
<a name="l01742"></a>01742          <span class="comment">/* Make congestion noise */</span>
<a name="l01743"></a>01743          <a class="code" href="chan__usbradio_8c.html#ac2043109d0094474173e42a642c1bd20">ring</a>(o, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a850bb06a1702741c93a3fd67cc9637ab">AST_CONTROL_CONGESTION</a>);
<a name="l01744"></a>01744       }
<a name="l01745"></a>01745    }
<a name="l01746"></a>01746    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a81ba3b4ebe2534f4cfc69a57a2d7debe">stophid</a> = 1;
<a name="l01747"></a>01747    pthread_join(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5825b205dd44a058bfe41b597755155b">hidthread</a>,NULL);
<a name="l01748"></a>01748    <span class="keywordflow">return</span> 0;
<a name="l01749"></a>01749 }
<a name="l01750"></a>01750 
<a name="l01751"></a>01751 
<a name="l01752"></a>01752 <span class="comment">/* used for data coming from the network */</span>
<a name="l01753"></a><a class="code" href="chan__usbradio_8c.html#a2013fdf75a76d927a7008d6625cb2cf9">01753</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#a2013fdf75a76d927a7008d6625cb2cf9">usbradio_write</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c, <span class="keyword">struct</span> <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>)
<a name="l01754"></a>01754 {
<a name="l01755"></a>01755    <span class="keyword">struct </span><a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o = c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l01756"></a>01756 
<a name="l01757"></a>01757    <a class="code" href="chan__usbradio_8c.html#ab7c6d9dd18ab648a0a772a28ee364c9f">traceusb2</a>((<span class="stringliteral">&quot;usbradio_write() o-&gt;nosound= %i\n&quot;</span>,o-&gt;nosound));
<a name="l01758"></a>01758 
<a name="l01759"></a>01759 <span class="preprocessor">#ifndef  NEW_ASTERISK</span>
<a name="l01760"></a>01760 <span class="preprocessor"></span>   <span class="comment">/* Immediately return if no sound is enabled */</span>
<a name="l01761"></a>01761    <span class="keywordflow">if</span> (o-&gt;nosound)
<a name="l01762"></a>01762       <span class="keywordflow">return</span> 0;
<a name="l01763"></a>01763    <span class="comment">/* Stop any currently playing sound */</span>
<a name="l01764"></a>01764    o-&gt;cursound = -1;
<a name="l01765"></a>01765 <span class="preprocessor">#endif</span>
<a name="l01766"></a>01766 <span class="preprocessor"></span>   <span class="comment">/*</span>
<a name="l01767"></a>01767 <span class="comment">    * we could receive a block which is not a multiple of our</span>
<a name="l01768"></a>01768 <span class="comment">    * FRAME_SIZE, so buffer it locally and write to the device</span>
<a name="l01769"></a>01769 <span class="comment">    * in FRAME_SIZE chunks.</span>
<a name="l01770"></a>01770 <span class="comment">    * Keep the residue stored for future use.</span>
<a name="l01771"></a>01771 <span class="comment">    */</span>
<a name="l01772"></a>01772 
<a name="l01773"></a>01773 <span class="preprocessor">   #if DEBUG_CAPTURES == 1 // to write input data to a file   datalen=320</span>
<a name="l01774"></a>01774 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (ftxcapraw &amp;&amp; o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a933ce66d291cb7d99d8693683d0a3f7d">b</a>.<a class="code" href="structchan__usbradio__pvt.html#a73d52d82e0d9d59647ad56302b908aa9">txcapraw</a>)
<a name="l01775"></a>01775    {
<a name="l01776"></a>01776       i16 i, tbuff[f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>];
<a name="l01777"></a>01777       <span class="keywordflow">for</span>(i=0;i&lt;f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>;i+=2)
<a name="l01778"></a>01778       {
<a name="l01779"></a>01779          tbuff[i]= ((i16*)(f-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>))[i/2];
<a name="l01780"></a>01780          tbuff[i+1]= o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ab567e67bb38d5cb120f53e25d709377f">txkeyed</a>*M_Q13;
<a name="l01781"></a>01781       }
<a name="l01782"></a>01782       <span class="keywordflow">if</span> (<a class="code" href="ast__expr2f_8c.html#a8541b986268a39ba1b07d9e912d31732">fwrite</a>(tbuff,2,f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>,ftxcapraw) != f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>) {
<a name="l01783"></a>01783          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;write() failed: %s\n&quot;</span>, strerror(<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l01784"></a>01784       }
<a name="l01785"></a>01785       <span class="comment">//fwrite(f-&gt;data,1,f-&gt;datalen,ftxcapraw);</span>
<a name="l01786"></a>01786    }
<a name="l01787"></a>01787 <span class="preprocessor">   #endif</span>
<a name="l01788"></a>01788 <span class="preprocessor"></span>
<a name="l01789"></a>01789    <span class="comment">// maw just take the data from the network and save it for PmrRx processing</span>
<a name="l01790"></a>01790 
<a name="l01791"></a>01791    PmrTx(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>,(i16*)f-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>);
<a name="l01792"></a>01792    
<a name="l01793"></a>01793    <span class="keywordflow">return</span> 0;
<a name="l01794"></a>01794 }
<a name="l01795"></a>01795 
<a name="l01796"></a><a class="code" href="chan__usbradio_8c.html#a59939931e3e083c818521d85d8f10808">01796</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="chan__usbradio_8c.html#a59939931e3e083c818521d85d8f10808">usbradio_read</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c)
<a name="l01797"></a>01797 {
<a name="l01798"></a>01798    <span class="keywordtype">int</span> res, src, <a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>, oldpttout;
<a name="l01799"></a>01799    <span class="keywordtype">int</span> cd,sd;
<a name="l01800"></a>01800    <span class="keyword">struct </span><a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o = c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l01801"></a>01801    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a> = &amp;o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ae76466f730a632fe0cbebdf16c61d228">read_f</a>,*f1;
<a name="l01802"></a>01802    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> wf = { <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a> };
<a name="l01803"></a>01803    time_t now;
<a name="l01804"></a>01804 
<a name="l01805"></a>01805    <a class="code" href="chan__usbradio_8c.html#ab7c6d9dd18ab648a0a772a28ee364c9f">traceusb2</a>((<span class="stringliteral">&quot;usbradio_read()\n&quot;</span>));
<a name="l01806"></a>01806 
<a name="l01807"></a>01807    <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ad1acec14ee8fb8cd2c5ec8d095029f91">lasthidtime</a>)
<a name="l01808"></a>01808    {
<a name="l01809"></a>01809       time(&amp;now);
<a name="l01810"></a>01810       <span class="keywordflow">if</span> ((now - o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ad1acec14ee8fb8cd2c5ec8d095029f91">lasthidtime</a>) &gt; 3)
<a name="l01811"></a>01811       {
<a name="l01812"></a>01812          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,<span class="stringliteral">&quot;HID process has died or something!!\n&quot;</span>);
<a name="l01813"></a>01813          <span class="keywordflow">return</span> NULL;
<a name="l01814"></a>01814       }
<a name="l01815"></a>01815    }
<a name="l01816"></a>01816    <span class="comment">/* XXX can be simplified returning &amp;ast_null_frame */</span>
<a name="l01817"></a>01817    <span class="comment">/* prepare a NULL frame in case we don&apos;t have enough data to return */</span>
<a name="l01818"></a>01818    memset(f, <span class="charliteral">&apos;\0&apos;</span>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a>));
<a name="l01819"></a>01819    f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a29ff71f9d5c7927906ebd437fe372056">AST_FRAME_NULL</a>;
<a name="l01820"></a>01820    f-&gt;<a class="code" href="structast__frame.html#af51e37c9331049b1e3d250a7c8bc3c26">src</a> = usbradio_tech.<a class="code" href="structast__channel__tech.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>;
<a name="l01821"></a>01821 
<a name="l01822"></a>01822    res = read(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac3fb672ce98321ddfeba0b02fba73298">sounddev</a>, o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a738bd0c9fee5e7ccf37f2a7cf84662e1">usbradio_read_buf</a> + o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a6bf189efc18e1f2c352c562b85bf851f">readpos</a>, 
<a name="l01823"></a>01823       <span class="keyword">sizeof</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a738bd0c9fee5e7ccf37f2a7cf84662e1">usbradio_read_buf</a>) - o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a6bf189efc18e1f2c352c562b85bf851f">readpos</a>);
<a name="l01824"></a>01824    <span class="keywordflow">if</span> (res &lt; 0)            <span class="comment">/* audio data not ready, return a NULL frame */</span>
<a name="l01825"></a>01825    {
<a name="l01826"></a>01826       <span class="keywordflow">if</span> (<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> != EAGAIN) <span class="keywordflow">return</span> NULL;
<a name="l01827"></a>01827       <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#acd3415bdb0bfcdbc03825a1f6a2678c3">readerrs</a>++ &gt; <a class="code" href="chan__usbradio_8c.html#ad4a78a85664f81bdf5fc49fb307b4e6f">READERR_THRESHOLD</a>)
<a name="l01828"></a>01828       {
<a name="l01829"></a>01829          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,<span class="stringliteral">&quot;Stuck USB read channel [%s], un-sticking it!\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l01830"></a>01830          o-&gt;<a class="code" href="structchan__usbradio__pvt.html#acd3415bdb0bfcdbc03825a1f6a2678c3">readerrs</a> = 0;
<a name="l01831"></a>01831          <span class="keywordflow">return</span> NULL;
<a name="l01832"></a>01832       }
<a name="l01833"></a>01833       <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#acd3415bdb0bfcdbc03825a1f6a2678c3">readerrs</a> == 1) 
<a name="l01834"></a>01834          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,<span class="stringliteral">&quot;Possibly stuck USB read channel. [%s]\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l01835"></a>01835       <span class="keywordflow">return</span> f;
<a name="l01836"></a>01836    }
<a name="l01837"></a>01837    <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#acd3415bdb0bfcdbc03825a1f6a2678c3">readerrs</a>) <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,<span class="stringliteral">&quot;Nope, USB read channel [%s] wasn&apos;t stuck after all.\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l01838"></a>01838    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#acd3415bdb0bfcdbc03825a1f6a2678c3">readerrs</a> = 0;
<a name="l01839"></a>01839    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a6bf189efc18e1f2c352c562b85bf851f">readpos</a> += res;
<a name="l01840"></a>01840    <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a6bf189efc18e1f2c352c562b85bf851f">readpos</a> &lt; <span class="keyword">sizeof</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a738bd0c9fee5e7ccf37f2a7cf84662e1">usbradio_read_buf</a>))  <span class="comment">/* not enough samples */</span>
<a name="l01841"></a>01841       <span class="keywordflow">return</span> f;
<a name="l01842"></a>01842 
<a name="l01843"></a>01843    <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a29128ae5c15a12dea5fe4f263ba6cec1">mute</a>)
<a name="l01844"></a>01844       <span class="keywordflow">return</span> f;
<a name="l01845"></a>01845 
<a name="l01846"></a>01846 <span class="preprocessor">   #if DEBUG_CAPTURES == 1</span>
<a name="l01847"></a>01847 <span class="preprocessor"></span>   <span class="keywordflow">if</span> ((o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a933ce66d291cb7d99d8693683d0a3f7d">b</a>.<a class="code" href="structchan__usbradio__pvt.html#a34f93defb00c007bb028c2fa93eac568">rxcapraw</a> &amp;&amp; frxcapraw) &amp;&amp; (<a class="code" href="ast__expr2f_8c.html#a8541b986268a39ba1b07d9e912d31732">fwrite</a>((o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a738bd0c9fee5e7ccf37f2a7cf84662e1">usbradio_read_buf</a> + <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>),1,FRAME_SIZE * 2 * 2 * 6,frxcapraw) != FRAME_SIZE * 2 * 2 * 6)) {
<a name="l01848"></a>01848       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;fwrite() failed: %s\n&quot;</span>, strerror(<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l01849"></a>01849    }
<a name="l01850"></a>01850 <span class="preprocessor">   #endif</span>
<a name="l01851"></a>01851 <span class="preprocessor"></span>
<a name="l01852"></a>01852 <span class="preprocessor">   #if 1</span>
<a name="l01853"></a>01853 <span class="preprocessor"></span>   <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ab567e67bb38d5cb120f53e25d709377f">txkeyed</a>||o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a633a737f50a6fd3c20783e59ada69952">txtestkey</a>)
<a name="l01854"></a>01854    {
<a name="l01855"></a>01855       <span class="keywordflow">if</span>(!o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;txPttIn)
<a name="l01856"></a>01856       {
<a name="l01857"></a>01857          o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;txPttIn=1;
<a name="l01858"></a>01858          <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a8bc52eafdec6e1ab31955b8e407746ba">debuglevel</a>) <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;txPttIn = %i, chan %s\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;txPttIn,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name);
<a name="l01859"></a>01859       }
<a name="l01860"></a>01860    }
<a name="l01861"></a>01861    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;txPttIn)
<a name="l01862"></a>01862    {
<a name="l01863"></a>01863       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;txPttIn=0;
<a name="l01864"></a>01864       <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a8bc52eafdec6e1ab31955b8e407746ba">debuglevel</a>) <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;txPttIn = %i, chan %s\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;txPttIn,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name);
<a name="l01865"></a>01865    }
<a name="l01866"></a>01866    oldpttout = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;txPttOut;
<a name="l01867"></a>01867 
<a name="l01868"></a>01868    PmrRx(         o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>, 
<a name="l01869"></a>01869          (i16 *)(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a738bd0c9fee5e7ccf37f2a7cf84662e1">usbradio_read_buf</a> + <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>),
<a name="l01870"></a>01870          (i16 *)(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a811d09a2bb7bdac7f3d06c292ba2bf82">usbradio_read_buf_8k</a> + <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>),
<a name="l01871"></a>01871          (i16 *)(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a1924c47e68051ef018be967998a4932d">usbradio_write_buf_1</a>));
<a name="l01872"></a>01872 
<a name="l01873"></a>01873    <span class="keywordflow">if</span> (oldpttout != o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;txPttOut)
<a name="l01874"></a>01874    {
<a name="l01875"></a>01875       <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a8bc52eafdec6e1ab31955b8e407746ba">debuglevel</a>) <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;txPttOut = %i, chan %s\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;txPttOut,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name);
<a name="l01876"></a>01876       <a class="code" href="chan__usbradio_8c.html#a56b8817c289bbdb4aaa42209a02ac5b5">kickptt</a>(o);
<a name="l01877"></a>01877    }
<a name="l01878"></a>01878 
<a name="l01879"></a>01879 <span class="preprocessor">   #if 0 // to write 48KS/s stereo tx data to a file</span>
<a name="l01880"></a>01880 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (!ftxoutraw) ftxoutraw = fopen(<a class="code" href="chan__usbradio_8c.html#afda5434c2b0af3f82ddf8fda79f5d4ef">TX_CAP_OUT_FILE</a>,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l01881"></a>01881    <span class="keywordflow">if</span> (ftxoutraw) <a class="code" href="ast__expr2f_8c.html#a8541b986268a39ba1b07d9e912d31732">fwrite</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a1924c47e68051ef018be967998a4932d">usbradio_write_buf_1</a>,1,FRAME_SIZE * 2 * 6,ftxoutraw);
<a name="l01882"></a>01882 <span class="preprocessor">   #endif</span>
<a name="l01883"></a>01883 <span class="preprocessor"></span>
<a name="l01884"></a>01884 <span class="preprocessor">   #if DEBUG_CAPTURES == 1 &amp;&amp; XPMR_DEBUG0 == 1</span>
<a name="l01885"></a>01885 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ((o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a933ce66d291cb7d99d8693683d0a3f7d">b</a>.<a class="code" href="structchan__usbradio__pvt.html#ae4e34f0e79fb4c42c3833cf4e3d44b70">txcap2</a> &amp;&amp; ftxcaptrace) &amp;&amp; (<a class="code" href="ast__expr2f_8c.html#a8541b986268a39ba1b07d9e912d31732">fwrite</a>((o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;ptxDebug),1,FRAME_SIZE * 2 * 16,ftxcaptrace) != FRAME_SIZE * 2 * 16)) {
<a name="l01886"></a>01886       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;fwrite() failed: %s\n&quot;</span>, strerror(<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l01887"></a>01887    }
<a name="l01888"></a>01888 <span class="preprocessor">   #endif</span>
<a name="l01889"></a>01889 <span class="preprocessor"></span>   
<a name="l01890"></a>01890    <span class="comment">// 160 samples * 2 bytes/sample * 2 chan * 6x oversampling to 48KS/s</span>
<a name="l01891"></a>01891    datalen = FRAME_SIZE * 24;  
<a name="l01892"></a>01892    src = 0;             <span class="comment">/* read position into f-&gt;data */</span>
<a name="l01893"></a>01893    <span class="keywordflow">while</span> (src &lt; datalen) 
<a name="l01894"></a>01894    {
<a name="l01895"></a>01895       <span class="comment">/* Compute spare room in the buffer */</span>
<a name="l01896"></a>01896       <span class="keywordtype">int</span> l = <span class="keyword">sizeof</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#acb14ce5d6a9719a07a3035c12f50a721">usbradio_write_buf</a>) - o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ab837acb75fa579ebfad5014e50bafd9a">usbradio_write_dst</a>;
<a name="l01897"></a>01897 
<a name="l01898"></a>01898       if (datalen - src &gt;= l) 
<a name="l01899"></a>01899       {  
<a name="l01900"></a>01900          <span class="comment">/* enough to fill a frame */</span>
<a name="l01901"></a>01901          memcpy(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#acb14ce5d6a9719a07a3035c12f50a721">usbradio_write_buf</a> + o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ab837acb75fa579ebfad5014e50bafd9a">usbradio_write_dst</a>, o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a1924c47e68051ef018be967998a4932d">usbradio_write_buf_1</a> + src, l);
<a name="l01902"></a>01902          <a class="code" href="chan__usbradio_8c.html#ac027145f62b02322b98b86b3cf4cc9bd">soundcard_writeframe</a>(o, (<span class="keywordtype">short</span> *) o-&gt;<a class="code" href="structchan__usbradio__pvt.html#acb14ce5d6a9719a07a3035c12f50a721">usbradio_write_buf</a>);
<a name="l01903"></a>01903          src += l;
<a name="l01904"></a>01904          o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ab837acb75fa579ebfad5014e50bafd9a">usbradio_write_dst</a> = 0;
<a name="l01905"></a>01905       } 
<a name="l01906"></a>01906       <span class="keywordflow">else</span> 
<a name="l01907"></a>01907       {           
<a name="l01908"></a>01908          <span class="comment">/* copy residue */</span>
<a name="l01909"></a>01909          l = datalen - src;
<a name="l01910"></a>01910          memcpy(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#acb14ce5d6a9719a07a3035c12f50a721">usbradio_write_buf</a> + o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ab837acb75fa579ebfad5014e50bafd9a">usbradio_write_dst</a>, o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a1924c47e68051ef018be967998a4932d">usbradio_write_buf_1</a> + src, l);
<a name="l01911"></a>01911          src += l;         <span class="comment">/* but really, we are done */</span>
<a name="l01912"></a>01912          o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ab837acb75fa579ebfad5014e50bafd9a">usbradio_write_dst</a> += l;
<a name="l01913"></a>01913       }
<a name="l01914"></a>01914    }
<a name="l01915"></a>01915 <span class="preprocessor">   #else</span>
<a name="l01916"></a>01916 <span class="preprocessor"></span>   <span class="keyword">static</span> FILE *hInput;
<a name="l01917"></a>01917    i16 iBuff[FRAME_SIZE*2*6];
<a name="l01918"></a>01918 
<a name="l01919"></a>01919    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;b.rxCapture=1;
<a name="l01920"></a>01920 
<a name="l01921"></a>01921    <span class="keywordflow">if</span>(!hInput)
<a name="l01922"></a>01922    {
<a name="l01923"></a>01923       hInput  = fopen(<span class="stringliteral">&quot;/usr/src/xpmr/testdata/rx_in.pcm&quot;</span>,<span class="stringliteral">&quot;r&quot;</span>);
<a name="l01924"></a>01924       <span class="keywordflow">if</span>(!hInput)
<a name="l01925"></a>01925       {
<a name="l01926"></a>01926          printf(<span class="stringliteral">&quot; Input Data File Not Found.\n&quot;</span>);
<a name="l01927"></a>01927          <span class="keywordflow">return</span> 0;
<a name="l01928"></a>01928       }
<a name="l01929"></a>01929    }
<a name="l01930"></a>01930 
<a name="l01931"></a>01931    <span class="keywordflow">if</span>(0==fread((<span class="keywordtype">void</span> *)iBuff,2,FRAME_SIZE*2*6,hInput))exit;
<a name="l01932"></a>01932 
<a name="l01933"></a>01933    PmrRx(  o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>, 
<a name="l01934"></a>01934          (i16 *)iBuff,
<a name="l01935"></a>01935          (i16 *)(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a811d09a2bb7bdac7f3d06c292ba2bf82">usbradio_read_buf_8k</a> + <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>));
<a name="l01936"></a>01936 
<a name="l01937"></a>01937 <span class="preprocessor">   #endif</span>
<a name="l01938"></a>01938 <span class="preprocessor"></span>
<a name="l01939"></a>01939 <span class="preprocessor">   #if 0</span>
<a name="l01940"></a>01940 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (!frxoutraw) frxoutraw = fopen(<a class="code" href="chan__usbradio_8c.html#a5ae02857e8ff8c543c3e78aad09aceba">RX_CAP_OUT_FILE</a>,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l01941"></a>01941     <span class="keywordflow">if</span> (frxoutraw) <a class="code" href="ast__expr2f_8c.html#a8541b986268a39ba1b07d9e912d31732">fwrite</a>((o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a811d09a2bb7bdac7f3d06c292ba2bf82">usbradio_read_buf_8k</a> + <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>),1,FRAME_SIZE * 2,frxoutraw);
<a name="l01942"></a>01942 <span class="preprocessor">   #endif</span>
<a name="l01943"></a>01943 <span class="preprocessor"></span>
<a name="l01944"></a>01944 <span class="preprocessor">   #if DEBUG_CAPTURES == 1 &amp;&amp; XPMR_DEBUG0 == 1</span>
<a name="l01945"></a>01945 <span class="preprocessor"></span>    <span class="keywordflow">if</span> ((frxcaptrace &amp;&amp; o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a933ce66d291cb7d99d8693683d0a3f7d">b</a>.<a class="code" href="structchan__usbradio__pvt.html#a0ffa6929db958c59e281798973c4ca2f">rxcap2</a> &amp;&amp; o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;b.radioactive) &amp;&amp; (<a class="code" href="ast__expr2f_8c.html#a8541b986268a39ba1b07d9e912d31732">fwrite</a>((o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;prxDebug),1,FRAME_SIZE * 2 * 16,frxcaptrace) != FRAME_SIZE * 2 * 16 )) {
<a name="l01946"></a>01946       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;fwrite() failed: %s\n&quot;</span>, strerror(<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l01947"></a>01947    }
<a name="l01948"></a>01948 <span class="preprocessor">   #endif</span>
<a name="l01949"></a>01949 <span class="preprocessor"></span>
<a name="l01950"></a>01950    cd = 0;
<a name="l01951"></a>01951    <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af7351b2441759672562708b11cd8fedd">rxcdtype</a>==<a class="code" href="chan__usbradio_8c.html#a68c01102755fc7d1c810bb0b0635fa90a3decc0a04d3b0418061d3edffc567dbf">CD_HID</a> &amp;&amp; (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;rxExtCarrierDetect!=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a31415c43e2f6cb3eefc6f0b86dec2b21">rxhidsq</a>))
<a name="l01952"></a>01952       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;rxExtCarrierDetect=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a31415c43e2f6cb3eefc6f0b86dec2b21">rxhidsq</a>;
<a name="l01953"></a>01953    
<a name="l01954"></a>01954    <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af7351b2441759672562708b11cd8fedd">rxcdtype</a>==<a class="code" href="chan__usbradio_8c.html#a68c01102755fc7d1c810bb0b0635fa90a4e320acd2108cbf05d76b78fdc9afac1">CD_HID_INVERT</a> &amp;&amp; (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;rxExtCarrierDetect==o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a31415c43e2f6cb3eefc6f0b86dec2b21">rxhidsq</a>))
<a name="l01955"></a>01955       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;rxExtCarrierDetect=!o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a31415c43e2f6cb3eefc6f0b86dec2b21">rxhidsq</a>;
<a name="l01956"></a>01956       
<a name="l01957"></a>01957    <span class="keywordflow">if</span>( (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af7351b2441759672562708b11cd8fedd">rxcdtype</a>==<a class="code" href="chan__usbradio_8c.html#a68c01102755fc7d1c810bb0b0635fa90a3decc0a04d3b0418061d3edffc567dbf">CD_HID</a>        &amp;&amp; o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a31415c43e2f6cb3eefc6f0b86dec2b21">rxhidsq</a>)                  ||
<a name="l01958"></a>01958       (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af7351b2441759672562708b11cd8fedd">rxcdtype</a>==<a class="code" href="chan__usbradio_8c.html#a68c01102755fc7d1c810bb0b0635fa90a4e320acd2108cbf05d76b78fdc9afac1">CD_HID_INVERT</a> &amp;&amp; !o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a31415c43e2f6cb3eefc6f0b86dec2b21">rxhidsq</a>)                 ||
<a name="l01959"></a>01959       (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af7351b2441759672562708b11cd8fedd">rxcdtype</a>==<a class="code" href="chan__usbradio_8c.html#a68c01102755fc7d1c810bb0b0635fa90a458efb22943bcf8e0e9bb22290294ff2">CD_XPMR_NOISE</a> &amp;&amp; o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;rxCarrierDetect) ||
<a name="l01960"></a>01960       (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af7351b2441759672562708b11cd8fedd">rxcdtype</a>==<a class="code" href="chan__usbradio_8c.html#a68c01102755fc7d1c810bb0b0635fa90ac3d0b3b9bd7c9d801dd2d7a3f1434f2b">CD_XPMR_VOX</a>   &amp;&amp; o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;rxCarrierDetect)
<a name="l01961"></a>01961      )
<a name="l01962"></a>01962    {
<a name="l01963"></a>01963       <span class="keywordflow">if</span> (!o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;txPttOut || o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a49cf136c1442f0e05adaf095f3dfb06d">radioduplex</a>)cd=1;  
<a name="l01964"></a>01964    }
<a name="l01965"></a>01965    <span class="keywordflow">else</span>
<a name="l01966"></a>01966    {
<a name="l01967"></a>01967       cd=0;
<a name="l01968"></a>01968    }
<a name="l01969"></a>01969 
<a name="l01970"></a>01970    <span class="keywordflow">if</span>(cd!=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a30bba200e14359fdf104099a69034d02">rxcarrierdetect</a>)
<a name="l01971"></a>01971    {
<a name="l01972"></a>01972       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a30bba200e14359fdf104099a69034d02">rxcarrierdetect</a>=cd;
<a name="l01973"></a>01973       <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a8bc52eafdec6e1ab31955b8e407746ba">debuglevel</a>) <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;rxcarrierdetect = %i, chan %s\n&quot;</span>,cd,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name);
<a name="l01974"></a>01974       <span class="comment">// printf(&quot;rxcarrierdetect = %i, chan %s\n&quot;,res,o-&gt;owner-&gt;name);</span>
<a name="l01975"></a>01975    }
<a name="l01976"></a>01976 
<a name="l01977"></a>01977    <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;b.ctcssRxEnable &amp;&amp; o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;rxCtcss-&gt;decode!=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ae1ce53e0b0e78d89254782c9a2bcfe0d">rxctcssdecode</a>)
<a name="l01978"></a>01978    {
<a name="l01979"></a>01979       <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a8bc52eafdec6e1ab31955b8e407746ba">debuglevel</a>)<a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;rxctcssdecode = %i, chan %s\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;rxCtcss-&gt;decode,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name);
<a name="l01980"></a>01980       <span class="comment">// printf(&quot;rxctcssdecode = %i, chan %s\n&quot;,o-&gt;pmrChan-&gt;rxCtcss-&gt;decode,o-&gt;owner-&gt;name);</span>
<a name="l01981"></a>01981       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ae1ce53e0b0e78d89254782c9a2bcfe0d">rxctcssdecode</a>=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;rxCtcss-&gt;decode;
<a name="l01982"></a>01982       strcpy(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9a1d72568062b00a6c0908bbee9a3f9b">rxctcssfreq</a>, o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;rxctcssfreq);
<a name="l01983"></a>01983    }
<a name="l01984"></a>01984 
<a name="l01985"></a>01985 <span class="preprocessor">   #ifndef HAVE_XPMRX</span>
<a name="l01986"></a>01986 <span class="preprocessor"></span>   <span class="keywordflow">if</span>(  !o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;b.ctcssRxEnable ||
<a name="l01987"></a>01987       ( o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;b.ctcssRxEnable &amp;&amp; 
<a name="l01988"></a>01988          o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;rxCtcss-&gt;decode&gt;CTCSS_NULL &amp;&amp; 
<a name="l01989"></a>01989          o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;smode==SMODE_CTCSS )  
<a name="l01990"></a>01990    )
<a name="l01991"></a>01991    {
<a name="l01992"></a>01992       sd=1; 
<a name="l01993"></a>01993    }
<a name="l01994"></a>01994    <span class="keywordflow">else</span>
<a name="l01995"></a>01995    {
<a name="l01996"></a>01996       sd=0;
<a name="l01997"></a>01997    }
<a name="l01998"></a>01998 <span class="preprocessor">   #else</span>
<a name="l01999"></a>01999 <span class="preprocessor"></span>   <span class="keywordflow">if</span>( (!o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;b.ctcssRxEnable &amp;&amp; !o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;b.dcsRxEnable &amp;&amp; !o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;b.lmrRxEnable) ||
<a name="l02000"></a>02000       ( o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;b.ctcssRxEnable &amp;&amp; 
<a name="l02001"></a>02001          o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;rxCtcss-&gt;decode&gt;CTCSS_NULL &amp;&amp; 
<a name="l02002"></a>02002          o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;smode==SMODE_CTCSS ) ||
<a name="l02003"></a>02003       ( o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;b.dcsRxEnable &amp;&amp; 
<a name="l02004"></a>02004          o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;decDcs-&gt;decode &gt; 0 &amp;&amp;
<a name="l02005"></a>02005          o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;smode==SMODE_DCS )
<a name="l02006"></a>02006    )
<a name="l02007"></a>02007    {
<a name="l02008"></a>02008       sd=1; 
<a name="l02009"></a>02009    }
<a name="l02010"></a>02010    <span class="keywordflow">else</span>
<a name="l02011"></a>02011    {
<a name="l02012"></a>02012       sd=0;
<a name="l02013"></a>02013    }
<a name="l02014"></a>02014 
<a name="l02015"></a>02015    <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;decDcs-&gt;decode!=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a938f3e7db5867fc985b1b1ba581e3838">rxdcsdecode</a>)
<a name="l02016"></a>02016    {                                      
<a name="l02017"></a>02017       <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a8bc52eafdec6e1ab31955b8e407746ba">debuglevel</a>)<a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;rxdcsdecode = %s, chan %s\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;rxctcssfreq,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name);
<a name="l02018"></a>02018       <span class="comment">// printf(&quot;rxctcssdecode = %i, chan %s\n&quot;,o-&gt;pmrChan-&gt;rxCtcss-&gt;decode,o-&gt;owner-&gt;name);</span>
<a name="l02019"></a>02019       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a938f3e7db5867fc985b1b1ba581e3838">rxdcsdecode</a>=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;decDcs-&gt;decode;
<a name="l02020"></a>02020       strcpy(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9a1d72568062b00a6c0908bbee9a3f9b">rxctcssfreq</a>, o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;rxctcssfreq);
<a name="l02021"></a>02021    }                                                                      
<a name="l02022"></a>02022 
<a name="l02023"></a>02023    <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;rptnum &amp;&amp; (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;pLsdCtl-&gt;cs[o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;rptnum].b.rxkeyed != o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0ba847ffbd7b9929dc5022c3e25ffde1">rxlsddecode</a>))
<a name="l02024"></a>02024    {                       
<a name="l02025"></a>02025       <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a8bc52eafdec6e1ab31955b8e407746ba">debuglevel</a>)<a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;rxLSDecode = %s, chan %s\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;rxctcssfreq,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name);
<a name="l02026"></a>02026       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0ba847ffbd7b9929dc5022c3e25ffde1">rxlsddecode</a>=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;pLsdCtl-&gt;cs[o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;rptnum].b.rxkeyed;
<a name="l02027"></a>02027       strcpy(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9a1d72568062b00a6c0908bbee9a3f9b">rxctcssfreq</a>, o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;rxctcssfreq);
<a name="l02028"></a>02028    }
<a name="l02029"></a>02029 
<a name="l02030"></a>02030    <span class="keywordflow">if</span>( (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;rptnum&gt;0 &amp;&amp; o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;smode==SMODE_LSD &amp;&amp; o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;pLsdCtl-&gt;cs[o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;rptnum].b.rxkeyed)||
<a name="l02031"></a>02031        (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;smode==SMODE_DCS &amp;&amp; o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;decDcs-&gt;decode&gt;0) )
<a name="l02032"></a>02032    {
<a name="l02033"></a>02033       sd=1;
<a name="l02034"></a>02034    }
<a name="l02035"></a>02035 <span class="preprocessor">   #endif</span>
<a name="l02036"></a>02036 <span class="preprocessor"></span>
<a name="l02037"></a>02037    <span class="keywordflow">if</span> ( cd &amp;&amp; sd )
<a name="l02038"></a>02038    {
<a name="l02039"></a>02039       <span class="comment">//if(!o-&gt;rxkeyed)o-&gt;pmrChan-&gt;dd.b.doitnow=1;</span>
<a name="l02040"></a>02040       <span class="keywordflow">if</span>(!o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9ffbd20ba016d188e8447f13a368bfe4">rxkeyed</a> &amp;&amp; o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a8bc52eafdec6e1ab31955b8e407746ba">debuglevel</a>)<a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;o-&gt;rxkeyed = 1, chan %s\n&quot;</span>, o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name);
<a name="l02041"></a>02041       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9ffbd20ba016d188e8447f13a368bfe4">rxkeyed</a> = 1;
<a name="l02042"></a>02042    }
<a name="l02043"></a>02043    <span class="keywordflow">else</span> 
<a name="l02044"></a>02044    {
<a name="l02045"></a>02045       <span class="comment">//if(o-&gt;rxkeyed)o-&gt;pmrChan-&gt;dd.b.doitnow=1;</span>
<a name="l02046"></a>02046       <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9ffbd20ba016d188e8447f13a368bfe4">rxkeyed</a> &amp;&amp; o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a8bc52eafdec6e1ab31955b8e407746ba">debuglevel</a>)<a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;o-&gt;rxkeyed = 0, chan %s\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name);
<a name="l02047"></a>02047       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9ffbd20ba016d188e8447f13a368bfe4">rxkeyed</a> = 0;
<a name="l02048"></a>02048    }
<a name="l02049"></a>02049 
<a name="l02050"></a>02050    <span class="comment">// provide rx signal detect conditions</span>
<a name="l02051"></a>02051    <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#adde6596829678336b403631181c14365">lastrx</a> &amp;&amp; (!o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9ffbd20ba016d188e8447f13a368bfe4">rxkeyed</a>))
<a name="l02052"></a>02052    {
<a name="l02053"></a>02053       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#adde6596829678336b403631181c14365">lastrx</a> = 0;
<a name="l02054"></a>02054       <span class="comment">//printf(&quot;AST_CONTROL_RADIO_UNKEY\n&quot;);</span>
<a name="l02055"></a>02055       wf.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a34ac3ccebc219c59daa7eb0275fcd54d">AST_CONTROL_RADIO_UNKEY</a>;
<a name="l02056"></a>02056       <a class="code" href="channel_8h.html#a6cbcba5661d55216968cde8fdf913c89" title="Queue one or more frames to a channel&amp;#39;s frame queue.">ast_queue_frame</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, &amp;wf);
<a name="l02057"></a>02057    }
<a name="l02058"></a>02058    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((!o-&gt;<a class="code" href="structchan__usbradio__pvt.html#adde6596829678336b403631181c14365">lastrx</a>) &amp;&amp; (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9ffbd20ba016d188e8447f13a368bfe4">rxkeyed</a>))
<a name="l02059"></a>02059    {
<a name="l02060"></a>02060       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#adde6596829678336b403631181c14365">lastrx</a> = 1;
<a name="l02061"></a>02061       <span class="comment">//printf(&quot;AST_CONTROL_RADIO_KEY\n&quot;);</span>
<a name="l02062"></a>02062       wf.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aacb7ddf1a95fa544fdecada68213f3c7">AST_CONTROL_RADIO_KEY</a>;
<a name="l02063"></a>02063       <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ae1ce53e0b0e78d89254782c9a2bcfe0d">rxctcssdecode</a>)    
<a name="l02064"></a>02064         {
<a name="l02065"></a>02065            wf.<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a> = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9a1d72568062b00a6c0908bbee9a3f9b">rxctcssfreq</a>;
<a name="l02066"></a>02066            wf.<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> = strlen(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9a1d72568062b00a6c0908bbee9a3f9b">rxctcssfreq</a>) + 1;
<a name="l02067"></a>02067          TRACEO(1,(<span class="stringliteral">&quot;AST_CONTROL_RADIO_KEY text=%s\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9a1d72568062b00a6c0908bbee9a3f9b">rxctcssfreq</a>));
<a name="l02068"></a>02068         }
<a name="l02069"></a>02069       <a class="code" href="channel_8h.html#a6cbcba5661d55216968cde8fdf913c89" title="Queue one or more frames to a channel&amp;#39;s frame queue.">ast_queue_frame</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, &amp;wf);
<a name="l02070"></a>02070    }
<a name="l02071"></a>02071 
<a name="l02072"></a>02072    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a6bf189efc18e1f2c352c562b85bf851f">readpos</a> = <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>;   <span class="comment">/* reset read pointer for next frame */</span>
<a name="l02073"></a>02073    <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>)   <span class="comment">/* drop data if frame is not up */</span>
<a name="l02074"></a>02074       <span class="keywordflow">return</span> f;
<a name="l02075"></a>02075    <span class="comment">/* ok we can build and deliver the frame to the caller */</span>
<a name="l02076"></a>02076    f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>;
<a name="l02077"></a>02077    f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>;
<a name="l02078"></a>02078    f-&gt;<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a> = FRAME_SIZE;
<a name="l02079"></a>02079    f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> = FRAME_SIZE * 2;
<a name="l02080"></a>02080    f-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a> = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a811d09a2bb7bdac7f3d06c292ba2bf82">usbradio_read_buf_8k</a> + <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>;
<a name="l02081"></a>02081    <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#acd32205748f53b345085531047aefa00">boost</a> != <a class="code" href="chan__oss_8c.html#a7b687e61ed66e74f77982bc22fd0c446">BOOST_SCALE</a>) {   <span class="comment">/* scale and clip values */</span>
<a name="l02082"></a>02082       <span class="keywordtype">int</span> i, x;
<a name="l02083"></a>02083       int16_t *p = (int16_t *) f-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>;
<a name="l02084"></a>02084       for (i = 0; i &lt; f-&gt;<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>; i++) {
<a name="l02085"></a>02085          x = (p[i] * o-&gt;<a class="code" href="structchan__usbradio__pvt.html#acd32205748f53b345085531047aefa00">boost</a>) / <a class="code" href="chan__oss_8c.html#a7b687e61ed66e74f77982bc22fd0c446">BOOST_SCALE</a>;
<a name="l02086"></a>02086          <span class="keywordflow">if</span> (x &gt; 32767)
<a name="l02087"></a>02087             x = 32767;
<a name="l02088"></a>02088          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (x &lt; -32768)
<a name="l02089"></a>02089             x = -32768;
<a name="l02090"></a>02090          p[i] = x;
<a name="l02091"></a>02091       }
<a name="l02092"></a>02092    }
<a name="l02093"></a>02093 
<a name="l02094"></a>02094    f-&gt;<a class="code" href="structast__frame.html#aed7ea92f45bd273dde380a45ddced592">offset</a> = <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>;
<a name="l02095"></a>02095    <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d">dsp</a>)
<a name="l02096"></a>02096    {
<a name="l02097"></a>02097        f1 = <a class="code" href="dsp_8h.html#ab6387ee12a3544d3d2068db61d9576ad" title="Return AST_FRAME_NULL frames when there is silence, AST_FRAME_BUSY on busies, and...">ast_dsp_process</a>(c,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d">dsp</a>,f);
<a name="l02098"></a>02098        <span class="keywordflow">if</span> ((f1-&gt;frametype == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a98e65764bc963016c394bcc1bad6540b">AST_FRAME_DTMF_END</a>) ||
<a name="l02099"></a>02099          (f1-&gt;frametype == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a9b350360a64b55c7590f1ec03db480be">AST_FRAME_DTMF_BEGIN</a>))
<a name="l02100"></a>02100        {
<a name="l02101"></a>02101       <span class="keywordflow">if</span> ((f1-&gt;subclass == <span class="charliteral">&apos;m&apos;</span>) || (f1-&gt;subclass == <span class="charliteral">&apos;u&apos;</span>))
<a name="l02102"></a>02102       {
<a name="l02103"></a>02103          f1-&gt;frametype = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a29ff71f9d5c7927906ebd437fe372056">AST_FRAME_NULL</a>;
<a name="l02104"></a>02104          f1-&gt;subclass = 0;
<a name="l02105"></a>02105          <span class="keywordflow">return</span>(f1);
<a name="l02106"></a>02106       }
<a name="l02107"></a>02107       <span class="keywordflow">if</span> (f1-&gt;frametype == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a98e65764bc963016c394bcc1bad6540b">AST_FRAME_DTMF_END</a>)
<a name="l02108"></a>02108          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;Got DTMF char %c\n&quot;</span>,f1-&gt;subclass);
<a name="l02109"></a>02109       <span class="keywordflow">return</span>(f1);
<a name="l02110"></a>02110        }
<a name="l02111"></a>02111    }
<a name="l02112"></a>02112    <span class="keywordflow">return</span> f;
<a name="l02113"></a>02113 }
<a name="l02114"></a>02114 
<a name="l02115"></a><a class="code" href="chan__usbradio_8c.html#a8e2dba4d8df08b2bb756213fd5e97e5e">02115</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#a8e2dba4d8df08b2bb756213fd5e97e5e">usbradio_fixup</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *oldchan, <span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *newchan)
<a name="l02116"></a>02116 {
<a name="l02117"></a>02117    <span class="keyword">struct </span><a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o = newchan-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l02118"></a>02118    <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,<span class="stringliteral">&quot;usbradio_fixup()\n&quot;</span>);
<a name="l02119"></a>02119    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = newchan;
<a name="l02120"></a>02120    <span class="keywordflow">return</span> 0;
<a name="l02121"></a>02121 }
<a name="l02122"></a>02122 
<a name="l02123"></a><a class="code" href="chan__usbradio_8c.html#abd3959dea3e40e21572fc37523428ab4">02123</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#abd3959dea3e40e21572fc37523428ab4">usbradio_indicate</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c, <span class="keywordtype">int</span> <a class="code" href="app__meetme_8c.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>, <span class="keyword">const</span> <span class="keywordtype">void</span> *data, <span class="keywordtype">size_t</span> datalen)
<a name="l02124"></a>02124 {
<a name="l02125"></a>02125    <span class="keyword">struct </span><a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o = c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l02126"></a>02126    <span class="keywordtype">int</span> res = -1;
<a name="l02127"></a>02127 
<a name="l02128"></a>02128    <span class="keywordflow">switch</span> (cond) {
<a name="l02129"></a>02129       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a387635982df3d2edb669a1eece92c875">AST_CONTROL_BUSY</a>:
<a name="l02130"></a>02130       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a850bb06a1702741c93a3fd67cc9637ab">AST_CONTROL_CONGESTION</a>:
<a name="l02131"></a>02131       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa5814e690c23b590bcd4eb43535907a1">AST_CONTROL_RINGING</a>:
<a name="l02132"></a>02132          res = cond;
<a name="l02133"></a>02133          <span class="keywordflow">break</span>;
<a name="l02134"></a>02134 
<a name="l02135"></a>02135       <span class="keywordflow">case</span> -1:
<a name="l02136"></a>02136 <span class="preprocessor">#ifndef  NEW_ASTERISK</span>
<a name="l02137"></a>02137 <span class="preprocessor"></span>         o-&gt;cursound = -1;
<a name="l02138"></a>02138          o-&gt;nosound = 0;      <span class="comment">/* when cursound is -1 nosound must be 0 */</span>
<a name="l02139"></a>02139 <span class="preprocessor">#endif</span>
<a name="l02140"></a>02140 <span class="preprocessor"></span>         <span class="keywordflow">return</span> 0;
<a name="l02141"></a>02141 
<a name="l02142"></a>02142       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a417bc8ac5817cc1525a3b530abfc1528">AST_CONTROL_VIDUPDATE</a>:
<a name="l02143"></a>02143          res = -1;
<a name="l02144"></a>02144          <span class="keywordflow">break</span>;
<a name="l02145"></a>02145       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390ab99a3d1c08c5ae8bca078c7cd1ec02f5">AST_CONTROL_HOLD</a>:
<a name="l02146"></a>02146          <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot; &lt;&lt; Console Has Been Placed on Hold &gt;&gt; \n&quot;</span>);
<a name="l02147"></a>02147          <a class="code" href="musiconhold_8h.html#a2acec01f2fddd8ca494d874003815cf7" title="Turn on music on hold on a given channel.">ast_moh_start</a>(c, data, o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af689da2b77d1265192a78a5b0994a1d5">mohinterpret</a>);
<a name="l02148"></a>02148          <span class="keywordflow">break</span>;
<a name="l02149"></a>02149       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a3e7629b5f7e39f1cc8ad2e51e266f91e">AST_CONTROL_UNHOLD</a>:
<a name="l02150"></a>02150          <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot; &lt;&lt; Console Has Been Retrieved from Hold &gt;&gt; \n&quot;</span>);
<a name="l02151"></a>02151          <a class="code" href="musiconhold_8h.html#a52fead32f69533450f3c05b2e6960149" title="Turn off music on hold on a given channel.">ast_moh_stop</a>(c);
<a name="l02152"></a>02152          <span class="keywordflow">break</span>;
<a name="l02153"></a>02153       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a50b7fe33bba67b74dd7b746539e81000">AST_CONTROL_PROCEEDING</a>:
<a name="l02154"></a>02154          <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot; &lt;&lt; Call Proceeding... &gt;&gt; \n&quot;</span>);
<a name="l02155"></a>02155          <a class="code" href="musiconhold_8h.html#a52fead32f69533450f3c05b2e6960149" title="Turn off music on hold on a given channel.">ast_moh_stop</a>(c);
<a name="l02156"></a>02156          <span class="keywordflow">break</span>;
<a name="l02157"></a>02157       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a1a461c5e737ed6ed7c8cb0f78557a6fd">AST_CONTROL_PROGRESS</a>:
<a name="l02158"></a>02158          <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot; &lt;&lt; Call Progress... &gt;&gt; \n&quot;</span>);
<a name="l02159"></a>02159          <a class="code" href="musiconhold_8h.html#a52fead32f69533450f3c05b2e6960149" title="Turn off music on hold on a given channel.">ast_moh_stop</a>(c);
<a name="l02160"></a>02160          <span class="keywordflow">break</span>;
<a name="l02161"></a>02161       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aacb7ddf1a95fa544fdecada68213f3c7">AST_CONTROL_RADIO_KEY</a>:
<a name="l02162"></a>02162          o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ab567e67bb38d5cb120f53e25d709377f">txkeyed</a> = 1;
<a name="l02163"></a>02163          <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a8bc52eafdec6e1ab31955b8e407746ba">debuglevel</a>)<a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot; &lt;&lt; AST_CONTROL_RADIO_KEY Radio Transmit On. &gt;&gt; \n&quot;</span>);
<a name="l02164"></a>02164          <span class="keywordflow">break</span>;
<a name="l02165"></a>02165       <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a34ac3ccebc219c59daa7eb0275fcd54d">AST_CONTROL_RADIO_UNKEY</a>:
<a name="l02166"></a>02166          o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ab567e67bb38d5cb120f53e25d709377f">txkeyed</a> = 0;
<a name="l02167"></a>02167          <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a8bc52eafdec6e1ab31955b8e407746ba">debuglevel</a>)<a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot; &lt;&lt; AST_CONTROL_RADIO_UNKEY Radio Transmit Off. &gt;&gt; \n&quot;</span>);
<a name="l02168"></a>02168          <span class="keywordflow">break</span>;
<a name="l02169"></a>02169       <span class="keywordflow">default</span>:
<a name="l02170"></a>02170          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Don&apos;t know how to display condition %d on %s\n&quot;</span>, cond, c-&gt;name);
<a name="l02171"></a>02171          <span class="keywordflow">return</span> -1;
<a name="l02172"></a>02172    }
<a name="l02173"></a>02173 
<a name="l02174"></a>02174    <span class="keywordflow">if</span> (res &gt; -1)
<a name="l02175"></a>02175       <a class="code" href="chan__usbradio_8c.html#ac2043109d0094474173e42a642c1bd20">ring</a>(o, res);
<a name="l02176"></a>02176 
<a name="l02177"></a>02177    <span class="keywordflow">return</span> 0;
<a name="l02178"></a>02178 }
<a name="l02179"></a>02179 
<a name="l02180"></a>02180 <span class="comment">/*</span>
<a name="l02181"></a>02181 <span class="comment"> * allocate a new channel.</span>
<a name="l02182"></a>02182 <span class="comment"> */</span>
<a name="l02183"></a><a class="code" href="chan__usbradio_8c.html#a5fdcb22bef0bcd15623ee6562b1f7b61">02183</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="chan__usbradio_8c.html#a5fdcb22bef0bcd15623ee6562b1f7b61">usbradio_new</a>(<span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o, <span class="keywordtype">char</span> *ext, <span class="keywordtype">char</span> *ctx, <span class="keywordtype">int</span> <a class="code" href="structstate.html">state</a>)
<a name="l02184"></a>02184 {
<a name="l02185"></a>02185    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c;
<a name="l02186"></a>02186 
<a name="l02187"></a>02187    c = <a class="code" href="channel_8h.html#adfbceb39821586c0f9be0c47496a4e18">ast_channel_alloc</a>(1, state, o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a557b0d5a633c0a98162e973793689380">cid_num</a>, o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a2916929201e1417f4ea335e9276aa382">cid_name</a>, <span class="stringliteral">&quot;&quot;</span>, ext, ctx, 0, <span class="stringliteral">&quot;Radio/%s&quot;</span>, o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l02188"></a>02188    <span class="keywordflow">if</span> (c == NULL)
<a name="l02189"></a>02189       <span class="keywordflow">return</span> NULL;
<a name="l02190"></a>02190    c-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a> = &amp;usbradio_tech;
<a name="l02191"></a>02191    <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac3fb672ce98321ddfeba0b02fba73298">sounddev</a> &lt; 0)
<a name="l02192"></a>02192       <a class="code" href="chan__usbradio_8c.html#a42967187d12d487ff0848ee5e9b12d8f">setformat</a>(o, O_RDWR);
<a name="l02193"></a>02193    c-&gt;<a class="code" href="structast__channel.html#aef68cd3879b791a3b6c12cdb750f8e6a">fds</a>[0] = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac3fb672ce98321ddfeba0b02fba73298">sounddev</a>;   <span class="comment">/* -1 if device closed, override later */</span>
<a name="l02194"></a>02194    c-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a> = <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>;
<a name="l02195"></a>02195    c-&gt;<a class="code" href="structast__channel.html#ab7786a0f5b9a9ebf83daed87be4f3868">readformat</a> = <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>;
<a name="l02196"></a>02196    c-&gt;<a class="code" href="structast__channel.html#a00f5ce2ad53ff8523f8e46ea5aceba48">writeformat</a> = <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>;
<a name="l02197"></a>02197    c-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a> = o;
<a name="l02198"></a>02198 
<a name="l02199"></a>02199    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#adf416dc058363e2fd5750c77e2d78bee">language</a>))
<a name="l02200"></a>02200       <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(c, <a class="code" href="chan__alsa_8c.html#adf416dc058363e2fd5750c77e2d78bee">language</a>, o-&gt;<a class="code" href="structchan__usbradio__pvt.html#adf416dc058363e2fd5750c77e2d78bee">language</a>);
<a name="l02201"></a>02201    <span class="comment">/* Don&apos;t use ast_set_callerid() here because it will</span>
<a name="l02202"></a>02202 <span class="comment">    * generate a needless NewCallerID event */</span>
<a name="l02203"></a>02203    c-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a557b0d5a633c0a98162e973793689380">cid_num</a>);
<a name="l02204"></a>02204    c-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a7bb8ad258e687da69d6933ab48320df7">cid_ani</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a557b0d5a633c0a98162e973793689380">cid_num</a>);
<a name="l02205"></a>02205    c-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ab2461abe6e234fe4f763b0a2179184b5">cid_name</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a2916929201e1417f4ea335e9276aa382">cid_name</a>);
<a name="l02206"></a>02206    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(ext))
<a name="l02207"></a>02207       c-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#aa54ab157f47ac529034d524781e2a7e2">cid_dnid</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(ext);
<a name="l02208"></a>02208 
<a name="l02209"></a>02209    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = c;
<a name="l02210"></a>02210    <a class="code" href="module_8h.html#aa08fcee0b390e15532dd03803c8728c4">ast_module_ref</a>(<a class="code" href="structast__module__info.html">ast_module_info</a>-&gt;self);
<a name="l02211"></a>02211    <a class="code" href="abstract__jb_8h.html#a0981c84ac90dd79bc2a0fdd90aa6efba" title="Configures a jitterbuffer on a channel.">ast_jb_configure</a>(c, &amp;<a class="code" href="chan__usbradio_8c.html#abaabcb7f4349cc632dde3af5c6a5e1bd">global_jbconf</a>);
<a name="l02212"></a>02212    <span class="keywordflow">if</span> (state != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a>) {
<a name="l02213"></a>02213       <span class="keywordflow">if</span> (<a class="code" href="pbx_8h.html#a9a937fbb3b5f4e68880a9c5714a29ce5" title="Create a new thread and start the PBX.">ast_pbx_start</a>(c)) {
<a name="l02214"></a>02214          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to start PBX on %s\n&quot;</span>, c-&gt;name);
<a name="l02215"></a>02215          <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(c);
<a name="l02216"></a>02216          o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = c = NULL;
<a name="l02217"></a>02217          <span class="comment">/* XXX what about the channel itself ? */</span>
<a name="l02218"></a>02218          <span class="comment">/* XXX what about usecnt ? */</span>
<a name="l02219"></a>02219       }
<a name="l02220"></a>02220    }
<a name="l02221"></a>02221 
<a name="l02222"></a>02222    <span class="keywordflow">return</span> c;
<a name="l02223"></a>02223 }
<a name="l02224"></a>02224 <span class="comment">/*</span>
<a name="l02225"></a>02225 <span class="comment">*/</span>
<a name="l02226"></a><a class="code" href="chan__usbradio_8c.html#ab65cf11e464669e400b87541652510dd">02226</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="chan__usbradio_8c.html#ab65cf11e464669e400b87541652510dd">usbradio_request</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>, <span class="keywordtype">int</span> <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>, <span class="keywordtype">void</span> *<a class="code" href="structast__channel.html#a8f64897c7ccc5c13f276d1d07c4e7095">data</a>, <span class="keywordtype">int</span> *<a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a>)
<a name="l02227"></a>02227 {
<a name="l02228"></a>02228    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c;
<a name="l02229"></a>02229    <span class="keyword">struct </span><a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o = <a class="code" href="chan__usbradio_8c.html#ac7145e9cf19c5cf2a51fcdb3e747eabe">find_desc</a>(data);
<a name="l02230"></a>02230 
<a name="l02231"></a>02231    TRACEO(1,(<span class="stringliteral">&quot;usbradio_request()\n&quot;</span>));
<a name="l02232"></a>02232 
<a name="l02233"></a>02233    <span class="keywordflow">if</span> (0)
<a name="l02234"></a>02234    {
<a name="l02235"></a>02235       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;usbradio_request type &lt;%s&gt; data 0x%p &lt;%s&gt;\n&quot;</span>, type, data, (<span class="keywordtype">char</span> *) data);
<a name="l02236"></a>02236    }
<a name="l02237"></a>02237    <span class="keywordflow">if</span> (o == NULL) {
<a name="l02238"></a>02238       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Device %s not found\n&quot;</span>, (<span class="keywordtype">char</span> *) data);
<a name="l02239"></a>02239       <span class="comment">/* XXX we could default to &apos;dsp&apos; perhaps ? */</span>
<a name="l02240"></a>02240       <span class="keywordflow">return</span> NULL;
<a name="l02241"></a>02241    }
<a name="l02242"></a>02242    <span class="keywordflow">if</span> ((format &amp; <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>) == 0) {
<a name="l02243"></a>02243       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Format 0x%x unsupported\n&quot;</span>, format);
<a name="l02244"></a>02244       <span class="keywordflow">return</span> NULL;
<a name="l02245"></a>02245    }
<a name="l02246"></a>02246    <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l02247"></a>02247       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Already have a call (chan %p) on the usb channel\n&quot;</span>, o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l02248"></a>02248       *cause = <a class="code" href="causes_8h.html#ae009c193522491f7de7ea28b23f20868">AST_CAUSE_BUSY</a>;
<a name="l02249"></a>02249       <span class="keywordflow">return</span> NULL;
<a name="l02250"></a>02250    }
<a name="l02251"></a>02251    c = <a class="code" href="chan__usbradio_8c.html#a5fdcb22bef0bcd15623ee6562b1f7b61">usbradio_new</a>(o, NULL, NULL, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a>);
<a name="l02252"></a>02252    <span class="keywordflow">if</span> (c == NULL) {
<a name="l02253"></a>02253       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create new usb channel\n&quot;</span>);
<a name="l02254"></a>02254       <span class="keywordflow">return</span> NULL;
<a name="l02255"></a>02255    }
<a name="l02256"></a>02256       
<a name="l02257"></a>02257    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a933ce66d291cb7d99d8693683d0a3f7d">b</a>.<a class="code" href="structchan__usbradio__pvt.html#aef7ddb05106487178eb92abe88289e7f">remoted</a>=0;
<a name="l02258"></a>02258    <a class="code" href="chan__usbradio_8c.html#a5f60010431301ac2b329a1910776855d">xpmr_config</a>(o);
<a name="l02259"></a>02259 
<a name="l02260"></a>02260    <span class="keywordflow">return</span> c;
<a name="l02261"></a>02261 }
<a name="l02262"></a>02262 <span class="comment">/*</span>
<a name="l02263"></a>02263 <span class="comment">*/</span>
<a name="l02264"></a><a class="code" href="chan__usbradio_8c.html#aaf9f0b89166c9c97cdfdf91be3b56ad0">02264</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#aaf9f0b89166c9c97cdfdf91be3b56ad0">console_key</a>(<span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
<a name="l02265"></a>02265 {
<a name="l02266"></a>02266    <span class="keyword">struct </span><a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o = <a class="code" href="chan__usbradio_8c.html#ac7145e9cf19c5cf2a51fcdb3e747eabe">find_desc</a>(usbradio_active);
<a name="l02267"></a>02267 
<a name="l02268"></a>02268    <span class="keywordflow">if</span> (argc != 2)
<a name="l02269"></a>02269       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a76ed22cec1f42c93a5b4eed8d967338f">RESULT_SHOWUSAGE</a>; 
<a name="l02270"></a>02270    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a633a737f50a6fd3c20783e59ada69952">txtestkey</a> = 1;
<a name="l02271"></a>02271    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a7cc1753a05a0821f6c70dd2bccfbab5c">RESULT_SUCCESS</a>;
<a name="l02272"></a>02272 }
<a name="l02273"></a>02273 <span class="comment">/*</span>
<a name="l02274"></a>02274 <span class="comment">*/</span>
<a name="l02275"></a><a class="code" href="chan__usbradio_8c.html#ad1564ccfbcf28ec9273f510493793545">02275</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#ad1564ccfbcf28ec9273f510493793545">console_unkey</a>(<span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
<a name="l02276"></a>02276 {
<a name="l02277"></a>02277    <span class="keyword">struct </span><a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o = <a class="code" href="chan__usbradio_8c.html#ac7145e9cf19c5cf2a51fcdb3e747eabe">find_desc</a>(usbradio_active);
<a name="l02278"></a>02278 
<a name="l02279"></a>02279    <span class="keywordflow">if</span> (argc != 2)
<a name="l02280"></a>02280       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a76ed22cec1f42c93a5b4eed8d967338f">RESULT_SHOWUSAGE</a>;
<a name="l02281"></a>02281    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a633a737f50a6fd3c20783e59ada69952">txtestkey</a> = 0;
<a name="l02282"></a>02282    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a7cc1753a05a0821f6c70dd2bccfbab5c">RESULT_SUCCESS</a>;
<a name="l02283"></a>02283 }
<a name="l02284"></a>02284 
<a name="l02285"></a><a class="code" href="chan__usbradio_8c.html#a5ec1e35fe999569ee78fcb9b035e235f">02285</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#a5ec1e35fe999569ee78fcb9b035e235f">radio_tune</a>(<span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
<a name="l02286"></a>02286 {
<a name="l02287"></a>02287    <span class="keyword">struct </span><a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o = <a class="code" href="chan__usbradio_8c.html#ac7145e9cf19c5cf2a51fcdb3e747eabe">find_desc</a>(usbradio_active);
<a name="l02288"></a>02288    <span class="keywordtype">int</span> i=0;
<a name="l02289"></a>02289 
<a name="l02290"></a>02290    <span class="keywordflow">if</span> ((argc &lt; 2) || (argc &gt; 4))
<a name="l02291"></a>02291       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a76ed22cec1f42c93a5b4eed8d967338f">RESULT_SHOWUSAGE</a>; 
<a name="l02292"></a>02292 
<a name="l02293"></a>02293    <span class="keywordflow">if</span> (argc == 2) <span class="comment">/* just show stuff */</span>
<a name="l02294"></a>02294    {
<a name="l02295"></a>02295       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;Active radio interface is [%s]\n&quot;</span>,usbradio_active);
<a name="l02296"></a>02296       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;Output A is currently set to &quot;</span>);
<a name="l02297"></a>02297       <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a95a57d28620e96b54f510eb9a543ddfc">txmixa</a>==<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051eaea61167af07104aee49cea1568e356ec">TX_OUT_COMPOSITE</a>)<a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;composite.\n&quot;</span>);
<a name="l02298"></a>02298       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a95a57d28620e96b54f510eb9a543ddfc">txmixa</a>==<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051eaccdce3522c59395383ad570f8ee57acd">TX_OUT_VOICE</a>)<a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;voice.\n&quot;</span>);
<a name="l02299"></a>02299       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a95a57d28620e96b54f510eb9a543ddfc">txmixa</a>==<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051ea10815a225284305f3f93416f07a85cb7">TX_OUT_LSD</a>)<a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;tone.\n&quot;</span>);
<a name="l02300"></a>02300       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a95a57d28620e96b54f510eb9a543ddfc">txmixa</a>==<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051ea40abd0b87cb8a3bd0d80c4732dad35e8">TX_OUT_AUX</a>)<a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;auxvoice.\n&quot;</span>);
<a name="l02301"></a>02301       <span class="keywordflow">else</span> <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;off.\n&quot;</span>);
<a name="l02302"></a>02302 
<a name="l02303"></a>02303       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;Output B is currently set to &quot;</span>);
<a name="l02304"></a>02304       <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a6cf7fb2913ee1a3c50247dd8f6ea32a4">txmixb</a>==<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051eaea61167af07104aee49cea1568e356ec">TX_OUT_COMPOSITE</a>)<a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;composite.\n&quot;</span>);
<a name="l02305"></a>02305       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a6cf7fb2913ee1a3c50247dd8f6ea32a4">txmixb</a>==<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051eaccdce3522c59395383ad570f8ee57acd">TX_OUT_VOICE</a>)<a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;voice.\n&quot;</span>);
<a name="l02306"></a>02306       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a6cf7fb2913ee1a3c50247dd8f6ea32a4">txmixb</a>==<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051ea10815a225284305f3f93416f07a85cb7">TX_OUT_LSD</a>)<a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;tone.\n&quot;</span>);
<a name="l02307"></a>02307       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a6cf7fb2913ee1a3c50247dd8f6ea32a4">txmixb</a>==<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051ea40abd0b87cb8a3bd0d80c4732dad35e8">TX_OUT_AUX</a>)<a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;auxvoice.\n&quot;</span>);
<a name="l02308"></a>02308       <span class="keywordflow">else</span> <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;off.\n&quot;</span>);
<a name="l02309"></a>02309 
<a name="l02310"></a>02310       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;Tx Voice Level currently set to %d\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5dca179fe41743d80bd66e6a21de9fac">txmixaset</a>);
<a name="l02311"></a>02311       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;Tx Tone Level currently set to %d\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af559c722569892f0612ff5c65493fe7a">txctcssadj</a>);
<a name="l02312"></a>02312       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;Rx Squelch currently set to %d\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a1745424fe0dd99b7d3a778a253a5d686">rxsquelchadj</a>);
<a name="l02313"></a>02313       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;Device String is %s\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ae0013a0ec03c2c35c2966c6aa3147abd">devstr</a>);
<a name="l02314"></a>02314       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a76ed22cec1f42c93a5b4eed8d967338f">RESULT_SHOWUSAGE</a>;
<a name="l02315"></a>02315    }
<a name="l02316"></a>02316 
<a name="l02317"></a>02317    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;b.tuning=1;
<a name="l02318"></a>02318 
<a name="l02319"></a>02319    <span class="keywordflow">if</span> (!strcasecmp(argv[2],<span class="stringliteral">&quot;rxnoise&quot;</span>)) <a class="code" href="chan__usbradio_8c.html#a64be783c23515f787fb2b093c2fce542">tune_rxinput</a>(fd,o);
<a name="l02320"></a>02320    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(argv[2],<span class="stringliteral">&quot;rxvoice&quot;</span>)) <a class="code" href="chan__usbradio_8c.html#a888766fbac96eab38b64ab7d04c6d1e1">tune_rxvoice</a>(fd,o);
<a name="l02321"></a>02321    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(argv[2],<span class="stringliteral">&quot;rxtone&quot;</span>)) <a class="code" href="chan__usbradio_8c.html#a1e5dd762108ebc90c351cd91991aa3ad">tune_rxctcss</a>(fd,o);
<a name="l02322"></a>02322    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(argv[2],<span class="stringliteral">&quot;rxsquelch&quot;</span>))
<a name="l02323"></a>02323    {
<a name="l02324"></a>02324       <span class="keywordflow">if</span> (argc == 3)
<a name="l02325"></a>02325       {
<a name="l02326"></a>02326           <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;Current Signal Strength is %d\n&quot;</span>,((32767-o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;rxRssi)*1000/32767));
<a name="l02327"></a>02327           <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;Current Squelch setting is %d\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a1745424fe0dd99b7d3a778a253a5d686">rxsquelchadj</a>);
<a name="l02328"></a>02328          <span class="comment">//ast_cli(fd,&quot;Current Raw RSSI        is %d\n&quot;,o-&gt;pmrChan-&gt;rxRssi);</span>
<a name="l02329"></a>02329           <span class="comment">//ast_cli(fd,&quot;Current (real) Squelch setting is %d\n&quot;,*(o-&gt;pmrChan-&gt;prxSquelchAdjust));</span>
<a name="l02330"></a>02330       } <span class="keywordflow">else</span> {
<a name="l02331"></a>02331          i = atoi(argv[3]);
<a name="l02332"></a>02332          <span class="keywordflow">if</span> ((i &lt; 0) || (i &gt; 999)) <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a76ed22cec1f42c93a5b4eed8d967338f">RESULT_SHOWUSAGE</a>;
<a name="l02333"></a>02333          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;Changed Squelch setting to %d\n&quot;</span>,i);
<a name="l02334"></a>02334          o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a1745424fe0dd99b7d3a778a253a5d686">rxsquelchadj</a> = i;
<a name="l02335"></a>02335          *(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;prxSquelchAdjust)= ((999 - i) * 32767) / 1000;
<a name="l02336"></a>02336       }
<a name="l02337"></a>02337    }
<a name="l02338"></a>02338    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(argv[2],<span class="stringliteral">&quot;txvoice&quot;</span>)) {
<a name="l02339"></a>02339       i = 0;
<a name="l02340"></a>02340 
<a name="l02341"></a>02341       <span class="keywordflow">if</span>( (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a95a57d28620e96b54f510eb9a543ddfc">txmixa</a>!=<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051eaccdce3522c59395383ad570f8ee57acd">TX_OUT_VOICE</a>) &amp;&amp; (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a6cf7fb2913ee1a3c50247dd8f6ea32a4">txmixb</a>!=<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051eaccdce3522c59395383ad570f8ee57acd">TX_OUT_VOICE</a>) &amp;&amp;
<a name="l02342"></a>02342          (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a95a57d28620e96b54f510eb9a543ddfc">txmixa</a>!=<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051eaea61167af07104aee49cea1568e356ec">TX_OUT_COMPOSITE</a>) &amp;&amp; (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a6cf7fb2913ee1a3c50247dd8f6ea32a4">txmixb</a>!=<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051eaea61167af07104aee49cea1568e356ec">TX_OUT_COMPOSITE</a>)
<a name="l02343"></a>02343         )
<a name="l02344"></a>02344       {
<a name="l02345"></a>02345          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,<span class="stringliteral">&quot;No txvoice output configured.\n&quot;</span>);
<a name="l02346"></a>02346       }
<a name="l02347"></a>02347       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (argc == 3)
<a name="l02348"></a>02348       {
<a name="l02349"></a>02349          <span class="keywordflow">if</span>((o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a95a57d28620e96b54f510eb9a543ddfc">txmixa</a>==<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051eaccdce3522c59395383ad570f8ee57acd">TX_OUT_VOICE</a>)||(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a95a57d28620e96b54f510eb9a543ddfc">txmixa</a>==<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051eaea61167af07104aee49cea1568e356ec">TX_OUT_COMPOSITE</a>))
<a name="l02350"></a>02350             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;Current txvoice setting on Channel A is %d\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5dca179fe41743d80bd66e6a21de9fac">txmixaset</a>);
<a name="l02351"></a>02351          <span class="keywordflow">else</span>
<a name="l02352"></a>02352             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;Current txvoice setting on Channel B is %d\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac2c2424ad6a5ca0a0c6f7026e74d7701">txmixbset</a>);
<a name="l02353"></a>02353       }
<a name="l02354"></a>02354       <span class="keywordflow">else</span>
<a name="l02355"></a>02355       {
<a name="l02356"></a>02356          i = atoi(argv[3]);
<a name="l02357"></a>02357          <span class="keywordflow">if</span> ((i &lt; 0) || (i &gt; 999)) <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a76ed22cec1f42c93a5b4eed8d967338f">RESULT_SHOWUSAGE</a>;
<a name="l02358"></a>02358 
<a name="l02359"></a>02359          <span class="keywordflow">if</span>((o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a95a57d28620e96b54f510eb9a543ddfc">txmixa</a>==<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051eaccdce3522c59395383ad570f8ee57acd">TX_OUT_VOICE</a>)||(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a95a57d28620e96b54f510eb9a543ddfc">txmixa</a>==<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051eaea61167af07104aee49cea1568e356ec">TX_OUT_COMPOSITE</a>))
<a name="l02360"></a>02360          {
<a name="l02361"></a>02361             o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5dca179fe41743d80bd66e6a21de9fac">txmixaset</a>=i;
<a name="l02362"></a>02362             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;Changed txvoice setting on Channel A to %d\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5dca179fe41743d80bd66e6a21de9fac">txmixaset</a>);
<a name="l02363"></a>02363          }
<a name="l02364"></a>02364          <span class="keywordflow">else</span>
<a name="l02365"></a>02365          {
<a name="l02366"></a>02366             o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac2c2424ad6a5ca0a0c6f7026e74d7701">txmixbset</a>=i;   
<a name="l02367"></a>02367             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;Changed txvoice setting on Channel B to %d\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac2c2424ad6a5ca0a0c6f7026e74d7701">txmixbset</a>);
<a name="l02368"></a>02368          }
<a name="l02369"></a>02369          <a class="code" href="chan__usbradio_8c.html#aa2020bdc5a2688a4727e349befacb35d">mixer_write</a>(o);
<a name="l02370"></a>02370          <a class="code" href="chan__usbradio_8c.html#acb41a83bcd08bfc92fb24c6ece7830c0">mult_set</a>(o);
<a name="l02371"></a>02371          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;Changed Tx Voice Output setting to %d\n&quot;</span>,i);
<a name="l02372"></a>02372       }
<a name="l02373"></a>02373       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;b.txCtcssInhibit=1;
<a name="l02374"></a>02374       <a class="code" href="chan__usbradio_8c.html#a24df517f036903ee52d886a2fef0d1c8">tune_txoutput</a>(o,i,fd);
<a name="l02375"></a>02375       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;b.txCtcssInhibit=0;
<a name="l02376"></a>02376    }
<a name="l02377"></a>02377    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(argv[2],<span class="stringliteral">&quot;txall&quot;</span>)) {
<a name="l02378"></a>02378       i = 0;
<a name="l02379"></a>02379 
<a name="l02380"></a>02380       <span class="keywordflow">if</span>( (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a95a57d28620e96b54f510eb9a543ddfc">txmixa</a>!=<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051eaccdce3522c59395383ad570f8ee57acd">TX_OUT_VOICE</a>) &amp;&amp; (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a6cf7fb2913ee1a3c50247dd8f6ea32a4">txmixb</a>!=<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051eaccdce3522c59395383ad570f8ee57acd">TX_OUT_VOICE</a>) &amp;&amp;
<a name="l02381"></a>02381          (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a95a57d28620e96b54f510eb9a543ddfc">txmixa</a>!=<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051eaea61167af07104aee49cea1568e356ec">TX_OUT_COMPOSITE</a>) &amp;&amp; (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a6cf7fb2913ee1a3c50247dd8f6ea32a4">txmixb</a>!=<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051eaea61167af07104aee49cea1568e356ec">TX_OUT_COMPOSITE</a>)
<a name="l02382"></a>02382         )
<a name="l02383"></a>02383       {
<a name="l02384"></a>02384          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,<span class="stringliteral">&quot;No txvoice output configured.\n&quot;</span>);
<a name="l02385"></a>02385       }
<a name="l02386"></a>02386       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (argc == 3)
<a name="l02387"></a>02387       {
<a name="l02388"></a>02388          <span class="keywordflow">if</span>((o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a95a57d28620e96b54f510eb9a543ddfc">txmixa</a>==<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051eaccdce3522c59395383ad570f8ee57acd">TX_OUT_VOICE</a>)||(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a95a57d28620e96b54f510eb9a543ddfc">txmixa</a>==<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051eaea61167af07104aee49cea1568e356ec">TX_OUT_COMPOSITE</a>))
<a name="l02389"></a>02389             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;Current txvoice setting on Channel A is %d\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5dca179fe41743d80bd66e6a21de9fac">txmixaset</a>);
<a name="l02390"></a>02390          <span class="keywordflow">else</span>
<a name="l02391"></a>02391             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;Current txvoice setting on Channel B is %d\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac2c2424ad6a5ca0a0c6f7026e74d7701">txmixbset</a>);
<a name="l02392"></a>02392       }
<a name="l02393"></a>02393       <span class="keywordflow">else</span>
<a name="l02394"></a>02394       {
<a name="l02395"></a>02395          i = atoi(argv[3]);
<a name="l02396"></a>02396          <span class="keywordflow">if</span> ((i &lt; 0) || (i &gt; 999)) <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a76ed22cec1f42c93a5b4eed8d967338f">RESULT_SHOWUSAGE</a>;
<a name="l02397"></a>02397 
<a name="l02398"></a>02398          <span class="keywordflow">if</span>((o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a95a57d28620e96b54f510eb9a543ddfc">txmixa</a>==<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051eaccdce3522c59395383ad570f8ee57acd">TX_OUT_VOICE</a>)||(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a95a57d28620e96b54f510eb9a543ddfc">txmixa</a>==<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051eaea61167af07104aee49cea1568e356ec">TX_OUT_COMPOSITE</a>))
<a name="l02399"></a>02399          {
<a name="l02400"></a>02400             o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5dca179fe41743d80bd66e6a21de9fac">txmixaset</a>=i;
<a name="l02401"></a>02401             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;Changed txvoice setting on Channel A to %d\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5dca179fe41743d80bd66e6a21de9fac">txmixaset</a>);
<a name="l02402"></a>02402          }
<a name="l02403"></a>02403          <span class="keywordflow">else</span>
<a name="l02404"></a>02404          {
<a name="l02405"></a>02405             o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac2c2424ad6a5ca0a0c6f7026e74d7701">txmixbset</a>=i;   
<a name="l02406"></a>02406             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;Changed txvoice setting on Channel B to %d\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac2c2424ad6a5ca0a0c6f7026e74d7701">txmixbset</a>);
<a name="l02407"></a>02407          }
<a name="l02408"></a>02408          <a class="code" href="chan__usbradio_8c.html#aa2020bdc5a2688a4727e349befacb35d">mixer_write</a>(o);
<a name="l02409"></a>02409          <a class="code" href="chan__usbradio_8c.html#acb41a83bcd08bfc92fb24c6ece7830c0">mult_set</a>(o);
<a name="l02410"></a>02410          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;Changed Tx Voice Output setting to %d\n&quot;</span>,i);
<a name="l02411"></a>02411       }
<a name="l02412"></a>02412       <a class="code" href="chan__usbradio_8c.html#a24df517f036903ee52d886a2fef0d1c8">tune_txoutput</a>(o,i,fd);
<a name="l02413"></a>02413    }
<a name="l02414"></a>02414    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(argv[2],<span class="stringliteral">&quot;auxvoice&quot;</span>)) {
<a name="l02415"></a>02415       i = 0;
<a name="l02416"></a>02416       <span class="keywordflow">if</span>( (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a95a57d28620e96b54f510eb9a543ddfc">txmixa</a>!=<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051ea40abd0b87cb8a3bd0d80c4732dad35e8">TX_OUT_AUX</a>) &amp;&amp; (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a6cf7fb2913ee1a3c50247dd8f6ea32a4">txmixb</a>!=<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051ea40abd0b87cb8a3bd0d80c4732dad35e8">TX_OUT_AUX</a>))
<a name="l02417"></a>02417       {
<a name="l02418"></a>02418          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,<span class="stringliteral">&quot;No auxvoice output configured.\n&quot;</span>);
<a name="l02419"></a>02419       }
<a name="l02420"></a>02420       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (argc == 3)
<a name="l02421"></a>02421       {
<a name="l02422"></a>02422          <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a95a57d28620e96b54f510eb9a543ddfc">txmixa</a>==<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051ea40abd0b87cb8a3bd0d80c4732dad35e8">TX_OUT_AUX</a>)
<a name="l02423"></a>02423             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;Current auxvoice setting on Channel A is %d\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5dca179fe41743d80bd66e6a21de9fac">txmixaset</a>);
<a name="l02424"></a>02424          <span class="keywordflow">else</span>
<a name="l02425"></a>02425             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;Current auxvoice setting on Channel B is %d\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac2c2424ad6a5ca0a0c6f7026e74d7701">txmixbset</a>);
<a name="l02426"></a>02426       }
<a name="l02427"></a>02427       <span class="keywordflow">else</span>
<a name="l02428"></a>02428       {
<a name="l02429"></a>02429          i = atoi(argv[3]);
<a name="l02430"></a>02430          <span class="keywordflow">if</span> ((i &lt; 0) || (i &gt; 999)) <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a76ed22cec1f42c93a5b4eed8d967338f">RESULT_SHOWUSAGE</a>;
<a name="l02431"></a>02431          <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a95a57d28620e96b54f510eb9a543ddfc">txmixa</a>==<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051ea40abd0b87cb8a3bd0d80c4732dad35e8">TX_OUT_AUX</a>)
<a name="l02432"></a>02432          {
<a name="l02433"></a>02433             o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac2c2424ad6a5ca0a0c6f7026e74d7701">txmixbset</a>=i;
<a name="l02434"></a>02434             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;Changed auxvoice setting on Channel A to %d\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5dca179fe41743d80bd66e6a21de9fac">txmixaset</a>);
<a name="l02435"></a>02435          }
<a name="l02436"></a>02436          <span class="keywordflow">else</span>
<a name="l02437"></a>02437          {
<a name="l02438"></a>02438             o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac2c2424ad6a5ca0a0c6f7026e74d7701">txmixbset</a>=i;
<a name="l02439"></a>02439             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;Changed auxvoice setting on Channel B to %d\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac2c2424ad6a5ca0a0c6f7026e74d7701">txmixbset</a>);
<a name="l02440"></a>02440          }
<a name="l02441"></a>02441          <a class="code" href="chan__usbradio_8c.html#aa2020bdc5a2688a4727e349befacb35d">mixer_write</a>(o);
<a name="l02442"></a>02442          <a class="code" href="chan__usbradio_8c.html#acb41a83bcd08bfc92fb24c6ece7830c0">mult_set</a>(o);
<a name="l02443"></a>02443       }
<a name="l02444"></a>02444       <span class="comment">//tune_auxoutput(o,i);</span>
<a name="l02445"></a>02445    }
<a name="l02446"></a>02446    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(argv[2],<span class="stringliteral">&quot;txtone&quot;</span>))
<a name="l02447"></a>02447    {
<a name="l02448"></a>02448       <span class="keywordflow">if</span> (argc == 3)
<a name="l02449"></a>02449          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;Current Tx CTCSS modulation setting = %d\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af559c722569892f0612ff5c65493fe7a">txctcssadj</a>);
<a name="l02450"></a>02450       <span class="keywordflow">else</span>
<a name="l02451"></a>02451       {
<a name="l02452"></a>02452          i = atoi(argv[3]);
<a name="l02453"></a>02453          <span class="keywordflow">if</span> ((i &lt; 0) || (i &gt; 999)) <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a76ed22cec1f42c93a5b4eed8d967338f">RESULT_SHOWUSAGE</a>;
<a name="l02454"></a>02454          o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af559c722569892f0612ff5c65493fe7a">txctcssadj</a> = i;
<a name="l02455"></a>02455          <a class="code" href="chan__usbradio_8c.html#abf334b349b8cb56932ef975dadfbb7df">set_txctcss_level</a>(o);
<a name="l02456"></a>02456          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;Changed Tx CTCSS modulation setting to %i\n&quot;</span>,i);
<a name="l02457"></a>02457       }
<a name="l02458"></a>02458       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a633a737f50a6fd3c20783e59ada69952">txtestkey</a>=1;
<a name="l02459"></a>02459       usleep(5000000);
<a name="l02460"></a>02460       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a633a737f50a6fd3c20783e59ada69952">txtestkey</a>=0;
<a name="l02461"></a>02461    }
<a name="l02462"></a>02462    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(argv[2],<span class="stringliteral">&quot;dump&quot;</span>)) <a class="code" href="chan__usbradio_8c.html#a98be1c07bf1c76b0ede7c3cef6c21c4e">pmrdump</a>(o);
<a name="l02463"></a>02463    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(argv[2],<span class="stringliteral">&quot;nocap&quot;</span>))    
<a name="l02464"></a>02464    {
<a name="l02465"></a>02465       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;File capture (trace) was rx=%d tx=%d and now off.\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a933ce66d291cb7d99d8693683d0a3f7d">b</a>.<a class="code" href="structchan__usbradio__pvt.html#a0ffa6929db958c59e281798973c4ca2f">rxcap2</a>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a933ce66d291cb7d99d8693683d0a3f7d">b</a>.<a class="code" href="structchan__usbradio__pvt.html#ae4e34f0e79fb4c42c3833cf4e3d44b70">txcap2</a>);
<a name="l02466"></a>02466       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;File capture (raw)   was rx=%d tx=%d and now off.\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a933ce66d291cb7d99d8693683d0a3f7d">b</a>.<a class="code" href="structchan__usbradio__pvt.html#a34f93defb00c007bb028c2fa93eac568">rxcapraw</a>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a933ce66d291cb7d99d8693683d0a3f7d">b</a>.<a class="code" href="structchan__usbradio__pvt.html#a73d52d82e0d9d59647ad56302b908aa9">txcapraw</a>);
<a name="l02467"></a>02467       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a933ce66d291cb7d99d8693683d0a3f7d">b</a>.<a class="code" href="structchan__usbradio__pvt.html#a34f93defb00c007bb028c2fa93eac568">rxcapraw</a>=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a933ce66d291cb7d99d8693683d0a3f7d">b</a>.<a class="code" href="structchan__usbradio__pvt.html#a73d52d82e0d9d59647ad56302b908aa9">txcapraw</a>=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a933ce66d291cb7d99d8693683d0a3f7d">b</a>.<a class="code" href="structchan__usbradio__pvt.html#a0ffa6929db958c59e281798973c4ca2f">rxcap2</a>=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a933ce66d291cb7d99d8693683d0a3f7d">b</a>.<a class="code" href="structchan__usbradio__pvt.html#ae4e34f0e79fb4c42c3833cf4e3d44b70">txcap2</a>=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;b.rxCapture=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;b.txCapture=0;
<a name="l02468"></a>02468       <span class="keywordflow">if</span> (frxcapraw) { fclose(frxcapraw); frxcapraw = NULL; }
<a name="l02469"></a>02469       <span class="keywordflow">if</span> (frxcaptrace) { fclose(frxcaptrace); frxcaptrace = NULL; }
<a name="l02470"></a>02470       <span class="keywordflow">if</span> (frxoutraw) { fclose(frxoutraw); frxoutraw = NULL; }
<a name="l02471"></a>02471       <span class="keywordflow">if</span> (ftxcapraw) { fclose(ftxcapraw); ftxcapraw = NULL; }
<a name="l02472"></a>02472       <span class="keywordflow">if</span> (ftxcaptrace) { fclose(ftxcaptrace); ftxcaptrace = NULL; }
<a name="l02473"></a>02473       <span class="keywordflow">if</span> (ftxoutraw) { fclose(ftxoutraw); ftxoutraw = NULL; }
<a name="l02474"></a>02474    }
<a name="l02475"></a>02475    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(argv[2],<span class="stringliteral">&quot;rxtracecap&quot;</span>)) 
<a name="l02476"></a>02476    {
<a name="l02477"></a>02477       <span class="keywordflow">if</span> (!frxcaptrace) frxcaptrace= fopen(<a class="code" href="chan__usbradio_8c.html#a562d1f506b1890e3762ea5f6e135e4cf">RX_CAP_TRACE_FILE</a>,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l02478"></a>02478       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;Trace rx on.\n&quot;</span>);
<a name="l02479"></a>02479       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a933ce66d291cb7d99d8693683d0a3f7d">b</a>.<a class="code" href="structchan__usbradio__pvt.html#a0ffa6929db958c59e281798973c4ca2f">rxcap2</a>=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;b.rxCapture=1;
<a name="l02480"></a>02480    }
<a name="l02481"></a>02481    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(argv[2],<span class="stringliteral">&quot;txtracecap&quot;</span>)) 
<a name="l02482"></a>02482    {
<a name="l02483"></a>02483       <span class="keywordflow">if</span> (!ftxcaptrace) ftxcaptrace= fopen(<a class="code" href="chan__usbradio_8c.html#ad68b53d74eb2b7d824a5138673ee33e5">TX_CAP_TRACE_FILE</a>,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l02484"></a>02484       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;Trace tx on.\n&quot;</span>);
<a name="l02485"></a>02485       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a933ce66d291cb7d99d8693683d0a3f7d">b</a>.<a class="code" href="structchan__usbradio__pvt.html#ae4e34f0e79fb4c42c3833cf4e3d44b70">txcap2</a>=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;b.txCapture=1;
<a name="l02486"></a>02486    }
<a name="l02487"></a>02487    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(argv[2],<span class="stringliteral">&quot;rxcap&quot;</span>)) 
<a name="l02488"></a>02488    {
<a name="l02489"></a>02489       <span class="keywordflow">if</span> (!frxcapraw) frxcapraw = fopen(<a class="code" href="chan__usbradio_8c.html#a474f3f93f52d6f6b47704bba67b4c7b0">RX_CAP_RAW_FILE</a>,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l02490"></a>02490       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;cap rx raw on.\n&quot;</span>);
<a name="l02491"></a>02491       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a933ce66d291cb7d99d8693683d0a3f7d">b</a>.<a class="code" href="structchan__usbradio__pvt.html#a34f93defb00c007bb028c2fa93eac568">rxcapraw</a>=1;
<a name="l02492"></a>02492    }
<a name="l02493"></a>02493    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(argv[2],<span class="stringliteral">&quot;txcap&quot;</span>)) 
<a name="l02494"></a>02494    {
<a name="l02495"></a>02495       <span class="keywordflow">if</span> (!ftxcapraw) ftxcapraw = fopen(<a class="code" href="chan__usbradio_8c.html#ab9127b328544e9ace5c706d2389b4e31">TX_CAP_RAW_FILE</a>,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l02496"></a>02496       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;cap tx raw on.\n&quot;</span>);
<a name="l02497"></a>02497       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a933ce66d291cb7d99d8693683d0a3f7d">b</a>.<a class="code" href="structchan__usbradio__pvt.html#a73d52d82e0d9d59647ad56302b908aa9">txcapraw</a>=1;
<a name="l02498"></a>02498    }
<a name="l02499"></a>02499    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(argv[2],<span class="stringliteral">&quot;save&quot;</span>))
<a name="l02500"></a>02500    {
<a name="l02501"></a>02501       <a class="code" href="chan__usbradio_8c.html#a7a5f435c891a0ebe13436cf941515a76">tune_write</a>(o);
<a name="l02502"></a>02502       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;Saved radio tuning settings to usbradio_tune_%s.conf\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l02503"></a>02503    }
<a name="l02504"></a>02504    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(argv[2],<span class="stringliteral">&quot;load&quot;</span>))
<a name="l02505"></a>02505    {
<a name="l02506"></a>02506       <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0cb029a4ba4ae628b6f5431a4cbb753f">eepromlock</a>);
<a name="l02507"></a>02507       <span class="keywordflow">while</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#aa4c4270e4903db2dcb2ee7e3a7966ca3">eepromctl</a>)
<a name="l02508"></a>02508       {
<a name="l02509"></a>02509          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0cb029a4ba4ae628b6f5431a4cbb753f">eepromlock</a>);
<a name="l02510"></a>02510          usleep(10000);
<a name="l02511"></a>02511          <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0cb029a4ba4ae628b6f5431a4cbb753f">eepromlock</a>);
<a name="l02512"></a>02512       }
<a name="l02513"></a>02513       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#aa4c4270e4903db2dcb2ee7e3a7966ca3">eepromctl</a> = 1;  <span class="comment">/* request a load */</span>
<a name="l02514"></a>02514       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0cb029a4ba4ae628b6f5431a4cbb753f">eepromlock</a>);
<a name="l02515"></a>02515 
<a name="l02516"></a>02516       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;Requesting loading of tuning settings from EEPROM for channel %s\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l02517"></a>02517    }
<a name="l02518"></a>02518    <span class="keywordflow">else</span>
<a name="l02519"></a>02519    {
<a name="l02520"></a>02520       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;b.tuning=0;
<a name="l02521"></a>02521       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a76ed22cec1f42c93a5b4eed8d967338f">RESULT_SHOWUSAGE</a>;
<a name="l02522"></a>02522    }
<a name="l02523"></a>02523    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;b.tuning=0;
<a name="l02524"></a>02524    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a7cc1753a05a0821f6c70dd2bccfbab5c">RESULT_SUCCESS</a>;
<a name="l02525"></a>02525 }
<a name="l02526"></a>02526 
<a name="l02527"></a>02527 <span class="comment">/*</span>
<a name="l02528"></a>02528 <span class="comment">   set transmit ctcss modulation level</span>
<a name="l02529"></a>02529 <span class="comment">   adjust mixer output or internal gain depending on output type</span>
<a name="l02530"></a>02530 <span class="comment">   setting range is 0.0 to 0.9</span>
<a name="l02531"></a>02531 <span class="comment">*/</span>
<a name="l02532"></a><a class="code" href="chan__usbradio_8c.html#abf334b349b8cb56932ef975dadfbb7df">02532</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#abf334b349b8cb56932ef975dadfbb7df">set_txctcss_level</a>(<span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o)
<a name="l02533"></a>02533 {                      
<a name="l02534"></a>02534    <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a95a57d28620e96b54f510eb9a543ddfc">txmixa</a> == <a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051ea10815a225284305f3f93416f07a85cb7">TX_OUT_LSD</a>)
<a name="l02535"></a>02535    {
<a name="l02536"></a>02536 <span class="comment">//    o-&gt;txmixaset=(151*o-&gt;txctcssadj) / 1000;</span>
<a name="l02537"></a>02537       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5dca179fe41743d80bd66e6a21de9fac">txmixaset</a>=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af559c722569892f0612ff5c65493fe7a">txctcssadj</a>;
<a name="l02538"></a>02538       <a class="code" href="chan__usbradio_8c.html#aa2020bdc5a2688a4727e349befacb35d">mixer_write</a>(o);
<a name="l02539"></a>02539       <a class="code" href="chan__usbradio_8c.html#acb41a83bcd08bfc92fb24c6ece7830c0">mult_set</a>(o);
<a name="l02540"></a>02540    }
<a name="l02541"></a>02541    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a6cf7fb2913ee1a3c50247dd8f6ea32a4">txmixb</a> == <a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051ea10815a225284305f3f93416f07a85cb7">TX_OUT_LSD</a>)
<a name="l02542"></a>02542    {
<a name="l02543"></a>02543 <span class="comment">//    o-&gt;txmixbset=(151*o-&gt;txctcssadj) / 1000;</span>
<a name="l02544"></a>02544       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac2c2424ad6a5ca0a0c6f7026e74d7701">txmixbset</a>=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af559c722569892f0612ff5c65493fe7a">txctcssadj</a>;
<a name="l02545"></a>02545       <a class="code" href="chan__usbradio_8c.html#aa2020bdc5a2688a4727e349befacb35d">mixer_write</a>(o);
<a name="l02546"></a>02546       <a class="code" href="chan__usbradio_8c.html#acb41a83bcd08bfc92fb24c6ece7830c0">mult_set</a>(o);
<a name="l02547"></a>02547    }
<a name="l02548"></a>02548    <span class="keywordflow">else</span>
<a name="l02549"></a>02549    {
<a name="l02550"></a>02550       *o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;ptxCtcssAdjust=(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af559c722569892f0612ff5c65493fe7a">txctcssadj</a> * M_Q8) / 1000;
<a name="l02551"></a>02551    }
<a name="l02552"></a>02552    <span class="keywordflow">return</span> 0;
<a name="l02553"></a>02553 }
<a name="l02554"></a>02554 <span class="comment">/*</span>
<a name="l02555"></a>02555 <span class="comment">   CLI debugging on and off</span>
<a name="l02556"></a>02556 <span class="comment">*/</span>
<a name="l02557"></a><a class="code" href="chan__usbradio_8c.html#ad912cb21af19858d008bb8d4356b0f7b">02557</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#ad912cb21af19858d008bb8d4356b0f7b">radio_set_debug</a>(<span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
<a name="l02558"></a>02558 {
<a name="l02559"></a>02559    <span class="keyword">struct </span><a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o = <a class="code" href="chan__usbradio_8c.html#ac7145e9cf19c5cf2a51fcdb3e747eabe">find_desc</a>(usbradio_active);
<a name="l02560"></a>02560 
<a name="l02561"></a>02561    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a8bc52eafdec6e1ab31955b8e407746ba">debuglevel</a>=1;
<a name="l02562"></a>02562    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;usbradio debug on.\n&quot;</span>);
<a name="l02563"></a>02563    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a7cc1753a05a0821f6c70dd2bccfbab5c">RESULT_SUCCESS</a>;
<a name="l02564"></a>02564 }
<a name="l02565"></a>02565 
<a name="l02566"></a><a class="code" href="chan__usbradio_8c.html#a637e38da389743f92b2152a27aa09d19">02566</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#a637e38da389743f92b2152a27aa09d19">radio_set_debug_off</a>(<span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
<a name="l02567"></a>02567 {
<a name="l02568"></a>02568    <span class="keyword">struct </span><a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o = <a class="code" href="chan__usbradio_8c.html#ac7145e9cf19c5cf2a51fcdb3e747eabe">find_desc</a>(usbradio_active);
<a name="l02569"></a>02569 
<a name="l02570"></a>02570    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a8bc52eafdec6e1ab31955b8e407746ba">debuglevel</a>=0;
<a name="l02571"></a>02571    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;usbradio debug off.\n&quot;</span>);
<a name="l02572"></a>02572    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a7cc1753a05a0821f6c70dd2bccfbab5c">RESULT_SUCCESS</a>;
<a name="l02573"></a>02573 }
<a name="l02574"></a>02574 
<a name="l02575"></a><a class="code" href="chan__usbradio_8c.html#a51162f45e26983094b79f8a3aa07c3bf">02575</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#a51162f45e26983094b79f8a3aa07c3bf">radio_active</a>(<span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
<a name="l02576"></a>02576 {
<a name="l02577"></a>02577         <span class="keywordflow">if</span> (argc == 2)
<a name="l02578"></a>02578                 <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;active (command) USB Radio device is [%s]\n&quot;</span>, usbradio_active);
<a name="l02579"></a>02579         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (argc != 3)
<a name="l02580"></a>02580                 <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a76ed22cec1f42c93a5b4eed8d967338f">RESULT_SHOWUSAGE</a>;
<a name="l02581"></a>02581         <span class="keywordflow">else</span> {
<a name="l02582"></a>02582                 <span class="keyword">struct </span><a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o;
<a name="l02583"></a>02583                 <span class="keywordflow">if</span> (strcmp(argv[2], <span class="stringliteral">&quot;show&quot;</span>) == 0) {
<a name="l02584"></a>02584                         <span class="keywordflow">for</span> (o = usbradio_default.<a class="code" href="structchan__usbradio__pvt.html#a9f87d8717635cfb958525ea3b179ff4f">next</a>; o; o = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9f87d8717635cfb958525ea3b179ff4f">next</a>)
<a name="l02585"></a>02585                                 <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;device [%s] exists\n&quot;</span>, o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l02586"></a>02586                         <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a7cc1753a05a0821f6c70dd2bccfbab5c">RESULT_SUCCESS</a>;
<a name="l02587"></a>02587                 }
<a name="l02588"></a>02588                 o = <a class="code" href="chan__usbradio_8c.html#ac7145e9cf19c5cf2a51fcdb3e747eabe">find_desc</a>(argv[2]);
<a name="l02589"></a>02589                 <span class="keywordflow">if</span> (o == NULL)
<a name="l02590"></a>02590                         <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;No device [%s] exists\n&quot;</span>, argv[2]);
<a name="l02591"></a>02591                 <span class="keywordflow">else</span>
<a name="l02592"></a>02592             {
<a name="l02593"></a>02593                <span class="keyword">struct </span><a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *ao;
<a name="l02594"></a>02594                <span class="keywordflow">for</span> (ao = usbradio_default.<a class="code" href="structchan__usbradio__pvt.html#a9f87d8717635cfb958525ea3b179ff4f">next</a>; ao &amp;&amp; ao-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5ac083a645d964373f022d03df4849c8">name</a> ; ao = ao-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9f87d8717635cfb958525ea3b179ff4f">next</a>)ao-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;b.radioactive=0;
<a name="l02595"></a>02595                     usbradio_active = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5ac083a645d964373f022d03df4849c8">name</a>;
<a name="l02596"></a>02596                 o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;b.radioactive=1;
<a name="l02597"></a>02597             }
<a name="l02598"></a>02598         }
<a name="l02599"></a>02599         <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a7cc1753a05a0821f6c70dd2bccfbab5c">RESULT_SUCCESS</a>;
<a name="l02600"></a>02600 }
<a name="l02601"></a>02601 <span class="comment">/*</span>
<a name="l02602"></a>02602 <span class="comment">   CLI debugging on and off</span>
<a name="l02603"></a>02603 <span class="comment">*/</span>
<a name="l02604"></a><a class="code" href="chan__usbradio_8c.html#a23a2cbdf67c12b687b9d7c5fc2a8aa4f">02604</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#a23a2cbdf67c12b687b9d7c5fc2a8aa4f">radio_set_xpmr_debug</a>(<span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
<a name="l02605"></a>02605 {
<a name="l02606"></a>02606    <span class="keyword">struct </span><a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o = <a class="code" href="chan__usbradio_8c.html#ac7145e9cf19c5cf2a51fcdb3e747eabe">find_desc</a>(usbradio_active);
<a name="l02607"></a>02607 
<a name="l02608"></a>02608    <span class="keywordflow">if</span> (argc == 4)
<a name="l02609"></a>02609    {
<a name="l02610"></a>02610       <span class="keywordtype">int</span> i;
<a name="l02611"></a>02611       i = atoi(argv[3]);
<a name="l02612"></a>02612       <span class="keywordflow">if</span> ((i &gt;= 0) &amp;&amp; (i &lt;= 100))
<a name="l02613"></a>02613       { 
<a name="l02614"></a>02614          o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;tracelevel=i;
<a name="l02615"></a>02615       }
<a name="l02616"></a>02616     }
<a name="l02617"></a>02617    <span class="comment">// add ability to set it for a number of frames after which it reverts</span>
<a name="l02618"></a>02618    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;usbradio xdebug on tracelevel %i\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;tracelevel);
<a name="l02619"></a>02619 
<a name="l02620"></a>02620    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a7cc1753a05a0821f6c70dd2bccfbab5c">RESULT_SUCCESS</a>;
<a name="l02621"></a>02621 }
<a name="l02622"></a>02622 
<a name="l02623"></a>02623 
<a name="l02624"></a><a class="code" href="chan__usbradio_8c.html#a8bdc4215c34cacb12abbd2d540445a88">02624</a> <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="chan__usbradio_8c.html#a8bdc4215c34cacb12abbd2d540445a88">key_usage</a>[] =
<a name="l02625"></a>02625    <span class="stringliteral">&quot;Usage: radio key\n&quot;</span>
<a name="l02626"></a>02626    <span class="stringliteral">&quot;       Simulates COR active.\n&quot;</span>;
<a name="l02627"></a>02627 
<a name="l02628"></a><a class="code" href="chan__usbradio_8c.html#ac82d5ba3f1db8d07e14c3e2a44e06c0d">02628</a> <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="chan__usbradio_8c.html#ac82d5ba3f1db8d07e14c3e2a44e06c0d">unkey_usage</a>[] =
<a name="l02629"></a>02629    <span class="stringliteral">&quot;Usage: radio unkey\n&quot;</span>
<a name="l02630"></a>02630    <span class="stringliteral">&quot;       Simulates COR un-active.\n&quot;</span>;
<a name="l02631"></a>02631 
<a name="l02632"></a><a class="code" href="chan__usbradio_8c.html#a1f93dbb4b13a77a3ba6c085e2fa8e9e1">02632</a> <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="chan__usbradio_8c.html#a1f93dbb4b13a77a3ba6c085e2fa8e9e1">active_usage</a>[] =
<a name="l02633"></a>02633         <span class="stringliteral">&quot;Usage: radio active [device-name]\n&quot;</span>
<a name="l02634"></a>02634         <span class="stringliteral">&quot;       If used without a parameter, displays which device is the current\n&quot;</span>
<a name="l02635"></a>02635         <span class="stringliteral">&quot;one being commanded.  If a device is specified, the commanded radio device is changed\n&quot;</span>
<a name="l02636"></a>02636         <span class="stringliteral">&quot;to the device specified.\n&quot;</span>;
<a name="l02637"></a>02637 <span class="comment">/*</span>
<a name="l02638"></a>02638 <span class="comment">radio tune 6 3000    measured tx value</span>
<a name="l02639"></a>02639 <span class="comment">*/</span>
<a name="l02640"></a><a class="code" href="chan__usbradio_8c.html#a5081536d6f73314ba627ef498dfd9694">02640</a> <span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="chan__usbradio_8c.html#a5081536d6f73314ba627ef498dfd9694">radio_tune_usage</a>[] =
<a name="l02641"></a>02641    <span class="stringliteral">&quot;Usage: radio tune &lt;function&gt;\n&quot;</span>
<a name="l02642"></a>02642    <span class="stringliteral">&quot;       rxnoise\n&quot;</span>
<a name="l02643"></a>02643    <span class="stringliteral">&quot;       rxvoice\n&quot;</span>
<a name="l02644"></a>02644    <span class="stringliteral">&quot;       rxtone\n&quot;</span>
<a name="l02645"></a>02645    <span class="stringliteral">&quot;       rxsquelch [newsetting]\n&quot;</span>
<a name="l02646"></a>02646    <span class="stringliteral">&quot;       txvoice [newsetting]\n&quot;</span>
<a name="l02647"></a>02647    <span class="stringliteral">&quot;       txtone [newsetting]\n&quot;</span>
<a name="l02648"></a>02648    <span class="stringliteral">&quot;       auxvoice [newsetting]\n&quot;</span>
<a name="l02649"></a>02649    <span class="stringliteral">&quot;       save (settings to tuning file)\n&quot;</span>
<a name="l02650"></a>02650    <span class="stringliteral">&quot;       load (tuning settings from EEPROM)\n&quot;</span>
<a name="l02651"></a>02651    <span class="stringliteral">&quot;\n       All [newsetting]&apos;s are values 0-999\n\n&quot;</span>;
<a name="l02652"></a>02652                  
<a name="l02653"></a>02653 <span class="preprocessor">#ifndef  NEW_ASTERISK</span>
<a name="l02654"></a>02654 <span class="preprocessor"></span>
<a name="l02655"></a>02655 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a> <a class="code" href="chan__usbradio_8c.html#a80881fd2557d5d8ade6c66926b958cf3">cli_usbradio</a>[] = {
<a name="l02656"></a>02656    { { <span class="stringliteral">&quot;radio&quot;</span>, <span class="stringliteral">&quot;key&quot;</span>, NULL },
<a name="l02657"></a>02657    <a class="code" href="chan__usbradio_8c.html#aaf9f0b89166c9c97cdfdf91be3b56ad0">console_key</a>, <span class="stringliteral">&quot;Simulate Rx Signal Present&quot;</span>,
<a name="l02658"></a>02658    key_usage, NULL, NULL},
<a name="l02659"></a>02659 
<a name="l02660"></a>02660    { { <span class="stringliteral">&quot;radio&quot;</span>, <span class="stringliteral">&quot;unkey&quot;</span>, NULL },
<a name="l02661"></a>02661    <a class="code" href="chan__usbradio_8c.html#ad1564ccfbcf28ec9273f510493793545">console_unkey</a>, <span class="stringliteral">&quot;Simulate Rx Signal Lusb&quot;</span>,
<a name="l02662"></a>02662    unkey_usage, NULL, NULL },
<a name="l02663"></a>02663 
<a name="l02664"></a>02664    { { <span class="stringliteral">&quot;radio&quot;</span>, <span class="stringliteral">&quot;tune&quot;</span>, NULL },
<a name="l02665"></a>02665    <a class="code" href="chan__usbradio_8c.html#a5ec1e35fe999569ee78fcb9b035e235f">radio_tune</a>, <span class="stringliteral">&quot;Radio Tune&quot;</span>,
<a name="l02666"></a>02666    radio_tune_usage, NULL, NULL },
<a name="l02667"></a>02667 
<a name="l02668"></a>02668    { { <span class="stringliteral">&quot;radio&quot;</span>, <span class="stringliteral">&quot;set&quot;</span>, <span class="stringliteral">&quot;debug&quot;</span>, NULL },
<a name="l02669"></a>02669    <a class="code" href="chan__usbradio_8c.html#ad912cb21af19858d008bb8d4356b0f7b">radio_set_debug</a>, <span class="stringliteral">&quot;Radio Debug&quot;</span>,
<a name="l02670"></a>02670    radio_tune_usage, NULL, NULL },
<a name="l02671"></a>02671 
<a name="l02672"></a>02672    { { <span class="stringliteral">&quot;radio&quot;</span>, <span class="stringliteral">&quot;set&quot;</span>, <span class="stringliteral">&quot;debug&quot;</span>, <span class="stringliteral">&quot;off&quot;</span>, NULL },
<a name="l02673"></a>02673    <a class="code" href="chan__usbradio_8c.html#a637e38da389743f92b2152a27aa09d19">radio_set_debug_off</a>, <span class="stringliteral">&quot;Radio Debug&quot;</span>,
<a name="l02674"></a>02674    radio_tune_usage, NULL, NULL },
<a name="l02675"></a>02675 
<a name="l02676"></a>02676    { { <span class="stringliteral">&quot;radio&quot;</span>, <span class="stringliteral">&quot;active&quot;</span>, NULL },
<a name="l02677"></a>02677    <a class="code" href="chan__usbradio_8c.html#a51162f45e26983094b79f8a3aa07c3bf">radio_active</a>, <span class="stringliteral">&quot;Change commanded device&quot;</span>,
<a name="l02678"></a>02678    active_usage, NULL, NULL },
<a name="l02679"></a>02679 
<a name="l02680"></a>02680     { { <span class="stringliteral">&quot;radio&quot;</span>, <span class="stringliteral">&quot;set&quot;</span>, <span class="stringliteral">&quot;xdebug&quot;</span>, NULL },
<a name="l02681"></a>02681    <a class="code" href="chan__usbradio_8c.html#a23a2cbdf67c12b687b9d7c5fc2a8aa4f">radio_set_xpmr_debug</a>, <span class="stringliteral">&quot;Radio set xpmr debug level&quot;</span>,
<a name="l02682"></a>02682    active_usage, NULL, NULL },
<a name="l02683"></a>02683 
<a name="l02684"></a>02684 };
<a name="l02685"></a>02685 <span class="preprocessor">#endif</span>
<a name="l02686"></a>02686 <span class="preprocessor"></span>
<a name="l02687"></a>02687 <span class="comment">/*</span>
<a name="l02688"></a>02688 <span class="comment"> * store the callerid components</span>
<a name="l02689"></a>02689 <span class="comment"> */</span>
<a name="l02690"></a>02690 <span class="preprocessor">#if 0</span>
<a name="l02691"></a>02691 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__console_8c.html#afdcb335a1ef2c86fcca00495bfe72dfb">store_callerid</a>(<span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o, <span class="keywordtype">char</span> *s)
<a name="l02692"></a>02692 {
<a name="l02693"></a>02693    <a class="code" href="callerid_8h.html#af33ee38631fe79ab21d91bcd0634903a">ast_callerid_split</a>(s, o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a2916929201e1417f4ea335e9276aa382">cid_name</a>, <span class="keyword">sizeof</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a2916929201e1417f4ea335e9276aa382">cid_name</a>), o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a557b0d5a633c0a98162e973793689380">cid_num</a>, <span class="keyword">sizeof</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a557b0d5a633c0a98162e973793689380">cid_num</a>));
<a name="l02694"></a>02694 }
<a name="l02695"></a>02695 <span class="preprocessor">#endif</span>
<a name="l02696"></a>02696 <span class="preprocessor"></span>
<a name="l02697"></a><a class="code" href="chan__usbradio_8c.html#a507daf62d02dc2766c61acb1a6ab175e">02697</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__usbradio_8c.html#a507daf62d02dc2766c61acb1a6ab175e">store_rxdemod</a>(<span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o, <span class="keywordtype">char</span> *s)
<a name="l02698"></a>02698 {
<a name="l02699"></a>02699    <span class="keywordflow">if</span> (!strcasecmp(s,<span class="stringliteral">&quot;no&quot;</span>)){
<a name="l02700"></a>02700       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a192b610a400b0092bbf865fa8cd60a44">rxdemod</a> = <a class="code" href="chan__usbradio_8c.html#a83e8bc15645f9d99ab91a152bb3dc8cead172bb1b89a45791c6145692cf3b4fac">RX_AUDIO_NONE</a>;
<a name="l02701"></a>02701    }
<a name="l02702"></a>02702    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(s,<span class="stringliteral">&quot;speaker&quot;</span>)){
<a name="l02703"></a>02703       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a192b610a400b0092bbf865fa8cd60a44">rxdemod</a> = <a class="code" href="chan__usbradio_8c.html#a83e8bc15645f9d99ab91a152bb3dc8ceacceada590b9f7e7694e546550b0cba74">RX_AUDIO_SPEAKER</a>;
<a name="l02704"></a>02704    }
<a name="l02705"></a>02705    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(s,<span class="stringliteral">&quot;flat&quot;</span>)){
<a name="l02706"></a>02706          o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a192b610a400b0092bbf865fa8cd60a44">rxdemod</a> = <a class="code" href="chan__usbradio_8c.html#a83e8bc15645f9d99ab91a152bb3dc8cead2f329eb79309c5c7ed7ba7cec2681ff">RX_AUDIO_FLAT</a>;
<a name="l02707"></a>02707    }  
<a name="l02708"></a>02708    <span class="keywordflow">else</span> {
<a name="l02709"></a>02709       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,<span class="stringliteral">&quot;Unrecognized rxdemod parameter: %s\n&quot;</span>,s);
<a name="l02710"></a>02710    }
<a name="l02711"></a>02711 
<a name="l02712"></a>02712    <span class="comment">//ast_log(LOG_WARNING, &quot;set rxdemod = %s\n&quot;, s);</span>
<a name="l02713"></a>02713 }
<a name="l02714"></a>02714 
<a name="l02715"></a>02715                   
<a name="l02716"></a><a class="code" href="chan__usbradio_8c.html#a490b78b67aa6feb5d8cd410033446880">02716</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__usbradio_8c.html#a490b78b67aa6feb5d8cd410033446880">store_txmixa</a>(<span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o, <span class="keywordtype">char</span> *s)
<a name="l02717"></a>02717 {
<a name="l02718"></a>02718    <span class="keywordflow">if</span> (!strcasecmp(s,<span class="stringliteral">&quot;no&quot;</span>)){
<a name="l02719"></a>02719       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a95a57d28620e96b54f510eb9a543ddfc">txmixa</a> = <a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051ea93bd99aa973ca72a6d778f6acbde4799">TX_OUT_OFF</a>;
<a name="l02720"></a>02720    }
<a name="l02721"></a>02721    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(s,<span class="stringliteral">&quot;voice&quot;</span>)){
<a name="l02722"></a>02722       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a95a57d28620e96b54f510eb9a543ddfc">txmixa</a> = <a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051eaccdce3522c59395383ad570f8ee57acd">TX_OUT_VOICE</a>;
<a name="l02723"></a>02723    }
<a name="l02724"></a>02724    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(s,<span class="stringliteral">&quot;tone&quot;</span>)){
<a name="l02725"></a>02725          o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a95a57d28620e96b54f510eb9a543ddfc">txmixa</a> = <a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051ea10815a225284305f3f93416f07a85cb7">TX_OUT_LSD</a>;
<a name="l02726"></a>02726    }  
<a name="l02727"></a>02727    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(s,<span class="stringliteral">&quot;composite&quot;</span>)){
<a name="l02728"></a>02728       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a95a57d28620e96b54f510eb9a543ddfc">txmixa</a> = <a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051eaea61167af07104aee49cea1568e356ec">TX_OUT_COMPOSITE</a>;
<a name="l02729"></a>02729    }  
<a name="l02730"></a>02730    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(s,<span class="stringliteral">&quot;auxvoice&quot;</span>)){
<a name="l02731"></a>02731       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a95a57d28620e96b54f510eb9a543ddfc">txmixa</a> = <a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051ea40abd0b87cb8a3bd0d80c4732dad35e8">TX_OUT_AUX</a>;
<a name="l02732"></a>02732    }  
<a name="l02733"></a>02733    <span class="keywordflow">else</span> {
<a name="l02734"></a>02734       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,<span class="stringliteral">&quot;Unrecognized txmixa parameter: %s\n&quot;</span>,s);
<a name="l02735"></a>02735    }
<a name="l02736"></a>02736 
<a name="l02737"></a>02737    <span class="comment">//ast_log(LOG_WARNING, &quot;set txmixa = %s\n&quot;, s);</span>
<a name="l02738"></a>02738 }
<a name="l02739"></a>02739 
<a name="l02740"></a><a class="code" href="chan__usbradio_8c.html#a843f66782fe14dcda89ca7c98a4e1d7c">02740</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__usbradio_8c.html#a843f66782fe14dcda89ca7c98a4e1d7c">store_txmixb</a>(<span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o, <span class="keywordtype">char</span> *s)
<a name="l02741"></a>02741 {
<a name="l02742"></a>02742    <span class="keywordflow">if</span> (!strcasecmp(s,<span class="stringliteral">&quot;no&quot;</span>)){
<a name="l02743"></a>02743       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a6cf7fb2913ee1a3c50247dd8f6ea32a4">txmixb</a> = <a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051ea93bd99aa973ca72a6d778f6acbde4799">TX_OUT_OFF</a>;
<a name="l02744"></a>02744    }
<a name="l02745"></a>02745    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(s,<span class="stringliteral">&quot;voice&quot;</span>)){
<a name="l02746"></a>02746       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a6cf7fb2913ee1a3c50247dd8f6ea32a4">txmixb</a> = <a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051eaccdce3522c59395383ad570f8ee57acd">TX_OUT_VOICE</a>;
<a name="l02747"></a>02747    }
<a name="l02748"></a>02748    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(s,<span class="stringliteral">&quot;tone&quot;</span>)){
<a name="l02749"></a>02749          o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a6cf7fb2913ee1a3c50247dd8f6ea32a4">txmixb</a> = <a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051ea10815a225284305f3f93416f07a85cb7">TX_OUT_LSD</a>;
<a name="l02750"></a>02750    }  
<a name="l02751"></a>02751    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(s,<span class="stringliteral">&quot;composite&quot;</span>)){
<a name="l02752"></a>02752       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a6cf7fb2913ee1a3c50247dd8f6ea32a4">txmixb</a> = <a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051eaea61167af07104aee49cea1568e356ec">TX_OUT_COMPOSITE</a>;
<a name="l02753"></a>02753    }  
<a name="l02754"></a>02754    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(s,<span class="stringliteral">&quot;auxvoice&quot;</span>)){
<a name="l02755"></a>02755       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a6cf7fb2913ee1a3c50247dd8f6ea32a4">txmixb</a> = <a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051ea40abd0b87cb8a3bd0d80c4732dad35e8">TX_OUT_AUX</a>;
<a name="l02756"></a>02756    }  
<a name="l02757"></a>02757    <span class="keywordflow">else</span> {
<a name="l02758"></a>02758       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,<span class="stringliteral">&quot;Unrecognized txmixb parameter: %s\n&quot;</span>,s);
<a name="l02759"></a>02759    }
<a name="l02760"></a>02760 
<a name="l02761"></a>02761    <span class="comment">//ast_log(LOG_WARNING, &quot;set txmixb = %s\n&quot;, s);</span>
<a name="l02762"></a>02762 }
<a name="l02763"></a>02763 <span class="comment">/*</span>
<a name="l02764"></a>02764 <span class="comment">*/</span>
<a name="l02765"></a><a class="code" href="chan__usbradio_8c.html#a3e3b9084f6ebb46dbd10d5f7a16e8721">02765</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__usbradio_8c.html#a3e3b9084f6ebb46dbd10d5f7a16e8721">store_rxcdtype</a>(<span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o, <span class="keywordtype">char</span> *s)
<a name="l02766"></a>02766 {
<a name="l02767"></a>02767    <span class="keywordflow">if</span> (!strcasecmp(s,<span class="stringliteral">&quot;no&quot;</span>)){
<a name="l02768"></a>02768       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af7351b2441759672562708b11cd8fedd">rxcdtype</a> = <a class="code" href="chan__usbradio_8c.html#a68c01102755fc7d1c810bb0b0635fa90abe9a656b626b31aa9c2c6b9908b4ed28">CD_IGNORE</a>;
<a name="l02769"></a>02769    }
<a name="l02770"></a>02770    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(s,<span class="stringliteral">&quot;usb&quot;</span>)){
<a name="l02771"></a>02771       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af7351b2441759672562708b11cd8fedd">rxcdtype</a> = <a class="code" href="chan__usbradio_8c.html#a68c01102755fc7d1c810bb0b0635fa90a3decc0a04d3b0418061d3edffc567dbf">CD_HID</a>;
<a name="l02772"></a>02772    }
<a name="l02773"></a>02773    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(s,<span class="stringliteral">&quot;dsp&quot;</span>)){
<a name="l02774"></a>02774       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af7351b2441759672562708b11cd8fedd">rxcdtype</a> = <a class="code" href="chan__usbradio_8c.html#a68c01102755fc7d1c810bb0b0635fa90a458efb22943bcf8e0e9bb22290294ff2">CD_XPMR_NOISE</a>;
<a name="l02775"></a>02775    }  
<a name="l02776"></a>02776    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(s,<span class="stringliteral">&quot;vox&quot;</span>)){
<a name="l02777"></a>02777       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af7351b2441759672562708b11cd8fedd">rxcdtype</a> = <a class="code" href="chan__usbradio_8c.html#a68c01102755fc7d1c810bb0b0635fa90ac3d0b3b9bd7c9d801dd2d7a3f1434f2b">CD_XPMR_VOX</a>;
<a name="l02778"></a>02778    }  
<a name="l02779"></a>02779    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(s,<span class="stringliteral">&quot;usbinvert&quot;</span>)){
<a name="l02780"></a>02780       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af7351b2441759672562708b11cd8fedd">rxcdtype</a> = <a class="code" href="chan__usbradio_8c.html#a68c01102755fc7d1c810bb0b0635fa90a4e320acd2108cbf05d76b78fdc9afac1">CD_HID_INVERT</a>;
<a name="l02781"></a>02781    }  
<a name="l02782"></a>02782    <span class="keywordflow">else</span> {
<a name="l02783"></a>02783       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,<span class="stringliteral">&quot;Unrecognized rxcdtype parameter: %s\n&quot;</span>,s);
<a name="l02784"></a>02784    }
<a name="l02785"></a>02785 
<a name="l02786"></a>02786    <span class="comment">//ast_log(LOG_WARNING, &quot;set rxcdtype = %s\n&quot;, s);</span>
<a name="l02787"></a>02787 }
<a name="l02788"></a>02788 <span class="comment">/*</span>
<a name="l02789"></a>02789 <span class="comment">*/</span>
<a name="l02790"></a><a class="code" href="chan__usbradio_8c.html#ac00edc4c0d47cbdace004f50907f4f4d">02790</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__usbradio_8c.html#ac00edc4c0d47cbdace004f50907f4f4d">store_rxsdtype</a>(<span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o, <span class="keywordtype">char</span> *s)
<a name="l02791"></a>02791 {
<a name="l02792"></a>02792    <span class="keywordflow">if</span> (!strcasecmp(s,<span class="stringliteral">&quot;no&quot;</span>) || !strcasecmp(s,<span class="stringliteral">&quot;SD_IGNORE&quot;</span>)){
<a name="l02793"></a>02793       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#aeb14af6032352ae6255ee5a59bd10d55">rxsdtype</a> = <a class="code" href="chan__usbradio_8c.html#aa618c4d8c29ef4efe6f10c741fb1f47aa3ba1200323ee3d30a468da96d71653c3">SD_IGNORE</a>;
<a name="l02794"></a>02794    }
<a name="l02795"></a>02795    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(s,<span class="stringliteral">&quot;usb&quot;</span>) || !strcasecmp(s,<span class="stringliteral">&quot;SD_HID&quot;</span>)){
<a name="l02796"></a>02796       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#aeb14af6032352ae6255ee5a59bd10d55">rxsdtype</a> = <a class="code" href="chan__usbradio_8c.html#aa618c4d8c29ef4efe6f10c741fb1f47aa7bd439426427f9eefd076a49b04e6ea7">SD_HID</a>;
<a name="l02797"></a>02797    }
<a name="l02798"></a>02798    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(s,<span class="stringliteral">&quot;usbinvert&quot;</span>) || !strcasecmp(s,<span class="stringliteral">&quot;SD_HID_INVERT&quot;</span>)){
<a name="l02799"></a>02799       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#aeb14af6032352ae6255ee5a59bd10d55">rxsdtype</a> = <a class="code" href="chan__usbradio_8c.html#aa618c4d8c29ef4efe6f10c741fb1f47aa3a5d0d2435fca1bac96577cf151cf27b">SD_HID_INVERT</a>;
<a name="l02800"></a>02800    }  
<a name="l02801"></a>02801    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(s,<span class="stringliteral">&quot;software&quot;</span>) || !strcasecmp(s,<span class="stringliteral">&quot;SD_XPMR&quot;</span>)){
<a name="l02802"></a>02802       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#aeb14af6032352ae6255ee5a59bd10d55">rxsdtype</a> = <a class="code" href="chan__usbradio_8c.html#aa618c4d8c29ef4efe6f10c741fb1f47aa8f2a8e795ef07b87cc9888c160e04b2f">SD_XPMR</a>;
<a name="l02803"></a>02803    }  
<a name="l02804"></a>02804    <span class="keywordflow">else</span> {
<a name="l02805"></a>02805       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,<span class="stringliteral">&quot;Unrecognized rxsdtype parameter: %s\n&quot;</span>,s);
<a name="l02806"></a>02806    }
<a name="l02807"></a>02807 
<a name="l02808"></a>02808    <span class="comment">//ast_log(LOG_WARNING, &quot;set rxsdtype = %s\n&quot;, s);</span>
<a name="l02809"></a>02809 }
<a name="l02810"></a>02810 <span class="comment">/*</span>
<a name="l02811"></a>02811 <span class="comment">*/</span>
<a name="l02812"></a><a class="code" href="chan__usbradio_8c.html#af2c1073c647c203be290e7473e8b6610">02812</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__usbradio_8c.html#af2c1073c647c203be290e7473e8b6610">store_rxgain</a>(<span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o, <span class="keywordtype">char</span> *s)
<a name="l02813"></a>02813 {
<a name="l02814"></a>02814    <span class="keywordtype">float</span> <a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l02815"></a>02815    sscanf(s, <span class="stringliteral">&quot;%30f&quot;</span>, &amp;f); 
<a name="l02816"></a>02816    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#aeebb464c72892c9f3ddafed5ade720ee">rxgain</a> = f;
<a name="l02817"></a>02817    <span class="comment">//ast_log(LOG_WARNING, &quot;set rxgain = %f\n&quot;, f);</span>
<a name="l02818"></a>02818 }
<a name="l02819"></a>02819 <span class="comment">/*</span>
<a name="l02820"></a>02820 <span class="comment">*/</span>
<a name="l02821"></a><a class="code" href="chan__usbradio_8c.html#afa72be179ff3f7bba9433c7d2c8e26b3">02821</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__usbradio_8c.html#afa72be179ff3f7bba9433c7d2c8e26b3">store_rxvoiceadj</a>(<span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o, <span class="keywordtype">char</span> *s)
<a name="l02822"></a>02822 {
<a name="l02823"></a>02823    <span class="keywordtype">float</span> <a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l02824"></a>02824    sscanf(s, <span class="stringliteral">&quot;%30f&quot;</span>, &amp;f);
<a name="l02825"></a>02825    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0d9da32dc6edbbd18f90722056331b65">rxvoiceadj</a> = f;
<a name="l02826"></a>02826    <span class="comment">//ast_log(LOG_WARNING, &quot;set rxvoiceadj = %f\n&quot;, f);</span>
<a name="l02827"></a>02827 }
<a name="l02828"></a>02828 <span class="comment">/*</span>
<a name="l02829"></a>02829 <span class="comment">*/</span>
<a name="l02830"></a><a class="code" href="chan__usbradio_8c.html#ab4beef9a9d6b261e45d685e178bbe790">02830</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__usbradio_8c.html#ab4beef9a9d6b261e45d685e178bbe790">store_rxctcssadj</a>(<span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o, <span class="keywordtype">char</span> *s)
<a name="l02831"></a>02831 {
<a name="l02832"></a>02832    <span class="keywordtype">float</span> <a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l02833"></a>02833    sscanf(s, <span class="stringliteral">&quot;%30f&quot;</span>, &amp;f);
<a name="l02834"></a>02834    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0da461807e1a48746fd856ae6aa21499">rxctcssadj</a> = f;
<a name="l02835"></a>02835    <span class="comment">//ast_log(LOG_WARNING, &quot;set rxctcssadj = %f\n&quot;, f);</span>
<a name="l02836"></a>02836 }
<a name="l02837"></a>02837 <span class="comment">/*</span>
<a name="l02838"></a>02838 <span class="comment">*/</span>
<a name="l02839"></a><a class="code" href="chan__usbradio_8c.html#a6f6ab3f8ae560feac63fefa24e84c46b">02839</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__usbradio_8c.html#a6f6ab3f8ae560feac63fefa24e84c46b">store_txtoctype</a>(<span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o, <span class="keywordtype">char</span> *s)
<a name="l02840"></a>02840 {
<a name="l02841"></a>02841    <span class="keywordflow">if</span> (!strcasecmp(s,<span class="stringliteral">&quot;no&quot;</span>) || !strcasecmp(s,<span class="stringliteral">&quot;TOC_NONE&quot;</span>)){
<a name="l02842"></a>02842       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a543f5a1359459a66235d463f755245e3">txtoctype</a> = <a class="code" href="chan__usbradio_8c.html#a79e9f285d34216706a748fd7ba8941b7a22a2e6eabfd060ff0c88d05f654a1649">TOC_NONE</a>;
<a name="l02843"></a>02843    }
<a name="l02844"></a>02844    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(s,<span class="stringliteral">&quot;phase&quot;</span>) || !strcasecmp(s,<span class="stringliteral">&quot;TOC_PHASE&quot;</span>)){
<a name="l02845"></a>02845       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a543f5a1359459a66235d463f755245e3">txtoctype</a> = <a class="code" href="chan__usbradio_8c.html#a79e9f285d34216706a748fd7ba8941b7ad031f6177bb928acd65b32177c84f14a">TOC_PHASE</a>;
<a name="l02846"></a>02846    }
<a name="l02847"></a>02847    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(s,<span class="stringliteral">&quot;notone&quot;</span>) || !strcasecmp(s,<span class="stringliteral">&quot;TOC_NOTONE&quot;</span>)){
<a name="l02848"></a>02848       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a543f5a1359459a66235d463f755245e3">txtoctype</a> = <a class="code" href="chan__usbradio_8c.html#a79e9f285d34216706a748fd7ba8941b7a0dff75ff110b842fa3575e1ad2118a96">TOC_NOTONE</a>;
<a name="l02849"></a>02849    }  
<a name="l02850"></a>02850    <span class="keywordflow">else</span> {
<a name="l02851"></a>02851       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,<span class="stringliteral">&quot;Unrecognized txtoctype parameter: %s\n&quot;</span>,s);
<a name="l02852"></a>02852    }
<a name="l02853"></a>02853 }
<a name="l02854"></a>02854 <span class="comment">/*</span>
<a name="l02855"></a>02855 <span class="comment">*/</span>
<a name="l02856"></a><a class="code" href="chan__usbradio_8c.html#a24df517f036903ee52d886a2fef0d1c8">02856</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__usbradio_8c.html#a24df517f036903ee52d886a2fef0d1c8">tune_txoutput</a>(<span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o, <span class="keywordtype">int</span> value, <span class="keywordtype">int</span> fd)
<a name="l02857"></a>02857 {
<a name="l02858"></a>02858    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a633a737f50a6fd3c20783e59ada69952">txtestkey</a>=1;
<a name="l02859"></a>02859    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;txPttIn=1;
<a name="l02860"></a>02860    TxTestTone(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>, 1);   <span class="comment">// generate 1KHz tone at 7200 peak</span>
<a name="l02861"></a>02861    <span class="keywordflow">if</span> (fd &gt; 0) <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;Tone output starting on channel %s...\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l02862"></a>02862    usleep(5000000);
<a name="l02863"></a>02863    TxTestTone(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>, 0);
<a name="l02864"></a>02864    <span class="keywordflow">if</span> (fd &gt; 0) <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;Tone output ending on channel %s...\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l02865"></a>02865    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;txPttIn=0;
<a name="l02866"></a>02866    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a633a737f50a6fd3c20783e59ada69952">txtestkey</a>=0;
<a name="l02867"></a>02867 }
<a name="l02868"></a>02868 <span class="comment">/*</span>
<a name="l02869"></a>02869 <span class="comment">*/</span>
<a name="l02870"></a><a class="code" href="chan__usbradio_8c.html#a64be783c23515f787fb2b093c2fce542">02870</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__usbradio_8c.html#a64be783c23515f787fb2b093c2fce542">tune_rxinput</a>(<span class="keywordtype">int</span> fd, <span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o)
<a name="l02871"></a>02871 {
<a name="l02872"></a>02872    <span class="keyword">const</span> <span class="keywordtype">int</span> target=23000;
<a name="l02873"></a>02873    <span class="keyword">const</span> <span class="keywordtype">int</span> tolerance=2000;
<a name="l02874"></a>02874    <span class="keyword">const</span> <span class="keywordtype">int</span> settingmin=1;
<a name="l02875"></a>02875    <span class="keyword">const</span> <span class="keywordtype">int</span> settingstart=2;
<a name="l02876"></a>02876    <span class="keyword">const</span> <span class="keywordtype">int</span> maxtries=12;
<a name="l02877"></a>02877 
<a name="l02878"></a>02878    <span class="keywordtype">float</span> settingmax;
<a name="l02879"></a>02879    
<a name="l02880"></a>02880    <span class="keywordtype">int</span> setting=0, tries=0, tmpdiscfactor, meas;
<a name="l02881"></a>02881    <span class="keywordtype">int</span> tunetype=0;
<a name="l02882"></a>02882 
<a name="l02883"></a>02883    settingmax = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ad73045328563e3ea5f9fbc8c3ce9ad09">micmax</a>;
<a name="l02884"></a>02884 
<a name="l02885"></a>02885    <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;rxDemod)tunetype=1;
<a name="l02886"></a>02886    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;b.tuning=1;
<a name="l02887"></a>02887 
<a name="l02888"></a>02888    setting = settingstart;
<a name="l02889"></a>02889 
<a name="l02890"></a>02890     <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;tune rxnoise maxtries=%i, target=%i, tolerance=%i\n&quot;</span>,maxtries,target,tolerance);
<a name="l02891"></a>02891 
<a name="l02892"></a>02892    <span class="keywordflow">while</span>(tries&lt;maxtries)
<a name="l02893"></a>02893    {
<a name="l02894"></a>02894       <a class="code" href="chan__usbradio_8c.html#a05443895be85616649ab5c6e76f8f241">setamixer</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a7d942ce6a2ddec93dc13684d61b1750d">devicenum</a>,<a class="code" href="chan__usbradio_8c.html#acdbe8da16d20178447b63f536bf8b9f9">MIXER_PARAM_MIC_CAPTURE_VOL</a>,setting,0);
<a name="l02895"></a>02895       <a class="code" href="chan__usbradio_8c.html#a05443895be85616649ab5c6e76f8f241">setamixer</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a7d942ce6a2ddec93dc13684d61b1750d">devicenum</a>,<a class="code" href="chan__usbradio_8c.html#a99390fc3e67665c7b237060a74bff67c">MIXER_PARAM_MIC_BOOST</a>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a2c9642c08c9342104a689c6bacff9160">rxboostset</a>,0);
<a name="l02896"></a>02896        
<a name="l02897"></a>02897       usleep(100000);
<a name="l02898"></a>02898       <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af7351b2441759672562708b11cd8fedd">rxcdtype</a>!=<a class="code" href="chan__usbradio_8c.html#a68c01102755fc7d1c810bb0b0635fa90a458efb22943bcf8e0e9bb22290294ff2">CD_XPMR_NOISE</a> || o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a192b610a400b0092bbf865fa8cd60a44">rxdemod</a>==<a class="code" href="chan__usbradio_8c.html#a83e8bc15645f9d99ab91a152bb3dc8ceacceada590b9f7e7694e546550b0cba74">RX_AUDIO_SPEAKER</a>) 
<a name="l02899"></a>02899       {
<a name="l02900"></a>02900          <span class="comment">// printf(&quot;Measure Direct Input\n&quot;);</span>
<a name="l02901"></a>02901          o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;spsMeasure-&gt;source = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;spsRx-&gt;source;
<a name="l02902"></a>02902          o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;spsMeasure-&gt;discfactor=2000;
<a name="l02903"></a>02903          o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;spsMeasure-&gt;enabled=1;
<a name="l02904"></a>02904          o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;spsMeasure-&gt;amax = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;spsMeasure-&gt;amin = 0;
<a name="l02905"></a>02905          usleep(400000);   
<a name="l02906"></a>02906          meas=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;spsMeasure-&gt;apeak;
<a name="l02907"></a>02907          o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;spsMeasure-&gt;enabled=0;  
<a name="l02908"></a>02908       }
<a name="l02909"></a>02909       <span class="keywordflow">else</span>
<a name="l02910"></a>02910       {
<a name="l02911"></a>02911          <span class="comment">// printf(&quot;Measure HF Noise\n&quot;);</span>
<a name="l02912"></a>02912          tmpdiscfactor=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;spsRx-&gt;discfactor;
<a name="l02913"></a>02913          o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;spsRx-&gt;discfactor=(i16)2000;
<a name="l02914"></a>02914          o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;spsRx-&gt;discounteru=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;spsRx-&gt;discounterl=0;
<a name="l02915"></a>02915          o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;spsRx-&gt;amax=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;spsRx-&gt;amin=0;
<a name="l02916"></a>02916          usleep(200000);
<a name="l02917"></a>02917          meas=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;rxRssi;
<a name="l02918"></a>02918          o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;spsRx-&gt;discfactor=tmpdiscfactor;
<a name="l02919"></a>02919          o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;spsRx-&gt;discounteru=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;spsRx-&gt;discounterl=0;
<a name="l02920"></a>02920          o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;spsRx-&gt;amax=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;spsRx-&gt;amin=0;
<a name="l02921"></a>02921       }
<a name="l02922"></a>02922         <span class="keywordflow">if</span>(!meas)meas++;
<a name="l02923"></a>02923       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;tries=%i, setting=%i, meas=%i\n&quot;</span>,tries,setting,meas);
<a name="l02924"></a>02924 
<a name="l02925"></a>02925       <span class="keywordflow">if</span>( meas&lt;(target-tolerance) || meas&gt;(target+tolerance) || tries&lt;3){
<a name="l02926"></a>02926          setting=setting*target/meas;
<a name="l02927"></a>02927       }
<a name="l02928"></a>02928       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(tries&gt;4 &amp;&amp; meas&gt;(target-tolerance) &amp;&amp; meas&lt;(target+tolerance) )
<a name="l02929"></a>02929       {
<a name="l02930"></a>02930          <span class="keywordflow">break</span>;
<a name="l02931"></a>02931       }
<a name="l02932"></a>02932 
<a name="l02933"></a>02933       <span class="keywordflow">if</span>(setting&lt;settingmin)setting=settingmin;
<a name="l02934"></a>02934       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(setting&gt;settingmax)setting=settingmax;
<a name="l02935"></a>02935 
<a name="l02936"></a>02936       tries++;
<a name="l02937"></a>02937    }
<a name="l02938"></a>02938    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;DONE tries=%i, setting=%i, meas=%i\n&quot;</span>,tries,
<a name="l02939"></a>02939       (setting * 1000) / o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ad73045328563e3ea5f9fbc8c3ce9ad09">micmax</a>,meas);
<a name="l02940"></a>02940    <span class="keywordflow">if</span>( meas&lt;(target-tolerance) || meas&gt;(target+tolerance) ){
<a name="l02941"></a>02941       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;ERROR: RX INPUT ADJUST FAILED.\n&quot;</span>);
<a name="l02942"></a>02942    }<span class="keywordflow">else</span>{
<a name="l02943"></a>02943       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;INFO: RX INPUT ADJUST SUCCESS.\n&quot;</span>); 
<a name="l02944"></a>02944       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a959ccc7bd4988d55f4115fd5b13e236e">rxmixerset</a>=(setting * 1000) / o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ad73045328563e3ea5f9fbc8c3ce9ad09">micmax</a>;
<a name="l02945"></a>02945    }
<a name="l02946"></a>02946    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;b.tuning=0;
<a name="l02947"></a>02947 }
<a name="l02948"></a>02948 <span class="comment">/*</span>
<a name="l02949"></a>02949 <span class="comment">*/</span>
<a name="l02950"></a><a class="code" href="chan__usbradio_8c.html#a888766fbac96eab38b64ab7d04c6d1e1">02950</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__usbradio_8c.html#a888766fbac96eab38b64ab7d04c6d1e1">tune_rxvoice</a>(<span class="keywordtype">int</span> fd, <span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o)
<a name="l02951"></a>02951 {
<a name="l02952"></a>02952    <span class="keyword">const</span> <span class="keywordtype">int</span> target=7200;           <span class="comment">// peak</span>
<a name="l02953"></a>02953    <span class="keyword">const</span> <span class="keywordtype">int</span> tolerance=360;            <span class="comment">// peak to peak</span>
<a name="l02954"></a>02954    <span class="keyword">const</span> <span class="keywordtype">float</span> settingmin=0.1;
<a name="l02955"></a>02955    <span class="keyword">const</span> <span class="keywordtype">float</span> settingmax=4;
<a name="l02956"></a>02956    <span class="keyword">const</span> <span class="keywordtype">float</span> settingstart=1;
<a name="l02957"></a>02957    <span class="keyword">const</span> <span class="keywordtype">int</span> maxtries=12;
<a name="l02958"></a>02958 
<a name="l02959"></a>02959    <span class="keywordtype">float</span> setting;
<a name="l02960"></a>02960 
<a name="l02961"></a>02961    <span class="keywordtype">int</span> tries=0, meas;
<a name="l02962"></a>02962 
<a name="l02963"></a>02963    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;INFO: RX VOICE ADJUST START.\n&quot;</span>);   
<a name="l02964"></a>02964    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;target=%i tolerance=%i \n&quot;</span>,target,tolerance);
<a name="l02965"></a>02965 
<a name="l02966"></a>02966    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;b.tuning=1;
<a name="l02967"></a>02967    <span class="keywordflow">if</span>(!o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;spsMeasure)
<a name="l02968"></a>02968       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;ERROR: NO MEASURE BLOCK.\n&quot;</span>);
<a name="l02969"></a>02969 
<a name="l02970"></a>02970    <span class="keywordflow">if</span>(!o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;spsMeasure-&gt;source || !o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;prxVoiceAdjust )
<a name="l02971"></a>02971       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;ERROR: NO SOURCE OR MEASURE SETTING.\n&quot;</span>);
<a name="l02972"></a>02972 
<a name="l02973"></a>02973    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;spsMeasure-&gt;source=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;spsRxOut-&gt;sink;
<a name="l02974"></a>02974    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;spsMeasure-&gt;enabled=1;
<a name="l02975"></a>02975    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;spsMeasure-&gt;discfactor=1000;
<a name="l02976"></a>02976    
<a name="l02977"></a>02977    setting=settingstart;
<a name="l02978"></a>02978 
<a name="l02979"></a>02979    <span class="comment">// ast_cli(fd,&quot;ERROR: NO MEASURE BLOCK.\n&quot;);</span>
<a name="l02980"></a>02980 
<a name="l02981"></a>02981    <span class="keywordflow">while</span>(tries&lt;maxtries)
<a name="l02982"></a>02982    {
<a name="l02983"></a>02983       *(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;prxVoiceAdjust)=setting*M_Q8;
<a name="l02984"></a>02984       usleep(10000);
<a name="l02985"></a>02985       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;spsMeasure-&gt;amax = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;spsMeasure-&gt;amin = 0;
<a name="l02986"></a>02986       usleep(1000000);
<a name="l02987"></a>02987       meas = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;spsMeasure-&gt;apeak;
<a name="l02988"></a>02988       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;tries=%i, setting=%f, meas=%i\n&quot;</span>,tries,setting,meas);
<a name="l02989"></a>02989 
<a name="l02990"></a>02990       <span class="keywordflow">if</span>( meas&lt;(target-tolerance) || meas&gt;(target+tolerance) || tries&lt;3){
<a name="l02991"></a>02991          setting=setting*target/meas;
<a name="l02992"></a>02992       }
<a name="l02993"></a>02993       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(tries&gt;4 &amp;&amp; meas&gt;(target-tolerance) &amp;&amp; meas&lt;(target+tolerance) )
<a name="l02994"></a>02994       {
<a name="l02995"></a>02995          <span class="keywordflow">break</span>;
<a name="l02996"></a>02996       }
<a name="l02997"></a>02997       <span class="keywordflow">if</span>(setting&lt;settingmin)setting=settingmin;
<a name="l02998"></a>02998       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(setting&gt;settingmax)setting=settingmax;
<a name="l02999"></a>02999 
<a name="l03000"></a>03000       tries++;
<a name="l03001"></a>03001    }
<a name="l03002"></a>03002 
<a name="l03003"></a>03003    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;spsMeasure-&gt;enabled=0;
<a name="l03004"></a>03004 
<a name="l03005"></a>03005    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;DONE tries=%i, setting=%f, meas=%f\n&quot;</span>,tries,setting,(<span class="keywordtype">float</span>)meas);
<a name="l03006"></a>03006    <span class="keywordflow">if</span>( meas&lt;(target-tolerance) || meas&gt;(target+tolerance) ){
<a name="l03007"></a>03007       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;ERROR: RX VOICE GAIN ADJUST FAILED.\n&quot;</span>);
<a name="l03008"></a>03008    }<span class="keywordflow">else</span>{
<a name="l03009"></a>03009       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;INFO: RX VOICE GAIN ADJUST SUCCESS.\n&quot;</span>);
<a name="l03010"></a>03010       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0d9da32dc6edbbd18f90722056331b65">rxvoiceadj</a>=setting;
<a name="l03011"></a>03011    }
<a name="l03012"></a>03012    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;b.tuning=0;
<a name="l03013"></a>03013 }
<a name="l03014"></a>03014 <span class="comment">/*</span>
<a name="l03015"></a>03015 <span class="comment">*/</span>
<a name="l03016"></a><a class="code" href="chan__usbradio_8c.html#a1e5dd762108ebc90c351cd91991aa3ad">03016</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__usbradio_8c.html#a1e5dd762108ebc90c351cd91991aa3ad">tune_rxctcss</a>(<span class="keywordtype">int</span> fd, <span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o)
<a name="l03017"></a>03017 {
<a name="l03018"></a>03018    <span class="keyword">const</span> <span class="keywordtype">int</span> target=2400;      <span class="comment">// was 4096 pre 20080205</span>
<a name="l03019"></a>03019    <span class="keyword">const</span> <span class="keywordtype">int</span> tolerance=100;
<a name="l03020"></a>03020    <span class="keyword">const</span> <span class="keywordtype">float</span> settingmin=0.1;
<a name="l03021"></a>03021    <span class="keyword">const</span> <span class="keywordtype">float</span> settingmax=8;
<a name="l03022"></a>03022    <span class="keyword">const</span> <span class="keywordtype">float</span> settingstart=1;
<a name="l03023"></a>03023    <span class="keyword">const</span> <span class="keywordtype">int</span> maxtries=12;
<a name="l03024"></a>03024 
<a name="l03025"></a>03025    <span class="keywordtype">float</span> setting;
<a name="l03026"></a>03026    <span class="keywordtype">int</span> tries=0, meas;
<a name="l03027"></a>03027 
<a name="l03028"></a>03028    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;INFO: RX CTCSS ADJUST START.\n&quot;</span>);   
<a name="l03029"></a>03029    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;target=%i tolerance=%i \n&quot;</span>,target,tolerance);
<a name="l03030"></a>03030 
<a name="l03031"></a>03031    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;b.tuning=1;
<a name="l03032"></a>03032    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;spsMeasure-&gt;source=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;prxCtcssMeasure;
<a name="l03033"></a>03033    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;spsMeasure-&gt;discfactor=400;
<a name="l03034"></a>03034    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;spsMeasure-&gt;enabled=1;
<a name="l03035"></a>03035 
<a name="l03036"></a>03036    setting=settingstart;
<a name="l03037"></a>03037 
<a name="l03038"></a>03038    <span class="keywordflow">while</span>(tries&lt;maxtries)
<a name="l03039"></a>03039    {
<a name="l03040"></a>03040       *(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;prxCtcssAdjust)=setting*M_Q8;
<a name="l03041"></a>03041       usleep(10000);
<a name="l03042"></a>03042       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;spsMeasure-&gt;amax = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;spsMeasure-&gt;amin = 0;
<a name="l03043"></a>03043       usleep(500000);
<a name="l03044"></a>03044       meas = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;spsMeasure-&gt;apeak;
<a name="l03045"></a>03045       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;tries=%i, setting=%f, meas=%i\n&quot;</span>,tries,setting,meas);
<a name="l03046"></a>03046 
<a name="l03047"></a>03047       <span class="keywordflow">if</span>( meas&lt;(target-tolerance) || meas&gt;(target+tolerance) || tries&lt;3){
<a name="l03048"></a>03048          setting=setting*target/meas;
<a name="l03049"></a>03049       }
<a name="l03050"></a>03050       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(tries&gt;4 &amp;&amp; meas&gt;(target-tolerance) &amp;&amp; meas&lt;(target+tolerance) )
<a name="l03051"></a>03051       {
<a name="l03052"></a>03052          <span class="keywordflow">break</span>;
<a name="l03053"></a>03053       }
<a name="l03054"></a>03054       <span class="keywordflow">if</span>(setting&lt;settingmin)setting=settingmin;
<a name="l03055"></a>03055       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(setting&gt;settingmax)setting=settingmax;
<a name="l03056"></a>03056 
<a name="l03057"></a>03057       tries++;
<a name="l03058"></a>03058    }
<a name="l03059"></a>03059    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;spsMeasure-&gt;enabled=0;
<a name="l03060"></a>03060    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;DONE tries=%i, setting=%f, meas=%f\n&quot;</span>,tries,setting,(<span class="keywordtype">float</span>)meas);
<a name="l03061"></a>03061    <span class="keywordflow">if</span>( meas&lt;(target-tolerance) || meas&gt;(target+tolerance) ){
<a name="l03062"></a>03062       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;ERROR: RX CTCSS GAIN ADJUST FAILED.\n&quot;</span>);
<a name="l03063"></a>03063    }<span class="keywordflow">else</span>{
<a name="l03064"></a>03064       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd,<span class="stringliteral">&quot;INFO: RX CTCSS GAIN ADJUST SUCCESS.\n&quot;</span>);
<a name="l03065"></a>03065       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0da461807e1a48746fd856ae6aa21499">rxctcssadj</a>=setting;
<a name="l03066"></a>03066    }
<a name="l03067"></a>03067    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;b.tuning=0;
<a name="l03068"></a>03068 }
<a name="l03069"></a>03069 <span class="comment">/*</span>
<a name="l03070"></a>03070 <span class="comment">   after radio tune is performed data is serialized here </span>
<a name="l03071"></a>03071 <span class="comment">*/</span>
<a name="l03072"></a><a class="code" href="chan__usbradio_8c.html#a7a5f435c891a0ebe13436cf941515a76">03072</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__usbradio_8c.html#a7a5f435c891a0ebe13436cf941515a76">tune_write</a>(<span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o)
<a name="l03073"></a>03073 {
<a name="l03074"></a>03074    FILE *fp;
<a name="l03075"></a>03075    <span class="keywordtype">char</span> fname[200];
<a name="l03076"></a>03076 
<a name="l03077"></a>03077    snprintf(fname,<span class="keyword">sizeof</span>(fname) - 1,<span class="stringliteral">&quot;/etc/asterisk/usbradio_tune_%s.conf&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l03078"></a>03078    fp = fopen(fname,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l03079"></a>03079 
<a name="l03080"></a>03080    fprintf(fp,<span class="stringliteral">&quot;[%s]\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l03081"></a>03081 
<a name="l03082"></a>03082    fprintf(fp,<span class="stringliteral">&quot;; name=%s\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l03083"></a>03083    fprintf(fp,<span class="stringliteral">&quot;; devicenum=%i\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a7d942ce6a2ddec93dc13684d61b1750d">devicenum</a>);
<a name="l03084"></a>03084    fprintf(fp,<span class="stringliteral">&quot;devstr=%s\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ae0013a0ec03c2c35c2966c6aa3147abd">devstr</a>);
<a name="l03085"></a>03085    fprintf(fp,<span class="stringliteral">&quot;rxmixerset=%i\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a959ccc7bd4988d55f4115fd5b13e236e">rxmixerset</a>);
<a name="l03086"></a>03086    fprintf(fp,<span class="stringliteral">&quot;txmixaset=%i\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5dca179fe41743d80bd66e6a21de9fac">txmixaset</a>);
<a name="l03087"></a>03087    fprintf(fp,<span class="stringliteral">&quot;txmixbset=%i\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac2c2424ad6a5ca0a0c6f7026e74d7701">txmixbset</a>);
<a name="l03088"></a>03088    fprintf(fp,<span class="stringliteral">&quot;rxvoiceadj=%f\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0d9da32dc6edbbd18f90722056331b65">rxvoiceadj</a>);
<a name="l03089"></a>03089    fprintf(fp,<span class="stringliteral">&quot;rxctcssadj=%f\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0da461807e1a48746fd856ae6aa21499">rxctcssadj</a>);
<a name="l03090"></a>03090    fprintf(fp,<span class="stringliteral">&quot;txctcssadj=%i\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af559c722569892f0612ff5c65493fe7a">txctcssadj</a>);
<a name="l03091"></a>03091    fprintf(fp,<span class="stringliteral">&quot;rxsquelchadj=%i\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a1745424fe0dd99b7d3a778a253a5d686">rxsquelchadj</a>);
<a name="l03092"></a>03092    fclose(fp);
<a name="l03093"></a>03093 
<a name="l03094"></a>03094    <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ae6df055b2352a39c3f2f781a17c6ba62">wanteeprom</a>)
<a name="l03095"></a>03095    {
<a name="l03096"></a>03096       <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0cb029a4ba4ae628b6f5431a4cbb753f">eepromlock</a>);
<a name="l03097"></a>03097       <span class="keywordflow">while</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#aa4c4270e4903db2dcb2ee7e3a7966ca3">eepromctl</a>)
<a name="l03098"></a>03098       {
<a name="l03099"></a>03099          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0cb029a4ba4ae628b6f5431a4cbb753f">eepromlock</a>);
<a name="l03100"></a>03100          usleep(10000);
<a name="l03101"></a>03101          <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0cb029a4ba4ae628b6f5431a4cbb753f">eepromlock</a>);
<a name="l03102"></a>03102       }
<a name="l03103"></a>03103       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac31262f80afbd912435464107e0d054d">eeprom</a>[<a class="code" href="chan__usbradio_8c.html#ad366055db4b38c2d08fa4773bec2d17a">EEPROM_RXMIXERSET</a>] = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a959ccc7bd4988d55f4115fd5b13e236e">rxmixerset</a>;
<a name="l03104"></a>03104       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac31262f80afbd912435464107e0d054d">eeprom</a>[<a class="code" href="chan__usbradio_8c.html#a93f87606ce71cf06fc9469404bcd2f8e">EEPROM_TXMIXASET</a>] = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5dca179fe41743d80bd66e6a21de9fac">txmixaset</a>;
<a name="l03105"></a>03105       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac31262f80afbd912435464107e0d054d">eeprom</a>[<a class="code" href="chan__usbradio_8c.html#a439cb7d09b0d38aa956758d174935074">EEPROM_TXMIXBSET</a>] = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac2c2424ad6a5ca0a0c6f7026e74d7701">txmixbset</a>;
<a name="l03106"></a>03106       memcpy(&amp;o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac31262f80afbd912435464107e0d054d">eeprom</a>[<a class="code" href="chan__usbradio_8c.html#a7d5f33700253c5914fac418bde3482b7">EEPROM_RXVOICEADJ</a>],&amp;o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0d9da32dc6edbbd18f90722056331b65">rxvoiceadj</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));
<a name="l03107"></a>03107       memcpy(&amp;o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac31262f80afbd912435464107e0d054d">eeprom</a>[<a class="code" href="chan__usbradio_8c.html#a15e2375389dc1811e52506c4cea0fd6d">EEPROM_RXCTCSSADJ</a>],&amp;o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0da461807e1a48746fd856ae6aa21499">rxctcssadj</a>,<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>));
<a name="l03108"></a>03108       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac31262f80afbd912435464107e0d054d">eeprom</a>[<a class="code" href="chan__usbradio_8c.html#a23c8442c744ec0f73f5d825fa470c704">EEPROM_TXCTCSSADJ</a>] = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af559c722569892f0612ff5c65493fe7a">txctcssadj</a>;
<a name="l03109"></a>03109       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac31262f80afbd912435464107e0d054d">eeprom</a>[<a class="code" href="chan__usbradio_8c.html#ae4b084ebdee2a0b600e62d67a71f3f94">EEPROM_RXSQUELCHADJ</a>] = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a1745424fe0dd99b7d3a778a253a5d686">rxsquelchadj</a>;
<a name="l03110"></a>03110       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#aa4c4270e4903db2dcb2ee7e3a7966ca3">eepromctl</a> = 2;  <span class="comment">/* request a write */</span>
<a name="l03111"></a>03111       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0cb029a4ba4ae628b6f5431a4cbb753f">eepromlock</a>);
<a name="l03112"></a>03112    }
<a name="l03113"></a>03113 }
<a name="l03114"></a>03114 <span class="comment">//</span>
<a name="l03115"></a><a class="code" href="chan__usbradio_8c.html#aa2020bdc5a2688a4727e349befacb35d">03115</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__usbradio_8c.html#aa2020bdc5a2688a4727e349befacb35d">mixer_write</a>(<span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o)
<a name="l03116"></a>03116 {
<a name="l03117"></a>03117    <a class="code" href="chan__usbradio_8c.html#a05443895be85616649ab5c6e76f8f241">setamixer</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a7d942ce6a2ddec93dc13684d61b1750d">devicenum</a>,<a class="code" href="chan__usbradio_8c.html#a6aa4920a9b490eaca041cb984eba5dab">MIXER_PARAM_MIC_PLAYBACK_SW</a>,0,0);
<a name="l03118"></a>03118    <a class="code" href="chan__usbradio_8c.html#a05443895be85616649ab5c6e76f8f241">setamixer</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a7d942ce6a2ddec93dc13684d61b1750d">devicenum</a>,<a class="code" href="chan__usbradio_8c.html#a2b13370bbcd89b6232752305f16af2c6">MIXER_PARAM_MIC_PLAYBACK_VOL</a>,0,0);
<a name="l03119"></a>03119    <a class="code" href="chan__usbradio_8c.html#a05443895be85616649ab5c6e76f8f241">setamixer</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a7d942ce6a2ddec93dc13684d61b1750d">devicenum</a>,<a class="code" href="chan__usbradio_8c.html#a48aae02ce5d047e71d09ae22a396c756">MIXER_PARAM_SPKR_PLAYBACK_SW</a>,1,0);
<a name="l03120"></a>03120    <a class="code" href="chan__usbradio_8c.html#a05443895be85616649ab5c6e76f8f241">setamixer</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a7d942ce6a2ddec93dc13684d61b1750d">devicenum</a>,<a class="code" href="chan__usbradio_8c.html#ad1cc3a63000c040db5c5e20836d039ae">MIXER_PARAM_SPKR_PLAYBACK_VOL</a>,
<a name="l03121"></a>03121       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5dca179fe41743d80bd66e6a21de9fac">txmixaset</a> * o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a726770ecafcfd5375796acf427cde947">spkrmax</a> / 1000,
<a name="l03122"></a>03122       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac2c2424ad6a5ca0a0c6f7026e74d7701">txmixbset</a> * o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a726770ecafcfd5375796acf427cde947">spkrmax</a> / 1000);
<a name="l03123"></a>03123    <a class="code" href="chan__usbradio_8c.html#a05443895be85616649ab5c6e76f8f241">setamixer</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a7d942ce6a2ddec93dc13684d61b1750d">devicenum</a>,<a class="code" href="chan__usbradio_8c.html#acdbe8da16d20178447b63f536bf8b9f9">MIXER_PARAM_MIC_CAPTURE_VOL</a>,
<a name="l03124"></a>03124       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a959ccc7bd4988d55f4115fd5b13e236e">rxmixerset</a> * o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ad73045328563e3ea5f9fbc8c3ce9ad09">micmax</a> / 1000,0);
<a name="l03125"></a>03125    <a class="code" href="chan__usbradio_8c.html#a05443895be85616649ab5c6e76f8f241">setamixer</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a7d942ce6a2ddec93dc13684d61b1750d">devicenum</a>,<a class="code" href="chan__usbradio_8c.html#a99390fc3e67665c7b237060a74bff67c">MIXER_PARAM_MIC_BOOST</a>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a2c9642c08c9342104a689c6bacff9160">rxboostset</a>,0);
<a name="l03126"></a>03126    <a class="code" href="chan__usbradio_8c.html#a05443895be85616649ab5c6e76f8f241">setamixer</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a7d942ce6a2ddec93dc13684d61b1750d">devicenum</a>,<a class="code" href="chan__usbradio_8c.html#abfc3705afb95d69707788ab111be693e">MIXER_PARAM_MIC_CAPTURE_SW</a>,1,0);
<a name="l03127"></a>03127 }
<a name="l03128"></a>03128 <span class="comment">/*</span>
<a name="l03129"></a>03129 <span class="comment">   adjust dsp multiplier to add resolution to tx level adjustment</span>
<a name="l03130"></a>03130 <span class="comment">*/</span>
<a name="l03131"></a><a class="code" href="chan__usbradio_8c.html#acb41a83bcd08bfc92fb24c6ece7830c0">03131</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__usbradio_8c.html#acb41a83bcd08bfc92fb24c6ece7830c0">mult_set</a>(<span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o)
<a name="l03132"></a>03132 {
<a name="l03133"></a>03133 
<a name="l03134"></a>03134    <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;spsTxOutA) {
<a name="l03135"></a>03135       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;spsTxOutA-&gt;outputGain = 
<a name="l03136"></a>03136          <a class="code" href="chan__usbradio_8c.html#a4f3ff3365910baf3963bd847f8e7f962">mult_calc</a>((o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5dca179fe41743d80bd66e6a21de9fac">txmixaset</a> * 152) / 1000);
<a name="l03137"></a>03137    }
<a name="l03138"></a>03138    <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;spsTxOutB){
<a name="l03139"></a>03139       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;spsTxOutB-&gt;outputGain = 
<a name="l03140"></a>03140          <a class="code" href="chan__usbradio_8c.html#a4f3ff3365910baf3963bd847f8e7f962">mult_calc</a>((o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac2c2424ad6a5ca0a0c6f7026e74d7701">txmixbset</a> * 152) / 1000);
<a name="l03141"></a>03141    }
<a name="l03142"></a>03142 }
<a name="l03143"></a>03143 <span class="comment">//</span>
<a name="l03144"></a>03144 <span class="comment">// input 0 - 151 outputs are pot and multiplier</span>
<a name="l03145"></a>03145 <span class="comment">//</span>
<a name="l03146"></a><a class="code" href="chan__usbradio_8c.html#a4f3ff3365910baf3963bd847f8e7f962">03146</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#a4f3ff3365910baf3963bd847f8e7f962">mult_calc</a>(<span class="keywordtype">int</span> value)
<a name="l03147"></a>03147 {
<a name="l03148"></a>03148    <span class="keyword">const</span> <span class="keywordtype">int</span> multx=M_Q8;
<a name="l03149"></a>03149    <span class="keywordtype">int</span> pot,mult;
<a name="l03150"></a>03150 
<a name="l03151"></a>03151    pot=((int)(value/4)*4)+2;
<a name="l03152"></a>03152    mult = multx-( ( multx * (3-(value%4)) ) / (pot+2) );
<a name="l03153"></a>03153    <span class="keywordflow">return</span>(mult);
<a name="l03154"></a>03154 }
<a name="l03155"></a>03155 
<a name="l03156"></a><a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">03156</a> <span class="preprocessor">#define pd(x) {printf(#x&quot; = %d\n&quot;,x);}</span>
<a name="l03157"></a><a class="code" href="chan__usbradio_8c.html#a76ef0d203c3e50e32968f67eb382677d">03157</a> <span class="preprocessor"></span><span class="preprocessor">#define pp(x) {printf(#x&quot; = %p\n&quot;,x);}</span>
<a name="l03158"></a><a class="code" href="chan__usbradio_8c.html#ae320c29b526039fbf085fc7337bb2265">03158</a> <span class="preprocessor"></span><span class="preprocessor">#define ps(x) {printf(#x&quot; = %s\n&quot;,x);}</span>
<a name="l03159"></a><a class="code" href="chan__usbradio_8c.html#a8ed7b83d132a542e57a2b1b6cac74aad">03159</a> <span class="preprocessor"></span><span class="preprocessor">#define pf(x) {printf(#x&quot; = %f\n&quot;,x);}</span>
<a name="l03160"></a>03160 <span class="preprocessor"></span>
<a name="l03161"></a>03161 
<a name="l03162"></a>03162 <span class="preprocessor">#if 0</span>
<a name="l03163"></a>03163 <span class="preprocessor"></span><span class="comment">/*</span>
<a name="l03164"></a>03164 <span class="comment">   do hid output if only requirement is ptt out</span>
<a name="l03165"></a>03165 <span class="comment">   this give fastest performance with least overhead</span>
<a name="l03166"></a>03166 <span class="comment">   where gpio inputs are not required.</span>
<a name="l03167"></a>03167 <span class="comment">*/</span>
<a name="l03168"></a>03168 
<a name="l03169"></a>03169 <span class="keyword">static</span> <span class="keywordtype">int</span> usbhider(<span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o, <span class="keywordtype">int</span> opt)
<a name="l03170"></a>03170 {
<a name="l03171"></a>03171    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[4];
<a name="l03172"></a>03172    <span class="keywordtype">char</span> lastrx, txtmp;
<a name="l03173"></a>03173 
<a name="l03174"></a>03174    <span class="keywordflow">if</span>(opt)
<a name="l03175"></a>03175    {
<a name="l03176"></a>03176       <span class="keyword">struct </span>usb_device *usb_dev;
<a name="l03177"></a>03177 
<a name="l03178"></a>03178       usb_dev = <a class="code" href="chan__usbradio_8c.html#a07a999973f172029333fd314780106e2">hid_device_init</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ae0013a0ec03c2c35c2966c6aa3147abd">devstr</a>);
<a name="l03179"></a>03179       <span class="keywordflow">if</span> (usb_dev == NULL) {
<a name="l03180"></a>03180          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,<span class="stringliteral">&quot;USB HID device not found\n&quot;</span>);
<a name="l03181"></a>03181          <span class="keywordflow">return</span> -1;
<a name="l03182"></a>03182       }
<a name="l03183"></a>03183       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a80347ac068869204dca84f4608f8ea09">usb_handle</a> = usb_open(usb_dev);
<a name="l03184"></a>03184       <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a80347ac068869204dca84f4608f8ea09">usb_handle</a> == NULL) {
<a name="l03185"></a>03185           <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,<span class="stringliteral">&quot;Not able to open USB device\n&quot;</span>);
<a name="l03186"></a>03186          <span class="keywordflow">return</span> -1;
<a name="l03187"></a>03187       }
<a name="l03188"></a>03188       <span class="keywordflow">if</span> (usb_claim_interface(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a80347ac068869204dca84f4608f8ea09">usb_handle</a>,<a class="code" href="chan__usbradio_8c.html#a82855a6adac1c229cd7d6e7d89365776">C108_HID_INTERFACE</a>) &lt; 0)
<a name="l03189"></a>03189       {
<a name="l03190"></a>03190           <span class="keywordflow">if</span> (usb_detach_kernel_driver_np(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a80347ac068869204dca84f4608f8ea09">usb_handle</a>,<a class="code" href="chan__usbradio_8c.html#a82855a6adac1c229cd7d6e7d89365776">C108_HID_INTERFACE</a>) &lt; 0) {
<a name="l03191"></a>03191              <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,<span class="stringliteral">&quot;Not able to detach the USB device\n&quot;</span>);
<a name="l03192"></a>03192             <span class="keywordflow">return</span> -1;
<a name="l03193"></a>03193          }
<a name="l03194"></a>03194          <span class="keywordflow">if</span> (usb_claim_interface(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a80347ac068869204dca84f4608f8ea09">usb_handle</a>,<a class="code" href="chan__usbradio_8c.html#a82855a6adac1c229cd7d6e7d89365776">C108_HID_INTERFACE</a>) &lt; 0) {
<a name="l03195"></a>03195             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,<span class="stringliteral">&quot;Not able to claim the USB device\n&quot;</span>);
<a name="l03196"></a>03196             <span class="keywordflow">return</span> -1;
<a name="l03197"></a>03197          }
<a name="l03198"></a>03198       }
<a name="l03199"></a>03199    
<a name="l03200"></a>03200       memset(buf,0,<span class="keyword">sizeof</span>(buf));
<a name="l03201"></a>03201       buf[2] = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a4daaa2a04c1f3cef618b8f7f2b2dbc66">hid_gpio_ctl</a>;
<a name="l03202"></a>03202       buf[1] = 0;
<a name="l03203"></a>03203       <a class="code" href="chan__usbradio_8c.html#ad8157eb0b78b43232433f943c3e48aaa">hid_set_outputs</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a80347ac068869204dca84f4608f8ea09">usb_handle</a>,buf);
<a name="l03204"></a>03204       memcpy(bufsave,buf,<span class="keyword">sizeof</span>(buf));
<a name="l03205"></a>03205     
<a name="l03206"></a>03206       buf[o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a24fbd2c9b0fc7e56bcb66e0499333fec">hid_gpio_ctl_loc</a>] = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a4daaa2a04c1f3cef618b8f7f2b2dbc66">hid_gpio_ctl</a>;
<a name="l03207"></a>03207       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ae7c1bd7aa1c831e7d13648fd13e1b6a6">lasttx</a>=0;
<a name="l03208"></a>03208    }
<a name="l03209"></a>03209 
<a name="l03210"></a>03210    <span class="comment">/* if change in tx state as controlled by xpmr */</span>
<a name="l03211"></a>03211    txtmp=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;txPttOut;
<a name="l03212"></a>03212          
<a name="l03213"></a>03213    <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ae7c1bd7aa1c831e7d13648fd13e1b6a6">lasttx</a> != txtmp)
<a name="l03214"></a>03214    {
<a name="l03215"></a>03215       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;txPttHid=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ae7c1bd7aa1c831e7d13648fd13e1b6a6">lasttx</a> = txtmp;
<a name="l03216"></a>03216       <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a8bc52eafdec6e1ab31955b8e407746ba">debuglevel</a>)printf(<span class="stringliteral">&quot;usbhid: tx set to %d\n&quot;</span>,txtmp);
<a name="l03217"></a>03217       buf[o-&gt;<a class="code" href="structchan__usbradio__pvt.html#afc21a1f1175ad7a1b6c3db6a23382ad4">hid_gpio_loc</a>] = 0;
<a name="l03218"></a>03218       <span class="keywordflow">if</span> (!o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a16bef002aa5c9dc00ccd30bd1638cd73">invertptt</a>)
<a name="l03219"></a>03219       {
<a name="l03220"></a>03220          <span class="keywordflow">if</span> (txtmp) buf[o-&gt;<a class="code" href="structchan__usbradio__pvt.html#afc21a1f1175ad7a1b6c3db6a23382ad4">hid_gpio_loc</a>] = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a986fd9e827a7571882f177c9b5598951">hid_io_ptt</a>;
<a name="l03221"></a>03221       }
<a name="l03222"></a>03222       <span class="keywordflow">else</span>
<a name="l03223"></a>03223       {
<a name="l03224"></a>03224          <span class="keywordflow">if</span> (!txtmp) buf[o-&gt;<a class="code" href="structchan__usbradio__pvt.html#afc21a1f1175ad7a1b6c3db6a23382ad4">hid_gpio_loc</a>] = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a986fd9e827a7571882f177c9b5598951">hid_io_ptt</a>;
<a name="l03225"></a>03225       }
<a name="l03226"></a>03226       buf[o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a24fbd2c9b0fc7e56bcb66e0499333fec">hid_gpio_ctl_loc</a>] = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a4daaa2a04c1f3cef618b8f7f2b2dbc66">hid_gpio_ctl</a>;
<a name="l03227"></a>03227       <a class="code" href="chan__usbradio_8c.html#ad8157eb0b78b43232433f943c3e48aaa">hid_set_outputs</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a80347ac068869204dca84f4608f8ea09">usb_handle</a>,buf);
<a name="l03228"></a>03228    }
<a name="l03229"></a>03229 
<a name="l03230"></a>03230    <span class="keywordflow">return</span>(0);
<a name="l03231"></a>03231 }
<a name="l03232"></a>03232 <span class="preprocessor">#endif</span>
<a name="l03233"></a>03233 <span class="preprocessor"></span><span class="comment">/*</span>
<a name="l03234"></a>03234 <span class="comment">*/</span>
<a name="l03235"></a><a class="code" href="chan__usbradio_8c.html#a98be1c07bf1c76b0ede7c3cef6c21c4e">03235</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="chan__usbradio_8c.html#a98be1c07bf1c76b0ede7c3cef6c21c4e">pmrdump</a>(<span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o)
<a name="l03236"></a>03236 {
<a name="l03237"></a>03237    t_pmr_chan *p;
<a name="l03238"></a>03238    <span class="keywordtype">int</span> i;
<a name="l03239"></a>03239 
<a name="l03240"></a>03240    p=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>;
<a name="l03241"></a>03241 
<a name="l03242"></a>03242    printf(<span class="stringliteral">&quot;\nodump()\n&quot;</span>);
<a name="l03243"></a>03243 
<a name="l03244"></a>03244    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a7d942ce6a2ddec93dc13684d61b1750d">devicenum</a>);
<a name="l03245"></a>03245    <a class="code" href="chan__usbradio_8c.html#ae320c29b526039fbf085fc7337bb2265">ps</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ae0013a0ec03c2c35c2966c6aa3147abd">devstr</a>);
<a name="l03246"></a>03246 
<a name="l03247"></a>03247    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ad73045328563e3ea5f9fbc8c3ce9ad09">micmax</a>);
<a name="l03248"></a>03248    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a726770ecafcfd5375796acf427cde947">spkrmax</a>);
<a name="l03249"></a>03249 
<a name="l03250"></a>03250    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a192b610a400b0092bbf865fa8cd60a44">rxdemod</a>);
<a name="l03251"></a>03251    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af7351b2441759672562708b11cd8fedd">rxcdtype</a>);
<a name="l03252"></a>03252    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#aeb14af6032352ae6255ee5a59bd10d55">rxsdtype</a>);
<a name="l03253"></a>03253    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a543f5a1359459a66235d463f755245e3">txtoctype</a>);
<a name="l03254"></a>03254 
<a name="l03255"></a>03255    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a959ccc7bd4988d55f4115fd5b13e236e">rxmixerset</a>);
<a name="l03256"></a>03256    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a2c9642c08c9342104a689c6bacff9160">rxboostset</a>);
<a name="l03257"></a>03257 
<a name="l03258"></a>03258    <a class="code" href="chan__usbradio_8c.html#a8ed7b83d132a542e57a2b1b6cac74aad">pf</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0d9da32dc6edbbd18f90722056331b65">rxvoiceadj</a>);
<a name="l03259"></a>03259    <a class="code" href="chan__usbradio_8c.html#a8ed7b83d132a542e57a2b1b6cac74aad">pf</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0da461807e1a48746fd856ae6aa21499">rxctcssadj</a>);
<a name="l03260"></a>03260    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a1745424fe0dd99b7d3a778a253a5d686">rxsquelchadj</a>);
<a name="l03261"></a>03261 
<a name="l03262"></a>03262    <a class="code" href="chan__usbradio_8c.html#ae320c29b526039fbf085fc7337bb2265">ps</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#aac82d4d77ee6a45db6720b0a47f9f052">txctcssdefault</a>);
<a name="l03263"></a>03263    <a class="code" href="chan__usbradio_8c.html#ae320c29b526039fbf085fc7337bb2265">ps</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a020b18a1a2da0a7290a6ad0547ff1070">txctcssfreq</a>);
<a name="l03264"></a>03264 
<a name="l03265"></a>03265    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a460732a473feeae83d1e9236060f92e6">numrxctcssfreqs</a>);
<a name="l03266"></a>03266    <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a460732a473feeae83d1e9236060f92e6">numrxctcssfreqs</a>&gt;0)
<a name="l03267"></a>03267    {
<a name="l03268"></a>03268       <span class="keywordflow">for</span>(i=0;i&lt;o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a460732a473feeae83d1e9236060f92e6">numrxctcssfreqs</a>;i++)
<a name="l03269"></a>03269       {
<a name="l03270"></a>03270          printf(<span class="stringliteral">&quot; %i =  %s  %s\n&quot;</span>,i,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#aa0ae57dfcf5f6bbd63240001a9db1367">rxctcss</a>[i],o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af788c8332d3a734b5bcc78ce098f9bf4">txctcss</a>[i]); 
<a name="l03271"></a>03271       }
<a name="l03272"></a>03272    }
<a name="l03273"></a>03273 
<a name="l03274"></a>03274    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a933ce66d291cb7d99d8693683d0a3f7d">b</a>.<a class="code" href="structchan__usbradio__pvt.html#a8b35b6a9c58966a7570a6fde53c7d0b0">rxpolarity</a>);
<a name="l03275"></a>03275    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a933ce66d291cb7d99d8693683d0a3f7d">b</a>.<a class="code" href="structchan__usbradio__pvt.html#a0501683ef8fd346ebdb84ca5cef9d8e8">txpolarity</a>);
<a name="l03276"></a>03276 
<a name="l03277"></a>03277    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ad75faa99a995d1f7847a2c0ae50b58df">txprelim</a>);
<a name="l03278"></a>03278    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a95a57d28620e96b54f510eb9a543ddfc">txmixa</a>);
<a name="l03279"></a>03279    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a6cf7fb2913ee1a3c50247dd8f6ea32a4">txmixb</a>);
<a name="l03280"></a>03280    
<a name="l03281"></a>03281    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5dca179fe41743d80bd66e6a21de9fac">txmixaset</a>);
<a name="l03282"></a>03282    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac2c2424ad6a5ca0a0c6f7026e74d7701">txmixbset</a>);
<a name="l03283"></a>03283    
<a name="l03284"></a>03284    printf(<span class="stringliteral">&quot;\npmrdump()\n&quot;</span>);
<a name="l03285"></a>03285  
<a name="l03286"></a>03286    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(p-&gt;devicenum);
<a name="l03287"></a>03287 
<a name="l03288"></a>03288    printf(<span class="stringliteral">&quot;prxSquelchAdjust=%i\n&quot;</span>,*(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;prxSquelchAdjust));
<a name="l03289"></a>03289 
<a name="l03290"></a>03290    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(p-&gt;rxCarrierPoint);
<a name="l03291"></a>03291    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(p-&gt;rxCarrierHyst);
<a name="l03292"></a>03292 
<a name="l03293"></a>03293    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(*p-&gt;prxVoiceAdjust);
<a name="l03294"></a>03294    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(*p-&gt;prxCtcssAdjust);
<a name="l03295"></a>03295 
<a name="l03296"></a>03296    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(p-&gt;rxfreq);
<a name="l03297"></a>03297    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(p-&gt;txfreq);
<a name="l03298"></a>03298 
<a name="l03299"></a>03299    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(p-&gt;rxCtcss-&gt;relax);
<a name="l03300"></a>03300    <span class="comment">//pf(p-&gt;rxCtcssFreq);   </span>
<a name="l03301"></a>03301    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(p-&gt;numrxcodes);
<a name="l03302"></a>03302    <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;numrxcodes&gt;0)
<a name="l03303"></a>03303    {
<a name="l03304"></a>03304       <span class="keywordflow">for</span>(i=0;i&lt;o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;numrxcodes;i++)
<a name="l03305"></a>03305       {
<a name="l03306"></a>03306          printf(<span class="stringliteral">&quot; %i = %s\n&quot;</span>,i,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;pRxCode[i]); 
<a name="l03307"></a>03307       }
<a name="l03308"></a>03308    }
<a name="l03309"></a>03309 
<a name="l03310"></a>03310    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(p-&gt;txTocType);
<a name="l03311"></a>03311    <a class="code" href="chan__usbradio_8c.html#ae320c29b526039fbf085fc7337bb2265">ps</a>(p-&gt;pTxCodeDefault);
<a name="l03312"></a>03312    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(p-&gt;txcodedefaultsmode);
<a name="l03313"></a>03313    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(p-&gt;numtxcodes);
<a name="l03314"></a>03314    <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;numtxcodes&gt;0)
<a name="l03315"></a>03315    {
<a name="l03316"></a>03316       <span class="keywordflow">for</span>(i=0;i&lt;o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;numtxcodes;i++)
<a name="l03317"></a>03317       {                                       
<a name="l03318"></a>03318          printf(<span class="stringliteral">&quot; %i = %s\n&quot;</span>,i,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;pTxCode[i]); 
<a name="l03319"></a>03319       }
<a name="l03320"></a>03320    }
<a name="l03321"></a>03321 
<a name="l03322"></a>03322    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(p-&gt;b.rxpolarity);
<a name="l03323"></a>03323    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(p-&gt;b.txpolarity);
<a name="l03324"></a>03324    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(p-&gt;b.dcsrxpolarity);
<a name="l03325"></a>03325    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(p-&gt;b.dcstxpolarity);
<a name="l03326"></a>03326    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(p-&gt;b.lsdrxpolarity);
<a name="l03327"></a>03327    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(p-&gt;b.lsdtxpolarity);
<a name="l03328"></a>03328 
<a name="l03329"></a>03329    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(p-&gt;txMixA);
<a name="l03330"></a>03330    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(p-&gt;txMixB);
<a name="l03331"></a>03331     
<a name="l03332"></a>03332    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(p-&gt;rxDeEmpEnable);
<a name="l03333"></a>03333    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(p-&gt;rxCenterSlicerEnable);
<a name="l03334"></a>03334    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(p-&gt;rxCtcssDecodeEnable);
<a name="l03335"></a>03335    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(p-&gt;rxDcsDecodeEnable);
<a name="l03336"></a>03336    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(p-&gt;b.ctcssRxEnable);
<a name="l03337"></a>03337    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(p-&gt;b.dcsRxEnable);
<a name="l03338"></a>03338    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(p-&gt;b.lmrRxEnable);
<a name="l03339"></a>03339    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(p-&gt;b.dstRxEnable);
<a name="l03340"></a>03340    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(p-&gt;smode);
<a name="l03341"></a>03341 
<a name="l03342"></a>03342    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(p-&gt;txHpfEnable);
<a name="l03343"></a>03343    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(p-&gt;txLimiterEnable);
<a name="l03344"></a>03344    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(p-&gt;txPreEmpEnable);
<a name="l03345"></a>03345    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(p-&gt;txLpfEnable);
<a name="l03346"></a>03346 
<a name="l03347"></a>03347    <span class="keywordflow">if</span>(p-&gt;spsTxOutA)<a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(p-&gt;spsTxOutA-&gt;outputGain);
<a name="l03348"></a>03348    <span class="keywordflow">if</span>(p-&gt;spsTxOutB)<a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(p-&gt;spsTxOutB-&gt;outputGain);
<a name="l03349"></a>03349    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(p-&gt;txPttIn);
<a name="l03350"></a>03350    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(p-&gt;txPttOut);
<a name="l03351"></a>03351 
<a name="l03352"></a>03352    <a class="code" href="chan__usbradio_8c.html#ab0701802d11479a6ce440168aadb64ee">pd</a>(p-&gt;tracetype);
<a name="l03353"></a>03353 
<a name="l03354"></a>03354    <span class="keywordflow">return</span>;
<a name="l03355"></a>03355 }
<a name="l03356"></a>03356 <span class="comment">/*</span>
<a name="l03357"></a>03357 <span class="comment">   takes data from a chan_usbradio_pvt struct (e.g. o-&gt;)</span>
<a name="l03358"></a>03358 <span class="comment">   and configures the xpmr radio layer</span>
<a name="l03359"></a>03359 <span class="comment">*/</span>
<a name="l03360"></a><a class="code" href="chan__usbradio_8c.html#a5f60010431301ac2b329a1910776855d">03360</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#a5f60010431301ac2b329a1910776855d">xpmr_config</a>(<span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o)
<a name="l03361"></a>03361 {
<a name="l03362"></a>03362    <span class="comment">//ast_log(LOG_NOTICE,&quot;xpmr_config()\n&quot;);</span>
<a name="l03363"></a>03363 
<a name="l03364"></a>03364    TRACEO(1,(<span class="stringliteral">&quot;xpmr_config()\n&quot;</span>));
<a name="l03365"></a>03365 
<a name="l03366"></a>03366    <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>==NULL)
<a name="l03367"></a>03367    {
<a name="l03368"></a>03368       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,<span class="stringliteral">&quot;pmr channel structure NULL\n&quot;</span>);
<a name="l03369"></a>03369       <span class="keywordflow">return</span> 1;
<a name="l03370"></a>03370    }
<a name="l03371"></a>03371 
<a name="l03372"></a>03372    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;rxCtcss-&gt;relax = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0ef47a421f5dd8fd85a847519642615f">rxctcssrelax</a>;
<a name="l03373"></a>03373    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;txpower=0;
<a name="l03374"></a>03374 
<a name="l03375"></a>03375    <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a933ce66d291cb7d99d8693683d0a3f7d">b</a>.<a class="code" href="structchan__usbradio__pvt.html#aef7ddb05106487178eb92abe88289e7f">remoted</a>)
<a name="l03376"></a>03376    {
<a name="l03377"></a>03377       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;pTxCodeDefault = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#aefc7b481c241afc76ed37d2c3fe2695d">set_txctcssdefault</a>;
<a name="l03378"></a>03378       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;pRxCodeSrc=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a36bb704870959c8638d2a7f438ce528e">set_rxctcssfreqs</a>;
<a name="l03379"></a>03379       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;pTxCodeSrc=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9df6c1ad2df4cdc5c71c38034d5d2c9c">set_txctcssfreqs</a>;
<a name="l03380"></a>03380 
<a name="l03381"></a>03381       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;rxfreq=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0bafa0a226e4538d6f64cd522580d1cd">set_rxfreq</a>;
<a name="l03382"></a>03382       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;txfreq=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a2c0e6eb590cb812c4b03c7a57be9656e">set_txfreq</a>;
<a name="l03383"></a>03383       <span class="comment">/* printf(&quot; remoted %s %s --&gt; %s \n&quot;,o-&gt;pmrChan-&gt;txctcssdefault,</span>
<a name="l03384"></a>03384 <span class="comment">         o-&gt;pmrChan-&gt;txctcssfreq,o-&gt;pmrChan-&gt;rxctcssfreq); */</span>
<a name="l03385"></a>03385    }
<a name="l03386"></a>03386    <span class="keywordflow">else</span>
<a name="l03387"></a>03387    {
<a name="l03388"></a>03388       <span class="comment">// set xpmr pointers to source strings</span>
<a name="l03389"></a>03389 
<a name="l03390"></a>03390       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;pTxCodeDefault = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#aac82d4d77ee6a45db6720b0a47f9f052">txctcssdefault</a>;
<a name="l03391"></a>03391       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;pRxCodeSrc     = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af828234faebaeded2f34d586b3402407">rxctcssfreqs</a>;
<a name="l03392"></a>03392       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;pTxCodeSrc     = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af02b209a6fcc5a72be847eb6ff43a200">txctcssfreqs</a>;
<a name="l03393"></a>03393    
<a name="l03394"></a>03394       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;rxfreq = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a7033bb3c7ea0c75b12123d732c0ae023">rxfreq</a>;
<a name="l03395"></a>03395       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;txfreq = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#aeef37cee21cac9eb3f9d12ff7ddad450">txfreq</a>;
<a name="l03396"></a>03396    }
<a name="l03397"></a>03397    
<a name="l03398"></a>03398    code_string_parse(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>);
<a name="l03399"></a>03399    <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;rxfreq) o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;b.reprog=1;
<a name="l03400"></a>03400 
<a name="l03401"></a>03401    <span class="keywordflow">return</span> 0;
<a name="l03402"></a>03402 }
<a name="l03403"></a>03403 <span class="comment">/*</span>
<a name="l03404"></a>03404 <span class="comment"> * grab fields from the config file, init the descriptor and open the device.</span>
<a name="l03405"></a>03405 <span class="comment"> */</span>
<a name="l03406"></a><a class="code" href="chan__usbradio_8c.html#a2c1a9ed1de775bf9e05ce3f5268894af">03406</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *<a class="code" href="chan__usbradio_8c.html#a2c1a9ed1de775bf9e05ce3f5268894af">store_config</a>(<span class="keyword">struct</span> <a class="code" href="structast__config.html">ast_config</a> *cfg, <span class="keywordtype">char</span> *ctg)
<a name="l03407"></a>03407 {
<a name="l03408"></a>03408    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *v;
<a name="l03409"></a>03409    <span class="keyword">struct </span><a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o;
<a name="l03410"></a>03410    <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *cfg1;
<a name="l03411"></a>03411    <span class="keywordtype">int</span> i;
<a name="l03412"></a>03412    <span class="keywordtype">char</span> fname[200];
<a name="l03413"></a>03413 <span class="preprocessor">#ifdef   NEW_ASTERISK</span>
<a name="l03414"></a>03414 <span class="preprocessor"></span>   <span class="keyword">struct </span><a class="code" href="structast__flags.html" title="Structure used to handle boolean flags.">ast_flags</a> zeroflag = {0};
<a name="l03415"></a>03415 <span class="preprocessor">#endif</span>
<a name="l03416"></a>03416 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (ctg == NULL) {
<a name="l03417"></a>03417       <a class="code" href="chan__usbradio_8c.html#ab8b71b2cbec55b695df88902fb911db3">traceusb1</a>((<span class="stringliteral">&quot; store_config() ctg == NULL\n&quot;</span>));
<a name="l03418"></a>03418       o = &amp;usbradio_default;
<a name="l03419"></a>03419       ctg = <span class="stringliteral">&quot;general&quot;</span>;
<a name="l03420"></a>03420    } <span class="keywordflow">else</span> {
<a name="l03421"></a>03421       <span class="comment">/* &quot;general&quot; is also the default thing */</span>
<a name="l03422"></a>03422       <span class="keywordflow">if</span> (strcmp(ctg, <span class="stringliteral">&quot;general&quot;</span>) == 0) {
<a name="l03423"></a>03423          o = &amp;usbradio_default;
<a name="l03424"></a>03424       } <span class="keywordflow">else</span> {
<a name="l03425"></a>03425           <span class="comment">// ast_log(LOG_NOTICE,&quot;ast_calloc for chan_usbradio_pvt of %s\n&quot;,ctg);</span>
<a name="l03426"></a>03426          <span class="keywordflow">if</span> (!(o = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*o))))
<a name="l03427"></a>03427             <span class="keywordflow">return</span> NULL;
<a name="l03428"></a>03428          *o = usbradio_default;
<a name="l03429"></a>03429          o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5ac083a645d964373f022d03df4849c8">name</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(ctg);
<a name="l03430"></a>03430          <span class="keywordflow">if</span> (!usbradio_active) 
<a name="l03431"></a>03431             usbradio_active = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5ac083a645d964373f022d03df4849c8">name</a>;
<a name="l03432"></a>03432       }
<a name="l03433"></a>03433    }
<a name="l03434"></a>03434    <a class="code" href="lock_8h.html#a5dc895fe6e8c089175159fc22e33fc3b">ast_mutex_init</a>(&amp;o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0cb029a4ba4ae628b6f5431a4cbb753f">eepromlock</a>);
<a name="l03435"></a>03435    strcpy(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af689da2b77d1265192a78a5b0994a1d5">mohinterpret</a>, <span class="stringliteral">&quot;default&quot;</span>);
<a name="l03436"></a>03436    <span class="comment">/* fill other fields from configuration */</span>
<a name="l03437"></a>03437    <span class="keywordflow">for</span> (v = <a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(cfg, ctg); v; v = v-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l03438"></a>03438       <a class="code" href="chan__usbradio_8c.html#aa8507593fc6a5ac8a4dda99c3ac5e024">M_START</a>((<span class="keywordtype">char</span> *)v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, (<span class="keywordtype">char</span> *)v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l03439"></a>03439 
<a name="l03440"></a>03440       <span class="comment">/* handle jb conf */</span>
<a name="l03441"></a>03441       <span class="keywordflow">if</span> (!<a class="code" href="abstract__jb_8h.html#ae50ad081bd2ae6b58bcfc4687916c586" title="Sets jitterbuffer configuration property.">ast_jb_read_conf</a>(&amp;<a class="code" href="chan__usbradio_8c.html#abaabcb7f4349cc632dde3af5c6a5e1bd">global_jbconf</a>, v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>))
<a name="l03442"></a>03442          <span class="keywordflow">continue</span>;
<a name="l03443"></a>03443 
<a name="l03444"></a>03444 <span class="preprocessor">#if   0</span>
<a name="l03445"></a>03445 <span class="preprocessor"></span>         <a class="code" href="chan__usbradio_8c.html#a9cf2eee5dda3e750f9e6f1cb3e7a09a2">M_BOOL</a>(<span class="stringliteral">&quot;autoanswer&quot;</span>, o-&gt;<a class="code" href="structchan__usbradio__pvt.html#aa682db27c8180700165db1398964b3c8">autoanswer</a>)
<a name="l03446"></a>03446          <a class="code" href="chan__usbradio_8c.html#a9cf2eee5dda3e750f9e6f1cb3e7a09a2">M_BOOL</a>(<span class="stringliteral">&quot;autohangup&quot;</span>, o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a56c3f16f4a1c55d1d95c6a9523cd65ca">autohangup</a>)
<a name="l03447"></a>03447          <a class="code" href="chan__usbradio_8c.html#a9cf2eee5dda3e750f9e6f1cb3e7a09a2">M_BOOL</a>(<span class="stringliteral">&quot;overridecontext&quot;</span>, o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a4eedfe56e88e9cb9777a619c022fe6a8">overridecontext</a>)
<a name="l03448"></a>03448          <a class="code" href="chan__usbradio_8c.html#a1dbce7eba2a5b0b4aa5905af98dbc9b6">M_STR</a>(<span class="stringliteral">&quot;context&quot;</span>, o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a02d0db19ebec1fa1e0d29bda775c1096">ctx</a>)
<a name="l03449"></a>03449          <a class="code" href="chan__usbradio_8c.html#a1dbce7eba2a5b0b4aa5905af98dbc9b6">M_STR</a>(<span class="stringliteral">&quot;language&quot;</span>, o-&gt;<a class="code" href="structchan__usbradio__pvt.html#adf416dc058363e2fd5750c77e2d78bee">language</a>)
<a name="l03450"></a>03450          <a class="code" href="chan__usbradio_8c.html#a1dbce7eba2a5b0b4aa5905af98dbc9b6">M_STR</a>(<span class="stringliteral">&quot;mohinterpret&quot;</span>, o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af689da2b77d1265192a78a5b0994a1d5">mohinterpret</a>)
<a name="l03451"></a>03451          <a class="code" href="chan__usbradio_8c.html#a1dbce7eba2a5b0b4aa5905af98dbc9b6">M_STR</a>(<span class="stringliteral">&quot;extension&quot;</span>, o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a1ad093b5bae14543eb7fe9f409d9c83b">ext</a>)
<a name="l03452"></a>03452          <a class="code" href="chan__usbradio_8c.html#a7772197db782e85b4e2fba2d641b592d">M_F</a>(<span class="stringliteral">&quot;callerid&quot;</span>, <a class="code" href="chan__console_8c.html#afdcb335a1ef2c86fcca00495bfe72dfb">store_callerid</a>(o, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>))
<a name="l03453"></a>03453 <span class="preprocessor">#endif</span>
<a name="l03454"></a>03454 <span class="preprocessor"></span>         <a class="code" href="chan__usbradio_8c.html#aba0c95c713354abf6c6577ed3c110be5">M_UINT</a>(<span class="stringliteral">&quot;frags&quot;</span>, o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a2f37ac27c86df549c61c5dcdc26de20d">frags</a>)
<a name="l03455"></a>03455          <a class="code" href="chan__usbradio_8c.html#aba0c95c713354abf6c6577ed3c110be5">M_UINT</a>(<span class="stringliteral">&quot;queuesize&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a33e55b30ec9ce66362b23d8fb1582630">queuesize</a>)
<a name="l03456"></a>03456 <span class="preprocessor">#if 0</span>
<a name="l03457"></a>03457 <span class="preprocessor"></span>         <a class="code" href="chan__usbradio_8c.html#aba0c95c713354abf6c6577ed3c110be5">M_UINT</a>(<span class="stringliteral">&quot;devicenum&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a7d942ce6a2ddec93dc13684d61b1750d">devicenum</a>)
<a name="l03458"></a>03458 <span class="preprocessor">#endif</span>
<a name="l03459"></a>03459 <span class="preprocessor"></span>         <a class="code" href="chan__usbradio_8c.html#aba0c95c713354abf6c6577ed3c110be5">M_UINT</a>(<span class="stringliteral">&quot;debug&quot;</span>, usbradio_debug)
<a name="l03460"></a>03460          <a class="code" href="chan__usbradio_8c.html#a9cf2eee5dda3e750f9e6f1cb3e7a09a2">M_BOOL</a>(<span class="stringliteral">&quot;rxcpusaver&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac1ba9d4ea02ed0233e32f29f904ba717">rxcpusaver</a>)
<a name="l03461"></a>03461          <a class="code" href="chan__usbradio_8c.html#a9cf2eee5dda3e750f9e6f1cb3e7a09a2">M_BOOL</a>(<span class="stringliteral">&quot;txcpusaver&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a599ff3f902292ed29218ddea9ec3945e">txcpusaver</a>)
<a name="l03462"></a>03462          <a class="code" href="chan__usbradio_8c.html#a9cf2eee5dda3e750f9e6f1cb3e7a09a2">M_BOOL</a>(<span class="stringliteral">&quot;invertptt&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a16bef002aa5c9dc00ccd30bd1638cd73">invertptt</a>)
<a name="l03463"></a>03463          <a class="code" href="chan__usbradio_8c.html#a7772197db782e85b4e2fba2d641b592d">M_F</a>(<span class="stringliteral">&quot;rxdemod&quot;</span>,<a class="code" href="chan__usbradio_8c.html#a507daf62d02dc2766c61acb1a6ab175e">store_rxdemod</a>(o,(<span class="keywordtype">char</span> *)v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>))
<a name="l03464"></a>03464          <a class="code" href="chan__usbradio_8c.html#a9cf2eee5dda3e750f9e6f1cb3e7a09a2">M_BOOL</a>(<span class="stringliteral">&quot;txprelim&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ad75faa99a995d1f7847a2c0ae50b58df">txprelim</a>);
<a name="l03465"></a>03465          <a class="code" href="chan__usbradio_8c.html#a7772197db782e85b4e2fba2d641b592d">M_F</a>(<span class="stringliteral">&quot;txmixa&quot;</span>,<a class="code" href="chan__usbradio_8c.html#a490b78b67aa6feb5d8cd410033446880">store_txmixa</a>(o,(<span class="keywordtype">char</span> *)v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>))
<a name="l03466"></a>03466          <a class="code" href="chan__usbradio_8c.html#a7772197db782e85b4e2fba2d641b592d">M_F</a>(<span class="stringliteral">&quot;txmixb&quot;</span>,<a class="code" href="chan__usbradio_8c.html#a843f66782fe14dcda89ca7c98a4e1d7c">store_txmixb</a>(o,(<span class="keywordtype">char</span> *)v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>))
<a name="l03467"></a>03467          <a class="code" href="chan__usbradio_8c.html#a7772197db782e85b4e2fba2d641b592d">M_F</a>(<span class="stringliteral">&quot;carrierfrom&quot;</span>,<a class="code" href="chan__usbradio_8c.html#a3e3b9084f6ebb46dbd10d5f7a16e8721">store_rxcdtype</a>(o,(<span class="keywordtype">char</span> *)v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>))
<a name="l03468"></a>03468          <a class="code" href="chan__usbradio_8c.html#a7772197db782e85b4e2fba2d641b592d">M_F</a>(<span class="stringliteral">&quot;rxsdtype&quot;</span>,<a class="code" href="chan__usbradio_8c.html#ac00edc4c0d47cbdace004f50907f4f4d">store_rxsdtype</a>(o,(<span class="keywordtype">char</span> *)v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>))
<a name="l03469"></a>03469           <a class="code" href="chan__usbradio_8c.html#aba0c95c713354abf6c6577ed3c110be5">M_UINT</a>(<span class="stringliteral">&quot;rxsqvox&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a4dc1e577c75292544b37eb803938b63b">rxsqvoxadj</a>)
<a name="l03470"></a>03470          <a class="code" href="chan__usbradio_8c.html#a1dbce7eba2a5b0b4aa5905af98dbc9b6">M_STR</a>(<span class="stringliteral">&quot;txctcssdefault&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#aac82d4d77ee6a45db6720b0a47f9f052">txctcssdefault</a>)
<a name="l03471"></a>03471          <a class="code" href="chan__usbradio_8c.html#a1dbce7eba2a5b0b4aa5905af98dbc9b6">M_STR</a>(<span class="stringliteral">&quot;rxctcssfreqs&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af828234faebaeded2f34d586b3402407">rxctcssfreqs</a>)
<a name="l03472"></a>03472          <a class="code" href="chan__usbradio_8c.html#a1dbce7eba2a5b0b4aa5905af98dbc9b6">M_STR</a>(<span class="stringliteral">&quot;txctcssfreqs&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af02b209a6fcc5a72be847eb6ff43a200">txctcssfreqs</a>)
<a name="l03473"></a>03473          <a class="code" href="chan__usbradio_8c.html#aba0c95c713354abf6c6577ed3c110be5">M_UINT</a>(<span class="stringliteral">&quot;rxfreq&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a7033bb3c7ea0c75b12123d732c0ae023">rxfreq</a>)
<a name="l03474"></a>03474          <a class="code" href="chan__usbradio_8c.html#aba0c95c713354abf6c6577ed3c110be5">M_UINT</a>(<span class="stringliteral">&quot;txfreq&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#aeef37cee21cac9eb3f9d12ff7ddad450">txfreq</a>)
<a name="l03475"></a>03475          <a class="code" href="chan__usbradio_8c.html#a7772197db782e85b4e2fba2d641b592d">M_F</a>(<span class="stringliteral">&quot;rxgain&quot;</span>,<a class="code" href="chan__usbradio_8c.html#af2c1073c647c203be290e7473e8b6610">store_rxgain</a>(o,(<span class="keywordtype">char</span> *)v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>))
<a name="l03476"></a>03476          <a class="code" href="chan__usbradio_8c.html#a9cf2eee5dda3e750f9e6f1cb3e7a09a2">M_BOOL</a>(<span class="stringliteral">&quot;rxboost&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a2c9642c08c9342104a689c6bacff9160">rxboostset</a>)
<a name="l03477"></a>03477          <a class="code" href="chan__usbradio_8c.html#aba0c95c713354abf6c6577ed3c110be5">M_UINT</a>(<span class="stringliteral">&quot;rxctcssrelax&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0ef47a421f5dd8fd85a847519642615f">rxctcssrelax</a>)
<a name="l03478"></a>03478          <a class="code" href="chan__usbradio_8c.html#a7772197db782e85b4e2fba2d641b592d">M_F</a>(<span class="stringliteral">&quot;txtoctype&quot;</span>,<a class="code" href="chan__usbradio_8c.html#a6f6ab3f8ae560feac63fefa24e84c46b">store_txtoctype</a>(o,(<span class="keywordtype">char</span> *)v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>))
<a name="l03479"></a>03479          <a class="code" href="chan__usbradio_8c.html#aba0c95c713354abf6c6577ed3c110be5">M_UINT</a>(<span class="stringliteral">&quot;hdwtype&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a7d71a2812f8777ec95ca963a743f6f77">hdwtype</a>)
<a name="l03480"></a>03480          <a class="code" href="chan__usbradio_8c.html#aba0c95c713354abf6c6577ed3c110be5">M_UINT</a>(<span class="stringliteral">&quot;eeprom&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ae6df055b2352a39c3f2f781a17c6ba62">wanteeprom</a>)
<a name="l03481"></a>03481          <a class="code" href="chan__usbradio_8c.html#aba0c95c713354abf6c6577ed3c110be5">M_UINT</a>(<span class="stringliteral">&quot;duplex&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a49cf136c1442f0e05adaf095f3dfb06d">radioduplex</a>)
<a name="l03482"></a>03482          <a class="code" href="chan__usbradio_8c.html#aba0c95c713354abf6c6577ed3c110be5">M_UINT</a>(<span class="stringliteral">&quot;txsettletime&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a4dbf7524c8b604e6ccc0823482472217">txsettletime</a>)
<a name="l03483"></a>03483          <a class="code" href="chan__usbradio_8c.html#a9cf2eee5dda3e750f9e6f1cb3e7a09a2">M_BOOL</a>(<span class="stringliteral">&quot;rxpolarity&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a933ce66d291cb7d99d8693683d0a3f7d">b</a>.<a class="code" href="structchan__usbradio__pvt.html#a8b35b6a9c58966a7570a6fde53c7d0b0">rxpolarity</a>)
<a name="l03484"></a>03484          <a class="code" href="chan__usbradio_8c.html#a9cf2eee5dda3e750f9e6f1cb3e7a09a2">M_BOOL</a>(<span class="stringliteral">&quot;txpolarity&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a933ce66d291cb7d99d8693683d0a3f7d">b</a>.<a class="code" href="structchan__usbradio__pvt.html#a0501683ef8fd346ebdb84ca5cef9d8e8">txpolarity</a>)
<a name="l03485"></a>03485          <a class="code" href="chan__usbradio_8c.html#a9cf2eee5dda3e750f9e6f1cb3e7a09a2">M_BOOL</a>(<span class="stringliteral">&quot;dcsrxpolarity&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a933ce66d291cb7d99d8693683d0a3f7d">b</a>.<a class="code" href="structchan__usbradio__pvt.html#a90c8f70a4bf3a7bd25bc953b500a2769">dcsrxpolarity</a>)
<a name="l03486"></a>03486          <a class="code" href="chan__usbradio_8c.html#a9cf2eee5dda3e750f9e6f1cb3e7a09a2">M_BOOL</a>(<span class="stringliteral">&quot;dcstxpolarity&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a933ce66d291cb7d99d8693683d0a3f7d">b</a>.<a class="code" href="structchan__usbradio__pvt.html#a8ce5dca9e30b5221ff181bda9359cfe3">dcstxpolarity</a>)
<a name="l03487"></a>03487          <a class="code" href="chan__usbradio_8c.html#a9cf2eee5dda3e750f9e6f1cb3e7a09a2">M_BOOL</a>(<span class="stringliteral">&quot;lsdrxpolarity&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a933ce66d291cb7d99d8693683d0a3f7d">b</a>.<a class="code" href="structchan__usbradio__pvt.html#a17edb8653d5bca21fced0355dba0cd74">lsdrxpolarity</a>)
<a name="l03488"></a>03488          <a class="code" href="chan__usbradio_8c.html#a9cf2eee5dda3e750f9e6f1cb3e7a09a2">M_BOOL</a>(<span class="stringliteral">&quot;lsdtxpolarity&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a933ce66d291cb7d99d8693683d0a3f7d">b</a>.<a class="code" href="structchan__usbradio__pvt.html#ab175352db5d8fda4b8d7de3032cfa617">lsdtxpolarity</a>)
<a name="l03489"></a>03489          <a class="code" href="chan__usbradio_8c.html#a9cf2eee5dda3e750f9e6f1cb3e7a09a2">M_BOOL</a>(<span class="stringliteral">&quot;loopback&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a933ce66d291cb7d99d8693683d0a3f7d">b</a>.<a class="code" href="structchan__usbradio__pvt.html#a7e490416a9c7a4cd16c20073ebb848c0">loopback</a>)
<a name="l03490"></a>03490          <a class="code" href="chan__usbradio_8c.html#a9cf2eee5dda3e750f9e6f1cb3e7a09a2">M_BOOL</a>(<span class="stringliteral">&quot;radioactive&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a933ce66d291cb7d99d8693683d0a3f7d">b</a>.<a class="code" href="structchan__usbradio__pvt.html#a698a1a571ceec928fdfc1f04b5ddd4c3">radioactive</a>)
<a name="l03491"></a>03491          <a class="code" href="chan__usbradio_8c.html#aba0c95c713354abf6c6577ed3c110be5">M_UINT</a>(<span class="stringliteral">&quot;rptnum&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a82b1c271bbb3d4dab02712eb367e72e3">rptnum</a>)
<a name="l03492"></a>03492          <a class="code" href="chan__usbradio_8c.html#aba0c95c713354abf6c6577ed3c110be5">M_UINT</a>(<span class="stringliteral">&quot;idleinterval&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ad45b11585c85aeaafbc94e28684c3e85">idleinterval</a>)
<a name="l03493"></a>03493          <a class="code" href="chan__usbradio_8c.html#aba0c95c713354abf6c6577ed3c110be5">M_UINT</a>(<span class="stringliteral">&quot;turnoffs&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#aaf7419abda44cc59ccdbadacf6a250a9">turnoffs</a>)
<a name="l03494"></a>03494          <a class="code" href="chan__usbradio_8c.html#aba0c95c713354abf6c6577ed3c110be5">M_UINT</a>(<span class="stringliteral">&quot;tracetype&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a7fd8a8f77cb943a60709a60b82af18cd">tracetype</a>)
<a name="l03495"></a>03495          <a class="code" href="chan__usbradio_8c.html#aba0c95c713354abf6c6577ed3c110be5">M_UINT</a>(<span class="stringliteral">&quot;tracelevel&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ad04598f0e808d02ac2f9d27f8f3ced05">tracelevel</a>)
<a name="l03496"></a>03496          <a class="code" href="chan__usbradio_8c.html#aba0c95c713354abf6c6577ed3c110be5">M_UINT</a>(<span class="stringliteral">&quot;area&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#aa4e3a1097557045b9c15a09117871dc7">area</a>)
<a name="l03497"></a>03497          <a class="code" href="chan__usbradio_8c.html#a1dbce7eba2a5b0b4aa5905af98dbc9b6">M_STR</a>(<span class="stringliteral">&quot;ukey&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a831424615eef40aa8601615107391569">ukey</a>)
<a name="l03498"></a>03498          <a class="code" href="chan__usbradio_8c.html#a93b8a223d68be1e0f2262e0ffe7f3dfc">M_END</a>(;
<a name="l03499"></a>03499          );
<a name="l03500"></a>03500    }
<a name="l03501"></a>03501 
<a name="l03502"></a>03502    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a8bc52eafdec6e1ab31955b8e407746ba">debuglevel</a>=0;
<a name="l03503"></a>03503 
<a name="l03504"></a>03504    <span class="keywordflow">if</span> (o == &amp;usbradio_default)      <span class="comment">/* we are done with the default */</span>
<a name="l03505"></a>03505       <span class="keywordflow">return</span> NULL;
<a name="l03506"></a>03506 
<a name="l03507"></a>03507    snprintf(fname,<span class="keyword">sizeof</span>(fname) - 1,<a class="code" href="chan__usbradio_8c.html#a06ca1079ac177d8beaafa3286da25297">config1</a>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l03508"></a>03508 <span class="preprocessor">#ifdef   NEW_ASTERISK</span>
<a name="l03509"></a>03509 <span class="preprocessor"></span>   cfg1 = <a class="code" href="config_8h.html#a0a07ddd6bbcf44485e01c14c96109482">ast_config_load</a>(fname,zeroflag);
<a name="l03510"></a>03510 <span class="preprocessor">#else</span>
<a name="l03511"></a>03511 <span class="preprocessor"></span>   cfg1 = <a class="code" href="config_8h.html#a0a07ddd6bbcf44485e01c14c96109482">ast_config_load</a>(fname);
<a name="l03512"></a>03512 <span class="preprocessor">#endif</span>
<a name="l03513"></a>03513 <span class="preprocessor"></span>   o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a959ccc7bd4988d55f4115fd5b13e236e">rxmixerset</a> = 500;
<a name="l03514"></a>03514    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5dca179fe41743d80bd66e6a21de9fac">txmixaset</a> = 500;
<a name="l03515"></a>03515    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac2c2424ad6a5ca0a0c6f7026e74d7701">txmixbset</a> = 500;
<a name="l03516"></a>03516    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0d9da32dc6edbbd18f90722056331b65">rxvoiceadj</a> = 0.5;
<a name="l03517"></a>03517    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0da461807e1a48746fd856ae6aa21499">rxctcssadj</a> = 0.5;
<a name="l03518"></a>03518    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af559c722569892f0612ff5c65493fe7a">txctcssadj</a> = 200;
<a name="l03519"></a>03519    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a1745424fe0dd99b7d3a778a253a5d686">rxsquelchadj</a> = 500;
<a name="l03520"></a>03520    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ae0013a0ec03c2c35c2966c6aa3147abd">devstr</a>[0] = 0;
<a name="l03521"></a>03521    <span class="keywordflow">if</span> (cfg1 &amp;&amp; cfg1 != <a class="code" href="config_8h.html#a8d1a63cdf2c7aff22a77b6e75d93b377">CONFIG_STATUS_FILEINVALID</a>) {
<a name="l03522"></a>03522       <span class="keywordflow">for</span> (v = <a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(cfg1, o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5ac083a645d964373f022d03df4849c8">name</a>); v; v = v-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l03523"></a>03523    
<a name="l03524"></a>03524          <a class="code" href="chan__usbradio_8c.html#aa8507593fc6a5ac8a4dda99c3ac5e024">M_START</a>((<span class="keywordtype">char</span> *)v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, (<span class="keywordtype">char</span> *)v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l03525"></a>03525          <a class="code" href="chan__usbradio_8c.html#aba0c95c713354abf6c6577ed3c110be5">M_UINT</a>(<span class="stringliteral">&quot;rxmixerset&quot;</span>, o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a959ccc7bd4988d55f4115fd5b13e236e">rxmixerset</a>)
<a name="l03526"></a>03526          <a class="code" href="chan__usbradio_8c.html#aba0c95c713354abf6c6577ed3c110be5">M_UINT</a>(<span class="stringliteral">&quot;txmixaset&quot;</span>, o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5dca179fe41743d80bd66e6a21de9fac">txmixaset</a>)
<a name="l03527"></a>03527          <a class="code" href="chan__usbradio_8c.html#aba0c95c713354abf6c6577ed3c110be5">M_UINT</a>(<span class="stringliteral">&quot;txmixbset&quot;</span>, o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac2c2424ad6a5ca0a0c6f7026e74d7701">txmixbset</a>)
<a name="l03528"></a>03528          <a class="code" href="chan__usbradio_8c.html#a7772197db782e85b4e2fba2d641b592d">M_F</a>(<span class="stringliteral">&quot;rxvoiceadj&quot;</span>,<a class="code" href="chan__usbradio_8c.html#afa72be179ff3f7bba9433c7d2c8e26b3">store_rxvoiceadj</a>(o,(<span class="keywordtype">char</span> *)v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>))
<a name="l03529"></a>03529          <a class="code" href="chan__usbradio_8c.html#a7772197db782e85b4e2fba2d641b592d">M_F</a>(<span class="stringliteral">&quot;rxctcssadj&quot;</span>,<a class="code" href="chan__usbradio_8c.html#ab4beef9a9d6b261e45d685e178bbe790">store_rxctcssadj</a>(o,(<span class="keywordtype">char</span> *)v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>))
<a name="l03530"></a>03530          <a class="code" href="chan__usbradio_8c.html#aba0c95c713354abf6c6577ed3c110be5">M_UINT</a>(<span class="stringliteral">&quot;txctcssadj&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af559c722569892f0612ff5c65493fe7a">txctcssadj</a>);
<a name="l03531"></a>03531          <a class="code" href="chan__usbradio_8c.html#aba0c95c713354abf6c6577ed3c110be5">M_UINT</a>(<span class="stringliteral">&quot;rxsquelchadj&quot;</span>, o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a1745424fe0dd99b7d3a778a253a5d686">rxsquelchadj</a>)
<a name="l03532"></a>03532          <a class="code" href="chan__usbradio_8c.html#a1dbce7eba2a5b0b4aa5905af98dbc9b6">M_STR</a>(<span class="stringliteral">&quot;devstr&quot;</span>, o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ae0013a0ec03c2c35c2966c6aa3147abd">devstr</a>)
<a name="l03533"></a>03533          <a class="code" href="chan__usbradio_8c.html#a93b8a223d68be1e0f2262e0ffe7f3dfc">M_END</a>(;
<a name="l03534"></a>03534          );
<a name="l03535"></a>03535       }
<a name="l03536"></a>03536       <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(cfg1);
<a name="l03537"></a>03537    } <span class="keywordflow">else</span> <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,<span class="stringliteral">&quot;File %s not found, using default parameters.\n&quot;</span>,fname);
<a name="l03538"></a>03538 
<a name="l03539"></a>03539    <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ae6df055b2352a39c3f2f781a17c6ba62">wanteeprom</a>)
<a name="l03540"></a>03540    {
<a name="l03541"></a>03541       <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0cb029a4ba4ae628b6f5431a4cbb753f">eepromlock</a>);
<a name="l03542"></a>03542       <span class="keywordflow">while</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#aa4c4270e4903db2dcb2ee7e3a7966ca3">eepromctl</a>)
<a name="l03543"></a>03543       {
<a name="l03544"></a>03544          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0cb029a4ba4ae628b6f5431a4cbb753f">eepromlock</a>);
<a name="l03545"></a>03545          usleep(10000);
<a name="l03546"></a>03546          <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0cb029a4ba4ae628b6f5431a4cbb753f">eepromlock</a>);
<a name="l03547"></a>03547       }
<a name="l03548"></a>03548       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#aa4c4270e4903db2dcb2ee7e3a7966ca3">eepromctl</a> = 1;  <span class="comment">/* request a load */</span>
<a name="l03549"></a>03549       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0cb029a4ba4ae628b6f5431a4cbb753f">eepromlock</a>);
<a name="l03550"></a>03550    }
<a name="l03551"></a>03551    <span class="comment">/* if our specified one exists in the list */</span>
<a name="l03552"></a>03552    <span class="keywordflow">if</span> ((!<a class="code" href="chan__usbradio_8c.html#a76b23f8d7a6306e67da3636fa9e463f1">usb_list_check</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ae0013a0ec03c2c35c2966c6aa3147abd">devstr</a>)) || <a class="code" href="chan__usbradio_8c.html#a17bc28c0dd48dd624e682fd416c4754b">find_desc_usb</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ae0013a0ec03c2c35c2966c6aa3147abd">devstr</a>))
<a name="l03553"></a>03553    {
<a name="l03554"></a>03554       <span class="keywordtype">char</span> *s;
<a name="l03555"></a>03555 
<a name="l03556"></a>03556       <span class="keywordflow">for</span>(s = usb_device_list; *s; s += strlen(s) + 1)
<a name="l03557"></a>03557       {
<a name="l03558"></a>03558          <span class="keywordflow">if</span> (!<a class="code" href="chan__usbradio_8c.html#a17bc28c0dd48dd624e682fd416c4754b">find_desc_usb</a>(s)) <span class="keywordflow">break</span>;
<a name="l03559"></a>03559       }
<a name="l03560"></a>03560       <span class="keywordflow">if</span> (!*s)
<a name="l03561"></a>03561       {
<a name="l03562"></a>03562          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,<span class="stringliteral">&quot;Unable to assign USB device for channel %s\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l03563"></a>03563          <span class="keywordflow">goto</span> error;
<a name="l03564"></a>03564       }
<a name="l03565"></a>03565       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;Assigned USB device %s to usbradio channel %s\n&quot;</span>,s,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l03566"></a>03566       strcpy(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ae0013a0ec03c2c35c2966c6aa3147abd">devstr</a>,s);
<a name="l03567"></a>03567    }
<a name="l03568"></a>03568 
<a name="l03569"></a>03569    i = <a class="code" href="chan__usbradio_8c.html#ac031edcda7e4fff124d7fd93f3a13f13">usb_get_usbdev</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ae0013a0ec03c2c35c2966c6aa3147abd">devstr</a>);
<a name="l03570"></a>03570    <span class="keywordflow">if</span> (i &lt; 0)
<a name="l03571"></a>03571    {
<a name="l03572"></a>03572            <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,<span class="stringliteral">&quot;Not able to find alsa USB device\n&quot;</span>);
<a name="l03573"></a>03573       <span class="keywordflow">goto</span> error;
<a name="l03574"></a>03574    }
<a name="l03575"></a>03575    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a7d942ce6a2ddec93dc13684d61b1750d">devicenum</a> = i;
<a name="l03576"></a>03576 
<a name="l03577"></a>03577    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ad73045328563e3ea5f9fbc8c3ce9ad09">micmax</a> = <a class="code" href="chan__usbradio_8c.html#ae23fe39aa9a878be7a5330fe96f18146">amixer_max</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a7d942ce6a2ddec93dc13684d61b1750d">devicenum</a>,<a class="code" href="chan__usbradio_8c.html#acdbe8da16d20178447b63f536bf8b9f9">MIXER_PARAM_MIC_CAPTURE_VOL</a>);
<a name="l03578"></a>03578    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a726770ecafcfd5375796acf427cde947">spkrmax</a> = <a class="code" href="chan__usbradio_8c.html#ae23fe39aa9a878be7a5330fe96f18146">amixer_max</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a7d942ce6a2ddec93dc13684d61b1750d">devicenum</a>,<a class="code" href="chan__usbradio_8c.html#ad1cc3a63000c040db5c5e20836d039ae">MIXER_PARAM_SPKR_PLAYBACK_VOL</a>);
<a name="l03579"></a>03579    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a335ae1f9f7ea2bc5d6cd92a35bb675c3">lastopen</a> = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>(); <span class="comment">/* don&apos;t leave it 0 or tvdiff may wrap */</span>
<a name="l03580"></a>03580    o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d">dsp</a> = <a class="code" href="dsp_8h.html#a0a60e93006c8e1ca8fda922ae0e0da2c">ast_dsp_new</a>();
<a name="l03581"></a>03581    <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d">dsp</a>)
<a name="l03582"></a>03582    {
<a name="l03583"></a>03583 <span class="preprocessor">#ifdef   NEW_ASTERISK</span>
<a name="l03584"></a>03584 <span class="preprocessor"></span>     <a class="code" href="dsp_8h.html#aedc7fa20fba91e3c018f6989e95c714b" title="Select feature set.">ast_dsp_set_features</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d">dsp</a>,<a class="code" href="dsp_8h.html#a84818b360426bdd5f588cdca463e15be">DSP_FEATURE_DIGIT_DETECT</a>);
<a name="l03585"></a>03585      <a class="code" href="dsp_8h.html#aa28ffa065bd46d09b5b06de2f77183b0" title="Set digit mode.">ast_dsp_set_digitmode</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d">dsp</a>,<a class="code" href="dsp_8h.html#af0e16e88030540319d8a545dd7c2576c">DSP_DIGITMODE_DTMF</a> | <a class="code" href="dsp_8h.html#aa34f768f0cae2ee8f2db1e8f57f02b21">DSP_DIGITMODE_MUTECONF</a> | <a class="code" href="dsp_8h.html#af955a2d9ad32683d8d783619480cd348">DSP_DIGITMODE_RELAXDTMF</a>);
<a name="l03586"></a>03586 <span class="preprocessor">#else</span>
<a name="l03587"></a>03587 <span class="preprocessor"></span>     <a class="code" href="dsp_8h.html#aedc7fa20fba91e3c018f6989e95c714b" title="Select feature set.">ast_dsp_set_features</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d">dsp</a>,DSP_FEATURE_DTMF_DETECT);
<a name="l03588"></a>03588      ast_dsp_digitmode(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d">dsp</a>,<a class="code" href="dsp_8h.html#af0e16e88030540319d8a545dd7c2576c">DSP_DIGITMODE_DTMF</a> | <a class="code" href="dsp_8h.html#aa34f768f0cae2ee8f2db1e8f57f02b21">DSP_DIGITMODE_MUTECONF</a> | <a class="code" href="dsp_8h.html#af955a2d9ad32683d8d783619480cd348">DSP_DIGITMODE_RELAXDTMF</a>);
<a name="l03589"></a>03589 <span class="preprocessor">#endif</span>
<a name="l03590"></a>03590 <span class="preprocessor"></span>   }
<a name="l03591"></a>03591 
<a name="l03592"></a>03592    <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>==NULL)
<a name="l03593"></a>03593    {
<a name="l03594"></a>03594       t_pmr_chan tChan;
<a name="l03595"></a>03595 
<a name="l03596"></a>03596       <span class="comment">// ast_log(LOG_NOTICE,&quot;createPmrChannel() %s\n&quot;,o-&gt;name);</span>
<a name="l03597"></a>03597       memset(&amp;tChan,0,<span class="keyword">sizeof</span>(t_pmr_chan));
<a name="l03598"></a>03598 
<a name="l03599"></a>03599       tChan.pTxCodeDefault = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#aac82d4d77ee6a45db6720b0a47f9f052">txctcssdefault</a>;
<a name="l03600"></a>03600       tChan.pRxCodeSrc     = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af828234faebaeded2f34d586b3402407">rxctcssfreqs</a>;
<a name="l03601"></a>03601       tChan.pTxCodeSrc     = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af02b209a6fcc5a72be847eb6ff43a200">txctcssfreqs</a>;
<a name="l03602"></a>03602 
<a name="l03603"></a>03603       tChan.rxDemod=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a192b610a400b0092bbf865fa8cd60a44">rxdemod</a>;
<a name="l03604"></a>03604       tChan.rxCdType=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#af7351b2441759672562708b11cd8fedd">rxcdtype</a>;
<a name="l03605"></a>03605       tChan.rxSqVoxAdj=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a4dc1e577c75292544b37eb803938b63b">rxsqvoxadj</a>;
<a name="l03606"></a>03606 
<a name="l03607"></a>03607       <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ad75faa99a995d1f7847a2c0ae50b58df">txprelim</a>) 
<a name="l03608"></a>03608          tChan.txMod = 2;
<a name="l03609"></a>03609 
<a name="l03610"></a>03610       tChan.txMixA = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a95a57d28620e96b54f510eb9a543ddfc">txmixa</a>;
<a name="l03611"></a>03611       tChan.txMixB = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a6cf7fb2913ee1a3c50247dd8f6ea32a4">txmixb</a>;
<a name="l03612"></a>03612 
<a name="l03613"></a>03613       tChan.rxCpuSaver=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac1ba9d4ea02ed0233e32f29f904ba717">rxcpusaver</a>;
<a name="l03614"></a>03614       tChan.txCpuSaver=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a599ff3f902292ed29218ddea9ec3945e">txcpusaver</a>;
<a name="l03615"></a>03615 
<a name="l03616"></a>03616       tChan.b.rxpolarity=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a933ce66d291cb7d99d8693683d0a3f7d">b</a>.<a class="code" href="structchan__usbradio__pvt.html#a8b35b6a9c58966a7570a6fde53c7d0b0">rxpolarity</a>;
<a name="l03617"></a>03617       tChan.b.txpolarity=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a933ce66d291cb7d99d8693683d0a3f7d">b</a>.<a class="code" href="structchan__usbradio__pvt.html#a0501683ef8fd346ebdb84ca5cef9d8e8">txpolarity</a>;
<a name="l03618"></a>03618 
<a name="l03619"></a>03619       tChan.b.dcsrxpolarity=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a933ce66d291cb7d99d8693683d0a3f7d">b</a>.<a class="code" href="structchan__usbradio__pvt.html#a90c8f70a4bf3a7bd25bc953b500a2769">dcsrxpolarity</a>;
<a name="l03620"></a>03620       tChan.b.dcstxpolarity=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a933ce66d291cb7d99d8693683d0a3f7d">b</a>.<a class="code" href="structchan__usbradio__pvt.html#a8ce5dca9e30b5221ff181bda9359cfe3">dcstxpolarity</a>;
<a name="l03621"></a>03621 
<a name="l03622"></a>03622       tChan.b.lsdrxpolarity=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a933ce66d291cb7d99d8693683d0a3f7d">b</a>.<a class="code" href="structchan__usbradio__pvt.html#a17edb8653d5bca21fced0355dba0cd74">lsdrxpolarity</a>;
<a name="l03623"></a>03623       tChan.b.lsdtxpolarity=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a933ce66d291cb7d99d8693683d0a3f7d">b</a>.<a class="code" href="structchan__usbradio__pvt.html#ab175352db5d8fda4b8d7de3032cfa617">lsdtxpolarity</a>;
<a name="l03624"></a>03624 
<a name="l03625"></a>03625       tChan.tracetype=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a7fd8a8f77cb943a60709a60b82af18cd">tracetype</a>;
<a name="l03626"></a>03626       tChan.tracelevel=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ad04598f0e808d02ac2f9d27f8f3ced05">tracelevel</a>;
<a name="l03627"></a>03627       tChan.rptnum=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a82b1c271bbb3d4dab02712eb367e72e3">rptnum</a>;
<a name="l03628"></a>03628       tChan.idleinterval=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ad45b11585c85aeaafbc94e28684c3e85">idleinterval</a>;
<a name="l03629"></a>03629       tChan.turnoffs=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#aaf7419abda44cc59ccdbadacf6a250a9">turnoffs</a>;
<a name="l03630"></a>03630       tChan.area=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#aa4e3a1097557045b9c15a09117871dc7">area</a>;
<a name="l03631"></a>03631       tChan.ukey=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a831424615eef40aa8601615107391569">ukey</a>;
<a name="l03632"></a>03632       tChan.name=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5ac083a645d964373f022d03df4849c8">name</a>;
<a name="l03633"></a>03633 
<a name="l03634"></a>03634       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>=createPmrChannel(&amp;tChan,FRAME_SIZE);
<a name="l03635"></a>03635                             
<a name="l03636"></a>03636       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;radioDuplex=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a49cf136c1442f0e05adaf095f3dfb06d">radioduplex</a>;
<a name="l03637"></a>03637       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;b.loopback=0; 
<a name="l03638"></a>03638       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;txsettletime=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a4dbf7524c8b604e6ccc0823482472217">txsettletime</a>;
<a name="l03639"></a>03639       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;rxCpuSaver=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac1ba9d4ea02ed0233e32f29f904ba717">rxcpusaver</a>;
<a name="l03640"></a>03640       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;txCpuSaver=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a599ff3f902292ed29218ddea9ec3945e">txcpusaver</a>;
<a name="l03641"></a>03641 
<a name="l03642"></a>03642       *(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;prxSquelchAdjust) = 
<a name="l03643"></a>03643          ((999 - o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a1745424fe0dd99b7d3a778a253a5d686">rxsquelchadj</a>) * 32767) / 1000;
<a name="l03644"></a>03644 
<a name="l03645"></a>03645       *(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;prxVoiceAdjust)=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0d9da32dc6edbbd18f90722056331b65">rxvoiceadj</a>*M_Q8;
<a name="l03646"></a>03646       *(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;prxCtcssAdjust)=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0da461807e1a48746fd856ae6aa21499">rxctcssadj</a>*M_Q8;
<a name="l03647"></a>03647       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;rxCtcss-&gt;relax=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a0ef47a421f5dd8fd85a847519642615f">rxctcssrelax</a>;
<a name="l03648"></a>03648       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>-&gt;txTocType = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a543f5a1359459a66235d463f755245e3">txtoctype</a>;
<a name="l03649"></a>03649 
<a name="l03650"></a>03650         <span class="keywordflow">if</span> (    (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a95a57d28620e96b54f510eb9a543ddfc">txmixa</a> == <a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051ea10815a225284305f3f93416f07a85cb7">TX_OUT_LSD</a>) ||
<a name="l03651"></a>03651                 (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a95a57d28620e96b54f510eb9a543ddfc">txmixa</a> == <a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051eaea61167af07104aee49cea1568e356ec">TX_OUT_COMPOSITE</a>) ||
<a name="l03652"></a>03652                 (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a6cf7fb2913ee1a3c50247dd8f6ea32a4">txmixb</a> == <a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051ea10815a225284305f3f93416f07a85cb7">TX_OUT_LSD</a>) ||
<a name="l03653"></a>03653                 (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a6cf7fb2913ee1a3c50247dd8f6ea32a4">txmixb</a> == <a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051eaea61167af07104aee49cea1568e356ec">TX_OUT_COMPOSITE</a>))
<a name="l03654"></a>03654         {
<a name="l03655"></a>03655                 <a class="code" href="chan__usbradio_8c.html#abf334b349b8cb56932ef975dadfbb7df">set_txctcss_level</a>(o);
<a name="l03656"></a>03656         }
<a name="l03657"></a>03657 
<a name="l03658"></a>03658       <span class="keywordflow">if</span>( (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a95a57d28620e96b54f510eb9a543ddfc">txmixa</a>!=<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051eaccdce3522c59395383ad570f8ee57acd">TX_OUT_VOICE</a>) &amp;&amp; (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a6cf7fb2913ee1a3c50247dd8f6ea32a4">txmixb</a>!=<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051eaccdce3522c59395383ad570f8ee57acd">TX_OUT_VOICE</a>) &amp;&amp;
<a name="l03659"></a>03659          (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a95a57d28620e96b54f510eb9a543ddfc">txmixa</a>!=<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051eaea61167af07104aee49cea1568e356ec">TX_OUT_COMPOSITE</a>) &amp;&amp; (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a6cf7fb2913ee1a3c50247dd8f6ea32a4">txmixb</a>!=<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051eaea61167af07104aee49cea1568e356ec">TX_OUT_COMPOSITE</a>)
<a name="l03660"></a>03660         )
<a name="l03661"></a>03661       {
<a name="l03662"></a>03662          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,<span class="stringliteral">&quot;No txvoice output configured.\n&quot;</span>);
<a name="l03663"></a>03663       }
<a name="l03664"></a>03664    
<a name="l03665"></a>03665       <span class="keywordflow">if</span>( o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a020b18a1a2da0a7290a6ad0547ff1070">txctcssfreq</a>[0] &amp;&amp; 
<a name="l03666"></a>03666           o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a95a57d28620e96b54f510eb9a543ddfc">txmixa</a>!=<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051ea10815a225284305f3f93416f07a85cb7">TX_OUT_LSD</a> &amp;&amp; o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a95a57d28620e96b54f510eb9a543ddfc">txmixa</a>!=<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051eaea61167af07104aee49cea1568e356ec">TX_OUT_COMPOSITE</a>  &amp;&amp;
<a name="l03667"></a>03667          o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a6cf7fb2913ee1a3c50247dd8f6ea32a4">txmixb</a>!=<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051ea10815a225284305f3f93416f07a85cb7">TX_OUT_LSD</a> &amp;&amp; o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a6cf7fb2913ee1a3c50247dd8f6ea32a4">txmixb</a>!=<a class="code" href="chan__usbradio_8c.html#a7859c0a3efa8b1c360f5c2376baf051eaea61167af07104aee49cea1568e356ec">TX_OUT_COMPOSITE</a>
<a name="l03668"></a>03668         )
<a name="l03669"></a>03669       {
<a name="l03670"></a>03670          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,<span class="stringliteral">&quot;No txtone output configured.\n&quot;</span>);
<a name="l03671"></a>03671       }
<a name="l03672"></a>03672       
<a name="l03673"></a>03673       <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a933ce66d291cb7d99d8693683d0a3f7d">b</a>.<a class="code" href="structchan__usbradio__pvt.html#a698a1a571ceec928fdfc1f04b5ddd4c3">radioactive</a>)
<a name="l03674"></a>03674       {
<a name="l03675"></a>03675           <span class="comment">// 20080328 sphenke asdf maw !!!</span>
<a name="l03676"></a>03676           <span class="comment">// this diagnostic option was working but now appears broken</span>
<a name="l03677"></a>03677          <span class="comment">// it&apos;s not required for operation so I&apos;ll fix it later.</span>
<a name="l03678"></a>03678          <span class="comment">//struct chan_usbradio_pvt *ao;</span>
<a name="l03679"></a>03679          <span class="comment">//for (ao = usbradio_default.next; ao &amp;&amp; ao-&gt;name ; ao = ao-&gt;next)ao-&gt;pmrChan-&gt;b.radioactive=0;</span>
<a name="l03680"></a>03680          usbradio_active = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5ac083a645d964373f022d03df4849c8">name</a>;
<a name="l03681"></a>03681          <span class="comment">// o-&gt;pmrChan-&gt;b.radioactive=1;</span>
<a name="l03682"></a>03682          <span class="comment">//o-&gt;b.radioactive=0;</span>
<a name="l03683"></a>03683          <span class="comment">//o-&gt;pmrChan-&gt;b.radioactive=0;</span>
<a name="l03684"></a>03684          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;radio active set to [%s]\n&quot;</span>,o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l03685"></a>03685       }
<a name="l03686"></a>03686    }
<a name="l03687"></a>03687 
<a name="l03688"></a>03688    <a class="code" href="chan__usbradio_8c.html#a5f60010431301ac2b329a1910776855d">xpmr_config</a>(o);
<a name="l03689"></a>03689 
<a name="l03690"></a>03690    TRACEO(1,(<span class="stringliteral">&quot;store_config() 120\n&quot;</span>));
<a name="l03691"></a>03691    <a class="code" href="chan__usbradio_8c.html#aa2020bdc5a2688a4727e349befacb35d">mixer_write</a>(o);
<a name="l03692"></a>03692    TRACEO(1,(<span class="stringliteral">&quot;store_config() 130\n&quot;</span>));
<a name="l03693"></a>03693    <a class="code" href="chan__usbradio_8c.html#acb41a83bcd08bfc92fb24c6ece7830c0">mult_set</a>(o);    
<a name="l03694"></a>03694    TRACEO(1,(<span class="stringliteral">&quot;store_config() 140\n&quot;</span>));
<a name="l03695"></a>03695    <a class="code" href="chan__usbradio_8c.html#a7dda562f378c1ca89125358f201373a0">hidhdwconfig</a>(o);
<a name="l03696"></a>03696 
<a name="l03697"></a>03697    TRACEO(1,(<span class="stringliteral">&quot;store_config() 200\n&quot;</span>));
<a name="l03698"></a>03698 
<a name="l03699"></a>03699 <span class="preprocessor">#ifndef  NEW_ASTERISK</span>
<a name="l03700"></a>03700 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (pipe(o-&gt;sndcmd) != 0) {
<a name="l03701"></a>03701       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to create pipe\n&quot;</span>);
<a name="l03702"></a>03702       <span class="keywordflow">goto</span> error;
<a name="l03703"></a>03703    }
<a name="l03704"></a>03704 
<a name="l03705"></a>03705    <a class="code" href="utils_8h.html#a595e2f8aa398f4bd21e381c3211235fe">ast_pthread_create_background</a>(&amp;o-&gt;sthread, NULL, sound_thread, o);
<a name="l03706"></a>03706 <span class="preprocessor">#endif</span>
<a name="l03707"></a>03707 <span class="preprocessor"></span>
<a name="l03708"></a>03708    <span class="comment">/* link into list of devices */</span>
<a name="l03709"></a>03709    <span class="keywordflow">if</span> (o != &amp;usbradio_default) {
<a name="l03710"></a>03710       o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9f87d8717635cfb958525ea3b179ff4f">next</a> = usbradio_default.<a class="code" href="structchan__usbradio__pvt.html#a9f87d8717635cfb958525ea3b179ff4f">next</a>;
<a name="l03711"></a>03711       usbradio_default.<a class="code" href="structchan__usbradio__pvt.html#a9f87d8717635cfb958525ea3b179ff4f">next</a> = o;
<a name="l03712"></a>03712    }
<a name="l03713"></a>03713    TRACEO(1,(<span class="stringliteral">&quot;store_config() complete\n&quot;</span>));
<a name="l03714"></a>03714    <span class="keywordflow">return</span> o;
<a name="l03715"></a>03715   
<a name="l03716"></a>03716   error:
<a name="l03717"></a>03717    <span class="keywordflow">if</span> (o != &amp;usbradio_default)
<a name="l03718"></a>03718       <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(o);
<a name="l03719"></a>03719    <span class="keywordflow">return</span> NULL;
<a name="l03720"></a>03720 }
<a name="l03721"></a>03721 
<a name="l03722"></a>03722 
<a name="l03723"></a>03723 <span class="preprocessor">#if   DEBUG_FILETEST == 1</span>
<a name="l03724"></a>03724 <span class="preprocessor"></span><span class="comment">/*</span>
<a name="l03725"></a>03725 <span class="comment">   Test It on a File</span>
<a name="l03726"></a>03726 <span class="comment">*/</span>
<a name="l03727"></a>03727 <span class="keywordtype">int</span> RxTestIt(<span class="keyword">struct</span> <a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o)
<a name="l03728"></a>03728 {
<a name="l03729"></a>03729    <span class="keyword">const</span> <span class="keywordtype">int</span> numSamples = SAMPLES_PER_BLOCK;
<a name="l03730"></a>03730    <span class="keyword">const</span> <span class="keywordtype">int</span> numChannels = 16;
<a name="l03731"></a>03731 
<a name="l03732"></a>03732    i16 sample,i,ii;
<a name="l03733"></a>03733    
<a name="l03734"></a>03734    i32 txHangTime;
<a name="l03735"></a>03735 
<a name="l03736"></a>03736    i16 txEnable;
<a name="l03737"></a>03737 
<a name="l03738"></a>03738    t_pmr_chan  tChan;
<a name="l03739"></a>03739    t_pmr_chan *pChan;
<a name="l03740"></a>03740 
<a name="l03741"></a>03741    FILE *hInput=NULL, *hOutput=NULL, *hOutputTx=NULL;
<a name="l03742"></a>03742  
<a name="l03743"></a>03743    i16 iBuff[numSamples*2*6], oBuff[numSamples];
<a name="l03744"></a>03744               
<a name="l03745"></a>03745    printf(<span class="stringliteral">&quot;RxTestIt()\n&quot;</span>);
<a name="l03746"></a>03746 
<a name="l03747"></a>03747    pChan=o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>;
<a name="l03748"></a>03748    pChan-&gt;b.txCapture=1;
<a name="l03749"></a>03749    pChan-&gt;b.rxCapture=1;
<a name="l03750"></a>03750 
<a name="l03751"></a>03751    txEnable = 0;
<a name="l03752"></a>03752 
<a name="l03753"></a>03753    hInput  = fopen(<span class="stringliteral">&quot;/usr/src/xpmr/testdata/rx_in.pcm&quot;</span>,<span class="stringliteral">&quot;r&quot;</span>);
<a name="l03754"></a>03754    <span class="keywordflow">if</span>(!hInput){
<a name="l03755"></a>03755       printf(<span class="stringliteral">&quot; RxTestIt() File Not Found.\n&quot;</span>);
<a name="l03756"></a>03756       <span class="keywordflow">return</span> 0;
<a name="l03757"></a>03757    }
<a name="l03758"></a>03758    hOutput = fopen(<span class="stringliteral">&quot;/usr/src/xpmr/testdata/rx_debug.pcm&quot;</span>,<span class="stringliteral">&quot;w&quot;</span>);
<a name="l03759"></a>03759 
<a name="l03760"></a>03760    printf(<span class="stringliteral">&quot; RxTestIt() Working...\n&quot;</span>);
<a name="l03761"></a>03761             
<a name="l03762"></a>03762    <span class="keywordflow">while</span>(!feof(hInput))
<a name="l03763"></a>03763    {
<a name="l03764"></a>03764       fread((<span class="keywordtype">void</span> *)iBuff,2,numSamples*2*6,hInput);
<a name="l03765"></a>03765        
<a name="l03766"></a>03766       <span class="keywordflow">if</span>(txHangTime)txHangTime-=numSamples;
<a name="l03767"></a>03767       <span class="keywordflow">if</span>(txHangTime&lt;0)txHangTime=0;
<a name="l03768"></a>03768       
<a name="l03769"></a>03769       <span class="keywordflow">if</span>(pChan-&gt;rxCtcss-&gt;decode)txHangTime=(8000/1000*2000);
<a name="l03770"></a>03770 
<a name="l03771"></a>03771       <span class="keywordflow">if</span>(pChan-&gt;rxCtcss-&gt;decode &amp;&amp; !txEnable)
<a name="l03772"></a>03772       {
<a name="l03773"></a>03773          txEnable=1;
<a name="l03774"></a>03774          <span class="comment">//pChan-&gt;inputBlanking=(8000/1000*200);</span>
<a name="l03775"></a>03775       }
<a name="l03776"></a>03776       <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!pChan-&gt;rxCtcss-&gt;decode &amp;&amp; txEnable)
<a name="l03777"></a>03777       {
<a name="l03778"></a>03778          txEnable=0; 
<a name="l03779"></a>03779       }
<a name="l03780"></a>03780 
<a name="l03781"></a>03781       PmrRx(pChan,iBuff,oBuff);
<a name="l03782"></a>03782 
<a name="l03783"></a>03783       <span class="keywordflow">if</span> (<a class="code" href="ast__expr2f_8c.html#a8541b986268a39ba1b07d9e912d31732">fwrite</a>((<span class="keywordtype">void</span> *)pChan-&gt;prxDebug,2,numSamples*numChannels,hOutput) != numSamples * numChannels) {
<a name="l03784"></a>03784          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;fwrite() failed: %s\n&quot;</span>, strerror(errno));
<a name="l03785"></a>03785       }
<a name="l03786"></a>03786    }
<a name="l03787"></a>03787    pChan-&gt;b.txCapture=0;
<a name="l03788"></a>03788    pChan-&gt;b.rxCapture=0;
<a name="l03789"></a>03789 
<a name="l03790"></a>03790    <span class="keywordflow">if</span>(hInput)fclose(hInput);
<a name="l03791"></a>03791    <span class="keywordflow">if</span>(hOutput)fclose(hOutput);
<a name="l03792"></a>03792 
<a name="l03793"></a>03793    printf(<span class="stringliteral">&quot; RxTestIt() Complete.\n&quot;</span>);
<a name="l03794"></a>03794 
<a name="l03795"></a>03795    <span class="keywordflow">return</span> 0;
<a name="l03796"></a>03796 }
<a name="l03797"></a>03797 <span class="preprocessor">#endif</span>
<a name="l03798"></a>03798 <span class="preprocessor"></span>
<a name="l03799"></a>03799 <span class="preprocessor">#ifdef   NEW_ASTERISK</span>
<a name="l03800"></a>03800 <span class="preprocessor"></span>
<a name="l03801"></a><a class="code" href="chan__usbradio_8c.html#a46891b794a61c74327d6ba4a5397e33f">03801</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="chan__usbradio_8c.html#a46891b794a61c74327d6ba4a5397e33f">res2cli</a>(<span class="keywordtype">int</span> r)
<a name="l03802"></a>03802 
<a name="l03803"></a>03803 {
<a name="l03804"></a>03804    <span class="keywordflow">switch</span> (r)
<a name="l03805"></a>03805    {
<a name="l03806"></a>03806        <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a7cc1753a05a0821f6c70dd2bccfbab5c">RESULT_SUCCESS</a>:
<a name="l03807"></a>03807       <span class="keywordflow">return</span>(<a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>);
<a name="l03808"></a>03808        <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a76ed22cec1f42c93a5b4eed8d967338f">RESULT_SHOWUSAGE</a>:
<a name="l03809"></a>03809       <span class="keywordflow">return</span>(<a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>);
<a name="l03810"></a>03810        <span class="keywordflow">default</span>:
<a name="l03811"></a>03811       <span class="keywordflow">return</span>(<a class="code" href="cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>);
<a name="l03812"></a>03812    }
<a name="l03813"></a>03813 }
<a name="l03814"></a>03814 
<a name="l03815"></a><a class="code" href="chan__usbradio_8c.html#ad0b1208cda772f6716ce55281fa66c4b">03815</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="chan__usbradio_8c.html#ad0b1208cda772f6716ce55281fa66c4b">handle_console_key</a>(<span class="keyword">struct</span> <a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a> *e,
<a name="l03816"></a>03816    <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="structast__cli__args.html">ast_cli_args</a> *a)
<a name="l03817"></a>03817 {
<a name="l03818"></a>03818    <span class="keywordtype">char</span> *argv[] = { <span class="stringliteral">&quot;radio&quot;</span>, <span class="stringliteral">&quot;key&quot;</span>, NULL };
<a name="l03819"></a>03819 
<a name="l03820"></a>03820         <span class="keywordflow">switch</span> (cmd) {
<a name="l03821"></a>03821         <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l03822"></a>03822                 e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;radio key&quot;</span>;
<a name="l03823"></a>03823                 e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> = key_usage;
<a name="l03824"></a>03824                 <span class="keywordflow">return</span> NULL;
<a name="l03825"></a>03825         <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l03826"></a>03826                 <span class="keywordflow">return</span> NULL;
<a name="l03827"></a>03827    }
<a name="l03828"></a>03828    <span class="keywordflow">return</span> <a class="code" href="chan__usbradio_8c.html#a46891b794a61c74327d6ba4a5397e33f">res2cli</a>(<a class="code" href="chan__usbradio_8c.html#aaf9f0b89166c9c97cdfdf91be3b56ad0">console_key</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, 2, argv));
<a name="l03829"></a>03829 }
<a name="l03830"></a>03830 
<a name="l03831"></a><a class="code" href="chan__usbradio_8c.html#a2b03c3d7b392dd6197bb4bf8e3ef1d73">03831</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="chan__usbradio_8c.html#a2b03c3d7b392dd6197bb4bf8e3ef1d73">handle_console_unkey</a>(<span class="keyword">struct</span> <a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a> *e,
<a name="l03832"></a>03832    <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="structast__cli__args.html">ast_cli_args</a> *a)
<a name="l03833"></a>03833 {
<a name="l03834"></a>03834    <span class="keywordtype">char</span> *argv[] = { <span class="stringliteral">&quot;radio&quot;</span>, <span class="stringliteral">&quot;unkey&quot;</span>, NULL };
<a name="l03835"></a>03835         <span class="keywordflow">switch</span> (cmd) {
<a name="l03836"></a>03836         <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l03837"></a>03837                 e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;radio unkey&quot;</span>;
<a name="l03838"></a>03838                 e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> = unkey_usage;
<a name="l03839"></a>03839                 <span class="keywordflow">return</span> NULL;
<a name="l03840"></a>03840         <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l03841"></a>03841                 <span class="keywordflow">return</span> NULL;
<a name="l03842"></a>03842    }
<a name="l03843"></a>03843    <span class="keywordflow">return</span> <a class="code" href="chan__usbradio_8c.html#a46891b794a61c74327d6ba4a5397e33f">res2cli</a>(<a class="code" href="chan__usbradio_8c.html#ad1564ccfbcf28ec9273f510493793545">console_unkey</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, 2, argv));
<a name="l03844"></a>03844 }
<a name="l03845"></a>03845 
<a name="l03846"></a><a class="code" href="chan__usbradio_8c.html#a14fe5633f636dc2ea460b932c2dcdb62">03846</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="chan__usbradio_8c.html#a14fe5633f636dc2ea460b932c2dcdb62">handle_radio_tune</a>(<span class="keyword">struct</span> <a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a> *e,
<a name="l03847"></a>03847    <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="structast__cli__args.html">ast_cli_args</a> *a)
<a name="l03848"></a>03848 {
<a name="l03849"></a>03849    <span class="keywordtype">char</span> *argv[5] = { <span class="stringliteral">&quot;radio&quot;</span>, <span class="stringliteral">&quot;tune&quot;</span>, a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> &gt; 2 ? (<span class="keywordtype">char</span> *) a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[2] : NULL, a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> &gt; 3 ? (<span class="keywordtype">char</span> *) a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3] : NULL };
<a name="l03850"></a>03850         <span class="keywordflow">switch</span> (cmd) {
<a name="l03851"></a>03851         <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l03852"></a>03852                 e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;radio tune&quot;</span>;
<a name="l03853"></a>03853                 e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> = radio_tune_usage;
<a name="l03854"></a>03854                 <span class="keywordflow">return</span> NULL;
<a name="l03855"></a>03855         <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l03856"></a>03856                 <span class="keywordflow">return</span> NULL;
<a name="l03857"></a>03857    }
<a name="l03858"></a>03858    <span class="keywordflow">return</span> <a class="code" href="chan__usbradio_8c.html#a46891b794a61c74327d6ba4a5397e33f">res2cli</a>(<a class="code" href="chan__usbradio_8c.html#a5ec1e35fe999569ee78fcb9b035e235f">radio_tune</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a>, argv));
<a name="l03859"></a>03859 }
<a name="l03860"></a>03860 
<a name="l03861"></a><a class="code" href="chan__usbradio_8c.html#a9ce71cefd68c7a16013e17439a8434f3">03861</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="chan__usbradio_8c.html#a9ce71cefd68c7a16013e17439a8434f3">handle_radio_debug</a>(<span class="keyword">struct</span> <a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a> *e,
<a name="l03862"></a>03862    <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="structast__cli__args.html">ast_cli_args</a> *a)
<a name="l03863"></a>03863 {
<a name="l03864"></a>03864         <span class="keywordflow">switch</span> (cmd) {
<a name="l03865"></a>03865         <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l03866"></a>03866                 e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;radio debug&quot;</span>;
<a name="l03867"></a>03867                 e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> = radio_tune_usage;
<a name="l03868"></a>03868                 <span class="keywordflow">return</span> NULL;
<a name="l03869"></a>03869         <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l03870"></a>03870                 <span class="keywordflow">return</span> NULL;
<a name="l03871"></a>03871    }
<a name="l03872"></a>03872    <span class="keywordflow">return</span> <a class="code" href="chan__usbradio_8c.html#a46891b794a61c74327d6ba4a5397e33f">res2cli</a>(<a class="code" href="chan__usbradio_8c.html#ad912cb21af19858d008bb8d4356b0f7b">radio_set_debug</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a>, NULL <span class="comment">/* ignored */</span>));
<a name="l03873"></a>03873 }
<a name="l03874"></a>03874 
<a name="l03875"></a><a class="code" href="chan__usbradio_8c.html#a1954694bb687dd8032c05d2cf4b797fb">03875</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="chan__usbradio_8c.html#a1954694bb687dd8032c05d2cf4b797fb">handle_radio_debug_off</a>(<span class="keyword">struct</span> <a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a> *e,
<a name="l03876"></a>03876    <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="structast__cli__args.html">ast_cli_args</a> *a)
<a name="l03877"></a>03877 {
<a name="l03878"></a>03878         <span class="keywordflow">switch</span> (cmd) {
<a name="l03879"></a>03879         <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l03880"></a>03880                 e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;radio debug off&quot;</span>;
<a name="l03881"></a>03881                 e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> = radio_tune_usage;
<a name="l03882"></a>03882                 <span class="keywordflow">return</span> NULL;
<a name="l03883"></a>03883         <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l03884"></a>03884                 <span class="keywordflow">return</span> NULL;
<a name="l03885"></a>03885    }
<a name="l03886"></a>03886    <span class="keywordflow">return</span> <a class="code" href="chan__usbradio_8c.html#a46891b794a61c74327d6ba4a5397e33f">res2cli</a>(<a class="code" href="chan__usbradio_8c.html#a637e38da389743f92b2152a27aa09d19">radio_set_debug_off</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a>, NULL <span class="comment">/* ignored */</span>));
<a name="l03887"></a>03887 }
<a name="l03888"></a>03888 
<a name="l03889"></a><a class="code" href="chan__usbradio_8c.html#a6349df5c93018ad4f54ee957c6f11447">03889</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="chan__usbradio_8c.html#a6349df5c93018ad4f54ee957c6f11447">handle_radio_active</a>(<span class="keyword">struct</span> <a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a> *e,
<a name="l03890"></a>03890    <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="structast__cli__args.html">ast_cli_args</a> *a)
<a name="l03891"></a>03891 {
<a name="l03892"></a>03892    <span class="keywordtype">char</span> *argv[4] = { <span class="stringliteral">&quot;radio&quot;</span>, <span class="stringliteral">&quot;active&quot;</span>, a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> &gt; 2 ? (<span class="keywordtype">char</span> *) a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[2] : NULL, };
<a name="l03893"></a>03893         <span class="keywordflow">switch</span> (cmd) {
<a name="l03894"></a>03894         <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l03895"></a>03895                 e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;radio active&quot;</span>;
<a name="l03896"></a>03896                 e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> = active_usage;
<a name="l03897"></a>03897                 <span class="keywordflow">return</span> NULL;
<a name="l03898"></a>03898         <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l03899"></a>03899                 <span class="keywordflow">return</span> NULL;
<a name="l03900"></a>03900    }
<a name="l03901"></a>03901    <span class="keywordflow">return</span> <a class="code" href="chan__usbradio_8c.html#a46891b794a61c74327d6ba4a5397e33f">res2cli</a>(<a class="code" href="chan__usbradio_8c.html#a51162f45e26983094b79f8a3aa07c3bf">radio_active</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a>, argv));
<a name="l03902"></a>03902 }
<a name="l03903"></a>03903 
<a name="l03904"></a><a class="code" href="chan__usbradio_8c.html#a9eb5f3c2f604affc28a1028d4db9751f">03904</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="chan__usbradio_8c.html#a9eb5f3c2f604affc28a1028d4db9751f">handle_set_xdebug</a>(<span class="keyword">struct</span> <a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a> *e,
<a name="l03905"></a>03905    <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="structast__cli__args.html">ast_cli_args</a> *a)
<a name="l03906"></a>03906 {
<a name="l03907"></a>03907    <span class="keywordtype">char</span> *argv[5] = { <span class="stringliteral">&quot;radio&quot;</span>, <span class="stringliteral">&quot;set&quot;</span>, <span class="stringliteral">&quot;xdebug&quot;</span>, a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> == 4 ? (<span class="keywordtype">char</span> *) a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3] : NULL, };
<a name="l03908"></a>03908         <span class="keywordflow">switch</span> (cmd) {
<a name="l03909"></a>03909         <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l03910"></a>03910                 e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;radio set xdebug&quot;</span>;
<a name="l03911"></a>03911                 e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> = active_usage;
<a name="l03912"></a>03912                 <span class="keywordflow">return</span> NULL;
<a name="l03913"></a>03913         <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l03914"></a>03914                 <span class="keywordflow">return</span> NULL;
<a name="l03915"></a>03915    }
<a name="l03916"></a>03916    <span class="keywordflow">return</span> <a class="code" href="chan__usbradio_8c.html#a46891b794a61c74327d6ba4a5397e33f">res2cli</a>(<a class="code" href="chan__usbradio_8c.html#a23a2cbdf67c12b687b9d7c5fc2a8aa4f">radio_set_xpmr_debug</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a>, argv));
<a name="l03917"></a>03917 }
<a name="l03918"></a>03918 
<a name="l03919"></a>03919 
<a name="l03920"></a><a class="code" href="chan__usbradio_8c.html#a80881fd2557d5d8ade6c66926b958cf3">03920</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a> cli_usbradio[] = {
<a name="l03921"></a>03921    <a class="code" href="cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="chan__usbradio_8c.html#ad0b1208cda772f6716ce55281fa66c4b">handle_console_key</a>,<span class="stringliteral">&quot;Simulate Rx Signal Present&quot;</span>),
<a name="l03922"></a>03922    <a class="code" href="cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="chan__usbradio_8c.html#a2b03c3d7b392dd6197bb4bf8e3ef1d73">handle_console_unkey</a>,<span class="stringliteral">&quot;Simulate Rx Signal Loss&quot;</span>),
<a name="l03923"></a>03923    <a class="code" href="cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="chan__usbradio_8c.html#a14fe5633f636dc2ea460b932c2dcdb62">handle_radio_tune</a>,<span class="stringliteral">&quot;Radio Tune&quot;</span>),
<a name="l03924"></a>03924    <a class="code" href="cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="chan__usbradio_8c.html#a9ce71cefd68c7a16013e17439a8434f3">handle_radio_debug</a>,<span class="stringliteral">&quot;Radio Debug On&quot;</span>),
<a name="l03925"></a>03925    <a class="code" href="cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="chan__usbradio_8c.html#a1954694bb687dd8032c05d2cf4b797fb">handle_radio_debug_off</a>,<span class="stringliteral">&quot;Radio Debug Off&quot;</span>),
<a name="l03926"></a>03926    <a class="code" href="cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="chan__usbradio_8c.html#a6349df5c93018ad4f54ee957c6f11447">handle_radio_active</a>,<span class="stringliteral">&quot;Change commanded device&quot;</span>),
<a name="l03927"></a>03927    <a class="code" href="cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="chan__usbradio_8c.html#a9eb5f3c2f604affc28a1028d4db9751f">handle_set_xdebug</a>,<span class="stringliteral">&quot;Radio set xpmr debug level&quot;</span>)
<a name="l03928"></a>03928 };
<a name="l03929"></a>03929 
<a name="l03930"></a>03930 <span class="preprocessor">#endif</span>
<a name="l03931"></a>03931 <span class="preprocessor"></span>
<a name="l03932"></a>03932 <span class="preprocessor">#include &quot;./xpmr/xpmr.c&quot;</span>
<a name="l03933"></a>03933 <span class="preprocessor">#ifdef HAVE_XPMRX</span>
<a name="l03934"></a>03934 <span class="preprocessor"></span><span class="preprocessor">#include &quot;./xpmrx/xpmrx.c&quot;</span>
<a name="l03935"></a>03935 <span class="preprocessor">#endif</span>
<a name="l03936"></a>03936 <span class="preprocessor"></span>
<a name="l03937"></a>03937 <span class="comment">/*</span>
<a name="l03938"></a>03938 <span class="comment">*/</span>
<a name="l03939"></a><a class="code" href="chan__usbradio_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">03939</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="chan__usbradio_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a>(<span class="keywordtype">void</span>)
<a name="l03940"></a>03940 {
<a name="l03941"></a>03941    <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *cfg = NULL;
<a name="l03942"></a>03942    <span class="keywordtype">char</span> *ctg = NULL;
<a name="l03943"></a>03943 <span class="preprocessor">#ifdef   NEW_ASTERISK</span>
<a name="l03944"></a>03944 <span class="preprocessor"></span>   <span class="keyword">struct </span><a class="code" href="structast__flags.html" title="Structure used to handle boolean flags.">ast_flags</a> zeroflag = {0};
<a name="l03945"></a>03945 <span class="preprocessor">#endif</span>
<a name="l03946"></a>03946 <span class="preprocessor"></span>
<a name="l03947"></a>03947    <span class="keywordflow">if</span> (<a class="code" href="chan__usbradio_8c.html#a9d38322b0cd6a6736d6cc6221a202594">hid_device_mklist</a>()) {
<a name="l03948"></a>03948       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Unable to make hid list\n&quot;</span>);
<a name="l03949"></a>03949       <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;
<a name="l03950"></a>03950    }
<a name="l03951"></a>03951 
<a name="l03952"></a>03952    <a class="code" href="chan__usbradio_8c.html#a76b23f8d7a6306e67da3636fa9e463f1">usb_list_check</a>(<span class="stringliteral">&quot;&quot;</span>);
<a name="l03953"></a>03953 
<a name="l03954"></a>03954    usbradio_active = NULL;
<a name="l03955"></a>03955 
<a name="l03956"></a>03956    <span class="comment">/* Copy the default jb config over global_jbconf */</span>
<a name="l03957"></a>03957    memcpy(&amp;<a class="code" href="chan__usbradio_8c.html#abaabcb7f4349cc632dde3af5c6a5e1bd">global_jbconf</a>, &amp;default_jbconf, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structast__jb__conf.html" title="General jitterbuffer configuration.">ast_jb_conf</a>));
<a name="l03958"></a>03958 
<a name="l03959"></a>03959    <span class="comment">/* load config file */</span>
<a name="l03960"></a>03960 <span class="preprocessor">#ifdef   NEW_ASTERISK</span>
<a name="l03961"></a>03961 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (!(cfg = <a class="code" href="config_8h.html#a0a07ddd6bbcf44485e01c14c96109482">ast_config_load</a>(config,zeroflag)) || cfg == <a class="code" href="config_8h.html#a8d1a63cdf2c7aff22a77b6e75d93b377">CONFIG_STATUS_FILEINVALID</a>) {
<a name="l03962"></a>03962 <span class="preprocessor">#else</span>
<a name="l03963"></a>03963 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (!(cfg = <a class="code" href="config_8h.html#a0a07ddd6bbcf44485e01c14c96109482">ast_config_load</a>(config))) || cfg == <a class="code" href="config_8h.html#a8d1a63cdf2c7aff22a77b6e75d93b377">CONFIG_STATUS_FILEINVALID</a> {
<a name="l03964"></a>03964 <span class="preprocessor">#endif</span>
<a name="l03965"></a>03965 <span class="preprocessor"></span>      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Unable to load config %s\n&quot;</span>, config);
<a name="l03966"></a>03966       <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;
<a name="l03967"></a>03967    }
<a name="l03968"></a>03968 
<a name="l03969"></a>03969    <span class="keywordflow">do</span> {
<a name="l03970"></a>03970       <a class="code" href="chan__usbradio_8c.html#a2c1a9ed1de775bf9e05ce3f5268894af">store_config</a>(cfg, ctg);
<a name="l03971"></a>03971    } <span class="keywordflow">while</span> ( (ctg = <a class="code" href="config_8h.html#a611776300f941a63266cb220ac62b4db" title="Goes through categories.">ast_category_browse</a>(cfg, ctg)) != NULL);
<a name="l03972"></a>03972 
<a name="l03973"></a>03973    <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(cfg);
<a name="l03974"></a>03974 
<a name="l03975"></a>03975    <span class="keywordflow">if</span> (<a class="code" href="chan__usbradio_8c.html#ac7145e9cf19c5cf2a51fcdb3e747eabe">find_desc</a>(usbradio_active) == NULL) {
<a name="l03976"></a>03976       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;radio active device %s not found\n&quot;</span>, usbradio_active);
<a name="l03977"></a>03977       <span class="comment">/* XXX we could default to &apos;dsp&apos; perhaps ? */</span>
<a name="l03978"></a>03978       <span class="comment">/* XXX should cleanup allocated memory etc. */</span>
<a name="l03979"></a>03979       <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfa8724da3ad620df86524280e760add388">AST_MODULE_LOAD_FAILURE</a>;
<a name="l03980"></a>03980    }
<a name="l03981"></a>03981 
<a name="l03982"></a>03982    <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#ab5f3776fda943e52820ceeee5835c1b4" title="Register a channel technology (a new channel driver) Called by a channel module to...">ast_channel_register</a>(&amp;usbradio_tech)) {
<a name="l03983"></a>03983       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to register channel type &apos;usb&apos;\n&quot;</span>);
<a name="l03984"></a>03984       <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfa8724da3ad620df86524280e760add388">AST_MODULE_LOAD_FAILURE</a>;
<a name="l03985"></a>03985    }
<a name="l03986"></a>03986 
<a name="l03987"></a>03987    <a class="code" href="cli_8h.html#aadeef34f3106bb78aeb3414032ad7fb7" title="Register multiple commands.">ast_cli_register_multiple</a>(cli_usbradio, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(cli_usbradio));
<a name="l03988"></a>03988 
<a name="l03989"></a>03989    <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a>;
<a name="l03990"></a>03990 }
<a name="l03991"></a>03991 <span class="comment">/*</span>
<a name="l03992"></a>03992 <span class="comment">*/</span>
<a name="l03993"></a><a class="code" href="chan__usbradio_8c.html#ad09fa931f468002152a3cc2d5ce25eae">03993</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="agent_8c.html#a95bac1db604c69a01ef7b3995342cd7a">unload_module</a>(<span class="keywordtype">void</span>)
<a name="l03994"></a>03994 {
<a name="l03995"></a>03995    <span class="keyword">struct </span><a class="code" href="structchan__usbradio__pvt.html">chan_usbradio_pvt</a> *o;
<a name="l03996"></a>03996 
<a name="l03997"></a>03997    <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;unload_module() called\n&quot;</span>);
<a name="l03998"></a>03998 
<a name="l03999"></a>03999    <a class="code" href="channel_8h.html#a53b708b7fc71dcbcd33acae0ad4d7ef8" title="Unregister a channel technology.">ast_channel_unregister</a>(&amp;usbradio_tech);
<a name="l04000"></a>04000    <a class="code" href="cli_8h.html#a56b6b59ee2eaa994597a5b0f4e9f9d09" title="Unregister multiple commands.">ast_cli_unregister_multiple</a>(cli_usbradio, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(cli_usbradio));
<a name="l04001"></a>04001 
<a name="l04002"></a>04002    <span class="keywordflow">for</span> (o = usbradio_default.<a class="code" href="structchan__usbradio__pvt.html#a9f87d8717635cfb958525ea3b179ff4f">next</a>; o; o = o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9f87d8717635cfb958525ea3b179ff4f">next</a>) {
<a name="l04003"></a>04003 
<a name="l04004"></a>04004       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;destroyPmrChannel() called\n&quot;</span>);
<a name="l04005"></a>04005       <span class="keywordflow">if</span>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>)destroyPmrChannel(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a3a94de40d5d2eecc0ce74b0e11ab9f6c">pmrChan</a>);
<a name="l04006"></a>04006       
<a name="l04007"></a>04007 <span class="preprocessor">      #if DEBUG_CAPTURES == 1</span>
<a name="l04008"></a>04008 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (frxcapraw) { fclose(frxcapraw); frxcapraw = NULL; }
<a name="l04009"></a>04009       <span class="keywordflow">if</span> (frxcaptrace) { fclose(frxcaptrace); frxcaptrace = NULL; }
<a name="l04010"></a>04010       <span class="keywordflow">if</span> (frxoutraw) { fclose(frxoutraw); frxoutraw = NULL; }
<a name="l04011"></a>04011       <span class="keywordflow">if</span> (ftxcapraw) { fclose(ftxcapraw); ftxcapraw = NULL; }
<a name="l04012"></a>04012       <span class="keywordflow">if</span> (ftxcaptrace) { fclose(ftxcaptrace); ftxcaptrace = NULL; }
<a name="l04013"></a>04013       <span class="keywordflow">if</span> (ftxoutraw) { fclose(ftxoutraw); ftxoutraw = NULL; }
<a name="l04014"></a>04014 <span class="preprocessor">      #endif</span>
<a name="l04015"></a>04015 <span class="preprocessor"></span>
<a name="l04016"></a>04016       close(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ac3fb672ce98321ddfeba0b02fba73298">sounddev</a>);
<a name="l04017"></a>04017 <span class="preprocessor">#ifndef  NEW_ASTERISK</span>
<a name="l04018"></a>04018 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (o-&gt;sndcmd[0] &gt; 0) {
<a name="l04019"></a>04019          close(o-&gt;sndcmd[0]);
<a name="l04020"></a>04020          close(o-&gt;sndcmd[1]);
<a name="l04021"></a>04021       }
<a name="l04022"></a>04022 <span class="preprocessor">#endif</span>
<a name="l04023"></a>04023 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d">dsp</a>) <a class="code" href="dsp_8h.html#a0a57a1e374549eb2705068688f4046db">ast_dsp_free</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#ab9deccb020b39c3f7ac94b1af99cac5d">dsp</a>);
<a name="l04024"></a>04024       <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)
<a name="l04025"></a>04025          <a class="code" href="channel_8h.html#ac2d6607253f7e8b272d4e845474eaa9b" title="Softly hangup up a channel.">ast_softhangup</a>(o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709aeeafae6abd77156800ec76b0ff7d3867">AST_SOFTHANGUP_APPUNLOAD</a>);
<a name="l04026"></a>04026       <span class="keywordflow">if</span> (o-&gt;<a class="code" href="structchan__usbradio__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)        <span class="comment">/* XXX how ??? */</span>
<a name="l04027"></a>04027          <span class="keywordflow">return</span> -1;
<a name="l04028"></a>04028       <span class="comment">/* XXX what about the thread ? */</span>
<a name="l04029"></a>04029       <span class="comment">/* XXX what about the memory allocated ? */</span>
<a name="l04030"></a>04030    }
<a name="l04031"></a>04031    <span class="keywordflow">return</span> 0;
<a name="l04032"></a>04032 }
<a name="l04033"></a>04033 
<a name="l04034"></a>04034 <a class="code" href="module_8h.html#a70ea6b2dde349dfaae4d21d93b9a5683">AST_MODULE_INFO_STANDARD</a>(<a class="code" href="module_8h.html#aba2c8d4be709a254658b21a834f8294a" title="The text the key() function should return.">ASTERISK_GPL_KEY</a>, <span class="stringliteral">&quot;usb Console Channel Driver&quot;</span>);
<a name="l04035"></a>04035 
<a name="l04036"></a>04036 <span class="comment">/* end of file */</span>
<a name="l04037"></a>04037 
<a name="l04038"></a>04038 
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:18:37 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
