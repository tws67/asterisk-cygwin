<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:23:34 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_0ca6ff3bf6b340411b2c6edd15b1a34d.html">channels</a>
  </div>
</div>
<div class="contents">
<h1>vcodecs.c File Reference</h1><code>#include &quot;<a class="el" href="asterisk_8h_source.html">asterisk.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="console__video_8h_source.html">console_video.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="frame_8h_source.html">asterisk/frame.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="utils_8h_source.html">asterisk/utils.h</a>&quot;</code><br/>

<p><a href="vcodecs_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct__cm.html">_cm</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structvideo__codec__desc.html">video_codec_desc</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structvideo__dec__desc.html">video_dec_desc</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#aa4007d13f9870b72148401231645cfba">H261_MIN_LEN</a>&nbsp;&nbsp;&nbsp;10</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#ac365005a57578e13321e99b4f7032a25">H263_MIN_LEN</a>&nbsp;&nbsp;&nbsp;6</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#ab4eb9668d17077a876591fc738a4dafe">HAVE_NAL</a>(x)&nbsp;&nbsp;&nbsp;(x[-4] == 0 &amp;&amp; x[-3] == 0 &amp;&amp; x[-2] == 0 &amp;&amp; x[-1] == 1)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#ae76825d684a0a161d3213795c7a8867e">N_DEC_IN</a>&nbsp;&nbsp;&nbsp;3</td></tr>
<tr><td colspan="2"><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef int(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#a2795d75dba244cca0dc2dc93ba290f85">decoder_decap_f</a> )(struct <a class="el" href="structfbuf__t.html">fbuf_t</a> *b, uint8_t *data, int len)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">extract the bitstream from RTP frames and store in the fbuf. return 0 if ok, 1 on error  <a href="#a2795d75dba244cca0dc2dc93ba290f85"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef int(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#a50fedf4a6e3a304d7b550ed5fcea7b2b">decoder_decode_f</a> )(struct <a class="el" href="structvideo__dec__desc.html">video_dec_desc</a> *v, struct <a class="el" href="structfbuf__t.html">fbuf_t</a> *b)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">actually call the decoder  <a href="#a50fedf4a6e3a304d7b550ed5fcea7b2b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef int(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#a3f800ea0e281e3970b392d52027c2930">decoder_init_f</a> )(AVCodecContext *enc_ctx)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">inizialize the decoder  <a href="#a3f800ea0e281e3970b392d52027c2930"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structast__frame.html">ast_frame</a> *(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#a609e04dbfb8c3472ac1a7481a54a12b6">encoder_encap_f</a> )(struct <a class="el" href="structfbuf__t.html">fbuf_t</a> *, int mtu, struct <a class="el" href="structast__frame.html">ast_frame</a> **tail)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">encapsulate the bistream in RTP frames  <a href="#a609e04dbfb8c3472ac1a7481a54a12b6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef int(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#adfabe5b0e939753b78db791f7efef0ae">encoder_encode_f</a> )(struct video_out_desc *v)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">actually call the encoder  <a href="#adfabe5b0e939753b78db791f7efef0ae"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef int(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#a3cab2f51c81316b531b35172b6bc4faa">encoder_init_f</a> )(AVCodecContext *v)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">initialize the encoder  <a href="#a3cab2f51c81316b531b35172b6bc4faa"></a><br/></td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#a892b5df711685dfbc8e1dcb14ac0e9a4">create_video_frame</a> (uint8_t *start, uint8_t *end, int <a class="el" href="chan__alsa_8c.html#a98f5e70e98f6dc48e3c5ba316066d540">format</a>, int head, struct <a class="el" href="structast__frame.html">ast_frame</a> *prev)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structvideo__dec__desc.html">video_dec_desc</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#adf1b00c3eef8629454179095a4dee452">dec_init</a> (uint32_t the_ast_format)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structvideo__dec__desc.html">video_dec_desc</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#a20dec20142208a77ce05a2246c72af26">dec_uninit</a> (struct <a class="el" href="structvideo__dec__desc.html">video_dec_desc</a> *v)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">uninitialize the descriptor for remote video stream  <a href="#a20dec20142208a77ce05a2246c72af26"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#a9673830c01bbadf4a9ace67169bf1719">fbuf_append</a> (struct <a class="el" href="structfbuf__t.html">fbuf_t</a> *b, uint8_t *src, int len, int sbit, int ebit)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#a194580c755d45fc41594b398fb70f119">ffmpeg_decode</a> (struct <a class="el" href="structvideo__dec__desc.html">video_dec_desc</a> *v, struct <a class="el" href="structfbuf__t.html">fbuf_t</a> *b)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#a20c9a18ff6f22a167ce3461070f8158a">ffmpeg_encode</a> (struct video_out_desc *v)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#a20b21523defe433fb3592547704787d6">h261_decap</a> (struct <a class="el" href="structfbuf__t.html">fbuf_t</a> *b, uint8_t *data, int len)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#a6c9e0930c255c8fe0a58fc8eb9a7ad74">h261_enc_init</a> (AVCodecContext *enc_ctx)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#a6632508d014f0ae86a0d282e5fcd5a49">h261_encap</a> (struct <a class="el" href="structfbuf__t.html">fbuf_t</a> *b, int mtu, struct <a class="el" href="structast__frame.html">ast_frame</a> **tail)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#a0e50c7cf90da944ba943261f9bcdfc84">h263_decap</a> (struct <a class="el" href="structfbuf__t.html">fbuf_t</a> *b, uint8_t *data, int len)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#a1c1b88d3283b5462a70874104c28439a">h263_enc_init</a> (AVCodecContext *enc_ctx)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#a8ddf5156d8e17f9ce737b68a8955e799">h263_encap</a> (struct <a class="el" href="structfbuf__t.html">fbuf_t</a> *b, int mtu, struct <a class="el" href="structast__frame.html">ast_frame</a> **tail)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#a9c8cb3acefa3f2825fb6c5515a1fc791">h263p_decap</a> (struct <a class="el" href="structfbuf__t.html">fbuf_t</a> *b, uint8_t *data, int len)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">extract the bitstreem from the RTP payload. This is format dependent. For h263+, the format is defined in RFC 2429 and basically has a fixed 2-byte header as follows: 5 bits RR reserved, shall be 0 1 bit P indicate a start/end condition, in which case the payload should be prepended by two zero-valued bytes. 1 bit V there is an additional VRC header after this header 6 bits PLEN length in bytes of extra picture header 3 bits PEBIT how many bits to be ignored in the last byte  <a href="#a9c8cb3acefa3f2825fb6c5515a1fc791"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#a35a454f50b41cb933796d096d3d37c9a">h263p_enc_init</a> (AVCodecContext *enc_ctx)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">initialization of h263p  <a href="#a35a454f50b41cb933796d096d3d37c9a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#ab4480005bfb416a5085c8d59582ce0c9">h263p_encap</a> (struct <a class="el" href="structfbuf__t.html">fbuf_t</a> *b, int mtu, struct <a class="el" href="structast__frame.html">ast_frame</a> **tail)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#a6da3894d832e07cc1048f3138e308c6e">h264_dec_init</a> (AVCodecContext *dec_ctx)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#aad0a57d8277f76d3bd871900ede66b18">h264_decap</a> (struct <a class="el" href="structfbuf__t.html">fbuf_t</a> *b, uint8_t *data, int len)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#a11bf5ca42fa94928cda691876fdb983d">h264_enc_init</a> (AVCodecContext *enc_ctx)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#a28fe96bf04296634ce2ce6b98efb84db">h264_encap</a> (struct <a class="el" href="structfbuf__t.html">fbuf_t</a> *b, int mtu, struct <a class="el" href="structast__frame.html">ast_frame</a> **tail)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structvideo__codec__desc.html">video_codec_desc</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#a3baa52b8258840aa068a6ab2a0e043ae">map_video_codec</a> (int fmt)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static enum CodecID&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#a79c6a44f6d03b49cd202cc86822e39eb">map_video_format</a> (uint32_t <a class="el" href="structast__format.html">ast_format</a>, int rw)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">map an asterisk format into an ffmpeg one  <a href="#a79c6a44f6d03b49cd202cc86822e39eb"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#a7b7ef85d92b560b5821062376b6d16e0">mpeg4_decap</a> (struct <a class="el" href="structfbuf__t.html">fbuf_t</a> *b, uint8_t *data, int len)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#a5314faf28d69c699c3b007a727fdc02a">mpeg4_decode</a> (struct <a class="el" href="structvideo__dec__desc.html">video_dec_desc</a> *v, struct <a class="el" href="structfbuf__t.html">fbuf_t</a> *b)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#a7cfea23475a1a6cbb996e75d321b4b2f">mpeg4_enc_init</a> (AVCodecContext *enc_ctx)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#a5db3aec009dc4a928c6def805d9cc962">mpeg4_encap</a> (struct <a class="el" href="structfbuf__t.html">fbuf_t</a> *b, int mtu, struct <a class="el" href="structast__frame.html">ast_frame</a> **tail)</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structvideo__codec__desc.html">video_codec_desc</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#acf1392eab8a042722e340e508711acf8">h261_codec</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structvideo__codec__desc.html">video_codec_desc</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#ae8ad59fa39ac2d9011b2c3f2bb1fc18c">h263_codec</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structvideo__codec__desc.html">video_codec_desc</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#a0c232bab64dd9e78d85eac98d52f6122">h263p_codec</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structvideo__codec__desc.html">video_codec_desc</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#a697e4e34d99ca86ae72bfd0ce4f9cf07">h264_codec</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structvideo__codec__desc.html">video_codec_desc</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#a81fa277c9441c83d685042cb8e357a2b">mpeg4_codec</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structvideo__codec__desc.html">video_codec_desc</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#a575da9919296e3bce230be7377758a84">supported_codecs</a> []</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="struct__cm.html">_cm</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="vcodecs_8c.html#a706faac5614a563d399cc21960747b33">video_formats</a> []</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="aa4007d13f9870b72148401231645cfba"></a><!-- doxytag: member="vcodecs.c::H261_MIN_LEN" ref="aa4007d13f9870b72148401231645cfba" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define H261_MIN_LEN&nbsp;&nbsp;&nbsp;10</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="vcodecs_8c_source.html#l00725">h261_encap()</a>.</p>

</div>
</div>
<a class="anchor" id="ac365005a57578e13321e99b4f7032a25"></a><!-- doxytag: member="vcodecs.c::H263_MIN_LEN" ref="ac365005a57578e13321e99b4f7032a25" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define H263_MIN_LEN&nbsp;&nbsp;&nbsp;6</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="vcodecs_8c_source.html#l00571">h263_encap()</a>.</p>

</div>
</div>
<a class="anchor" id="ab4eb9668d17077a876591fc738a4dafe"></a><!-- doxytag: member="vcodecs.c::HAVE_NAL" ref="ab4eb9668d17077a876591fc738a4dafe" args="(x)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HAVE_NAL</td>
          <td>(</td>
          <td class="paramtype">x&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;(x[-4] == 0 &amp;&amp; x[-3] == 0 &amp;&amp; x[-2] == 0 &amp;&amp; x[-1] == 1)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="vcodecs_8c_source.html#l00955">h264_encap()</a>.</p>

</div>
</div>
<a class="anchor" id="ae76825d684a0a161d3213795c7a8867e"></a><!-- doxytag: member="vcodecs.c::N_DEC_IN" ref="ae76825d684a0a161d3213795c7a8867e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define N_DEC_IN&nbsp;&nbsp;&nbsp;3</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="vcodecs_8c_source.html#l00088">88</a> of file <a class="el" href="vcodecs_8c_source.html">vcodecs.c</a>.</p>

<p>Referenced by <a class="el" href="vcodecs_8c_source.html#l01167">dec_uninit()</a>.</p>

</div>
</div>
<hr/><h2>Typedef Documentation</h2>
<a class="anchor" id="a2795d75dba244cca0dc2dc93ba290f85"></a><!-- doxytag: member="vcodecs.c::decoder_decap_f" ref="a2795d75dba244cca0dc2dc93ba290f85" args=")(struct fbuf_t *b, uint8_t *data, int len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef int(* <a class="el" href="vcodecs_8c.html#a2795d75dba244cca0dc2dc93ba290f85">decoder_decap_f</a>)(struct <a class="el" href="structfbuf__t.html">fbuf_t</a> *b, uint8_t *data, int len)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>extract the bitstream from RTP frames and store in the fbuf. return 0 if ok, 1 on error </p>

<p>Definition at line <a class="el" href="vcodecs_8c_source.html#l00050">50</a> of file <a class="el" href="vcodecs_8c_source.html">vcodecs.c</a>.</p>

</div>
</div>
<a class="anchor" id="a50fedf4a6e3a304d7b550ed5fcea7b2b"></a><!-- doxytag: member="vcodecs.c::decoder_decode_f" ref="a50fedf4a6e3a304d7b550ed5fcea7b2b" args=")(struct video_dec_desc *v, struct fbuf_t *b)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef int(* <a class="el" href="vcodecs_8c.html#a50fedf4a6e3a304d7b550ed5fcea7b2b">decoder_decode_f</a>)(struct <a class="el" href="structvideo__dec__desc.html">video_dec_desc</a> *v, struct <a class="el" href="structfbuf__t.html">fbuf_t</a> *b)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>actually call the decoder </p>

<p>Definition at line <a class="el" href="vcodecs_8c_source.html#l00053">53</a> of file <a class="el" href="vcodecs_8c_source.html">vcodecs.c</a>.</p>

</div>
</div>
<a class="anchor" id="a3f800ea0e281e3970b392d52027c2930"></a><!-- doxytag: member="vcodecs.c::decoder_init_f" ref="a3f800ea0e281e3970b392d52027c2930" args=")(AVCodecContext *enc_ctx)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef int(* <a class="el" href="vcodecs_8c.html#a3f800ea0e281e3970b392d52027c2930">decoder_init_f</a>)(AVCodecContext *enc_ctx)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>inizialize the decoder </p>

<p>Definition at line <a class="el" href="vcodecs_8c_source.html#l00045">45</a> of file <a class="el" href="vcodecs_8c_source.html">vcodecs.c</a>.</p>

</div>
</div>
<a class="anchor" id="a609e04dbfb8c3472ac1a7481a54a12b6"></a><!-- doxytag: member="vcodecs.c::encoder_encap_f" ref="a609e04dbfb8c3472ac1a7481a54a12b6" args=")(struct fbuf_t *, int mtu, struct ast_frame **tail)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structast__frame.html">ast_frame</a>*(* <a class="el" href="vcodecs_8c.html#a609e04dbfb8c3472ac1a7481a54a12b6">encoder_encap_f</a>)(struct <a class="el" href="structfbuf__t.html">fbuf_t</a> *, int mtu, struct <a class="el" href="structast__frame.html">ast_frame</a> **tail)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>encapsulate the bistream in RTP frames </p>

<p>Definition at line <a class="el" href="vcodecs_8c_source.html#l00041">41</a> of file <a class="el" href="vcodecs_8c_source.html">vcodecs.c</a>.</p>

</div>
</div>
<a class="anchor" id="adfabe5b0e939753b78db791f7efef0ae"></a><!-- doxytag: member="vcodecs.c::encoder_encode_f" ref="adfabe5b0e939753b78db791f7efef0ae" args=")(struct video_out_desc *v)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef int(* <a class="el" href="vcodecs_8c.html#adfabe5b0e939753b78db791f7efef0ae">encoder_encode_f</a>)(struct video_out_desc *v)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>actually call the encoder </p>

<p>Definition at line <a class="el" href="vcodecs_8c_source.html#l00038">38</a> of file <a class="el" href="vcodecs_8c_source.html">vcodecs.c</a>.</p>

</div>
</div>
<a class="anchor" id="a3cab2f51c81316b531b35172b6bc4faa"></a><!-- doxytag: member="vcodecs.c::encoder_init_f" ref="a3cab2f51c81316b531b35172b6bc4faa" args=")(AVCodecContext *v)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef int(* <a class="el" href="vcodecs_8c.html#a3cab2f51c81316b531b35172b6bc4faa">encoder_init_f</a>)(AVCodecContext *v)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>initialize the encoder </p>

<p>Definition at line <a class="el" href="vcodecs_8c_source.html#l00035">35</a> of file <a class="el" href="vcodecs_8c_source.html">vcodecs.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a892b5df711685dfbc8e1dcb14ac0e9a4"></a><!-- doxytag: member="vcodecs.c::create_video_frame" ref="a892b5df711685dfbc8e1dcb14ac0e9a4" args="(uint8_t *start, uint8_t *end, int format, int head, struct ast_frame *prev)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__frame.html">ast_frame</a>* create_video_frame </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>format</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>head</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td>
          <td class="paramname"> <em>prev</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Build an <a class="el" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> for a given chunk of data, and link it into the queue, with possibly 'head' bytes at the beginning to fill in some fields later. </p>

<p>Definition at line <a class="el" href="vcodecs_8c_source.html#l00224">224</a> of file <a class="el" href="vcodecs_8c_source.html">vcodecs.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="frame_8h_source.html#l00103">AST_FRAME_VIDEO</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="linkedlists_8h_source.html#l00438">AST_LIST_NEXT</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="frame_8h_source.html#l00209">AST_MALLOCD_DATA</a>, <a class="el" href="frame_8h_source.html#l00207">AST_MALLOCD_HDR</a>, <a class="el" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">ast_frame::data</a>, <a class="el" href="frame_8h_source.html#l00147">ast_frame::datalen</a>, <a class="el" href="frame_8h_source.html#l00161">ast_frame::delivery</a>, <a class="el" href="format__g726_8c_source.html#l00177">f</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="func__strings_8c_source.html#l00821">len()</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="frame_8h_source.html#l00151">ast_frame::mallocd</a>, <a class="el" href="frame_8h_source.html#l00155">ast_frame::offset</a>, <a class="el" href="frame_8h_source.html#l00159">ast_frame::ptr</a>, <a class="el" href="frame_8h_source.html#l00149">ast_frame::samples</a>, <a class="el" href="frame_8h_source.html#l00171">ast_frame::seqno</a>, <a class="el" href="frame_8h_source.html#l00157">ast_frame::src</a>, and <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>.</p>

<p>Referenced by <a class="el" href="vcodecs_8c_source.html#l00725">h261_encap()</a>, <a class="el" href="vcodecs_8c_source.html#l00571">h263_encap()</a>, <a class="el" href="vcodecs_8c_source.html#l00356">h263p_encap()</a>, <a class="el" href="vcodecs_8c_source.html#l00955">h264_encap()</a>, and <a class="el" href="vcodecs_8c_source.html#l00867">mpeg4_encap()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00226"></a>00226 {
<a name="l00227"></a>00227    <span class="keywordtype">int</span> <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> = end-start;
<a name="l00228"></a>00228    uint8_t *data;
<a name="l00229"></a>00229    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l00230"></a>00230 
<a name="l00231"></a>00231    data = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, len+head);
<a name="l00232"></a>00232    f = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*f));
<a name="l00233"></a>00233    <span class="keywordflow">if</span> (f == NULL || data == NULL) {
<a name="l00234"></a>00234       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;--- frame error f %p data %p len %d format %d\n&quot;</span>,
<a name="l00235"></a>00235             f, data, len, <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>);
<a name="l00236"></a>00236       <span class="keywordflow">if</span> (f)
<a name="l00237"></a>00237          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(f);
<a name="l00238"></a>00238       <span class="keywordflow">if</span> (data)
<a name="l00239"></a>00239          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(data);
<a name="l00240"></a>00240       <span class="keywordflow">return</span> NULL;
<a name="l00241"></a>00241    }
<a name="l00242"></a>00242    memcpy(data+head, start, len);
<a name="l00243"></a>00243    f-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a> = data;
<a name="l00244"></a>00244    f-&gt;<a class="code" href="structast__frame.html#aed16590d48f41d89f31e0cf347f5cd99">mallocd</a> = <a class="code" href="frame_8h.html#a700f5f786d7e5a985387e5ce40c47a6a">AST_MALLOCD_DATA</a> | <a class="code" href="frame_8h.html#a22c49dfda592a2adb1fbaeaaa6ed3b7f">AST_MALLOCD_HDR</a>;
<a name="l00245"></a>00245    <span class="comment">//f-&gt;has_timing_info = 1;</span>
<a name="l00246"></a>00246    <span class="comment">//f-&gt;ts = ast_tvdiff_ms(ast_tvnow(), out-&gt;ts);</span>
<a name="l00247"></a>00247    f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> = len+head;
<a name="l00248"></a>00248    f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a17ae96b6ea8a2388bb0d409e8124ff30">AST_FRAME_VIDEO</a>;
<a name="l00249"></a>00249    f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>;
<a name="l00250"></a>00250    f-&gt;<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a> = 0;
<a name="l00251"></a>00251    f-&gt;<a class="code" href="structast__frame.html#aed7ea92f45bd273dde380a45ddced592">offset</a> = 0;
<a name="l00252"></a>00252    f-&gt;<a class="code" href="structast__frame.html#af51e37c9331049b1e3d250a7c8bc3c26">src</a> = <span class="stringliteral">&quot;Console&quot;</span>;
<a name="l00253"></a>00253    f-&gt;<a class="code" href="structast__frame.html#a41a708025486b4c9383e7432e9ba3f0e">delivery</a>.tv_sec = 0;
<a name="l00254"></a>00254    f-&gt;<a class="code" href="structast__frame.html#a41a708025486b4c9383e7432e9ba3f0e">delivery</a>.tv_usec = 0;
<a name="l00255"></a>00255    f-&gt;<a class="code" href="structast__frame.html#ab793262012344621455faf9266acbac2">seqno</a> = 0;
<a name="l00256"></a>00256    <a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(f, frame_list) = NULL;
<a name="l00257"></a>00257 
<a name="l00258"></a>00258    <span class="keywordflow">if</span> (prev)
<a name="l00259"></a>00259            <a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(prev, frame_list) = f;
<a name="l00260"></a>00260 
<a name="l00261"></a>00261    <span class="keywordflow">return</span> f;
<a name="l00262"></a>00262 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="adf1b00c3eef8629454179095a4dee452"></a><!-- doxytag: member="vcodecs.c::dec_init" ref="adf1b00c3eef8629454179095a4dee452" args="(uint32_t the_ast_format)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structvideo__dec__desc.html">video_dec_desc</a>* dec_init </td>
          <td>(</td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>the_ast_format</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="vcodecs_8c_source.html#l01199">1199</a> of file <a class="el" href="vcodecs_8c_source.html">vcodecs.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="vcodecs_8c_source.html#l00083">video_dec_desc::codec</a>, <a class="el" href="vcodecs_8c_source.html#l00081">video_dec_desc::d_callbacks</a>, <a class="el" href="vcodecs_8c_source.html#l00084">video_dec_desc::d_frame</a>, <a class="el" href="vcodecs_8c_source.html#l00082">video_dec_desc::dec_ctx</a>, <a class="el" href="vcodecs_8c_source.html#l00091">video_dec_desc::dec_in</a>, <a class="el" href="vcodecs_8c_source.html#l00089">video_dec_desc::dec_in_cur</a>, <a class="el" href="vcodecs_8c_source.html#l00090">video_dec_desc::dec_in_dpy</a>, <a class="el" href="vcodecs_8c_source.html#l01167">dec_uninit()</a>, <a class="el" href="vcodecs_8c_source.html#l00087">video_dec_desc::discard</a>, <a class="el" href="vcodecs_8c_source.html#l00057">video_codec_desc::format</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="vcodecs_8c_source.html#l01153">map_video_codec()</a>, <a class="el" href="vcodecs_8c_source.html#l01129">map_video_format()</a>, and <a class="el" href="vcodecs_8c_source.html#l00085">video_dec_desc::parser</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01200"></a>01200 {
<a name="l01201"></a>01201    <span class="keyword">enum</span> CodecID codec;
<a name="l01202"></a>01202    <span class="keyword">struct </span><a class="code" href="structvideo__dec__desc.html">video_dec_desc</a> *v = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*v));
<a name="l01203"></a>01203    <span class="keywordflow">if</span> (v == NULL)
<a name="l01204"></a>01204       <span class="keywordflow">return</span> NULL;
<a name="l01205"></a>01205 
<a name="l01206"></a>01206    v-&gt;<a class="code" href="structvideo__dec__desc.html#a1e271435c2e72bedc8dd8b85b7f971ac">discard</a> = 1;
<a name="l01207"></a>01207 
<a name="l01208"></a>01208    v-&gt;<a class="code" href="structvideo__dec__desc.html#a75b14c12df26c41bf27a8c18c9c8dabb">d_callbacks</a> = <a class="code" href="vcodecs_8c.html#a3baa52b8258840aa068a6ab2a0e043ae">map_video_codec</a>(the_ast_format);
<a name="l01209"></a>01209    <span class="keywordflow">if</span> (v-&gt;<a class="code" href="structvideo__dec__desc.html#a75b14c12df26c41bf27a8c18c9c8dabb">d_callbacks</a> == NULL) {
<a name="l01210"></a>01210       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;cannot find video codec, drop input 0x%x\n&quot;</span>, the_ast_format);
<a name="l01211"></a>01211       <span class="keywordflow">return</span> <a class="code" href="vcodecs_8c.html#a20dec20142208a77ce05a2246c72af26" title="uninitialize the descriptor for remote video stream">dec_uninit</a>(v);
<a name="l01212"></a>01212    }
<a name="l01213"></a>01213 
<a name="l01214"></a>01214    codec = <a class="code" href="vcodecs_8c.html#a79c6a44f6d03b49cd202cc86822e39eb" title="map an asterisk format into an ffmpeg one">map_video_format</a>(v-&gt;<a class="code" href="structvideo__dec__desc.html#a75b14c12df26c41bf27a8c18c9c8dabb">d_callbacks</a>-&gt;<a class="code" href="structvideo__codec__desc.html#a317afff57d87a89158c2b038d37b2b08">format</a>, CM_RD);
<a name="l01215"></a>01215 
<a name="l01216"></a>01216    v-&gt;<a class="code" href="structvideo__dec__desc.html#a3d92780da6f5146c4f47f425dd151d96">codec</a> = avcodec_find_decoder(codec);
<a name="l01217"></a>01217    <span class="keywordflow">if</span> (!v-&gt;<a class="code" href="structvideo__dec__desc.html#a3d92780da6f5146c4f47f425dd151d96">codec</a>) {
<a name="l01218"></a>01218       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to find the decoder for format %d\n&quot;</span>, codec);
<a name="l01219"></a>01219       <span class="keywordflow">return</span> <a class="code" href="vcodecs_8c.html#a20dec20142208a77ce05a2246c72af26" title="uninitialize the descriptor for remote video stream">dec_uninit</a>(v);
<a name="l01220"></a>01220    }
<a name="l01221"></a>01221    <span class="comment">/*</span>
<a name="l01222"></a>01222 <span class="comment">    * Initialize the codec context.</span>
<a name="l01223"></a>01223 <span class="comment">    */</span>
<a name="l01224"></a>01224    v-&gt;<a class="code" href="structvideo__dec__desc.html#ac2bf6798f37e95d3d2ff2d44e4ab3c12">dec_ctx</a> = avcodec_alloc_context();
<a name="l01225"></a>01225    <span class="keywordflow">if</span> (!v-&gt;<a class="code" href="structvideo__dec__desc.html#ac2bf6798f37e95d3d2ff2d44e4ab3c12">dec_ctx</a>) {
<a name="l01226"></a>01226       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Cannot allocate the decoder context\n&quot;</span>);
<a name="l01227"></a>01227       <span class="keywordflow">return</span> <a class="code" href="vcodecs_8c.html#a20dec20142208a77ce05a2246c72af26" title="uninitialize the descriptor for remote video stream">dec_uninit</a>(v);
<a name="l01228"></a>01228    }
<a name="l01229"></a>01229    <span class="comment">/* XXX call dec_init() ? */</span>
<a name="l01230"></a>01230    <span class="keywordflow">if</span> (avcodec_open(v-&gt;<a class="code" href="structvideo__dec__desc.html#ac2bf6798f37e95d3d2ff2d44e4ab3c12">dec_ctx</a>, v-&gt;<a class="code" href="structvideo__dec__desc.html#a3d92780da6f5146c4f47f425dd151d96">codec</a>) &lt; 0) {
<a name="l01231"></a>01231       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Cannot open the decoder context\n&quot;</span>);
<a name="l01232"></a>01232       av_free(v-&gt;<a class="code" href="structvideo__dec__desc.html#ac2bf6798f37e95d3d2ff2d44e4ab3c12">dec_ctx</a>);
<a name="l01233"></a>01233       v-&gt;<a class="code" href="structvideo__dec__desc.html#ac2bf6798f37e95d3d2ff2d44e4ab3c12">dec_ctx</a> = NULL;
<a name="l01234"></a>01234       <span class="keywordflow">return</span> <a class="code" href="vcodecs_8c.html#a20dec20142208a77ce05a2246c72af26" title="uninitialize the descriptor for remote video stream">dec_uninit</a>(v);
<a name="l01235"></a>01235    }
<a name="l01236"></a>01236 
<a name="l01237"></a>01237    v-&gt;<a class="code" href="structvideo__dec__desc.html#a68b279e912ef73bfd6201cfdfb197e1d">parser</a> = av_parser_init(codec);
<a name="l01238"></a>01238    <span class="keywordflow">if</span> (!v-&gt;<a class="code" href="structvideo__dec__desc.html#a68b279e912ef73bfd6201cfdfb197e1d">parser</a>) {
<a name="l01239"></a>01239       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Cannot initialize the decoder parser\n&quot;</span>);
<a name="l01240"></a>01240       <span class="keywordflow">return</span> <a class="code" href="vcodecs_8c.html#a20dec20142208a77ce05a2246c72af26" title="uninitialize the descriptor for remote video stream">dec_uninit</a>(v);
<a name="l01241"></a>01241    }
<a name="l01242"></a>01242 
<a name="l01243"></a>01243    v-&gt;<a class="code" href="structvideo__dec__desc.html#ac62c84bfb8a2d6b64af87aefa0908837">d_frame</a> = avcodec_alloc_frame();
<a name="l01244"></a>01244    <span class="keywordflow">if</span> (!v-&gt;<a class="code" href="structvideo__dec__desc.html#ac62c84bfb8a2d6b64af87aefa0908837">d_frame</a>) {
<a name="l01245"></a>01245       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Cannot allocate decoding video frame\n&quot;</span>);
<a name="l01246"></a>01246       <span class="keywordflow">return</span> <a class="code" href="vcodecs_8c.html#a20dec20142208a77ce05a2246c72af26" title="uninitialize the descriptor for remote video stream">dec_uninit</a>(v);
<a name="l01247"></a>01247    }
<a name="l01248"></a>01248         v-&gt;<a class="code" href="structvideo__dec__desc.html#a42db1556a4ed48c5d5e35cea1d431c44">dec_in_cur</a> = &amp;v-&gt;<a class="code" href="structvideo__dec__desc.html#af9b10863ae9025d1e728af14182fed86">dec_in</a>[0]; <span class="comment">/* buffer for incoming frames */</span>
<a name="l01249"></a>01249         v-&gt;<a class="code" href="structvideo__dec__desc.html#ae598ed95c6a8072bf8ecc92bf7a36287">dec_in_dpy</a> = NULL;      <span class="comment">/* nothing to display */</span>
<a name="l01250"></a>01250 
<a name="l01251"></a>01251    <span class="keywordflow">return</span> v;   <span class="comment">/* ok */</span>
<a name="l01252"></a>01252 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a20dec20142208a77ce05a2246c72af26"></a><!-- doxytag: member="vcodecs.c::dec_uninit" ref="a20dec20142208a77ce05a2246c72af26" args="(struct video_dec_desc *v)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structvideo__dec__desc.html">video_dec_desc</a>* dec_uninit </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structvideo__dec__desc.html">video_dec_desc</a> *&nbsp;</td>
          <td class="paramname"> <em>v</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>uninitialize the descriptor for remote video stream </p>

<p>Definition at line <a class="el" href="vcodecs_8c_source.html#l01167">1167</a> of file <a class="el" href="vcodecs_8c_source.html">vcodecs.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="vcodecs_8c_source.html#l00083">video_dec_desc::codec</a>, <a class="el" href="vcodecs_8c_source.html#l00081">video_dec_desc::d_callbacks</a>, <a class="el" href="vcodecs_8c_source.html#l00084">video_dec_desc::d_frame</a>, <a class="el" href="vcodecs_8c_source.html#l00082">video_dec_desc::dec_ctx</a>, <a class="el" href="vcodecs_8c_source.html#l00091">video_dec_desc::dec_in</a>, <a class="el" href="vcodecs_8c_source.html#l00092">video_dec_desc::dec_out</a>, <a class="el" href="vcodecs_8c_source.html#l00087">video_dec_desc::discard</a>, <a class="el" href="console__video_8h.html#ab6072b154016b1ef506e591221c8c87e">fbuf_free()</a>, <a class="el" href="vcodecs_8c_source.html#l00088">N_DEC_IN</a>, and <a class="el" href="vcodecs_8c_source.html#l00085">video_dec_desc::parser</a>.</p>

<p>Referenced by <a class="el" href="vcodecs_8c_source.html#l01199">dec_init()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01168"></a>01168 {
<a name="l01169"></a>01169    <span class="keywordtype">int</span> i;
<a name="l01170"></a>01170 
<a name="l01171"></a>01171    <span class="keywordflow">if</span> (v == NULL)    <span class="comment">/* not initialized yet */</span>
<a name="l01172"></a>01172       <span class="keywordflow">return</span> NULL;
<a name="l01173"></a>01173    <span class="keywordflow">if</span> (v-&gt;<a class="code" href="structvideo__dec__desc.html#a68b279e912ef73bfd6201cfdfb197e1d">parser</a>) {
<a name="l01174"></a>01174       av_parser_close(v-&gt;<a class="code" href="structvideo__dec__desc.html#a68b279e912ef73bfd6201cfdfb197e1d">parser</a>);
<a name="l01175"></a>01175       v-&gt;<a class="code" href="structvideo__dec__desc.html#a68b279e912ef73bfd6201cfdfb197e1d">parser</a> = NULL;
<a name="l01176"></a>01176    }
<a name="l01177"></a>01177    <span class="keywordflow">if</span> (v-&gt;<a class="code" href="structvideo__dec__desc.html#ac2bf6798f37e95d3d2ff2d44e4ab3c12">dec_ctx</a>) {
<a name="l01178"></a>01178       avcodec_close(v-&gt;<a class="code" href="structvideo__dec__desc.html#ac2bf6798f37e95d3d2ff2d44e4ab3c12">dec_ctx</a>);
<a name="l01179"></a>01179       av_free(v-&gt;<a class="code" href="structvideo__dec__desc.html#ac2bf6798f37e95d3d2ff2d44e4ab3c12">dec_ctx</a>);
<a name="l01180"></a>01180       v-&gt;<a class="code" href="structvideo__dec__desc.html#ac2bf6798f37e95d3d2ff2d44e4ab3c12">dec_ctx</a> = NULL;
<a name="l01181"></a>01181    }
<a name="l01182"></a>01182    <span class="keywordflow">if</span> (v-&gt;<a class="code" href="structvideo__dec__desc.html#ac62c84bfb8a2d6b64af87aefa0908837">d_frame</a>) {
<a name="l01183"></a>01183       av_free(v-&gt;<a class="code" href="structvideo__dec__desc.html#ac62c84bfb8a2d6b64af87aefa0908837">d_frame</a>);
<a name="l01184"></a>01184       v-&gt;<a class="code" href="structvideo__dec__desc.html#ac62c84bfb8a2d6b64af87aefa0908837">d_frame</a> = NULL;
<a name="l01185"></a>01185    }
<a name="l01186"></a>01186    v-&gt;<a class="code" href="structvideo__dec__desc.html#a3d92780da6f5146c4f47f425dd151d96">codec</a> = NULL;  <span class="comment">/* only a reference */</span>
<a name="l01187"></a>01187    v-&gt;<a class="code" href="structvideo__dec__desc.html#a75b14c12df26c41bf27a8c18c9c8dabb">d_callbacks</a> = NULL;     <span class="comment">/* forget the decoder */</span>
<a name="l01188"></a>01188    v-&gt;<a class="code" href="structvideo__dec__desc.html#a1e271435c2e72bedc8dd8b85b7f971ac">discard</a> = 1;      <span class="comment">/* start in discard mode */</span>
<a name="l01189"></a>01189    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="vcodecs_8c.html#ae76825d684a0a161d3213795c7a8867e">N_DEC_IN</a>; i++)
<a name="l01190"></a>01190       <a class="code" href="console__video_8h.html#ab6072b154016b1ef506e591221c8c87e">fbuf_free</a>(&amp;v-&gt;<a class="code" href="structvideo__dec__desc.html#af9b10863ae9025d1e728af14182fed86">dec_in</a>[i]);
<a name="l01191"></a>01191    <a class="code" href="console__video_8h.html#ab6072b154016b1ef506e591221c8c87e">fbuf_free</a>(&amp;v-&gt;<a class="code" href="structvideo__dec__desc.html#aed498803f555e6b36626a1da8e56948e">dec_out</a>);
<a name="l01192"></a>01192    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(v);
<a name="l01193"></a>01193    <span class="keywordflow">return</span> NULL;   <span class="comment">/* error, in case someone cares */</span>
<a name="l01194"></a>01194 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9673830c01bbadf4a9ace67169bf1719"></a><!-- doxytag: member="vcodecs.c::fbuf_append" ref="a9673830c01bbadf4a9ace67169bf1719" args="(struct fbuf_t *b, uint8_t *src, int len, int sbit, int ebit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int fbuf_append </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structfbuf__t.html">fbuf_t</a> *&nbsp;</td>
          <td class="paramname"> <em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>sbit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>ebit</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="vcodecs_8c_source.html#l00269">269</a> of file <a class="el" href="vcodecs_8c_source.html">vcodecs.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="astmm_8h_source.html#l00093">ast_realloc</a>, <a class="el" href="console__video_8h_source.html#l00060">fbuf_t::data</a>, <a class="el" href="console__video_8h_source.html#l00064">fbuf_t::ebit</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="console__video_8h_source.html#l00062">fbuf_t::size</a>, and <a class="el" href="console__video_8h_source.html#l00063">fbuf_t::used</a>.</p>

<p>Referenced by <a class="el" href="vcodecs_8c_source.html#l00823">h261_decap()</a>, <a class="el" href="vcodecs_8c_source.html#l00667">h263_decap()</a>, <a class="el" href="vcodecs_8c_source.html#l00429">h263p_decap()</a>, <a class="el" href="vcodecs_8c_source.html#l01042">h264_decap()</a>, and <a class="el" href="vcodecs_8c_source.html#l00889">mpeg4_decap()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00271"></a>00271 {
<a name="l00272"></a>00272    <span class="comment">/*</span>
<a name="l00273"></a>00273 <span class="comment">    * Allocate buffer. ffmpeg wants an extra FF_INPUT_BUFFER_PADDING_SIZE,</span>
<a name="l00274"></a>00274 <span class="comment">    * and also wants 0 as a buffer terminator to prevent trouble.</span>
<a name="l00275"></a>00275 <span class="comment">    */</span>
<a name="l00276"></a>00276    <span class="keywordtype">int</span> need = <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> + FF_INPUT_BUFFER_PADDING_SIZE;
<a name="l00277"></a>00277    <span class="keywordtype">int</span> i;
<a name="l00278"></a>00278    uint8_t *dst, mask;
<a name="l00279"></a>00279 
<a name="l00280"></a>00280    <span class="keywordflow">if</span> (b-&gt;<a class="code" href="structfbuf__t.html#abe222f6d3581e7920dcad5306cc906a8">data</a> == NULL) {
<a name="l00281"></a>00281       b-&gt;<a class="code" href="structfbuf__t.html#a439227feff9d7f55384e8780cfc2eb82">size</a> = need;
<a name="l00282"></a>00282       b-&gt;<a class="code" href="structfbuf__t.html#a5810b6407672b8e7aeba609b4bb649de">used</a> = 0;
<a name="l00283"></a>00283       b-&gt;<a class="code" href="structfbuf__t.html#afc198efda3f50db2a5cae3c738528dd9">ebit</a> = 0;
<a name="l00284"></a>00284       b-&gt;<a class="code" href="structfbuf__t.html#abe222f6d3581e7920dcad5306cc906a8">data</a> = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, b-&gt;<a class="code" href="structfbuf__t.html#a439227feff9d7f55384e8780cfc2eb82">size</a>);
<a name="l00285"></a>00285    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (b-&gt;<a class="code" href="structfbuf__t.html#a5810b6407672b8e7aeba609b4bb649de">used</a> + need &gt; b-&gt;<a class="code" href="structfbuf__t.html#a439227feff9d7f55384e8780cfc2eb82">size</a>) {
<a name="l00286"></a>00286       b-&gt;<a class="code" href="structfbuf__t.html#a439227feff9d7f55384e8780cfc2eb82">size</a> = b-&gt;<a class="code" href="structfbuf__t.html#a5810b6407672b8e7aeba609b4bb649de">used</a> + need;
<a name="l00287"></a>00287       b-&gt;<a class="code" href="structfbuf__t.html#abe222f6d3581e7920dcad5306cc906a8">data</a> = <a class="code" href="astmm_8h.html#aa852314efa0cfeecee97ffc51b649734">ast_realloc</a>(b-&gt;<a class="code" href="structfbuf__t.html#abe222f6d3581e7920dcad5306cc906a8">data</a>, b-&gt;<a class="code" href="structfbuf__t.html#a439227feff9d7f55384e8780cfc2eb82">size</a>);
<a name="l00288"></a>00288    }
<a name="l00289"></a>00289    <span class="keywordflow">if</span> (b-&gt;<a class="code" href="structfbuf__t.html#abe222f6d3581e7920dcad5306cc906a8">data</a> == NULL) {
<a name="l00290"></a>00290       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;alloc failure for %d, discard\n&quot;</span>,
<a name="l00291"></a>00291          b-&gt;<a class="code" href="structfbuf__t.html#a439227feff9d7f55384e8780cfc2eb82">size</a>);
<a name="l00292"></a>00292       <span class="keywordflow">return</span> 1;
<a name="l00293"></a>00293    }
<a name="l00294"></a>00294    <span class="keywordflow">if</span> (b-&gt;<a class="code" href="structfbuf__t.html#a5810b6407672b8e7aeba609b4bb649de">used</a> == 0 &amp;&amp; b-&gt;<a class="code" href="structfbuf__t.html#afc198efda3f50db2a5cae3c738528dd9">ebit</a> != 0) {
<a name="l00295"></a>00295       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;ebit not reset at start\n&quot;</span>);
<a name="l00296"></a>00296       b-&gt;<a class="code" href="structfbuf__t.html#afc198efda3f50db2a5cae3c738528dd9">ebit</a> = 0;
<a name="l00297"></a>00297    }
<a name="l00298"></a>00298    dst = b-&gt;<a class="code" href="structfbuf__t.html#abe222f6d3581e7920dcad5306cc906a8">data</a> + b-&gt;<a class="code" href="structfbuf__t.html#a5810b6407672b8e7aeba609b4bb649de">used</a>;
<a name="l00299"></a>00299    i = b-&gt;<a class="code" href="structfbuf__t.html#afc198efda3f50db2a5cae3c738528dd9">ebit</a> + sbit;  <span class="comment">/* bits to ignore around */</span>
<a name="l00300"></a>00300    <span class="keywordflow">if</span> (i == 0) {  <span class="comment">/* easy case, just append */</span>
<a name="l00301"></a>00301       <span class="comment">/* do everything in the common block */</span>
<a name="l00302"></a>00302    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i == 8) { <span class="comment">/* easy too, just handle the overlap byte */</span>
<a name="l00303"></a>00303       mask = (1 &lt;&lt; b-&gt;<a class="code" href="structfbuf__t.html#afc198efda3f50db2a5cae3c738528dd9">ebit</a>) - 1;
<a name="l00304"></a>00304       <span class="comment">/* update the last byte in the buffer */</span>
<a name="l00305"></a>00305       dst[-1] &amp;= ~mask; <span class="comment">/* clear bits to ignore */</span>
<a name="l00306"></a>00306       dst[-1] |= (*src &amp; mask);  <span class="comment">/* append new bits */</span>
<a name="l00307"></a>00307       src += 1;   <span class="comment">/* skip and prepare for common block */</span>
<a name="l00308"></a>00308       <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> --;
<a name="l00309"></a>00309    } <span class="keywordflow">else</span> { <span class="comment">/* must shift the new block, not done yet */</span>
<a name="l00310"></a>00310       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;must handle shift %d %d at %d\n&quot;</span>,
<a name="l00311"></a>00311          b-&gt;<a class="code" href="structfbuf__t.html#afc198efda3f50db2a5cae3c738528dd9">ebit</a>, sbit, b-&gt;<a class="code" href="structfbuf__t.html#a5810b6407672b8e7aeba609b4bb649de">used</a>);
<a name="l00312"></a>00312       <span class="keywordflow">return</span> 1;
<a name="l00313"></a>00313    }
<a name="l00314"></a>00314    memcpy(dst, src, <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>);
<a name="l00315"></a>00315    b-&gt;<a class="code" href="structfbuf__t.html#a5810b6407672b8e7aeba609b4bb649de">used</a> += <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>;
<a name="l00316"></a>00316    b-&gt;<a class="code" href="structfbuf__t.html#afc198efda3f50db2a5cae3c738528dd9">ebit</a> = ebit;
<a name="l00317"></a>00317    b-&gt;<a class="code" href="structfbuf__t.html#abe222f6d3581e7920dcad5306cc906a8">data</a>[b-&gt;<a class="code" href="structfbuf__t.html#a5810b6407672b8e7aeba609b4bb649de">used</a>] = 0;   <span class="comment">/* padding */</span>
<a name="l00318"></a>00318    <span class="keywordflow">return</span> 0;
<a name="l00319"></a>00319 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a194580c755d45fc41594b398fb70f119"></a><!-- doxytag: member="vcodecs.c::ffmpeg_decode" ref="a194580c755d45fc41594b398fb70f119" args="(struct video_dec_desc *v, struct fbuf_t *b)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ffmpeg_decode </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structvideo__dec__desc.html">video_dec_desc</a> *&nbsp;</td>
          <td class="paramname"> <em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structfbuf__t.html">fbuf_t</a> *&nbsp;</td>
          <td class="paramname"> <em>b</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="vcodecs_8c_source.html#l00478">478</a> of file <a class="el" href="vcodecs_8c_source.html">vcodecs.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="vcodecs_8c_source.html#l00084">video_dec_desc::d_frame</a>, <a class="el" href="console__video_8h_source.html#l00060">fbuf_t::data</a>, <a class="el" href="vcodecs_8c_source.html#l00082">video_dec_desc::dec_ctx</a>, <a class="el" href="console__video_8h_source.html#l00064">fbuf_t::ebit</a>, <a class="el" href="func__strings_8c_source.html#l00821">len()</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="vcodecs_8c_source.html#l00085">video_dec_desc::parser</a>, and <a class="el" href="console__video_8h_source.html#l00063">fbuf_t::used</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00479"></a>00479 {
<a name="l00480"></a>00480    uint8_t *src = b-&gt;<a class="code" href="structfbuf__t.html#abe222f6d3581e7920dcad5306cc906a8">data</a>;
<a name="l00481"></a>00481    <span class="keywordtype">int</span> srclen = b-&gt;<a class="code" href="structfbuf__t.html#a5810b6407672b8e7aeba609b4bb649de">used</a>;
<a name="l00482"></a>00482    <span class="keywordtype">int</span> full_frame = 0;
<a name="l00483"></a>00483 
<a name="l00484"></a>00484    <span class="keywordflow">if</span> (srclen == 0)  <span class="comment">/* no data */</span>
<a name="l00485"></a>00485       <span class="keywordflow">return</span> 0;
<a name="l00486"></a>00486    <span class="keywordflow">while</span> (srclen) {
<a name="l00487"></a>00487       uint8_t *data;
<a name="l00488"></a>00488       <span class="keywordtype">int</span> datalen, ret;
<a name="l00489"></a>00489       <span class="keywordtype">int</span> <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> = av_parser_parse(v-&gt;<a class="code" href="structvideo__dec__desc.html#a68b279e912ef73bfd6201cfdfb197e1d">parser</a>, v-&gt;<a class="code" href="structvideo__dec__desc.html#ac2bf6798f37e95d3d2ff2d44e4ab3c12">dec_ctx</a>, &amp;data, &amp;datalen, src, srclen, 0, 0);
<a name="l00490"></a>00490 
<a name="l00491"></a>00491       src += len;
<a name="l00492"></a>00492       srclen -= len;
<a name="l00493"></a>00493       <span class="comment">/* The parser might return something it cannot decode, so it skips</span>
<a name="l00494"></a>00494 <span class="comment">       * the block returning no data</span>
<a name="l00495"></a>00495 <span class="comment">       */</span>
<a name="l00496"></a>00496       <span class="keywordflow">if</span> (data == NULL || datalen == 0)
<a name="l00497"></a>00497          <span class="keywordflow">continue</span>;
<a name="l00498"></a>00498       ret = avcodec_decode_video(v-&gt;<a class="code" href="structvideo__dec__desc.html#ac2bf6798f37e95d3d2ff2d44e4ab3c12">dec_ctx</a>, v-&gt;<a class="code" href="structvideo__dec__desc.html#ac62c84bfb8a2d6b64af87aefa0908837">d_frame</a>, &amp;full_frame, data, datalen);
<a name="l00499"></a>00499       <span class="keywordflow">if</span> (full_frame == 1) <span class="comment">/* full frame */</span>
<a name="l00500"></a>00500          <span class="keywordflow">break</span>;
<a name="l00501"></a>00501       <span class="keywordflow">if</span> (ret &lt; 0) {
<a name="l00502"></a>00502          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Error decoding\n&quot;</span>);
<a name="l00503"></a>00503          <span class="keywordflow">break</span>;
<a name="l00504"></a>00504       }
<a name="l00505"></a>00505    }
<a name="l00506"></a>00506    <span class="keywordflow">if</span> (srclen != 0)  <span class="comment">/* update b with leftover data */</span>
<a name="l00507"></a>00507       memmove(b-&gt;<a class="code" href="structfbuf__t.html#abe222f6d3581e7920dcad5306cc906a8">data</a>, src, srclen);
<a name="l00508"></a>00508    b-&gt;<a class="code" href="structfbuf__t.html#a5810b6407672b8e7aeba609b4bb649de">used</a> = srclen;
<a name="l00509"></a>00509    b-&gt;<a class="code" href="structfbuf__t.html#afc198efda3f50db2a5cae3c738528dd9">ebit</a> = 0;
<a name="l00510"></a>00510    <span class="keywordflow">return</span> full_frame;
<a name="l00511"></a>00511 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a20c9a18ff6f22a167ce3461070f8158a"></a><!-- doxytag: member="vcodecs.c::ffmpeg_encode" ref="a20c9a18ff6f22a167ce3461070f8158a" args="(struct video_out_desc *v)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ffmpeg_encode </td>
          <td>(</td>
          <td class="paramtype">struct video_out_desc *&nbsp;</td>
          <td class="paramname"> <em>v</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="vcodecs_8c_source.html#l00457">457</a> of file <a class="el" href="vcodecs_8c_source.html">vcodecs.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="console__video_8h_source.html#l00060">fbuf_t::data</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="console__video_8h_source.html#l00062">fbuf_t::size</a>, and <a class="el" href="console__video_8h_source.html#l00063">fbuf_t::used</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00458"></a>00458 {
<a name="l00459"></a>00459    <span class="keyword">struct </span><a class="code" href="structfbuf__t.html">fbuf_t</a> *b = &amp;v-&gt;enc_out;
<a name="l00460"></a>00460    <span class="keywordtype">int</span> i;
<a name="l00461"></a>00461 
<a name="l00462"></a>00462    b-&gt;<a class="code" href="structfbuf__t.html#a5810b6407672b8e7aeba609b4bb649de">used</a> = avcodec_encode_video(v-&gt;enc_ctx, b-&gt;<a class="code" href="structfbuf__t.html#abe222f6d3581e7920dcad5306cc906a8">data</a>, b-&gt;<a class="code" href="structfbuf__t.html#a439227feff9d7f55384e8780cfc2eb82">size</a>, v-&gt;enc_in_frame);
<a name="l00463"></a>00463    i = avcodec_encode_video(v-&gt;enc_ctx, b-&gt;<a class="code" href="structfbuf__t.html#abe222f6d3581e7920dcad5306cc906a8">data</a> + b-&gt;<a class="code" href="structfbuf__t.html#a5810b6407672b8e7aeba609b4bb649de">used</a>, b-&gt;<a class="code" href="structfbuf__t.html#a439227feff9d7f55384e8780cfc2eb82">size</a> - b-&gt;<a class="code" href="structfbuf__t.html#a5810b6407672b8e7aeba609b4bb649de">used</a>, NULL); <span class="comment">/* delayed frames ? */</span>
<a name="l00464"></a>00464    <span class="keywordflow">if</span> (i &gt; 0) {
<a name="l00465"></a>00465       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;have %d more bytes\n&quot;</span>, i);
<a name="l00466"></a>00466       b-&gt;<a class="code" href="structfbuf__t.html#a5810b6407672b8e7aeba609b4bb649de">used</a> += i;
<a name="l00467"></a>00467    }
<a name="l00468"></a>00468    <span class="keywordflow">return</span> 0;
<a name="l00469"></a>00469 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a20b21523defe433fb3592547704787d6"></a><!-- doxytag: member="vcodecs.c::h261_decap" ref="a20b21523defe433fb3592547704787d6" args="(struct fbuf_t *b, uint8_t *data, int len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int h261_decap </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structfbuf__t.html">fbuf_t</a> *&nbsp;</td>
          <td class="paramname"> <em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>len</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="vcodecs_8c_source.html#l00823">823</a> of file <a class="el" href="vcodecs_8c_source.html">vcodecs.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="vcodecs_8c_source.html#l00269">fbuf_append()</a>, and <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00824"></a>00824 {
<a name="l00825"></a>00825    <span class="keywordtype">int</span> <a class="code" href="structfbuf__t.html#afc198efda3f50db2a5cae3c738528dd9">ebit</a>, sbit;
<a name="l00826"></a>00826 
<a name="l00827"></a>00827    <span class="keywordflow">if</span> (<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> &lt; 8) {
<a name="l00828"></a>00828       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;invalid framesize %d\n&quot;</span>, <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>);
<a name="l00829"></a>00829       <span class="keywordflow">return</span> 1;
<a name="l00830"></a>00830    }
<a name="l00831"></a>00831    sbit = (<a class="code" href="structfbuf__t.html#abe222f6d3581e7920dcad5306cc906a8">data</a>[0] &gt;&gt; 5) &amp; 7;
<a name="l00832"></a>00832    ebit = (<a class="code" href="structfbuf__t.html#abe222f6d3581e7920dcad5306cc906a8">data</a>[0] &gt;&gt; 2) &amp; 7;
<a name="l00833"></a>00833    <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> -= 4;
<a name="l00834"></a>00834    <a class="code" href="structfbuf__t.html#abe222f6d3581e7920dcad5306cc906a8">data</a> += 4;
<a name="l00835"></a>00835    <span class="keywordflow">return</span> <a class="code" href="vcodecs_8c.html#a9673830c01bbadf4a9ace67169bf1719">fbuf_append</a>(b, <a class="code" href="structfbuf__t.html#abe222f6d3581e7920dcad5306cc906a8">data</a>, <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, sbit, ebit);
<a name="l00836"></a>00836 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6c9e0930c255c8fe0a58fc8eb9a7ad74"></a><!-- doxytag: member="vcodecs.c::h261_enc_init" ref="a6c9e0930c255c8fe0a58fc8eb9a7ad74" args="(AVCodecContext *enc_ctx)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int h261_enc_init </td>
          <td>(</td>
          <td class="paramtype">AVCodecContext *&nbsp;</td>
          <td class="paramname"> <em>enc_ctx</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="vcodecs_8c_source.html#l00698">698</a> of file <a class="el" href="vcodecs_8c_source.html">vcodecs.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00699"></a>00699 {
<a name="l00700"></a>00700    <span class="comment">/* It is important to set rtp_payload_size = 0, otherwise</span>
<a name="l00701"></a>00701 <span class="comment">    * ffmpeg in h261 mode will produce output that it cannot parse.</span>
<a name="l00702"></a>00702 <span class="comment">    * Also try to send I frames more frequently than with other codecs.</span>
<a name="l00703"></a>00703 <span class="comment">    */</span>
<a name="l00704"></a>00704    enc_ctx-&gt;rtp_payload_size = 0; <span class="comment">/* important - ffmpeg fails otherwise */</span>
<a name="l00705"></a>00705 
<a name="l00706"></a>00706    <span class="keywordflow">return</span> 0;
<a name="l00707"></a>00707 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6632508d014f0ae86a0d282e5fcd5a49"></a><!-- doxytag: member="vcodecs.c::h261_encap" ref="a6632508d014f0ae86a0d282e5fcd5a49" args="(struct fbuf_t *b, int mtu, struct ast_frame **tail)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__frame.html">ast_frame</a>* h261_encap </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structfbuf__t.html">fbuf_t</a> *&nbsp;</td>
          <td class="paramname"> <em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>mtu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__frame.html">ast_frame</a> **&nbsp;</td>
          <td class="paramname"> <em>tail</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="vcodecs_8c_source.html#l00725">725</a> of file <a class="el" href="vcodecs_8c_source.html">vcodecs.c</a>.</p>

<p>References <a class="el" href="frame_8h_source.html#l00279">AST_FORMAT_H261</a>, <a class="el" href="vcodecs_8c_source.html#l00224">create_video_frame()</a>, <a class="el" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">ast_frame::data</a>, <a class="el" href="console__video_8h_source.html#l00060">fbuf_t::data</a>, <a class="el" href="format__g726_8c_source.html#l00177">f</a>, <a class="el" href="devicestate_8c_source.html#l00198">first</a>, <a class="el" href="vcodecs_8c.html#aa4007d13f9870b72148401231645cfba">H261_MIN_LEN</a>, <a class="el" href="func__strings_8c_source.html#l00821">len()</a>, <a class="el" href="frame_8h_source.html#l00159">ast_frame::ptr</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, and <a class="el" href="console__video_8h_source.html#l00063">fbuf_t::used</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00727"></a>00727 {
<a name="l00728"></a>00728    uint8_t *d = b-&gt;<a class="code" href="structfbuf__t.html#abe222f6d3581e7920dcad5306cc906a8">data</a>;
<a name="l00729"></a>00729    <span class="keywordtype">int</span> start = 0, i, <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> = b-&gt;<a class="code" href="structfbuf__t.html#a5810b6407672b8e7aeba609b4bb649de">used</a>;
<a name="l00730"></a>00730    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>, *cur = NULL, *<a class="code" href="devicestate_8c.html#abd2135e6f8a41bc900933b1985d97165">first</a> = NULL;
<a name="l00731"></a>00731    <span class="keyword">const</span> <span class="keywordtype">int</span> pheader_len = 4;
<a name="l00732"></a>00732    uint8_t h261_hdr[4];
<a name="l00733"></a>00733    uint8_t *h = h261_hdr;  <span class="comment">/* shorthand */</span>
<a name="l00734"></a>00734    <span class="keywordtype">int</span> sbit = 0, ebit = 0;
<a name="l00735"></a>00735 
<a name="l00736"></a>00736 <span class="preprocessor">#define H261_MIN_LEN 10</span>
<a name="l00737"></a>00737 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (len &lt; H261_MIN_LEN) <span class="comment">/* unreasonably small */</span>
<a name="l00738"></a>00738       <span class="keywordflow">return</span> NULL;
<a name="l00739"></a>00739 
<a name="l00740"></a>00740    memset(h261_hdr, <span class="charliteral">&apos;\0&apos;</span>, <span class="keyword">sizeof</span>(h261_hdr));
<a name="l00741"></a>00741 
<a name="l00742"></a>00742    <span class="comment">/* Similar to the code in h263_encap, but the marker there is longer.</span>
<a name="l00743"></a>00743 <span class="comment">    * Start a few bytes within the bitstream to avoid hitting the marker</span>
<a name="l00744"></a>00744 <span class="comment">    * twice. Note we might access the buffer at len, but this is ok because</span>
<a name="l00745"></a>00745 <span class="comment">    * the caller has it oversized.</span>
<a name="l00746"></a>00746 <span class="comment">    */</span>
<a name="l00747"></a>00747    <span class="keywordflow">for</span> (i = H261_MIN_LEN, start = 0; start &lt; len - 1; start = i, i += 4) {
<a name="l00748"></a>00748 <span class="preprocessor">#if 0 </span><span class="comment">/* test - disable packetization */</span>
<a name="l00749"></a>00749       i = len; <span class="comment">/* wrong... */</span>
<a name="l00750"></a>00750 <span class="preprocessor">#else</span>
<a name="l00751"></a>00751 <span class="preprocessor"></span>      <span class="keywordtype">int</span> found = 0, found_ebit = 0;   <span class="comment">/* last GBSC position found */</span>
<a name="l00752"></a>00752       <span class="keywordflow">for</span> (; i &lt; len ; i++) {
<a name="l00753"></a>00753          uint8_t x, rpos, lpos;
<a name="l00754"></a>00754          <span class="keywordflow">if</span> (d[i] != 0)    <span class="comment">/* cannot be in a GBSC */</span>
<a name="l00755"></a>00755             <span class="keywordflow">continue</span>;
<a name="l00756"></a>00756          x = d[i+1];
<a name="l00757"></a>00757          <span class="keywordflow">if</span> (x == 0) <span class="comment">/* next is equally good */</span>
<a name="l00758"></a>00758             <span class="keywordflow">continue</span>;
<a name="l00759"></a>00759          <span class="comment">/* See if around us we find 15 &apos;0&apos; bits for the GBSC.</span>
<a name="l00760"></a>00760 <span class="comment">          * Look for the first bit set on the right, and then</span>
<a name="l00761"></a>00761 <span class="comment">          * see if we have enough 0 on the left.</span>
<a name="l00762"></a>00762 <span class="comment">          * We are guaranteed to end before rpos == 0</span>
<a name="l00763"></a>00763 <span class="comment">          */</span>
<a name="l00764"></a>00764          <span class="keywordflow">for</span> (rpos = 0x80, ebit = 7; rpos; ebit--, rpos &gt;&gt;= 1)
<a name="l00765"></a>00765             <span class="keywordflow">if</span> (x &amp; rpos)  <span class="comment">/* found the &apos;1&apos; bit in GBSC */</span>
<a name="l00766"></a>00766                <span class="keywordflow">break</span>;
<a name="l00767"></a>00767          x = d[i-1];    <span class="comment">/* now look behind */</span>
<a name="l00768"></a>00768          <span class="keywordflow">for</span> (lpos = (rpos &gt;&gt; 1); lpos ; lpos &gt;&gt;= 1)
<a name="l00769"></a>00769             <span class="keywordflow">if</span> (x &amp; lpos)  <span class="comment">/* too early, not a GBSC */</span>
<a name="l00770"></a>00770                <span class="keywordflow">break</span>;
<a name="l00771"></a>00771          <span class="keywordflow">if</span> (lpos)      <span class="comment">/* as i said... */</span>
<a name="l00772"></a>00772             <span class="keywordflow">continue</span>;
<a name="l00773"></a>00773          <span class="comment">/* now we have a GBSC starting somewhere in d[i-1],</span>
<a name="l00774"></a>00774 <span class="comment">          * but it might be not byte-aligned. Just remember it.</span>
<a name="l00775"></a>00775 <span class="comment">          */</span>
<a name="l00776"></a>00776          <span class="keywordflow">if</span> (i - start &gt; mtu) <span class="comment">/* too large, stop now */</span>
<a name="l00777"></a>00777             <span class="keywordflow">break</span>;
<a name="l00778"></a>00778          found_ebit = ebit;
<a name="l00779"></a>00779          found = i;
<a name="l00780"></a>00780          i += 4;  <span class="comment">/* continue forward */</span>
<a name="l00781"></a>00781       }
<a name="l00782"></a>00782       <span class="keywordflow">if</span> (i &gt;= len) {   <span class="comment">/* trim if we went too forward */</span>
<a name="l00783"></a>00783          i = len;
<a name="l00784"></a>00784          ebit = 0;   <span class="comment">/* hopefully... should ask the bitstream ? */</span>
<a name="l00785"></a>00785       }
<a name="l00786"></a>00786       <span class="keywordflow">if</span> (i - start &gt; mtu &amp;&amp; found) {
<a name="l00787"></a>00787          <span class="comment">/* use the previous GBSC, hope is within the mtu */</span>
<a name="l00788"></a>00788          i = found;
<a name="l00789"></a>00789          ebit = found_ebit;
<a name="l00790"></a>00790       }
<a name="l00791"></a>00791 <span class="preprocessor">#endif </span><span class="comment">/* test */</span>
<a name="l00792"></a>00792       <span class="keywordflow">if</span> (i - start &lt; 4)   <span class="comment">/* XXX too short ? */</span>
<a name="l00793"></a>00793          <span class="keywordflow">continue</span>;
<a name="l00794"></a>00794       <span class="comment">/* This frame is up to offset i (not inclusive).</span>
<a name="l00795"></a>00795 <span class="comment">       * We do not split it yet even if larger than MTU.</span>
<a name="l00796"></a>00796 <span class="comment">       */</span>
<a name="l00797"></a>00797       f = <a class="code" href="vcodecs_8c.html#a892b5df711685dfbc8e1dcb14ac0e9a4">create_video_frame</a>(d + start, d+i, <a class="code" href="frame_8h.html#a876fb06c385409451b7842fe1af6c42e">AST_FORMAT_H261</a>,
<a name="l00798"></a>00798             pheader_len, cur);
<a name="l00799"></a>00799 
<a name="l00800"></a>00800       <span class="keywordflow">if</span> (!f)
<a name="l00801"></a>00801          <span class="keywordflow">break</span>;
<a name="l00802"></a>00802       <span class="comment">/* recompute header with I=0, V=1 */</span>
<a name="l00803"></a>00803       h[0] = ( (sbit &amp; 7) &lt;&lt; 5 ) | ( (ebit &amp; 7) &lt;&lt; 2 ) | 1;
<a name="l00804"></a>00804       memmove(f-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, h, 4);   <span class="comment">/* copy the h261 header */</span>
<a name="l00805"></a>00805       <span class="keywordflow">if</span> (ebit)   <span class="comment">/* not aligned, restart from previous byte */</span>
<a name="l00806"></a>00806          i--;
<a name="l00807"></a>00807       sbit = (8 - ebit) &amp; 7;
<a name="l00808"></a>00808       ebit = 0;
<a name="l00809"></a>00809       <span class="keywordflow">if</span> (!cur)
<a name="l00810"></a>00810          first = f;
<a name="l00811"></a>00811       cur = f;
<a name="l00812"></a>00812    }
<a name="l00813"></a>00813    <span class="keywordflow">if</span> (cur)
<a name="l00814"></a>00814       cur-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> |= 1;  <span class="comment">// RTP Marker</span>
<a name="l00815"></a>00815 
<a name="l00816"></a>00816    *tail = cur;
<a name="l00817"></a>00817    <span class="keywordflow">return</span> first;
<a name="l00818"></a>00818 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0e50c7cf90da944ba943261f9bcdfc84"></a><!-- doxytag: member="vcodecs.c::h263_decap" ref="a0e50c7cf90da944ba943261f9bcdfc84" args="(struct fbuf_t *b, uint8_t *data, int len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int h263_decap </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structfbuf__t.html">fbuf_t</a> *&nbsp;</td>
          <td class="paramname"> <em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>len</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="vcodecs_8c_source.html#l00667">667</a> of file <a class="el" href="vcodecs_8c_source.html">vcodecs.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="vcodecs_8c_source.html#l00269">fbuf_append()</a>, and <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00668"></a>00668 {
<a name="l00669"></a>00669    <span class="keywordflow">if</span> (<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> &lt; 4) {
<a name="l00670"></a>00670       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;invalid framesize %d\n&quot;</span>, <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>);
<a name="l00671"></a>00671       <span class="keywordflow">return</span> 1;   <span class="comment">/* error */</span>
<a name="l00672"></a>00672    }
<a name="l00673"></a>00673 
<a name="l00674"></a>00674    <span class="keywordflow">if</span> ( (<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>[0] &amp; 0x80) == 0) {
<a name="l00675"></a>00675       <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> -= 4;
<a name="l00676"></a>00676       <a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a> += 4;
<a name="l00677"></a>00677    } <span class="keywordflow">else</span> {
<a name="l00678"></a>00678       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;unsupported mode 0x%x\n&quot;</span>,
<a name="l00679"></a>00679          <a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>[0]);
<a name="l00680"></a>00680       <span class="keywordflow">return</span> 1;
<a name="l00681"></a>00681    }
<a name="l00682"></a>00682    <span class="keywordflow">return</span> <a class="code" href="vcodecs_8c.html#a9673830c01bbadf4a9ace67169bf1719">fbuf_append</a>(b, <a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>, <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, 0, 0);   <span class="comment">/* XXX no bit alignment support yet */</span>
<a name="l00683"></a>00683 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1c1b88d3283b5462a70874104c28439a"></a><!-- doxytag: member="vcodecs.c::h263_enc_init" ref="a1c1b88d3283b5462a70874104c28439a" args="(AVCodecContext *enc_ctx)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int h263_enc_init </td>
          <td>(</td>
          <td class="paramtype">AVCodecContext *&nbsp;</td>
          <td class="paramname"> <em>enc_ctx</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="vcodecs_8c_source.html#l00526">526</a> of file <a class="el" href="vcodecs_8c_source.html">vcodecs.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00527"></a>00527 {
<a name="l00528"></a>00528    <span class="comment">/* XXX check whether these are supported */</span>
<a name="l00529"></a>00529    enc_ctx-&gt;flags |= CODEC_FLAG_H263P_UMV;
<a name="l00530"></a>00530    enc_ctx-&gt;flags |= CODEC_FLAG_H263P_AIC;
<a name="l00531"></a>00531    enc_ctx-&gt;flags |= CODEC_FLAG_H263P_SLICE_STRUCT;
<a name="l00532"></a>00532    enc_ctx-&gt;flags |= CODEC_FLAG_AC_PRED;
<a name="l00533"></a>00533 
<a name="l00534"></a>00534    <span class="keywordflow">return</span> 0;
<a name="l00535"></a>00535 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8ddf5156d8e17f9ce737b68a8955e799"></a><!-- doxytag: member="vcodecs.c::h263_encap" ref="a8ddf5156d8e17f9ce737b68a8955e799" args="(struct fbuf_t *b, int mtu, struct ast_frame **tail)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__frame.html">ast_frame</a>* h263_encap </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structfbuf__t.html">fbuf_t</a> *&nbsp;</td>
          <td class="paramname"> <em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>mtu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__frame.html">ast_frame</a> **&nbsp;</td>
          <td class="paramname"> <em>tail</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="vcodecs_8c_source.html#l00571">571</a> of file <a class="el" href="vcodecs_8c_source.html">vcodecs.c</a>.</p>

<p>References <a class="el" href="frame_8h_source.html#l00281">AST_FORMAT_H263</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="vcodecs_8c_source.html#l00224">create_video_frame()</a>, <a class="el" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">ast_frame::data</a>, <a class="el" href="console__video_8h_source.html#l00060">fbuf_t::data</a>, <a class="el" href="format__g726_8c_source.html#l00177">f</a>, <a class="el" href="devicestate_8c_source.html#l00198">first</a>, <a class="el" href="vcodecs_8c.html#ac365005a57578e13321e99b4f7032a25">H263_MIN_LEN</a>, <a class="el" href="func__strings_8c_source.html#l00821">len()</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="frame_8h_source.html#l00159">ast_frame::ptr</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, and <a class="el" href="console__video_8h_source.html#l00063">fbuf_t::used</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00573"></a>00573 {
<a name="l00574"></a>00574    uint8_t *d = b-&gt;<a class="code" href="structfbuf__t.html#abe222f6d3581e7920dcad5306cc906a8">data</a>;
<a name="l00575"></a>00575    <span class="keywordtype">int</span> start = 0, i, <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> = b-&gt;<a class="code" href="structfbuf__t.html#a5810b6407672b8e7aeba609b4bb649de">used</a>;
<a name="l00576"></a>00576    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>, *cur = NULL, *<a class="code" href="devicestate_8c.html#abd2135e6f8a41bc900933b1985d97165">first</a> = NULL;
<a name="l00577"></a>00577    <span class="keyword">const</span> <span class="keywordtype">int</span> pheader_len = 4; <span class="comment">/* Use RFC-2190 Mode A */</span>
<a name="l00578"></a>00578    uint8_t h263_hdr[12];   <span class="comment">/* worst case, room for a type c header */</span>
<a name="l00579"></a>00579    uint8_t *h = h263_hdr;  <span class="comment">/* shorthand */</span>
<a name="l00580"></a>00580 
<a name="l00581"></a>00581 <span class="preprocessor">#define H263_MIN_LEN 6</span>
<a name="l00582"></a>00582 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (len &lt; H263_MIN_LEN) <span class="comment">/* unreasonably small */</span>
<a name="l00583"></a>00583       <span class="keywordflow">return</span> NULL;
<a name="l00584"></a>00584 
<a name="l00585"></a>00585    memset(h263_hdr, <span class="charliteral">&apos;\0&apos;</span>, <span class="keyword">sizeof</span>(h263_hdr));
<a name="l00586"></a>00586    <span class="comment">/* Now set the header bytes. Only type A by now,</span>
<a name="l00587"></a>00587 <span class="comment">    * and h[0] = h[2] = h[3] = 0 by default.</span>
<a name="l00588"></a>00588 <span class="comment">    * PTYPE starts 30 bits in the picture, so the first useful</span>
<a name="l00589"></a>00589 <span class="comment">    * bit for us is bit 36 i.e. within d[4] (0 is the msbit).</span>
<a name="l00590"></a>00590 <span class="comment">    * SRC = d[4] &amp; 0x1c goes into data[1] &amp; 0xe0</span>
<a name="l00591"></a>00591 <span class="comment">    * I   = d[4] &amp; 0x02 goes into data[1] &amp; 0x10</span>
<a name="l00592"></a>00592 <span class="comment">    * U   = d[4] &amp; 0x01 goes into data[1] &amp; 0x08</span>
<a name="l00593"></a>00593 <span class="comment">    * S   = d[5] &amp; 0x80 goes into data[1] &amp; 0x04</span>
<a name="l00594"></a>00594 <span class="comment">    * A   = d[5] &amp; 0x40 goes into data[1] &amp; 0x02</span>
<a name="l00595"></a>00595 <span class="comment">    * R   = 0           goes into data[1] &amp; 0x01</span>
<a name="l00596"></a>00596 <span class="comment">    * Optimizing it, we have</span>
<a name="l00597"></a>00597 <span class="comment">    */</span>
<a name="l00598"></a>00598    h[1] = ( (d[4] &amp; 0x1f) &lt;&lt; 3 ) |  <span class="comment">/* SRC, I, U */</span>
<a name="l00599"></a>00599       ( (d[5] &amp; 0xc0) &gt;&gt; 5 );    <span class="comment">/* S, A, R */</span>
<a name="l00600"></a>00600 
<a name="l00601"></a>00601    <span class="comment">/* now look for the next PSC or GOB header. First try to hit</span>
<a name="l00602"></a>00602 <span class="comment">    * a &apos;0&apos; byte then look around for the 0000 0000 0000 0000 1 pattern</span>
<a name="l00603"></a>00603 <span class="comment">    * which is both in the PSC and the GBSC.</span>
<a name="l00604"></a>00604 <span class="comment">    */</span>
<a name="l00605"></a>00605    <span class="keywordflow">for</span> (i = H263_MIN_LEN, start = 0; start &lt; len; start = i, i += 3) {
<a name="l00606"></a>00606       <span class="comment">//ast_log(LOG_WARNING, &quot;search at %d of %d/%d\n&quot;, i, start, len);</span>
<a name="l00607"></a>00607       <span class="keywordflow">for</span> (; i &lt; len ; i++) {
<a name="l00608"></a>00608          uint8_t x, rpos, lpos;
<a name="l00609"></a>00609          <span class="keywordtype">int</span> rpos_i; <span class="comment">/* index corresponding to rpos */</span>
<a name="l00610"></a>00610          <span class="keywordflow">if</span> (d[i] != 0)    <span class="comment">/* cannot be in a GBSC */</span>
<a name="l00611"></a>00611             <span class="keywordflow">continue</span>;
<a name="l00612"></a>00612          <span class="keywordflow">if</span> (i &gt; len - 1)
<a name="l00613"></a>00613             <span class="keywordflow">break</span>;
<a name="l00614"></a>00614          x = d[i+1];
<a name="l00615"></a>00615          <span class="keywordflow">if</span> (x == 0) <span class="comment">/* next is equally good */</span>
<a name="l00616"></a>00616             <span class="keywordflow">continue</span>;
<a name="l00617"></a>00617          <span class="comment">/* see if around us we can make 16 &apos;0&apos; bits for the GBSC.</span>
<a name="l00618"></a>00618 <span class="comment">          * Look for the first bit set on the right, and then</span>
<a name="l00619"></a>00619 <span class="comment">          * see if we have enough 0 on the left.</span>
<a name="l00620"></a>00620 <span class="comment">          * We are guaranteed to end before rpos == 0</span>
<a name="l00621"></a>00621 <span class="comment">          */</span>
<a name="l00622"></a>00622          <span class="keywordflow">for</span> (rpos = 0x80, rpos_i = 8; rpos; rpos &gt;&gt;= 1, rpos_i--)
<a name="l00623"></a>00623             <span class="keywordflow">if</span> (x &amp; rpos)  <span class="comment">/* found the &apos;1&apos; bit in GBSC */</span>
<a name="l00624"></a>00624                <span class="keywordflow">break</span>;
<a name="l00625"></a>00625          x = d[i-1];    <span class="comment">/* now look behind */</span>
<a name="l00626"></a>00626          <span class="keywordflow">for</span> (lpos = rpos; lpos ; lpos &gt;&gt;= 1)
<a name="l00627"></a>00627             <span class="keywordflow">if</span> (x &amp; lpos)  <span class="comment">/* too early, not a GBSC */</span>
<a name="l00628"></a>00628                <span class="keywordflow">break</span>;
<a name="l00629"></a>00629          <span class="keywordflow">if</span> (lpos)      <span class="comment">/* as i said... */</span>
<a name="l00630"></a>00630             <span class="keywordflow">continue</span>;
<a name="l00631"></a>00631          <span class="comment">/* now we have a GBSC starting somewhere in d[i-1],</span>
<a name="l00632"></a>00632 <span class="comment">          * but it might be not byte-aligned</span>
<a name="l00633"></a>00633 <span class="comment">          */</span>
<a name="l00634"></a>00634          <span class="keywordflow">if</span> (rpos == 0x80) {  <span class="comment">/* lucky case */</span>
<a name="l00635"></a>00635             i = i - 1;
<a name="l00636"></a>00636          } <span class="keywordflow">else</span> { <span class="comment">/* XXX to be completed */</span>
<a name="l00637"></a>00637             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;unaligned GBSC 0x%x %d\n&quot;</span>,
<a name="l00638"></a>00638                rpos, rpos_i);
<a name="l00639"></a>00639          }
<a name="l00640"></a>00640          <span class="keywordflow">break</span>;
<a name="l00641"></a>00641       }
<a name="l00642"></a>00642       <span class="comment">/* This frame is up to offset i (not inclusive).</span>
<a name="l00643"></a>00643 <span class="comment">       * We do not split it yet even if larger than MTU.</span>
<a name="l00644"></a>00644 <span class="comment">       */</span>
<a name="l00645"></a>00645       f = <a class="code" href="vcodecs_8c.html#a892b5df711685dfbc8e1dcb14ac0e9a4">create_video_frame</a>(d + start, d+i, <a class="code" href="frame_8h.html#a750506bc6e9117c66a5a6ad2dc82bc85">AST_FORMAT_H263</a>,
<a name="l00646"></a>00646             pheader_len, cur);
<a name="l00647"></a>00647 
<a name="l00648"></a>00648       <span class="keywordflow">if</span> (!f)
<a name="l00649"></a>00649          <span class="keywordflow">break</span>;
<a name="l00650"></a>00650       memmove(f-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, h, 4);   <span class="comment">/* copy the h263 header */</span>
<a name="l00651"></a>00651       <span class="comment">/* XXX to do: if not aligned, fix sbit and ebit,</span>
<a name="l00652"></a>00652 <span class="comment">       * then move i back by 1 for the next frame</span>
<a name="l00653"></a>00653 <span class="comment">       */</span>
<a name="l00654"></a>00654       <span class="keywordflow">if</span> (!cur)
<a name="l00655"></a>00655          first = f;
<a name="l00656"></a>00656       cur = f;
<a name="l00657"></a>00657    }
<a name="l00658"></a>00658 
<a name="l00659"></a>00659    <span class="keywordflow">if</span> (cur)
<a name="l00660"></a>00660       cur-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> |= 1;  <span class="comment">// RTP Marker</span>
<a name="l00661"></a>00661 
<a name="l00662"></a>00662    *tail = cur;
<a name="l00663"></a>00663    <span class="keywordflow">return</span> first;
<a name="l00664"></a>00664 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9c8cb3acefa3f2825fb6c5515a1fc791"></a><!-- doxytag: member="vcodecs.c::h263p_decap" ref="a9c8cb3acefa3f2825fb6c5515a1fc791" args="(struct fbuf_t *b, uint8_t *data, int len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int h263p_decap </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structfbuf__t.html">fbuf_t</a> *&nbsp;</td>
          <td class="paramname"> <em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>len</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>extract the bitstreem from the RTP payload. This is format dependent. For h263+, the format is defined in RFC 2429 and basically has a fixed 2-byte header as follows: 5 bits RR reserved, shall be 0 1 bit P indicate a start/end condition, in which case the payload should be prepended by two zero-valued bytes. 1 bit V there is an additional VRC header after this header 6 bits PLEN length in bytes of extra picture header 3 bits PEBIT how many bits to be ignored in the last byte </p>
<p>XXX the code below is not complete. </p>

<p>Definition at line <a class="el" href="vcodecs_8c_source.html#l00429">429</a> of file <a class="el" href="vcodecs_8c_source.html">vcodecs.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="vcodecs_8c_source.html#l00269">fbuf_append()</a>, and <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00430"></a>00430 {
<a name="l00431"></a>00431    <span class="keywordtype">int</span> PLEN;
<a name="l00432"></a>00432 
<a name="l00433"></a>00433    <span class="keywordflow">if</span> (<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> &lt; 2) {
<a name="l00434"></a>00434       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;invalid framesize %d\n&quot;</span>, <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>);
<a name="l00435"></a>00435       <span class="keywordflow">return</span> 1;
<a name="l00436"></a>00436    }
<a name="l00437"></a>00437    PLEN = ( (<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>[0] &amp; 1) &lt;&lt; 5 ) | ( (<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>[1] &amp; 0xf8) &gt;&gt; 3);
<a name="l00438"></a>00438 
<a name="l00439"></a>00439    <span class="keywordflow">if</span> (PLEN &gt; 0) {
<a name="l00440"></a>00440       <a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a> += PLEN;
<a name="l00441"></a>00441       <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> -= PLEN;
<a name="l00442"></a>00442    }
<a name="l00443"></a>00443    <span class="keywordflow">if</span> (<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>[0] &amp; 4)  <span class="comment">/* bit P */</span>
<a name="l00444"></a>00444       <a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>[0] = <a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>[1] = 0;
<a name="l00445"></a>00445    <span class="keywordflow">else</span> {
<a name="l00446"></a>00446       <a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a> += 2;
<a name="l00447"></a>00447       <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> -= 2;
<a name="l00448"></a>00448    }
<a name="l00449"></a>00449    <span class="keywordflow">return</span> <a class="code" href="vcodecs_8c.html#a9673830c01bbadf4a9ace67169bf1719">fbuf_append</a>(b, <a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>, <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, 0, 0);   <span class="comment">/* ignore trail bits */</span>
<a name="l00450"></a>00450 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a35a454f50b41cb933796d096d3d37c9a"></a><!-- doxytag: member="vcodecs.c::h263p_enc_init" ref="a35a454f50b41cb933796d096d3d37c9a" args="(AVCodecContext *enc_ctx)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int h263p_enc_init </td>
          <td>(</td>
          <td class="paramtype">AVCodecContext *&nbsp;</td>
          <td class="paramname"> <em>enc_ctx</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>initialization of h263p </p>

<p>Definition at line <a class="el" href="vcodecs_8c_source.html#l00331">331</a> of file <a class="el" href="vcodecs_8c_source.html">vcodecs.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00332"></a>00332 {
<a name="l00333"></a>00333    <span class="comment">/* modes supported are</span>
<a name="l00334"></a>00334 <span class="comment">   - Unrestricted Motion Vector (annex D)</span>
<a name="l00335"></a>00335 <span class="comment">   - Advanced Prediction (annex F)</span>
<a name="l00336"></a>00336 <span class="comment">   - Advanced Intra Coding (annex I)</span>
<a name="l00337"></a>00337 <span class="comment">   - Deblocking Filter (annex J)</span>
<a name="l00338"></a>00338 <span class="comment">   - Slice Structure (annex K)</span>
<a name="l00339"></a>00339 <span class="comment">   - Alternative Inter VLC (annex S)</span>
<a name="l00340"></a>00340 <span class="comment">   - Modified Quantization (annex T)</span>
<a name="l00341"></a>00341 <span class="comment">   */</span>
<a name="l00342"></a>00342    enc_ctx-&gt;flags |=CODEC_FLAG_H263P_UMV; <span class="comment">/* annex D */</span>
<a name="l00343"></a>00343    enc_ctx-&gt;flags |=CODEC_FLAG_AC_PRED; <span class="comment">/* annex f ? */</span>
<a name="l00344"></a>00344    enc_ctx-&gt;flags |=CODEC_FLAG_H263P_SLICE_STRUCT; <span class="comment">/* annex k */</span>
<a name="l00345"></a>00345    enc_ctx-&gt;flags |= CODEC_FLAG_H263P_AIC; <span class="comment">/* annex I */</span>
<a name="l00346"></a>00346 
<a name="l00347"></a>00347    <span class="keywordflow">return</span> 0;
<a name="l00348"></a>00348 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab4480005bfb416a5085c8d59582ce0c9"></a><!-- doxytag: member="vcodecs.c::h263p_encap" ref="ab4480005bfb416a5085c8d59582ce0c9" args="(struct fbuf_t *b, int mtu, struct ast_frame **tail)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__frame.html">ast_frame</a>* h263p_encap </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structfbuf__t.html">fbuf_t</a> *&nbsp;</td>
          <td class="paramname"> <em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>mtu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__frame.html">ast_frame</a> **&nbsp;</td>
          <td class="paramname"> <em>tail</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="vcodecs_8c_source.html#l00356">356</a> of file <a class="el" href="vcodecs_8c_source.html">vcodecs.c</a>.</p>

<p>References <a class="el" href="frame_8h_source.html#l00283">AST_FORMAT_H263_PLUS</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="vcodecs_8c_source.html#l00224">create_video_frame()</a>, <a class="el" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">ast_frame::data</a>, <a class="el" href="console__video_8h_source.html#l00060">fbuf_t::data</a>, <a class="el" href="format__g726_8c_source.html#l00177">f</a>, <a class="el" href="devicestate_8c_source.html#l00198">first</a>, <a class="el" href="func__strings_8c_source.html#l00821">len()</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="utils_8h_source.html#l00224">MIN</a>, <a class="el" href="frame_8h_source.html#l00159">ast_frame::ptr</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, and <a class="el" href="console__video_8h_source.html#l00063">fbuf_t::used</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00358"></a>00358 {
<a name="l00359"></a>00359    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *cur = NULL, *<a class="code" href="devicestate_8c.html#abd2135e6f8a41bc900933b1985d97165">first</a> = NULL;
<a name="l00360"></a>00360    uint8_t *d = b-&gt;<a class="code" href="structfbuf__t.html#abe222f6d3581e7920dcad5306cc906a8">data</a>;
<a name="l00361"></a>00361    <span class="keywordtype">int</span> <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> = b-&gt;<a class="code" href="structfbuf__t.html#a5810b6407672b8e7aeba609b4bb649de">used</a>;
<a name="l00362"></a>00362    <span class="keywordtype">int</span> l = len; <span class="comment">/* size of the current fragment. If 0, must look for a psc */</span>
<a name="l00363"></a>00363 
<a name="l00364"></a>00364    <span class="keywordflow">for</span> (;len &gt; 0; len -= l, d += l) {
<a name="l00365"></a>00365       uint8_t *<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>;
<a name="l00366"></a>00366       <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l00367"></a>00367       <span class="keywordtype">int</span> i, h;
<a name="l00368"></a>00368 
<a name="l00369"></a>00369       <span class="keywordflow">if</span> (len &gt;= 3 &amp;&amp; d[0] == 0 &amp;&amp; d[1] == 0 &amp;&amp; d[2] &gt;= 0x80) {
<a name="l00370"></a>00370          <span class="comment">/* we are starting a new block, so look for a PSC. */</span>
<a name="l00371"></a>00371          <span class="keywordflow">for</span> (i = 3; i &lt; len - 3; i++) {
<a name="l00372"></a>00372             <span class="keywordflow">if</span> (d[i] == 0 &amp;&amp; d[i+1] == 0 &amp;&amp; d[i+2] &gt;= 0x80) {
<a name="l00373"></a>00373                l = i;
<a name="l00374"></a>00374                <span class="keywordflow">break</span>;
<a name="l00375"></a>00375             }
<a name="l00376"></a>00376          }
<a name="l00377"></a>00377       }
<a name="l00378"></a>00378       <span class="keywordflow">if</span> (l &gt; mtu || l &gt; len) { <span class="comment">/* psc not found, split */</span>
<a name="l00379"></a>00379          l = <a class="code" href="utils_8h.html#a3acffbd305ee72dcd4593c0d8af64a4f">MIN</a>(len, mtu);
<a name="l00380"></a>00380       }
<a name="l00381"></a>00381       <span class="keywordflow">if</span> (l &lt; 1 || l &gt; mtu) {
<a name="l00382"></a>00382          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;--- frame error l %d\n&quot;</span>, l);
<a name="l00383"></a>00383          <span class="keywordflow">break</span>;
<a name="l00384"></a>00384       }
<a name="l00385"></a>00385       
<a name="l00386"></a>00386       <span class="keywordflow">if</span> (d[0] == 0 &amp;&amp; d[1] == 0) { <span class="comment">/* we start with a psc */</span>
<a name="l00387"></a>00387          h = 0;
<a name="l00388"></a>00388       } <span class="keywordflow">else</span> { <span class="comment">/* no psc, create a header */</span>
<a name="l00389"></a>00389          h = 2;
<a name="l00390"></a>00390       }
<a name="l00391"></a>00391 
<a name="l00392"></a>00392       f = <a class="code" href="vcodecs_8c.html#a892b5df711685dfbc8e1dcb14ac0e9a4">create_video_frame</a>(d, d+l, <a class="code" href="frame_8h.html#aea05b09095ebe8302b1187f4f0b0d042">AST_FORMAT_H263_PLUS</a>, h, cur);
<a name="l00393"></a>00393       <span class="keywordflow">if</span> (!f)
<a name="l00394"></a>00394          <span class="keywordflow">break</span>;
<a name="l00395"></a>00395 
<a name="l00396"></a>00396       data = f-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>;
<a name="l00397"></a>00397       <span class="keywordflow">if</span> (h == 0) {  <span class="comment">/* we start with a psc */</span>
<a name="l00398"></a>00398          data[0] |= 0x04;  <span class="comment">// set P == 1, and we are done</span>
<a name="l00399"></a>00399       } <span class="keywordflow">else</span> { <span class="comment">/* no psc, create a header */</span>
<a name="l00400"></a>00400          data[0] = data[1] = 0;  <span class="comment">// P == 0</span>
<a name="l00401"></a>00401       }
<a name="l00402"></a>00402 
<a name="l00403"></a>00403       <span class="keywordflow">if</span> (!cur)
<a name="l00404"></a>00404          first = f;
<a name="l00405"></a>00405       cur = f;
<a name="l00406"></a>00406    }
<a name="l00407"></a>00407 
<a name="l00408"></a>00408    <span class="keywordflow">if</span> (cur)
<a name="l00409"></a>00409       cur-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> |= 1; <span class="comment">// RTP Marker</span>
<a name="l00410"></a>00410 
<a name="l00411"></a>00411    *tail = cur;   <span class="comment">/* end of the list */</span>
<a name="l00412"></a>00412    <span class="keywordflow">return</span> first;
<a name="l00413"></a>00413 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6da3894d832e07cc1048f3138e308c6e"></a><!-- doxytag: member="vcodecs.c::h264_dec_init" ref="a6da3894d832e07cc1048f3138e308c6e" args="(AVCodecContext *dec_ctx)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int h264_dec_init </td>
          <td>(</td>
          <td class="paramtype">AVCodecContext *&nbsp;</td>
          <td class="paramname"> <em>dec_ctx</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="vcodecs_8c_source.html#l00934">934</a> of file <a class="el" href="vcodecs_8c_source.html">vcodecs.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00935"></a>00935 {
<a name="l00936"></a>00936    dec_ctx-&gt;flags |= CODEC_FLAG_TRUNCATED;
<a name="l00937"></a>00937 
<a name="l00938"></a>00938    <span class="keywordflow">return</span> 0;
<a name="l00939"></a>00939 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aad0a57d8277f76d3bd871900ede66b18"></a><!-- doxytag: member="vcodecs.c::h264_decap" ref="aad0a57d8277f76d3bd871900ede66b18" args="(struct fbuf_t *b, uint8_t *data, int len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int h264_decap </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structfbuf__t.html">fbuf_t</a> *&nbsp;</td>
          <td class="paramname"> <em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>len</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="vcodecs_8c_source.html#l01042">1042</a> of file <a class="el" href="vcodecs_8c_source.html">vcodecs.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="vcodecs_8c_source.html#l00269">fbuf_append()</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, and <a class="el" href="evt_8c_source.html#l00071">type</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01043"></a>01043 {
<a name="l01044"></a>01044    <span class="comment">/* Start Code Prefix (Annex B in specification) */</span>
<a name="l01045"></a>01045    uint8_t scp[] = { 0x00, 0x00, 0x00, 0x01 };
<a name="l01046"></a>01046    <span class="keywordtype">int</span> retval = 0;
<a name="l01047"></a>01047    <span class="keywordtype">int</span> <a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>, ofs = 0;
<a name="l01048"></a>01048 
<a name="l01049"></a>01049    <span class="keywordflow">if</span> (<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> &lt; 2) {
<a name="l01050"></a>01050       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;--- invalid len %d\n&quot;</span>, <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>);
<a name="l01051"></a>01051       <span class="keywordflow">return</span> 1;
<a name="l01052"></a>01052    }
<a name="l01053"></a>01053    <span class="comment">/* first of all, check if the packet has F == 0 */</span>
<a name="l01054"></a>01054    <span class="keywordflow">if</span> (<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>[0] &amp; 0x80) {
<a name="l01055"></a>01055       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;--- forbidden packet; nal: %02x\n&quot;</span>,
<a name="l01056"></a>01056          <a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>[0]);
<a name="l01057"></a>01057       <span class="keywordflow">return</span> 1;
<a name="l01058"></a>01058    }
<a name="l01059"></a>01059 
<a name="l01060"></a>01060    type = <a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>[0] &amp; 0x1f;
<a name="l01061"></a>01061    <span class="keywordflow">switch</span> (type) {
<a name="l01062"></a>01062    <span class="keywordflow">case</span> 0:
<a name="l01063"></a>01063    <span class="keywordflow">case</span> 31:
<a name="l01064"></a>01064       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;--- invalid type: %d\n&quot;</span>, type);
<a name="l01065"></a>01065       <span class="keywordflow">return</span> 1;
<a name="l01066"></a>01066    <span class="keywordflow">case</span> 24:
<a name="l01067"></a>01067    <span class="keywordflow">case</span> 25:
<a name="l01068"></a>01068    <span class="keywordflow">case</span> 26:
<a name="l01069"></a>01069    <span class="keywordflow">case</span> 27:
<a name="l01070"></a>01070    <span class="keywordflow">case</span> 29:
<a name="l01071"></a>01071       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;--- encapsulation not supported : %d\n&quot;</span>, type);
<a name="l01072"></a>01072       <span class="keywordflow">return</span> 1;
<a name="l01073"></a>01073    <span class="keywordflow">case</span> 28: <span class="comment">/* FU-A Unit */</span>
<a name="l01074"></a>01074       <span class="keywordflow">if</span> (<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>[1] &amp; 0x80) { <span class="comment">// S == 1, import F and NRI from next</span>
<a name="l01075"></a>01075          <a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>[1] &amp;= 0x1f;  <span class="comment">/* preserve type */</span>
<a name="l01076"></a>01076          <a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>[1] |= (<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>[0] &amp; 0xe0);  <span class="comment">/* import F &amp; NRI */</span>
<a name="l01077"></a>01077          retval = <a class="code" href="vcodecs_8c.html#a9673830c01bbadf4a9ace67169bf1719">fbuf_append</a>(b, scp, <span class="keyword">sizeof</span>(scp), 0, 0);
<a name="l01078"></a>01078          ofs = 1;
<a name="l01079"></a>01079       } <span class="keywordflow">else</span> {
<a name="l01080"></a>01080          ofs = 2;
<a name="l01081"></a>01081       }
<a name="l01082"></a>01082       <span class="keywordflow">break</span>;
<a name="l01083"></a>01083    <span class="keywordflow">default</span>: <span class="comment">/* From 1 to 23 (Single NAL Unit) */</span>
<a name="l01084"></a>01084       retval = <a class="code" href="vcodecs_8c.html#a9673830c01bbadf4a9ace67169bf1719">fbuf_append</a>(b, scp, <span class="keyword">sizeof</span>(scp), 0, 0);
<a name="l01085"></a>01085    }
<a name="l01086"></a>01086    <span class="keywordflow">if</span> (!retval)
<a name="l01087"></a>01087       retval = <a class="code" href="vcodecs_8c.html#a9673830c01bbadf4a9ace67169bf1719">fbuf_append</a>(b, <a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a> + ofs, <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> - ofs, 0, 0);
<a name="l01088"></a>01088    <span class="keywordflow">if</span> (retval)
<a name="l01089"></a>01089       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;result %d\n&quot;</span>, retval);
<a name="l01090"></a>01090    <span class="keywordflow">return</span> retval;
<a name="l01091"></a>01091 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a11bf5ca42fa94928cda691876fdb983d"></a><!-- doxytag: member="vcodecs.c::h264_enc_init" ref="a11bf5ca42fa94928cda691876fdb983d" args="(AVCodecContext *enc_ctx)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int h264_enc_init </td>
          <td>(</td>
          <td class="paramtype">AVCodecContext *&nbsp;</td>
          <td class="paramname"> <em>enc_ctx</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="vcodecs_8c_source.html#l00922">922</a> of file <a class="el" href="vcodecs_8c_source.html">vcodecs.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00923"></a>00923 {
<a name="l00924"></a>00924    enc_ctx-&gt;flags |= CODEC_FLAG_TRUNCATED;
<a name="l00925"></a>00925    <span class="comment">//enc_ctx-&gt;flags |= CODEC_FLAG_GLOBAL_HEADER;</span>
<a name="l00926"></a>00926    <span class="comment">//enc_ctx-&gt;flags2 |= CODEC_FLAG2_FASTPSKIP;</span>
<a name="l00927"></a>00927    <span class="comment">/* TODO: Maybe we need to add some other flags */</span>
<a name="l00928"></a>00928    enc_ctx-&gt;rtp_mode = 0;
<a name="l00929"></a>00929    enc_ctx-&gt;rtp_payload_size = 0;
<a name="l00930"></a>00930    enc_ctx-&gt;bit_rate_tolerance = enc_ctx-&gt;bit_rate;
<a name="l00931"></a>00931    <span class="keywordflow">return</span> 0;
<a name="l00932"></a>00932 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a28fe96bf04296634ce2ce6b98efb84db"></a><!-- doxytag: member="vcodecs.c::h264_encap" ref="a28fe96bf04296634ce2ce6b98efb84db" args="(struct fbuf_t *b, int mtu, struct ast_frame **tail)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__frame.html">ast_frame</a>* h264_encap </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structfbuf__t.html">fbuf_t</a> *&nbsp;</td>
          <td class="paramname"> <em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>mtu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__frame.html">ast_frame</a> **&nbsp;</td>
          <td class="paramname"> <em>tail</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="vcodecs_8c_source.html#l00955">955</a> of file <a class="el" href="vcodecs_8c_source.html">vcodecs.c</a>.</p>

<p>References <a class="el" href="frame_8h_source.html#l00285">AST_FORMAT_H264</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="vcodecs_8c_source.html#l00224">create_video_frame()</a>, <a class="el" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">ast_frame::data</a>, <a class="el" href="console__video_8h_source.html#l00060">fbuf_t::data</a>, <a class="el" href="format__g726_8c_source.html#l00177">f</a>, <a class="el" href="devicestate_8c_source.html#l00198">first</a>, <a class="el" href="vcodecs_8c.html#ab4eb9668d17077a876591fc738a4dafe">HAVE_NAL</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="utils_8h_source.html#l00224">MIN</a>, <a class="el" href="frame_8h_source.html#l00159">ast_frame::ptr</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, and <a class="el" href="console__video_8h_source.html#l00063">fbuf_t::used</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00957"></a>00957 {
<a name="l00958"></a>00958    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a> = NULL, *cur = NULL, *<a class="code" href="devicestate_8c.html#abd2135e6f8a41bc900933b1985d97165">first</a> = NULL;
<a name="l00959"></a>00959    uint8_t *d, *start = b-&gt;<a class="code" href="structfbuf__t.html#abe222f6d3581e7920dcad5306cc906a8">data</a>;
<a name="l00960"></a>00960    uint8_t *end = start + b-&gt;<a class="code" href="structfbuf__t.html#a5810b6407672b8e7aeba609b4bb649de">used</a>;
<a name="l00961"></a>00961 
<a name="l00962"></a>00962    <span class="comment">/* Search the first start code prefix - ITU-T H.264 sec. B.2,</span>
<a name="l00963"></a>00963 <span class="comment">    * and move start right after that, on the NAL header byte.</span>
<a name="l00964"></a>00964 <span class="comment">    */</span>
<a name="l00965"></a>00965 <span class="preprocessor">#define HAVE_NAL(x) (x[-4] == 0 &amp;&amp; x[-3] == 0 &amp;&amp; x[-2] == 0 &amp;&amp; x[-1] == 1)</span>
<a name="l00966"></a>00966 <span class="preprocessor"></span>   <span class="keywordflow">for</span> (start += 4; start &lt; end; start++) {
<a name="l00967"></a>00967       <span class="keywordtype">int</span> ty = start[0] &amp; 0x1f;
<a name="l00968"></a>00968       <span class="keywordflow">if</span> (<a class="code" href="vcodecs_8c.html#ab4eb9668d17077a876591fc738a4dafe">HAVE_NAL</a>(start) &amp;&amp; ty != 0 &amp;&amp; ty != 31)
<a name="l00969"></a>00969          <span class="keywordflow">break</span>;
<a name="l00970"></a>00970    }
<a name="l00971"></a>00971    <span class="comment">/* if not found, or too short, we just skip the next loop and are done. */</span>
<a name="l00972"></a>00972 
<a name="l00973"></a>00973    <span class="comment">/* Here follows the main loop to create frames. Search subsequent start</span>
<a name="l00974"></a>00974 <span class="comment">    * codes, and then possibly fragment the unit into smaller fragments.</span>
<a name="l00975"></a>00975 <span class="comment">    */</span>
<a name="l00976"></a>00976    <span class="keywordflow">for</span> (;start &lt; end - 4; start = d) {
<a name="l00977"></a>00977    <span class="keywordtype">int</span> size;      <span class="comment">/* size of current block */</span>
<a name="l00978"></a>00978    uint8_t hdr[2];      <span class="comment">/* add-on header when fragmenting */</span>
<a name="l00979"></a>00979    <span class="keywordtype">int</span> ty = 0;
<a name="l00980"></a>00980 
<a name="l00981"></a>00981    <span class="comment">/* now search next nal */</span>
<a name="l00982"></a>00982    <span class="keywordflow">for</span> (d = start + 4; d &lt; end; d++) {
<a name="l00983"></a>00983       ty = d[0] &amp; 0x1f;
<a name="l00984"></a>00984       <span class="keywordflow">if</span> (<a class="code" href="vcodecs_8c.html#ab4eb9668d17077a876591fc738a4dafe">HAVE_NAL</a>(d))
<a name="l00985"></a>00985          <span class="keywordflow">break</span>;   <span class="comment">/* found NAL */</span>
<a name="l00986"></a>00986    }
<a name="l00987"></a>00987    <span class="comment">/* have a block to send. d past the start code unless we overflow */</span>
<a name="l00988"></a>00988    <span class="keywordflow">if</span> (d &gt;= end) {   <span class="comment">/* NAL not found */</span>
<a name="l00989"></a>00989       d = end + 4;
<a name="l00990"></a>00990    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ty == 0 || ty == 31) { <span class="comment">/* found but invalid type, skip */</span>
<a name="l00991"></a>00991       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;skip invalid nal type %d at %d of %d\n&quot;</span>,
<a name="l00992"></a>00992          ty, d - (uint8_t *)b-&gt;<a class="code" href="structfbuf__t.html#abe222f6d3581e7920dcad5306cc906a8">data</a>, b-&gt;<a class="code" href="structfbuf__t.html#a5810b6407672b8e7aeba609b4bb649de">used</a>);
<a name="l00993"></a>00993       <span class="keywordflow">continue</span>;
<a name="l00994"></a>00994    }
<a name="l00995"></a>00995 
<a name="l00996"></a>00996    size = d - start - 4;   <span class="comment">/* don&apos;t count the end */</span>
<a name="l00997"></a>00997 
<a name="l00998"></a>00998    <span class="keywordflow">if</span> (size &lt; mtu) { <span class="comment">// test - don&apos;t fragment</span>
<a name="l00999"></a>00999       <span class="comment">// Single NAL Unit</span>
<a name="l01000"></a>01000       f = <a class="code" href="vcodecs_8c.html#a892b5df711685dfbc8e1dcb14ac0e9a4">create_video_frame</a>(start, d - 4, <a class="code" href="frame_8h.html#a884a71784d2a563dd54eb15c2cfc57b0">AST_FORMAT_H264</a>, 0, cur);
<a name="l01001"></a>01001       <span class="keywordflow">if</span> (!f)
<a name="l01002"></a>01002          <span class="keywordflow">break</span>;
<a name="l01003"></a>01003       <span class="keywordflow">if</span> (!first)
<a name="l01004"></a>01004          first = f;
<a name="l01005"></a>01005 
<a name="l01006"></a>01006       cur = f;
<a name="l01007"></a>01007       <span class="keywordflow">continue</span>;
<a name="l01008"></a>01008    }
<a name="l01009"></a>01009 
<a name="l01010"></a>01010    <span class="comment">// Fragmented Unit (Mode A: no DON, very weak)</span>
<a name="l01011"></a>01011    hdr[0] = (*start &amp; 0xe0) | 28;   <span class="comment">/* mark as a fragmentation unit */</span>
<a name="l01012"></a>01012    hdr[1] = (*start++ &amp; 0x1f) | 0x80 ; <span class="comment">/* keep type and set START bit */</span>
<a name="l01013"></a>01013    size--;     <span class="comment">/* skip the NAL header */</span>
<a name="l01014"></a>01014    <span class="keywordflow">while</span> (size) {
<a name="l01015"></a>01015       uint8_t *<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>;
<a name="l01016"></a>01016       <span class="keywordtype">int</span> frag_size = <a class="code" href="utils_8h.html#a3acffbd305ee72dcd4593c0d8af64a4f">MIN</a>(size, mtu);
<a name="l01017"></a>01017 
<a name="l01018"></a>01018       f = <a class="code" href="vcodecs_8c.html#a892b5df711685dfbc8e1dcb14ac0e9a4">create_video_frame</a>(start, start+frag_size, <a class="code" href="frame_8h.html#a884a71784d2a563dd54eb15c2cfc57b0">AST_FORMAT_H264</a>, 2, cur);
<a name="l01019"></a>01019       <span class="keywordflow">if</span> (!f)
<a name="l01020"></a>01020          <span class="keywordflow">break</span>;
<a name="l01021"></a>01021       size -= frag_size;   <span class="comment">/* skip this data block */</span>
<a name="l01022"></a>01022       start += frag_size;
<a name="l01023"></a>01023 
<a name="l01024"></a>01024       data = f-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>;
<a name="l01025"></a>01025       data[0] = hdr[0];
<a name="l01026"></a>01026       data[1] = hdr[1] | (size == 0 ? 0x40 : 0);   <span class="comment">/* end bit if we are done */</span>
<a name="l01027"></a>01027       hdr[1] &amp;= ~0x80;  <span class="comment">/* clear start bit for subsequent frames */</span>
<a name="l01028"></a>01028       <span class="keywordflow">if</span> (!first)
<a name="l01029"></a>01029          first = f;
<a name="l01030"></a>01030       cur = f;
<a name="l01031"></a>01031    }
<a name="l01032"></a>01032     }
<a name="l01033"></a>01033 
<a name="l01034"></a>01034    <span class="keywordflow">if</span> (cur)
<a name="l01035"></a>01035       cur-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> |= 1;     <span class="comment">// RTP Marker</span>
<a name="l01036"></a>01036 
<a name="l01037"></a>01037    *tail = cur;
<a name="l01038"></a>01038 
<a name="l01039"></a>01039    <span class="keywordflow">return</span> first;
<a name="l01040"></a>01040 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3baa52b8258840aa068a6ab2a0e043ae"></a><!-- doxytag: member="vcodecs.c::map_video_codec" ref="a3baa52b8258840aa068a6ab2a0e043ae" args="(int fmt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structvideo__codec__desc.html">video_codec_desc</a>* map_video_codec </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fmt</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="vcodecs_8c_source.html#l01153">1153</a> of file <a class="el" href="vcodecs_8c_source.html">vcodecs.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="cdr__custom_8c_source.html#l00058">format</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, and <a class="el" href="cdr__adaptive__odbc_8c_source.html#l00053">name</a>.</p>

<p>Referenced by <a class="el" href="vcodecs_8c_source.html#l01199">dec_init()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01154"></a>01154 {
<a name="l01155"></a>01155    <span class="keywordtype">int</span> i;
<a name="l01156"></a>01156 
<a name="l01157"></a>01157    <span class="keywordflow">for</span> (i = 0; <a class="code" href="vcodecs_8c.html#a575da9919296e3bce230be7377758a84">supported_codecs</a>[i]; i++)
<a name="l01158"></a>01158       <span class="keywordflow">if</span> (fmt == <a class="code" href="vcodecs_8c.html#a575da9919296e3bce230be7377758a84">supported_codecs</a>[i]-&gt;<a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>) {
<a name="l01159"></a>01159          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;using %s for format 0x%x\n&quot;</span>,
<a name="l01160"></a>01160             <a class="code" href="vcodecs_8c.html#a575da9919296e3bce230be7377758a84">supported_codecs</a>[i]-&gt;<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, fmt);
<a name="l01161"></a>01161          <span class="keywordflow">return</span> <a class="code" href="vcodecs_8c.html#a575da9919296e3bce230be7377758a84">supported_codecs</a>[i];
<a name="l01162"></a>01162       }
<a name="l01163"></a>01163    <span class="keywordflow">return</span> NULL;
<a name="l01164"></a>01164 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a79c6a44f6d03b49cd202cc86822e39eb"></a><!-- doxytag: member="vcodecs.c::map_video_format" ref="a79c6a44f6d03b49cd202cc86822e39eb" args="(uint32_t ast_format, int rw)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static enum CodecID map_video_format </td>
          <td>(</td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>ast_format</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>rw</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>map an asterisk format into an ffmpeg one </p>

<p>Definition at line <a class="el" href="vcodecs_8c_source.html#l01129">1129</a> of file <a class="el" href="vcodecs_8c_source.html">vcodecs.c</a>.</p>

<p>References <a class="el" href="vcodecs_8c_source.html#l01110">_cm::ast_format</a>, <a class="el" href="vcodecs_8c_source.html#l01111">_cm::codec</a>, and <a class="el" href="struct__cm.html#a888483f84a7626d3eba4d5bf8cb63002">_cm::rw</a>.</p>

<p>Referenced by <a class="el" href="vcodecs_8c_source.html#l01199">dec_init()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01130"></a>01130 {
<a name="l01131"></a>01131    <span class="keyword">struct </span><a class="code" href="struct__cm.html">_cm</a> *i;
<a name="l01132"></a>01132 
<a name="l01133"></a>01133    <span class="keywordflow">for</span> (i = <a class="code" href="vcodecs_8c.html#a706faac5614a563d399cc21960747b33">video_formats</a>; i-&gt;<a class="code" href="struct__cm.html#a6ee9db214ae065c0c1c34dbde9ad1273">ast_format</a> != 0; i++)
<a name="l01134"></a>01134       <span class="keywordflow">if</span> (<a class="code" href="structast__format.html" title="Each supported file format is described by the following structure.">ast_format</a> &amp; i-&gt;<a class="code" href="struct__cm.html#a6ee9db214ae065c0c1c34dbde9ad1273">ast_format</a> &amp;&amp; <a class="code" href="struct__cm.html#a888483f84a7626d3eba4d5bf8cb63002">rw</a> &amp; i-&gt;<a class="code" href="struct__cm.html#a888483f84a7626d3eba4d5bf8cb63002">rw</a> &amp;&amp; <a class="code" href="struct__cm.html#a888483f84a7626d3eba4d5bf8cb63002">rw</a> &amp; i-&gt;<a class="code" href="struct__cm.html#a888483f84a7626d3eba4d5bf8cb63002">rw</a>)
<a name="l01135"></a>01135          <span class="keywordflow">return</span> i-&gt;<a class="code" href="struct__cm.html#aca295f35fb1ec34cca289d2cfabdcee2">codec</a>;
<a name="l01136"></a>01136    <span class="keywordflow">return</span> CODEC_ID_NONE;
<a name="l01137"></a>01137 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7b7ef85d92b560b5821062376b6d16e0"></a><!-- doxytag: member="vcodecs.c::mpeg4_decap" ref="a7b7ef85d92b560b5821062376b6d16e0" args="(struct fbuf_t *b, uint8_t *data, int len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int mpeg4_decap </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structfbuf__t.html">fbuf_t</a> *&nbsp;</td>
          <td class="paramname"> <em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>len</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="vcodecs_8c_source.html#l00889">889</a> of file <a class="el" href="vcodecs_8c_source.html">vcodecs.c</a>.</p>

<p>References <a class="el" href="vcodecs_8c_source.html#l00269">fbuf_append()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00890"></a>00890 {
<a name="l00891"></a>00891    <span class="keywordflow">return</span> <a class="code" href="vcodecs_8c.html#a9673830c01bbadf4a9ace67169bf1719">fbuf_append</a>(b, data, <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, 0, 0);
<a name="l00892"></a>00892 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5314faf28d69c699c3b007a727fdc02a"></a><!-- doxytag: member="vcodecs.c::mpeg4_decode" ref="a5314faf28d69c699c3b007a727fdc02a" args="(struct video_dec_desc *v, struct fbuf_t *b)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int mpeg4_decode </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structvideo__dec__desc.html">video_dec_desc</a> *&nbsp;</td>
          <td class="paramname"> <em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structfbuf__t.html">fbuf_t</a> *&nbsp;</td>
          <td class="paramname"> <em>b</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="vcodecs_8c_source.html#l00894">894</a> of file <a class="el" href="vcodecs_8c_source.html">vcodecs.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="vcodecs_8c_source.html#l00084">video_dec_desc::d_frame</a>, <a class="el" href="console__video_8h_source.html#l00060">fbuf_t::data</a>, <a class="el" href="frame_8h_source.html#l00147">ast_frame::datalen</a>, <a class="el" href="vcodecs_8c_source.html#l00082">video_dec_desc::dec_ctx</a>, <a class="el" href="console__video_8h_source.html#l00064">fbuf_t::ebit</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, and <a class="el" href="console__video_8h_source.html#l00063">fbuf_t::used</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00895"></a>00895 {
<a name="l00896"></a>00896    <span class="keywordtype">int</span> full_frame = 0, datalen = b-&gt;<a class="code" href="structfbuf__t.html#a5810b6407672b8e7aeba609b4bb649de">used</a>;
<a name="l00897"></a>00897    <span class="keywordtype">int</span> ret = avcodec_decode_video(v-&gt;<a class="code" href="structvideo__dec__desc.html#ac2bf6798f37e95d3d2ff2d44e4ab3c12">dec_ctx</a>, v-&gt;<a class="code" href="structvideo__dec__desc.html#ac62c84bfb8a2d6b64af87aefa0908837">d_frame</a>, &amp;full_frame,
<a name="l00898"></a>00898       b-&gt;<a class="code" href="structfbuf__t.html#abe222f6d3581e7920dcad5306cc906a8">data</a>, datalen);
<a name="l00899"></a>00899    <span class="keywordflow">if</span> (ret &lt; 0) {
<a name="l00900"></a>00900       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Error decoding\n&quot;</span>);
<a name="l00901"></a>00901       ret = datalen; <span class="comment">/* assume we used everything. */</span>
<a name="l00902"></a>00902    }
<a name="l00903"></a>00903    datalen -= ret;
<a name="l00904"></a>00904    <span class="keywordflow">if</span> (datalen &gt; 0)  <span class="comment">/* update b with leftover bytes */</span>
<a name="l00905"></a>00905       memmove(b-&gt;<a class="code" href="structfbuf__t.html#abe222f6d3581e7920dcad5306cc906a8">data</a>, b-&gt;<a class="code" href="structfbuf__t.html#abe222f6d3581e7920dcad5306cc906a8">data</a> + ret, datalen);
<a name="l00906"></a>00906    b-&gt;<a class="code" href="structfbuf__t.html#a5810b6407672b8e7aeba609b4bb649de">used</a> = datalen;
<a name="l00907"></a>00907    b-&gt;<a class="code" href="structfbuf__t.html#afc198efda3f50db2a5cae3c738528dd9">ebit</a> = 0;
<a name="l00908"></a>00908    <span class="keywordflow">return</span> full_frame;
<a name="l00909"></a>00909 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7cfea23475a1a6cbb996e75d321b4b2f"></a><!-- doxytag: member="vcodecs.c::mpeg4_enc_init" ref="a7cfea23475a1a6cbb996e75d321b4b2f" args="(AVCodecContext *enc_ctx)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int mpeg4_enc_init </td>
          <td>(</td>
          <td class="paramtype">AVCodecContext *&nbsp;</td>
          <td class="paramname"> <em>enc_ctx</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="vcodecs_8c_source.html#l00850">850</a> of file <a class="el" href="vcodecs_8c_source.html">vcodecs.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00851"></a>00851 {
<a name="l00852"></a>00852 <span class="preprocessor">#if 0</span>
<a name="l00853"></a>00853 <span class="preprocessor"></span>   <span class="comment">//enc_ctx-&gt;flags |= CODEC_FLAG_LOW_DELAY; /*don&apos;t use b frames ?*/</span>
<a name="l00854"></a>00854    enc_ctx-&gt;flags |= CODEC_FLAG_AC_PRED;
<a name="l00855"></a>00855    enc_ctx-&gt;flags |= CODEC_FLAG_H263P_UMV;
<a name="l00856"></a>00856    enc_ctx-&gt;flags |= CODEC_FLAG_QPEL;
<a name="l00857"></a>00857    enc_ctx-&gt;flags |= CODEC_FLAG_4MV;
<a name="l00858"></a>00858    enc_ctx-&gt;flags |= CODEC_FLAG_GMC;
<a name="l00859"></a>00859    enc_ctx-&gt;flags |= CODEC_FLAG_LOOP_FILTER;
<a name="l00860"></a>00860    enc_ctx-&gt;flags |= CODEC_FLAG_H263P_SLICE_STRUCT;
<a name="l00861"></a>00861 <span class="preprocessor">#endif</span>
<a name="l00862"></a>00862 <span class="preprocessor"></span>   enc_ctx-&gt;rtp_payload_size = 0; <span class="comment">/* important - ffmpeg fails otherwise */</span>
<a name="l00863"></a>00863    <span class="keywordflow">return</span> 0;
<a name="l00864"></a>00864 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5db3aec009dc4a928c6def805d9cc962"></a><!-- doxytag: member="vcodecs.c::mpeg4_encap" ref="a5db3aec009dc4a928c6def805d9cc962" args="(struct fbuf_t *b, int mtu, struct ast_frame **tail)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__frame.html">ast_frame</a>* mpeg4_encap </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structfbuf__t.html">fbuf_t</a> *&nbsp;</td>
          <td class="paramname"> <em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>mtu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__frame.html">ast_frame</a> **&nbsp;</td>
          <td class="paramname"> <em>tail</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="vcodecs_8c_source.html#l00867">867</a> of file <a class="el" href="vcodecs_8c_source.html">vcodecs.c</a>.</p>

<p>References <a class="el" href="frame_8h_source.html#l00287">AST_FORMAT_MP4_VIDEO</a>, <a class="el" href="vcodecs_8c_source.html#l00224">create_video_frame()</a>, <a class="el" href="console__video_8h_source.html#l00060">fbuf_t::data</a>, <a class="el" href="format__g726_8c_source.html#l00177">f</a>, <a class="el" href="devicestate_8c_source.html#l00198">first</a>, <a class="el" href="func__strings_8c_source.html#l00821">len()</a>, <a class="el" href="utils_8h_source.html#l00224">MIN</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, and <a class="el" href="console__video_8h_source.html#l00063">fbuf_t::used</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00869"></a>00869 {
<a name="l00870"></a>00870    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>, *cur = NULL, *<a class="code" href="devicestate_8c.html#abd2135e6f8a41bc900933b1985d97165">first</a> = NULL;
<a name="l00871"></a>00871    uint8_t *d = b-&gt;<a class="code" href="structfbuf__t.html#abe222f6d3581e7920dcad5306cc906a8">data</a>;
<a name="l00872"></a>00872    uint8_t *end = d + b-&gt;<a class="code" href="structfbuf__t.html#a5810b6407672b8e7aeba609b4bb649de">used</a>;
<a name="l00873"></a>00873    <span class="keywordtype">int</span> <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>;
<a name="l00874"></a>00874 
<a name="l00875"></a>00875    <span class="keywordflow">for</span> (;d &lt; end; d += len, cur = f) {
<a name="l00876"></a>00876       len = <a class="code" href="utils_8h.html#a3acffbd305ee72dcd4593c0d8af64a4f">MIN</a>(mtu, end - d);
<a name="l00877"></a>00877       f = <a class="code" href="vcodecs_8c.html#a892b5df711685dfbc8e1dcb14ac0e9a4">create_video_frame</a>(d, d + len, <a class="code" href="frame_8h.html#a315d4a14bcf11a55ea8df52dd3a74d35">AST_FORMAT_MP4_VIDEO</a>, 0, cur);
<a name="l00878"></a>00878       <span class="keywordflow">if</span> (!f)
<a name="l00879"></a>00879          <span class="keywordflow">break</span>;
<a name="l00880"></a>00880       <span class="keywordflow">if</span> (!first)
<a name="l00881"></a>00881          first = f;
<a name="l00882"></a>00882    }
<a name="l00883"></a>00883    <span class="keywordflow">if</span> (cur)
<a name="l00884"></a>00884       cur-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> |= 1;
<a name="l00885"></a>00885    *tail = cur;
<a name="l00886"></a>00886    <span class="keywordflow">return</span> first;
<a name="l00887"></a>00887 }
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="acf1392eab8a042722e340e508711acf8"></a><!-- doxytag: member="vcodecs.c::h261_codec" ref="acf1392eab8a042722e340e508711acf8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structvideo__codec__desc.html">video_codec_desc</a> <a class="el" href="vcodecs_8c.html#acf1392eab8a042722e340e508711acf8">h261_codec</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="vcodecs_8c_source.html#l00838">838</a> of file <a class="el" href="vcodecs_8c_source.html">vcodecs.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae8ad59fa39ac2d9011b2c3f2bb1fc18c"></a><!-- doxytag: member="vcodecs.c::h263_codec" ref="ae8ad59fa39ac2d9011b2c3f2bb1fc18c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structvideo__codec__desc.html">video_codec_desc</a> <a class="el" href="vcodecs_8c.html#ae8ad59fa39ac2d9011b2c3f2bb1fc18c">h263_codec</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="vcodecs_8c_source.html#l00685">685</a> of file <a class="el" href="vcodecs_8c_source.html">vcodecs.c</a>.</p>

</div>
</div>
<a class="anchor" id="a0c232bab64dd9e78d85eac98d52f6122"></a><!-- doxytag: member="vcodecs.c::h263p_codec" ref="a0c232bab64dd9e78d85eac98d52f6122" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structvideo__codec__desc.html">video_codec_desc</a> <a class="el" href="vcodecs_8c.html#a0c232bab64dd9e78d85eac98d52f6122">h263p_codec</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="vcodecs_8c_source.html#l00513">513</a> of file <a class="el" href="vcodecs_8c_source.html">vcodecs.c</a>.</p>

</div>
</div>
<a class="anchor" id="a697e4e34d99ca86ae72bfd0ce4f9cf07"></a><!-- doxytag: member="vcodecs.c::h264_codec" ref="a697e4e34d99ca86ae72bfd0ce4f9cf07" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structvideo__codec__desc.html">video_codec_desc</a> <a class="el" href="vcodecs_8c.html#a697e4e34d99ca86ae72bfd0ce4f9cf07">h264_codec</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="vcodecs_8c_source.html#l01093">1093</a> of file <a class="el" href="vcodecs_8c_source.html">vcodecs.c</a>.</p>

</div>
</div>
<a class="anchor" id="a81fa277c9441c83d685042cb8e357a2b"></a><!-- doxytag: member="vcodecs.c::mpeg4_codec" ref="a81fa277c9441c83d685042cb8e357a2b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structvideo__codec__desc.html">video_codec_desc</a> <a class="el" href="vcodecs_8c.html#a81fa277c9441c83d685042cb8e357a2b">mpeg4_codec</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="vcodecs_8c_source.html#l00911">911</a> of file <a class="el" href="vcodecs_8c_source.html">vcodecs.c</a>.</p>

</div>
</div>
<a class="anchor" id="a575da9919296e3bce230be7377758a84"></a><!-- doxytag: member="vcodecs.c::supported_codecs" ref="a575da9919296e3bce230be7377758a84" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structvideo__codec__desc.html">video_codec_desc</a>* <a class="el" href="vcodecs_8c.html#a575da9919296e3bce230be7377758a84">supported_codecs</a>[]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="vcodecs_8c_source.html#l01140">1140</a> of file <a class="el" href="vcodecs_8c_source.html">vcodecs.c</a>.</p>

</div>
</div>
<a class="anchor" id="a706faac5614a563d399cc21960747b33"></a><!-- doxytag: member="vcodecs.c::video_formats" ref="a706faac5614a563d399cc21960747b33" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="struct__cm.html">_cm</a> <a class="el" href="vcodecs_8c.html#a706faac5614a563d399cc21960747b33">video_formats</a>[]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="vcodecs_8c_source.html#l01116">1116</a> of file <a class="el" href="vcodecs_8c_source.html">vcodecs.c</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:23:34 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
