<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:18:23 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_afe38fc0ccf2e9eefca5d5c6b03503d9.html">main</a>
  </div>
</div>
<div class="contents">
<h1>abstract_jb.c</h1><a href="abstract__jb_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * abstract_jb: common implementation-independent jitterbuffer stuff</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * Copyright (C) 2005, Attractel OOD</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * Contributors:</span>
<a name="l00007"></a>00007 <span class="comment"> * Slav Klenov &lt;slav@securax.org&gt;</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * See http://www.asterisk.org for more information about</span>
<a name="l00010"></a>00010 <span class="comment"> * the Asterisk project. Please do not directly contact</span>
<a name="l00011"></a>00011 <span class="comment"> * any of the maintainers of this project for assistance;</span>
<a name="l00012"></a>00012 <span class="comment"> * the project provides a web site, mailing lists and IRC</span>
<a name="l00013"></a>00013 <span class="comment"> * channels for your use.</span>
<a name="l00014"></a>00014 <span class="comment"> *</span>
<a name="l00015"></a>00015 <span class="comment"> * This program is free software, distributed under the terms of</span>
<a name="l00016"></a>00016 <span class="comment"> * the GNU General Public License Version 2. See the LICENSE file</span>
<a name="l00017"></a>00017 <span class="comment"> * at the top of the source tree.</span>
<a name="l00018"></a>00018 <span class="comment"> *</span>
<a name="l00019"></a>00019 <span class="comment"> * A license has been granted to Digium (via disclaimer) for the use of</span>
<a name="l00020"></a>00020 <span class="comment"> * this code.</span>
<a name="l00021"></a>00021 <span class="comment"> */</span>
<a name="l00022"></a>00022 <span class="comment"></span>
<a name="l00023"></a>00023 <span class="comment">/*! \file</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> * \brief Common implementation-independent jitterbuffer stuff.</span>
<a name="l00026"></a>00026 <span class="comment"> *</span>
<a name="l00027"></a>00027 <span class="comment"> * \author Slav Klenov &lt;slav@securax.org&gt;</span>
<a name="l00028"></a>00028 <span class="comment"> *</span>
<a name="l00029"></a>00029 <span class="comment"> *</span>
<a name="l00030"></a>00030 <span class="comment"> */</span>
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="asterisk_8h.html" title="Asterisk main include file. File version handling, generic pbx functions.">asterisk.h</a>&quot;</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <a class="code" href="asterisk_8h.html#ab0390be60f8c539a2662df2faf9985c7" title="Register/unregister a source code file with the core.">ASTERISK_FILE_VERSION</a>(__FILE__, <span class="stringliteral">&quot;$Revision: 249895 $&quot;</span>)
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;asterisk/frame.h&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="channel_8h.html" title="General Asterisk PBX channel definitions.">asterisk/channel.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="term_8h.html" title="Handy terminal functions for vt* terms.">asterisk/term.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="utils_8h.html" title="Utility functions.">asterisk/utils.h</a>&quot;</span>
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="abstract__jb_8h.html" title="Common implementation-independent jitterbuffer stuff.">asterisk/abstract_jb.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="fixedjitterbuf_8h.html" title="Jitterbuffering algorithm.">fixedjitterbuf.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="jitterbuf_8h.html" title="jitterbuf: an application-independent jitterbuffer jitterbuf.c">jitterbuf.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="comment"></span>
<a name="l00045"></a>00045 <span class="comment">/*! Internal jb flags */</span>
<a name="l00046"></a>00046 <span class="keyword">enum</span> {
<a name="l00047"></a><a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a8ee448ef258f740aeb4e0ea89436af6d">00047</a>    <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a8ee448ef258f740aeb4e0ea89436af6d">JB_USE</a> =                  (1 &lt;&lt; 0),
<a name="l00048"></a><a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140afe2d9a1cb0e496b589437b7faed7f23a">00048</a>    <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140afe2d9a1cb0e496b589437b7faed7f23a">JB_TIMEBASE_INITIALIZED</a> = (1 &lt;&lt; 1),
<a name="l00049"></a><a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a44ed8c27e26a66b03cedb8d77a424af5">00049</a>    <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a44ed8c27e26a66b03cedb8d77a424af5">JB_CREATED</a> =              (1 &lt;&lt; 2)
<a name="l00050"></a>00050 };
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 <span class="comment">/* Hooks for the abstract jb implementation */</span>
<a name="l00053"></a>00053 <span class="comment"></span>
<a name="l00054"></a>00054 <span class="comment">/*! \brief Create */</span>
<a name="l00055"></a><a class="code" href="abstract__jb_8c.html#ac33c50e6f663f5b75520e0f8cabefaa5">00055</a> <span class="keyword">typedef</span> <span class="keywordtype">void</span> * (*jb_create_impl)(<span class="keyword">struct </span><a class="code" href="structast__jb__conf.html" title="General jitterbuffer configuration.">ast_jb_conf</a> *general_config, <span class="keywordtype">long</span> resynch_threshold);<span class="comment"></span>
<a name="l00056"></a>00056 <span class="comment">/*! \brief Destroy */</span>
<a name="l00057"></a><a class="code" href="abstract__jb_8c.html#af6e44dd090df7c87e260586af24c8198">00057</a> <span class="keyword">typedef</span> void (*<a class="code" href="abstract__jb_8c.html#af6e44dd090df7c87e260586af24c8198" title="Destroy.">jb_destroy_impl</a>)(<span class="keywordtype">void</span> *jb);<span class="comment"></span>
<a name="l00058"></a>00058 <span class="comment">/*! \brief Put first frame */</span>
<a name="l00059"></a><a class="code" href="abstract__jb_8c.html#aeddfd70e2079adec1a8f09514db555cc">00059</a> <span class="keyword">typedef</span> int (*<a class="code" href="abstract__jb_8c.html#aeddfd70e2079adec1a8f09514db555cc" title="Put first frame.">jb_put_first_impl</a>)(<span class="keywordtype">void</span> *jb, <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *fin, <span class="keywordtype">long</span> now);<span class="comment"></span>
<a name="l00060"></a>00060 <span class="comment">/*! \brief Put frame */</span>
<a name="l00061"></a><a class="code" href="abstract__jb_8c.html#aef9ba4e9aa956033f21e34534be9d4eb">00061</a> <span class="keyword">typedef</span> int (*<a class="code" href="abstract__jb_8c.html#aef9ba4e9aa956033f21e34534be9d4eb" title="Put frame.">jb_put_impl</a>)(<span class="keywordtype">void</span> *jb, <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *fin, <span class="keywordtype">long</span> now);<span class="comment"></span>
<a name="l00062"></a>00062 <span class="comment">/*! \brief Get frame for now */</span>
<a name="l00063"></a><a class="code" href="abstract__jb_8c.html#af30239b717ff0c4abada12bb91a3f58a">00063</a> <span class="keyword">typedef</span> int (*<a class="code" href="abstract__jb_8c.html#af30239b717ff0c4abada12bb91a3f58a" title="Get frame for now.">jb_get_impl</a>)(<span class="keywordtype">void</span> *jb, <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> **fout, <span class="keywordtype">long</span> now, <span class="keywordtype">long</span> interpl);<span class="comment"></span>
<a name="l00064"></a>00064 <span class="comment">/*! \brief Get next */</span>
<a name="l00065"></a><a class="code" href="abstract__jb_8c.html#a372013644bd2e1ec16ffdfadf15ee0a3">00065</a> <span class="keyword">typedef</span> long (*<a class="code" href="abstract__jb_8c.html#a372013644bd2e1ec16ffdfadf15ee0a3" title="Get next.">jb_next_impl</a>)(<span class="keywordtype">void</span> *jb);<span class="comment"></span>
<a name="l00066"></a>00066 <span class="comment">/*! \brief Remove first frame */</span>
<a name="l00067"></a><a class="code" href="abstract__jb_8c.html#a5bc3b0a2788aef5af8dab19e1db97614">00067</a> <span class="keyword">typedef</span> int (*<a class="code" href="abstract__jb_8c.html#a5bc3b0a2788aef5af8dab19e1db97614" title="Remove first frame.">jb_remove_impl</a>)(<span class="keywordtype">void</span> *jb, <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> **fout);<span class="comment"></span>
<a name="l00068"></a>00068 <span class="comment">/*! \brief Force resynch */</span>
<a name="l00069"></a><a class="code" href="abstract__jb_8c.html#a78290891643d71c82fa5b5eb2ccc011e">00069</a> <span class="keyword">typedef</span> void (*<a class="code" href="abstract__jb_8c.html#a78290891643d71c82fa5b5eb2ccc011e" title="Force resynch.">jb_force_resynch_impl</a>)(<span class="keywordtype">void</span> *jb);<span class="comment"></span>
<a name="l00070"></a>00070 <span class="comment">/*! \brief Empty and reset jb */</span>
<a name="l00071"></a><a class="code" href="abstract__jb_8c.html#afa80e7315eb6d2878366388489f73423">00071</a> <span class="keyword">typedef</span> void (*<a class="code" href="abstract__jb_8c.html#afa80e7315eb6d2878366388489f73423" title="Empty and reset jb.">jb_empty_and_reset_impl</a>)(<span class="keywordtype">void</span> *jb);
<a name="l00072"></a>00072 <span class="comment"></span>
<a name="l00073"></a>00073 <span class="comment">/*!</span>
<a name="l00074"></a>00074 <span class="comment"> * \brief Jitterbuffer implementation private struct.</span>
<a name="l00075"></a>00075 <span class="comment"> */</span>
<a name="l00076"></a><a class="code" href="structast__jb__impl.html">00076</a> <span class="keyword">struct </span><a class="code" href="structast__jb__impl.html" title="Jitterbuffer implementation private struct.">ast_jb_impl</a>
<a name="l00077"></a>00077 {
<a name="l00078"></a><a class="code" href="structast__jb__impl.html#a5276c0a183c322592ca4435cf76f8fb2">00078</a>    <span class="keywordtype">char</span> <a class="code" href="structast__jb__impl.html#a5276c0a183c322592ca4435cf76f8fb2">name</a>[<a class="code" href="abstract__jb_8h.html#aed29eaebafbb4e5179d3a40d4d890e2e">AST_JB_IMPL_NAME_SIZE</a>];
<a name="l00079"></a><a class="code" href="structast__jb__impl.html#aa09fad8ce9439495f357baf080e4e938">00079</a>    <a class="code" href="abstract__jb_8c.html#ac33c50e6f663f5b75520e0f8cabefaa5" title="Create.">jb_create_impl</a> <a class="code" href="structast__jb__impl.html#aa09fad8ce9439495f357baf080e4e938">create</a>;
<a name="l00080"></a><a class="code" href="structast__jb__impl.html#a2deddc2d4df26e6e0e3ebde6c98f6647">00080</a>    <a class="code" href="abstract__jb_8c.html#af6e44dd090df7c87e260586af24c8198" title="Destroy.">jb_destroy_impl</a> <a class="code" href="structast__jb__impl.html#a2deddc2d4df26e6e0e3ebde6c98f6647">destroy</a>;
<a name="l00081"></a><a class="code" href="structast__jb__impl.html#a24838139378ea2320490859c89cbc3f9">00081</a>    <a class="code" href="abstract__jb_8c.html#aeddfd70e2079adec1a8f09514db555cc" title="Put first frame.">jb_put_first_impl</a> <a class="code" href="structast__jb__impl.html#a24838139378ea2320490859c89cbc3f9">put_first</a>;
<a name="l00082"></a><a class="code" href="structast__jb__impl.html#aee1fbf86e67d9bacc09a0dd8d77171bd">00082</a>    <a class="code" href="abstract__jb_8c.html#aef9ba4e9aa956033f21e34534be9d4eb" title="Put frame.">jb_put_impl</a> <a class="code" href="structast__jb__impl.html#aee1fbf86e67d9bacc09a0dd8d77171bd">put</a>;
<a name="l00083"></a><a class="code" href="structast__jb__impl.html#a14c509af9f72b5c0da46d422ec5bfc0e">00083</a>    <a class="code" href="abstract__jb_8c.html#af30239b717ff0c4abada12bb91a3f58a" title="Get frame for now.">jb_get_impl</a> <span class="keyword">get</span>;
<a name="l00084"></a><a class="code" href="structast__jb__impl.html#a9343b518a13ed73bb3f42c41792d7dee">00084</a>    <a class="code" href="abstract__jb_8c.html#a372013644bd2e1ec16ffdfadf15ee0a3" title="Get next.">jb_next_impl</a> <a class="code" href="structast__jb__impl.html#a9343b518a13ed73bb3f42c41792d7dee">next</a>;
<a name="l00085"></a><a class="code" href="structast__jb__impl.html#a66c0c9ee34addeb93c5adca833649f9b">00085</a>    <a class="code" href="abstract__jb_8c.html#a5bc3b0a2788aef5af8dab19e1db97614" title="Remove first frame.">jb_remove_impl</a> <span class="keyword">remove</span>;
<a name="l00086"></a><a class="code" href="structast__jb__impl.html#aeeb89aa0366801501aa518694cad193a">00086</a>    <a class="code" href="abstract__jb_8c.html#a78290891643d71c82fa5b5eb2ccc011e" title="Force resynch.">jb_force_resynch_impl</a> <a class="code" href="structast__jb__impl.html#aeeb89aa0366801501aa518694cad193a">force_resync</a>;
<a name="l00087"></a><a class="code" href="structast__jb__impl.html#a86d5347bd385fb0681a2e2414bff18be">00087</a>    <a class="code" href="abstract__jb_8c.html#afa80e7315eb6d2878366388489f73423" title="Empty and reset jb.">jb_empty_and_reset_impl</a> <a class="code" href="structast__jb__impl.html#a86d5347bd385fb0681a2e2414bff18be">empty_and_reset</a>;
<a name="l00088"></a>00088 };
<a name="l00089"></a>00089 
<a name="l00090"></a>00090 <span class="comment">/* Implementation functions */</span>
<a name="l00091"></a>00091 <span class="comment">/* fixed */</span>
<a name="l00092"></a>00092 <span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="abstract__jb_8c.html#aa306ce2e88c8949810f6e05fe9182cd2">jb_create_fixed</a>(<span class="keyword">struct</span> <a class="code" href="structast__jb__conf.html" title="General jitterbuffer configuration.">ast_jb_conf</a> *general_config, <span class="keywordtype">long</span> resynch_threshold);
<a name="l00093"></a>00093 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="abstract__jb_8c.html#abcb45d2c8505def068211243395ccde2">jb_destroy_fixed</a>(<span class="keywordtype">void</span> *jb);
<a name="l00094"></a>00094 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="abstract__jb_8c.html#aebc0713afb88453bbc688e7e7872c2d2">jb_put_first_fixed</a>(<span class="keywordtype">void</span> *jb, <span class="keyword">struct</span> <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *fin, <span class="keywordtype">long</span> now);
<a name="l00095"></a>00095 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="abstract__jb_8c.html#a17f4c25153594a57f188f3cad1d8c348">jb_put_fixed</a>(<span class="keywordtype">void</span> *jb, <span class="keyword">struct</span> <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *fin, <span class="keywordtype">long</span> now);
<a name="l00096"></a>00096 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="abstract__jb_8c.html#ae0cfc3efbefa40327321a552239879b2">jb_get_fixed</a>(<span class="keywordtype">void</span> *jb, <span class="keyword">struct</span> <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> **fout, <span class="keywordtype">long</span> now, <span class="keywordtype">long</span> interpl);
<a name="l00097"></a>00097 <span class="keyword">static</span> <span class="keywordtype">long</span> <a class="code" href="abstract__jb_8c.html#a63c65444eb6fcdb991ff9af96b8ea31f">jb_next_fixed</a>(<span class="keywordtype">void</span> *jb);
<a name="l00098"></a>00098 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="abstract__jb_8c.html#a19e4be4437c2a5e6a631c16e4eabf7f0">jb_remove_fixed</a>(<span class="keywordtype">void</span> *jb, <span class="keyword">struct</span> <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> **fout);
<a name="l00099"></a>00099 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="abstract__jb_8c.html#a3d74a011c952ca36c677e2fe73f284f1">jb_force_resynch_fixed</a>(<span class="keywordtype">void</span> *jb);
<a name="l00100"></a>00100 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="abstract__jb_8c.html#ada58865ed9b0d523853282c74aebd560">jb_empty_and_reset_fixed</a>(<span class="keywordtype">void</span> *jb);
<a name="l00101"></a>00101 <span class="comment">/* adaptive */</span>
<a name="l00102"></a>00102 <span class="keyword">static</span> <span class="keywordtype">void</span> * <a class="code" href="abstract__jb_8c.html#a7e0bdab27251e2595d5468001d73154e">jb_create_adaptive</a>(<span class="keyword">struct</span> <a class="code" href="structast__jb__conf.html" title="General jitterbuffer configuration.">ast_jb_conf</a> *general_config, <span class="keywordtype">long</span> resynch_threshold);
<a name="l00103"></a>00103 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="abstract__jb_8c.html#ac5b1d5ef57dbd7d0eef8e6a0f972bb1c">jb_destroy_adaptive</a>(<span class="keywordtype">void</span> *jb);
<a name="l00104"></a>00104 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="abstract__jb_8c.html#ab901ec2de556331d0ff46342d62c56bc">jb_put_first_adaptive</a>(<span class="keywordtype">void</span> *jb, <span class="keyword">struct</span> <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *fin, <span class="keywordtype">long</span> now);
<a name="l00105"></a>00105 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="abstract__jb_8c.html#a483b38f23bd9ef5293a6e3564c36f8bb">jb_put_adaptive</a>(<span class="keywordtype">void</span> *jb, <span class="keyword">struct</span> <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *fin, <span class="keywordtype">long</span> now);
<a name="l00106"></a>00106 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="abstract__jb_8c.html#a6f67e271e84cb1a28aee93f4c10958ea">jb_get_adaptive</a>(<span class="keywordtype">void</span> *jb, <span class="keyword">struct</span> <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> **fout, <span class="keywordtype">long</span> now, <span class="keywordtype">long</span> interpl);
<a name="l00107"></a>00107 <span class="keyword">static</span> <span class="keywordtype">long</span> <a class="code" href="abstract__jb_8c.html#a56b96eefcf15ae5ce37a7cdffbd65745">jb_next_adaptive</a>(<span class="keywordtype">void</span> *jb);
<a name="l00108"></a>00108 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="abstract__jb_8c.html#ad1e4c7a7c7ee99733beb66389a661ac9">jb_remove_adaptive</a>(<span class="keywordtype">void</span> *jb, <span class="keyword">struct</span> <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> **fout);
<a name="l00109"></a>00109 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="abstract__jb_8c.html#aa03c23606541409e6e3b5137d5f4a9c6">jb_force_resynch_adaptive</a>(<span class="keywordtype">void</span> *jb);
<a name="l00110"></a>00110 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="abstract__jb_8c.html#aaa70646a0eec8575d97b599ce9ce46ae">jb_empty_and_reset_adaptive</a>(<span class="keywordtype">void</span> *jb);
<a name="l00111"></a>00111 
<a name="l00112"></a>00112 <span class="comment">/* Available jb implementations */</span>
<a name="l00113"></a><a class="code" href="abstract__jb_8c.html#a8dce4e1485ccb46caf7b23b4d8ed2828">00113</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structast__jb__impl.html" title="Jitterbuffer implementation private struct.">ast_jb_impl</a> <a class="code" href="abstract__jb_8c.html#a8dce4e1485ccb46caf7b23b4d8ed2828">avail_impl</a>[] =
<a name="l00114"></a>00114 {
<a name="l00115"></a>00115    {
<a name="l00116"></a>00116       .<a class="code" href="structast__jb__impl.html#a5276c0a183c322592ca4435cf76f8fb2">name</a> = <span class="stringliteral">&quot;fixed&quot;</span>,
<a name="l00117"></a>00117       .create = <a class="code" href="abstract__jb_8c.html#aa306ce2e88c8949810f6e05fe9182cd2">jb_create_fixed</a>,
<a name="l00118"></a>00118       .destroy = <a class="code" href="abstract__jb_8c.html#abcb45d2c8505def068211243395ccde2">jb_destroy_fixed</a>,
<a name="l00119"></a>00119       .put_first = <a class="code" href="abstract__jb_8c.html#aebc0713afb88453bbc688e7e7872c2d2">jb_put_first_fixed</a>,
<a name="l00120"></a>00120       .put = <a class="code" href="abstract__jb_8c.html#a17f4c25153594a57f188f3cad1d8c348">jb_put_fixed</a>,
<a name="l00121"></a>00121       .get = <a class="code" href="abstract__jb_8c.html#ae0cfc3efbefa40327321a552239879b2">jb_get_fixed</a>,
<a name="l00122"></a>00122       .next = <a class="code" href="abstract__jb_8c.html#a63c65444eb6fcdb991ff9af96b8ea31f">jb_next_fixed</a>,
<a name="l00123"></a>00123       .remove = <a class="code" href="abstract__jb_8c.html#a19e4be4437c2a5e6a631c16e4eabf7f0">jb_remove_fixed</a>,
<a name="l00124"></a>00124       .force_resync = <a class="code" href="abstract__jb_8c.html#a3d74a011c952ca36c677e2fe73f284f1">jb_force_resynch_fixed</a>,
<a name="l00125"></a>00125       .empty_and_reset = <a class="code" href="abstract__jb_8c.html#ada58865ed9b0d523853282c74aebd560">jb_empty_and_reset_fixed</a>,
<a name="l00126"></a>00126    },
<a name="l00127"></a>00127    {
<a name="l00128"></a>00128       .name = <span class="stringliteral">&quot;adaptive&quot;</span>,
<a name="l00129"></a>00129       .create = <a class="code" href="abstract__jb_8c.html#a7e0bdab27251e2595d5468001d73154e">jb_create_adaptive</a>,
<a name="l00130"></a>00130       .destroy = <a class="code" href="abstract__jb_8c.html#ac5b1d5ef57dbd7d0eef8e6a0f972bb1c">jb_destroy_adaptive</a>,
<a name="l00131"></a>00131       .put_first = <a class="code" href="abstract__jb_8c.html#ab901ec2de556331d0ff46342d62c56bc">jb_put_first_adaptive</a>,
<a name="l00132"></a>00132       .put = <a class="code" href="abstract__jb_8c.html#a483b38f23bd9ef5293a6e3564c36f8bb">jb_put_adaptive</a>,
<a name="l00133"></a>00133       .get = <a class="code" href="abstract__jb_8c.html#a6f67e271e84cb1a28aee93f4c10958ea">jb_get_adaptive</a>,
<a name="l00134"></a>00134       .next = <a class="code" href="abstract__jb_8c.html#a56b96eefcf15ae5ce37a7cdffbd65745">jb_next_adaptive</a>,
<a name="l00135"></a>00135       .remove = <a class="code" href="abstract__jb_8c.html#ad1e4c7a7c7ee99733beb66389a661ac9">jb_remove_adaptive</a>,
<a name="l00136"></a>00136       .force_resync = <a class="code" href="abstract__jb_8c.html#aa03c23606541409e6e3b5137d5f4a9c6">jb_force_resynch_adaptive</a>,
<a name="l00137"></a>00137       .empty_and_reset = <a class="code" href="abstract__jb_8c.html#aaa70646a0eec8575d97b599ce9ce46ae">jb_empty_and_reset_adaptive</a>,
<a name="l00138"></a>00138    }
<a name="l00139"></a>00139 };
<a name="l00140"></a>00140 
<a name="l00141"></a><a class="code" href="abstract__jb_8c.html#a8d8b7e54c446a74316126f913a16917d">00141</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="abstract__jb_8c.html#a8d8b7e54c446a74316126f913a16917d">default_impl</a> = 0;
<a name="l00142"></a>00142 
<a name="l00143"></a>00143 <span class="comment"></span>
<a name="l00144"></a>00144 <span class="comment">/*! Abstract return codes */</span>
<a name="l00145"></a>00145 <span class="keyword">enum</span> {
<a name="l00146"></a><a class="code" href="abstract__jb_8c.html#a52864abcf6ebd8d120995b36fe6ce06ead66978f8f133d1d59c73904b675b170a">00146</a>    <a class="code" href="abstract__jb_8c.html#a52864abcf6ebd8d120995b36fe6ce06ead66978f8f133d1d59c73904b675b170a">JB_IMPL_OK</a>,
<a name="l00147"></a><a class="code" href="abstract__jb_8c.html#a52864abcf6ebd8d120995b36fe6ce06ea0aab6c8f8a1aab112134968c23d3ba9d">00147</a>    <a class="code" href="abstract__jb_8c.html#a52864abcf6ebd8d120995b36fe6ce06ea0aab6c8f8a1aab112134968c23d3ba9d">JB_IMPL_DROP</a>,
<a name="l00148"></a><a class="code" href="abstract__jb_8c.html#a52864abcf6ebd8d120995b36fe6ce06eae9d08ea7b7489c02574671c91104da61">00148</a>    <a class="code" href="abstract__jb_8c.html#a52864abcf6ebd8d120995b36fe6ce06eae9d08ea7b7489c02574671c91104da61">JB_IMPL_INTERP</a>,
<a name="l00149"></a><a class="code" href="abstract__jb_8c.html#a52864abcf6ebd8d120995b36fe6ce06ea39c6f6b3ff5a3a419e8fbce06ebb6bef">00149</a>    <a class="code" href="abstract__jb_8c.html#a52864abcf6ebd8d120995b36fe6ce06ea39c6f6b3ff5a3a419e8fbce06ebb6bef">JB_IMPL_NOFRAME</a>
<a name="l00150"></a>00150 };
<a name="l00151"></a>00151 
<a name="l00152"></a>00152 <span class="comment">/* Translations between impl and abstract return codes */</span>
<a name="l00153"></a><a class="code" href="abstract__jb_8c.html#a25549fb0a688998da474469286df66a2">00153</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="abstract__jb_8c.html#a25549fb0a688998da474469286df66a2">fixed_to_abstract_code</a>[] =
<a name="l00154"></a>00154    {<a class="code" href="abstract__jb_8c.html#a52864abcf6ebd8d120995b36fe6ce06ead66978f8f133d1d59c73904b675b170a">JB_IMPL_OK</a>, <a class="code" href="abstract__jb_8c.html#a52864abcf6ebd8d120995b36fe6ce06ea0aab6c8f8a1aab112134968c23d3ba9d">JB_IMPL_DROP</a>, <a class="code" href="abstract__jb_8c.html#a52864abcf6ebd8d120995b36fe6ce06eae9d08ea7b7489c02574671c91104da61">JB_IMPL_INTERP</a>, <a class="code" href="abstract__jb_8c.html#a52864abcf6ebd8d120995b36fe6ce06ea39c6f6b3ff5a3a419e8fbce06ebb6bef">JB_IMPL_NOFRAME</a>};
<a name="l00155"></a><a class="code" href="abstract__jb_8c.html#a08cd304f970e78738b727bd49f930835">00155</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="abstract__jb_8c.html#a08cd304f970e78738b727bd49f930835">adaptive_to_abstract_code</a>[] =
<a name="l00156"></a>00156    {<a class="code" href="abstract__jb_8c.html#a52864abcf6ebd8d120995b36fe6ce06ead66978f8f133d1d59c73904b675b170a">JB_IMPL_OK</a>, <a class="code" href="abstract__jb_8c.html#a52864abcf6ebd8d120995b36fe6ce06ea39c6f6b3ff5a3a419e8fbce06ebb6bef">JB_IMPL_NOFRAME</a>, JB_IMPL_NOFRAME, <a class="code" href="abstract__jb_8c.html#a52864abcf6ebd8d120995b36fe6ce06eae9d08ea7b7489c02574671c91104da61">JB_IMPL_INTERP</a>, <a class="code" href="abstract__jb_8c.html#a52864abcf6ebd8d120995b36fe6ce06ea0aab6c8f8a1aab112134968c23d3ba9d">JB_IMPL_DROP</a>, <a class="code" href="abstract__jb_8c.html#a52864abcf6ebd8d120995b36fe6ce06ead66978f8f133d1d59c73904b675b170a">JB_IMPL_OK</a>};
<a name="l00157"></a>00157 
<a name="l00158"></a>00158 <span class="comment">/* JB_GET actions (used only for the frames log) */</span>
<a name="l00159"></a><a class="code" href="abstract__jb_8c.html#a6cf1540bf0affb49cbc7a95efbfe315f">00159</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="abstract__jb_8c.html#a6cf1540bf0affb49cbc7a95efbfe315f">jb_get_actions</a>[] = {<span class="stringliteral">&quot;Delivered&quot;</span>, <span class="stringliteral">&quot;Dropped&quot;</span>, <span class="stringliteral">&quot;Interpolated&quot;</span>, <span class="stringliteral">&quot;No&quot;</span>};
<a name="l00160"></a>00160 <span class="comment"></span>
<a name="l00161"></a>00161 <span class="comment">/*! \brief Macros for the frame log files */</span>
<a name="l00162"></a><a class="code" href="abstract__jb_8c.html#a25587b898af76bc590a5d2905a160786">00162</a> <span class="preprocessor">#define jb_framelog(...) do { \</span>
<a name="l00163"></a>00163 <span class="preprocessor">   if (jb-&gt;logfile) { \</span>
<a name="l00164"></a>00164 <span class="preprocessor">      fprintf(jb-&gt;logfile, __VA_ARGS__); \</span>
<a name="l00165"></a>00165 <span class="preprocessor">      fflush(jb-&gt;logfile); \</span>
<a name="l00166"></a>00166 <span class="preprocessor">   } \</span>
<a name="l00167"></a>00167 <span class="preprocessor">} while (0)</span>
<a name="l00168"></a>00168 <span class="preprocessor"></span>
<a name="l00169"></a>00169 
<a name="l00170"></a>00170 <span class="comment">/* Internal utility functions */</span>
<a name="l00171"></a>00171 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="abstract__jb_8c.html#ab45f11b0a95110a51f848b2b873e1065">jb_choose_impl</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>);
<a name="l00172"></a>00172 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="abstract__jb_8c.html#a5cb94ef2c28559777814eaa4a4b12e0f">jb_get_and_deliver</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>);
<a name="l00173"></a>00173 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="abstract__jb_8c.html#a1af5788183300b288581f5606bcadcb1">create_jb</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, <span class="keyword">struct</span> <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *first_frame);
<a name="l00174"></a>00174 <span class="keyword">static</span> <span class="keywordtype">long</span> <a class="code" href="abstract__jb_8c.html#a1f09f2a933351d824c96a8f614261e5c">get_now</a>(<span class="keyword">struct</span> <a class="code" href="structast__jb.html" title="General jitterbuffer state.">ast_jb</a> *jb, <span class="keyword">struct</span> timeval *tv);
<a name="l00175"></a>00175 
<a name="l00176"></a>00176 
<a name="l00177"></a>00177 <span class="comment">/* Interface ast jb functions impl */</span>
<a name="l00178"></a>00178 
<a name="l00179"></a>00179 
<a name="l00180"></a><a class="code" href="abstract__jb_8c.html#ab45f11b0a95110a51f848b2b873e1065">00180</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="abstract__jb_8c.html#ab45f11b0a95110a51f848b2b873e1065">jb_choose_impl</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)
<a name="l00181"></a>00181 {
<a name="l00182"></a>00182    <span class="keyword">struct </span><a class="code" href="structast__jb.html" title="General jitterbuffer state.">ast_jb</a> *jb = &amp;chan-&gt;<a class="code" href="structast__channel.html#ac9cb7d989f739f5a082bcffd4262d4af">jb</a>;
<a name="l00183"></a>00183    <span class="keyword">struct </span><a class="code" href="structast__jb__conf.html" title="General jitterbuffer configuration.">ast_jb_conf</a> *jbconf = &amp;jb-&gt;<a class="code" href="structast__jb.html#a5e0765fcfec251b02238ec7159d3857a" title="Jitterbuffer configuration.">conf</a>;
<a name="l00184"></a>00184    <span class="keyword">struct </span><a class="code" href="structast__jb__impl.html" title="Jitterbuffer implementation private struct.">ast_jb_impl</a> *test_impl;
<a name="l00185"></a>00185    <span class="keywordtype">int</span> i, avail_impl_count = <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(avail_impl);
<a name="l00186"></a>00186 
<a name="l00187"></a>00187    jb-&gt;<a class="code" href="structast__jb.html#abb027c8d7c9c539e7e8ba8a31be7569f" title="Jitterbuffer implementation to be used.">impl</a> = &amp;avail_impl[default_impl];
<a name="l00188"></a>00188 
<a name="l00189"></a>00189    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(jbconf-&gt;<a class="code" href="structast__jb__conf.html#a60072c5fdc7f8f7772e49783b48e37a6" title="Name of the jitterbuffer implementation to be used.">impl</a>)) {
<a name="l00190"></a>00190       <span class="keywordflow">return</span>;
<a name="l00191"></a>00191    }
<a name="l00192"></a>00192 
<a name="l00193"></a>00193    <span class="keywordflow">for</span> (i = 0; i &lt; avail_impl_count; i++) {
<a name="l00194"></a>00194       test_impl = &amp;avail_impl[i];
<a name="l00195"></a>00195       <span class="keywordflow">if</span> (!strcasecmp(jbconf-&gt;<a class="code" href="structast__jb__conf.html#a60072c5fdc7f8f7772e49783b48e37a6" title="Name of the jitterbuffer implementation to be used.">impl</a>, test_impl-&gt;<a class="code" href="structast__jb__impl.html#a5276c0a183c322592ca4435cf76f8fb2">name</a>)) {
<a name="l00196"></a>00196          jb-&gt;<a class="code" href="structast__jb.html#abb027c8d7c9c539e7e8ba8a31be7569f" title="Jitterbuffer implementation to be used.">impl</a> = test_impl;
<a name="l00197"></a>00197          <span class="keywordflow">return</span>;
<a name="l00198"></a>00198       }
<a name="l00199"></a>00199    }
<a name="l00200"></a>00200 }
<a name="l00201"></a>00201 
<a name="l00202"></a><a class="code" href="abstract__jb_8c.html#ad013da092efd28ba7a6a21ee76297a80">00202</a> <span class="keywordtype">int</span> <a class="code" href="abstract__jb_8h.html#ad013da092efd28ba7a6a21ee76297a80" title="Checks the need of a jb use in a generic bridge.">ast_jb_do_usecheck</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c0, <span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c1)
<a name="l00203"></a>00203 {
<a name="l00204"></a>00204    <span class="keyword">struct </span><a class="code" href="structast__jb.html" title="General jitterbuffer state.">ast_jb</a> *jb0 = &amp;c0-&gt;<a class="code" href="structast__channel.html#ac9cb7d989f739f5a082bcffd4262d4af">jb</a>;
<a name="l00205"></a>00205    <span class="keyword">struct </span><a class="code" href="structast__jb.html" title="General jitterbuffer state.">ast_jb</a> *jb1 = &amp;c1-&gt;<a class="code" href="structast__channel.html#ac9cb7d989f739f5a082bcffd4262d4af">jb</a>;
<a name="l00206"></a>00206    <span class="keyword">struct </span><a class="code" href="structast__jb__conf.html" title="General jitterbuffer configuration.">ast_jb_conf</a> *conf0 = &amp;jb0-&gt;<a class="code" href="structast__jb.html#a5e0765fcfec251b02238ec7159d3857a" title="Jitterbuffer configuration.">conf</a>;
<a name="l00207"></a>00207    <span class="keyword">struct </span><a class="code" href="structast__jb__conf.html" title="General jitterbuffer configuration.">ast_jb_conf</a> *conf1 = &amp;jb1-&gt;<a class="code" href="structast__jb.html#a5e0765fcfec251b02238ec7159d3857a" title="Jitterbuffer configuration.">conf</a>;
<a name="l00208"></a>00208    <span class="keywordtype">int</span> c0_wants_jitter = c0-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a5f36febd4b26a025856e994a4e189a20">properties</a> &amp; <a class="code" href="channel_8h.html#a4f126a0a9b1d8c6a8f46a051ef8830bba54130226ec87f80c48ee98aa5cc9168c" title="Channels have this property if they can accept input with jitter; i.e. most VoIP...">AST_CHAN_TP_WANTSJITTER</a>;
<a name="l00209"></a>00209    <span class="keywordtype">int</span> c0_creates_jitter = c0-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a5f36febd4b26a025856e994a4e189a20">properties</a> &amp; <a class="code" href="channel_8h.html#a4f126a0a9b1d8c6a8f46a051ef8830bbafb2c9cea57f7fc8e0350ed6f60cbb892" title="Channels have this property if they can create jitter; i.e. most VoIP channels.">AST_CHAN_TP_CREATESJITTER</a>;
<a name="l00210"></a>00210    <span class="keywordtype">int</span> c0_jb_enabled = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(conf0, <a class="code" href="abstract__jb_8h.html#aad393aa3e173d7f081ab4bbc6ba5027daf49c3e265d3ff27e62d8c38779d89dd9">AST_JB_ENABLED</a>);
<a name="l00211"></a>00211    <span class="keywordtype">int</span> c0_force_jb = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(conf0, <a class="code" href="abstract__jb_8h.html#aad393aa3e173d7f081ab4bbc6ba5027dac9bdd81232f2ef32fad9ebd0b92b9f63">AST_JB_FORCED</a>);
<a name="l00212"></a>00212    <span class="keywordtype">int</span> c0_jb_timebase_initialized = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jb0, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140afe2d9a1cb0e496b589437b7faed7f23a">JB_TIMEBASE_INITIALIZED</a>);
<a name="l00213"></a>00213    <span class="keywordtype">int</span> c0_jb_created = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jb0, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a44ed8c27e26a66b03cedb8d77a424af5">JB_CREATED</a>);
<a name="l00214"></a>00214    <span class="keywordtype">int</span> c1_wants_jitter = c1-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a5f36febd4b26a025856e994a4e189a20">properties</a> &amp; <a class="code" href="channel_8h.html#a4f126a0a9b1d8c6a8f46a051ef8830bba54130226ec87f80c48ee98aa5cc9168c" title="Channels have this property if they can accept input with jitter; i.e. most VoIP...">AST_CHAN_TP_WANTSJITTER</a>;
<a name="l00215"></a>00215    <span class="keywordtype">int</span> c1_creates_jitter = c1-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a5f36febd4b26a025856e994a4e189a20">properties</a> &amp; <a class="code" href="channel_8h.html#a4f126a0a9b1d8c6a8f46a051ef8830bbafb2c9cea57f7fc8e0350ed6f60cbb892" title="Channels have this property if they can create jitter; i.e. most VoIP channels.">AST_CHAN_TP_CREATESJITTER</a>;
<a name="l00216"></a>00216    <span class="keywordtype">int</span> c1_jb_enabled = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(conf1, <a class="code" href="abstract__jb_8h.html#aad393aa3e173d7f081ab4bbc6ba5027daf49c3e265d3ff27e62d8c38779d89dd9">AST_JB_ENABLED</a>);
<a name="l00217"></a>00217    <span class="keywordtype">int</span> c1_force_jb = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(conf1, <a class="code" href="abstract__jb_8h.html#aad393aa3e173d7f081ab4bbc6ba5027dac9bdd81232f2ef32fad9ebd0b92b9f63">AST_JB_FORCED</a>);
<a name="l00218"></a>00218    <span class="keywordtype">int</span> c1_jb_timebase_initialized = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jb1, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140afe2d9a1cb0e496b589437b7faed7f23a">JB_TIMEBASE_INITIALIZED</a>);
<a name="l00219"></a>00219    <span class="keywordtype">int</span> c1_jb_created = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jb1, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a44ed8c27e26a66b03cedb8d77a424af5">JB_CREATED</a>);
<a name="l00220"></a>00220    <span class="keywordtype">int</span> <a class="code" href="pbx__gtkconsole_8c.html#a679cabe3b846f2e363f43d8e57433834">inuse</a> = 0;
<a name="l00221"></a>00221 
<a name="l00222"></a>00222    <span class="comment">/* Determine whether audio going to c0 needs a jitter buffer */</span>
<a name="l00223"></a>00223    <span class="keywordflow">if</span> (((!c0_wants_jitter &amp;&amp; c1_creates_jitter) || (c0_force_jb &amp;&amp; c1_creates_jitter)) &amp;&amp; c0_jb_enabled) {
<a name="l00224"></a>00224       <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(jb0, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a8ee448ef258f740aeb4e0ea89436af6d">JB_USE</a>);
<a name="l00225"></a>00225       <span class="keywordflow">if</span> (!c0_jb_timebase_initialized) {
<a name="l00226"></a>00226          <span class="keywordflow">if</span> (c1_jb_timebase_initialized) {
<a name="l00227"></a>00227             memcpy(&amp;jb0-&gt;<a class="code" href="structast__jb.html#ab0653ad203e83c307faf381f663e4649" title="The time the jitterbuffer was created.">timebase</a>, &amp;jb1-&gt;<a class="code" href="structast__jb.html#ab0653ad203e83c307faf381f663e4649" title="The time the jitterbuffer was created.">timebase</a>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> timeval));
<a name="l00228"></a>00228          } <span class="keywordflow">else</span> {
<a name="l00229"></a>00229             gettimeofday(&amp;jb0-&gt;<a class="code" href="structast__jb.html#ab0653ad203e83c307faf381f663e4649" title="The time the jitterbuffer was created.">timebase</a>, NULL);
<a name="l00230"></a>00230          }
<a name="l00231"></a>00231          <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(jb0, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140afe2d9a1cb0e496b589437b7faed7f23a">JB_TIMEBASE_INITIALIZED</a>);
<a name="l00232"></a>00232       }
<a name="l00233"></a>00233 
<a name="l00234"></a>00234       <span class="keywordflow">if</span> (!c0_jb_created) {
<a name="l00235"></a>00235          <a class="code" href="abstract__jb_8c.html#ab45f11b0a95110a51f848b2b873e1065">jb_choose_impl</a>(c0);
<a name="l00236"></a>00236       }
<a name="l00237"></a>00237 
<a name="l00238"></a>00238       inuse = 1;
<a name="l00239"></a>00239    }
<a name="l00240"></a>00240 
<a name="l00241"></a>00241    <span class="comment">/* Determine whether audio going to c1 needs a jitter buffer */</span>
<a name="l00242"></a>00242    <span class="keywordflow">if</span> (((!c1_wants_jitter &amp;&amp; c0_creates_jitter) || (c1_force_jb &amp;&amp; c0_creates_jitter)) &amp;&amp; c1_jb_enabled) {
<a name="l00243"></a>00243       <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(jb1, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a8ee448ef258f740aeb4e0ea89436af6d">JB_USE</a>);
<a name="l00244"></a>00244       <span class="keywordflow">if</span> (!c1_jb_timebase_initialized) {
<a name="l00245"></a>00245          <span class="keywordflow">if</span> (c0_jb_timebase_initialized) {
<a name="l00246"></a>00246             memcpy(&amp;jb1-&gt;<a class="code" href="structast__jb.html#ab0653ad203e83c307faf381f663e4649" title="The time the jitterbuffer was created.">timebase</a>, &amp;jb0-&gt;<a class="code" href="structast__jb.html#ab0653ad203e83c307faf381f663e4649" title="The time the jitterbuffer was created.">timebase</a>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> timeval));
<a name="l00247"></a>00247          } <span class="keywordflow">else</span> {
<a name="l00248"></a>00248             gettimeofday(&amp;jb1-&gt;<a class="code" href="structast__jb.html#ab0653ad203e83c307faf381f663e4649" title="The time the jitterbuffer was created.">timebase</a>, NULL);
<a name="l00249"></a>00249          }
<a name="l00250"></a>00250          <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(jb1, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140afe2d9a1cb0e496b589437b7faed7f23a">JB_TIMEBASE_INITIALIZED</a>);
<a name="l00251"></a>00251       }
<a name="l00252"></a>00252 
<a name="l00253"></a>00253       <span class="keywordflow">if</span> (!c1_jb_created) {
<a name="l00254"></a>00254          <a class="code" href="abstract__jb_8c.html#ab45f11b0a95110a51f848b2b873e1065">jb_choose_impl</a>(c1);
<a name="l00255"></a>00255       }
<a name="l00256"></a>00256 
<a name="l00257"></a>00257       inuse = 1;
<a name="l00258"></a>00258    }
<a name="l00259"></a>00259 
<a name="l00260"></a>00260    <span class="keywordflow">return</span> inuse;
<a name="l00261"></a>00261 }
<a name="l00262"></a>00262 
<a name="l00263"></a><a class="code" href="abstract__jb_8c.html#ad3f6eb99c87c8fb1d79232762df48354">00263</a> <span class="keywordtype">int</span> <a class="code" href="abstract__jb_8h.html#ad3f6eb99c87c8fb1d79232762df48354" title="Calculates the time, left to the closest delivery moment in a bridge.">ast_jb_get_when_to_wakeup</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c0, <span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c1, <span class="keywordtype">int</span> time_left)
<a name="l00264"></a>00264 {
<a name="l00265"></a>00265    <span class="keyword">struct </span><a class="code" href="structast__jb.html" title="General jitterbuffer state.">ast_jb</a> *jb0 = &amp;c0-&gt;<a class="code" href="structast__channel.html#ac9cb7d989f739f5a082bcffd4262d4af">jb</a>;
<a name="l00266"></a>00266    <span class="keyword">struct </span><a class="code" href="structast__jb.html" title="General jitterbuffer state.">ast_jb</a> *jb1 = &amp;c1-&gt;<a class="code" href="structast__channel.html#ac9cb7d989f739f5a082bcffd4262d4af">jb</a>;
<a name="l00267"></a>00267    <span class="keywordtype">int</span> c0_use_jb = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jb0, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a8ee448ef258f740aeb4e0ea89436af6d">JB_USE</a>);
<a name="l00268"></a>00268    <span class="keywordtype">int</span> c0_jb_is_created = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jb0, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a44ed8c27e26a66b03cedb8d77a424af5">JB_CREATED</a>);
<a name="l00269"></a>00269    <span class="keywordtype">int</span> c1_use_jb = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jb1, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a8ee448ef258f740aeb4e0ea89436af6d">JB_USE</a>);
<a name="l00270"></a>00270    <span class="keywordtype">int</span> c1_jb_is_created = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jb1, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a44ed8c27e26a66b03cedb8d77a424af5">JB_CREATED</a>);
<a name="l00271"></a>00271    <span class="keywordtype">int</span> wait, wait0, wait1;
<a name="l00272"></a>00272    <span class="keyword">struct </span>timeval tv_now;
<a name="l00273"></a>00273 
<a name="l00274"></a>00274    <span class="keywordflow">if</span> (time_left == 0) {
<a name="l00275"></a>00275       <span class="comment">/* No time left - the bridge will be retried */</span>
<a name="l00276"></a>00276       <span class="comment">/* TODO: Test disable this */</span>
<a name="l00277"></a>00277       <span class="comment">/*return 0;*/</span>
<a name="l00278"></a>00278    }
<a name="l00279"></a>00279 
<a name="l00280"></a>00280    <span class="keywordflow">if</span> (time_left &lt; 0) {
<a name="l00281"></a>00281       time_left = INT_MAX;
<a name="l00282"></a>00282    }
<a name="l00283"></a>00283 
<a name="l00284"></a>00284    gettimeofday(&amp;tv_now, NULL);
<a name="l00285"></a>00285 
<a name="l00286"></a>00286    wait0 = (c0_use_jb &amp;&amp; c0_jb_is_created) ? jb0-&gt;<a class="code" href="structast__jb.html#a7c51e0a99ee5dbb8d94870937e62f4c0" title="The time the next frame should be played.">next</a> - <a class="code" href="abstract__jb_8c.html#a1f09f2a933351d824c96a8f614261e5c">get_now</a>(jb0, &amp;tv_now) : time_left;
<a name="l00287"></a>00287    wait1 = (c1_use_jb &amp;&amp; c1_jb_is_created) ? jb1-&gt;<a class="code" href="structast__jb.html#a7c51e0a99ee5dbb8d94870937e62f4c0" title="The time the next frame should be played.">next</a> - <a class="code" href="abstract__jb_8c.html#a1f09f2a933351d824c96a8f614261e5c">get_now</a>(jb1, &amp;tv_now) : time_left;
<a name="l00288"></a>00288 
<a name="l00289"></a>00289    wait = wait0 &lt; wait1 ? wait0 : wait1;
<a name="l00290"></a>00290    wait = wait &lt; time_left ? wait : time_left;
<a name="l00291"></a>00291 
<a name="l00292"></a>00292    <span class="keywordflow">if</span> (wait == INT_MAX) {
<a name="l00293"></a>00293       wait = -1;
<a name="l00294"></a>00294    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (wait &lt; 1) {
<a name="l00295"></a>00295       <span class="comment">/* don&apos;t let wait=0, because this can cause the pbx thread to loop without any sleeping at all */</span>
<a name="l00296"></a>00296       wait = 1;
<a name="l00297"></a>00297    }
<a name="l00298"></a>00298 
<a name="l00299"></a>00299    <span class="keywordflow">return</span> wait;
<a name="l00300"></a>00300 }
<a name="l00301"></a>00301 
<a name="l00302"></a>00302 
<a name="l00303"></a><a class="code" href="abstract__jb_8c.html#a971bdfddf7e452f516dd32991951d581">00303</a> <span class="keywordtype">int</span> <a class="code" href="abstract__jb_8h.html#a971bdfddf7e452f516dd32991951d581" title="Puts a frame into a channel jitterbuffer.">ast_jb_put</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, <span class="keyword">struct</span> <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>)
<a name="l00304"></a>00304 {
<a name="l00305"></a>00305    <span class="keyword">struct </span><a class="code" href="structast__jb.html" title="General jitterbuffer state.">ast_jb</a> *jb = &amp;chan-&gt;<a class="code" href="structast__channel.html#ac9cb7d989f739f5a082bcffd4262d4af">jb</a>;
<a name="l00306"></a>00306    <span class="keyword">struct </span><a class="code" href="structast__jb__impl.html" title="Jitterbuffer implementation private struct.">ast_jb_impl</a> *jbimpl = jb-&gt;<a class="code" href="structast__jb.html#abb027c8d7c9c539e7e8ba8a31be7569f" title="Jitterbuffer implementation to be used.">impl</a>;
<a name="l00307"></a>00307    <span class="keywordtype">void</span> *jbobj = jb-&gt;<a class="code" href="structast__jb.html#a51035317dc8789dd45eb2879177fea07" title="Jitterbuffer object, passed to the implementation.">jbobj</a>;
<a name="l00308"></a>00308    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *frr;
<a name="l00309"></a>00309    <span class="keywordtype">long</span> now = 0;
<a name="l00310"></a>00310 
<a name="l00311"></a>00311    <span class="keywordflow">if</span> (!<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jb, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a8ee448ef258f740aeb4e0ea89436af6d">JB_USE</a>))
<a name="l00312"></a>00312       <span class="keywordflow">return</span> -1;
<a name="l00313"></a>00313 
<a name="l00314"></a>00314    <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> != <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>) {
<a name="l00315"></a>00315       <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#a248afd6c02044259a386f6b7aee922a2">AST_FRAME_DTMF</a> &amp;&amp; <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jb, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a44ed8c27e26a66b03cedb8d77a424af5">JB_CREATED</a>)) {
<a name="l00316"></a>00316          <a class="code" href="abstract__jb_8c.html#a25587b898af76bc590a5d2905a160786" title="Macros for the frame log files.">jb_framelog</a>(<span class="stringliteral">&quot;JB_PUT {now=%ld}: Received DTMF frame. Force resynching jb...\n&quot;</span>, now);
<a name="l00317"></a>00317          jbimpl-&gt;<a class="code" href="structast__jb__impl.html#aeeb89aa0366801501aa518694cad193a">force_resync</a>(jbobj);
<a name="l00318"></a>00318       }
<a name="l00319"></a>00319 
<a name="l00320"></a>00320       <span class="keywordflow">return</span> -1;
<a name="l00321"></a>00321    }
<a name="l00322"></a>00322 
<a name="l00323"></a>00323    <span class="comment">/* We consider an enabled jitterbuffer should receive frames with valid timing info. */</span>
<a name="l00324"></a>00324    <span class="keywordflow">if</span> (!<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(f, <a class="code" href="frame_8h.html#a0ae1e3bf78c960c83e2d437efd802058ae8f674e19f6450e2b746c8a52c11649a">AST_FRFLAG_HAS_TIMING_INFO</a>) || f-&gt;<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a> &lt; 2 || f-&gt;<a class="code" href="structast__frame.html#a1eb46dcb363821328c0d2a758549216b">ts</a> &lt; 0) {
<a name="l00325"></a>00325       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;%s received frame with invalid timing info: &quot;</span>
<a name="l00326"></a>00326          <span class="stringliteral">&quot;has_timing_info=%d, len=%ld, ts=%ld, src=%s\n&quot;</span>,
<a name="l00327"></a>00327          chan-&gt;name, <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(f, <a class="code" href="frame_8h.html#a0ae1e3bf78c960c83e2d437efd802058ae8f674e19f6450e2b746c8a52c11649a">AST_FRFLAG_HAS_TIMING_INFO</a>), f-&gt;<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a>, f-&gt;<a class="code" href="structast__frame.html#a1eb46dcb363821328c0d2a758549216b">ts</a>, f-&gt;<a class="code" href="structast__frame.html#af51e37c9331049b1e3d250a7c8bc3c26">src</a>);
<a name="l00328"></a>00328       <span class="keywordflow">return</span> -1;
<a name="l00329"></a>00329    }
<a name="l00330"></a>00330 
<a name="l00331"></a>00331    frr = <a class="code" href="frame_8h.html#a4b23720d208128250a765490b1a4f145" title="Copies a frame.">ast_frdup</a>(f);
<a name="l00332"></a>00332 
<a name="l00333"></a>00333    <span class="keywordflow">if</span> (!frr) {
<a name="l00334"></a>00334       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to isolate frame for the jitterbuffer on channel &apos;%s&apos;\n&quot;</span>, chan-&gt;name);
<a name="l00335"></a>00335       <span class="keywordflow">return</span> -1;
<a name="l00336"></a>00336    }
<a name="l00337"></a>00337 
<a name="l00338"></a>00338    <span class="keywordflow">if</span> (!<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jb, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a44ed8c27e26a66b03cedb8d77a424af5">JB_CREATED</a>)) {
<a name="l00339"></a>00339       <span class="keywordflow">if</span> (<a class="code" href="abstract__jb_8c.html#a1af5788183300b288581f5606bcadcb1">create_jb</a>(chan, frr)) {
<a name="l00340"></a>00340          <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(frr);
<a name="l00341"></a>00341          <span class="comment">/* Disable the jitterbuffer */</span>
<a name="l00342"></a>00342          <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(jb, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a8ee448ef258f740aeb4e0ea89436af6d">JB_USE</a>);
<a name="l00343"></a>00343          <span class="keywordflow">return</span> -1;
<a name="l00344"></a>00344       }
<a name="l00345"></a>00345 
<a name="l00346"></a>00346       <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(jb, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a44ed8c27e26a66b03cedb8d77a424af5">JB_CREATED</a>);
<a name="l00347"></a>00347       <span class="keywordflow">return</span> 0;
<a name="l00348"></a>00348    } <span class="keywordflow">else</span> {
<a name="l00349"></a>00349       now = <a class="code" href="abstract__jb_8c.html#a1f09f2a933351d824c96a8f614261e5c">get_now</a>(jb, NULL);
<a name="l00350"></a>00350       <span class="keywordflow">if</span> (jbimpl-&gt;<a class="code" href="structast__jb__impl.html#aee1fbf86e67d9bacc09a0dd8d77171bd">put</a>(jbobj, frr, now) != <a class="code" href="abstract__jb_8c.html#a52864abcf6ebd8d120995b36fe6ce06ead66978f8f133d1d59c73904b675b170a">JB_IMPL_OK</a>) {
<a name="l00351"></a>00351          <a class="code" href="abstract__jb_8c.html#a25587b898af76bc590a5d2905a160786" title="Macros for the frame log files.">jb_framelog</a>(<span class="stringliteral">&quot;JB_PUT {now=%ld}: Dropped frame with ts=%ld and len=%ld\n&quot;</span>, now, frr-&gt;<a class="code" href="structast__frame.html#a1eb46dcb363821328c0d2a758549216b">ts</a>, frr-&gt;<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a>);
<a name="l00352"></a>00352          <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(frr);
<a name="l00353"></a>00353          <span class="comment">/*return -1;*/</span>
<a name="l00354"></a>00354          <span class="comment">/* TODO: Check this fix - should return 0 here, because the dropped frame shouldn&apos;t</span>
<a name="l00355"></a>00355 <span class="comment">            be delivered at all */</span>
<a name="l00356"></a>00356          <span class="keywordflow">return</span> 0;
<a name="l00357"></a>00357       }
<a name="l00358"></a>00358 
<a name="l00359"></a>00359       jb-&gt;<a class="code" href="structast__jb.html#a7c51e0a99ee5dbb8d94870937e62f4c0" title="The time the next frame should be played.">next</a> = jbimpl-&gt;<a class="code" href="structast__jb__impl.html#a9343b518a13ed73bb3f42c41792d7dee">next</a>(jbobj);
<a name="l00360"></a>00360 
<a name="l00361"></a>00361       <a class="code" href="abstract__jb_8c.html#a25587b898af76bc590a5d2905a160786" title="Macros for the frame log files.">jb_framelog</a>(<span class="stringliteral">&quot;JB_PUT {now=%ld}: Queued frame with ts=%ld and len=%ld\n&quot;</span>, now, frr-&gt;<a class="code" href="structast__frame.html#a1eb46dcb363821328c0d2a758549216b">ts</a>, frr-&gt;<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a>);
<a name="l00362"></a>00362 
<a name="l00363"></a>00363       <span class="keywordflow">return</span> 0;
<a name="l00364"></a>00364    }
<a name="l00365"></a>00365 }
<a name="l00366"></a>00366 
<a name="l00367"></a>00367 
<a name="l00368"></a><a class="code" href="abstract__jb_8c.html#a543ca527d26b42c6f50eccb2924ddebd">00368</a> <span class="keywordtype">void</span> <a class="code" href="abstract__jb_8h.html#a543ca527d26b42c6f50eccb2924ddebd" title="Deliver the queued frames that should be delivered now for both channels.">ast_jb_get_and_deliver</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c0, <span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c1)
<a name="l00369"></a>00369 {
<a name="l00370"></a>00370    <span class="keyword">struct </span><a class="code" href="structast__jb.html" title="General jitterbuffer state.">ast_jb</a> *jb0 = &amp;c0-&gt;<a class="code" href="structast__channel.html#ac9cb7d989f739f5a082bcffd4262d4af">jb</a>;
<a name="l00371"></a>00371    <span class="keyword">struct </span><a class="code" href="structast__jb.html" title="General jitterbuffer state.">ast_jb</a> *jb1 = &amp;c1-&gt;<a class="code" href="structast__channel.html#ac9cb7d989f739f5a082bcffd4262d4af">jb</a>;
<a name="l00372"></a>00372    <span class="keywordtype">int</span> c0_use_jb = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jb0, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a8ee448ef258f740aeb4e0ea89436af6d">JB_USE</a>);
<a name="l00373"></a>00373    <span class="keywordtype">int</span> c0_jb_is_created = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jb0, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a44ed8c27e26a66b03cedb8d77a424af5">JB_CREATED</a>);
<a name="l00374"></a>00374    <span class="keywordtype">int</span> c1_use_jb = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jb1, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a8ee448ef258f740aeb4e0ea89436af6d">JB_USE</a>);
<a name="l00375"></a>00375    <span class="keywordtype">int</span> c1_jb_is_created = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jb1, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a44ed8c27e26a66b03cedb8d77a424af5">JB_CREATED</a>);
<a name="l00376"></a>00376 
<a name="l00377"></a>00377    <span class="keywordflow">if</span> (c0_use_jb &amp;&amp; c0_jb_is_created)
<a name="l00378"></a>00378       <a class="code" href="abstract__jb_8c.html#a5cb94ef2c28559777814eaa4a4b12e0f">jb_get_and_deliver</a>(c0);
<a name="l00379"></a>00379 
<a name="l00380"></a>00380    <span class="keywordflow">if</span> (c1_use_jb &amp;&amp; c1_jb_is_created)
<a name="l00381"></a>00381       <a class="code" href="abstract__jb_8c.html#a5cb94ef2c28559777814eaa4a4b12e0f">jb_get_and_deliver</a>(c1);
<a name="l00382"></a>00382 }
<a name="l00383"></a>00383 
<a name="l00384"></a>00384 
<a name="l00385"></a><a class="code" href="abstract__jb_8c.html#a5cb94ef2c28559777814eaa4a4b12e0f">00385</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="abstract__jb_8c.html#a5cb94ef2c28559777814eaa4a4b12e0f">jb_get_and_deliver</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)
<a name="l00386"></a>00386 {
<a name="l00387"></a>00387    <span class="keyword">struct </span><a class="code" href="structast__jb.html" title="General jitterbuffer state.">ast_jb</a> *jb = &amp;chan-&gt;<a class="code" href="structast__channel.html#ac9cb7d989f739f5a082bcffd4262d4af">jb</a>;
<a name="l00388"></a>00388    <span class="keyword">struct </span><a class="code" href="structast__jb__impl.html" title="Jitterbuffer implementation private struct.">ast_jb_impl</a> *jbimpl = jb-&gt;<a class="code" href="structast__jb.html#abb027c8d7c9c539e7e8ba8a31be7569f" title="Jitterbuffer implementation to be used.">impl</a>;
<a name="l00389"></a>00389    <span class="keywordtype">void</span> *jbobj = jb-&gt;<a class="code" href="structast__jb.html#a51035317dc8789dd45eb2879177fea07" title="Jitterbuffer object, passed to the implementation.">jbobj</a>;
<a name="l00390"></a>00390    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>, finterp = { .frametype = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>, };
<a name="l00391"></a>00391    <span class="keywordtype">long</span> now;
<a name="l00392"></a>00392    <span class="keywordtype">int</span> interpolation_len, res;
<a name="l00393"></a>00393 
<a name="l00394"></a>00394    now = <a class="code" href="abstract__jb_8c.html#a1f09f2a933351d824c96a8f614261e5c">get_now</a>(jb, NULL);
<a name="l00395"></a>00395    jb-&gt;<a class="code" href="structast__jb.html#a7c51e0a99ee5dbb8d94870937e62f4c0" title="The time the next frame should be played.">next</a> = jbimpl-&gt;<a class="code" href="structast__jb__impl.html#a9343b518a13ed73bb3f42c41792d7dee">next</a>(jbobj);
<a name="l00396"></a>00396    <span class="keywordflow">if</span> (now &lt; jb-&gt;next) {
<a name="l00397"></a>00397       <a class="code" href="abstract__jb_8c.html#a25587b898af76bc590a5d2905a160786" title="Macros for the frame log files.">jb_framelog</a>(<span class="stringliteral">&quot;\tJB_GET {now=%ld}: now &lt; next=%ld\n&quot;</span>, now, jb-&gt;<a class="code" href="structast__jb.html#a7c51e0a99ee5dbb8d94870937e62f4c0" title="The time the next frame should be played.">next</a>);
<a name="l00398"></a>00398       <span class="keywordflow">return</span>;
<a name="l00399"></a>00399    }
<a name="l00400"></a>00400 
<a name="l00401"></a>00401    <span class="keywordflow">while</span> (now &gt;= jb-&gt;<a class="code" href="structast__jb.html#a7c51e0a99ee5dbb8d94870937e62f4c0" title="The time the next frame should be played.">next</a>) {
<a name="l00402"></a>00402       interpolation_len = <a class="code" href="frame_8h.html#ab4d67e0c5a553f7796d59ccbbad33510" title="Gets duration in ms of interpolation frame for a format.">ast_codec_interp_len</a>(jb-&gt;<a class="code" href="structast__jb.html#a7c313e1a72a659b7b0bd07951727d02f" title="Voice format of the last frame in.">last_format</a>);
<a name="l00403"></a>00403 
<a name="l00404"></a>00404       res = jbimpl-&gt;<a class="code" href="structast__jb__impl.html#a14c509af9f72b5c0da46d422ec5bfc0e">get</a>(jbobj, &amp;f, now, interpolation_len);
<a name="l00405"></a>00405 
<a name="l00406"></a>00406       <span class="keywordflow">switch</span> (res) {
<a name="l00407"></a>00407       <span class="keywordflow">case</span> <a class="code" href="abstract__jb_8c.html#a52864abcf6ebd8d120995b36fe6ce06ead66978f8f133d1d59c73904b675b170a">JB_IMPL_OK</a>:
<a name="l00408"></a>00408          <span class="comment">/* deliver the frame */</span>
<a name="l00409"></a>00409          <a class="code" href="channel_8h.html#a79c413d51b7135404d5cacf811649a61" title="Write a frame to a channel This function writes the given frame to the indicated...">ast_write</a>(chan, f);
<a name="l00410"></a>00410       <span class="keywordflow">case</span> <a class="code" href="abstract__jb_8c.html#a52864abcf6ebd8d120995b36fe6ce06ea0aab6c8f8a1aab112134968c23d3ba9d">JB_IMPL_DROP</a>:
<a name="l00411"></a>00411          <a class="code" href="abstract__jb_8c.html#a25587b898af76bc590a5d2905a160786" title="Macros for the frame log files.">jb_framelog</a>(<span class="stringliteral">&quot;\tJB_GET {now=%ld}: %s frame with ts=%ld and len=%ld\n&quot;</span>,
<a name="l00412"></a>00412             now, jb_get_actions[res], f-&gt;<a class="code" href="structast__frame.html#a1eb46dcb363821328c0d2a758549216b">ts</a>, f-&gt;<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a>);
<a name="l00413"></a>00413          jb-&gt;<a class="code" href="structast__jb.html#a7c313e1a72a659b7b0bd07951727d02f" title="Voice format of the last frame in.">last_format</a> = f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>;
<a name="l00414"></a>00414          <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l00415"></a>00415          <span class="keywordflow">break</span>;
<a name="l00416"></a>00416       <span class="keywordflow">case</span> <a class="code" href="abstract__jb_8c.html#a52864abcf6ebd8d120995b36fe6ce06eae9d08ea7b7489c02574671c91104da61">JB_IMPL_INTERP</a>:
<a name="l00417"></a>00417          <span class="comment">/* interpolate a frame */</span>
<a name="l00418"></a>00418          f = &amp;finterp;
<a name="l00419"></a>00419          f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = jb-&gt;<a class="code" href="structast__jb.html#a7c313e1a72a659b7b0bd07951727d02f" title="Voice format of the last frame in.">last_format</a>;
<a name="l00420"></a>00420          f-&gt;<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>  = interpolation_len * 8;
<a name="l00421"></a>00421          f-&gt;<a class="code" href="structast__frame.html#af51e37c9331049b1e3d250a7c8bc3c26">src</a>  = <span class="stringliteral">&quot;JB interpolation&quot;</span>;
<a name="l00422"></a>00422          f-&gt;<a class="code" href="structast__frame.html#a41a708025486b4c9383e7432e9ba3f0e">delivery</a> = <a class="code" href="time_8h.html#a97e1bb8fbd7a103212789e87e7ed6073" title="Returns the sum of two timevals a + b.">ast_tvadd</a>(jb-&gt;<a class="code" href="structast__jb.html#ab0653ad203e83c307faf381f663e4649" title="The time the jitterbuffer was created.">timebase</a>, <a class="code" href="time_8h.html#a147d132412d7188c1dcebf25b8d31c0c" title="Returns a timeval corresponding to the duration of n samples at rate r. Useful to...">ast_samp2tv</a>(jb-&gt;<a class="code" href="structast__jb.html#a7c51e0a99ee5dbb8d94870937e62f4c0" title="The time the next frame should be played.">next</a>, 1000));
<a name="l00423"></a>00423          f-&gt;<a class="code" href="structast__frame.html#aed7ea92f45bd273dde380a45ddced592">offset</a> = <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>;
<a name="l00424"></a>00424          <span class="comment">/* deliver the interpolated frame */</span>
<a name="l00425"></a>00425          <a class="code" href="channel_8h.html#a79c413d51b7135404d5cacf811649a61" title="Write a frame to a channel This function writes the given frame to the indicated...">ast_write</a>(chan, f);
<a name="l00426"></a>00426          <a class="code" href="abstract__jb_8c.html#a25587b898af76bc590a5d2905a160786" title="Macros for the frame log files.">jb_framelog</a>(<span class="stringliteral">&quot;\tJB_GET {now=%ld}: Interpolated frame with len=%d\n&quot;</span>, now, interpolation_len);
<a name="l00427"></a>00427          <span class="keywordflow">break</span>;
<a name="l00428"></a>00428       <span class="keywordflow">case</span> <a class="code" href="abstract__jb_8c.html#a52864abcf6ebd8d120995b36fe6ce06ea39c6f6b3ff5a3a419e8fbce06ebb6bef">JB_IMPL_NOFRAME</a>:
<a name="l00429"></a>00429          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,
<a name="l00430"></a>00430             <span class="stringliteral">&quot;JB_IMPL_NOFRAME is returned from the %s jb when now=%ld &gt;= next=%ld, jbnext=%ld!\n&quot;</span>,
<a name="l00431"></a>00431             jbimpl-&gt;<a class="code" href="structast__jb__impl.html#a5276c0a183c322592ca4435cf76f8fb2">name</a>, now, jb-&gt;<a class="code" href="structast__jb.html#a7c51e0a99ee5dbb8d94870937e62f4c0" title="The time the next frame should be played.">next</a>, jbimpl-&gt;<a class="code" href="structast__jb__impl.html#a9343b518a13ed73bb3f42c41792d7dee">next</a>(jbobj));
<a name="l00432"></a>00432          <a class="code" href="abstract__jb_8c.html#a25587b898af76bc590a5d2905a160786" title="Macros for the frame log files.">jb_framelog</a>(<span class="stringliteral">&quot;\tJB_GET {now=%ld}: No frame for now!?\n&quot;</span>, now);
<a name="l00433"></a>00433          <span class="keywordflow">return</span>;
<a name="l00434"></a>00434       <span class="keywordflow">default</span>:
<a name="l00435"></a>00435          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;This should never happen!\n&quot;</span>);
<a name="l00436"></a>00436          <a class="code" href="utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(<span class="stringliteral">&quot;JB type unknown&quot;</span> == NULL);
<a name="l00437"></a>00437          <span class="keywordflow">break</span>;
<a name="l00438"></a>00438       }
<a name="l00439"></a>00439 
<a name="l00440"></a>00440       jb-&gt;<a class="code" href="structast__jb.html#a7c51e0a99ee5dbb8d94870937e62f4c0" title="The time the next frame should be played.">next</a> = jbimpl-&gt;<a class="code" href="structast__jb__impl.html#a9343b518a13ed73bb3f42c41792d7dee">next</a>(jbobj);
<a name="l00441"></a>00441    }
<a name="l00442"></a>00442 }
<a name="l00443"></a>00443 
<a name="l00444"></a>00444 
<a name="l00445"></a><a class="code" href="abstract__jb_8c.html#a1af5788183300b288581f5606bcadcb1">00445</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="abstract__jb_8c.html#a1af5788183300b288581f5606bcadcb1">create_jb</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, <span class="keyword">struct</span> <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *frr)
<a name="l00446"></a>00446 {
<a name="l00447"></a>00447    <span class="keyword">struct </span><a class="code" href="structast__jb.html" title="General jitterbuffer state.">ast_jb</a> *jb = &amp;chan-&gt;<a class="code" href="structast__channel.html#ac9cb7d989f739f5a082bcffd4262d4af">jb</a>;
<a name="l00448"></a>00448    <span class="keyword">struct </span><a class="code" href="structast__jb__conf.html" title="General jitterbuffer configuration.">ast_jb_conf</a> *jbconf = &amp;jb-&gt;<a class="code" href="structast__jb.html#a5e0765fcfec251b02238ec7159d3857a" title="Jitterbuffer configuration.">conf</a>;
<a name="l00449"></a>00449    <span class="keyword">struct </span><a class="code" href="structast__jb__impl.html" title="Jitterbuffer implementation private struct.">ast_jb_impl</a> *jbimpl = jb-&gt;<a class="code" href="structast__jb.html#abb027c8d7c9c539e7e8ba8a31be7569f" title="Jitterbuffer implementation to be used.">impl</a>;
<a name="l00450"></a>00450    <span class="keywordtype">void</span> *jbobj;
<a name="l00451"></a>00451    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *bridged;
<a name="l00452"></a>00452    <span class="keywordtype">long</span> now;
<a name="l00453"></a>00453    <span class="keywordtype">char</span> logfile_pathname[20 + <a class="code" href="abstract__jb_8h.html#aed29eaebafbb4e5179d3a40d4d890e2e">AST_JB_IMPL_NAME_SIZE</a> + 2*<a class="code" href="channel_8h.html#ab57c278099ea5f8d7cedbb41eba58b56">AST_CHANNEL_NAME</a> + 1];
<a name="l00454"></a>00454    <span class="keywordtype">char</span> name1[<a class="code" href="channel_8h.html#ab57c278099ea5f8d7cedbb41eba58b56">AST_CHANNEL_NAME</a>], name2[<a class="code" href="channel_8h.html#ab57c278099ea5f8d7cedbb41eba58b56">AST_CHANNEL_NAME</a>], *tmp;
<a name="l00455"></a>00455    <span class="keywordtype">int</span> res;
<a name="l00456"></a>00456 
<a name="l00457"></a>00457    jbobj = jb-&gt;<a class="code" href="structast__jb.html#a51035317dc8789dd45eb2879177fea07" title="Jitterbuffer object, passed to the implementation.">jbobj</a> = jbimpl-&gt;<a class="code" href="structast__jb__impl.html#aa09fad8ce9439495f357baf080e4e938">create</a>(jbconf, jbconf-&gt;<a class="code" href="structast__jb__conf.html#ab5d708c3e3489b6fd1f92b19939c18e8" title="Resynchronization threshold of the jitterbuffer implementation.">resync_threshold</a>);
<a name="l00458"></a>00458    <span class="keywordflow">if</span> (!jbobj) {
<a name="l00459"></a>00459       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to create jitterbuffer on channel &apos;%s&apos;\n&quot;</span>, chan-&gt;name);
<a name="l00460"></a>00460       <span class="keywordflow">return</span> -1;
<a name="l00461"></a>00461    }
<a name="l00462"></a>00462 
<a name="l00463"></a>00463    now = <a class="code" href="abstract__jb_8c.html#a1f09f2a933351d824c96a8f614261e5c">get_now</a>(jb, NULL);
<a name="l00464"></a>00464    res = jbimpl-&gt;<a class="code" href="structast__jb__impl.html#a24838139378ea2320490859c89cbc3f9">put_first</a>(jbobj, frr, now);
<a name="l00465"></a>00465 
<a name="l00466"></a>00466    <span class="comment">/* The result of putting the first frame should not differ from OK. However, its possible</span>
<a name="l00467"></a>00467 <span class="comment">      some implementations (i.e. adaptive&apos;s when resynch_threshold is specified) to drop it. */</span>
<a name="l00468"></a>00468    <span class="keywordflow">if</span> (res != <a class="code" href="abstract__jb_8c.html#a52864abcf6ebd8d120995b36fe6ce06ead66978f8f133d1d59c73904b675b170a">JB_IMPL_OK</a>) {
<a name="l00469"></a>00469       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to put first frame in the jitterbuffer on channel &apos;%s&apos;\n&quot;</span>, chan-&gt;name);
<a name="l00470"></a>00470       <span class="comment">/*</span>
<a name="l00471"></a>00471 <span class="comment">      jbimpl-&gt;destroy(jbobj);</span>
<a name="l00472"></a>00472 <span class="comment">      return -1;</span>
<a name="l00473"></a>00473 <span class="comment">      */</span>
<a name="l00474"></a>00474    }
<a name="l00475"></a>00475 
<a name="l00476"></a>00476    <span class="comment">/* Init next */</span>
<a name="l00477"></a>00477    jb-&gt;<a class="code" href="structast__jb.html#a7c51e0a99ee5dbb8d94870937e62f4c0" title="The time the next frame should be played.">next</a> = jbimpl-&gt;<a class="code" href="structast__jb__impl.html#a9343b518a13ed73bb3f42c41792d7dee">next</a>(jbobj);
<a name="l00478"></a>00478 
<a name="l00479"></a>00479    <span class="comment">/* Init last format for a first time. */</span>
<a name="l00480"></a>00480    jb-&gt;<a class="code" href="structast__jb.html#a7c313e1a72a659b7b0bd07951727d02f" title="Voice format of the last frame in.">last_format</a> = frr-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>;
<a name="l00481"></a>00481 
<a name="l00482"></a>00482    <span class="comment">/* Create a frame log file */</span>
<a name="l00483"></a>00483    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jbconf, <a class="code" href="abstract__jb_8h.html#aad393aa3e173d7f081ab4bbc6ba5027dae6ca3d7ddaa509b36e1fb4c36c18478e">AST_JB_LOG</a>)) {
<a name="l00484"></a>00484       <span class="keywordtype">char</span> safe_logfile[30] = <span class="stringliteral">&quot;/tmp/logfile-XXXXXX&quot;</span>;
<a name="l00485"></a>00485       <span class="keywordtype">int</span> safe_fd;
<a name="l00486"></a>00486       snprintf(name2, <span class="keyword">sizeof</span>(name2), <span class="stringliteral">&quot;%s&quot;</span>, chan-&gt;name);
<a name="l00487"></a>00487       <span class="keywordflow">if</span> ((tmp = strchr(name2, <span class="charliteral">&apos;/&apos;</span>))) {
<a name="l00488"></a>00488          *tmp = <span class="charliteral">&apos;#&apos;</span>;
<a name="l00489"></a>00489       }
<a name="l00490"></a>00490 
<a name="l00491"></a>00491       bridged = <a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(chan);
<a name="l00492"></a>00492       <span class="comment">/* We should always have bridged chan if a jitterbuffer is in use */</span>
<a name="l00493"></a>00493       <a class="code" href="utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(bridged != NULL);
<a name="l00494"></a>00494 
<a name="l00495"></a>00495       snprintf(name1, <span class="keyword">sizeof</span>(name1), <span class="stringliteral">&quot;%s&quot;</span>, bridged-&gt;name);
<a name="l00496"></a>00496       <span class="keywordflow">if</span> ((tmp = strchr(name1, <span class="charliteral">&apos;/&apos;</span>))) {
<a name="l00497"></a>00497          *tmp = <span class="charliteral">&apos;#&apos;</span>;
<a name="l00498"></a>00498       }
<a name="l00499"></a>00499 
<a name="l00500"></a>00500       snprintf(logfile_pathname, <span class="keyword">sizeof</span>(logfile_pathname),
<a name="l00501"></a>00501          <span class="stringliteral">&quot;/tmp/ast_%s_jb_%s--%s.log&quot;</span>, jbimpl-&gt;<a class="code" href="structast__jb__impl.html#a5276c0a183c322592ca4435cf76f8fb2">name</a>, name1, name2);
<a name="l00502"></a>00502       <span class="keywordflow">if</span> (!(safe_fd = mkstemp(safe_logfile)) &gt; -1 || unlink(logfile_pathname) || link(safe_logfile, logfile_pathname) || unlink(safe_logfile) || !(jb-&gt;<a class="code" href="structast__jb.html#ab25a3625a8efbaa3d81ef27bbb51c9c5" title="File for frame timestamp tracing.">logfile</a> = fdopen(safe_fd, <span class="stringliteral">&quot;w+b&quot;</span>))) {
<a name="l00503"></a>00503          jb-&gt;<a class="code" href="structast__jb.html#ab25a3625a8efbaa3d81ef27bbb51c9c5" title="File for frame timestamp tracing.">logfile</a> = NULL;
<a name="l00504"></a>00504          <span class="keywordflow">if</span> (safe_fd &gt; -1) {
<a name="l00505"></a>00505             close(safe_fd);
<a name="l00506"></a>00506          }
<a name="l00507"></a>00507          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to create frame log file with pathname &apos;%s&apos;: %s\n&quot;</span>, logfile_pathname, strerror(<a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));
<a name="l00508"></a>00508       }
<a name="l00509"></a>00509 
<a name="l00510"></a>00510       <span class="keywordflow">if</span> (res == <a class="code" href="abstract__jb_8c.html#a52864abcf6ebd8d120995b36fe6ce06ead66978f8f133d1d59c73904b675b170a">JB_IMPL_OK</a>) {
<a name="l00511"></a>00511          <a class="code" href="abstract__jb_8c.html#a25587b898af76bc590a5d2905a160786" title="Macros for the frame log files.">jb_framelog</a>(<span class="stringliteral">&quot;JB_PUT_FIRST {now=%ld}: Queued frame with ts=%ld and len=%ld\n&quot;</span>,
<a name="l00512"></a>00512             now, frr-&gt;<a class="code" href="structast__frame.html#a1eb46dcb363821328c0d2a758549216b">ts</a>, frr-&gt;<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a>);
<a name="l00513"></a>00513       } <span class="keywordflow">else</span> {
<a name="l00514"></a>00514          <a class="code" href="abstract__jb_8c.html#a25587b898af76bc590a5d2905a160786" title="Macros for the frame log files.">jb_framelog</a>(<span class="stringliteral">&quot;JB_PUT_FIRST {now=%ld}: Dropped frame with ts=%ld and len=%ld\n&quot;</span>,
<a name="l00515"></a>00515             now, frr-&gt;<a class="code" href="structast__frame.html#a1eb46dcb363821328c0d2a758549216b">ts</a>, frr-&gt;<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a>);
<a name="l00516"></a>00516       }
<a name="l00517"></a>00517    }
<a name="l00518"></a>00518 
<a name="l00519"></a>00519    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;%s jitterbuffer created on channel %s\n&quot;</span>, jbimpl-&gt;<a class="code" href="structast__jb__impl.html#a5276c0a183c322592ca4435cf76f8fb2">name</a>, chan-&gt;name);
<a name="l00520"></a>00520 
<a name="l00521"></a>00521    <span class="comment">/* Free the frame if it has not been queued in the jb */</span>
<a name="l00522"></a>00522    <span class="keywordflow">if</span> (res != <a class="code" href="abstract__jb_8c.html#a52864abcf6ebd8d120995b36fe6ce06ead66978f8f133d1d59c73904b675b170a">JB_IMPL_OK</a>) {
<a name="l00523"></a>00523       <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(frr);
<a name="l00524"></a>00524    }
<a name="l00525"></a>00525 
<a name="l00526"></a>00526    <span class="keywordflow">return</span> 0;
<a name="l00527"></a>00527 }
<a name="l00528"></a>00528 
<a name="l00529"></a>00529 
<a name="l00530"></a><a class="code" href="abstract__jb_8c.html#aa94fd3c228854f8ac519da8218d5c032">00530</a> <span class="keywordtype">void</span> <a class="code" href="abstract__jb_8h.html#aa94fd3c228854f8ac519da8218d5c032" title="Destroys jitterbuffer on a channel.">ast_jb_destroy</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)
<a name="l00531"></a>00531 {
<a name="l00532"></a>00532    <span class="keyword">struct </span><a class="code" href="structast__jb.html" title="General jitterbuffer state.">ast_jb</a> *jb = &amp;chan-&gt;<a class="code" href="structast__channel.html#ac9cb7d989f739f5a082bcffd4262d4af">jb</a>;
<a name="l00533"></a>00533    <span class="keyword">struct </span><a class="code" href="structast__jb__impl.html" title="Jitterbuffer implementation private struct.">ast_jb_impl</a> *jbimpl = jb-&gt;<a class="code" href="structast__jb.html#abb027c8d7c9c539e7e8ba8a31be7569f" title="Jitterbuffer implementation to be used.">impl</a>;
<a name="l00534"></a>00534    <span class="keywordtype">void</span> *jbobj = jb-&gt;<a class="code" href="structast__jb.html#a51035317dc8789dd45eb2879177fea07" title="Jitterbuffer object, passed to the implementation.">jbobj</a>;
<a name="l00535"></a>00535    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l00536"></a>00536 
<a name="l00537"></a>00537    <span class="keywordflow">if</span> (jb-&gt;<a class="code" href="structast__jb.html#ab25a3625a8efbaa3d81ef27bbb51c9c5" title="File for frame timestamp tracing.">logfile</a>) {
<a name="l00538"></a>00538       fclose(jb-&gt;<a class="code" href="structast__jb.html#ab25a3625a8efbaa3d81ef27bbb51c9c5" title="File for frame timestamp tracing.">logfile</a>);
<a name="l00539"></a>00539       jb-&gt;<a class="code" href="structast__jb.html#ab25a3625a8efbaa3d81ef27bbb51c9c5" title="File for frame timestamp tracing.">logfile</a> = NULL;
<a name="l00540"></a>00540    }
<a name="l00541"></a>00541 
<a name="l00542"></a>00542    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jb, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a44ed8c27e26a66b03cedb8d77a424af5">JB_CREATED</a>)) {
<a name="l00543"></a>00543       <span class="comment">/* Remove and free all frames still queued in jb */</span>
<a name="l00544"></a>00544       <span class="keywordflow">while</span> (jbimpl-&gt;<a class="code" href="structast__jb__impl.html#a66c0c9ee34addeb93c5adca833649f9b">remove</a>(jbobj, &amp;f) == <a class="code" href="abstract__jb_8c.html#a52864abcf6ebd8d120995b36fe6ce06ead66978f8f133d1d59c73904b675b170a">JB_IMPL_OK</a>) {
<a name="l00545"></a>00545          <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l00546"></a>00546       }
<a name="l00547"></a>00547 
<a name="l00548"></a>00548       jbimpl-&gt;<a class="code" href="structast__jb__impl.html#a2deddc2d4df26e6e0e3ebde6c98f6647">destroy</a>(jbobj);
<a name="l00549"></a>00549       jb-&gt;<a class="code" href="structast__jb.html#a51035317dc8789dd45eb2879177fea07" title="Jitterbuffer object, passed to the implementation.">jbobj</a> = NULL;
<a name="l00550"></a>00550 
<a name="l00551"></a>00551       <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(jb, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a44ed8c27e26a66b03cedb8d77a424af5">JB_CREATED</a>);
<a name="l00552"></a>00552 
<a name="l00553"></a>00553       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;%s jitterbuffer destroyed on channel %s\n&quot;</span>, jbimpl-&gt;<a class="code" href="structast__jb__impl.html#a5276c0a183c322592ca4435cf76f8fb2">name</a>, chan-&gt;name);
<a name="l00554"></a>00554    }
<a name="l00555"></a>00555 }
<a name="l00556"></a>00556 
<a name="l00557"></a>00557 
<a name="l00558"></a><a class="code" href="abstract__jb_8c.html#a1f09f2a933351d824c96a8f614261e5c">00558</a> <span class="keyword">static</span> <span class="keywordtype">long</span> <a class="code" href="abstract__jb_8c.html#a1f09f2a933351d824c96a8f614261e5c">get_now</a>(<span class="keyword">struct</span> <a class="code" href="structast__jb.html" title="General jitterbuffer state.">ast_jb</a> *jb, <span class="keyword">struct</span> timeval *when)
<a name="l00559"></a>00559 {
<a name="l00560"></a>00560    <span class="keyword">struct </span>timeval now;
<a name="l00561"></a>00561 
<a name="l00562"></a>00562    <span class="keywordflow">if</span> (!when) {
<a name="l00563"></a>00563       when = &amp;now;
<a name="l00564"></a>00564       gettimeofday(when, NULL);
<a name="l00565"></a>00565    }
<a name="l00566"></a>00566 
<a name="l00567"></a>00567    <span class="keywordflow">return</span> <a class="code" href="time_8h.html#a74e35cffcd45ad6cd7c8587921e8a4c2" title="Computes the difference (in milliseconds) between two struct timeval instances.">ast_tvdiff_ms</a>(*when, jb-&gt;<a class="code" href="structast__jb.html#ab0653ad203e83c307faf381f663e4649" title="The time the jitterbuffer was created.">timebase</a>);
<a name="l00568"></a>00568 }
<a name="l00569"></a>00569 
<a name="l00570"></a>00570 
<a name="l00571"></a><a class="code" href="abstract__jb_8c.html#ae50ad081bd2ae6b58bcfc4687916c586">00571</a> <span class="keywordtype">int</span> <a class="code" href="abstract__jb_8h.html#ae50ad081bd2ae6b58bcfc4687916c586" title="Sets jitterbuffer configuration property.">ast_jb_read_conf</a>(<span class="keyword">struct</span> <a class="code" href="structast__jb__conf.html" title="General jitterbuffer configuration.">ast_jb_conf</a> *conf, <span class="keyword">const</span> <span class="keywordtype">char</span> *varname, <span class="keyword">const</span> <span class="keywordtype">char</span> *value)
<a name="l00572"></a>00572 {
<a name="l00573"></a>00573    <span class="keywordtype">int</span> prefixlen = <span class="keyword">sizeof</span>(<a class="code" href="abstract__jb_8h.html#aff7a5dfaf7cb79efb8e9ddc564212d1c">AST_JB_CONF_PREFIX</a>) - 1;
<a name="l00574"></a>00574    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>;
<a name="l00575"></a>00575    <span class="keywordtype">int</span> tmp;
<a name="l00576"></a>00576 
<a name="l00577"></a>00577    <span class="keywordflow">if</span> (strncasecmp(<a class="code" href="abstract__jb_8h.html#aff7a5dfaf7cb79efb8e9ddc564212d1c">AST_JB_CONF_PREFIX</a>, varname, prefixlen)) {
<a name="l00578"></a>00578       <span class="keywordflow">return</span> -1;
<a name="l00579"></a>00579    }
<a name="l00580"></a>00580 
<a name="l00581"></a>00581    name = varname + prefixlen;
<a name="l00582"></a>00582 
<a name="l00583"></a>00583    <span class="keywordflow">if</span> (!strcasecmp(name, <a class="code" href="abstract__jb_8h.html#a168e0e7cbd179c4aceefd8bb42c3a408">AST_JB_CONF_ENABLE</a>)) {
<a name="l00584"></a>00584       <a class="code" href="utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>(conf, <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(value), <a class="code" href="abstract__jb_8h.html#aad393aa3e173d7f081ab4bbc6ba5027daf49c3e265d3ff27e62d8c38779d89dd9">AST_JB_ENABLED</a>);
<a name="l00585"></a>00585    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(name, <a class="code" href="abstract__jb_8h.html#ad9f3ff3a64a627dd8ec08e92e32081c3">AST_JB_CONF_FORCE</a>)) {
<a name="l00586"></a>00586       <a class="code" href="utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>(conf, <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(value), <a class="code" href="abstract__jb_8h.html#aad393aa3e173d7f081ab4bbc6ba5027dac9bdd81232f2ef32fad9ebd0b92b9f63">AST_JB_FORCED</a>);
<a name="l00587"></a>00587    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(name, <a class="code" href="abstract__jb_8h.html#adf4913cb009ccd8f95dc5cc6422872b9">AST_JB_CONF_MAX_SIZE</a>)) {
<a name="l00588"></a>00588       <span class="keywordflow">if</span> ((tmp = atoi(value)) &gt; 0)
<a name="l00589"></a>00589          conf-&gt;<a class="code" href="structast__jb__conf.html#aaba39ba18eb00647786272b9061659e3" title="Max size of the jitterbuffer implementation.">max_size</a> = tmp;
<a name="l00590"></a>00590    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(name, <a class="code" href="abstract__jb_8h.html#a1c488fb41b043a2e392f6ecd6e78f3ed">AST_JB_CONF_RESYNCH_THRESHOLD</a>)) {
<a name="l00591"></a>00591       <span class="keywordflow">if</span> ((tmp = atoi(value)) &gt; 0)
<a name="l00592"></a>00592          conf-&gt;<a class="code" href="structast__jb__conf.html#ab5d708c3e3489b6fd1f92b19939c18e8" title="Resynchronization threshold of the jitterbuffer implementation.">resync_threshold</a> = tmp;
<a name="l00593"></a>00593    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(name, <a class="code" href="abstract__jb_8h.html#a3025d70ca72b1abc6983d3f18c50b899">AST_JB_CONF_IMPL</a>)) {
<a name="l00594"></a>00594       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(value))
<a name="l00595"></a>00595          snprintf(conf-&gt;<a class="code" href="structast__jb__conf.html#a60072c5fdc7f8f7772e49783b48e37a6" title="Name of the jitterbuffer implementation to be used.">impl</a>, <span class="keyword">sizeof</span>(conf-&gt;<a class="code" href="structast__jb__conf.html#a60072c5fdc7f8f7772e49783b48e37a6" title="Name of the jitterbuffer implementation to be used.">impl</a>), <span class="stringliteral">&quot;%s&quot;</span>, value);
<a name="l00596"></a>00596    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(name, <a class="code" href="abstract__jb_8h.html#aec196522d0bff37d617dab5fcb403a46">AST_JB_CONF_TARGET_EXTRA</a>)) {
<a name="l00597"></a>00597       <span class="keywordflow">if</span> (sscanf(value, <span class="stringliteral">&quot;%30d&quot;</span>, &amp;tmp) == 1) {
<a name="l00598"></a>00598          conf-&gt;<a class="code" href="structast__jb__conf.html#a322d898485ffd6c3c07391f381903bdd" title="amount of additional jitterbuffer adjustment">target_extra</a> = tmp;
<a name="l00599"></a>00599       }
<a name="l00600"></a>00600    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(name, <a class="code" href="abstract__jb_8h.html#a30af15dd4b567ed1950e7b3a78d9a89f">AST_JB_CONF_LOG</a>)) {
<a name="l00601"></a>00601       <a class="code" href="utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>(conf, <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(value), <a class="code" href="abstract__jb_8h.html#aad393aa3e173d7f081ab4bbc6ba5027dae6ca3d7ddaa509b36e1fb4c36c18478e">AST_JB_LOG</a>);
<a name="l00602"></a>00602    } <span class="keywordflow">else</span> {
<a name="l00603"></a>00603       <span class="keywordflow">return</span> -1;
<a name="l00604"></a>00604    }
<a name="l00605"></a>00605 
<a name="l00606"></a>00606    <span class="keywordflow">return</span> 0;
<a name="l00607"></a>00607 }
<a name="l00608"></a>00608 
<a name="l00609"></a>00609 
<a name="l00610"></a><a class="code" href="abstract__jb_8c.html#a0981c84ac90dd79bc2a0fdd90aa6efba">00610</a> <span class="keywordtype">void</span> <a class="code" href="abstract__jb_8h.html#a0981c84ac90dd79bc2a0fdd90aa6efba" title="Configures a jitterbuffer on a channel.">ast_jb_configure</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structast__jb__conf.html" title="General jitterbuffer configuration.">ast_jb_conf</a> *conf)
<a name="l00611"></a>00611 {
<a name="l00612"></a>00612    memcpy(&amp;chan-&gt;<a class="code" href="structast__channel.html#ac9cb7d989f739f5a082bcffd4262d4af">jb</a>.<a class="code" href="structast__jb.html#a5e0765fcfec251b02238ec7159d3857a" title="Jitterbuffer configuration.">conf</a>, conf, <span class="keyword">sizeof</span>(*conf));
<a name="l00613"></a>00613 }
<a name="l00614"></a>00614 
<a name="l00615"></a>00615 
<a name="l00616"></a><a class="code" href="abstract__jb_8c.html#ae38fc3d7573cd890716edca9bcb31766">00616</a> <span class="keywordtype">void</span> <a class="code" href="abstract__jb_8h.html#ae38fc3d7573cd890716edca9bcb31766" title="Copies a channel&amp;#39;s jitterbuffer configuration.">ast_jb_get_config</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, <span class="keyword">struct</span> <a class="code" href="structast__jb__conf.html" title="General jitterbuffer configuration.">ast_jb_conf</a> *conf)
<a name="l00617"></a>00617 {
<a name="l00618"></a>00618    memcpy(conf, &amp;chan-&gt;<a class="code" href="structast__channel.html#ac9cb7d989f739f5a082bcffd4262d4af">jb</a>.<a class="code" href="structast__jb.html#a5e0765fcfec251b02238ec7159d3857a" title="Jitterbuffer configuration.">conf</a>, <span class="keyword">sizeof</span>(*conf));
<a name="l00619"></a>00619 }
<a name="l00620"></a>00620 
<a name="l00621"></a><a class="code" href="abstract__jb_8c.html#a252f5415d8e69c1d17597ccb16446a30">00621</a> <span class="keywordtype">void</span> <a class="code" href="abstract__jb_8h.html#a252f5415d8e69c1d17597ccb16446a30" title="drops all frames from a jitterbuffer and resets it">ast_jb_empty_and_reset</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c0, <span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c1)
<a name="l00622"></a>00622 {
<a name="l00623"></a>00623    <span class="keyword">struct </span><a class="code" href="structast__jb.html" title="General jitterbuffer state.">ast_jb</a> *jb0 = &amp;c0-&gt;<a class="code" href="structast__channel.html#ac9cb7d989f739f5a082bcffd4262d4af">jb</a>;
<a name="l00624"></a>00624    <span class="keyword">struct </span><a class="code" href="structast__jb.html" title="General jitterbuffer state.">ast_jb</a> *jb1 = &amp;c1-&gt;<a class="code" href="structast__channel.html#ac9cb7d989f739f5a082bcffd4262d4af">jb</a>;
<a name="l00625"></a>00625    <span class="keywordtype">int</span> c0_use_jb = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jb0, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a8ee448ef258f740aeb4e0ea89436af6d">JB_USE</a>);
<a name="l00626"></a>00626    <span class="keywordtype">int</span> c0_jb_is_created = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jb0, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a44ed8c27e26a66b03cedb8d77a424af5">JB_CREATED</a>);
<a name="l00627"></a>00627    <span class="keywordtype">int</span> c1_use_jb = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jb1, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a8ee448ef258f740aeb4e0ea89436af6d">JB_USE</a>);
<a name="l00628"></a>00628    <span class="keywordtype">int</span> c1_jb_is_created = <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(jb1, <a class="code" href="abstract__jb_8c.html#a85c7862086c1f92e4fb4108e176d8140a44ed8c27e26a66b03cedb8d77a424af5">JB_CREATED</a>);
<a name="l00629"></a>00629 
<a name="l00630"></a>00630    <span class="keywordflow">if</span> (c0_use_jb &amp;&amp; c0_jb_is_created &amp;&amp; jb0-&gt;<a class="code" href="structast__jb.html#abb027c8d7c9c539e7e8ba8a31be7569f" title="Jitterbuffer implementation to be used.">impl</a>-&gt;<a class="code" href="structast__jb__impl.html#a86d5347bd385fb0681a2e2414bff18be">empty_and_reset</a>) {
<a name="l00631"></a>00631       jb0-&gt;<a class="code" href="structast__jb.html#abb027c8d7c9c539e7e8ba8a31be7569f" title="Jitterbuffer implementation to be used.">impl</a>-&gt;<a class="code" href="structast__jb__impl.html#a86d5347bd385fb0681a2e2414bff18be">empty_and_reset</a>(jb0-&gt;<a class="code" href="structast__jb.html#a51035317dc8789dd45eb2879177fea07" title="Jitterbuffer object, passed to the implementation.">jbobj</a>);
<a name="l00632"></a>00632    }
<a name="l00633"></a>00633 
<a name="l00634"></a>00634    <span class="keywordflow">if</span> (c1_use_jb &amp;&amp; c1_jb_is_created &amp;&amp; jb1-&gt;<a class="code" href="structast__jb.html#abb027c8d7c9c539e7e8ba8a31be7569f" title="Jitterbuffer implementation to be used.">impl</a>-&gt;<a class="code" href="structast__jb__impl.html#a86d5347bd385fb0681a2e2414bff18be">empty_and_reset</a>) {
<a name="l00635"></a>00635       jb1-&gt;<a class="code" href="structast__jb.html#abb027c8d7c9c539e7e8ba8a31be7569f" title="Jitterbuffer implementation to be used.">impl</a>-&gt;<a class="code" href="structast__jb__impl.html#a86d5347bd385fb0681a2e2414bff18be">empty_and_reset</a>(jb1-&gt;<a class="code" href="structast__jb.html#a51035317dc8789dd45eb2879177fea07" title="Jitterbuffer object, passed to the implementation.">jbobj</a>);
<a name="l00636"></a>00636    }
<a name="l00637"></a>00637 }
<a name="l00638"></a>00638 
<a name="l00639"></a>00639 <span class="comment">/* Implementation functions */</span>
<a name="l00640"></a>00640 
<a name="l00641"></a>00641 <span class="comment">/* fixed */</span>
<a name="l00642"></a><a class="code" href="abstract__jb_8c.html#aa306ce2e88c8949810f6e05fe9182cd2">00642</a> <span class="keyword">static</span> <span class="keywordtype">void</span> * <a class="code" href="abstract__jb_8c.html#aa306ce2e88c8949810f6e05fe9182cd2">jb_create_fixed</a>(<span class="keyword">struct</span> <a class="code" href="structast__jb__conf.html" title="General jitterbuffer configuration.">ast_jb_conf</a> *general_config, <span class="keywordtype">long</span> resynch_threshold)
<a name="l00643"></a>00643 {
<a name="l00644"></a>00644    <span class="keyword">struct </span><a class="code" href="structfixed__jb__conf.html">fixed_jb_conf</a> conf;
<a name="l00645"></a>00645 
<a name="l00646"></a>00646    conf.<a class="code" href="structfixed__jb__conf.html#a92f744ef7ea6aa19accb4c2c68621b52">jbsize</a> = general_config-&gt;<a class="code" href="structast__jb__conf.html#aaba39ba18eb00647786272b9061659e3" title="Max size of the jitterbuffer implementation.">max_size</a>;
<a name="l00647"></a>00647    conf.<a class="code" href="structfixed__jb__conf.html#ab5d708c3e3489b6fd1f92b19939c18e8">resync_threshold</a> = resynch_threshold;
<a name="l00648"></a>00648 
<a name="l00649"></a>00649    <span class="keywordflow">return</span> <a class="code" href="fixedjitterbuf_8c.html#a422ae86f28fc89102603a8422d89445c">fixed_jb_new</a>(&amp;conf);
<a name="l00650"></a>00650 }
<a name="l00651"></a>00651 
<a name="l00652"></a><a class="code" href="abstract__jb_8c.html#abcb45d2c8505def068211243395ccde2">00652</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="abstract__jb_8c.html#abcb45d2c8505def068211243395ccde2">jb_destroy_fixed</a>(<span class="keywordtype">void</span> *jb)
<a name="l00653"></a>00653 {
<a name="l00654"></a>00654    <span class="keyword">struct </span><a class="code" href="structfixed__jb.html" title="private fixed_jb structure">fixed_jb</a> *fixedjb = (<span class="keyword">struct </span><a class="code" href="structfixed__jb.html" title="private fixed_jb structure">fixed_jb</a> *) jb;
<a name="l00655"></a>00655 
<a name="l00656"></a>00656    <span class="comment">/* destroy the jb */</span>
<a name="l00657"></a>00657    <a class="code" href="fixedjitterbuf_8c.html#abeafbe13f8a2d2dbec6e59c039a8741c">fixed_jb_destroy</a>(fixedjb);
<a name="l00658"></a>00658 }
<a name="l00659"></a>00659 
<a name="l00660"></a>00660 
<a name="l00661"></a><a class="code" href="abstract__jb_8c.html#aebc0713afb88453bbc688e7e7872c2d2">00661</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="abstract__jb_8c.html#aebc0713afb88453bbc688e7e7872c2d2">jb_put_first_fixed</a>(<span class="keywordtype">void</span> *jb, <span class="keyword">struct</span> <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *fin, <span class="keywordtype">long</span> now)
<a name="l00662"></a>00662 {
<a name="l00663"></a>00663    <span class="keyword">struct </span><a class="code" href="structfixed__jb.html" title="private fixed_jb structure">fixed_jb</a> *fixedjb = (<span class="keyword">struct </span><a class="code" href="structfixed__jb.html" title="private fixed_jb structure">fixed_jb</a> *) jb;
<a name="l00664"></a>00664    <span class="keywordtype">int</span> res;
<a name="l00665"></a>00665 
<a name="l00666"></a>00666    res = <a class="code" href="fixedjitterbuf_8c.html#a106bbf8ecb1418adbaff65e7897337d1">fixed_jb_put_first</a>(fixedjb, fin, fin-&gt;<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a>, fin-&gt;<a class="code" href="structast__frame.html#a1eb46dcb363821328c0d2a758549216b">ts</a>, now);
<a name="l00667"></a>00667 
<a name="l00668"></a>00668    <span class="keywordflow">return</span> fixed_to_abstract_code[res];
<a name="l00669"></a>00669 }
<a name="l00670"></a>00670 
<a name="l00671"></a>00671 
<a name="l00672"></a><a class="code" href="abstract__jb_8c.html#a17f4c25153594a57f188f3cad1d8c348">00672</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="abstract__jb_8c.html#a17f4c25153594a57f188f3cad1d8c348">jb_put_fixed</a>(<span class="keywordtype">void</span> *jb, <span class="keyword">struct</span> <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *fin, <span class="keywordtype">long</span> now)
<a name="l00673"></a>00673 {
<a name="l00674"></a>00674    <span class="keyword">struct </span><a class="code" href="structfixed__jb.html" title="private fixed_jb structure">fixed_jb</a> *fixedjb = (<span class="keyword">struct </span><a class="code" href="structfixed__jb.html" title="private fixed_jb structure">fixed_jb</a> *) jb;
<a name="l00675"></a>00675    <span class="keywordtype">int</span> res;
<a name="l00676"></a>00676 
<a name="l00677"></a>00677    res = <a class="code" href="fixedjitterbuf_8c.html#a23dda5934f0266daa24d5cb6c2184f37">fixed_jb_put</a>(fixedjb, fin, fin-&gt;<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a>, fin-&gt;<a class="code" href="structast__frame.html#a1eb46dcb363821328c0d2a758549216b">ts</a>, now);
<a name="l00678"></a>00678 
<a name="l00679"></a>00679    <span class="keywordflow">return</span> fixed_to_abstract_code[res];
<a name="l00680"></a>00680 }
<a name="l00681"></a>00681 
<a name="l00682"></a>00682 
<a name="l00683"></a><a class="code" href="abstract__jb_8c.html#ae0cfc3efbefa40327321a552239879b2">00683</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="abstract__jb_8c.html#ae0cfc3efbefa40327321a552239879b2">jb_get_fixed</a>(<span class="keywordtype">void</span> *jb, <span class="keyword">struct</span> <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> **fout, <span class="keywordtype">long</span> now, <span class="keywordtype">long</span> interpl)
<a name="l00684"></a>00684 {
<a name="l00685"></a>00685    <span class="keyword">struct </span><a class="code" href="structfixed__jb.html" title="private fixed_jb structure">fixed_jb</a> *fixedjb = (<span class="keyword">struct </span><a class="code" href="structfixed__jb.html" title="private fixed_jb structure">fixed_jb</a> *) jb;
<a name="l00686"></a>00686    <span class="keyword">struct </span><a class="code" href="structfixed__jb__frame.html">fixed_jb_frame</a> frame;
<a name="l00687"></a>00687    <span class="keywordtype">int</span> res;
<a name="l00688"></a>00688 
<a name="l00689"></a>00689    res = <a class="code" href="fixedjitterbuf_8c.html#a8f1f855738e56421bde17723171cb349">fixed_jb_get</a>(fixedjb, &amp;frame, now, interpl);
<a name="l00690"></a>00690    *fout = frame.<a class="code" href="structfixed__jb__frame.html#a735984d41155bc1032e09bece8f8d66d">data</a>;
<a name="l00691"></a>00691 
<a name="l00692"></a>00692    <span class="keywordflow">return</span> fixed_to_abstract_code[res];
<a name="l00693"></a>00693 }
<a name="l00694"></a>00694 
<a name="l00695"></a>00695 
<a name="l00696"></a><a class="code" href="abstract__jb_8c.html#a63c65444eb6fcdb991ff9af96b8ea31f">00696</a> <span class="keyword">static</span> <span class="keywordtype">long</span> <a class="code" href="abstract__jb_8c.html#a63c65444eb6fcdb991ff9af96b8ea31f">jb_next_fixed</a>(<span class="keywordtype">void</span> *jb)
<a name="l00697"></a>00697 {
<a name="l00698"></a>00698    <span class="keyword">struct </span><a class="code" href="structfixed__jb.html" title="private fixed_jb structure">fixed_jb</a> *fixedjb = (<span class="keyword">struct </span><a class="code" href="structfixed__jb.html" title="private fixed_jb structure">fixed_jb</a> *) jb;
<a name="l00699"></a>00699 
<a name="l00700"></a>00700    <span class="keywordflow">return</span> <a class="code" href="fixedjitterbuf_8c.html#a804095f8968987ae58a5effdccd862d1">fixed_jb_next</a>(fixedjb);
<a name="l00701"></a>00701 }
<a name="l00702"></a>00702 
<a name="l00703"></a>00703 
<a name="l00704"></a><a class="code" href="abstract__jb_8c.html#a19e4be4437c2a5e6a631c16e4eabf7f0">00704</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="abstract__jb_8c.html#a19e4be4437c2a5e6a631c16e4eabf7f0">jb_remove_fixed</a>(<span class="keywordtype">void</span> *jb, <span class="keyword">struct</span> <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> **fout)
<a name="l00705"></a>00705 {
<a name="l00706"></a>00706    <span class="keyword">struct </span><a class="code" href="structfixed__jb.html" title="private fixed_jb structure">fixed_jb</a> *fixedjb = (<span class="keyword">struct </span><a class="code" href="structfixed__jb.html" title="private fixed_jb structure">fixed_jb</a> *) jb;
<a name="l00707"></a>00707    <span class="keyword">struct </span><a class="code" href="structfixed__jb__frame.html">fixed_jb_frame</a> frame;
<a name="l00708"></a>00708    <span class="keywordtype">int</span> res;
<a name="l00709"></a>00709 
<a name="l00710"></a>00710    res = <a class="code" href="fixedjitterbuf_8c.html#aca299f79cffc484162cbb8deac80d511">fixed_jb_remove</a>(fixedjb, &amp;frame);
<a name="l00711"></a>00711    *fout = frame.<a class="code" href="structfixed__jb__frame.html#a735984d41155bc1032e09bece8f8d66d">data</a>;
<a name="l00712"></a>00712 
<a name="l00713"></a>00713    <span class="keywordflow">return</span> fixed_to_abstract_code[res];
<a name="l00714"></a>00714 }
<a name="l00715"></a>00715 
<a name="l00716"></a>00716 
<a name="l00717"></a><a class="code" href="abstract__jb_8c.html#a3d74a011c952ca36c677e2fe73f284f1">00717</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="abstract__jb_8c.html#a3d74a011c952ca36c677e2fe73f284f1">jb_force_resynch_fixed</a>(<span class="keywordtype">void</span> *jb)
<a name="l00718"></a>00718 {
<a name="l00719"></a>00719    <span class="keyword">struct </span><a class="code" href="structfixed__jb.html" title="private fixed_jb structure">fixed_jb</a> *fixedjb = (<span class="keyword">struct </span><a class="code" href="structfixed__jb.html" title="private fixed_jb structure">fixed_jb</a> *) jb;
<a name="l00720"></a>00720 
<a name="l00721"></a>00721    <a class="code" href="fixedjitterbuf_8c.html#aef1b92e58c4a0bcc1cf5902e705b10ec">fixed_jb_set_force_resynch</a>(fixedjb);
<a name="l00722"></a>00722 }
<a name="l00723"></a>00723 
<a name="l00724"></a><a class="code" href="abstract__jb_8c.html#ada58865ed9b0d523853282c74aebd560">00724</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="abstract__jb_8c.html#ada58865ed9b0d523853282c74aebd560">jb_empty_and_reset_fixed</a>(<span class="keywordtype">void</span> *jb)
<a name="l00725"></a>00725 {
<a name="l00726"></a>00726    <span class="keyword">struct </span><a class="code" href="structfixed__jb.html" title="private fixed_jb structure">fixed_jb</a> *fixedjb = jb;
<a name="l00727"></a>00727    <span class="keyword">struct </span><a class="code" href="structfixed__jb__frame.html">fixed_jb_frame</a> f;
<a name="l00728"></a>00728 
<a name="l00729"></a>00729    <span class="keywordflow">while</span> (<a class="code" href="fixedjitterbuf_8c.html#aca299f79cffc484162cbb8deac80d511">fixed_jb_remove</a>(fixedjb, &amp;f) == <a class="code" href="fixedjitterbuf_8h.html#aa35bbc7be42569ff9ba436cf05942ce6ae434daf121142a5eb2ecfcace6f5a039">FIXED_JB_OK</a>) {
<a name="l00730"></a>00730       <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f.<a class="code" href="structfixed__jb__frame.html#a735984d41155bc1032e09bece8f8d66d">data</a>);
<a name="l00731"></a>00731    }
<a name="l00732"></a>00732 }
<a name="l00733"></a>00733 
<a name="l00734"></a>00734 <span class="comment">/* adaptive */</span>
<a name="l00735"></a>00735 
<a name="l00736"></a><a class="code" href="abstract__jb_8c.html#a7e0bdab27251e2595d5468001d73154e">00736</a> <span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="abstract__jb_8c.html#a7e0bdab27251e2595d5468001d73154e">jb_create_adaptive</a>(<span class="keyword">struct</span> <a class="code" href="structast__jb__conf.html" title="General jitterbuffer configuration.">ast_jb_conf</a> *general_config, <span class="keywordtype">long</span> resynch_threshold)
<a name="l00737"></a>00737 {
<a name="l00738"></a>00738    <a class="code" href="structjb__conf.html">jb_conf</a> jbconf;
<a name="l00739"></a>00739    <a class="code" href="structjitterbuf.html">jitterbuf</a> *adaptivejb;
<a name="l00740"></a>00740 
<a name="l00741"></a>00741    adaptivejb = <a class="code" href="jitterbuf_8h.html#a2fd56d2b8a06ad6b89cf67619f790911" title="new jitterbuf">jb_new</a>();
<a name="l00742"></a>00742    <span class="keywordflow">if</span> (adaptivejb) {
<a name="l00743"></a>00743       jbconf.<a class="code" href="structjb__conf.html#a560b79d26ead7b640d797181c9c3122c">max_jitterbuf</a> = general_config-&gt;<a class="code" href="structast__jb__conf.html#aaba39ba18eb00647786272b9061659e3" title="Max size of the jitterbuffer implementation.">max_size</a>;
<a name="l00744"></a>00744       jbconf.<a class="code" href="structjb__conf.html#ab5d708c3e3489b6fd1f92b19939c18e8">resync_threshold</a> = general_config-&gt;<a class="code" href="structast__jb__conf.html#ab5d708c3e3489b6fd1f92b19939c18e8" title="Resynchronization threshold of the jitterbuffer implementation.">resync_threshold</a>;
<a name="l00745"></a>00745       jbconf.<a class="code" href="structjb__conf.html#af42f40eb2b87dd2147bd66357e99eff4">max_contig_interp</a> = 10;
<a name="l00746"></a>00746       jbconf.<a class="code" href="structjb__conf.html#a322d898485ffd6c3c07391f381903bdd">target_extra</a> = general_config-&gt;<a class="code" href="structast__jb__conf.html#a322d898485ffd6c3c07391f381903bdd" title="amount of additional jitterbuffer adjustment">target_extra</a>;
<a name="l00747"></a>00747       <a class="code" href="jitterbuf_8h.html#a8ecded60181a9c1d1dae2fe05bddccf8" title="set jitterbuf conf">jb_setconf</a>(adaptivejb, &amp;jbconf);
<a name="l00748"></a>00748    }
<a name="l00749"></a>00749 
<a name="l00750"></a>00750    <span class="keywordflow">return</span> adaptivejb;
<a name="l00751"></a>00751 }
<a name="l00752"></a>00752 
<a name="l00753"></a>00753 
<a name="l00754"></a><a class="code" href="abstract__jb_8c.html#ac5b1d5ef57dbd7d0eef8e6a0f972bb1c">00754</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="abstract__jb_8c.html#ac5b1d5ef57dbd7d0eef8e6a0f972bb1c">jb_destroy_adaptive</a>(<span class="keywordtype">void</span> *jb)
<a name="l00755"></a>00755 {
<a name="l00756"></a>00756    <a class="code" href="structjitterbuf.html">jitterbuf</a> *adaptivejb = (<a class="code" href="structjitterbuf.html">jitterbuf</a> *) jb;
<a name="l00757"></a>00757 
<a name="l00758"></a>00758    <a class="code" href="jitterbuf_8h.html#a2714537be23d6bb12425ba8542c4b1f7" title="destroy jitterbuf">jb_destroy</a>(adaptivejb);
<a name="l00759"></a>00759 }
<a name="l00760"></a>00760 
<a name="l00761"></a>00761 
<a name="l00762"></a><a class="code" href="abstract__jb_8c.html#ab901ec2de556331d0ff46342d62c56bc">00762</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="abstract__jb_8c.html#ab901ec2de556331d0ff46342d62c56bc">jb_put_first_adaptive</a>(<span class="keywordtype">void</span> *jb, <span class="keyword">struct</span> <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *fin, <span class="keywordtype">long</span> now)
<a name="l00763"></a>00763 {
<a name="l00764"></a>00764    <span class="keywordflow">return</span> <a class="code" href="abstract__jb_8c.html#a483b38f23bd9ef5293a6e3564c36f8bb">jb_put_adaptive</a>(jb, fin, now);
<a name="l00765"></a>00765 }
<a name="l00766"></a>00766 
<a name="l00767"></a>00767 
<a name="l00768"></a><a class="code" href="abstract__jb_8c.html#a483b38f23bd9ef5293a6e3564c36f8bb">00768</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="abstract__jb_8c.html#a483b38f23bd9ef5293a6e3564c36f8bb">jb_put_adaptive</a>(<span class="keywordtype">void</span> *jb, <span class="keyword">struct</span> <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *fin, <span class="keywordtype">long</span> now)
<a name="l00769"></a>00769 {
<a name="l00770"></a>00770    <a class="code" href="structjitterbuf.html">jitterbuf</a> *adaptivejb = (<a class="code" href="structjitterbuf.html">jitterbuf</a> *) jb;
<a name="l00771"></a>00771    <span class="keywordtype">int</span> res;
<a name="l00772"></a>00772 
<a name="l00773"></a>00773    res = <a class="code" href="jitterbuf_8h.html#a68bbac088e27e18441bd5b403f7f31d7" title="queue a frame">jb_put</a>(adaptivejb, fin, <a class="code" href="jitterbuf_8h.html#a7e72da000f982634fda8319b82db8de5ad5dc59855a16913d9c6bdda89bb8ea31">JB_TYPE_VOICE</a>, fin-&gt;<a class="code" href="structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a>, fin-&gt;<a class="code" href="structast__frame.html#a1eb46dcb363821328c0d2a758549216b">ts</a>, now);
<a name="l00774"></a>00774 
<a name="l00775"></a>00775    <span class="keywordflow">return</span> adaptive_to_abstract_code[res];
<a name="l00776"></a>00776 }
<a name="l00777"></a>00777 
<a name="l00778"></a>00778 
<a name="l00779"></a><a class="code" href="abstract__jb_8c.html#a6f67e271e84cb1a28aee93f4c10958ea">00779</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="abstract__jb_8c.html#a6f67e271e84cb1a28aee93f4c10958ea">jb_get_adaptive</a>(<span class="keywordtype">void</span> *jb, <span class="keyword">struct</span> <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> **fout, <span class="keywordtype">long</span> now, <span class="keywordtype">long</span> interpl)
<a name="l00780"></a>00780 {
<a name="l00781"></a>00781    <a class="code" href="structjitterbuf.html">jitterbuf</a> *adaptivejb = (<a class="code" href="structjitterbuf.html">jitterbuf</a> *) jb;
<a name="l00782"></a>00782    <a class="code" href="structjb__frame.html">jb_frame</a> frame;
<a name="l00783"></a>00783    <span class="keywordtype">int</span> res;
<a name="l00784"></a>00784 
<a name="l00785"></a>00785    res = <a class="code" href="jitterbuf_8h.html#a37158045e8af38a69ab6d15ee51dc08e" title="get a frame for time now (receiver&amp;#39;s time) return value is one of JB_OK: You&amp;#39;ve...">jb_get</a>(adaptivejb, &amp;frame, now, interpl);
<a name="l00786"></a>00786    *fout = frame.<a class="code" href="structjb__frame.html#a735984d41155bc1032e09bece8f8d66d">data</a>;
<a name="l00787"></a>00787 
<a name="l00788"></a>00788    <span class="keywordflow">return</span> adaptive_to_abstract_code[res];
<a name="l00789"></a>00789 }
<a name="l00790"></a>00790 
<a name="l00791"></a>00791 
<a name="l00792"></a><a class="code" href="abstract__jb_8c.html#a56b96eefcf15ae5ce37a7cdffbd65745">00792</a> <span class="keyword">static</span> <span class="keywordtype">long</span> <a class="code" href="abstract__jb_8c.html#a56b96eefcf15ae5ce37a7cdffbd65745">jb_next_adaptive</a>(<span class="keywordtype">void</span> *jb)
<a name="l00793"></a>00793 {
<a name="l00794"></a>00794    <a class="code" href="structjitterbuf.html">jitterbuf</a> *adaptivejb = (<a class="code" href="structjitterbuf.html">jitterbuf</a> *) jb;
<a name="l00795"></a>00795 
<a name="l00796"></a>00796    <span class="keywordflow">return</span> <a class="code" href="jitterbuf_8h.html#a72883f3dc8328524ab3930122946e0a0" title="when is the next frame due out, in receiver&amp;#39;s time (0=EMPTY) This value may change...">jb_next</a>(adaptivejb);
<a name="l00797"></a>00797 }
<a name="l00798"></a>00798 
<a name="l00799"></a>00799 
<a name="l00800"></a><a class="code" href="abstract__jb_8c.html#ad1e4c7a7c7ee99733beb66389a661ac9">00800</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="abstract__jb_8c.html#ad1e4c7a7c7ee99733beb66389a661ac9">jb_remove_adaptive</a>(<span class="keywordtype">void</span> *jb, <span class="keyword">struct</span> <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> **fout)
<a name="l00801"></a>00801 {
<a name="l00802"></a>00802    <a class="code" href="structjitterbuf.html">jitterbuf</a> *adaptivejb = (<a class="code" href="structjitterbuf.html">jitterbuf</a> *) jb;
<a name="l00803"></a>00803    <a class="code" href="structjb__frame.html">jb_frame</a> frame;
<a name="l00804"></a>00804    <span class="keywordtype">int</span> res;
<a name="l00805"></a>00805 
<a name="l00806"></a>00806    res = <a class="code" href="jitterbuf_8h.html#aaca01cea1cbcba683ca6d5b0bc009666" title="unconditionally get frames from jitterbuf until empty">jb_getall</a>(adaptivejb, &amp;frame);
<a name="l00807"></a>00807    *fout = frame.<a class="code" href="structjb__frame.html#a735984d41155bc1032e09bece8f8d66d">data</a>;
<a name="l00808"></a>00808 
<a name="l00809"></a>00809    <span class="keywordflow">return</span> adaptive_to_abstract_code[res];
<a name="l00810"></a>00810 }
<a name="l00811"></a>00811 
<a name="l00812"></a>00812 
<a name="l00813"></a><a class="code" href="abstract__jb_8c.html#aa03c23606541409e6e3b5137d5f4a9c6">00813</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="abstract__jb_8c.html#aa03c23606541409e6e3b5137d5f4a9c6">jb_force_resynch_adaptive</a>(<span class="keywordtype">void</span> *jb)
<a name="l00814"></a>00814 {
<a name="l00815"></a>00815 }
<a name="l00816"></a>00816 
<a name="l00817"></a><a class="code" href="abstract__jb_8c.html#aaa70646a0eec8575d97b599ce9ce46ae">00817</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="abstract__jb_8c.html#aaa70646a0eec8575d97b599ce9ce46ae">jb_empty_and_reset_adaptive</a>(<span class="keywordtype">void</span> *jb)
<a name="l00818"></a>00818 {
<a name="l00819"></a>00819    <a class="code" href="structjitterbuf.html">jitterbuf</a> *adaptivejb = jb;
<a name="l00820"></a>00820    <a class="code" href="structjb__frame.html">jb_frame</a> <a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l00821"></a>00821 
<a name="l00822"></a>00822    <span class="keywordflow">while</span> (<a class="code" href="jitterbuf_8h.html#aaca01cea1cbcba683ca6d5b0bc009666" title="unconditionally get frames from jitterbuf until empty">jb_getall</a>(adaptivejb, &amp;f) == <a class="code" href="jitterbuf_8h.html#ad8d0ce8a0ebfabfe77a56b17b2d154f5abcbf2631f2f32ca1af2a49ff82bebaec">JB_OK</a>) {
<a name="l00823"></a>00823       <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f.<a class="code" href="structjb__frame.html#a735984d41155bc1032e09bece8f8d66d">data</a>);
<a name="l00824"></a>00824    }
<a name="l00825"></a>00825 
<a name="l00826"></a>00826    <a class="code" href="jitterbuf_8h.html#a2c9efa9222ff9d7324a06c4a21b5ef72" title="reset jitterbuf">jb_reset</a>(adaptivejb);
<a name="l00827"></a>00827 }
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:18:23 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
