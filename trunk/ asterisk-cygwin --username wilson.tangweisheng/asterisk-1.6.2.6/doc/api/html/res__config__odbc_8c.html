<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:23:10 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_318a70d4e812a718d9ecaeea98fff199.html">res</a>
  </div>
</div>
<div class="contents">
<h1>res_config_odbc.c File Reference</h1>
<p>odbc+odbc plugin for portable configuration engine  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="asterisk_8h_source.html">asterisk.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="file_8h_source.html">asterisk/file.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="channel_8h_source.html">asterisk/channel.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="pbx_8h_source.html">asterisk/pbx.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="config_8h_source.html">asterisk/config.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="module_8h_source.html">asterisk/module.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="lock_8h_source.html">asterisk/lock.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="res__odbc_8h_source.html">asterisk/res_odbc.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="utils_8h_source.html">asterisk/utils.h</a>&quot;</code><br/>

<p><a href="res__config__odbc_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structconfig__odbc__obj.html">config_odbc_obj</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcustom__prepare__struct.html">custom_prepare_struct</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structupdate2__prepare__struct.html">update2_prepare_struct</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__odbc_8c.html#a213ff212b1abd119f58f61f5576e13d4">CHECK_SIZE</a>(n)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__odbc_8c.html#a18da797c1ab7394473a9b3c7e13e6f89">warn_length</a>(col, size)&nbsp;&nbsp;&nbsp;ast_log(LOG_WARNING, &quot;Realtime <a class="el" href="cdr__sqlite3__custom_8c.html#aa334abe35e252ebf7a2c7c29572bc60f">table</a> %s@%s: column '%s' is not long enough to contain realtime data (needs %d)\n&quot;, table, database, col-&gt;<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, size)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__odbc_8c.html#ac0fc1cb3fe8e03194386842057d38085">warn_type</a>(col, <a class="el" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>)&nbsp;&nbsp;&nbsp;ast_log(LOG_WARNING, &quot;Realtime <a class="el" href="cdr__sqlite3__custom_8c.html#aa334abe35e252ebf7a2c7c29572bc60f">table</a> %s@%s: column '%s' is of the incorrect <a class="el" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a> (%d) to contain the required realtime data\n&quot;, table, database, col-&gt;<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, col-&gt;<a class="el" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__odbc_8c.html#af2cdda2f51ca0d0f04ec61841eb58ddb">WARN_TYPE_OR_LENGTH</a>(n)</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__odbc_8c.html#a2ff160eb8cc768ef928c90bb61ded670">__init_sql_buf</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__odbc_8c.html#a88b7c88fed6b80fd18f34f97757dfc04">__reg_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__odbc_8c.html#afeab1257bd17282b95875499393a147a">__unreg_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__config.html">ast_config</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__odbc_8c.html#afb539ed4449dca3ae69f5509be91984e">config_odbc</a> (const char *database, const char *<a class="el" href="cdr__sqlite3__custom_8c.html#aa334abe35e252ebf7a2c7c29572bc60f">table</a>, const char *file, struct <a class="el" href="structast__config.html">ast_config</a> *cfg, struct <a class="el" href="structast__flags.html">ast_flags</a> flags, const char *sugg_incl, const char *who_asked)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static SQLHSTMT&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__odbc_8c.html#ac6e7f282a8bd52604b583b42e7db4488">config_odbc_prepare</a> (struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *obj, void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static SQLHSTMT&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__odbc_8c.html#a9fb0770b5d483240183affa19304b681">custom_prepare</a> (struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *obj, void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__odbc_8c.html#affad90b515d1b3993b1582518f6ed883">destroy_odbc</a> (const char *database, const char *<a class="el" href="cdr__sqlite3__custom_8c.html#aa334abe35e252ebf7a2c7c29572bc60f">table</a>, const char *keyfield, const char *lookup, va_list ap)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Excute an DELETE query.  <a href="#affad90b515d1b3993b1582518f6ed883"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__odbc_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__config.html">ast_config</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__odbc_8c.html#a39bc8a97c5e98573ea3d5d266c17ce8a">realtime_multi_odbc</a> (const char *database, const char *<a class="el" href="cdr__sqlite3__custom_8c.html#aa334abe35e252ebf7a2c7c29572bc60f">table</a>, va_list ap)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Excute an Select query and return <a class="el" href="structast__config.html">ast_config</a> list.  <a href="#a39bc8a97c5e98573ea3d5d266c17ce8a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__variable.html">ast_variable</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__odbc_8c.html#a2416b8a4c2adace0ce96ca56ef73c017">realtime_odbc</a> (const char *database, const char *<a class="el" href="cdr__sqlite3__custom_8c.html#aa334abe35e252ebf7a2c7c29572bc60f">table</a>, va_list ap)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Excute an SQL query and return <a class="el" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> list.  <a href="#a2416b8a4c2adace0ce96ca56ef73c017"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__odbc_8c.html#a7c6ac25ea7536c0bc9ed18cbcf917527">reload_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__odbc_8c.html#a3dc1c580fd0e6f5ab56a9d9569ca44aa">require_odbc</a> (const char *database, const char *<a class="el" href="cdr__sqlite3__custom_8c.html#aa334abe35e252ebf7a2c7c29572bc60f">table</a>, va_list ap)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__odbc_8c.html#ae97ad756e436d6ecf0755aa42d05d7fd">store_odbc</a> (const char *database, const char *<a class="el" href="cdr__sqlite3__custom_8c.html#aa334abe35e252ebf7a2c7c29572bc60f">table</a>, va_list ap)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Excute an INSERT query.  <a href="#ae97ad756e436d6ecf0755aa42d05d7fd"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__odbc_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__odbc_8c.html#a375a41c8f5c188809ca9383c99e7112a">update2_odbc</a> (const char *database, const char *<a class="el" href="cdr__sqlite3__custom_8c.html#aa334abe35e252ebf7a2c7c29572bc60f">table</a>, va_list ap)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Execute an UPDATE query.  <a href="#a375a41c8f5c188809ca9383c99e7112a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static SQLHSTMT&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__odbc_8c.html#a6186be46bd20ad42812bfd719cfef978">update2_prepare</a> (struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *obj, void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__odbc_8c.html#a1b7a5cbfc56b64b535e75a1ac0268430">update_odbc</a> (const char *database, const char *<a class="el" href="cdr__sqlite3__custom_8c.html#aa334abe35e252ebf7a2c7c29572bc60f">table</a>, const char *keyfield, const char *lookup, va_list ap)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Excute an UPDATE query.  <a href="#a1b7a5cbfc56b64b535e75a1ac0268430"></a><br/></td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__module__info.html">ast_module_info</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__odbc_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a> = { .<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = AST_MODULE, .flags = AST_MODFLAG_GLOBAL_SYMBOLS , .<a class="el" href="callerid_8c.html#a68344fa88cf4e86b5079fd69a5c22d57">description</a> = &quot;Realtime ODBC configuration&quot; , .key = &quot;This paragraph is copyright (c) 2006 by Digium, Inc. \In order for your module to load, it must return this \key via a function called \&quot;key\&quot;. Any code which \includes this paragraph must be licensed under the GNU \General Public License <a class="el" href="res__config__pgsql_8c.html#aad880fc4455c253781e8968f2239d56f">version</a> 2 or later (at your \option). In addition to Digium's general reservations \of rights, Digium expressly reserves the right to \allow other parties to license this paragraph under \different terms. Any use of Digium, Inc. trademarks or \logos (including \&quot;Asterisk\&quot; or \&quot;Digium\&quot;) without \express written <a class="el" href="structpermission.html">permission</a> of Digium, Inc. is prohibited.\n&quot; , .buildopt_sum = &quot;aefddfaffd51bc118c14a748e96eb9a0&quot; , .load = load_module, .unload = unload_module, .reload = reload_module, }</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__module__info.html">ast_module_info</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__odbc_8c.html#ae25b9f3970870610911f8850897e8ead">ast_module_info</a> = &amp;<a class="el" href="res__timing__timerfd_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__config__engine.html">ast_config_engine</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__odbc_8c.html#a0db7ee1d52bac64062bb76ed957432bb">odbc_engine</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__threadstorage.html">ast_threadstorage</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__odbc_8c.html#afc4bfa5a94710e6f323a1033f82425b3">sql_buf</a> = { .once = PTHREAD_ONCE_INIT , .key_init = __init_sql_buf , .custom_init = NULL , }</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>odbc+odbc plugin for portable configuration engine </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Mark Spencer &lt;<a href="mailto:markster@digium.com">markster@digium.com</a>&gt; </dd>
<dd>
Anthony Minessale II &lt;<a href="mailto:anthmct@yahoo.com">anthmct@yahoo.com</a>&gt;</dd></dl>
<ul>
<li><a href="http://www.unixodbc.org">http://www.unixodbc.org</a> </li>
</ul>

<p>Definition in file <a class="el" href="res__config__odbc_8c_source.html">res_config_odbc.c</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a213ff212b1abd119f58f61f5576e13d4"></a><!-- doxytag: member="res_config_odbc.c::CHECK_SIZE" ref="a213ff212b1abd119f58f61f5576e13d4" args="(n)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CHECK_SIZE</td>
          <td>(</td>
          <td class="paramtype">n&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment"><span class="keywordflow">if</span> (col-&gt;size &lt; n) {      \
                     <a class="code" href="res__config__odbc_8c.html#a18da797c1ab7394473a9b3c7e13e6f89">warn_length</a>(col, n);  \
                  }                         \
                  <span class="keywordflow">break</span>;
</pre></div>
<p>Referenced by <a class="el" href="res__config__odbc_8c_source.html#l00884">require_odbc()</a>.</p>

</div>
</div>
<a class="anchor" id="a18da797c1ab7394473a9b3c7e13e6f89"></a><!-- doxytag: member="res_config_odbc.c::warn_length" ref="a18da797c1ab7394473a9b3c7e13e6f89" args="(col, size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define warn_length</td>
          <td>(</td>
          <td class="paramtype">col, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;ast_log(LOG_WARNING, &quot;Realtime <a class="el" href="cdr__sqlite3__custom_8c.html#aa334abe35e252ebf7a2c7c29572bc60f">table</a> %s@%s: column '%s' is not long enough to contain realtime data (needs %d)\n&quot;, table, database, col-&gt;<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, size)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__odbc_8c_source.html#l00881">881</a> of file <a class="el" href="res__config__odbc_8c_source.html">res_config_odbc.c</a>.</p>

<p>Referenced by <a class="el" href="res__config__odbc_8c_source.html#l00884">require_odbc()</a>.</p>

</div>
</div>
<a class="anchor" id="ac0fc1cb3fe8e03194386842057d38085"></a><!-- doxytag: member="res_config_odbc.c::warn_type" ref="ac0fc1cb3fe8e03194386842057d38085" args="(col, type)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define warn_type</td>
          <td>(</td>
          <td class="paramtype">col, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;ast_log(LOG_WARNING, &quot;Realtime <a class="el" href="cdr__sqlite3__custom_8c.html#aa334abe35e252ebf7a2c7c29572bc60f">table</a> %s@%s: column '%s' is of the incorrect <a class="el" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a> (%d) to contain the required realtime data\n&quot;, table, database, col-&gt;<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, col-&gt;<a class="el" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__odbc_8c_source.html#l00882">882</a> of file <a class="el" href="res__config__odbc_8c_source.html">res_config_odbc.c</a>.</p>

<p>Referenced by <a class="el" href="res__config__odbc_8c_source.html#l00884">require_odbc()</a>.</p>

</div>
</div>
<a class="anchor" id="af2cdda2f51ca0d0f04ec61841eb58ddb"></a><!-- doxytag: member="res_config_odbc.c::WARN_TYPE_OR_LENGTH" ref="af2cdda2f51ca0d0f04ec61841eb58ddb" args="(n)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define WARN_TYPE_OR_LENGTH</td>
          <td>(</td>
          <td class="paramtype">n&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment"><span class="keywordflow">if</span> (!ast_rq_is_int(<a class="code" href="chan__nbs_8c.html#abda2c6671470e62e2e93b09986c9117e">type</a>)) {  \
                     <a class="code" href="res__config__odbc_8c.html#ac0fc1cb3fe8e03194386842057d38085">warn_type</a>(col, <a class="code" href="chan__nbs_8c.html#abda2c6671470e62e2e93b09986c9117e">type</a>);    \
                  } <span class="keywordflow">else</span> {                     \
                     <a class="code" href="res__config__odbc_8c.html#a18da797c1ab7394473a9b3c7e13e6f89">warn_length</a>(col, n);  \
                  }
</pre></div>
<p>Referenced by <a class="el" href="res__config__odbc_8c_source.html#l00884">require_odbc()</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a2ff160eb8cc768ef928c90bb61ded670"></a><!-- doxytag: member="res_config_odbc.c::__init_sql_buf" ref="a2ff160eb8cc768ef928c90bb61ded670" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void __init_sql_buf </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__odbc_8c_source.html#l00048">48</a> of file <a class="el" href="res__config__odbc_8c_source.html">res_config_odbc.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00050"></a>00050 {
</pre></div></p>

</div>
</div>
<a class="anchor" id="a88b7c88fed6b80fd18f34f97757dfc04"></a><!-- doxytag: member="res_config_odbc.c::__reg_module" ref="a88b7c88fed6b80fd18f34f97757dfc04" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void __reg_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__odbc_8c_source.html#l01079">1079</a> of file <a class="el" href="res__config__odbc_8c_source.html">res_config_odbc.c</a>.</p>

</div>
</div>
<a class="anchor" id="afeab1257bd17282b95875499393a147a"></a><!-- doxytag: member="res_config_odbc.c::__unreg_module" ref="afeab1257bd17282b95875499393a147a" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void __unreg_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__odbc_8c_source.html#l01079">1079</a> of file <a class="el" href="res__config__odbc_8c_source.html">res_config_odbc.c</a>.</p>

</div>
</div>
<a class="anchor" id="afb539ed4449dca3ae69f5509be91984e"></a><!-- doxytag: member="res_config_odbc.c::config_odbc" ref="afb539ed4449dca3ae69f5509be91984e" args="(const char *database, const char *table, const char *file, struct ast_config *cfg, struct ast_flags flags, const char *sugg_incl, const char *who_asked)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__config.html">ast_config</a>* config_odbc </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>database</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__config.html">ast_config</a> *&nbsp;</td>
          <td class="paramname"> <em>cfg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__flags.html">ast_flags</a>&nbsp;</td>
          <td class="paramname"> <em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>sugg_incl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>who_asked</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__odbc_8c_source.html#l00797">797</a> of file <a class="el" href="res__config__odbc_8c_source.html">res_config_odbc.c</a>.</p>

<p>References <a class="el" href="utils_8c_source.html#l01299">ast_build_string()</a>, <a class="el" href="config_8c_source.html#l00522">ast_category_append()</a>, <a class="el" href="config_8c_source.html#l00483">ast_category_new()</a>, <a class="el" href="config_8c_source.html#l00845">ast_config_get_current_category()</a>, <a class="el" href="config_8c_source.html#l02031">ast_config_internal_load()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="res__odbc_8c_source.html#l00593">ast_odbc_prepare_and_execute()</a>, <a class="el" href="res__odbc_8c_source.html#l01041">ast_odbc_release_obj()</a>, <a class="el" href="res__odbc_8c_source.html#l01331">ast_odbc_request_obj()</a>, <a class="el" href="config_8c_source.html#l00348">ast_variable_append()</a>, <a class="el" href="config_8c_source.html#l00223">ast_variable_new()</a>, <a class="el" href="res__config__odbc_8c_source.html#l00763">config_odbc_obj::cat_metric</a>, <a class="el" href="res__config__odbc_8c_source.html#l00764">config_odbc_obj::category</a>, <a class="el" href="res__config__odbc_8c_source.html#l00770">config_odbc_prepare()</a>, <a class="el" href="devicestate_8c_source.html#l00198">last</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="res__config__odbc_8c_source.html#l00762">config_odbc_obj::sql</a>, <a class="el" href="res__config__odbc_8c_source.html#l00765">config_odbc_obj::var_name</a>, and <a class="el" href="res__config__odbc_8c_source.html#l00766">config_odbc_obj::var_val</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00798"></a>00798 {
<a name="l00799"></a>00799    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *new_v;
<a name="l00800"></a>00800    <span class="keyword">struct </span><a class="code" href="structast__category.html">ast_category</a> *cur_cat;
<a name="l00801"></a>00801    <span class="keywordtype">int</span> res = 0;
<a name="l00802"></a>00802    <span class="keyword">struct </span><a class="code" href="structodbc__obj.html" title="ODBC container.">odbc_obj</a> *obj;
<a name="l00803"></a>00803    <span class="keywordtype">char</span> sqlbuf[1024] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00804"></a>00804    <span class="keywordtype">char</span> *sql = sqlbuf;
<a name="l00805"></a>00805    <span class="keywordtype">size_t</span> sqlleft = <span class="keyword">sizeof</span>(sqlbuf);
<a name="l00806"></a>00806    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> last_cat_metric = 0;
<a name="l00807"></a>00807    SQLSMALLINT rowcount = 0;
<a name="l00808"></a>00808    SQLHSTMT stmt;
<a name="l00809"></a>00809    <span class="keywordtype">char</span> <a class="code" href="devicestate_8c.html#a43a8def62ee15449794285cbbc0f79af">last</a>[128] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00810"></a>00810    <span class="keyword">struct </span><a class="code" href="structconfig__odbc__obj.html">config_odbc_obj</a> q;
<a name="l00811"></a>00811    <span class="keyword">struct </span><a class="code" href="structast__flags.html" title="Structure used to handle boolean flags.">ast_flags</a> loader_flags = { 0 };
<a name="l00812"></a>00812 
<a name="l00813"></a>00813    memset(&amp;q, 0, <span class="keyword">sizeof</span>(q));
<a name="l00814"></a>00814 
<a name="l00815"></a>00815    <span class="keywordflow">if</span> (!file || !strcmp (file, <span class="stringliteral">&quot;res_config_odbc.conf&quot;</span>))
<a name="l00816"></a>00816       <span class="keywordflow">return</span> NULL;      <span class="comment">/* cant configure myself with myself ! */</span>
<a name="l00817"></a>00817 
<a name="l00818"></a>00818    obj = <a class="code" href="res__odbc_8h.html#ad34ae2bdba165ef6c7405afc94f2a7f3">ast_odbc_request_obj</a>(database, 0);
<a name="l00819"></a>00819    <span class="keywordflow">if</span> (!obj)
<a name="l00820"></a>00820       <span class="keywordflow">return</span> NULL;
<a name="l00821"></a>00821 
<a name="l00822"></a>00822    <a class="code" href="strings_8h.html#a603020160399d4876ec09fd299ebcaf9" title="Build a string in a buffer, designed to be called repeatedly.">ast_build_string</a>(&amp;sql, &amp;sqlleft, <span class="stringliteral">&quot;SELECT cat_metric, category, var_name, var_val FROM %s &quot;</span>, <a class="code" href="cdr__odbc_8c.html#a68d1e6e752f2cf81551fac543cae108a">table</a>);
<a name="l00823"></a>00823    <a class="code" href="strings_8h.html#a603020160399d4876ec09fd299ebcaf9" title="Build a string in a buffer, designed to be called repeatedly.">ast_build_string</a>(&amp;sql, &amp;sqlleft, <span class="stringliteral">&quot;WHERE filename=&apos;%s&apos; AND commented=0 &quot;</span>, file);
<a name="l00824"></a>00824    <a class="code" href="strings_8h.html#a603020160399d4876ec09fd299ebcaf9" title="Build a string in a buffer, designed to be called repeatedly.">ast_build_string</a>(&amp;sql, &amp;sqlleft, <span class="stringliteral">&quot;ORDER BY cat_metric DESC, var_metric ASC, category, var_name &quot;</span>);
<a name="l00825"></a>00825    q.sql = sqlbuf;
<a name="l00826"></a>00826 
<a name="l00827"></a>00827    stmt = <a class="code" href="res__odbc_8h.html#ad1e82a2b1ba4eda1924d8b8f591de065" title="Prepares, executes, and returns the resulting statement handle.">ast_odbc_prepare_and_execute</a>(obj, <a class="code" href="res__config__odbc_8c.html#ac6e7f282a8bd52604b583b42e7db4488">config_odbc_prepare</a>, &amp;q);
<a name="l00828"></a>00828 
<a name="l00829"></a>00829    <span class="keywordflow">if</span> (!stmt) {
<a name="l00830"></a>00830       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;SQL select error!\n[%s]\n\n&quot;</span>, sql);
<a name="l00831"></a>00831       <a class="code" href="res__odbc_8h.html#a78d14d1dd01c269c9c0a47b49475eeea" title="Releases an ODBC object previously allocated by odbc_request_obj().">ast_odbc_release_obj</a>(obj);
<a name="l00832"></a>00832       <span class="keywordflow">return</span> NULL;
<a name="l00833"></a>00833    }
<a name="l00834"></a>00834 
<a name="l00835"></a>00835    res = SQLNumResultCols(stmt, &amp;rowcount);
<a name="l00836"></a>00836 
<a name="l00837"></a>00837    <span class="keywordflow">if</span> ((res != SQL_SUCCESS) &amp;&amp; (res != SQL_SUCCESS_WITH_INFO)) {
<a name="l00838"></a>00838       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;SQL NumResultCols error!\n[%s]\n\n&quot;</span>, sql);
<a name="l00839"></a>00839       SQLFreeHandle(SQL_HANDLE_STMT, stmt);
<a name="l00840"></a>00840       <a class="code" href="res__odbc_8h.html#a78d14d1dd01c269c9c0a47b49475eeea" title="Releases an ODBC object previously allocated by odbc_request_obj().">ast_odbc_release_obj</a>(obj);
<a name="l00841"></a>00841       <span class="keywordflow">return</span> NULL;
<a name="l00842"></a>00842    }
<a name="l00843"></a>00843 
<a name="l00844"></a>00844    <span class="keywordflow">if</span> (!rowcount) {
<a name="l00845"></a>00845       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;found nothing\n&quot;</span>);
<a name="l00846"></a>00846       <a class="code" href="res__odbc_8h.html#a78d14d1dd01c269c9c0a47b49475eeea" title="Releases an ODBC object previously allocated by odbc_request_obj().">ast_odbc_release_obj</a>(obj);
<a name="l00847"></a>00847       <span class="keywordflow">return</span> cfg;
<a name="l00848"></a>00848    }
<a name="l00849"></a>00849 
<a name="l00850"></a>00850    cur_cat = <a class="code" href="config_8h.html#a6884d439424ba2be31ef259213da4e8b" title="Retrieve the current category name being built. API for backend configuration engines...">ast_config_get_current_category</a>(cfg);
<a name="l00851"></a>00851 
<a name="l00852"></a>00852    <span class="keywordflow">while</span> ((res = SQLFetch(stmt)) != SQL_NO_DATA) {
<a name="l00853"></a>00853       <span class="keywordflow">if</span> (!strcmp (q.var_name, <span class="stringliteral">&quot;#include&quot;</span>)) {
<a name="l00854"></a>00854          <span class="keywordflow">if</span> (!<a class="code" href="config_8h.html#a721d5cd60abda2bdd96838336dc09669">ast_config_internal_load</a>(q.var_val, cfg, loader_flags, <span class="stringliteral">&quot;&quot;</span>, who_asked)) {
<a name="l00855"></a>00855             SQLFreeHandle(SQL_HANDLE_STMT, stmt);
<a name="l00856"></a>00856             <a class="code" href="res__odbc_8h.html#a78d14d1dd01c269c9c0a47b49475eeea" title="Releases an ODBC object previously allocated by odbc_request_obj().">ast_odbc_release_obj</a>(obj);
<a name="l00857"></a>00857             <span class="keywordflow">return</span> NULL;
<a name="l00858"></a>00858          }
<a name="l00859"></a>00859          <span class="keywordflow">continue</span>;
<a name="l00860"></a>00860       } 
<a name="l00861"></a>00861       <span class="keywordflow">if</span> (strcmp(last, q.category) || last_cat_metric != q.cat_metric) {
<a name="l00862"></a>00862          cur_cat = <a class="code" href="config_8h.html#affebac76d69639677b677037d9871e29" title="Create a category structure.">ast_category_new</a>(q.category, <span class="stringliteral">&quot;&quot;</span>, 99999);
<a name="l00863"></a>00863          <span class="keywordflow">if</span> (!cur_cat) {
<a name="l00864"></a>00864             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Out of memory!\n&quot;</span>);
<a name="l00865"></a>00865             <span class="keywordflow">break</span>;
<a name="l00866"></a>00866          }
<a name="l00867"></a>00867          strcpy(last, q.category);
<a name="l00868"></a>00868          last_cat_metric   = q.cat_metric;
<a name="l00869"></a>00869          <a class="code" href="config_8h.html#ab7b56ec66b058952423f313752c734e7">ast_category_append</a>(cfg, cur_cat);
<a name="l00870"></a>00870       }
<a name="l00871"></a>00871 
<a name="l00872"></a>00872       new_v = <a class="code" href="config_8h.html#a08e94d96f459e7301a74daf32035423b">ast_variable_new</a>(q.var_name, q.var_val, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00873"></a>00873       <a class="code" href="config_8h.html#a132ddbd39dd9d26395c410f7647f76db">ast_variable_append</a>(cur_cat, new_v);
<a name="l00874"></a>00874    }
<a name="l00875"></a>00875 
<a name="l00876"></a>00876    SQLFreeHandle(SQL_HANDLE_STMT, stmt);
<a name="l00877"></a>00877    <a class="code" href="res__odbc_8h.html#a78d14d1dd01c269c9c0a47b49475eeea" title="Releases an ODBC object previously allocated by odbc_request_obj().">ast_odbc_release_obj</a>(obj);
<a name="l00878"></a>00878    <span class="keywordflow">return</span> cfg;
<a name="l00879"></a>00879 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac6e7f282a8bd52604b583b42e7db4488"></a><!-- doxytag: member="res_config_odbc.c::config_odbc_prepare" ref="ac6e7f282a8bd52604b583b42e7db4488" args="(struct odbc_obj *obj, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static SQLHSTMT config_odbc_prepare </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__odbc_8c_source.html#l00770">770</a> of file <a class="el" href="res__config__odbc_8c_source.html">res_config_odbc.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="res__config__odbc_8c_source.html#l00763">config_odbc_obj::cat_metric</a>, <a class="el" href="res__config__odbc_8c_source.html#l00764">config_odbc_obj::category</a>, <a class="el" href="res__odbc_8h_source.html#l00047">odbc_obj::con</a>, <a class="el" href="res__config__odbc_8c_source.html#l00767">config_odbc_obj::err</a>, <a class="el" href="res__config__odbc_8c_source.html#l00762">config_odbc_obj::sql</a>, <a class="el" href="res__config__odbc_8c_source.html#l00765">config_odbc_obj::var_name</a>, and <a class="el" href="res__config__odbc_8c_source.html#l00766">config_odbc_obj::var_val</a>.</p>

<p>Referenced by <a class="el" href="res__config__odbc_8c_source.html#l00797">config_odbc()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00771"></a>00771 {
<a name="l00772"></a>00772    <span class="keyword">struct </span><a class="code" href="structconfig__odbc__obj.html">config_odbc_obj</a> *q = data;
<a name="l00773"></a>00773    SQLHSTMT sth;
<a name="l00774"></a>00774    <span class="keywordtype">int</span> res;
<a name="l00775"></a>00775 
<a name="l00776"></a>00776    res = SQLAllocHandle(SQL_HANDLE_STMT, obj-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>, &amp;sth);
<a name="l00777"></a>00777    <span class="keywordflow">if</span> ((res != SQL_SUCCESS) &amp;&amp; (res != SQL_SUCCESS_WITH_INFO)) {
<a name="l00778"></a>00778       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(4, <span class="stringliteral">&quot;Failure in AllocStatement %d\n&quot;</span>, res);
<a name="l00779"></a>00779       <span class="keywordflow">return</span> NULL;
<a name="l00780"></a>00780    }
<a name="l00781"></a>00781 
<a name="l00782"></a>00782    res = SQLPrepare(sth, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)q-&gt;<a class="code" href="structconfig__odbc__obj.html#aa29adf0df91c751c5cae685ca18a251f">sql</a>, SQL_NTS);
<a name="l00783"></a>00783    <span class="keywordflow">if</span> ((res != SQL_SUCCESS) &amp;&amp; (res != SQL_SUCCESS_WITH_INFO)) {
<a name="l00784"></a>00784       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(4, <span class="stringliteral">&quot;Error in PREPARE %d\n&quot;</span>, res);
<a name="l00785"></a>00785       SQLFreeHandle(SQL_HANDLE_STMT, sth);
<a name="l00786"></a>00786       <span class="keywordflow">return</span> NULL;
<a name="l00787"></a>00787    }
<a name="l00788"></a>00788 
<a name="l00789"></a>00789    SQLBindCol(sth, 1, SQL_C_ULONG, &amp;q-&gt;<a class="code" href="structconfig__odbc__obj.html#ab6bb5904c99ac1f6e8d0c5c01906bcee">cat_metric</a>, <span class="keyword">sizeof</span>(q-&gt;<a class="code" href="structconfig__odbc__obj.html#ab6bb5904c99ac1f6e8d0c5c01906bcee">cat_metric</a>), &amp;q-&gt;<a class="code" href="structconfig__odbc__obj.html#ae0939ba7a2bc12cb6133bdc725042d53">err</a>);
<a name="l00790"></a>00790    SQLBindCol(sth, 2, SQL_C_CHAR, q-&gt;<a class="code" href="structconfig__odbc__obj.html#ac8e3112aeb70e89066f72305634d9f27">category</a>, <span class="keyword">sizeof</span>(q-&gt;<a class="code" href="structconfig__odbc__obj.html#ac8e3112aeb70e89066f72305634d9f27">category</a>), &amp;q-&gt;<a class="code" href="structconfig__odbc__obj.html#ae0939ba7a2bc12cb6133bdc725042d53">err</a>);
<a name="l00791"></a>00791    SQLBindCol(sth, 3, SQL_C_CHAR, q-&gt;<a class="code" href="structconfig__odbc__obj.html#a22ce82b4fe59529e6991e574277c993c">var_name</a>, <span class="keyword">sizeof</span>(q-&gt;<a class="code" href="structconfig__odbc__obj.html#a22ce82b4fe59529e6991e574277c993c">var_name</a>), &amp;q-&gt;<a class="code" href="structconfig__odbc__obj.html#ae0939ba7a2bc12cb6133bdc725042d53">err</a>);
<a name="l00792"></a>00792    SQLBindCol(sth, 4, SQL_C_CHAR, q-&gt;<a class="code" href="structconfig__odbc__obj.html#a30ad1f7060b5618fbce15e07f7959be5">var_val</a>, <span class="keyword">sizeof</span>(q-&gt;<a class="code" href="structconfig__odbc__obj.html#a30ad1f7060b5618fbce15e07f7959be5">var_val</a>), &amp;q-&gt;<a class="code" href="structconfig__odbc__obj.html#ae0939ba7a2bc12cb6133bdc725042d53">err</a>);
<a name="l00793"></a>00793 
<a name="l00794"></a>00794    <span class="keywordflow">return</span> sth;
<a name="l00795"></a>00795 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9fb0770b5d483240183affa19304b681"></a><!-- doxytag: member="res_config_odbc.c::custom_prepare" ref="a9fb0770b5d483240183affa19304b681" args="(struct odbc_obj *obj, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static SQLHSTMT custom_prepare </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__odbc_8c_source.html#l00057">57</a> of file <a class="el" href="res__config__odbc_8c_source.html">res_config_odbc.c</a>.</p>

<p>References <a class="el" href="res__config__odbc_8c_source.html#l00053">custom_prepare_struct::ap</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="res__odbc_8h_source.html#l00047">odbc_obj::con</a>, <a class="el" href="res__config__odbc_8c_source.html#l00052">custom_prepare_struct::extra</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="res__config__odbc_8c_source.html#l00054">custom_prepare_struct::skip</a>, and <a class="el" href="res__config__odbc_8c_source.html#l00051">custom_prepare_struct::sql</a>.</p>

<p>Referenced by <a class="el" href="res__config__odbc_8c_source.html#l00709">destroy_odbc()</a>, <a class="el" href="res__config__odbc_8c_source.html#l00256">realtime_multi_odbc()</a>, <a class="el" href="res__config__odbc_8c_source.html#l00111">realtime_odbc()</a>, <a class="el" href="res__config__odbc_8c_source.html#l00633">store_odbc()</a>, and <a class="el" href="res__config__odbc_8c_source.html#l00404">update_odbc()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00058"></a>00058 {
<a name="l00059"></a>00059    <span class="keywordtype">int</span> res, x = 1, count = 0;
<a name="l00060"></a>00060    <span class="keyword">struct </span><a class="code" href="structcustom__prepare__struct.html">custom_prepare_struct</a> *cps = data;
<a name="l00061"></a>00061    <span class="keyword">const</span> <span class="keywordtype">char</span> *newparam, *newval;
<a name="l00062"></a>00062    SQLHSTMT stmt;
<a name="l00063"></a>00063    va_list <a class="code" href="structcustom__prepare__struct.html#aba0d2a7f015cf887da8af71f5014280b">ap</a>;
<a name="l00064"></a>00064 
<a name="l00065"></a>00065    va_copy(ap, cps-&gt;<a class="code" href="structcustom__prepare__struct.html#aba0d2a7f015cf887da8af71f5014280b">ap</a>);
<a name="l00066"></a>00066 
<a name="l00067"></a>00067    res = SQLAllocHandle(SQL_HANDLE_STMT, obj-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>, &amp;stmt);
<a name="l00068"></a>00068    <span class="keywordflow">if</span> ((res != SQL_SUCCESS) &amp;&amp; (res != SQL_SUCCESS_WITH_INFO)) {
<a name="l00069"></a>00069       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;SQL Alloc Handle failed!\n&quot;</span>);
<a name="l00070"></a>00070       <span class="keywordflow">return</span> NULL;
<a name="l00071"></a>00071    }
<a name="l00072"></a>00072 
<a name="l00073"></a>00073    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Skip: %lld; SQL: %s\n&quot;</span>, cps-&gt;<a class="code" href="structcustom__prepare__struct.html#a6ee44de20e6dfc70683517f91ecbc053">skip</a>, cps-&gt;<a class="code" href="structcustom__prepare__struct.html#aecb2dd0da01a12f0e48213d6d9f3c5af">sql</a>);
<a name="l00074"></a>00074 
<a name="l00075"></a>00075    res = SQLPrepare(stmt, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)cps-&gt;<a class="code" href="structcustom__prepare__struct.html#aecb2dd0da01a12f0e48213d6d9f3c5af">sql</a>, SQL_NTS);
<a name="l00076"></a>00076    <span class="keywordflow">if</span> ((res != SQL_SUCCESS) &amp;&amp; (res != SQL_SUCCESS_WITH_INFO)) {
<a name="l00077"></a>00077       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;SQL Prepare failed![%s]\n&quot;</span>, cps-&gt;<a class="code" href="structcustom__prepare__struct.html#aecb2dd0da01a12f0e48213d6d9f3c5af">sql</a>);
<a name="l00078"></a>00078       SQLFreeHandle (SQL_HANDLE_STMT, stmt);
<a name="l00079"></a>00079       <span class="keywordflow">return</span> NULL;
<a name="l00080"></a>00080    }
<a name="l00081"></a>00081 
<a name="l00082"></a>00082    <span class="keywordflow">while</span> ((newparam = va_arg(ap, <span class="keyword">const</span> <span class="keywordtype">char</span> *))) {
<a name="l00083"></a>00083       newval = va_arg(ap, <span class="keyword">const</span> <span class="keywordtype">char</span> *);
<a name="l00084"></a>00084       <span class="keywordflow">if</span> ((1LL &lt;&lt; count++) &amp; cps-&gt;<a class="code" href="structcustom__prepare__struct.html#a6ee44de20e6dfc70683517f91ecbc053">skip</a>) {
<a name="l00085"></a>00085          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Skipping field &apos;%s&apos;=&apos;%s&apos; (%llo/%llo)\n&quot;</span>, newparam, newval, 1LL &lt;&lt; (count - 1), cps-&gt;<a class="code" href="structcustom__prepare__struct.html#a6ee44de20e6dfc70683517f91ecbc053">skip</a>);
<a name="l00086"></a>00086          <span class="keywordflow">continue</span>;
<a name="l00087"></a>00087       }
<a name="l00088"></a>00088       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Parameter %d (&apos;%s&apos;) = &apos;%s&apos;\n&quot;</span>, x, newparam, newval);
<a name="l00089"></a>00089       SQLBindParameter(stmt, x++, SQL_PARAM_INPUT, SQL_C_CHAR, SQL_CHAR, strlen(newval), 0, (<span class="keywordtype">void</span> *)newval, 0, NULL);
<a name="l00090"></a>00090    }
<a name="l00091"></a>00091    va_end(ap);
<a name="l00092"></a>00092 
<a name="l00093"></a>00093    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(cps-&gt;<a class="code" href="structcustom__prepare__struct.html#a270601ef08727b13b7b159b0a9dcc18b">extra</a>))
<a name="l00094"></a>00094       SQLBindParameter(stmt, x++, SQL_PARAM_INPUT, SQL_C_CHAR, SQL_CHAR, strlen(cps-&gt;<a class="code" href="structcustom__prepare__struct.html#a270601ef08727b13b7b159b0a9dcc18b">extra</a>), 0, (<span class="keywordtype">void</span> *)cps-&gt;<a class="code" href="structcustom__prepare__struct.html#a270601ef08727b13b7b159b0a9dcc18b">extra</a>, 0, NULL);
<a name="l00095"></a>00095    <span class="keywordflow">return</span> stmt;
<a name="l00096"></a>00096 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="affad90b515d1b3993b1582518f6ed883"></a><!-- doxytag: member="res_config_odbc.c::destroy_odbc" ref="affad90b515d1b3993b1582518f6ed883" args="(const char *database, const char *table, const char *keyfield, const char *lookup, va_list ap)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int destroy_odbc </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>database</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>keyfield</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>lookup</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">va_list&nbsp;</td>
          <td class="paramname"> <em>ap</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Excute an DELETE query. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>database</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>table</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>keyfield</em>&nbsp;</td><td>where clause field </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>lookup</em>&nbsp;</td><td>value of field for where clause </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ap</em>&nbsp;</td><td>list containing one or more field/value set(s)</td></tr>
  </table>
  </dd>
</dl>
<p>Delete a row from a database table, prepare the sql statement using keyfield and lookup control the <a class="el" href="structnumber.html" title="Number structure.">number</a> of records to change. Additional params to match rows are stored in ap list. Sub-in the <a class="el" href="structvalues.html">values</a> to the prepared statement and execute it.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structnumber.html" title="Number structure.">number</a></em>&nbsp;</td><td>of rows affected </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="res__config__odbc_8c_source.html#l00709">709</a> of file <a class="el" href="res__config__odbc_8c_source.html">res_config_odbc.c</a>.</p>

<p>References <a class="el" href="res__config__odbc_8c_source.html#l00053">custom_prepare_struct::ap</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="res__odbc_8c_source.html#l00593">ast_odbc_prepare_and_execute()</a>, <a class="el" href="res__odbc_8c_source.html#l01041">ast_odbc_release_obj()</a>, <a class="el" href="res__odbc_8c_source.html#l01331">ast_odbc_request_obj()</a>, <a class="el" href="res__config__odbc_8c_source.html#l00057">custom_prepare()</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, and <a class="el" href="res__config__odbc_8c_source.html#l00051">custom_prepare_struct::sql</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00710"></a>00710 {
<a name="l00711"></a>00711    <span class="keyword">struct </span><a class="code" href="structodbc__obj.html" title="ODBC container.">odbc_obj</a> *obj;
<a name="l00712"></a>00712    SQLHSTMT stmt;
<a name="l00713"></a>00713    <span class="keywordtype">char</span> sql[256];
<a name="l00714"></a>00714    SQLLEN rowcount=0;
<a name="l00715"></a>00715    <span class="keyword">const</span> <span class="keywordtype">char</span> *newparam, *newval;
<a name="l00716"></a>00716    <span class="keywordtype">int</span> res;
<a name="l00717"></a>00717    va_list aq;
<a name="l00718"></a>00718    <span class="keyword">struct </span><a class="code" href="structcustom__prepare__struct.html">custom_prepare_struct</a> cps = { .sql = sql, .extra = lookup };
<a name="l00719"></a>00719 
<a name="l00720"></a>00720    va_copy(cps.<a class="code" href="structcustom__prepare__struct.html#aba0d2a7f015cf887da8af71f5014280b">ap</a>, <a class="code" href="structcustom__prepare__struct.html#aba0d2a7f015cf887da8af71f5014280b">ap</a>);
<a name="l00721"></a>00721    va_copy(aq, <a class="code" href="structcustom__prepare__struct.html#aba0d2a7f015cf887da8af71f5014280b">ap</a>);
<a name="l00722"></a>00722    
<a name="l00723"></a>00723    <span class="keywordflow">if</span> (!<a class="code" href="cdr__odbc_8c.html#a68d1e6e752f2cf81551fac543cae108a">table</a>)
<a name="l00724"></a>00724       <span class="keywordflow">return</span> -1;
<a name="l00725"></a>00725 
<a name="l00726"></a>00726    obj = <a class="code" href="res__odbc_8h.html#ad34ae2bdba165ef6c7405afc94f2a7f3">ast_odbc_request_obj</a>(database, 0);
<a name="l00727"></a>00727    <span class="keywordflow">if</span> (!obj)
<a name="l00728"></a>00728       <span class="keywordflow">return</span> -1;
<a name="l00729"></a>00729 
<a name="l00730"></a>00730    snprintf(sql, <span class="keyword">sizeof</span>(sql), <span class="stringliteral">&quot;DELETE FROM %s WHERE &quot;</span>, <a class="code" href="cdr__odbc_8c.html#a68d1e6e752f2cf81551fac543cae108a">table</a>);
<a name="l00731"></a>00731    <span class="keywordflow">while</span>((newparam = va_arg(aq, <span class="keyword">const</span> <span class="keywordtype">char</span> *))) {
<a name="l00732"></a>00732       snprintf(sql + strlen(sql), <span class="keyword">sizeof</span>(sql) - strlen(sql), <span class="stringliteral">&quot;%s=? AND &quot;</span>, newparam);
<a name="l00733"></a>00733       newval = va_arg(aq, <span class="keyword">const</span> <span class="keywordtype">char</span> *);
<a name="l00734"></a>00734    }
<a name="l00735"></a>00735    va_end(aq);
<a name="l00736"></a>00736    snprintf(sql + strlen(sql), <span class="keyword">sizeof</span>(sql) - strlen(sql), <span class="stringliteral">&quot;%s=?&quot;</span>, keyfield);
<a name="l00737"></a>00737 
<a name="l00738"></a>00738    stmt = <a class="code" href="res__odbc_8h.html#ad1e82a2b1ba4eda1924d8b8f591de065" title="Prepares, executes, and returns the resulting statement handle.">ast_odbc_prepare_and_execute</a>(obj, <a class="code" href="res__config__odbc_8c.html#a9fb0770b5d483240183affa19304b681">custom_prepare</a>, &amp;cps);
<a name="l00739"></a>00739 
<a name="l00740"></a>00740    <span class="keywordflow">if</span> (!stmt) {
<a name="l00741"></a>00741       <a class="code" href="res__odbc_8h.html#a78d14d1dd01c269c9c0a47b49475eeea" title="Releases an ODBC object previously allocated by odbc_request_obj().">ast_odbc_release_obj</a>(obj);
<a name="l00742"></a>00742       <span class="keywordflow">return</span> -1;
<a name="l00743"></a>00743    }
<a name="l00744"></a>00744 
<a name="l00745"></a>00745    res = SQLRowCount(stmt, &amp;rowcount);
<a name="l00746"></a>00746    SQLFreeHandle (SQL_HANDLE_STMT, stmt);
<a name="l00747"></a>00747    <a class="code" href="res__odbc_8h.html#a78d14d1dd01c269c9c0a47b49475eeea" title="Releases an ODBC object previously allocated by odbc_request_obj().">ast_odbc_release_obj</a>(obj);
<a name="l00748"></a>00748 
<a name="l00749"></a>00749    <span class="keywordflow">if</span> ((res != SQL_SUCCESS) &amp;&amp; (res != SQL_SUCCESS_WITH_INFO)) {
<a name="l00750"></a>00750       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;SQL Row Count error!\n[%s]\n\n&quot;</span>, sql);
<a name="l00751"></a>00751       <span class="keywordflow">return</span> -1;
<a name="l00752"></a>00752    }
<a name="l00753"></a>00753 
<a name="l00754"></a>00754    <span class="keywordflow">if</span> (rowcount &gt;= 0)
<a name="l00755"></a>00755       <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)rowcount;
<a name="l00756"></a>00756 
<a name="l00757"></a>00757    <span class="keywordflow">return</span> -1;
<a name="l00758"></a>00758 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac3382bf6da54c56b37069bd76bbdf4f9"></a><!-- doxytag: member="res_config_odbc.c::load_module" ref="ac3382bf6da54c56b37069bd76bbdf4f9" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int load_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__odbc_8c_source.html#l01063">1063</a> of file <a class="el" href="res__config__odbc_8c_source.html">res_config_odbc.c</a>.</p>

<p>References <a class="el" href="config_8c_source.html#l01950">ast_config_engine_register()</a>, and <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01064"></a>01064 {
<a name="l01065"></a>01065    <a class="code" href="config_8h.html#af15c271e1708b251fc938b30baba18f1" title="Register config engine.">ast_config_engine_register</a>(&amp;<a class="code" href="res__config__odbc_8c.html#a0db7ee1d52bac64062bb76ed957432bb">odbc_engine</a>);
<a name="l01066"></a>01066    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;res_config_odbc loaded.\n&quot;</span>);
<a name="l01067"></a>01067    <span class="keywordflow">return</span> 0;
<a name="l01068"></a>01068 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a39bc8a97c5e98573ea3d5d266c17ce8a"></a><!-- doxytag: member="res_config_odbc.c::realtime_multi_odbc" ref="a39bc8a97c5e98573ea3d5d266c17ce8a" args="(const char *database, const char *table, va_list ap)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__config.html">ast_config</a>* realtime_multi_odbc </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>database</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">va_list&nbsp;</td>
          <td class="paramname"> <em>ap</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Excute an Select query and return <a class="el" href="structast__config.html">ast_config</a> list. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>database</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>table</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ap</em>&nbsp;</td><td>list containing one or more field/operator/value set.</td></tr>
  </table>
  </dd>
</dl>
<p>Select database and preform query on table, prepare the sql statement Sub-in the <a class="el" href="structvalues.html">values</a> to the prepared statement and execute it. Execute this prepared query against several ODBC connected databases. Return results as an <a class="el" href="structast__config.html">ast_config</a> variable.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>var</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>NULL</em>&nbsp;</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="res__config__odbc_8c_source.html#l00256">256</a> of file <a class="el" href="res__config__odbc_8c_source.html">res_config_odbc.c</a>.</p>

<p>References <a class="el" href="res__config__odbc_8c_source.html#l00053">custom_prepare_struct::ap</a>, <a class="el" href="config_8c_source.html#l00522">ast_category_append()</a>, <a class="el" href="config_8c_source.html#l00561">ast_category_destroy()</a>, <a class="el" href="config_8c_source.html#l00483">ast_category_new()</a>, <a class="el" href="config_8c_source.html#l00656">ast_category_rename()</a>, <a class="el" href="config_8c_source.html#l00673">ast_config_new()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="res__odbc_8c_source.html#l01047">ast_odbc_backslash_is_escape()</a>, <a class="el" href="res__odbc_8c_source.html#l00593">ast_odbc_prepare_and_execute()</a>, <a class="el" href="res__odbc_8c_source.html#l01041">ast_odbc_release_obj()</a>, <a class="el" href="res__odbc_8c_source.html#l01331">ast_odbc_request_obj()</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="strings_8h_source.html#l00150">ast_strip()</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="config_8c_source.html#l00348">ast_variable_append()</a>, <a class="el" href="config_8c_source.html#l00223">ast_variable_new()</a>, <a class="el" href="res__config__odbc_8c_source.html#l00057">custom_prepare()</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="res__config__odbc_8c_source.html#l00051">custom_prepare_struct::sql</a>, <a class="el" href="agi_2strcompat_8c_source.html#l00093">strcasestr()</a>, <a class="el" href="agi_2strcompat_8c_source.html#l00027">strsep()</a>, and <a class="el" href="ast__expr2f_8c_source.html#l00613">var</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00257"></a>00257 {
<a name="l00258"></a>00258    <span class="keyword">struct </span><a class="code" href="structodbc__obj.html" title="ODBC container.">odbc_obj</a> *obj;
<a name="l00259"></a>00259    SQLHSTMT stmt;
<a name="l00260"></a>00260    <span class="keywordtype">char</span> sql[1024];
<a name="l00261"></a>00261    <span class="keywordtype">char</span> coltitle[256];
<a name="l00262"></a>00262    <span class="keywordtype">char</span> rowdata[2048];
<a name="l00263"></a>00263    <span class="keyword">const</span> <span class="keywordtype">char</span> *initfield=NULL;
<a name="l00264"></a>00264    <span class="keywordtype">char</span> *op;
<a name="l00265"></a>00265    <span class="keyword">const</span> <span class="keywordtype">char</span> *newparam, *newval;
<a name="l00266"></a>00266    <span class="keywordtype">char</span> *stringp;
<a name="l00267"></a>00267    <span class="keywordtype">char</span> *chunk;
<a name="l00268"></a>00268    SQLSMALLINT collen;
<a name="l00269"></a>00269    <span class="keywordtype">int</span> res;
<a name="l00270"></a>00270    <span class="keywordtype">int</span> x;
<a name="l00271"></a>00271    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>=NULL;
<a name="l00272"></a>00272    <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *cfg=NULL;
<a name="l00273"></a>00273    <span class="keyword">struct </span><a class="code" href="structast__category.html">ast_category</a> *cat=NULL;
<a name="l00274"></a>00274    SQLULEN colsize;
<a name="l00275"></a>00275    SQLSMALLINT colcount=0;
<a name="l00276"></a>00276    SQLSMALLINT datatype;
<a name="l00277"></a>00277    SQLSMALLINT decimaldigits;
<a name="l00278"></a>00278    SQLSMALLINT nullable;
<a name="l00279"></a>00279    SQLLEN indicator;
<a name="l00280"></a>00280    <span class="keyword">struct </span><a class="code" href="structcustom__prepare__struct.html">custom_prepare_struct</a> cps = { .sql = sql };
<a name="l00281"></a>00281    va_list aq;
<a name="l00282"></a>00282 
<a name="l00283"></a>00283    va_copy(cps.<a class="code" href="structcustom__prepare__struct.html#aba0d2a7f015cf887da8af71f5014280b">ap</a>, <a class="code" href="structcustom__prepare__struct.html#aba0d2a7f015cf887da8af71f5014280b">ap</a>);
<a name="l00284"></a>00284    va_copy(aq, <a class="code" href="structcustom__prepare__struct.html#aba0d2a7f015cf887da8af71f5014280b">ap</a>);
<a name="l00285"></a>00285 
<a name="l00286"></a>00286    <span class="keywordflow">if</span> (!<a class="code" href="cdr__odbc_8c.html#a68d1e6e752f2cf81551fac543cae108a">table</a>)
<a name="l00287"></a>00287       <span class="keywordflow">return</span> NULL;
<a name="l00288"></a>00288 
<a name="l00289"></a>00289    obj = <a class="code" href="res__odbc_8h.html#ad34ae2bdba165ef6c7405afc94f2a7f3">ast_odbc_request_obj</a>(database, 0);
<a name="l00290"></a>00290    <span class="keywordflow">if</span> (!obj)
<a name="l00291"></a>00291       <span class="keywordflow">return</span> NULL;
<a name="l00292"></a>00292 
<a name="l00293"></a>00293    newparam = va_arg(aq, <span class="keyword">const</span> <span class="keywordtype">char</span> *);
<a name="l00294"></a>00294    <span class="keywordflow">if</span> (!newparam)  {
<a name="l00295"></a>00295       <a class="code" href="res__odbc_8h.html#a78d14d1dd01c269c9c0a47b49475eeea" title="Releases an ODBC object previously allocated by odbc_request_obj().">ast_odbc_release_obj</a>(obj);
<a name="l00296"></a>00296       <span class="keywordflow">return</span> NULL;
<a name="l00297"></a>00297    }
<a name="l00298"></a>00298    initfield = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(newparam);
<a name="l00299"></a>00299    <span class="keywordflow">if</span> ((op = strchr(initfield, <span class="charliteral">&apos; &apos;</span>))) 
<a name="l00300"></a>00300       *op = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00301"></a>00301    newval = va_arg(aq, <span class="keyword">const</span> <span class="keywordtype">char</span> *);
<a name="l00302"></a>00302    op = !strchr(newparam, <span class="charliteral">&apos; &apos;</span>) ? <span class="stringliteral">&quot; =&quot;</span> : <span class="stringliteral">&quot;&quot;</span>;
<a name="l00303"></a>00303    snprintf(sql, <span class="keyword">sizeof</span>(sql), <span class="stringliteral">&quot;SELECT * FROM %s WHERE %s%s ?%s&quot;</span>, <a class="code" href="cdr__odbc_8c.html#a68d1e6e752f2cf81551fac543cae108a">table</a>, newparam, op,
<a name="l00304"></a>00304       <a class="code" href="agi_2strcompat_8c.html#ae9229017a4501f8d6a637b4498cfed2e">strcasestr</a>(newparam, <span class="stringliteral">&quot;LIKE&quot;</span>) &amp;&amp; !<a class="code" href="res__odbc_8h.html#a9fb64cb1a2fcc8c4f627fba961f84a4e" title="Checks if the database natively supports backslash as an escape character.">ast_odbc_backslash_is_escape</a>(obj) ? <span class="stringliteral">&quot; ESCAPE &apos;\\&apos;&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l00305"></a>00305    <span class="keywordflow">while</span>((newparam = va_arg(aq, <span class="keyword">const</span> <span class="keywordtype">char</span> *))) {
<a name="l00306"></a>00306       op = !strchr(newparam, <span class="charliteral">&apos; &apos;</span>) ? <span class="stringliteral">&quot; =&quot;</span> : <span class="stringliteral">&quot;&quot;</span>;
<a name="l00307"></a>00307       snprintf(sql + strlen(sql), <span class="keyword">sizeof</span>(sql) - strlen(sql), <span class="stringliteral">&quot; AND %s%s ?%s&quot;</span>, newparam, op,
<a name="l00308"></a>00308          <a class="code" href="agi_2strcompat_8c.html#ae9229017a4501f8d6a637b4498cfed2e">strcasestr</a>(newparam, <span class="stringliteral">&quot;LIKE&quot;</span>) &amp;&amp; !<a class="code" href="res__odbc_8h.html#a9fb64cb1a2fcc8c4f627fba961f84a4e" title="Checks if the database natively supports backslash as an escape character.">ast_odbc_backslash_is_escape</a>(obj) ? <span class="stringliteral">&quot; ESCAPE &apos;\\&apos;&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l00309"></a>00309       newval = va_arg(aq, <span class="keyword">const</span> <span class="keywordtype">char</span> *);
<a name="l00310"></a>00310    }
<a name="l00311"></a>00311    <span class="keywordflow">if</span> (initfield)
<a name="l00312"></a>00312       snprintf(sql + strlen(sql), <span class="keyword">sizeof</span>(sql) - strlen(sql), <span class="stringliteral">&quot; ORDER BY %s&quot;</span>, initfield);
<a name="l00313"></a>00313    va_end(aq);
<a name="l00314"></a>00314 
<a name="l00315"></a>00315    stmt = <a class="code" href="res__odbc_8h.html#ad1e82a2b1ba4eda1924d8b8f591de065" title="Prepares, executes, and returns the resulting statement handle.">ast_odbc_prepare_and_execute</a>(obj, <a class="code" href="res__config__odbc_8c.html#a9fb0770b5d483240183affa19304b681">custom_prepare</a>, &amp;cps);
<a name="l00316"></a>00316 
<a name="l00317"></a>00317    <span class="keywordflow">if</span> (!stmt) {
<a name="l00318"></a>00318       <a class="code" href="res__odbc_8h.html#a78d14d1dd01c269c9c0a47b49475eeea" title="Releases an ODBC object previously allocated by odbc_request_obj().">ast_odbc_release_obj</a>(obj);
<a name="l00319"></a>00319       <span class="keywordflow">return</span> NULL;
<a name="l00320"></a>00320    }
<a name="l00321"></a>00321 
<a name="l00322"></a>00322    res = SQLNumResultCols(stmt, &amp;colcount);
<a name="l00323"></a>00323    <span class="keywordflow">if</span> ((res != SQL_SUCCESS) &amp;&amp; (res != SQL_SUCCESS_WITH_INFO)) {
<a name="l00324"></a>00324       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;SQL Column Count error!\n[%s]\n\n&quot;</span>, sql);
<a name="l00325"></a>00325       SQLFreeHandle(SQL_HANDLE_STMT, stmt);
<a name="l00326"></a>00326       <a class="code" href="res__odbc_8h.html#a78d14d1dd01c269c9c0a47b49475eeea" title="Releases an ODBC object previously allocated by odbc_request_obj().">ast_odbc_release_obj</a>(obj);
<a name="l00327"></a>00327       <span class="keywordflow">return</span> NULL;
<a name="l00328"></a>00328    }
<a name="l00329"></a>00329 
<a name="l00330"></a>00330    cfg = <a class="code" href="config_8h.html#a45e1a284d7d84c4b4a316764fbb887fb" title="Create a new base configuration structure.">ast_config_new</a>();
<a name="l00331"></a>00331    <span class="keywordflow">if</span> (!cfg) {
<a name="l00332"></a>00332       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Out of memory!\n&quot;</span>);
<a name="l00333"></a>00333       SQLFreeHandle(SQL_HANDLE_STMT, stmt);
<a name="l00334"></a>00334       <a class="code" href="res__odbc_8h.html#a78d14d1dd01c269c9c0a47b49475eeea" title="Releases an ODBC object previously allocated by odbc_request_obj().">ast_odbc_release_obj</a>(obj);
<a name="l00335"></a>00335       <span class="keywordflow">return</span> NULL;
<a name="l00336"></a>00336    }
<a name="l00337"></a>00337 
<a name="l00338"></a>00338    <span class="keywordflow">while</span> ((res=SQLFetch(stmt)) != SQL_NO_DATA) {
<a name="l00339"></a>00339       var = NULL;
<a name="l00340"></a>00340       <span class="keywordflow">if</span> ((res != SQL_SUCCESS) &amp;&amp; (res != SQL_SUCCESS_WITH_INFO)) {
<a name="l00341"></a>00341          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;SQL Fetch error!\n[%s]\n\n&quot;</span>, sql);
<a name="l00342"></a>00342          <span class="keywordflow">continue</span>;
<a name="l00343"></a>00343       }
<a name="l00344"></a>00344       cat = <a class="code" href="config_8h.html#affebac76d69639677b677037d9871e29" title="Create a category structure.">ast_category_new</a>(<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;&quot;</span>,99999);
<a name="l00345"></a>00345       <span class="keywordflow">if</span> (!cat) {
<a name="l00346"></a>00346          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Out of memory!\n&quot;</span>);
<a name="l00347"></a>00347          <span class="keywordflow">continue</span>;
<a name="l00348"></a>00348       }
<a name="l00349"></a>00349       <span class="keywordflow">for</span> (x=0;x&lt;colcount;x++) {
<a name="l00350"></a>00350          rowdata[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00351"></a>00351          collen = <span class="keyword">sizeof</span>(coltitle);
<a name="l00352"></a>00352          res = SQLDescribeCol(stmt, x + 1, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)coltitle, <span class="keyword">sizeof</span>(coltitle), &amp;collen, 
<a name="l00353"></a>00353                   &amp;datatype, &amp;colsize, &amp;decimaldigits, &amp;nullable);
<a name="l00354"></a>00354          <span class="keywordflow">if</span> ((res != SQL_SUCCESS) &amp;&amp; (res != SQL_SUCCESS_WITH_INFO)) {
<a name="l00355"></a>00355             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;SQL Describe Column error!\n[%s]\n\n&quot;</span>, sql);
<a name="l00356"></a>00356             <a class="code" href="config_8h.html#abd17f201d0e7c31c124dc0cd3a0d073b">ast_category_destroy</a>(cat);
<a name="l00357"></a>00357             <span class="keywordflow">continue</span>;
<a name="l00358"></a>00358          }
<a name="l00359"></a>00359 
<a name="l00360"></a>00360          indicator = 0;
<a name="l00361"></a>00361          res = SQLGetData(stmt, x + 1, SQL_CHAR, rowdata, <span class="keyword">sizeof</span>(rowdata), &amp;indicator);
<a name="l00362"></a>00362          <span class="keywordflow">if</span> (indicator == SQL_NULL_DATA)
<a name="l00363"></a>00363             <span class="keywordflow">continue</span>;
<a name="l00364"></a>00364 
<a name="l00365"></a>00365          <span class="keywordflow">if</span> ((res != SQL_SUCCESS) &amp;&amp; (res != SQL_SUCCESS_WITH_INFO)) {
<a name="l00366"></a>00366             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;SQL Get Data error!\n[%s]\n\n&quot;</span>, sql);
<a name="l00367"></a>00367             <a class="code" href="config_8h.html#abd17f201d0e7c31c124dc0cd3a0d073b">ast_category_destroy</a>(cat);
<a name="l00368"></a>00368             <span class="keywordflow">continue</span>;
<a name="l00369"></a>00369          }
<a name="l00370"></a>00370          stringp = rowdata;
<a name="l00371"></a>00371          <span class="keywordflow">while</span>(stringp) {
<a name="l00372"></a>00372             chunk = <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;stringp, <span class="stringliteral">&quot;;&quot;</span>);
<a name="l00373"></a>00373             <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="strings_8h.html#aeb1c54e6e100c63176d8e22b0d5ca865" title="Strip leading/trailing whitespace from a string.">ast_strip</a>(chunk))) {
<a name="l00374"></a>00374                <span class="keywordflow">if</span> (initfield &amp;&amp; !strcmp(initfield, coltitle))
<a name="l00375"></a>00375                   <a class="code" href="config_8h.html#a2a5612ff8eb3595c1be1df75be4d870f">ast_category_rename</a>(cat, chunk);
<a name="l00376"></a>00376                var = <a class="code" href="config_8h.html#a08e94d96f459e7301a74daf32035423b">ast_variable_new</a>(coltitle, chunk, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00377"></a>00377                <a class="code" href="config_8h.html#a132ddbd39dd9d26395c410f7647f76db">ast_variable_append</a>(cat, var);
<a name="l00378"></a>00378             }
<a name="l00379"></a>00379          }
<a name="l00380"></a>00380       }
<a name="l00381"></a>00381       <a class="code" href="config_8h.html#ab7b56ec66b058952423f313752c734e7">ast_category_append</a>(cfg, cat);
<a name="l00382"></a>00382    }
<a name="l00383"></a>00383 
<a name="l00384"></a>00384    SQLFreeHandle(SQL_HANDLE_STMT, stmt);
<a name="l00385"></a>00385    <a class="code" href="res__odbc_8h.html#a78d14d1dd01c269c9c0a47b49475eeea" title="Releases an ODBC object previously allocated by odbc_request_obj().">ast_odbc_release_obj</a>(obj);
<a name="l00386"></a>00386    <span class="keywordflow">return</span> cfg;
<a name="l00387"></a>00387 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2416b8a4c2adace0ce96ca56ef73c017"></a><!-- doxytag: member="res_config_odbc.c::realtime_odbc" ref="a2416b8a4c2adace0ce96ca56ef73c017" args="(const char *database, const char *table, va_list ap)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__variable.html">ast_variable</a>* realtime_odbc </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>database</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">va_list&nbsp;</td>
          <td class="paramname"> <em>ap</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Excute an SQL query and return <a class="el" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> list. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>database</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>table</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ap</em>&nbsp;</td><td>list containing one or more field/operator/value set.</td></tr>
  </table>
  </dd>
</dl>
<p>Select database and preform query on table, prepare the sql statement Sub-in the <a class="el" href="structvalues.html">values</a> to the prepared statement and execute it. Return results as a <a class="el" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> list.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>var</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>NULL</em>&nbsp;</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="res__config__odbc_8c_source.html#l00111">111</a> of file <a class="el" href="res__config__odbc_8c_source.html">res_config_odbc.c</a>.</p>

<p>References <a class="el" href="res__config__odbc_8c_source.html#l00053">custom_prepare_struct::ap</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="res__odbc_8c_source.html#l01047">ast_odbc_backslash_is_escape()</a>, <a class="el" href="res__odbc_8c_source.html#l00593">ast_odbc_prepare_and_execute()</a>, <a class="el" href="res__odbc_8c_source.html#l01041">ast_odbc_release_obj()</a>, <a class="el" href="res__odbc_8c_source.html#l01331">ast_odbc_request_obj()</a>, <a class="el" href="strings_8h_source.html#l00150">ast_strip()</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="config_8c_source.html#l00223">ast_variable_new()</a>, <a class="el" href="config_8c_source.html#l00397">ast_variables_destroy()</a>, <a class="el" href="res__config__odbc_8c_source.html#l00057">custom_prepare()</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="res__config__odbc_8c_source.html#l00051">custom_prepare_struct::sql</a>, <a class="el" href="agi_2strcompat_8c_source.html#l00093">strcasestr()</a>, <a class="el" href="agi_2strcompat_8c_source.html#l00027">strsep()</a>, and <a class="el" href="ast__expr2f_8c_source.html#l00613">var</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00112"></a>00112 {
<a name="l00113"></a>00113    <span class="keyword">struct </span><a class="code" href="structodbc__obj.html" title="ODBC container.">odbc_obj</a> *obj;
<a name="l00114"></a>00114    SQLHSTMT stmt;
<a name="l00115"></a>00115    <span class="keywordtype">char</span> sql[1024];
<a name="l00116"></a>00116    <span class="keywordtype">char</span> coltitle[256];
<a name="l00117"></a>00117    <span class="keywordtype">char</span> rowdata[2048];
<a name="l00118"></a>00118    <span class="keywordtype">char</span> *op;
<a name="l00119"></a>00119    <span class="keyword">const</span> <span class="keywordtype">char</span> *newparam, *newval;
<a name="l00120"></a>00120    <span class="keywordtype">char</span> *stringp;
<a name="l00121"></a>00121    <span class="keywordtype">char</span> *chunk;
<a name="l00122"></a>00122    SQLSMALLINT collen;
<a name="l00123"></a>00123    <span class="keywordtype">int</span> res;
<a name="l00124"></a>00124    <span class="keywordtype">int</span> x;
<a name="l00125"></a>00125    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>=NULL, *prev=NULL;
<a name="l00126"></a>00126    SQLULEN colsize;
<a name="l00127"></a>00127    SQLSMALLINT colcount=0;
<a name="l00128"></a>00128    SQLSMALLINT datatype;
<a name="l00129"></a>00129    SQLSMALLINT decimaldigits;
<a name="l00130"></a>00130    SQLSMALLINT nullable;
<a name="l00131"></a>00131    SQLLEN indicator;
<a name="l00132"></a>00132    va_list aq;
<a name="l00133"></a>00133    <span class="keyword">struct </span><a class="code" href="structcustom__prepare__struct.html">custom_prepare_struct</a> cps = { .sql = sql };
<a name="l00134"></a>00134 
<a name="l00135"></a>00135    va_copy(cps.<a class="code" href="structcustom__prepare__struct.html#aba0d2a7f015cf887da8af71f5014280b">ap</a>, <a class="code" href="structcustom__prepare__struct.html#aba0d2a7f015cf887da8af71f5014280b">ap</a>);
<a name="l00136"></a>00136    va_copy(aq, <a class="code" href="structcustom__prepare__struct.html#aba0d2a7f015cf887da8af71f5014280b">ap</a>);
<a name="l00137"></a>00137 
<a name="l00138"></a>00138    <span class="keywordflow">if</span> (!<a class="code" href="cdr__odbc_8c.html#a68d1e6e752f2cf81551fac543cae108a">table</a>)
<a name="l00139"></a>00139       <span class="keywordflow">return</span> NULL;
<a name="l00140"></a>00140 
<a name="l00141"></a>00141    obj = <a class="code" href="res__odbc_8h.html#ad34ae2bdba165ef6c7405afc94f2a7f3">ast_odbc_request_obj</a>(database, 0);
<a name="l00142"></a>00142 
<a name="l00143"></a>00143    <span class="keywordflow">if</span> (!obj) {
<a name="l00144"></a>00144       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;No database handle available with the name of &apos;%s&apos; (check res_odbc.conf)\n&quot;</span>, database);
<a name="l00145"></a>00145       <span class="keywordflow">return</span> NULL;
<a name="l00146"></a>00146    }
<a name="l00147"></a>00147 
<a name="l00148"></a>00148    newparam = va_arg(aq, <span class="keyword">const</span> <span class="keywordtype">char</span> *);
<a name="l00149"></a>00149    <span class="keywordflow">if</span> (!newparam) {
<a name="l00150"></a>00150       <a class="code" href="res__odbc_8h.html#a78d14d1dd01c269c9c0a47b49475eeea" title="Releases an ODBC object previously allocated by odbc_request_obj().">ast_odbc_release_obj</a>(obj);
<a name="l00151"></a>00151       <span class="keywordflow">return</span> NULL;
<a name="l00152"></a>00152    }
<a name="l00153"></a>00153    newval = va_arg(aq, <span class="keyword">const</span> <span class="keywordtype">char</span> *);
<a name="l00154"></a>00154    op = !strchr(newparam, <span class="charliteral">&apos; &apos;</span>) ? <span class="stringliteral">&quot; =&quot;</span> : <span class="stringliteral">&quot;&quot;</span>;
<a name="l00155"></a>00155    snprintf(sql, <span class="keyword">sizeof</span>(sql), <span class="stringliteral">&quot;SELECT * FROM %s WHERE %s%s ?%s&quot;</span>, <a class="code" href="cdr__odbc_8c.html#a68d1e6e752f2cf81551fac543cae108a">table</a>, newparam, op,
<a name="l00156"></a>00156       <a class="code" href="agi_2strcompat_8c.html#ae9229017a4501f8d6a637b4498cfed2e">strcasestr</a>(newparam, <span class="stringliteral">&quot;LIKE&quot;</span>) &amp;&amp; !<a class="code" href="res__odbc_8h.html#a9fb64cb1a2fcc8c4f627fba961f84a4e" title="Checks if the database natively supports backslash as an escape character.">ast_odbc_backslash_is_escape</a>(obj) ? <span class="stringliteral">&quot; ESCAPE &apos;\\&apos;&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l00157"></a>00157    <span class="keywordflow">while</span>((newparam = va_arg(aq, <span class="keyword">const</span> <span class="keywordtype">char</span> *))) {
<a name="l00158"></a>00158       op = !strchr(newparam, <span class="charliteral">&apos; &apos;</span>) ? <span class="stringliteral">&quot; =&quot;</span> : <span class="stringliteral">&quot;&quot;</span>;
<a name="l00159"></a>00159       snprintf(sql + strlen(sql), <span class="keyword">sizeof</span>(sql) - strlen(sql), <span class="stringliteral">&quot; AND %s%s ?%s&quot;</span>, newparam, op,
<a name="l00160"></a>00160          <a class="code" href="agi_2strcompat_8c.html#ae9229017a4501f8d6a637b4498cfed2e">strcasestr</a>(newparam, <span class="stringliteral">&quot;LIKE&quot;</span>) &amp;&amp; !<a class="code" href="res__odbc_8h.html#a9fb64cb1a2fcc8c4f627fba961f84a4e" title="Checks if the database natively supports backslash as an escape character.">ast_odbc_backslash_is_escape</a>(obj) ? <span class="stringliteral">&quot; ESCAPE &apos;\\&apos;&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l00161"></a>00161       newval = va_arg(aq, <span class="keyword">const</span> <span class="keywordtype">char</span> *);
<a name="l00162"></a>00162    }
<a name="l00163"></a>00163    va_end(aq);
<a name="l00164"></a>00164 
<a name="l00165"></a>00165    stmt = <a class="code" href="res__odbc_8h.html#ad1e82a2b1ba4eda1924d8b8f591de065" title="Prepares, executes, and returns the resulting statement handle.">ast_odbc_prepare_and_execute</a>(obj, <a class="code" href="res__config__odbc_8c.html#a9fb0770b5d483240183affa19304b681">custom_prepare</a>, &amp;cps);
<a name="l00166"></a>00166 
<a name="l00167"></a>00167    <span class="keywordflow">if</span> (!stmt) {
<a name="l00168"></a>00168       <a class="code" href="res__odbc_8h.html#a78d14d1dd01c269c9c0a47b49475eeea" title="Releases an ODBC object previously allocated by odbc_request_obj().">ast_odbc_release_obj</a>(obj);
<a name="l00169"></a>00169       <span class="keywordflow">return</span> NULL;
<a name="l00170"></a>00170    }
<a name="l00171"></a>00171 
<a name="l00172"></a>00172    res = SQLNumResultCols(stmt, &amp;colcount);
<a name="l00173"></a>00173    <span class="keywordflow">if</span> ((res != SQL_SUCCESS) &amp;&amp; (res != SQL_SUCCESS_WITH_INFO)) {
<a name="l00174"></a>00174       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;SQL Column Count error!\n[%s]\n\n&quot;</span>, sql);
<a name="l00175"></a>00175       SQLFreeHandle (SQL_HANDLE_STMT, stmt);
<a name="l00176"></a>00176       <a class="code" href="res__odbc_8h.html#a78d14d1dd01c269c9c0a47b49475eeea" title="Releases an ODBC object previously allocated by odbc_request_obj().">ast_odbc_release_obj</a>(obj);
<a name="l00177"></a>00177       <span class="keywordflow">return</span> NULL;
<a name="l00178"></a>00178    }
<a name="l00179"></a>00179 
<a name="l00180"></a>00180    res = SQLFetch(stmt);
<a name="l00181"></a>00181    <span class="keywordflow">if</span> (res == SQL_NO_DATA) {
<a name="l00182"></a>00182       SQLFreeHandle (SQL_HANDLE_STMT, stmt);
<a name="l00183"></a>00183       <a class="code" href="res__odbc_8h.html#a78d14d1dd01c269c9c0a47b49475eeea" title="Releases an ODBC object previously allocated by odbc_request_obj().">ast_odbc_release_obj</a>(obj);
<a name="l00184"></a>00184       <span class="keywordflow">return</span> NULL;
<a name="l00185"></a>00185    }
<a name="l00186"></a>00186    <span class="keywordflow">if</span> ((res != SQL_SUCCESS) &amp;&amp; (res != SQL_SUCCESS_WITH_INFO)) {
<a name="l00187"></a>00187       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;SQL Fetch error!\n[%s]\n\n&quot;</span>, sql);
<a name="l00188"></a>00188       SQLFreeHandle (SQL_HANDLE_STMT, stmt);
<a name="l00189"></a>00189       <a class="code" href="res__odbc_8h.html#a78d14d1dd01c269c9c0a47b49475eeea" title="Releases an ODBC object previously allocated by odbc_request_obj().">ast_odbc_release_obj</a>(obj);
<a name="l00190"></a>00190       <span class="keywordflow">return</span> NULL;
<a name="l00191"></a>00191    }
<a name="l00192"></a>00192    <span class="keywordflow">for</span> (x = 0; x &lt; colcount; x++) {
<a name="l00193"></a>00193       rowdata[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00194"></a>00194       collen = <span class="keyword">sizeof</span>(coltitle);
<a name="l00195"></a>00195       res = SQLDescribeCol(stmt, x + 1, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)coltitle, <span class="keyword">sizeof</span>(coltitle), &amp;collen, 
<a name="l00196"></a>00196                &amp;datatype, &amp;colsize, &amp;decimaldigits, &amp;nullable);
<a name="l00197"></a>00197       <span class="keywordflow">if</span> ((res != SQL_SUCCESS) &amp;&amp; (res != SQL_SUCCESS_WITH_INFO)) {
<a name="l00198"></a>00198          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;SQL Describe Column error!\n[%s]\n\n&quot;</span>, sql);
<a name="l00199"></a>00199          <span class="keywordflow">if</span> (var)
<a name="l00200"></a>00200             <a class="code" href="config_8h.html#ad3d8122172af6f13687a07840411d65d" title="Free variable list.">ast_variables_destroy</a>(var);
<a name="l00201"></a>00201          <a class="code" href="res__odbc_8h.html#a78d14d1dd01c269c9c0a47b49475eeea" title="Releases an ODBC object previously allocated by odbc_request_obj().">ast_odbc_release_obj</a>(obj);
<a name="l00202"></a>00202          <span class="keywordflow">return</span> NULL;
<a name="l00203"></a>00203       }
<a name="l00204"></a>00204 
<a name="l00205"></a>00205       indicator = 0;
<a name="l00206"></a>00206       res = SQLGetData(stmt, x + 1, SQL_CHAR, rowdata, <span class="keyword">sizeof</span>(rowdata), &amp;indicator);
<a name="l00207"></a>00207       <span class="keywordflow">if</span> (indicator == SQL_NULL_DATA)
<a name="l00208"></a>00208          rowdata[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00209"></a>00209       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(rowdata)) {
<a name="l00210"></a>00210          <span class="comment">/* Because we encode the empty string for a NULL, we will encode</span>
<a name="l00211"></a>00211 <span class="comment">          * actual empty strings as a string containing a single whitespace. */</span>
<a name="l00212"></a>00212          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(rowdata, <span class="stringliteral">&quot; &quot;</span>, <span class="keyword">sizeof</span>(rowdata));
<a name="l00213"></a>00213       }
<a name="l00214"></a>00214 
<a name="l00215"></a>00215       <span class="keywordflow">if</span> ((res != SQL_SUCCESS) &amp;&amp; (res != SQL_SUCCESS_WITH_INFO)) {
<a name="l00216"></a>00216          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;SQL Get Data error!\n[%s]\n\n&quot;</span>, sql);
<a name="l00217"></a>00217          <span class="keywordflow">if</span> (var)
<a name="l00218"></a>00218             <a class="code" href="config_8h.html#ad3d8122172af6f13687a07840411d65d" title="Free variable list.">ast_variables_destroy</a>(var);
<a name="l00219"></a>00219          <a class="code" href="res__odbc_8h.html#a78d14d1dd01c269c9c0a47b49475eeea" title="Releases an ODBC object previously allocated by odbc_request_obj().">ast_odbc_release_obj</a>(obj);
<a name="l00220"></a>00220          <span class="keywordflow">return</span> NULL;
<a name="l00221"></a>00221       }
<a name="l00222"></a>00222       stringp = rowdata;
<a name="l00223"></a>00223       <span class="keywordflow">while</span>(stringp) {
<a name="l00224"></a>00224          chunk = <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;stringp, <span class="stringliteral">&quot;;&quot;</span>);
<a name="l00225"></a>00225          <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="strings_8h.html#aeb1c54e6e100c63176d8e22b0d5ca865" title="Strip leading/trailing whitespace from a string.">ast_strip</a>(chunk))) {
<a name="l00226"></a>00226             <span class="keywordflow">if</span> (prev) {
<a name="l00227"></a>00227                prev-&gt;next = <a class="code" href="config_8h.html#a08e94d96f459e7301a74daf32035423b">ast_variable_new</a>(coltitle, chunk, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00228"></a>00228                <span class="keywordflow">if</span> (prev-&gt;next)
<a name="l00229"></a>00229                   prev = prev-&gt;next;
<a name="l00230"></a>00230             } <span class="keywordflow">else</span> 
<a name="l00231"></a>00231                prev = var = <a class="code" href="config_8h.html#a08e94d96f459e7301a74daf32035423b">ast_variable_new</a>(coltitle, chunk, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00232"></a>00232          }
<a name="l00233"></a>00233       }
<a name="l00234"></a>00234    }
<a name="l00235"></a>00235 
<a name="l00236"></a>00236 
<a name="l00237"></a>00237    SQLFreeHandle(SQL_HANDLE_STMT, stmt);
<a name="l00238"></a>00238    <a class="code" href="res__odbc_8h.html#a78d14d1dd01c269c9c0a47b49475eeea" title="Releases an ODBC object previously allocated by odbc_request_obj().">ast_odbc_release_obj</a>(obj);
<a name="l00239"></a>00239    <span class="keywordflow">return</span> var;
<a name="l00240"></a>00240 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7c6ac25ea7536c0bc9ed18cbcf917527"></a><!-- doxytag: member="res_config_odbc.c::reload_module" ref="a7c6ac25ea7536c0bc9ed18cbcf917527" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int reload_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__odbc_8c_source.html#l01070">1070</a> of file <a class="el" href="res__config__odbc_8c_source.html">res_config_odbc.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01071"></a>01071 {
<a name="l01072"></a>01072    <span class="keywordflow">return</span> 0;
<a name="l01073"></a>01073 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3dc1c580fd0e6f5ab56a9d9569ca44aa"></a><!-- doxytag: member="res_config_odbc.c::require_odbc" ref="a3dc1c580fd0e6f5ab56a9d9569ca44aa" args="(const char *database, const char *table, va_list ap)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int require_odbc </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>database</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">va_list&nbsp;</td>
          <td class="paramname"> <em>ap</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__odbc_8c_source.html#l00884">884</a> of file <a class="el" href="res__config__odbc_8c_source.html">res_config_odbc.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="res__odbc_8c_source.html#l00425">ast_odbc_find_table()</a>, <a class="el" href="linkedlists_8h_source.html#l00493">AST_RWLIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="res__config__odbc_8c.html#a213ff212b1abd119f58f61f5576e13d4">CHECK_SIZE</a>, <a class="el" href="structodbc__cache__tables.html#a09f857e5d5d25c0d2065acfbb45afe6c">odbc_cache_tables::columns</a>, <a class="el" href="structodbc__cache__columns.html#a104d3ecbbd644ca8156e812056c5ce90">odbc_cache_columns::list</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="res__odbc_8h_source.html#l00063">odbc_cache_columns::name</a>, <a class="el" href="config_8h_source.html#l00066">RQ_CHAR</a>, <a class="el" href="config_8h_source.html#l00068">RQ_DATE</a>, <a class="el" href="config_8h_source.html#l00069">RQ_DATETIME</a>, <a class="el" href="config_8h_source.html#l00067">RQ_FLOAT</a>, <a class="el" href="config_8h_source.html#l00056">RQ_INTEGER1</a>, <a class="el" href="config_8h_source.html#l00058">RQ_INTEGER2</a>, <a class="el" href="config_8h_source.html#l00060">RQ_INTEGER3</a>, <a class="el" href="config_8h_source.html#l00062">RQ_INTEGER4</a>, <a class="el" href="config_8h_source.html#l00064">RQ_INTEGER8</a>, <a class="el" href="config_8h_source.html#l00057">RQ_UINTEGER1</a>, <a class="el" href="config_8h_source.html#l00059">RQ_UINTEGER2</a>, <a class="el" href="config_8h_source.html#l00061">RQ_UINTEGER3</a>, <a class="el" href="config_8h_source.html#l00063">RQ_UINTEGER4</a>, <a class="el" href="config_8h_source.html#l00065">RQ_UINTEGER8</a>, <a class="el" href="res__odbc_8h_source.html#l00065">odbc_cache_columns::size</a>, <a class="el" href="res__odbc_8h_source.html#l00064">odbc_cache_columns::type</a>, <a class="el" href="evt_8c_source.html#l00071">type</a>, <a class="el" href="res__config__odbc_8c_source.html#l00881">warn_length</a>, <a class="el" href="res__config__odbc_8c_source.html#l00882">warn_type</a>, and <a class="el" href="res__config__odbc_8c.html#af2cdda2f51ca0d0f04ec61841eb58ddb">WARN_TYPE_OR_LENGTH</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00885"></a>00885 {
<a name="l00886"></a>00886    <span class="keyword">struct </span><a class="code" href="structodbc__cache__tables.html">odbc_cache_tables</a> *tableptr = <a class="code" href="res__odbc_8h.html#aa15ed6f1d16784d3e2961c0bef9352c8" title="Find or create an entry describing the table specified.">ast_odbc_find_table</a>(database, <a class="code" href="cdr__odbc_8c.html#a68d1e6e752f2cf81551fac543cae108a">table</a>);
<a name="l00887"></a>00887    <span class="keyword">struct </span><a class="code" href="structodbc__cache__columns.html">odbc_cache_columns</a> *col;
<a name="l00888"></a>00888    <span class="keywordtype">char</span> *elm;
<a name="l00889"></a>00889    <span class="keywordtype">int</span> <a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>, <a class="code" href="structodbc__cache__columns.html#a8f725e63e7aaa7e48a10d571d6bc5c44">size</a>;
<a name="l00890"></a>00890 
<a name="l00891"></a>00891    <span class="keywordflow">if</span> (!tableptr) {
<a name="l00892"></a>00892       <span class="keywordflow">return</span> -1;
<a name="l00893"></a>00893    }
<a name="l00894"></a>00894 
<a name="l00895"></a>00895    <span class="keywordflow">while</span> ((elm = va_arg(ap, <span class="keywordtype">char</span> *))) {
<a name="l00896"></a>00896       type = va_arg(ap, <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3" title="Types used in ast_realtime_require_field.">require_type</a>);
<a name="l00897"></a>00897       size = va_arg(ap, <span class="keywordtype">int</span>);
<a name="l00898"></a>00898       <span class="comment">/* Check if the field matches the criteria */</span>
<a name="l00899"></a>00899       <a class="code" href="linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;tableptr-&gt;<a class="code" href="structodbc__cache__tables.html#a09f857e5d5d25c0d2065acfbb45afe6c">columns</a>, col, <a class="code" href="structodbc__cache__columns.html#a104d3ecbbd644ca8156e812056c5ce90">list</a>) {
<a name="l00900"></a>00900          <span class="keywordflow">if</span> (strcmp(col-&gt;<a class="code" href="structodbc__cache__columns.html#a5ac083a645d964373f022d03df4849c8">name</a>, elm) == 0) {
<a name="l00901"></a>00901             <span class="comment">/* Type check, first.  Some fields are more particular than others */</span>
<a name="l00902"></a>00902             <span class="keywordflow">switch</span> (col-&gt;<a class="code" href="structodbc__cache__columns.html#a713b6299f1d41d81cf4fec75082f0033">type</a>) {
<a name="l00903"></a>00903             <span class="keywordflow">case</span> SQL_CHAR:
<a name="l00904"></a>00904             <span class="keywordflow">case</span> SQL_VARCHAR:
<a name="l00905"></a>00905             <span class="keywordflow">case</span> SQL_LONGVARCHAR:
<a name="l00906"></a>00906 <span class="preprocessor">#ifdef HAVE_ODBC_WCHAR</span>
<a name="l00907"></a>00907 <span class="preprocessor"></span>            <span class="keywordflow">case</span> SQL_WCHAR:
<a name="l00908"></a>00908             <span class="keywordflow">case</span> SQL_WVARCHAR:
<a name="l00909"></a>00909             <span class="keywordflow">case</span> SQL_WLONGVARCHAR:
<a name="l00910"></a>00910 <span class="preprocessor">#endif</span>
<a name="l00911"></a>00911 <span class="preprocessor"></span>            <span class="keywordflow">case</span> SQL_BINARY:
<a name="l00912"></a>00912             <span class="keywordflow">case</span> SQL_VARBINARY:
<a name="l00913"></a>00913             <span class="keywordflow">case</span> SQL_LONGVARBINARY:
<a name="l00914"></a>00914             <span class="keywordflow">case</span> SQL_GUID:
<a name="l00915"></a>00915 <span class="preprocessor">#define CHECK_SIZE(n) \</span>
<a name="l00916"></a>00916 <span class="preprocessor">                  if (col-&gt;size &lt; n) {      \</span>
<a name="l00917"></a>00917 <span class="preprocessor">                     warn_length(col, n);  \</span>
<a name="l00918"></a>00918 <span class="preprocessor">                  }                         \</span>
<a name="l00919"></a>00919 <span class="preprocessor">                  break;</span>
<a name="l00920"></a>00920 <span class="preprocessor"></span>               <span class="keywordflow">switch</span> (type) {
<a name="l00921"></a>00921                <span class="keywordflow">case</span> <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3ae8c94d6fa08e17f6f86792727b201bf9">RQ_UINTEGER1</a>: <a class="code" href="res__config__odbc_8c.html#a213ff212b1abd119f58f61f5576e13d4">CHECK_SIZE</a>(3)  <span class="comment">/*         255 */</span>
<a name="l00922"></a>00922                case <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3a7b4a9e81298a296d3e066ed369727cc4">RQ_INTEGER1</a>:  CHECK_SIZE(4)  <span class="comment">/*        -128 */</span>
<a name="l00923"></a>00923                case <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3a1ab15af464bf1838c9ca91d32ca7a2a1">RQ_UINTEGER2</a>: CHECK_SIZE(5)  <span class="comment">/*       65535 */</span>
<a name="l00924"></a>00924                case <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3af1d7dd0d3aacafdef0d2f0d2db6d7112">RQ_INTEGER2</a>:  CHECK_SIZE(6)  <span class="comment">/*      -32768 */</span>
<a name="l00925"></a>00925                case <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3ad3163600ec26815e26092d9eb3e4b0b5">RQ_UINTEGER3</a>:                <span class="comment">/*    16777215 */</span>
<a name="l00926"></a>00926                case <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3a75d046b2f103381a62aeb81f42550404">RQ_INTEGER3</a>:  CHECK_SIZE(8)  <span class="comment">/*    -8388608 */</span>
<a name="l00927"></a>00927                case <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3a3d3293675f377a4398a25974cba3e7e1">RQ_DATE</a>:                     <span class="comment">/*  2008-06-09 */</span>
<a name="l00928"></a>00928                case <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3a27acda71d87003db19a6e0b4193a32be">RQ_UINTEGER4</a>: CHECK_SIZE(10) <span class="comment">/*  4200000000 */</span>
<a name="l00929"></a>00929                case <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3a8a9fbbd166ee4918cec8c9303fde70e8">RQ_INTEGER4</a>:  CHECK_SIZE(11) <span class="comment">/* -2100000000 */</span>
<a name="l00930"></a>00930                case <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3acf1d0ae3a1d0e3ae12a1f05f485f07c9">RQ_DATETIME</a>:                 <span class="comment">/* 2008-06-09 16:03:47 */</span>
<a name="l00931"></a>00931                case <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3a2e4fb4c24a3958e2fbd853d5c53cfbb4">RQ_UINTEGER8</a>: CHECK_SIZE(19) <span class="comment">/* trust me    */</span>
<a name="l00932"></a>00932                case <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3aaa7be840b4634cc84021f0c20a17275b">RQ_INTEGER8</a>:  CHECK_SIZE(20) <span class="comment">/* ditto       */</span>
<a name="l00933"></a>00933                case <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3a1133e08bb8b498770188f728ca03e417">RQ_FLOAT</a>:
<a name="l00934"></a>00934                case <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3a75759a4654f061f8e7d6bd1ec7a3b4bb">RQ_CHAR</a>:      CHECK_SIZE(size)
<a name="l00935"></a>00935                }
<a name="l00936"></a>00936 <span class="preprocessor">#undef CHECK_SIZE</span>
<a name="l00937"></a>00937 <span class="preprocessor"></span>               <span class="keywordflow">break</span>;
<a name="l00938"></a>00938             <span class="keywordflow">case</span> SQL_TYPE_DATE:
<a name="l00939"></a>00939                <span class="keywordflow">if</span> (type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3a3d3293675f377a4398a25974cba3e7e1">RQ_DATE</a>) {
<a name="l00940"></a>00940                   <a class="code" href="res__config__odbc_8c.html#ac0fc1cb3fe8e03194386842057d38085">warn_type</a>(col, type);
<a name="l00941"></a>00941                }
<a name="l00942"></a>00942                <span class="keywordflow">break</span>;
<a name="l00943"></a>00943             <span class="keywordflow">case</span> SQL_TYPE_TIMESTAMP:
<a name="l00944"></a>00944             <span class="keywordflow">case</span> SQL_TIMESTAMP:
<a name="l00945"></a>00945                <span class="keywordflow">if</span> (type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3a3d3293675f377a4398a25974cba3e7e1">RQ_DATE</a> &amp;&amp; type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3acf1d0ae3a1d0e3ae12a1f05f485f07c9">RQ_DATETIME</a>) {
<a name="l00946"></a>00946                   <a class="code" href="res__config__odbc_8c.html#ac0fc1cb3fe8e03194386842057d38085">warn_type</a>(col, type);
<a name="l00947"></a>00947                }
<a name="l00948"></a>00948                <span class="keywordflow">break</span>;
<a name="l00949"></a>00949             <span class="keywordflow">case</span> SQL_BIT:
<a name="l00950"></a>00950                <a class="code" href="res__config__odbc_8c.html#a18da797c1ab7394473a9b3c7e13e6f89">warn_length</a>(col, size);
<a name="l00951"></a>00951                <span class="keywordflow">break</span>;
<a name="l00952"></a>00952 <span class="preprocessor">#define WARN_TYPE_OR_LENGTH(n)   \</span>
<a name="l00953"></a>00953 <span class="preprocessor">                  if (!ast_rq_is_int(type)) {  \</span>
<a name="l00954"></a>00954 <span class="preprocessor">                     warn_type(col, type);    \</span>
<a name="l00955"></a>00955 <span class="preprocessor">                  } else {                     \</span>
<a name="l00956"></a>00956 <span class="preprocessor">                     warn_length(col, n);  \</span>
<a name="l00957"></a>00957 <span class="preprocessor">                  }</span>
<a name="l00958"></a>00958 <span class="preprocessor"></span>            <span class="keywordflow">case</span> SQL_TINYINT:
<a name="l00959"></a>00959                <span class="keywordflow">if</span> (type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3ae8c94d6fa08e17f6f86792727b201bf9">RQ_UINTEGER1</a>) {
<a name="l00960"></a>00960                   <a class="code" href="res__config__odbc_8c.html#af2cdda2f51ca0d0f04ec61841eb58ddb">WARN_TYPE_OR_LENGTH</a>(size)
<a name="l00961"></a>00961                }
<a name="l00962"></a>00962                <span class="keywordflow">break</span>;
<a name="l00963"></a>00963             <span class="keywordflow">case</span> SQL_C_STINYINT:
<a name="l00964"></a>00964                <span class="keywordflow">if</span> (type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3a7b4a9e81298a296d3e066ed369727cc4">RQ_INTEGER1</a>) {
<a name="l00965"></a>00965                   <a class="code" href="res__config__odbc_8c.html#af2cdda2f51ca0d0f04ec61841eb58ddb">WARN_TYPE_OR_LENGTH</a>(size)
<a name="l00966"></a>00966                }
<a name="l00967"></a>00967                <span class="keywordflow">break</span>;
<a name="l00968"></a>00968             <span class="keywordflow">case</span> SQL_C_USHORT:
<a name="l00969"></a>00969                <span class="keywordflow">if</span> (type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3ae8c94d6fa08e17f6f86792727b201bf9">RQ_UINTEGER1</a> &amp;&amp; type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3a7b4a9e81298a296d3e066ed369727cc4">RQ_INTEGER1</a> &amp;&amp; type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3a1ab15af464bf1838c9ca91d32ca7a2a1">RQ_UINTEGER2</a>) {
<a name="l00970"></a>00970                   <a class="code" href="res__config__odbc_8c.html#af2cdda2f51ca0d0f04ec61841eb58ddb">WARN_TYPE_OR_LENGTH</a>(size)
<a name="l00971"></a>00971                }
<a name="l00972"></a>00972                <span class="keywordflow">break</span>;
<a name="l00973"></a>00973             <span class="keywordflow">case</span> SQL_SMALLINT:
<a name="l00974"></a>00974             <span class="keywordflow">case</span> SQL_C_SSHORT:
<a name="l00975"></a>00975                <span class="keywordflow">if</span> (type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3ae8c94d6fa08e17f6f86792727b201bf9">RQ_UINTEGER1</a> &amp;&amp; type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3a7b4a9e81298a296d3e066ed369727cc4">RQ_INTEGER1</a> &amp;&amp; type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3af1d7dd0d3aacafdef0d2f0d2db6d7112">RQ_INTEGER2</a>) {
<a name="l00976"></a>00976                   <a class="code" href="res__config__odbc_8c.html#af2cdda2f51ca0d0f04ec61841eb58ddb">WARN_TYPE_OR_LENGTH</a>(size)
<a name="l00977"></a>00977                }
<a name="l00978"></a>00978                <span class="keywordflow">break</span>;
<a name="l00979"></a>00979             <span class="keywordflow">case</span> SQL_C_ULONG:
<a name="l00980"></a>00980                <span class="keywordflow">if</span> (type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3ae8c94d6fa08e17f6f86792727b201bf9">RQ_UINTEGER1</a> &amp;&amp; type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3a7b4a9e81298a296d3e066ed369727cc4">RQ_INTEGER1</a> &amp;&amp;
<a name="l00981"></a>00981                   type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3a1ab15af464bf1838c9ca91d32ca7a2a1">RQ_UINTEGER2</a> &amp;&amp; type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3af1d7dd0d3aacafdef0d2f0d2db6d7112">RQ_INTEGER2</a> &amp;&amp;
<a name="l00982"></a>00982                   type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3ad3163600ec26815e26092d9eb3e4b0b5">RQ_UINTEGER3</a> &amp;&amp; type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3a75d046b2f103381a62aeb81f42550404">RQ_INTEGER3</a> &amp;&amp;
<a name="l00983"></a>00983                   type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3a8a9fbbd166ee4918cec8c9303fde70e8">RQ_INTEGER4</a>) {
<a name="l00984"></a>00984                   <a class="code" href="res__config__odbc_8c.html#af2cdda2f51ca0d0f04ec61841eb58ddb">WARN_TYPE_OR_LENGTH</a>(size)
<a name="l00985"></a>00985                }
<a name="l00986"></a>00986                <span class="keywordflow">break</span>;
<a name="l00987"></a>00987             <span class="keywordflow">case</span> SQL_INTEGER:
<a name="l00988"></a>00988             <span class="keywordflow">case</span> SQL_C_SLONG:
<a name="l00989"></a>00989                <span class="keywordflow">if</span> (type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3ae8c94d6fa08e17f6f86792727b201bf9">RQ_UINTEGER1</a> &amp;&amp; type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3a7b4a9e81298a296d3e066ed369727cc4">RQ_INTEGER1</a> &amp;&amp;
<a name="l00990"></a>00990                   type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3a1ab15af464bf1838c9ca91d32ca7a2a1">RQ_UINTEGER2</a> &amp;&amp; type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3af1d7dd0d3aacafdef0d2f0d2db6d7112">RQ_INTEGER2</a> &amp;&amp;
<a name="l00991"></a>00991                   type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3ad3163600ec26815e26092d9eb3e4b0b5">RQ_UINTEGER3</a> &amp;&amp; type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3a75d046b2f103381a62aeb81f42550404">RQ_INTEGER3</a> &amp;&amp;
<a name="l00992"></a>00992                   type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3a8a9fbbd166ee4918cec8c9303fde70e8">RQ_INTEGER4</a>) {
<a name="l00993"></a>00993                   <a class="code" href="res__config__odbc_8c.html#af2cdda2f51ca0d0f04ec61841eb58ddb">WARN_TYPE_OR_LENGTH</a>(size)
<a name="l00994"></a>00994                }
<a name="l00995"></a>00995                <span class="keywordflow">break</span>;
<a name="l00996"></a>00996             <span class="keywordflow">case</span> SQL_C_UBIGINT:
<a name="l00997"></a>00997                <span class="keywordflow">if</span> (type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3ae8c94d6fa08e17f6f86792727b201bf9">RQ_UINTEGER1</a> &amp;&amp; type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3a7b4a9e81298a296d3e066ed369727cc4">RQ_INTEGER1</a> &amp;&amp;
<a name="l00998"></a>00998                   type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3a1ab15af464bf1838c9ca91d32ca7a2a1">RQ_UINTEGER2</a> &amp;&amp; type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3af1d7dd0d3aacafdef0d2f0d2db6d7112">RQ_INTEGER2</a> &amp;&amp;
<a name="l00999"></a>00999                   type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3ad3163600ec26815e26092d9eb3e4b0b5">RQ_UINTEGER3</a> &amp;&amp; type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3a75d046b2f103381a62aeb81f42550404">RQ_INTEGER3</a> &amp;&amp;
<a name="l01000"></a>01000                   type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3a27acda71d87003db19a6e0b4193a32be">RQ_UINTEGER4</a> &amp;&amp; type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3a8a9fbbd166ee4918cec8c9303fde70e8">RQ_INTEGER4</a> &amp;&amp;
<a name="l01001"></a>01001                   type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3aaa7be840b4634cc84021f0c20a17275b">RQ_INTEGER8</a>) {
<a name="l01002"></a>01002                   <a class="code" href="res__config__odbc_8c.html#af2cdda2f51ca0d0f04ec61841eb58ddb">WARN_TYPE_OR_LENGTH</a>(size)
<a name="l01003"></a>01003                }
<a name="l01004"></a>01004                <span class="keywordflow">break</span>;
<a name="l01005"></a>01005             <span class="keywordflow">case</span> SQL_BIGINT:
<a name="l01006"></a>01006             <span class="keywordflow">case</span> SQL_C_SBIGINT:
<a name="l01007"></a>01007                <span class="keywordflow">if</span> (type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3ae8c94d6fa08e17f6f86792727b201bf9">RQ_UINTEGER1</a> &amp;&amp; type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3a7b4a9e81298a296d3e066ed369727cc4">RQ_INTEGER1</a> &amp;&amp;
<a name="l01008"></a>01008                   type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3a1ab15af464bf1838c9ca91d32ca7a2a1">RQ_UINTEGER2</a> &amp;&amp; type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3af1d7dd0d3aacafdef0d2f0d2db6d7112">RQ_INTEGER2</a> &amp;&amp;
<a name="l01009"></a>01009                   type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3ad3163600ec26815e26092d9eb3e4b0b5">RQ_UINTEGER3</a> &amp;&amp; type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3a75d046b2f103381a62aeb81f42550404">RQ_INTEGER3</a> &amp;&amp;
<a name="l01010"></a>01010                   type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3a27acda71d87003db19a6e0b4193a32be">RQ_UINTEGER4</a> &amp;&amp; type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3a8a9fbbd166ee4918cec8c9303fde70e8">RQ_INTEGER4</a> &amp;&amp;
<a name="l01011"></a>01011                   type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3aaa7be840b4634cc84021f0c20a17275b">RQ_INTEGER8</a>) {
<a name="l01012"></a>01012                   <a class="code" href="res__config__odbc_8c.html#af2cdda2f51ca0d0f04ec61841eb58ddb">WARN_TYPE_OR_LENGTH</a>(size)
<a name="l01013"></a>01013                }
<a name="l01014"></a>01014                <span class="keywordflow">break</span>;
<a name="l01015"></a>01015 <span class="preprocessor">#undef WARN_TYPE_OR_LENGTH</span>
<a name="l01016"></a>01016 <span class="preprocessor"></span>            <span class="keywordflow">case</span> SQL_NUMERIC:
<a name="l01017"></a>01017             <span class="keywordflow">case</span> SQL_DECIMAL:
<a name="l01018"></a>01018             <span class="keywordflow">case</span> SQL_FLOAT:
<a name="l01019"></a>01019             <span class="keywordflow">case</span> SQL_REAL:
<a name="l01020"></a>01020             <span class="keywordflow">case</span> SQL_DOUBLE:
<a name="l01021"></a>01021                <span class="keywordflow">if</span> (!ast_rq_is_int(type) &amp;&amp; type != <a class="code" href="config_8h.html#abbca034b0a98715c687b808347af82a3a1133e08bb8b498770188f728ca03e417">RQ_FLOAT</a>) {
<a name="l01022"></a>01022                   <a class="code" href="res__config__odbc_8c.html#ac0fc1cb3fe8e03194386842057d38085">warn_type</a>(col, type);
<a name="l01023"></a>01023                }
<a name="l01024"></a>01024                <span class="keywordflow">break</span>;
<a name="l01025"></a>01025             <span class="keywordflow">default</span>:
<a name="l01026"></a>01026                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Realtime table %s@%s: column type (%d) unrecognized for column &apos;%s&apos;\n&quot;</span>, <a class="code" href="cdr__odbc_8c.html#a68d1e6e752f2cf81551fac543cae108a">table</a>, database, col-&gt;<a class="code" href="structodbc__cache__columns.html#a713b6299f1d41d81cf4fec75082f0033">type</a>, elm);
<a name="l01027"></a>01027             }
<a name="l01028"></a>01028             <span class="keywordflow">break</span>;
<a name="l01029"></a>01029          }
<a name="l01030"></a>01030       }
<a name="l01031"></a>01031       <span class="keywordflow">if</span> (!col) {
<a name="l01032"></a>01032          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Realtime table %s@%s requires column &apos;%s&apos;, but that column does not exist!\n&quot;</span>, <a class="code" href="cdr__odbc_8c.html#a68d1e6e752f2cf81551fac543cae108a">table</a>, database, elm);
<a name="l01033"></a>01033       }
<a name="l01034"></a>01034    }
<a name="l01035"></a>01035    va_end(ap);
<a name="l01036"></a>01036    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;tableptr-&gt;<a class="code" href="structodbc__cache__tables.html#a09f857e5d5d25c0d2065acfbb45afe6c">columns</a>);
<a name="l01037"></a>01037    <span class="keywordflow">return</span> 0;
<a name="l01038"></a>01038 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae97ad756e436d6ecf0755aa42d05d7fd"></a><!-- doxytag: member="res_config_odbc.c::store_odbc" ref="ae97ad756e436d6ecf0755aa42d05d7fd" args="(const char *database, const char *table, va_list ap)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int store_odbc </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>database</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">va_list&nbsp;</td>
          <td class="paramname"> <em>ap</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Excute an INSERT query. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>database</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>table</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ap</em>&nbsp;</td><td>list containing one or more field/value set(s)</td></tr>
  </table>
  </dd>
</dl>
<p>Insert a new record into database table, prepare the sql statement. All <a class="el" href="structvalues.html">values</a> to be changed are stored in ap list. Sub-in the <a class="el" href="structvalues.html">values</a> to the prepared statement and execute it.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structnumber.html" title="Number structure.">number</a></em>&nbsp;</td><td>of rows affected </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="res__config__odbc_8c_source.html#l00633">633</a> of file <a class="el" href="res__config__odbc_8c_source.html">res_config_odbc.c</a>.</p>

<p>References <a class="el" href="res__config__odbc_8c_source.html#l00053">custom_prepare_struct::ap</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="res__odbc_8c_source.html#l00593">ast_odbc_prepare_and_execute()</a>, <a class="el" href="res__odbc_8c_source.html#l01041">ast_odbc_release_obj()</a>, <a class="el" href="res__odbc_8c_source.html#l01331">ast_odbc_request_obj()</a>, <a class="el" href="res__config__odbc_8c_source.html#l00057">custom_prepare()</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, and <a class="el" href="res__config__odbc_8c_source.html#l00051">custom_prepare_struct::sql</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00634"></a>00634 {
<a name="l00635"></a>00635    <span class="keyword">struct </span><a class="code" href="structodbc__obj.html" title="ODBC container.">odbc_obj</a> *obj;
<a name="l00636"></a>00636    SQLHSTMT stmt;
<a name="l00637"></a>00637    <span class="keywordtype">char</span> sql[256];
<a name="l00638"></a>00638    <span class="keywordtype">char</span> <a class="code" href="structkeys.html">keys</a>[256];
<a name="l00639"></a>00639    <span class="keywordtype">char</span> vals[256];
<a name="l00640"></a>00640    SQLLEN rowcount=0;
<a name="l00641"></a>00641    <span class="keyword">const</span> <span class="keywordtype">char</span> *newparam, *newval;
<a name="l00642"></a>00642    <span class="keywordtype">int</span> res;
<a name="l00643"></a>00643    va_list aq;
<a name="l00644"></a>00644    <span class="keyword">struct </span><a class="code" href="structcustom__prepare__struct.html">custom_prepare_struct</a> cps = { .sql = sql, .extra = NULL };
<a name="l00645"></a>00645 
<a name="l00646"></a>00646    va_copy(cps.<a class="code" href="structcustom__prepare__struct.html#aba0d2a7f015cf887da8af71f5014280b">ap</a>, <a class="code" href="structcustom__prepare__struct.html#aba0d2a7f015cf887da8af71f5014280b">ap</a>);
<a name="l00647"></a>00647    va_copy(aq, <a class="code" href="structcustom__prepare__struct.html#aba0d2a7f015cf887da8af71f5014280b">ap</a>);
<a name="l00648"></a>00648    
<a name="l00649"></a>00649    <span class="keywordflow">if</span> (!<a class="code" href="cdr__odbc_8c.html#a68d1e6e752f2cf81551fac543cae108a">table</a>)
<a name="l00650"></a>00650       <span class="keywordflow">return</span> -1;
<a name="l00651"></a>00651 
<a name="l00652"></a>00652    obj = <a class="code" href="res__odbc_8h.html#ad34ae2bdba165ef6c7405afc94f2a7f3">ast_odbc_request_obj</a>(database, 0);
<a name="l00653"></a>00653    <span class="keywordflow">if</span> (!obj)
<a name="l00654"></a>00654       <span class="keywordflow">return</span> -1;
<a name="l00655"></a>00655 
<a name="l00656"></a>00656    newparam = va_arg(aq, <span class="keyword">const</span> <span class="keywordtype">char</span> *);
<a name="l00657"></a>00657    <span class="keywordflow">if</span> (!newparam)  {
<a name="l00658"></a>00658       <a class="code" href="res__odbc_8h.html#a78d14d1dd01c269c9c0a47b49475eeea" title="Releases an ODBC object previously allocated by odbc_request_obj().">ast_odbc_release_obj</a>(obj);
<a name="l00659"></a>00659       <span class="keywordflow">return</span> -1;
<a name="l00660"></a>00660    }
<a name="l00661"></a>00661    newval = va_arg(aq, <span class="keyword">const</span> <span class="keywordtype">char</span> *);
<a name="l00662"></a>00662    snprintf(keys, <span class="keyword">sizeof</span>(keys), <span class="stringliteral">&quot;%s&quot;</span>, newparam);
<a name="l00663"></a>00663    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(vals, <span class="stringliteral">&quot;?&quot;</span>, <span class="keyword">sizeof</span>(vals));
<a name="l00664"></a>00664    <span class="keywordflow">while</span> ((newparam = va_arg(aq, <span class="keyword">const</span> <span class="keywordtype">char</span> *))) {
<a name="l00665"></a>00665       snprintf(keys + strlen(keys), <span class="keyword">sizeof</span>(keys) - strlen(keys), <span class="stringliteral">&quot;, %s&quot;</span>, newparam);
<a name="l00666"></a>00666       snprintf(vals + strlen(vals), <span class="keyword">sizeof</span>(vals) - strlen(vals), <span class="stringliteral">&quot;, ?&quot;</span>);
<a name="l00667"></a>00667       newval = va_arg(aq, <span class="keyword">const</span> <span class="keywordtype">char</span> *);
<a name="l00668"></a>00668    }
<a name="l00669"></a>00669    va_end(aq);
<a name="l00670"></a>00670    snprintf(sql, <span class="keyword">sizeof</span>(sql), <span class="stringliteral">&quot;INSERT INTO %s (%s) VALUES (%s)&quot;</span>, <a class="code" href="cdr__odbc_8c.html#a68d1e6e752f2cf81551fac543cae108a">table</a>, keys, vals);
<a name="l00671"></a>00671 
<a name="l00672"></a>00672    stmt = <a class="code" href="res__odbc_8h.html#ad1e82a2b1ba4eda1924d8b8f591de065" title="Prepares, executes, and returns the resulting statement handle.">ast_odbc_prepare_and_execute</a>(obj, <a class="code" href="res__config__odbc_8c.html#a9fb0770b5d483240183affa19304b681">custom_prepare</a>, &amp;cps);
<a name="l00673"></a>00673 
<a name="l00674"></a>00674    <span class="keywordflow">if</span> (!stmt) {
<a name="l00675"></a>00675       <a class="code" href="res__odbc_8h.html#a78d14d1dd01c269c9c0a47b49475eeea" title="Releases an ODBC object previously allocated by odbc_request_obj().">ast_odbc_release_obj</a>(obj);
<a name="l00676"></a>00676       <span class="keywordflow">return</span> -1;
<a name="l00677"></a>00677    }
<a name="l00678"></a>00678 
<a name="l00679"></a>00679    res = SQLRowCount(stmt, &amp;rowcount);
<a name="l00680"></a>00680    SQLFreeHandle (SQL_HANDLE_STMT, stmt);
<a name="l00681"></a>00681    <a class="code" href="res__odbc_8h.html#a78d14d1dd01c269c9c0a47b49475eeea" title="Releases an ODBC object previously allocated by odbc_request_obj().">ast_odbc_release_obj</a>(obj);
<a name="l00682"></a>00682 
<a name="l00683"></a>00683    <span class="keywordflow">if</span> ((res != SQL_SUCCESS) &amp;&amp; (res != SQL_SUCCESS_WITH_INFO)) {
<a name="l00684"></a>00684       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;SQL Row Count error!\n[%s]\n\n&quot;</span>, sql);
<a name="l00685"></a>00685       <span class="keywordflow">return</span> -1;
<a name="l00686"></a>00686    }
<a name="l00687"></a>00687 
<a name="l00688"></a>00688    <span class="keywordflow">if</span> (rowcount &gt;= 0)
<a name="l00689"></a>00689       <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)rowcount;
<a name="l00690"></a>00690 
<a name="l00691"></a>00691    <span class="keywordflow">return</span> -1;
<a name="l00692"></a>00692 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad09fa931f468002152a3cc2d5ce25eae"></a><!-- doxytag: member="res_config_odbc.c::unload_module" ref="ad09fa931f468002152a3cc2d5ce25eae" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int unload_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__odbc_8c_source.html#l01055">1055</a> of file <a class="el" href="res__config__odbc_8c_source.html">res_config_odbc.c</a>.</p>

<p>References <a class="el" href="config_8c_source.html#l01969">ast_config_engine_deregister()</a>, and <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01056"></a>01056 {
<a name="l01057"></a>01057    <a class="code" href="config_8h.html#a7028ff4b11d7167ee4030b4d3e123d76" title="Deregister config engine.">ast_config_engine_deregister</a>(&amp;<a class="code" href="res__config__odbc_8c.html#a0db7ee1d52bac64062bb76ed957432bb">odbc_engine</a>);
<a name="l01058"></a>01058 
<a name="l01059"></a>01059    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;res_config_odbc unloaded.\n&quot;</span>);
<a name="l01060"></a>01060    <span class="keywordflow">return</span> 0;
<a name="l01061"></a>01061 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a375a41c8f5c188809ca9383c99e7112a"></a><!-- doxytag: member="res_config_odbc.c::update2_odbc" ref="a375a41c8f5c188809ca9383c99e7112a" args="(const char *database, const char *table, va_list ap)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int update2_odbc </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>database</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">va_list&nbsp;</td>
          <td class="paramname"> <em>ap</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Execute an UPDATE query. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>database</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>table</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ap</em>&nbsp;</td><td>list containing one or more field/value set(s).</td></tr>
  </table>
  </dd>
</dl>
<p>Update a database table, preparing the sql statement from a list of key/value pairs specified in ap. The lookup pairs are specified first and are separated from the update pairs by a sentinel value. Sub-in the <a class="el" href="structvalues.html">values</a> to the prepared statement and execute it.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structnumber.html" title="Number structure.">number</a></em>&nbsp;</td><td>of rows affected </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="res__config__odbc_8c_source.html#l00582">582</a> of file <a class="el" href="res__config__odbc_8c_source.html">res_config_odbc.c</a>.</p>

<p>References <a class="el" href="res__config__odbc_8c_source.html#l00482">update2_prepare_struct::ap</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="res__odbc_8c_source.html#l00593">ast_odbc_prepare_and_execute()</a>, <a class="el" href="res__odbc_8c_source.html#l01041">ast_odbc_release_obj()</a>, <a class="el" href="res__odbc_8c_source.html#l01331">ast_odbc_request_obj()</a>, <a class="el" href="strings_8h_source.html#l00488">ast_str_buffer()</a>, <a class="el" href="strings_8h_source.html#l00637">ast_str_thread_get()</a>, <a class="el" href="res__config__odbc_8c_source.html#l00480">update2_prepare_struct::database</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="res__config__odbc_8c_source.html#l00048">sql_buf</a>, and <a class="el" href="res__config__odbc_8c_source.html#l00485">update2_prepare()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00583"></a>00583 {
<a name="l00584"></a>00584    <span class="keyword">struct </span><a class="code" href="structodbc__obj.html" title="ODBC container.">odbc_obj</a> *obj;
<a name="l00585"></a>00585    SQLHSTMT stmt;
<a name="l00586"></a>00586    <span class="keyword">struct </span><a class="code" href="structupdate2__prepare__struct.html">update2_prepare_struct</a> ups = { .database = <a class="code" href="structupdate2__prepare__struct.html#a53d0c97c2202a2386262cfeca447b392">database</a>, .table = <a class="code" href="cdr__odbc_8c.html#a68d1e6e752f2cf81551fac543cae108a">table</a>, };
<a name="l00587"></a>00587    <span class="keyword">struct </span><a class="code" href="structast__str.html" title="The descriptor of a dynamic string XXX storage will be optimized later if needed...">ast_str</a> *sql;
<a name="l00588"></a>00588    <span class="keywordtype">int</span> res;
<a name="l00589"></a>00589    SQLLEN rowcount = 0;
<a name="l00590"></a>00590 
<a name="l00591"></a>00591    va_copy(ups.<a class="code" href="structupdate2__prepare__struct.html#aba0d2a7f015cf887da8af71f5014280b">ap</a>, ap);
<a name="l00592"></a>00592 
<a name="l00593"></a>00593    <span class="keywordflow">if</span> (!(obj = <a class="code" href="res__odbc_8h.html#ad34ae2bdba165ef6c7405afc94f2a7f3">ast_odbc_request_obj</a>(database, 0))) {
<a name="l00594"></a>00594       <span class="keywordflow">return</span> -1;
<a name="l00595"></a>00595    }
<a name="l00596"></a>00596 
<a name="l00597"></a>00597    <span class="keywordflow">if</span> (!(stmt = <a class="code" href="res__odbc_8h.html#ad1e82a2b1ba4eda1924d8b8f591de065" title="Prepares, executes, and returns the resulting statement handle.">ast_odbc_prepare_and_execute</a>(obj, <a class="code" href="res__config__odbc_8c.html#a6186be46bd20ad42812bfd719cfef978">update2_prepare</a>, &amp;ups))) {
<a name="l00598"></a>00598       <a class="code" href="res__odbc_8h.html#a78d14d1dd01c269c9c0a47b49475eeea" title="Releases an ODBC object previously allocated by odbc_request_obj().">ast_odbc_release_obj</a>(obj);
<a name="l00599"></a>00599       <span class="keywordflow">return</span> -1;
<a name="l00600"></a>00600    }
<a name="l00601"></a>00601 
<a name="l00602"></a>00602    res = SQLRowCount(stmt, &amp;rowcount);
<a name="l00603"></a>00603    SQLFreeHandle(SQL_HANDLE_STMT, stmt);
<a name="l00604"></a>00604    <a class="code" href="res__odbc_8h.html#a78d14d1dd01c269c9c0a47b49475eeea" title="Releases an ODBC object previously allocated by odbc_request_obj().">ast_odbc_release_obj</a>(obj);
<a name="l00605"></a>00605 
<a name="l00606"></a>00606    <span class="keywordflow">if</span> ((res != SQL_SUCCESS) &amp;&amp; (res != SQL_SUCCESS_WITH_INFO)) {
<a name="l00607"></a>00607       <span class="comment">/* Since only a single thread can access this memory, we can retrieve what would otherwise be lost. */</span>
<a name="l00608"></a>00608       sql = <a class="code" href="strings_8h.html#affe8ca3cf8ee9ab07fe29d11bc824ac4" title="Retrieve a thread locally stored dynamic string.">ast_str_thread_get</a>(&amp;<a class="code" href="res__config__odbc_8c.html#afc4bfa5a94710e6f323a1033f82425b3">sql_buf</a>, 16);
<a name="l00609"></a>00609       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;SQL Row Count error!\n[%s]\n&quot;</span>, <a class="code" href="strings_8h.html#a053bdfc229997a75f112bdd7b995e00b" title="Returns the string buffer within the ast_str buf.">ast_str_buffer</a>(sql));
<a name="l00610"></a>00610       <span class="keywordflow">return</span> -1;
<a name="l00611"></a>00611    }
<a name="l00612"></a>00612 
<a name="l00613"></a>00613    <span class="keywordflow">if</span> (rowcount &gt;= 0) {
<a name="l00614"></a>00614       <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)rowcount;
<a name="l00615"></a>00615    }
<a name="l00616"></a>00616 
<a name="l00617"></a>00617    <span class="keywordflow">return</span> -1;
<a name="l00618"></a>00618 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6186be46bd20ad42812bfd719cfef978"></a><!-- doxytag: member="res_config_odbc.c::update2_prepare" ref="a6186be46bd20ad42812bfd719cfef978" args="(struct odbc_obj *obj, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static SQLHSTMT update2_prepare </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structodbc__obj.html">odbc_obj</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__odbc_8c_source.html#l00485">485</a> of file <a class="el" href="res__config__odbc_8c_source.html">res_config_odbc.c</a>.</p>

<p>References <a class="el" href="res__config__odbc_8c_source.html#l00482">update2_prepare_struct::ap</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="res__odbc_8c_source.html#l00540">ast_odbc_find_column()</a>, <a class="el" href="res__odbc_8c_source.html#l00425">ast_odbc_find_table()</a>, <a class="el" href="res__odbc_8h_source.html#l00212">ast_odbc_release_table</a>, <a class="el" href="strings_8h_source.html#l00846">ast_str_append()</a>, <a class="el" href="strings_8h_source.html#l00488">ast_str_buffer()</a>, <a class="el" href="strings_8h_source.html#l00825">ast_str_set()</a>, <a class="el" href="strings_8h_source.html#l00637">ast_str_thread_get()</a>, <a class="el" href="res__odbc_8h_source.html#l00047">odbc_obj::con</a>, <a class="el" href="res__config__odbc_8c_source.html#l00480">update2_prepare_struct::database</a>, <a class="el" href="devicestate_8c_source.html#l00198">first</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="res__config__odbc_8c_source.html#l00048">sql_buf</a>, and <a class="el" href="res__config__odbc_8c_source.html#l00481">update2_prepare_struct::table</a>.</p>

<p>Referenced by <a class="el" href="res__config__odbc_8c_source.html#l00582">update2_odbc()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00486"></a>00486 {
<a name="l00487"></a>00487    <span class="keywordtype">int</span> res, x = 1, <a class="code" href="devicestate_8c.html#abd2135e6f8a41bc900933b1985d97165">first</a> = 1;
<a name="l00488"></a>00488    <span class="keyword">struct </span><a class="code" href="structupdate2__prepare__struct.html">update2_prepare_struct</a> *ups = data;
<a name="l00489"></a>00489    <span class="keyword">const</span> <span class="keywordtype">char</span> *newparam, *newval;
<a name="l00490"></a>00490    <span class="keyword">struct </span><a class="code" href="structast__str.html" title="The descriptor of a dynamic string XXX storage will be optimized later if needed...">ast_str</a> *sql = <a class="code" href="strings_8h.html#affe8ca3cf8ee9ab07fe29d11bc824ac4" title="Retrieve a thread locally stored dynamic string.">ast_str_thread_get</a>(&amp;<a class="code" href="res__config__odbc_8c.html#afc4bfa5a94710e6f323a1033f82425b3">sql_buf</a>, 16);
<a name="l00491"></a>00491    SQLHSTMT stmt;
<a name="l00492"></a>00492    va_list ap;
<a name="l00493"></a>00493    <span class="keyword">struct </span><a class="code" href="structodbc__cache__tables.html">odbc_cache_tables</a> *tableptr = <a class="code" href="res__odbc_8h.html#aa15ed6f1d16784d3e2961c0bef9352c8" title="Find or create an entry describing the table specified.">ast_odbc_find_table</a>(ups-&gt;<a class="code" href="structupdate2__prepare__struct.html#a53d0c97c2202a2386262cfeca447b392">database</a>, ups-&gt;<a class="code" href="structupdate2__prepare__struct.html#a490f3d07e6b7376ac6a95b62ed1633d0">table</a>);
<a name="l00494"></a>00494    <span class="keyword">struct </span><a class="code" href="structodbc__cache__columns.html">odbc_cache_columns</a> *column;
<a name="l00495"></a>00495 
<a name="l00496"></a>00496    <span class="keywordflow">if</span> (!sql) {
<a name="l00497"></a>00497       <span class="keywordflow">if</span> (tableptr) {
<a name="l00498"></a>00498          <a class="code" href="res__odbc_8h.html#a9aaeb9d433261beabf9ae1cc24566397" title="Release a table returned from ast_odbc_find_table.">ast_odbc_release_table</a>(tableptr);
<a name="l00499"></a>00499       }
<a name="l00500"></a>00500       <span class="keywordflow">return</span> NULL;
<a name="l00501"></a>00501    }
<a name="l00502"></a>00502 
<a name="l00503"></a>00503    <span class="keywordflow">if</span> (!tableptr) {
<a name="l00504"></a>00504       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not retrieve metadata for table &apos;%s@%s&apos;.  Update will fail!\n&quot;</span>, ups-&gt;<a class="code" href="structupdate2__prepare__struct.html#a490f3d07e6b7376ac6a95b62ed1633d0">table</a>, ups-&gt;<a class="code" href="structupdate2__prepare__struct.html#a53d0c97c2202a2386262cfeca447b392">database</a>);
<a name="l00505"></a>00505       <span class="keywordflow">return</span> NULL;
<a name="l00506"></a>00506    }
<a name="l00507"></a>00507 
<a name="l00508"></a>00508    res = SQLAllocHandle(SQL_HANDLE_STMT, obj-&gt;<a class="code" href="structodbc__obj.html#ae83918cc26dc7acd65bbec1712593054">con</a>, &amp;stmt);
<a name="l00509"></a>00509    <span class="keywordflow">if</span> ((res != SQL_SUCCESS) &amp;&amp; (res != SQL_SUCCESS_WITH_INFO)) {
<a name="l00510"></a>00510       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;SQL Alloc Handle failed!\n&quot;</span>);
<a name="l00511"></a>00511       <a class="code" href="res__odbc_8h.html#a9aaeb9d433261beabf9ae1cc24566397" title="Release a table returned from ast_odbc_find_table.">ast_odbc_release_table</a>(tableptr);
<a name="l00512"></a>00512       <span class="keywordflow">return</span> NULL;
<a name="l00513"></a>00513    }
<a name="l00514"></a>00514 
<a name="l00515"></a>00515    <a class="code" href="strings_8h.html#a4a3222f04f84c80a1d70f51e2dff00ea" title="Set a dynamic string using variable arguments.">ast_str_set</a>(&amp;sql, 0, <span class="stringliteral">&quot;UPDATE %s SET &quot;</span>, ups-&gt;<a class="code" href="structupdate2__prepare__struct.html#a490f3d07e6b7376ac6a95b62ed1633d0">table</a>);
<a name="l00516"></a>00516 
<a name="l00517"></a>00517    <span class="comment">/* Start by finding the second set of parameters */</span>
<a name="l00518"></a>00518    va_copy(ap, ups-&gt;<a class="code" href="structupdate2__prepare__struct.html#aba0d2a7f015cf887da8af71f5014280b">ap</a>);
<a name="l00519"></a>00519 
<a name="l00520"></a>00520    <span class="keywordflow">while</span> ((newparam = va_arg(ap, <span class="keyword">const</span> <span class="keywordtype">char</span> *))) {
<a name="l00521"></a>00521       newval = va_arg(ap, <span class="keyword">const</span> <span class="keywordtype">char</span> *);
<a name="l00522"></a>00522    }
<a name="l00523"></a>00523 
<a name="l00524"></a>00524    <span class="keywordflow">while</span> ((newparam = va_arg(ap, <span class="keyword">const</span> <span class="keywordtype">char</span> *))) {
<a name="l00525"></a>00525       newval = va_arg(ap, <span class="keyword">const</span> <span class="keywordtype">char</span> *);
<a name="l00526"></a>00526       <span class="keywordflow">if</span> ((column = <a class="code" href="res__odbc_8h.html#afa284d7796514825c1783efdd5f29c68" title="Find a column entry within a cached table structure.">ast_odbc_find_column</a>(tableptr, newparam))) {
<a name="l00527"></a>00527          <a class="code" href="strings_8h.html#a85cd5a8ef499e39d22b4bfeb8b9a64f7" title="Append to a thread local dynamic string.">ast_str_append</a>(&amp;sql, 0, <span class="stringliteral">&quot;%s%s=? &quot;</span>, <a class="code" href="devicestate_8c.html#abd2135e6f8a41bc900933b1985d97165">first</a> ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;, &quot;</span>, newparam);
<a name="l00528"></a>00528          SQLBindParameter(stmt, x++, SQL_PARAM_INPUT, SQL_C_CHAR, SQL_CHAR, strlen(newval), 0, (<span class="keywordtype">void</span> *)newval, 0, NULL);
<a name="l00529"></a>00529          <a class="code" href="devicestate_8c.html#abd2135e6f8a41bc900933b1985d97165">first</a> = 0;
<a name="l00530"></a>00530       } <span class="keywordflow">else</span> {
<a name="l00531"></a>00531          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Not updating column &apos;%s&apos; in &apos;%s@%s&apos; because that column does not exist!\n&quot;</span>, newparam, ups-&gt;<a class="code" href="structupdate2__prepare__struct.html#a490f3d07e6b7376ac6a95b62ed1633d0">table</a>, ups-&gt;<a class="code" href="structupdate2__prepare__struct.html#a53d0c97c2202a2386262cfeca447b392">database</a>);
<a name="l00532"></a>00532       }
<a name="l00533"></a>00533    }
<a name="l00534"></a>00534    va_end(ap);
<a name="l00535"></a>00535 
<a name="l00536"></a>00536    <span class="comment">/* Restart search, because we need to add the search parameters */</span>
<a name="l00537"></a>00537    va_copy(ap, ups-&gt;<a class="code" href="structupdate2__prepare__struct.html#aba0d2a7f015cf887da8af71f5014280b">ap</a>);
<a name="l00538"></a>00538    <a class="code" href="strings_8h.html#a85cd5a8ef499e39d22b4bfeb8b9a64f7" title="Append to a thread local dynamic string.">ast_str_append</a>(&amp;sql, 0, <span class="stringliteral">&quot;WHERE&quot;</span>);
<a name="l00539"></a>00539    <a class="code" href="devicestate_8c.html#abd2135e6f8a41bc900933b1985d97165">first</a> = 1;
<a name="l00540"></a>00540 
<a name="l00541"></a>00541    <span class="keywordflow">while</span> ((newparam = va_arg(ap, <span class="keyword">const</span> <span class="keywordtype">char</span> *))) {
<a name="l00542"></a>00542       newval = va_arg(ap, <span class="keyword">const</span> <span class="keywordtype">char</span> *);
<a name="l00543"></a>00543       <span class="keywordflow">if</span> (!(column = <a class="code" href="res__odbc_8h.html#afa284d7796514825c1783efdd5f29c68" title="Find a column entry within a cached table structure.">ast_odbc_find_column</a>(tableptr, newparam))) {
<a name="l00544"></a>00544          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;One or more of the criteria columns &apos;%s&apos; on &apos;%s@%s&apos; for this update does not exist!\n&quot;</span>, newparam, ups-&gt;<a class="code" href="structupdate2__prepare__struct.html#a490f3d07e6b7376ac6a95b62ed1633d0">table</a>, ups-&gt;<a class="code" href="structupdate2__prepare__struct.html#a53d0c97c2202a2386262cfeca447b392">database</a>);
<a name="l00545"></a>00545          <a class="code" href="res__odbc_8h.html#a9aaeb9d433261beabf9ae1cc24566397" title="Release a table returned from ast_odbc_find_table.">ast_odbc_release_table</a>(tableptr);
<a name="l00546"></a>00546          SQLFreeHandle(SQL_HANDLE_STMT, stmt);
<a name="l00547"></a>00547          <span class="keywordflow">return</span> NULL;
<a name="l00548"></a>00548       }
<a name="l00549"></a>00549       <a class="code" href="strings_8h.html#a85cd5a8ef499e39d22b4bfeb8b9a64f7" title="Append to a thread local dynamic string.">ast_str_append</a>(&amp;sql, 0, <span class="stringliteral">&quot;%s %s=?&quot;</span>, <a class="code" href="devicestate_8c.html#abd2135e6f8a41bc900933b1985d97165">first</a> ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot; AND&quot;</span>, newparam);
<a name="l00550"></a>00550       SQLBindParameter(stmt, x++, SQL_PARAM_INPUT, SQL_C_CHAR, SQL_CHAR, strlen(newval), 0, (<span class="keywordtype">void</span> *)newval, 0, NULL);
<a name="l00551"></a>00551       <a class="code" href="devicestate_8c.html#abd2135e6f8a41bc900933b1985d97165">first</a> = 0;
<a name="l00552"></a>00552    }
<a name="l00553"></a>00553    va_end(ap);
<a name="l00554"></a>00554 
<a name="l00555"></a>00555    <span class="comment">/* Done with the table metadata */</span>
<a name="l00556"></a>00556    <a class="code" href="res__odbc_8h.html#a9aaeb9d433261beabf9ae1cc24566397" title="Release a table returned from ast_odbc_find_table.">ast_odbc_release_table</a>(tableptr);
<a name="l00557"></a>00557 
<a name="l00558"></a>00558    res = SQLPrepare(stmt, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)<a class="code" href="strings_8h.html#a053bdfc229997a75f112bdd7b995e00b" title="Returns the string buffer within the ast_str buf.">ast_str_buffer</a>(sql), SQL_NTS);
<a name="l00559"></a>00559    <span class="keywordflow">if</span> ((res != SQL_SUCCESS) &amp;&amp; (res != SQL_SUCCESS_WITH_INFO)) {
<a name="l00560"></a>00560       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;SQL Prepare failed![%s]\n&quot;</span>, <a class="code" href="strings_8h.html#a053bdfc229997a75f112bdd7b995e00b" title="Returns the string buffer within the ast_str buf.">ast_str_buffer</a>(sql));
<a name="l00561"></a>00561       SQLFreeHandle(SQL_HANDLE_STMT, stmt);
<a name="l00562"></a>00562       <span class="keywordflow">return</span> NULL;
<a name="l00563"></a>00563    }
<a name="l00564"></a>00564 
<a name="l00565"></a>00565    <span class="keywordflow">return</span> stmt;
<a name="l00566"></a>00566 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1b7a5cbfc56b64b535e75a1ac0268430"></a><!-- doxytag: member="res_config_odbc.c::update_odbc" ref="a1b7a5cbfc56b64b535e75a1ac0268430" args="(const char *database, const char *table, const char *keyfield, const char *lookup, va_list ap)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int update_odbc </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>database</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>keyfield</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>lookup</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">va_list&nbsp;</td>
          <td class="paramname"> <em>ap</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Excute an UPDATE query. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>database</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>table</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>keyfield</em>&nbsp;</td><td>where clause field </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>lookup</em>&nbsp;</td><td>value of field for where clause </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ap</em>&nbsp;</td><td>list containing one or more field/value set(s).</td></tr>
  </table>
  </dd>
</dl>
<p>Update a database table, prepare the sql statement using keyfield and lookup control the <a class="el" href="structnumber.html" title="Number structure.">number</a> of records to change. All <a class="el" href="structvalues.html">values</a> to be changed are stored in ap list. Sub-in the <a class="el" href="structvalues.html">values</a> to the prepared statement and execute it.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structnumber.html" title="Number structure.">number</a></em>&nbsp;</td><td>of rows affected </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="res__config__odbc_8c_source.html#l00404">404</a> of file <a class="el" href="res__config__odbc_8c_source.html">res_config_odbc.c</a>.</p>

<p>References <a class="el" href="res__config__odbc_8c_source.html#l00053">custom_prepare_struct::ap</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="res__odbc_8c_source.html#l00540">ast_odbc_find_column()</a>, <a class="el" href="res__odbc_8c_source.html#l00425">ast_odbc_find_table()</a>, <a class="el" href="res__odbc_8c_source.html#l00593">ast_odbc_prepare_and_execute()</a>, <a class="el" href="res__odbc_8c_source.html#l01041">ast_odbc_release_obj()</a>, <a class="el" href="res__odbc_8h_source.html#l00212">ast_odbc_release_table</a>, <a class="el" href="res__odbc_8c_source.html#l01331">ast_odbc_request_obj()</a>, <a class="el" href="res__config__odbc_8c_source.html#l00057">custom_prepare()</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="res__config__odbc_8c_source.html#l00054">custom_prepare_struct::skip</a>, and <a class="el" href="res__config__odbc_8c_source.html#l00051">custom_prepare_struct::sql</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00405"></a>00405 {
<a name="l00406"></a>00406    <span class="keyword">struct </span><a class="code" href="structodbc__obj.html" title="ODBC container.">odbc_obj</a> *obj;
<a name="l00407"></a>00407    SQLHSTMT stmt;
<a name="l00408"></a>00408    <span class="keywordtype">char</span> sql[256];
<a name="l00409"></a>00409    SQLLEN rowcount=0;
<a name="l00410"></a>00410    <span class="keyword">const</span> <span class="keywordtype">char</span> *newparam, *newval;
<a name="l00411"></a>00411    <span class="keywordtype">int</span> res, count = 1;
<a name="l00412"></a>00412    va_list aq;
<a name="l00413"></a>00413    <span class="keyword">struct </span><a class="code" href="structcustom__prepare__struct.html">custom_prepare_struct</a> cps = { .sql = sql, .extra = lookup };
<a name="l00414"></a>00414    <span class="keyword">struct </span><a class="code" href="structodbc__cache__tables.html">odbc_cache_tables</a> *tableptr = <a class="code" href="res__odbc_8h.html#aa15ed6f1d16784d3e2961c0bef9352c8" title="Find or create an entry describing the table specified.">ast_odbc_find_table</a>(database, <a class="code" href="cdr__odbc_8c.html#a68d1e6e752f2cf81551fac543cae108a">table</a>);
<a name="l00415"></a>00415    <span class="keyword">struct </span><a class="code" href="structodbc__cache__columns.html">odbc_cache_columns</a> *column;
<a name="l00416"></a>00416 
<a name="l00417"></a>00417    va_copy(cps.<a class="code" href="structcustom__prepare__struct.html#aba0d2a7f015cf887da8af71f5014280b">ap</a>, ap);
<a name="l00418"></a>00418    va_copy(aq, ap);
<a name="l00419"></a>00419    
<a name="l00420"></a>00420    <span class="keywordflow">if</span> (!<a class="code" href="cdr__odbc_8c.html#a68d1e6e752f2cf81551fac543cae108a">table</a>) {
<a name="l00421"></a>00421       <a class="code" href="res__odbc_8h.html#a9aaeb9d433261beabf9ae1cc24566397" title="Release a table returned from ast_odbc_find_table.">ast_odbc_release_table</a>(tableptr);
<a name="l00422"></a>00422       <span class="keywordflow">return</span> -1;
<a name="l00423"></a>00423    }
<a name="l00424"></a>00424 
<a name="l00425"></a>00425    obj = <a class="code" href="res__odbc_8h.html#ad34ae2bdba165ef6c7405afc94f2a7f3">ast_odbc_request_obj</a>(database, 0);
<a name="l00426"></a>00426    <span class="keywordflow">if</span> (!obj) {
<a name="l00427"></a>00427       <a class="code" href="res__odbc_8h.html#a9aaeb9d433261beabf9ae1cc24566397" title="Release a table returned from ast_odbc_find_table.">ast_odbc_release_table</a>(tableptr);
<a name="l00428"></a>00428       <span class="keywordflow">return</span> -1;
<a name="l00429"></a>00429    }
<a name="l00430"></a>00430 
<a name="l00431"></a>00431    newparam = va_arg(aq, <span class="keyword">const</span> <span class="keywordtype">char</span> *);
<a name="l00432"></a>00432    <span class="keywordflow">if</span> (!newparam)  {
<a name="l00433"></a>00433       <a class="code" href="res__odbc_8h.html#a78d14d1dd01c269c9c0a47b49475eeea" title="Releases an ODBC object previously allocated by odbc_request_obj().">ast_odbc_release_obj</a>(obj);
<a name="l00434"></a>00434       <a class="code" href="res__odbc_8h.html#a9aaeb9d433261beabf9ae1cc24566397" title="Release a table returned from ast_odbc_find_table.">ast_odbc_release_table</a>(tableptr);
<a name="l00435"></a>00435       <span class="keywordflow">return</span> -1;
<a name="l00436"></a>00436    }
<a name="l00437"></a>00437    newval = va_arg(aq, <span class="keyword">const</span> <span class="keywordtype">char</span> *);
<a name="l00438"></a>00438 
<a name="l00439"></a>00439    <span class="keywordflow">if</span> (tableptr &amp;&amp; !(column = <a class="code" href="res__odbc_8h.html#afa284d7796514825c1783efdd5f29c68" title="Find a column entry within a cached table structure.">ast_odbc_find_column</a>(tableptr, newparam))) {
<a name="l00440"></a>00440       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Key field &apos;%s&apos; does not exist in table &apos;%s@%s&apos;.  Update will fail\n&quot;</span>, newparam, <a class="code" href="cdr__odbc_8c.html#a68d1e6e752f2cf81551fac543cae108a">table</a>, database);
<a name="l00441"></a>00441    }
<a name="l00442"></a>00442 
<a name="l00443"></a>00443    snprintf(sql, <span class="keyword">sizeof</span>(sql), <span class="stringliteral">&quot;UPDATE %s SET %s=?&quot;</span>, <a class="code" href="cdr__odbc_8c.html#a68d1e6e752f2cf81551fac543cae108a">table</a>, newparam);
<a name="l00444"></a>00444    <span class="keywordflow">while</span>((newparam = va_arg(aq, <span class="keyword">const</span> <span class="keywordtype">char</span> *))) {
<a name="l00445"></a>00445       newval = va_arg(aq, <span class="keyword">const</span> <span class="keywordtype">char</span> *);
<a name="l00446"></a>00446       <span class="keywordflow">if</span> ((tableptr &amp;&amp; (column = <a class="code" href="res__odbc_8h.html#afa284d7796514825c1783efdd5f29c68" title="Find a column entry within a cached table structure.">ast_odbc_find_column</a>(tableptr, newparam))) || count &gt; 63) {
<a name="l00447"></a>00447          snprintf(sql + strlen(sql), <span class="keyword">sizeof</span>(sql) - strlen(sql), <span class="stringliteral">&quot;, %s=?&quot;</span>, newparam);
<a name="l00448"></a>00448       } <span class="keywordflow">else</span> { <span class="comment">/* the column does not exist in the table */</span>
<a name="l00449"></a>00449          cps.<a class="code" href="structcustom__prepare__struct.html#a6ee44de20e6dfc70683517f91ecbc053">skip</a> |= (1LL &lt;&lt; count);
<a name="l00450"></a>00450       }
<a name="l00451"></a>00451       count++;
<a name="l00452"></a>00452    }
<a name="l00453"></a>00453    va_end(aq);
<a name="l00454"></a>00454    snprintf(sql + strlen(sql), <span class="keyword">sizeof</span>(sql) - strlen(sql), <span class="stringliteral">&quot; WHERE %s=?&quot;</span>, keyfield);
<a name="l00455"></a>00455    <a class="code" href="res__odbc_8h.html#a9aaeb9d433261beabf9ae1cc24566397" title="Release a table returned from ast_odbc_find_table.">ast_odbc_release_table</a>(tableptr);
<a name="l00456"></a>00456 
<a name="l00457"></a>00457    stmt = <a class="code" href="res__odbc_8h.html#ad1e82a2b1ba4eda1924d8b8f591de065" title="Prepares, executes, and returns the resulting statement handle.">ast_odbc_prepare_and_execute</a>(obj, <a class="code" href="res__config__odbc_8c.html#a9fb0770b5d483240183affa19304b681">custom_prepare</a>, &amp;cps);
<a name="l00458"></a>00458 
<a name="l00459"></a>00459    <span class="keywordflow">if</span> (!stmt) {
<a name="l00460"></a>00460       <a class="code" href="res__odbc_8h.html#a78d14d1dd01c269c9c0a47b49475eeea" title="Releases an ODBC object previously allocated by odbc_request_obj().">ast_odbc_release_obj</a>(obj);
<a name="l00461"></a>00461       <span class="keywordflow">return</span> -1;
<a name="l00462"></a>00462    }
<a name="l00463"></a>00463 
<a name="l00464"></a>00464    res = SQLRowCount(stmt, &amp;rowcount);
<a name="l00465"></a>00465    SQLFreeHandle (SQL_HANDLE_STMT, stmt);
<a name="l00466"></a>00466    <a class="code" href="res__odbc_8h.html#a78d14d1dd01c269c9c0a47b49475eeea" title="Releases an ODBC object previously allocated by odbc_request_obj().">ast_odbc_release_obj</a>(obj);
<a name="l00467"></a>00467 
<a name="l00468"></a>00468    <span class="keywordflow">if</span> ((res != SQL_SUCCESS) &amp;&amp; (res != SQL_SUCCESS_WITH_INFO)) {
<a name="l00469"></a>00469       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;SQL Row Count error!\n[%s]\n\n&quot;</span>, sql);
<a name="l00470"></a>00470       <span class="keywordflow">return</span> -1;
<a name="l00471"></a>00471    }
<a name="l00472"></a>00472 
<a name="l00473"></a>00473    <span class="keywordflow">if</span> (rowcount &gt;= 0)
<a name="l00474"></a>00474       <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)rowcount;
<a name="l00475"></a>00475 
<a name="l00476"></a>00476    <span class="keywordflow">return</span> -1;
<a name="l00477"></a>00477 }
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="ab22f32016155f7f403e7178767163d7d"></a><!-- doxytag: member="res_config_odbc.c::__mod_info" ref="ab22f32016155f7f403e7178767163d7d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__module__info.html">ast_module_info</a> <a class="el" href="res__timing__timerfd_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a> = { .<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = AST_MODULE, .flags = AST_MODFLAG_GLOBAL_SYMBOLS , .<a class="el" href="callerid_8c.html#a68344fa88cf4e86b5079fd69a5c22d57">description</a> = &quot;Realtime ODBC configuration&quot; , .key = &quot;This paragraph is copyright (c) 2006 by Digium, Inc. \In order for your module to load, it must return this \key via a function called \&quot;key\&quot;. Any code which \includes this paragraph must be licensed under the GNU \General Public License <a class="el" href="res__config__pgsql_8c.html#aad880fc4455c253781e8968f2239d56f">version</a> 2 or later (at your \option). In addition to Digium's general reservations \of rights, Digium expressly reserves the right to \allow other parties to license this paragraph under \different terms. Any use of Digium, Inc. trademarks or \logos (including \&quot;Asterisk\&quot; or \&quot;Digium\&quot;) without \express written <a class="el" href="structpermission.html">permission</a> of Digium, Inc. is prohibited.\n&quot; , .buildopt_sum = &quot;aefddfaffd51bc118c14a748e96eb9a0&quot; , .load = load_module, .unload = unload_module, .reload = reload_module, }<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__odbc_8c_source.html#l01079">1079</a> of file <a class="el" href="res__config__odbc_8c_source.html">res_config_odbc.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae25b9f3970870610911f8850897e8ead"></a><!-- doxytag: member="res_config_odbc.c::ast_module_info" ref="ae25b9f3970870610911f8850897e8ead" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__module__info.html">ast_module_info</a>* <a class="el" href="structast__module__info.html">ast_module_info</a> = &amp;<a class="el" href="res__timing__timerfd_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__odbc_8c_source.html#l01079">1079</a> of file <a class="el" href="res__config__odbc_8c_source.html">res_config_odbc.c</a>.</p>

</div>
</div>
<a class="anchor" id="a0db7ee1d52bac64062bb76ed957432bb"></a><!-- doxytag: member="res_config_odbc.c::odbc_engine" ref="a0db7ee1d52bac64062bb76ed957432bb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__config__engine.html">ast_config_engine</a> <a class="el" href="res__config__odbc_8c.html#a0db7ee1d52bac64062bb76ed957432bb">odbc_engine</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__odbc_8c_source.html#l01042">1042</a> of file <a class="el" href="res__config__odbc_8c_source.html">res_config_odbc.c</a>.</p>

</div>
</div>
<a class="anchor" id="afc4bfa5a94710e6f323a1033f82425b3"></a><!-- doxytag: member="res_config_odbc.c::sql_buf" ref="afc4bfa5a94710e6f323a1033f82425b3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__threadstorage.html">ast_threadstorage</a> <a class="el" href="res__config__sqlite_8c.html#afc4bfa5a94710e6f323a1033f82425b3">sql_buf</a> = { .once = PTHREAD_ONCE_INIT , .key_init = __init_sql_buf , .custom_init = NULL , }<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__odbc_8c_source.html#l00048">48</a> of file <a class="el" href="res__config__odbc_8c_source.html">res_config_odbc.c</a>.</p>

<p>Referenced by <a class="el" href="func__odbc_8c_source.html#l00375">acf_odbc_read()</a>, <a class="el" href="func__odbc_8c_source.html#l00203">acf_odbc_write()</a>, <a class="el" href="func__odbc_8c_source.html#l00978">cli_odbc_read()</a>, <a class="el" href="func__odbc_8c_source.html#l01177">cli_odbc_write()</a>, <a class="el" href="res__config__odbc_8c_source.html#l00582">update2_odbc()</a>, and <a class="el" href="res__config__odbc_8c_source.html#l00485">update2_prepare()</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:23:10 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
