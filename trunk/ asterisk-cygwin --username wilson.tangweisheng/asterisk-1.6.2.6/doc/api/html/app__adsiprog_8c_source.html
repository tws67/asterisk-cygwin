<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:18:24 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_7739c4bd2a7c382676c2c912043775c7.html">apps</a>
  </div>
</div>
<div class="contents">
<h1>app_adsiprog.c</h1><a href="app__adsiprog_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Asterisk -- An open source telephony toolkit.</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * Copyright (C) 1999 - 2005, Digium, Inc.</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * Mark Spencer &lt;markster@digium.com&gt;</span>
<a name="l00007"></a>00007 <span class="comment"> *</span>
<a name="l00008"></a>00008 <span class="comment"> * See http://www.asterisk.org for more information about</span>
<a name="l00009"></a>00009 <span class="comment"> * the Asterisk project. Please do not directly contact</span>
<a name="l00010"></a>00010 <span class="comment"> * any of the maintainers of this project for assistance;</span>
<a name="l00011"></a>00011 <span class="comment"> * the project provides a web site, mailing lists and IRC</span>
<a name="l00012"></a>00012 <span class="comment"> * channels for your use.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * This program is free software, distributed under the terms of</span>
<a name="l00015"></a>00015 <span class="comment"> * the GNU General Public License Version 2. See the LICENSE file</span>
<a name="l00016"></a>00016 <span class="comment"> * at the top of the source tree.</span>
<a name="l00017"></a>00017 <span class="comment"> */</span>
<a name="l00018"></a>00018 <span class="comment"></span>
<a name="l00019"></a>00019 <span class="comment">/*! \file</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * \brief Program Asterisk ADSI Scripts into phone</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * \author Mark Spencer &lt;markster@digium.com&gt;</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> * \ingroup applications</span>
<a name="l00026"></a>00026 <span class="comment"> */</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="comment">/*** MODULEINFO</span>
<a name="l00029"></a>00029 <span class="comment">   &lt;depend&gt;res_adsi&lt;/depend&gt;</span>
<a name="l00030"></a>00030 <span class="comment"> ***/</span>
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="asterisk_8h.html" title="Asterisk main include file. File version handling, generic pbx functions.">asterisk.h</a>&quot;</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <a class="code" href="asterisk_8h.html#ab0390be60f8c539a2662df2faf9985c7" title="Register/unregister a source code file with the core.">ASTERISK_FILE_VERSION</a>(__FILE__, <span class="stringliteral">&quot;$Revision: 211580 $&quot;</span>)
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;netinet/in.h&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor"></span><span class="preprocessor">#include &lt;ctype.h&gt;</span>
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="paths_8h.html" title="Asterisk file paths, configured in asterisk.conf.">asterisk/paths.h</a>&quot;</span> <span class="comment">/* use ast_config_AST_CONFIG_DIR */</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="file_8h.html" title="Generic File Format Support. Should be included by clients of the file handling routines...">asterisk/file.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="channel_8h.html" title="General Asterisk PBX channel definitions.">asterisk/channel.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="pbx_8h.html" title="Core PBX routines and definitions.">asterisk/pbx.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="module_8h.html" title="Asterisk module definitions.">asterisk/module.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="adsi_8h.html" title="ADSI Support (built upon Caller*ID).">asterisk/adsi.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="utils_8h.html" title="Utility functions.">asterisk/utils.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="lock_8h.html" title="Asterisk locking-related definitions:ast_mutext_t, ast_rwlock_t and related functions;atomic...">asterisk/lock.h</a>&quot;</span>
<a name="l00047"></a>00047 
<a name="l00048"></a><a class="code" href="app__adsiprog_8c.html#a9e5f57131367eff409b9e0bd7b31aa1a">00048</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="app__adsiprog_8c.html#a9e5f57131367eff409b9e0bd7b31aa1a">app</a> = <span class="stringliteral">&quot;ADSIProg&quot;</span>;
<a name="l00049"></a>00049 
<a name="l00050"></a>00050 <span class="comment">/*** DOCUMENTATION</span>
<a name="l00051"></a>00051 <span class="comment">   &lt;application name=&quot;ADSIProg&quot; language=&quot;en_US&quot;&gt;</span>
<a name="l00052"></a>00052 <span class="comment">      &lt;synopsis&gt;</span>
<a name="l00053"></a>00053 <span class="comment">         Load Asterisk ADSI Scripts into phone</span>
<a name="l00054"></a>00054 <span class="comment">      &lt;/synopsis&gt;</span>
<a name="l00055"></a>00055 <span class="comment">      &lt;syntax&gt;</span>
<a name="l00056"></a>00056 <span class="comment">         &lt;parameter name=&quot;script&quot; required=&quot;false&quot;&gt;</span>
<a name="l00057"></a>00057 <span class="comment">            &lt;para&gt;adsi script to use. If not given uses the default script &lt;filename&gt;asterisk.adsi&lt;/filename&gt;&lt;/para&gt;</span>
<a name="l00058"></a>00058 <span class="comment">         &lt;/parameter&gt;</span>
<a name="l00059"></a>00059 <span class="comment">      &lt;/syntax&gt;</span>
<a name="l00060"></a>00060 <span class="comment">      &lt;description&gt;</span>
<a name="l00061"></a>00061 <span class="comment">         &lt;para&gt;This application programs an ADSI Phone with the given script&lt;/para&gt;</span>
<a name="l00062"></a>00062 <span class="comment">      &lt;/description&gt;</span>
<a name="l00063"></a>00063 <span class="comment">      &lt;see-also&gt;</span>
<a name="l00064"></a>00064 <span class="comment">         &lt;ref type=&quot;application&quot;&gt;GetCPEID&lt;/ref&gt;</span>
<a name="l00065"></a>00065 <span class="comment">         &lt;ref type=&quot;filename&quot;&gt;adsi.conf&lt;/ref&gt;</span>
<a name="l00066"></a>00066 <span class="comment">      &lt;/see-also&gt;</span>
<a name="l00067"></a>00067 <span class="comment">   &lt;/application&gt;</span>
<a name="l00068"></a>00068 <span class="comment"> ***/</span>
<a name="l00069"></a>00069 
<a name="l00070"></a>00070 <span class="comment">/* #define DUMP_MESSAGES */</span>
<a name="l00071"></a>00071 
<a name="l00072"></a><a class="code" href="structadsi__event.html">00072</a> <span class="keyword">struct </span><a class="code" href="structadsi__event.html">adsi_event</a> {
<a name="l00073"></a><a class="code" href="structadsi__event.html#a7441ef0865bcb3db9b8064dd7375c1ea">00073</a>    <span class="keywordtype">int</span> <a class="code" href="structadsi__event.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a>;
<a name="l00074"></a><a class="code" href="structadsi__event.html#a5ac083a645d964373f022d03df4849c8">00074</a>    <span class="keywordtype">char</span> *<a class="code" href="structadsi__event.html#a5ac083a645d964373f022d03df4849c8">name</a>;
<a name="l00075"></a>00075 };
<a name="l00076"></a>00076 
<a name="l00077"></a><a class="code" href="app__adsiprog_8c.html#a31547b3fbfe860fc4518ce2332297f9b">00077</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structadsi__event.html">adsi_event</a> <a class="code" href="app__adsiprog_8c.html#a31547b3fbfe860fc4518ce2332297f9b">events</a>[] = {
<a name="l00078"></a>00078    { 1, <span class="stringliteral">&quot;CALLERID&quot;</span> },
<a name="l00079"></a>00079    { 2, <span class="stringliteral">&quot;VMWI&quot;</span> },
<a name="l00080"></a>00080    { 3, <span class="stringliteral">&quot;NEARANSWER&quot;</span> },
<a name="l00081"></a>00081    { 4, <span class="stringliteral">&quot;FARANSWER&quot;</span> },
<a name="l00082"></a>00082    { 5, <span class="stringliteral">&quot;ENDOFRING&quot;</span> },
<a name="l00083"></a>00083    { 6, <span class="stringliteral">&quot;IDLE&quot;</span> },
<a name="l00084"></a>00084    { 7, <span class="stringliteral">&quot;OFFHOOK&quot;</span> },
<a name="l00085"></a>00085    { 8, <span class="stringliteral">&quot;CIDCW&quot;</span> },
<a name="l00086"></a>00086    { 9, <span class="stringliteral">&quot;BUSY&quot;</span> },
<a name="l00087"></a>00087    { 10, <span class="stringliteral">&quot;FARRING&quot;</span> },
<a name="l00088"></a>00088    { 11, <span class="stringliteral">&quot;DIALTONE&quot;</span> },
<a name="l00089"></a>00089    { 12, <span class="stringliteral">&quot;RECALL&quot;</span> },
<a name="l00090"></a>00090    { 13, <span class="stringliteral">&quot;MESSAGE&quot;</span> },
<a name="l00091"></a>00091    { 14, <span class="stringliteral">&quot;REORDER&quot;</span> },
<a name="l00092"></a>00092    { 15, <span class="stringliteral">&quot;DISTINCTIVERING&quot;</span> },
<a name="l00093"></a>00093    { 16, <span class="stringliteral">&quot;RING&quot;</span> },
<a name="l00094"></a>00094    { 17, <span class="stringliteral">&quot;REMINDERRING&quot;</span> },
<a name="l00095"></a>00095    { 18, <span class="stringliteral">&quot;SPECIALRING&quot;</span> },
<a name="l00096"></a>00096    { 19, <span class="stringliteral">&quot;CODEDRING&quot;</span> },
<a name="l00097"></a>00097    { 20, <span class="stringliteral">&quot;TIMER&quot;</span> },
<a name="l00098"></a>00098    { 21, <span class="stringliteral">&quot;INUSE&quot;</span> },
<a name="l00099"></a>00099    { 22, <span class="stringliteral">&quot;EVENT22&quot;</span> },
<a name="l00100"></a>00100    { 23, <span class="stringliteral">&quot;EVENT23&quot;</span> },
<a name="l00101"></a>00101    { 24, <span class="stringliteral">&quot;CPEID&quot;</span> },
<a name="l00102"></a>00102 };
<a name="l00103"></a>00103 
<a name="l00104"></a><a class="code" href="app__adsiprog_8c.html#ac63d06057e89bc34a690d16229374079">00104</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structadsi__event.html">adsi_event</a> <a class="code" href="app__adsiprog_8c.html#ac63d06057e89bc34a690d16229374079">justify</a>[] = {
<a name="l00105"></a>00105    { 0, <span class="stringliteral">&quot;CENTER&quot;</span> },
<a name="l00106"></a>00106    { 1, <span class="stringliteral">&quot;RIGHT&quot;</span> },
<a name="l00107"></a>00107    { 2, <span class="stringliteral">&quot;LEFT&quot;</span> },
<a name="l00108"></a>00108    { 3, <span class="stringliteral">&quot;INDENT&quot;</span> },
<a name="l00109"></a>00109 };
<a name="l00110"></a>00110 
<a name="l00111"></a><a class="code" href="app__adsiprog_8c.html#ae429c985be88ed048f382511c9ff00de">00111</a> <span class="preprocessor">#define STATE_NORMAL 0</span>
<a name="l00112"></a><a class="code" href="app__adsiprog_8c.html#ad0ab7c996fd8ed836205212f8f71c74a">00112</a> <span class="preprocessor"></span><span class="preprocessor">#define STATE_INKEY  1</span>
<a name="l00113"></a><a class="code" href="app__adsiprog_8c.html#aeab5a3465be5583c64655c66714505e0">00113</a> <span class="preprocessor"></span><span class="preprocessor">#define STATE_INSUB  2</span>
<a name="l00114"></a><a class="code" href="app__adsiprog_8c.html#a85a20e7a24da7888ce6bf37c1d061e7e">00114</a> <span class="preprocessor"></span><span class="preprocessor">#define STATE_INIF   3</span>
<a name="l00115"></a>00115 <span class="preprocessor"></span>
<a name="l00116"></a><a class="code" href="app__adsiprog_8c.html#afe3b99eafa759841f10ef4c1a8ff1700">00116</a> <span class="preprocessor">#define MAX_RET_CODE 20</span>
<a name="l00117"></a><a class="code" href="app__adsiprog_8c.html#ace1dddc6ba6a999e7dc4830453136c34">00117</a> <span class="preprocessor"></span><span class="preprocessor">#define MAX_SUB_LEN  255</span>
<a name="l00118"></a><a class="code" href="app__adsiprog_8c.html#a79fd262be73bcca835b513bfa1d50a1d">00118</a> <span class="preprocessor"></span><span class="preprocessor">#define MAX_MAIN_LEN 1600</span>
<a name="l00119"></a>00119 <span class="preprocessor"></span>
<a name="l00120"></a><a class="code" href="app__adsiprog_8c.html#a4de5ed5fcf59a18b24bc9f6449cc9356">00120</a> <span class="preprocessor">#define ARG_STRING (1 &lt;&lt; 0)</span>
<a name="l00121"></a><a class="code" href="app__adsiprog_8c.html#a3f0af864ac7fb3d21180fb420db64105">00121</a> <span class="preprocessor"></span><span class="preprocessor">#define ARG_NUMBER (1 &lt;&lt; 1)</span>
<a name="l00122"></a>00122 <span class="preprocessor"></span>
<a name="l00123"></a><a class="code" href="structadsi__soft__key.html">00123</a> <span class="keyword">struct </span><a class="code" href="structadsi__soft__key.html">adsi_soft_key</a> {
<a name="l00124"></a><a class="code" href="structadsi__soft__key.html#af781142f98a00b542e50998f1be48230">00124</a>    <span class="keywordtype">char</span> <a class="code" href="structadsi__soft__key.html#af781142f98a00b542e50998f1be48230">vname</a>[40];  <span class="comment">/* Which &quot;variable&quot; is associated with it */</span>
<a name="l00125"></a><a class="code" href="structadsi__soft__key.html#ab6b099f2c0f7e492b8e5bc27627cedbc">00125</a>    <span class="keywordtype">int</span> <a class="code" href="structadsi__soft__key.html#ab6b099f2c0f7e492b8e5bc27627cedbc">retstrlen</a>;   <span class="comment">/* Length of return string */</span>
<a name="l00126"></a><a class="code" href="structadsi__soft__key.html#ad78f07e59e8e533b5c75f6db2012f52e">00126</a>    <span class="keywordtype">int</span> <a class="code" href="structadsi__soft__key.html#ad78f07e59e8e533b5c75f6db2012f52e">initlen</a>;     <span class="comment">/* initial length */</span>
<a name="l00127"></a><a class="code" href="structadsi__soft__key.html#a7441ef0865bcb3db9b8064dd7375c1ea">00127</a>    <span class="keywordtype">int</span> <a class="code" href="structadsi__soft__key.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a>;
<a name="l00128"></a><a class="code" href="structadsi__soft__key.html#a3995c0a64d5c1a1c54b757a5a9237aa2">00128</a>    <span class="keywordtype">int</span> <a class="code" href="structadsi__soft__key.html#a3995c0a64d5c1a1c54b757a5a9237aa2">defined</a>;
<a name="l00129"></a><a class="code" href="structadsi__soft__key.html#a9be5b50ad2d70413ccaa9ba65dd3c733">00129</a>    <span class="keywordtype">char</span> <a class="code" href="structadsi__soft__key.html#a9be5b50ad2d70413ccaa9ba65dd3c733">retstr</a>[80]; <span class="comment">/* Return string data */</span>
<a name="l00130"></a>00130 };
<a name="l00131"></a>00131 
<a name="l00132"></a><a class="code" href="structadsi__subscript.html">00132</a> <span class="keyword">struct </span><a class="code" href="structadsi__subscript.html">adsi_subscript</a> {
<a name="l00133"></a><a class="code" href="structadsi__subscript.html#af781142f98a00b542e50998f1be48230">00133</a>    <span class="keywordtype">char</span> <a class="code" href="structadsi__subscript.html#af781142f98a00b542e50998f1be48230">vname</a>[40];
<a name="l00134"></a><a class="code" href="structadsi__subscript.html#a7441ef0865bcb3db9b8064dd7375c1ea">00134</a>    <span class="keywordtype">int</span> <a class="code" href="structadsi__subscript.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a>;
<a name="l00135"></a><a class="code" href="structadsi__subscript.html#a3995c0a64d5c1a1c54b757a5a9237aa2">00135</a>    <span class="keywordtype">int</span> <a class="code" href="structadsi__subscript.html#a3995c0a64d5c1a1c54b757a5a9237aa2">defined</a>;
<a name="l00136"></a><a class="code" href="structadsi__subscript.html#ad67e07841d1233e596e6f822a3c81f6b">00136</a>    <span class="keywordtype">int</span> <a class="code" href="structadsi__subscript.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>;
<a name="l00137"></a><a class="code" href="structadsi__subscript.html#a27a33e4fca32013b818073cc38355060">00137</a>    <span class="keywordtype">int</span> <a class="code" href="structadsi__subscript.html#a27a33e4fca32013b818073cc38355060">inscount</a>;
<a name="l00138"></a><a class="code" href="structadsi__subscript.html#a90695c7538e691f33a6dad59abb154d9">00138</a>    <span class="keywordtype">int</span> <a class="code" href="structadsi__subscript.html#a90695c7538e691f33a6dad59abb154d9">ifinscount</a>;
<a name="l00139"></a><a class="code" href="structadsi__subscript.html#a8590bbb8ad212e9772ba06ac5e65dc30">00139</a>    <span class="keywordtype">char</span> *<a class="code" href="structadsi__subscript.html#a8590bbb8ad212e9772ba06ac5e65dc30">ifdata</a>;
<a name="l00140"></a><a class="code" href="structadsi__subscript.html#ae75ec805c7e74dcf4dae969c03d32661">00140</a>    <span class="keywordtype">char</span> <a class="code" href="structadsi__subscript.html#ae75ec805c7e74dcf4dae969c03d32661">data</a>[2048];
<a name="l00141"></a>00141 };
<a name="l00142"></a>00142 
<a name="l00143"></a><a class="code" href="structadsi__state.html">00143</a> <span class="keyword">struct </span><a class="code" href="structadsi__state.html">adsi_state</a> {
<a name="l00144"></a><a class="code" href="structadsi__state.html#af781142f98a00b542e50998f1be48230">00144</a>    <span class="keywordtype">char</span> <a class="code" href="structadsi__state.html#af781142f98a00b542e50998f1be48230">vname</a>[40];
<a name="l00145"></a><a class="code" href="structadsi__state.html#a7441ef0865bcb3db9b8064dd7375c1ea">00145</a>    <span class="keywordtype">int</span> <a class="code" href="structadsi__state.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a>;
<a name="l00146"></a>00146 };
<a name="l00147"></a>00147 
<a name="l00148"></a><a class="code" href="structadsi__flag.html">00148</a> <span class="keyword">struct </span><a class="code" href="structadsi__flag.html">adsi_flag</a> {
<a name="l00149"></a><a class="code" href="structadsi__flag.html#af781142f98a00b542e50998f1be48230">00149</a>    <span class="keywordtype">char</span> <a class="code" href="structadsi__flag.html#af781142f98a00b542e50998f1be48230">vname</a>[40];
<a name="l00150"></a><a class="code" href="structadsi__flag.html#a7441ef0865bcb3db9b8064dd7375c1ea">00150</a>    <span class="keywordtype">int</span> <a class="code" href="structadsi__flag.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a>;
<a name="l00151"></a>00151 };
<a name="l00152"></a>00152 
<a name="l00153"></a><a class="code" href="structadsi__display.html">00153</a> <span class="keyword">struct </span><a class="code" href="structadsi__display.html">adsi_display</a> {
<a name="l00154"></a><a class="code" href="structadsi__display.html#af781142f98a00b542e50998f1be48230">00154</a>    <span class="keywordtype">char</span> <a class="code" href="structadsi__display.html#af781142f98a00b542e50998f1be48230">vname</a>[40];
<a name="l00155"></a><a class="code" href="structadsi__display.html#a7441ef0865bcb3db9b8064dd7375c1ea">00155</a>    <span class="keywordtype">int</span> <a class="code" href="structadsi__display.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a>;
<a name="l00156"></a><a class="code" href="structadsi__display.html#a3b33566e63aeeb4d270d4a15a887a48a">00156</a>    <span class="keywordtype">char</span> <a class="code" href="structadsi__display.html#a3b33566e63aeeb4d270d4a15a887a48a">data</a>[70];
<a name="l00157"></a><a class="code" href="structadsi__display.html#ad67e07841d1233e596e6f822a3c81f6b">00157</a>    <span class="keywordtype">int</span> <a class="code" href="structadsi__display.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>;
<a name="l00158"></a>00158 };
<a name="l00159"></a>00159 
<a name="l00160"></a><a class="code" href="structadsi__script.html">00160</a> <span class="keyword">struct </span><a class="code" href="structadsi__script.html">adsi_script</a> {
<a name="l00161"></a><a class="code" href="structadsi__script.html#a89f234133d3efe315836311cbf21c64b">00161</a>    <span class="keywordtype">int</span> <a class="code" href="structstate.html">state</a>;
<a name="l00162"></a><a class="code" href="structadsi__script.html#a2a2bc6427e5e73762ff9ed591294fa7d">00162</a>    <span class="keywordtype">int</span> <a class="code" href="structadsi__script.html#a2a2bc6427e5e73762ff9ed591294fa7d">numkeys</a>;
<a name="l00163"></a><a class="code" href="structadsi__script.html#acd5c8ec5a9d632d17afeacba7bc97366">00163</a>    <span class="keywordtype">int</span> <a class="code" href="structadsi__script.html#acd5c8ec5a9d632d17afeacba7bc97366">numsubs</a>;
<a name="l00164"></a><a class="code" href="structadsi__script.html#abf37fa96cdabb5402cf3c535f561e447">00164</a>    <span class="keywordtype">int</span> <a class="code" href="structadsi__script.html#abf37fa96cdabb5402cf3c535f561e447">numstates</a>;
<a name="l00165"></a><a class="code" href="structadsi__script.html#a2a6f934ad060f9a1e4920791fe4126c8">00165</a>    <span class="keywordtype">int</span> <a class="code" href="structadsi__script.html#a2a6f934ad060f9a1e4920791fe4126c8">numdisplays</a>;
<a name="l00166"></a><a class="code" href="structadsi__script.html#aa46d72056712c28ca547923c36231b51">00166</a>    <span class="keywordtype">int</span> <a class="code" href="structadsi__script.html#aa46d72056712c28ca547923c36231b51">numflags</a>;
<a name="l00167"></a><a class="code" href="structadsi__script.html#af78308364878b8e811a0bb24ff07af58">00167</a>    <span class="keyword">struct </span><a class="code" href="structadsi__soft__key.html">adsi_soft_key</a> *<a class="code" href="structadsi__script.html#af78308364878b8e811a0bb24ff07af58">key</a>;
<a name="l00168"></a><a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">00168</a>    <span class="keyword">struct </span><a class="code" href="structadsi__subscript.html">adsi_subscript</a> *<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>;
<a name="l00169"></a>00169    <span class="comment">/* Pre-defined displays */</span>
<a name="l00170"></a><a class="code" href="structadsi__script.html#ad04f477fcc502d48613cfb4760e4c25d">00170</a>    <span class="keyword">struct </span><a class="code" href="structadsi__display.html">adsi_display</a> <a class="code" href="structadsi__script.html#ad04f477fcc502d48613cfb4760e4c25d">displays</a>[63];
<a name="l00171"></a>00171    <span class="comment">/* ADSI States 1 (initial) - 254 */</span>
<a name="l00172"></a><a class="code" href="structadsi__script.html#aac75fa31598589a8781f905f3ca5838b">00172</a>    <span class="keyword">struct </span><a class="code" href="structadsi__state.html">adsi_state</a> <a class="code" href="structadsi__script.html#aac75fa31598589a8781f905f3ca5838b">states</a>[256];
<a name="l00173"></a>00173    <span class="comment">/* Keys 2-63 */</span>
<a name="l00174"></a><a class="code" href="structadsi__script.html#adfc4c259f04b196894e168eb1eac555f">00174</a>    <span class="keyword">struct </span><a class="code" href="structadsi__soft__key.html">adsi_soft_key</a> <a class="code" href="structkeys.html">keys</a>[62];
<a name="l00175"></a>00175    <span class="comment">/* Subscripts 0 (main) to 127 */</span>
<a name="l00176"></a><a class="code" href="structadsi__script.html#a02c62f8b0c39859e0c9e8556c4c2f404">00176</a>    <span class="keyword">struct </span><a class="code" href="structadsi__subscript.html">adsi_subscript</a> <a class="code" href="structadsi__script.html#a02c62f8b0c39859e0c9e8556c4c2f404">subs</a>[128];
<a name="l00177"></a>00177    <span class="comment">/* Flags 1-7 */</span>
<a name="l00178"></a><a class="code" href="structadsi__script.html#ab7e57f0b0be7486b7a6ace6ef8398aa0">00178</a>    <span class="keyword">struct </span><a class="code" href="structadsi__flag.html">adsi_flag</a> <a class="code" href="structadsi__script.html#ab7e57f0b0be7486b7a6ace6ef8398aa0">flags</a>[7];
<a name="l00179"></a>00179 
<a name="l00180"></a>00180    <span class="comment">/* Stuff from adsi script */</span>
<a name="l00181"></a><a class="code" href="structadsi__script.html#a5b2b7d06455abb1f9961f2ceec99cd80">00181</a>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structadsi__script.html#a5b2b7d06455abb1f9961f2ceec99cd80">sec</a>[5];
<a name="l00182"></a><a class="code" href="structadsi__script.html#a3545dcc45fe896ce213114ea9fba34df">00182</a>    <span class="keywordtype">char</span> <a class="code" href="structadsi__script.html#a3545dcc45fe896ce213114ea9fba34df">desc</a>[19];
<a name="l00183"></a><a class="code" href="structadsi__script.html#a19ee504aa140fcafcb26ce70106819fd">00183</a>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structadsi__script.html#a19ee504aa140fcafcb26ce70106819fd">fdn</a>[5];
<a name="l00184"></a><a class="code" href="structadsi__script.html#a88ca8dd6d8b1535e6ba06c4d988c525b">00184</a>    <span class="keywordtype">int</span> <a class="code" href="structadsi__script.html#a88ca8dd6d8b1535e6ba06c4d988c525b">ver</a>;
<a name="l00185"></a>00185 };
<a name="l00186"></a>00186 
<a name="l00187"></a>00187 
<a name="l00188"></a><a class="code" href="app__adsiprog_8c.html#a18d18d3cbfe73fe1b44532317edf1f38">00188</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="app__adsiprog_8c.html#a18d18d3cbfe73fe1b44532317edf1f38">process_token</a>(<span class="keywordtype">void</span> *out, <span class="keywordtype">char</span> *src, <span class="keywordtype">int</span> maxlen, <span class="keywordtype">int</span> argtype)
<a name="l00189"></a>00189 {
<a name="l00190"></a>00190    <span class="keywordflow">if</span> ((strlen(src) &gt; 1) &amp;&amp; src[0] == <span class="charliteral">&apos;\&quot;&apos;</span>) {
<a name="l00191"></a>00191       <span class="comment">/* This is a quoted string */</span>
<a name="l00192"></a>00192       <span class="keywordflow">if</span> (!(argtype &amp; <a class="code" href="app__adsiprog_8c.html#a4de5ed5fcf59a18b24bc9f6449cc9356">ARG_STRING</a>))
<a name="l00193"></a>00193          <span class="keywordflow">return</span> -1;
<a name="l00194"></a>00194       src++;
<a name="l00195"></a>00195       <span class="comment">/* Don&apos;t take more than what&apos;s there */</span>
<a name="l00196"></a>00196       <span class="keywordflow">if</span> (maxlen &gt; strlen(src) - 1)
<a name="l00197"></a>00197          maxlen = strlen(src) - 1;
<a name="l00198"></a>00198       memcpy(out, src, maxlen);
<a name="l00199"></a>00199       ((<span class="keywordtype">char</span> *)out)[maxlen] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00200"></a>00200    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(src) &amp;&amp; (src[0] == <span class="charliteral">&apos;\\&apos;</span>)) {
<a name="l00201"></a>00201       <span class="keywordflow">if</span> (!(argtype &amp; <a class="code" href="app__adsiprog_8c.html#a3f0af864ac7fb3d21180fb420db64105">ARG_NUMBER</a>))
<a name="l00202"></a>00202          <span class="keywordflow">return</span> -1;
<a name="l00203"></a>00203       <span class="comment">/* Octal value */</span>
<a name="l00204"></a>00204       <span class="keywordflow">if</span> (sscanf(src, <span class="stringliteral">&quot;%30o&quot;</span>, (<span class="keywordtype">int</span> *)out) != 1)
<a name="l00205"></a>00205          <span class="keywordflow">return</span> -1;
<a name="l00206"></a>00206       <span class="keywordflow">if</span> (argtype &amp; <a class="code" href="app__adsiprog_8c.html#a4de5ed5fcf59a18b24bc9f6449cc9356">ARG_STRING</a>) {
<a name="l00207"></a>00207          <span class="comment">/* Convert */</span>
<a name="l00208"></a>00208          *((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *)out) = htonl(*((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *)out));
<a name="l00209"></a>00209       }
<a name="l00210"></a>00210    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((strlen(src) &gt; 2) &amp;&amp; (src[0] == <span class="charliteral">&apos;0&apos;</span>) &amp;&amp; (tolower(src[1]) == <span class="charliteral">&apos;x&apos;</span>)) {
<a name="l00211"></a>00211       <span class="keywordflow">if</span> (!(argtype &amp; <a class="code" href="app__adsiprog_8c.html#a3f0af864ac7fb3d21180fb420db64105">ARG_NUMBER</a>))
<a name="l00212"></a>00212          <span class="keywordflow">return</span> -1;
<a name="l00213"></a>00213       <span class="comment">/* Hex value */</span>
<a name="l00214"></a>00214       <span class="keywordflow">if</span> (sscanf(src + 2, <span class="stringliteral">&quot;%30x&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *)out) != 1)
<a name="l00215"></a>00215          <span class="keywordflow">return</span> -1;
<a name="l00216"></a>00216       <span class="keywordflow">if</span> (argtype &amp; <a class="code" href="app__adsiprog_8c.html#a4de5ed5fcf59a18b24bc9f6449cc9356">ARG_STRING</a>) {
<a name="l00217"></a>00217          <span class="comment">/* Convert */</span>
<a name="l00218"></a>00218          *((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *)out) = htonl(*((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *)out));
<a name="l00219"></a>00219       }
<a name="l00220"></a>00220    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(src) &amp;&amp; isdigit(src[0]))) {
<a name="l00221"></a>00221       <span class="keywordflow">if</span> (!(argtype &amp; <a class="code" href="app__adsiprog_8c.html#a3f0af864ac7fb3d21180fb420db64105">ARG_NUMBER</a>))
<a name="l00222"></a>00222          <span class="keywordflow">return</span> -1;
<a name="l00223"></a>00223       <span class="comment">/* Hex value */</span>
<a name="l00224"></a>00224       <span class="keywordflow">if</span> (sscanf(src, <span class="stringliteral">&quot;%30d&quot;</span>, (<span class="keywordtype">int</span> *)out) != 1)
<a name="l00225"></a>00225          <span class="keywordflow">return</span> -1;
<a name="l00226"></a>00226       <span class="keywordflow">if</span> (argtype &amp; <a class="code" href="app__adsiprog_8c.html#a4de5ed5fcf59a18b24bc9f6449cc9356">ARG_STRING</a>) {
<a name="l00227"></a>00227          <span class="comment">/* Convert */</span>
<a name="l00228"></a>00228          *((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *)out) = htonl(*((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *)out));
<a name="l00229"></a>00229       }
<a name="l00230"></a>00230    } <span class="keywordflow">else</span>
<a name="l00231"></a>00231       <span class="keywordflow">return</span> -1;
<a name="l00232"></a>00232    <span class="keywordflow">return</span> 0;
<a name="l00233"></a>00233 }
<a name="l00234"></a>00234 
<a name="l00235"></a><a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">00235</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(<span class="keywordtype">char</span> **<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <span class="keywordtype">char</span> *script, <span class="keywordtype">int</span> lineno)
<a name="l00236"></a>00236 {
<a name="l00237"></a>00237    <span class="keywordtype">char</span> *tmp = *buf, *keyword;
<a name="l00238"></a>00238    <span class="keywordtype">int</span> quoted = 0;
<a name="l00239"></a>00239 
<a name="l00240"></a>00240    <span class="comment">/* Advance past any white space */</span>
<a name="l00241"></a>00241    <span class="keywordflow">while</span>(*tmp &amp;&amp; (*tmp &lt; 33))
<a name="l00242"></a>00242       tmp++;
<a name="l00243"></a>00243    <span class="keywordflow">if</span> (!*tmp)
<a name="l00244"></a>00244       <span class="keywordflow">return</span> NULL;
<a name="l00245"></a>00245    keyword = tmp;
<a name="l00246"></a>00246    <span class="keywordflow">while</span>(*tmp &amp;&amp; ((*tmp &gt; 32)  || quoted)) {
<a name="l00247"></a>00247       <span class="keywordflow">if</span> (*tmp == <span class="charliteral">&apos;\&quot;&apos;</span>) {
<a name="l00248"></a>00248          quoted = !quoted;
<a name="l00249"></a>00249       }
<a name="l00250"></a>00250       tmp++;
<a name="l00251"></a>00251    }
<a name="l00252"></a>00252    <span class="keywordflow">if</span> (quoted) {
<a name="l00253"></a>00253       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Mismatched quotes at line %d of %s\n&quot;</span>, lineno, script);
<a name="l00254"></a>00254       <span class="keywordflow">return</span> NULL;
<a name="l00255"></a>00255    }
<a name="l00256"></a>00256    *tmp = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00257"></a>00257    tmp++;
<a name="l00258"></a>00258    <span class="keywordflow">while</span>(*tmp &amp;&amp; (*tmp &lt; 33))
<a name="l00259"></a>00259       tmp++;
<a name="l00260"></a>00260    <span class="comment">/* Note where we left off */</span>
<a name="l00261"></a>00261    *buf = tmp;
<a name="l00262"></a>00262    <span class="keywordflow">return</span> keyword;
<a name="l00263"></a>00263 }
<a name="l00264"></a>00264 
<a name="l00265"></a><a class="code" href="app__adsiprog_8c.html#a7a144fe1d3cc742b2238912502bdb187">00265</a> <span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="app__adsiprog_8c.html#a7a144fe1d3cc742b2238912502bdb187">validdtmf</a> = <span class="stringliteral">&quot;123456789*0#ABCD&quot;</span>;
<a name="l00266"></a>00266 
<a name="l00267"></a><a class="code" href="app__adsiprog_8c.html#ada9512fb0d6c34e029b1a9e50bfbe317">00267</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="app__adsiprog_8c.html#ada9512fb0d6c34e029b1a9e50bfbe317">send_dtmf</a>(<span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <span class="keywordtype">char</span> *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keywordtype">char</span> *args, <span class="keyword">struct</span> <a class="code" href="structadsi__script.html">adsi_script</a> *<a class="code" href="structstate.html">state</a>, <span class="keywordtype">char</span> *script, <span class="keywordtype">int</span> lineno)
<a name="l00268"></a>00268 {
<a name="l00269"></a>00269    <span class="keywordtype">char</span> <a class="code" href="chan__sip_8c.html#a1d83a7ddc8e158e8f6888c0019dd6ff7" title="mapping between dtmf flags and strings">dtmfstr</a>[80], *a;
<a name="l00270"></a>00270    <span class="keywordtype">int</span> bytes = 0;
<a name="l00271"></a>00271 
<a name="l00272"></a>00272    <span class="keywordflow">if</span> (!(a = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;args, script, lineno))) {
<a name="l00273"></a>00273       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Expecting something to send for SENDDTMF at line %d of %s\n&quot;</span>, lineno, script);
<a name="l00274"></a>00274       <span class="keywordflow">return</span> 0;
<a name="l00275"></a>00275    }
<a name="l00276"></a>00276 
<a name="l00277"></a>00277    <span class="keywordflow">if</span> (<a class="code" href="app__adsiprog_8c.html#a18d18d3cbfe73fe1b44532317edf1f38">process_token</a>(dtmfstr, a, <span class="keyword">sizeof</span>(dtmfstr) - 1, <a class="code" href="app__adsiprog_8c.html#a4de5ed5fcf59a18b24bc9f6449cc9356">ARG_STRING</a>)) {
<a name="l00278"></a>00278       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid token for SENDDTMF at line %d of %s\n&quot;</span>, lineno, script);
<a name="l00279"></a>00279       <span class="keywordflow">return</span> 0;
<a name="l00280"></a>00280    }
<a name="l00281"></a>00281 
<a name="l00282"></a>00282    a = dtmfstr;
<a name="l00283"></a>00283 
<a name="l00284"></a>00284    <span class="keywordflow">while</span> (*a) {
<a name="l00285"></a>00285       <span class="keywordflow">if</span> (strchr(validdtmf, *a)) {
<a name="l00286"></a>00286          *buf = *a;
<a name="l00287"></a>00287          buf++;
<a name="l00288"></a>00288          bytes++;
<a name="l00289"></a>00289       } <span class="keywordflow">else</span>
<a name="l00290"></a>00290          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;&apos;%c&apos; is not a valid DTMF tone at line %d of %s\n&quot;</span>, *a, lineno, script);
<a name="l00291"></a>00291       a++;
<a name="l00292"></a>00292    }
<a name="l00293"></a>00293 
<a name="l00294"></a>00294    <span class="keywordflow">return</span> bytes;
<a name="l00295"></a>00295 }
<a name="l00296"></a>00296 
<a name="l00297"></a><a class="code" href="app__adsiprog_8c.html#a9d5836220a5af272e86c9a46356c8523">00297</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="app__adsiprog_8c.html#a9d5836220a5af272e86c9a46356c8523">goto_line</a>(<span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <span class="keywordtype">char</span> *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keywordtype">char</span> *args, <span class="keyword">struct</span> <a class="code" href="structadsi__script.html">adsi_script</a> *<a class="code" href="structstate.html">state</a>, <span class="keywordtype">char</span> *script, <span class="keywordtype">int</span> lineno)
<a name="l00298"></a>00298 {
<a name="l00299"></a>00299    <span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#a68cf50bee509a6b69603c25cb19921c6">page</a> = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;args, script, lineno);
<a name="l00300"></a>00300    <span class="keywordtype">char</span> *gline = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;args, script, lineno);
<a name="l00301"></a>00301    <span class="keywordtype">int</span> line;
<a name="l00302"></a>00302    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> cmd;
<a name="l00303"></a>00303 
<a name="l00304"></a>00304    <span class="keywordflow">if</span> (!page || !gline) {
<a name="l00305"></a>00305       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Expecting page and line number for GOTOLINE at line %d of %s\n&quot;</span>, lineno, script);
<a name="l00306"></a>00306       <span class="keywordflow">return</span> 0;
<a name="l00307"></a>00307    }
<a name="l00308"></a>00308 
<a name="l00309"></a>00309    <span class="keywordflow">if</span> (!strcasecmp(page, <span class="stringliteral">&quot;INFO&quot;</span>))
<a name="l00310"></a>00310       cmd = 0;
<a name="l00311"></a>00311    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(page, <span class="stringliteral">&quot;COMM&quot;</span>))
<a name="l00312"></a>00312       cmd = 0x80;
<a name="l00313"></a>00313    <span class="keywordflow">else</span> {
<a name="l00314"></a>00314       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Expecting either &apos;INFO&apos; or &apos;COMM&apos; page, got got &apos;%s&apos; at line %d of %s\n&quot;</span>, page, lineno, script);
<a name="l00315"></a>00315       <span class="keywordflow">return</span> 0;
<a name="l00316"></a>00316    }
<a name="l00317"></a>00317 
<a name="l00318"></a>00318    <span class="keywordflow">if</span> (<a class="code" href="app__adsiprog_8c.html#a18d18d3cbfe73fe1b44532317edf1f38">process_token</a>(&amp;line, gline, <span class="keyword">sizeof</span>(line), <a class="code" href="app__adsiprog_8c.html#a3f0af864ac7fb3d21180fb420db64105">ARG_NUMBER</a>)) {
<a name="l00319"></a>00319       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid line number &apos;%s&apos; at line %d of %s\n&quot;</span>, gline, lineno, script);
<a name="l00320"></a>00320       <span class="keywordflow">return</span> 0;
<a name="l00321"></a>00321    }
<a name="l00322"></a>00322 
<a name="l00323"></a>00323    cmd |= line;
<a name="l00324"></a>00324    buf[0] = 0x8b;
<a name="l00325"></a>00325    buf[1] = cmd;
<a name="l00326"></a>00326 
<a name="l00327"></a>00327    <span class="keywordflow">return</span> 2;
<a name="l00328"></a>00328 }
<a name="l00329"></a>00329 
<a name="l00330"></a><a class="code" href="app__adsiprog_8c.html#a39f980c073134c9ec74a13a18355f94d">00330</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="app__adsiprog_8c.html#a39f980c073134c9ec74a13a18355f94d">goto_line_rel</a>(<span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <span class="keywordtype">char</span> *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keywordtype">char</span> *args, <span class="keyword">struct</span> <a class="code" href="structadsi__script.html">adsi_script</a> *<a class="code" href="structstate.html">state</a>, <span class="keywordtype">char</span> *script, <span class="keywordtype">int</span> lineno)
<a name="l00331"></a>00331 {
<a name="l00332"></a>00332    <span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#a946c6fe93168120f0fa86002b4e9d575">dir</a> = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;args, script, lineno);
<a name="l00333"></a>00333    <span class="keywordtype">char</span> *gline = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;args, script, lineno);
<a name="l00334"></a>00334    <span class="keywordtype">int</span> line;
<a name="l00335"></a>00335    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> cmd;
<a name="l00336"></a>00336 
<a name="l00337"></a>00337    <span class="keywordflow">if</span> (!dir || !gline) {
<a name="l00338"></a>00338       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Expecting direction and number of lines for GOTOLINEREL at line %d of %s\n&quot;</span>, lineno, script);
<a name="l00339"></a>00339       <span class="keywordflow">return</span> 0;
<a name="l00340"></a>00340    }
<a name="l00341"></a>00341 
<a name="l00342"></a>00342    <span class="keywordflow">if</span> (!strcasecmp(dir, <span class="stringliteral">&quot;UP&quot;</span>))
<a name="l00343"></a>00343       cmd = 0;
<a name="l00344"></a>00344    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(dir, <span class="stringliteral">&quot;DOWN&quot;</span>))
<a name="l00345"></a>00345       cmd = 0x20;
<a name="l00346"></a>00346    <span class="keywordflow">else</span> {
<a name="l00347"></a>00347       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Expecting either &apos;UP&apos; or &apos;DOWN&apos; direction, got &apos;%s&apos; at line %d of %s\n&quot;</span>, dir, lineno, script);
<a name="l00348"></a>00348       <span class="keywordflow">return</span> 0;
<a name="l00349"></a>00349    }
<a name="l00350"></a>00350 
<a name="l00351"></a>00351    <span class="keywordflow">if</span> (<a class="code" href="app__adsiprog_8c.html#a18d18d3cbfe73fe1b44532317edf1f38">process_token</a>(&amp;line, gline, <span class="keyword">sizeof</span>(line), <a class="code" href="app__adsiprog_8c.html#a3f0af864ac7fb3d21180fb420db64105">ARG_NUMBER</a>)) {
<a name="l00352"></a>00352       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid line number &apos;%s&apos; at line %d of %s\n&quot;</span>, gline, lineno, script);
<a name="l00353"></a>00353       <span class="keywordflow">return</span> 0;
<a name="l00354"></a>00354    }
<a name="l00355"></a>00355 
<a name="l00356"></a>00356    cmd |= line;
<a name="l00357"></a>00357    buf[0] = 0x8c;
<a name="l00358"></a>00358    buf[1] = cmd;
<a name="l00359"></a>00359 
<a name="l00360"></a>00360    <span class="keywordflow">return</span> 2;
<a name="l00361"></a>00361 }
<a name="l00362"></a>00362 
<a name="l00363"></a><a class="code" href="app__adsiprog_8c.html#ac737a6059a6a98d6928b4cad77112983">00363</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="app__adsiprog_8c.html#ac737a6059a6a98d6928b4cad77112983">send_delay</a>(<span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <span class="keywordtype">char</span> *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keywordtype">char</span> *args, <span class="keyword">struct</span> <a class="code" href="structadsi__script.html">adsi_script</a> *<a class="code" href="structstate.html">state</a>, <span class="keywordtype">char</span> *script, <span class="keywordtype">int</span> lineno)
<a name="l00364"></a>00364 {
<a name="l00365"></a>00365    <span class="keywordtype">char</span> *gtime = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;args, script, lineno);
<a name="l00366"></a>00366    <span class="keywordtype">int</span> ms;
<a name="l00367"></a>00367 
<a name="l00368"></a>00368    <span class="keywordflow">if</span> (!gtime) {
<a name="l00369"></a>00369       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Expecting number of milliseconds to wait at line %d of %s\n&quot;</span>, lineno, script);
<a name="l00370"></a>00370       <span class="keywordflow">return</span> 0;
<a name="l00371"></a>00371    }
<a name="l00372"></a>00372 
<a name="l00373"></a>00373    <span class="keywordflow">if</span> (<a class="code" href="app__adsiprog_8c.html#a18d18d3cbfe73fe1b44532317edf1f38">process_token</a>(&amp;ms, gtime, <span class="keyword">sizeof</span>(ms), <a class="code" href="app__adsiprog_8c.html#a3f0af864ac7fb3d21180fb420db64105">ARG_NUMBER</a>)) {
<a name="l00374"></a>00374       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid delay milliseconds &apos;%s&apos; at line %d of %s\n&quot;</span>, gtime, lineno, script);
<a name="l00375"></a>00375       <span class="keywordflow">return</span> 0;
<a name="l00376"></a>00376    }
<a name="l00377"></a>00377 
<a name="l00378"></a>00378    buf[0] = 0x90;
<a name="l00379"></a>00379 
<a name="l00380"></a>00380    <span class="keywordflow">if</span> (<span class="keywordtype">id</span> == 11)
<a name="l00381"></a>00381       buf[1] = ms / 100;
<a name="l00382"></a>00382    <span class="keywordflow">else</span>
<a name="l00383"></a>00383       buf[1] = ms / 10;
<a name="l00384"></a>00384 
<a name="l00385"></a>00385    <span class="keywordflow">return</span> 2;
<a name="l00386"></a>00386 }
<a name="l00387"></a>00387 
<a name="l00388"></a><a class="code" href="app__adsiprog_8c.html#a579ab373f54eddfedbe50fe2b2c77c84">00388</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="app__adsiprog_8c.html#a579ab373f54eddfedbe50fe2b2c77c84">set_state</a>(<span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <span class="keywordtype">char</span> *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keywordtype">char</span> *args, <span class="keyword">struct</span> <a class="code" href="structadsi__script.html">adsi_script</a> *istate, <span class="keywordtype">char</span> *script, <span class="keywordtype">int</span> lineno)
<a name="l00389"></a>00389 {
<a name="l00390"></a>00390    <span class="keywordtype">char</span> *gstate = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;args, script, lineno);
<a name="l00391"></a>00391    <span class="keywordtype">int</span> <a class="code" href="structstate.html">state</a>;
<a name="l00392"></a>00392 
<a name="l00393"></a>00393    <span class="keywordflow">if</span> (!gstate) {
<a name="l00394"></a>00394       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Expecting state number at line %d of %s\n&quot;</span>, lineno, script);
<a name="l00395"></a>00395       <span class="keywordflow">return</span> 0;
<a name="l00396"></a>00396    }
<a name="l00397"></a>00397 
<a name="l00398"></a>00398    <span class="keywordflow">if</span> (<a class="code" href="app__adsiprog_8c.html#a18d18d3cbfe73fe1b44532317edf1f38">process_token</a>(&amp;state, gstate, <span class="keyword">sizeof</span>(state), <a class="code" href="app__adsiprog_8c.html#a3f0af864ac7fb3d21180fb420db64105">ARG_NUMBER</a>)) {
<a name="l00399"></a>00399       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid state number &apos;%s&apos; at line %d of %s\n&quot;</span>, gstate, lineno, script);
<a name="l00400"></a>00400       <span class="keywordflow">return</span> 0;
<a name="l00401"></a>00401    }
<a name="l00402"></a>00402 
<a name="l00403"></a>00403    buf[0] = id;
<a name="l00404"></a>00404    buf[1] = state;
<a name="l00405"></a>00405 
<a name="l00406"></a>00406    <span class="keywordflow">return</span> 2;
<a name="l00407"></a>00407 }
<a name="l00408"></a>00408 
<a name="l00409"></a><a class="code" href="app__adsiprog_8c.html#a2e363f090f0c2bb7c467d5fa19b38156">00409</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="app__adsiprog_8c.html#a2e363f090f0c2bb7c467d5fa19b38156">cleartimer</a>(<span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <span class="keywordtype">char</span> *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keywordtype">char</span> *args, <span class="keyword">struct</span> <a class="code" href="structadsi__script.html">adsi_script</a> *istate, <span class="keywordtype">char</span> *script, <span class="keywordtype">int</span> lineno)
<a name="l00410"></a>00410 {
<a name="l00411"></a>00411    <span class="keywordtype">char</span> *tok = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;args, script, lineno);
<a name="l00412"></a>00412 
<a name="l00413"></a>00413    <span class="keywordflow">if</span> (tok)
<a name="l00414"></a>00414       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Clearing timer requires no arguments (&apos;%s&apos;) at line %d of %s\n&quot;</span>, tok, lineno, script);
<a name="l00415"></a>00415 
<a name="l00416"></a>00416    buf[0] = id;
<a name="l00417"></a>00417 
<a name="l00418"></a>00418    <span class="comment">/* For some reason the clear code is different slightly */</span>
<a name="l00419"></a>00419    <span class="keywordflow">if</span> (<span class="keywordtype">id</span> == 7)
<a name="l00420"></a>00420       buf[1] = 0x10;
<a name="l00421"></a>00421    <span class="keywordflow">else</span>
<a name="l00422"></a>00422       buf[1] = 0x00;
<a name="l00423"></a>00423 
<a name="l00424"></a>00424    <span class="keywordflow">return</span> 2;
<a name="l00425"></a>00425 }
<a name="l00426"></a>00426 
<a name="l00427"></a><a class="code" href="app__adsiprog_8c.html#a3b23848aadf4d0b05ac4edb5162bd999">00427</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structadsi__flag.html">adsi_flag</a> *<a class="code" href="app__adsiprog_8c.html#a3b23848aadf4d0b05ac4edb5162bd999">getflagbyname</a>(<span class="keyword">struct</span> <a class="code" href="structadsi__script.html">adsi_script</a> *<a class="code" href="structstate.html">state</a>, <span class="keywordtype">char</span> *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keywordtype">char</span> *script, <span class="keywordtype">int</span> lineno, <span class="keywordtype">int</span> create)
<a name="l00428"></a>00428 {
<a name="l00429"></a>00429    <span class="keywordtype">int</span> x;
<a name="l00430"></a>00430 
<a name="l00431"></a>00431    <span class="keywordflow">for</span> (x = 0; x &lt; state-&gt;<a class="code" href="structadsi__script.html#aa46d72056712c28ca547923c36231b51">numflags</a>; x++) {
<a name="l00432"></a>00432       <span class="keywordflow">if</span> (!strcasecmp(state-&gt;<a class="code" href="structadsi__script.html#ab7e57f0b0be7486b7a6ace6ef8398aa0">flags</a>[x].<a class="code" href="structadsi__flag.html#af781142f98a00b542e50998f1be48230">vname</a>, name))
<a name="l00433"></a>00433          <span class="keywordflow">return</span> &amp;state-&gt;<a class="code" href="structadsi__script.html#ab7e57f0b0be7486b7a6ace6ef8398aa0">flags</a>[x];
<a name="l00434"></a>00434    }
<a name="l00435"></a>00435 
<a name="l00436"></a>00436    <span class="comment">/* Return now if we&apos;re not allowed to create */</span>
<a name="l00437"></a>00437    <span class="keywordflow">if</span> (!create)
<a name="l00438"></a>00438       <span class="keywordflow">return</span> NULL;
<a name="l00439"></a>00439 
<a name="l00440"></a>00440    <span class="keywordflow">if</span> (state-&gt;<a class="code" href="structadsi__script.html#aa46d72056712c28ca547923c36231b51">numflags</a> &gt; 6) {
<a name="l00441"></a>00441       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No more flag space at line %d of %s\n&quot;</span>, lineno, script);
<a name="l00442"></a>00442       <span class="keywordflow">return</span> NULL;
<a name="l00443"></a>00443    }
<a name="l00444"></a>00444 
<a name="l00445"></a>00445    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(state-&gt;<a class="code" href="structadsi__script.html#ab7e57f0b0be7486b7a6ace6ef8398aa0">flags</a>[state-&gt;<a class="code" href="structadsi__script.html#aa46d72056712c28ca547923c36231b51">numflags</a>].<a class="code" href="structadsi__flag.html#af781142f98a00b542e50998f1be48230">vname</a>, name, <span class="keyword">sizeof</span>(state-&gt;<a class="code" href="structadsi__script.html#ab7e57f0b0be7486b7a6ace6ef8398aa0">flags</a>[state-&gt;<a class="code" href="structadsi__script.html#aa46d72056712c28ca547923c36231b51">numflags</a>].<a class="code" href="structadsi__flag.html#af781142f98a00b542e50998f1be48230">vname</a>));
<a name="l00446"></a>00446    state-&gt;<a class="code" href="structadsi__script.html#ab7e57f0b0be7486b7a6ace6ef8398aa0">flags</a>[state-&gt;<a class="code" href="structadsi__script.html#aa46d72056712c28ca547923c36231b51">numflags</a>].<a class="code" href="structadsi__flag.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a> = state-&gt;<a class="code" href="structadsi__script.html#aa46d72056712c28ca547923c36231b51">numflags</a> + 1;
<a name="l00447"></a>00447    state-&gt;<a class="code" href="structadsi__script.html#aa46d72056712c28ca547923c36231b51">numflags</a>++;
<a name="l00448"></a>00448 
<a name="l00449"></a>00449    <span class="keywordflow">return</span> &amp;state-&gt;<a class="code" href="structadsi__script.html#ab7e57f0b0be7486b7a6ace6ef8398aa0">flags</a>[state-&gt;<a class="code" href="structadsi__script.html#aa46d72056712c28ca547923c36231b51">numflags</a>-1];
<a name="l00450"></a>00450 }
<a name="l00451"></a>00451 
<a name="l00452"></a><a class="code" href="app__adsiprog_8c.html#a32b0053a0da2b937c91e61cffdfdb24d">00452</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="app__adsiprog_8c.html#a32b0053a0da2b937c91e61cffdfdb24d">setflag</a>(<span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <span class="keywordtype">char</span> *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keywordtype">char</span> *args, <span class="keyword">struct</span> <a class="code" href="structadsi__script.html">adsi_script</a> *<a class="code" href="structstate.html">state</a>, <span class="keywordtype">char</span> *script, <span class="keywordtype">int</span> lineno)
<a name="l00453"></a>00453 {
<a name="l00454"></a>00454    <span class="keywordtype">char</span> *tok = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;args, script, lineno);
<a name="l00455"></a>00455    <span class="keywordtype">char</span> sname[80];
<a name="l00456"></a>00456    <span class="keyword">struct </span><a class="code" href="structadsi__flag.html">adsi_flag</a> *flag;
<a name="l00457"></a>00457 
<a name="l00458"></a>00458    <span class="keywordflow">if</span> (!tok) {
<a name="l00459"></a>00459       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Setting flag requires a flag number at line %d of %s\n&quot;</span>, lineno, script);
<a name="l00460"></a>00460       <span class="keywordflow">return</span> 0;
<a name="l00461"></a>00461    }
<a name="l00462"></a>00462 
<a name="l00463"></a>00463    <span class="keywordflow">if</span> (<a class="code" href="app__adsiprog_8c.html#a18d18d3cbfe73fe1b44532317edf1f38">process_token</a>(sname, tok, <span class="keyword">sizeof</span>(sname) - 1, <a class="code" href="app__adsiprog_8c.html#a4de5ed5fcf59a18b24bc9f6449cc9356">ARG_STRING</a>)) {
<a name="l00464"></a>00464       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid flag &apos;%s&apos; at line %d of %s\n&quot;</span>, tok, lineno, script);
<a name="l00465"></a>00465       <span class="keywordflow">return</span> 0;
<a name="l00466"></a>00466    }
<a name="l00467"></a>00467 
<a name="l00468"></a>00468    <span class="keywordflow">if</span> (!(flag = <a class="code" href="app__adsiprog_8c.html#a3b23848aadf4d0b05ac4edb5162bd999">getflagbyname</a>(state, sname, script, lineno, 0))) {
<a name="l00469"></a>00469       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Flag &apos;%s&apos; is undeclared at line %d of %s\n&quot;</span>, sname, lineno, script);
<a name="l00470"></a>00470       <span class="keywordflow">return</span> 0;
<a name="l00471"></a>00471    }
<a name="l00472"></a>00472 
<a name="l00473"></a>00473    buf[0] = id;
<a name="l00474"></a>00474    buf[1] = ((flag-&gt;<a class="code" href="structadsi__flag.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a> &amp; 0x7) &lt;&lt; 4) | 1;
<a name="l00475"></a>00475 
<a name="l00476"></a>00476    <span class="keywordflow">return</span> 2;
<a name="l00477"></a>00477 }
<a name="l00478"></a>00478 
<a name="l00479"></a><a class="code" href="app__adsiprog_8c.html#a93173d73f78d9d75086eeda1fa0f04b3">00479</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="app__adsiprog_8c.html#a93173d73f78d9d75086eeda1fa0f04b3">clearflag</a>(<span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <span class="keywordtype">char</span> *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keywordtype">char</span> *args, <span class="keyword">struct</span> <a class="code" href="structadsi__script.html">adsi_script</a> *<a class="code" href="structstate.html">state</a>, <span class="keywordtype">char</span> *script, <span class="keywordtype">int</span> lineno)
<a name="l00480"></a>00480 {
<a name="l00481"></a>00481    <span class="keywordtype">char</span> *tok = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;args, script, lineno);
<a name="l00482"></a>00482    <span class="keyword">struct </span><a class="code" href="structadsi__flag.html">adsi_flag</a> *flag;
<a name="l00483"></a>00483    <span class="keywordtype">char</span> sname[80];
<a name="l00484"></a>00484 
<a name="l00485"></a>00485    <span class="keywordflow">if</span> (!tok) {
<a name="l00486"></a>00486       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Clearing flag requires a flag number at line %d of %s\n&quot;</span>, lineno, script);
<a name="l00487"></a>00487       <span class="keywordflow">return</span> 0;
<a name="l00488"></a>00488    }
<a name="l00489"></a>00489 
<a name="l00490"></a>00490    <span class="keywordflow">if</span> (<a class="code" href="app__adsiprog_8c.html#a18d18d3cbfe73fe1b44532317edf1f38">process_token</a>(sname, tok, <span class="keyword">sizeof</span>(sname) - 1, <a class="code" href="app__adsiprog_8c.html#a4de5ed5fcf59a18b24bc9f6449cc9356">ARG_STRING</a>)) {
<a name="l00491"></a>00491       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid flag &apos;%s&apos; at line %d of %s\n&quot;</span>, tok, lineno, script);
<a name="l00492"></a>00492       <span class="keywordflow">return</span> 0;
<a name="l00493"></a>00493    }
<a name="l00494"></a>00494 
<a name="l00495"></a>00495    <span class="keywordflow">if</span> (!(flag = <a class="code" href="app__adsiprog_8c.html#a3b23848aadf4d0b05ac4edb5162bd999">getflagbyname</a>(state, sname, script, lineno, 0))) {
<a name="l00496"></a>00496       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Flag &apos;%s&apos; is undeclared at line %d of %s\n&quot;</span>, sname, lineno, script);
<a name="l00497"></a>00497       <span class="keywordflow">return</span> 0;
<a name="l00498"></a>00498    }
<a name="l00499"></a>00499 
<a name="l00500"></a>00500    buf[0] = id;
<a name="l00501"></a>00501    buf[1] = ((flag-&gt;<a class="code" href="structadsi__flag.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a> &amp; 0x7) &lt;&lt; 4);
<a name="l00502"></a>00502 
<a name="l00503"></a>00503    <span class="keywordflow">return</span> 2;
<a name="l00504"></a>00504 }
<a name="l00505"></a>00505 
<a name="l00506"></a><a class="code" href="app__adsiprog_8c.html#a29c7f44fe091705e1fd14cac6ca783a6">00506</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="app__adsiprog_8c.html#a29c7f44fe091705e1fd14cac6ca783a6">starttimer</a>(<span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <span class="keywordtype">char</span> *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keywordtype">char</span> *args, <span class="keyword">struct</span> <a class="code" href="structadsi__script.html">adsi_script</a> *istate, <span class="keywordtype">char</span> *script, <span class="keywordtype">int</span> lineno)
<a name="l00507"></a>00507 {
<a name="l00508"></a>00508    <span class="keywordtype">char</span> *tok = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;args, script, lineno);
<a name="l00509"></a>00509    <span class="keywordtype">int</span> secs;
<a name="l00510"></a>00510 
<a name="l00511"></a>00511    <span class="keywordflow">if</span> (!tok) {
<a name="l00512"></a>00512       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Missing number of seconds at line %d of %s\n&quot;</span>, lineno, script);
<a name="l00513"></a>00513       <span class="keywordflow">return</span> 0;
<a name="l00514"></a>00514    }
<a name="l00515"></a>00515 
<a name="l00516"></a>00516    <span class="keywordflow">if</span> (<a class="code" href="app__adsiprog_8c.html#a18d18d3cbfe73fe1b44532317edf1f38">process_token</a>(&amp;secs, tok, <span class="keyword">sizeof</span>(secs), <a class="code" href="app__adsiprog_8c.html#a3f0af864ac7fb3d21180fb420db64105">ARG_NUMBER</a>)) {
<a name="l00517"></a>00517       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid number of seconds &apos;%s&apos; at line %d of %s\n&quot;</span>, tok, lineno, script);
<a name="l00518"></a>00518       <span class="keywordflow">return</span> 0;
<a name="l00519"></a>00519    }
<a name="l00520"></a>00520 
<a name="l00521"></a>00521    buf[0] = id;
<a name="l00522"></a>00522    buf[1] = 0x1;
<a name="l00523"></a>00523    buf[2] = secs;
<a name="l00524"></a>00524 
<a name="l00525"></a>00525    <span class="keywordflow">return</span> 3;
<a name="l00526"></a>00526 }
<a name="l00527"></a>00527 
<a name="l00528"></a><a class="code" href="app__adsiprog_8c.html#a57fa3d17b7e48989d6c27915ec9def13">00528</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="app__adsiprog_8c.html#a57fa3d17b7e48989d6c27915ec9def13">geteventbyname</a>(<span class="keywordtype">char</span> *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>)
<a name="l00529"></a>00529 {
<a name="l00530"></a>00530    <span class="keywordtype">int</span> x;
<a name="l00531"></a>00531 
<a name="l00532"></a>00532    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(events); x++) {
<a name="l00533"></a>00533       <span class="keywordflow">if</span> (!strcasecmp(events[x].name, name))
<a name="l00534"></a>00534          <span class="keywordflow">return</span> events[x].<span class="keywordtype">id</span>;
<a name="l00535"></a>00535    }
<a name="l00536"></a>00536 
<a name="l00537"></a>00537    <span class="keywordflow">return</span> 0;
<a name="l00538"></a>00538 }
<a name="l00539"></a>00539 
<a name="l00540"></a><a class="code" href="app__adsiprog_8c.html#ac3391dd58f860148905adbc0dea15070">00540</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="app__adsiprog_8c.html#ac3391dd58f860148905adbc0dea15070">getjustifybyname</a>(<span class="keywordtype">char</span> *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>)
<a name="l00541"></a>00541 {
<a name="l00542"></a>00542    <span class="keywordtype">int</span> x;
<a name="l00543"></a>00543 
<a name="l00544"></a>00544    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(justify); x++) {
<a name="l00545"></a>00545       <span class="keywordflow">if</span> (!strcasecmp(justify[x].name, name))
<a name="l00546"></a>00546          <span class="keywordflow">return</span> justify[x].<span class="keywordtype">id</span>;
<a name="l00547"></a>00547    }
<a name="l00548"></a>00548 
<a name="l00549"></a>00549    <span class="keywordflow">return</span> -1;
<a name="l00550"></a>00550 }
<a name="l00551"></a>00551 
<a name="l00552"></a><a class="code" href="app__adsiprog_8c.html#a3777d6a06b016339dd85e08d84202da9">00552</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structadsi__soft__key.html">adsi_soft_key</a> *<a class="code" href="app__adsiprog_8c.html#a3777d6a06b016339dd85e08d84202da9">getkeybyname</a>(<span class="keyword">struct</span> <a class="code" href="structadsi__script.html">adsi_script</a> *<a class="code" href="structstate.html">state</a>, <span class="keywordtype">char</span> *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keywordtype">char</span> *script, <span class="keywordtype">int</span> lineno)
<a name="l00553"></a>00553 {
<a name="l00554"></a>00554    <span class="keywordtype">int</span> x;
<a name="l00555"></a>00555 
<a name="l00556"></a>00556    <span class="keywordflow">for</span> (x = 0; x &lt; state-&gt;<a class="code" href="structadsi__script.html#a2a2bc6427e5e73762ff9ed591294fa7d">numkeys</a>; x++) {
<a name="l00557"></a>00557       <span class="keywordflow">if</span> (!strcasecmp(state-&gt;<a class="code" href="structadsi__script.html#adfc4c259f04b196894e168eb1eac555f">keys</a>[x].<a class="code" href="structadsi__soft__key.html#af781142f98a00b542e50998f1be48230">vname</a>, name))
<a name="l00558"></a>00558          <span class="keywordflow">return</span> &amp;state-&gt;<a class="code" href="structadsi__script.html#adfc4c259f04b196894e168eb1eac555f">keys</a>[x];
<a name="l00559"></a>00559    }
<a name="l00560"></a>00560 
<a name="l00561"></a>00561    <span class="keywordflow">if</span> (state-&gt;<a class="code" href="structadsi__script.html#a2a2bc6427e5e73762ff9ed591294fa7d">numkeys</a> &gt; 61) {
<a name="l00562"></a>00562       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No more key space at line %d of %s\n&quot;</span>, lineno, script);
<a name="l00563"></a>00563       <span class="keywordflow">return</span> NULL;
<a name="l00564"></a>00564    }
<a name="l00565"></a>00565 
<a name="l00566"></a>00566    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(state-&gt;<a class="code" href="structadsi__script.html#adfc4c259f04b196894e168eb1eac555f">keys</a>[state-&gt;<a class="code" href="structadsi__script.html#a2a2bc6427e5e73762ff9ed591294fa7d">numkeys</a>].<a class="code" href="structadsi__soft__key.html#af781142f98a00b542e50998f1be48230">vname</a>, name, <span class="keyword">sizeof</span>(state-&gt;<a class="code" href="structadsi__script.html#adfc4c259f04b196894e168eb1eac555f">keys</a>[state-&gt;<a class="code" href="structadsi__script.html#a2a2bc6427e5e73762ff9ed591294fa7d">numkeys</a>].<a class="code" href="structadsi__soft__key.html#af781142f98a00b542e50998f1be48230">vname</a>));
<a name="l00567"></a>00567    state-&gt;<a class="code" href="structadsi__script.html#adfc4c259f04b196894e168eb1eac555f">keys</a>[state-&gt;<a class="code" href="structadsi__script.html#a2a2bc6427e5e73762ff9ed591294fa7d">numkeys</a>].<a class="code" href="structadsi__soft__key.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a> = state-&gt;<a class="code" href="structadsi__script.html#a2a2bc6427e5e73762ff9ed591294fa7d">numkeys</a> + 2;
<a name="l00568"></a>00568    state-&gt;<a class="code" href="structadsi__script.html#a2a2bc6427e5e73762ff9ed591294fa7d">numkeys</a>++;
<a name="l00569"></a>00569 
<a name="l00570"></a>00570    <span class="keywordflow">return</span> &amp;state-&gt;<a class="code" href="structadsi__script.html#adfc4c259f04b196894e168eb1eac555f">keys</a>[state-&gt;<a class="code" href="structadsi__script.html#a2a2bc6427e5e73762ff9ed591294fa7d">numkeys</a>-1];
<a name="l00571"></a>00571 }
<a name="l00572"></a>00572 
<a name="l00573"></a><a class="code" href="app__adsiprog_8c.html#a5934eb908ac28aa57d044c6d48044ef9">00573</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structadsi__subscript.html">adsi_subscript</a> *<a class="code" href="app__adsiprog_8c.html#a5934eb908ac28aa57d044c6d48044ef9">getsubbyname</a>(<span class="keyword">struct</span> <a class="code" href="structadsi__script.html">adsi_script</a> *<a class="code" href="structstate.html">state</a>, <span class="keywordtype">char</span> *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keywordtype">char</span> *script, <span class="keywordtype">int</span> lineno)
<a name="l00574"></a>00574 {
<a name="l00575"></a>00575    <span class="keywordtype">int</span> x;
<a name="l00576"></a>00576 
<a name="l00577"></a>00577    <span class="keywordflow">for</span> (x = 0; x &lt; state-&gt;<a class="code" href="structadsi__script.html#acd5c8ec5a9d632d17afeacba7bc97366">numsubs</a>; x++) {
<a name="l00578"></a>00578       <span class="keywordflow">if</span> (!strcasecmp(state-&gt;<a class="code" href="structadsi__script.html#a02c62f8b0c39859e0c9e8556c4c2f404">subs</a>[x].<a class="code" href="structadsi__subscript.html#af781142f98a00b542e50998f1be48230">vname</a>, name))
<a name="l00579"></a>00579          <span class="keywordflow">return</span> &amp;state-&gt;<a class="code" href="structadsi__script.html#a02c62f8b0c39859e0c9e8556c4c2f404">subs</a>[x];
<a name="l00580"></a>00580    }
<a name="l00581"></a>00581 
<a name="l00582"></a>00582    <span class="keywordflow">if</span> (state-&gt;<a class="code" href="structadsi__script.html#acd5c8ec5a9d632d17afeacba7bc97366">numsubs</a> &gt; 127) {
<a name="l00583"></a>00583       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No more subscript space at line %d of %s\n&quot;</span>, lineno, script);
<a name="l00584"></a>00584       <span class="keywordflow">return</span> NULL;
<a name="l00585"></a>00585    }
<a name="l00586"></a>00586 
<a name="l00587"></a>00587    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(state-&gt;<a class="code" href="structadsi__script.html#a02c62f8b0c39859e0c9e8556c4c2f404">subs</a>[state-&gt;<a class="code" href="structadsi__script.html#acd5c8ec5a9d632d17afeacba7bc97366">numsubs</a>].<a class="code" href="structadsi__subscript.html#af781142f98a00b542e50998f1be48230">vname</a>, name, <span class="keyword">sizeof</span>(state-&gt;<a class="code" href="structadsi__script.html#a02c62f8b0c39859e0c9e8556c4c2f404">subs</a>[state-&gt;<a class="code" href="structadsi__script.html#acd5c8ec5a9d632d17afeacba7bc97366">numsubs</a>].<a class="code" href="structadsi__subscript.html#af781142f98a00b542e50998f1be48230">vname</a>));
<a name="l00588"></a>00588    state-&gt;<a class="code" href="structadsi__script.html#a02c62f8b0c39859e0c9e8556c4c2f404">subs</a>[state-&gt;<a class="code" href="structadsi__script.html#acd5c8ec5a9d632d17afeacba7bc97366">numsubs</a>].<a class="code" href="structadsi__subscript.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a> = state-&gt;<a class="code" href="structadsi__script.html#acd5c8ec5a9d632d17afeacba7bc97366">numsubs</a>;
<a name="l00589"></a>00589    state-&gt;<a class="code" href="structadsi__script.html#acd5c8ec5a9d632d17afeacba7bc97366">numsubs</a>++;
<a name="l00590"></a>00590 
<a name="l00591"></a>00591    <span class="keywordflow">return</span> &amp;state-&gt;<a class="code" href="structadsi__script.html#a02c62f8b0c39859e0c9e8556c4c2f404">subs</a>[state-&gt;<a class="code" href="structadsi__script.html#acd5c8ec5a9d632d17afeacba7bc97366">numsubs</a>-1];
<a name="l00592"></a>00592 }
<a name="l00593"></a>00593 
<a name="l00594"></a><a class="code" href="app__adsiprog_8c.html#a1d45f6e735132426f82b9e8f7e1dca38">00594</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structadsi__state.html">adsi_state</a> *<a class="code" href="app__adsiprog_8c.html#a1d45f6e735132426f82b9e8f7e1dca38">getstatebyname</a>(<span class="keyword">struct</span> <a class="code" href="structadsi__script.html">adsi_script</a> *<a class="code" href="structstate.html">state</a>, <span class="keywordtype">char</span> *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keywordtype">char</span> *script, <span class="keywordtype">int</span> lineno, <span class="keywordtype">int</span> create)
<a name="l00595"></a>00595 {
<a name="l00596"></a>00596    <span class="keywordtype">int</span> x;
<a name="l00597"></a>00597 
<a name="l00598"></a>00598    <span class="keywordflow">for</span> (x = 0; x &lt;state-&gt;<a class="code" href="structadsi__script.html#abf37fa96cdabb5402cf3c535f561e447">numstates</a>; x++) {
<a name="l00599"></a>00599       <span class="keywordflow">if</span> (!strcasecmp(state-&gt;<a class="code" href="structadsi__script.html#aac75fa31598589a8781f905f3ca5838b">states</a>[x].<a class="code" href="structadsi__state.html#af781142f98a00b542e50998f1be48230">vname</a>, name))
<a name="l00600"></a>00600          <span class="keywordflow">return</span> &amp;state-&gt;<a class="code" href="structadsi__script.html#aac75fa31598589a8781f905f3ca5838b">states</a>[x];
<a name="l00601"></a>00601    }
<a name="l00602"></a>00602 
<a name="l00603"></a>00603    <span class="comment">/* Return now if we&apos;re not allowed to create */</span>
<a name="l00604"></a>00604    <span class="keywordflow">if</span> (!create)
<a name="l00605"></a>00605       <span class="keywordflow">return</span> NULL;
<a name="l00606"></a>00606 
<a name="l00607"></a>00607    <span class="keywordflow">if</span> (state-&gt;<a class="code" href="structadsi__script.html#abf37fa96cdabb5402cf3c535f561e447">numstates</a> &gt; 253) {
<a name="l00608"></a>00608       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No more state space at line %d of %s\n&quot;</span>, lineno, script);
<a name="l00609"></a>00609       <span class="keywordflow">return</span> NULL;
<a name="l00610"></a>00610    }
<a name="l00611"></a>00611 
<a name="l00612"></a>00612    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(state-&gt;<a class="code" href="structadsi__script.html#aac75fa31598589a8781f905f3ca5838b">states</a>[state-&gt;<a class="code" href="structadsi__script.html#abf37fa96cdabb5402cf3c535f561e447">numstates</a>].<a class="code" href="structadsi__state.html#af781142f98a00b542e50998f1be48230">vname</a>, name, <span class="keyword">sizeof</span>(state-&gt;<a class="code" href="structadsi__script.html#aac75fa31598589a8781f905f3ca5838b">states</a>[state-&gt;<a class="code" href="structadsi__script.html#abf37fa96cdabb5402cf3c535f561e447">numstates</a>].<a class="code" href="structadsi__state.html#af781142f98a00b542e50998f1be48230">vname</a>));
<a name="l00613"></a>00613    state-&gt;<a class="code" href="structadsi__script.html#aac75fa31598589a8781f905f3ca5838b">states</a>[state-&gt;<a class="code" href="structadsi__script.html#abf37fa96cdabb5402cf3c535f561e447">numstates</a>].<a class="code" href="structadsi__state.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a> = state-&gt;<a class="code" href="structadsi__script.html#abf37fa96cdabb5402cf3c535f561e447">numstates</a> + 1;
<a name="l00614"></a>00614    state-&gt;<a class="code" href="structadsi__script.html#abf37fa96cdabb5402cf3c535f561e447">numstates</a>++;
<a name="l00615"></a>00615 
<a name="l00616"></a>00616    <span class="keywordflow">return</span> &amp;state-&gt;<a class="code" href="structadsi__script.html#aac75fa31598589a8781f905f3ca5838b">states</a>[state-&gt;<a class="code" href="structadsi__script.html#abf37fa96cdabb5402cf3c535f561e447">numstates</a>-1];
<a name="l00617"></a>00617 }
<a name="l00618"></a>00618 
<a name="l00619"></a><a class="code" href="app__adsiprog_8c.html#a403f26cc1e2121fff693bfb4ef37dbb4">00619</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structadsi__display.html">adsi_display</a> *<a class="code" href="app__adsiprog_8c.html#a403f26cc1e2121fff693bfb4ef37dbb4">getdisplaybyname</a>(<span class="keyword">struct</span> <a class="code" href="structadsi__script.html">adsi_script</a> *<a class="code" href="structstate.html">state</a>, <span class="keywordtype">char</span> *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keywordtype">char</span> *script, <span class="keywordtype">int</span> lineno, <span class="keywordtype">int</span> create)
<a name="l00620"></a>00620 {
<a name="l00621"></a>00621    <span class="keywordtype">int</span> x;
<a name="l00622"></a>00622 
<a name="l00623"></a>00623    <span class="keywordflow">for</span> (x = 0; x &lt; state-&gt;<a class="code" href="structadsi__script.html#a2a6f934ad060f9a1e4920791fe4126c8">numdisplays</a>; x++) {
<a name="l00624"></a>00624       <span class="keywordflow">if</span> (!strcasecmp(state-&gt;<a class="code" href="structadsi__script.html#ad04f477fcc502d48613cfb4760e4c25d">displays</a>[x].<a class="code" href="structadsi__display.html#af781142f98a00b542e50998f1be48230">vname</a>, name))
<a name="l00625"></a>00625          <span class="keywordflow">return</span> &amp;state-&gt;<a class="code" href="structadsi__script.html#ad04f477fcc502d48613cfb4760e4c25d">displays</a>[x];
<a name="l00626"></a>00626    }
<a name="l00627"></a>00627 
<a name="l00628"></a>00628    <span class="comment">/* Return now if we&apos;re not allowed to create */</span>
<a name="l00629"></a>00629    <span class="keywordflow">if</span> (!create)
<a name="l00630"></a>00630       <span class="keywordflow">return</span> NULL;
<a name="l00631"></a>00631 
<a name="l00632"></a>00632    <span class="keywordflow">if</span> (state-&gt;<a class="code" href="structadsi__script.html#a2a6f934ad060f9a1e4920791fe4126c8">numdisplays</a> &gt; 61) {
<a name="l00633"></a>00633       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No more display space at line %d of %s\n&quot;</span>, lineno, script);
<a name="l00634"></a>00634       <span class="keywordflow">return</span> NULL;
<a name="l00635"></a>00635    }
<a name="l00636"></a>00636 
<a name="l00637"></a>00637    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(state-&gt;<a class="code" href="structadsi__script.html#ad04f477fcc502d48613cfb4760e4c25d">displays</a>[state-&gt;<a class="code" href="structadsi__script.html#a2a6f934ad060f9a1e4920791fe4126c8">numdisplays</a>].<a class="code" href="structadsi__display.html#af781142f98a00b542e50998f1be48230">vname</a>, name, <span class="keyword">sizeof</span>(state-&gt;<a class="code" href="structadsi__script.html#ad04f477fcc502d48613cfb4760e4c25d">displays</a>[state-&gt;<a class="code" href="structadsi__script.html#a2a6f934ad060f9a1e4920791fe4126c8">numdisplays</a>].<a class="code" href="structadsi__display.html#af781142f98a00b542e50998f1be48230">vname</a>));
<a name="l00638"></a>00638    state-&gt;<a class="code" href="structadsi__script.html#ad04f477fcc502d48613cfb4760e4c25d">displays</a>[state-&gt;<a class="code" href="structadsi__script.html#a2a6f934ad060f9a1e4920791fe4126c8">numdisplays</a>].<a class="code" href="structadsi__display.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a> = state-&gt;<a class="code" href="structadsi__script.html#a2a6f934ad060f9a1e4920791fe4126c8">numdisplays</a> + 1;
<a name="l00639"></a>00639    state-&gt;<a class="code" href="structadsi__script.html#a2a6f934ad060f9a1e4920791fe4126c8">numdisplays</a>++;
<a name="l00640"></a>00640 
<a name="l00641"></a>00641    <span class="keywordflow">return</span> &amp;state-&gt;<a class="code" href="structadsi__script.html#ad04f477fcc502d48613cfb4760e4c25d">displays</a>[state-&gt;<a class="code" href="structadsi__script.html#a2a6f934ad060f9a1e4920791fe4126c8">numdisplays</a>-1];
<a name="l00642"></a>00642 }
<a name="l00643"></a>00643 
<a name="l00644"></a><a class="code" href="app__adsiprog_8c.html#ad7eb68bb1f346e51907a614bac67bd9b">00644</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="app__adsiprog_8c.html#ad7eb68bb1f346e51907a614bac67bd9b">showkeys</a>(<span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <span class="keywordtype">char</span> *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keywordtype">char</span> *args, <span class="keyword">struct</span> <a class="code" href="structadsi__script.html">adsi_script</a> *<a class="code" href="structstate.html">state</a>, <span class="keywordtype">char</span> *script, <span class="keywordtype">int</span> lineno)
<a name="l00645"></a>00645 {
<a name="l00646"></a>00646    <span class="keywordtype">char</span> *tok, newkey[80];
<a name="l00647"></a>00647    <span class="keywordtype">int</span> bytes, x, flagid = 0;
<a name="l00648"></a>00648    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> keyid[6];
<a name="l00649"></a>00649    <span class="keyword">struct </span><a class="code" href="structadsi__soft__key.html">adsi_soft_key</a> *key;
<a name="l00650"></a>00650    <span class="keyword">struct </span><a class="code" href="structadsi__flag.html">adsi_flag</a> *flag;
<a name="l00651"></a>00651 
<a name="l00652"></a>00652    <span class="keywordflow">for</span> (x = 0; x &lt; 7; x++) {
<a name="l00653"></a>00653       <span class="comment">/* Up to 6 key arguments */</span>
<a name="l00654"></a>00654       <span class="keywordflow">if</span> (!(tok = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;args, script, lineno)))
<a name="l00655"></a>00655          <span class="keywordflow">break</span>;
<a name="l00656"></a>00656       <span class="keywordflow">if</span> (!strcasecmp(tok, <span class="stringliteral">&quot;UNLESS&quot;</span>)) {
<a name="l00657"></a>00657          <span class="comment">/* Check for trailing UNLESS flag */</span>
<a name="l00658"></a>00658          <span class="keywordflow">if</span> (!(tok = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;args, script, lineno)))
<a name="l00659"></a>00659             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Missing argument for UNLESS clause at line %d of %s\n&quot;</span>, lineno, script);
<a name="l00660"></a>00660          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="app__adsiprog_8c.html#a18d18d3cbfe73fe1b44532317edf1f38">process_token</a>(newkey, tok, <span class="keyword">sizeof</span>(newkey) - 1, <a class="code" href="app__adsiprog_8c.html#a4de5ed5fcf59a18b24bc9f6449cc9356">ARG_STRING</a>))
<a name="l00661"></a>00661             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid flag name &apos;%s&apos; at line %d of %s\n&quot;</span>, tok, lineno, script);
<a name="l00662"></a>00662          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!(flag = <a class="code" href="app__adsiprog_8c.html#a3b23848aadf4d0b05ac4edb5162bd999">getflagbyname</a>(state, newkey, script, lineno, 0)))
<a name="l00663"></a>00663             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Flag &apos;%s&apos; is undeclared at line %d of %s\n&quot;</span>, newkey, lineno, script);
<a name="l00664"></a>00664          <span class="keywordflow">else</span>
<a name="l00665"></a>00665             flagid = flag-&gt;<a class="code" href="structadsi__flag.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a>;
<a name="l00666"></a>00666          <span class="keywordflow">if</span> ((tok = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;args, script, lineno)))
<a name="l00667"></a>00667             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Extra arguments after UNLESS clause: &apos;%s&apos; at line %d of %s\n&quot;</span>, tok, lineno, script);
<a name="l00668"></a>00668          <span class="keywordflow">break</span>;
<a name="l00669"></a>00669       }
<a name="l00670"></a>00670       <span class="keywordflow">if</span> (x &gt; 5) {
<a name="l00671"></a>00671          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Only 6 keys can be defined, ignoring &apos;%s&apos; at line %d of %s\n&quot;</span>, tok, lineno, script);
<a name="l00672"></a>00672          <span class="keywordflow">break</span>;
<a name="l00673"></a>00673       }
<a name="l00674"></a>00674       <span class="keywordflow">if</span> (<a class="code" href="app__adsiprog_8c.html#a18d18d3cbfe73fe1b44532317edf1f38">process_token</a>(newkey, tok, <span class="keyword">sizeof</span>(newkey) - 1, <a class="code" href="app__adsiprog_8c.html#a4de5ed5fcf59a18b24bc9f6449cc9356">ARG_STRING</a>)) {
<a name="l00675"></a>00675          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid token for key name: %s\n&quot;</span>, tok);
<a name="l00676"></a>00676          <span class="keywordflow">continue</span>;
<a name="l00677"></a>00677       }
<a name="l00678"></a>00678 
<a name="l00679"></a>00679       <span class="keywordflow">if</span> (!(key = <a class="code" href="app__adsiprog_8c.html#a3777d6a06b016339dd85e08d84202da9">getkeybyname</a>(state, newkey, script, lineno)))
<a name="l00680"></a>00680          <span class="keywordflow">break</span>;
<a name="l00681"></a>00681       keyid[x] = key-&gt;<a class="code" href="structadsi__soft__key.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a>;
<a name="l00682"></a>00682    }
<a name="l00683"></a>00683    buf[0] = id;
<a name="l00684"></a>00684    buf[1] = (flagid &amp; 0x7) &lt;&lt; 3 | (x &amp; 0x7);
<a name="l00685"></a>00685    <span class="keywordflow">for</span> (bytes = 0; bytes &lt; x; bytes++)
<a name="l00686"></a>00686       buf[bytes + 2] = keyid[bytes];
<a name="l00687"></a>00687 
<a name="l00688"></a>00688    <span class="keywordflow">return</span> 2 + x;
<a name="l00689"></a>00689 }
<a name="l00690"></a>00690 
<a name="l00691"></a><a class="code" href="app__adsiprog_8c.html#aa1e8abd1abd66339d2a45f1e71155a59">00691</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="app__adsiprog_8c.html#aa1e8abd1abd66339d2a45f1e71155a59">showdisplay</a>(<span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <span class="keywordtype">char</span> *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keywordtype">char</span> *args, <span class="keyword">struct</span> <a class="code" href="structadsi__script.html">adsi_script</a> *<a class="code" href="structstate.html">state</a>, <span class="keywordtype">char</span> *script, <span class="keywordtype">int</span> lineno)
<a name="l00692"></a>00692 {
<a name="l00693"></a>00693    <span class="keywordtype">char</span> *tok, dispname[80];
<a name="l00694"></a>00694    <span class="keywordtype">int</span> line = 0, flag = 0, cmd = 3;
<a name="l00695"></a>00695    <span class="keyword">struct </span><a class="code" href="structadsi__display.html">adsi_display</a> *disp;
<a name="l00696"></a>00696 
<a name="l00697"></a>00697    <span class="comment">/* Get display */</span>
<a name="l00698"></a>00698    <span class="keywordflow">if</span> (!(tok = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;args, script, lineno)) || <a class="code" href="app__adsiprog_8c.html#a18d18d3cbfe73fe1b44532317edf1f38">process_token</a>(dispname, tok, <span class="keyword">sizeof</span>(dispname) - 1, <a class="code" href="app__adsiprog_8c.html#a4de5ed5fcf59a18b24bc9f6449cc9356">ARG_STRING</a>)) {
<a name="l00699"></a>00699       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid display name: %s at line %d of %s\n&quot;</span>, tok ? tok : <span class="stringliteral">&quot;&lt;nothing&gt;&quot;</span>, lineno, script);
<a name="l00700"></a>00700       <span class="keywordflow">return</span> 0;
<a name="l00701"></a>00701    }
<a name="l00702"></a>00702 
<a name="l00703"></a>00703    <span class="keywordflow">if</span> (!(disp = <a class="code" href="app__adsiprog_8c.html#a403f26cc1e2121fff693bfb4ef37dbb4">getdisplaybyname</a>(state, dispname, script, lineno, 0))) {
<a name="l00704"></a>00704       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Display &apos;%s&apos; is undefined at line %d of %s\n&quot;</span>, dispname, lineno, script);
<a name="l00705"></a>00705       <span class="keywordflow">return</span> 0;
<a name="l00706"></a>00706    }
<a name="l00707"></a>00707 
<a name="l00708"></a>00708    <span class="keywordflow">if</span> (!(tok = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;args, script, lineno)) || strcasecmp(tok, <span class="stringliteral">&quot;AT&quot;</span>)) {
<a name="l00709"></a>00709       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Missing token &apos;AT&apos; at line %d of %s\n&quot;</span>, lineno, script);
<a name="l00710"></a>00710       <span class="keywordflow">return</span> 0;
<a name="l00711"></a>00711    }
<a name="l00712"></a>00712 
<a name="l00713"></a>00713    <span class="comment">/* Get line number */</span>
<a name="l00714"></a>00714    <span class="keywordflow">if</span> (!(tok = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;args, script, lineno)) || <a class="code" href="app__adsiprog_8c.html#a18d18d3cbfe73fe1b44532317edf1f38">process_token</a>(&amp;line, tok, <span class="keyword">sizeof</span>(line), <a class="code" href="app__adsiprog_8c.html#a3f0af864ac7fb3d21180fb420db64105">ARG_NUMBER</a>)) {
<a name="l00715"></a>00715       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid line: &apos;%s&apos; at line %d of %s\n&quot;</span>, tok ? tok : <span class="stringliteral">&quot;&lt;nothing&gt;&quot;</span>, lineno, script);
<a name="l00716"></a>00716       <span class="keywordflow">return</span> 0;
<a name="l00717"></a>00717    }
<a name="l00718"></a>00718 
<a name="l00719"></a>00719    <span class="keywordflow">if</span> ((tok = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;args, script, lineno)) &amp;&amp; !strcasecmp(tok, <span class="stringliteral">&quot;NOUPDATE&quot;</span>)) {
<a name="l00720"></a>00720       cmd = 1;
<a name="l00721"></a>00721       tok = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;args, script, lineno);
<a name="l00722"></a>00722    }
<a name="l00723"></a>00723 
<a name="l00724"></a>00724    <span class="keywordflow">if</span> (tok &amp;&amp; !strcasecmp(tok, <span class="stringliteral">&quot;UNLESS&quot;</span>)) {
<a name="l00725"></a>00725       <span class="comment">/* Check for trailing UNLESS flag */</span>
<a name="l00726"></a>00726       <span class="keywordflow">if</span> (!(tok = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;args, script, lineno)))
<a name="l00727"></a>00727          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Missing argument for UNLESS clause at line %d of %s\n&quot;</span>, lineno, script);
<a name="l00728"></a>00728       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="app__adsiprog_8c.html#a18d18d3cbfe73fe1b44532317edf1f38">process_token</a>(&amp;flag, tok, <span class="keyword">sizeof</span>(flag), <a class="code" href="app__adsiprog_8c.html#a3f0af864ac7fb3d21180fb420db64105">ARG_NUMBER</a>))
<a name="l00729"></a>00729          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid flag number &apos;%s&apos; at line %d of %s\n&quot;</span>, tok, lineno, script);
<a name="l00730"></a>00730 
<a name="l00731"></a>00731       <span class="keywordflow">if</span> ((tok = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;args, script, lineno)))
<a name="l00732"></a>00732          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Extra arguments after UNLESS clause: &apos;%s&apos; at line %d of %s\n&quot;</span>, tok, lineno, script);
<a name="l00733"></a>00733    }
<a name="l00734"></a>00734 
<a name="l00735"></a>00735    buf[0] = id;
<a name="l00736"></a>00736    buf[1] = (cmd &lt;&lt; 6) | (disp-&gt;<a class="code" href="structadsi__display.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a> &amp; 0x3f);
<a name="l00737"></a>00737    buf[2] = ((line &amp; 0x1f) &lt;&lt; 3) | (flag &amp; 0x7);
<a name="l00738"></a>00738 
<a name="l00739"></a>00739    <span class="keywordflow">return</span> 3;
<a name="l00740"></a>00740 }
<a name="l00741"></a>00741 
<a name="l00742"></a><a class="code" href="app__adsiprog_8c.html#a6a303c8fdfb922fb0f88126c12eeb9de">00742</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="app__adsiprog_8c.html#a6a303c8fdfb922fb0f88126c12eeb9de">cleardisplay</a>(<span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <span class="keywordtype">char</span> *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keywordtype">char</span> *args, <span class="keyword">struct</span> <a class="code" href="structadsi__script.html">adsi_script</a> *istate, <span class="keywordtype">char</span> *script, <span class="keywordtype">int</span> lineno)
<a name="l00743"></a>00743 {
<a name="l00744"></a>00744    <span class="keywordtype">char</span> *tok = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;args, script, lineno);
<a name="l00745"></a>00745 
<a name="l00746"></a>00746    <span class="keywordflow">if</span> (tok)
<a name="l00747"></a>00747       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Clearing display requires no arguments (&apos;%s&apos;) at line %d of %s\n&quot;</span>, tok, lineno, script);
<a name="l00748"></a>00748 
<a name="l00749"></a>00749    buf[0] = id;
<a name="l00750"></a>00750    buf[1] = 0x00;
<a name="l00751"></a>00751    <span class="keywordflow">return</span> 2;
<a name="l00752"></a>00752 }
<a name="l00753"></a>00753 
<a name="l00754"></a><a class="code" href="app__adsiprog_8c.html#a88d8f2a01589087f2bf0420f77fb5e28">00754</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="app__adsiprog_8c.html#a88d8f2a01589087f2bf0420f77fb5e28">digitdirect</a>(<span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <span class="keywordtype">char</span> *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keywordtype">char</span> *args, <span class="keyword">struct</span> <a class="code" href="structadsi__script.html">adsi_script</a> *istate, <span class="keywordtype">char</span> *script, <span class="keywordtype">int</span> lineno)
<a name="l00755"></a>00755 {
<a name="l00756"></a>00756    <span class="keywordtype">char</span> *tok = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;args, script, lineno);
<a name="l00757"></a>00757 
<a name="l00758"></a>00758    <span class="keywordflow">if</span> (tok)
<a name="l00759"></a>00759       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Digitdirect requires no arguments (&apos;%s&apos;) at line %d of %s\n&quot;</span>, tok, lineno, script);
<a name="l00760"></a>00760 
<a name="l00761"></a>00761    buf[0] = id;
<a name="l00762"></a>00762    buf[1] = 0x7;
<a name="l00763"></a>00763    <span class="keywordflow">return</span> 2;
<a name="l00764"></a>00764 }
<a name="l00765"></a>00765 
<a name="l00766"></a><a class="code" href="app__adsiprog_8c.html#adc1b5c9884901ea0338273eb0d33c312">00766</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="app__adsiprog_8c.html#adc1b5c9884901ea0338273eb0d33c312">clearcbone</a>(<span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <span class="keywordtype">char</span> *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keywordtype">char</span> *args, <span class="keyword">struct</span> <a class="code" href="structadsi__script.html">adsi_script</a> *istate, <span class="keywordtype">char</span> *script, <span class="keywordtype">int</span> lineno)
<a name="l00767"></a>00767 {
<a name="l00768"></a>00768    <span class="keywordtype">char</span> *tok = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;args, script, lineno);
<a name="l00769"></a>00769 
<a name="l00770"></a>00770    <span class="keywordflow">if</span> (tok)
<a name="l00771"></a>00771       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;CLEARCB1 requires no arguments (&apos;%s&apos;) at line %d of %s\n&quot;</span>, tok, lineno, script);
<a name="l00772"></a>00772 
<a name="l00773"></a>00773    buf[0] = id;
<a name="l00774"></a>00774    buf[1] = 0;
<a name="l00775"></a>00775    <span class="keywordflow">return</span> 2;
<a name="l00776"></a>00776 }
<a name="l00777"></a>00777 
<a name="l00778"></a><a class="code" href="app__adsiprog_8c.html#a74d2b14cf0ce3e57401b37701d595b5c">00778</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="app__adsiprog_8c.html#a74d2b14cf0ce3e57401b37701d595b5c">digitcollect</a>(<span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <span class="keywordtype">char</span> *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keywordtype">char</span> *args, <span class="keyword">struct</span> <a class="code" href="structadsi__script.html">adsi_script</a> *istate, <span class="keywordtype">char</span> *script, <span class="keywordtype">int</span> lineno)
<a name="l00779"></a>00779 {
<a name="l00780"></a>00780    <span class="keywordtype">char</span> *tok = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;args, script, lineno);
<a name="l00781"></a>00781 
<a name="l00782"></a>00782    <span class="keywordflow">if</span> (tok)
<a name="l00783"></a>00783       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Digitcollect requires no arguments (&apos;%s&apos;) at line %d of %s\n&quot;</span>, tok, lineno, script);
<a name="l00784"></a>00784 
<a name="l00785"></a>00785    buf[0] = id;
<a name="l00786"></a>00786    buf[1] = 0xf;
<a name="l00787"></a>00787    <span class="keywordflow">return</span> 2;
<a name="l00788"></a>00788 }
<a name="l00789"></a>00789 
<a name="l00790"></a><a class="code" href="app__adsiprog_8c.html#ae24ea2605bc89726fa500346dedc2990">00790</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="app__adsiprog_8c.html#ae24ea2605bc89726fa500346dedc2990">subscript</a>(<span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <span class="keywordtype">char</span> *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keywordtype">char</span> *args, <span class="keyword">struct</span> <a class="code" href="structadsi__script.html">adsi_script</a> *<a class="code" href="structstate.html">state</a>, <span class="keywordtype">char</span> *script, <span class="keywordtype">int</span> lineno)
<a name="l00791"></a>00791 {
<a name="l00792"></a>00792    <span class="keywordtype">char</span> *tok = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;args, script, lineno);
<a name="l00793"></a>00793    <span class="keywordtype">char</span> subscr[80];
<a name="l00794"></a>00794    <span class="keyword">struct </span><a class="code" href="structadsi__subscript.html">adsi_subscript</a> *sub;
<a name="l00795"></a>00795 
<a name="l00796"></a>00796    <span class="keywordflow">if</span> (!tok) {
<a name="l00797"></a>00797       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Missing subscript to call at line %d of %s\n&quot;</span>, lineno, script);
<a name="l00798"></a>00798       <span class="keywordflow">return</span> 0;
<a name="l00799"></a>00799    }
<a name="l00800"></a>00800 
<a name="l00801"></a>00801    <span class="keywordflow">if</span> (<a class="code" href="app__adsiprog_8c.html#a18d18d3cbfe73fe1b44532317edf1f38">process_token</a>(subscr, tok, <span class="keyword">sizeof</span>(subscr) - 1, <a class="code" href="app__adsiprog_8c.html#a4de5ed5fcf59a18b24bc9f6449cc9356">ARG_STRING</a>)) {
<a name="l00802"></a>00802       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid number of seconds &apos;%s&apos; at line %d of %s\n&quot;</span>, tok, lineno, script);
<a name="l00803"></a>00803       <span class="keywordflow">return</span> 0;
<a name="l00804"></a>00804    }
<a name="l00805"></a>00805 
<a name="l00806"></a>00806    <span class="keywordflow">if</span> (!(sub = <a class="code" href="app__adsiprog_8c.html#a5934eb908ac28aa57d044c6d48044ef9">getsubbyname</a>(state, subscr, script, lineno)))
<a name="l00807"></a>00807       <span class="keywordflow">return</span> 0;
<a name="l00808"></a>00808 
<a name="l00809"></a>00809    buf[0] = 0x9d;
<a name="l00810"></a>00810    buf[1] = sub-&gt;<a class="code" href="structadsi__subscript.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a>;
<a name="l00811"></a>00811 
<a name="l00812"></a>00812    <span class="keywordflow">return</span> 2;
<a name="l00813"></a>00813 }
<a name="l00814"></a>00814 
<a name="l00815"></a><a class="code" href="app__adsiprog_8c.html#a43833621164bdb68407481978b89eccb">00815</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="app__adsiprog_8c.html#a43833621164bdb68407481978b89eccb">onevent</a>(<span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <span class="keywordtype">char</span> *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keywordtype">int</span> <span class="keywordtype">id</span>, <span class="keywordtype">char</span> *args, <span class="keyword">struct</span> <a class="code" href="structadsi__script.html">adsi_script</a> *<a class="code" href="structstate.html">state</a>, <span class="keywordtype">char</span> *script, <span class="keywordtype">int</span> lineno)
<a name="l00816"></a>00816 {
<a name="l00817"></a>00817    <span class="keywordtype">char</span> *tok = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;args, script, lineno);
<a name="l00818"></a>00818    <span class="keywordtype">char</span> subscr[80], sname[80];
<a name="l00819"></a>00819    <span class="keywordtype">int</span> sawin = 0, event, snums[8], scnt = 0, x;
<a name="l00820"></a>00820    <span class="keyword">struct </span><a class="code" href="structadsi__subscript.html">adsi_subscript</a> *sub;
<a name="l00821"></a>00821 
<a name="l00822"></a>00822    <span class="keywordflow">if</span> (!tok) {
<a name="l00823"></a>00823       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Missing event for &apos;ONEVENT&apos; at line %d of %s\n&quot;</span>, lineno, script);
<a name="l00824"></a>00824       <span class="keywordflow">return</span> 0;
<a name="l00825"></a>00825    }
<a name="l00826"></a>00826 
<a name="l00827"></a>00827    <span class="keywordflow">if</span> ((event = <a class="code" href="app__adsiprog_8c.html#a57fa3d17b7e48989d6c27915ec9def13">geteventbyname</a>(tok)) &lt; 1) {
<a name="l00828"></a>00828       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;&apos;%s&apos; is not a valid event name, at line %d of %s\n&quot;</span>, args, lineno, script);
<a name="l00829"></a>00829       <span class="keywordflow">return</span> 0;
<a name="l00830"></a>00830    }
<a name="l00831"></a>00831 
<a name="l00832"></a>00832    tok = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;args, script, lineno);
<a name="l00833"></a>00833    <span class="keywordflow">while</span> ((!sawin &amp;&amp; !strcasecmp(tok, <span class="stringliteral">&quot;IN&quot;</span>)) || (sawin &amp;&amp; !strcasecmp(tok, <span class="stringliteral">&quot;OR&quot;</span>))) {
<a name="l00834"></a>00834       sawin = 1;
<a name="l00835"></a>00835       <span class="keywordflow">if</span> (scnt &gt; 7) {
<a name="l00836"></a>00836          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No more than 8 states may be specified for inclusion at line %d of %s\n&quot;</span>, lineno, script);
<a name="l00837"></a>00837          <span class="keywordflow">return</span> 0;
<a name="l00838"></a>00838       }
<a name="l00839"></a>00839       <span class="comment">/* Process &apos;in&apos; things */</span>
<a name="l00840"></a>00840       tok = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;args, script, lineno);
<a name="l00841"></a>00841       <span class="keywordflow">if</span> (<a class="code" href="app__adsiprog_8c.html#a18d18d3cbfe73fe1b44532317edf1f38">process_token</a>(sname, tok, <span class="keyword">sizeof</span>(sname), <a class="code" href="app__adsiprog_8c.html#a4de5ed5fcf59a18b24bc9f6449cc9356">ARG_STRING</a>)) {
<a name="l00842"></a>00842          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;&apos;%s&apos; is not a valid state name at line %d of %s\n&quot;</span>, tok, lineno, script);
<a name="l00843"></a>00843          <span class="keywordflow">return</span> 0;
<a name="l00844"></a>00844       }
<a name="l00845"></a>00845       <span class="keywordflow">if</span> ((snums[scnt] = <a class="code" href="app__adsiprog_8c.html#a1d45f6e735132426f82b9e8f7e1dca38">getstatebyname</a>(state, sname, script, lineno, 0) == NULL)) {
<a name="l00846"></a>00846          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;State &apos;%s&apos; not declared at line %d of %s\n&quot;</span>, sname, lineno, script);
<a name="l00847"></a>00847          <span class="keywordflow">return</span> 0;
<a name="l00848"></a>00848       }
<a name="l00849"></a>00849       scnt++;
<a name="l00850"></a>00850       <span class="keywordflow">if</span> (!(tok = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;args, script, lineno)))
<a name="l00851"></a>00851          <span class="keywordflow">break</span>;
<a name="l00852"></a>00852    }
<a name="l00853"></a>00853    <span class="keywordflow">if</span> (!tok || strcasecmp(tok, <span class="stringliteral">&quot;GOTO&quot;</span>)) {
<a name="l00854"></a>00854       <span class="keywordflow">if</span> (!tok)
<a name="l00855"></a>00855          tok = <span class="stringliteral">&quot;&lt;nothing&gt;&quot;</span>;
<a name="l00856"></a>00856       <span class="keywordflow">if</span> (sawin)
<a name="l00857"></a>00857          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Got &apos;%s&apos; while looking for &apos;GOTO&apos; or &apos;OR&apos; at line %d of %s\n&quot;</span>, tok, lineno, script);
<a name="l00858"></a>00858       <span class="keywordflow">else</span>
<a name="l00859"></a>00859          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Got &apos;%s&apos; while looking for &apos;GOTO&apos; or &apos;IN&apos; at line %d of %s\n&quot;</span>, tok, lineno, script);
<a name="l00860"></a>00860    }
<a name="l00861"></a>00861    <span class="keywordflow">if</span> (!(tok = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;args, script, lineno))) {
<a name="l00862"></a>00862       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Missing subscript to call at line %d of %s\n&quot;</span>, lineno, script);
<a name="l00863"></a>00863       <span class="keywordflow">return</span> 0;
<a name="l00864"></a>00864    }
<a name="l00865"></a>00865    <span class="keywordflow">if</span> (<a class="code" href="app__adsiprog_8c.html#a18d18d3cbfe73fe1b44532317edf1f38">process_token</a>(subscr, tok, <span class="keyword">sizeof</span>(subscr) - 1, <a class="code" href="app__adsiprog_8c.html#a4de5ed5fcf59a18b24bc9f6449cc9356">ARG_STRING</a>)) {
<a name="l00866"></a>00866       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid subscript &apos;%s&apos; at line %d of %s\n&quot;</span>, tok, lineno, script);
<a name="l00867"></a>00867       <span class="keywordflow">return</span> 0;
<a name="l00868"></a>00868    }
<a name="l00869"></a>00869    <span class="keywordflow">if</span> (!(sub = <a class="code" href="app__adsiprog_8c.html#a5934eb908ac28aa57d044c6d48044ef9">getsubbyname</a>(state, subscr, script, lineno)))
<a name="l00870"></a>00870       <span class="keywordflow">return</span> 0;
<a name="l00871"></a>00871    buf[0] = 8;
<a name="l00872"></a>00872    buf[1] = event;
<a name="l00873"></a>00873    buf[2] = sub-&gt;<a class="code" href="structadsi__subscript.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a> | 0x80;
<a name="l00874"></a>00874    <span class="keywordflow">for</span> (x = 0; x &lt; scnt; x++)
<a name="l00875"></a>00875       buf[3 + x] = snums[x];
<a name="l00876"></a>00876    <span class="keywordflow">return</span> 3 + scnt;
<a name="l00877"></a>00877 }
<a name="l00878"></a>00878 
<a name="l00879"></a><a class="code" href="structadsi__key__cmd.html">00879</a> <span class="keyword">struct </span><a class="code" href="structadsi__key__cmd.html">adsi_key_cmd</a> {
<a name="l00880"></a><a class="code" href="structadsi__key__cmd.html#a5ac083a645d964373f022d03df4849c8">00880</a>    <span class="keywordtype">char</span> *<a class="code" href="structadsi__key__cmd.html#a5ac083a645d964373f022d03df4849c8">name</a>;
<a name="l00881"></a><a class="code" href="structadsi__key__cmd.html#a7441ef0865bcb3db9b8064dd7375c1ea">00881</a>    <span class="keywordtype">int</span> <a class="code" href="structadsi__key__cmd.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a>;
<a name="l00882"></a>00882    int (*<a class="code" href="structadsi__key__cmd.html#aec058e74708ecfbbc6b10e1e6db680eb">add_args</a>)(<span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <span class="keywordtype">char</span> *<a class="code" href="structadsi__key__cmd.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keywordtype">int</span> <a class="code" href="structadsi__key__cmd.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a>, <span class="keywordtype">char</span> *args, <span class="keyword">struct </span><a class="code" href="structadsi__script.html">adsi_script</a> *<a class="code" href="structstate.html">state</a>, <span class="keywordtype">char</span> *script, <span class="keywordtype">int</span> lineno);
<a name="l00883"></a>00883 };
<a name="l00884"></a>00884 
<a name="l00885"></a><a class="code" href="app__adsiprog_8c.html#ad0d2ce30c8cb68173a90223ea591a41c">00885</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structadsi__key__cmd.html">adsi_key_cmd</a> <a class="code" href="app__adsiprog_8c.html#ad0d2ce30c8cb68173a90223ea591a41c">kcmds</a>[] = {
<a name="l00886"></a>00886    { <span class="stringliteral">&quot;SENDDTMF&quot;</span>, 0, <a class="code" href="app__adsiprog_8c.html#ada9512fb0d6c34e029b1a9e50bfbe317">send_dtmf</a> },
<a name="l00887"></a>00887    <span class="comment">/* Encoded DTMF would go here */</span>
<a name="l00888"></a>00888    { <span class="stringliteral">&quot;ONHOOK&quot;</span>, 0x81 },
<a name="l00889"></a>00889    { <span class="stringliteral">&quot;OFFHOOK&quot;</span>, 0x82 },
<a name="l00890"></a>00890    { <span class="stringliteral">&quot;FLASH&quot;</span>, 0x83 },
<a name="l00891"></a>00891    { <span class="stringliteral">&quot;WAITDIALTONE&quot;</span>, 0x84 },
<a name="l00892"></a>00892    <span class="comment">/* Send line number */</span>
<a name="l00893"></a>00893    { <span class="stringliteral">&quot;BLANK&quot;</span>, 0x86 },
<a name="l00894"></a>00894    { <span class="stringliteral">&quot;SENDCHARS&quot;</span>, 0x87 },
<a name="l00895"></a>00895    { <span class="stringliteral">&quot;CLEARCHARS&quot;</span>, 0x88 },
<a name="l00896"></a>00896    { <span class="stringliteral">&quot;BACKSPACE&quot;</span>, 0x89 },
<a name="l00897"></a>00897    <span class="comment">/* Tab column */</span>
<a name="l00898"></a>00898    { <span class="stringliteral">&quot;GOTOLINE&quot;</span>, 0x8b, <a class="code" href="app__adsiprog_8c.html#a9d5836220a5af272e86c9a46356c8523">goto_line</a> },
<a name="l00899"></a>00899    { <span class="stringliteral">&quot;GOTOLINEREL&quot;</span>, 0x8c, <a class="code" href="app__adsiprog_8c.html#a39f980c073134c9ec74a13a18355f94d">goto_line_rel</a> },
<a name="l00900"></a>00900    { <span class="stringliteral">&quot;PAGEUP&quot;</span>, 0x8d },
<a name="l00901"></a>00901    { <span class="stringliteral">&quot;PAGEDOWN&quot;</span>, 0x8e },
<a name="l00902"></a>00902    <span class="comment">/* Extended DTMF */</span>
<a name="l00903"></a>00903    { <span class="stringliteral">&quot;DELAY&quot;</span>, 0x90, <a class="code" href="app__adsiprog_8c.html#ac737a6059a6a98d6928b4cad77112983">send_delay</a> },
<a name="l00904"></a>00904    { <span class="stringliteral">&quot;DIALPULSEONE&quot;</span>, 0x91 },
<a name="l00905"></a>00905    { <span class="stringliteral">&quot;DATAMODE&quot;</span>, 0x92 },
<a name="l00906"></a>00906    { <span class="stringliteral">&quot;VOICEMODE&quot;</span>, 0x93 },
<a name="l00907"></a>00907    <span class="comment">/* Display call buffer &apos;n&apos; */</span>
<a name="l00908"></a>00908    <span class="comment">/* Clear call buffer &apos;n&apos; */</span>
<a name="l00909"></a>00909    { <span class="stringliteral">&quot;CLEARCB1&quot;</span>, 0x95, <a class="code" href="app__adsiprog_8c.html#adc1b5c9884901ea0338273eb0d33c312">clearcbone</a> },
<a name="l00910"></a>00910    { <span class="stringliteral">&quot;DIGITCOLLECT&quot;</span>, 0x96, <a class="code" href="app__adsiprog_8c.html#a74d2b14cf0ce3e57401b37701d595b5c">digitcollect</a> },
<a name="l00911"></a>00911    { <span class="stringliteral">&quot;DIGITDIRECT&quot;</span>, 0x96, <a class="code" href="app__adsiprog_8c.html#a88d8f2a01589087f2bf0420f77fb5e28">digitdirect</a> },
<a name="l00912"></a>00912    { <span class="stringliteral">&quot;CLEAR&quot;</span>, 0x97 },
<a name="l00913"></a>00913    { <span class="stringliteral">&quot;SHOWDISPLAY&quot;</span>, 0x98, <a class="code" href="app__adsiprog_8c.html#aa1e8abd1abd66339d2a45f1e71155a59">showdisplay</a> },
<a name="l00914"></a>00914    { <span class="stringliteral">&quot;CLEARDISPLAY&quot;</span>, 0x98, <a class="code" href="app__adsiprog_8c.html#a6a303c8fdfb922fb0f88126c12eeb9de">cleardisplay</a> },
<a name="l00915"></a>00915    { <span class="stringliteral">&quot;SHOWKEYS&quot;</span>, 0x99, <a class="code" href="app__adsiprog_8c.html#ad7eb68bb1f346e51907a614bac67bd9b">showkeys</a> },
<a name="l00916"></a>00916    { <span class="stringliteral">&quot;SETSTATE&quot;</span>, 0x9a, <a class="code" href="app__adsiprog_8c.html#a579ab373f54eddfedbe50fe2b2c77c84">set_state</a> },
<a name="l00917"></a>00917    { <span class="stringliteral">&quot;TIMERSTART&quot;</span>, 0x9b, <a class="code" href="app__adsiprog_8c.html#a29c7f44fe091705e1fd14cac6ca783a6">starttimer</a> },
<a name="l00918"></a>00918    { <span class="stringliteral">&quot;TIMERCLEAR&quot;</span>, 0x9b, <a class="code" href="app__adsiprog_8c.html#a2e363f090f0c2bb7c467d5fa19b38156">cleartimer</a> },
<a name="l00919"></a>00919    { <span class="stringliteral">&quot;SETFLAG&quot;</span>, 0x9c, <a class="code" href="app__adsiprog_8c.html#a32b0053a0da2b937c91e61cffdfdb24d">setflag</a> },
<a name="l00920"></a>00920    { <span class="stringliteral">&quot;CLEARFLAG&quot;</span>, 0x9c, <a class="code" href="app__adsiprog_8c.html#a93173d73f78d9d75086eeda1fa0f04b3">clearflag</a> },
<a name="l00921"></a>00921    { <span class="stringliteral">&quot;GOTO&quot;</span>, 0x9d, <a class="code" href="app__adsiprog_8c.html#ae24ea2605bc89726fa500346dedc2990">subscript</a> },
<a name="l00922"></a>00922    { <span class="stringliteral">&quot;EVENT22&quot;</span>, 0x9e },
<a name="l00923"></a>00923    { <span class="stringliteral">&quot;EVENT23&quot;</span>, 0x9f },
<a name="l00924"></a>00924    { <span class="stringliteral">&quot;EXIT&quot;</span>, 0xa0 },
<a name="l00925"></a>00925 };
<a name="l00926"></a>00926 
<a name="l00927"></a><a class="code" href="app__adsiprog_8c.html#a9777713cf535268b9174c66063a673a3">00927</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structadsi__key__cmd.html">adsi_key_cmd</a> <a class="code" href="app__adsiprog_8c.html#a9777713cf535268b9174c66063a673a3">opcmds</a>[] = {
<a name="l00928"></a>00928    
<a name="l00929"></a>00929    <span class="comment">/* 1 - Branch on event -- handled specially */</span>
<a name="l00930"></a>00930    { <span class="stringliteral">&quot;SHOWKEYS&quot;</span>, 2, <a class="code" href="app__adsiprog_8c.html#ad7eb68bb1f346e51907a614bac67bd9b">showkeys</a> },
<a name="l00931"></a>00931    <span class="comment">/* Display Control */</span>
<a name="l00932"></a>00932    { <span class="stringliteral">&quot;SHOWDISPLAY&quot;</span>, 3, <a class="code" href="app__adsiprog_8c.html#aa1e8abd1abd66339d2a45f1e71155a59">showdisplay</a> },
<a name="l00933"></a>00933    { <span class="stringliteral">&quot;CLEARDISPLAY&quot;</span>, 3, <a class="code" href="app__adsiprog_8c.html#a6a303c8fdfb922fb0f88126c12eeb9de">cleardisplay</a> },
<a name="l00934"></a>00934    { <span class="stringliteral">&quot;CLEAR&quot;</span>, 5 },
<a name="l00935"></a>00935    { <span class="stringliteral">&quot;SETSTATE&quot;</span>, 6, <a class="code" href="app__adsiprog_8c.html#a579ab373f54eddfedbe50fe2b2c77c84">set_state</a> },
<a name="l00936"></a>00936    { <span class="stringliteral">&quot;TIMERSTART&quot;</span>, 7, <a class="code" href="app__adsiprog_8c.html#a29c7f44fe091705e1fd14cac6ca783a6">starttimer</a> },
<a name="l00937"></a>00937    { <span class="stringliteral">&quot;TIMERCLEAR&quot;</span>, 7, <a class="code" href="app__adsiprog_8c.html#a2e363f090f0c2bb7c467d5fa19b38156">cleartimer</a> },
<a name="l00938"></a>00938    { <span class="stringliteral">&quot;ONEVENT&quot;</span>, 8, <a class="code" href="app__adsiprog_8c.html#a43833621164bdb68407481978b89eccb">onevent</a> },
<a name="l00939"></a>00939    <span class="comment">/* 9 - Subroutine label, treated specially */</span>
<a name="l00940"></a>00940    { <span class="stringliteral">&quot;SETFLAG&quot;</span>, 10, <a class="code" href="app__adsiprog_8c.html#a32b0053a0da2b937c91e61cffdfdb24d">setflag</a> },
<a name="l00941"></a>00941    { <span class="stringliteral">&quot;CLEARFLAG&quot;</span>, 10, <a class="code" href="app__adsiprog_8c.html#a93173d73f78d9d75086eeda1fa0f04b3">clearflag</a> },
<a name="l00942"></a>00942    { <span class="stringliteral">&quot;DELAY&quot;</span>, 11, <a class="code" href="app__adsiprog_8c.html#ac737a6059a6a98d6928b4cad77112983">send_delay</a> },
<a name="l00943"></a>00943    { <span class="stringliteral">&quot;EXIT&quot;</span>, 12 },
<a name="l00944"></a>00944 };
<a name="l00945"></a>00945 
<a name="l00946"></a>00946 
<a name="l00947"></a><a class="code" href="app__adsiprog_8c.html#a148c147c790c3924aa8d424a0c1fb288">00947</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="app__adsiprog_8c.html#a148c147c790c3924aa8d424a0c1fb288">process_returncode</a>(<span class="keyword">struct</span> <a class="code" href="structadsi__soft__key.html">adsi_soft_key</a> *key, <span class="keywordtype">char</span> *code, <span class="keywordtype">char</span> *args, <span class="keyword">struct</span> <a class="code" href="structadsi__script.html">adsi_script</a> *<a class="code" href="structstate.html">state</a>, <span class="keywordtype">char</span> *script, <span class="keywordtype">int</span> lineno)
<a name="l00948"></a>00948 {
<a name="l00949"></a>00949    <span class="keywordtype">int</span> x, res;
<a name="l00950"></a>00950    <span class="keywordtype">char</span> *unused;
<a name="l00951"></a>00951 
<a name="l00952"></a>00952    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(kcmds); x++) {
<a name="l00953"></a>00953       <span class="keywordflow">if</span> ((kcmds[x].<span class="keywordtype">id</span> &gt; -1) &amp;&amp; !strcasecmp(kcmds[x].<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, code)) {
<a name="l00954"></a>00954          <span class="keywordflow">if</span> (kcmds[x].<a class="code" href="structadsi__key__cmd.html#aec058e74708ecfbbc6b10e1e6db680eb">add_args</a>) {
<a name="l00955"></a>00955             res = kcmds[x].<a class="code" href="structadsi__key__cmd.html#aec058e74708ecfbbc6b10e1e6db680eb">add_args</a>(key-&gt;<a class="code" href="structadsi__soft__key.html#a9be5b50ad2d70413ccaa9ba65dd3c733">retstr</a> + key-&gt;<a class="code" href="structadsi__soft__key.html#ab6b099f2c0f7e492b8e5bc27627cedbc">retstrlen</a>,
<a name="l00956"></a>00956                   code, kcmds[x].<a class="code" href="structadsi__key__cmd.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a>, args, state, script, lineno);
<a name="l00957"></a>00957             <span class="keywordflow">if</span> ((key-&gt;<a class="code" href="structadsi__soft__key.html#ab6b099f2c0f7e492b8e5bc27627cedbc">retstrlen</a> + res - key-&gt;<a class="code" href="structadsi__soft__key.html#ad78f07e59e8e533b5c75f6db2012f52e">initlen</a>) &lt;= <a class="code" href="app__adsiprog_8c.html#afe3b99eafa759841f10ef4c1a8ff1700">MAX_RET_CODE</a>)
<a name="l00958"></a>00958                key-&gt;<a class="code" href="structadsi__soft__key.html#ab6b099f2c0f7e492b8e5bc27627cedbc">retstrlen</a> += res;
<a name="l00959"></a>00959             <span class="keywordflow">else</span>
<a name="l00960"></a>00960                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No space for &apos;%s&apos; code in key &apos;%s&apos; at line %d of %s\n&quot;</span>, kcmds[x].name, key-&gt;<a class="code" href="structadsi__soft__key.html#af781142f98a00b542e50998f1be48230">vname</a>, lineno, script);
<a name="l00961"></a>00961          } <span class="keywordflow">else</span> {
<a name="l00962"></a>00962             <span class="keywordflow">if</span> ((unused = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;args, script, lineno)))
<a name="l00963"></a>00963                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;&apos;%s&apos; takes no arguments at line %d of %s (token is &apos;%s&apos;)\n&quot;</span>, kcmds[x].name, lineno, script, unused);
<a name="l00964"></a>00964             <span class="keywordflow">if</span> ((key-&gt;<a class="code" href="structadsi__soft__key.html#ab6b099f2c0f7e492b8e5bc27627cedbc">retstrlen</a> + 1 - key-&gt;<a class="code" href="structadsi__soft__key.html#ad78f07e59e8e533b5c75f6db2012f52e">initlen</a>) &lt;= <a class="code" href="app__adsiprog_8c.html#afe3b99eafa759841f10ef4c1a8ff1700">MAX_RET_CODE</a>) {
<a name="l00965"></a>00965                key-&gt;<a class="code" href="structadsi__soft__key.html#a9be5b50ad2d70413ccaa9ba65dd3c733">retstr</a>[key-&gt;<a class="code" href="structadsi__soft__key.html#ab6b099f2c0f7e492b8e5bc27627cedbc">retstrlen</a>] = kcmds[x].<a class="code" href="structadsi__key__cmd.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a>;
<a name="l00966"></a>00966                key-&gt;<a class="code" href="structadsi__soft__key.html#ab6b099f2c0f7e492b8e5bc27627cedbc">retstrlen</a>++;
<a name="l00967"></a>00967             } <span class="keywordflow">else</span>
<a name="l00968"></a>00968                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No space for &apos;%s&apos; code in key &apos;%s&apos; at line %d of %s\n&quot;</span>, kcmds[x].name, key-&gt;<a class="code" href="structadsi__soft__key.html#af781142f98a00b542e50998f1be48230">vname</a>, lineno, script);
<a name="l00969"></a>00969          }
<a name="l00970"></a>00970          <span class="keywordflow">return</span> 0;
<a name="l00971"></a>00971       }
<a name="l00972"></a>00972    }
<a name="l00973"></a>00973    <span class="keywordflow">return</span> -1;
<a name="l00974"></a>00974 }
<a name="l00975"></a>00975 
<a name="l00976"></a><a class="code" href="app__adsiprog_8c.html#afc8cdb2f72d8c350534928ef91a8e994">00976</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="app__adsiprog_8c.html#afc8cdb2f72d8c350534928ef91a8e994">process_opcode</a>(<span class="keyword">struct</span> <a class="code" href="structadsi__subscript.html">adsi_subscript</a> *sub, <span class="keywordtype">char</span> *code, <span class="keywordtype">char</span> *args, <span class="keyword">struct</span> <a class="code" href="structadsi__script.html">adsi_script</a> *<a class="code" href="structstate.html">state</a>, <span class="keywordtype">char</span> *script, <span class="keywordtype">int</span> lineno)
<a name="l00977"></a>00977 {
<a name="l00978"></a>00978    <span class="keywordtype">int</span> x, res, max = sub-&gt;<a class="code" href="structadsi__subscript.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a> ? <a class="code" href="app__adsiprog_8c.html#ace1dddc6ba6a999e7dc4830453136c34">MAX_SUB_LEN</a> : <a class="code" href="app__adsiprog_8c.html#a79fd262be73bcca835b513bfa1d50a1d">MAX_MAIN_LEN</a>;
<a name="l00979"></a>00979    <span class="keywordtype">char</span> *unused;
<a name="l00980"></a>00980 
<a name="l00981"></a>00981    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(opcmds); x++) {
<a name="l00982"></a>00982       <span class="keywordflow">if</span> ((opcmds[x].<span class="keywordtype">id</span> &gt; -1) &amp;&amp; !strcasecmp(opcmds[x].<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, code)) {
<a name="l00983"></a>00983          <span class="keywordflow">if</span> (opcmds[x].<a class="code" href="structadsi__key__cmd.html#aec058e74708ecfbbc6b10e1e6db680eb">add_args</a>) {
<a name="l00984"></a>00984             res = opcmds[x].<a class="code" href="structadsi__key__cmd.html#aec058e74708ecfbbc6b10e1e6db680eb">add_args</a>(sub-&gt;<a class="code" href="structadsi__subscript.html#ae75ec805c7e74dcf4dae969c03d32661">data</a> + sub-&gt;<a class="code" href="structadsi__subscript.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>,
<a name="l00985"></a>00985                   code, opcmds[x].<a class="code" href="structadsi__key__cmd.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a>, args, state, script, lineno);
<a name="l00986"></a>00986             <span class="keywordflow">if</span> ((sub-&gt;<a class="code" href="structadsi__subscript.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> + res + 1) &lt;= max)
<a name="l00987"></a>00987                sub-&gt;<a class="code" href="structadsi__subscript.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> += res;
<a name="l00988"></a>00988             <span class="keywordflow">else</span> {
<a name="l00989"></a>00989                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No space for &apos;%s&apos; code in subscript &apos;%s&apos; at line %d of %s\n&quot;</span>, opcmds[x].name, sub-&gt;<a class="code" href="structadsi__subscript.html#af781142f98a00b542e50998f1be48230">vname</a>, lineno, script);
<a name="l00990"></a>00990                <span class="keywordflow">return</span> -1;
<a name="l00991"></a>00991             }
<a name="l00992"></a>00992          } <span class="keywordflow">else</span> {
<a name="l00993"></a>00993             <span class="keywordflow">if</span> ((unused = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;args, script, lineno)))
<a name="l00994"></a>00994                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;&apos;%s&apos; takes no arguments at line %d of %s (token is &apos;%s&apos;)\n&quot;</span>, opcmds[x].name, lineno, script, unused);
<a name="l00995"></a>00995             <span class="keywordflow">if</span> ((sub-&gt;<a class="code" href="structadsi__subscript.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> + 2) &lt;= max) {
<a name="l00996"></a>00996                sub-&gt;<a class="code" href="structadsi__subscript.html#ae75ec805c7e74dcf4dae969c03d32661">data</a>[sub-&gt;<a class="code" href="structadsi__subscript.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>] = opcmds[x].<a class="code" href="structadsi__key__cmd.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a>;
<a name="l00997"></a>00997                sub-&gt;<a class="code" href="structadsi__subscript.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>++;
<a name="l00998"></a>00998             } <span class="keywordflow">else</span> {
<a name="l00999"></a>00999                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No space for &apos;%s&apos; code in key &apos;%s&apos; at line %d of %s\n&quot;</span>, opcmds[x].name, sub-&gt;<a class="code" href="structadsi__subscript.html#af781142f98a00b542e50998f1be48230">vname</a>, lineno, script);
<a name="l01000"></a>01000                <span class="keywordflow">return</span> -1;
<a name="l01001"></a>01001             }
<a name="l01002"></a>01002          }
<a name="l01003"></a>01003          <span class="comment">/* Separate commands with 0xff */</span>
<a name="l01004"></a>01004          sub-&gt;<a class="code" href="structadsi__subscript.html#ae75ec805c7e74dcf4dae969c03d32661">data</a>[sub-&gt;<a class="code" href="structadsi__subscript.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>] = 0xff;
<a name="l01005"></a>01005          sub-&gt;<a class="code" href="structadsi__subscript.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>++;
<a name="l01006"></a>01006          sub-&gt;<a class="code" href="structadsi__subscript.html#a27a33e4fca32013b818073cc38355060">inscount</a>++;
<a name="l01007"></a>01007          <span class="keywordflow">return</span> 0;
<a name="l01008"></a>01008       }
<a name="l01009"></a>01009    }
<a name="l01010"></a>01010    <span class="keywordflow">return</span> -1;
<a name="l01011"></a>01011 }
<a name="l01012"></a>01012 
<a name="l01013"></a><a class="code" href="app__adsiprog_8c.html#ae9466a561f9c270a5f4a3b58948d840d">01013</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="app__adsiprog_8c.html#ae9466a561f9c270a5f4a3b58948d840d">adsi_process</a>(<span class="keyword">struct</span> <a class="code" href="structadsi__script.html">adsi_script</a> *<a class="code" href="structstate.html">state</a>, <span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <span class="keywordtype">char</span> *script, <span class="keywordtype">int</span> lineno)
<a name="l01014"></a>01014 {
<a name="l01015"></a>01015    <span class="keywordtype">char</span> *keyword = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;buf, script, lineno);
<a name="l01016"></a>01016    <span class="keywordtype">char</span> *args, vname[256], tmp[80], tmp2[80];
<a name="l01017"></a>01017    <span class="keywordtype">int</span> lrci, wi, event;
<a name="l01018"></a>01018    <span class="keyword">struct </span><a class="code" href="structadsi__display.html">adsi_display</a> *disp;
<a name="l01019"></a>01019    <span class="keyword">struct </span><a class="code" href="structadsi__subscript.html">adsi_subscript</a> *newsub;
<a name="l01020"></a>01020 
<a name="l01021"></a>01021    <span class="keywordflow">if</span> (!keyword)
<a name="l01022"></a>01022       <span class="keywordflow">return</span> 0;
<a name="l01023"></a>01023 
<a name="l01024"></a>01024    <span class="keywordflow">switch</span>(state-&gt;<a class="code" href="structadsi__script.html#a89f234133d3efe315836311cbf21c64b">state</a>) {
<a name="l01025"></a>01025    <span class="keywordflow">case</span> <a class="code" href="app__adsiprog_8c.html#ae429c985be88ed048f382511c9ff00de">STATE_NORMAL</a>:
<a name="l01026"></a>01026       <span class="keywordflow">if</span> (!strcasecmp(keyword, <span class="stringliteral">&quot;DESCRIPTION&quot;</span>)) {
<a name="l01027"></a>01027          <span class="keywordflow">if</span> ((args = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;buf, script, lineno))) {
<a name="l01028"></a>01028             <span class="keywordflow">if</span> (<a class="code" href="app__adsiprog_8c.html#a18d18d3cbfe73fe1b44532317edf1f38">process_token</a>(state-&gt;<a class="code" href="structadsi__script.html#a3545dcc45fe896ce213114ea9fba34df">desc</a>, args, <span class="keyword">sizeof</span>(state-&gt;<a class="code" href="structadsi__script.html#a3545dcc45fe896ce213114ea9fba34df">desc</a>) - 1, <a class="code" href="app__adsiprog_8c.html#a4de5ed5fcf59a18b24bc9f6449cc9356">ARG_STRING</a>))
<a name="l01029"></a>01029                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;&apos;%s&apos; is not a valid token for DESCRIPTION at line %d of %s\n&quot;</span>, args, lineno, script);
<a name="l01030"></a>01030          } <span class="keywordflow">else</span>
<a name="l01031"></a>01031             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Missing argument for DESCRIPTION at line %d of %s\n&quot;</span>, lineno, script);
<a name="l01032"></a>01032       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(keyword, <span class="stringliteral">&quot;VERSION&quot;</span>)) {
<a name="l01033"></a>01033          <span class="keywordflow">if</span> ((args = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;buf, script, lineno))) {
<a name="l01034"></a>01034             <span class="keywordflow">if</span> (<a class="code" href="app__adsiprog_8c.html#a18d18d3cbfe73fe1b44532317edf1f38">process_token</a>(&amp;state-&gt;<a class="code" href="structadsi__script.html#a88ca8dd6d8b1535e6ba06c4d988c525b">ver</a>, args, <span class="keyword">sizeof</span>(state-&gt;<a class="code" href="structadsi__script.html#a88ca8dd6d8b1535e6ba06c4d988c525b">ver</a>) - 1, <a class="code" href="app__adsiprog_8c.html#a3f0af864ac7fb3d21180fb420db64105">ARG_NUMBER</a>))
<a name="l01035"></a>01035                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;&apos;%s&apos; is not a valid token for VERSION at line %d of %s\n&quot;</span>, args, lineno, script);
<a name="l01036"></a>01036          } <span class="keywordflow">else</span>
<a name="l01037"></a>01037             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Missing argument for VERSION at line %d of %s\n&quot;</span>, lineno, script);
<a name="l01038"></a>01038       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(keyword, <span class="stringliteral">&quot;SECURITY&quot;</span>)) {
<a name="l01039"></a>01039          <span class="keywordflow">if</span> ((args = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;buf, script, lineno))) {
<a name="l01040"></a>01040             <span class="keywordflow">if</span> (<a class="code" href="app__adsiprog_8c.html#a18d18d3cbfe73fe1b44532317edf1f38">process_token</a>(state-&gt;<a class="code" href="structadsi__script.html#a5b2b7d06455abb1f9961f2ceec99cd80">sec</a>, args, <span class="keyword">sizeof</span>(state-&gt;<a class="code" href="structadsi__script.html#a5b2b7d06455abb1f9961f2ceec99cd80">sec</a>) - 1, <a class="code" href="app__adsiprog_8c.html#a4de5ed5fcf59a18b24bc9f6449cc9356">ARG_STRING</a> | <a class="code" href="app__adsiprog_8c.html#a3f0af864ac7fb3d21180fb420db64105">ARG_NUMBER</a>))
<a name="l01041"></a>01041                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;&apos;%s&apos; is not a valid token for SECURITY at line %d of %s\n&quot;</span>, args, lineno, script);
<a name="l01042"></a>01042          } <span class="keywordflow">else</span>
<a name="l01043"></a>01043             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Missing argument for SECURITY at line %d of %s\n&quot;</span>, lineno, script);
<a name="l01044"></a>01044       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(keyword, <span class="stringliteral">&quot;FDN&quot;</span>)) {
<a name="l01045"></a>01045          <span class="keywordflow">if</span> ((args = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;buf, script, lineno))) {
<a name="l01046"></a>01046             <span class="keywordflow">if</span> (<a class="code" href="app__adsiprog_8c.html#a18d18d3cbfe73fe1b44532317edf1f38">process_token</a>(state-&gt;<a class="code" href="structadsi__script.html#a19ee504aa140fcafcb26ce70106819fd">fdn</a>, args, <span class="keyword">sizeof</span>(state-&gt;<a class="code" href="structadsi__script.html#a19ee504aa140fcafcb26ce70106819fd">fdn</a>) - 1, <a class="code" href="app__adsiprog_8c.html#a4de5ed5fcf59a18b24bc9f6449cc9356">ARG_STRING</a> | <a class="code" href="app__adsiprog_8c.html#a3f0af864ac7fb3d21180fb420db64105">ARG_NUMBER</a>))
<a name="l01047"></a>01047                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;&apos;%s&apos; is not a valid token for FDN at line %d of %s\n&quot;</span>, args, lineno, script);
<a name="l01048"></a>01048          } <span class="keywordflow">else</span>
<a name="l01049"></a>01049             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Missing argument for FDN at line %d of %s\n&quot;</span>, lineno, script);
<a name="l01050"></a>01050       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(keyword, <span class="stringliteral">&quot;KEY&quot;</span>)) {
<a name="l01051"></a>01051          <span class="keywordflow">if</span> (!(args = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;buf, script, lineno))) {
<a name="l01052"></a>01052             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;KEY definition missing name at line %d of %s\n&quot;</span>, lineno, script);
<a name="l01053"></a>01053             <span class="keywordflow">break</span>;
<a name="l01054"></a>01054          }
<a name="l01055"></a>01055          <span class="keywordflow">if</span> (<a class="code" href="app__adsiprog_8c.html#a18d18d3cbfe73fe1b44532317edf1f38">process_token</a>(vname, args, <span class="keyword">sizeof</span>(vname) - 1, <a class="code" href="app__adsiprog_8c.html#a4de5ed5fcf59a18b24bc9f6449cc9356">ARG_STRING</a>)) {
<a name="l01056"></a>01056             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;&apos;%s&apos; is not a valid token for a KEY name at line %d of %s\n&quot;</span>, args, lineno, script);
<a name="l01057"></a>01057             <span class="keywordflow">break</span>;
<a name="l01058"></a>01058          }
<a name="l01059"></a>01059          <span class="keywordflow">if</span> (!(state-&gt;<a class="code" href="structadsi__script.html#af78308364878b8e811a0bb24ff07af58">key</a> = <a class="code" href="app__adsiprog_8c.html#a3777d6a06b016339dd85e08d84202da9">getkeybyname</a>(state, vname, script, lineno))) {
<a name="l01060"></a>01060             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Out of key space at line %d of %s\n&quot;</span>, lineno, script);
<a name="l01061"></a>01061             <span class="keywordflow">break</span>;
<a name="l01062"></a>01062          }
<a name="l01063"></a>01063          <span class="keywordflow">if</span> (state-&gt;<a class="code" href="structadsi__script.html#af78308364878b8e811a0bb24ff07af58">key</a>-&gt;<a class="code" href="structadsi__soft__key.html#a3995c0a64d5c1a1c54b757a5a9237aa2">defined</a>) {
<a name="l01064"></a>01064             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Cannot redefine key &apos;%s&apos; at line %d of %s\n&quot;</span>, vname, lineno, script);
<a name="l01065"></a>01065             <span class="keywordflow">break</span>;
<a name="l01066"></a>01066          }
<a name="l01067"></a>01067          <span class="keywordflow">if</span> (!(args = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;buf, script, lineno)) || strcasecmp(args, <span class="stringliteral">&quot;IS&quot;</span>)) {
<a name="l01068"></a>01068             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Expecting &apos;IS&apos;, but got &apos;%s&apos; at line %d of %s\n&quot;</span>, args ? args : <span class="stringliteral">&quot;&lt;nothing&gt;&quot;</span>, lineno, script);
<a name="l01069"></a>01069             <span class="keywordflow">break</span>;
<a name="l01070"></a>01070          }
<a name="l01071"></a>01071          <span class="keywordflow">if</span> (!(args = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;buf, script, lineno))) {
<a name="l01072"></a>01072             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;KEY definition missing short name at line %d of %s\n&quot;</span>, lineno, script);
<a name="l01073"></a>01073             <span class="keywordflow">break</span>;
<a name="l01074"></a>01074          }
<a name="l01075"></a>01075          <span class="keywordflow">if</span> (<a class="code" href="app__adsiprog_8c.html#a18d18d3cbfe73fe1b44532317edf1f38">process_token</a>(tmp, args, <span class="keyword">sizeof</span>(tmp) - 1, <a class="code" href="app__adsiprog_8c.html#a4de5ed5fcf59a18b24bc9f6449cc9356">ARG_STRING</a>)) {
<a name="l01076"></a>01076             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;&apos;%s&apos; is not a valid token for a KEY short name at line %d of %s\n&quot;</span>, args, lineno, script);
<a name="l01077"></a>01077             <span class="keywordflow">break</span>;
<a name="l01078"></a>01078          }
<a name="l01079"></a>01079          <span class="keywordflow">if</span> ((args = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;buf, script, lineno))) {
<a name="l01080"></a>01080             <span class="keywordflow">if</span> (strcasecmp(args, <span class="stringliteral">&quot;OR&quot;</span>)) {
<a name="l01081"></a>01081                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Expecting &apos;OR&apos; but got &apos;%s&apos; instead at line %d of %s\n&quot;</span>, args, lineno, script);
<a name="l01082"></a>01082                <span class="keywordflow">break</span>;
<a name="l01083"></a>01083             }
<a name="l01084"></a>01084             <span class="keywordflow">if</span> (!(args = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;buf, script, lineno))) {
<a name="l01085"></a>01085                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;KEY definition missing optional long name at line %d of %s\n&quot;</span>, lineno, script);
<a name="l01086"></a>01086                <span class="keywordflow">break</span>;
<a name="l01087"></a>01087             }
<a name="l01088"></a>01088             <span class="keywordflow">if</span> (<a class="code" href="app__adsiprog_8c.html#a18d18d3cbfe73fe1b44532317edf1f38">process_token</a>(tmp2, args, <span class="keyword">sizeof</span>(tmp2) - 1, <a class="code" href="app__adsiprog_8c.html#a4de5ed5fcf59a18b24bc9f6449cc9356">ARG_STRING</a>)) {
<a name="l01089"></a>01089                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;&apos;%s&apos; is not a valid token for a KEY long name at line %d of %s\n&quot;</span>, args, lineno, script);
<a name="l01090"></a>01090                <span class="keywordflow">break</span>;
<a name="l01091"></a>01091             }
<a name="l01092"></a>01092          } <span class="keywordflow">else</span> {
<a name="l01093"></a>01093             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmp2, tmp, <span class="keyword">sizeof</span>(tmp2));
<a name="l01094"></a>01094          }
<a name="l01095"></a>01095          <span class="keywordflow">if</span> (strlen(tmp2) &gt; 18) {
<a name="l01096"></a>01096             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Truncating full name to 18 characters at line %d of %s\n&quot;</span>, lineno, script);
<a name="l01097"></a>01097             tmp2[18] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01098"></a>01098          }
<a name="l01099"></a>01099          <span class="keywordflow">if</span> (strlen(tmp) &gt; 7) {
<a name="l01100"></a>01100             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Truncating short name to 7 bytes at line %d of %s\n&quot;</span>, lineno, script);
<a name="l01101"></a>01101             tmp[7] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01102"></a>01102          }
<a name="l01103"></a>01103          <span class="comment">/* Setup initial stuff */</span>
<a name="l01104"></a>01104          state-&gt;<a class="code" href="structadsi__script.html#af78308364878b8e811a0bb24ff07af58">key</a>-&gt;<a class="code" href="structadsi__soft__key.html#a9be5b50ad2d70413ccaa9ba65dd3c733">retstr</a>[0] = 128;
<a name="l01105"></a>01105          <span class="comment">/* 1 has the length */</span>
<a name="l01106"></a>01106          state-&gt;<a class="code" href="structadsi__script.html#af78308364878b8e811a0bb24ff07af58">key</a>-&gt;<a class="code" href="structadsi__soft__key.html#a9be5b50ad2d70413ccaa9ba65dd3c733">retstr</a>[2] = state-&gt;<a class="code" href="structadsi__script.html#af78308364878b8e811a0bb24ff07af58">key</a>-&gt;<a class="code" href="structadsi__soft__key.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a>;
<a name="l01107"></a>01107          <span class="comment">/* Put the Full name in */</span>
<a name="l01108"></a>01108          memcpy(state-&gt;<a class="code" href="structadsi__script.html#af78308364878b8e811a0bb24ff07af58">key</a>-&gt;<a class="code" href="structadsi__soft__key.html#a9be5b50ad2d70413ccaa9ba65dd3c733">retstr</a> + 3, tmp2, strlen(tmp2));
<a name="l01109"></a>01109          <span class="comment">/* Update length */</span>
<a name="l01110"></a>01110          state-&gt;<a class="code" href="structadsi__script.html#af78308364878b8e811a0bb24ff07af58">key</a>-&gt;<a class="code" href="structadsi__soft__key.html#ab6b099f2c0f7e492b8e5bc27627cedbc">retstrlen</a> = strlen(tmp2) + 3;
<a name="l01111"></a>01111          <span class="comment">/* Put trailing 0xff */</span>
<a name="l01112"></a>01112          state-&gt;<a class="code" href="structadsi__script.html#af78308364878b8e811a0bb24ff07af58">key</a>-&gt;<a class="code" href="structadsi__soft__key.html#a9be5b50ad2d70413ccaa9ba65dd3c733">retstr</a>[state-&gt;<a class="code" href="structadsi__script.html#af78308364878b8e811a0bb24ff07af58">key</a>-&gt;<a class="code" href="structadsi__soft__key.html#ab6b099f2c0f7e492b8e5bc27627cedbc">retstrlen</a>++] = 0xff;
<a name="l01113"></a>01113          <span class="comment">/* Put the short name */</span>
<a name="l01114"></a>01114          memcpy(state-&gt;<a class="code" href="structadsi__script.html#af78308364878b8e811a0bb24ff07af58">key</a>-&gt;<a class="code" href="structadsi__soft__key.html#a9be5b50ad2d70413ccaa9ba65dd3c733">retstr</a> + state-&gt;<a class="code" href="structadsi__script.html#af78308364878b8e811a0bb24ff07af58">key</a>-&gt;<a class="code" href="structadsi__soft__key.html#ab6b099f2c0f7e492b8e5bc27627cedbc">retstrlen</a>, tmp, strlen(tmp));
<a name="l01115"></a>01115          <span class="comment">/* Update length */</span>
<a name="l01116"></a>01116          state-&gt;<a class="code" href="structadsi__script.html#af78308364878b8e811a0bb24ff07af58">key</a>-&gt;<a class="code" href="structadsi__soft__key.html#ab6b099f2c0f7e492b8e5bc27627cedbc">retstrlen</a> += strlen(tmp);
<a name="l01117"></a>01117          <span class="comment">/* Put trailing 0xff */</span>
<a name="l01118"></a>01118          state-&gt;<a class="code" href="structadsi__script.html#af78308364878b8e811a0bb24ff07af58">key</a>-&gt;<a class="code" href="structadsi__soft__key.html#a9be5b50ad2d70413ccaa9ba65dd3c733">retstr</a>[state-&gt;<a class="code" href="structadsi__script.html#af78308364878b8e811a0bb24ff07af58">key</a>-&gt;<a class="code" href="structadsi__soft__key.html#ab6b099f2c0f7e492b8e5bc27627cedbc">retstrlen</a>++] = 0xff;
<a name="l01119"></a>01119          <span class="comment">/* Record initial length */</span>
<a name="l01120"></a>01120          state-&gt;<a class="code" href="structadsi__script.html#af78308364878b8e811a0bb24ff07af58">key</a>-&gt;<a class="code" href="structadsi__soft__key.html#ad78f07e59e8e533b5c75f6db2012f52e">initlen</a> = state-&gt;<a class="code" href="structadsi__script.html#af78308364878b8e811a0bb24ff07af58">key</a>-&gt;<a class="code" href="structadsi__soft__key.html#ab6b099f2c0f7e492b8e5bc27627cedbc">retstrlen</a>;
<a name="l01121"></a>01121          state-&gt;<a class="code" href="structadsi__script.html#a89f234133d3efe315836311cbf21c64b">state</a> = <a class="code" href="app__adsiprog_8c.html#ad0ab7c996fd8ed836205212f8f71c74a">STATE_INKEY</a>;
<a name="l01122"></a>01122       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(keyword, <span class="stringliteral">&quot;SUB&quot;</span>)) {
<a name="l01123"></a>01123          <span class="keywordflow">if</span> (!(args = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;buf, script, lineno))) {
<a name="l01124"></a>01124             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;SUB definition missing name at line %d of %s\n&quot;</span>, lineno, script);
<a name="l01125"></a>01125             <span class="keywordflow">break</span>;
<a name="l01126"></a>01126          }
<a name="l01127"></a>01127          <span class="keywordflow">if</span> (<a class="code" href="app__adsiprog_8c.html#a18d18d3cbfe73fe1b44532317edf1f38">process_token</a>(vname, args, <span class="keyword">sizeof</span>(vname) - 1, <a class="code" href="app__adsiprog_8c.html#a4de5ed5fcf59a18b24bc9f6449cc9356">ARG_STRING</a>)) {
<a name="l01128"></a>01128             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;&apos;%s&apos; is not a valid token for a KEY name at line %d of %s\n&quot;</span>, args, lineno, script);
<a name="l01129"></a>01129             <span class="keywordflow">break</span>;
<a name="l01130"></a>01130          }
<a name="l01131"></a>01131          <span class="keywordflow">if</span> (!(state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a> = <a class="code" href="app__adsiprog_8c.html#a5934eb908ac28aa57d044c6d48044ef9">getsubbyname</a>(state, vname, script, lineno))) {
<a name="l01132"></a>01132             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Out of subroutine space at line %d of %s\n&quot;</span>, lineno, script);
<a name="l01133"></a>01133             <span class="keywordflow">break</span>;
<a name="l01134"></a>01134          }
<a name="l01135"></a>01135          <span class="keywordflow">if</span> (state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>-&gt;<a class="code" href="structadsi__subscript.html#a3995c0a64d5c1a1c54b757a5a9237aa2">defined</a>) {
<a name="l01136"></a>01136             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Cannot redefine subroutine &apos;%s&apos; at line %d of %s\n&quot;</span>, vname, lineno, script);
<a name="l01137"></a>01137             <span class="keywordflow">break</span>;
<a name="l01138"></a>01138          }
<a name="l01139"></a>01139          <span class="comment">/* Setup sub */</span>
<a name="l01140"></a>01140          state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>-&gt;<a class="code" href="structadsi__subscript.html#ae75ec805c7e74dcf4dae969c03d32661">data</a>[0] = 130;
<a name="l01141"></a>01141          <span class="comment">/* 1 is the length */</span>
<a name="l01142"></a>01142          state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>-&gt;<a class="code" href="structadsi__subscript.html#ae75ec805c7e74dcf4dae969c03d32661">data</a>[2] = 0x0; <span class="comment">/* Clear extensibility bit */</span>
<a name="l01143"></a>01143          state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>-&gt;<a class="code" href="structadsi__subscript.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> = 3;
<a name="l01144"></a>01144          <span class="keywordflow">if</span> (state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>-&gt;<a class="code" href="structadsi__subscript.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a>) {
<a name="l01145"></a>01145             <span class="comment">/* If this isn&apos;t the main subroutine, make a subroutine label for it */</span>
<a name="l01146"></a>01146             state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>-&gt;<a class="code" href="structadsi__subscript.html#ae75ec805c7e74dcf4dae969c03d32661">data</a>[3] = 9;
<a name="l01147"></a>01147             state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>-&gt;<a class="code" href="structadsi__subscript.html#ae75ec805c7e74dcf4dae969c03d32661">data</a>[4] = state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>-&gt;<a class="code" href="structadsi__subscript.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a>;
<a name="l01148"></a>01148             <span class="comment">/* 5 is length */</span>
<a name="l01149"></a>01149             state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>-&gt;<a class="code" href="structadsi__subscript.html#ae75ec805c7e74dcf4dae969c03d32661">data</a>[6] = 0xff;
<a name="l01150"></a>01150             state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>-&gt;<a class="code" href="structadsi__subscript.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> = 7;
<a name="l01151"></a>01151          }
<a name="l01152"></a>01152          <span class="keywordflow">if</span> (!(args = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;buf, script, lineno)) || strcasecmp(args, <span class="stringliteral">&quot;IS&quot;</span>)) {
<a name="l01153"></a>01153             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Expecting &apos;IS&apos;, but got &apos;%s&apos; at line %d of %s\n&quot;</span>, args ? args : <span class="stringliteral">&quot;&lt;nothing&gt;&quot;</span>, lineno, script);
<a name="l01154"></a>01154             <span class="keywordflow">break</span>;
<a name="l01155"></a>01155          }
<a name="l01156"></a>01156          state-&gt;<a class="code" href="structadsi__script.html#a89f234133d3efe315836311cbf21c64b">state</a> = <a class="code" href="app__adsiprog_8c.html#aeab5a3465be5583c64655c66714505e0">STATE_INSUB</a>;
<a name="l01157"></a>01157       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(keyword, <span class="stringliteral">&quot;STATE&quot;</span>)) {
<a name="l01158"></a>01158          <span class="keywordflow">if</span> (!(args = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;buf, script, lineno))) {
<a name="l01159"></a>01159             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;STATE definition missing name at line %d of %s\n&quot;</span>, lineno, script);
<a name="l01160"></a>01160             <span class="keywordflow">break</span>;
<a name="l01161"></a>01161          }
<a name="l01162"></a>01162          <span class="keywordflow">if</span> (<a class="code" href="app__adsiprog_8c.html#a18d18d3cbfe73fe1b44532317edf1f38">process_token</a>(vname, args, <span class="keyword">sizeof</span>(vname) - 1, <a class="code" href="app__adsiprog_8c.html#a4de5ed5fcf59a18b24bc9f6449cc9356">ARG_STRING</a>)) {
<a name="l01163"></a>01163             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;&apos;%s&apos; is not a valid token for a STATE name at line %d of %s\n&quot;</span>, args, lineno, script);
<a name="l01164"></a>01164             <span class="keywordflow">break</span>;
<a name="l01165"></a>01165          }
<a name="l01166"></a>01166          <span class="keywordflow">if</span> (<a class="code" href="app__adsiprog_8c.html#a1d45f6e735132426f82b9e8f7e1dca38">getstatebyname</a>(state, vname, script, lineno, 0)) {
<a name="l01167"></a>01167             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;State &apos;%s&apos; is already defined at line %d of %s\n&quot;</span>, vname, lineno, script);
<a name="l01168"></a>01168             <span class="keywordflow">break</span>;
<a name="l01169"></a>01169          }
<a name="l01170"></a>01170          <a class="code" href="app__adsiprog_8c.html#a1d45f6e735132426f82b9e8f7e1dca38">getstatebyname</a>(state, vname, script, lineno, 1);
<a name="l01171"></a>01171       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(keyword, <span class="stringliteral">&quot;FLAG&quot;</span>)) {
<a name="l01172"></a>01172          <span class="keywordflow">if</span> (!(args = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;buf, script, lineno))) {
<a name="l01173"></a>01173             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;FLAG definition missing name at line %d of %s\n&quot;</span>, lineno, script);
<a name="l01174"></a>01174             <span class="keywordflow">break</span>;
<a name="l01175"></a>01175          }
<a name="l01176"></a>01176          <span class="keywordflow">if</span> (<a class="code" href="app__adsiprog_8c.html#a18d18d3cbfe73fe1b44532317edf1f38">process_token</a>(vname, args, <span class="keyword">sizeof</span>(vname) - 1, <a class="code" href="app__adsiprog_8c.html#a4de5ed5fcf59a18b24bc9f6449cc9356">ARG_STRING</a>)) {
<a name="l01177"></a>01177             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;&apos;%s&apos; is not a valid token for a FLAG name at line %d of %s\n&quot;</span>, args, lineno, script);
<a name="l01178"></a>01178             <span class="keywordflow">break</span>;
<a name="l01179"></a>01179          }
<a name="l01180"></a>01180          <span class="keywordflow">if</span> (<a class="code" href="app__adsiprog_8c.html#a3b23848aadf4d0b05ac4edb5162bd999">getflagbyname</a>(state, vname, script, lineno, 0)) {
<a name="l01181"></a>01181             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Flag &apos;%s&apos; is already defined\n&quot;</span>, vname);
<a name="l01182"></a>01182             <span class="keywordflow">break</span>;
<a name="l01183"></a>01183          }
<a name="l01184"></a>01184          <a class="code" href="app__adsiprog_8c.html#a3b23848aadf4d0b05ac4edb5162bd999">getflagbyname</a>(state, vname, script, lineno, 1);
<a name="l01185"></a>01185       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(keyword, <span class="stringliteral">&quot;DISPLAY&quot;</span>)) {
<a name="l01186"></a>01186          lrci = 0;
<a name="l01187"></a>01187          wi = 0;
<a name="l01188"></a>01188          <span class="keywordflow">if</span> (!(args = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;buf, script, lineno))) {
<a name="l01189"></a>01189             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;SUB definition missing name at line %d of %s\n&quot;</span>, lineno, script);
<a name="l01190"></a>01190             <span class="keywordflow">break</span>;
<a name="l01191"></a>01191          }
<a name="l01192"></a>01192          <span class="keywordflow">if</span> (<a class="code" href="app__adsiprog_8c.html#a18d18d3cbfe73fe1b44532317edf1f38">process_token</a>(vname, args, <span class="keyword">sizeof</span>(vname) - 1, <a class="code" href="app__adsiprog_8c.html#a4de5ed5fcf59a18b24bc9f6449cc9356">ARG_STRING</a>)) {
<a name="l01193"></a>01193             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;&apos;%s&apos; is not a valid token for a KEY name at line %d of %s\n&quot;</span>, args, lineno, script);
<a name="l01194"></a>01194             <span class="keywordflow">break</span>;
<a name="l01195"></a>01195          }
<a name="l01196"></a>01196          <span class="keywordflow">if</span> (<a class="code" href="app__adsiprog_8c.html#a403f26cc1e2121fff693bfb4ef37dbb4">getdisplaybyname</a>(state, vname, script, lineno, 0)) {
<a name="l01197"></a>01197             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;State &apos;%s&apos; is already defined\n&quot;</span>, vname);
<a name="l01198"></a>01198             <span class="keywordflow">break</span>;
<a name="l01199"></a>01199          }
<a name="l01200"></a>01200          <span class="keywordflow">if</span> (!(disp = <a class="code" href="app__adsiprog_8c.html#a403f26cc1e2121fff693bfb4ef37dbb4">getdisplaybyname</a>(state, vname, script, lineno, 1)))
<a name="l01201"></a>01201             <span class="keywordflow">break</span>;
<a name="l01202"></a>01202          <span class="keywordflow">if</span> (!(args = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;buf, script, lineno)) || strcasecmp(args, <span class="stringliteral">&quot;IS&quot;</span>)) {
<a name="l01203"></a>01203             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Missing &apos;IS&apos; at line %d of %s\n&quot;</span>, lineno, script);
<a name="l01204"></a>01204             <span class="keywordflow">break</span>;
<a name="l01205"></a>01205          }
<a name="l01206"></a>01206          <span class="keywordflow">if</span> (!(args = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;buf, script, lineno))) {
<a name="l01207"></a>01207             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Missing Column 1 text at line %d of %s\n&quot;</span>, lineno, script);
<a name="l01208"></a>01208             <span class="keywordflow">break</span>;
<a name="l01209"></a>01209          }
<a name="l01210"></a>01210          <span class="keywordflow">if</span> (<a class="code" href="app__adsiprog_8c.html#a18d18d3cbfe73fe1b44532317edf1f38">process_token</a>(tmp, args, <span class="keyword">sizeof</span>(tmp) - 1, <a class="code" href="app__adsiprog_8c.html#a4de5ed5fcf59a18b24bc9f6449cc9356">ARG_STRING</a>)) {
<a name="l01211"></a>01211             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Token &apos;%s&apos; is not valid column 1 text at line %d of %s\n&quot;</span>, args, lineno, script);
<a name="l01212"></a>01212             <span class="keywordflow">break</span>;
<a name="l01213"></a>01213          }
<a name="l01214"></a>01214          <span class="keywordflow">if</span> (strlen(tmp) &gt; 20) {
<a name="l01215"></a>01215             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Truncating column one to 20 characters at line %d of %s\n&quot;</span>, lineno, script);
<a name="l01216"></a>01216             tmp[20] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01217"></a>01217          }
<a name="l01218"></a>01218          memcpy(disp-&gt;<a class="code" href="structadsi__display.html#a3b33566e63aeeb4d270d4a15a887a48a">data</a> + 5, tmp, strlen(tmp));
<a name="l01219"></a>01219          disp-&gt;<a class="code" href="structadsi__display.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> = strlen(tmp) + 5;
<a name="l01220"></a>01220          disp-&gt;<a class="code" href="structadsi__display.html#a3b33566e63aeeb4d270d4a15a887a48a">data</a>[disp-&gt;<a class="code" href="structadsi__display.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>++] = 0xff;
<a name="l01221"></a>01221 
<a name="l01222"></a>01222          args = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;buf, script, lineno);
<a name="l01223"></a>01223          <span class="keywordflow">if</span> (args &amp;&amp; !<a class="code" href="app__adsiprog_8c.html#a18d18d3cbfe73fe1b44532317edf1f38">process_token</a>(tmp, args, <span class="keyword">sizeof</span>(tmp) - 1, <a class="code" href="app__adsiprog_8c.html#a4de5ed5fcf59a18b24bc9f6449cc9356">ARG_STRING</a>)) {
<a name="l01224"></a>01224             <span class="comment">/* Got a column two */</span>
<a name="l01225"></a>01225             <span class="keywordflow">if</span> (strlen(tmp) &gt; 20) {
<a name="l01226"></a>01226                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Truncating column two to 20 characters at line %d of %s\n&quot;</span>, lineno, script);
<a name="l01227"></a>01227                tmp[20] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01228"></a>01228             }
<a name="l01229"></a>01229             memcpy(disp-&gt;<a class="code" href="structadsi__display.html#a3b33566e63aeeb4d270d4a15a887a48a">data</a> + disp-&gt;<a class="code" href="structadsi__display.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>, tmp, strlen(tmp));
<a name="l01230"></a>01230             disp-&gt;<a class="code" href="structadsi__display.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> += strlen(tmp);
<a name="l01231"></a>01231             args = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;buf, script, lineno);
<a name="l01232"></a>01232          }
<a name="l01233"></a>01233          <span class="keywordflow">while</span> (args) {
<a name="l01234"></a>01234             <span class="keywordflow">if</span> (!strcasecmp(args, <span class="stringliteral">&quot;JUSTIFY&quot;</span>)) {
<a name="l01235"></a>01235                args = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;buf, script, lineno);
<a name="l01236"></a>01236                <span class="keywordflow">if</span> (!args) {
<a name="l01237"></a>01237                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Qualifier &apos;JUSTIFY&apos; requires an argument at line %d of %s\n&quot;</span>, lineno, script);
<a name="l01238"></a>01238                   <span class="keywordflow">break</span>;
<a name="l01239"></a>01239                }
<a name="l01240"></a>01240                lrci = <a class="code" href="app__adsiprog_8c.html#ac3391dd58f860148905adbc0dea15070">getjustifybyname</a>(args);
<a name="l01241"></a>01241                <span class="keywordflow">if</span> (lrci &lt; 0) {
<a name="l01242"></a>01242                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;&apos;%s&apos; is not a valid justification at line %d of %s\n&quot;</span>, args, lineno, script);
<a name="l01243"></a>01243                   <span class="keywordflow">break</span>;
<a name="l01244"></a>01244                }
<a name="l01245"></a>01245             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(args, <span class="stringliteral">&quot;WRAP&quot;</span>)) {
<a name="l01246"></a>01246                wi = 0x80;
<a name="l01247"></a>01247             } <span class="keywordflow">else</span> {
<a name="l01248"></a>01248                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;&apos;%s&apos; is not a known qualifier at line %d of %s\n&quot;</span>, args, lineno, script);
<a name="l01249"></a>01249                <span class="keywordflow">break</span>;
<a name="l01250"></a>01250             }
<a name="l01251"></a>01251             args = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;buf, script, lineno);
<a name="l01252"></a>01252          }
<a name="l01253"></a>01253          <span class="keywordflow">if</span> (args) {
<a name="l01254"></a>01254             <span class="comment">/* Something bad happened */</span>
<a name="l01255"></a>01255             <span class="keywordflow">break</span>;
<a name="l01256"></a>01256          }
<a name="l01257"></a>01257          disp-&gt;<a class="code" href="structadsi__display.html#a3b33566e63aeeb4d270d4a15a887a48a">data</a>[0] = 129;
<a name="l01258"></a>01258          disp-&gt;<a class="code" href="structadsi__display.html#a3b33566e63aeeb4d270d4a15a887a48a">data</a>[1] = disp-&gt;<a class="code" href="structadsi__display.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> - 2;
<a name="l01259"></a>01259          disp-&gt;<a class="code" href="structadsi__display.html#a3b33566e63aeeb4d270d4a15a887a48a">data</a>[2] = ((lrci &amp; 0x3) &lt;&lt; 6) | disp-&gt;<a class="code" href="structadsi__display.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a>;
<a name="l01260"></a>01260          disp-&gt;<a class="code" href="structadsi__display.html#a3b33566e63aeeb4d270d4a15a887a48a">data</a>[3] = wi;
<a name="l01261"></a>01261          disp-&gt;<a class="code" href="structadsi__display.html#a3b33566e63aeeb4d270d4a15a887a48a">data</a>[4] = 0xff;
<a name="l01262"></a>01262       } <span class="keywordflow">else</span> {
<a name="l01263"></a>01263          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid or Unknown keyword &apos;%s&apos; in PROGRAM\n&quot;</span>, keyword);
<a name="l01264"></a>01264       }
<a name="l01265"></a>01265       <span class="keywordflow">break</span>;
<a name="l01266"></a>01266    <span class="keywordflow">case</span> <a class="code" href="app__adsiprog_8c.html#ad0ab7c996fd8ed836205212f8f71c74a">STATE_INKEY</a>:
<a name="l01267"></a>01267       <span class="keywordflow">if</span> (<a class="code" href="app__adsiprog_8c.html#a148c147c790c3924aa8d424a0c1fb288">process_returncode</a>(state-&gt;<a class="code" href="structadsi__script.html#af78308364878b8e811a0bb24ff07af58">key</a>, keyword, buf, state, script, lineno)) {
<a name="l01268"></a>01268          <span class="keywordflow">if</span> (!strcasecmp(keyword, <span class="stringliteral">&quot;ENDKEY&quot;</span>)) {
<a name="l01269"></a>01269             <span class="comment">/* Return to normal operation and increment current key */</span>
<a name="l01270"></a>01270             state-&gt;<a class="code" href="structadsi__script.html#a89f234133d3efe315836311cbf21c64b">state</a> = <a class="code" href="app__adsiprog_8c.html#ae429c985be88ed048f382511c9ff00de">STATE_NORMAL</a>;
<a name="l01271"></a>01271             state-&gt;<a class="code" href="structadsi__script.html#af78308364878b8e811a0bb24ff07af58">key</a>-&gt;<a class="code" href="structadsi__soft__key.html#a3995c0a64d5c1a1c54b757a5a9237aa2">defined</a> = 1;
<a name="l01272"></a>01272             state-&gt;<a class="code" href="structadsi__script.html#af78308364878b8e811a0bb24ff07af58">key</a>-&gt;<a class="code" href="structadsi__soft__key.html#a9be5b50ad2d70413ccaa9ba65dd3c733">retstr</a>[1] = state-&gt;<a class="code" href="structadsi__script.html#af78308364878b8e811a0bb24ff07af58">key</a>-&gt;<a class="code" href="structadsi__soft__key.html#ab6b099f2c0f7e492b8e5bc27627cedbc">retstrlen</a> - 2;
<a name="l01273"></a>01273             state-&gt;<a class="code" href="structadsi__script.html#af78308364878b8e811a0bb24ff07af58">key</a> = NULL;
<a name="l01274"></a>01274          } <span class="keywordflow">else</span> {
<a name="l01275"></a>01275             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid or Unknown keyword &apos;%s&apos; in SOFTKEY definition at line %d of %s\n&quot;</span>, keyword, lineno, script);
<a name="l01276"></a>01276          }
<a name="l01277"></a>01277       }
<a name="l01278"></a>01278       <span class="keywordflow">break</span>;
<a name="l01279"></a>01279    <span class="keywordflow">case</span> <a class="code" href="app__adsiprog_8c.html#a85a20e7a24da7888ce6bf37c1d061e7e">STATE_INIF</a>:
<a name="l01280"></a>01280       <span class="keywordflow">if</span> (<a class="code" href="app__adsiprog_8c.html#afc8cdb2f72d8c350534928ef91a8e994">process_opcode</a>(state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>, keyword, buf, state, script, lineno)) {
<a name="l01281"></a>01281          <span class="keywordflow">if</span> (!strcasecmp(keyword, <span class="stringliteral">&quot;ENDIF&quot;</span>)) {
<a name="l01282"></a>01282             <span class="comment">/* Return to normal SUB operation and increment current key */</span>
<a name="l01283"></a>01283             state-&gt;<a class="code" href="structadsi__script.html#a89f234133d3efe315836311cbf21c64b">state</a> = <a class="code" href="app__adsiprog_8c.html#aeab5a3465be5583c64655c66714505e0">STATE_INSUB</a>;
<a name="l01284"></a>01284             state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>-&gt;<a class="code" href="structadsi__subscript.html#a3995c0a64d5c1a1c54b757a5a9237aa2">defined</a> = 1;
<a name="l01285"></a>01285             <span class="comment">/* Store the proper number of instructions */</span>
<a name="l01286"></a>01286             state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>-&gt;<a class="code" href="structadsi__subscript.html#a8590bbb8ad212e9772ba06ac5e65dc30">ifdata</a>[2] = state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>-&gt;<a class="code" href="structadsi__subscript.html#a90695c7538e691f33a6dad59abb154d9">ifinscount</a>;
<a name="l01287"></a>01287          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(keyword, <span class="stringliteral">&quot;GOTO&quot;</span>)) {
<a name="l01288"></a>01288             <span class="keywordflow">if</span> (!(args = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;buf, script, lineno))) {
<a name="l01289"></a>01289                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;GOTO clause missing Subscript name at line %d of %s\n&quot;</span>, lineno, script);
<a name="l01290"></a>01290                <span class="keywordflow">break</span>;
<a name="l01291"></a>01291             }
<a name="l01292"></a>01292             <span class="keywordflow">if</span> (<a class="code" href="app__adsiprog_8c.html#a18d18d3cbfe73fe1b44532317edf1f38">process_token</a>(tmp, args, <span class="keyword">sizeof</span>(tmp) - 1, <a class="code" href="app__adsiprog_8c.html#a4de5ed5fcf59a18b24bc9f6449cc9356">ARG_STRING</a>)) {
<a name="l01293"></a>01293                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;&apos;%s&apos; is not a valid subscript name token at line %d of %s\n&quot;</span>, args, lineno, script);
<a name="l01294"></a>01294                <span class="keywordflow">break</span>;
<a name="l01295"></a>01295             }
<a name="l01296"></a>01296             <span class="keywordflow">if</span> (!(newsub = <a class="code" href="app__adsiprog_8c.html#a5934eb908ac28aa57d044c6d48044ef9">getsubbyname</a>(state, tmp, script, lineno)))
<a name="l01297"></a>01297                <span class="keywordflow">break</span>;
<a name="l01298"></a>01298             <span class="comment">/* Somehow you use GOTO to go to another place */</span>
<a name="l01299"></a>01299             state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>-&gt;<a class="code" href="structadsi__subscript.html#ae75ec805c7e74dcf4dae969c03d32661">data</a>[state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>-&gt;<a class="code" href="structadsi__subscript.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>++] = 0x8;
<a name="l01300"></a>01300             state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>-&gt;<a class="code" href="structadsi__subscript.html#ae75ec805c7e74dcf4dae969c03d32661">data</a>[state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>-&gt;<a class="code" href="structadsi__subscript.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>++] = state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>-&gt;<a class="code" href="structadsi__subscript.html#a8590bbb8ad212e9772ba06ac5e65dc30">ifdata</a>[1];
<a name="l01301"></a>01301             state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>-&gt;<a class="code" href="structadsi__subscript.html#ae75ec805c7e74dcf4dae969c03d32661">data</a>[state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>-&gt;<a class="code" href="structadsi__subscript.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>++] = newsub-&gt;<a class="code" href="structadsi__subscript.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a>;
<a name="l01302"></a>01302             <span class="comment">/* Terminate */</span>
<a name="l01303"></a>01303             state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>-&gt;<a class="code" href="structadsi__subscript.html#ae75ec805c7e74dcf4dae969c03d32661">data</a>[state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>-&gt;<a class="code" href="structadsi__subscript.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>++] = 0xff;
<a name="l01304"></a>01304             <span class="comment">/* Increment counters */</span>
<a name="l01305"></a>01305             state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>-&gt;<a class="code" href="structadsi__subscript.html#a27a33e4fca32013b818073cc38355060">inscount</a>++;
<a name="l01306"></a>01306             state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>-&gt;<a class="code" href="structadsi__subscript.html#a90695c7538e691f33a6dad59abb154d9">ifinscount</a>++;
<a name="l01307"></a>01307          } <span class="keywordflow">else</span> {
<a name="l01308"></a>01308             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid or Unknown keyword &apos;%s&apos; in IF clause at line %d of %s\n&quot;</span>, keyword, lineno, script);
<a name="l01309"></a>01309          }
<a name="l01310"></a>01310       } <span class="keywordflow">else</span>
<a name="l01311"></a>01311          state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>-&gt;<a class="code" href="structadsi__subscript.html#a90695c7538e691f33a6dad59abb154d9">ifinscount</a>++;
<a name="l01312"></a>01312       <span class="keywordflow">break</span>;
<a name="l01313"></a>01313    <span class="keywordflow">case</span> <a class="code" href="app__adsiprog_8c.html#aeab5a3465be5583c64655c66714505e0">STATE_INSUB</a>:
<a name="l01314"></a>01314       <span class="keywordflow">if</span> (<a class="code" href="app__adsiprog_8c.html#afc8cdb2f72d8c350534928ef91a8e994">process_opcode</a>(state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>, keyword, buf, state, script, lineno)) {
<a name="l01315"></a>01315          <span class="keywordflow">if</span> (!strcasecmp(keyword, <span class="stringliteral">&quot;ENDSUB&quot;</span>)) {
<a name="l01316"></a>01316             <span class="comment">/* Return to normal operation and increment current key */</span>
<a name="l01317"></a>01317             state-&gt;<a class="code" href="structadsi__script.html#a89f234133d3efe315836311cbf21c64b">state</a> = <a class="code" href="app__adsiprog_8c.html#ae429c985be88ed048f382511c9ff00de">STATE_NORMAL</a>;
<a name="l01318"></a>01318             state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>-&gt;<a class="code" href="structadsi__subscript.html#a3995c0a64d5c1a1c54b757a5a9237aa2">defined</a> = 1;
<a name="l01319"></a>01319             <span class="comment">/* Store the proper length */</span>
<a name="l01320"></a>01320             state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>-&gt;<a class="code" href="structadsi__subscript.html#ae75ec805c7e74dcf4dae969c03d32661">data</a>[1] = state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>-&gt;<a class="code" href="structadsi__subscript.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> - 2;
<a name="l01321"></a>01321             <span class="keywordflow">if</span> (state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>-&gt;<a class="code" href="structadsi__subscript.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a>) {
<a name="l01322"></a>01322                <span class="comment">/* if this isn&apos;t main, store number of instructions, too */</span>
<a name="l01323"></a>01323                state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>-&gt;<a class="code" href="structadsi__subscript.html#ae75ec805c7e74dcf4dae969c03d32661">data</a>[5] = state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>-&gt;<a class="code" href="structadsi__subscript.html#a27a33e4fca32013b818073cc38355060">inscount</a>;
<a name="l01324"></a>01324             }
<a name="l01325"></a>01325             state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a> = NULL;
<a name="l01326"></a>01326          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(keyword, <span class="stringliteral">&quot;IFEVENT&quot;</span>)) {
<a name="l01327"></a>01327             <span class="keywordflow">if</span> (!(args = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;buf, script, lineno))) {
<a name="l01328"></a>01328                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;IFEVENT clause missing Event name at line %d of %s\n&quot;</span>, lineno, script);
<a name="l01329"></a>01329                <span class="keywordflow">break</span>;
<a name="l01330"></a>01330             }
<a name="l01331"></a>01331             <span class="keywordflow">if</span> ((event = <a class="code" href="app__adsiprog_8c.html#a57fa3d17b7e48989d6c27915ec9def13">geteventbyname</a>(args)) &lt; 1) {
<a name="l01332"></a>01332                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;&apos;%s&apos; is not a valid event\n&quot;</span>, args);
<a name="l01333"></a>01333                <span class="keywordflow">break</span>;
<a name="l01334"></a>01334             }
<a name="l01335"></a>01335             <span class="keywordflow">if</span> (!(args = <a class="code" href="app__adsiprog_8c.html#a4cfd262241d9b4f639752dc69c471d6c">get_token</a>(&amp;buf, script, lineno)) || strcasecmp(args, <span class="stringliteral">&quot;THEN&quot;</span>)) {
<a name="l01336"></a>01336                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;IFEVENT clause missing &apos;THEN&apos; at line %d of %s\n&quot;</span>, lineno, script);
<a name="l01337"></a>01337                <span class="keywordflow">break</span>;
<a name="l01338"></a>01338             }
<a name="l01339"></a>01339             state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>-&gt;<a class="code" href="structadsi__subscript.html#a90695c7538e691f33a6dad59abb154d9">ifinscount</a> = 0;
<a name="l01340"></a>01340             state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>-&gt;<a class="code" href="structadsi__subscript.html#a8590bbb8ad212e9772ba06ac5e65dc30">ifdata</a> = state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>-&gt;<a class="code" href="structadsi__subscript.html#ae75ec805c7e74dcf4dae969c03d32661">data</a> + state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>-&gt;<a class="code" href="structadsi__subscript.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>;
<a name="l01341"></a>01341             <span class="comment">/* Reserve header and insert op codes */</span>
<a name="l01342"></a>01342             state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>-&gt;<a class="code" href="structadsi__subscript.html#a8590bbb8ad212e9772ba06ac5e65dc30">ifdata</a>[0] = 0x1;
<a name="l01343"></a>01343             state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>-&gt;<a class="code" href="structadsi__subscript.html#a8590bbb8ad212e9772ba06ac5e65dc30">ifdata</a>[1] = event;
<a name="l01344"></a>01344             <span class="comment">/* 2 is for the number of instructions */</span>
<a name="l01345"></a>01345             state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>-&gt;<a class="code" href="structadsi__subscript.html#a8590bbb8ad212e9772ba06ac5e65dc30">ifdata</a>[3] = 0xff;
<a name="l01346"></a>01346             state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>-&gt;<a class="code" href="structadsi__subscript.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> += 4;
<a name="l01347"></a>01347             <span class="comment">/* Update Subscript instruction count */</span>
<a name="l01348"></a>01348             state-&gt;<a class="code" href="structadsi__script.html#a90ef513ac82f6865056e28a8f7a4e4f7">sub</a>-&gt;<a class="code" href="structadsi__subscript.html#a27a33e4fca32013b818073cc38355060">inscount</a>++;
<a name="l01349"></a>01349             state-&gt;<a class="code" href="structadsi__script.html#a89f234133d3efe315836311cbf21c64b">state</a> = <a class="code" href="app__adsiprog_8c.html#a85a20e7a24da7888ce6bf37c1d061e7e">STATE_INIF</a>;
<a name="l01350"></a>01350          } <span class="keywordflow">else</span> {
<a name="l01351"></a>01351             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid or Unknown keyword &apos;%s&apos; in SUB definition at line %d of %s\n&quot;</span>, keyword, lineno, script);
<a name="l01352"></a>01352          }
<a name="l01353"></a>01353       }
<a name="l01354"></a>01354       <span class="keywordflow">break</span>;
<a name="l01355"></a>01355    <span class="keywordflow">default</span>:
<a name="l01356"></a>01356       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Can&apos;t process keyword &apos;%s&apos; in weird state %d\n&quot;</span>, keyword, state-&gt;<a class="code" href="structadsi__script.html#a89f234133d3efe315836311cbf21c64b">state</a>);
<a name="l01357"></a>01357    }
<a name="l01358"></a>01358    <span class="keywordflow">return</span> 0;
<a name="l01359"></a>01359 }
<a name="l01360"></a>01360 
<a name="l01361"></a><a class="code" href="app__adsiprog_8c.html#a74c17b01512eb16013b1637b09109f85">01361</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structadsi__script.html">adsi_script</a> *<a class="code" href="app__adsiprog_8c.html#a74c17b01512eb16013b1637b09109f85">compile_script</a>(<span class="keywordtype">char</span> *script)
<a name="l01362"></a>01362 {
<a name="l01363"></a>01363    FILE *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l01364"></a>01364    <span class="keywordtype">char</span> fn[256], <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[256], *c;
<a name="l01365"></a>01365    <span class="keywordtype">int</span> lineno = 0, x, err;
<a name="l01366"></a>01366    <span class="keyword">struct </span><a class="code" href="structadsi__script.html">adsi_script</a> *scr;
<a name="l01367"></a>01367 
<a name="l01368"></a>01368    <span class="keywordflow">if</span> (script[0] == <span class="charliteral">&apos;/&apos;</span>)
<a name="l01369"></a>01369       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(fn, script, <span class="keyword">sizeof</span>(fn));
<a name="l01370"></a>01370    <span class="keywordflow">else</span>
<a name="l01371"></a>01371       snprintf(fn, <span class="keyword">sizeof</span>(fn), <span class="stringliteral">&quot;%s/%s&quot;</span>, <a class="code" href="paths_8h.html#a7d3836e5581e433c9f5edd30300cc187">ast_config_AST_CONFIG_DIR</a>, script);
<a name="l01372"></a>01372 
<a name="l01373"></a>01373    <span class="keywordflow">if</span> (!(f = fopen(fn, <span class="stringliteral">&quot;r&quot;</span>))) {
<a name="l01374"></a>01374       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Can&apos;t open file &apos;%s&apos;\n&quot;</span>, fn);
<a name="l01375"></a>01375       <span class="keywordflow">return</span> NULL;
<a name="l01376"></a>01376    }
<a name="l01377"></a>01377 
<a name="l01378"></a>01378    <span class="keywordflow">if</span> (!(scr = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*scr)))) {
<a name="l01379"></a>01379       fclose(f);
<a name="l01380"></a>01380       <span class="keywordflow">return</span> NULL;
<a name="l01381"></a>01381    }
<a name="l01382"></a>01382 
<a name="l01383"></a>01383    <span class="comment">/* Create &quot;main&quot; as first subroutine */</span>
<a name="l01384"></a>01384    <a class="code" href="app__adsiprog_8c.html#a5934eb908ac28aa57d044c6d48044ef9">getsubbyname</a>(scr, <span class="stringliteral">&quot;main&quot;</span>, NULL, 0);
<a name="l01385"></a>01385    <span class="keywordflow">while</span> (!feof(f)) {
<a name="l01386"></a>01386       <span class="keywordflow">if</span> (!fgets(buf, <span class="keyword">sizeof</span>(buf), f)) {
<a name="l01387"></a>01387          <span class="keywordflow">continue</span>;
<a name="l01388"></a>01388       }
<a name="l01389"></a>01389       <span class="keywordflow">if</span> (!feof(f)) {
<a name="l01390"></a>01390          lineno++;
<a name="l01391"></a>01391          <span class="comment">/* Trim off trailing return */</span>
<a name="l01392"></a>01392          buf[strlen(buf) - 1] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01393"></a>01393          <span class="comment">/* Strip comments */</span>
<a name="l01394"></a>01394          <span class="keywordflow">if</span> ((c = strchr(buf, <span class="charliteral">&apos;;&apos;</span>)))
<a name="l01395"></a>01395             *c = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01396"></a>01396          <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(buf))
<a name="l01397"></a>01397             <a class="code" href="app__adsiprog_8c.html#ae9466a561f9c270a5f4a3b58948d840d">adsi_process</a>(scr, buf, script, lineno);
<a name="l01398"></a>01398       }
<a name="l01399"></a>01399    }
<a name="l01400"></a>01400    fclose(f);
<a name="l01401"></a>01401    <span class="comment">/* Make sure we&apos;re in the main routine again */</span>
<a name="l01402"></a>01402    <span class="keywordflow">switch</span>(scr-&gt;<a class="code" href="structadsi__script.html#a89f234133d3efe315836311cbf21c64b">state</a>) {
<a name="l01403"></a>01403    <span class="keywordflow">case</span> <a class="code" href="app__adsiprog_8c.html#ae429c985be88ed048f382511c9ff00de">STATE_NORMAL</a>:
<a name="l01404"></a>01404       <span class="keywordflow">break</span>;
<a name="l01405"></a>01405    <span class="keywordflow">case</span> <a class="code" href="app__adsiprog_8c.html#aeab5a3465be5583c64655c66714505e0">STATE_INSUB</a>:
<a name="l01406"></a>01406       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Missing ENDSUB at end of file %s\n&quot;</span>, script);
<a name="l01407"></a>01407       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(scr);
<a name="l01408"></a>01408       <span class="keywordflow">return</span> NULL;
<a name="l01409"></a>01409    <span class="keywordflow">case</span> <a class="code" href="app__adsiprog_8c.html#ad0ab7c996fd8ed836205212f8f71c74a">STATE_INKEY</a>:
<a name="l01410"></a>01410       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Missing ENDKEY at end of file %s\n&quot;</span>, script);
<a name="l01411"></a>01411       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(scr);
<a name="l01412"></a>01412       <span class="keywordflow">return</span> NULL;
<a name="l01413"></a>01413    }
<a name="l01414"></a>01414    err = 0;
<a name="l01415"></a>01415 
<a name="l01416"></a>01416    <span class="comment">/* Resolve all keys and record their lengths */</span>
<a name="l01417"></a>01417    <span class="keywordflow">for</span> (x = 0; x &lt; scr-&gt;<a class="code" href="structadsi__script.html#a2a2bc6427e5e73762ff9ed591294fa7d">numkeys</a>; x++) {
<a name="l01418"></a>01418       <span class="keywordflow">if</span> (!scr-&gt;<a class="code" href="structadsi__script.html#adfc4c259f04b196894e168eb1eac555f">keys</a>[x].<a class="code" href="structadsi__soft__key.html#a3995c0a64d5c1a1c54b757a5a9237aa2">defined</a>) {
<a name="l01419"></a>01419          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Key &apos;%s&apos; referenced but never defined in file %s\n&quot;</span>, scr-&gt;<a class="code" href="structadsi__script.html#adfc4c259f04b196894e168eb1eac555f">keys</a>[x].<a class="code" href="structadsi__soft__key.html#af781142f98a00b542e50998f1be48230">vname</a>, fn);
<a name="l01420"></a>01420          err++;
<a name="l01421"></a>01421       }
<a name="l01422"></a>01422    }
<a name="l01423"></a>01423 
<a name="l01424"></a>01424    <span class="comment">/* Resolve all subs */</span>
<a name="l01425"></a>01425    <span class="keywordflow">for</span> (x = 0; x &lt; scr-&gt;<a class="code" href="structadsi__script.html#acd5c8ec5a9d632d17afeacba7bc97366">numsubs</a>; x++) {
<a name="l01426"></a>01426       <span class="keywordflow">if</span> (!scr-&gt;<a class="code" href="structadsi__script.html#a02c62f8b0c39859e0c9e8556c4c2f404">subs</a>[x].<a class="code" href="structadsi__subscript.html#a3995c0a64d5c1a1c54b757a5a9237aa2">defined</a>) {
<a name="l01427"></a>01427          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Subscript &apos;%s&apos; referenced but never defined in file %s\n&quot;</span>, scr-&gt;<a class="code" href="structadsi__script.html#a02c62f8b0c39859e0c9e8556c4c2f404">subs</a>[x].<a class="code" href="structadsi__subscript.html#af781142f98a00b542e50998f1be48230">vname</a>, fn);
<a name="l01428"></a>01428          err++;
<a name="l01429"></a>01429       }
<a name="l01430"></a>01430       <span class="keywordflow">if</span> (x == (scr-&gt;<a class="code" href="structadsi__script.html#acd5c8ec5a9d632d17afeacba7bc97366">numsubs</a> - 1)) {
<a name="l01431"></a>01431          <span class="comment">/* Clear out extension bit on last message */</span>
<a name="l01432"></a>01432          scr-&gt;<a class="code" href="structadsi__script.html#a02c62f8b0c39859e0c9e8556c4c2f404">subs</a>[x].<a class="code" href="structadsi__subscript.html#ae75ec805c7e74dcf4dae969c03d32661">data</a>[2] = 0x80;
<a name="l01433"></a>01433       }
<a name="l01434"></a>01434    }
<a name="l01435"></a>01435 
<a name="l01436"></a>01436    <span class="keywordflow">if</span> (err) {
<a name="l01437"></a>01437       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(scr);
<a name="l01438"></a>01438       <span class="keywordflow">return</span> NULL;
<a name="l01439"></a>01439    }
<a name="l01440"></a>01440    <span class="keywordflow">return</span> scr;
<a name="l01441"></a>01441 }
<a name="l01442"></a>01442 
<a name="l01443"></a>01443 <span class="preprocessor">#ifdef DUMP_MESSAGES</span>
<a name="l01444"></a>01444 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">void</span> dump_message(<span class="keywordtype">char</span> *<a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>, <span class="keywordtype">char</span> *vname, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <span class="keywordtype">int</span> buflen)
<a name="l01445"></a>01445 {
<a name="l01446"></a>01446    <span class="keywordtype">int</span> x;
<a name="l01447"></a>01447    printf(<span class="stringliteral">&quot;%s %s: [ &quot;</span>, type, vname);
<a name="l01448"></a>01448    <span class="keywordflow">for</span> (x = 0; x &lt; buflen; x++)
<a name="l01449"></a>01449       printf(<span class="stringliteral">&quot;%02x &quot;</span>, buf[x]);
<a name="l01450"></a>01450    printf(<span class="stringliteral">&quot;]\n&quot;</span>);
<a name="l01451"></a>01451 }
<a name="l01452"></a>01452 <span class="preprocessor">#endif</span>
<a name="l01453"></a>01453 <span class="preprocessor"></span>
<a name="l01454"></a><a class="code" href="app__adsiprog_8c.html#ac44d3b59ca1471de484b2fc9d8e8993c">01454</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="app__adsiprog_8c.html#ac44d3b59ca1471de484b2fc9d8e8993c">adsi_prog</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, <span class="keywordtype">char</span> *script)
<a name="l01455"></a>01455 {
<a name="l01456"></a>01456    <span class="keyword">struct </span><a class="code" href="structadsi__script.html">adsi_script</a> *scr;
<a name="l01457"></a>01457    <span class="keywordtype">int</span> x, bytes;
<a name="l01458"></a>01458    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> buf[1024];
<a name="l01459"></a>01459 
<a name="l01460"></a>01460    <span class="keywordflow">if</span> (!(scr = <a class="code" href="app__adsiprog_8c.html#a74c17b01512eb16013b1637b09109f85">compile_script</a>(script)))
<a name="l01461"></a>01461       <span class="keywordflow">return</span> -1;
<a name="l01462"></a>01462 
<a name="l01463"></a>01463    <span class="comment">/* Start an empty ADSI Session */</span>
<a name="l01464"></a>01464    <span class="keywordflow">if</span> (<a class="code" href="adsi_8h.html#a4c7e441bdf356ad4cbc6e549c2ff0ea1" title="Check if scripts for a given app are already loaded. Version may be -1, if any version...">ast_adsi_load_session</a>(chan, NULL, 0, 1) &lt; 1)
<a name="l01465"></a>01465       <span class="keywordflow">return</span> -1;
<a name="l01466"></a>01466 
<a name="l01467"></a>01467    <span class="comment">/* Now begin the download attempt */</span>
<a name="l01468"></a>01468    <span class="keywordflow">if</span> (<a class="code" href="adsi_8h.html#a8f98a667128bb0296f9a2e09786f61bb">ast_adsi_begin_download</a>(chan, scr-&gt;<a class="code" href="structadsi__script.html#a3545dcc45fe896ce213114ea9fba34df">desc</a>, scr-&gt;<a class="code" href="structadsi__script.html#a19ee504aa140fcafcb26ce70106819fd">fdn</a>, scr-&gt;<a class="code" href="structadsi__script.html#a5b2b7d06455abb1f9961f2ceec99cd80">sec</a>, scr-&gt;<a class="code" href="structadsi__script.html#a88ca8dd6d8b1535e6ba06c4d988c525b">ver</a>)) {
<a name="l01469"></a>01469       <span class="comment">/* User rejected us for some reason */</span>
<a name="l01470"></a>01470       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;User rejected download attempt\n&quot;</span>);
<a name="l01471"></a>01471       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;User rejected download on channel %s\n&quot;</span>, chan-&gt;name);
<a name="l01472"></a>01472       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(scr);
<a name="l01473"></a>01473       <span class="keywordflow">return</span> -1;
<a name="l01474"></a>01474    }
<a name="l01475"></a>01475 
<a name="l01476"></a>01476    bytes = 0;
<a name="l01477"></a>01477    <span class="comment">/* Start with key definitions */</span>
<a name="l01478"></a>01478    <span class="keywordflow">for</span> (x = 0; x &lt; scr-&gt;<a class="code" href="structadsi__script.html#a2a2bc6427e5e73762ff9ed591294fa7d">numkeys</a>; x++) {
<a name="l01479"></a>01479       <span class="keywordflow">if</span> (bytes + scr-&gt;<a class="code" href="structadsi__script.html#adfc4c259f04b196894e168eb1eac555f">keys</a>[x].<a class="code" href="structadsi__soft__key.html#ab6b099f2c0f7e492b8e5bc27627cedbc">retstrlen</a> &gt; 253) {
<a name="l01480"></a>01480          <span class="comment">/* Send what we&apos;ve collected so far */</span>
<a name="l01481"></a>01481          <span class="keywordflow">if</span> (<a class="code" href="adsi_8h.html#ade0991b7687ddb977a60f3699753e8df">ast_adsi_transmit_message</a>(chan, buf, bytes, <a class="code" href="adsi_8h.html#a2e0a51a5c3ebbb2933612622c37cd8e0">ADSI_MSG_DOWNLOAD</a>)) {
<a name="l01482"></a>01482             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to send chunk ending at %d\n&quot;</span>, x);
<a name="l01483"></a>01483             <span class="keywordflow">return</span> -1;
<a name="l01484"></a>01484          }
<a name="l01485"></a>01485          bytes =0;
<a name="l01486"></a>01486       }
<a name="l01487"></a>01487       memcpy(buf + bytes, scr-&gt;<a class="code" href="structadsi__script.html#adfc4c259f04b196894e168eb1eac555f">keys</a>[x].<a class="code" href="structadsi__soft__key.html#a9be5b50ad2d70413ccaa9ba65dd3c733">retstr</a>, scr-&gt;<a class="code" href="structadsi__script.html#adfc4c259f04b196894e168eb1eac555f">keys</a>[x].<a class="code" href="structadsi__soft__key.html#ab6b099f2c0f7e492b8e5bc27627cedbc">retstrlen</a>);
<a name="l01488"></a>01488       bytes += scr-&gt;<a class="code" href="structadsi__script.html#adfc4c259f04b196894e168eb1eac555f">keys</a>[x].<a class="code" href="structadsi__soft__key.html#ab6b099f2c0f7e492b8e5bc27627cedbc">retstrlen</a>;
<a name="l01489"></a>01489 <span class="preprocessor">#ifdef DUMP_MESSAGES</span>
<a name="l01490"></a>01490 <span class="preprocessor"></span>      dump_message(<span class="stringliteral">&quot;Key&quot;</span>, scr-&gt;<a class="code" href="structadsi__script.html#adfc4c259f04b196894e168eb1eac555f">keys</a>[x].<a class="code" href="structadsi__soft__key.html#af781142f98a00b542e50998f1be48230">vname</a>, scr-&gt;<a class="code" href="structadsi__script.html#adfc4c259f04b196894e168eb1eac555f">keys</a>[x].<a class="code" href="structadsi__soft__key.html#a9be5b50ad2d70413ccaa9ba65dd3c733">retstr</a>, scr-&gt;<a class="code" href="structadsi__script.html#adfc4c259f04b196894e168eb1eac555f">keys</a>[x].<a class="code" href="structadsi__soft__key.html#ab6b099f2c0f7e492b8e5bc27627cedbc">retstrlen</a>);
<a name="l01491"></a>01491 <span class="preprocessor">#endif</span>
<a name="l01492"></a>01492 <span class="preprocessor"></span>   }
<a name="l01493"></a>01493    <span class="keywordflow">if</span> (bytes) {
<a name="l01494"></a>01494       <span class="keywordflow">if</span> (<a class="code" href="adsi_8h.html#ade0991b7687ddb977a60f3699753e8df">ast_adsi_transmit_message</a>(chan, buf, bytes, <a class="code" href="adsi_8h.html#a2e0a51a5c3ebbb2933612622c37cd8e0">ADSI_MSG_DOWNLOAD</a>)) {
<a name="l01495"></a>01495          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to send chunk ending at %d\n&quot;</span>, x);
<a name="l01496"></a>01496          <span class="keywordflow">return</span> -1;
<a name="l01497"></a>01497       }
<a name="l01498"></a>01498    }
<a name="l01499"></a>01499 
<a name="l01500"></a>01500    bytes = 0;
<a name="l01501"></a>01501    <span class="comment">/* Continue with the display messages */</span>
<a name="l01502"></a>01502    <span class="keywordflow">for</span> (x = 0; x &lt; scr-&gt;<a class="code" href="structadsi__script.html#a2a6f934ad060f9a1e4920791fe4126c8">numdisplays</a>; x++) {
<a name="l01503"></a>01503       <span class="keywordflow">if</span> (bytes + scr-&gt;<a class="code" href="structadsi__script.html#ad04f477fcc502d48613cfb4760e4c25d">displays</a>[x].<a class="code" href="structadsi__display.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> &gt; 253) {
<a name="l01504"></a>01504          <span class="comment">/* Send what we&apos;ve collected so far */</span>
<a name="l01505"></a>01505          <span class="keywordflow">if</span> (<a class="code" href="adsi_8h.html#ade0991b7687ddb977a60f3699753e8df">ast_adsi_transmit_message</a>(chan, buf, bytes, <a class="code" href="adsi_8h.html#a2e0a51a5c3ebbb2933612622c37cd8e0">ADSI_MSG_DOWNLOAD</a>)) {
<a name="l01506"></a>01506             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to send chunk ending at %d\n&quot;</span>, x);
<a name="l01507"></a>01507             <span class="keywordflow">return</span> -1;
<a name="l01508"></a>01508          }
<a name="l01509"></a>01509          bytes =0;
<a name="l01510"></a>01510       }
<a name="l01511"></a>01511       memcpy(buf + bytes, scr-&gt;<a class="code" href="structadsi__script.html#ad04f477fcc502d48613cfb4760e4c25d">displays</a>[x].<a class="code" href="structadsi__display.html#a3b33566e63aeeb4d270d4a15a887a48a">data</a>, scr-&gt;<a class="code" href="structadsi__script.html#ad04f477fcc502d48613cfb4760e4c25d">displays</a>[x].<a class="code" href="structadsi__display.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>);
<a name="l01512"></a>01512       bytes += scr-&gt;<a class="code" href="structadsi__script.html#ad04f477fcc502d48613cfb4760e4c25d">displays</a>[x].<a class="code" href="structadsi__display.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>;
<a name="l01513"></a>01513 <span class="preprocessor">#ifdef DUMP_MESSAGES</span>
<a name="l01514"></a>01514 <span class="preprocessor"></span>      dump_message(<span class="stringliteral">&quot;Display&quot;</span>, scr-&gt;<a class="code" href="structadsi__script.html#ad04f477fcc502d48613cfb4760e4c25d">displays</a>[x].<a class="code" href="structadsi__display.html#af781142f98a00b542e50998f1be48230">vname</a>, scr-&gt;<a class="code" href="structadsi__script.html#ad04f477fcc502d48613cfb4760e4c25d">displays</a>[x].<a class="code" href="structadsi__display.html#a3b33566e63aeeb4d270d4a15a887a48a">data</a>, scr-&gt;<a class="code" href="structadsi__script.html#ad04f477fcc502d48613cfb4760e4c25d">displays</a>[x].<a class="code" href="structadsi__display.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>);
<a name="l01515"></a>01515 <span class="preprocessor">#endif</span>
<a name="l01516"></a>01516 <span class="preprocessor"></span>   }
<a name="l01517"></a>01517    <span class="keywordflow">if</span> (bytes) {
<a name="l01518"></a>01518       <span class="keywordflow">if</span> (<a class="code" href="adsi_8h.html#ade0991b7687ddb977a60f3699753e8df">ast_adsi_transmit_message</a>(chan, buf, bytes, <a class="code" href="adsi_8h.html#a2e0a51a5c3ebbb2933612622c37cd8e0">ADSI_MSG_DOWNLOAD</a>)) {
<a name="l01519"></a>01519          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to send chunk ending at %d\n&quot;</span>, x);
<a name="l01520"></a>01520          <span class="keywordflow">return</span> -1;
<a name="l01521"></a>01521       }
<a name="l01522"></a>01522    }
<a name="l01523"></a>01523 
<a name="l01524"></a>01524    bytes = 0;
<a name="l01525"></a>01525    <span class="comment">/* Send subroutines */</span>
<a name="l01526"></a>01526    <span class="keywordflow">for</span> (x = 0; x &lt; scr-&gt;<a class="code" href="structadsi__script.html#acd5c8ec5a9d632d17afeacba7bc97366">numsubs</a>; x++) {
<a name="l01527"></a>01527       <span class="keywordflow">if</span> (bytes + scr-&gt;<a class="code" href="structadsi__script.html#a02c62f8b0c39859e0c9e8556c4c2f404">subs</a>[x].<a class="code" href="structadsi__subscript.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> &gt; 253) {
<a name="l01528"></a>01528          <span class="comment">/* Send what we&apos;ve collected so far */</span>
<a name="l01529"></a>01529          <span class="keywordflow">if</span> (<a class="code" href="adsi_8h.html#ade0991b7687ddb977a60f3699753e8df">ast_adsi_transmit_message</a>(chan, buf, bytes, <a class="code" href="adsi_8h.html#a2e0a51a5c3ebbb2933612622c37cd8e0">ADSI_MSG_DOWNLOAD</a>)) {
<a name="l01530"></a>01530             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to send chunk ending at %d\n&quot;</span>, x);
<a name="l01531"></a>01531             <span class="keywordflow">return</span> -1;
<a name="l01532"></a>01532          }
<a name="l01533"></a>01533          bytes =0;
<a name="l01534"></a>01534       }
<a name="l01535"></a>01535       memcpy(buf + bytes, scr-&gt;<a class="code" href="structadsi__script.html#a02c62f8b0c39859e0c9e8556c4c2f404">subs</a>[x].<a class="code" href="structadsi__subscript.html#ae75ec805c7e74dcf4dae969c03d32661">data</a>, scr-&gt;<a class="code" href="structadsi__script.html#a02c62f8b0c39859e0c9e8556c4c2f404">subs</a>[x].<a class="code" href="structadsi__subscript.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>);
<a name="l01536"></a>01536       bytes += scr-&gt;<a class="code" href="structadsi__script.html#a02c62f8b0c39859e0c9e8556c4c2f404">subs</a>[x].<a class="code" href="structadsi__subscript.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>;
<a name="l01537"></a>01537 <span class="preprocessor">#ifdef DUMP_MESSAGES</span>
<a name="l01538"></a>01538 <span class="preprocessor"></span>      dump_message(<span class="stringliteral">&quot;Sub&quot;</span>, scr-&gt;<a class="code" href="structadsi__script.html#a02c62f8b0c39859e0c9e8556c4c2f404">subs</a>[x].<a class="code" href="structadsi__subscript.html#af781142f98a00b542e50998f1be48230">vname</a>, scr-&gt;<a class="code" href="structadsi__script.html#a02c62f8b0c39859e0c9e8556c4c2f404">subs</a>[x].<a class="code" href="structadsi__subscript.html#ae75ec805c7e74dcf4dae969c03d32661">data</a>, scr-&gt;<a class="code" href="structadsi__script.html#a02c62f8b0c39859e0c9e8556c4c2f404">subs</a>[x].<a class="code" href="structadsi__subscript.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>);
<a name="l01539"></a>01539 <span class="preprocessor">#endif</span>
<a name="l01540"></a>01540 <span class="preprocessor"></span>   }
<a name="l01541"></a>01541    <span class="keywordflow">if</span> (bytes) {
<a name="l01542"></a>01542       <span class="keywordflow">if</span> (<a class="code" href="adsi_8h.html#ade0991b7687ddb977a60f3699753e8df">ast_adsi_transmit_message</a>(chan, buf, bytes, <a class="code" href="adsi_8h.html#a2e0a51a5c3ebbb2933612622c37cd8e0">ADSI_MSG_DOWNLOAD</a>)) {
<a name="l01543"></a>01543          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to send chunk ending at %d\n&quot;</span>, x);
<a name="l01544"></a>01544          <span class="keywordflow">return</span> -1;
<a name="l01545"></a>01545       }
<a name="l01546"></a>01546    }
<a name="l01547"></a>01547 
<a name="l01548"></a>01548    bytes = 0;
<a name="l01549"></a>01549    bytes += <a class="code" href="adsi_8h.html#a4ef17399d8bd69e82a97b7673d599ec2" title="Loads a line of info into the display.">ast_adsi_display</a>(buf, <a class="code" href="adsi_8h.html#a1024eb317e88742fde2143333130b0b6">ADSI_INFO_PAGE</a>, 1, <a class="code" href="adsi_8h.html#a730b24255e33ddaa2bc4e52b51220100">ADSI_JUST_LEFT</a>, 0, <span class="stringliteral">&quot;Download complete.&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l01550"></a>01550    bytes += <a class="code" href="adsi_8h.html#a14a3721e40e8ebc9b56271d9fd9e93af" title="Sets the current line and page.">ast_adsi_set_line</a>(buf, <a class="code" href="adsi_8h.html#a1024eb317e88742fde2143333130b0b6">ADSI_INFO_PAGE</a>, 1);
<a name="l01551"></a>01551    <span class="keywordflow">if</span> (<a class="code" href="adsi_8h.html#ade0991b7687ddb977a60f3699753e8df">ast_adsi_transmit_message</a>(chan, buf, bytes, <a class="code" href="adsi_8h.html#a5f65b445dd274af93d891153a82808cf">ADSI_MSG_DISPLAY</a>) &lt; 0)
<a name="l01552"></a>01552       <span class="keywordflow">return</span> -1;
<a name="l01553"></a>01553    <span class="keywordflow">if</span> (<a class="code" href="adsi_8h.html#a12c4576517435afede8d83ca1ea8e7dd">ast_adsi_end_download</a>(chan)) {
<a name="l01554"></a>01554       <span class="comment">/* Download failed for some reason */</span>
<a name="l01555"></a>01555       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Download attempt failed\n&quot;</span>);
<a name="l01556"></a>01556       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Download failed on %s\n&quot;</span>, chan-&gt;name);
<a name="l01557"></a>01557       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(scr);
<a name="l01558"></a>01558       <span class="keywordflow">return</span> -1;
<a name="l01559"></a>01559    }
<a name="l01560"></a>01560    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(scr);
<a name="l01561"></a>01561    <a class="code" href="adsi_8h.html#aa65291a80a241bda57a53d4f26ec5bed">ast_adsi_unload_session</a>(chan);
<a name="l01562"></a>01562    <span class="keywordflow">return</span> 0;
<a name="l01563"></a>01563 }
<a name="l01564"></a>01564 
<a name="l01565"></a><a class="code" href="app__adsiprog_8c.html#ac58f53434dc0e8ac14326a55ccd253c6">01565</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="app__adsiprog_8c.html#ac58f53434dc0e8ac14326a55ccd253c6">adsi_exec</a>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, <span class="keywordtype">void</span> *data)
<a name="l01566"></a>01566 {
<a name="l01567"></a>01567    <span class="keywordtype">int</span> res = 0;
<a name="l01568"></a>01568    
<a name="l01569"></a>01569    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(data))
<a name="l01570"></a>01570       data = <span class="stringliteral">&quot;asterisk.adsi&quot;</span>;
<a name="l01571"></a>01571 
<a name="l01572"></a>01572    <span class="keywordflow">if</span> (!<a class="code" href="adsi_8h.html#af28e8c6a680742f32b9c39ea26e398f3" title="Returns non-zero if Channel does or might support ADSI.">ast_adsi_available</a>(chan)) {
<a name="l01573"></a>01573       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;ADSI Unavailable on CPE.  Not bothering to try.\n&quot;</span>);
<a name="l01574"></a>01574    } <span class="keywordflow">else</span> {
<a name="l01575"></a>01575       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;ADSI Available on CPE.  Attempting Upload.\n&quot;</span>);
<a name="l01576"></a>01576       res = <a class="code" href="app__adsiprog_8c.html#ac44d3b59ca1471de484b2fc9d8e8993c">adsi_prog</a>(chan, data);
<a name="l01577"></a>01577    }
<a name="l01578"></a>01578 
<a name="l01579"></a>01579    <span class="keywordflow">return</span> res;
<a name="l01580"></a>01580 }
<a name="l01581"></a>01581 
<a name="l01582"></a><a class="code" href="app__adsiprog_8c.html#ad09fa931f468002152a3cc2d5ce25eae">01582</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="agent_8c.html#a95bac1db604c69a01ef7b3995342cd7a">unload_module</a>(<span class="keywordtype">void</span>)
<a name="l01583"></a>01583 {
<a name="l01584"></a>01584    <span class="keywordflow">return</span> <a class="code" href="module_8h.html#ad2ca15621101154f29748cf1dac3c3cf" title="Unregister an application.">ast_unregister_application</a>(app);
<a name="l01585"></a>01585 }
<a name="l01586"></a>01586 
<a name="l01587"></a><a class="code" href="app__adsiprog_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">01587</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="app__adsiprog_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a>(<span class="keywordtype">void</span>)
<a name="l01588"></a>01588 {
<a name="l01589"></a>01589    <span class="keywordflow">if</span> (<a class="code" href="module_8h.html#afba4eb7a910b10969041ae4cd488729d" title="Register an application using XML documentation.">ast_register_application_xml</a>(app, <a class="code" href="app__adsiprog_8c.html#ac58f53434dc0e8ac14326a55ccd253c6">adsi_exec</a>))
<a name="l01590"></a>01590       <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfa8724da3ad620df86524280e760add388">AST_MODULE_LOAD_FAILURE</a>;
<a name="l01591"></a>01591    <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a>;
<a name="l01592"></a>01592 }
<a name="l01593"></a>01593 
<a name="l01594"></a>01594 <a class="code" href="module_8h.html#a70ea6b2dde349dfaae4d21d93b9a5683">AST_MODULE_INFO_STANDARD</a>(<a class="code" href="module_8h.html#aba2c8d4be709a254658b21a834f8294a" title="The text the key() function should return.">ASTERISK_GPL_KEY</a>, <span class="stringliteral">&quot;Asterisk ADSI Programming Application&quot;</span>);
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:18:24 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
