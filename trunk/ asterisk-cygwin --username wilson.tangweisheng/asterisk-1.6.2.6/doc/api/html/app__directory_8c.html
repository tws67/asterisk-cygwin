<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:18:55 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_7739c4bd2a7c382676c2c912043775c7.html">apps</a>
  </div>
</div>
<div class="contents">
<h1>app_directory.c File Reference</h1>
<p>Provide a directory of extensions.  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="asterisk_8h_source.html">asterisk.h</a>&quot;</code><br/>
<code>#include &lt;ctype.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="paths_8h_source.html">asterisk/paths.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="file_8h_source.html">asterisk/file.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="pbx_8h_source.html">asterisk/pbx.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="module_8h_source.html">asterisk/module.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="say_8h_source.html">asterisk/say.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="app_8h_source.html">asterisk/app.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="utils_8h_source.html">asterisk/utils.h</a>&quot;</code><br/>

<p><a href="app__directory_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structdirectory__item.html">directory_item</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__directory_8c.html#a62e6fabd28e7d7a9941945c7fde3bda6">VOICEMAIL_CONFIG</a>&nbsp;&nbsp;&nbsp;&quot;voicemail.conf&quot;</td></tr>
<tr><td colspan="2"><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom">{ <br/>
&nbsp;&nbsp;<a class="el" href="app__directory_8c.html#a385c44f6fb256e5716a2302a5b940388a695c5cdd1eb7c764031e7d80b673950d">OPT_ARG_FIRSTNAME</a> =  0, 
<a class="el" href="app__directory_8c.html#a385c44f6fb256e5716a2302a5b940388a1f0f9f0c092737ac21f4fb42681af8aa">OPT_ARG_LASTNAME</a> =  1, 
<a class="el" href="app__directory_8c.html#a385c44f6fb256e5716a2302a5b940388af13b51c690c1129a7b98f06a35f41bb6">OPT_ARG_EITHER</a> =  2, 
<a class="el" href="app__directory_8c.html#a385c44f6fb256e5716a2302a5b940388a8c8fc6c9a237f184209e0be944211f1a">OPT_ARG_PAUSE</a> =  3, 
<br/>
&nbsp;&nbsp;<a class="el" href="app__directory_8c.html#a385c44f6fb256e5716a2302a5b940388aec7326f60e7edad15d96ff935e5616d6">OPT_ARG_ARRAY_SIZE</a> =  4
<br/>
 }</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom">{ <br/>
&nbsp;&nbsp;<a class="el" href="app__directory_8c.html#ab04a0655cd1e3bcac5e8f48c18df1a57a07ddbe7b2361ed4dc1ea23ac17beb206">OPT_LISTBYFIRSTNAME</a> =  (1 &lt;&lt; 0), 
<a class="el" href="app__directory_8c.html#ab04a0655cd1e3bcac5e8f48c18df1a57a94223020f1266eb08abd4ec3f307b0a0">OPT_SAYEXTENSION</a> =  (1 &lt;&lt; 1), 
<a class="el" href="app__directory_8c.html#ab04a0655cd1e3bcac5e8f48c18df1a57aeb8bbdb286b4e727f61048703d57a686">OPT_FROMVOICEMAIL</a> =  (1 &lt;&lt; 2), 
<a class="el" href="app__directory_8c.html#ab04a0655cd1e3bcac5e8f48c18df1a57ad8d6a9101512c9760ebdc635fb1a6bcd">OPT_SELECTFROMMENU</a> =  (1 &lt;&lt; 3), 
<br/>
&nbsp;&nbsp;<a class="el" href="app__directory_8c.html#ab04a0655cd1e3bcac5e8f48c18df1a57a7055cf6034461c78becde2198f6a6aa2">OPT_LISTBYLASTNAME</a> =  (1 &lt;&lt; 4), 
<a class="el" href="app__directory_8c.html#ab04a0655cd1e3bcac5e8f48c18df1a57a49560c2d4376e7ae27ceff90e5af66e6">OPT_LISTBYEITHER</a> =  OPT_LISTBYFIRSTNAME | OPT_LISTBYLASTNAME, 
<a class="el" href="app__directory_8c.html#ab04a0655cd1e3bcac5e8f48c18df1a57ae54e9e96fa7aa1d2b4809b9c3dbed441">OPT_PAUSE</a> =  (1 &lt;&lt; 5)
<br/>
 }</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__directory_8c.html#a688ed943c565539574eee538849c7973">AST_APP_OPTIONS</a> (directory_app_options,{AST_APP_OPTION_ARG('<a class="el" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>', OPT_LISTBYFIRSTNAME, OPT_ARG_FIRSTNAME), AST_APP_OPTION_ARG('l', OPT_LISTBYLASTNAME, OPT_ARG_LASTNAME), AST_APP_OPTION_ARG('b', OPT_LISTBYEITHER, OPT_ARG_EITHER), AST_APP_OPTION_ARG('p', OPT_PAUSE, OPT_ARG_PAUSE), AST_APP_OPTION('e', OPT_SAYEXTENSION), AST_APP_OPTION('v', OPT_FROMVOICEMAIL), AST_APP_OPTION('m', OPT_SELECTFROMMENU),})</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__directory_8c.html#ada8d260242f07d3811cb57ab069bfe54">AST_LIST_HEAD_NOLOCK</a> (<a class="el" href="structdirectory__item.html">directory_item</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__directory_8c.html#ac48afb1ecfe5c02c7d0afad66a7eca34">AST_MODULE_INFO_STANDARD</a> (ASTERISK_GPL_KEY,&quot;Extension Directory&quot;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__directory_8c.html#a727ca1d79db96f13d0ac1da995cf1d68">check_match</a> (struct <a class="el" href="structdirectory__item.html">directory_item</a> **result, const char *item_context, const char *item_fullname, const char *item_ext, const char *pattern_ext, int use_first_name)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__directory_8c.html#adf773af7f5d8ca288a3a68fc3659d95c">compare</a> (const char *<a class="el" href="app__queue_8c.html#a5633b1433389cec21ade3811bbe9ca5b">text</a>, const char *template)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__directory_8c.html#a95b7ecdd4594874d46eb128e420142d7">directory_exec</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__directory_8c.html#ae9bc5a847f9d29d1739ae9f7ca2c9c71">do_directory</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structast__config.html">ast_config</a> *vmcfg, struct <a class="el" href="structast__config.html">ast_config</a> *ucfg, char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, char *<a class="el" href="app__voicemail_8c.html#a695d5aca89839d016497739454f9779a">dialcontext</a>, char digit, int digits, struct <a class="el" href="structast__flags.html">ast_flags</a> *flags)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__directory_8c.html#a4abe4549602d1caa18efe2b4ffc09e65">goto_exten</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *<a class="el" href="app__voicemail_8c.html#a695d5aca89839d016497739454f9779a">dialcontext</a>, char *<a class="el" href="res__phoneprov_8c.html#a71ac783a3ca66bd546dc964f1dd0e0f0">ext</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__directory_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__directory_8c.html#a9b7f6a60e87ca035b380bd836305b084">play_mailbox_owner</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, const char *<a class="el" href="res__phoneprov_8c.html#a71ac783a3ca66bd546dc964f1dd0e0f0">ext</a>, const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, struct <a class="el" href="structast__flags.html">ast_flags</a> *flags)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__config.html">ast_config</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__directory_8c.html#aae65c22521b984632f1a4be9bc5fa22f">realtime_directory</a> (char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__directory_8c.html#acfa24d65aa83a292e4d4f9faaf3227c0">search_directory</a> (const char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, struct <a class="el" href="structast__config.html">ast_config</a> *vmcfg, struct <a class="el" href="structast__config.html">ast_config</a> *ucfg, const char *<a class="el" href="res__phoneprov_8c.html#a71ac783a3ca66bd546dc964f1dd0e0f0">ext</a>, struct <a class="el" href="structast__flags.html">ast_flags</a> flags, itemlist *alist)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__directory_8c.html#a8c03b4df5b417fa42d5e7ce7db696319">select_entry</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *<a class="el" href="app__voicemail_8c.html#a695d5aca89839d016497739454f9779a">dialcontext</a>, const struct <a class="el" href="structdirectory__item.html">directory_item</a> *item, struct <a class="el" href="structast__flags.html">ast_flags</a> *flags)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__directory_8c.html#a912f19830f78d23995311923108a2f37">select_item_menu</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structdirectory__item.html">directory_item</a> **items, int count, const char *<a class="el" href="app__voicemail_8c.html#a695d5aca89839d016497739454f9779a">dialcontext</a>, struct <a class="el" href="structast__flags.html">ast_flags</a> *flags)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__directory_8c.html#ab7dd75de6e3856c3091c3724c2deb504">select_item_seq</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structdirectory__item.html">directory_item</a> **items, int count, const char *<a class="el" href="app__voicemail_8c.html#a695d5aca89839d016497739454f9779a">dialcontext</a>, struct <a class="el" href="structast__flags.html">ast_flags</a> *flags)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__directory_8c.html#a6c0f63ace71012f347e4e34f45dfcea1">sort_items</a> (struct <a class="el" href="structdirectory__item.html">directory_item</a> **sorted, int count)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__directory_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a> (void)</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__directory_8c.html#a9e5f57131367eff409b9e0bd7b31aa1a">app</a> = &quot;Directory&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum  { ... } &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__directory_8c.html#afabdb6af0ceca9bea92229e123d8de02">directory_option_flags</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Provide a directory of extensions. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Mark Spencer &lt;<a href="mailto:markster@digium.com">markster@digium.com</a>&gt; </dd></dl>

<p>Definition in file <a class="el" href="app__directory_8c_source.html">app_directory.c</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a62e6fabd28e7d7a9941945c7fde3bda6"></a><!-- doxytag: member="app_directory.c::VOICEMAIL_CONFIG" ref="a62e6fabd28e7d7a9941945c7fde3bda6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VOICEMAIL_CONFIG&nbsp;&nbsp;&nbsp;&quot;voicemail.conf&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__directory_8c_source.html#l00122">122</a> of file <a class="el" href="app__directory_8c_source.html">app_directory.c</a>.</p>

<p>Referenced by <a class="el" href="app__minivm_8c_source.html#l02573">load_config()</a>, <a class="el" href="app__directory_8c_source.html#l00382">realtime_directory()</a>, and <a class="el" href="app__voicemail_8c_source.html#l01357">vm_change_password()</a>.</p>

</div>
</div>
<hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="a385c44f6fb256e5716a2302a5b940388"></a><!-- doxytag: member="app_directory.c::@10" ref="a385c44f6fb256e5716a2302a5b940388" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">anonymous enum</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a385c44f6fb256e5716a2302a5b940388a695c5cdd1eb7c764031e7d80b673950d"></a><!-- doxytag: member="OPT_ARG_FIRSTNAME" ref="a385c44f6fb256e5716a2302a5b940388a695c5cdd1eb7c764031e7d80b673950d" args="" -->OPT_ARG_FIRSTNAME</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a385c44f6fb256e5716a2302a5b940388a1f0f9f0c092737ac21f4fb42681af8aa"></a><!-- doxytag: member="OPT_ARG_LASTNAME" ref="a385c44f6fb256e5716a2302a5b940388a1f0f9f0c092737ac21f4fb42681af8aa" args="" -->OPT_ARG_LASTNAME</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a385c44f6fb256e5716a2302a5b940388af13b51c690c1129a7b98f06a35f41bb6"></a><!-- doxytag: member="OPT_ARG_EITHER" ref="a385c44f6fb256e5716a2302a5b940388af13b51c690c1129a7b98f06a35f41bb6" args="" -->OPT_ARG_EITHER</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a385c44f6fb256e5716a2302a5b940388a8c8fc6c9a237f184209e0be944211f1a"></a><!-- doxytag: member="OPT_ARG_PAUSE" ref="a385c44f6fb256e5716a2302a5b940388a8c8fc6c9a237f184209e0be944211f1a" args="" -->OPT_ARG_PAUSE</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a385c44f6fb256e5716a2302a5b940388aec7326f60e7edad15d96ff935e5616d6"></a><!-- doxytag: member="OPT_ARG_ARRAY_SIZE" ref="a385c44f6fb256e5716a2302a5b940388aec7326f60e7edad15d96ff935e5616d6" args="" -->OPT_ARG_ARRAY_SIZE</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="app__directory_8c_source.html#l00134">134</a> of file <a class="el" href="app__directory_8c_source.html">app_directory.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00134"></a>00134      {
<a name="l00135"></a>00135    <a class="code" href="app__directory_8c.html#a385c44f6fb256e5716a2302a5b940388a695c5cdd1eb7c764031e7d80b673950d">OPT_ARG_FIRSTNAME</a> =   0,
<a name="l00136"></a>00136    <a class="code" href="app__directory_8c.html#a385c44f6fb256e5716a2302a5b940388a1f0f9f0c092737ac21f4fb42681af8aa">OPT_ARG_LASTNAME</a> =    1,
<a name="l00137"></a>00137    <a class="code" href="app__directory_8c.html#a385c44f6fb256e5716a2302a5b940388af13b51c690c1129a7b98f06a35f41bb6">OPT_ARG_EITHER</a> =      2,
<a name="l00138"></a>00138    <a class="code" href="app__directory_8c.html#a385c44f6fb256e5716a2302a5b940388a8c8fc6c9a237f184209e0be944211f1a">OPT_ARG_PAUSE</a> =       3,
<a name="l00139"></a>00139    <span class="comment">/* This *must* be the last value in this enum! */</span>
<a name="l00140"></a>00140    <a class="code" href="app__chanspy_8c.html#a99fb83031ce9923c84392b4e92f956b5aec7326f60e7edad15d96ff935e5616d6">OPT_ARG_ARRAY_SIZE</a> =  4,
<a name="l00141"></a>00141 };
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab04a0655cd1e3bcac5e8f48c18df1a57"></a><!-- doxytag: member="app_directory.c::@9" ref="ab04a0655cd1e3bcac5e8f48c18df1a57" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">anonymous enum</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="ab04a0655cd1e3bcac5e8f48c18df1a57a07ddbe7b2361ed4dc1ea23ac17beb206"></a><!-- doxytag: member="OPT_LISTBYFIRSTNAME" ref="ab04a0655cd1e3bcac5e8f48c18df1a57a07ddbe7b2361ed4dc1ea23ac17beb206" args="" -->OPT_LISTBYFIRSTNAME</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ab04a0655cd1e3bcac5e8f48c18df1a57a94223020f1266eb08abd4ec3f307b0a0"></a><!-- doxytag: member="OPT_SAYEXTENSION" ref="ab04a0655cd1e3bcac5e8f48c18df1a57a94223020f1266eb08abd4ec3f307b0a0" args="" -->OPT_SAYEXTENSION</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ab04a0655cd1e3bcac5e8f48c18df1a57aeb8bbdb286b4e727f61048703d57a686"></a><!-- doxytag: member="OPT_FROMVOICEMAIL" ref="ab04a0655cd1e3bcac5e8f48c18df1a57aeb8bbdb286b4e727f61048703d57a686" args="" -->OPT_FROMVOICEMAIL</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ab04a0655cd1e3bcac5e8f48c18df1a57ad8d6a9101512c9760ebdc635fb1a6bcd"></a><!-- doxytag: member="OPT_SELECTFROMMENU" ref="ab04a0655cd1e3bcac5e8f48c18df1a57ad8d6a9101512c9760ebdc635fb1a6bcd" args="" -->OPT_SELECTFROMMENU</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ab04a0655cd1e3bcac5e8f48c18df1a57a7055cf6034461c78becde2198f6a6aa2"></a><!-- doxytag: member="OPT_LISTBYLASTNAME" ref="ab04a0655cd1e3bcac5e8f48c18df1a57a7055cf6034461c78becde2198f6a6aa2" args="" -->OPT_LISTBYLASTNAME</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ab04a0655cd1e3bcac5e8f48c18df1a57a49560c2d4376e7ae27ceff90e5af66e6"></a><!-- doxytag: member="OPT_LISTBYEITHER" ref="ab04a0655cd1e3bcac5e8f48c18df1a57a49560c2d4376e7ae27ceff90e5af66e6" args="" -->OPT_LISTBYEITHER</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ab04a0655cd1e3bcac5e8f48c18df1a57ae54e9e96fa7aa1d2b4809b9c3dbed441"></a><!-- doxytag: member="OPT_PAUSE" ref="ab04a0655cd1e3bcac5e8f48c18df1a57ae54e9e96fa7aa1d2b4809b9c3dbed441" args="" -->OPT_PAUSE</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="app__directory_8c_source.html#l00124">124</a> of file <a class="el" href="app__directory_8c_source.html">app_directory.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00124"></a>00124      {
<a name="l00125"></a>00125    <a class="code" href="app__directory_8c.html#ab04a0655cd1e3bcac5e8f48c18df1a57a07ddbe7b2361ed4dc1ea23ac17beb206">OPT_LISTBYFIRSTNAME</a> = (1 &lt;&lt; 0),
<a name="l00126"></a>00126    <a class="code" href="app__directory_8c.html#ab04a0655cd1e3bcac5e8f48c18df1a57a94223020f1266eb08abd4ec3f307b0a0">OPT_SAYEXTENSION</a> =    (1 &lt;&lt; 1),
<a name="l00127"></a>00127    <a class="code" href="app__directory_8c.html#ab04a0655cd1e3bcac5e8f48c18df1a57aeb8bbdb286b4e727f61048703d57a686">OPT_FROMVOICEMAIL</a> =   (1 &lt;&lt; 2),
<a name="l00128"></a>00128    <a class="code" href="app__directory_8c.html#ab04a0655cd1e3bcac5e8f48c18df1a57ad8d6a9101512c9760ebdc635fb1a6bcd">OPT_SELECTFROMMENU</a> =  (1 &lt;&lt; 3),
<a name="l00129"></a>00129    <a class="code" href="app__directory_8c.html#ab04a0655cd1e3bcac5e8f48c18df1a57a7055cf6034461c78becde2198f6a6aa2">OPT_LISTBYLASTNAME</a> =  (1 &lt;&lt; 4),
<a name="l00130"></a>00130    <a class="code" href="app__directory_8c.html#ab04a0655cd1e3bcac5e8f48c18df1a57a49560c2d4376e7ae27ceff90e5af66e6">OPT_LISTBYEITHER</a> =    <a class="code" href="app__directory_8c.html#ab04a0655cd1e3bcac5e8f48c18df1a57a07ddbe7b2361ed4dc1ea23ac17beb206">OPT_LISTBYFIRSTNAME</a> | <a class="code" href="app__directory_8c.html#ab04a0655cd1e3bcac5e8f48c18df1a57a7055cf6034461c78becde2198f6a6aa2">OPT_LISTBYLASTNAME</a>,
<a name="l00131"></a>00131    <a class="code" href="app__directory_8c.html#ab04a0655cd1e3bcac5e8f48c18df1a57ae54e9e96fa7aa1d2b4809b9c3dbed441">OPT_PAUSE</a> =           (1 &lt;&lt; 5),
<a name="l00132"></a>00132 } <a class="code" href="app__directory_8c.html#afabdb6af0ceca9bea92229e123d8de02">directory_option_flags</a>;
</pre></div></p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a688ed943c565539574eee538849c7973"></a><!-- doxytag: member="app_directory.c::AST_APP_OPTIONS" ref="a688ed943c565539574eee538849c7973" args="(directory_app_options,{AST_APP_OPTION_ARG('f', OPT_LISTBYFIRSTNAME, OPT_ARG_FIRSTNAME), AST_APP_OPTION_ARG('l', OPT_LISTBYLASTNAME, OPT_ARG_LASTNAME), AST_APP_OPTION_ARG('b', OPT_LISTBYEITHER, OPT_ARG_EITHER), AST_APP_OPTION_ARG('p', OPT_PAUSE, OPT_ARG_PAUSE), AST_APP_OPTION('e', OPT_SAYEXTENSION), AST_APP_OPTION('v', OPT_FROMVOICEMAIL), AST_APP_OPTION('m', OPT_SELECTFROMMENU),})" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">AST_APP_OPTIONS </td>
          <td>(</td>
          <td class="paramtype">directory_app_options&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="ada8d260242f07d3811cb57ab069bfe54"></a><!-- doxytag: member="app_directory.c::AST_LIST_HEAD_NOLOCK" ref="ada8d260242f07d3811cb57ab069bfe54" args="(directory_item)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef AST_LIST_HEAD_NOLOCK </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structdirectory__item.html">directory_item</a>&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__directory_8c_source.html#l00505">505</a> of file <a class="el" href="app__directory_8c_source.html">app_directory.c</a>.</p>

<p>References <a class="el" href="config_8c_source.html#l00613">ast_category_browse()</a>, <a class="el" href="config_8c_source.html#l00424">ast_config_option()</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="linkedlists_8h_source.html#l00715">AST_LIST_INSERT_TAIL</a>, <a class="el" href="channel_8h_source.html#l00134">AST_MAX_EXTENSION</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="utils_8c_source.html#l01311">ast_true()</a>, <a class="el" href="config_8c_source.html#l00411">ast_variable_browse()</a>, <a class="el" href="config_8c_source.html#l00435">ast_variable_retrieve()</a>, <a class="el" href="adsistub_8c_source.html#l00059">buf</a>, <a class="el" href="app__directory_8c_source.html#l00460">check_match()</a>, <a class="el" href="config_8h_source.html#l00075">ast_variable::name</a>, <a class="el" href="config_8h_source.html#l00077">ast_variable::next</a>, <a class="el" href="app__directory_8c_source.html#l00125">OPT_LISTBYFIRSTNAME</a>, <a class="el" href="app__directory_8c_source.html#l00129">OPT_LISTBYLASTNAME</a>, <a class="el" href="agi_2strcompat_8c_source.html#l00093">strcasestr()</a>, <a class="el" href="agi_2strcompat_8c_source.html#l00027">strsep()</a>, and <a class="el" href="config_8h_source.html#l00076">ast_variable::value</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00508"></a>00508 {
<a name="l00509"></a>00509    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *v;
<a name="l00510"></a>00510    <span class="keywordtype">char</span> <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[<a class="code" href="channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a> + 1], *pos, *bufptr, *cat;
<a name="l00511"></a>00511    <span class="keyword">struct </span><a class="code" href="structdirectory__item.html">directory_item</a> *item;
<a name="l00512"></a>00512    <span class="keywordtype">int</span> res;
<a name="l00513"></a>00513 
<a name="l00514"></a>00514    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;Pattern: %s\n&quot;</span>, <a class="code" href="http_8c.html#af9b32121c4ad80b0887a3d73fd24de5f">ext</a>);
<a name="l00515"></a>00515 
<a name="l00516"></a>00516    <span class="keywordflow">for</span> (v = <a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(vmcfg, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>); v; v = v-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l00517"></a>00517 
<a name="l00518"></a>00518       <span class="comment">/* Ignore hidden */</span>
<a name="l00519"></a>00519       <span class="keywordflow">if</span> (<a class="code" href="agi_2strcompat_8c.html#ae9229017a4501f8d6a637b4498cfed2e">strcasestr</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;hidefromdir=yes&quot;</span>))
<a name="l00520"></a>00520          <span class="keywordflow">continue</span>;
<a name="l00521"></a>00521 
<a name="l00522"></a>00522       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(buf, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(buf));
<a name="l00523"></a>00523       bufptr = buf;
<a name="l00524"></a>00524 
<a name="l00525"></a>00525       <span class="comment">/* password,Full Name,email,pager,options */</span>
<a name="l00526"></a>00526       <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;bufptr, <span class="stringliteral">&quot;,&quot;</span>);
<a name="l00527"></a>00527       pos = <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;bufptr, <span class="stringliteral">&quot;,&quot;</span>);
<a name="l00528"></a>00528 
<a name="l00529"></a>00529       <span class="comment">/* No name to compare against */</span>
<a name="l00530"></a>00530       <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(pos)) {
<a name="l00531"></a>00531          <span class="keywordflow">continue</span>;
<a name="l00532"></a>00532       }
<a name="l00533"></a>00533 
<a name="l00534"></a>00534       res = 0;
<a name="l00535"></a>00535       <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="app__directory_8c.html#ab04a0655cd1e3bcac5e8f48c18df1a57a7055cf6034461c78becde2198f6a6aa2">OPT_LISTBYLASTNAME</a>)) {
<a name="l00536"></a>00536          res = <a class="code" href="app__directory_8c.html#a727ca1d79db96f13d0ac1da995cf1d68">check_match</a>(&amp;item, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, pos, v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <a class="code" href="http_8c.html#af9b32121c4ad80b0887a3d73fd24de5f">ext</a>, 0 <span class="comment">/* use_first_name */</span>);
<a name="l00537"></a>00537       }
<a name="l00538"></a>00538       <span class="keywordflow">if</span> (!res &amp;&amp; <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="app__directory_8c.html#ab04a0655cd1e3bcac5e8f48c18df1a57a07ddbe7b2361ed4dc1ea23ac17beb206">OPT_LISTBYFIRSTNAME</a>)) {
<a name="l00539"></a>00539          res = <a class="code" href="app__directory_8c.html#a727ca1d79db96f13d0ac1da995cf1d68">check_match</a>(&amp;item, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, pos, v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <a class="code" href="http_8c.html#af9b32121c4ad80b0887a3d73fd24de5f">ext</a>, 1 <span class="comment">/* use_first_name */</span>);
<a name="l00540"></a>00540       }
<a name="l00541"></a>00541 
<a name="l00542"></a>00542       <span class="keywordflow">if</span> (!res)
<a name="l00543"></a>00543          <span class="keywordflow">continue</span>;
<a name="l00544"></a>00544       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res &lt; 0)
<a name="l00545"></a>00545          <span class="keywordflow">return</span> -1;
<a name="l00546"></a>00546 
<a name="l00547"></a>00547       <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(alist, item, entry);
<a name="l00548"></a>00548    }
<a name="l00549"></a>00549 
<a name="l00550"></a>00550    <span class="keywordflow">if</span> (ucfg) {
<a name="l00551"></a>00551       <span class="keywordflow">for</span> (cat = <a class="code" href="config_8h.html#a611776300f941a63266cb220ac62b4db" title="Goes through categories.">ast_category_browse</a>(ucfg, NULL); cat ; cat = <a class="code" href="config_8h.html#a611776300f941a63266cb220ac62b4db" title="Goes through categories.">ast_category_browse</a>(ucfg, cat)) {
<a name="l00552"></a>00552          <span class="keyword">const</span> <span class="keywordtype">char</span> *position;
<a name="l00553"></a>00553          <span class="keywordflow">if</span> (!strcasecmp(cat, <span class="stringliteral">&quot;general&quot;</span>))
<a name="l00554"></a>00554             <span class="keywordflow">continue</span>;
<a name="l00555"></a>00555          <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(<a class="code" href="config_8h.html#ad9fd2625614158b152434e45acf1d78b" title="Retrieve a configuration variable within the configuration set. Retrieves the named...">ast_config_option</a>(ucfg, cat, <span class="stringliteral">&quot;hasdirectory&quot;</span>)))
<a name="l00556"></a>00556             <span class="keywordflow">continue</span>;
<a name="l00557"></a>00557 
<a name="l00558"></a>00558          <span class="comment">/* Find all candidate extensions */</span>
<a name="l00559"></a>00559          position = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(ucfg, cat, <span class="stringliteral">&quot;fullname&quot;</span>);
<a name="l00560"></a>00560          <span class="keywordflow">if</span> (!position)
<a name="l00561"></a>00561             <span class="keywordflow">continue</span>;
<a name="l00562"></a>00562 
<a name="l00563"></a>00563          res = 0;
<a name="l00564"></a>00564          <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="app__directory_8c.html#ab04a0655cd1e3bcac5e8f48c18df1a57a7055cf6034461c78becde2198f6a6aa2">OPT_LISTBYLASTNAME</a>)) {
<a name="l00565"></a>00565             res = <a class="code" href="app__directory_8c.html#a727ca1d79db96f13d0ac1da995cf1d68">check_match</a>(&amp;item, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, position, cat, <a class="code" href="http_8c.html#af9b32121c4ad80b0887a3d73fd24de5f">ext</a>, 0 <span class="comment">/* use_first_name */</span>);
<a name="l00566"></a>00566          }
<a name="l00567"></a>00567          <span class="keywordflow">if</span> (!res &amp;&amp; <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="app__directory_8c.html#ab04a0655cd1e3bcac5e8f48c18df1a57a07ddbe7b2361ed4dc1ea23ac17beb206">OPT_LISTBYFIRSTNAME</a>)) {
<a name="l00568"></a>00568             res = <a class="code" href="app__directory_8c.html#a727ca1d79db96f13d0ac1da995cf1d68">check_match</a>(&amp;item, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, position, cat, <a class="code" href="http_8c.html#af9b32121c4ad80b0887a3d73fd24de5f">ext</a>, 1 <span class="comment">/* use_first_name */</span>);
<a name="l00569"></a>00569          }
<a name="l00570"></a>00570 
<a name="l00571"></a>00571          <span class="keywordflow">if</span> (!res)
<a name="l00572"></a>00572             <span class="keywordflow">continue</span>;
<a name="l00573"></a>00573          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res &lt; 0)
<a name="l00574"></a>00574             <span class="keywordflow">return</span> -1;
<a name="l00575"></a>00575 
<a name="l00576"></a>00576          <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(alist, item, entry);
<a name="l00577"></a>00577       }
<a name="l00578"></a>00578    }
<a name="l00579"></a>00579    <span class="keywordflow">return</span> 0;
<a name="l00580"></a>00580 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac48afb1ecfe5c02c7d0afad66a7eca34"></a><!-- doxytag: member="app_directory.c::AST_MODULE_INFO_STANDARD" ref="ac48afb1ecfe5c02c7d0afad66a7eca34" args="(ASTERISK_GPL_KEY,&quot;Extension Directory&quot;)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">AST_MODULE_INFO_STANDARD </td>
          <td>(</td>
          <td class="paramtype">ASTERISK_GPL_KEY&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&quot;Extension Directory&quot;&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a727ca1d79db96f13d0ac1da995cf1d68"></a><!-- doxytag: member="app_directory.c::check_match" ref="a727ca1d79db96f13d0ac1da995cf1d68" args="(struct directory_item **result, const char *item_context, const char *item_fullname, const char *item_ext, const char *pattern_ext, int use_first_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int check_match </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdirectory__item.html">directory_item</a> **&nbsp;</td>
          <td class="paramname"> <em>result</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>item_context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>item_fullname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>item_ext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>pattern_ext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>use_first_name</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__directory_8c_source.html#l00460">460</a> of file <a class="el" href="app__directory_8c_source.html">app_directory.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="app__directory_8c_source.html#l00162">compare()</a>, <a class="el" href="app__directory_8c_source.html#l00146">directory_item::context</a>, <a class="el" href="app__directory_8c_source.html#l00144">directory_item::exten</a>, <a class="el" href="app__directory_8c_source.html#l00147">directory_item::key</a>, and <a class="el" href="app__directory_8c_source.html#l00145">directory_item::name</a>.</p>

<p>Referenced by <a class="el" href="app__directory_8c_source.html#l00505">AST_LIST_HEAD_NOLOCK()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00461"></a>00461 {
<a name="l00462"></a>00462    <span class="keyword">struct </span><a class="code" href="structdirectory__item.html">directory_item</a> *item;
<a name="l00463"></a>00463    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structdirectory__item.html#a0d2242a26ccc2fe03904d009ae23de4d">key</a> = NULL;
<a name="l00464"></a>00464    <span class="keywordtype">int</span> namelen;
<a name="l00465"></a>00465 
<a name="l00466"></a>00466    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(item_fullname)) {
<a name="l00467"></a>00467       <span class="keywordflow">return</span> 0;
<a name="l00468"></a>00468    }
<a name="l00469"></a>00469 
<a name="l00470"></a>00470    <span class="comment">/* Set key to last name or first name depending on search mode */</span>
<a name="l00471"></a>00471    <span class="keywordflow">if</span> (!use_first_name)
<a name="l00472"></a>00472       key = strchr(item_fullname, <span class="charliteral">&apos; &apos;</span>);
<a name="l00473"></a>00473 
<a name="l00474"></a>00474    <span class="keywordflow">if</span> (key)
<a name="l00475"></a>00475       key++;
<a name="l00476"></a>00476    <span class="keywordflow">else</span>
<a name="l00477"></a>00477       key = item_fullname;
<a name="l00478"></a>00478 
<a name="l00479"></a>00479    <span class="keywordflow">if</span> (<a class="code" href="app__directory_8c.html#adf773af7f5d8ca288a3a68fc3659d95c">compare</a>(key, pattern_ext))
<a name="l00480"></a>00480       <span class="keywordflow">return</span> 0;
<a name="l00481"></a>00481 
<a name="l00482"></a>00482    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Found match %s@%s\n&quot;</span>, item_ext, item_context);
<a name="l00483"></a>00483 
<a name="l00484"></a>00484    <span class="comment">/* Match */</span>
<a name="l00485"></a>00485    item = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*item));
<a name="l00486"></a>00486    <span class="keywordflow">if</span> (!item)
<a name="l00487"></a>00487       <span class="keywordflow">return</span> -1;
<a name="l00488"></a>00488    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(item-&gt;<a class="code" href="structdirectory__item.html#a25965a26a05a3325299c4b693960a4e0">context</a>, item_context, <span class="keyword">sizeof</span>(item-&gt;<a class="code" href="structdirectory__item.html#a25965a26a05a3325299c4b693960a4e0">context</a>));
<a name="l00489"></a>00489    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(item-&gt;<a class="code" href="structdirectory__item.html#a1c46613278470da923cf68a39bf947f4">name</a>, item_fullname, <span class="keyword">sizeof</span>(item-&gt;<a class="code" href="structdirectory__item.html#a1c46613278470da923cf68a39bf947f4">name</a>));
<a name="l00490"></a>00490    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(item-&gt;<a class="code" href="structdirectory__item.html#aa8ad22aa2eb725296bb02c8985001d6c">exten</a>, item_ext, <span class="keyword">sizeof</span>(item-&gt;<a class="code" href="structdirectory__item.html#aa8ad22aa2eb725296bb02c8985001d6c">exten</a>));
<a name="l00491"></a>00491 
<a name="l00492"></a>00492    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(item-&gt;<a class="code" href="structdirectory__item.html#a0d2242a26ccc2fe03904d009ae23de4d">key</a>, key, <span class="keyword">sizeof</span>(item-&gt;<a class="code" href="structdirectory__item.html#a0d2242a26ccc2fe03904d009ae23de4d">key</a>));
<a name="l00493"></a>00493    <span class="keywordflow">if</span> (key != item_fullname) {
<a name="l00494"></a>00494       <span class="comment">/* Key is the last name. Append first name to key in order to sort Last,First */</span>
<a name="l00495"></a>00495       namelen = key - item_fullname - 1;
<a name="l00496"></a>00496       <span class="keywordflow">if</span> (namelen &gt; <span class="keyword">sizeof</span>(item-&gt;<a class="code" href="structdirectory__item.html#a0d2242a26ccc2fe03904d009ae23de4d">key</a>) - strlen(item-&gt;<a class="code" href="structdirectory__item.html#a0d2242a26ccc2fe03904d009ae23de4d">key</a>) - 1)
<a name="l00497"></a>00497          namelen = <span class="keyword">sizeof</span>(item-&gt;<a class="code" href="structdirectory__item.html#a0d2242a26ccc2fe03904d009ae23de4d">key</a>) - strlen(item-&gt;<a class="code" href="structdirectory__item.html#a0d2242a26ccc2fe03904d009ae23de4d">key</a>) - 1;
<a name="l00498"></a>00498       strncat(item-&gt;<a class="code" href="structdirectory__item.html#a0d2242a26ccc2fe03904d009ae23de4d">key</a>, item_fullname, namelen);
<a name="l00499"></a>00499    }
<a name="l00500"></a>00500 
<a name="l00501"></a>00501    *result = item;
<a name="l00502"></a>00502    <span class="keywordflow">return</span> 1;
<a name="l00503"></a>00503 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="adf773af7f5d8ca288a3a68fc3659d95c"></a><!-- doxytag: member="app_directory.c::compare" ref="adf773af7f5d8ca288a3a68fc3659d95c" args="(const char *text, const char *template)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int compare </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>text</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>template</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__directory_8c_source.html#l00162">162</a> of file <a class="el" href="app__directory_8c_source.html">app_directory.c</a>.</p>

<p>References <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>.</p>

<p>Referenced by <a class="el" href="hashtab_8c_source.html#l00222">ast_hashtab_create()</a>, and <a class="el" href="app__directory_8c_source.html#l00460">check_match()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00163"></a>00163 {
<a name="l00164"></a>00164    <span class="keywordtype">char</span> digit;
<a name="l00165"></a>00165 
<a name="l00166"></a>00166    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="app__queue_8c.html#a5633b1433389cec21ade3811bbe9ca5b">text</a>)) {
<a name="l00167"></a>00167       <span class="keywordflow">return</span> -1;
<a name="l00168"></a>00168    }
<a name="l00169"></a>00169 
<a name="l00170"></a>00170    <span class="keywordflow">while</span> (*<span class="keyword">template</span>) {
<a name="l00171"></a>00171       digit = toupper(*<a class="code" href="app__queue_8c.html#a5633b1433389cec21ade3811bbe9ca5b">text</a>++);
<a name="l00172"></a>00172       <span class="keywordflow">switch</span> (digit) {
<a name="l00173"></a>00173       <span class="keywordflow">case</span> 0:
<a name="l00174"></a>00174          <span class="keywordflow">return</span> -1;
<a name="l00175"></a>00175       <span class="keywordflow">case</span> <span class="charliteral">&apos;1&apos;</span>:
<a name="l00176"></a>00176          digit = <span class="charliteral">&apos;1&apos;</span>;
<a name="l00177"></a>00177          <span class="keywordflow">break</span>;
<a name="l00178"></a>00178       <span class="keywordflow">case</span> <span class="charliteral">&apos;2&apos;</span>:
<a name="l00179"></a>00179       <span class="keywordflow">case</span> <span class="charliteral">&apos;A&apos;</span>:
<a name="l00180"></a>00180       <span class="keywordflow">case</span> <span class="charliteral">&apos;B&apos;</span>:
<a name="l00181"></a>00181       <span class="keywordflow">case</span> <span class="charliteral">&apos;C&apos;</span>:
<a name="l00182"></a>00182          digit = <span class="charliteral">&apos;2&apos;</span>;
<a name="l00183"></a>00183          <span class="keywordflow">break</span>;
<a name="l00184"></a>00184       <span class="keywordflow">case</span> <span class="charliteral">&apos;3&apos;</span>:
<a name="l00185"></a>00185       <span class="keywordflow">case</span> <span class="charliteral">&apos;D&apos;</span>:
<a name="l00186"></a>00186       <span class="keywordflow">case</span> <span class="charliteral">&apos;E&apos;</span>:
<a name="l00187"></a>00187       <span class="keywordflow">case</span> <span class="charliteral">&apos;F&apos;</span>:
<a name="l00188"></a>00188          digit = <span class="charliteral">&apos;3&apos;</span>;
<a name="l00189"></a>00189          <span class="keywordflow">break</span>;
<a name="l00190"></a>00190       <span class="keywordflow">case</span> <span class="charliteral">&apos;4&apos;</span>:
<a name="l00191"></a>00191       <span class="keywordflow">case</span> <span class="charliteral">&apos;G&apos;</span>:
<a name="l00192"></a>00192       <span class="keywordflow">case</span> <span class="charliteral">&apos;H&apos;</span>:
<a name="l00193"></a>00193       <span class="keywordflow">case</span> <span class="charliteral">&apos;I&apos;</span>:
<a name="l00194"></a>00194          digit = <span class="charliteral">&apos;4&apos;</span>;
<a name="l00195"></a>00195          <span class="keywordflow">break</span>;
<a name="l00196"></a>00196       <span class="keywordflow">case</span> <span class="charliteral">&apos;5&apos;</span>:
<a name="l00197"></a>00197       <span class="keywordflow">case</span> <span class="charliteral">&apos;J&apos;</span>:
<a name="l00198"></a>00198       <span class="keywordflow">case</span> <span class="charliteral">&apos;K&apos;</span>:
<a name="l00199"></a>00199       <span class="keywordflow">case</span> <span class="charliteral">&apos;L&apos;</span>:
<a name="l00200"></a>00200          digit = <span class="charliteral">&apos;5&apos;</span>;
<a name="l00201"></a>00201          <span class="keywordflow">break</span>;
<a name="l00202"></a>00202       <span class="keywordflow">case</span> <span class="charliteral">&apos;6&apos;</span>:
<a name="l00203"></a>00203       <span class="keywordflow">case</span> <span class="charliteral">&apos;M&apos;</span>:
<a name="l00204"></a>00204       <span class="keywordflow">case</span> <span class="charliteral">&apos;N&apos;</span>:
<a name="l00205"></a>00205       <span class="keywordflow">case</span> <span class="charliteral">&apos;O&apos;</span>:
<a name="l00206"></a>00206          digit = <span class="charliteral">&apos;6&apos;</span>;
<a name="l00207"></a>00207          <span class="keywordflow">break</span>;
<a name="l00208"></a>00208       <span class="keywordflow">case</span> <span class="charliteral">&apos;7&apos;</span>:
<a name="l00209"></a>00209       <span class="keywordflow">case</span> <span class="charliteral">&apos;P&apos;</span>:
<a name="l00210"></a>00210       <span class="keywordflow">case</span> <span class="charliteral">&apos;Q&apos;</span>:
<a name="l00211"></a>00211       <span class="keywordflow">case</span> <span class="charliteral">&apos;R&apos;</span>:
<a name="l00212"></a>00212       <span class="keywordflow">case</span> <span class="charliteral">&apos;S&apos;</span>:
<a name="l00213"></a>00213          digit = <span class="charliteral">&apos;7&apos;</span>;
<a name="l00214"></a>00214          <span class="keywordflow">break</span>;
<a name="l00215"></a>00215       <span class="keywordflow">case</span> <span class="charliteral">&apos;8&apos;</span>:
<a name="l00216"></a>00216       <span class="keywordflow">case</span> <span class="charliteral">&apos;T&apos;</span>:
<a name="l00217"></a>00217       <span class="keywordflow">case</span> <span class="charliteral">&apos;U&apos;</span>:
<a name="l00218"></a>00218       <span class="keywordflow">case</span> <span class="charliteral">&apos;V&apos;</span>:
<a name="l00219"></a>00219          digit = <span class="charliteral">&apos;8&apos;</span>;
<a name="l00220"></a>00220          <span class="keywordflow">break</span>;
<a name="l00221"></a>00221       <span class="keywordflow">case</span> <span class="charliteral">&apos;9&apos;</span>:
<a name="l00222"></a>00222       <span class="keywordflow">case</span> <span class="charliteral">&apos;W&apos;</span>:
<a name="l00223"></a>00223       <span class="keywordflow">case</span> <span class="charliteral">&apos;X&apos;</span>:
<a name="l00224"></a>00224       <span class="keywordflow">case</span> <span class="charliteral">&apos;Y&apos;</span>:
<a name="l00225"></a>00225       <span class="keywordflow">case</span> <span class="charliteral">&apos;Z&apos;</span>:
<a name="l00226"></a>00226          digit = <span class="charliteral">&apos;9&apos;</span>;
<a name="l00227"></a>00227          <span class="keywordflow">break</span>;
<a name="l00228"></a>00228 
<a name="l00229"></a>00229       <span class="keywordflow">default</span>:
<a name="l00230"></a>00230          <span class="keywordflow">if</span> (digit &gt; <span class="charliteral">&apos; &apos;</span>)
<a name="l00231"></a>00231             <span class="keywordflow">return</span> -1;
<a name="l00232"></a>00232          <span class="keywordflow">continue</span>;
<a name="l00233"></a>00233       }
<a name="l00234"></a>00234 
<a name="l00235"></a>00235       <span class="keywordflow">if</span> (*<span class="keyword">template</span>++ != digit)
<a name="l00236"></a>00236          <span class="keywordflow">return</span> -1;
<a name="l00237"></a>00237    }
<a name="l00238"></a>00238 
<a name="l00239"></a>00239    <span class="keywordflow">return</span> 0;
<a name="l00240"></a>00240 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a95b7ecdd4594874d46eb128e420142d7"></a><!-- doxytag: member="app_directory.c::directory_exec" ref="a95b7ecdd4594874d46eb128e420142d7" args="(struct ast_channel *chan, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int directory_exec </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__directory_8c_source.html#l00723">723</a> of file <a class="el" href="app__directory_8c_source.html">app_directory.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00469">ast_channel::_state</a>, <a class="el" href="channel_8c_source.html#l01951">ast_answer()</a>, <a class="el" href="app_8h_source.html#l00338">AST_APP_ARG</a>, <a class="el" href="app_8c_source.html#l01776">ast_app_parse_options()</a>, <a class="el" href="config_8c_source.html#l00827">ast_config_destroy()</a>, <a class="el" href="config_8h_source.html#l00139">ast_config_load</a>, <a class="el" href="app_8h_source.html#l00355">AST_DECLARE_APP_ARGS</a>, <a class="el" href="file_8h_source.html#l00047">AST_DIGIT_ANY</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="utils_8h_source.html#l00068">ast_set_flag</a>, <a class="el" href="app_8h_source.html#l00387">AST_STANDARD_APP_ARGS</a>, <a class="el" href="channel_8h_source.html#l00365">AST_STATE_UP</a>, <a class="el" href="file_8c_source.html#l00122">ast_stopstream()</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="file_8c_source.html#l01342">ast_stream_and_wait()</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="config_8c_source.html#l00435">ast_variable_retrieve()</a>, <a class="el" href="channel_8c_source.html#l02400">ast_waitfordigit()</a>, <a class="el" href="file_8c_source.html#l01315">ast_waitstream()</a>, <a class="el" href="config_8h_source.html#l00050">CONFIG_STATUS_FILEINVALID</a>, <a class="el" href="app__voicemail_8c_source.html#l00797">dialcontext</a>, <a class="el" href="app__directory_8c_source.html#l00646">do_directory()</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="app__chanspy_8c_source.html#l00319">OPT_ARG_ARRAY_SIZE</a>, <a class="el" href="app__directory_8c_source.html#l00137">OPT_ARG_EITHER</a>, <a class="el" href="app__directory_8c_source.html#l00135">OPT_ARG_FIRSTNAME</a>, <a class="el" href="app__directory_8c_source.html#l00136">OPT_ARG_LASTNAME</a>, <a class="el" href="app__directory_8c_source.html#l00125">OPT_LISTBYFIRSTNAME</a>, <a class="el" href="app__directory_8c_source.html#l00129">OPT_LISTBYLASTNAME</a>, <a class="el" href="chan__mgcp_8c_source.html#l01737">parse()</a>, and <a class="el" href="app__directory_8c_source.html#l00382">realtime_directory()</a>.</p>

<p>Referenced by <a class="el" href="app__directory_8c_source.html#l00847">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00724"></a>00724 {
<a name="l00725"></a>00725    <span class="keywordtype">int</span> res = 0, digit = 3;
<a name="l00726"></a>00726    <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *cfg, *ucfg;
<a name="l00727"></a>00727    <span class="keyword">const</span> <span class="keywordtype">char</span> *dirintro;
<a name="l00728"></a>00728    <span class="keywordtype">char</span> *<a class="code" href="chan__mgcp_8c.html#a2e006acff60d9b3d65d7d60f975d6747">parse</a>, *opts[<a class="code" href="app__chanspy_8c.html#a99fb83031ce9923c84392b4e92f956b5aec7326f60e7edad15d96ff935e5616d6">OPT_ARG_ARRAY_SIZE</a>] = { 0, };
<a name="l00729"></a>00729    <span class="keyword">struct </span><a class="code" href="structast__flags.html" title="Structure used to handle boolean flags.">ast_flags</a> <a class="code" href="structast__flags.html#ac92588540e8c1d014a08cd8a45462b19">flags</a> = { 0 };
<a name="l00730"></a>00730    <span class="keyword">struct </span><a class="code" href="structast__flags.html" title="Structure used to handle boolean flags.">ast_flags</a> <a class="code" href="app__rpt_8c.html#a1f57f20c1f46890828791a4827fe8752">config_flags</a> = { 0 };
<a name="l00731"></a>00731    <span class="keyword">enum</span> { FIRST, LAST, BOTH } which = LAST;
<a name="l00732"></a>00732    <span class="keywordtype">char</span> digits[9] = <span class="stringliteral">&quot;digits/3&quot;</span>;
<a name="l00733"></a>00733    <a class="code" href="app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2" title="Declare a structure to hold an application&amp;#39;s arguments.">AST_DECLARE_APP_ARGS</a>(args,
<a name="l00734"></a>00734       <a class="code" href="app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5" title="Define an application argument.">AST_APP_ARG</a>(vmcontext);
<a name="l00735"></a>00735       <a class="code" href="app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5" title="Define an application argument.">AST_APP_ARG</a>(<a class="code" href="app__voicemail_8c.html#a695d5aca89839d016497739454f9779a">dialcontext</a>);
<a name="l00736"></a>00736       <a class="code" href="app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5" title="Define an application argument.">AST_APP_ARG</a>(options);
<a name="l00737"></a>00737    );
<a name="l00738"></a>00738 
<a name="l00739"></a>00739    parse = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(data);
<a name="l00740"></a>00740 
<a name="l00741"></a>00741    <a class="code" href="app_8h.html#ac08f7eb1eb9476b30987c73e1052ada8" title="Performs the &amp;#39;standard&amp;#39; argument separation process for an application.">AST_STANDARD_APP_ARGS</a>(args, parse);
<a name="l00742"></a>00742 
<a name="l00743"></a>00743    <span class="keywordflow">if</span> (args.options &amp;&amp; <a class="code" href="app_8h.html#af40039f1c49c16d0f6fa33fe9c43a0cb" title="Parses a string containing application options and sets flags/arguments.">ast_app_parse_options</a>(directory_app_options, &amp;flags, opts, args.options))
<a name="l00744"></a>00744       <span class="keywordflow">return</span> -1;
<a name="l00745"></a>00745 
<a name="l00746"></a>00746    <span class="keywordflow">if</span> (!(cfg = <a class="code" href="app__directory_8c.html#aae65c22521b984632f1a4be9bc5fa22f">realtime_directory</a>(args.vmcontext))) {
<a name="l00747"></a>00747       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to read the configuration data!\n&quot;</span>);
<a name="l00748"></a>00748       <span class="keywordflow">return</span> -1;
<a name="l00749"></a>00749    }
<a name="l00750"></a>00750 
<a name="l00751"></a>00751    <span class="keywordflow">if</span> ((ucfg = <a class="code" href="config_8h.html#a0a07ddd6bbcf44485e01c14c96109482">ast_config_load</a>(<span class="stringliteral">&quot;users.conf&quot;</span>, config_flags)) == <a class="code" href="config_8h.html#a8d1a63cdf2c7aff22a77b6e75d93b377">CONFIG_STATUS_FILEINVALID</a>) {
<a name="l00752"></a>00752       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Config file users.conf is in an invalid format.  Aborting.\n&quot;</span>);
<a name="l00753"></a>00753       ucfg = NULL;
<a name="l00754"></a>00754    }
<a name="l00755"></a>00755 
<a name="l00756"></a>00756    dirintro = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, args.vmcontext, <span class="stringliteral">&quot;directoryintro&quot;</span>);
<a name="l00757"></a>00757    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(dirintro))
<a name="l00758"></a>00758       dirintro = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;directoryintro&quot;</span>);
<a name="l00759"></a>00759 
<a name="l00760"></a>00760    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="app__directory_8c.html#ab04a0655cd1e3bcac5e8f48c18df1a57a07ddbe7b2361ed4dc1ea23ac17beb206">OPT_LISTBYFIRSTNAME</a>) &amp;&amp; <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="app__directory_8c.html#ab04a0655cd1e3bcac5e8f48c18df1a57a7055cf6034461c78becde2198f6a6aa2">OPT_LISTBYLASTNAME</a>)) {
<a name="l00761"></a>00761       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(opts[<a class="code" href="app__directory_8c.html#a385c44f6fb256e5716a2302a5b940388af13b51c690c1129a7b98f06a35f41bb6">OPT_ARG_EITHER</a>])) {
<a name="l00762"></a>00762          digit = atoi(opts[OPT_ARG_EITHER]);
<a name="l00763"></a>00763       }
<a name="l00764"></a>00764       which = BOTH;
<a name="l00765"></a>00765    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="app__directory_8c.html#ab04a0655cd1e3bcac5e8f48c18df1a57a07ddbe7b2361ed4dc1ea23ac17beb206">OPT_LISTBYFIRSTNAME</a>)) {
<a name="l00766"></a>00766       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(opts[<a class="code" href="app__directory_8c.html#a385c44f6fb256e5716a2302a5b940388a695c5cdd1eb7c764031e7d80b673950d">OPT_ARG_FIRSTNAME</a>])) {
<a name="l00767"></a>00767          digit = atoi(opts[OPT_ARG_FIRSTNAME]);
<a name="l00768"></a>00768       }
<a name="l00769"></a>00769       which = FIRST;
<a name="l00770"></a>00770    } <span class="keywordflow">else</span> {
<a name="l00771"></a>00771       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(opts[<a class="code" href="app__directory_8c.html#a385c44f6fb256e5716a2302a5b940388a1f0f9f0c092737ac21f4fb42681af8aa">OPT_ARG_LASTNAME</a>])) {
<a name="l00772"></a>00772          digit = atoi(opts[OPT_ARG_LASTNAME]);
<a name="l00773"></a>00773       }
<a name="l00774"></a>00774       which = LAST;
<a name="l00775"></a>00775    }
<a name="l00776"></a>00776 
<a name="l00777"></a>00777    <span class="comment">/* If no options specified, search by last name */</span>
<a name="l00778"></a>00778    <span class="keywordflow">if</span> (!<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="app__directory_8c.html#ab04a0655cd1e3bcac5e8f48c18df1a57a07ddbe7b2361ed4dc1ea23ac17beb206">OPT_LISTBYFIRSTNAME</a>) &amp;&amp; !<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="app__directory_8c.html#ab04a0655cd1e3bcac5e8f48c18df1a57a7055cf6034461c78becde2198f6a6aa2">OPT_LISTBYLASTNAME</a>)) {
<a name="l00779"></a>00779       <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(&amp;flags, <a class="code" href="app__directory_8c.html#ab04a0655cd1e3bcac5e8f48c18df1a57a7055cf6034461c78becde2198f6a6aa2">OPT_LISTBYLASTNAME</a>);
<a name="l00780"></a>00780       which = LAST;
<a name="l00781"></a>00781    }
<a name="l00782"></a>00782 
<a name="l00783"></a>00783    <span class="keywordflow">if</span> (digit &gt; 9) {
<a name="l00784"></a>00784       digit = 9;
<a name="l00785"></a>00785    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (digit &lt; 1) {
<a name="l00786"></a>00786       digit = 3;
<a name="l00787"></a>00787    }
<a name="l00788"></a>00788    digits[7] = digit + <span class="charliteral">&apos;0&apos;</span>;
<a name="l00789"></a>00789 
<a name="l00790"></a>00790    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>)
<a name="l00791"></a>00791       res = <a class="code" href="channel_8h.html#aec583a3e25358ee552a4f3df53914cd0" title="Answer a channel.">ast_answer</a>(chan);
<a name="l00792"></a>00792 
<a name="l00793"></a>00793    <span class="keywordflow">for</span> (;;) {
<a name="l00794"></a>00794       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(dirintro) &amp;&amp; !res) {
<a name="l00795"></a>00795          res = <a class="code" href="file_8h.html#a95b94a020720147325a486e210b36775" title="stream file until digit If the file name is non-empty, try to play it.">ast_stream_and_wait</a>(chan, dirintro, <a class="code" href="file_8h.html#afa92b0106fb7a918ea994c2867ac0a04">AST_DIGIT_ANY</a>);
<a name="l00796"></a>00796       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!res) {
<a name="l00797"></a>00797          <span class="comment">/* Stop playing sounds as soon as we have a digit. */</span>
<a name="l00798"></a>00798          res = <a class="code" href="file_8h.html#a95b94a020720147325a486e210b36775" title="stream file until digit If the file name is non-empty, try to play it.">ast_stream_and_wait</a>(chan, <span class="stringliteral">&quot;dir-welcome&quot;</span>, <a class="code" href="file_8h.html#afa92b0106fb7a918ea994c2867ac0a04">AST_DIGIT_ANY</a>);
<a name="l00799"></a>00799          <span class="keywordflow">if</span> (!res) {
<a name="l00800"></a>00800             res = <a class="code" href="file_8h.html#a95b94a020720147325a486e210b36775" title="stream file until digit If the file name is non-empty, try to play it.">ast_stream_and_wait</a>(chan, <span class="stringliteral">&quot;dir-pls-enter&quot;</span>, <a class="code" href="file_8h.html#afa92b0106fb7a918ea994c2867ac0a04">AST_DIGIT_ANY</a>);
<a name="l00801"></a>00801          }
<a name="l00802"></a>00802          <span class="keywordflow">if</span> (!res) {
<a name="l00803"></a>00803             res = <a class="code" href="file_8h.html#a95b94a020720147325a486e210b36775" title="stream file until digit If the file name is non-empty, try to play it.">ast_stream_and_wait</a>(chan, digits, <a class="code" href="file_8h.html#afa92b0106fb7a918ea994c2867ac0a04">AST_DIGIT_ANY</a>);
<a name="l00804"></a>00804          }
<a name="l00805"></a>00805          <span class="keywordflow">if</span> (!res) {
<a name="l00806"></a>00806             res = <a class="code" href="file_8h.html#a95b94a020720147325a486e210b36775" title="stream file until digit If the file name is non-empty, try to play it.">ast_stream_and_wait</a>(chan, 
<a name="l00807"></a>00807                which == FIRST ? <span class="stringliteral">&quot;dir-first&quot;</span> :
<a name="l00808"></a>00808                which == LAST ? <span class="stringliteral">&quot;dir-last&quot;</span> :
<a name="l00809"></a>00809                <span class="stringliteral">&quot;dir-firstlast&quot;</span>, <a class="code" href="file_8h.html#afa92b0106fb7a918ea994c2867ac0a04">AST_DIGIT_ANY</a>);
<a name="l00810"></a>00810          }
<a name="l00811"></a>00811          <span class="keywordflow">if</span> (!res) {
<a name="l00812"></a>00812             res = <a class="code" href="file_8h.html#a95b94a020720147325a486e210b36775" title="stream file until digit If the file name is non-empty, try to play it.">ast_stream_and_wait</a>(chan, <span class="stringliteral">&quot;dir-usingkeypad&quot;</span>, <a class="code" href="file_8h.html#afa92b0106fb7a918ea994c2867ac0a04">AST_DIGIT_ANY</a>);
<a name="l00813"></a>00813          }
<a name="l00814"></a>00814       }
<a name="l00815"></a>00815       <a class="code" href="file_8h.html#a3092bf11d4bba66f646562759608b1bc" title="Stops a stream.">ast_stopstream</a>(chan);
<a name="l00816"></a>00816       <span class="keywordflow">if</span> (!res)
<a name="l00817"></a>00817          res = <a class="code" href="channel_8h.html#a050bec9a4abc1a599b6573a6091b080c" title="Waits for a digit.">ast_waitfordigit</a>(chan, 5000);
<a name="l00818"></a>00818 
<a name="l00819"></a>00819       <span class="keywordflow">if</span> (res &lt;= 0)
<a name="l00820"></a>00820          <span class="keywordflow">break</span>;
<a name="l00821"></a>00821 
<a name="l00822"></a>00822       res = <a class="code" href="app__directory_8c.html#ae9bc5a847f9d29d1739ae9f7ca2c9c71">do_directory</a>(chan, cfg, ucfg, args.vmcontext, args.dialcontext, res, digit, &amp;flags);
<a name="l00823"></a>00823       <span class="keywordflow">if</span> (res)
<a name="l00824"></a>00824          <span class="keywordflow">break</span>;
<a name="l00825"></a>00825 
<a name="l00826"></a>00826       res = <a class="code" href="file_8h.html#affc21cb57c6bf72a2cb7ec8a379b2137" title="Waits for a stream to stop or digit to be pressed.">ast_waitstream</a>(chan, <a class="code" href="file_8h.html#afa92b0106fb7a918ea994c2867ac0a04">AST_DIGIT_ANY</a>);
<a name="l00827"></a>00827       <a class="code" href="file_8h.html#a3092bf11d4bba66f646562759608b1bc" title="Stops a stream.">ast_stopstream</a>(chan);
<a name="l00828"></a>00828 
<a name="l00829"></a>00829       <span class="keywordflow">if</span> (res)
<a name="l00830"></a>00830          <span class="keywordflow">break</span>;
<a name="l00831"></a>00831    }
<a name="l00832"></a>00832 
<a name="l00833"></a>00833    <span class="keywordflow">if</span> (ucfg)
<a name="l00834"></a>00834       <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(ucfg);
<a name="l00835"></a>00835    <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(cfg);
<a name="l00836"></a>00836 
<a name="l00837"></a>00837    <span class="keywordflow">return</span> res &lt; 0 ? -1 : 0;
<a name="l00838"></a>00838 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae9bc5a847f9d29d1739ae9f7ca2c9c71"></a><!-- doxytag: member="app_directory.c::do_directory" ref="ae9bc5a847f9d29d1739ae9f7ca2c9c71" args="(struct ast_channel *chan, struct ast_config *vmcfg, struct ast_config *ucfg, char *context, char *dialcontext, char digit, int digits, struct ast_flags *flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int do_directory </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__config.html">ast_config</a> *&nbsp;</td>
          <td class="paramname"> <em>vmcfg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__config.html">ast_config</a> *&nbsp;</td>
          <td class="paramname"> <em>ucfg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>dialcontext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>digit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>digits</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__flags.html">ast_flags</a> *&nbsp;</td>
          <td class="paramname"> <em>flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__directory_8c_source.html#l00646">646</a> of file <a class="el" href="app__directory_8c_source.html">app_directory.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="linkedlists_8h_source.html#l00251">AST_LIST_HEAD_NOLOCK_INIT_VALUE</a>, <a class="el" href="linkedlists_8h_source.html#l00817">AST_LIST_REMOVE_HEAD</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="channel_8c_source.html#l04088">ast_readstring()</a>, <a class="el" href="file_8c_source.html#l00943">ast_streamfile()</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="http_8c_source.html#l00097">ext</a>, <a class="el" href="app__directory_8c_source.html#l00144">directory_item::exten</a>, <a class="el" href="app__directory_8c_source.html#l00633">goto_exten()</a>, <a class="el" href="app__directory_8c_source.html#l00145">directory_item::name</a>, <a class="el" href="app__directory_8c_source.html#l00128">OPT_SELECTFROMMENU</a>, <a class="el" href="asterisk_8c_source.html#l00175">option_debug</a>, <a class="el" href="strings_8h_source.html#l00072">S_OR</a>, <a class="el" href="app__directory_8c_source.html#l00582">search_directory()</a>, <a class="el" href="app__directory_8c_source.html#l00322">select_item_menu()</a>, <a class="el" href="app__directory_8c_source.html#l00287">select_item_seq()</a>, and <a class="el" href="app__directory_8c_source.html#l00611">sort_items()</a>.</p>

<p>Referenced by <a class="el" href="app__directory_8c_source.html#l00723">directory_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00647"></a>00647 {
<a name="l00648"></a>00648    <span class="comment">/* Read in the first three digits..  &quot;digit&quot; is the first digit, already read */</span>
<a name="l00649"></a>00649    <span class="keywordtype">int</span> res = 0;
<a name="l00650"></a>00650    itemlist alist = <a class="code" href="linkedlists_8h.html#a5a79a9dc65f139cedb64503d171d5df4" title="Defines initial values for a declaration of AST_LIST_HEAD_NOLOCK.">AST_LIST_HEAD_NOLOCK_INIT_VALUE</a>;
<a name="l00651"></a>00651    <span class="keyword">struct </span><a class="code" href="structdirectory__item.html">directory_item</a> *item, **ptr, **sorted = NULL;
<a name="l00652"></a>00652    <span class="keywordtype">int</span> count, i;
<a name="l00653"></a>00653    <span class="keywordtype">char</span> <a class="code" href="http_8c.html#af9b32121c4ad80b0887a3d73fd24de5f">ext</a>[10] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00654"></a>00654 
<a name="l00655"></a>00655    <span class="keywordflow">if</span> (digit == <span class="charliteral">&apos;0&apos;</span> &amp;&amp; !<a class="code" href="app__directory_8c.html#a4abe4549602d1caa18efe2b4ffc09e65">goto_exten</a>(chan, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(<a class="code" href="app__voicemail_8c.html#a695d5aca89839d016497739454f9779a">dialcontext</a>, <span class="stringliteral">&quot;default&quot;</span>), <span class="stringliteral">&quot;o&quot;</span>)) {
<a name="l00656"></a>00656       <span class="keywordflow">return</span> digit;
<a name="l00657"></a>00657    }
<a name="l00658"></a>00658 
<a name="l00659"></a>00659    <span class="keywordflow">if</span> (digit == <span class="charliteral">&apos;*&apos;</span> &amp;&amp; !<a class="code" href="app__directory_8c.html#a4abe4549602d1caa18efe2b4ffc09e65">goto_exten</a>(chan, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(<a class="code" href="app__voicemail_8c.html#a695d5aca89839d016497739454f9779a">dialcontext</a>, <span class="stringliteral">&quot;default&quot;</span>), <span class="stringliteral">&quot;a&quot;</span>)) {
<a name="l00660"></a>00660       <span class="keywordflow">return</span> digit;
<a name="l00661"></a>00661    }
<a name="l00662"></a>00662 
<a name="l00663"></a>00663    ext[0] = digit;
<a name="l00664"></a>00664    <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#ae68c6e4af7aba456ec08906cb9fb3140">ast_readstring</a>(chan, ext + 1, digits - 1, 3000, 3000, <span class="stringliteral">&quot;#&quot;</span>) &lt; 0)
<a name="l00665"></a>00665       <span class="keywordflow">return</span> -1;
<a name="l00666"></a>00666 
<a name="l00667"></a>00667    res = <a class="code" href="app__directory_8c.html#acfa24d65aa83a292e4d4f9faaf3227c0">search_directory</a>(<a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, vmcfg, ucfg, ext, *flags, &amp;alist);
<a name="l00668"></a>00668    <span class="keywordflow">if</span> (res)
<a name="l00669"></a>00669       <span class="keywordflow">goto</span> exit;
<a name="l00670"></a>00670 
<a name="l00671"></a>00671    <span class="comment">/* Count items in the list */</span>
<a name="l00672"></a>00672    count = 0;
<a name="l00673"></a>00673    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;alist, item, entry) {
<a name="l00674"></a>00674       count++;
<a name="l00675"></a>00675    }
<a name="l00676"></a>00676 
<a name="l00677"></a>00677    <span class="keywordflow">if</span> (count &lt; 1) {
<a name="l00678"></a>00678       res = <a class="code" href="file_8h.html#a67c7e271b4ca70aca6d48fd48d121857" title="Streams a file.">ast_streamfile</a>(chan, <span class="stringliteral">&quot;dir-nomatch&quot;</span>, chan-&gt;language);
<a name="l00679"></a>00679       <span class="keywordflow">goto</span> exit;
<a name="l00680"></a>00680    }
<a name="l00681"></a>00681 
<a name="l00682"></a>00682 
<a name="l00683"></a>00683    <span class="comment">/* Create plain array of pointers to items (for sorting) */</span>
<a name="l00684"></a>00684    sorted = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(count, <span class="keyword">sizeof</span>(*sorted));
<a name="l00685"></a>00685 
<a name="l00686"></a>00686    ptr = sorted;
<a name="l00687"></a>00687    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;alist, item, entry) {
<a name="l00688"></a>00688       *ptr++ = item;
<a name="l00689"></a>00689    }
<a name="l00690"></a>00690 
<a name="l00691"></a>00691    <span class="comment">/* Sort items */</span>
<a name="l00692"></a>00692    <a class="code" href="app__directory_8c.html#a6c0f63ace71012f347e4e34f45dfcea1">sort_items</a>(sorted, count);
<a name="l00693"></a>00693 
<a name="l00694"></a>00694    <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#ga40f8fb2e731031d99f732f515cec680f">option_debug</a>) {
<a name="l00695"></a>00695       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;Listing matching entries:\n&quot;</span>);
<a name="l00696"></a>00696       <span class="keywordflow">for</span> (ptr = sorted, i = 0; i &lt; count; i++, ptr++) {
<a name="l00697"></a>00697          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;%s: %s\n&quot;</span>, ptr[0]-&gt;<a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, ptr[0]-&gt;<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l00698"></a>00698       }
<a name="l00699"></a>00699    }
<a name="l00700"></a>00700 
<a name="l00701"></a>00701    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(flags, <a class="code" href="app__directory_8c.html#ab04a0655cd1e3bcac5e8f48c18df1a57ad8d6a9101512c9760ebdc635fb1a6bcd">OPT_SELECTFROMMENU</a>)) {
<a name="l00702"></a>00702       <span class="comment">/* Offer multiple entries at the same time */</span>
<a name="l00703"></a>00703       res = <a class="code" href="app__directory_8c.html#a912f19830f78d23995311923108a2f37">select_item_menu</a>(chan, sorted, count, <a class="code" href="app__voicemail_8c.html#a695d5aca89839d016497739454f9779a">dialcontext</a>, flags);
<a name="l00704"></a>00704    } <span class="keywordflow">else</span> {
<a name="l00705"></a>00705       <span class="comment">/* Offer entries one by one */</span>
<a name="l00706"></a>00706       res = <a class="code" href="app__directory_8c.html#ab7dd75de6e3856c3091c3724c2deb504">select_item_seq</a>(chan, sorted, count, <a class="code" href="app__voicemail_8c.html#a695d5aca89839d016497739454f9779a">dialcontext</a>, flags);
<a name="l00707"></a>00707    }
<a name="l00708"></a>00708 
<a name="l00709"></a>00709    <span class="keywordflow">if</span> (!res) {
<a name="l00710"></a>00710       res = <a class="code" href="file_8h.html#a67c7e271b4ca70aca6d48fd48d121857" title="Streams a file.">ast_streamfile</a>(chan, <span class="stringliteral">&quot;dir-nomore&quot;</span>, chan-&gt;language);
<a name="l00711"></a>00711    }
<a name="l00712"></a>00712 
<a name="l00713"></a>00713 exit:
<a name="l00714"></a>00714    <span class="keywordflow">if</span> (sorted)
<a name="l00715"></a>00715       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(sorted);
<a name="l00716"></a>00716 
<a name="l00717"></a>00717    <span class="keywordflow">while</span> ((item = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;alist, entry)))
<a name="l00718"></a>00718       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(item);
<a name="l00719"></a>00719 
<a name="l00720"></a>00720    <span class="keywordflow">return</span> res;
<a name="l00721"></a>00721 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4abe4549602d1caa18efe2b4ffc09e65"></a><!-- doxytag: member="app_directory.c::goto_exten" ref="a4abe4549602d1caa18efe2b4ffc09e65" args="(struct ast_channel *chan, const char *dialcontext, char *ext)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int goto_exten </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>dialcontext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>ext</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__directory_8c_source.html#l00633">633</a> of file <a class="el" href="app__directory_8c_source.html">app_directory.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l09570">ast_goto_if_exists()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, and <a class="el" href="channel_8h_source.html#l00505">ast_channel::macrocontext</a>.</p>

<p>Referenced by <a class="el" href="app__directory_8c_source.html#l00646">do_directory()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00634"></a>00634 {
<a name="l00635"></a>00635    <span class="keywordflow">if</span> (!<a class="code" href="pbx_8h.html#a8f7166f50cb9642179c9b321b8143f55">ast_goto_if_exists</a>(chan, <a class="code" href="app__voicemail_8c.html#a695d5aca89839d016497739454f9779a">dialcontext</a>, <a class="code" href="http_8c.html#af9b32121c4ad80b0887a3d73fd24de5f">ext</a>, 1) ||
<a name="l00636"></a>00636       (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(chan-&gt;<a class="code" href="structast__channel.html#a0a602b0f10ece2644f247c3f6ff841e0">macrocontext</a>) &amp;&amp;
<a name="l00637"></a>00637       !<a class="code" href="pbx_8h.html#a8f7166f50cb9642179c9b321b8143f55">ast_goto_if_exists</a>(chan, chan-&gt;<a class="code" href="structast__channel.html#a0a602b0f10ece2644f247c3f6ff841e0">macrocontext</a>, <a class="code" href="http_8c.html#af9b32121c4ad80b0887a3d73fd24de5f">ext</a>, 1))) {
<a name="l00638"></a>00638       <span class="keywordflow">return</span> 0;
<a name="l00639"></a>00639    } <span class="keywordflow">else</span> {
<a name="l00640"></a>00640       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Can&apos;t find extension &apos;%s&apos; in current context.  &quot;</span>
<a name="l00641"></a>00641          <span class="stringliteral">&quot;Not Exiting the Directory!\n&quot;</span>, <a class="code" href="http_8c.html#af9b32121c4ad80b0887a3d73fd24de5f">ext</a>);
<a name="l00642"></a>00642       <span class="keywordflow">return</span> -1;
<a name="l00643"></a>00643    }
<a name="l00644"></a>00644 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac3382bf6da54c56b37069bd76bbdf4f9"></a><!-- doxytag: member="app_directory.c::load_module" ref="ac3382bf6da54c56b37069bd76bbdf4f9" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int load_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__directory_8c_source.html#l00847">847</a> of file <a class="el" href="app__directory_8c_source.html">app_directory.c</a>.</p>

<p>References <a class="el" href="module_8h_source.html#l00406">ast_register_application_xml</a>, and <a class="el" href="app__directory_8c_source.html#l00723">directory_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00848"></a>00848 {
<a name="l00849"></a>00849    <span class="keywordflow">return</span> <a class="code" href="module_8h.html#afba4eb7a910b10969041ae4cd488729d" title="Register an application using XML documentation.">ast_register_application_xml</a>(<a class="code" href="app__adsiprog_8c.html#a9e5f57131367eff409b9e0bd7b31aa1a">app</a>, <a class="code" href="app__directory_8c.html#a95b7ecdd4594874d46eb128e420142d7">directory_exec</a>);
<a name="l00850"></a>00850 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9b7f6a60e87ca035b380bd836305b084"></a><!-- doxytag: member="app_directory.c::play_mailbox_owner" ref="a9b7f6a60e87ca035b380bd836305b084" args="(struct ast_channel *chan, const char *context, const char *ext, const char *name, struct ast_flags *flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int play_mailbox_owner </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>ext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__flags.html">ast_flags</a> *&nbsp;</td>
          <td class="paramname"> <em>flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__directory_8c_source.html#l00247">247</a> of file <a class="el" href="app__directory_8c_source.html">app_directory.c</a>.</p>

<p>References <a class="el" href="app_8c_source.html#l00291">ast_app_sayname()</a>, <a class="el" href="file_8h_source.html#l00047">AST_DIGIT_ANY</a>, <a class="el" href="channel_8c_source.html#l05839">ast_say_character_str()</a>, <a class="el" href="file_8c_source.html#l00122">ast_stopstream()</a>, <a class="el" href="file_8c_source.html#l01342">ast_stream_and_wait()</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="app__directory_8c_source.html#l00126">OPT_SAYEXTENSION</a>, and <a class="el" href="strings_8h_source.html#l00072">S_OR</a>.</p>

<p>Referenced by <a class="el" href="app__directory_8c_source.html#l00322">select_item_menu()</a>, and <a class="el" href="app__directory_8c_source.html#l00287">select_item_seq()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00249"></a>00249 {
<a name="l00250"></a>00250    <span class="keywordtype">int</span> res = 0;
<a name="l00251"></a>00251    <span class="keywordflow">if</span> ((res = <a class="code" href="app_8h.html#a3c444cef1f29205f033db05bfeee8298" title="Given a mailbox and context, play that mailbox owner&amp;#39;s name to the channel specified...">ast_app_sayname</a>(chan, <a class="code" href="http_8c.html#af9b32121c4ad80b0887a3d73fd24de5f">ext</a>, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>)) &gt;= 0) {
<a name="l00252"></a>00252       <a class="code" href="file_8h.html#a3092bf11d4bba66f646562759608b1bc" title="Stops a stream.">ast_stopstream</a>(chan);
<a name="l00253"></a>00253       <span class="comment">/* If Option &apos;e&apos; was specified, also read the extension number with the name */</span>
<a name="l00254"></a>00254       <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(flags, <a class="code" href="app__directory_8c.html#ab04a0655cd1e3bcac5e8f48c18df1a57a94223020f1266eb08abd4ec3f307b0a0">OPT_SAYEXTENSION</a>)) {
<a name="l00255"></a>00255          <a class="code" href="file_8h.html#a95b94a020720147325a486e210b36775" title="stream file until digit If the file name is non-empty, try to play it.">ast_stream_and_wait</a>(chan, <span class="stringliteral">&quot;vm-extension&quot;</span>, <a class="code" href="file_8h.html#afa92b0106fb7a918ea994c2867ac0a04">AST_DIGIT_ANY</a>);
<a name="l00256"></a>00256          res = <a class="code" href="say_8h.html#a5a2049959851520fd46c332fc127e9a5">ast_say_character_str</a>(chan, <a class="code" href="http_8c.html#af9b32121c4ad80b0887a3d73fd24de5f">ext</a>, <a class="code" href="file_8h.html#afa92b0106fb7a918ea994c2867ac0a04">AST_DIGIT_ANY</a>, chan-&gt;language);
<a name="l00257"></a>00257       }
<a name="l00258"></a>00258    } <span class="keywordflow">else</span> {
<a name="l00259"></a>00259       res = <a class="code" href="say_8h.html#a5a2049959851520fd46c332fc127e9a5">ast_say_character_str</a>(chan, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <a class="code" href="http_8c.html#af9b32121c4ad80b0887a3d73fd24de5f">ext</a>), <a class="code" href="file_8h.html#afa92b0106fb7a918ea994c2867ac0a04">AST_DIGIT_ANY</a>, chan-&gt;language);
<a name="l00260"></a>00260       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>) &amp;&amp; <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(flags, <a class="code" href="app__directory_8c.html#ab04a0655cd1e3bcac5e8f48c18df1a57a94223020f1266eb08abd4ec3f307b0a0">OPT_SAYEXTENSION</a>)) {
<a name="l00261"></a>00261          <a class="code" href="file_8h.html#a95b94a020720147325a486e210b36775" title="stream file until digit If the file name is non-empty, try to play it.">ast_stream_and_wait</a>(chan, <span class="stringliteral">&quot;vm-extension&quot;</span>, <a class="code" href="file_8h.html#afa92b0106fb7a918ea994c2867ac0a04">AST_DIGIT_ANY</a>);
<a name="l00262"></a>00262          res = <a class="code" href="say_8h.html#a5a2049959851520fd46c332fc127e9a5">ast_say_character_str</a>(chan, <a class="code" href="http_8c.html#af9b32121c4ad80b0887a3d73fd24de5f">ext</a>, <a class="code" href="file_8h.html#afa92b0106fb7a918ea994c2867ac0a04">AST_DIGIT_ANY</a>, chan-&gt;language);
<a name="l00263"></a>00263       }
<a name="l00264"></a>00264    }
<a name="l00265"></a>00265 
<a name="l00266"></a>00266    <span class="keywordflow">return</span> res;
<a name="l00267"></a>00267 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aae65c22521b984632f1a4be9bc5fa22f"></a><!-- doxytag: member="app_directory.c::realtime_directory" ref="aae65c22521b984632f1a4be9bc5fa22f" args="(char *context)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__config.html">ast_config</a>* realtime_directory </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>context</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__directory_8c_source.html#l00382">382</a> of file <a class="el" href="app__directory_8c_source.html">app_directory.c</a>.</p>

<p>References <a class="el" href="config_8c_source.html#l00522">ast_category_append()</a>, <a class="el" href="config_8c_source.html#l00613">ast_category_browse()</a>, <a class="el" href="config_8c_source.html#l00512">ast_category_get()</a>, <a class="el" href="config_8c_source.html#l00483">ast_category_new()</a>, <a class="el" href="config_8c_source.html#l00827">ast_config_destroy()</a>, <a class="el" href="config_8h_source.html#l00139">ast_config_load</a>, <a class="el" href="config_8c_source.html#l02198">ast_load_realtime_multientry()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="utils_8c_source.html#l01311">ast_true()</a>, <a class="el" href="config_8c_source.html#l00348">ast_variable_append()</a>, <a class="el" href="config_8c_source.html#l00223">ast_variable_new()</a>, <a class="el" href="config_8c_source.html#l00435">ast_variable_retrieve()</a>, <a class="el" href="config_8h_source.html#l00050">CONFIG_STATUS_FILEINVALID</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__mgcp_8c_source.html#l00185">mailbox</a>, <a class="el" href="strings_8h_source.html#l00072">S_OR</a>, <a class="el" href="compiler_8h_source.html#l00069">SENTINEL</a>, <a class="el" href="ast__expr2f_8c_source.html#l00613">var</a>, and <a class="el" href="app__directory_8c_source.html#l00122">VOICEMAIL_CONFIG</a>.</p>

<p>Referenced by <a class="el" href="app__directory_8c_source.html#l00723">directory_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00383"></a>00383 {
<a name="l00384"></a>00384    <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *cfg;
<a name="l00385"></a>00385    <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *rtdata;
<a name="l00386"></a>00386    <span class="keyword">struct </span><a class="code" href="structast__category.html">ast_category</a> *cat;
<a name="l00387"></a>00387    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>;
<a name="l00388"></a>00388    <span class="keywordtype">char</span> *<a class="code" href="chan__mgcp_8c.html#ac81f44f4f22dee90de5975cf8fa4641b">mailbox</a>;
<a name="l00389"></a>00389    <span class="keyword">const</span> <span class="keywordtype">char</span> *fullname;
<a name="l00390"></a>00390    <span class="keyword">const</span> <span class="keywordtype">char</span> *hidefromdir, *searchcontexts = NULL;
<a name="l00391"></a>00391    <span class="keywordtype">char</span> tmp[100];
<a name="l00392"></a>00392    <span class="keyword">struct </span><a class="code" href="structast__flags.html" title="Structure used to handle boolean flags.">ast_flags</a> <a class="code" href="app__rpt_8c.html#a1f57f20c1f46890828791a4827fe8752">config_flags</a> = { 0 };
<a name="l00393"></a>00393 
<a name="l00394"></a>00394    <span class="comment">/* Load flat file config. */</span>
<a name="l00395"></a>00395    cfg = <a class="code" href="config_8h.html#a0a07ddd6bbcf44485e01c14c96109482">ast_config_load</a>(<a class="code" href="app__directory_8c.html#a62e6fabd28e7d7a9941945c7fde3bda6">VOICEMAIL_CONFIG</a>, config_flags);
<a name="l00396"></a>00396 
<a name="l00397"></a>00397    <span class="keywordflow">if</span> (!cfg) {
<a name="l00398"></a>00398       <span class="comment">/* Loading config failed. */</span>
<a name="l00399"></a>00399       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Loading config failed.\n&quot;</span>);
<a name="l00400"></a>00400       <span class="keywordflow">return</span> NULL;
<a name="l00401"></a>00401    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cfg == <a class="code" href="config_8h.html#a8d1a63cdf2c7aff22a77b6e75d93b377">CONFIG_STATUS_FILEINVALID</a>) {
<a name="l00402"></a>00402       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Config file %s is in an invalid format.  Aborting.\n&quot;</span>, <a class="code" href="app__directory_8c.html#a62e6fabd28e7d7a9941945c7fde3bda6">VOICEMAIL_CONFIG</a>);
<a name="l00403"></a>00403       <span class="keywordflow">return</span> NULL;
<a name="l00404"></a>00404    }
<a name="l00405"></a>00405 
<a name="l00406"></a>00406    <span class="comment">/* Get realtime entries, categorized by their mailbox number</span>
<a name="l00407"></a>00407 <span class="comment">      and present in the requested context */</span>
<a name="l00408"></a>00408    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>) &amp;&amp; (searchcontexts = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;searchcontexts&quot;</span>))) {
<a name="l00409"></a>00409       <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(searchcontexts)) {
<a name="l00410"></a>00410          rtdata = <a class="code" href="config_8h.html#a29ff8cd717c0c0bac60abbd827fec409" title="Retrieve realtime configuration.">ast_load_realtime_multientry</a>(<span class="stringliteral">&quot;voicemail&quot;</span>, <span class="stringliteral">&quot;mailbox LIKE&quot;</span>, <span class="stringliteral">&quot;%&quot;</span>, <a class="code" href="compiler_8h.html#af2af475b85aef66019c417d8ded1c435">SENTINEL</a>);
<a name="l00411"></a>00411          <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a> = NULL;
<a name="l00412"></a>00412       } <span class="keywordflow">else</span> {
<a name="l00413"></a>00413          rtdata = <a class="code" href="config_8h.html#a29ff8cd717c0c0bac60abbd827fec409" title="Retrieve realtime configuration.">ast_load_realtime_multientry</a>(<span class="stringliteral">&quot;voicemail&quot;</span>, <span class="stringliteral">&quot;mailbox LIKE&quot;</span>, <span class="stringliteral">&quot;%&quot;</span>, <span class="stringliteral">&quot;context&quot;</span>, <span class="stringliteral">&quot;default&quot;</span>, <a class="code" href="compiler_8h.html#af2af475b85aef66019c417d8ded1c435">SENTINEL</a>);
<a name="l00414"></a>00414          <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a> = <span class="stringliteral">&quot;default&quot;</span>;
<a name="l00415"></a>00415       }
<a name="l00416"></a>00416    } <span class="keywordflow">else</span> {
<a name="l00417"></a>00417       rtdata = <a class="code" href="config_8h.html#a29ff8cd717c0c0bac60abbd827fec409" title="Retrieve realtime configuration.">ast_load_realtime_multientry</a>(<span class="stringliteral">&quot;voicemail&quot;</span>, <span class="stringliteral">&quot;mailbox LIKE&quot;</span>, <span class="stringliteral">&quot;%&quot;</span>, <span class="stringliteral">&quot;context&quot;</span>, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <a class="code" href="compiler_8h.html#af2af475b85aef66019c417d8ded1c435">SENTINEL</a>);
<a name="l00418"></a>00418    }
<a name="l00419"></a>00419 
<a name="l00420"></a>00420    <span class="comment">/* if there are no results, just return the entries from the config file */</span>
<a name="l00421"></a>00421    <span class="keywordflow">if</span> (!rtdata) {
<a name="l00422"></a>00422       <span class="keywordflow">return</span> cfg;
<a name="l00423"></a>00423    }
<a name="l00424"></a>00424 
<a name="l00425"></a>00425    mailbox = NULL;
<a name="l00426"></a>00426    <span class="keywordflow">while</span> ( (mailbox = <a class="code" href="config_8h.html#a611776300f941a63266cb220ac62b4db" title="Goes through categories.">ast_category_browse</a>(rtdata, mailbox)) ) {
<a name="l00427"></a>00427       <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a> = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(rtdata, mailbox, <span class="stringliteral">&quot;context&quot;</span>);
<a name="l00428"></a>00428 
<a name="l00429"></a>00429       fullname = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(rtdata, mailbox, <span class="stringliteral">&quot;fullname&quot;</span>);
<a name="l00430"></a>00430       <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>((hidefromdir = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(rtdata, mailbox, <span class="stringliteral">&quot;hidefromdir&quot;</span>)))) {
<a name="l00431"></a>00431          <span class="comment">/* Skip hidden */</span>
<a name="l00432"></a>00432          <span class="keywordflow">continue</span>;
<a name="l00433"></a>00433       }
<a name="l00434"></a>00434       snprintf(tmp, <span class="keyword">sizeof</span>(tmp), <span class="stringliteral">&quot;no-password,%s&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(fullname, <span class="stringliteral">&quot;&quot;</span>));
<a name="l00435"></a>00435 
<a name="l00436"></a>00436       <span class="comment">/* Does the context exist within the config file? If not, make one */</span>
<a name="l00437"></a>00437       <span class="keywordflow">if</span> (!(cat = <a class="code" href="config_8h.html#a0c2db6370e5051f282b2926f5893b2ea" title="Retrieve a category if it exists.">ast_category_get</a>(cfg, context))) {
<a name="l00438"></a>00438          <span class="keywordflow">if</span> (!(cat = <a class="code" href="config_8h.html#affebac76d69639677b677037d9871e29" title="Create a category structure.">ast_category_new</a>(context, <span class="stringliteral">&quot;&quot;</span>, 99999))) {
<a name="l00439"></a>00439             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Out of memory\n&quot;</span>);
<a name="l00440"></a>00440             <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(cfg);
<a name="l00441"></a>00441             <span class="keywordflow">if</span> (rtdata) {
<a name="l00442"></a>00442                <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(rtdata);
<a name="l00443"></a>00443             }
<a name="l00444"></a>00444             <span class="keywordflow">return</span> NULL;
<a name="l00445"></a>00445          }
<a name="l00446"></a>00446          <a class="code" href="config_8h.html#ab7b56ec66b058952423f313752c734e7">ast_category_append</a>(cfg, cat);
<a name="l00447"></a>00447       }
<a name="l00448"></a>00448 
<a name="l00449"></a>00449       <span class="keywordflow">if</span> ((var = <a class="code" href="config_8h.html#a08e94d96f459e7301a74daf32035423b">ast_variable_new</a>(mailbox, tmp, <span class="stringliteral">&quot;&quot;</span>))) {
<a name="l00450"></a>00450          <a class="code" href="config_8h.html#a132ddbd39dd9d26395c410f7647f76db">ast_variable_append</a>(cat, var);
<a name="l00451"></a>00451       } <span class="keywordflow">else</span> {
<a name="l00452"></a>00452          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Out of memory adding mailbox &apos;%s&apos;\n&quot;</span>, mailbox);
<a name="l00453"></a>00453       }
<a name="l00454"></a>00454    }
<a name="l00455"></a>00455    <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(rtdata);
<a name="l00456"></a>00456 
<a name="l00457"></a>00457    <span class="keywordflow">return</span> cfg;
<a name="l00458"></a>00458 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="acfa24d65aa83a292e4d4f9faaf3227c0"></a><!-- doxytag: member="app_directory.c::search_directory" ref="acfa24d65aa83a292e4d4f9faaf3227c0" args="(const char *context, struct ast_config *vmcfg, struct ast_config *ucfg, const char *ext, struct ast_flags flags, itemlist *alist)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int search_directory </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__config.html">ast_config</a> *&nbsp;</td>
          <td class="paramname"> <em>vmcfg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__config.html">ast_config</a> *&nbsp;</td>
          <td class="paramname"> <em>ucfg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>ext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__flags.html">ast_flags</a>&nbsp;</td>
          <td class="paramname"> <em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">itemlist *&nbsp;</td>
          <td class="paramname"> <em>alist</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__directory_8c_source.html#l00582">582</a> of file <a class="el" href="app__directory_8c_source.html">app_directory.c</a>.</p>

<p>References <a class="el" href="config_8c_source.html#l00613">ast_category_browse()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="utils_8c_source.html#l01311">ast_true()</a>, and <a class="el" href="config_8c_source.html#l00435">ast_variable_retrieve()</a>.</p>

<p>Referenced by <a class="el" href="app__directory_8c_source.html#l00646">do_directory()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00583"></a>00583 {
<a name="l00584"></a>00584    <span class="keyword">const</span> <span class="keywordtype">char</span> *searchcontexts = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(vmcfg, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;searchcontexts&quot;</span>);
<a name="l00585"></a>00585    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>)) {
<a name="l00586"></a>00586       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(searchcontexts) &amp;&amp; <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(searchcontexts)) {
<a name="l00587"></a>00587          <span class="comment">/* Browse each context for a match */</span>
<a name="l00588"></a>00588          <span class="keywordtype">int</span> res;
<a name="l00589"></a>00589          <span class="keyword">const</span> <span class="keywordtype">char</span> *catg;
<a name="l00590"></a>00590          <span class="keywordflow">for</span> (catg = <a class="code" href="config_8h.html#a611776300f941a63266cb220ac62b4db" title="Goes through categories.">ast_category_browse</a>(vmcfg, NULL); catg; catg = <a class="code" href="config_8h.html#a611776300f941a63266cb220ac62b4db" title="Goes through categories.">ast_category_browse</a>(vmcfg, catg)) {
<a name="l00591"></a>00591             <span class="keywordflow">if</span> (!strcmp(catg, <span class="stringliteral">&quot;general&quot;</span>) || !strcmp(catg, <span class="stringliteral">&quot;zonemessages&quot;</span>)) {
<a name="l00592"></a>00592                <span class="keywordflow">continue</span>;
<a name="l00593"></a>00593             }
<a name="l00594"></a>00594 
<a name="l00595"></a>00595             <span class="keywordflow">if</span> ((res = search_directory_sub(catg, vmcfg, ucfg, <a class="code" href="http_8c.html#af9b32121c4ad80b0887a3d73fd24de5f">ext</a>, flags, alist))) {
<a name="l00596"></a>00596                <span class="keywordflow">return</span> res;
<a name="l00597"></a>00597             }
<a name="l00598"></a>00598          }
<a name="l00599"></a>00599          <span class="keywordflow">return</span> 0;
<a name="l00600"></a>00600       } <span class="keywordflow">else</span> {
<a name="l00601"></a>00601          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Searching by category default\n&quot;</span>);
<a name="l00602"></a>00602          <span class="keywordflow">return</span> search_directory_sub(<span class="stringliteral">&quot;default&quot;</span>, vmcfg, ucfg, <a class="code" href="http_8c.html#af9b32121c4ad80b0887a3d73fd24de5f">ext</a>, flags, alist);
<a name="l00603"></a>00603       }
<a name="l00604"></a>00604    } <span class="keywordflow">else</span> {
<a name="l00605"></a>00605       <span class="comment">/* Browse only the listed context for a match */</span>
<a name="l00606"></a>00606       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Searching by category %s\n&quot;</span>, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>);
<a name="l00607"></a>00607       <span class="keywordflow">return</span> search_directory_sub(<a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, vmcfg, ucfg, <a class="code" href="http_8c.html#af9b32121c4ad80b0887a3d73fd24de5f">ext</a>, flags, alist);
<a name="l00608"></a>00608    }
<a name="l00609"></a>00609 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8c03b4df5b417fa42d5e7ce7db696319"></a><!-- doxytag: member="app_directory.c::select_entry" ref="a8c03b4df5b417fa42d5e7ce7db696319" args="(struct ast_channel *chan, const char *dialcontext, const struct directory_item *item, struct ast_flags *flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int select_entry </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>dialcontext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structdirectory__item.html">directory_item</a> *&nbsp;</td>
          <td class="paramname"> <em>item</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__flags.html">ast_flags</a> *&nbsp;</td>
          <td class="paramname"> <em>flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__directory_8c_source.html#l00269">269</a> of file <a class="el" href="app__directory_8c_source.html">app_directory.c</a>.</p>

<p>References <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="pbx_8c_source.html#l09570">ast_goto_if_exists()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="app__directory_8c_source.html#l00146">directory_item::context</a>, <a class="el" href="channel_8h_source.html#l00504">ast_channel::exten</a>, <a class="el" href="app__directory_8c_source.html#l00144">directory_item::exten</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="app__directory_8c_source.html#l00145">directory_item::name</a>, <a class="el" href="app__directory_8c_source.html#l00127">OPT_FROMVOICEMAIL</a>, and <a class="el" href="strings_8h_source.html#l00072">S_OR</a>.</p>

<p>Referenced by <a class="el" href="app__directory_8c_source.html#l00322">select_item_menu()</a>, and <a class="el" href="app__directory_8c_source.html#l00287">select_item_seq()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00270"></a>00270 {
<a name="l00271"></a>00271    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Selecting &apos;%s&apos; - %s@%s\n&quot;</span>, item-&gt;<a class="code" href="structdirectory__item.html#a1c46613278470da923cf68a39bf947f4">name</a>, item-&gt;<a class="code" href="structdirectory__item.html#aa8ad22aa2eb725296bb02c8985001d6c">exten</a>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(<a class="code" href="app__voicemail_8c.html#a695d5aca89839d016497739454f9779a">dialcontext</a>, item-&gt;<a class="code" href="structdirectory__item.html#a25965a26a05a3325299c4b693960a4e0">context</a>));
<a name="l00272"></a>00272 
<a name="l00273"></a>00273    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(flags, <a class="code" href="app__directory_8c.html#ab04a0655cd1e3bcac5e8f48c18df1a57aeb8bbdb286b4e727f61048703d57a686">OPT_FROMVOICEMAIL</a>)) {
<a name="l00274"></a>00274       <span class="comment">/* We still want to set the exten though */</span>
<a name="l00275"></a>00275       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(chan-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>, item-&gt;<a class="code" href="structdirectory__item.html#aa8ad22aa2eb725296bb02c8985001d6c">exten</a>, <span class="keyword">sizeof</span>(chan-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>));
<a name="l00276"></a>00276    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="pbx_8h.html#a8f7166f50cb9642179c9b321b8143f55">ast_goto_if_exists</a>(chan, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(<a class="code" href="app__voicemail_8c.html#a695d5aca89839d016497739454f9779a">dialcontext</a>, item-&gt;<a class="code" href="structdirectory__item.html#a25965a26a05a3325299c4b693960a4e0">context</a>), item-&gt;<a class="code" href="structdirectory__item.html#aa8ad22aa2eb725296bb02c8985001d6c">exten</a>, 1)) {
<a name="l00277"></a>00277       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,
<a name="l00278"></a>00278          <span class="stringliteral">&quot;Can&apos;t find extension &apos;%s&apos; in context &apos;%s&apos;.  &quot;</span>
<a name="l00279"></a>00279          <span class="stringliteral">&quot;Did you pass the wrong context to Directory?\n&quot;</span>,
<a name="l00280"></a>00280          item-&gt;<a class="code" href="structdirectory__item.html#aa8ad22aa2eb725296bb02c8985001d6c">exten</a>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(<a class="code" href="app__voicemail_8c.html#a695d5aca89839d016497739454f9779a">dialcontext</a>, item-&gt;<a class="code" href="structdirectory__item.html#a25965a26a05a3325299c4b693960a4e0">context</a>));
<a name="l00281"></a>00281       <span class="keywordflow">return</span> -1;
<a name="l00282"></a>00282    }
<a name="l00283"></a>00283 
<a name="l00284"></a>00284    <span class="keywordflow">return</span> 0;
<a name="l00285"></a>00285 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a912f19830f78d23995311923108a2f37"></a><!-- doxytag: member="app_directory.c::select_item_menu" ref="a912f19830f78d23995311923108a2f37" args="(struct ast_channel *chan, struct directory_item **items, int count, const char *dialcontext, struct ast_flags *flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int select_item_menu </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdirectory__item.html">directory_item</a> **&nbsp;</td>
          <td class="paramname"> <em>items</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>count</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>dialcontext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__flags.html">ast_flags</a> *&nbsp;</td>
          <td class="paramname"> <em>flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__directory_8c_source.html#l00322">322</a> of file <a class="el" href="app__directory_8c_source.html">app_directory.c</a>.</p>

<p>References <a class="el" href="file_8h_source.html#l00047">AST_DIGIT_ANY</a>, <a class="el" href="file_8c_source.html#l00943">ast_streamfile()</a>, <a class="el" href="channel_8c_source.html#l02400">ast_waitfordigit()</a>, <a class="el" href="file_8c_source.html#l01315">ast_waitstream()</a>, <a class="el" href="adsistub_8c_source.html#l00059">buf</a>, <a class="el" href="app__directory_8c_source.html#l00146">directory_item::context</a>, <a class="el" href="app__directory_8c_source.html#l00144">directory_item::exten</a>, <a class="el" href="app__directory_8c_source.html#l00145">directory_item::name</a>, <a class="el" href="app__directory_8c_source.html#l00247">play_mailbox_owner()</a>, and <a class="el" href="app__directory_8c_source.html#l00269">select_entry()</a>.</p>

<p>Referenced by <a class="el" href="app__directory_8c_source.html#l00646">do_directory()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00323"></a>00323 {
<a name="l00324"></a>00324    <span class="keyword">struct </span><a class="code" href="structdirectory__item.html">directory_item</a> **block, *item;
<a name="l00325"></a>00325    <span class="keywordtype">int</span> i, limit, res = 0;
<a name="l00326"></a>00326    <span class="keywordtype">char</span> <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[9];
<a name="l00327"></a>00327 
<a name="l00328"></a>00328    <span class="keywordflow">for</span> (block = items; count; block += limit, count -= limit) {
<a name="l00329"></a>00329       limit = count;
<a name="l00330"></a>00330       <span class="keywordflow">if</span> (limit &gt; 8)
<a name="l00331"></a>00331          limit = 8;
<a name="l00332"></a>00332 
<a name="l00333"></a>00333       <span class="keywordflow">for</span> (i = 0; i &lt; limit &amp;&amp; !res; i++) {
<a name="l00334"></a>00334          item = block[i];
<a name="l00335"></a>00335 
<a name="l00336"></a>00336          snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;digits/%d&quot;</span>, i + 1);
<a name="l00337"></a>00337          <span class="comment">/* Press &lt;num&gt; for &lt;name&gt;, [ extension &lt;ext&gt; ] */</span>
<a name="l00338"></a>00338          res = <a class="code" href="file_8h.html#a67c7e271b4ca70aca6d48fd48d121857" title="Streams a file.">ast_streamfile</a>(chan, <span class="stringliteral">&quot;dir-multi1&quot;</span>, chan-&gt;language);
<a name="l00339"></a>00339          <span class="keywordflow">if</span> (!res)
<a name="l00340"></a>00340             res = <a class="code" href="file_8h.html#affc21cb57c6bf72a2cb7ec8a379b2137" title="Waits for a stream to stop or digit to be pressed.">ast_waitstream</a>(chan, <a class="code" href="file_8h.html#afa92b0106fb7a918ea994c2867ac0a04">AST_DIGIT_ANY</a>);
<a name="l00341"></a>00341          <span class="keywordflow">if</span> (!res)
<a name="l00342"></a>00342             res = <a class="code" href="file_8h.html#a67c7e271b4ca70aca6d48fd48d121857" title="Streams a file.">ast_streamfile</a>(chan, buf, chan-&gt;language);
<a name="l00343"></a>00343          <span class="keywordflow">if</span> (!res)
<a name="l00344"></a>00344             res = <a class="code" href="file_8h.html#affc21cb57c6bf72a2cb7ec8a379b2137" title="Waits for a stream to stop or digit to be pressed.">ast_waitstream</a>(chan, <a class="code" href="file_8h.html#afa92b0106fb7a918ea994c2867ac0a04">AST_DIGIT_ANY</a>);
<a name="l00345"></a>00345          <span class="keywordflow">if</span> (!res)
<a name="l00346"></a>00346             res = <a class="code" href="file_8h.html#a67c7e271b4ca70aca6d48fd48d121857" title="Streams a file.">ast_streamfile</a>(chan, <span class="stringliteral">&quot;dir-multi2&quot;</span>, chan-&gt;language);
<a name="l00347"></a>00347          <span class="keywordflow">if</span> (!res)
<a name="l00348"></a>00348             res = <a class="code" href="file_8h.html#affc21cb57c6bf72a2cb7ec8a379b2137" title="Waits for a stream to stop or digit to be pressed.">ast_waitstream</a>(chan, <a class="code" href="file_8h.html#afa92b0106fb7a918ea994c2867ac0a04">AST_DIGIT_ANY</a>);
<a name="l00349"></a>00349          <span class="keywordflow">if</span> (!res)
<a name="l00350"></a>00350             res = <a class="code" href="app__directory_8c.html#a9b7f6a60e87ca035b380bd836305b084">play_mailbox_owner</a>(chan, item-&gt;<a class="code" href="structdirectory__item.html#a25965a26a05a3325299c4b693960a4e0">context</a>, item-&gt;<a class="code" href="structdirectory__item.html#aa8ad22aa2eb725296bb02c8985001d6c">exten</a>, item-&gt;<a class="code" href="structdirectory__item.html#a1c46613278470da923cf68a39bf947f4">name</a>, flags);
<a name="l00351"></a>00351          <span class="keywordflow">if</span> (!res)
<a name="l00352"></a>00352             res = <a class="code" href="file_8h.html#affc21cb57c6bf72a2cb7ec8a379b2137" title="Waits for a stream to stop or digit to be pressed.">ast_waitstream</a>(chan, <a class="code" href="file_8h.html#afa92b0106fb7a918ea994c2867ac0a04">AST_DIGIT_ANY</a>);
<a name="l00353"></a>00353          <span class="keywordflow">if</span> (!res)
<a name="l00354"></a>00354             res = <a class="code" href="channel_8h.html#a050bec9a4abc1a599b6573a6091b080c" title="Waits for a digit.">ast_waitfordigit</a>(chan, 800);
<a name="l00355"></a>00355       }
<a name="l00356"></a>00356 
<a name="l00357"></a>00357       <span class="comment">/* Press &quot;9&quot; for more names. */</span>
<a name="l00358"></a>00358       <span class="keywordflow">if</span> (!res &amp;&amp; count &gt; limit) {
<a name="l00359"></a>00359          res = <a class="code" href="file_8h.html#a67c7e271b4ca70aca6d48fd48d121857" title="Streams a file.">ast_streamfile</a>(chan, <span class="stringliteral">&quot;dir-multi9&quot;</span>, chan-&gt;language);
<a name="l00360"></a>00360          <span class="keywordflow">if</span> (!res)
<a name="l00361"></a>00361             res = <a class="code" href="file_8h.html#affc21cb57c6bf72a2cb7ec8a379b2137" title="Waits for a stream to stop or digit to be pressed.">ast_waitstream</a>(chan, <a class="code" href="file_8h.html#afa92b0106fb7a918ea994c2867ac0a04">AST_DIGIT_ANY</a>);
<a name="l00362"></a>00362       }
<a name="l00363"></a>00363 
<a name="l00364"></a>00364       <span class="keywordflow">if</span> (!res) {
<a name="l00365"></a>00365          res = <a class="code" href="channel_8h.html#a050bec9a4abc1a599b6573a6091b080c" title="Waits for a digit.">ast_waitfordigit</a>(chan, 3000);
<a name="l00366"></a>00366       }
<a name="l00367"></a>00367 
<a name="l00368"></a>00368       <span class="keywordflow">if</span> (res &amp;&amp; res &gt; <span class="charliteral">&apos;0&apos;</span> &amp;&amp; res &lt; <span class="charliteral">&apos;1&apos;</span> + limit) {
<a name="l00369"></a>00369          <span class="keywordflow">return</span> <a class="code" href="app__directory_8c.html#a8c03b4df5b417fa42d5e7ce7db696319">select_entry</a>(chan, <a class="code" href="app__voicemail_8c.html#a695d5aca89839d016497739454f9779a">dialcontext</a>, block[res - <span class="charliteral">&apos;1&apos;</span>], flags) ? -1 : 1;
<a name="l00370"></a>00370       }
<a name="l00371"></a>00371 
<a name="l00372"></a>00372       <span class="keywordflow">if</span> (res &lt; 0)
<a name="l00373"></a>00373          <span class="keywordflow">return</span> -1;
<a name="l00374"></a>00374 
<a name="l00375"></a>00375       res = 0;
<a name="l00376"></a>00376    }
<a name="l00377"></a>00377 
<a name="l00378"></a>00378    <span class="comment">/* Nothing was selected */</span>
<a name="l00379"></a>00379    <span class="keywordflow">return</span> 0;
<a name="l00380"></a>00380 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab7dd75de6e3856c3091c3724c2deb504"></a><!-- doxytag: member="app_directory.c::select_item_seq" ref="ab7dd75de6e3856c3091c3724c2deb504" args="(struct ast_channel *chan, struct directory_item **items, int count, const char *dialcontext, struct ast_flags *flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int select_item_seq </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structdirectory__item.html">directory_item</a> **&nbsp;</td>
          <td class="paramname"> <em>items</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>count</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>dialcontext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__flags.html">ast_flags</a> *&nbsp;</td>
          <td class="paramname"> <em>flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__directory_8c_source.html#l00287">287</a> of file <a class="el" href="app__directory_8c_source.html">app_directory.c</a>.</p>

<p>References <a class="el" href="file_8h_source.html#l00047">AST_DIGIT_ANY</a>, <a class="el" href="file_8c_source.html#l00122">ast_stopstream()</a>, <a class="el" href="file_8c_source.html#l01342">ast_stream_and_wait()</a>, <a class="el" href="channel_8c_source.html#l02400">ast_waitfordigit()</a>, <a class="el" href="app__directory_8c_source.html#l00146">directory_item::context</a>, <a class="el" href="app__directory_8c_source.html#l00144">directory_item::exten</a>, <a class="el" href="app__directory_8c_source.html#l00145">directory_item::name</a>, <a class="el" href="app__directory_8c_source.html#l00247">play_mailbox_owner()</a>, and <a class="el" href="app__directory_8c_source.html#l00269">select_entry()</a>.</p>

<p>Referenced by <a class="el" href="app__directory_8c_source.html#l00646">do_directory()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00288"></a>00288 {
<a name="l00289"></a>00289    <span class="keyword">struct </span><a class="code" href="structdirectory__item.html">directory_item</a> *item, **ptr;
<a name="l00290"></a>00290    <span class="keywordtype">int</span> i, res, loop;
<a name="l00291"></a>00291 
<a name="l00292"></a>00292    <span class="keywordflow">for</span> (ptr = items, i = 0; i &lt; count; i++, ptr++) {
<a name="l00293"></a>00293       item = *ptr;
<a name="l00294"></a>00294 
<a name="l00295"></a>00295       <span class="keywordflow">for</span> (loop = 3 ; loop &gt; 0; loop--) {
<a name="l00296"></a>00296          res = <a class="code" href="app__directory_8c.html#a9b7f6a60e87ca035b380bd836305b084">play_mailbox_owner</a>(chan, item-&gt;<a class="code" href="structdirectory__item.html#a25965a26a05a3325299c4b693960a4e0">context</a>, item-&gt;<a class="code" href="structdirectory__item.html#aa8ad22aa2eb725296bb02c8985001d6c">exten</a>, item-&gt;<a class="code" href="structdirectory__item.html#a1c46613278470da923cf68a39bf947f4">name</a>, flags);
<a name="l00297"></a>00297 
<a name="l00298"></a>00298          <span class="keywordflow">if</span> (!res)
<a name="l00299"></a>00299             res = <a class="code" href="file_8h.html#a95b94a020720147325a486e210b36775" title="stream file until digit If the file name is non-empty, try to play it.">ast_stream_and_wait</a>(chan, <span class="stringliteral">&quot;dir-instr&quot;</span>, <a class="code" href="file_8h.html#afa92b0106fb7a918ea994c2867ac0a04">AST_DIGIT_ANY</a>);
<a name="l00300"></a>00300          <span class="keywordflow">if</span> (!res)
<a name="l00301"></a>00301             res = <a class="code" href="channel_8h.html#a050bec9a4abc1a599b6573a6091b080c" title="Waits for a digit.">ast_waitfordigit</a>(chan, 3000);
<a name="l00302"></a>00302          <a class="code" href="file_8h.html#a3092bf11d4bba66f646562759608b1bc" title="Stops a stream.">ast_stopstream</a>(chan);
<a name="l00303"></a>00303    
<a name="l00304"></a>00304          <span class="keywordflow">if</span> (res == <span class="charliteral">&apos;1&apos;</span>) { <span class="comment">/* Name selected */</span>
<a name="l00305"></a>00305             <span class="keywordflow">return</span> <a class="code" href="app__directory_8c.html#a8c03b4df5b417fa42d5e7ce7db696319">select_entry</a>(chan, <a class="code" href="app__voicemail_8c.html#a695d5aca89839d016497739454f9779a">dialcontext</a>, item, flags) ? -1 : 1;
<a name="l00306"></a>00306          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res == <span class="charliteral">&apos;*&apos;</span>) {
<a name="l00307"></a>00307             <span class="comment">/* Skip to next match in list */</span>
<a name="l00308"></a>00308             <span class="keywordflow">break</span>;
<a name="l00309"></a>00309          }
<a name="l00310"></a>00310 
<a name="l00311"></a>00311          <span class="keywordflow">if</span> (res &lt; 0)
<a name="l00312"></a>00312             <span class="keywordflow">return</span> -1;
<a name="l00313"></a>00313 
<a name="l00314"></a>00314          res = 0;
<a name="l00315"></a>00315       }
<a name="l00316"></a>00316    }
<a name="l00317"></a>00317 
<a name="l00318"></a>00318    <span class="comment">/* Nothing was selected */</span>
<a name="l00319"></a>00319    <span class="keywordflow">return</span> 0;
<a name="l00320"></a>00320 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6c0f63ace71012f347e4e34f45dfcea1"></a><!-- doxytag: member="app_directory.c::sort_items" ref="a6c0f63ace71012f347e4e34f45dfcea1" args="(struct directory_item **sorted, int count)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void sort_items </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdirectory__item.html">directory_item</a> **&nbsp;</td>
          <td class="paramname"> <em>sorted</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>count</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__directory_8c_source.html#l00611">611</a> of file <a class="el" href="app__directory_8c_source.html">app_directory.c</a>.</p>

<p>References <a class="el" href="app__directory_8c_source.html#l00147">directory_item::key</a>.</p>

<p>Referenced by <a class="el" href="app__directory_8c_source.html#l00646">do_directory()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00612"></a>00612 {
<a name="l00613"></a>00613    <span class="keywordtype">int</span> reordered, i;
<a name="l00614"></a>00614    <span class="keyword">struct </span><a class="code" href="structdirectory__item.html">directory_item</a> **ptr, *tmp;
<a name="l00615"></a>00615 
<a name="l00616"></a>00616    <span class="keywordflow">if</span> (count &lt; 2)
<a name="l00617"></a>00617       <span class="keywordflow">return</span>;
<a name="l00618"></a>00618 
<a name="l00619"></a>00619    <span class="comment">/* Bubble-sort items by the key */</span>
<a name="l00620"></a>00620    <span class="keywordflow">do</span> {
<a name="l00621"></a>00621       reordered = 0;
<a name="l00622"></a>00622       <span class="keywordflow">for</span> (ptr = sorted, i = 0; i &lt; count - 1; i++, ptr++) {
<a name="l00623"></a>00623          <span class="keywordflow">if</span> (strcasecmp(ptr[0]-&gt;<a class="code" href="structdirectory__item.html#a0d2242a26ccc2fe03904d009ae23de4d">key</a>, ptr[1]-&gt;<a class="code" href="structdirectory__item.html#a0d2242a26ccc2fe03904d009ae23de4d">key</a>) &gt; 0) {
<a name="l00624"></a>00624             tmp = ptr[0];
<a name="l00625"></a>00625             ptr[0] = ptr[1];
<a name="l00626"></a>00626             ptr[1] = tmp;
<a name="l00627"></a>00627             reordered++;
<a name="l00628"></a>00628          }
<a name="l00629"></a>00629       }
<a name="l00630"></a>00630    } <span class="keywordflow">while</span> (reordered);
<a name="l00631"></a>00631 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad09fa931f468002152a3cc2d5ce25eae"></a><!-- doxytag: member="app_directory.c::unload_module" ref="ad09fa931f468002152a3cc2d5ce25eae" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int unload_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__directory_8c_source.html#l00840">840</a> of file <a class="el" href="app__directory_8c_source.html">app_directory.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l06403">ast_unregister_application()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00841"></a>00841 {
<a name="l00842"></a>00842    <span class="keywordtype">int</span> res;
<a name="l00843"></a>00843    res = <a class="code" href="module_8h.html#ad2ca15621101154f29748cf1dac3c3cf" title="Unregister an application.">ast_unregister_application</a>(<a class="code" href="app__adsiprog_8c.html#a9e5f57131367eff409b9e0bd7b31aa1a">app</a>);
<a name="l00844"></a>00844    <span class="keywordflow">return</span> res;
<a name="l00845"></a>00845 }
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a9e5f57131367eff409b9e0bd7b31aa1a"></a><!-- doxytag: member="app_directory.c::app" ref="a9e5f57131367eff409b9e0bd7b31aa1a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* <a class="el" href="res__agi_8c.html#a9e5f57131367eff409b9e0bd7b31aa1a">app</a> = &quot;Directory&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__directory_8c_source.html#l00117">117</a> of file <a class="el" href="app__directory_8c_source.html">app_directory.c</a>.</p>

</div>
</div>
<a class="anchor" id="afabdb6af0ceca9bea92229e123d8de02"></a><!-- doxytag: member="app_directory.c::directory_option_flags" ref="afabdb6af0ceca9bea92229e123d8de02" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum { ... }   <a class="el" href="app__directory_8c.html#afabdb6af0ceca9bea92229e123d8de02">directory_option_flags</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:18:55 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
