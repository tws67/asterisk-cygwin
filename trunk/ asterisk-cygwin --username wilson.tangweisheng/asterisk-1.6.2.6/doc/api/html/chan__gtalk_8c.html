<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:19:56 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_0ca6ff3bf6b340411b2c6edd15b1a34d.html">channels</a>
  </div>
</div>
<div class="contents">
<h1>chan_gtalk.c File Reference</h1>
<p>Gtalk Channel Driver, until google/libjingle works with <a class="el" href="structjingle.html">jingle</a> spec.  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="asterisk_8h_source.html">asterisk.h</a>&quot;</code><br/>
<code>#include &lt;sys/socket.h&gt;</code><br/>
<code>#include &lt;fcntl.h&gt;</code><br/>
<code>#include &lt;netdb.h&gt;</code><br/>
<code>#include &lt;netinet/in.h&gt;</code><br/>
<code>#include &lt;arpa/inet.h&gt;</code><br/>
<code>#include &lt;sys/signal.h&gt;</code><br/>
<code>#include &lt;iksemel.h&gt;</code><br/>
<code>#include &lt;pthread.h&gt;</code><br/>
<code>#include &lt;ctype.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="lock_8h_source.html">asterisk/lock.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="channel_8h_source.html">asterisk/channel.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="config_8h_source.html">asterisk/config.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="module_8h_source.html">asterisk/module.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="pbx_8h_source.html">asterisk/pbx.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="sched_8h_source.html">asterisk/sched.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="io_8h_source.html">asterisk/io.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="rtp_8h_source.html">asterisk/rtp.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="acl_8h_source.html">asterisk/acl.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="callerid_8h_source.html">asterisk/callerid.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="file_8h_source.html">asterisk/file.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="cli_8h_source.html">asterisk/cli.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="app_8h_source.html">asterisk/app.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="musiconhold_8h_source.html">asterisk/musiconhold.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="manager_8h_source.html">asterisk/manager.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="stringfields_8h_source.html">asterisk/stringfields.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="utils_8h_source.html">asterisk/utils.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="causes_8h_source.html">asterisk/causes.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="astobj_8h_source.html">asterisk/astobj.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="abstract__jb_8h_source.html">asterisk/abstract_jb.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="jabber_8h_source.html">asterisk/jabber.h</a>&quot;</code><br/>

<p><a href="chan__gtalk_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structgtalk.html">gtalk</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structgtalk__candidate.html">gtalk_candidate</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structgtalk__container.html">gtalk_container</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structgtalk__pvt.html">gtalk_pvt</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#ac8dc47e3b39c930caed4bfd05b4ba805">FORMAT</a>&nbsp;&nbsp;&nbsp;&quot;%-30.30s  %-30.30s  %-15.15s  %-5.5s %-5.5s \n&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#a9c681542bb2e28dccfdcb69fa9593b29">GOOGLE_CONFIG</a>&nbsp;&nbsp;&nbsp;&quot;gtalk.conf&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#a265618f8e70c8e4a15fa48a7cb1f6d32">GOOGLE_NS</a>&nbsp;&nbsp;&nbsp;&quot;http://www.google.com/session&quot;</td></tr>
<tr><td colspan="2"><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#aabf7ea7d1c280c2d91d5ad67ea5ab883">gtalk_connect_type</a> { <a class="el" href="chan__gtalk_8c.html#aabf7ea7d1c280c2d91d5ad67ea5ab883afa2cfdc5c71aec4bb0ec4849e3236142">AJI_CONNECT_STUN</a> =  1, 
<a class="el" href="chan__gtalk_8c.html#aabf7ea7d1c280c2d91d5ad67ea5ab883a11e5bb1099f4e7c029d500bbc80ac483">AJI_CONNECT_LOCAL</a> =  2, 
<a class="el" href="chan__gtalk_8c.html#aabf7ea7d1c280c2d91d5ad67ea5ab883a2ef123abfa8253ea9f67f7750dbdc421">AJI_CONNECT_RELAY</a> =  3
 }</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#a4735ec2011c291c5213a858fe007c851">gtalk_protocol</a> { <a class="el" href="chan__gtalk_8c.html#a4735ec2011c291c5213a858fe007c851ac913daa556e052c68933b9c428707ee3">AJI_PROTOCOL_UDP</a> =  1, 
<a class="el" href="chan__gtalk_8c.html#a4735ec2011c291c5213a858fe007c851a8d65aeba8254d08131b4672b7a06221c">AJI_PROTOCOL_SSLTCP</a> =  2
 }</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#a8b0bdafb8aec1c12f09676cf21095769">add_codec_to_answer</a> (const struct <a class="el" href="structgtalk__pvt.html">gtalk_pvt</a> *p, int codec, iks *dcodecs)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#a881799e9c17fc02dfa8d14a0b88aee59">AST_MODULE_INFO</a> (ASTERISK_GPL_KEY, AST_MODFLAG_DEFAULT,&quot;Gtalk Channel Driver&quot;,.load=load_module,.unload=unload_module,.reload=reload,)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#a2a597570b80bb813f9e017df2935860c">AST_MUTEX_DEFINE_STATIC</a> (gtalklock)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structgtalk.html">gtalk</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#a3a4d5143261dfb2f100e526609223bab">find_gtalk</a> (char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, char *connection)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#a97da48981722a1f8484aac2ea2e48da5">gtalk_action</a> (struct <a class="el" href="structgtalk.html">gtalk</a> *client, struct <a class="el" href="structgtalk__pvt.html">gtalk_pvt</a> *p, const char *action)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#a300fd28bae4ef2ff4b18e5c2e80244cf">gtalk_add_candidate</a> (struct <a class="el" href="structgtalk.html">gtalk</a> *client, ikspak *pak)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structgtalk__pvt.html">gtalk_pvt</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#aa0e0e8c2e99606e052fcd142dcf580dd">gtalk_alloc</a> (struct <a class="el" href="structgtalk.html">gtalk</a> *client, const char *us, const char *them, const char *sid)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#ab4016a88f2a6fbc6750653491dc8d8be">gtalk_answer</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *ast)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#a6267c8db91fb20894c6e17763febac14">gtalk_call</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *ast, char *dest, int timeout)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initiate new call, part of PBX interface dest is the dial string.  <a href="#a6267c8db91fb20894c6e17763febac14"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#aefe1cdecffa94036ff8745b95267e70c">gtalk_create_candidates</a> (struct <a class="el" href="structgtalk.html">gtalk</a> *client, struct <a class="el" href="structgtalk__pvt.html">gtalk_pvt</a> *p, char *sid, char *from, char *to)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#a81ece7628e623a8f04b68b7edd007ab1">gtalk_create_member</a> (char *label, struct <a class="el" href="structast__variable.html">ast_variable</a> *var, int allowguest, struct <a class="el" href="structast__codec__pref.html">ast_codec_pref</a> <a class="el" href="chan__iax2_8c.html#a46262e3cc2baf55a72542567ccfe86d9">prefs</a>, char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, struct <a class="el" href="structgtalk.html">gtalk</a> *<a class="el" href="structmember.html">member</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#afa624b42925eed15fdc76a849b0766ae">gtalk_digit</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *ast, char digit, unsigned int duration)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#a4ec053e812be19b810ff938914588518">gtalk_digit_begin</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *ast, char digit)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#a733bc73b78f85f96715d3a9029be69bc">gtalk_digit_end</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *ast, char digit, unsigned int duration)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#afc4171d29cff2186306811cc21ee480d">gtalk_do_reload</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">CLI command "gtalk reload".  <a href="#afc4171d29cff2186306811cc21ee480d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#ac86bc5d49ff09213cfe5a13e3ad1c1fa">gtalk_fixup</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *oldchan, struct <a class="el" href="structast__channel.html">ast_channel</a> *newchan)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#a55a258df74e77719bdcd6c617d91e2b0">gtalk_free_candidates</a> (struct <a class="el" href="structgtalk__candidate.html">gtalk_candidate</a> *candidate)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#a46487d9263cd957964d6056bfe183d6c">gtalk_free_pvt</a> (struct <a class="el" href="structgtalk.html">gtalk</a> *client, struct <a class="el" href="structgtalk__pvt.html">gtalk_pvt</a> *p)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#a81d8662de17c88b4d841d9379043b461">gtalk_get_codec</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95">ast_rtp_get_result</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#a94dbeea9dc490aa6149e045b2bd4421b">gtalk_get_rtp_peer</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structast__rtp.html">ast_rtp</a> **rtp)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#a61cd7bfb93e66deda92be4dd3bf8175f">gtalk_handle_dtmf</a> (struct <a class="el" href="structgtalk.html">gtalk</a> *client, ikspak *pak)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#ae40647d59ad2609a48c2c7e4b3ec1c3c">gtalk_hangup</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *ast)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Hangup a call through the <a class="el" href="structgtalk.html">gtalk</a> proxy channel.  <a href="#ae40647d59ad2609a48c2c7e4b3ec1c3c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#afdd3edee003bac0ad10d23a88b9b2a62">gtalk_hangup_farend</a> (struct <a class="el" href="structgtalk.html">gtalk</a> *client, ikspak *pak)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#a1d613b759165b8f5bba3dca27dfee45c">gtalk_indicate</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *ast, int condition, const void *data, size_t datalen)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#adbb80c94f25deee90406ec8e4b207db9">gtalk_invite</a> (struct <a class="el" href="structgtalk__pvt.html">gtalk_pvt</a> *p, char *to, char *from, char *sid, int initiator)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#a9647000d3f1d4b0364443c472e28af78">gtalk_invite_response</a> (struct <a class="el" href="structgtalk__pvt.html">gtalk_pvt</a> *p, char *to, char *from, char *sid, int initiator)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#ab1d8e1f165c49766885eeefb88ee1683">gtalk_is_accepted</a> (struct <a class="el" href="structgtalk.html">gtalk</a> *client, ikspak *pak)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#a3d19065e34e7d81391accb2ac3cb7cf1">gtalk_is_answered</a> (struct <a class="el" href="structgtalk.html">gtalk</a> *client, ikspak *pak)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#a87e308c2bc4ec47311b71ab1a613c44c">gtalk_load_config</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#a70f7219810c0483ff4725912193266bd">gtalk_member_destroy</a> (struct <a class="el" href="structgtalk.html">gtalk</a> *obj)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#aff3b348d0837fe806e53d1b66130693e">gtalk_new</a> (struct <a class="el" href="structgtalk.html">gtalk</a> *client, struct <a class="el" href="structgtalk__pvt.html">gtalk_pvt</a> *i, int <a class="el" href="structstate.html">state</a>, const char *title)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Start new <a class="el" href="structgtalk.html">gtalk</a> channel.  <a href="#aff3b348d0837fe806e53d1b66130693e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#aa8c45a47a9e46688c69cba60399bfd03">gtalk_newcall</a> (struct <a class="el" href="structgtalk.html">gtalk</a> *client, ikspak *pak)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#a8677afddf5ca302b0dd80e6330290cc2">gtalk_parser</a> (void *data, ikspak *pak)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#a18491cc6e0e1b499f59b1524b67e8cb7">gtalk_read</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *ast)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#a03e60f1275a660cde724d9a9b930a065">gtalk_request</a> (const char *<a class="el" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>, int <a class="el" href="chan__alsa_8c.html#a98f5e70e98f6dc48e3c5ba316066d540">format</a>, void *data, int *<a class="el" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Part of PBX interface.  <a href="#a03e60f1275a660cde724d9a9b930a065"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#ac60c0cc7813dc8afb593b62633a0236f">gtalk_response</a> (struct <a class="el" href="structgtalk.html">gtalk</a> *client, char *from, ikspak *pak, const char *reasonstr, const char *reasonstr2)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#a04f7e90ada5bf53d2d7d02e9dd4ad66c">gtalk_ringing_ack</a> (void *data, ikspak *pak)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#a51669af6c51b461739d586003af35dde">gtalk_rtp_read</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *ast, struct <a class="el" href="structgtalk__pvt.html">gtalk_pvt</a> *p)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#aa877860a00947443ae12744d4b7730f2">gtalk_sendhtml</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *ast, int subclass, const char *data, int datalen)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#a6e1f17efe86af5cb94a53c6c0e74bdd4">gtalk_set_rtp_peer</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structast__rtp.html">ast_rtp</a> *rtp, struct <a class="el" href="structast__rtp.html">ast_rtp</a> *vrtp, struct <a class="el" href="structast__rtp.html">ast_rtp</a> *trtp, int codecs, int nat_active)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#ae33a85434da4c4a6cb7454dc6528432b">gtalk_show_channels</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">CLI command "gtalk show channels".  <a href="#ae33a85434da4c4a6cb7454dc6528432b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#a4a9807802122430659202f6ce9663ead">gtalk_update_stun</a> (struct <a class="el" href="structgtalk.html">gtalk</a> *client, struct <a class="el" href="structgtalk__pvt.html">gtalk_pvt</a> *p)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#adcb572a924a53a9243646bd05656fda2">gtalk_write</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *ast, struct <a class="el" href="structast__frame.html">ast_frame</a> *frame)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Send frame to media channel (rtp).  <a href="#adcb572a924a53a9243646bd05656fda2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Load module into PBX, register channel.  <a href="#ac3382bf6da54c56b37069bd76bbdf4f9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Reload module.  <a href="#ad1982509765f4870f1f63412a53ea668"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Unload the <a class="el" href="structgtalk.html">gtalk</a> channel from Asterisk.  <a href="#ad09fa931f468002152a3cc2d5ce25eae"></a><br/></td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct in_addr&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#a1d084b82cb21102ba46ea60d3cd9c085">__ourip</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct sockaddr_in&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#a4ec29229510a2e3ea6ce34d520f06e90">bindaddr</a> = { 0, }</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__jb__conf.html">ast_jb_conf</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#a2d8d5920e90ccbad7832926becdadb29">default_jbconf</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#a787f82faccb7c1f40a2539a14855601b">desc</a> [] = &quot;Gtalk Channel&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#a651c2e6c15fed139c3dd5bf54ab01ff2">externip</a> [16]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#a10fc9006937dcda26877acc36353aad4">global_capability</a> = AST_FORMAT_ULAW | AST_FORMAT_ALAW | AST_FORMAT_GSM | AST_FORMAT_H263</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__jb__conf.html">ast_jb_conf</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#abaabcb7f4349cc632dde3af5c6a5e1bd">global_jbconf</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#af45d937b4d9f9451e31c9f059f8fb668">gtalk_cli</a> []</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structgtalk__container.html">gtalk_container</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#a8ddc6fee75005b7f3f13d189dd1ecb80">gtalk_list</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__rtp__protocol.html">ast_rtp_protocol</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#a30cf4dbe190977582df5b9ee84937213">gtalk_rtp</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">RTP driver interface.  <a href="#a30cf4dbe190977582df5b9ee84937213"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__channel__tech.html">ast_channel_tech</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#a99d9c7da92ab47bf1a3f0274c84ecee8">gtalk_tech</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">PBX interface structure for channel registration.  <a href="#a99d9c7da92ab47bf1a3f0274c84ecee8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structio__context.html">io_context</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#abda48311b6abe5a4dd8b6904ddde0a6d">io</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structsched__context.html">sched_context</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="chan__gtalk_8c.html#aea6233539fc73fc5303bf7525ec27e73">sched</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Gtalk Channel Driver, until google/libjingle works with <a class="el" href="structjingle.html">jingle</a> spec. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Matt O'Gorman &lt;<a href="mailto:mogorman@digium.com">mogorman@digium.com</a>&gt; </dd></dl>

<p>Definition in file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="ac8dc47e3b39c930caed4bfd05b4ba805"></a><!-- doxytag: member="chan_gtalk.c::FORMAT" ref="ac8dc47e3b39c930caed4bfd05b4ba805" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FORMAT&nbsp;&nbsp;&nbsp;&quot;%-30.30s  %-30.30s  %-15.15s  %-5.5s %-5.5s \n&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a9c681542bb2e28dccfdcb69fa9593b29"></a><!-- doxytag: member="chan_gtalk.c::GOOGLE_CONFIG" ref="a9c681542bb2e28dccfdcb69fa9593b29" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define GOOGLE_CONFIG&nbsp;&nbsp;&nbsp;&quot;gtalk.conf&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l00070">70</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>Referenced by <a class="el" href="chan__gtalk_8c_source.html#l01901">gtalk_load_config()</a>, and <a class="el" href="chan__gtalk_8c_source.html#l02033">load_module()</a>.</p>

</div>
</div>
<a class="anchor" id="a265618f8e70c8e4a15fa48a7cb1f6d32"></a><!-- doxytag: member="chan_gtalk.c::GOOGLE_NS" ref="a265618f8e70c8e4a15fa48a7cb1f6d32" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define GOOGLE_NS&nbsp;&nbsp;&nbsp;&quot;http://www.google.com/session&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l00072">72</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>Referenced by <a class="el" href="chan__gtalk_8c_source.html#l00773">gtalk_create_candidates()</a>.</p>

</div>
</div>
<hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="aabf7ea7d1c280c2d91d5ad67ea5ab883"></a><!-- doxytag: member="chan_gtalk.c::gtalk_connect_type" ref="aabf7ea7d1c280c2d91d5ad67ea5ab883" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="chan__gtalk_8c.html#aabf7ea7d1c280c2d91d5ad67ea5ab883">gtalk_connect_type</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="aabf7ea7d1c280c2d91d5ad67ea5ab883afa2cfdc5c71aec4bb0ec4849e3236142"></a><!-- doxytag: member="AJI_CONNECT_STUN" ref="aabf7ea7d1c280c2d91d5ad67ea5ab883afa2cfdc5c71aec4bb0ec4849e3236142" args="" -->AJI_CONNECT_STUN</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="aabf7ea7d1c280c2d91d5ad67ea5ab883a11e5bb1099f4e7c029d500bbc80ac483"></a><!-- doxytag: member="AJI_CONNECT_LOCAL" ref="aabf7ea7d1c280c2d91d5ad67ea5ab883a11e5bb1099f4e7c029d500bbc80ac483" args="" -->AJI_CONNECT_LOCAL</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="aabf7ea7d1c280c2d91d5ad67ea5ab883a2ef123abfa8253ea9f67f7750dbdc421"></a><!-- doxytag: member="AJI_CONNECT_RELAY" ref="aabf7ea7d1c280c2d91d5ad67ea5ab883a2ef123abfa8253ea9f67f7750dbdc421" args="" -->AJI_CONNECT_RELAY</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l00091">91</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00091"></a>00091                         {
<a name="l00092"></a>00092    <a class="code" href="chan__gtalk_8c.html#aabf7ea7d1c280c2d91d5ad67ea5ab883afa2cfdc5c71aec4bb0ec4849e3236142">AJI_CONNECT_STUN</a> = 1,
<a name="l00093"></a>00093    <a class="code" href="chan__gtalk_8c.html#aabf7ea7d1c280c2d91d5ad67ea5ab883a11e5bb1099f4e7c029d500bbc80ac483">AJI_CONNECT_LOCAL</a> = 2,
<a name="l00094"></a>00094    <a class="code" href="chan__gtalk_8c.html#aabf7ea7d1c280c2d91d5ad67ea5ab883a2ef123abfa8253ea9f67f7750dbdc421">AJI_CONNECT_RELAY</a> = 3,
<a name="l00095"></a>00095 };
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4735ec2011c291c5213a858fe007c851"></a><!-- doxytag: member="chan_gtalk.c::gtalk_protocol" ref="a4735ec2011c291c5213a858fe007c851" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="chan__gtalk_8c.html#a4735ec2011c291c5213a858fe007c851">gtalk_protocol</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a4735ec2011c291c5213a858fe007c851ac913daa556e052c68933b9c428707ee3"></a><!-- doxytag: member="AJI_PROTOCOL_UDP" ref="a4735ec2011c291c5213a858fe007c851ac913daa556e052c68933b9c428707ee3" args="" -->AJI_PROTOCOL_UDP</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a4735ec2011c291c5213a858fe007c851a8d65aeba8254d08131b4672b7a06221c"></a><!-- doxytag: member="AJI_PROTOCOL_SSLTCP" ref="a4735ec2011c291c5213a858fe007c851a8d65aeba8254d08131b4672b7a06221c" args="" -->AJI_PROTOCOL_SSLTCP</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l00086">86</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00086"></a>00086                     {
<a name="l00087"></a>00087    <a class="code" href="chan__gtalk_8c.html#a4735ec2011c291c5213a858fe007c851ac913daa556e052c68933b9c428707ee3">AJI_PROTOCOL_UDP</a> = 1,
<a name="l00088"></a>00088    <a class="code" href="chan__gtalk_8c.html#a4735ec2011c291c5213a858fe007c851a8d65aeba8254d08131b4672b7a06221c">AJI_PROTOCOL_SSLTCP</a> = 2,
<a name="l00089"></a>00089 };
</pre></div></p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a8b0bdafb8aec1c12f09676cf21095769"></a><!-- doxytag: member="chan_gtalk.c::add_codec_to_answer" ref="a8b0bdafb8aec1c12f09676cf21095769" args="(const struct gtalk_pvt *p, int codec, iks *dcodecs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int add_codec_to_answer </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structgtalk__pvt.html">gtalk_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>codec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">iks *&nbsp;</td>
          <td class="paramname"> <em>dcodecs</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l00274">274</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="frame_8c_source.html#l00573">ast_getformatname()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="rtp_8c_source.html#l02360">ast_rtp_lookup_code()</a>, <a class="el" href="cdr__custom_8c_source.html#l00058">format</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, and <a class="el" href="chan__gtalk_8c_source.html#l00116">gtalk_pvt::rtp</a>.</p>

<p>Referenced by <a class="el" href="chan__gtalk_8c_source.html#l00379">gtalk_invite()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00275"></a>00275 {
<a name="l00276"></a>00276    <span class="keywordtype">int</span> res = 0;
<a name="l00277"></a>00277    <span class="keywordtype">char</span> *<a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a> = <a class="code" href="frame_8h.html#afe8f690984f8ba95cd01a431198c10bf" title="Get the name of a format.">ast_getformatname</a>(codec);
<a name="l00278"></a>00278 
<a name="l00279"></a>00279    <span class="keywordflow">if</span> (!strcasecmp(<span class="stringliteral">&quot;ulaw&quot;</span>, format)) {
<a name="l00280"></a>00280       iks *payload_eg711u, *payload_pcmu;
<a name="l00281"></a>00281       payload_pcmu = iks_new(<span class="stringliteral">&quot;payload-type&quot;</span>);
<a name="l00282"></a>00282       payload_eg711u = iks_new(<span class="stringliteral">&quot;payload-type&quot;</span>);
<a name="l00283"></a>00283    
<a name="l00284"></a>00284       <span class="keywordflow">if</span>(!payload_eg711u || !payload_pcmu) {
<a name="l00285"></a>00285          iks_delete(payload_pcmu);
<a name="l00286"></a>00286          iks_delete(payload_eg711u);
<a name="l00287"></a>00287          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,<span class="stringliteral">&quot;Failed to allocate iks node&quot;</span>);
<a name="l00288"></a>00288          <span class="keywordflow">return</span> -1;
<a name="l00289"></a>00289       }
<a name="l00290"></a>00290       iks_insert_attrib(payload_pcmu, <span class="stringliteral">&quot;id&quot;</span>, <span class="stringliteral">&quot;0&quot;</span>);
<a name="l00291"></a>00291       iks_insert_attrib(payload_pcmu, <span class="stringliteral">&quot;name&quot;</span>, <span class="stringliteral">&quot;PCMU&quot;</span>);
<a name="l00292"></a>00292       iks_insert_attrib(payload_pcmu, <span class="stringliteral">&quot;clockrate&quot;</span>,<span class="stringliteral">&quot;8000&quot;</span>);
<a name="l00293"></a>00293       iks_insert_attrib(payload_pcmu, <span class="stringliteral">&quot;bitrate&quot;</span>,<span class="stringliteral">&quot;64000&quot;</span>);
<a name="l00294"></a>00294       iks_insert_attrib(payload_eg711u, <span class="stringliteral">&quot;id&quot;</span>, <span class="stringliteral">&quot;100&quot;</span>);
<a name="l00295"></a>00295       iks_insert_attrib(payload_eg711u, <span class="stringliteral">&quot;name&quot;</span>, <span class="stringliteral">&quot;EG711U&quot;</span>);
<a name="l00296"></a>00296       iks_insert_attrib(payload_eg711u, <span class="stringliteral">&quot;clockrate&quot;</span>,<span class="stringliteral">&quot;8000&quot;</span>);
<a name="l00297"></a>00297       iks_insert_attrib(payload_eg711u, <span class="stringliteral">&quot;bitrate&quot;</span>,<span class="stringliteral">&quot;64000&quot;</span>);
<a name="l00298"></a>00298       iks_insert_node(dcodecs, payload_pcmu);
<a name="l00299"></a>00299       iks_insert_node(dcodecs, payload_eg711u);
<a name="l00300"></a>00300       res ++;
<a name="l00301"></a>00301    }
<a name="l00302"></a>00302    <span class="keywordflow">if</span> (!strcasecmp(<span class="stringliteral">&quot;alaw&quot;</span>, format)) {
<a name="l00303"></a>00303       iks *payload_eg711a, *payload_pcma;
<a name="l00304"></a>00304       payload_pcma = iks_new(<span class="stringliteral">&quot;payload-type&quot;</span>);
<a name="l00305"></a>00305       payload_eg711a = iks_new(<span class="stringliteral">&quot;payload-type&quot;</span>);
<a name="l00306"></a>00306       <span class="keywordflow">if</span>(!payload_eg711a || !payload_pcma) {
<a name="l00307"></a>00307          iks_delete(payload_eg711a);
<a name="l00308"></a>00308          iks_delete(payload_pcma);
<a name="l00309"></a>00309          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,<span class="stringliteral">&quot;Failed to allocate iks node&quot;</span>);
<a name="l00310"></a>00310          <span class="keywordflow">return</span> -1;
<a name="l00311"></a>00311       }
<a name="l00312"></a>00312       iks_insert_attrib(payload_pcma, <span class="stringliteral">&quot;id&quot;</span>, <span class="stringliteral">&quot;8&quot;</span>);
<a name="l00313"></a>00313       iks_insert_attrib(payload_pcma, <span class="stringliteral">&quot;name&quot;</span>, <span class="stringliteral">&quot;PCMA&quot;</span>);
<a name="l00314"></a>00314       iks_insert_attrib(payload_pcma, <span class="stringliteral">&quot;clockrate&quot;</span>,<span class="stringliteral">&quot;8000&quot;</span>);
<a name="l00315"></a>00315       iks_insert_attrib(payload_pcma, <span class="stringliteral">&quot;bitrate&quot;</span>,<span class="stringliteral">&quot;64000&quot;</span>);
<a name="l00316"></a>00316       payload_eg711a = iks_new(<span class="stringliteral">&quot;payload-type&quot;</span>);
<a name="l00317"></a>00317       iks_insert_attrib(payload_eg711a, <span class="stringliteral">&quot;id&quot;</span>, <span class="stringliteral">&quot;101&quot;</span>);
<a name="l00318"></a>00318       iks_insert_attrib(payload_eg711a, <span class="stringliteral">&quot;name&quot;</span>, <span class="stringliteral">&quot;EG711A&quot;</span>);
<a name="l00319"></a>00319       iks_insert_attrib(payload_eg711a, <span class="stringliteral">&quot;clockrate&quot;</span>,<span class="stringliteral">&quot;8000&quot;</span>);
<a name="l00320"></a>00320       iks_insert_attrib(payload_eg711a, <span class="stringliteral">&quot;bitrate&quot;</span>,<span class="stringliteral">&quot;64000&quot;</span>);
<a name="l00321"></a>00321       iks_insert_node(dcodecs, payload_pcma);
<a name="l00322"></a>00322       iks_insert_node(dcodecs, payload_eg711a);
<a name="l00323"></a>00323       res ++;
<a name="l00324"></a>00324    }
<a name="l00325"></a>00325    <span class="keywordflow">if</span> (!strcasecmp(<span class="stringliteral">&quot;ilbc&quot;</span>, format)) {
<a name="l00326"></a>00326       iks *payload_ilbc = iks_new(<span class="stringliteral">&quot;payload-type&quot;</span>);
<a name="l00327"></a>00327       <span class="keywordflow">if</span>(!payload_ilbc) {
<a name="l00328"></a>00328          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,<span class="stringliteral">&quot;Failed to allocate iks node&quot;</span>);
<a name="l00329"></a>00329          <span class="keywordflow">return</span> -1;
<a name="l00330"></a>00330       }
<a name="l00331"></a>00331       iks_insert_attrib(payload_ilbc, <span class="stringliteral">&quot;id&quot;</span>, <span class="stringliteral">&quot;97&quot;</span>);
<a name="l00332"></a>00332       iks_insert_attrib(payload_ilbc, <span class="stringliteral">&quot;name&quot;</span>, <span class="stringliteral">&quot;iLBC&quot;</span>);
<a name="l00333"></a>00333       iks_insert_attrib(payload_ilbc, <span class="stringliteral">&quot;clockrate&quot;</span>,<span class="stringliteral">&quot;8000&quot;</span>);
<a name="l00334"></a>00334       iks_insert_attrib(payload_ilbc, <span class="stringliteral">&quot;bitrate&quot;</span>,<span class="stringliteral">&quot;13300&quot;</span>);
<a name="l00335"></a>00335       iks_insert_node(dcodecs, payload_ilbc);
<a name="l00336"></a>00336       res ++;
<a name="l00337"></a>00337    }
<a name="l00338"></a>00338    <span class="keywordflow">if</span> (!strcasecmp(<span class="stringliteral">&quot;g723&quot;</span>, format)) {
<a name="l00339"></a>00339       iks *payload_g723 = iks_new(<span class="stringliteral">&quot;payload-type&quot;</span>);
<a name="l00340"></a>00340       <span class="keywordflow">if</span>(!payload_g723) {
<a name="l00341"></a>00341          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,<span class="stringliteral">&quot;Failed to allocate iks node&quot;</span>);
<a name="l00342"></a>00342          <span class="keywordflow">return</span> -1;
<a name="l00343"></a>00343       }
<a name="l00344"></a>00344       iks_insert_attrib(payload_g723, <span class="stringliteral">&quot;id&quot;</span>, <span class="stringliteral">&quot;4&quot;</span>);
<a name="l00345"></a>00345       iks_insert_attrib(payload_g723, <span class="stringliteral">&quot;name&quot;</span>, <span class="stringliteral">&quot;G723&quot;</span>);
<a name="l00346"></a>00346       iks_insert_attrib(payload_g723, <span class="stringliteral">&quot;clockrate&quot;</span>,<span class="stringliteral">&quot;8000&quot;</span>);
<a name="l00347"></a>00347       iks_insert_attrib(payload_g723, <span class="stringliteral">&quot;bitrate&quot;</span>,<span class="stringliteral">&quot;6300&quot;</span>);
<a name="l00348"></a>00348       iks_insert_node(dcodecs, payload_g723);
<a name="l00349"></a>00349       res ++;
<a name="l00350"></a>00350    }
<a name="l00351"></a>00351    <span class="keywordflow">if</span> (!strcasecmp(<span class="stringliteral">&quot;speex&quot;</span>, format)) {
<a name="l00352"></a>00352       iks *payload_speex = iks_new(<span class="stringliteral">&quot;payload-type&quot;</span>);
<a name="l00353"></a>00353       <span class="keywordflow">if</span>(!payload_speex) {
<a name="l00354"></a>00354          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,<span class="stringliteral">&quot;Failed to allocate iks node&quot;</span>);
<a name="l00355"></a>00355          <span class="keywordflow">return</span> -1;
<a name="l00356"></a>00356       }
<a name="l00357"></a>00357       iks_insert_attrib(payload_speex, <span class="stringliteral">&quot;id&quot;</span>, <span class="stringliteral">&quot;110&quot;</span>);
<a name="l00358"></a>00358       iks_insert_attrib(payload_speex, <span class="stringliteral">&quot;name&quot;</span>, <span class="stringliteral">&quot;speex&quot;</span>);
<a name="l00359"></a>00359       iks_insert_attrib(payload_speex, <span class="stringliteral">&quot;clockrate&quot;</span>,<span class="stringliteral">&quot;8000&quot;</span>);
<a name="l00360"></a>00360       iks_insert_attrib(payload_speex, <span class="stringliteral">&quot;bitrate&quot;</span>,<span class="stringliteral">&quot;11000&quot;</span>);
<a name="l00361"></a>00361       iks_insert_node(dcodecs, payload_speex);
<a name="l00362"></a>00362       res++;
<a name="l00363"></a>00363    }
<a name="l00364"></a>00364    <span class="keywordflow">if</span> (!strcasecmp(<span class="stringliteral">&quot;gsm&quot;</span>, format)) {
<a name="l00365"></a>00365       iks *payload_gsm = iks_new(<span class="stringliteral">&quot;payload-type&quot;</span>);
<a name="l00366"></a>00366       <span class="keywordflow">if</span>(!payload_gsm) {
<a name="l00367"></a>00367          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,<span class="stringliteral">&quot;Failed to allocate iks node&quot;</span>);
<a name="l00368"></a>00368          <span class="keywordflow">return</span> -1;
<a name="l00369"></a>00369       }
<a name="l00370"></a>00370       iks_insert_attrib(payload_gsm, <span class="stringliteral">&quot;id&quot;</span>, <span class="stringliteral">&quot;103&quot;</span>);
<a name="l00371"></a>00371       iks_insert_attrib(payload_gsm, <span class="stringliteral">&quot;name&quot;</span>, <span class="stringliteral">&quot;gsm&quot;</span>);
<a name="l00372"></a>00372       iks_insert_node(dcodecs, payload_gsm);
<a name="l00373"></a>00373       res++;
<a name="l00374"></a>00374    }
<a name="l00375"></a>00375    <a class="code" href="rtp_8h.html#a4daa559b8f2ef25bc33d8f5d8fd937d1" title="Looks up an RTP code out of our *static* outbound list.">ast_rtp_lookup_code</a>(p-&gt;<a class="code" href="structgtalk__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>, 1, codec);
<a name="l00376"></a>00376    <span class="keywordflow">return</span> res;
<a name="l00377"></a>00377 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a881799e9c17fc02dfa8d14a0b88aee59"></a><!-- doxytag: member="chan_gtalk.c::AST_MODULE_INFO" ref="a881799e9c17fc02dfa8d14a0b88aee59" args="(ASTERISK_GPL_KEY, AST_MODFLAG_DEFAULT,&quot;Gtalk Channel Driver&quot;,.load=load_module,.unload=unload_module,.reload=reload,)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">AST_MODULE_INFO </td>
          <td>(</td>
          <td class="paramtype">ASTERISK_GPL_KEY&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">AST_MODFLAG_DEFAULT&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&quot;Gtalk Channel Driver&quot;&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">.&nbsp;</td>
          <td class="paramname"> <em>load</em> = <code>load_module</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">.&nbsp;</td>
          <td class="paramname"> <em>unload</em> = <code>unload_module</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">.&nbsp;</td>
          <td class="paramname"> <em>reload</em> = <code>reload</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a2a597570b80bb813f9e017df2935860c"></a><!-- doxytag: member="chan_gtalk.c::AST_MUTEX_DEFINE_STATIC" ref="a2a597570b80bb813f9e017df2935860c" args="(gtalklock)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">AST_MUTEX_DEFINE_STATIC </td>
          <td>(</td>
          <td class="paramtype">gtalklock&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Protect the interface list (of gtalk_pvt's) </p>

</div>
</div>
<a class="anchor" id="a3a4d5143261dfb2f100e526609223bab"></a><!-- doxytag: member="chan_gtalk.c::find_gtalk" ref="a3a4d5143261dfb2f100e526609223bab" args="(char *name, char *connection)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structgtalk.html">gtalk</a>* find_gtalk </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>connection</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l00242">242</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="logger_8h_source.html#l00079">ast_verbose</a>, <a class="el" href="astobj_8h_source.html#l00401">ASTOBJ_CONTAINER_FIND</a>, <a class="el" href="astobj_8h_source.html#l00428">ASTOBJ_CONTAINER_FIND_FULL</a>, <a class="el" href="astobj_8h_source.html#l00376">ASTOBJ_CONTAINER_TRAVERSE</a>, <a class="el" href="astobj_8h_source.html#l00100">ASTOBJ_RDLOCK</a>, <a class="el" href="astobj_8h_source.html#l00109">ASTOBJ_UNLOCK</a>, <a class="el" href="chan__gtalk_8c_source.html#l00235">gtalk_list</a>, <a class="el" href="aesopt_8h_source.html#l00399">s</a>, and <a class="el" href="agi_2strcompat_8c_source.html#l00027">strsep()</a>.</p>

<p>Referenced by <a class="el" href="chan__gtalk_8c_source.html#l01637">gtalk_request()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00243"></a>00243 {
<a name="l00244"></a>00244    <span class="keyword">struct </span><a class="code" href="structgtalk.html">gtalk</a> *<a class="code" href="structgtalk.html">gtalk</a> = NULL;
<a name="l00245"></a>00245    <span class="keywordtype">char</span> *<a class="code" href="structdomain.html" title="Domain data structure.">domain</a> = NULL , *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a> = NULL;
<a name="l00246"></a>00246 
<a name="l00247"></a>00247    <span class="keywordflow">if</span> (strchr(<a class="code" href="structgtalk.html#a22eb965539587ef7d2b0340d57159e3a">connection</a>, <span class="charliteral">&apos;@&apos;</span>)) {
<a name="l00248"></a>00248       s = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(<a class="code" href="structgtalk.html#a22eb965539587ef7d2b0340d57159e3a">connection</a>);
<a name="l00249"></a>00249       domain = <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;s, <span class="stringliteral">&quot;@&quot;</span>);
<a name="l00250"></a>00250       <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;OOOOH domain = %s\n&quot;</span>, domain);
<a name="l00251"></a>00251    }
<a name="l00252"></a>00252    gtalk = <a class="code" href="astobj_8h.html#aca5d7206cd0c6817140bba786a9b6b8a" title="Find an object in a container.">ASTOBJ_CONTAINER_FIND</a>(&amp;<a class="code" href="chan__gtalk_8c.html#a8ddc6fee75005b7f3f13d189dd1ecb80">gtalk_list</a>, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l00253"></a>00253    <span class="keywordflow">if</span> (!gtalk &amp;&amp; strchr(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="charliteral">&apos;@&apos;</span>))
<a name="l00254"></a>00254       gtalk = <a class="code" href="astobj_8h.html#a2714c822060df6eec7241ee4b250cc3c" title="Find an object in a container.">ASTOBJ_CONTAINER_FIND_FULL</a>(&amp;<a class="code" href="chan__gtalk_8c.html#a8ddc6fee75005b7f3f13d189dd1ecb80">gtalk_list</a>, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <a class="code" href="structuser.html" title="structure to hold users read from users.conf">user</a>,,, strcasecmp);
<a name="l00255"></a>00255 
<a name="l00256"></a>00256    <span class="keywordflow">if</span> (!gtalk) {           
<a name="l00257"></a>00257       <span class="comment">/* guest call */</span>
<a name="l00258"></a>00258       <a class="code" href="astobj_8h.html#a8483cbd2bcf0b91ac62168fb1cb7f5b1" title="Iterate through the objects in a container.">ASTOBJ_CONTAINER_TRAVERSE</a>(&amp;<a class="code" href="chan__gtalk_8c.html#a8ddc6fee75005b7f3f13d189dd1ecb80">gtalk_list</a>, 1, {
<a name="l00259"></a>00259          <a class="code" href="astobj_8h.html#a8d411cc142b0b49472fe38cf7b0845e1" title="Lock an ASTOBJ for reading.">ASTOBJ_RDLOCK</a>(iterator);
<a name="l00260"></a>00260          <span class="keywordflow">if</span> (!strcasecmp(iterator-&gt;name, <span class="stringliteral">&quot;guest&quot;</span>)) {
<a name="l00261"></a>00261             gtalk = iterator;
<a name="l00262"></a>00262          }
<a name="l00263"></a>00263          <a class="code" href="astobj_8h.html#a9acee27cc52e8533d439f6cc10d11fbc" title="Unlock a locked object.">ASTOBJ_UNLOCK</a>(iterator);
<a name="l00264"></a>00264 
<a name="l00265"></a>00265          <span class="keywordflow">if</span> (gtalk)
<a name="l00266"></a>00266             <span class="keywordflow">break</span>;
<a name="l00267"></a>00267       });
<a name="l00268"></a>00268 
<a name="l00269"></a>00269    }
<a name="l00270"></a>00270    <span class="keywordflow">return</span> gtalk;
<a name="l00271"></a>00271 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a97da48981722a1f8484aac2ea2e48da5"></a><!-- doxytag: member="chan_gtalk.c::gtalk_action" ref="a97da48981722a1f8484aac2ea2e48da5" args="(struct gtalk *client, struct gtalk_pvt *p, const char *action)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int gtalk_action </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structgtalk.html">gtalk</a> *&nbsp;</td>
          <td class="paramname"> <em>client</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structgtalk__pvt.html">gtalk_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>action</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l01078">1078</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="res__jabber_8c_source.html#l02038">ast_aji_increment_mid()</a>, <a class="el" href="res__jabber_8c_source.html#l00818">ast_aji_send()</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="chan__gtalk_8c_source.html#l00140">gtalk::connection</a>, <a class="el" href="chan__gtalk_8c_source.html#l00106">gtalk_pvt::initiator</a>, <a class="el" href="jabber_8h_source.html#l00148">aji_client::mid</a>, <a class="el" href="chan__gtalk_8c_source.html#l00101">gtalk_pvt::sid</a>, <a class="el" href="chan__gtalk_8c_source.html#l00103">gtalk_pvt::them</a>, and <a class="el" href="chan__gtalk_8c_source.html#l00102">gtalk_pvt::us</a>.</p>

<p>Referenced by <a class="el" href="chan__gtalk_8c_source.html#l01617">gtalk_hangup()</a>, and <a class="el" href="chan__gtalk_8c_source.html#l01154">gtalk_newcall()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01079"></a>01079 {
<a name="l01080"></a>01080    iks *request, *session = NULL;
<a name="l01081"></a>01081    <span class="keywordtype">int</span> res = -1;
<a name="l01082"></a>01082    <span class="keywordtype">char</span> *lowerthem = NULL;
<a name="l01083"></a>01083 
<a name="l01084"></a>01084    request = iks_new(<span class="stringliteral">&quot;iq&quot;</span>);
<a name="l01085"></a>01085    <span class="keywordflow">if</span> (request) {
<a name="l01086"></a>01086       iks_insert_attrib(request, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;set&quot;</span>);
<a name="l01087"></a>01087       iks_insert_attrib(request, <span class="stringliteral">&quot;from&quot;</span>, p-&gt;<a class="code" href="structgtalk__pvt.html#a81eba36a21e03789e7d728d4bebd61d3">us</a>);
<a name="l01088"></a>01088       iks_insert_attrib(request, <span class="stringliteral">&quot;to&quot;</span>, p-&gt;<a class="code" href="structgtalk__pvt.html#a7c3b41a9f87238ef5a35607e6655f02e">them</a>);
<a name="l01089"></a>01089       iks_insert_attrib(request, <span class="stringliteral">&quot;id&quot;</span>, client-&gt;<a class="code" href="structgtalk.html#a22eb965539587ef7d2b0340d57159e3a">connection</a>-&gt;<a class="code" href="structaji__client.html#abee5661fa88af477fe47bbbd21136301">mid</a>);
<a name="l01090"></a>01090       <a class="code" href="jabber_8h.html#a6e4ae95e74b73933aa6e6d6817df9023" title="increments the mid field for messages and other events.">ast_aji_increment_mid</a>(client-&gt;<a class="code" href="structgtalk.html#a22eb965539587ef7d2b0340d57159e3a">connection</a>-&gt;<a class="code" href="structaji__client.html#abee5661fa88af477fe47bbbd21136301">mid</a>);
<a name="l01091"></a>01091       session = iks_new(<span class="stringliteral">&quot;session&quot;</span>);
<a name="l01092"></a>01092       <span class="keywordflow">if</span> (session) {
<a name="l01093"></a>01093          iks_insert_attrib(session, <span class="stringliteral">&quot;type&quot;</span>, action);
<a name="l01094"></a>01094          iks_insert_attrib(session, <span class="stringliteral">&quot;id&quot;</span>, p-&gt;<a class="code" href="structgtalk__pvt.html#a11855a8fa7877d4395e800ce1bb3ed8d">sid</a>);
<a name="l01095"></a>01095          <span class="comment">/* put the initiator attribute to lower case if we receive the call </span>
<a name="l01096"></a>01096 <span class="comment">          * otherwise GoogleTalk won&apos;t establish the session */</span>
<a name="l01097"></a>01097          <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="structgtalk__pvt.html#ad65c66f9895c8d58b388365ac363e91c">initiator</a>) {
<a name="l01098"></a>01098                  <span class="keywordtype">char</span> c;
<a name="l01099"></a>01099             <span class="keywordtype">char</span> *t = lowerthem = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(p-&gt;<a class="code" href="structgtalk__pvt.html#a7c3b41a9f87238ef5a35607e6655f02e">them</a>);
<a name="l01100"></a>01100             <span class="keywordflow">while</span> (((c = *t) != <span class="charliteral">&apos;/&apos;</span>) &amp;&amp; (*t++ = tolower(c)));
<a name="l01101"></a>01101          }
<a name="l01102"></a>01102          iks_insert_attrib(session, <span class="stringliteral">&quot;initiator&quot;</span>, p-&gt;<a class="code" href="structgtalk__pvt.html#ad65c66f9895c8d58b388365ac363e91c">initiator</a> ? p-&gt;<a class="code" href="structgtalk__pvt.html#a81eba36a21e03789e7d728d4bebd61d3">us</a> : lowerthem);
<a name="l01103"></a>01103          iks_insert_attrib(session, <span class="stringliteral">&quot;xmlns&quot;</span>, <span class="stringliteral">&quot;http://www.google.com/session&quot;</span>);
<a name="l01104"></a>01104          iks_insert_node(request, session);
<a name="l01105"></a>01105          <a class="code" href="jabber_8h.html#a3c77ceecc909619207e971421fc3e9ef" title="Wraps raw sending.">ast_aji_send</a>(client-&gt;<a class="code" href="structgtalk.html#a22eb965539587ef7d2b0340d57159e3a">connection</a>, request);
<a name="l01106"></a>01106          res = 0;
<a name="l01107"></a>01107       }
<a name="l01108"></a>01108    }
<a name="l01109"></a>01109 
<a name="l01110"></a>01110    iks_delete(session);
<a name="l01111"></a>01111    iks_delete(request);
<a name="l01112"></a>01112 
<a name="l01113"></a>01113    <span class="keywordflow">return</span> res;
<a name="l01114"></a>01114 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a300fd28bae4ef2ff4b18e5c2e80244cf"></a><!-- doxytag: member="chan_gtalk.c::gtalk_add_candidate" ref="a300fd28bae4ef2ff4b18e5c2e80244cf" args="(struct gtalk *client, ikspak *pak)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int gtalk_add_candidate </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structgtalk.html">gtalk</a> *&nbsp;</td>
          <td class="paramname"> <em>client</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ikspak *&nbsp;</td>
          <td class="paramname"> <em>pak</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l01302">1302</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="chan__gtalk_8c_source.html#l00093">AJI_CONNECT_LOCAL</a>, <a class="el" href="chan__gtalk_8c_source.html#l00094">AJI_CONNECT_RELAY</a>, <a class="el" href="chan__gtalk_8c_source.html#l00092">AJI_CONNECT_STUN</a>, <a class="el" href="chan__gtalk_8c_source.html#l00088">AJI_PROTOCOL_SSLTCP</a>, <a class="el" href="chan__gtalk_8c_source.html#l00087">AJI_PROTOCOL_UDP</a>, <a class="el" href="res__jabber_8c_source.html#l00818">ast_aji_send()</a>, <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00140">gtalk::connection</a>, <a class="el" href="chan__gtalk_8c_source.html#l00131">gtalk_candidate::generation</a>, <a class="el" href="chan__gtalk_8c_source.html#l01256">gtalk_update_stun()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00132">gtalk_candidate::ip</a>, <a class="el" href="jabber_8h_source.html#l00149">aji_client::jid</a>, <a class="el" href="chan__gtalk_8c_source.html#l00099">gtalk_pvt::laststun</a>, <a class="el" href="chan__gtalk_8c_source.html#l00124">gtalk_candidate::name</a>, <a class="el" href="chan__gtalk_8c_source.html#l00130">gtalk_candidate::network</a>, <a class="el" href="chan__gtalk_8c_source.html#l00135">gtalk_candidate::next</a>, <a class="el" href="chan__gtalk_8c_source.html#l00120">gtalk_pvt::next</a>, <a class="el" href="chan__gtalk_8c_source.html#l00142">gtalk::p</a>, <a class="el" href="chan__gtalk_8c_source.html#l00100">gtalk_pvt::parent</a>, <a class="el" href="chan__gtalk_8c_source.html#l00128">gtalk_candidate::password</a>, <a class="el" href="chan__gtalk_8c_source.html#l00133">gtalk_candidate::port</a>, <a class="el" href="chan__gtalk_8c_source.html#l00126">gtalk_candidate::preference</a>, <a class="el" href="chan__gtalk_8c_source.html#l00125">gtalk_candidate::protocol</a>, <a class="el" href="chan__gtalk_8c_source.html#l00134">gtalk_candidate::receipt</a>, <a class="el" href="chan__gtalk_8c_source.html#l00110">gtalk_pvt::theircandidates</a>, <a class="el" href="chan__gtalk_8c_source.html#l00129">gtalk_candidate::type</a>, and <a class="el" href="chan__gtalk_8c_source.html#l00127">gtalk_candidate::username</a>.</p>

<p>Referenced by <a class="el" href="chan__gtalk_8c_source.html#l01764">gtalk_parser()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01303"></a>01303 {
<a name="l01304"></a>01304    <span class="keyword">struct </span><a class="code" href="structgtalk__pvt.html">gtalk_pvt</a> *p = NULL, *tmp = NULL;
<a name="l01305"></a>01305    <span class="keyword">struct </span><a class="code" href="structaji__client.html">aji_client</a> *c = client-&gt;<a class="code" href="structgtalk.html#a22eb965539587ef7d2b0340d57159e3a">connection</a>;
<a name="l01306"></a>01306    <span class="keyword">struct </span><a class="code" href="structgtalk__candidate.html">gtalk_candidate</a> *newcandidate = NULL;
<a name="l01307"></a>01307    iks *traversenodes = NULL, *<a class="code" href="structgtalk__candidate.html#a07cf7683ab9878c4cd8f2525e8b86f4e">receipt</a> = NULL;
<a name="l01308"></a>01308    <span class="keywordtype">char</span> *from;
<a name="l01309"></a>01309 
<a name="l01310"></a>01310    from = iks_find_attrib(pak-&gt;x,<span class="stringliteral">&quot;to&quot;</span>);
<a name="l01311"></a>01311    <span class="keywordflow">if</span>(!from)
<a name="l01312"></a>01312       from = c-&gt;<a class="code" href="structaji__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;full;
<a name="l01313"></a>01313 
<a name="l01314"></a>01314    <span class="keywordflow">for</span> (tmp = client-&gt;<a class="code" href="structgtalk.html#a87c10b8b2ce58b28854a6cf5a7462bbd">p</a>; tmp; tmp = tmp-&gt;<a class="code" href="structgtalk__pvt.html#ad52b2b57b8b3ac8cab36317c65547157">next</a>) {
<a name="l01315"></a>01315       <span class="keywordflow">if</span> (iks_find_with_attrib(pak-&gt;x, <span class="stringliteral">&quot;session&quot;</span>, <span class="stringliteral">&quot;id&quot;</span>, tmp-&gt;sid)) {
<a name="l01316"></a>01316          p = tmp;
<a name="l01317"></a>01317          <span class="keywordflow">break</span>;
<a name="l01318"></a>01318       }
<a name="l01319"></a>01319    }
<a name="l01320"></a>01320 
<a name="l01321"></a>01321    <span class="keywordflow">if</span> (!p)
<a name="l01322"></a>01322       <span class="keywordflow">return</span> -1;
<a name="l01323"></a>01323 
<a name="l01324"></a>01324    traversenodes = pak-&gt;query;
<a name="l01325"></a>01325    <span class="keywordflow">while</span>(traversenodes) {
<a name="l01326"></a>01326       <span class="keywordflow">if</span>(!strcasecmp(iks_name(traversenodes), <span class="stringliteral">&quot;session&quot;</span>)) {
<a name="l01327"></a>01327          traversenodes = iks_first_tag(traversenodes);
<a name="l01328"></a>01328          <span class="keywordflow">continue</span>;
<a name="l01329"></a>01329       }
<a name="l01330"></a>01330       <span class="keywordflow">if</span>(!strcasecmp(iks_name(traversenodes), <span class="stringliteral">&quot;transport&quot;</span>)) {
<a name="l01331"></a>01331          traversenodes = iks_first_tag(traversenodes);
<a name="l01332"></a>01332          <span class="keywordflow">continue</span>;
<a name="l01333"></a>01333       }
<a name="l01334"></a>01334       <span class="keywordflow">if</span>(!strcasecmp(iks_name(traversenodes), <span class="stringliteral">&quot;candidate&quot;</span>)) {
<a name="l01335"></a>01335          newcandidate = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*newcandidate));
<a name="l01336"></a>01336          <span class="keywordflow">if</span> (!newcandidate)
<a name="l01337"></a>01337             <span class="keywordflow">return</span> 0;
<a name="l01338"></a>01338          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(newcandidate-&gt;<a class="code" href="structgtalk__candidate.html#aeaf846aa21a7d016a52f0b5b0c2f5544">name</a>, iks_find_attrib(traversenodes, <span class="stringliteral">&quot;name&quot;</span>),
<a name="l01339"></a>01339                      <span class="keyword">sizeof</span>(newcandidate-&gt;<a class="code" href="structgtalk__candidate.html#aeaf846aa21a7d016a52f0b5b0c2f5544">name</a>));
<a name="l01340"></a>01340          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(newcandidate-&gt;<a class="code" href="structgtalk__candidate.html#ac03ec605186c0c6d17c4beaab73d615c">ip</a>, iks_find_attrib(traversenodes, <span class="stringliteral">&quot;address&quot;</span>),
<a name="l01341"></a>01341                      <span class="keyword">sizeof</span>(newcandidate-&gt;<a class="code" href="structgtalk__candidate.html#ac03ec605186c0c6d17c4beaab73d615c">ip</a>));
<a name="l01342"></a>01342          newcandidate-&gt;<a class="code" href="structgtalk__candidate.html#a63c89c04d1feae07ca35558055155ffb">port</a> = atoi(iks_find_attrib(traversenodes, <span class="stringliteral">&quot;port&quot;</span>));
<a name="l01343"></a>01343          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(newcandidate-&gt;<a class="code" href="structgtalk__candidate.html#a05eeba7fa0e9f1c4fcb8110937b46236">username</a>, iks_find_attrib(traversenodes, <span class="stringliteral">&quot;username&quot;</span>),
<a name="l01344"></a>01344                      <span class="keyword">sizeof</span>(newcandidate-&gt;<a class="code" href="structgtalk__candidate.html#a05eeba7fa0e9f1c4fcb8110937b46236">username</a>));
<a name="l01345"></a>01345          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(newcandidate-&gt;<a class="code" href="structgtalk__candidate.html#a20218b63ca6f0a6ce74d704d915cb90a">password</a>, iks_find_attrib(traversenodes, <span class="stringliteral">&quot;password&quot;</span>),
<a name="l01346"></a>01346                      <span class="keyword">sizeof</span>(newcandidate-&gt;<a class="code" href="structgtalk__candidate.html#a20218b63ca6f0a6ce74d704d915cb90a">password</a>));
<a name="l01347"></a>01347          newcandidate-&gt;<a class="code" href="structgtalk__candidate.html#aec15fa312e7877a8b26f9672d5da32b1">preference</a> = atof(iks_find_attrib(traversenodes, <span class="stringliteral">&quot;preference&quot;</span>));
<a name="l01348"></a>01348          <span class="keywordflow">if</span> (!strcasecmp(iks_find_attrib(traversenodes, <span class="stringliteral">&quot;protocol&quot;</span>), <span class="stringliteral">&quot;udp&quot;</span>))
<a name="l01349"></a>01349             newcandidate-&gt;<a class="code" href="structgtalk__candidate.html#a97af5ab5463f8cc8bde8c7727d79c870">protocol</a> = <a class="code" href="chan__gtalk_8c.html#a4735ec2011c291c5213a858fe007c851ac913daa556e052c68933b9c428707ee3">AJI_PROTOCOL_UDP</a>;
<a name="l01350"></a>01350          <span class="keywordflow">if</span> (!strcasecmp(iks_find_attrib(traversenodes, <span class="stringliteral">&quot;protocol&quot;</span>), <span class="stringliteral">&quot;ssltcp&quot;</span>))
<a name="l01351"></a>01351             newcandidate-&gt;<a class="code" href="structgtalk__candidate.html#a97af5ab5463f8cc8bde8c7727d79c870">protocol</a> = <a class="code" href="chan__gtalk_8c.html#a4735ec2011c291c5213a858fe007c851a8d65aeba8254d08131b4672b7a06221c">AJI_PROTOCOL_SSLTCP</a>;
<a name="l01352"></a>01352       
<a name="l01353"></a>01353          <span class="keywordflow">if</span> (!strcasecmp(iks_find_attrib(traversenodes, <span class="stringliteral">&quot;type&quot;</span>), <span class="stringliteral">&quot;stun&quot;</span>))
<a name="l01354"></a>01354             newcandidate-&gt;<a class="code" href="structgtalk__candidate.html#a89b984ef49eae8ce966e6c5d9290d879">type</a> = <a class="code" href="chan__gtalk_8c.html#aabf7ea7d1c280c2d91d5ad67ea5ab883afa2cfdc5c71aec4bb0ec4849e3236142">AJI_CONNECT_STUN</a>;
<a name="l01355"></a>01355          <span class="keywordflow">if</span> (!strcasecmp(iks_find_attrib(traversenodes, <span class="stringliteral">&quot;type&quot;</span>), <span class="stringliteral">&quot;local&quot;</span>))
<a name="l01356"></a>01356             newcandidate-&gt;<a class="code" href="structgtalk__candidate.html#a89b984ef49eae8ce966e6c5d9290d879">type</a> = <a class="code" href="chan__gtalk_8c.html#aabf7ea7d1c280c2d91d5ad67ea5ab883a11e5bb1099f4e7c029d500bbc80ac483">AJI_CONNECT_LOCAL</a>;
<a name="l01357"></a>01357          <span class="keywordflow">if</span> (!strcasecmp(iks_find_attrib(traversenodes, <span class="stringliteral">&quot;type&quot;</span>), <span class="stringliteral">&quot;relay&quot;</span>))
<a name="l01358"></a>01358             newcandidate-&gt;<a class="code" href="structgtalk__candidate.html#a89b984ef49eae8ce966e6c5d9290d879">type</a> = <a class="code" href="chan__gtalk_8c.html#aabf7ea7d1c280c2d91d5ad67ea5ab883a2ef123abfa8253ea9f67f7750dbdc421">AJI_CONNECT_RELAY</a>;
<a name="l01359"></a>01359          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(newcandidate-&gt;<a class="code" href="structgtalk__candidate.html#a0c9a19e6be2d24eeabedf5b75d30903b">network</a>, iks_find_attrib(traversenodes, <span class="stringliteral">&quot;network&quot;</span>),
<a name="l01360"></a>01360                      <span class="keyword">sizeof</span>(newcandidate-&gt;<a class="code" href="structgtalk__candidate.html#a0c9a19e6be2d24eeabedf5b75d30903b">network</a>));
<a name="l01361"></a>01361          newcandidate-&gt;<a class="code" href="structgtalk__candidate.html#aad8eab95bc6ae0373f10cb2a0bdeb88c">generation</a> = atoi(iks_find_attrib(traversenodes, <span class="stringliteral">&quot;generation&quot;</span>));
<a name="l01362"></a>01362          newcandidate-&gt;<a class="code" href="structgtalk__candidate.html#a6f4a98673f70f06b746ef8e1c50c3ade">next</a> = NULL;
<a name="l01363"></a>01363       
<a name="l01364"></a>01364          newcandidate-&gt;<a class="code" href="structgtalk__candidate.html#a6f4a98673f70f06b746ef8e1c50c3ade">next</a> = p-&gt;<a class="code" href="structgtalk__pvt.html#ad255738c9c6ff7d58888b3b937d57bfd">theircandidates</a>;
<a name="l01365"></a>01365          p-&gt;<a class="code" href="structgtalk__pvt.html#ad255738c9c6ff7d58888b3b937d57bfd">theircandidates</a> = newcandidate;
<a name="l01366"></a>01366          p-&gt;<a class="code" href="structgtalk__pvt.html#afea13c69c31226a6607e67b85f0231e2">laststun</a> = 0;
<a name="l01367"></a>01367          <a class="code" href="chan__gtalk_8c.html#a4a9807802122430659202f6ce9663ead">gtalk_update_stun</a>(p-&gt;<a class="code" href="structgtalk__pvt.html#a06cbd7bfad0d73228cdd0dbb68fb999f">parent</a>, p);
<a name="l01368"></a>01368          newcandidate = NULL;
<a name="l01369"></a>01369       }
<a name="l01370"></a>01370       traversenodes = iks_next_tag(traversenodes);
<a name="l01371"></a>01371    }
<a name="l01372"></a>01372    
<a name="l01373"></a>01373    receipt = iks_new(<span class="stringliteral">&quot;iq&quot;</span>);
<a name="l01374"></a>01374    iks_insert_attrib(receipt, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;result&quot;</span>);
<a name="l01375"></a>01375    iks_insert_attrib(receipt, <span class="stringliteral">&quot;from&quot;</span>, from);
<a name="l01376"></a>01376    iks_insert_attrib(receipt, <span class="stringliteral">&quot;to&quot;</span>, iks_find_attrib(pak-&gt;x, <span class="stringliteral">&quot;from&quot;</span>));
<a name="l01377"></a>01377    iks_insert_attrib(receipt, <span class="stringliteral">&quot;id&quot;</span>, iks_find_attrib(pak-&gt;x, <span class="stringliteral">&quot;id&quot;</span>));
<a name="l01378"></a>01378    <a class="code" href="jabber_8h.html#a3c77ceecc909619207e971421fc3e9ef" title="Wraps raw sending.">ast_aji_send</a>(c, receipt);
<a name="l01379"></a>01379 
<a name="l01380"></a>01380    iks_delete(receipt);
<a name="l01381"></a>01381 
<a name="l01382"></a>01382    <span class="keywordflow">return</span> 1;
<a name="l01383"></a>01383 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa0e0e8c2e99606e052fcd142dcf580dd"></a><!-- doxytag: member="chan_gtalk.c::gtalk_alloc" ref="aa0e0e8c2e99606e052fcd142dcf580dd" args="(struct gtalk *client, const char *us, const char *them, const char *sid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structgtalk__pvt.html">gtalk_pvt</a> * gtalk_alloc </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structgtalk.html">gtalk</a> *&nbsp;</td>
          <td class="paramname"> <em>client</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>us</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>them</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>sid</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l00909">909</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01692">ast_mutex_init()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="utils_8c_source.html#l01401">ast_random()</a>, <a class="el" href="rtp_8c_source.html#l02533">ast_rtp_new_with_bindaddr()</a>, <a class="el" href="rtp_8c_source.html#l01995">ast_rtp_pt_clear()</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="astobj_8h_source.html#l00401">ASTOBJ_CONTAINER_FIND</a>, <a class="el" href="jabber_8h_source.html#l00172">aji_client::buddies</a>, <a class="el" href="chan__gtalk_8c_source.html#l00141">gtalk::buddy</a>, <a class="el" href="jabber_8h_source.html#l00111">aji_resource::cap</a>, <a class="el" href="chan__gtalk_8c_source.html#l00108">gtalk_pvt::capability</a>, <a class="el" href="chan__gtalk_8c_source.html#l00149">gtalk::capability</a>, <a class="el" href="chan__gtalk_8c_source.html#l00113">gtalk_pvt::cid_name</a>, <a class="el" href="chan__gtalk_8c_source.html#l00140">gtalk::connection</a>, <a class="el" href="chan__gtalk_8c_source.html#l00114">gtalk_pvt::exten</a>, <a class="el" href="chan__alsa_8c_source.html#l00107">exten</a>, <a class="el" href="chan__gtalk_8c_source.html#l00106">gtalk_pvt::initiator</a>, <a class="el" href="jabber_8h_source.html#l00096">aji_version::jingle</a>, <a class="el" href="chan__gtalk_8c_source.html#l00098">gtalk_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__gtalk_8c_source.html#l00120">gtalk_pvt::next</a>, <a class="el" href="jabber_8h_source.html#l00113">aji_resource::next</a>, <a class="el" href="chan__gtalk_8c_source.html#l00142">gtalk::p</a>, <a class="el" href="chan__gtalk_8c_source.html#l00100">gtalk_pvt::parent</a>, <a class="el" href="chan__gtalk_8c_source.html#l00143">gtalk::prefs</a>, <a class="el" href="chan__gtalk_8c_source.html#l00109">gtalk_pvt::prefs</a>, <a class="el" href="jabber_8h_source.html#l00109">aji_resource::resource</a>, <a class="el" href="jabber_8h_source.html#l00127">aji_buddy::resources</a>, <a class="el" href="chan__gtalk_8c_source.html#l00116">gtalk_pvt::rtp</a>, <a class="el" href="chan__gtalk_8c_source.html#l00101">gtalk_pvt::sid</a>, <a class="el" href="agi_2strcompat_8c_source.html#l00027">strsep()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00103">gtalk_pvt::them</a>, and <a class="el" href="chan__gtalk_8c_source.html#l00102">gtalk_pvt::us</a>.</p>

<p>Referenced by <a class="el" href="chan__gtalk_8c_source.html#l01154">gtalk_newcall()</a>, and <a class="el" href="chan__gtalk_8c_source.html#l01637">gtalk_request()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00910"></a>00910 {
<a name="l00911"></a>00911    <span class="keyword">struct </span><a class="code" href="structgtalk__pvt.html">gtalk_pvt</a> *tmp = NULL;
<a name="l00912"></a>00912    <span class="keyword">struct </span><a class="code" href="structaji__resource.html">aji_resource</a> *resources = NULL;
<a name="l00913"></a>00913    <span class="keyword">struct </span><a class="code" href="structaji__buddy.html">aji_buddy</a> *buddy;
<a name="l00914"></a>00914    <span class="keywordtype">char</span> idroster[200];
<a name="l00915"></a>00915    <span class="keywordtype">char</span> *data, *<a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a> = NULL;
<a name="l00916"></a>00916 
<a name="l00917"></a>00917    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;The client is %s for alloc\n&quot;</span>, client-&gt;name);
<a name="l00918"></a>00918    <span class="keywordflow">if</span> (!sid &amp;&amp; !strchr(them, <span class="charliteral">&apos;/&apos;</span>)) {   <span class="comment">/* I started call! */</span>
<a name="l00919"></a>00919       <span class="keywordflow">if</span> (!strcasecmp(client-&gt;name, <span class="stringliteral">&quot;guest&quot;</span>)) {
<a name="l00920"></a>00920          buddy = <a class="code" href="astobj_8h.html#aca5d7206cd0c6817140bba786a9b6b8a" title="Find an object in a container.">ASTOBJ_CONTAINER_FIND</a>(&amp;client-&gt;<a class="code" href="structgtalk.html#a22eb965539587ef7d2b0340d57159e3a">connection</a>-&gt;<a class="code" href="structaji__client.html#acb477f162f95d7daa23c110e9ce62b60">buddies</a>, them);
<a name="l00921"></a>00921          <span class="keywordflow">if</span> (buddy)
<a name="l00922"></a>00922             resources = buddy-&gt;<a class="code" href="structaji__buddy.html#aae15cbeb57008429de5584b554e98940">resources</a>;
<a name="l00923"></a>00923       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (client-&gt;<a class="code" href="structgtalk.html#a2704a75322ea2a93cfbfd9ba4d08dad6">buddy</a>)
<a name="l00924"></a>00924          resources = client-&gt;<a class="code" href="structgtalk.html#a2704a75322ea2a93cfbfd9ba4d08dad6">buddy</a>-&gt;<a class="code" href="structaji__buddy.html#aae15cbeb57008429de5584b554e98940">resources</a>;
<a name="l00925"></a>00925       <span class="keywordflow">while</span> (resources) {
<a name="l00926"></a>00926          <span class="keywordflow">if</span> (resources-&gt;<a class="code" href="structaji__resource.html#a3a3d467a2f83feeb330fabb44031c72f">cap</a>-&gt;<a class="code" href="structaji__version.html#a221bb2c9b97010417157c4ac47625367">jingle</a>) {
<a name="l00927"></a>00927             <span class="keywordflow">break</span>;
<a name="l00928"></a>00928          }
<a name="l00929"></a>00929          resources = resources-&gt;<a class="code" href="structaji__resource.html#a96df1b44c7b5636af9508acea4f6120b">next</a>;
<a name="l00930"></a>00930       }
<a name="l00931"></a>00931       <span class="keywordflow">if</span> (resources)
<a name="l00932"></a>00932          snprintf(idroster, <span class="keyword">sizeof</span>(idroster), <span class="stringliteral">&quot;%s/%s&quot;</span>, them, resources-&gt;<a class="code" href="structaji__resource.html#a1242b14224ca75fd8d9ecd5514880049">resource</a>);
<a name="l00933"></a>00933       <span class="keywordflow">else</span> {
<a name="l00934"></a>00934          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;no gtalk capable clients to talk to.\n&quot;</span>);
<a name="l00935"></a>00935          <span class="keywordflow">return</span> NULL;
<a name="l00936"></a>00936       }
<a name="l00937"></a>00937    }
<a name="l00938"></a>00938    <span class="keywordflow">if</span> (!(tmp = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*tmp)))) {
<a name="l00939"></a>00939       <span class="keywordflow">return</span> NULL;
<a name="l00940"></a>00940    }
<a name="l00941"></a>00941 
<a name="l00942"></a>00942    memcpy(&amp;tmp-&gt;<a class="code" href="structgtalk__pvt.html#a46262e3cc2baf55a72542567ccfe86d9">prefs</a>, &amp;client-&gt;<a class="code" href="structgtalk.html#a46262e3cc2baf55a72542567ccfe86d9">prefs</a>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structast__codec__pref.html">ast_codec_pref</a>));
<a name="l00943"></a>00943 
<a name="l00944"></a>00944    <span class="keywordflow">if</span> (sid) {
<a name="l00945"></a>00945       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmp-&gt;<a class="code" href="structgtalk__pvt.html#a11855a8fa7877d4395e800ce1bb3ed8d">sid</a>, sid, <span class="keyword">sizeof</span>(tmp-&gt;<a class="code" href="structgtalk__pvt.html#a11855a8fa7877d4395e800ce1bb3ed8d">sid</a>));
<a name="l00946"></a>00946       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmp-&gt;<a class="code" href="structgtalk__pvt.html#a7c3b41a9f87238ef5a35607e6655f02e">them</a>, them, <span class="keyword">sizeof</span>(tmp-&gt;<a class="code" href="structgtalk__pvt.html#a7c3b41a9f87238ef5a35607e6655f02e">them</a>));
<a name="l00947"></a>00947       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmp-&gt;<a class="code" href="structgtalk__pvt.html#a81eba36a21e03789e7d728d4bebd61d3">us</a>, us, <span class="keyword">sizeof</span>(tmp-&gt;<a class="code" href="structgtalk__pvt.html#a81eba36a21e03789e7d728d4bebd61d3">us</a>));
<a name="l00948"></a>00948    } <span class="keywordflow">else</span> {
<a name="l00949"></a>00949       snprintf(tmp-&gt;<a class="code" href="structgtalk__pvt.html#a11855a8fa7877d4395e800ce1bb3ed8d">sid</a>, <span class="keyword">sizeof</span>(tmp-&gt;<a class="code" href="structgtalk__pvt.html#a11855a8fa7877d4395e800ce1bb3ed8d">sid</a>), <span class="stringliteral">&quot;%08lx%08lx&quot;</span>, <a class="code" href="utils_8h.html#a7b4f10b070e95ba413e258a3e4b03c20">ast_random</a>(), <a class="code" href="utils_8h.html#a7b4f10b070e95ba413e258a3e4b03c20">ast_random</a>());
<a name="l00950"></a>00950       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmp-&gt;<a class="code" href="structgtalk__pvt.html#a7c3b41a9f87238ef5a35607e6655f02e">them</a>, idroster, <span class="keyword">sizeof</span>(tmp-&gt;<a class="code" href="structgtalk__pvt.html#a7c3b41a9f87238ef5a35607e6655f02e">them</a>));
<a name="l00951"></a>00951       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmp-&gt;<a class="code" href="structgtalk__pvt.html#a81eba36a21e03789e7d728d4bebd61d3">us</a>, us, <span class="keyword">sizeof</span>(tmp-&gt;<a class="code" href="structgtalk__pvt.html#a81eba36a21e03789e7d728d4bebd61d3">us</a>));
<a name="l00952"></a>00952       tmp-&gt;<a class="code" href="structgtalk__pvt.html#ad65c66f9895c8d58b388365ac363e91c">initiator</a> = 1;
<a name="l00953"></a>00953    }
<a name="l00954"></a>00954    <span class="comment">/* clear codecs */</span>
<a name="l00955"></a>00955    tmp-&gt;<a class="code" href="structgtalk__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a> = <a class="code" href="rtp_8h.html#a10d5296cd50be78954103b0a0c754640" title="Initializate a RTP session using an in_addr structure.">ast_rtp_new_with_bindaddr</a>(<a class="code" href="structsched.html">sched</a>, <a class="code" href="chan__gtalk_8c.html#abda48311b6abe5a4dd8b6904ddde0a6d">io</a>, 1, 0, <a class="code" href="chan__gtalk_8c.html#a4ec29229510a2e3ea6ce34d520f06e90">bindaddr</a>.sin_addr);
<a name="l00956"></a>00956    <a class="code" href="rtp_8h.html#ac008cc5d5e4b915062b98ff2f202cc38" title="Setting RTP payload types from lines in a SDP description:.">ast_rtp_pt_clear</a>(tmp-&gt;<a class="code" href="structgtalk__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>);
<a name="l00957"></a>00957 
<a name="l00958"></a>00958    <span class="comment">/* add user configured codec capabilites */</span>
<a name="l00959"></a>00959    <span class="keywordflow">if</span> (client-&gt;<a class="code" href="structgtalk.html#afa05b14ff7f76f303c784c00c4c63fa7">capability</a>)
<a name="l00960"></a>00960       tmp-&gt;<a class="code" href="structgtalk__pvt.html#afa05b14ff7f76f303c784c00c4c63fa7">capability</a> = client-&gt;<a class="code" href="structgtalk.html#afa05b14ff7f76f303c784c00c4c63fa7">capability</a>;
<a name="l00961"></a>00961    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="chan__gtalk_8c.html#a10fc9006937dcda26877acc36353aad4">global_capability</a>)
<a name="l00962"></a>00962       tmp-&gt;<a class="code" href="structgtalk__pvt.html#afa05b14ff7f76f303c784c00c4c63fa7">capability</a> = <a class="code" href="chan__gtalk_8c.html#a10fc9006937dcda26877acc36353aad4">global_capability</a>;
<a name="l00963"></a>00963 
<a name="l00964"></a>00964    tmp-&gt;<a class="code" href="structgtalk__pvt.html#a06cbd7bfad0d73228cdd0dbb68fb999f">parent</a> = client;
<a name="l00965"></a>00965    <span class="keywordflow">if</span> (!tmp-&gt;<a class="code" href="structgtalk__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>) {
<a name="l00966"></a>00966       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Out of RTP sessions?\n&quot;</span>);
<a name="l00967"></a>00967       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(tmp);
<a name="l00968"></a>00968       <span class="keywordflow">return</span> NULL;
<a name="l00969"></a>00969    }
<a name="l00970"></a>00970 
<a name="l00971"></a>00971    <span class="comment">/* Set CALLERID(name) to the full JID of the remote peer */</span>
<a name="l00972"></a>00972    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmp-&gt;<a class="code" href="structgtalk__pvt.html#abeca50433a6b06e370cf0aacb8af5444">cid_name</a>, tmp-&gt;<a class="code" href="structgtalk__pvt.html#a7c3b41a9f87238ef5a35607e6655f02e">them</a>, <span class="keyword">sizeof</span>(tmp-&gt;<a class="code" href="structgtalk__pvt.html#abeca50433a6b06e370cf0aacb8af5444">cid_name</a>));
<a name="l00973"></a>00973 
<a name="l00974"></a>00974    <span class="keywordflow">if</span>(strchr(tmp-&gt;<a class="code" href="structgtalk__pvt.html#a81eba36a21e03789e7d728d4bebd61d3">us</a>, <span class="charliteral">&apos;/&apos;</span>)) {
<a name="l00975"></a>00975       data = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(tmp-&gt;<a class="code" href="structgtalk__pvt.html#a81eba36a21e03789e7d728d4bebd61d3">us</a>);
<a name="l00976"></a>00976       exten = <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;data, <span class="stringliteral">&quot;/&quot;</span>);
<a name="l00977"></a>00977    } <span class="keywordflow">else</span>
<a name="l00978"></a>00978       exten = tmp-&gt;<a class="code" href="structgtalk__pvt.html#a81eba36a21e03789e7d728d4bebd61d3">us</a>;
<a name="l00979"></a>00979    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmp-&gt;<a class="code" href="structgtalk__pvt.html#a1a25ab316fdbfb7a045251cf4d1f9b0f">exten</a>,  exten, <span class="keyword">sizeof</span>(tmp-&gt;<a class="code" href="structgtalk__pvt.html#a1a25ab316fdbfb7a045251cf4d1f9b0f">exten</a>));
<a name="l00980"></a>00980    <a class="code" href="lock_8h.html#a5dc895fe6e8c089175159fc22e33fc3b">ast_mutex_init</a>(&amp;tmp-&gt;<a class="code" href="structgtalk__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00981"></a>00981    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;gtalklock);
<a name="l00982"></a>00982    tmp-&gt;<a class="code" href="structgtalk__pvt.html#ad52b2b57b8b3ac8cab36317c65547157">next</a> = client-&gt;<a class="code" href="structgtalk.html#a87c10b8b2ce58b28854a6cf5a7462bbd">p</a>;
<a name="l00983"></a>00983    client-&gt;<a class="code" href="structgtalk.html#a87c10b8b2ce58b28854a6cf5a7462bbd">p</a> = tmp;
<a name="l00984"></a>00984    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;gtalklock);
<a name="l00985"></a>00985    <span class="keywordflow">return</span> tmp;
<a name="l00986"></a>00986 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab4016a88f2a6fbc6750653491dc8d8be"></a><!-- doxytag: member="chan_gtalk.c::gtalk_answer" ref="ab4016a88f2a6fbc6750653491dc8d8be" args="(struct ast_channel *ast)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int gtalk_answer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>ast</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l00513">513</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="manager_8h_source.html#l00061">EVENT_FLAG_SYSTEM</a>, <a class="el" href="chan__gtalk_8c_source.html#l00379">gtalk_invite()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00098">gtalk_pvt::lock</a>, <a class="el" href="manager_8h_source.html#l00181">manager_event</a>, <a class="el" href="chan__gtalk_8c_source.html#l00101">gtalk_pvt::sid</a>, <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>, <a class="el" href="chan__gtalk_8c_source.html#l00103">gtalk_pvt::them</a>, and <a class="el" href="chan__gtalk_8c_source.html#l00102">gtalk_pvt::us</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00514"></a>00514 {
<a name="l00515"></a>00515    <span class="keyword">struct </span><a class="code" href="structgtalk__pvt.html">gtalk_pvt</a> *p = ast-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l00516"></a>00516    <span class="keywordtype">int</span> res = 0;
<a name="l00517"></a>00517    
<a name="l00518"></a>00518    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Answer!\n&quot;</span>);
<a name="l00519"></a>00519    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;p-&gt;<a class="code" href="structgtalk__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00520"></a>00520    <a class="code" href="chan__gtalk_8c.html#adbb80c94f25deee90406ec8e4b207db9">gtalk_invite</a>(p, p-&gt;<a class="code" href="structgtalk__pvt.html#a7c3b41a9f87238ef5a35607e6655f02e">them</a>, p-&gt;<a class="code" href="structgtalk__pvt.html#a81eba36a21e03789e7d728d4bebd61d3">us</a>,p-&gt;<a class="code" href="structgtalk__pvt.html#a11855a8fa7877d4395e800ce1bb3ed8d">sid</a>, 0);
<a name="l00521"></a>00521    <a class="code" href="manager_8h.html#a1ef0ee0044dbbeb4c3a5abc6c046b208" title="External routines may send asterisk manager events this way.">manager_event</a>(<a class="code" href="manager_8h.html#a420f0f755e1c3378b45ca7f6f0669ffa">EVENT_FLAG_SYSTEM</a>, <span class="stringliteral">&quot;ChannelUpdate&quot;</span>, <span class="stringliteral">&quot;Channel: %s\r\nChanneltype: %s\r\nGtalk-SID: %s\r\n&quot;</span>,
<a name="l00522"></a>00522       ast-&gt;name, <span class="stringliteral">&quot;GTALK&quot;</span>, p-&gt;<a class="code" href="structgtalk__pvt.html#a11855a8fa7877d4395e800ce1bb3ed8d">sid</a>);
<a name="l00523"></a>00523    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structgtalk__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00524"></a>00524    <span class="keywordflow">return</span> res;
<a name="l00525"></a>00525 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6267c8db91fb20894c6e17763febac14"></a><!-- doxytag: member="chan_gtalk.c::gtalk_call" ref="a6267c8db91fb20894c6e17763febac14" args="(struct ast_channel *ast, char *dest, int timeout)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int gtalk_call </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>ast</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>timeout</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initiate new call, part of PBX interface dest is the dial string. </p>

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l01593">1593</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00469">ast_channel::_state</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8c_source.html#l04695">ast_setstate()</a>, <a class="el" href="channel_8h_source.html#l00359">AST_STATE_DOWN</a>, <a class="el" href="channel_8h_source.html#l00360">AST_STATE_RESERVED</a>, <a class="el" href="channel_8h_source.html#l00363">AST_STATE_RING</a>, <a class="el" href="chan__gtalk_8c_source.html#l00140">gtalk::connection</a>, <a class="el" href="jabber_8h_source.html#l00151">aji_client::f</a>, <a class="el" href="chan__gtalk_8c_source.html#l00773">gtalk_create_candidates()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00379">gtalk_invite()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00501">gtalk_ringing_ack()</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="jabber_8h_source.html#l00148">aji_client::mid</a>, <a class="el" href="chan__gtalk_8c_source.html#l00100">gtalk_pvt::parent</a>, <a class="el" href="chan__gtalk_8c_source.html#l00104">gtalk_pvt::ring</a>, <a class="el" href="chan__gtalk_8c_source.html#l00105">gtalk_pvt::ringrule</a>, <a class="el" href="chan__gtalk_8c_source.html#l00101">gtalk_pvt::sid</a>, <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>, <a class="el" href="chan__gtalk_8c_source.html#l00103">gtalk_pvt::them</a>, and <a class="el" href="chan__gtalk_8c_source.html#l00102">gtalk_pvt::us</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01594"></a>01594 {
<a name="l01595"></a>01595    <span class="keyword">struct </span><a class="code" href="structgtalk__pvt.html">gtalk_pvt</a> *p = ast-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l01596"></a>01596 
<a name="l01597"></a>01597    <span class="keywordflow">if</span> ((ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a>) &amp;&amp; (ast-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660addb60fd97b55a4aea24f992e30fe3c84">AST_STATE_RESERVED</a>)) {
<a name="l01598"></a>01598       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;gtalk_call called on %s, neither down nor reserved\n&quot;</span>, ast-&gt;name);
<a name="l01599"></a>01599       <span class="keywordflow">return</span> -1;
<a name="l01600"></a>01600    }
<a name="l01601"></a>01601 
<a name="l01602"></a>01602    <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(ast, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a>);
<a name="l01603"></a>01603    <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="structgtalk__pvt.html#a48b56664545a8ea58b25639b74f863b5">ringrule</a>) {
<a name="l01604"></a>01604       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(p-&gt;<a class="code" href="structgtalk__pvt.html#a4b47cdfa1ed7bb8a6323cdf070e50c97">ring</a>, p-&gt;<a class="code" href="structgtalk__pvt.html#a06cbd7bfad0d73228cdd0dbb68fb999f">parent</a>-&gt;<a class="code" href="structgtalk.html#a22eb965539587ef7d2b0340d57159e3a">connection</a>-&gt;<a class="code" href="structaji__client.html#abee5661fa88af477fe47bbbd21136301">mid</a>, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structgtalk__pvt.html#a4b47cdfa1ed7bb8a6323cdf070e50c97">ring</a>));
<a name="l01605"></a>01605       p-&gt;<a class="code" href="structgtalk__pvt.html#a48b56664545a8ea58b25639b74f863b5">ringrule</a> = iks_filter_add_rule(p-&gt;<a class="code" href="structgtalk__pvt.html#a06cbd7bfad0d73228cdd0dbb68fb999f">parent</a>-&gt;<a class="code" href="structgtalk.html#a22eb965539587ef7d2b0340d57159e3a">connection</a>-&gt;<a class="code" href="structaji__client.html#afc6fdfd9b3ea85d062020bb1aea416b3">f</a>, <a class="code" href="chan__gtalk_8c.html#a04f7e90ada5bf53d2d7d02e9dd4ad66c">gtalk_ringing_ack</a>, p,
<a name="l01606"></a>01606                      IKS_RULE_ID, p-&gt;<a class="code" href="structgtalk__pvt.html#a4b47cdfa1ed7bb8a6323cdf070e50c97">ring</a>, IKS_RULE_DONE);
<a name="l01607"></a>01607    } <span class="keywordflow">else</span>
<a name="l01608"></a>01608       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Whoa, already have a ring rule!\n&quot;</span>);
<a name="l01609"></a>01609 
<a name="l01610"></a>01610    <a class="code" href="chan__gtalk_8c.html#adbb80c94f25deee90406ec8e4b207db9">gtalk_invite</a>(p, p-&gt;<a class="code" href="structgtalk__pvt.html#a7c3b41a9f87238ef5a35607e6655f02e">them</a>, p-&gt;<a class="code" href="structgtalk__pvt.html#a81eba36a21e03789e7d728d4bebd61d3">us</a>, p-&gt;<a class="code" href="structgtalk__pvt.html#a11855a8fa7877d4395e800ce1bb3ed8d">sid</a>, 1);
<a name="l01611"></a>01611    <a class="code" href="chan__gtalk_8c.html#aefe1cdecffa94036ff8745b95267e70c">gtalk_create_candidates</a>(p-&gt;<a class="code" href="structgtalk__pvt.html#a06cbd7bfad0d73228cdd0dbb68fb999f">parent</a>, p, p-&gt;<a class="code" href="structgtalk__pvt.html#a11855a8fa7877d4395e800ce1bb3ed8d">sid</a>, p-&gt;<a class="code" href="structgtalk__pvt.html#a7c3b41a9f87238ef5a35607e6655f02e">them</a>, p-&gt;<a class="code" href="structgtalk__pvt.html#a81eba36a21e03789e7d728d4bebd61d3">us</a>);
<a name="l01612"></a>01612 
<a name="l01613"></a>01613    <span class="keywordflow">return</span> 0;
<a name="l01614"></a>01614 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aefe1cdecffa94036ff8745b95267e70c"></a><!-- doxytag: member="chan_gtalk.c::gtalk_create_candidates" ref="aefe1cdecffa94036ff8745b95267e70c" args="(struct gtalk *client, struct gtalk_pvt *p, char *sid, char *from, char *to)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int gtalk_create_candidates </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structgtalk.html">gtalk</a> *&nbsp;</td>
          <td class="paramname"> <em>client</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structgtalk__pvt.html">gtalk_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>sid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>from</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>to</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l00773">773</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="chan__gtalk_8c_source.html#l00218">__ourip</a>, <a class="el" href="chan__gtalk_8c_source.html#l00093">AJI_CONNECT_LOCAL</a>, <a class="el" href="chan__gtalk_8c_source.html#l00094">AJI_CONNECT_RELAY</a>, <a class="el" href="chan__gtalk_8c_source.html#l00092">AJI_CONNECT_STUN</a>, <a class="el" href="chan__gtalk_8c_source.html#l00088">AJI_PROTOCOL_SSLTCP</a>, <a class="el" href="chan__gtalk_8c_source.html#l00087">AJI_PROTOCOL_UDP</a>, <a class="el" href="res__jabber_8c_source.html#l02038">ast_aji_increment_mid()</a>, <a class="el" href="res__jabber_8c_source.html#l00818">ast_aji_send()</a>, <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="acl_8c_source.html#l00511">ast_find_ourip()</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="utils_8c_source.html#l00431">ast_inet_ntoa()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="utils_8c_source.html#l01401">ast_random()</a>, <a class="el" href="rtp_8c_source.html#l02694">ast_rtp_get_us()</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00140">gtalk::connection</a>, <a class="el" href="chan__gtalk_8c_source.html#l00131">gtalk_candidate::generation</a>, <a class="el" href="chan__gtalk_8c_source.html#l00072">GOOGLE_NS</a>, <a class="el" href="chan__gtalk_8c_source.html#l00106">gtalk_pvt::initiator</a>, <a class="el" href="chan__gtalk_8c_source.html#l00132">gtalk_candidate::ip</a>, <a class="el" href="chan__gtalk_8c_source.html#l00099">gtalk_pvt::laststun</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="jabber_8h_source.html#l00148">aji_client::mid</a>, <a class="el" href="chan__gtalk_8c_source.html#l00124">gtalk_candidate::name</a>, <a class="el" href="chan__gtalk_8c_source.html#l00135">gtalk_candidate::next</a>, <a class="el" href="chan__gtalk_8c_source.html#l00120">gtalk_pvt::next</a>, <a class="el" href="chan__gtalk_8c_source.html#l00111">gtalk_pvt::ourcandidates</a>, <a class="el" href="res__config__ldap_8c_source.html#l00069">pass</a>, <a class="el" href="chan__gtalk_8c_source.html#l00128">gtalk_candidate::password</a>, <a class="el" href="chan__gtalk_8c_source.html#l00133">gtalk_candidate::port</a>, <a class="el" href="chan__gtalk_8c_source.html#l00126">gtalk_candidate::preference</a>, <a class="el" href="chan__gtalk_8c_source.html#l00125">gtalk_candidate::protocol</a>, <a class="el" href="chan__gtalk_8c_source.html#l00116">gtalk_pvt::rtp</a>, <a class="el" href="chan__gtalk_8c_source.html#l00101">gtalk_pvt::sid</a>, <a class="el" href="chan__gtalk_8c_source.html#l00129">gtalk_candidate::type</a>, and <a class="el" href="chan__gtalk_8c_source.html#l00127">gtalk_candidate::username</a>.</p>

<p>Referenced by <a class="el" href="chan__gtalk_8c_source.html#l01593">gtalk_call()</a>, and <a class="el" href="chan__gtalk_8c_source.html#l01154">gtalk_newcall()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00774"></a>00774 {
<a name="l00775"></a>00775    <span class="keyword">struct </span><a class="code" href="structgtalk__candidate.html">gtalk_candidate</a> *tmp;
<a name="l00776"></a>00776    <span class="keyword">struct </span><a class="code" href="structaji__client.html">aji_client</a> *c = client-&gt;<a class="code" href="structgtalk.html#a22eb965539587ef7d2b0340d57159e3a">connection</a>;
<a name="l00777"></a>00777    <span class="keyword">struct </span><a class="code" href="structgtalk__candidate.html">gtalk_candidate</a> *ours1 = NULL, *ours2 = NULL;
<a name="l00778"></a>00778    <span class="keyword">struct </span>sockaddr_in sin;
<a name="l00779"></a>00779    <span class="keyword">struct </span>sockaddr_in dest;
<a name="l00780"></a>00780    <span class="keyword">struct </span>in_addr us;
<a name="l00781"></a>00781    iks *iq, *<a class="code" href="structgtalk.html">gtalk</a>, *candidate, *transport;
<a name="l00782"></a>00782    <span class="keywordtype">char</span> <a class="code" href="structuser.html" title="structure to hold users read from users.conf">user</a>[17], <a class="code" href="res__config__ldap_8c.html#a68433c52f2199bd92a3c151b295de06e">pass</a>[17], preference[5], port[7];
<a name="l00783"></a>00783    <span class="keywordtype">char</span> *lowerfrom = NULL;
<a name="l00784"></a>00784 
<a name="l00785"></a>00785 
<a name="l00786"></a>00786    iq = iks_new(<span class="stringliteral">&quot;iq&quot;</span>);
<a name="l00787"></a>00787    gtalk = iks_new(<span class="stringliteral">&quot;session&quot;</span>);
<a name="l00788"></a>00788    candidate = iks_new(<span class="stringliteral">&quot;candidate&quot;</span>);
<a name="l00789"></a>00789    transport = iks_new(<span class="stringliteral">&quot;transport&quot;</span>);
<a name="l00790"></a>00790    <span class="keywordflow">if</span> (!iq || !gtalk || !candidate || !transport) {
<a name="l00791"></a>00791       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Memory allocation error\n&quot;</span>);
<a name="l00792"></a>00792       <span class="keywordflow">goto</span> safeout;
<a name="l00793"></a>00793    }
<a name="l00794"></a>00794    ours1 = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*ours1));
<a name="l00795"></a>00795    ours2 = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*ours2));
<a name="l00796"></a>00796    <span class="keywordflow">if</span> (!ours1 || !ours2)
<a name="l00797"></a>00797       <span class="keywordflow">goto</span> safeout;
<a name="l00798"></a>00798 
<a name="l00799"></a>00799    iks_insert_attrib(transport, <span class="stringliteral">&quot;xmlns&quot;</span>,<span class="stringliteral">&quot;http://www.google.com/transport/p2p&quot;</span>);
<a name="l00800"></a>00800    iks_insert_node(iq, gtalk);
<a name="l00801"></a>00801    iks_insert_node(gtalk,transport);
<a name="l00802"></a>00802    iks_insert_node(transport, candidate);
<a name="l00803"></a>00803 
<a name="l00804"></a>00804    <span class="keywordflow">for</span> (; p; p = p-&gt;<a class="code" href="structgtalk__pvt.html#ad52b2b57b8b3ac8cab36317c65547157">next</a>) {
<a name="l00805"></a>00805       <span class="keywordflow">if</span> (!strcasecmp(p-&gt;<a class="code" href="structgtalk__pvt.html#a11855a8fa7877d4395e800ce1bb3ed8d">sid</a>, sid))
<a name="l00806"></a>00806          <span class="keywordflow">break</span>;
<a name="l00807"></a>00807    }
<a name="l00808"></a>00808 
<a name="l00809"></a>00809    <span class="keywordflow">if</span> (!p) {
<a name="l00810"></a>00810       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;No matching gtalk session - SID %s!\n&quot;</span>, sid);
<a name="l00811"></a>00811       <span class="keywordflow">goto</span> safeout;
<a name="l00812"></a>00812    }
<a name="l00813"></a>00813 
<a name="l00814"></a>00814    <a class="code" href="rtp_8h.html#a307269685e6f067a6abe35a184c3bae6">ast_rtp_get_us</a>(p-&gt;<a class="code" href="structgtalk__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>, &amp;sin);
<a name="l00815"></a>00815    <a class="code" href="acl_8h.html#a4fbb9258573d41461c7389afbcbba377">ast_find_ourip</a>(&amp;us, <a class="code" href="chan__gtalk_8c.html#a4ec29229510a2e3ea6ce34d520f06e90">bindaddr</a>);
<a name="l00816"></a>00816    <span class="keywordflow">if</span> (!strcmp(<a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(us), <span class="stringliteral">&quot;127.0.0.1&quot;</span>)) {
<a name="l00817"></a>00817       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Found a loopback IP on the system, check your network configuration or set the bindaddr attribute.&quot;</span>);
<a name="l00818"></a>00818    }
<a name="l00819"></a>00819 
<a name="l00820"></a>00820    <span class="comment">/* Setup our gtalk candidates */</span>
<a name="l00821"></a>00821    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(ours1-&gt;<a class="code" href="structgtalk__candidate.html#aeaf846aa21a7d016a52f0b5b0c2f5544">name</a>, <span class="stringliteral">&quot;rtp&quot;</span>, <span class="keyword">sizeof</span>(ours1-&gt;<a class="code" href="structgtalk__candidate.html#aeaf846aa21a7d016a52f0b5b0c2f5544">name</a>));
<a name="l00822"></a>00822    ours1-&gt;<a class="code" href="structgtalk__candidate.html#a63c89c04d1feae07ca35558055155ffb">port</a> = ntohs(sin.sin_port);
<a name="l00823"></a>00823    ours1-&gt;<a class="code" href="structgtalk__candidate.html#aec15fa312e7877a8b26f9672d5da32b1">preference</a> = 1;
<a name="l00824"></a>00824    snprintf(user, <span class="keyword">sizeof</span>(user), <span class="stringliteral">&quot;%08lx%08lx&quot;</span>, <a class="code" href="utils_8h.html#a7b4f10b070e95ba413e258a3e4b03c20">ast_random</a>(), <a class="code" href="utils_8h.html#a7b4f10b070e95ba413e258a3e4b03c20">ast_random</a>());
<a name="l00825"></a>00825    snprintf(pass, <span class="keyword">sizeof</span>(pass), <span class="stringliteral">&quot;%08lx%08lx&quot;</span>, <a class="code" href="utils_8h.html#a7b4f10b070e95ba413e258a3e4b03c20">ast_random</a>(), <a class="code" href="utils_8h.html#a7b4f10b070e95ba413e258a3e4b03c20">ast_random</a>());
<a name="l00826"></a>00826    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(ours1-&gt;<a class="code" href="structgtalk__candidate.html#a05eeba7fa0e9f1c4fcb8110937b46236">username</a>, user, <span class="keyword">sizeof</span>(ours1-&gt;<a class="code" href="structgtalk__candidate.html#a05eeba7fa0e9f1c4fcb8110937b46236">username</a>));
<a name="l00827"></a>00827    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(ours1-&gt;<a class="code" href="structgtalk__candidate.html#a20218b63ca6f0a6ce74d704d915cb90a">password</a>, pass, <span class="keyword">sizeof</span>(ours1-&gt;<a class="code" href="structgtalk__candidate.html#a20218b63ca6f0a6ce74d704d915cb90a">password</a>));
<a name="l00828"></a>00828    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(ours1-&gt;<a class="code" href="structgtalk__candidate.html#ac03ec605186c0c6d17c4beaab73d615c">ip</a>, <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(us), <span class="keyword">sizeof</span>(ours1-&gt;<a class="code" href="structgtalk__candidate.html#ac03ec605186c0c6d17c4beaab73d615c">ip</a>));
<a name="l00829"></a>00829    ours1-&gt;<a class="code" href="structgtalk__candidate.html#a97af5ab5463f8cc8bde8c7727d79c870">protocol</a> = <a class="code" href="chan__gtalk_8c.html#a4735ec2011c291c5213a858fe007c851ac913daa556e052c68933b9c428707ee3">AJI_PROTOCOL_UDP</a>;
<a name="l00830"></a>00830    ours1-&gt;<a class="code" href="structgtalk__candidate.html#a89b984ef49eae8ce966e6c5d9290d879">type</a> = <a class="code" href="chan__gtalk_8c.html#aabf7ea7d1c280c2d91d5ad67ea5ab883a11e5bb1099f4e7c029d500bbc80ac483">AJI_CONNECT_LOCAL</a>;
<a name="l00831"></a>00831    ours1-&gt;<a class="code" href="structgtalk__candidate.html#aad8eab95bc6ae0373f10cb2a0bdeb88c">generation</a> = 0;
<a name="l00832"></a>00832    p-&gt;<a class="code" href="structgtalk__pvt.html#a389400de584309e3ed17fa62c709555f">ourcandidates</a> = ours1;
<a name="l00833"></a>00833 
<a name="l00834"></a>00834    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="chan__gtalk_8c.html#a651c2e6c15fed139c3dd5bf54ab01ff2">externip</a>)) {
<a name="l00835"></a>00835       <span class="comment">/* XXX We should really stun for this one not just go with externip XXX */</span>
<a name="l00836"></a>00836       snprintf(user, <span class="keyword">sizeof</span>(user), <span class="stringliteral">&quot;%08lx%08lx&quot;</span>, <a class="code" href="utils_8h.html#a7b4f10b070e95ba413e258a3e4b03c20">ast_random</a>(), <a class="code" href="utils_8h.html#a7b4f10b070e95ba413e258a3e4b03c20">ast_random</a>());
<a name="l00837"></a>00837       snprintf(pass, <span class="keyword">sizeof</span>(pass), <span class="stringliteral">&quot;%08lx%08lx&quot;</span>, <a class="code" href="utils_8h.html#a7b4f10b070e95ba413e258a3e4b03c20">ast_random</a>(), <a class="code" href="utils_8h.html#a7b4f10b070e95ba413e258a3e4b03c20">ast_random</a>());
<a name="l00838"></a>00838       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(ours2-&gt;username, user, <span class="keyword">sizeof</span>(ours2-&gt;username));
<a name="l00839"></a>00839       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(ours2-&gt;password, pass, <span class="keyword">sizeof</span>(ours2-&gt;password));
<a name="l00840"></a>00840       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(ours2-&gt;ip, <a class="code" href="chan__gtalk_8c.html#a651c2e6c15fed139c3dd5bf54ab01ff2">externip</a>, <span class="keyword">sizeof</span>(ours2-&gt;ip));
<a name="l00841"></a>00841       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(ours2-&gt;name, <span class="stringliteral">&quot;rtp&quot;</span>, <span class="keyword">sizeof</span>(ours1-&gt;<a class="code" href="structgtalk__candidate.html#aeaf846aa21a7d016a52f0b5b0c2f5544">name</a>));
<a name="l00842"></a>00842       ours2-&gt;port = ntohs(sin.sin_port);
<a name="l00843"></a>00843       ours2-&gt;preference = 0.9;
<a name="l00844"></a>00844       ours2-&gt;protocol = <a class="code" href="chan__gtalk_8c.html#a4735ec2011c291c5213a858fe007c851ac913daa556e052c68933b9c428707ee3">AJI_PROTOCOL_UDP</a>;
<a name="l00845"></a>00845       ours2-&gt;type = <a class="code" href="chan__gtalk_8c.html#aabf7ea7d1c280c2d91d5ad67ea5ab883afa2cfdc5c71aec4bb0ec4849e3236142">AJI_CONNECT_STUN</a>;
<a name="l00846"></a>00846       ours2-&gt;generation = 0;
<a name="l00847"></a>00847       ours1-&gt;<a class="code" href="structgtalk__candidate.html#a6f4a98673f70f06b746ef8e1c50c3ade">next</a> = ours2;
<a name="l00848"></a>00848       ours2 = NULL;
<a name="l00849"></a>00849    }
<a name="l00850"></a>00850    ours1 = NULL;
<a name="l00851"></a>00851    dest.sin_addr = <a class="code" href="chan__gtalk_8c.html#a1d084b82cb21102ba46ea60d3cd9c085">__ourip</a>;
<a name="l00852"></a>00852    dest.sin_port = sin.sin_port;
<a name="l00853"></a>00853 
<a name="l00854"></a>00854 
<a name="l00855"></a>00855    <span class="keywordflow">for</span> (tmp = p-&gt;<a class="code" href="structgtalk__pvt.html#a389400de584309e3ed17fa62c709555f">ourcandidates</a>; tmp; tmp = tmp-&gt;<a class="code" href="structgtalk__candidate.html#a6f4a98673f70f06b746ef8e1c50c3ade">next</a>) {
<a name="l00856"></a>00856       snprintf(port, <span class="keyword">sizeof</span>(port), <span class="stringliteral">&quot;%d&quot;</span>, tmp-&gt;<a class="code" href="structgtalk__candidate.html#a63c89c04d1feae07ca35558055155ffb">port</a>);
<a name="l00857"></a>00857       snprintf(preference, <span class="keyword">sizeof</span>(preference), <span class="stringliteral">&quot;%.2f&quot;</span>, tmp-&gt;<a class="code" href="structgtalk__candidate.html#aec15fa312e7877a8b26f9672d5da32b1">preference</a>);
<a name="l00858"></a>00858       iks_insert_attrib(iq, <span class="stringliteral">&quot;from&quot;</span>, to);
<a name="l00859"></a>00859       iks_insert_attrib(iq, <span class="stringliteral">&quot;to&quot;</span>, from);
<a name="l00860"></a>00860       iks_insert_attrib(iq, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;set&quot;</span>);
<a name="l00861"></a>00861       iks_insert_attrib(iq, <span class="stringliteral">&quot;id&quot;</span>, c-&gt;<a class="code" href="structaji__client.html#abee5661fa88af477fe47bbbd21136301">mid</a>);
<a name="l00862"></a>00862       <a class="code" href="jabber_8h.html#a6e4ae95e74b73933aa6e6d6817df9023" title="increments the mid field for messages and other events.">ast_aji_increment_mid</a>(c-&gt;<a class="code" href="structaji__client.html#abee5661fa88af477fe47bbbd21136301">mid</a>);
<a name="l00863"></a>00863       iks_insert_attrib(gtalk, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;transport-info&quot;</span>);
<a name="l00864"></a>00864       iks_insert_attrib(gtalk, <span class="stringliteral">&quot;id&quot;</span>, sid);
<a name="l00865"></a>00865       <span class="comment">/* put the initiator attribute to lower case if we receive the call </span>
<a name="l00866"></a>00866 <span class="comment">       * otherwise GoogleTalk won&apos;t establish the session */</span>
<a name="l00867"></a>00867       <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="structgtalk__pvt.html#ad65c66f9895c8d58b388365ac363e91c">initiator</a>) {
<a name="l00868"></a>00868               <span class="keywordtype">char</span> c;
<a name="l00869"></a>00869          <span class="keywordtype">char</span> *t = lowerfrom = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(from);
<a name="l00870"></a>00870          <span class="keywordflow">while</span> (((c = *t) != <span class="charliteral">&apos;/&apos;</span>) &amp;&amp; (*t++ = tolower(c)));
<a name="l00871"></a>00871       }
<a name="l00872"></a>00872       iks_insert_attrib(gtalk, <span class="stringliteral">&quot;initiator&quot;</span>, (p-&gt;<a class="code" href="structgtalk__pvt.html#ad65c66f9895c8d58b388365ac363e91c">initiator</a>) ? to : lowerfrom);
<a name="l00873"></a>00873       iks_insert_attrib(gtalk, <span class="stringliteral">&quot;xmlns&quot;</span>, <a class="code" href="chan__gtalk_8c.html#a265618f8e70c8e4a15fa48a7cb1f6d32">GOOGLE_NS</a>);
<a name="l00874"></a>00874       iks_insert_attrib(candidate, <span class="stringliteral">&quot;name&quot;</span>, tmp-&gt;<a class="code" href="structgtalk__candidate.html#aeaf846aa21a7d016a52f0b5b0c2f5544">name</a>);
<a name="l00875"></a>00875       iks_insert_attrib(candidate, <span class="stringliteral">&quot;address&quot;</span>, tmp-&gt;<a class="code" href="structgtalk__candidate.html#ac03ec605186c0c6d17c4beaab73d615c">ip</a>);
<a name="l00876"></a>00876       iks_insert_attrib(candidate, <span class="stringliteral">&quot;port&quot;</span>, port);
<a name="l00877"></a>00877       iks_insert_attrib(candidate, <span class="stringliteral">&quot;username&quot;</span>, tmp-&gt;<a class="code" href="structgtalk__candidate.html#a05eeba7fa0e9f1c4fcb8110937b46236">username</a>);
<a name="l00878"></a>00878       iks_insert_attrib(candidate, <span class="stringliteral">&quot;password&quot;</span>, tmp-&gt;<a class="code" href="structgtalk__candidate.html#a20218b63ca6f0a6ce74d704d915cb90a">password</a>);
<a name="l00879"></a>00879       iks_insert_attrib(candidate, <span class="stringliteral">&quot;preference&quot;</span>, preference);
<a name="l00880"></a>00880       <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="structgtalk__candidate.html#a97af5ab5463f8cc8bde8c7727d79c870">protocol</a> == <a class="code" href="chan__gtalk_8c.html#a4735ec2011c291c5213a858fe007c851ac913daa556e052c68933b9c428707ee3">AJI_PROTOCOL_UDP</a>)
<a name="l00881"></a>00881          iks_insert_attrib(candidate, <span class="stringliteral">&quot;protocol&quot;</span>, <span class="stringliteral">&quot;udp&quot;</span>);
<a name="l00882"></a>00882       <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="structgtalk__candidate.html#a97af5ab5463f8cc8bde8c7727d79c870">protocol</a> == <a class="code" href="chan__gtalk_8c.html#a4735ec2011c291c5213a858fe007c851a8d65aeba8254d08131b4672b7a06221c">AJI_PROTOCOL_SSLTCP</a>)
<a name="l00883"></a>00883          iks_insert_attrib(candidate, <span class="stringliteral">&quot;protocol&quot;</span>, <span class="stringliteral">&quot;ssltcp&quot;</span>);
<a name="l00884"></a>00884       <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="structgtalk__candidate.html#a89b984ef49eae8ce966e6c5d9290d879">type</a> == <a class="code" href="chan__gtalk_8c.html#aabf7ea7d1c280c2d91d5ad67ea5ab883afa2cfdc5c71aec4bb0ec4849e3236142">AJI_CONNECT_STUN</a>)
<a name="l00885"></a>00885          iks_insert_attrib(candidate, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;stun&quot;</span>);
<a name="l00886"></a>00886       <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="structgtalk__candidate.html#a89b984ef49eae8ce966e6c5d9290d879">type</a> == <a class="code" href="chan__gtalk_8c.html#aabf7ea7d1c280c2d91d5ad67ea5ab883a11e5bb1099f4e7c029d500bbc80ac483">AJI_CONNECT_LOCAL</a>)
<a name="l00887"></a>00887          iks_insert_attrib(candidate, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;local&quot;</span>);
<a name="l00888"></a>00888       <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="structgtalk__candidate.html#a89b984ef49eae8ce966e6c5d9290d879">type</a> == <a class="code" href="chan__gtalk_8c.html#aabf7ea7d1c280c2d91d5ad67ea5ab883a2ef123abfa8253ea9f67f7750dbdc421">AJI_CONNECT_RELAY</a>)
<a name="l00889"></a>00889          iks_insert_attrib(candidate, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;relay&quot;</span>);
<a name="l00890"></a>00890       iks_insert_attrib(candidate, <span class="stringliteral">&quot;network&quot;</span>, <span class="stringliteral">&quot;0&quot;</span>);
<a name="l00891"></a>00891       iks_insert_attrib(candidate, <span class="stringliteral">&quot;generation&quot;</span>, <span class="stringliteral">&quot;0&quot;</span>);
<a name="l00892"></a>00892       <a class="code" href="jabber_8h.html#a3c77ceecc909619207e971421fc3e9ef" title="Wraps raw sending.">ast_aji_send</a>(c, iq);
<a name="l00893"></a>00893    }
<a name="l00894"></a>00894    p-&gt;<a class="code" href="structgtalk__pvt.html#afea13c69c31226a6607e67b85f0231e2">laststun</a> = 0;
<a name="l00895"></a>00895 
<a name="l00896"></a>00896 safeout:
<a name="l00897"></a>00897    <span class="keywordflow">if</span> (ours1)
<a name="l00898"></a>00898       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(ours1);
<a name="l00899"></a>00899    <span class="keywordflow">if</span> (ours2)
<a name="l00900"></a>00900       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(ours2);
<a name="l00901"></a>00901    iks_delete(iq);
<a name="l00902"></a>00902    iks_delete(gtalk);
<a name="l00903"></a>00903    iks_delete(candidate);
<a name="l00904"></a>00904    iks_delete(transport);
<a name="l00905"></a>00905 
<a name="l00906"></a>00906    <span class="keywordflow">return</span> 1;
<a name="l00907"></a>00907 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a81ece7628e623a8f04b68b7edd007ab1"></a><!-- doxytag: member="chan_gtalk.c::gtalk_create_member" ref="a81ece7628e623a8f04b68b7edd007ab1" args="(char *label, struct ast_variable *var, int allowguest, struct ast_codec_pref prefs, char *context, struct gtalk *member)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int gtalk_create_member </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>label</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__variable.html">ast_variable</a> *&nbsp;</td>
          <td class="paramname"> <em>var</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>allowguest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__codec__pref.html">ast_codec_pref</a>&nbsp;</td>
          <td class="paramname"> <em>prefs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structgtalk.html">gtalk</a> *&nbsp;</td>
          <td class="paramname"> <em>member</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l01840">1840</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="chan__gtalk_8c_source.html#l00153">gtalk::allowguest</a>, <a class="el" href="res__jabber_8c_source.html#l02954">ast_aji_get_client()</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="frame_8c_source.html#l01233">ast_parse_allow_disallow()</a>, <a class="el" href="astobj_8h_source.html#l00401">ASTOBJ_CONTAINER_FIND</a>, <a class="el" href="jabber_8h_source.html#l00172">aji_client::buddies</a>, <a class="el" href="chan__gtalk_8c_source.html#l00141">gtalk::buddy</a>, <a class="el" href="chan__gtalk_8c_source.html#l00149">gtalk::capability</a>, <a class="el" href="chan__gtalk_8c_source.html#l00140">gtalk::connection</a>, <a class="el" href="chan__gtalk_8c_source.html#l00146">gtalk::context</a>, <a class="el" href="jabber_8h_source.html#l00151">aji_client::f</a>, <a class="el" href="chan__gtalk_8c_source.html#l01764">gtalk_parser()</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="config_8h_source.html#l00075">ast_variable::name</a>, <a class="el" href="config_8h_source.html#l00077">ast_variable::next</a>, <a class="el" href="chan__gtalk_8c_source.html#l00135">gtalk_candidate::next</a>, <a class="el" href="chan__gtalk_8c_source.html#l00147">gtalk::parkinglot</a>, <a class="el" href="chan__gtalk_8c_source.html#l00143">gtalk::prefs</a>, <a class="el" href="chan__gtalk_8c_source.html#l00145">gtalk::user</a>, and <a class="el" href="config_8h_source.html#l00076">ast_variable::value</a>.</p>

<p>Referenced by <a class="el" href="chan__gtalk_8c_source.html#l01901">gtalk_load_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01843"></a>01843 {
<a name="l01844"></a>01844    <span class="keyword">struct </span><a class="code" href="structaji__client.html">aji_client</a> *client;
<a name="l01845"></a>01845 
<a name="l01846"></a>01846    <span class="keywordflow">if</span> (!member)
<a name="l01847"></a>01847       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Out of memory.\n&quot;</span>);
<a name="l01848"></a>01848 
<a name="l01849"></a>01849    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(member-&gt;name, label, <span class="keyword">sizeof</span>(member-&gt;name));
<a name="l01850"></a>01850    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(member-&gt;<a class="code" href="structgtalk.html#a7932bef941e6643d2487880116d9990f">user</a>, label, <span class="keyword">sizeof</span>(member-&gt;<a class="code" href="structgtalk.html#a7932bef941e6643d2487880116d9990f">user</a>));
<a name="l01851"></a>01851    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(member-&gt;<a class="code" href="structgtalk.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <span class="keyword">sizeof</span>(member-&gt;<a class="code" href="structgtalk.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>));
<a name="l01852"></a>01852    member-&gt;<a class="code" href="structgtalk.html#aba1ad8c6c1c296a19e3a11c50ed7c8d5">allowguest</a> = <a class="code" href="structaji__client.html#aba1ad8c6c1c296a19e3a11c50ed7c8d5">allowguest</a>;
<a name="l01853"></a>01853    member-&gt;<a class="code" href="structgtalk.html#a46262e3cc2baf55a72542567ccfe86d9">prefs</a> = prefs;
<a name="l01854"></a>01854    <span class="keywordflow">while</span> (var) {
<a name="l01855"></a>01855 <span class="preprocessor">#if 0</span>
<a name="l01856"></a>01856 <span class="preprocessor"></span>      <span class="keyword">struct </span><a class="code" href="structgtalk__candidate.html">gtalk_candidate</a> *candidate = NULL;
<a name="l01857"></a>01857 <span class="preprocessor">#endif</span>
<a name="l01858"></a>01858 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;username&quot;</span>))
<a name="l01859"></a>01859          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(member-&gt;<a class="code" href="structgtalk.html#a7932bef941e6643d2487880116d9990f">user</a>, var-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(member-&gt;<a class="code" href="structgtalk.html#a7932bef941e6643d2487880116d9990f">user</a>));
<a name="l01860"></a>01860       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;disallow&quot;</span>))
<a name="l01861"></a>01861          <a class="code" href="frame_8h.html#a35aa1fb72e1993a14156a6b912034ef9" title="Parse an &amp;quot;allow&amp;quot; or &amp;quot;deny&amp;quot; line in a channel or device configuration...">ast_parse_allow_disallow</a>(&amp;member-&gt;<a class="code" href="structgtalk.html#a46262e3cc2baf55a72542567ccfe86d9">prefs</a>, &amp;member-&gt;<a class="code" href="structgtalk.html#afa05b14ff7f76f303c784c00c4c63fa7">capability</a>, var-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, 0);
<a name="l01862"></a>01862       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;allow&quot;</span>))
<a name="l01863"></a>01863          <a class="code" href="frame_8h.html#a35aa1fb72e1993a14156a6b912034ef9" title="Parse an &amp;quot;allow&amp;quot; or &amp;quot;deny&amp;quot; line in a channel or device configuration...">ast_parse_allow_disallow</a>(&amp;member-&gt;<a class="code" href="structgtalk.html#a46262e3cc2baf55a72542567ccfe86d9">prefs</a>, &amp;member-&gt;<a class="code" href="structgtalk.html#afa05b14ff7f76f303c784c00c4c63fa7">capability</a>, var-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, 1);
<a name="l01864"></a>01864       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;context&quot;</span>))
<a name="l01865"></a>01865          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(member-&gt;<a class="code" href="structgtalk.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, var-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(member-&gt;<a class="code" href="structgtalk.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>));
<a name="l01866"></a>01866       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;parkinglot&quot;</span>))
<a name="l01867"></a>01867          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(member-&gt;<a class="code" href="structgtalk.html#a6b31bfcc769a5b5c31e13aa6d8a9a286">parkinglot</a>, var-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(member-&gt;<a class="code" href="structgtalk.html#a6b31bfcc769a5b5c31e13aa6d8a9a286">parkinglot</a>));
<a name="l01868"></a>01868 <span class="preprocessor">#if 0</span>
<a name="l01869"></a>01869 <span class="preprocessor"></span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;candidate&quot;</span>)) {
<a name="l01870"></a>01870          candidate = gtalk_create_candidate(var-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l01871"></a>01871          <span class="keywordflow">if</span> (candidate) {
<a name="l01872"></a>01872             candidate-&gt;<a class="code" href="structgtalk__candidate.html#a6f4a98673f70f06b746ef8e1c50c3ade">next</a> = member-&gt;ourcandidates;
<a name="l01873"></a>01873             member-&gt;ourcandidates = candidate;
<a name="l01874"></a>01874          }
<a name="l01875"></a>01875       }
<a name="l01876"></a>01876 <span class="preprocessor">#endif</span>
<a name="l01877"></a>01877 <span class="preprocessor"></span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;connection&quot;</span>)) {
<a name="l01878"></a>01878          <span class="keywordflow">if</span> ((client = <a class="code" href="jabber_8h.html#a6689c8e948c8d55e092f30277336fde7" title="grab a aji_client structure by label name or JID (without the resource string)">ast_aji_get_client</a>(var-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>))) {
<a name="l01879"></a>01879             member-&gt;<a class="code" href="structgtalk.html#a22eb965539587ef7d2b0340d57159e3a">connection</a> = client;
<a name="l01880"></a>01880             iks_filter_add_rule(client-&gt;<a class="code" href="structaji__client.html#afc6fdfd9b3ea85d062020bb1aea416b3">f</a>, <a class="code" href="chan__gtalk_8c.html#a8677afddf5ca302b0dd80e6330290cc2">gtalk_parser</a>, member, 
<a name="l01881"></a>01881                       IKS_RULE_TYPE, IKS_PAK_IQ, 
<a name="l01882"></a>01882                       IKS_RULE_FROM_PARTIAL, member-&gt;<a class="code" href="structgtalk.html#a7932bef941e6643d2487880116d9990f">user</a>,
<a name="l01883"></a>01883                       IKS_RULE_NS, <span class="stringliteral">&quot;http://www.google.com/session&quot;</span>,
<a name="l01884"></a>01884                       IKS_RULE_DONE);
<a name="l01885"></a>01885 
<a name="l01886"></a>01886          } <span class="keywordflow">else</span> {
<a name="l01887"></a>01887             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;connection referenced not found!\n&quot;</span>);
<a name="l01888"></a>01888             <span class="keywordflow">return</span> 0;
<a name="l01889"></a>01889          }
<a name="l01890"></a>01890       }
<a name="l01891"></a>01891       var = var-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>;
<a name="l01892"></a>01892    }
<a name="l01893"></a>01893    <span class="keywordflow">if</span> (member-&gt;<a class="code" href="structgtalk.html#a22eb965539587ef7d2b0340d57159e3a">connection</a> &amp;&amp; member-&gt;<a class="code" href="structgtalk.html#a7932bef941e6643d2487880116d9990f">user</a>)
<a name="l01894"></a>01894       member-&gt;<a class="code" href="structgtalk.html#a2704a75322ea2a93cfbfd9ba4d08dad6">buddy</a> = <a class="code" href="astobj_8h.html#aca5d7206cd0c6817140bba786a9b6b8a" title="Find an object in a container.">ASTOBJ_CONTAINER_FIND</a>(&amp;member-&gt;<a class="code" href="structgtalk.html#a22eb965539587ef7d2b0340d57159e3a">connection</a>-&gt;<a class="code" href="structaji__client.html#acb477f162f95d7daa23c110e9ce62b60">buddies</a>, member-&gt;<a class="code" href="structgtalk.html#a7932bef941e6643d2487880116d9990f">user</a>);
<a name="l01895"></a>01895    <span class="keywordflow">else</span> {
<a name="l01896"></a>01896       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;No Connection or Username!\n&quot;</span>);
<a name="l01897"></a>01897    }
<a name="l01898"></a>01898    <span class="keywordflow">return</span> 1;
<a name="l01899"></a>01899 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="afa624b42925eed15fdc76a849b0766ae"></a><!-- doxytag: member="chan_gtalk.c::gtalk_digit" ref="afa624b42925eed15fdc76a849b0766ae" args="(struct ast_channel *ast, char digit, unsigned int duration)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int gtalk_digit </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>ast</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>digit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>duration</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l01512">1512</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="res__jabber_8c_source.html#l02038">ast_aji_increment_mid()</a>, <a class="el" href="res__jabber_8c_source.html#l00818">ast_aji_send()</a>, <a class="el" href="frame_8h_source.html#l00122">AST_FRAME_DTMF_BEGIN</a>, <a class="el" href="frame_8h_source.html#l00099">AST_FRAME_DTMF_END</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="chan__gtalk_8c_source.html#l00140">gtalk::connection</a>, <a class="el" href="channel_8h_source.html#l00445">ast_channel::dtmff</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="chan__gtalk_8c_source.html#l00106">gtalk_pvt::initiator</a>, <a class="el" href="chan__gtalk_8c_source.html#l00098">gtalk_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="jabber_8h_source.html#l00148">aji_client::mid</a>, <a class="el" href="chan__gtalk_8c_source.html#l00100">gtalk_pvt::parent</a>, <a class="el" href="chan__gtalk_8c_source.html#l00101">gtalk_pvt::sid</a>, <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>, <a class="el" href="chan__gtalk_8c_source.html#l00103">gtalk_pvt::them</a>, and <a class="el" href="chan__gtalk_8c_source.html#l00102">gtalk_pvt::us</a>.</p>

<p>Referenced by <a class="el" href="chan__gtalk_8c_source.html#l01502">gtalk_digit_begin()</a>, and <a class="el" href="chan__gtalk_8c_source.html#l01507">gtalk_digit_end()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01513"></a>01513 {
<a name="l01514"></a>01514    <span class="keyword">struct </span><a class="code" href="structgtalk__pvt.html">gtalk_pvt</a> *p = ast-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l01515"></a>01515    <span class="keyword">struct </span><a class="code" href="structgtalk.html">gtalk</a> *client = p-&gt;<a class="code" href="structgtalk__pvt.html#a06cbd7bfad0d73228cdd0dbb68fb999f">parent</a>;
<a name="l01516"></a>01516    iks *iq, *<a class="code" href="structgtalk.html">gtalk</a>, *dtmf;
<a name="l01517"></a>01517    <span class="keywordtype">char</span> buffer[2] = {digit, <span class="charliteral">&apos;\0&apos;</span>};
<a name="l01518"></a>01518    <span class="keywordtype">char</span> *lowerthem = NULL;
<a name="l01519"></a>01519    iq = iks_new(<span class="stringliteral">&quot;iq&quot;</span>);
<a name="l01520"></a>01520    gtalk = iks_new(<span class="stringliteral">&quot;gtalk&quot;</span>);
<a name="l01521"></a>01521    dtmf = iks_new(<span class="stringliteral">&quot;dtmf&quot;</span>);
<a name="l01522"></a>01522    <span class="keywordflow">if</span>(!iq || !gtalk || !dtmf) {
<a name="l01523"></a>01523       iks_delete(iq);
<a name="l01524"></a>01524       iks_delete(gtalk);
<a name="l01525"></a>01525       iks_delete(dtmf);
<a name="l01526"></a>01526       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Did not send dtmf do to memory issue\n&quot;</span>);
<a name="l01527"></a>01527       <span class="keywordflow">return</span> -1;
<a name="l01528"></a>01528    }
<a name="l01529"></a>01529 
<a name="l01530"></a>01530    iks_insert_attrib(iq, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;set&quot;</span>);
<a name="l01531"></a>01531    iks_insert_attrib(iq, <span class="stringliteral">&quot;to&quot;</span>, p-&gt;<a class="code" href="structgtalk__pvt.html#a7c3b41a9f87238ef5a35607e6655f02e">them</a>);
<a name="l01532"></a>01532    iks_insert_attrib(iq, <span class="stringliteral">&quot;from&quot;</span>, p-&gt;<a class="code" href="structgtalk__pvt.html#a81eba36a21e03789e7d728d4bebd61d3">us</a>);
<a name="l01533"></a>01533    iks_insert_attrib(iq, <span class="stringliteral">&quot;id&quot;</span>, client-&gt;<a class="code" href="structgtalk.html#a22eb965539587ef7d2b0340d57159e3a">connection</a>-&gt;<a class="code" href="structaji__client.html#abee5661fa88af477fe47bbbd21136301">mid</a>);
<a name="l01534"></a>01534    <a class="code" href="jabber_8h.html#a6e4ae95e74b73933aa6e6d6817df9023" title="increments the mid field for messages and other events.">ast_aji_increment_mid</a>(client-&gt;<a class="code" href="structgtalk.html#a22eb965539587ef7d2b0340d57159e3a">connection</a>-&gt;<a class="code" href="structaji__client.html#abee5661fa88af477fe47bbbd21136301">mid</a>);
<a name="l01535"></a>01535    iks_insert_attrib(gtalk, <span class="stringliteral">&quot;xmlns&quot;</span>, <span class="stringliteral">&quot;http://jabber.org/protocol/gtalk&quot;</span>);
<a name="l01536"></a>01536    iks_insert_attrib(gtalk, <span class="stringliteral">&quot;action&quot;</span>, <span class="stringliteral">&quot;session-info&quot;</span>);
<a name="l01537"></a>01537    <span class="comment">/* put the initiator attribute to lower case if we receive the call </span>
<a name="l01538"></a>01538 <span class="comment">    * otherwise GoogleTalk won&apos;t establish the session */</span>
<a name="l01539"></a>01539    <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="structgtalk__pvt.html#ad65c66f9895c8d58b388365ac363e91c">initiator</a>) {
<a name="l01540"></a>01540            <span class="keywordtype">char</span> c;
<a name="l01541"></a>01541            <span class="keywordtype">char</span> *t = lowerthem = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(p-&gt;<a class="code" href="structgtalk__pvt.html#a7c3b41a9f87238ef5a35607e6655f02e">them</a>);
<a name="l01542"></a>01542            <span class="keywordflow">while</span> (((c = *t) != <span class="charliteral">&apos;/&apos;</span>) &amp;&amp; (*t++ = tolower(c)));
<a name="l01543"></a>01543    }
<a name="l01544"></a>01544    iks_insert_attrib(gtalk, <span class="stringliteral">&quot;initiator&quot;</span>, p-&gt;<a class="code" href="structgtalk__pvt.html#ad65c66f9895c8d58b388365ac363e91c">initiator</a> ? p-&gt;<a class="code" href="structgtalk__pvt.html#a81eba36a21e03789e7d728d4bebd61d3">us</a>: lowerthem);
<a name="l01545"></a>01545    iks_insert_attrib(gtalk, <span class="stringliteral">&quot;sid&quot;</span>, p-&gt;<a class="code" href="structgtalk__pvt.html#a11855a8fa7877d4395e800ce1bb3ed8d">sid</a>);
<a name="l01546"></a>01546    iks_insert_attrib(dtmf, <span class="stringliteral">&quot;xmlns&quot;</span>, <span class="stringliteral">&quot;http://jabber.org/protocol/gtalk/info/dtmf&quot;</span>);
<a name="l01547"></a>01547    iks_insert_attrib(dtmf, <span class="stringliteral">&quot;code&quot;</span>, buffer);
<a name="l01548"></a>01548    iks_insert_node(iq, gtalk);
<a name="l01549"></a>01549    iks_insert_node(gtalk, dtmf);
<a name="l01550"></a>01550 
<a name="l01551"></a>01551    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;p-&gt;<a class="code" href="structgtalk__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01552"></a>01552    <span class="keywordflow">if</span> (ast-&gt;<a class="code" href="structast__channel.html#a2d07143627b03360ff4de0097553dbcc">dtmff</a>.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a9b350360a64b55c7590f1ec03db480be">AST_FRAME_DTMF_BEGIN</a> || duration == 0) {
<a name="l01553"></a>01553       iks_insert_attrib(dtmf, <span class="stringliteral">&quot;action&quot;</span>, <span class="stringliteral">&quot;button-down&quot;</span>);
<a name="l01554"></a>01554    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ast-&gt;<a class="code" href="structast__channel.html#a2d07143627b03360ff4de0097553dbcc">dtmff</a>.<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a98e65764bc963016c394bcc1bad6540b">AST_FRAME_DTMF_END</a> || duration != 0) {
<a name="l01555"></a>01555       iks_insert_attrib(dtmf, <span class="stringliteral">&quot;action&quot;</span>, <span class="stringliteral">&quot;button-up&quot;</span>);
<a name="l01556"></a>01556    }
<a name="l01557"></a>01557    <a class="code" href="jabber_8h.html#a3c77ceecc909619207e971421fc3e9ef" title="Wraps raw sending.">ast_aji_send</a>(client-&gt;<a class="code" href="structgtalk.html#a22eb965539587ef7d2b0340d57159e3a">connection</a>, iq);
<a name="l01558"></a>01558 
<a name="l01559"></a>01559    iks_delete(iq);
<a name="l01560"></a>01560    iks_delete(gtalk);
<a name="l01561"></a>01561    iks_delete(dtmf);
<a name="l01562"></a>01562    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structgtalk__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01563"></a>01563    <span class="keywordflow">return</span> 0;
<a name="l01564"></a>01564 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4ec053e812be19b810ff938914588518"></a><!-- doxytag: member="chan_gtalk.c::gtalk_digit_begin" ref="a4ec053e812be19b810ff938914588518" args="(struct ast_channel *ast, char digit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int gtalk_digit_begin </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>ast</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>digit</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l01502">1502</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="chan__gtalk_8c_source.html#l01512">gtalk_digit()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01503"></a>01503 {
<a name="l01504"></a>01504    <span class="keywordflow">return</span> <a class="code" href="chan__gtalk_8c.html#afa624b42925eed15fdc76a849b0766ae">gtalk_digit</a>(<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, digit, 0);
<a name="l01505"></a>01505 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a733bc73b78f85f96715d3a9029be69bc"></a><!-- doxytag: member="chan_gtalk.c::gtalk_digit_end" ref="a733bc73b78f85f96715d3a9029be69bc" args="(struct ast_channel *ast, char digit, unsigned int duration)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int gtalk_digit_end </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>ast</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>digit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>duration</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l01507">1507</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="chan__gtalk_8c_source.html#l01512">gtalk_digit()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01508"></a>01508 {
<a name="l01509"></a>01509    <span class="keywordflow">return</span> <a class="code" href="chan__gtalk_8c.html#afa624b42925eed15fdc76a849b0766ae">gtalk_digit</a>(<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, digit, duration);
<a name="l01510"></a>01510 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="afc4171d29cff2186306811cc21ee480d"></a><!-- doxytag: member="chan_gtalk.c::gtalk_do_reload" ref="afc4171d29cff2186306811cc21ee480d" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char * gtalk_do_reload </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>CLI command "gtalk reload". </p>

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l01747">1747</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00079">ast_verbose</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, and <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01748"></a>01748 {
<a name="l01749"></a>01749    <span class="keywordflow">switch</span> (cmd) {
<a name="l01750"></a>01750    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l01751"></a>01751       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;gtalk reload&quot;</span>;
<a name="l01752"></a>01752       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l01753"></a>01753          <span class="stringliteral">&quot;Usage: gtalk reload\n&quot;</span>
<a name="l01754"></a>01754          <span class="stringliteral">&quot;       Reload gtalk channel driver.\n&quot;</span>;
<a name="l01755"></a>01755       <span class="keywordflow">return</span> NULL;
<a name="l01756"></a>01756    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l01757"></a>01757       <span class="keywordflow">return</span> NULL;
<a name="l01758"></a>01758    }  
<a name="l01759"></a>01759    
<a name="l01760"></a>01760    <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;IT DOES WORK!\n&quot;</span>);
<a name="l01761"></a>01761    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l01762"></a>01762 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac86bc5d49ff09213cfe5a13e3ad1c1fa"></a><!-- doxytag: member="chan_gtalk.c::gtalk_fixup" ref="ac86bc5d49ff09213cfe5a13e3ad1c1fa" args="(struct ast_channel *oldchan, struct ast_channel *newchan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int gtalk_fixup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>oldchan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>newchan</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l01468">1468</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00098">gtalk_pvt::lock</a>, <a class="el" href="chan__gtalk_8c_source.html#l00115">gtalk_pvt::owner</a>, and <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01469"></a>01469 {
<a name="l01470"></a>01470    <span class="keyword">struct </span><a class="code" href="structgtalk__pvt.html">gtalk_pvt</a> *p = newchan-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l01471"></a>01471    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;p-&gt;<a class="code" href="structgtalk__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01472"></a>01472 
<a name="l01473"></a>01473    <span class="keywordflow">if</span> ((p-&gt;<a class="code" href="structgtalk__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> != oldchan)) {
<a name="l01474"></a>01474       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structgtalk__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01475"></a>01475       <span class="keywordflow">return</span> -1;
<a name="l01476"></a>01476    }
<a name="l01477"></a>01477    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structgtalk__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> == oldchan)
<a name="l01478"></a>01478       p-&gt;<a class="code" href="structgtalk__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = newchan;
<a name="l01479"></a>01479    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structgtalk__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01480"></a>01480    <span class="keywordflow">return</span> 0;
<a name="l01481"></a>01481 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a55a258df74e77719bdcd6c617d91e2b0"></a><!-- doxytag: member="chan_gtalk.c::gtalk_free_candidates" ref="a55a258df74e77719bdcd6c617d91e2b0" args="(struct gtalk_candidate *candidate)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void gtalk_free_candidates </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structgtalk__candidate.html">gtalk_candidate</a> *&nbsp;</td>
          <td class="paramname"> <em>candidate</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l01116">1116</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="devicestate_8c_source.html#l00198">last</a>, and <a class="el" href="chan__gtalk_8c_source.html#l00135">gtalk_candidate::next</a>.</p>

<p>Referenced by <a class="el" href="chan__gtalk_8c_source.html#l01126">gtalk_free_pvt()</a>, and <a class="el" href="chan__gtalk_8c_source.html#l01901">gtalk_load_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01117"></a>01117 {
<a name="l01118"></a>01118    <span class="keyword">struct </span><a class="code" href="structgtalk__candidate.html">gtalk_candidate</a> *<a class="code" href="devicestate_8c.html#a43a8def62ee15449794285cbbc0f79af">last</a>;
<a name="l01119"></a>01119    <span class="keywordflow">while</span> (candidate) {
<a name="l01120"></a>01120       last = candidate;
<a name="l01121"></a>01121       candidate = candidate-&gt;<a class="code" href="structgtalk__candidate.html#a6f4a98673f70f06b746ef8e1c50c3ade">next</a>;
<a name="l01122"></a>01122       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(last);
<a name="l01123"></a>01123    }
<a name="l01124"></a>01124 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a46487d9263cd957964d6056bfe183d6c"></a><!-- doxytag: member="chan_gtalk.c::gtalk_free_pvt" ref="a46487d9263cd957964d6056bfe183d6c" args="(struct gtalk *client, struct gtalk_pvt *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void gtalk_free_pvt </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structgtalk.html">gtalk</a> *&nbsp;</td>
          <td class="paramname"> <em>client</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structgtalk__pvt.html">gtalk_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l01126">1126</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="rtp_8c_source.html#l03058">ast_rtp_destroy()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00140">gtalk::connection</a>, <a class="el" href="jabber_8h_source.html#l00151">aji_client::f</a>, <a class="el" href="chan__gtalk_8c_source.html#l01116">gtalk_free_candidates()</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__gtalk_8c_source.html#l00120">gtalk_pvt::next</a>, <a class="el" href="chan__gtalk_8c_source.html#l00115">gtalk_pvt::owner</a>, <a class="el" href="chan__gtalk_8c_source.html#l00142">gtalk::p</a>, <a class="el" href="chan__gtalk_8c_source.html#l00100">gtalk_pvt::parent</a>, <a class="el" href="chan__gtalk_8c_source.html#l00105">gtalk_pvt::ringrule</a>, <a class="el" href="chan__gtalk_8c_source.html#l00116">gtalk_pvt::rtp</a>, <a class="el" href="chan__gtalk_8c_source.html#l00110">gtalk_pvt::theircandidates</a>, and <a class="el" href="chan__gtalk_8c_source.html#l00117">gtalk_pvt::vrtp</a>.</p>

<p>Referenced by <a class="el" href="chan__gtalk_8c_source.html#l01617">gtalk_hangup()</a>, and <a class="el" href="chan__gtalk_8c_source.html#l01154">gtalk_newcall()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01127"></a>01127 {
<a name="l01128"></a>01128    <span class="keyword">struct </span><a class="code" href="structgtalk__pvt.html">gtalk_pvt</a> *cur, *prev = NULL;
<a name="l01129"></a>01129    cur = client-&gt;<a class="code" href="structgtalk.html#a87c10b8b2ce58b28854a6cf5a7462bbd">p</a>;
<a name="l01130"></a>01130    <span class="keywordflow">while</span> (cur) {
<a name="l01131"></a>01131       <span class="keywordflow">if</span> (cur == p) {
<a name="l01132"></a>01132          <span class="keywordflow">if</span> (prev)
<a name="l01133"></a>01133             prev-&gt;<a class="code" href="structgtalk__pvt.html#ad52b2b57b8b3ac8cab36317c65547157">next</a> = p-&gt;<a class="code" href="structgtalk__pvt.html#ad52b2b57b8b3ac8cab36317c65547157">next</a>;
<a name="l01134"></a>01134          <span class="keywordflow">else</span>
<a name="l01135"></a>01135             client-&gt;<a class="code" href="structgtalk.html#a87c10b8b2ce58b28854a6cf5a7462bbd">p</a> = p-&gt;<a class="code" href="structgtalk__pvt.html#ad52b2b57b8b3ac8cab36317c65547157">next</a>;
<a name="l01136"></a>01136          <span class="keywordflow">break</span>;
<a name="l01137"></a>01137       }
<a name="l01138"></a>01138       prev = cur;
<a name="l01139"></a>01139       cur = cur-&gt;<a class="code" href="structgtalk__pvt.html#ad52b2b57b8b3ac8cab36317c65547157">next</a>;
<a name="l01140"></a>01140    }
<a name="l01141"></a>01141    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structgtalk__pvt.html#a48b56664545a8ea58b25639b74f863b5">ringrule</a>)
<a name="l01142"></a>01142       iks_filter_remove_rule(p-&gt;<a class="code" href="structgtalk__pvt.html#a06cbd7bfad0d73228cdd0dbb68fb999f">parent</a>-&gt;<a class="code" href="structgtalk.html#a22eb965539587ef7d2b0340d57159e3a">connection</a>-&gt;<a class="code" href="structaji__client.html#afc6fdfd9b3ea85d062020bb1aea416b3">f</a>, p-&gt;<a class="code" href="structgtalk__pvt.html#a48b56664545a8ea58b25639b74f863b5">ringrule</a>);
<a name="l01143"></a>01143    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structgtalk__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)
<a name="l01144"></a>01144       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Uh oh, there&apos;s an owner, this is going to be messy.\n&quot;</span>);
<a name="l01145"></a>01145    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structgtalk__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>)
<a name="l01146"></a>01146       <a class="code" href="rtp_8h.html#a6d2addabf879eb321a660932e3bd57eb">ast_rtp_destroy</a>(p-&gt;<a class="code" href="structgtalk__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>);
<a name="l01147"></a>01147    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structgtalk__pvt.html#a65e8f978abd3f0206026969c627200a9">vrtp</a>)
<a name="l01148"></a>01148       <a class="code" href="rtp_8h.html#a6d2addabf879eb321a660932e3bd57eb">ast_rtp_destroy</a>(p-&gt;<a class="code" href="structgtalk__pvt.html#a65e8f978abd3f0206026969c627200a9">vrtp</a>);
<a name="l01149"></a>01149    <a class="code" href="chan__gtalk_8c.html#a55a258df74e77719bdcd6c617d91e2b0">gtalk_free_candidates</a>(p-&gt;<a class="code" href="structgtalk__pvt.html#ad255738c9c6ff7d58888b3b937d57bfd">theircandidates</a>);
<a name="l01150"></a>01150    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(p);
<a name="l01151"></a>01151 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a81d8662de17c88b4d841d9379043b461"></a><!-- doxytag: member="chan_gtalk.c::gtalk_get_codec" ref="a81d8662de17c88b4d841d9379043b461" args="(struct ast_channel *chan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int gtalk_get_codec </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l00545">545</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="chan__gtalk_8c_source.html#l00119">gtalk_pvt::peercapability</a>, and <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00546"></a>00546 {
<a name="l00547"></a>00547    <span class="keyword">struct </span><a class="code" href="structgtalk__pvt.html">gtalk_pvt</a> *p = chan-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l00548"></a>00548    <span class="keywordflow">return</span> p-&gt;<a class="code" href="structgtalk__pvt.html#a64c43413589d9d63d2ef5db58ed1a7c2">peercapability</a>;
<a name="l00549"></a>00549 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a94dbeea9dc490aa6149e045b2bd4421b"></a><!-- doxytag: member="chan_gtalk.c::gtalk_get_rtp_peer" ref="a94dbeea9dc490aa6149e045b2bd4421b" args="(struct ast_channel *chan, struct ast_rtp **rtp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95">ast_rtp_get_result</a> gtalk_get_rtp_peer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> **&nbsp;</td>
          <td class="paramname"> <em>rtp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l00527">527</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="rtp_8h_source.html#l00065">AST_RTP_GET_FAILED</a>, <a class="el" href="rtp_8h_source.html#l00067">AST_RTP_TRY_PARTIAL</a>, <a class="el" href="chan__gtalk_8c_source.html#l00098">gtalk_pvt::lock</a>, <a class="el" href="chan__gtalk_8c_source.html#l00116">gtalk_pvt::rtp</a>, and <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00528"></a>00528 {
<a name="l00529"></a>00529    <span class="keyword">struct </span><a class="code" href="structgtalk__pvt.html">gtalk_pvt</a> *p = chan-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l00530"></a>00530    <span class="keyword">enum</span> <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95">ast_rtp_get_result</a> res = <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95ac5576eebb6765a96bed3a6e123c8f6c4">AST_RTP_GET_FAILED</a>;
<a name="l00531"></a>00531 
<a name="l00532"></a>00532    <span class="keywordflow">if</span> (!p)
<a name="l00533"></a>00533       <span class="keywordflow">return</span> res;
<a name="l00534"></a>00534 
<a name="l00535"></a>00535    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;p-&gt;<a class="code" href="structgtalk__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00536"></a>00536    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structgtalk__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>){
<a name="l00537"></a>00537       *rtp = p-&gt;<a class="code" href="structgtalk__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>;
<a name="l00538"></a>00538       res = <a class="code" href="rtp_8h.html#adb5c0a29db09eb234a36f24b25766a95a8bc993394ab95ca4c2ac98f9477518fe">AST_RTP_TRY_PARTIAL</a>;
<a name="l00539"></a>00539    }
<a name="l00540"></a>00540    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structgtalk__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00541"></a>00541 
<a name="l00542"></a>00542    <span class="keywordflow">return</span> res;
<a name="l00543"></a>00543 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a61cd7bfb93e66deda92be4dd3bf8175f"></a><!-- doxytag: member="chan_gtalk.c::gtalk_handle_dtmf" ref="a61cd7bfb93e66deda92be4dd3bf8175f" args="(struct gtalk *client, ikspak *pak)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int gtalk_handle_dtmf </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structgtalk.html">gtalk</a> *&nbsp;</td>
          <td class="paramname"> <em>client</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ikspak *&nbsp;</td>
          <td class="paramname"> <em>pak</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l00680">680</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="frame_8h_source.html#l00124">AST_FRAME_DTMF</a>, <a class="el" href="frame_8h_source.html#l00122">AST_FRAME_DTMF_BEGIN</a>, <a class="el" href="frame_8h_source.html#l00099">AST_FRAME_DTMF_END</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8c_source.html#l01080">ast_queue_frame()</a>, <a class="el" href="logger_8h_source.html#l00079">ast_verbose</a>, <a class="el" href="chan__gtalk_8c_source.html#l00140">gtalk::connection</a>, <a class="el" href="chan__gtalk_8c_source.html#l00571">gtalk_response()</a>, <a class="el" href="jabber_8h_source.html#l00149">aji_client::jid</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="chan__gtalk_8c_source.html#l00120">gtalk_pvt::next</a>, <a class="el" href="chan__gtalk_8c_source.html#l00115">gtalk_pvt::owner</a>, <a class="el" href="chan__gtalk_8c_source.html#l00142">gtalk::p</a>, <a class="el" href="chan__gtalk_8c_source.html#l00101">gtalk_pvt::sid</a>, and <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>.</p>

<p>Referenced by <a class="el" href="chan__gtalk_8c_source.html#l01764">gtalk_parser()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00681"></a>00681 {
<a name="l00682"></a>00682    <span class="keyword">struct </span><a class="code" href="structgtalk__pvt.html">gtalk_pvt</a> *tmp;
<a name="l00683"></a>00683    iks *dtmfnode = NULL, *dtmfchild = NULL;
<a name="l00684"></a>00684    <span class="keywordtype">char</span> *dtmf;
<a name="l00685"></a>00685    <span class="keywordtype">char</span> *from;
<a name="l00686"></a>00686    <span class="comment">/* Make sure our new call doesn&apos;t exist yet */</span>
<a name="l00687"></a>00687    <span class="keywordflow">for</span> (tmp = client-&gt;<a class="code" href="structgtalk.html#a87c10b8b2ce58b28854a6cf5a7462bbd">p</a>; tmp; tmp = tmp-&gt;<a class="code" href="structgtalk__pvt.html#ad52b2b57b8b3ac8cab36317c65547157">next</a>) {
<a name="l00688"></a>00688       <span class="keywordflow">if</span> (iks_find_with_attrib(pak-&gt;x, <span class="stringliteral">&quot;session&quot;</span>, <span class="stringliteral">&quot;id&quot;</span>, tmp-&gt;<a class="code" href="structgtalk__pvt.html#a11855a8fa7877d4395e800ce1bb3ed8d">sid</a>) || iks_find_with_attrib(pak-&gt;x, <span class="stringliteral">&quot;gtalk&quot;</span>, <span class="stringliteral">&quot;sid&quot;</span>, tmp-&gt;<a class="code" href="structgtalk__pvt.html#a11855a8fa7877d4395e800ce1bb3ed8d">sid</a>))
<a name="l00689"></a>00689          <span class="keywordflow">break</span>;
<a name="l00690"></a>00690    }
<a name="l00691"></a>00691    from = iks_find_attrib(pak-&gt;x, <span class="stringliteral">&quot;to&quot;</span>);
<a name="l00692"></a>00692    <span class="keywordflow">if</span>(!from)
<a name="l00693"></a>00693       from = client-&gt;<a class="code" href="structgtalk.html#a22eb965539587ef7d2b0340d57159e3a">connection</a>-&gt;<a class="code" href="structaji__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;full;
<a name="l00694"></a>00694 
<a name="l00695"></a>00695 
<a name="l00696"></a>00696    <span class="keywordflow">if</span> (tmp) {
<a name="l00697"></a>00697       <span class="keywordflow">if</span>(iks_find_with_attrib(pak-&gt;x, <span class="stringliteral">&quot;dtmf-method&quot;</span>, <span class="stringliteral">&quot;method&quot;</span>, <span class="stringliteral">&quot;rtp&quot;</span>)) {
<a name="l00698"></a>00698          <a class="code" href="chan__gtalk_8c.html#ac60c0cc7813dc8afb593b62633a0236f">gtalk_response</a>(client, from, pak,
<a name="l00699"></a>00699                <span class="stringliteral">&quot;feature-not-implemented xmlns=&apos;urn:ietf:params:xml:ns:xmpp-stanzas&apos;&quot;</span>,
<a name="l00700"></a>00700                <span class="stringliteral">&quot;unsupported-dtmf-method xmlns=&apos;http://jabber.org/protocol/gtalk/info/dtmf#errors&apos;&quot;</span>);
<a name="l00701"></a>00701          <span class="keywordflow">return</span> -1;
<a name="l00702"></a>00702       }
<a name="l00703"></a>00703       <span class="keywordflow">if</span> ((dtmfnode = iks_find(pak-&gt;x, <span class="stringliteral">&quot;dtmf&quot;</span>))) {
<a name="l00704"></a>00704          <span class="keywordflow">if</span>((dtmf = iks_find_attrib(dtmfnode, <span class="stringliteral">&quot;code&quot;</span>))) {
<a name="l00705"></a>00705             <span class="keywordflow">if</span>(iks_find_with_attrib(pak-&gt;x, <span class="stringliteral">&quot;dtmf&quot;</span>, <span class="stringliteral">&quot;action&quot;</span>, <span class="stringliteral">&quot;button-up&quot;</span>)) {
<a name="l00706"></a>00706                <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> <a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a> = {<a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a9b350360a64b55c7590f1ec03db480be">AST_FRAME_DTMF_BEGIN</a>, };
<a name="l00707"></a>00707                f.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = dtmf[0];
<a name="l00708"></a>00708                <a class="code" href="channel_8h.html#a6cbcba5661d55216968cde8fdf913c89" title="Queue one or more frames to a channel&amp;#39;s frame queue.">ast_queue_frame</a>(tmp-&gt;<a class="code" href="structgtalk__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, &amp;f);
<a name="l00709"></a>00709                <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;GOOGLE! DTMF-relay event received: %c\n&quot;</span>, f.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>);
<a name="l00710"></a>00710             } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(iks_find_with_attrib(pak-&gt;x, <span class="stringliteral">&quot;dtmf&quot;</span>, <span class="stringliteral">&quot;action&quot;</span>, <span class="stringliteral">&quot;button-down&quot;</span>)) {
<a name="l00711"></a>00711                <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> <a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a> = {<a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a98e65764bc963016c394bcc1bad6540b">AST_FRAME_DTMF_END</a>, };
<a name="l00712"></a>00712                f.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = dtmf[0];
<a name="l00713"></a>00713                <a class="code" href="channel_8h.html#a6cbcba5661d55216968cde8fdf913c89" title="Queue one or more frames to a channel&amp;#39;s frame queue.">ast_queue_frame</a>(tmp-&gt;<a class="code" href="structgtalk__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, &amp;f);
<a name="l00714"></a>00714                <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;GOOGLE! DTMF-relay event received: %c\n&quot;</span>, f.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>);
<a name="l00715"></a>00715             } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(iks_find_attrib(pak-&gt;x, <span class="stringliteral">&quot;dtmf&quot;</span>)) { <span class="comment">/* 250 millasecond default */</span>
<a name="l00716"></a>00716                <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> <a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a> = {<a class="code" href="frame_8h.html#a248afd6c02044259a386f6b7aee922a2">AST_FRAME_DTMF</a>, };
<a name="l00717"></a>00717                f.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = dtmf[0];
<a name="l00718"></a>00718                <a class="code" href="channel_8h.html#a6cbcba5661d55216968cde8fdf913c89" title="Queue one or more frames to a channel&amp;#39;s frame queue.">ast_queue_frame</a>(tmp-&gt;<a class="code" href="structgtalk__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, &amp;f);
<a name="l00719"></a>00719                <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;GOOGLE! DTMF-relay event received: %c\n&quot;</span>, f.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>);
<a name="l00720"></a>00720             }
<a name="l00721"></a>00721          }
<a name="l00722"></a>00722       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((dtmfnode = iks_find_with_attrib(pak-&gt;x, <span class="stringliteral">&quot;gtalk&quot;</span>, <span class="stringliteral">&quot;action&quot;</span>, <span class="stringliteral">&quot;session-info&quot;</span>))) {
<a name="l00723"></a>00723          <span class="keywordflow">if</span>((dtmfchild = iks_find(dtmfnode, <span class="stringliteral">&quot;dtmf&quot;</span>))) {
<a name="l00724"></a>00724             <span class="keywordflow">if</span>((dtmf = iks_find_attrib(dtmfchild, <span class="stringliteral">&quot;code&quot;</span>))) {
<a name="l00725"></a>00725                <span class="keywordflow">if</span>(iks_find_with_attrib(dtmfnode, <span class="stringliteral">&quot;dtmf&quot;</span>, <span class="stringliteral">&quot;action&quot;</span>, <span class="stringliteral">&quot;button-up&quot;</span>)) {
<a name="l00726"></a>00726                   <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> <a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a> = {<a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a98e65764bc963016c394bcc1bad6540b">AST_FRAME_DTMF_END</a>, };
<a name="l00727"></a>00727                   f.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = dtmf[0];
<a name="l00728"></a>00728                   <a class="code" href="channel_8h.html#a6cbcba5661d55216968cde8fdf913c89" title="Queue one or more frames to a channel&amp;#39;s frame queue.">ast_queue_frame</a>(tmp-&gt;<a class="code" href="structgtalk__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, &amp;f);
<a name="l00729"></a>00729                   <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;GOOGLE! DTMF-relay event received: %c\n&quot;</span>, f.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>);
<a name="l00730"></a>00730                } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(iks_find_with_attrib(dtmfnode, <span class="stringliteral">&quot;dtmf&quot;</span>, <span class="stringliteral">&quot;action&quot;</span>, <span class="stringliteral">&quot;button-down&quot;</span>)) {
<a name="l00731"></a>00731                   <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> <a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a> = {<a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a9b350360a64b55c7590f1ec03db480be">AST_FRAME_DTMF_BEGIN</a>, };
<a name="l00732"></a>00732                   f.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = dtmf[0];
<a name="l00733"></a>00733                   <a class="code" href="channel_8h.html#a6cbcba5661d55216968cde8fdf913c89" title="Queue one or more frames to a channel&amp;#39;s frame queue.">ast_queue_frame</a>(tmp-&gt;<a class="code" href="structgtalk__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, &amp;f);
<a name="l00734"></a>00734                   <a class="code" href="logger_8h.html#afcd8b407dfb3f461488abf7d1ed70fb9">ast_verbose</a>(<span class="stringliteral">&quot;GOOGLE! DTMF-relay event received: %c\n&quot;</span>, f.<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>);
<a name="l00735"></a>00735                }
<a name="l00736"></a>00736             }
<a name="l00737"></a>00737          }
<a name="l00738"></a>00738       }
<a name="l00739"></a>00739       <a class="code" href="chan__gtalk_8c.html#ac60c0cc7813dc8afb593b62633a0236f">gtalk_response</a>(client, from, pak, NULL, NULL);
<a name="l00740"></a>00740       <span class="keywordflow">return</span> 1;
<a name="l00741"></a>00741    } <span class="keywordflow">else</span>
<a name="l00742"></a>00742       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Whoa, didn&apos;t find call!\n&quot;</span>);
<a name="l00743"></a>00743 
<a name="l00744"></a>00744    <a class="code" href="chan__gtalk_8c.html#ac60c0cc7813dc8afb593b62633a0236f">gtalk_response</a>(client, from, pak, NULL, NULL);
<a name="l00745"></a>00745    <span class="keywordflow">return</span> 1;
<a name="l00746"></a>00746 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae40647d59ad2609a48c2c7e4b3ec1c3c"></a><!-- doxytag: member="chan_gtalk.c::gtalk_hangup" ref="ae40647d59ad2609a48c2c7e4b3ec1c3c" args="(struct ast_channel *ast)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int gtalk_hangup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>ast</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Hangup a call through the <a class="el" href="structgtalk.html">gtalk</a> proxy channel. </p>

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l01617">1617</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="chan__gtalk_8c_source.html#l00107">gtalk_pvt::alreadygone</a>, <a class="el" href="loader_8c_source.html#l01171">ast_module_unref()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="chan__gtalk_8c_source.html#l01078">gtalk_action()</a>, <a class="el" href="chan__gtalk_8c_source.html#l01126">gtalk_free_pvt()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00098">gtalk_pvt::lock</a>, <a class="el" href="chan__gtalk_8c_source.html#l00115">gtalk_pvt::owner</a>, <a class="el" href="chan__gtalk_8c_source.html#l00100">gtalk_pvt::parent</a>, and <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>.</p>

<p>Referenced by <a class="el" href="chan__gtalk_8c_source.html#l01154">gtalk_newcall()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01618"></a>01618 {
<a name="l01619"></a>01619    <span class="keyword">struct </span><a class="code" href="structgtalk__pvt.html">gtalk_pvt</a> *p = ast-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l01620"></a>01620    <span class="keyword">struct </span><a class="code" href="structgtalk.html">gtalk</a> *client;
<a name="l01621"></a>01621 
<a name="l01622"></a>01622    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;p-&gt;<a class="code" href="structgtalk__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01623"></a>01623    client = p-&gt;<a class="code" href="structgtalk__pvt.html#a06cbd7bfad0d73228cdd0dbb68fb999f">parent</a>;
<a name="l01624"></a>01624    p-&gt;<a class="code" href="structgtalk__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = NULL;
<a name="l01625"></a>01625    ast-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a> = NULL;
<a name="l01626"></a>01626    <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="structgtalk__pvt.html#ac43993a73742eff145b861107a1afa0d">alreadygone</a>)
<a name="l01627"></a>01627       <a class="code" href="chan__gtalk_8c.html#a97da48981722a1f8484aac2ea2e48da5">gtalk_action</a>(client, p, <span class="stringliteral">&quot;terminate&quot;</span>);
<a name="l01628"></a>01628    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structgtalk__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01629"></a>01629 
<a name="l01630"></a>01630    <a class="code" href="chan__gtalk_8c.html#a46487d9263cd957964d6056bfe183d6c">gtalk_free_pvt</a>(client, p);
<a name="l01631"></a>01631    <a class="code" href="module_8h.html#ac65fa15b16dbc563a2424af744ab003d">ast_module_unref</a>(<a class="code" href="structast__module__info.html">ast_module_info</a>-&gt;self);
<a name="l01632"></a>01632 
<a name="l01633"></a>01633    <span class="keywordflow">return</span> 0;
<a name="l01634"></a>01634 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="afdd3edee003bac0ad10d23a88b9b2a62"></a><!-- doxytag: member="chan_gtalk.c::gtalk_hangup_farend" ref="afdd3edee003bac0ad10d23a88b9b2a62" args="(struct gtalk *client, ikspak *pak)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int gtalk_hangup_farend </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structgtalk.html">gtalk</a> *&nbsp;</td>
          <td class="paramname"> <em>client</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ikspak *&nbsp;</td>
          <td class="paramname"> <em>pak</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l00748">748</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="chan__gtalk_8c_source.html#l00107">gtalk_pvt::alreadygone</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8c_source.html#l01091">ast_queue_hangup()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00140">gtalk::connection</a>, <a class="el" href="chan__gtalk_8c_source.html#l00571">gtalk_response()</a>, <a class="el" href="jabber_8h_source.html#l00149">aji_client::jid</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="chan__gtalk_8c_source.html#l00120">gtalk_pvt::next</a>, <a class="el" href="chan__gtalk_8c_source.html#l00115">gtalk_pvt::owner</a>, <a class="el" href="chan__gtalk_8c_source.html#l00142">gtalk::p</a>, and <a class="el" href="chan__gtalk_8c_source.html#l00101">gtalk_pvt::sid</a>.</p>

<p>Referenced by <a class="el" href="chan__gtalk_8c_source.html#l01764">gtalk_parser()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00749"></a>00749 {
<a name="l00750"></a>00750    <span class="keyword">struct </span><a class="code" href="structgtalk__pvt.html">gtalk_pvt</a> *tmp;
<a name="l00751"></a>00751    <span class="keywordtype">char</span> *from;
<a name="l00752"></a>00752 
<a name="l00753"></a>00753    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;The client is %s\n&quot;</span>, client-&gt;name);
<a name="l00754"></a>00754    <span class="comment">/* Make sure our new call doesn&apos;t exist yet */</span>
<a name="l00755"></a>00755    <span class="keywordflow">for</span> (tmp = client-&gt;<a class="code" href="structgtalk.html#a87c10b8b2ce58b28854a6cf5a7462bbd">p</a>; tmp; tmp = tmp-&gt;<a class="code" href="structgtalk__pvt.html#ad52b2b57b8b3ac8cab36317c65547157">next</a>) {
<a name="l00756"></a>00756       <span class="keywordflow">if</span> (iks_find_with_attrib(pak-&gt;x, <span class="stringliteral">&quot;session&quot;</span>, <span class="stringliteral">&quot;id&quot;</span>, tmp-&gt;<a class="code" href="structgtalk__pvt.html#a11855a8fa7877d4395e800ce1bb3ed8d">sid</a>))
<a name="l00757"></a>00757          <span class="keywordflow">break</span>;
<a name="l00758"></a>00758    }
<a name="l00759"></a>00759    from = iks_find_attrib(pak-&gt;x, <span class="stringliteral">&quot;to&quot;</span>);
<a name="l00760"></a>00760    <span class="keywordflow">if</span>(!from)
<a name="l00761"></a>00761       from = client-&gt;<a class="code" href="structgtalk.html#a22eb965539587ef7d2b0340d57159e3a">connection</a>-&gt;<a class="code" href="structaji__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;full;
<a name="l00762"></a>00762 
<a name="l00763"></a>00763    <span class="keywordflow">if</span> (tmp) {
<a name="l00764"></a>00764       tmp-&gt;<a class="code" href="structgtalk__pvt.html#ac43993a73742eff145b861107a1afa0d">alreadygone</a> = 1;
<a name="l00765"></a>00765       <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="structgtalk__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)
<a name="l00766"></a>00766          <a class="code" href="channel_8h.html#a30bcf0418189567bc84ff32034f79f28" title="Queue a hangup frame.">ast_queue_hangup</a>(tmp-&gt;<a class="code" href="structgtalk__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l00767"></a>00767    } <span class="keywordflow">else</span>
<a name="l00768"></a>00768       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Whoa, didn&apos;t find call!\n&quot;</span>);
<a name="l00769"></a>00769    <a class="code" href="chan__gtalk_8c.html#ac60c0cc7813dc8afb593b62633a0236f">gtalk_response</a>(client, from, pak, NULL, NULL);
<a name="l00770"></a>00770    <span class="keywordflow">return</span> 1;
<a name="l00771"></a>00771 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1d613b759165b8f5bba3dca27dfee45c"></a><!-- doxytag: member="chan_gtalk.c::gtalk_indicate" ref="a1d613b759165b8f5bba3dca27dfee45c" args="(struct ast_channel *ast, int condition, const void *data, size_t datalen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int gtalk_indicate </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>ast</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>condition</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>datalen</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l01483">1483</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="frame_8h_source.html#l00313">AST_CONTROL_HOLD</a>, <a class="el" href="frame_8h_source.html#l00314">AST_CONTROL_UNHOLD</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8c_source.html#l05538">ast_moh_start()</a>, <a class="el" href="channel_8c_source.html#l05549">ast_moh_stop()</a>, and <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01484"></a>01484 {
<a name="l01485"></a>01485    <span class="keywordtype">int</span> res = 0;
<a name="l01486"></a>01486 
<a name="l01487"></a>01487    <span class="keywordflow">switch</span> (condition) {
<a name="l01488"></a>01488    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390ab99a3d1c08c5ae8bca078c7cd1ec02f5">AST_CONTROL_HOLD</a>:
<a name="l01489"></a>01489       <a class="code" href="musiconhold_8h.html#a2acec01f2fddd8ca494d874003815cf7" title="Turn on music on hold on a given channel.">ast_moh_start</a>(ast, data, NULL);
<a name="l01490"></a>01490       <span class="keywordflow">break</span>;
<a name="l01491"></a>01491    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a3e7629b5f7e39f1cc8ad2e51e266f91e">AST_CONTROL_UNHOLD</a>:
<a name="l01492"></a>01492       <a class="code" href="musiconhold_8h.html#a52fead32f69533450f3c05b2e6960149" title="Turn off music on hold on a given channel.">ast_moh_stop</a>(ast);
<a name="l01493"></a>01493       <span class="keywordflow">break</span>;
<a name="l01494"></a>01494    <span class="keywordflow">default</span>:
<a name="l01495"></a>01495       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Don&apos;t know how to indicate condition &apos;%d&apos;\n&quot;</span>, condition);
<a name="l01496"></a>01496       res = -1;
<a name="l01497"></a>01497    }
<a name="l01498"></a>01498 
<a name="l01499"></a>01499    <span class="keywordflow">return</span> res;
<a name="l01500"></a>01500 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="adbb80c94f25deee90406ec8e4b207db9"></a><!-- doxytag: member="chan_gtalk.c::gtalk_invite" ref="adbb80c94f25deee90406ec8e4b207db9" args="(struct gtalk_pvt *p, char *to, char *from, char *sid, int initiator)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int gtalk_invite </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structgtalk__pvt.html">gtalk_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>to</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>from</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>sid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>initiator</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l00379">379</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="chan__gtalk_8c_source.html#l00274">add_codec_to_answer()</a>, <a class="el" href="res__jabber_8c_source.html#l02038">ast_aji_increment_mid()</a>, <a class="el" href="res__jabber_8c_source.html#l00818">ast_aji_send()</a>, <a class="el" href="frame_8c_source.html#l01032">ast_codec_pref_index()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="chan__gtalk_8c_source.html#l00149">gtalk::capability</a>, <a class="el" href="chan__gtalk_8c_source.html#l00140">gtalk::connection</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="jabber_8h_source.html#l00148">aji_client::mid</a>, <a class="el" href="chan__gtalk_8c_source.html#l00100">gtalk_pvt::parent</a>, and <a class="el" href="chan__gtalk_8c_source.html#l00143">gtalk::prefs</a>.</p>

<p>Referenced by <a class="el" href="chan__gtalk_8c_source.html#l00513">gtalk_answer()</a>, and <a class="el" href="chan__gtalk_8c_source.html#l01593">gtalk_call()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00380"></a>00380 {
<a name="l00381"></a>00381    <span class="keyword">struct </span><a class="code" href="structgtalk.html">gtalk</a> *client = p-&gt;<a class="code" href="structgtalk__pvt.html#a06cbd7bfad0d73228cdd0dbb68fb999f">parent</a>;
<a name="l00382"></a>00382    iks *iq, *<a class="code" href="structgtalk.html">gtalk</a>, *dcodecs, *payload_telephone, *transport;
<a name="l00383"></a>00383    <span class="keywordtype">int</span> x;
<a name="l00384"></a>00384    <span class="keywordtype">int</span> pref_codec = 0;
<a name="l00385"></a>00385    <span class="keywordtype">int</span> alreadysent = 0;
<a name="l00386"></a>00386    <span class="keywordtype">int</span> codecs_num = 0;
<a name="l00387"></a>00387    <span class="keywordtype">char</span> *lowerto = NULL;
<a name="l00388"></a>00388 
<a name="l00389"></a>00389    iq = iks_new(<span class="stringliteral">&quot;iq&quot;</span>);
<a name="l00390"></a>00390    gtalk = iks_new(<span class="stringliteral">&quot;session&quot;</span>);
<a name="l00391"></a>00391    dcodecs = iks_new(<span class="stringliteral">&quot;description&quot;</span>);
<a name="l00392"></a>00392    transport = iks_new(<span class="stringliteral">&quot;transport&quot;</span>);
<a name="l00393"></a>00393    payload_telephone = iks_new(<span class="stringliteral">&quot;payload-type&quot;</span>);
<a name="l00394"></a>00394    <span class="keywordflow">if</span> (!(iq &amp;&amp; gtalk &amp;&amp; dcodecs &amp;&amp; transport &amp;&amp; payload_telephone)){
<a name="l00395"></a>00395       iks_delete(iq);
<a name="l00396"></a>00396       iks_delete(gtalk);
<a name="l00397"></a>00397       iks_delete(dcodecs);
<a name="l00398"></a>00398       iks_delete(transport);
<a name="l00399"></a>00399       iks_delete(payload_telephone);
<a name="l00400"></a>00400       
<a name="l00401"></a>00401       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not allocate iksemel nodes\n&quot;</span>);
<a name="l00402"></a>00402       <span class="keywordflow">return</span> 0;
<a name="l00403"></a>00403    }
<a name="l00404"></a>00404    iks_insert_attrib(dcodecs, <span class="stringliteral">&quot;xmlns&quot;</span>, <span class="stringliteral">&quot;http://www.google.com/session/phone&quot;</span>);
<a name="l00405"></a>00405    iks_insert_attrib(dcodecs, <span class="stringliteral">&quot;xml:lang&quot;</span>, <span class="stringliteral">&quot;en&quot;</span>);
<a name="l00406"></a>00406 
<a name="l00407"></a>00407    <span class="keywordflow">for</span> (x = 0; x &lt; 32; x++) {
<a name="l00408"></a>00408       <span class="keywordflow">if</span> (!(pref_codec = <a class="code" href="frame_8h.html#af9dd4cbc4b715644df1afe4964169c9b" title="Codec located at a particular place in the preference index.">ast_codec_pref_index</a>(&amp;client-&gt;<a class="code" href="structgtalk.html#a46262e3cc2baf55a72542567ccfe86d9">prefs</a>, x)))
<a name="l00409"></a>00409          <span class="keywordflow">break</span>;
<a name="l00410"></a>00410       <span class="keywordflow">if</span> (!(client-&gt;<a class="code" href="structgtalk.html#afa05b14ff7f76f303c784c00c4c63fa7">capability</a> &amp; pref_codec))
<a name="l00411"></a>00411          <span class="keywordflow">continue</span>;
<a name="l00412"></a>00412       <span class="keywordflow">if</span> (alreadysent &amp; pref_codec)
<a name="l00413"></a>00413          <span class="keywordflow">continue</span>;
<a name="l00414"></a>00414       codecs_num = <a class="code" href="chan__gtalk_8c.html#a8b0bdafb8aec1c12f09676cf21095769">add_codec_to_answer</a>(p, pref_codec, dcodecs);
<a name="l00415"></a>00415       alreadysent |= pref_codec;
<a name="l00416"></a>00416    }
<a name="l00417"></a>00417    
<a name="l00418"></a>00418    <span class="keywordflow">if</span> (codecs_num) {
<a name="l00419"></a>00419       <span class="comment">/* only propose DTMF within an audio session */</span>
<a name="l00420"></a>00420       iks_insert_attrib(payload_telephone, <span class="stringliteral">&quot;id&quot;</span>, <span class="stringliteral">&quot;106&quot;</span>);
<a name="l00421"></a>00421       iks_insert_attrib(payload_telephone, <span class="stringliteral">&quot;name&quot;</span>, <span class="stringliteral">&quot;telephone-event&quot;</span>);
<a name="l00422"></a>00422       iks_insert_attrib(payload_telephone, <span class="stringliteral">&quot;clockrate&quot;</span>, <span class="stringliteral">&quot;8000&quot;</span>);
<a name="l00423"></a>00423    }
<a name="l00424"></a>00424    iks_insert_attrib(transport,<span class="stringliteral">&quot;xmlns&quot;</span>,<span class="stringliteral">&quot;http://www.google.com/transport/p2p&quot;</span>);
<a name="l00425"></a>00425    
<a name="l00426"></a>00426    iks_insert_attrib(iq, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;set&quot;</span>);
<a name="l00427"></a>00427    iks_insert_attrib(iq, <span class="stringliteral">&quot;to&quot;</span>, to);
<a name="l00428"></a>00428    iks_insert_attrib(iq, <span class="stringliteral">&quot;from&quot;</span>, from);
<a name="l00429"></a>00429    iks_insert_attrib(iq, <span class="stringliteral">&quot;id&quot;</span>, client-&gt;<a class="code" href="structgtalk.html#a22eb965539587ef7d2b0340d57159e3a">connection</a>-&gt;<a class="code" href="structaji__client.html#abee5661fa88af477fe47bbbd21136301">mid</a>);
<a name="l00430"></a>00430    <a class="code" href="jabber_8h.html#a6e4ae95e74b73933aa6e6d6817df9023" title="increments the mid field for messages and other events.">ast_aji_increment_mid</a>(client-&gt;<a class="code" href="structgtalk.html#a22eb965539587ef7d2b0340d57159e3a">connection</a>-&gt;<a class="code" href="structaji__client.html#abee5661fa88af477fe47bbbd21136301">mid</a>);
<a name="l00431"></a>00431 
<a name="l00432"></a>00432    iks_insert_attrib(gtalk, <span class="stringliteral">&quot;xmlns&quot;</span>, <span class="stringliteral">&quot;http://www.google.com/session&quot;</span>);
<a name="l00433"></a>00433    iks_insert_attrib(gtalk, <span class="stringliteral">&quot;type&quot;</span>,initiator ? <span class="stringliteral">&quot;initiate&quot;</span>: <span class="stringliteral">&quot;accept&quot;</span>);
<a name="l00434"></a>00434    <span class="comment">/* put the initiator attribute to lower case if we receive the call </span>
<a name="l00435"></a>00435 <span class="comment">    * otherwise GoogleTalk won&apos;t establish the session */</span>
<a name="l00436"></a>00436    <span class="keywordflow">if</span> (!initiator) {
<a name="l00437"></a>00437            <span class="keywordtype">char</span> c;
<a name="l00438"></a>00438            <span class="keywordtype">char</span> *t = lowerto = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(to);
<a name="l00439"></a>00439       <span class="keywordflow">while</span> (((c = *t) != <span class="charliteral">&apos;/&apos;</span>) &amp;&amp; (*t++ = tolower(c)));
<a name="l00440"></a>00440    }
<a name="l00441"></a>00441    iks_insert_attrib(gtalk, <span class="stringliteral">&quot;initiator&quot;</span>, initiator ? from : lowerto);
<a name="l00442"></a>00442    iks_insert_attrib(gtalk, <span class="stringliteral">&quot;id&quot;</span>, sid);
<a name="l00443"></a>00443    iks_insert_node(iq, gtalk);
<a name="l00444"></a>00444    iks_insert_node(gtalk, dcodecs);
<a name="l00445"></a>00445    iks_insert_node(gtalk, transport);
<a name="l00446"></a>00446    iks_insert_node(dcodecs, payload_telephone);
<a name="l00447"></a>00447 
<a name="l00448"></a>00448    <a class="code" href="jabber_8h.html#a3c77ceecc909619207e971421fc3e9ef" title="Wraps raw sending.">ast_aji_send</a>(client-&gt;<a class="code" href="structgtalk.html#a22eb965539587ef7d2b0340d57159e3a">connection</a>, iq);
<a name="l00449"></a>00449 
<a name="l00450"></a>00450    iks_delete(payload_telephone);
<a name="l00451"></a>00451    iks_delete(transport);
<a name="l00452"></a>00452    iks_delete(dcodecs);
<a name="l00453"></a>00453    iks_delete(gtalk);
<a name="l00454"></a>00454    iks_delete(iq);
<a name="l00455"></a>00455    <span class="keywordflow">return</span> 1;
<a name="l00456"></a>00456 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9647000d3f1d4b0364443c472e28af78"></a><!-- doxytag: member="chan_gtalk.c::gtalk_invite_response" ref="a9647000d3f1d4b0364443c472e28af78" args="(struct gtalk_pvt *p, char *to, char *from, char *sid, int initiator)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int gtalk_invite_response </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structgtalk__pvt.html">gtalk_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>to</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>from</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>sid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>initiator</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l00458">458</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="res__jabber_8c_source.html#l02038">ast_aji_increment_mid()</a>, <a class="el" href="res__jabber_8c_source.html#l00818">ast_aji_send()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="chan__gtalk_8c_source.html#l00140">gtalk::connection</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="jabber_8h_source.html#l00148">aji_client::mid</a>, and <a class="el" href="chan__gtalk_8c_source.html#l00100">gtalk_pvt::parent</a>.</p>

<p>Referenced by <a class="el" href="chan__gtalk_8c_source.html#l01154">gtalk_newcall()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00459"></a>00459 {
<a name="l00460"></a>00460    iks *iq, *session, *transport;
<a name="l00461"></a>00461    <span class="keywordtype">char</span> *lowerto = NULL;
<a name="l00462"></a>00462 
<a name="l00463"></a>00463    iq = iks_new(<span class="stringliteral">&quot;iq&quot;</span>);
<a name="l00464"></a>00464    session = iks_new(<span class="stringliteral">&quot;session&quot;</span>);
<a name="l00465"></a>00465    transport = iks_new(<span class="stringliteral">&quot;transport&quot;</span>);
<a name="l00466"></a>00466    <span class="keywordflow">if</span>(!(iq &amp;&amp; session &amp;&amp; transport)) {
<a name="l00467"></a>00467       iks_delete(iq);
<a name="l00468"></a>00468       iks_delete(session);
<a name="l00469"></a>00469       iks_delete(transport);
<a name="l00470"></a>00470       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot; Unable to allocate IKS node\n&quot;</span>);
<a name="l00471"></a>00471       <span class="keywordflow">return</span> -1;
<a name="l00472"></a>00472    }
<a name="l00473"></a>00473    iks_insert_attrib(iq, <span class="stringliteral">&quot;from&quot;</span>, from);
<a name="l00474"></a>00474    iks_insert_attrib(iq, <span class="stringliteral">&quot;to&quot;</span>, to);
<a name="l00475"></a>00475    iks_insert_attrib(iq, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;set&quot;</span>);
<a name="l00476"></a>00476    iks_insert_attrib(iq, <span class="stringliteral">&quot;id&quot;</span>,p-&gt;<a class="code" href="structgtalk__pvt.html#a06cbd7bfad0d73228cdd0dbb68fb999f">parent</a>-&gt;<a class="code" href="structgtalk.html#a22eb965539587ef7d2b0340d57159e3a">connection</a>-&gt;<a class="code" href="structaji__client.html#abee5661fa88af477fe47bbbd21136301">mid</a>);
<a name="l00477"></a>00477    <a class="code" href="jabber_8h.html#a6e4ae95e74b73933aa6e6d6817df9023" title="increments the mid field for messages and other events.">ast_aji_increment_mid</a>(p-&gt;<a class="code" href="structgtalk__pvt.html#a06cbd7bfad0d73228cdd0dbb68fb999f">parent</a>-&gt;<a class="code" href="structgtalk.html#a22eb965539587ef7d2b0340d57159e3a">connection</a>-&gt;<a class="code" href="structaji__client.html#abee5661fa88af477fe47bbbd21136301">mid</a>);
<a name="l00478"></a>00478    iks_insert_attrib(session, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;transport-accept&quot;</span>);
<a name="l00479"></a>00479    iks_insert_attrib(session, <span class="stringliteral">&quot;id&quot;</span>, sid);
<a name="l00480"></a>00480    <span class="comment">/* put the initiator attribute to lower case if we receive the call </span>
<a name="l00481"></a>00481 <span class="comment">    * otherwise GoogleTalk won&apos;t establish the session */</span>
<a name="l00482"></a>00482    <span class="keywordflow">if</span> (!initiator) {
<a name="l00483"></a>00483            <span class="keywordtype">char</span> c;
<a name="l00484"></a>00484       <span class="keywordtype">char</span> *t = lowerto = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(to);
<a name="l00485"></a>00485       <span class="keywordflow">while</span> (((c = *t) != <span class="charliteral">&apos;/&apos;</span>) &amp;&amp; (*t++ = tolower(c)));
<a name="l00486"></a>00486    }
<a name="l00487"></a>00487    iks_insert_attrib(session, <span class="stringliteral">&quot;initiator&quot;</span>, initiator ? from : lowerto);
<a name="l00488"></a>00488    iks_insert_attrib(session, <span class="stringliteral">&quot;xmlns&quot;</span>, <span class="stringliteral">&quot;http://www.google.com/session&quot;</span>);
<a name="l00489"></a>00489    iks_insert_attrib(transport, <span class="stringliteral">&quot;xmlns&quot;</span>, <span class="stringliteral">&quot;http://www.google.com/transport/p2p&quot;</span>);
<a name="l00490"></a>00490    iks_insert_node(iq,session);
<a name="l00491"></a>00491    iks_insert_node(session,transport);
<a name="l00492"></a>00492    <a class="code" href="jabber_8h.html#a3c77ceecc909619207e971421fc3e9ef" title="Wraps raw sending.">ast_aji_send</a>(p-&gt;<a class="code" href="structgtalk__pvt.html#a06cbd7bfad0d73228cdd0dbb68fb999f">parent</a>-&gt;<a class="code" href="structgtalk.html#a22eb965539587ef7d2b0340d57159e3a">connection</a>, iq);
<a name="l00493"></a>00493 
<a name="l00494"></a>00494    iks_delete(transport);
<a name="l00495"></a>00495    iks_delete(session);
<a name="l00496"></a>00496    iks_delete(iq);
<a name="l00497"></a>00497    <span class="keywordflow">return</span> 1;
<a name="l00498"></a>00498 
<a name="l00499"></a>00499 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab1d8e1f165c49766885eeefb88ee1683"></a><!-- doxytag: member="chan_gtalk.c::gtalk_is_accepted" ref="ab1d8e1f165c49766885eeefb88ee1683" args="(struct gtalk *client, ikspak *pak)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int gtalk_is_accepted </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structgtalk.html">gtalk</a> *&nbsp;</td>
          <td class="paramname"> <em>client</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ikspak *&nbsp;</td>
          <td class="paramname"> <em>pak</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l00656">656</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00140">gtalk::connection</a>, <a class="el" href="chan__gtalk_8c_source.html#l00571">gtalk_response()</a>, <a class="el" href="jabber_8h_source.html#l00149">aji_client::jid</a>, <a class="el" href="logger_8h_source.html#l00119">LOG_DEBUG</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="chan__gtalk_8c_source.html#l00120">gtalk_pvt::next</a>, <a class="el" href="chan__gtalk_8c_source.html#l00142">gtalk::p</a>, and <a class="el" href="chan__gtalk_8c_source.html#l00101">gtalk_pvt::sid</a>.</p>

<p>Referenced by <a class="el" href="chan__gtalk_8c_source.html#l01764">gtalk_parser()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00657"></a>00657 {
<a name="l00658"></a>00658    <span class="keyword">struct </span><a class="code" href="structgtalk__pvt.html">gtalk_pvt</a> *tmp;
<a name="l00659"></a>00659    <span class="keywordtype">char</span> *from;
<a name="l00660"></a>00660 
<a name="l00661"></a>00661    <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;The client is %s\n&quot;</span>, client-&gt;name);
<a name="l00662"></a>00662    <span class="comment">/* find corresponding call */</span>
<a name="l00663"></a>00663    <span class="keywordflow">for</span> (tmp = client-&gt;<a class="code" href="structgtalk.html#a87c10b8b2ce58b28854a6cf5a7462bbd">p</a>; tmp; tmp = tmp-&gt;<a class="code" href="structgtalk__pvt.html#ad52b2b57b8b3ac8cab36317c65547157">next</a>) {
<a name="l00664"></a>00664       <span class="keywordflow">if</span> (iks_find_with_attrib(pak-&gt;x, <span class="stringliteral">&quot;session&quot;</span>, <span class="stringliteral">&quot;id&quot;</span>, tmp-&gt;<a class="code" href="structgtalk__pvt.html#a11855a8fa7877d4395e800ce1bb3ed8d">sid</a>))
<a name="l00665"></a>00665          <span class="keywordflow">break</span>;
<a name="l00666"></a>00666    }
<a name="l00667"></a>00667 
<a name="l00668"></a>00668    from = iks_find_attrib(pak-&gt;x, <span class="stringliteral">&quot;to&quot;</span>);
<a name="l00669"></a>00669    <span class="keywordflow">if</span>(!from)
<a name="l00670"></a>00670       from = client-&gt;<a class="code" href="structgtalk.html#a22eb965539587ef7d2b0340d57159e3a">connection</a>-&gt;<a class="code" href="structaji__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;full;
<a name="l00671"></a>00671 
<a name="l00672"></a>00672    <span class="keywordflow">if</span> (!tmp)
<a name="l00673"></a>00673       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Whoa, didn&apos;t find call!\n&quot;</span>);
<a name="l00674"></a>00674 
<a name="l00675"></a>00675    <span class="comment">/* answer &apos;iq&apos; packet to let the remote peer know that we&apos;re alive */</span>
<a name="l00676"></a>00676    <a class="code" href="chan__gtalk_8c.html#ac60c0cc7813dc8afb593b62633a0236f">gtalk_response</a>(client, from, pak, NULL, NULL);
<a name="l00677"></a>00677    <span class="keywordflow">return</span> 1;
<a name="l00678"></a>00678 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3d19065e34e7d81391accb2ac3cb7cf1"></a><!-- doxytag: member="chan_gtalk.c::gtalk_is_answered" ref="a3d19065e34e7d81391accb2ac3cb7cf1" args="(struct gtalk *client, ikspak *pak)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int gtalk_is_answered </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structgtalk.html">gtalk</a> *&nbsp;</td>
          <td class="paramname"> <em>client</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ikspak *&nbsp;</td>
          <td class="paramname"> <em>pak</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l00603">603</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="frame_8h_source.html#l00301">AST_CONTROL_ANSWER</a>, <a class="el" href="frame_8c_source.html#l00586">ast_getformatname_multiple()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8c_source.html#l01123">ast_queue_control()</a>, <a class="el" href="channel_8c_source.html#l01091">ast_queue_hangup()</a>, <a class="el" href="rtp_8c_source.html#l02319">ast_rtp_get_current_formats()</a>, <a class="el" href="rtp_8c_source.html#l02234">ast_rtp_set_m_type()</a>, <a class="el" href="rtp_8c_source.html#l02310">ast_rtp_set_rtpmap_type()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00108">gtalk_pvt::capability</a>, <a class="el" href="chan__gtalk_8c_source.html#l00140">gtalk::connection</a>, <a class="el" href="chan__gtalk_8c_source.html#l00571">gtalk_response()</a>, <a class="el" href="jabber_8h_source.html#l00149">aji_client::jid</a>, <a class="el" href="chan__gtalk_8c_source.html#l00118">gtalk_pvt::jointcapability</a>, <a class="el" href="logger_8h_source.html#l00119">LOG_DEBUG</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__gtalk_8c_source.html#l00120">gtalk_pvt::next</a>, <a class="el" href="chan__gtalk_8c_source.html#l00115">gtalk_pvt::owner</a>, <a class="el" href="chan__gtalk_8c_source.html#l00142">gtalk::p</a>, <a class="el" href="chan__gtalk_8c_source.html#l00119">gtalk_pvt::peercapability</a>, <a class="el" href="chan__gtalk_8c_source.html#l00116">gtalk_pvt::rtp</a>, and <a class="el" href="chan__gtalk_8c_source.html#l00101">gtalk_pvt::sid</a>.</p>

<p>Referenced by <a class="el" href="chan__gtalk_8c_source.html#l01764">gtalk_parser()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00604"></a>00604 {
<a name="l00605"></a>00605    <span class="keyword">struct </span><a class="code" href="structgtalk__pvt.html">gtalk_pvt</a> *tmp;
<a name="l00606"></a>00606    <span class="keywordtype">char</span> *from;
<a name="l00607"></a>00607    iks *codec;
<a name="l00608"></a>00608    <span class="keywordtype">char</span> s1[BUFSIZ], s2[BUFSIZ], s3[BUFSIZ];
<a name="l00609"></a>00609    <span class="keywordtype">int</span> peernoncodeccapability;
<a name="l00610"></a>00610 
<a name="l00611"></a>00611    <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;The client is %s\n&quot;</span>, client-&gt;name);
<a name="l00612"></a>00612    <span class="comment">/* Make sure our new call doesn&apos;t exist yet */</span>
<a name="l00613"></a>00613    <span class="keywordflow">for</span> (tmp = client-&gt;<a class="code" href="structgtalk.html#a87c10b8b2ce58b28854a6cf5a7462bbd">p</a>; tmp; tmp = tmp-&gt;<a class="code" href="structgtalk__pvt.html#ad52b2b57b8b3ac8cab36317c65547157">next</a>) {
<a name="l00614"></a>00614       <span class="keywordflow">if</span> (iks_find_with_attrib(pak-&gt;x, <span class="stringliteral">&quot;session&quot;</span>, <span class="stringliteral">&quot;id&quot;</span>, tmp-&gt;<a class="code" href="structgtalk__pvt.html#a11855a8fa7877d4395e800ce1bb3ed8d">sid</a>))
<a name="l00615"></a>00615          <span class="keywordflow">break</span>;
<a name="l00616"></a>00616    }
<a name="l00617"></a>00617 
<a name="l00618"></a>00618    <span class="comment">/* codec points to the first &lt;payload-type/&gt; tag */</span>
<a name="l00619"></a>00619    codec = iks_first_tag(iks_first_tag(iks_first_tag(pak-&gt;x)));
<a name="l00620"></a>00620    <span class="keywordflow">while</span> (codec) {
<a name="l00621"></a>00621       <a class="code" href="rtp_8h.html#a83fe16478ba4b99f0bc1798f1064baef" title="Activate payload type.">ast_rtp_set_m_type</a>(tmp-&gt;<a class="code" href="structgtalk__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>, atoi(iks_find_attrib(codec, <span class="stringliteral">&quot;id&quot;</span>)));
<a name="l00622"></a>00622       <a class="code" href="rtp_8h.html#a02a3ba4e11691cafd933cbb1e6225b3e" title="Set payload type to a known MIME media type for a codec.">ast_rtp_set_rtpmap_type</a>(tmp-&gt;<a class="code" href="structgtalk__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>, atoi(iks_find_attrib(codec, <span class="stringliteral">&quot;id&quot;</span>)), <span class="stringliteral">&quot;audio&quot;</span>, iks_find_attrib(codec, <span class="stringliteral">&quot;name&quot;</span>), 0);
<a name="l00623"></a>00623       codec = iks_next_tag(codec);
<a name="l00624"></a>00624    }
<a name="l00625"></a>00625    
<a name="l00626"></a>00626    <span class="comment">/* Now gather all of the codecs that we are asked for */</span>
<a name="l00627"></a>00627    <a class="code" href="rtp_8h.html#a0af7232148535d9bc024fc01579d4ec8" title="Return the union of all of the codecs that were set by rtp_set...() calls They&amp;#39;re...">ast_rtp_get_current_formats</a>(tmp-&gt;<a class="code" href="structgtalk__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>, &amp;tmp-&gt;<a class="code" href="structgtalk__pvt.html#a64c43413589d9d63d2ef5db58ed1a7c2">peercapability</a>, &amp;peernoncodeccapability);
<a name="l00628"></a>00628    
<a name="l00629"></a>00629    <span class="comment">/* at this point, we received an awser from the remote Gtalk client,</span>
<a name="l00630"></a>00630 <span class="comment">      which allows us to compare capabilities */</span>
<a name="l00631"></a>00631    tmp-&gt;<a class="code" href="structgtalk__pvt.html#a38f5730c90d9315eb1c0df6cfdc37da6">jointcapability</a> = tmp-&gt;<a class="code" href="structgtalk__pvt.html#afa05b14ff7f76f303c784c00c4c63fa7">capability</a> &amp; tmp-&gt;<a class="code" href="structgtalk__pvt.html#a64c43413589d9d63d2ef5db58ed1a7c2">peercapability</a>;
<a name="l00632"></a>00632    <span class="keywordflow">if</span> (!tmp-&gt;<a class="code" href="structgtalk__pvt.html#a38f5730c90d9315eb1c0df6cfdc37da6">jointcapability</a>) {
<a name="l00633"></a>00633       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Capabilities don&apos;t match : us - %s, peer - %s, combined - %s \n&quot;</span>, <a class="code" href="frame_8h.html#a37cdc7e78686b0bfa4e47e645f782b30" title="Get the names of a set of formats.">ast_getformatname_multiple</a>(s1, BUFSIZ, tmp-&gt;<a class="code" href="structgtalk__pvt.html#afa05b14ff7f76f303c784c00c4c63fa7">capability</a>),
<a name="l00634"></a>00634          <a class="code" href="frame_8h.html#a37cdc7e78686b0bfa4e47e645f782b30" title="Get the names of a set of formats.">ast_getformatname_multiple</a>(s2, BUFSIZ, tmp-&gt;<a class="code" href="structgtalk__pvt.html#a64c43413589d9d63d2ef5db58ed1a7c2">peercapability</a>),
<a name="l00635"></a>00635          <a class="code" href="frame_8h.html#a37cdc7e78686b0bfa4e47e645f782b30" title="Get the names of a set of formats.">ast_getformatname_multiple</a>(s3, BUFSIZ, tmp-&gt;<a class="code" href="structgtalk__pvt.html#a38f5730c90d9315eb1c0df6cfdc37da6">jointcapability</a>));
<a name="l00636"></a>00636       <span class="comment">/* close session if capabilities don&apos;t match */</span>
<a name="l00637"></a>00637       <a class="code" href="channel_8h.html#a30bcf0418189567bc84ff32034f79f28" title="Queue a hangup frame.">ast_queue_hangup</a>(tmp-&gt;<a class="code" href="structgtalk__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>);
<a name="l00638"></a>00638 
<a name="l00639"></a>00639       <span class="keywordflow">return</span> -1;
<a name="l00640"></a>00640 
<a name="l00641"></a>00641    }  
<a name="l00642"></a>00642    
<a name="l00643"></a>00643    from = iks_find_attrib(pak-&gt;x, <span class="stringliteral">&quot;to&quot;</span>);
<a name="l00644"></a>00644    <span class="keywordflow">if</span>(!from)
<a name="l00645"></a>00645       from = client-&gt;<a class="code" href="structgtalk.html#a22eb965539587ef7d2b0340d57159e3a">connection</a>-&gt;<a class="code" href="structaji__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;full;
<a name="l00646"></a>00646 
<a name="l00647"></a>00647    <span class="keywordflow">if</span> (tmp) {
<a name="l00648"></a>00648       <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="structgtalk__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)
<a name="l00649"></a>00649          <a class="code" href="channel_8h.html#a60f9d2b0ab8b7a839902313321163b28" title="Queue a control frame with payload.">ast_queue_control</a>(tmp-&gt;<a class="code" href="structgtalk__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe">AST_CONTROL_ANSWER</a>);
<a name="l00650"></a>00650    } <span class="keywordflow">else</span>
<a name="l00651"></a>00651       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Whoa, didn&apos;t find call!\n&quot;</span>);
<a name="l00652"></a>00652    <a class="code" href="chan__gtalk_8c.html#ac60c0cc7813dc8afb593b62633a0236f">gtalk_response</a>(client, from, pak, NULL, NULL);
<a name="l00653"></a>00653    <span class="keywordflow">return</span> 1;
<a name="l00654"></a>00654 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a87e308c2bc4ec47311b71ab1a613c44c"></a><!-- doxytag: member="chan_gtalk.c::gtalk_load_config" ref="a87e308c2bc4ec47311b71ab1a613c44c" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int gtalk_load_config </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l01901">1901</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="chan__gtalk_8c_source.html#l00153">gtalk::allowguest</a>, <a class="el" href="res__jabber_8c_source.html#l02976">ast_aji_get_clients()</a>, <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="config_8c_source.html#l00613">ast_category_browse()</a>, <a class="el" href="config_8h_source.html#l00139">ast_config_load</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="utils_8c_source.html#l00182">ast_gethostbyname()</a>, <a class="el" href="abstract__jb_8c_source.html#l00571">ast_jb_read_conf()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8h_source.html#l00135">AST_MAX_CONTEXT</a>, <a class="el" href="frame_8c_source.html#l01233">ast_parse_allow_disallow()</a>, <a class="el" href="utils_8c_source.html#l01311">ast_true()</a>, <a class="el" href="config_8c_source.html#l00411">ast_variable_browse()</a>, <a class="el" href="config_8c_source.html#l00435">ast_variable_retrieve()</a>, <a class="el" href="astobj_8h_source.html#l00776">ASTOBJ_CONTAINER_LINK</a>, <a class="el" href="astobj_8h_source.html#l00376">ASTOBJ_CONTAINER_TRAVERSE</a>, <a class="el" href="astobj_8h_source.html#l00264">ASTOBJ_INIT</a>, <a class="el" href="astobj_8h_source.html#l00109">ASTOBJ_UNLOCK</a>, <a class="el" href="astobj_8h_source.html#l00218">ASTOBJ_UNREF</a>, <a class="el" href="astobj_8h_source.html#l00104">ASTOBJ_WRLOCK</a>, <a class="el" href="chan__gtalk_8c_source.html#l00149">gtalk::capability</a>, <a class="el" href="res__jabber_8c_source.html#l00246">clients</a>, <a class="el" href="config_8h_source.html#l00050">CONFIG_STATUS_FILEINVALID</a>, <a class="el" href="chan__gtalk_8c_source.html#l00140">gtalk::connection</a>, <a class="el" href="chan__gtalk_8c_source.html#l00146">gtalk::context</a>, <a class="el" href="chan__alsa_8c_source.html#l00105">context</a>, <a class="el" href="chan__gtalk_8c_source.html#l00084">global_jbconf</a>, <a class="el" href="chan__gtalk_8c_source.html#l00070">GOOGLE_CONFIG</a>, <a class="el" href="chan__gtalk_8c_source.html#l01840">gtalk_create_member()</a>, <a class="el" href="chan__gtalk_8c_source.html#l01116">gtalk_free_candidates()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00235">gtalk_list</a>, <a class="el" href="chan__gtalk_8c_source.html#l00237">gtalk_member_destroy()</a>, <a class="el" href="chan__gtalk_8c_source.html#l01764">gtalk_parser()</a>, <a class="el" href="chan__skinny_8c_source.html#l00982">hp</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="config_8h_source.html#l00075">ast_variable::name</a>, <a class="el" href="config_8h_source.html#l00077">ast_variable::next</a>, <a class="el" href="chan__gtalk_8c_source.html#l00147">gtalk::parkinglot</a>, <a class="el" href="chan__dahdi_8c_source.html#l00299">parkinglot</a>, <a class="el" href="chan__gtalk_8c_source.html#l00143">gtalk::prefs</a>, <a class="el" href="chan__gtalk_8c_source.html#l00145">gtalk::user</a>, <a class="el" href="config_8h_source.html#l00076">ast_variable::value</a>, and <a class="el" href="ast__expr2f_8c_source.html#l00613">var</a>.</p>

<p>Referenced by <a class="el" href="chan__gtalk_8c_source.html#l02033">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01902"></a>01902 {
<a name="l01903"></a>01903    <span class="keywordtype">char</span> *cat = NULL;
<a name="l01904"></a>01904    <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *cfg = NULL;
<a name="l01905"></a>01905    <span class="keywordtype">char</span> <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>[<a class="code" href="channel_8h.html#abcf1aea85b924e9cd605040b86241e2a">AST_MAX_CONTEXT</a>];
<a name="l01906"></a>01906    <span class="keywordtype">char</span> <a class="code" href="chan__dahdi_8c.html#ac59e01fcfbc9801f87f28f6b60957a24">parkinglot</a>[<a class="code" href="channel_8h.html#abcf1aea85b924e9cd605040b86241e2a">AST_MAX_CONTEXT</a>];
<a name="l01907"></a>01907    <span class="keywordtype">int</span> allowguest = 1;
<a name="l01908"></a>01908    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>;
<a name="l01909"></a>01909    <span class="keyword">struct </span><a class="code" href="structgtalk.html">gtalk</a> *<a class="code" href="structmember.html">member</a>;
<a name="l01910"></a>01910    <span class="keyword">struct </span><a class="code" href="structast__codec__pref.html">ast_codec_pref</a> <a class="code" href="chan__iax2_8c.html#a46262e3cc2baf55a72542567ccfe86d9">prefs</a>;
<a name="l01911"></a>01911    <span class="keyword">struct </span><a class="code" href="structaji__client__container.html">aji_client_container</a> *<a class="code" href="res__jabber_8c.html#a412e6d5d6035a37146acd5af40e881cb">clients</a>;
<a name="l01912"></a>01912    <span class="keyword">struct </span><a class="code" href="structgtalk__candidate.html">gtalk_candidate</a> *global_candidates = NULL;
<a name="l01913"></a>01913    <span class="keyword">struct </span>hostent *<a class="code" href="chan__skinny_8c.html#aa0f575fa3882aa394cc287edba645a35">hp</a>;
<a name="l01914"></a>01914    <span class="keyword">struct </span><a class="code" href="structast__hostent.html">ast_hostent</a> <a class="code" href="chan__skinny_8c.html#a9e435aef83f14da6d3d5ec44f821558e">ahp</a>;
<a name="l01915"></a>01915    <span class="keyword">struct </span><a class="code" href="structast__flags.html" title="Structure used to handle boolean flags.">ast_flags</a> <a class="code" href="app__rpt_8c.html#a1f57f20c1f46890828791a4827fe8752">config_flags</a> = { 0 };
<a name="l01916"></a>01916 
<a name="l01917"></a>01917    cfg = <a class="code" href="config_8h.html#a0a07ddd6bbcf44485e01c14c96109482">ast_config_load</a>(<a class="code" href="chan__gtalk_8c.html#a9c681542bb2e28dccfdcb69fa9593b29">GOOGLE_CONFIG</a>, config_flags);
<a name="l01918"></a>01918    <span class="keywordflow">if</span> (!cfg) {
<a name="l01919"></a>01919       <span class="keywordflow">return</span> 0;
<a name="l01920"></a>01920    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cfg == <a class="code" href="config_8h.html#a8d1a63cdf2c7aff22a77b6e75d93b377">CONFIG_STATUS_FILEINVALID</a>) {
<a name="l01921"></a>01921       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Config file %s is in an invalid format.  Aborting.\n&quot;</span>, <a class="code" href="chan__gtalk_8c.html#a9c681542bb2e28dccfdcb69fa9593b29">GOOGLE_CONFIG</a>);
<a name="l01922"></a>01922       <span class="keywordflow">return</span> 0;
<a name="l01923"></a>01923    }
<a name="l01924"></a>01924 
<a name="l01925"></a>01925    <span class="comment">/* Copy the default jb config over global_jbconf */</span>
<a name="l01926"></a>01926    memcpy(&amp;<a class="code" href="chan__gtalk_8c.html#abaabcb7f4349cc632dde3af5c6a5e1bd">global_jbconf</a>, &amp;<a class="code" href="chan__gtalk_8c.html#a2d8d5920e90ccbad7832926becdadb29">default_jbconf</a>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structast__jb__conf.html" title="General jitterbuffer configuration.">ast_jb_conf</a>));
<a name="l01927"></a>01927 
<a name="l01928"></a>01928    cat = <a class="code" href="config_8h.html#a611776300f941a63266cb220ac62b4db" title="Goes through categories.">ast_category_browse</a>(cfg, NULL);
<a name="l01929"></a>01929    <span class="keywordflow">for</span> (var = <a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>); var; var = var-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l01930"></a>01930       <span class="comment">/* handle jb conf */</span>
<a name="l01931"></a>01931       <span class="keywordflow">if</span> (!<a class="code" href="abstract__jb_8h.html#ae50ad081bd2ae6b58bcfc4687916c586" title="Sets jitterbuffer configuration property.">ast_jb_read_conf</a>(&amp;<a class="code" href="chan__gtalk_8c.html#abaabcb7f4349cc632dde3af5c6a5e1bd">global_jbconf</a>, var-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, var-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>))
<a name="l01932"></a>01932          <span class="keywordflow">continue</span>;
<a name="l01933"></a>01933 
<a name="l01934"></a>01934       <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;allowguest&quot;</span>))
<a name="l01935"></a>01935          allowguest =
<a name="l01936"></a>01936             (<a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(<a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;allowguest&quot;</span>))) ? 1 : 0;
<a name="l01937"></a>01937       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;disallow&quot;</span>))
<a name="l01938"></a>01938          <a class="code" href="frame_8h.html#a35aa1fb72e1993a14156a6b912034ef9" title="Parse an &amp;quot;allow&amp;quot; or &amp;quot;deny&amp;quot; line in a channel or device configuration...">ast_parse_allow_disallow</a>(&amp;<a class="code" href="chan__iax2_8c.html#a46262e3cc2baf55a72542567ccfe86d9">prefs</a>, &amp;<a class="code" href="chan__gtalk_8c.html#a10fc9006937dcda26877acc36353aad4">global_capability</a>, var-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, 0);
<a name="l01939"></a>01939       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;allow&quot;</span>))
<a name="l01940"></a>01940          <a class="code" href="frame_8h.html#a35aa1fb72e1993a14156a6b912034ef9" title="Parse an &amp;quot;allow&amp;quot; or &amp;quot;deny&amp;quot; line in a channel or device configuration...">ast_parse_allow_disallow</a>(&amp;<a class="code" href="chan__iax2_8c.html#a46262e3cc2baf55a72542567ccfe86d9">prefs</a>, &amp;<a class="code" href="chan__gtalk_8c.html#a10fc9006937dcda26877acc36353aad4">global_capability</a>, var-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, 1);
<a name="l01941"></a>01941       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;context&quot;</span>))
<a name="l01942"></a>01942          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(context, var-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(context));
<a name="l01943"></a>01943       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;parkinglot&quot;</span>))
<a name="l01944"></a>01944          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(parkinglot, var-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(parkinglot));
<a name="l01945"></a>01945       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;bindaddr&quot;</span>)) {
<a name="l01946"></a>01946          <span class="keywordflow">if</span> (!(hp = <a class="code" href="utils_8h.html#ad3b63ee1041593219ef0765b28d70442" title="Thread-safe gethostbyname function to use in Asterisk.">ast_gethostbyname</a>(var-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, &amp;<a class="code" href="chan__skinny_8c.html#a9e435aef83f14da6d3d5ec44f821558e">ahp</a>))) {
<a name="l01947"></a>01947             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid address: %s\n&quot;</span>, var-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l01948"></a>01948          } <span class="keywordflow">else</span> {
<a name="l01949"></a>01949             memcpy(&amp;<a class="code" href="chan__gtalk_8c.html#a4ec29229510a2e3ea6ce34d520f06e90">bindaddr</a>.sin_addr, hp-&gt;h_addr, <span class="keyword">sizeof</span>(<a class="code" href="chan__gtalk_8c.html#a4ec29229510a2e3ea6ce34d520f06e90">bindaddr</a>.sin_addr));
<a name="l01950"></a>01950          }
<a name="l01951"></a>01951       }
<a name="l01952"></a>01952 <span class="comment">/*  Idea to allow for custom candidates  */</span>
<a name="l01953"></a>01953 <span class="comment">/*</span>
<a name="l01954"></a>01954 <span class="comment">      else if (!strcasecmp(var-&gt;name, &quot;candidate&quot;)) {</span>
<a name="l01955"></a>01955 <span class="comment">         candidate = gtalk_create_candidate(var-&gt;value);</span>
<a name="l01956"></a>01956 <span class="comment">         if (candidate) {</span>
<a name="l01957"></a>01957 <span class="comment">            candidate-&gt;next = global_candidates;</span>
<a name="l01958"></a>01958 <span class="comment">            global_candidates = candidate;</span>
<a name="l01959"></a>01959 <span class="comment">         }</span>
<a name="l01960"></a>01960 <span class="comment">      }</span>
<a name="l01961"></a>01961 <span class="comment">*/</span>
<a name="l01962"></a>01962    }
<a name="l01963"></a>01963    <span class="keywordflow">while</span> (cat) {
<a name="l01964"></a>01964       <span class="keywordflow">if</span> (strcasecmp(cat, <span class="stringliteral">&quot;general&quot;</span>)) {
<a name="l01965"></a>01965          var = <a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(cfg, cat);
<a name="l01966"></a>01966          member = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*member));
<a name="l01967"></a>01967          <a class="code" href="astobj_8h.html#a996db3d193843755068f61f21e14c3dd" title="Initialize an object.">ASTOBJ_INIT</a>(member);
<a name="l01968"></a>01968          <a class="code" href="astobj_8h.html#ab4a4c9fe0af3b6237d81ae6fd7b857d4" title="Lock an ASTOBJ for writing.">ASTOBJ_WRLOCK</a>(member);
<a name="l01969"></a>01969          <span class="keywordflow">if</span> (!strcasecmp(cat, <span class="stringliteral">&quot;guest&quot;</span>)) {
<a name="l01970"></a>01970             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(member-&gt;name, <span class="stringliteral">&quot;guest&quot;</span>, <span class="keyword">sizeof</span>(member-&gt;name));
<a name="l01971"></a>01971             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(member-&gt;<a class="code" href="structgtalk.html#a7932bef941e6643d2487880116d9990f">user</a>, <span class="stringliteral">&quot;guest&quot;</span>, <span class="keyword">sizeof</span>(member-&gt;<a class="code" href="structgtalk.html#a7932bef941e6643d2487880116d9990f">user</a>));
<a name="l01972"></a>01972             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(member-&gt;<a class="code" href="structgtalk.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, context, <span class="keyword">sizeof</span>(member-&gt;<a class="code" href="structgtalk.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>));
<a name="l01973"></a>01973             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(member-&gt;<a class="code" href="structgtalk.html#a6b31bfcc769a5b5c31e13aa6d8a9a286">parkinglot</a>, parkinglot, <span class="keyword">sizeof</span>(member-&gt;<a class="code" href="structgtalk.html#a6b31bfcc769a5b5c31e13aa6d8a9a286">parkinglot</a>));
<a name="l01974"></a>01974             member-&gt;<a class="code" href="structgtalk.html#aba1ad8c6c1c296a19e3a11c50ed7c8d5">allowguest</a> = allowguest;
<a name="l01975"></a>01975             member-&gt;<a class="code" href="structgtalk.html#a46262e3cc2baf55a72542567ccfe86d9">prefs</a> = <a class="code" href="chan__iax2_8c.html#a46262e3cc2baf55a72542567ccfe86d9">prefs</a>;
<a name="l01976"></a>01976             <span class="keywordflow">while</span> (var) {
<a name="l01977"></a>01977                <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;disallow&quot;</span>))
<a name="l01978"></a>01978                   <a class="code" href="frame_8h.html#a35aa1fb72e1993a14156a6b912034ef9" title="Parse an &amp;quot;allow&amp;quot; or &amp;quot;deny&amp;quot; line in a channel or device configuration...">ast_parse_allow_disallow</a>(&amp;member-&gt;<a class="code" href="structgtalk.html#a46262e3cc2baf55a72542567ccfe86d9">prefs</a>, &amp;member-&gt;<a class="code" href="structgtalk.html#afa05b14ff7f76f303c784c00c4c63fa7">capability</a>,
<a name="l01979"></a>01979                                      var-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, 0);
<a name="l01980"></a>01980                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;allow&quot;</span>))
<a name="l01981"></a>01981                   <a class="code" href="frame_8h.html#a35aa1fb72e1993a14156a6b912034ef9" title="Parse an &amp;quot;allow&amp;quot; or &amp;quot;deny&amp;quot; line in a channel or device configuration...">ast_parse_allow_disallow</a>(&amp;member-&gt;<a class="code" href="structgtalk.html#a46262e3cc2baf55a72542567ccfe86d9">prefs</a>, &amp;member-&gt;<a class="code" href="structgtalk.html#afa05b14ff7f76f303c784c00c4c63fa7">capability</a>,
<a name="l01982"></a>01982                                      var-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, 1);
<a name="l01983"></a>01983                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;context&quot;</span>))
<a name="l01984"></a>01984                   <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(member-&gt;<a class="code" href="structgtalk.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, var-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>,
<a name="l01985"></a>01985                               <span class="keyword">sizeof</span>(member-&gt;<a class="code" href="structgtalk.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>));
<a name="l01986"></a>01986                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;parkinglot&quot;</span>))
<a name="l01987"></a>01987                   <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(member-&gt;<a class="code" href="structgtalk.html#a6b31bfcc769a5b5c31e13aa6d8a9a286">parkinglot</a>, var-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>,
<a name="l01988"></a>01988                               <span class="keyword">sizeof</span>(member-&gt;<a class="code" href="structgtalk.html#a6b31bfcc769a5b5c31e13aa6d8a9a286">parkinglot</a>));
<a name="l01989"></a>01989 <span class="comment">/*  Idea to allow for custom candidates  */</span>
<a name="l01990"></a>01990 <span class="comment">/*</span>
<a name="l01991"></a>01991 <span class="comment">               else if (!strcasecmp(var-&gt;name, &quot;candidate&quot;)) {</span>
<a name="l01992"></a>01992 <span class="comment">                  candidate = gtalk_create_candidate(var-&gt;value);</span>
<a name="l01993"></a>01993 <span class="comment">                  if (candidate) {</span>
<a name="l01994"></a>01994 <span class="comment">                     candidate-&gt;next = member-&gt;ourcandidates;</span>
<a name="l01995"></a>01995 <span class="comment">                     member-&gt;ourcandidates = candidate;</span>
<a name="l01996"></a>01996 <span class="comment">                  }</span>
<a name="l01997"></a>01997 <span class="comment">               }</span>
<a name="l01998"></a>01998 <span class="comment">*/</span>
<a name="l01999"></a>01999                var = var-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>;
<a name="l02000"></a>02000             }
<a name="l02001"></a>02001             <a class="code" href="astobj_8h.html#a9acee27cc52e8533d439f6cc10d11fbc" title="Unlock a locked object.">ASTOBJ_UNLOCK</a>(member);
<a name="l02002"></a>02002             clients = <a class="code" href="jabber_8h.html#a740bf5f4ba6bf40ff9273ca8f7a89710">ast_aji_get_clients</a>();
<a name="l02003"></a>02003             <span class="keywordflow">if</span> (clients) {
<a name="l02004"></a>02004                <a class="code" href="astobj_8h.html#a8483cbd2bcf0b91ac62168fb1cb7f5b1" title="Iterate through the objects in a container.">ASTOBJ_CONTAINER_TRAVERSE</a>(clients, 1, {
<a name="l02005"></a>02005                   <a class="code" href="astobj_8h.html#ab4a4c9fe0af3b6237d81ae6fd7b857d4" title="Lock an ASTOBJ for writing.">ASTOBJ_WRLOCK</a>(iterator);
<a name="l02006"></a>02006                   <a class="code" href="astobj_8h.html#ab4a4c9fe0af3b6237d81ae6fd7b857d4" title="Lock an ASTOBJ for writing.">ASTOBJ_WRLOCK</a>(member);
<a name="l02007"></a>02007                   member-&gt;<a class="code" href="structgtalk.html#a22eb965539587ef7d2b0340d57159e3a">connection</a> = NULL;
<a name="l02008"></a>02008                   iks_filter_add_rule(iterator-&gt;f, <a class="code" href="chan__gtalk_8c.html#a8677afddf5ca302b0dd80e6330290cc2">gtalk_parser</a>, member, IKS_RULE_TYPE, IKS_PAK_IQ, IKS_RULE_NS, <span class="stringliteral">&quot;http://www.google.com/session&quot;</span>, IKS_RULE_DONE);
<a name="l02009"></a>02009                   iks_filter_add_rule(iterator-&gt;f, <a class="code" href="chan__gtalk_8c.html#a8677afddf5ca302b0dd80e6330290cc2">gtalk_parser</a>, member, IKS_RULE_TYPE, IKS_PAK_IQ, IKS_RULE_NS, <span class="stringliteral">&quot;http://jabber.org/protocol/gtalk&quot;</span>, IKS_RULE_DONE);
<a name="l02010"></a>02010                   <a class="code" href="astobj_8h.html#a9acee27cc52e8533d439f6cc10d11fbc" title="Unlock a locked object.">ASTOBJ_UNLOCK</a>(member);
<a name="l02011"></a>02011                   <a class="code" href="astobj_8h.html#a9acee27cc52e8533d439f6cc10d11fbc" title="Unlock a locked object.">ASTOBJ_UNLOCK</a>(iterator);
<a name="l02012"></a>02012                });
<a name="l02013"></a>02013                <a class="code" href="astobj_8h.html#a73bb2d9f59430fd47007a3c6ea651de6" title="Add an object to a container.">ASTOBJ_CONTAINER_LINK</a>(&amp;<a class="code" href="chan__gtalk_8c.html#a8ddc6fee75005b7f3f13d189dd1ecb80">gtalk_list</a>, member);
<a name="l02014"></a>02014                <a class="code" href="astobj_8h.html#aed02826b481ce75ec710c1184ac8f059" title="Decrement the reference count on an object.">ASTOBJ_UNREF</a>(member, <a class="code" href="chan__gtalk_8c.html#a70f7219810c0483ff4725912193266bd">gtalk_member_destroy</a>);
<a name="l02015"></a>02015             } <span class="keywordflow">else</span> {
<a name="l02016"></a>02016                <a class="code" href="astobj_8h.html#a9acee27cc52e8533d439f6cc10d11fbc" title="Unlock a locked object.">ASTOBJ_UNLOCK</a>(member);
<a name="l02017"></a>02017                <a class="code" href="astobj_8h.html#aed02826b481ce75ec710c1184ac8f059" title="Decrement the reference count on an object.">ASTOBJ_UNREF</a>(member, <a class="code" href="chan__gtalk_8c.html#a70f7219810c0483ff4725912193266bd">gtalk_member_destroy</a>);
<a name="l02018"></a>02018             }
<a name="l02019"></a>02019          } <span class="keywordflow">else</span> {
<a name="l02020"></a>02020             <a class="code" href="astobj_8h.html#a9acee27cc52e8533d439f6cc10d11fbc" title="Unlock a locked object.">ASTOBJ_UNLOCK</a>(member);
<a name="l02021"></a>02021             <span class="keywordflow">if</span> (<a class="code" href="chan__gtalk_8c.html#a81ece7628e623a8f04b68b7edd007ab1">gtalk_create_member</a>(cat, var, allowguest, <a class="code" href="chan__iax2_8c.html#a46262e3cc2baf55a72542567ccfe86d9">prefs</a>, context, member))
<a name="l02022"></a>02022                <a class="code" href="astobj_8h.html#a73bb2d9f59430fd47007a3c6ea651de6" title="Add an object to a container.">ASTOBJ_CONTAINER_LINK</a>(&amp;<a class="code" href="chan__gtalk_8c.html#a8ddc6fee75005b7f3f13d189dd1ecb80">gtalk_list</a>, member);
<a name="l02023"></a>02023             <a class="code" href="astobj_8h.html#aed02826b481ce75ec710c1184ac8f059" title="Decrement the reference count on an object.">ASTOBJ_UNREF</a>(member, <a class="code" href="chan__gtalk_8c.html#a70f7219810c0483ff4725912193266bd">gtalk_member_destroy</a>);
<a name="l02024"></a>02024          }
<a name="l02025"></a>02025       }
<a name="l02026"></a>02026       cat = <a class="code" href="config_8h.html#a611776300f941a63266cb220ac62b4db" title="Goes through categories.">ast_category_browse</a>(cfg, cat);
<a name="l02027"></a>02027    }
<a name="l02028"></a>02028    <a class="code" href="chan__gtalk_8c.html#a55a258df74e77719bdcd6c617d91e2b0">gtalk_free_candidates</a>(global_candidates);
<a name="l02029"></a>02029    <span class="keywordflow">return</span> 1;
<a name="l02030"></a>02030 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a70f7219810c0483ff4725912193266bd"></a><!-- doxytag: member="chan_gtalk.c::gtalk_member_destroy" ref="a70f7219810c0483ff4725912193266bd" args="(struct gtalk *obj)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void gtalk_member_destroy </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structgtalk.html">gtalk</a> *&nbsp;</td>
          <td class="paramname"> <em>obj</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l00237">237</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>.</p>

<p>Referenced by <a class="el" href="chan__gtalk_8c_source.html#l01901">gtalk_load_config()</a>, <a class="el" href="chan__gtalk_8c_source.html#l01764">gtalk_parser()</a>, <a class="el" href="chan__gtalk_8c_source.html#l01637">gtalk_request()</a>, and <a class="el" href="chan__gtalk_8c_source.html#l02084">unload_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00238"></a>00238 {
<a name="l00239"></a>00239    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(obj);
<a name="l00240"></a>00240 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aff3b348d0837fe806e53d1b66130693e"></a><!-- doxytag: member="chan_gtalk.c::gtalk_new" ref="aff3b348d0837fe806e53d1b66130693e" args="(struct gtalk *client, struct gtalk_pvt *i, int state, const char *title)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__channel.html">ast_channel</a>* gtalk_new </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structgtalk.html">gtalk</a> *&nbsp;</td>
          <td class="paramname"> <em>client</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structgtalk__pvt.html">gtalk_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>title</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Start new <a class="el" href="structgtalk.html">gtalk</a> channel. </p>

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l00989">989</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="chan__iax2_8c_source.html#l00328">accountcode</a>, <a class="el" href="chan__gtalk_8c_source.html#l00148">gtalk::accountcode</a>, <a class="el" href="channel_8h_source.html#l00474">ast_channel::adsicpe</a>, <a class="el" href="channel_8h_source.html#l00473">ast_channel::amaflags</a>, <a class="el" href="chan__gtalk_8c_source.html#l00144">gtalk::amaflags</a>, <a class="el" href="channel_8h_source.html#l00348">AST_ADSI_UNAVAILABLE</a>, <a class="el" href="channel_8c_source.html#l00711">ast_best_codec()</a>, <a class="el" href="causes_8h_source.html#l00117">AST_CAUSE_SWITCH_CONGESTION</a>, <a class="el" href="channel_8h_source.html#l00730">ast_channel_alloc</a>, <a class="el" href="channel_8c_source.html#l01576">ast_channel_set_fd()</a>, <a class="el" href="frame_8c_source.html#l01211">ast_codec_choose()</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="frame_8h_source.html#l00288">AST_FORMAT_VIDEO_MASK</a>, <a class="el" href="channel_8c_source.html#l01690">ast_hangup()</a>, <a class="el" href="abstract__jb_8c_source.html#l00610">ast_jb_configure()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="loader_8c_source.html#l01163">ast_module_ref()</a>, <a class="el" href="pbx_8c_source.html#l04559">ast_pbx_start()</a>, <a class="el" href="utils_8c_source.html#l01401">ast_random()</a>, <a class="el" href="rtp_8c_source.html#l00723">ast_rtcp_fd()</a>, <a class="el" href="rtp_8c_source.html#l03728">ast_rtp_codec_setpref()</a>, <a class="el" href="rtp_8c_source.html#l00718">ast_rtp_fd()</a>, <a class="el" href="rtp_8c_source.html#l00821">ast_rtp_setstun()</a>, <a class="el" href="channel_8h_source.html#l00359">AST_STATE_DOWN</a>, <a class="el" href="channel_8h_source.html#l00363">AST_STATE_RING</a>, <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="stringfields_8h_source.html#l00285">ast_string_field_set</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00150">gtalk::callgroup</a>, <a class="el" href="channel_8h_source.html#l00447">ast_channel::callgroup</a>, <a class="el" href="chan__gtalk_8c_source.html#l00152">gtalk::callingpres</a>, <a class="el" href="chan__gtalk_8c_source.html#l00108">gtalk_pvt::capability</a>, <a class="el" href="channel_8h_source.html#l00444">ast_channel::cid</a>, <a class="el" href="channel_8h_source.html#l00202">ast_callerid::cid_dnid</a>, <a class="el" href="chan__gtalk_8c_source.html#l00113">gtalk_pvt::cid_name</a>, <a class="el" href="chan__gtalk_8c_source.html#l00112">gtalk_pvt::cid_num</a>, <a class="el" href="channel_8h_source.html#l00207">ast_callerid::cid_pres</a>, <a class="el" href="channel_8h_source.html#l00503">ast_channel::context</a>, <a class="el" href="chan__gtalk_8c_source.html#l00146">gtalk::context</a>, <a class="el" href="manager_8h_source.html#l00061">EVENT_FLAG_SYSTEM</a>, <a class="el" href="channel_8h_source.html#l00504">ast_channel::exten</a>, <a class="el" href="chan__gtalk_8c_source.html#l00114">gtalk_pvt::exten</a>, <a class="el" href="chan__gtalk_8c_source.html#l00084">global_jbconf</a>, <a class="el" href="channel_8h_source.html#l00479">ast_channel::hangupcause</a>, <a class="el" href="chan__gtalk_8c_source.html#l00118">gtalk_pvt::jointcapability</a>, <a class="el" href="chan__alsa_8c_source.html#l00106">language</a>, <a class="el" href="chan__gtalk_8c_source.html#l00154">gtalk::language</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="manager_8h_source.html#l00181">manager_event</a>, <a class="el" href="chan__mgcp_8c_source.html#l00146">musicclass</a>, <a class="el" href="chan__gtalk_8c_source.html#l00155">gtalk::musicclass</a>, <a class="el" href="channel_8h_source.html#l00482">ast_channel::nativeformats</a>, <a class="el" href="chan__gtalk_8c_source.html#l00115">gtalk_pvt::owner</a>, <a class="el" href="chan__dahdi_8c_source.html#l00299">parkinglot</a>, <a class="el" href="chan__gtalk_8c_source.html#l00147">gtalk::parkinglot</a>, <a class="el" href="chan__gtalk_8c_source.html#l00151">gtalk::pickupgroup</a>, <a class="el" href="channel_8h_source.html#l00448">ast_channel::pickupgroup</a>, <a class="el" href="chan__gtalk_8c_source.html#l00109">gtalk_pvt::prefs</a>, <a class="el" href="channel_8h_source.html#l00471">ast_channel::priority</a>, <a class="el" href="channel_8h_source.html#l00485">ast_channel::rawreadformat</a>, <a class="el" href="channel_8h_source.html#l00486">ast_channel::rawwriteformat</a>, <a class="el" href="channel_8h_source.html#l00483">ast_channel::readformat</a>, <a class="el" href="channel_8h_source.html#l00470">ast_channel::rings</a>, <a class="el" href="chan__gtalk_8c_source.html#l00116">gtalk_pvt::rtp</a>, <a class="el" href="chan__gtalk_8c_source.html#l00101">gtalk_pvt::sid</a>, <a class="el" href="channel_8h_source.html#l00400">ast_channel::tech</a>, <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>, <a class="el" href="chan__gtalk_8c_source.html#l00102">gtalk_pvt::us</a>, <a class="el" href="chan__gtalk_8c_source.html#l00117">gtalk_pvt::vrtp</a>, and <a class="el" href="channel_8h_source.html#l00484">ast_channel::writeformat</a>.</p>

<p>Referenced by <a class="el" href="chan__gtalk_8c_source.html#l01154">gtalk_newcall()</a>, and <a class="el" href="chan__gtalk_8c_source.html#l01637">gtalk_request()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00990"></a>00990 {
<a name="l00991"></a>00991    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *tmp;
<a name="l00992"></a>00992    <span class="keywordtype">int</span> fmt;
<a name="l00993"></a>00993    <span class="keywordtype">int</span> what;
<a name="l00994"></a>00994    <span class="keyword">const</span> <span class="keywordtype">char</span> *n2;
<a name="l00995"></a>00995 
<a name="l00996"></a>00996    <span class="keywordflow">if</span> (title)
<a name="l00997"></a>00997       n2 = title;
<a name="l00998"></a>00998    <span class="keywordflow">else</span>
<a name="l00999"></a>00999       n2 = i-&gt;<a class="code" href="structgtalk__pvt.html#a81eba36a21e03789e7d728d4bebd61d3">us</a>;
<a name="l01000"></a>01000    tmp = <a class="code" href="channel_8h.html#adfbceb39821586c0f9be0c47496a4e18">ast_channel_alloc</a>(1, <a class="code" href="structstate.html">state</a>, i-&gt;<a class="code" href="structgtalk__pvt.html#a7b41ba5c947adf528a0615b688a4c5d1">cid_num</a>, i-&gt;<a class="code" href="structgtalk__pvt.html#abeca50433a6b06e370cf0aacb8af5444">cid_name</a>, client-&gt;<a class="code" href="structgtalk.html#adfee50d07a98645d4d20b896ce03785a">accountcode</a>, i-&gt;<a class="code" href="structgtalk__pvt.html#a1a25ab316fdbfb7a045251cf4d1f9b0f">exten</a>, client-&gt;<a class="code" href="structgtalk.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, client-&gt;<a class="code" href="structgtalk.html#ad2cfb0f821c065261382a9298bb5a16b">amaflags</a>, <span class="stringliteral">&quot;Gtalk/%s-%04lx&quot;</span>, n2, <a class="code" href="utils_8h.html#a7b4f10b070e95ba413e258a3e4b03c20">ast_random</a>() &amp; 0xffff);
<a name="l01001"></a>01001    <span class="keywordflow">if</span> (!tmp) {
<a name="l01002"></a>01002       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to allocate Gtalk channel structure!\n&quot;</span>);
<a name="l01003"></a>01003       <span class="keywordflow">return</span> NULL;
<a name="l01004"></a>01004    }
<a name="l01005"></a>01005    tmp-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a> = &amp;<a class="code" href="chan__gtalk_8c.html#a99d9c7da92ab47bf1a3f0274c84ecee8" title="PBX interface structure for channel registration.">gtalk_tech</a>;
<a name="l01006"></a>01006 
<a name="l01007"></a>01007    <span class="comment">/* Select our native format based on codec preference until we receive</span>
<a name="l01008"></a>01008 <span class="comment">      something from another device to the contrary. */</span>
<a name="l01009"></a>01009    <span class="keywordflow">if</span> (i-&gt;<a class="code" href="structgtalk__pvt.html#a38f5730c90d9315eb1c0df6cfdc37da6">jointcapability</a>)
<a name="l01010"></a>01010       what = i-&gt;<a class="code" href="structgtalk__pvt.html#a38f5730c90d9315eb1c0df6cfdc37da6">jointcapability</a>;
<a name="l01011"></a>01011    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i-&gt;<a class="code" href="structgtalk__pvt.html#afa05b14ff7f76f303c784c00c4c63fa7">capability</a>)
<a name="l01012"></a>01012       what = i-&gt;<a class="code" href="structgtalk__pvt.html#afa05b14ff7f76f303c784c00c4c63fa7">capability</a>;
<a name="l01013"></a>01013    <span class="keywordflow">else</span>
<a name="l01014"></a>01014       what = <a class="code" href="chan__gtalk_8c.html#a10fc9006937dcda26877acc36353aad4">global_capability</a>;
<a name="l01015"></a>01015 
<a name="l01016"></a>01016    <span class="comment">/* Set Frame packetization */</span>
<a name="l01017"></a>01017    <span class="keywordflow">if</span> (i-&gt;<a class="code" href="structgtalk__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>)
<a name="l01018"></a>01018       <a class="code" href="rtp_8h.html#ae6a1acd75aaf08afc6954bd5ac671c6a" title="Set codec preference.">ast_rtp_codec_setpref</a>(i-&gt;<a class="code" href="structgtalk__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>, &amp;i-&gt;<a class="code" href="structgtalk__pvt.html#a46262e3cc2baf55a72542567ccfe86d9">prefs</a>);
<a name="l01019"></a>01019 
<a name="l01020"></a>01020    tmp-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a> = <a class="code" href="frame_8h.html#a123ec7e6e90e279b75bc6447eab5d3b2" title="Select the best audio format according to preference list from supplied options....">ast_codec_choose</a>(&amp;i-&gt;<a class="code" href="structgtalk__pvt.html#a46262e3cc2baf55a72542567ccfe86d9">prefs</a>, what, 1) | (i-&gt;<a class="code" href="structgtalk__pvt.html#a38f5730c90d9315eb1c0df6cfdc37da6">jointcapability</a> &amp; <a class="code" href="frame_8h.html#ad048231af8a6271706585e3c8630dc69">AST_FORMAT_VIDEO_MASK</a>);
<a name="l01021"></a>01021    fmt = <a class="code" href="channel_8h.html#a4d78194779a26341c3ec7298b450b9ed" title="Pick the best audio codec.">ast_best_codec</a>(tmp-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a>);
<a name="l01022"></a>01022 
<a name="l01023"></a>01023    <span class="keywordflow">if</span> (i-&gt;<a class="code" href="structgtalk__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>) {
<a name="l01024"></a>01024       <a class="code" href="rtp_8h.html#a7c4ba34d21a78cb29bed9a286858180b" title="Enable STUN capability.">ast_rtp_setstun</a>(i-&gt;<a class="code" href="structgtalk__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>, 1);
<a name="l01025"></a>01025       <a class="code" href="channel_8h.html#aca37ca2f3d55a223d26617329ed48a3e">ast_channel_set_fd</a>(tmp, 0, <a class="code" href="rtp_8h.html#a9a990d85fb0aac29bda48777f0f86108">ast_rtp_fd</a>(i-&gt;<a class="code" href="structgtalk__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>));
<a name="l01026"></a>01026       <a class="code" href="channel_8h.html#aca37ca2f3d55a223d26617329ed48a3e">ast_channel_set_fd</a>(tmp, 1, <a class="code" href="rtp_8h.html#ac3e115dfd0bfe82479060b55dd41601f">ast_rtcp_fd</a>(i-&gt;<a class="code" href="structgtalk__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>));
<a name="l01027"></a>01027    }
<a name="l01028"></a>01028    <span class="keywordflow">if</span> (i-&gt;<a class="code" href="structgtalk__pvt.html#a65e8f978abd3f0206026969c627200a9">vrtp</a>) {
<a name="l01029"></a>01029       <a class="code" href="rtp_8h.html#a7c4ba34d21a78cb29bed9a286858180b" title="Enable STUN capability.">ast_rtp_setstun</a>(i-&gt;<a class="code" href="structgtalk__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>, 1);
<a name="l01030"></a>01030       <a class="code" href="channel_8h.html#aca37ca2f3d55a223d26617329ed48a3e">ast_channel_set_fd</a>(tmp, 2, <a class="code" href="rtp_8h.html#a9a990d85fb0aac29bda48777f0f86108">ast_rtp_fd</a>(i-&gt;<a class="code" href="structgtalk__pvt.html#a65e8f978abd3f0206026969c627200a9">vrtp</a>));
<a name="l01031"></a>01031       <a class="code" href="channel_8h.html#aca37ca2f3d55a223d26617329ed48a3e">ast_channel_set_fd</a>(tmp, 3, <a class="code" href="rtp_8h.html#ac3e115dfd0bfe82479060b55dd41601f">ast_rtcp_fd</a>(i-&gt;<a class="code" href="structgtalk__pvt.html#a65e8f978abd3f0206026969c627200a9">vrtp</a>));
<a name="l01032"></a>01032    }
<a name="l01033"></a>01033    <span class="keywordflow">if</span> (<a class="code" href="structstate.html">state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a>)
<a name="l01034"></a>01034       tmp-&gt;<a class="code" href="structast__channel.html#a358fd14658a0c5276190e48f1b1f251a">rings</a> = 1;
<a name="l01035"></a>01035    tmp-&gt;<a class="code" href="structast__channel.html#a4507948aab513e976b52d2253376ee7f">adsicpe</a> = <a class="code" href="channel_8h.html#a828f537544a2ad2352c56c078390a0bda5f0673b46cfdba3094393b3fbce084ff">AST_ADSI_UNAVAILABLE</a>;
<a name="l01036"></a>01036    tmp-&gt;<a class="code" href="structast__channel.html#a00f5ce2ad53ff8523f8e46ea5aceba48">writeformat</a> = fmt;
<a name="l01037"></a>01037    tmp-&gt;<a class="code" href="structast__channel.html#a045b6dfdee84adceb7e86b6c5c4f9a86">rawwriteformat</a> = fmt;
<a name="l01038"></a>01038    tmp-&gt;<a class="code" href="structast__channel.html#ab7786a0f5b9a9ebf83daed87be4f3868">readformat</a> = fmt;
<a name="l01039"></a>01039    tmp-&gt;<a class="code" href="structast__channel.html#a6fcf944239e3718e282e0ba7512e66c6">rawreadformat</a> = fmt;
<a name="l01040"></a>01040    tmp-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a> = i;
<a name="l01041"></a>01041 
<a name="l01042"></a>01042    tmp-&gt;<a class="code" href="structast__channel.html#af0f007b48a9c8cf0629428bd0483e0d1">callgroup</a> = client-&gt;<a class="code" href="structgtalk.html#af0f007b48a9c8cf0629428bd0483e0d1">callgroup</a>;
<a name="l01043"></a>01043    tmp-&gt;<a class="code" href="structast__channel.html#abc0651bcec68410023c036b7d8ec4d11">pickupgroup</a> = client-&gt;<a class="code" href="structgtalk.html#abc0651bcec68410023c036b7d8ec4d11">pickupgroup</a>;
<a name="l01044"></a>01044    tmp-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a5674af3fa5ce1dd1fe052be1477d4110">cid_pres</a> = client-&gt;<a class="code" href="structgtalk.html#abd29b99884a9fc8a54fc021555190fb8">callingpres</a>;
<a name="l01045"></a>01045    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(client-&gt;<a class="code" href="structgtalk.html#adfee50d07a98645d4d20b896ce03785a">accountcode</a>))
<a name="l01046"></a>01046       <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(tmp, <a class="code" href="chan__iax2_8c.html#adfee50d07a98645d4d20b896ce03785a">accountcode</a>, client-&gt;<a class="code" href="structgtalk.html#adfee50d07a98645d4d20b896ce03785a">accountcode</a>);
<a name="l01047"></a>01047    <span class="keywordflow">if</span> (client-&gt;<a class="code" href="structgtalk.html#ad2cfb0f821c065261382a9298bb5a16b">amaflags</a>)
<a name="l01048"></a>01048       tmp-&gt;<a class="code" href="structast__channel.html#ad2cfb0f821c065261382a9298bb5a16b">amaflags</a> = client-&gt;<a class="code" href="structgtalk.html#ad2cfb0f821c065261382a9298bb5a16b">amaflags</a>;
<a name="l01049"></a>01049    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(client-&gt;<a class="code" href="structgtalk.html#adf416dc058363e2fd5750c77e2d78bee">language</a>))
<a name="l01050"></a>01050       <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(tmp, <a class="code" href="chan__alsa_8c.html#adf416dc058363e2fd5750c77e2d78bee">language</a>, client-&gt;<a class="code" href="structgtalk.html#adf416dc058363e2fd5750c77e2d78bee">language</a>);
<a name="l01051"></a>01051    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(client-&gt;<a class="code" href="structgtalk.html#abc34958c9b03014779727e5ca61b93e5">musicclass</a>))
<a name="l01052"></a>01052       <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(tmp, <a class="code" href="chan__mgcp_8c.html#abc34958c9b03014779727e5ca61b93e5">musicclass</a>, client-&gt;<a class="code" href="structgtalk.html#abc34958c9b03014779727e5ca61b93e5">musicclass</a>);
<a name="l01053"></a>01053    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(client-&gt;<a class="code" href="structgtalk.html#a6b31bfcc769a5b5c31e13aa6d8a9a286">parkinglot</a>))
<a name="l01054"></a>01054       <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(tmp, <a class="code" href="chan__dahdi_8c.html#ac59e01fcfbc9801f87f28f6b60957a24">parkinglot</a>, client-&gt;<a class="code" href="structgtalk.html#a6b31bfcc769a5b5c31e13aa6d8a9a286">parkinglot</a>);
<a name="l01055"></a>01055    i-&gt;<a class="code" href="structgtalk__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = tmp;
<a name="l01056"></a>01056    <a class="code" href="module_8h.html#aa08fcee0b390e15532dd03803c8728c4">ast_module_ref</a>(<a class="code" href="structast__module__info.html">ast_module_info</a>-&gt;self);
<a name="l01057"></a>01057    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmp-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, client-&gt;<a class="code" href="structgtalk.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <span class="keyword">sizeof</span>(tmp-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>));
<a name="l01058"></a>01058    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmp-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>, i-&gt;<a class="code" href="structgtalk__pvt.html#a1a25ab316fdbfb7a045251cf4d1f9b0f">exten</a>, <span class="keyword">sizeof</span>(tmp-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>));
<a name="l01059"></a>01059 
<a name="l01060"></a>01060    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(i-&gt;<a class="code" href="structgtalk__pvt.html#a1a25ab316fdbfb7a045251cf4d1f9b0f">exten</a>) &amp;&amp; strcmp(i-&gt;<a class="code" href="structgtalk__pvt.html#a1a25ab316fdbfb7a045251cf4d1f9b0f">exten</a>, <span class="stringliteral">&quot;s&quot;</span>))
<a name="l01061"></a>01061       tmp-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#aa54ab157f47ac529034d524781e2a7e2">cid_dnid</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(i-&gt;<a class="code" href="structgtalk__pvt.html#a1a25ab316fdbfb7a045251cf4d1f9b0f">exten</a>);
<a name="l01062"></a>01062    tmp-&gt;<a class="code" href="structast__channel.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> = 1;
<a name="l01063"></a>01063    <span class="keywordflow">if</span> (i-&gt;<a class="code" href="structgtalk__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>)
<a name="l01064"></a>01064       <a class="code" href="abstract__jb_8h.html#a0981c84ac90dd79bc2a0fdd90aa6efba" title="Configures a jitterbuffer on a channel.">ast_jb_configure</a>(tmp, &amp;<a class="code" href="chan__gtalk_8c.html#abaabcb7f4349cc632dde3af5c6a5e1bd">global_jbconf</a>);
<a name="l01065"></a>01065    <span class="keywordflow">if</span> (<a class="code" href="structstate.html">state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a> &amp;&amp; <a class="code" href="pbx_8h.html#a9a937fbb3b5f4e68880a9c5714a29ce5" title="Create a new thread and start the PBX.">ast_pbx_start</a>(tmp)) {
<a name="l01066"></a>01066       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to start PBX on %s\n&quot;</span>, tmp-&gt;name);
<a name="l01067"></a>01067       tmp-&gt;<a class="code" href="structast__channel.html#aa4261b664d6712ba8551bde24ad17382">hangupcause</a> = <a class="code" href="causes_8h.html#a02b3785262e0be6843e8e9d235d8d78d">AST_CAUSE_SWITCH_CONGESTION</a>;
<a name="l01068"></a>01068       <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(tmp);
<a name="l01069"></a>01069       tmp = NULL;
<a name="l01070"></a>01070    } <span class="keywordflow">else</span> {
<a name="l01071"></a>01071       <a class="code" href="manager_8h.html#a1ef0ee0044dbbeb4c3a5abc6c046b208" title="External routines may send asterisk manager events this way.">manager_event</a>(<a class="code" href="manager_8h.html#a420f0f755e1c3378b45ca7f6f0669ffa">EVENT_FLAG_SYSTEM</a>, <span class="stringliteral">&quot;ChannelUpdate&quot;</span>,
<a name="l01072"></a>01072          <span class="stringliteral">&quot;Channel: %s\r\nChanneltype: %s\r\nGtalk-SID: %s\r\n&quot;</span>,
<a name="l01073"></a>01073          i-&gt;<a class="code" href="structgtalk__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> ? i-&gt;<a class="code" href="structgtalk__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;name : <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;Gtalk&quot;</span>, i-&gt;<a class="code" href="structgtalk__pvt.html#a11855a8fa7877d4395e800ce1bb3ed8d">sid</a>);
<a name="l01074"></a>01074    }
<a name="l01075"></a>01075    <span class="keywordflow">return</span> tmp;
<a name="l01076"></a>01076 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa8c45a47a9e46688c69cba60399bfd03"></a><!-- doxytag: member="chan_gtalk.c::gtalk_newcall" ref="aa8c45a47a9e46688c69cba60399bfd03" args="(struct gtalk *client, ikspak *pak)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int gtalk_newcall </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structgtalk.html">gtalk</a> *&nbsp;</td>
          <td class="paramname"> <em>client</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ikspak *&nbsp;</td>
          <td class="paramname"> <em>pak</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l01154">1154</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="chan__gtalk_8c_source.html#l00107">gtalk_pvt::alreadygone</a>, <a class="el" href="res__jabber_8c_source.html#l02954">ast_aji_get_client()</a>, <a class="el" href="channel_8c_source.html#l01388">ast_channel_free()</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="frame_8c_source.html#l00586">ast_getformatname_multiple()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="pbx_8h_source.html#l00265">AST_PBX_CALL_LIMIT</a>, <a class="el" href="pbx_8h_source.html#l00264">AST_PBX_FAILED</a>, <a class="el" href="pbx_8c_source.html#l04559">ast_pbx_start()</a>, <a class="el" href="pbx_8h_source.html#l00263">AST_PBX_SUCCESS</a>, <a class="el" href="rtp_8c_source.html#l02319">ast_rtp_get_current_formats()</a>, <a class="el" href="rtp_8c_source.html#l02234">ast_rtp_set_m_type()</a>, <a class="el" href="rtp_8c_source.html#l02310">ast_rtp_set_rtpmap_type()</a>, <a class="el" href="channel_8c_source.html#l04695">ast_setstate()</a>, <a class="el" href="channel_8h_source.html#l00359">AST_STATE_DOWN</a>, <a class="el" href="channel_8h_source.html#l00363">AST_STATE_RING</a>, <a class="el" href="chan__gtalk_8c_source.html#l00108">gtalk_pvt::capability</a>, <a class="el" href="adsistub_8c_source.html#l00049">chan</a>, <a class="el" href="chan__gtalk_8c_source.html#l00140">gtalk::connection</a>, <a class="el" href="chan__gtalk_8c_source.html#l01078">gtalk_action()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00909">gtalk_alloc()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00773">gtalk_create_candidates()</a>, <a class="el" href="chan__gtalk_8c_source.html#l01126">gtalk_free_pvt()</a>, <a class="el" href="chan__gtalk_8c_source.html#l01617">gtalk_hangup()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00458">gtalk_invite_response()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00989">gtalk_new()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00571">gtalk_response()</a>, <a class="el" href="jabber_8h_source.html#l00149">aji_client::jid</a>, <a class="el" href="chan__gtalk_8c_source.html#l00118">gtalk_pvt::jointcapability</a>, <a class="el" href="chan__gtalk_8c_source.html#l00098">gtalk_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__gtalk_8c_source.html#l00120">gtalk_pvt::next</a>, <a class="el" href="chan__gtalk_8c_source.html#l00142">gtalk::p</a>, <a class="el" href="chan__gtalk_8c_source.html#l00119">gtalk_pvt::peercapability</a>, <a class="el" href="chan__gtalk_8c_source.html#l00116">gtalk_pvt::rtp</a>, <a class="el" href="chan__gtalk_8c_source.html#l00101">gtalk_pvt::sid</a>, <a class="el" href="chan__gtalk_8c_source.html#l00103">gtalk_pvt::them</a>, and <a class="el" href="chan__gtalk_8c_source.html#l00102">gtalk_pvt::us</a>.</p>

<p>Referenced by <a class="el" href="chan__gtalk_8c_source.html#l01764">gtalk_parser()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01155"></a>01155 {
<a name="l01156"></a>01156    <span class="keyword">struct </span><a class="code" href="structgtalk__pvt.html">gtalk_pvt</a> *p, *tmp = client-&gt;<a class="code" href="structgtalk.html#a87c10b8b2ce58b28854a6cf5a7462bbd">p</a>;
<a name="l01157"></a>01157    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>;
<a name="l01158"></a>01158    <span class="keywordtype">int</span> res;
<a name="l01159"></a>01159    iks *codec;
<a name="l01160"></a>01160    <span class="keywordtype">char</span> *from = NULL;
<a name="l01161"></a>01161    <span class="keywordtype">char</span> s1[BUFSIZ], s2[BUFSIZ], s3[BUFSIZ];
<a name="l01162"></a>01162    <span class="keywordtype">int</span> peernoncodeccapability;
<a name="l01163"></a>01163 
<a name="l01164"></a>01164    <span class="comment">/* Make sure our new call doesn&apos;t exist yet */</span>
<a name="l01165"></a>01165    from = iks_find_attrib(pak-&gt;x,<span class="stringliteral">&quot;to&quot;</span>);
<a name="l01166"></a>01166    <span class="keywordflow">if</span>(!from)
<a name="l01167"></a>01167       from = client-&gt;<a class="code" href="structgtalk.html#a22eb965539587ef7d2b0340d57159e3a">connection</a>-&gt;<a class="code" href="structaji__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;full;
<a name="l01168"></a>01168    
<a name="l01169"></a>01169    <span class="keywordflow">while</span> (tmp) {
<a name="l01170"></a>01170       <span class="keywordflow">if</span> (iks_find_with_attrib(pak-&gt;x, <span class="stringliteral">&quot;session&quot;</span>, <span class="stringliteral">&quot;id&quot;</span>, tmp-&gt;<a class="code" href="structgtalk__pvt.html#a11855a8fa7877d4395e800ce1bb3ed8d">sid</a>)) {
<a name="l01171"></a>01171          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Ignoring duplicate call setup on SID %s\n&quot;</span>, tmp-&gt;<a class="code" href="structgtalk__pvt.html#a11855a8fa7877d4395e800ce1bb3ed8d">sid</a>);
<a name="l01172"></a>01172          <a class="code" href="chan__gtalk_8c.html#ac60c0cc7813dc8afb593b62633a0236f">gtalk_response</a>(client, from, pak, <span class="stringliteral">&quot;out-of-order&quot;</span>, NULL);
<a name="l01173"></a>01173          <span class="keywordflow">return</span> -1;
<a name="l01174"></a>01174       }
<a name="l01175"></a>01175       tmp = tmp-&gt;<a class="code" href="structgtalk__pvt.html#ad52b2b57b8b3ac8cab36317c65547157">next</a>;
<a name="l01176"></a>01176    }
<a name="l01177"></a>01177 
<a name="l01178"></a>01178    <span class="keywordflow">if</span> (!strcasecmp(client-&gt;name, <span class="stringliteral">&quot;guest&quot;</span>)){
<a name="l01179"></a>01179       <span class="comment">/* the guest account is not tied to any configured XMPP client,</span>
<a name="l01180"></a>01180 <span class="comment">         let&apos;s set it now */</span>
<a name="l01181"></a>01181       client-&gt;<a class="code" href="structgtalk.html#a22eb965539587ef7d2b0340d57159e3a">connection</a> = <a class="code" href="jabber_8h.html#a6689c8e948c8d55e092f30277336fde7" title="grab a aji_client structure by label name or JID (without the resource string)">ast_aji_get_client</a>(from);
<a name="l01182"></a>01182       <span class="keywordflow">if</span> (!client-&gt;<a class="code" href="structgtalk.html#a22eb965539587ef7d2b0340d57159e3a">connection</a>) {
<a name="l01183"></a>01183          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;No XMPP client to talk to, us (partial JID) : %s\n&quot;</span>, from);
<a name="l01184"></a>01184          <span class="keywordflow">return</span> -1;
<a name="l01185"></a>01185       }
<a name="l01186"></a>01186    }
<a name="l01187"></a>01187 
<a name="l01188"></a>01188    p = <a class="code" href="chan__gtalk_8c.html#aa0e0e8c2e99606e052fcd142dcf580dd">gtalk_alloc</a>(client, from, pak-&gt;from-&gt;full, iks_find_attrib(pak-&gt;query, <span class="stringliteral">&quot;id&quot;</span>));
<a name="l01189"></a>01189    <span class="keywordflow">if</span> (!p) {
<a name="l01190"></a>01190       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to allocate gtalk structure!\n&quot;</span>);
<a name="l01191"></a>01191       <span class="keywordflow">return</span> -1;
<a name="l01192"></a>01192    }
<a name="l01193"></a>01193 
<a name="l01194"></a>01194    chan = <a class="code" href="chan__gtalk_8c.html#aff3b348d0837fe806e53d1b66130693e" title="Start new gtalk channel.">gtalk_new</a>(client, p, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a>, pak-&gt;from-&gt;user);
<a name="l01195"></a>01195    <span class="keywordflow">if</span> (!chan) {
<a name="l01196"></a>01196       <a class="code" href="chan__gtalk_8c.html#a46487d9263cd957964d6056bfe183d6c">gtalk_free_pvt</a>(client, p);
<a name="l01197"></a>01197       <span class="keywordflow">return</span> -1;
<a name="l01198"></a>01198    }
<a name="l01199"></a>01199 
<a name="l01200"></a>01200    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;p-&gt;<a class="code" href="structgtalk__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01201"></a>01201    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(p-&gt;<a class="code" href="structgtalk__pvt.html#a7c3b41a9f87238ef5a35607e6655f02e">them</a>, pak-&gt;from-&gt;full, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structgtalk__pvt.html#a7c3b41a9f87238ef5a35607e6655f02e">them</a>));
<a name="l01202"></a>01202    <span class="keywordflow">if</span> (iks_find_attrib(pak-&gt;query, <span class="stringliteral">&quot;id&quot;</span>)) {
<a name="l01203"></a>01203       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(p-&gt;<a class="code" href="structgtalk__pvt.html#a11855a8fa7877d4395e800ce1bb3ed8d">sid</a>, iks_find_attrib(pak-&gt;query, <span class="stringliteral">&quot;id&quot;</span>),
<a name="l01204"></a>01204             <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structgtalk__pvt.html#a11855a8fa7877d4395e800ce1bb3ed8d">sid</a>));
<a name="l01205"></a>01205    }
<a name="l01206"></a>01206 
<a name="l01207"></a>01207    <span class="comment">/* codec points to the first &lt;payload-type/&gt; tag */</span>   
<a name="l01208"></a>01208    codec = iks_first_tag(iks_first_tag(iks_first_tag(pak-&gt;x)));
<a name="l01209"></a>01209    
<a name="l01210"></a>01210    <span class="keywordflow">while</span> (codec) {
<a name="l01211"></a>01211       <a class="code" href="rtp_8h.html#a83fe16478ba4b99f0bc1798f1064baef" title="Activate payload type.">ast_rtp_set_m_type</a>(p-&gt;<a class="code" href="structgtalk__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>, atoi(iks_find_attrib(codec, <span class="stringliteral">&quot;id&quot;</span>)));
<a name="l01212"></a>01212       <a class="code" href="rtp_8h.html#a02a3ba4e11691cafd933cbb1e6225b3e" title="Set payload type to a known MIME media type for a codec.">ast_rtp_set_rtpmap_type</a>(p-&gt;<a class="code" href="structgtalk__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>, atoi(iks_find_attrib(codec, <span class="stringliteral">&quot;id&quot;</span>)), <span class="stringliteral">&quot;audio&quot;</span>, iks_find_attrib(codec, <span class="stringliteral">&quot;name&quot;</span>), 0);
<a name="l01213"></a>01213       codec = iks_next_tag(codec);
<a name="l01214"></a>01214    }
<a name="l01215"></a>01215    
<a name="l01216"></a>01216    <span class="comment">/* Now gather all of the codecs that we are asked for */</span>
<a name="l01217"></a>01217    <a class="code" href="rtp_8h.html#a0af7232148535d9bc024fc01579d4ec8" title="Return the union of all of the codecs that were set by rtp_set...() calls They&amp;#39;re...">ast_rtp_get_current_formats</a>(p-&gt;<a class="code" href="structgtalk__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>, &amp;p-&gt;<a class="code" href="structgtalk__pvt.html#a64c43413589d9d63d2ef5db58ed1a7c2">peercapability</a>, &amp;peernoncodeccapability);
<a name="l01218"></a>01218    p-&gt;<a class="code" href="structgtalk__pvt.html#a38f5730c90d9315eb1c0df6cfdc37da6">jointcapability</a> = p-&gt;<a class="code" href="structgtalk__pvt.html#afa05b14ff7f76f303c784c00c4c63fa7">capability</a> &amp; p-&gt;<a class="code" href="structgtalk__pvt.html#a64c43413589d9d63d2ef5db58ed1a7c2">peercapability</a>;
<a name="l01219"></a>01219    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structgtalk__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01220"></a>01220       
<a name="l01221"></a>01221    <a class="code" href="channel_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448" title="Change the state of a channel.">ast_setstate</a>(chan, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a>);
<a name="l01222"></a>01222    <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="structgtalk__pvt.html#a38f5730c90d9315eb1c0df6cfdc37da6">jointcapability</a>) {
<a name="l01223"></a>01223       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Capabilities don&apos;t match : us - %s, peer - %s, combined - %s \n&quot;</span>, <a class="code" href="frame_8h.html#a37cdc7e78686b0bfa4e47e645f782b30" title="Get the names of a set of formats.">ast_getformatname_multiple</a>(s1, BUFSIZ, p-&gt;<a class="code" href="structgtalk__pvt.html#afa05b14ff7f76f303c784c00c4c63fa7">capability</a>),
<a name="l01224"></a>01224          <a class="code" href="frame_8h.html#a37cdc7e78686b0bfa4e47e645f782b30" title="Get the names of a set of formats.">ast_getformatname_multiple</a>(s2, BUFSIZ, p-&gt;<a class="code" href="structgtalk__pvt.html#a64c43413589d9d63d2ef5db58ed1a7c2">peercapability</a>),
<a name="l01225"></a>01225          <a class="code" href="frame_8h.html#a37cdc7e78686b0bfa4e47e645f782b30" title="Get the names of a set of formats.">ast_getformatname_multiple</a>(s3, BUFSIZ, p-&gt;<a class="code" href="structgtalk__pvt.html#a38f5730c90d9315eb1c0df6cfdc37da6">jointcapability</a>));
<a name="l01226"></a>01226       <span class="comment">/* close session if capabilities don&apos;t match */</span>
<a name="l01227"></a>01227       <a class="code" href="chan__gtalk_8c.html#a97da48981722a1f8484aac2ea2e48da5">gtalk_action</a>(client, p, <span class="stringliteral">&quot;reject&quot;</span>);
<a name="l01228"></a>01228       p-&gt;<a class="code" href="structgtalk__pvt.html#ac43993a73742eff145b861107a1afa0d">alreadygone</a> = 1;
<a name="l01229"></a>01229       <a class="code" href="chan__gtalk_8c.html#ae40647d59ad2609a48c2c7e4b3ec1c3c" title="Hangup a call through the gtalk proxy channel.">gtalk_hangup</a>(chan);
<a name="l01230"></a>01230       <a class="code" href="channel_8h.html#a239d899b30002db4e8b08c055ac9d8e5" title="Free a channel structure.">ast_channel_free</a>(chan);
<a name="l01231"></a>01231       <span class="keywordflow">return</span> -1;
<a name="l01232"></a>01232    }  
<a name="l01233"></a>01233 
<a name="l01234"></a>01234    res = <a class="code" href="pbx_8h.html#a9a937fbb3b5f4e68880a9c5714a29ce5" title="Create a new thread and start the PBX.">ast_pbx_start</a>(chan);
<a name="l01235"></a>01235    
<a name="l01236"></a>01236    <span class="keywordflow">switch</span> (res) {
<a name="l01237"></a>01237    <span class="keywordflow">case</span> <a class="code" href="pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735a4a46cde728f5cd375af4f2d5b1542490">AST_PBX_FAILED</a>:
<a name="l01238"></a>01238       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to start PBX :(\n&quot;</span>);
<a name="l01239"></a>01239       <a class="code" href="chan__gtalk_8c.html#ac60c0cc7813dc8afb593b62633a0236f">gtalk_response</a>(client, from, pak, <span class="stringliteral">&quot;service-unavailable&quot;</span>, NULL);
<a name="l01240"></a>01240       <span class="keywordflow">break</span>;
<a name="l01241"></a>01241    <span class="keywordflow">case</span> <a class="code" href="pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735ab69a419c47206542956e9d933b6605f5">AST_PBX_CALL_LIMIT</a>:
<a name="l01242"></a>01242       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to start PBX (call limit reached) \n&quot;</span>);
<a name="l01243"></a>01243       <a class="code" href="chan__gtalk_8c.html#ac60c0cc7813dc8afb593b62633a0236f">gtalk_response</a>(client, from, pak, <span class="stringliteral">&quot;service-unavailable&quot;</span>, NULL);
<a name="l01244"></a>01244       <span class="keywordflow">break</span>;
<a name="l01245"></a>01245    <span class="keywordflow">case</span> <a class="code" href="pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735ae1482e87c137b03ef9f9c17cf4fb5ec4">AST_PBX_SUCCESS</a>:
<a name="l01246"></a>01246       <a class="code" href="chan__gtalk_8c.html#ac60c0cc7813dc8afb593b62633a0236f">gtalk_response</a>(client, from, pak, NULL, NULL);
<a name="l01247"></a>01247       <a class="code" href="chan__gtalk_8c.html#a9647000d3f1d4b0364443c472e28af78">gtalk_invite_response</a>(p, p-&gt;<a class="code" href="structgtalk__pvt.html#a7c3b41a9f87238ef5a35607e6655f02e">them</a>, p-&gt;<a class="code" href="structgtalk__pvt.html#a81eba36a21e03789e7d728d4bebd61d3">us</a>,p-&gt;<a class="code" href="structgtalk__pvt.html#a11855a8fa7877d4395e800ce1bb3ed8d">sid</a>, 0);
<a name="l01248"></a>01248       <a class="code" href="chan__gtalk_8c.html#aefe1cdecffa94036ff8745b95267e70c">gtalk_create_candidates</a>(client, p, p-&gt;<a class="code" href="structgtalk__pvt.html#a11855a8fa7877d4395e800ce1bb3ed8d">sid</a>, p-&gt;<a class="code" href="structgtalk__pvt.html#a7c3b41a9f87238ef5a35607e6655f02e">them</a>, p-&gt;<a class="code" href="structgtalk__pvt.html#a81eba36a21e03789e7d728d4bebd61d3">us</a>);
<a name="l01249"></a>01249       <span class="comment">/* nothing to do */</span>
<a name="l01250"></a>01250       <span class="keywordflow">break</span>;
<a name="l01251"></a>01251    }
<a name="l01252"></a>01252 
<a name="l01253"></a>01253    <span class="keywordflow">return</span> 1;
<a name="l01254"></a>01254 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8677afddf5ca302b0dd80e6330290cc2"></a><!-- doxytag: member="chan_gtalk.c::gtalk_parser" ref="a8677afddf5ca302b0dd80e6330290cc2" args="(void *data, ikspak *pak)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int gtalk_parser </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ikspak *&nbsp;</td>
          <td class="paramname"> <em>pak</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l01764">1764</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="astobj_8h_source.html#l00201">ASTOBJ_REF</a>, <a class="el" href="astobj_8h_source.html#l00218">ASTOBJ_UNREF</a>, <a class="el" href="chan__gtalk_8c_source.html#l01302">gtalk_add_candidate()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00680">gtalk_handle_dtmf()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00748">gtalk_hangup_farend()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00656">gtalk_is_accepted()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00603">gtalk_is_answered()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00237">gtalk_member_destroy()</a>, <a class="el" href="chan__gtalk_8c_source.html#l01154">gtalk_newcall()</a>, and <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>.</p>

<p>Referenced by <a class="el" href="chan__gtalk_8c_source.html#l01840">gtalk_create_member()</a>, and <a class="el" href="chan__gtalk_8c_source.html#l01901">gtalk_load_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01765"></a>01765 {
<a name="l01766"></a>01766    <span class="keyword">struct </span><a class="code" href="structgtalk.html">gtalk</a> *client = <a class="code" href="astobj_8h.html#ab9c2c3dae8dc0cd67210b5e03b3b7d6e" title="Increment an object reference count.">ASTOBJ_REF</a>((<span class="keyword">struct</span> <a class="code" href="structgtalk.html">gtalk</a> *) data);
<a name="l01767"></a>01767 
<a name="l01768"></a>01768    <span class="keywordflow">if</span> (iks_find_attrib(pak-&gt;x, <span class="stringliteral">&quot;type&quot;</span>) &amp;&amp; !strcmp(iks_find_attrib (pak-&gt;x, <span class="stringliteral">&quot;type&quot;</span>),<span class="stringliteral">&quot;error&quot;</span>)) {
<a name="l01769"></a>01769       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Remote peer reported an error, trying to establish the call anyway\n&quot;</span>);
<a name="l01770"></a>01770    }
<a name="l01771"></a>01771    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iks_find_with_attrib(pak-&gt;x, <span class="stringliteral">&quot;session&quot;</span>, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;initiate&quot;</span>)) {
<a name="l01772"></a>01772       <span class="comment">/* New call */</span>
<a name="l01773"></a>01773       <a class="code" href="chan__gtalk_8c.html#aa8c45a47a9e46688c69cba60399bfd03">gtalk_newcall</a>(client, pak);
<a name="l01774"></a>01774    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iks_find_with_attrib(pak-&gt;x, <span class="stringliteral">&quot;session&quot;</span>, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;candidates&quot;</span>) || iks_find_with_attrib(pak-&gt;x, <span class="stringliteral">&quot;session&quot;</span>, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;transport-info&quot;</span>)) {
<a name="l01775"></a>01775       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(3, <span class="stringliteral">&quot;About to add candidate!\n&quot;</span>);
<a name="l01776"></a>01776       <a class="code" href="chan__gtalk_8c.html#a300fd28bae4ef2ff4b18e5c2e80244cf">gtalk_add_candidate</a>(client, pak);
<a name="l01777"></a>01777       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(3, <span class="stringliteral">&quot;Candidate Added!\n&quot;</span>);
<a name="l01778"></a>01778    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iks_find_with_attrib(pak-&gt;x, <span class="stringliteral">&quot;session&quot;</span>, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;accept&quot;</span>)) {
<a name="l01779"></a>01779       <a class="code" href="chan__gtalk_8c.html#a3d19065e34e7d81391accb2ac3cb7cf1">gtalk_is_answered</a>(client, pak);
<a name="l01780"></a>01780    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iks_find_with_attrib(pak-&gt;x, <span class="stringliteral">&quot;session&quot;</span>, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;transport-accept&quot;</span>)) {
<a name="l01781"></a>01781       <a class="code" href="chan__gtalk_8c.html#ab1d8e1f165c49766885eeefb88ee1683">gtalk_is_accepted</a>(client, pak);
<a name="l01782"></a>01782    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iks_find_with_attrib(pak-&gt;x, <span class="stringliteral">&quot;session&quot;</span>, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;content-info&quot;</span>) || iks_find_with_attrib(pak-&gt;x, <span class="stringliteral">&quot;gtalk&quot;</span>, <span class="stringliteral">&quot;action&quot;</span>, <span class="stringliteral">&quot;session-info&quot;</span>)) {
<a name="l01783"></a>01783       <a class="code" href="chan__gtalk_8c.html#a61cd7bfb93e66deda92be4dd3bf8175f">gtalk_handle_dtmf</a>(client, pak);
<a name="l01784"></a>01784    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iks_find_with_attrib(pak-&gt;x, <span class="stringliteral">&quot;session&quot;</span>, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;terminate&quot;</span>)) {
<a name="l01785"></a>01785       <a class="code" href="chan__gtalk_8c.html#afdd3edee003bac0ad10d23a88b9b2a62">gtalk_hangup_farend</a>(client, pak);
<a name="l01786"></a>01786    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iks_find_with_attrib(pak-&gt;x, <span class="stringliteral">&quot;session&quot;</span>, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;reject&quot;</span>)) {
<a name="l01787"></a>01787       <a class="code" href="chan__gtalk_8c.html#afdd3edee003bac0ad10d23a88b9b2a62">gtalk_hangup_farend</a>(client, pak);
<a name="l01788"></a>01788    }
<a name="l01789"></a>01789    <a class="code" href="astobj_8h.html#aed02826b481ce75ec710c1184ac8f059" title="Decrement the reference count on an object.">ASTOBJ_UNREF</a>(client, <a class="code" href="chan__gtalk_8c.html#a70f7219810c0483ff4725912193266bd">gtalk_member_destroy</a>);
<a name="l01790"></a>01790    <span class="keywordflow">return</span> IKS_FILTER_EAT;
<a name="l01791"></a>01791 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a18491cc6e0e1b499f59b1524b67e8cb7"></a><!-- doxytag: member="chan_gtalk.c::gtalk_read" ref="a18491cc6e0e1b499f59b1524b67e8cb7" args="(struct ast_channel *ast)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__frame.html">ast_frame</a> * gtalk_read </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>ast</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l01413">1413</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="chan__gtalk_8c_source.html#l01385">gtalk_rtp_read()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00098">gtalk_pvt::lock</a>, and <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01414"></a>01414 {
<a name="l01415"></a>01415    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *fr;
<a name="l01416"></a>01416    <span class="keyword">struct </span><a class="code" href="structgtalk__pvt.html">gtalk_pvt</a> *p = ast-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l01417"></a>01417 
<a name="l01418"></a>01418    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;p-&gt;<a class="code" href="structgtalk__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01419"></a>01419    fr = <a class="code" href="chan__gtalk_8c.html#a51669af6c51b461739d586003af35dde">gtalk_rtp_read</a>(ast, p);
<a name="l01420"></a>01420    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structgtalk__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01421"></a>01421    <span class="keywordflow">return</span> fr;
<a name="l01422"></a>01422 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a03e60f1275a660cde724d9a9b930a065"></a><!-- doxytag: member="chan_gtalk.c::gtalk_request" ref="a03e60f1275a660cde724d9a9b930a065" args="(const char *type, int format, void *data, int *cause)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__channel.html">ast_channel</a> * gtalk_request </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>format</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>cause</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Part of PBX interface. </p>

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l01637">1637</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="res__jabber_8c_source.html#l02954">ast_aji_get_client()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8h_source.html#l00359">AST_STATE_DOWN</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="astobj_8h_source.html#l00109">ASTOBJ_UNLOCK</a>, <a class="el" href="astobj_8h_source.html#l00218">ASTOBJ_UNREF</a>, <a class="el" href="astobj_8h_source.html#l00104">ASTOBJ_WRLOCK</a>, <a class="el" href="adsistub_8c_source.html#l00049">chan</a>, <a class="el" href="chan__gtalk_8c_source.html#l00140">gtalk::connection</a>, <a class="el" href="chan__gtalk_8c_source.html#l00242">find_gtalk()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00909">gtalk_alloc()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00237">gtalk_member_destroy()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00989">gtalk_new()</a>, <a class="el" href="jabber_8h_source.html#l00149">aji_client::jid</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="aesopt_8h_source.html#l00399">s</a>, <a class="el" href="agi_2strcompat_8c_source.html#l00027">strsep()</a>, and <a class="el" href="chan__gtalk_8c_source.html#l00145">gtalk::user</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01638"></a>01638 {
<a name="l01639"></a>01639    <span class="keyword">struct </span><a class="code" href="structgtalk__pvt.html">gtalk_pvt</a> *p = NULL;
<a name="l01640"></a>01640    <span class="keyword">struct </span><a class="code" href="structgtalk.html">gtalk</a> *client = NULL;
<a name="l01641"></a>01641    <span class="keywordtype">char</span> *sender = NULL, *to = NULL, *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a> = NULL;
<a name="l01642"></a>01642    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a> = NULL;
<a name="l01643"></a>01643 
<a name="l01644"></a>01644    <span class="keywordflow">if</span> (<a class="code" href="structast__channel.html#a8f64897c7ccc5c13f276d1d07c4e7095">data</a>) {
<a name="l01645"></a>01645       s = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(<a class="code" href="structast__channel.html#a8f64897c7ccc5c13f276d1d07c4e7095">data</a>);
<a name="l01646"></a>01646       <span class="keywordflow">if</span> (s) {
<a name="l01647"></a>01647          sender = <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;s, <span class="stringliteral">&quot;/&quot;</span>);
<a name="l01648"></a>01648          <span class="keywordflow">if</span> (sender &amp;&amp; (sender[0] != <span class="charliteral">&apos;\0&apos;</span>))
<a name="l01649"></a>01649             to = <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;s, <span class="stringliteral">&quot;/&quot;</span>);
<a name="l01650"></a>01650          <span class="keywordflow">if</span> (!to) {
<a name="l01651"></a>01651             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Bad arguments in Gtalk Dialstring: %s\n&quot;</span>, (<span class="keywordtype">char</span>*) <a class="code" href="structast__channel.html#a8f64897c7ccc5c13f276d1d07c4e7095">data</a>);
<a name="l01652"></a>01652             <span class="keywordflow">return</span> NULL;
<a name="l01653"></a>01653          }
<a name="l01654"></a>01654       }
<a name="l01655"></a>01655    }
<a name="l01656"></a>01656 
<a name="l01657"></a>01657    client = <a class="code" href="chan__gtalk_8c.html#a3a4d5143261dfb2f100e526609223bab">find_gtalk</a>(to, sender);
<a name="l01658"></a>01658    <span class="keywordflow">if</span> (!client) {
<a name="l01659"></a>01659       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not find recipient.\n&quot;</span>);
<a name="l01660"></a>01660       <span class="keywordflow">return</span> NULL;
<a name="l01661"></a>01661    }
<a name="l01662"></a>01662    <span class="keywordflow">if</span> (!strcasecmp(client-&gt;name, <span class="stringliteral">&quot;guest&quot;</span>)){
<a name="l01663"></a>01663       <span class="comment">/* the guest account is not tied to any configured XMPP client,</span>
<a name="l01664"></a>01664 <span class="comment">         let&apos;s set it now */</span>
<a name="l01665"></a>01665       client-&gt;<a class="code" href="structgtalk.html#a22eb965539587ef7d2b0340d57159e3a">connection</a> = <a class="code" href="jabber_8h.html#a6689c8e948c8d55e092f30277336fde7" title="grab a aji_client structure by label name or JID (without the resource string)">ast_aji_get_client</a>(sender);
<a name="l01666"></a>01666       <span class="keywordflow">if</span> (!client-&gt;<a class="code" href="structgtalk.html#a22eb965539587ef7d2b0340d57159e3a">connection</a>) {
<a name="l01667"></a>01667          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;No XMPP client to talk to, us (partial JID) : %s\n&quot;</span>, sender);
<a name="l01668"></a>01668          <a class="code" href="astobj_8h.html#aed02826b481ce75ec710c1184ac8f059" title="Decrement the reference count on an object.">ASTOBJ_UNREF</a>(client, <a class="code" href="chan__gtalk_8c.html#a70f7219810c0483ff4725912193266bd">gtalk_member_destroy</a>);
<a name="l01669"></a>01669          <span class="keywordflow">return</span> NULL;
<a name="l01670"></a>01670       }
<a name="l01671"></a>01671    }
<a name="l01672"></a>01672        
<a name="l01673"></a>01673    <a class="code" href="astobj_8h.html#ab4a4c9fe0af3b6237d81ae6fd7b857d4" title="Lock an ASTOBJ for writing.">ASTOBJ_WRLOCK</a>(client);
<a name="l01674"></a>01674    p = <a class="code" href="chan__gtalk_8c.html#aa0e0e8c2e99606e052fcd142dcf580dd">gtalk_alloc</a>(client, strchr(sender, <span class="charliteral">&apos;@&apos;</span>) ? sender : client-&gt;<a class="code" href="structgtalk.html#a22eb965539587ef7d2b0340d57159e3a">connection</a>-&gt;<a class="code" href="structaji__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;full, strchr(to, <span class="charliteral">&apos;@&apos;</span>) ? to : client-&gt;<a class="code" href="structgtalk.html#a7932bef941e6643d2487880116d9990f">user</a>, NULL);
<a name="l01675"></a>01675    <span class="keywordflow">if</span> (p)
<a name="l01676"></a>01676       chan = <a class="code" href="chan__gtalk_8c.html#aff3b348d0837fe806e53d1b66130693e" title="Start new gtalk channel.">gtalk_new</a>(client, p, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a>, to);
<a name="l01677"></a>01677 
<a name="l01678"></a>01678    <a class="code" href="astobj_8h.html#a9acee27cc52e8533d439f6cc10d11fbc" title="Unlock a locked object.">ASTOBJ_UNLOCK</a>(client);
<a name="l01679"></a>01679    <span class="keywordflow">return</span> chan;
<a name="l01680"></a>01680 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac60c0cc7813dc8afb593b62633a0236f"></a><!-- doxytag: member="chan_gtalk.c::gtalk_response" ref="ac60c0cc7813dc8afb593b62633a0236f" args="(struct gtalk *client, char *from, ikspak *pak, const char *reasonstr, const char *reasonstr2)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int gtalk_response </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structgtalk.html">gtalk</a> *&nbsp;</td>
          <td class="paramname"> <em>client</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>from</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ikspak *&nbsp;</td>
          <td class="paramname"> <em>pak</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>reasonstr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>reasonstr2</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l00571">571</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="res__jabber_8c_source.html#l00818">ast_aji_send()</a>, and <a class="el" href="chan__gtalk_8c_source.html#l00140">gtalk::connection</a>.</p>

<p>Referenced by <a class="el" href="chan__gtalk_8c_source.html#l00680">gtalk_handle_dtmf()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00748">gtalk_hangup_farend()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00656">gtalk_is_accepted()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00603">gtalk_is_answered()</a>, and <a class="el" href="chan__gtalk_8c_source.html#l01154">gtalk_newcall()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00572"></a>00572 {
<a name="l00573"></a>00573    iks *response = NULL, *error = NULL, *reason = NULL;
<a name="l00574"></a>00574    <span class="keywordtype">int</span> res = -1;
<a name="l00575"></a>00575 
<a name="l00576"></a>00576    response = iks_new(<span class="stringliteral">&quot;iq&quot;</span>);
<a name="l00577"></a>00577    <span class="keywordflow">if</span> (response) {
<a name="l00578"></a>00578       iks_insert_attrib(response, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;result&quot;</span>);
<a name="l00579"></a>00579       iks_insert_attrib(response, <span class="stringliteral">&quot;from&quot;</span>, from);
<a name="l00580"></a>00580       iks_insert_attrib(response, <span class="stringliteral">&quot;to&quot;</span>, iks_find_attrib(pak-&gt;x, <span class="stringliteral">&quot;from&quot;</span>));
<a name="l00581"></a>00581       iks_insert_attrib(response, <span class="stringliteral">&quot;id&quot;</span>, iks_find_attrib(pak-&gt;x, <span class="stringliteral">&quot;id&quot;</span>));
<a name="l00582"></a>00582       <span class="keywordflow">if</span> (reasonstr) {
<a name="l00583"></a>00583          error = iks_new(<span class="stringliteral">&quot;error&quot;</span>);
<a name="l00584"></a>00584          <span class="keywordflow">if</span> (error) {
<a name="l00585"></a>00585             iks_insert_attrib(error, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;cancel&quot;</span>);
<a name="l00586"></a>00586             reason = iks_new(reasonstr);
<a name="l00587"></a>00587             <span class="keywordflow">if</span> (reason)
<a name="l00588"></a>00588                iks_insert_node(error, reason);
<a name="l00589"></a>00589             iks_insert_node(response, error);
<a name="l00590"></a>00590          }
<a name="l00591"></a>00591       }
<a name="l00592"></a>00592       <a class="code" href="jabber_8h.html#a3c77ceecc909619207e971421fc3e9ef" title="Wraps raw sending.">ast_aji_send</a>(client-&gt;<a class="code" href="structgtalk.html#a22eb965539587ef7d2b0340d57159e3a">connection</a>, response);
<a name="l00593"></a>00593       res = 0;
<a name="l00594"></a>00594    }
<a name="l00595"></a>00595 
<a name="l00596"></a>00596    iks_delete(reason);
<a name="l00597"></a>00597    iks_delete(error);
<a name="l00598"></a>00598    iks_delete(response);
<a name="l00599"></a>00599 
<a name="l00600"></a>00600    <span class="keywordflow">return</span> res;
<a name="l00601"></a>00601 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a04f7e90ada5bf53d2d7d02e9dd4ad66c"></a><!-- doxytag: member="chan_gtalk.c::gtalk_ringing_ack" ref="a04f7e90ada5bf53d2d7d02e9dd4ad66c" args="(void *data, ikspak *pak)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int gtalk_ringing_ack </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ikspak *&nbsp;</td>
          <td class="paramname"> <em>pak</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l00501">501</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="frame_8h_source.html#l00300">AST_CONTROL_RINGING</a>, <a class="el" href="channel_8c_source.html#l01123">ast_queue_control()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00140">gtalk::connection</a>, <a class="el" href="jabber_8h_source.html#l00151">aji_client::f</a>, <a class="el" href="chan__gtalk_8c_source.html#l00115">gtalk_pvt::owner</a>, <a class="el" href="chan__gtalk_8c_source.html#l00100">gtalk_pvt::parent</a>, and <a class="el" href="chan__gtalk_8c_source.html#l00105">gtalk_pvt::ringrule</a>.</p>

<p>Referenced by <a class="el" href="chan__gtalk_8c_source.html#l01593">gtalk_call()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00502"></a>00502 {
<a name="l00503"></a>00503    <span class="keyword">struct </span><a class="code" href="structgtalk__pvt.html">gtalk_pvt</a> *p = data;
<a name="l00504"></a>00504 
<a name="l00505"></a>00505    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structgtalk__pvt.html#a48b56664545a8ea58b25639b74f863b5">ringrule</a>)
<a name="l00506"></a>00506       iks_filter_remove_rule(p-&gt;<a class="code" href="structgtalk__pvt.html#a06cbd7bfad0d73228cdd0dbb68fb999f">parent</a>-&gt;<a class="code" href="structgtalk.html#a22eb965539587ef7d2b0340d57159e3a">connection</a>-&gt;<a class="code" href="structaji__client.html#afc6fdfd9b3ea85d062020bb1aea416b3">f</a>, p-&gt;<a class="code" href="structgtalk__pvt.html#a48b56664545a8ea58b25639b74f863b5">ringrule</a>);
<a name="l00507"></a>00507    p-&gt;<a class="code" href="structgtalk__pvt.html#a48b56664545a8ea58b25639b74f863b5">ringrule</a> = NULL;
<a name="l00508"></a>00508    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structgtalk__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)
<a name="l00509"></a>00509       <a class="code" href="channel_8h.html#a60f9d2b0ab8b7a839902313321163b28" title="Queue a control frame with payload.">ast_queue_control</a>(p-&gt;<a class="code" href="structgtalk__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390aa5814e690c23b590bcd4eb43535907a1">AST_CONTROL_RINGING</a>);
<a name="l00510"></a>00510    <span class="keywordflow">return</span> IKS_FILTER_EAT;
<a name="l00511"></a>00511 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a51669af6c51b461739d586003af35dde"></a><!-- doxytag: member="chan_gtalk.c::gtalk_rtp_read" ref="a51669af6c51b461739d586003af35dde" args="(struct ast_channel *ast, struct gtalk_pvt *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__frame.html">ast_frame</a>* gtalk_rtp_read </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>ast</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structgtalk__pvt.html">gtalk_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l01385">1385</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="frame_8h_source.html#l00273">AST_FORMAT_AUDIO_MASK</a>, <a class="el" href="frame_8h_source.html#l00288">AST_FORMAT_VIDEO_MASK</a>, <a class="el" href="frame_8h_source.html#l00101">AST_FRAME_VOICE</a>, <a class="el" href="frame_8c_source.html#l00124">ast_null_frame</a>, <a class="el" href="rtp_8c_source.html#l01562">ast_rtp_read()</a>, <a class="el" href="channel_8c_source.html#l03731">ast_set_read_format()</a>, <a class="el" href="channel_8c_source.html#l03737">ast_set_write_format()</a>, <a class="el" href="format__g726_8c_source.html#l00177">f</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="chan__gtalk_8c_source.html#l01256">gtalk_update_stun()</a>, <a class="el" href="channel_8h_source.html#l00482">ast_channel::nativeformats</a>, <a class="el" href="chan__gtalk_8c_source.html#l00115">gtalk_pvt::owner</a>, <a class="el" href="chan__gtalk_8c_source.html#l00100">gtalk_pvt::parent</a>, <a class="el" href="channel_8h_source.html#l00483">ast_channel::readformat</a>, <a class="el" href="chan__gtalk_8c_source.html#l00116">gtalk_pvt::rtp</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, and <a class="el" href="channel_8h_source.html#l00484">ast_channel::writeformat</a>.</p>

<p>Referenced by <a class="el" href="chan__gtalk_8c_source.html#l01413">gtalk_read()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01386"></a>01386 {
<a name="l01387"></a>01387    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l01388"></a>01388 
<a name="l01389"></a>01389    <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="structgtalk__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>)
<a name="l01390"></a>01390       <span class="keywordflow">return</span> &amp;<a class="code" href="frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;
<a name="l01391"></a>01391    f = <a class="code" href="rtp_8h.html#ac0a9d31f175e3de83fa1dda629c11674">ast_rtp_read</a>(p-&gt;<a class="code" href="structgtalk__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>);
<a name="l01392"></a>01392    <a class="code" href="chan__gtalk_8c.html#a4a9807802122430659202f6ce9663ead">gtalk_update_stun</a>(p-&gt;<a class="code" href="structgtalk__pvt.html#a06cbd7bfad0d73228cdd0dbb68fb999f">parent</a>, p);
<a name="l01393"></a>01393    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structgtalk__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l01394"></a>01394       <span class="comment">/* We already hold the channel lock */</span>
<a name="l01395"></a>01395       <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>) {
<a name="l01396"></a>01396          <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> != (p-&gt;<a class="code" href="structgtalk__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a> &amp; <a class="code" href="frame_8h.html#a3f680b9c15596de927d507a664fd2803">AST_FORMAT_AUDIO_MASK</a>)) {
<a name="l01397"></a>01397             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Oooh, format changed to %d\n&quot;</span>, f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>);
<a name="l01398"></a>01398             p-&gt;<a class="code" href="structgtalk__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a> =
<a name="l01399"></a>01399                (p-&gt;<a class="code" href="structgtalk__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a> &amp; <a class="code" href="frame_8h.html#ad048231af8a6271706585e3c8630dc69">AST_FORMAT_VIDEO_MASK</a>) | f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>;
<a name="l01400"></a>01400             <a class="code" href="channel_8h.html#a72d53065c6bc2b6092fa41eefa03f1ad" title="Sets read format on channel chan Set read format for channel to whichever component...">ast_set_read_format</a>(p-&gt;<a class="code" href="structgtalk__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, p-&gt;<a class="code" href="structgtalk__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#ab7786a0f5b9a9ebf83daed87be4f3868">readformat</a>);
<a name="l01401"></a>01401             <a class="code" href="channel_8h.html#a978161a52d98fdaee374d1f6e1359544" title="Sets write format on channel chan Set write format for channel to whichever component...">ast_set_write_format</a>(p-&gt;<a class="code" href="structgtalk__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, p-&gt;<a class="code" href="structgtalk__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#a00f5ce2ad53ff8523f8e46ea5aceba48">writeformat</a>);
<a name="l01402"></a>01402          }
<a name="l01403"></a>01403 <span class="comment">/*       if ((ast_test_flag(p, SIP_DTMF) == SIP_DTMF_INBAND) &amp;&amp; p-&gt;vad) {</span>
<a name="l01404"></a>01404 <span class="comment">            f = ast_dsp_process(p-&gt;owner, p-&gt;vad, f);</span>
<a name="l01405"></a>01405 <span class="comment">            if (option_debug &amp;&amp; f &amp;&amp; (f-&gt;frametype == AST_FRAME_DTMF))</span>
<a name="l01406"></a>01406 <span class="comment">               ast_debug(1, &quot;* Detected inband DTMF &apos;%c&apos;\n&quot;, f-&gt;subclass);</span>
<a name="l01407"></a>01407 <span class="comment">              } */</span>
<a name="l01408"></a>01408       }
<a name="l01409"></a>01409    }
<a name="l01410"></a>01410    <span class="keywordflow">return</span> f;
<a name="l01411"></a>01411 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa877860a00947443ae12744d4b7730f2"></a><!-- doxytag: member="chan_gtalk.c::gtalk_sendhtml" ref="aa877860a00947443ae12744d4b7730f2" args="(struct ast_channel *ast, int subclass, const char *data, int datalen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int gtalk_sendhtml </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>ast</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>subclass</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>datalen</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l01566">1566</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, and <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01567"></a>01567 {
<a name="l01568"></a>01568    <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;XXX Implement gtalk sendhtml XXX\n&quot;</span>);
<a name="l01569"></a>01569 
<a name="l01570"></a>01570    <span class="keywordflow">return</span> -1;
<a name="l01571"></a>01571 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6e1f17efe86af5cb94a53c6c0e74bdd4"></a><!-- doxytag: member="chan_gtalk.c::gtalk_set_rtp_peer" ref="a6e1f17efe86af5cb94a53c6c0e74bdd4" args="(struct ast_channel *chan, struct ast_rtp *rtp, struct ast_rtp *vrtp, struct ast_rtp *trtp, int codecs, int nat_active)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int gtalk_set_rtp_peer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>rtp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>vrtp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__rtp.html">ast_rtp</a> *&nbsp;</td>
          <td class="paramname"> <em>trtp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>codecs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>nat_active</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l00551">551</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00098">gtalk_pvt::lock</a>, and <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00552"></a>00552 {
<a name="l00553"></a>00553    <span class="keyword">struct </span><a class="code" href="structgtalk__pvt.html">gtalk_pvt</a> *p;
<a name="l00554"></a>00554 
<a name="l00555"></a>00555    p = chan-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l00556"></a>00556    <span class="keywordflow">if</span> (!p)
<a name="l00557"></a>00557       <span class="keywordflow">return</span> -1;
<a name="l00558"></a>00558    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;p-&gt;<a class="code" href="structgtalk__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00559"></a>00559 
<a name="l00560"></a>00560 <span class="comment">/* if (rtp)</span>
<a name="l00561"></a>00561 <span class="comment">      ast_rtp_get_peer(rtp, &amp;p-&gt;redirip);</span>
<a name="l00562"></a>00562 <span class="comment">   else</span>
<a name="l00563"></a>00563 <span class="comment">      memset(&amp;p-&gt;redirip, 0, sizeof(p-&gt;redirip));</span>
<a name="l00564"></a>00564 <span class="comment">   p-&gt;redircodecs = codecs; */</span>
<a name="l00565"></a>00565 
<a name="l00566"></a>00566    <span class="comment">/* Reset lastrtprx timer */</span>
<a name="l00567"></a>00567    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structgtalk__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00568"></a>00568    <span class="keywordflow">return</span> 0;
<a name="l00569"></a>00569 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae33a85434da4c4a6cb7454dc6528432b"></a><!-- doxytag: member="chan_gtalk.c::gtalk_show_channels" ref="ae33a85434da4c4a6cb7454dc6528432b" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char * gtalk_show_channels </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>CLI command "gtalk show channels". </p>

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l01683">1683</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="jabber_8h_source.html#l00073">AJI_MAX_JIDLEN</a>, <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="frame_8c_source.html#l00573">ast_getformatname()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="astobj_8h_source.html#l00376">ASTOBJ_CONTAINER_TRAVERSE</a>, <a class="el" href="astobj_8h_source.html#l00109">ASTOBJ_UNLOCK</a>, <a class="el" href="astobj_8h_source.html#l00104">ASTOBJ_WRLOCK</a>, <a class="el" href="adsistub_8c_source.html#l00049">chan</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, <a class="el" href="chan__dahdi_8c.html#ac8dc47e3b39c930caed4bfd05b4ba805">FORMAT</a>, <a class="el" href="chan__gtalk_8c_source.html#l00235">gtalk_list</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__gtalk_8c_source.html#l00120">gtalk_pvt::next</a>, <a class="el" href="chan__gtalk_8c_source.html#l00115">gtalk_pvt::owner</a>, <a class="el" href="channel_8h_source.html#l00483">ast_channel::readformat</a>, <a class="el" href="chan__gtalk_8c_source.html#l00103">gtalk_pvt::them</a>, <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>, and <a class="el" href="channel_8h_source.html#l00484">ast_channel::writeformat</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01684"></a>01684 {
<a name="l01685"></a>01685 <span class="preprocessor">#define FORMAT  &quot;%-30.30s  %-30.30s  %-15.15s  %-5.5s %-5.5s \n&quot;</span>
<a name="l01686"></a>01686 <span class="preprocessor"></span>   <span class="keyword">struct </span><a class="code" href="structgtalk__pvt.html">gtalk_pvt</a> *p;
<a name="l01687"></a>01687    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>;
<a name="l01688"></a>01688    <span class="keywordtype">int</span> numchans = 0;
<a name="l01689"></a>01689    <span class="keywordtype">char</span> them[<a class="code" href="jabber_8h.html#aff8969a8d91846c9e669eb4f0ec5208a">AJI_MAX_JIDLEN</a>];
<a name="l01690"></a>01690    <span class="keywordtype">char</span> *jid = NULL;
<a name="l01691"></a>01691    <span class="keywordtype">char</span> *resource = NULL;
<a name="l01692"></a>01692 
<a name="l01693"></a>01693    <span class="keywordflow">switch</span> (cmd) {
<a name="l01694"></a>01694    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l01695"></a>01695       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;gtalk show channels&quot;</span>;
<a name="l01696"></a>01696       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l01697"></a>01697          <span class="stringliteral">&quot;Usage: gtalk show channels\n&quot;</span>
<a name="l01698"></a>01698          <span class="stringliteral">&quot;       Shows current state of the Gtalk channels.\n&quot;</span>;
<a name="l01699"></a>01699       <span class="keywordflow">return</span> NULL;
<a name="l01700"></a>01700    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l01701"></a>01701       <span class="keywordflow">return</span> NULL;
<a name="l01702"></a>01702    }
<a name="l01703"></a>01703 
<a name="l01704"></a>01704    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> != 3)
<a name="l01705"></a>01705       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l01706"></a>01706 
<a name="l01707"></a>01707    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;gtalklock);
<a name="l01708"></a>01708    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, FORMAT, <span class="stringliteral">&quot;Channel&quot;</span>, <span class="stringliteral">&quot;Jabber ID&quot;</span>, <span class="stringliteral">&quot;Resource&quot;</span>, <span class="stringliteral">&quot;Read&quot;</span>, <span class="stringliteral">&quot;Write&quot;</span>);
<a name="l01709"></a>01709    <a class="code" href="astobj_8h.html#a8483cbd2bcf0b91ac62168fb1cb7f5b1" title="Iterate through the objects in a container.">ASTOBJ_CONTAINER_TRAVERSE</a>(&amp;<a class="code" href="chan__gtalk_8c.html#a8ddc6fee75005b7f3f13d189dd1ecb80">gtalk_list</a>, 1, {
<a name="l01710"></a>01710       <a class="code" href="astobj_8h.html#ab4a4c9fe0af3b6237d81ae6fd7b857d4" title="Lock an ASTOBJ for writing.">ASTOBJ_WRLOCK</a>(iterator);
<a name="l01711"></a>01711       p = iterator-&gt;p;
<a name="l01712"></a>01712       <span class="keywordflow">while</span>(p) {
<a name="l01713"></a>01713          chan = p-&gt;<a class="code" href="structgtalk__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;
<a name="l01714"></a>01714          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(them, p-&gt;<a class="code" href="structgtalk__pvt.html#a7c3b41a9f87238ef5a35607e6655f02e">them</a>, <span class="keyword">sizeof</span>(them));
<a name="l01715"></a>01715          jid = them;
<a name="l01716"></a>01716          resource = strchr(them, <span class="charliteral">&apos;/&apos;</span>);
<a name="l01717"></a>01717          <span class="keywordflow">if</span> (!resource)
<a name="l01718"></a>01718             resource = <span class="stringliteral">&quot;None&quot;</span>;
<a name="l01719"></a>01719          <span class="keywordflow">else</span> {
<a name="l01720"></a>01720             *resource = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01721"></a>01721             resource ++;
<a name="l01722"></a>01722          }
<a name="l01723"></a>01723          <span class="keywordflow">if</span> (chan)
<a name="l01724"></a>01724             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, FORMAT, 
<a name="l01725"></a>01725                chan-&gt;name,
<a name="l01726"></a>01726                jid,
<a name="l01727"></a>01727                resource,
<a name="l01728"></a>01728                <a class="code" href="frame_8h.html#afe8f690984f8ba95cd01a431198c10bf" title="Get the name of a format.">ast_getformatname</a>(chan-&gt;<a class="code" href="structast__channel.html#ab7786a0f5b9a9ebf83daed87be4f3868">readformat</a>),
<a name="l01729"></a>01729                <a class="code" href="frame_8h.html#afe8f690984f8ba95cd01a431198c10bf" title="Get the name of a format.">ast_getformatname</a>(chan-&gt;<a class="code" href="structast__channel.html#a00f5ce2ad53ff8523f8e46ea5aceba48">writeformat</a>)               
<a name="l01730"></a>01730                );
<a name="l01731"></a>01731          <span class="keywordflow">else</span> 
<a name="l01732"></a>01732             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No available channel\n&quot;</span>);
<a name="l01733"></a>01733          numchans ++;
<a name="l01734"></a>01734          p = p-&gt;<a class="code" href="structgtalk__pvt.html#ad52b2b57b8b3ac8cab36317c65547157">next</a>;
<a name="l01735"></a>01735       }
<a name="l01736"></a>01736       <a class="code" href="astobj_8h.html#a9acee27cc52e8533d439f6cc10d11fbc" title="Unlock a locked object.">ASTOBJ_UNLOCK</a>(iterator);
<a name="l01737"></a>01737    });
<a name="l01738"></a>01738 
<a name="l01739"></a>01739    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;gtalklock);
<a name="l01740"></a>01740 
<a name="l01741"></a>01741    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;%d active gtalk channel%s\n&quot;</span>, numchans, (numchans != 1) ? <span class="stringliteral">&quot;s&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l01742"></a>01742    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l01743"></a>01743 <span class="preprocessor">#undef FORMAT</span>
<a name="l01744"></a>01744 <span class="preprocessor"></span>}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4a9807802122430659202f6ce9663ead"></a><!-- doxytag: member="chan_gtalk.c::gtalk_update_stun" ref="a4a9807802122430659202f6ce9663ead" args="(struct gtalk *client, struct gtalk_pvt *p)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int gtalk_update_stun </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structgtalk.html">gtalk</a> *&nbsp;</td>
          <td class="paramname"> <em>client</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structgtalk__pvt.html">gtalk_pvt</a> *&nbsp;</td>
          <td class="paramname"> <em>p</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l01256">1256</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="utils_8c_source.html#l00182">ast_gethostbyname()</a>, <a class="el" href="utils_8c_source.html#l00431">ast_inet_ntoa()</a>, <a class="el" href="rtp_8c_source.html#l02681">ast_rtp_get_peer()</a>, <a class="el" href="rtp_8c_source.html#l00700">ast_rtp_stun_request()</a>, <a class="el" href="chan__skinny_8c_source.html#l00982">hp</a>, <a class="el" href="chan__gtalk_8c_source.html#l00132">gtalk_candidate::ip</a>, <a class="el" href="chan__gtalk_8c_source.html#l00099">gtalk_pvt::laststun</a>, <a class="el" href="chan__gtalk_8c_source.html#l00135">gtalk_candidate::next</a>, <a class="el" href="chan__gtalk_8c_source.html#l00111">gtalk_pvt::ourcandidates</a>, <a class="el" href="chan__gtalk_8c_source.html#l00133">gtalk_candidate::port</a>, <a class="el" href="chan__gtalk_8c_source.html#l00116">gtalk_pvt::rtp</a>, <a class="el" href="chan__gtalk_8c_source.html#l00110">gtalk_pvt::theircandidates</a>, and <a class="el" href="chan__gtalk_8c_source.html#l00127">gtalk_candidate::username</a>.</p>

<p>Referenced by <a class="el" href="chan__gtalk_8c_source.html#l01302">gtalk_add_candidate()</a>, and <a class="el" href="chan__gtalk_8c_source.html#l01385">gtalk_rtp_read()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01257"></a>01257 {
<a name="l01258"></a>01258    <span class="keyword">struct </span><a class="code" href="structgtalk__candidate.html">gtalk_candidate</a> *tmp;
<a name="l01259"></a>01259    <span class="keyword">struct </span>hostent *<a class="code" href="chan__skinny_8c.html#aa0f575fa3882aa394cc287edba645a35">hp</a>;
<a name="l01260"></a>01260    <span class="keyword">struct </span><a class="code" href="structast__hostent.html">ast_hostent</a> <a class="code" href="chan__skinny_8c.html#a9e435aef83f14da6d3d5ec44f821558e">ahp</a>;
<a name="l01261"></a>01261    <span class="keyword">struct </span>sockaddr_in sin;
<a name="l01262"></a>01262    <span class="keyword">struct </span>sockaddr_in aux;
<a name="l01263"></a>01263 
<a name="l01264"></a>01264    <span class="keywordflow">if</span> (time(NULL) == p-&gt;<a class="code" href="structgtalk__pvt.html#afea13c69c31226a6607e67b85f0231e2">laststun</a>)
<a name="l01265"></a>01265       <span class="keywordflow">return</span> 0;
<a name="l01266"></a>01266 
<a name="l01267"></a>01267    tmp = p-&gt;<a class="code" href="structgtalk__pvt.html#ad255738c9c6ff7d58888b3b937d57bfd">theircandidates</a>;
<a name="l01268"></a>01268    p-&gt;<a class="code" href="structgtalk__pvt.html#afea13c69c31226a6607e67b85f0231e2">laststun</a> = time(NULL);
<a name="l01269"></a>01269    <span class="keywordflow">while</span> (tmp) {
<a name="l01270"></a>01270       <span class="keywordtype">char</span> username[256];
<a name="l01271"></a>01271 
<a name="l01272"></a>01272       <span class="comment">/* Find the IP address of the host */</span>
<a name="l01273"></a>01273       hp = <a class="code" href="utils_8h.html#ad3b63ee1041593219ef0765b28d70442" title="Thread-safe gethostbyname function to use in Asterisk.">ast_gethostbyname</a>(tmp-&gt;<a class="code" href="structgtalk__candidate.html#ac03ec605186c0c6d17c4beaab73d615c">ip</a>, &amp;<a class="code" href="chan__skinny_8c.html#a9e435aef83f14da6d3d5ec44f821558e">ahp</a>);
<a name="l01274"></a>01274       sin.sin_family = AF_INET;
<a name="l01275"></a>01275       memcpy(&amp;sin.sin_addr, hp-&gt;h_addr, <span class="keyword">sizeof</span>(sin.sin_addr));
<a name="l01276"></a>01276       sin.sin_port = htons(tmp-&gt;<a class="code" href="structgtalk__candidate.html#a63c89c04d1feae07ca35558055155ffb">port</a>);
<a name="l01277"></a>01277       snprintf(username, <span class="keyword">sizeof</span>(username), <span class="stringliteral">&quot;%s%s&quot;</span>, tmp-&gt;<a class="code" href="structgtalk__candidate.html#a05eeba7fa0e9f1c4fcb8110937b46236">username</a>,
<a name="l01278"></a>01278           p-&gt;<a class="code" href="structgtalk__pvt.html#a389400de584309e3ed17fa62c709555f">ourcandidates</a>-&gt;<a class="code" href="structgtalk__candidate.html#a05eeba7fa0e9f1c4fcb8110937b46236">username</a>);
<a name="l01279"></a>01279       
<a name="l01280"></a>01280       <span class="comment">/* Find out the result of the STUN */</span>
<a name="l01281"></a>01281       <a class="code" href="rtp_8h.html#aa1ffde0e800995c386729bc5eaf82e7c">ast_rtp_get_peer</a>(p-&gt;<a class="code" href="structgtalk__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>, &amp;aux);
<a name="l01282"></a>01282 
<a name="l01283"></a>01283       <span class="comment">/* If the STUN result is different from the IP of the hostname,</span>
<a name="l01284"></a>01284 <span class="comment">         lock on the stun IP of the hostname advertised by the</span>
<a name="l01285"></a>01285 <span class="comment">         remote client */</span>
<a name="l01286"></a>01286       <span class="keywordflow">if</span> (aux.sin_addr.s_addr &amp;&amp; 
<a name="l01287"></a>01287           aux.sin_addr.s_addr != sin.sin_addr.s_addr)
<a name="l01288"></a>01288          <a class="code" href="rtp_8h.html#a07235f64f5a9df68065cfe08ee6d9f44" title="Send STUN request for an RTP socket Deprecated, this is just a wrapper for ast_rtp_stun_request()...">ast_rtp_stun_request</a>(p-&gt;<a class="code" href="structgtalk__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>, &amp;aux, username);
<a name="l01289"></a>01289       <span class="keywordflow">else</span> 
<a name="l01290"></a>01290          <a class="code" href="rtp_8h.html#a07235f64f5a9df68065cfe08ee6d9f44" title="Send STUN request for an RTP socket Deprecated, this is just a wrapper for ast_rtp_stun_request()...">ast_rtp_stun_request</a>(p-&gt;<a class="code" href="structgtalk__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>, &amp;sin, username);
<a name="l01291"></a>01291       
<a name="l01292"></a>01292       <span class="keywordflow">if</span> (aux.sin_addr.s_addr) {
<a name="l01293"></a>01293          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(4, <span class="stringliteral">&quot;Receiving RTP traffic from IP %s, matches with remote candidate&apos;s IP %s\n&quot;</span>, <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(aux.sin_addr), tmp-&gt;<a class="code" href="structgtalk__candidate.html#ac03ec605186c0c6d17c4beaab73d615c">ip</a>);
<a name="l01294"></a>01294          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(4, <span class="stringliteral">&quot;Sending STUN request to %s\n&quot;</span>, tmp-&gt;<a class="code" href="structgtalk__candidate.html#ac03ec605186c0c6d17c4beaab73d615c">ip</a>);
<a name="l01295"></a>01295       }
<a name="l01296"></a>01296 
<a name="l01297"></a>01297       tmp = tmp-&gt;<a class="code" href="structgtalk__candidate.html#a6f4a98673f70f06b746ef8e1c50c3ade">next</a>;
<a name="l01298"></a>01298    }
<a name="l01299"></a>01299    <span class="keywordflow">return</span> 1;
<a name="l01300"></a>01300 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="adcb572a924a53a9243646bd05656fda2"></a><!-- doxytag: member="chan_gtalk.c::gtalk_write" ref="adcb572a924a53a9243646bd05656fda2" args="(struct ast_channel *ast, struct ast_frame *frame)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int gtalk_write </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>ast</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td>
          <td class="paramname"> <em>f</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Send frame to media channel (rtp). </p>

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l01425">1425</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="frame_8h_source.html#l00113">AST_FRAME_IMAGE</a>, <a class="el" href="frame_8h_source.html#l00103">AST_FRAME_VIDEO</a>, <a class="el" href="frame_8h_source.html#l00101">AST_FRAME_VOICE</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="rtp_8c_source.html#l03790">ast_rtp_write()</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="chan__gtalk_8c_source.html#l00098">gtalk_pvt::lock</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="channel_8h_source.html#l00482">ast_channel::nativeformats</a>, <a class="el" href="channel_8h_source.html#l00483">ast_channel::readformat</a>, <a class="el" href="chan__gtalk_8c_source.html#l00116">gtalk_pvt::rtp</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, <a class="el" href="channel_8h_source.html#l00401">ast_channel::tech_pvt</a>, <a class="el" href="chan__gtalk_8c_source.html#l00117">gtalk_pvt::vrtp</a>, and <a class="el" href="channel_8h_source.html#l00484">ast_channel::writeformat</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01426"></a>01426 {
<a name="l01427"></a>01427    <span class="keyword">struct </span><a class="code" href="structgtalk__pvt.html">gtalk_pvt</a> *p = ast-&gt;<a class="code" href="structast__channel.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;
<a name="l01428"></a>01428    <span class="keywordtype">int</span> res = 0;
<a name="l01429"></a>01429 
<a name="l01430"></a>01430    <span class="keywordflow">switch</span> (frame-&gt;frametype) {
<a name="l01431"></a>01431    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>:
<a name="l01432"></a>01432       <span class="keywordflow">if</span> (!(frame-&gt;subclass &amp; ast-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a>)) {
<a name="l01433"></a>01433          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,
<a name="l01434"></a>01434                <span class="stringliteral">&quot;Asked to transmit frame type %d, while native formats is %d (read/write = %d/%d)\n&quot;</span>,
<a name="l01435"></a>01435                frame-&gt;subclass, ast-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a>, ast-&gt;<a class="code" href="structast__channel.html#ab7786a0f5b9a9ebf83daed87be4f3868">readformat</a>,
<a name="l01436"></a>01436                ast-&gt;<a class="code" href="structast__channel.html#a00f5ce2ad53ff8523f8e46ea5aceba48">writeformat</a>);
<a name="l01437"></a>01437          <span class="keywordflow">return</span> 0;
<a name="l01438"></a>01438       }
<a name="l01439"></a>01439       <span class="keywordflow">if</span> (p) {
<a name="l01440"></a>01440          <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;p-&gt;<a class="code" href="structgtalk__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01441"></a>01441          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structgtalk__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>) {
<a name="l01442"></a>01442             res = <a class="code" href="rtp_8h.html#a7a8ffdcbe10f04c3ca29e7cad359a68c">ast_rtp_write</a>(p-&gt;<a class="code" href="structgtalk__pvt.html#aba39773f04fd6540d56897b3d0396086">rtp</a>, frame);
<a name="l01443"></a>01443          }
<a name="l01444"></a>01444          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structgtalk__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01445"></a>01445       }
<a name="l01446"></a>01446       <span class="keywordflow">break</span>;
<a name="l01447"></a>01447    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a17ae96b6ea8a2388bb0d409e8124ff30">AST_FRAME_VIDEO</a>:
<a name="l01448"></a>01448       <span class="keywordflow">if</span> (p) {
<a name="l01449"></a>01449          <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;p-&gt;<a class="code" href="structgtalk__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01450"></a>01450          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structgtalk__pvt.html#a65e8f978abd3f0206026969c627200a9">vrtp</a>) {
<a name="l01451"></a>01451             res = <a class="code" href="rtp_8h.html#a7a8ffdcbe10f04c3ca29e7cad359a68c">ast_rtp_write</a>(p-&gt;<a class="code" href="structgtalk__pvt.html#a65e8f978abd3f0206026969c627200a9">vrtp</a>, frame);
<a name="l01452"></a>01452          }
<a name="l01453"></a>01453          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;p-&gt;<a class="code" href="structgtalk__pvt.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01454"></a>01454       }
<a name="l01455"></a>01455       <span class="keywordflow">break</span>;
<a name="l01456"></a>01456    <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a6c9398ee8989239124295d096a87bf32">AST_FRAME_IMAGE</a>:
<a name="l01457"></a>01457       <span class="keywordflow">return</span> 0;
<a name="l01458"></a>01458       <span class="keywordflow">break</span>;
<a name="l01459"></a>01459    <span class="keywordflow">default</span>:
<a name="l01460"></a>01460       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Can&apos;t send %d type frames with Gtalk write\n&quot;</span>,
<a name="l01461"></a>01461             frame-&gt;frametype);
<a name="l01462"></a>01462       <span class="keywordflow">return</span> 0;
<a name="l01463"></a>01463    }
<a name="l01464"></a>01464 
<a name="l01465"></a>01465    <span class="keywordflow">return</span> res;
<a name="l01466"></a>01466 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac3382bf6da54c56b37069bd76bbdf4f9"></a><!-- doxytag: member="chan_gtalk.c::load_module" ref="ac3382bf6da54c56b37069bd76bbdf4f9" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int load_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Load module into PBX, register channel. </p>

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l02033">2033</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="chan__gtalk_8c_source.html#l00218">__ourip</a>, <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="channel_8c_source.html#l00557">ast_channel_register()</a>, <a class="el" href="cli_8c_source.html#l01927">ast_cli_register_multiple()</a>, <a class="el" href="acl_8c_source.html#l00511">ast_find_ourip()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="loader_8c_source.html#l00542">ast_module_helper()</a>, <a class="el" href="module_8h_source.html#l00062">AST_MODULE_LOAD_DECLINE</a>, <a class="el" href="rtp_8c_source.html#l03896">ast_rtp_proto_register()</a>, <a class="el" href="astobj_8h_source.html#l00752">ASTOBJ_CONTAINER_INIT</a>, <a class="el" href="astmm_8h_source.html#l00084">free</a>, <a class="el" href="chan__gtalk_8c_source.html#l00070">GOOGLE_CONFIG</a>, <a class="el" href="chan__gtalk_8c_source.html#l00235">gtalk_list</a>, <a class="el" href="chan__gtalk_8c_source.html#l01901">gtalk_load_config()</a>, <a class="el" href="io_8c_source.html#l00072">io_context_create()</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="sched_8c_source.html#l00239">sched_context_create()</a>, and <a class="el" href="channel_8h_source.html#l00226">ast_channel_tech::type</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02034"></a>02034 {
<a name="l02035"></a>02035    <span class="keywordtype">char</span> *jabber_loaded = <a class="code" href="module_8h.html#a2114c90d58e7c3c3638965d1811301e9" title="Match modules names for the Asterisk cli.">ast_module_helper</a>(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;res_jabber.so&quot;</span>, 0, 0, 0, 0);
<a name="l02036"></a>02036    <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(jabber_loaded);
<a name="l02037"></a>02037    <span class="keywordflow">if</span> (!jabber_loaded) {
<a name="l02038"></a>02038       <span class="comment">/* If embedded, check for a different module name */</span>
<a name="l02039"></a>02039       jabber_loaded = <a class="code" href="module_8h.html#a2114c90d58e7c3c3638965d1811301e9" title="Match modules names for the Asterisk cli.">ast_module_helper</a>(<span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;res_jabber&quot;</span>, 0, 0, 0, 0);
<a name="l02040"></a>02040       <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(jabber_loaded);
<a name="l02041"></a>02041       <span class="keywordflow">if</span> (!jabber_loaded) {
<a name="l02042"></a>02042          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;chan_gtalk.so depends upon res_jabber.so\n&quot;</span>);
<a name="l02043"></a>02043          <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;
<a name="l02044"></a>02044       }
<a name="l02045"></a>02045    }
<a name="l02046"></a>02046 
<a name="l02047"></a>02047    <a class="code" href="astobj_8h.html#a8551f606c8aecc4797ef7728c7792827" title="Initialize a container.">ASTOBJ_CONTAINER_INIT</a>(&amp;<a class="code" href="chan__gtalk_8c.html#a8ddc6fee75005b7f3f13d189dd1ecb80">gtalk_list</a>);
<a name="l02048"></a>02048    <span class="keywordflow">if</span> (!<a class="code" href="chan__gtalk_8c.html#a87e308c2bc4ec47311b71ab1a613c44c">gtalk_load_config</a>()) {
<a name="l02049"></a>02049       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to read config file %s. Not loading module.\n&quot;</span>, <a class="code" href="chan__gtalk_8c.html#a9c681542bb2e28dccfdcb69fa9593b29">GOOGLE_CONFIG</a>);
<a name="l02050"></a>02050       <span class="keywordflow">return</span> 0;
<a name="l02051"></a>02051    }
<a name="l02052"></a>02052 
<a name="l02053"></a>02053    <a class="code" href="structsched.html">sched</a> = <a class="code" href="sched_8h.html#ad4fd5c63d5d3dcc8e11bec644c601017" title="New schedule context.">sched_context_create</a>();
<a name="l02054"></a>02054    <span class="keywordflow">if</span> (!<a class="code" href="structsched.html">sched</a>) 
<a name="l02055"></a>02055       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create schedule context\n&quot;</span>);
<a name="l02056"></a>02056 
<a name="l02057"></a>02057    <a class="code" href="chan__gtalk_8c.html#abda48311b6abe5a4dd8b6904ddde0a6d">io</a> = <a class="code" href="io_8h.html#a7d66d121ef63109c2f55188a38b8240f" title="Creates a context Create a context for I/O operations Basically mallocs an IO structure...">io_context_create</a>();
<a name="l02058"></a>02058    <span class="keywordflow">if</span> (!<a class="code" href="chan__gtalk_8c.html#abda48311b6abe5a4dd8b6904ddde0a6d">io</a>) 
<a name="l02059"></a>02059       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to create I/O context\n&quot;</span>);
<a name="l02060"></a>02060 
<a name="l02061"></a>02061    <span class="keywordflow">if</span> (<a class="code" href="acl_8h.html#a4fbb9258573d41461c7389afbcbba377">ast_find_ourip</a>(&amp;<a class="code" href="chan__gtalk_8c.html#a1d084b82cb21102ba46ea60d3cd9c085">__ourip</a>, <a class="code" href="chan__gtalk_8c.html#a4ec29229510a2e3ea6ce34d520f06e90">bindaddr</a>)) {
<a name="l02062"></a>02062       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to get own IP address, Gtalk disabled\n&quot;</span>);
<a name="l02063"></a>02063       <span class="keywordflow">return</span> 0;
<a name="l02064"></a>02064    }
<a name="l02065"></a>02065 
<a name="l02066"></a>02066    <a class="code" href="rtp_8h.html#a00b94396faf3f52b0c3ea612a9af334d" title="Register an RTP channel client.">ast_rtp_proto_register</a>(&amp;<a class="code" href="chan__gtalk_8c.html#a30cf4dbe190977582df5b9ee84937213" title="RTP driver interface.">gtalk_rtp</a>);
<a name="l02067"></a>02067    <a class="code" href="cli_8h.html#aadeef34f3106bb78aeb3414032ad7fb7" title="Register multiple commands.">ast_cli_register_multiple</a>(<a class="code" href="chan__gtalk_8c.html#af45d937b4d9f9451e31c9f059f8fb668">gtalk_cli</a>, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="chan__gtalk_8c.html#af45d937b4d9f9451e31c9f059f8fb668">gtalk_cli</a>));
<a name="l02068"></a>02068 
<a name="l02069"></a>02069    <span class="comment">/* Make sure we can register our channel type */</span>
<a name="l02070"></a>02070    <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#ab5f3776fda943e52820ceeee5835c1b4" title="Register a channel technology (a new channel driver) Called by a channel module to...">ast_channel_register</a>(&amp;<a class="code" href="chan__gtalk_8c.html#a99d9c7da92ab47bf1a3f0274c84ecee8" title="PBX interface structure for channel registration.">gtalk_tech</a>)) {
<a name="l02071"></a>02071       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to register channel class %s\n&quot;</span>, <a class="code" href="chan__gtalk_8c.html#a99d9c7da92ab47bf1a3f0274c84ecee8" title="PBX interface structure for channel registration.">gtalk_tech</a>.<a class="code" href="structast__channel__tech.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>);
<a name="l02072"></a>02072       <span class="keywordflow">return</span> -1;
<a name="l02073"></a>02073    }
<a name="l02074"></a>02074    <span class="keywordflow">return</span> 0;
<a name="l02075"></a>02075 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad1982509765f4870f1f63412a53ea668"></a><!-- doxytag: member="chan_gtalk.c::reload" ref="ad1982509765f4870f1f63412a53ea668" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int reload </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reload module. </p>

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l02078">2078</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02079"></a>02079 {
<a name="l02080"></a>02080    <span class="keywordflow">return</span> 0;
<a name="l02081"></a>02081 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad09fa931f468002152a3cc2d5ce25eae"></a><!-- doxytag: member="chan_gtalk.c::unload_module" ref="ad09fa931f468002152a3cc2d5ce25eae" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int unload_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Unload the <a class="el" href="structgtalk.html">gtalk</a> channel from Asterisk. </p>

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l02084">2084</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="channel_8c_source.html#l00587">ast_channel_unregister()</a>, <a class="el" href="cli_8c_source.html#l01937">ast_cli_unregister_multiple()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="rtp_8c_source.html#l03888">ast_rtp_proto_unregister()</a>, <a class="el" href="channel_8c_source.html#l01666">ast_softhangup()</a>, <a class="el" href="channel_8h_source.html#l00638">AST_SOFTHANGUP_APPUNLOAD</a>, <a class="el" href="astobj_8h_source.html#l00765">ASTOBJ_CONTAINER_DESTROY</a>, <a class="el" href="astobj_8h_source.html#l00453">ASTOBJ_CONTAINER_DESTROYALL</a>, <a class="el" href="astobj_8h_source.html#l00376">ASTOBJ_CONTAINER_TRAVERSE</a>, <a class="el" href="astobj_8h_source.html#l00109">ASTOBJ_UNLOCK</a>, <a class="el" href="astobj_8h_source.html#l00104">ASTOBJ_WRLOCK</a>, <a class="el" href="chan__gtalk_8c_source.html#l00235">gtalk_list</a>, <a class="el" href="chan__gtalk_8c_source.html#l00237">gtalk_member_destroy()</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__gtalk_8c_source.html#l00120">gtalk_pvt::next</a>, and <a class="el" href="chan__gtalk_8c_source.html#l00115">gtalk_pvt::owner</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02085"></a>02085 {
<a name="l02086"></a>02086    <span class="keyword">struct </span><a class="code" href="structgtalk__pvt.html">gtalk_pvt</a> *privates = NULL;
<a name="l02087"></a>02087    <a class="code" href="cli_8h.html#a56b6b59ee2eaa994597a5b0f4e9f9d09" title="Unregister multiple commands.">ast_cli_unregister_multiple</a>(<a class="code" href="chan__gtalk_8c.html#af45d937b4d9f9451e31c9f059f8fb668">gtalk_cli</a>, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="chan__gtalk_8c.html#af45d937b4d9f9451e31c9f059f8fb668">gtalk_cli</a>));
<a name="l02088"></a>02088    <span class="comment">/* First, take us out of the channel loop */</span>
<a name="l02089"></a>02089    <a class="code" href="channel_8h.html#a53b708b7fc71dcbcd33acae0ad4d7ef8" title="Unregister a channel technology.">ast_channel_unregister</a>(&amp;<a class="code" href="chan__gtalk_8c.html#a99d9c7da92ab47bf1a3f0274c84ecee8" title="PBX interface structure for channel registration.">gtalk_tech</a>);
<a name="l02090"></a>02090    <a class="code" href="rtp_8h.html#a39d797fe6097e914323998f72b13420c" title="Unregister an RTP channel client.">ast_rtp_proto_unregister</a>(&amp;<a class="code" href="chan__gtalk_8c.html#a30cf4dbe190977582df5b9ee84937213" title="RTP driver interface.">gtalk_rtp</a>);
<a name="l02091"></a>02091 
<a name="l02092"></a>02092    <span class="keywordflow">if</span> (!<a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;gtalklock)) {
<a name="l02093"></a>02093       <span class="comment">/* Hangup all interfaces if they have an owner */</span>
<a name="l02094"></a>02094       <a class="code" href="astobj_8h.html#a8483cbd2bcf0b91ac62168fb1cb7f5b1" title="Iterate through the objects in a container.">ASTOBJ_CONTAINER_TRAVERSE</a>(&amp;<a class="code" href="chan__gtalk_8c.html#a8ddc6fee75005b7f3f13d189dd1ecb80">gtalk_list</a>, 1, {
<a name="l02095"></a>02095          <a class="code" href="astobj_8h.html#ab4a4c9fe0af3b6237d81ae6fd7b857d4" title="Lock an ASTOBJ for writing.">ASTOBJ_WRLOCK</a>(iterator);
<a name="l02096"></a>02096          privates = iterator-&gt;p;
<a name="l02097"></a>02097          <span class="keywordflow">while</span>(privates) {
<a name="l02098"></a>02098             <span class="keywordflow">if</span> (privates-&gt;<a class="code" href="structgtalk__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>)
<a name="l02099"></a>02099                <a class="code" href="channel_8h.html#ac2d6607253f7e8b272d4e845474eaa9b" title="Softly hangup up a channel.">ast_softhangup</a>(privates-&gt;<a class="code" href="structgtalk__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709aeeafae6abd77156800ec76b0ff7d3867">AST_SOFTHANGUP_APPUNLOAD</a>);
<a name="l02100"></a>02100             privates = privates-&gt;<a class="code" href="structgtalk__pvt.html#ad52b2b57b8b3ac8cab36317c65547157">next</a>;
<a name="l02101"></a>02101          }
<a name="l02102"></a>02102          iterator-&gt;p = NULL;
<a name="l02103"></a>02103          <a class="code" href="astobj_8h.html#a9acee27cc52e8533d439f6cc10d11fbc" title="Unlock a locked object.">ASTOBJ_UNLOCK</a>(iterator);
<a name="l02104"></a>02104       });
<a name="l02105"></a>02105       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;gtalklock);
<a name="l02106"></a>02106    } <span class="keywordflow">else</span> {
<a name="l02107"></a>02107       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to lock the monitor\n&quot;</span>);
<a name="l02108"></a>02108       <span class="keywordflow">return</span> -1;
<a name="l02109"></a>02109    }
<a name="l02110"></a>02110    <a class="code" href="astobj_8h.html#a5b923418ce1d4908359bb3b27b211411" title="Empty a container.">ASTOBJ_CONTAINER_DESTROYALL</a>(&amp;<a class="code" href="chan__gtalk_8c.html#a8ddc6fee75005b7f3f13d189dd1ecb80">gtalk_list</a>, <a class="code" href="chan__gtalk_8c.html#a70f7219810c0483ff4725912193266bd">gtalk_member_destroy</a>);
<a name="l02111"></a>02111    <a class="code" href="astobj_8h.html#a49ab9467549d53be33f3f9f3ecae97f9" title="Destroy a container.">ASTOBJ_CONTAINER_DESTROY</a>(&amp;<a class="code" href="chan__gtalk_8c.html#a8ddc6fee75005b7f3f13d189dd1ecb80">gtalk_list</a>);
<a name="l02112"></a>02112    <span class="keywordflow">return</span> 0;
<a name="l02113"></a>02113 }
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a1d084b82cb21102ba46ea60d3cd9c085"></a><!-- doxytag: member="chan_gtalk.c::__ourip" ref="a1d084b82cb21102ba46ea60d3cd9c085" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct in_addr <a class="el" href="res__phoneprov_8c.html#a1d084b82cb21102ba46ea60d3cd9c085">__ourip</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l00218">218</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>Referenced by <a class="el" href="chan__gtalk_8c_source.html#l00773">gtalk_create_candidates()</a>, and <a class="el" href="chan__gtalk_8c_source.html#l02033">load_module()</a>.</p>

</div>
</div>
<a class="anchor" id="a4ec29229510a2e3ea6ce34d520f06e90"></a><!-- doxytag: member="chan_gtalk.c::bindaddr" ref="a4ec29229510a2e3ea6ce34d520f06e90" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct sockaddr_in <a class="el" href="chan__skinny_8c.html#a4ec29229510a2e3ea6ce34d520f06e90">bindaddr</a> = { 0, }<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The address we bind to </p>

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l00214">214</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

</div>
</div>
<a class="anchor" id="a2d8d5920e90ccbad7832926becdadb29"></a><!-- doxytag: member="chan_gtalk.c::default_jbconf" ref="a2d8d5920e90ccbad7832926becdadb29" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__jb__conf.html">ast_jb_conf</a> <a class="el" href="misdn__config_8c.html#a2d8d5920e90ccbad7832926becdadb29">default_jbconf</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Global jitterbuffer configuration - by default, jb is disabled </p>

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l00076">76</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

</div>
</div>
<a class="anchor" id="a787f82faccb7c1f40a2539a14855601b"></a><!-- doxytag: member="chan_gtalk.c::desc" ref="a787f82faccb7c1f40a2539a14855601b" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char <a class="el" href="channel_8c.html#a710bce51374aba96ab04912897666c35">desc</a>[] = &quot;Gtalk Channel&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l00162">162</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

</div>
</div>
<a class="anchor" id="a651c2e6c15fed139c3dd5bf54ab01ff2"></a><!-- doxytag: member="chan_gtalk.c::externip" ref="a651c2e6c15fed139c3dd5bf54ab01ff2" args="[16]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="chan__sip_8c.html#a117d2932ba7efd7af4e9c3a2d908f774">externip</a>[16]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l00233">233</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

</div>
</div>
<a class="anchor" id="a10fc9006937dcda26877acc36353aad4"></a><!-- doxytag: member="chan_gtalk.c::global_capability" ref="a10fc9006937dcda26877acc36353aad4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="chan__sip_8c.html#a10fc9006937dcda26877acc36353aad4">global_capability</a> = AST_FORMAT_ULAW | AST_FORMAT_ALAW | AST_FORMAT_GSM | AST_FORMAT_H263<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l00164">164</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

</div>
</div>
<a class="anchor" id="abaabcb7f4349cc632dde3af5c6a5e1bd"></a><!-- doxytag: member="chan_gtalk.c::global_jbconf" ref="abaabcb7f4349cc632dde3af5c6a5e1bd" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__jb__conf.html">ast_jb_conf</a> <a class="el" href="misdn__config_8c.html#abaabcb7f4349cc632dde3af5c6a5e1bd">global_jbconf</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l00084">84</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>Referenced by <a class="el" href="chan__gtalk_8c_source.html#l01901">gtalk_load_config()</a>, and <a class="el" href="chan__gtalk_8c_source.html#l00989">gtalk_new()</a>.</p>

</div>
</div>
<a class="anchor" id="af45d937b4d9f9451e31c9f059f8fb668"></a><!-- doxytag: member="chan_gtalk.c::gtalk_cli" ref="af45d937b4d9f9451e31c9f059f8fb668" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> <a class="el" href="chan__gtalk_8c.html#af45d937b4d9f9451e31c9f059f8fb668">gtalk_cli</a>[]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
   <a class="code" href="cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="chan__gtalk_8c.html#afc4171d29cff2186306811cc21ee480d" title="CLI command &amp;quot;gtalk reload&amp;quot;.">gtalk_do_reload</a>, <span class="stringliteral">&quot;Reload GoogleTalk configuration&quot;</span>),
   <a class="code" href="cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="chan__gtalk_8c.html#ae33a85434da4c4a6cb7454dc6528432b" title="CLI command &amp;quot;gtalk show channels&amp;quot;.">gtalk_show_channels</a>, <span class="stringliteral">&quot;Show GoogleTalk channels&quot;</span>),
}
</pre></div>
<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l00228">228</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

</div>
</div>
<a class="anchor" id="a8ddc6fee75005b7f3f13d189dd1ecb80"></a><!-- doxytag: member="chan_gtalk.c::gtalk_list" ref="a8ddc6fee75005b7f3f13d189dd1ecb80" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structgtalk__container.html">gtalk_container</a> <a class="el" href="chan__gtalk_8c.html#a8ddc6fee75005b7f3f13d189dd1ecb80">gtalk_list</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l00235">235</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

<p>Referenced by <a class="el" href="chan__gtalk_8c_source.html#l00242">find_gtalk()</a>, <a class="el" href="chan__gtalk_8c_source.html#l01901">gtalk_load_config()</a>, <a class="el" href="chan__gtalk_8c_source.html#l01683">gtalk_show_channels()</a>, <a class="el" href="chan__gtalk_8c_source.html#l02033">load_module()</a>, and <a class="el" href="chan__gtalk_8c_source.html#l02084">unload_module()</a>.</p>

</div>
</div>
<a class="anchor" id="a30cf4dbe190977582df5b9ee84937213"></a><!-- doxytag: member="chan_gtalk.c::gtalk_rtp" ref="a30cf4dbe190977582df5b9ee84937213" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__rtp__protocol.html">ast_rtp_protocol</a> <a class="el" href="chan__gtalk_8c.html#a30cf4dbe190977582df5b9ee84937213">gtalk_rtp</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>RTP driver interface. </p>

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l00221">221</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

</div>
</div>
<a class="anchor" id="a99d9c7da92ab47bf1a3f0274c84ecee8"></a><!-- doxytag: member="chan_gtalk.c::gtalk_tech" ref="a99d9c7da92ab47bf1a3f0274c84ecee8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__channel__tech.html">ast_channel_tech</a> <a class="el" href="chan__gtalk_8c.html#a99d9c7da92ab47bf1a3f0274c84ecee8">gtalk_tech</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>PBX interface structure for channel registration. </p>

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l00194">194</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

</div>
</div>
<a class="anchor" id="abda48311b6abe5a4dd8b6904ddde0a6d"></a><!-- doxytag: member="chan_gtalk.c::io" ref="abda48311b6abe5a4dd8b6904ddde0a6d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structio__context.html">io_context</a>* <a class="el" href="pbx__dundi_8c.html#abda48311b6abe5a4dd8b6904ddde0a6d">io</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The IO context </p>

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l00217">217</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

</div>
</div>
<a class="anchor" id="aea6233539fc73fc5303bf7525ec27e73"></a><!-- doxytag: member="chan_gtalk.c::sched" ref="aea6233539fc73fc5303bf7525ec27e73" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structsched__context.html">sched_context</a>* <a class="el" href="structsched.html">sched</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The scheduling context </p>

<p>Definition at line <a class="el" href="chan__gtalk_8c_source.html#l00216">216</a> of file <a class="el" href="chan__gtalk_8c_source.html">chan_gtalk.c</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:19:57 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
