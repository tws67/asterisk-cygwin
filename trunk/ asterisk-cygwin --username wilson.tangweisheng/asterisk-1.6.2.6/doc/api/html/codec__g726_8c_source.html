<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:18:38 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_04b5f3939ba7010fb71a3cf8bc2dc318.html">codecs</a>
  </div>
</div>
<div class="contents">
<h1>codec_g726.c</h1><a href="codec__g726_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Asterisk -- An open source telephony toolkit.</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * Copyright (C) 1999 - 2006, Digium, Inc.</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * Mark Spencer &lt;markster@digium.com&gt;</span>
<a name="l00007"></a>00007 <span class="comment"> * Kevin P. Fleming &lt;kpfleming@digium.com&gt;</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * Based on frompcm.c and topcm.c from the Emiliano MIPL browser/</span>
<a name="l00010"></a>00010 <span class="comment"> * interpreter.  See http://www.bsdtelephony.com.mx</span>
<a name="l00011"></a>00011 <span class="comment"> *</span>
<a name="l00012"></a>00012 <span class="comment"> * See http://www.asterisk.org for more information about</span>
<a name="l00013"></a>00013 <span class="comment"> * the Asterisk project. Please do not directly contact</span>
<a name="l00014"></a>00014 <span class="comment"> * any of the maintainers of this project for assistance;</span>
<a name="l00015"></a>00015 <span class="comment"> * the project provides a web site, mailing lists and IRC</span>
<a name="l00016"></a>00016 <span class="comment"> * channels for your use.</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> * This program is free software, distributed under the terms of</span>
<a name="l00019"></a>00019 <span class="comment"> * the GNU General Public License Version 2. See the LICENSE file</span>
<a name="l00020"></a>00020 <span class="comment"> * at the top of the source tree.</span>
<a name="l00021"></a>00021 <span class="comment"> */</span>
<a name="l00022"></a>00022 <span class="comment"></span>
<a name="l00023"></a>00023 <span class="comment">/*! \file</span>
<a name="l00024"></a>00024 <span class="comment"> *</span>
<a name="l00025"></a>00025 <span class="comment"> * \brief codec_g726.c - translate between signed linear and ITU G.726-32kbps (both RFC3551 and AAL2 codeword packing)</span>
<a name="l00026"></a>00026 <span class="comment"> *</span>
<a name="l00027"></a>00027 <span class="comment"> * \ingroup codecs</span>
<a name="l00028"></a>00028 <span class="comment"> */</span>
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="asterisk_8h.html" title="Asterisk main include file. File version handling, generic pbx functions.">asterisk.h</a>&quot;</span>
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <a class="code" href="asterisk_8h.html#ab0390be60f8c539a2662df2faf9985c7" title="Register/unregister a source code file with the core.">ASTERISK_FILE_VERSION</a>(__FILE__, <span class="stringliteral">&quot;$Revision: 229285 $&quot;</span>)
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;asterisk/lock.h&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="linkedlists_8h.html" title="A set of macros to manage forward-linked lists.">asterisk/linkedlists.h</a>&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="module_8h.html" title="Asterisk module definitions.">asterisk/module.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="config_8h.html" title="Configuration File Parser.">asterisk/config.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="translate_8h.html" title="Support for translation of data formats. translate.c.">asterisk/translate.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="utils_8h.html" title="Utility functions.">asterisk/utils.h</a>&quot;</span>
<a name="l00040"></a>00040 
<a name="l00041"></a><a class="code" href="codec__g726_8c.html#a006a129c40983eff8b77744936d9a047">00041</a> <span class="preprocessor">#define WANT_ASM</span>
<a name="l00042"></a>00042 <span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="log2comp_8h.html" title="log2comp.h - various base 2 log computation versions">log2comp.h</a>&quot;</span>
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 <span class="comment">/* define NOT_BLI to use a faster but not bit-level identical version */</span>
<a name="l00045"></a>00045 <span class="comment">/* #define NOT_BLI */</span>
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="preprocessor">#if defined(NOT_BLI)</span>
<a name="l00048"></a>00048 <span class="preprocessor"></span><span class="preprocessor">#  if defined(_MSC_VER)</span>
<a name="l00049"></a>00049 <span class="preprocessor"></span><span class="keyword">typedef</span> __int64 sint64;
<a name="l00050"></a>00050 <span class="preprocessor">#  elif defined(__GNUC__)</span>
<a name="l00051"></a>00051 <span class="preprocessor"></span><span class="keyword">typedef</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> sint64;
<a name="l00052"></a>00052 <span class="preprocessor">#  else</span>
<a name="l00053"></a>00053 <span class="preprocessor"></span><span class="preprocessor">#     error 64-bit integer type is not defined for your compiler/platform</span>
<a name="l00054"></a>00054 <span class="preprocessor"></span><span class="preprocessor">#  endif</span>
<a name="l00055"></a>00055 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00056"></a>00056 <span class="preprocessor"></span>
<a name="l00057"></a><a class="code" href="codec__g726_8c.html#a26ea4db54e582d52795474df3ebb981a">00057</a> <span class="preprocessor">#define BUFFER_SAMPLES   8096 </span><span class="comment">/* size for the translation buffers */</span>
<a name="l00058"></a><a class="code" href="codec__g726_8c.html#a1fff0bd51736fde243ccf6674c09f8b4">00058</a> <span class="preprocessor">#define BUF_SHIFT 5</span>
<a name="l00059"></a>00059 <span class="preprocessor"></span>
<a name="l00060"></a>00060 <span class="comment">/* Sample frame data */</span>
<a name="l00061"></a>00061 <span class="preprocessor">#include &quot;<a class="code" href="slin_8h.html">asterisk/slin.h</a>&quot;</span>
<a name="l00062"></a>00062 <span class="preprocessor">#include &quot;<a class="code" href="ex__g726_8h.html" title="4-bit G.726 data">ex_g726.h</a>&quot;</span>
<a name="l00063"></a>00063 
<a name="l00064"></a>00064 <span class="comment">/*</span>
<a name="l00065"></a>00065 <span class="comment"> * The following is the definition of the state structure</span>
<a name="l00066"></a>00066 <span class="comment"> * used by the G.726 encoder and decoder to preserve their internal</span>
<a name="l00067"></a>00067 <span class="comment"> * state between successive calls.  The meanings of the majority</span>
<a name="l00068"></a>00068 <span class="comment"> * of the state structure fields are explained in detail in the</span>
<a name="l00069"></a>00069 <span class="comment"> * CCITT Recommendation G.721.  The field names are essentially identical</span>
<a name="l00070"></a>00070 <span class="comment"> * to variable names in the bit level description of the coding algorithm</span>
<a name="l00071"></a>00071 <span class="comment"> * included in this Recommendation.</span>
<a name="l00072"></a>00072 <span class="comment"> */</span>
<a name="l00073"></a><a class="code" href="structg726__state.html">00073</a> <span class="keyword">struct </span><a class="code" href="structg726__state.html">g726_state</a> {
<a name="l00074"></a><a class="code" href="structg726__state.html#ac5e8399d7fcaabdc34cfb42f4b72f6d0">00074</a>    <span class="keywordtype">long</span> <a class="code" href="structg726__state.html#ac5e8399d7fcaabdc34cfb42f4b72f6d0">yl</a>; <span class="comment">/* Locked or steady state step size multiplier. */</span>
<a name="l00075"></a><a class="code" href="structg726__state.html#ab3688f95b71311a2d94f2b6b053da796">00075</a>    <span class="keywordtype">int</span> <a class="code" href="structg726__state.html#ab3688f95b71311a2d94f2b6b053da796">yu</a>;     <span class="comment">/* Unlocked or non-steady state step size multiplier. */</span>
<a name="l00076"></a><a class="code" href="structg726__state.html#ab4b194a50b1b4a5db20c08e4982d7550">00076</a>    <span class="keywordtype">int</span> <a class="code" href="structg726__state.html#ab4b194a50b1b4a5db20c08e4982d7550">dms</a>; <span class="comment">/* Short term energy estimate. */</span>
<a name="l00077"></a><a class="code" href="structg726__state.html#a17320d9e1c5549138392f94a95540c6f">00077</a>    <span class="keywordtype">int</span> <a class="code" href="structg726__state.html#a17320d9e1c5549138392f94a95540c6f">dml</a>; <span class="comment">/* Long term energy estimate. */</span>
<a name="l00078"></a><a class="code" href="structg726__state.html#ab43e9fd4bffa0506f3075a660a040e55">00078</a>    <span class="keywordtype">int</span> <a class="code" href="structg726__state.html#ab43e9fd4bffa0506f3075a660a040e55">ap</a>;     <span class="comment">/* Linear weighting coefficient of &apos;yl&apos; and &apos;yu&apos;. */</span>
<a name="l00079"></a><a class="code" href="structg726__state.html#a491bc358fce276972681cc0be8844bd7">00079</a>    <span class="keywordtype">int</span> <a class="code" href="structg726__state.html#a491bc358fce276972681cc0be8844bd7">a</a>[2];   <span class="comment">/* Coefficients of pole portion of prediction filter.</span>
<a name="l00080"></a>00080 <span class="comment">          * stored as fixed-point 1==2^14 */</span>
<a name="l00081"></a><a class="code" href="structg726__state.html#a3a8fb794aee037da0f573e5328d14f0d">00081</a>    <span class="keywordtype">int</span> <a class="code" href="structg726__state.html#a3a8fb794aee037da0f573e5328d14f0d">b</a>[6];   <span class="comment">/* Coefficients of zero portion of prediction filter.</span>
<a name="l00082"></a>00082 <span class="comment">          * stored as fixed-point 1==2^14 */</span>
<a name="l00083"></a><a class="code" href="structg726__state.html#ae4b79f57afaae139d974b685e4da9356">00083</a>    <span class="keywordtype">int</span> <a class="code" href="structg726__state.html#ae4b79f57afaae139d974b685e4da9356">pk</a>[2];  <span class="comment">/* Signs of previous two samples of a partially</span>
<a name="l00084"></a>00084 <span class="comment">          * reconstructed signal. */</span>
<a name="l00085"></a><a class="code" href="structg726__state.html#a9f47e6a513301cc3add36f44ed8a1c74">00085</a>    <span class="keywordtype">int</span> <a class="code" href="structg726__state.html#a9f47e6a513301cc3add36f44ed8a1c74">dq</a>[6];     <span class="comment">/* Previous 6 samples of the quantized difference signal</span>
<a name="l00086"></a>00086 <span class="comment">          * stored as fixed point 1==2^12,</span>
<a name="l00087"></a>00087 <span class="comment">          * or in internal floating point format */</span>
<a name="l00088"></a><a class="code" href="structg726__state.html#a99e9ec65fcfa64bf1c602aaf9880722a">00088</a>    <span class="keywordtype">int</span> <a class="code" href="structg726__state.html#a99e9ec65fcfa64bf1c602aaf9880722a">sr</a>[2];  <span class="comment">/* Previous 2 samples of the quantized difference signal</span>
<a name="l00089"></a>00089 <span class="comment">          * stored as fixed point 1==2^12,</span>
<a name="l00090"></a>00090 <span class="comment">          * or in internal floating point format */</span>
<a name="l00091"></a><a class="code" href="structg726__state.html#ae912684497cad6bba9d0b7d85b3e3c0d">00091</a>    <span class="keywordtype">int</span> <a class="code" href="structg726__state.html#ae912684497cad6bba9d0b7d85b3e3c0d">td</a>;     <span class="comment">/* delayed tone detect, new in 1988 version */</span>
<a name="l00092"></a>00092 };
<a name="l00093"></a>00093 
<a name="l00094"></a><a class="code" href="codec__g726_8c.html#a1aa1be6d141bcc2643fcea11a7b3fa2b">00094</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="codec__g726_8c.html#a1aa1be6d141bcc2643fcea11a7b3fa2b">qtab_721</a>[7] = {-124, 80, 178, 246, 300, 349, 400};
<a name="l00095"></a>00095 <span class="comment">/*</span>
<a name="l00096"></a>00096 <span class="comment"> * Maps G.721 code word to reconstructed scale factor normalized log</span>
<a name="l00097"></a>00097 <span class="comment"> * magnitude values.</span>
<a name="l00098"></a>00098 <span class="comment"> */</span>
<a name="l00099"></a><a class="code" href="codec__g726_8c.html#a70996513a9691c488656705d609b7a93">00099</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="codec__g726_8c.html#a70996513a9691c488656705d609b7a93">_dqlntab</a>[16] = {-2048, 4, 135, 213, 273, 323, 373, 425,
<a name="l00100"></a>00100             425, 373, 323, 273, 213, 135, 4, -2048};
<a name="l00101"></a>00101 
<a name="l00102"></a>00102 <span class="comment">/* Maps G.721 code word to log of scale factor multiplier. */</span>
<a name="l00103"></a><a class="code" href="codec__g726_8c.html#a4b08024e57c9308442a81232ca82a7fe">00103</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="codec__g726_8c.html#a4b08024e57c9308442a81232ca82a7fe">_witab</a>[16] = {-12, 18, 41, 64, 112, 198, 355, 1122,
<a name="l00104"></a>00104             1122, 355, 198, 112, 64, 41, 18, -12};
<a name="l00105"></a>00105 <span class="comment">/*</span>
<a name="l00106"></a>00106 <span class="comment"> * Maps G.721 code words to a set of values whose long and short</span>
<a name="l00107"></a>00107 <span class="comment"> * term averages are computed and then compared to give an indication</span>
<a name="l00108"></a>00108 <span class="comment"> * how stationary (steady state) the signal is.</span>
<a name="l00109"></a>00109 <span class="comment"> */</span>
<a name="l00110"></a><a class="code" href="codec__g726_8c.html#aaf30cbce3801ed6d35731472676845b7">00110</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="codec__g726_8c.html#aaf30cbce3801ed6d35731472676845b7">_fitab</a>[16] = {0, 0, 0, 0x200, 0x200, 0x200, 0x600, 0xE00,
<a name="l00111"></a>00111             0xE00, 0x600, 0x200, 0x200, 0x200, 0, 0, 0};
<a name="l00112"></a>00112 
<a name="l00113"></a>00113 
<a name="l00114"></a>00114 <span class="comment">/*</span>
<a name="l00115"></a>00115 <span class="comment"> * g72x_init_state()</span>
<a name="l00116"></a>00116 <span class="comment"> *</span>
<a name="l00117"></a>00117 <span class="comment"> * This routine initializes and/or resets the g726_state structure</span>
<a name="l00118"></a>00118 <span class="comment"> * pointed to by &apos;state_ptr&apos;.</span>
<a name="l00119"></a>00119 <span class="comment"> * All the initial state values are specified in the CCITT G.721 document.</span>
<a name="l00120"></a>00120 <span class="comment"> */</span>
<a name="l00121"></a><a class="code" href="codec__g726_8c.html#a4ed96ee853ed1effaccd28027ebe2f8d">00121</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="codec__g726_8c.html#a4ed96ee853ed1effaccd28027ebe2f8d">g726_init_state</a>(<span class="keyword">struct</span> <a class="code" href="structg726__state.html">g726_state</a> *state_ptr)
<a name="l00122"></a>00122 {
<a name="l00123"></a>00123    <span class="keywordtype">int</span>      cnta;
<a name="l00124"></a>00124 
<a name="l00125"></a>00125    state_ptr-&gt;<a class="code" href="structg726__state.html#ac5e8399d7fcaabdc34cfb42f4b72f6d0">yl</a> = 34816;
<a name="l00126"></a>00126    state_ptr-&gt;<a class="code" href="structg726__state.html#ab3688f95b71311a2d94f2b6b053da796">yu</a> = 544;
<a name="l00127"></a>00127    state_ptr-&gt;<a class="code" href="structg726__state.html#ab4b194a50b1b4a5db20c08e4982d7550">dms</a> = 0;
<a name="l00128"></a>00128    state_ptr-&gt;<a class="code" href="structg726__state.html#a17320d9e1c5549138392f94a95540c6f">dml</a> = 0;
<a name="l00129"></a>00129    state_ptr-&gt;<a class="code" href="structg726__state.html#ab43e9fd4bffa0506f3075a660a040e55">ap</a> = 0;
<a name="l00130"></a>00130    <span class="keywordflow">for</span> (cnta = 0; cnta &lt; 2; cnta++) {
<a name="l00131"></a>00131       state_ptr-&gt;<a class="code" href="structg726__state.html#a491bc358fce276972681cc0be8844bd7">a</a>[cnta] = 0;
<a name="l00132"></a>00132       state_ptr-&gt;<a class="code" href="structg726__state.html#ae4b79f57afaae139d974b685e4da9356">pk</a>[cnta] = 0;
<a name="l00133"></a>00133 <span class="preprocessor">#ifdef NOT_BLI</span>
<a name="l00134"></a>00134 <span class="preprocessor"></span>      state_ptr-&gt;<a class="code" href="structg726__state.html#a99e9ec65fcfa64bf1c602aaf9880722a">sr</a>[cnta] = 1;
<a name="l00135"></a>00135 <span class="preprocessor">#else</span>
<a name="l00136"></a>00136 <span class="preprocessor"></span>      state_ptr-&gt;<a class="code" href="structg726__state.html#a99e9ec65fcfa64bf1c602aaf9880722a">sr</a>[cnta] = 32;
<a name="l00137"></a>00137 <span class="preprocessor">#endif</span>
<a name="l00138"></a>00138 <span class="preprocessor"></span>   }
<a name="l00139"></a>00139    <span class="keywordflow">for</span> (cnta = 0; cnta &lt; 6; cnta++) {
<a name="l00140"></a>00140       state_ptr-&gt;<a class="code" href="structg726__state.html#a3a8fb794aee037da0f573e5328d14f0d">b</a>[cnta] = 0;
<a name="l00141"></a>00141 <span class="preprocessor">#ifdef NOT_BLI</span>
<a name="l00142"></a>00142 <span class="preprocessor"></span>      state_ptr-&gt;<a class="code" href="structg726__state.html#a9f47e6a513301cc3add36f44ed8a1c74">dq</a>[cnta] = 1;
<a name="l00143"></a>00143 <span class="preprocessor">#else</span>
<a name="l00144"></a>00144 <span class="preprocessor"></span>      state_ptr-&gt;<a class="code" href="structg726__state.html#a9f47e6a513301cc3add36f44ed8a1c74">dq</a>[cnta] = 32;
<a name="l00145"></a>00145 <span class="preprocessor">#endif</span>
<a name="l00146"></a>00146 <span class="preprocessor"></span>   }
<a name="l00147"></a>00147    state_ptr-&gt;<a class="code" href="structg726__state.html#ae912684497cad6bba9d0b7d85b3e3c0d">td</a> = 0;
<a name="l00148"></a>00148 }
<a name="l00149"></a>00149 
<a name="l00150"></a>00150 <span class="comment">/*</span>
<a name="l00151"></a>00151 <span class="comment"> * quan()</span>
<a name="l00152"></a>00152 <span class="comment"> *</span>
<a name="l00153"></a>00153 <span class="comment"> * quantizes the input val against the table of integers.</span>
<a name="l00154"></a>00154 <span class="comment"> * It returns i if table[i - 1] &lt;= val &lt; table[i].</span>
<a name="l00155"></a>00155 <span class="comment"> *</span>
<a name="l00156"></a>00156 <span class="comment"> * Using linear search for simple coding.</span>
<a name="l00157"></a>00157 <span class="comment"> */</span>
<a name="l00158"></a><a class="code" href="codec__g726_8c.html#a435953d081060276186b200bd9003f90">00158</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="codec__g726_8c.html#a435953d081060276186b200bd9003f90">quan</a>(<span class="keywordtype">int</span> <a class="code" href="structval.html">val</a>, <span class="keywordtype">int</span> *<a class="code" href="cdr__odbc_8c.html#a68d1e6e752f2cf81551fac543cae108a">table</a>, <span class="keywordtype">int</span> size)
<a name="l00159"></a>00159 {
<a name="l00160"></a>00160    <span class="keywordtype">int</span>      i;
<a name="l00161"></a>00161 
<a name="l00162"></a>00162    <span class="keywordflow">for</span> (i = 0; i &lt; size &amp;&amp; val &gt;= *table; ++i, ++table)
<a name="l00163"></a>00163       ;
<a name="l00164"></a>00164    <span class="keywordflow">return</span> (i);
<a name="l00165"></a>00165 }
<a name="l00166"></a>00166 
<a name="l00167"></a>00167 <span class="preprocessor">#ifdef NOT_BLI </span><span class="comment">/* faster non-identical version */</span>
<a name="l00168"></a>00168 
<a name="l00169"></a>00169 <span class="comment">/*</span>
<a name="l00170"></a>00170 <span class="comment"> * predictor_zero()</span>
<a name="l00171"></a>00171 <span class="comment"> *</span>
<a name="l00172"></a>00172 <span class="comment"> * computes the estimated signal from 6-zero predictor.</span>
<a name="l00173"></a>00173 <span class="comment"> *</span>
<a name="l00174"></a>00174 <span class="comment"> */</span>
<a name="l00175"></a>00175 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="codec__g726_8c.html#a25bc3fa4bf5c7cf53cc31a753493ca0c">predictor_zero</a>(<span class="keyword">struct</span> <a class="code" href="structg726__state.html">g726_state</a> *state_ptr)
<a name="l00176"></a>00176 {  <span class="comment">/* divide by 2 is necessary here to handle negative numbers correctly */</span>
<a name="l00177"></a>00177    <span class="keywordtype">int</span> i;
<a name="l00178"></a>00178    sint64 sezi;
<a name="l00179"></a>00179    <span class="keywordflow">for</span> (sezi = 0, i = 0; i &lt; 6; i++)         <span class="comment">/* ACCUM */</span>
<a name="l00180"></a>00180       sezi += (sint64)state_ptr-&gt;<a class="code" href="structg726__state.html#a3a8fb794aee037da0f573e5328d14f0d">b</a>[i] * state_ptr-&gt;<a class="code" href="structg726__state.html#a9f47e6a513301cc3add36f44ed8a1c74">dq</a>[i];
<a name="l00181"></a>00181    <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)(sezi &gt;&gt; 13) / 2 <span class="comment">/* 2^14 */</span>;
<a name="l00182"></a>00182 }
<a name="l00183"></a>00183 
<a name="l00184"></a>00184 <span class="comment">/*</span>
<a name="l00185"></a>00185 <span class="comment"> * predictor_pole()</span>
<a name="l00186"></a>00186 <span class="comment"> *</span>
<a name="l00187"></a>00187 <span class="comment"> * computes the estimated signal from 2-pole predictor.</span>
<a name="l00188"></a>00188 <span class="comment"> *</span>
<a name="l00189"></a>00189 <span class="comment"> */</span>
<a name="l00190"></a>00190 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="codec__g726_8c.html#aa8f18e1457b16f935c543def8f7b76f4">predictor_pole</a>(<span class="keyword">struct</span> <a class="code" href="structg726__state.html">g726_state</a> *state_ptr)
<a name="l00191"></a>00191 {  <span class="comment">/* divide by 2 is necessary here to handle negative numbers correctly */</span>
<a name="l00192"></a>00192    <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)(((sint64)state_ptr-&gt;<a class="code" href="structg726__state.html#a491bc358fce276972681cc0be8844bd7">a</a>[1] * state_ptr-&gt;<a class="code" href="structg726__state.html#a99e9ec65fcfa64bf1c602aaf9880722a">sr</a>[1] +
<a name="l00193"></a>00193                  (sint64)state_ptr-&gt;<a class="code" href="structg726__state.html#a491bc358fce276972681cc0be8844bd7">a</a>[0] * state_ptr-&gt;<a class="code" href="structg726__state.html#a99e9ec65fcfa64bf1c602aaf9880722a">sr</a>[0]) &gt;&gt; 13) / 2 <span class="comment">/* 2^14 */</span>;
<a name="l00194"></a>00194 }
<a name="l00195"></a>00195 
<a name="l00196"></a>00196 <span class="preprocessor">#else </span><span class="comment">/* NOT_BLI - identical version */</span>
<a name="l00197"></a>00197 <span class="comment">/*</span>
<a name="l00198"></a>00198 <span class="comment"> * fmult()</span>
<a name="l00199"></a>00199 <span class="comment"> *</span>
<a name="l00200"></a>00200 <span class="comment"> * returns the integer product of the fixed-point number &quot;an&quot; (1==2^12) and</span>
<a name="l00201"></a>00201 <span class="comment"> * &quot;floating point&quot; representation (4-bit exponent, 6-bit mantessa) &quot;srn&quot;.</span>
<a name="l00202"></a>00202 <span class="comment"> */</span>
<a name="l00203"></a><a class="code" href="codec__g726_8c.html#a339a5c283785b7434a2ef0b6b8a4f98d">00203</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="codec__g726_8c.html#a339a5c283785b7434a2ef0b6b8a4f98d">fmult</a>(<span class="keywordtype">int</span> an, <span class="keywordtype">int</span> srn)
<a name="l00204"></a>00204 {
<a name="l00205"></a>00205    <span class="keywordtype">int</span>      anmag, anexp, anmant;
<a name="l00206"></a>00206    <span class="keywordtype">int</span>      wanexp, wanmant;
<a name="l00207"></a>00207    <span class="keywordtype">int</span>      retval;
<a name="l00208"></a>00208 
<a name="l00209"></a>00209    anmag = (an &gt; 0) ? an : ((-an) &amp; 0x1FFF);
<a name="l00210"></a>00210    anexp = <a class="code" href="log2comp_8h.html#a95cc6d062293f2336429a321a3c55638">ilog2</a>(anmag) - 5;
<a name="l00211"></a>00211    anmant = (anmag == 0) ? 32 :
<a name="l00212"></a>00212        (anexp &gt;= 0) ? anmag &gt;&gt; anexp : anmag &lt;&lt; -anexp;
<a name="l00213"></a>00213    wanexp = anexp + ((srn &gt;&gt; 6) &amp; 0xF) - 13;
<a name="l00214"></a>00214 
<a name="l00215"></a>00215    wanmant = (anmant * (srn &amp; 077) + 0x30) &gt;&gt; 4;
<a name="l00216"></a>00216    retval = (wanexp &gt;= 0) ? ((wanmant &lt;&lt; wanexp) &amp; 0x7FFF) :
<a name="l00217"></a>00217        (wanmant &gt;&gt; -wanexp);
<a name="l00218"></a>00218 
<a name="l00219"></a>00219    <span class="keywordflow">return</span> (((an ^ srn) &lt; 0) ? -retval : retval);
<a name="l00220"></a>00220 }
<a name="l00221"></a>00221 
<a name="l00222"></a><a class="code" href="codec__g726_8c.html#a25bc3fa4bf5c7cf53cc31a753493ca0c">00222</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="codec__g726_8c.html#a25bc3fa4bf5c7cf53cc31a753493ca0c">predictor_zero</a>(<span class="keyword">struct</span> <a class="code" href="structg726__state.html">g726_state</a> *state_ptr)
<a name="l00223"></a>00223 {
<a name="l00224"></a>00224    <span class="keywordtype">int</span>      i;
<a name="l00225"></a>00225    <span class="keywordtype">int</span>      sezi;
<a name="l00226"></a>00226    <span class="keywordflow">for</span> (sezi = 0, i = 0; i &lt; 6; i++)         <span class="comment">/* ACCUM */</span>
<a name="l00227"></a>00227       sezi += <a class="code" href="codec__g726_8c.html#a339a5c283785b7434a2ef0b6b8a4f98d">fmult</a>(state_ptr-&gt;<a class="code" href="structg726__state.html#a3a8fb794aee037da0f573e5328d14f0d">b</a>[i] &gt;&gt; 2, state_ptr-&gt;<a class="code" href="structg726__state.html#a9f47e6a513301cc3add36f44ed8a1c74">dq</a>[i]);
<a name="l00228"></a>00228    <span class="keywordflow">return</span> sezi;
<a name="l00229"></a>00229 }
<a name="l00230"></a>00230 
<a name="l00231"></a><a class="code" href="codec__g726_8c.html#aa8f18e1457b16f935c543def8f7b76f4">00231</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="codec__g726_8c.html#aa8f18e1457b16f935c543def8f7b76f4">predictor_pole</a>(<span class="keyword">struct</span> <a class="code" href="structg726__state.html">g726_state</a> *state_ptr)
<a name="l00232"></a>00232 {
<a name="l00233"></a>00233    <span class="keywordflow">return</span> (<a class="code" href="codec__g726_8c.html#a339a5c283785b7434a2ef0b6b8a4f98d">fmult</a>(state_ptr-&gt;<a class="code" href="structg726__state.html#a491bc358fce276972681cc0be8844bd7">a</a>[1] &gt;&gt; 2, state_ptr-&gt;<a class="code" href="structg726__state.html#a99e9ec65fcfa64bf1c602aaf9880722a">sr</a>[1]) +
<a name="l00234"></a>00234          <a class="code" href="codec__g726_8c.html#a339a5c283785b7434a2ef0b6b8a4f98d">fmult</a>(state_ptr-&gt;<a class="code" href="structg726__state.html#a491bc358fce276972681cc0be8844bd7">a</a>[0] &gt;&gt; 2, state_ptr-&gt;<a class="code" href="structg726__state.html#a99e9ec65fcfa64bf1c602aaf9880722a">sr</a>[0]));
<a name="l00235"></a>00235 }
<a name="l00236"></a>00236 
<a name="l00237"></a>00237 <span class="preprocessor">#endif </span><span class="comment">/* NOT_BLI */</span>
<a name="l00238"></a>00238 
<a name="l00239"></a>00239 <span class="comment">/*</span>
<a name="l00240"></a>00240 <span class="comment"> * step_size()</span>
<a name="l00241"></a>00241 <span class="comment"> *</span>
<a name="l00242"></a>00242 <span class="comment"> * computes the quantization step size of the adaptive quantizer.</span>
<a name="l00243"></a>00243 <span class="comment"> *</span>
<a name="l00244"></a>00244 <span class="comment"> */</span>
<a name="l00245"></a><a class="code" href="codec__g726_8c.html#a19c4e074d472c28d949cb493e6e2c77f">00245</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="codec__g726_8c.html#a19c4e074d472c28d949cb493e6e2c77f">step_size</a>(<span class="keyword">struct</span> <a class="code" href="structg726__state.html">g726_state</a> *state_ptr)
<a name="l00246"></a>00246 {
<a name="l00247"></a>00247    <span class="keywordtype">int</span>      y;
<a name="l00248"></a>00248    <span class="keywordtype">int</span>      dif;
<a name="l00249"></a>00249    <span class="keywordtype">int</span>      al;
<a name="l00250"></a>00250 
<a name="l00251"></a>00251    <span class="keywordflow">if</span> (state_ptr-&gt;<a class="code" href="structg726__state.html#ab43e9fd4bffa0506f3075a660a040e55">ap</a> &gt;= 256)
<a name="l00252"></a>00252       <span class="keywordflow">return</span> (state_ptr-&gt;<a class="code" href="structg726__state.html#ab3688f95b71311a2d94f2b6b053da796">yu</a>);
<a name="l00253"></a>00253    <span class="keywordflow">else</span> {
<a name="l00254"></a>00254       y = state_ptr-&gt;<a class="code" href="structg726__state.html#ac5e8399d7fcaabdc34cfb42f4b72f6d0">yl</a> &gt;&gt; 6;
<a name="l00255"></a>00255       dif = state_ptr-&gt;<a class="code" href="structg726__state.html#ab3688f95b71311a2d94f2b6b053da796">yu</a> - y;
<a name="l00256"></a>00256       al = state_ptr-&gt;<a class="code" href="structg726__state.html#ab43e9fd4bffa0506f3075a660a040e55">ap</a> &gt;&gt; 2;
<a name="l00257"></a>00257       <span class="keywordflow">if</span> (dif &gt; 0)
<a name="l00258"></a>00258          y += (dif * al) &gt;&gt; 6;
<a name="l00259"></a>00259       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dif &lt; 0)
<a name="l00260"></a>00260          y += (dif * al + 0x3F) &gt;&gt; 6;
<a name="l00261"></a>00261       <span class="keywordflow">return</span> (y);
<a name="l00262"></a>00262    }
<a name="l00263"></a>00263 }
<a name="l00264"></a>00264 
<a name="l00265"></a>00265 <span class="comment">/*</span>
<a name="l00266"></a>00266 <span class="comment"> * quantize()</span>
<a name="l00267"></a>00267 <span class="comment"> *</span>
<a name="l00268"></a>00268 <span class="comment"> * Given a raw sample, &apos;d&apos;, of the difference signal and a</span>
<a name="l00269"></a>00269 <span class="comment"> * quantization step size scale factor, &apos;y&apos;, this routine returns the</span>
<a name="l00270"></a>00270 <span class="comment"> * ADPCM codeword to which that sample gets quantized.  The step</span>
<a name="l00271"></a>00271 <span class="comment"> * size scale factor division operation is done in the log base 2 domain</span>
<a name="l00272"></a>00272 <span class="comment"> * as a subtraction.</span>
<a name="l00273"></a>00273 <span class="comment"> */</span>
<a name="l00274"></a><a class="code" href="codec__g726_8c.html#a97f877849366e51ff303c25633e12829">00274</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="codec__g726_8c.html#a97f877849366e51ff303c25633e12829">quantize</a>(
<a name="l00275"></a>00275    <span class="keywordtype">int</span>      d, <span class="comment">/* Raw difference signal sample */</span>
<a name="l00276"></a>00276    <span class="keywordtype">int</span>      y, <span class="comment">/* Step size multiplier */</span>
<a name="l00277"></a>00277    <span class="keywordtype">int</span>      *<a class="code" href="cdr__odbc_8c.html#a68d1e6e752f2cf81551fac543cae108a">table</a>,  <span class="comment">/* quantization table */</span>
<a name="l00278"></a>00278    <span class="keywordtype">int</span>      size) <span class="comment">/* table size of integers */</span>
<a name="l00279"></a>00279 {
<a name="l00280"></a>00280    <span class="keywordtype">int</span>      dqm;  <span class="comment">/* Magnitude of &apos;d&apos; */</span>
<a name="l00281"></a>00281    <span class="keywordtype">int</span>      exp;  <span class="comment">/* Integer part of base 2 log of &apos;d&apos; */</span>
<a name="l00282"></a>00282    <span class="keywordtype">int</span>      mant; <span class="comment">/* Fractional part of base 2 log */</span>
<a name="l00283"></a>00283    <span class="keywordtype">int</span>      dl;      <span class="comment">/* Log of magnitude of &apos;d&apos; */</span>
<a name="l00284"></a>00284    <span class="keywordtype">int</span>      dln;  <span class="comment">/* Step size scale factor normalized log */</span>
<a name="l00285"></a>00285    <span class="keywordtype">int</span>      i;
<a name="l00286"></a>00286 
<a name="l00287"></a>00287    <span class="comment">/*</span>
<a name="l00288"></a>00288 <span class="comment">    * LOG</span>
<a name="l00289"></a>00289 <span class="comment">    *</span>
<a name="l00290"></a>00290 <span class="comment">    * Compute base 2 log of &apos;d&apos;, and store in &apos;dl&apos;.</span>
<a name="l00291"></a>00291 <span class="comment">    */</span>
<a name="l00292"></a>00292    dqm = abs(d);
<a name="l00293"></a>00293    exp = <a class="code" href="log2comp_8h.html#a95cc6d062293f2336429a321a3c55638">ilog2</a>(dqm);
<a name="l00294"></a>00294    <span class="keywordflow">if</span> (exp &lt; 0)
<a name="l00295"></a>00295       exp = 0;
<a name="l00296"></a>00296    mant = ((dqm &lt;&lt; 7) &gt;&gt; exp) &amp; 0x7F;  <span class="comment">/* Fractional portion. */</span>
<a name="l00297"></a>00297    dl = (exp &lt;&lt; 7) | mant;
<a name="l00298"></a>00298 
<a name="l00299"></a>00299    <span class="comment">/*</span>
<a name="l00300"></a>00300 <span class="comment">    * SUBTB</span>
<a name="l00301"></a>00301 <span class="comment">    *</span>
<a name="l00302"></a>00302 <span class="comment">    * &quot;Divide&quot; by step size multiplier.</span>
<a name="l00303"></a>00303 <span class="comment">    */</span>
<a name="l00304"></a>00304    dln = dl - (y &gt;&gt; 2);
<a name="l00305"></a>00305 
<a name="l00306"></a>00306    <span class="comment">/*</span>
<a name="l00307"></a>00307 <span class="comment">    * QUAN</span>
<a name="l00308"></a>00308 <span class="comment">    *</span>
<a name="l00309"></a>00309 <span class="comment">    * Obtain codword i for &apos;d&apos;.</span>
<a name="l00310"></a>00310 <span class="comment">    */</span>
<a name="l00311"></a>00311    i = <a class="code" href="codec__g726_8c.html#a435953d081060276186b200bd9003f90">quan</a>(dln, table, size);
<a name="l00312"></a>00312    <span class="keywordflow">if</span> (d &lt; 0)        <span class="comment">/* take 1&apos;s complement of i */</span>
<a name="l00313"></a>00313       <span class="keywordflow">return</span> ((size &lt;&lt; 1) + 1 - i);
<a name="l00314"></a>00314    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i == 0)     <span class="comment">/* take 1&apos;s complement of 0 */</span>
<a name="l00315"></a>00315       <span class="keywordflow">return</span> ((size &lt;&lt; 1) + 1); <span class="comment">/* new in 1988 */</span>
<a name="l00316"></a>00316    <span class="keywordflow">else</span>
<a name="l00317"></a>00317       <span class="keywordflow">return</span> (i);
<a name="l00318"></a>00318 }
<a name="l00319"></a>00319 
<a name="l00320"></a>00320 <span class="comment">/*</span>
<a name="l00321"></a>00321 <span class="comment"> * reconstruct()</span>
<a name="l00322"></a>00322 <span class="comment"> *</span>
<a name="l00323"></a>00323 <span class="comment"> * Returns reconstructed difference signal &apos;dq&apos; obtained from</span>
<a name="l00324"></a>00324 <span class="comment"> * codeword &apos;i&apos; and quantization step size scale factor &apos;y&apos;.</span>
<a name="l00325"></a>00325 <span class="comment"> * Multiplication is performed in log base 2 domain as addition.</span>
<a name="l00326"></a>00326 <span class="comment"> */</span>
<a name="l00327"></a><a class="code" href="codec__g726_8c.html#aab1f392cff37399fc43db0d4b2cc11c8">00327</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="codec__g726_8c.html#aab1f392cff37399fc43db0d4b2cc11c8">reconstruct</a>(
<a name="l00328"></a>00328    <span class="keywordtype">int</span>      sign, <span class="comment">/* 0 for non-negative value */</span>
<a name="l00329"></a>00329    <span class="keywordtype">int</span>      dqln, <span class="comment">/* G.72x codeword */</span>
<a name="l00330"></a>00330    <span class="keywordtype">int</span>      y) <span class="comment">/* Step size multiplier */</span>
<a name="l00331"></a>00331 {
<a name="l00332"></a>00332    <span class="keywordtype">int</span>      dql;  <span class="comment">/* Log of &apos;dq&apos; magnitude */</span>
<a name="l00333"></a>00333    <span class="keywordtype">int</span>      dex;  <span class="comment">/* Integer part of log */</span>
<a name="l00334"></a>00334    <span class="keywordtype">int</span>      dqt;
<a name="l00335"></a>00335    <span class="keywordtype">int</span>      dq;   <span class="comment">/* Reconstructed difference signal sample */</span>
<a name="l00336"></a>00336 
<a name="l00337"></a>00337    dql = dqln + (y &gt;&gt; 2);  <span class="comment">/* ADDA */</span>
<a name="l00338"></a>00338 
<a name="l00339"></a>00339    <span class="keywordflow">if</span> (dql &lt; 0) {
<a name="l00340"></a>00340 <span class="preprocessor">#ifdef NOT_BLI</span>
<a name="l00341"></a>00341 <span class="preprocessor"></span>      <span class="keywordflow">return</span> (sign) ? -1 : 1;
<a name="l00342"></a>00342 <span class="preprocessor">#else</span>
<a name="l00343"></a>00343 <span class="preprocessor"></span>      <span class="keywordflow">return</span> (sign) ? -0x8000 : 0;
<a name="l00344"></a>00344 <span class="preprocessor">#endif</span>
<a name="l00345"></a>00345 <span class="preprocessor"></span>   } <span class="keywordflow">else</span> {    <span class="comment">/* ANTILOG */</span>
<a name="l00346"></a>00346       dex = (dql &gt;&gt; 7) &amp; 15;
<a name="l00347"></a>00347       dqt = 128 + (dql &amp; 127);
<a name="l00348"></a>00348 <span class="preprocessor">#ifdef NOT_BLI</span>
<a name="l00349"></a>00349 <span class="preprocessor"></span>      dq = ((dqt &lt;&lt; 19) &gt;&gt; (14 - dex));
<a name="l00350"></a>00350       <span class="keywordflow">return</span> (sign) ? -dq : dq;
<a name="l00351"></a>00351 <span class="preprocessor">#else</span>
<a name="l00352"></a>00352 <span class="preprocessor"></span>      dq = (dqt &lt;&lt; 7) &gt;&gt; (14 - dex);
<a name="l00353"></a>00353       <span class="keywordflow">return</span> (sign) ? (dq - 0x8000) : dq;
<a name="l00354"></a>00354 <span class="preprocessor">#endif</span>
<a name="l00355"></a>00355 <span class="preprocessor"></span>   }
<a name="l00356"></a>00356 }
<a name="l00357"></a>00357 
<a name="l00358"></a>00358 <span class="comment">/*</span>
<a name="l00359"></a>00359 <span class="comment"> * update()</span>
<a name="l00360"></a>00360 <span class="comment"> *</span>
<a name="l00361"></a>00361 <span class="comment"> * updates the state variables for each output code</span>
<a name="l00362"></a>00362 <span class="comment"> */</span>
<a name="l00363"></a><a class="code" href="codec__g726_8c.html#a8c58a1d1fd9436ff5145385d3ef7a430">00363</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="codec__g726_8c.html#a8c58a1d1fd9436ff5145385d3ef7a430">update</a>(
<a name="l00364"></a>00364    <span class="keywordtype">int</span>      code_size,  <span class="comment">/* distinguish 723_40 with others */</span>
<a name="l00365"></a>00365    <span class="keywordtype">int</span>      y,    <span class="comment">/* quantizer step size */</span>
<a name="l00366"></a>00366    <span class="keywordtype">int</span>      wi,      <span class="comment">/* scale factor multiplier */</span>
<a name="l00367"></a>00367    <span class="keywordtype">int</span>      fi,      <span class="comment">/* for long/short term energies */</span>
<a name="l00368"></a>00368    <span class="keywordtype">int</span>      dq,      <span class="comment">/* quantized prediction difference */</span>
<a name="l00369"></a>00369    <span class="keywordtype">int</span>      sr,      <span class="comment">/* reconstructed signal */</span>
<a name="l00370"></a>00370    <span class="keywordtype">int</span>      dqsez,      <span class="comment">/* difference from 2-pole predictor */</span>
<a name="l00371"></a>00371    <span class="keyword">struct</span> <a class="code" href="structg726__state.html">g726_state</a> *state_ptr) <span class="comment">/* coder state pointer */</span>
<a name="l00372"></a>00372 {
<a name="l00373"></a>00373    <span class="keywordtype">int</span>      cnt;
<a name="l00374"></a>00374    <span class="keywordtype">int</span>      mag;     <span class="comment">/* Adaptive predictor, FLOAT A */</span>
<a name="l00375"></a>00375 <span class="preprocessor">#ifndef NOT_BLI</span>
<a name="l00376"></a>00376 <span class="preprocessor"></span>   <span class="keywordtype">int</span>      exp;
<a name="l00377"></a>00377 <span class="preprocessor">#endif</span>
<a name="l00378"></a>00378 <span class="preprocessor"></span>   <span class="keywordtype">int</span>      a2p=0;      <span class="comment">/* LIMC */</span>
<a name="l00379"></a>00379    <span class="keywordtype">int</span>      a1ul;    <span class="comment">/* UPA1 */</span>
<a name="l00380"></a>00380    <span class="keywordtype">int</span>      pks1;    <span class="comment">/* UPA2 */</span>
<a name="l00381"></a>00381    <span class="keywordtype">int</span>      fa1;
<a name="l00382"></a>00382    <span class="keywordtype">int</span>      tr;         <span class="comment">/* tone/transition detector */</span>
<a name="l00383"></a>00383    <span class="keywordtype">int</span>      ylint, thr2, dqthr;
<a name="l00384"></a>00384    <span class="keywordtype">int</span>      ylfrac, thr1;
<a name="l00385"></a>00385    <span class="keywordtype">int</span>      pk0;
<a name="l00386"></a>00386 
<a name="l00387"></a>00387    pk0 = (dqsez &lt; 0) ? 1 : 0; <span class="comment">/* needed in updating predictor poles */</span>
<a name="l00388"></a>00388 
<a name="l00389"></a>00389 <span class="preprocessor">#ifdef NOT_BLI</span>
<a name="l00390"></a>00390 <span class="preprocessor"></span>   mag = abs(dq / 0x1000); <span class="comment">/* prediction difference magnitude */</span>
<a name="l00391"></a>00391 <span class="preprocessor">#else</span>
<a name="l00392"></a>00392 <span class="preprocessor"></span>   mag = dq &amp; 0x7FFF;      <span class="comment">/* prediction difference magnitude */</span>
<a name="l00393"></a>00393 <span class="preprocessor">#endif</span>
<a name="l00394"></a>00394 <span class="preprocessor"></span>   <span class="comment">/* TRANS */</span>
<a name="l00395"></a>00395    ylint = state_ptr-&gt;<a class="code" href="structg726__state.html#ac5e8399d7fcaabdc34cfb42f4b72f6d0">yl</a> &gt;&gt; 15;  <span class="comment">/* exponent part of yl */</span>
<a name="l00396"></a>00396    ylfrac = (state_ptr-&gt;<a class="code" href="structg726__state.html#ac5e8399d7fcaabdc34cfb42f4b72f6d0">yl</a> &gt;&gt; 10) &amp; 0x1F; <span class="comment">/* fractional part of yl */</span>
<a name="l00397"></a>00397    thr1 = (32 + ylfrac) &lt;&lt; ylint;      <span class="comment">/* threshold */</span>
<a name="l00398"></a>00398    thr2 = (ylint &gt; 9) ? 31 &lt;&lt; 10 : thr1;  <span class="comment">/* limit thr2 to 31 &lt;&lt; 10 */</span>
<a name="l00399"></a>00399    dqthr = (thr2 + (thr2 &gt;&gt; 1)) &gt;&gt; 1;  <span class="comment">/* dqthr = 0.75 * thr2 */</span>
<a name="l00400"></a>00400    <span class="keywordflow">if</span> (state_ptr-&gt;<a class="code" href="structg726__state.html#ae912684497cad6bba9d0b7d85b3e3c0d">td</a> == 0)    <span class="comment">/* signal supposed voice */</span>
<a name="l00401"></a>00401       tr = 0;
<a name="l00402"></a>00402    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mag &lt;= dqthr)     <span class="comment">/* supposed data, but small mag */</span>
<a name="l00403"></a>00403       tr = 0;        <span class="comment">/* treated as voice */</span>
<a name="l00404"></a>00404    <span class="keywordflow">else</span>           <span class="comment">/* signal is data (modem) */</span>
<a name="l00405"></a>00405       tr = 1;
<a name="l00406"></a>00406 
<a name="l00407"></a>00407    <span class="comment">/*</span>
<a name="l00408"></a>00408 <span class="comment">    * Quantizer scale factor adaptation.</span>
<a name="l00409"></a>00409 <span class="comment">    */</span>
<a name="l00410"></a>00410 
<a name="l00411"></a>00411    <span class="comment">/* FUNCTW &amp; FILTD &amp; DELAY */</span>
<a name="l00412"></a>00412    <span class="comment">/* update non-steady state step size multiplier */</span>
<a name="l00413"></a>00413    state_ptr-&gt;<a class="code" href="structg726__state.html#ab3688f95b71311a2d94f2b6b053da796">yu</a> = y + ((wi - y) &gt;&gt; 5);
<a name="l00414"></a>00414 
<a name="l00415"></a>00415    <span class="comment">/* LIMB */</span>
<a name="l00416"></a>00416    <span class="keywordflow">if</span> (state_ptr-&gt;<a class="code" href="structg726__state.html#ab3688f95b71311a2d94f2b6b053da796">yu</a> &lt; 544)   <span class="comment">/* 544 &lt;= yu &lt;= 5120 */</span>
<a name="l00417"></a>00417       state_ptr-&gt;<a class="code" href="structg726__state.html#ab3688f95b71311a2d94f2b6b053da796">yu</a> = 544;
<a name="l00418"></a>00418    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (state_ptr-&gt;<a class="code" href="structg726__state.html#ab3688f95b71311a2d94f2b6b053da796">yu</a> &gt; 5120)
<a name="l00419"></a>00419       state_ptr-&gt;<a class="code" href="structg726__state.html#ab3688f95b71311a2d94f2b6b053da796">yu</a> = 5120;
<a name="l00420"></a>00420 
<a name="l00421"></a>00421    <span class="comment">/* FILTE &amp; DELAY */</span>
<a name="l00422"></a>00422    <span class="comment">/* update steady state step size multiplier */</span>
<a name="l00423"></a>00423    state_ptr-&gt;<a class="code" href="structg726__state.html#ac5e8399d7fcaabdc34cfb42f4b72f6d0">yl</a> += state_ptr-&gt;<a class="code" href="structg726__state.html#ab3688f95b71311a2d94f2b6b053da796">yu</a> + ((-state_ptr-&gt;<a class="code" href="structg726__state.html#ac5e8399d7fcaabdc34cfb42f4b72f6d0">yl</a>) &gt;&gt; 6);
<a name="l00424"></a>00424 
<a name="l00425"></a>00425    <span class="comment">/*</span>
<a name="l00426"></a>00426 <span class="comment">    * Adaptive predictor coefficients.</span>
<a name="l00427"></a>00427 <span class="comment">    */</span>
<a name="l00428"></a>00428    <span class="keywordflow">if</span> (tr == 1) {       <span class="comment">/* reset a&apos;s and b&apos;s for modem signal */</span>
<a name="l00429"></a>00429       state_ptr-&gt;<a class="code" href="structg726__state.html#a491bc358fce276972681cc0be8844bd7">a</a>[0] = 0;
<a name="l00430"></a>00430       state_ptr-&gt;<a class="code" href="structg726__state.html#a491bc358fce276972681cc0be8844bd7">a</a>[1] = 0;
<a name="l00431"></a>00431       state_ptr-&gt;<a class="code" href="structg726__state.html#a3a8fb794aee037da0f573e5328d14f0d">b</a>[0] = 0;
<a name="l00432"></a>00432       state_ptr-&gt;<a class="code" href="structg726__state.html#a3a8fb794aee037da0f573e5328d14f0d">b</a>[1] = 0;
<a name="l00433"></a>00433       state_ptr-&gt;<a class="code" href="structg726__state.html#a3a8fb794aee037da0f573e5328d14f0d">b</a>[2] = 0;
<a name="l00434"></a>00434       state_ptr-&gt;<a class="code" href="structg726__state.html#a3a8fb794aee037da0f573e5328d14f0d">b</a>[3] = 0;
<a name="l00435"></a>00435       state_ptr-&gt;<a class="code" href="structg726__state.html#a3a8fb794aee037da0f573e5328d14f0d">b</a>[4] = 0;
<a name="l00436"></a>00436       state_ptr-&gt;<a class="code" href="structg726__state.html#a3a8fb794aee037da0f573e5328d14f0d">b</a>[5] = 0;
<a name="l00437"></a>00437    } <span class="keywordflow">else</span> {       <span class="comment">/* update a&apos;s and b&apos;s */</span>
<a name="l00438"></a>00438       pks1 = pk0 ^ state_ptr-&gt;<a class="code" href="structg726__state.html#ae4b79f57afaae139d974b685e4da9356">pk</a>[0];      <span class="comment">/* UPA2 */</span>
<a name="l00439"></a>00439 
<a name="l00440"></a>00440       <span class="comment">/* update predictor pole a[1] */</span>
<a name="l00441"></a>00441       a2p = state_ptr-&gt;<a class="code" href="structg726__state.html#a491bc358fce276972681cc0be8844bd7">a</a>[1] - (state_ptr-&gt;<a class="code" href="structg726__state.html#a491bc358fce276972681cc0be8844bd7">a</a>[1] &gt;&gt; 7);
<a name="l00442"></a>00442       <span class="keywordflow">if</span> (dqsez != 0) {
<a name="l00443"></a>00443          fa1 = (pks1) ? state_ptr-&gt;<a class="code" href="structg726__state.html#a491bc358fce276972681cc0be8844bd7">a</a>[0] : -state_ptr-&gt;<a class="code" href="structg726__state.html#a491bc358fce276972681cc0be8844bd7">a</a>[0];
<a name="l00444"></a>00444          if (fa1 &lt; -8191)  <span class="comment">/* a2p = function of fa1 */</span>
<a name="l00445"></a>00445             a2p -= 0x100;
<a name="l00446"></a>00446          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fa1 &gt; 8191)
<a name="l00447"></a>00447             a2p += 0xFF;
<a name="l00448"></a>00448          <span class="keywordflow">else</span>
<a name="l00449"></a>00449             a2p += fa1 &gt;&gt; 5;
<a name="l00450"></a>00450 
<a name="l00451"></a>00451          <span class="keywordflow">if</span> (pk0 ^ state_ptr-&gt;<a class="code" href="structg726__state.html#ae4b79f57afaae139d974b685e4da9356">pk</a>[1])
<a name="l00452"></a>00452             <span class="comment">/* LIMC */</span>
<a name="l00453"></a>00453             <span class="keywordflow">if</span> (a2p &lt;= -12160)
<a name="l00454"></a>00454                a2p = -12288;
<a name="l00455"></a>00455             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (a2p &gt;= 12416)
<a name="l00456"></a>00456                a2p = 12288;
<a name="l00457"></a>00457             <span class="keywordflow">else</span>
<a name="l00458"></a>00458                a2p -= 0x80;
<a name="l00459"></a>00459          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (a2p &lt;= -12416)
<a name="l00460"></a>00460             a2p = -12288;
<a name="l00461"></a>00461          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (a2p &gt;= 12160)
<a name="l00462"></a>00462             a2p = 12288;
<a name="l00463"></a>00463          <span class="keywordflow">else</span>
<a name="l00464"></a>00464             a2p += 0x80;
<a name="l00465"></a>00465       }
<a name="l00466"></a>00466 
<a name="l00467"></a>00467       <span class="comment">/* TRIGB &amp; DELAY */</span>
<a name="l00468"></a>00468       state_ptr-&gt;<a class="code" href="structg726__state.html#a491bc358fce276972681cc0be8844bd7">a</a>[1] = a2p;
<a name="l00469"></a>00469 
<a name="l00470"></a>00470       <span class="comment">/* UPA1 */</span>
<a name="l00471"></a>00471       <span class="comment">/* update predictor pole a[0] */</span>
<a name="l00472"></a>00472       state_ptr-&gt;<a class="code" href="structg726__state.html#a491bc358fce276972681cc0be8844bd7">a</a>[0] -= state_ptr-&gt;<a class="code" href="structg726__state.html#a491bc358fce276972681cc0be8844bd7">a</a>[0] &gt;&gt; 8;
<a name="l00473"></a>00473       <span class="keywordflow">if</span> (dqsez != 0) {
<a name="l00474"></a>00474          <span class="keywordflow">if</span> (pks1 == 0)
<a name="l00475"></a>00475             state_ptr-&gt;<a class="code" href="structg726__state.html#a491bc358fce276972681cc0be8844bd7">a</a>[0] += 192;
<a name="l00476"></a>00476          <span class="keywordflow">else</span>
<a name="l00477"></a>00477             state_ptr-&gt;<a class="code" href="structg726__state.html#a491bc358fce276972681cc0be8844bd7">a</a>[0] -= 192;
<a name="l00478"></a>00478       }
<a name="l00479"></a>00479       <span class="comment">/* LIMD */</span>
<a name="l00480"></a>00480       a1ul = 15360 - a2p;
<a name="l00481"></a>00481       <span class="keywordflow">if</span> (state_ptr-&gt;<a class="code" href="structg726__state.html#a491bc358fce276972681cc0be8844bd7">a</a>[0] &lt; -a1ul)
<a name="l00482"></a>00482          state_ptr-&gt;<a class="code" href="structg726__state.html#a491bc358fce276972681cc0be8844bd7">a</a>[0] = -a1ul;
<a name="l00483"></a>00483       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (state_ptr-&gt;<a class="code" href="structg726__state.html#a491bc358fce276972681cc0be8844bd7">a</a>[0] &gt; a1ul)
<a name="l00484"></a>00484          state_ptr-&gt;<a class="code" href="structg726__state.html#a491bc358fce276972681cc0be8844bd7">a</a>[0] = a1ul;
<a name="l00485"></a>00485 
<a name="l00486"></a>00486       <span class="comment">/* UPB : update predictor zeros b[6] */</span>
<a name="l00487"></a>00487       <span class="keywordflow">for</span> (cnt = 0; cnt &lt; 6; cnt++) {
<a name="l00488"></a>00488          <span class="keywordflow">if</span> (code_size == 5)     <span class="comment">/* for 40Kbps G.723 */</span>
<a name="l00489"></a>00489             state_ptr-&gt;<a class="code" href="structg726__state.html#a3a8fb794aee037da0f573e5328d14f0d">b</a>[cnt] -= state_ptr-&gt;<a class="code" href="structg726__state.html#a3a8fb794aee037da0f573e5328d14f0d">b</a>[cnt] &gt;&gt; 9;
<a name="l00490"></a>00490          <span class="keywordflow">else</span>        <span class="comment">/* for G.721 and 24Kbps G.723 */</span>
<a name="l00491"></a>00491             state_ptr-&gt;<a class="code" href="structg726__state.html#a3a8fb794aee037da0f573e5328d14f0d">b</a>[cnt] -= state_ptr-&gt;<a class="code" href="structg726__state.html#a3a8fb794aee037da0f573e5328d14f0d">b</a>[cnt] &gt;&gt; 8;
<a name="l00492"></a>00492          <span class="keywordflow">if</span> (mag)
<a name="l00493"></a>00493          {  <span class="comment">/* XOR */</span>
<a name="l00494"></a>00494             <span class="keywordflow">if</span> ((dq ^ state_ptr-&gt;<a class="code" href="structg726__state.html#a9f47e6a513301cc3add36f44ed8a1c74">dq</a>[cnt]) &gt;= 0)
<a name="l00495"></a>00495                state_ptr-&gt;<a class="code" href="structg726__state.html#a3a8fb794aee037da0f573e5328d14f0d">b</a>[cnt] += 128;
<a name="l00496"></a>00496             <span class="keywordflow">else</span>
<a name="l00497"></a>00497                state_ptr-&gt;<a class="code" href="structg726__state.html#a3a8fb794aee037da0f573e5328d14f0d">b</a>[cnt] -= 128;
<a name="l00498"></a>00498          }
<a name="l00499"></a>00499       }
<a name="l00500"></a>00500    }
<a name="l00501"></a>00501 
<a name="l00502"></a>00502    <span class="keywordflow">for</span> (cnt = 5; cnt &gt; 0; cnt--)
<a name="l00503"></a>00503       state_ptr-&gt;<a class="code" href="structg726__state.html#a9f47e6a513301cc3add36f44ed8a1c74">dq</a>[cnt] = state_ptr-&gt;<a class="code" href="structg726__state.html#a9f47e6a513301cc3add36f44ed8a1c74">dq</a>[cnt-1];
<a name="l00504"></a>00504 #ifdef NOT_BLI
<a name="l00505"></a>00505    state_ptr-&gt;<a class="code" href="structg726__state.html#a9f47e6a513301cc3add36f44ed8a1c74">dq</a>[0] = dq;
<a name="l00506"></a>00506 #<span class="keywordflow">else</span>
<a name="l00507"></a>00507    <span class="comment">/* FLOAT A : convert dq[0] to 4-bit exp, 6-bit mantissa f.p. */</span>
<a name="l00508"></a>00508    if (mag == 0) {
<a name="l00509"></a>00509       state_ptr-&gt;<a class="code" href="structg726__state.html#a9f47e6a513301cc3add36f44ed8a1c74">dq</a>[0] = (dq &gt;= 0) ? 0x20 : 0x20 - 0x400;
<a name="l00510"></a>00510    } <span class="keywordflow">else</span> {
<a name="l00511"></a>00511       exp = <a class="code" href="log2comp_8h.html#a95cc6d062293f2336429a321a3c55638">ilog2</a>(mag) + 1;
<a name="l00512"></a>00512       state_ptr-&gt;<a class="code" href="structg726__state.html#a9f47e6a513301cc3add36f44ed8a1c74">dq</a>[0] = (dq &gt;= 0) ?
<a name="l00513"></a>00513           (exp &lt;&lt; 6) + ((mag &lt;&lt; 6) &gt;&gt; exp) :
<a name="l00514"></a>00514           (exp &lt;&lt; 6) + ((mag &lt;&lt; 6) &gt;&gt; exp) - 0x400;
<a name="l00515"></a>00515    }
<a name="l00516"></a>00516 <span class="preprocessor">#endif</span>
<a name="l00517"></a>00517 <span class="preprocessor"></span>
<a name="l00518"></a>00518    state_ptr-&gt;<a class="code" href="structg726__state.html#a99e9ec65fcfa64bf1c602aaf9880722a">sr</a>[1] = state_ptr-&gt;<a class="code" href="structg726__state.html#a99e9ec65fcfa64bf1c602aaf9880722a">sr</a>[0];
<a name="l00519"></a>00519 <span class="preprocessor">#ifdef NOT_BLI</span>
<a name="l00520"></a>00520 <span class="preprocessor"></span>   state_ptr-&gt;<a class="code" href="structg726__state.html#a99e9ec65fcfa64bf1c602aaf9880722a">sr</a>[0] = sr;
<a name="l00521"></a>00521 <span class="preprocessor">#else</span>
<a name="l00522"></a>00522 <span class="preprocessor"></span>   <span class="comment">/* FLOAT B : convert sr to 4-bit exp., 6-bit mantissa f.p. */</span>
<a name="l00523"></a>00523    <span class="keywordflow">if</span> (sr == 0) {
<a name="l00524"></a>00524       state_ptr-&gt;<a class="code" href="structg726__state.html#a99e9ec65fcfa64bf1c602aaf9880722a">sr</a>[0] = 0x20;
<a name="l00525"></a>00525    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sr &gt; 0) {
<a name="l00526"></a>00526       exp = <a class="code" href="log2comp_8h.html#a95cc6d062293f2336429a321a3c55638">ilog2</a>(sr) + 1;
<a name="l00527"></a>00527       state_ptr-&gt;<a class="code" href="structg726__state.html#a99e9ec65fcfa64bf1c602aaf9880722a">sr</a>[0] = (exp &lt;&lt; 6) + ((sr &lt;&lt; 6) &gt;&gt; exp);
<a name="l00528"></a>00528    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sr &gt; -0x8000) {
<a name="l00529"></a>00529       mag = -sr;
<a name="l00530"></a>00530       exp = <a class="code" href="log2comp_8h.html#a95cc6d062293f2336429a321a3c55638">ilog2</a>(mag) + 1;
<a name="l00531"></a>00531       state_ptr-&gt;<a class="code" href="structg726__state.html#a99e9ec65fcfa64bf1c602aaf9880722a">sr</a>[0] =  (exp &lt;&lt; 6) + ((mag &lt;&lt; 6) &gt;&gt; exp) - 0x400;
<a name="l00532"></a>00532    } <span class="keywordflow">else</span>
<a name="l00533"></a>00533       state_ptr-&gt;<a class="code" href="structg726__state.html#a99e9ec65fcfa64bf1c602aaf9880722a">sr</a>[0] = 0x20 - 0x400;
<a name="l00534"></a>00534 <span class="preprocessor">#endif</span>
<a name="l00535"></a>00535 <span class="preprocessor"></span>
<a name="l00536"></a>00536    <span class="comment">/* DELAY A */</span>
<a name="l00537"></a>00537    state_ptr-&gt;<a class="code" href="structg726__state.html#ae4b79f57afaae139d974b685e4da9356">pk</a>[1] = state_ptr-&gt;<a class="code" href="structg726__state.html#ae4b79f57afaae139d974b685e4da9356">pk</a>[0];
<a name="l00538"></a>00538    state_ptr-&gt;<a class="code" href="structg726__state.html#ae4b79f57afaae139d974b685e4da9356">pk</a>[0] = pk0;
<a name="l00539"></a>00539 
<a name="l00540"></a>00540    <span class="comment">/* TONE */</span>
<a name="l00541"></a>00541    <span class="keywordflow">if</span> (tr == 1)      <span class="comment">/* this sample has been treated as data */</span>
<a name="l00542"></a>00542       state_ptr-&gt;<a class="code" href="structg726__state.html#ae912684497cad6bba9d0b7d85b3e3c0d">td</a> = 0;   <span class="comment">/* next one will be treated as voice */</span>
<a name="l00543"></a>00543    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (a2p &lt; -11776)  <span class="comment">/* small sample-to-sample correlation */</span>
<a name="l00544"></a>00544       state_ptr-&gt;<a class="code" href="structg726__state.html#ae912684497cad6bba9d0b7d85b3e3c0d">td</a> = 1;   <span class="comment">/* signal may be data */</span>
<a name="l00545"></a>00545    <span class="keywordflow">else</span>           <span class="comment">/* signal is voice */</span>
<a name="l00546"></a>00546       state_ptr-&gt;<a class="code" href="structg726__state.html#ae912684497cad6bba9d0b7d85b3e3c0d">td</a> = 0;
<a name="l00547"></a>00547 
<a name="l00548"></a>00548    <span class="comment">/*</span>
<a name="l00549"></a>00549 <span class="comment">    * Adaptation speed control.</span>
<a name="l00550"></a>00550 <span class="comment">    */</span>
<a name="l00551"></a>00551    state_ptr-&gt;<a class="code" href="structg726__state.html#ab4b194a50b1b4a5db20c08e4982d7550">dms</a> += (fi - state_ptr-&gt;<a class="code" href="structg726__state.html#ab4b194a50b1b4a5db20c08e4982d7550">dms</a>) &gt;&gt; 5;      <span class="comment">/* FILTA */</span>
<a name="l00552"></a>00552    state_ptr-&gt;<a class="code" href="structg726__state.html#a17320d9e1c5549138392f94a95540c6f">dml</a> += (((fi &lt;&lt; 2) - state_ptr-&gt;<a class="code" href="structg726__state.html#a17320d9e1c5549138392f94a95540c6f">dml</a>) &gt;&gt; 7);   <span class="comment">/* FILTB */</span>
<a name="l00553"></a>00553 
<a name="l00554"></a>00554    <span class="keywordflow">if</span> (tr == 1)
<a name="l00555"></a>00555       state_ptr-&gt;<a class="code" href="structg726__state.html#ab43e9fd4bffa0506f3075a660a040e55">ap</a> = 256;
<a name="l00556"></a>00556    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (y &lt; 1536)               <span class="comment">/* SUBTC */</span>
<a name="l00557"></a>00557       state_ptr-&gt;<a class="code" href="structg726__state.html#ab43e9fd4bffa0506f3075a660a040e55">ap</a> += (0x200 - state_ptr-&gt;<a class="code" href="structg726__state.html#ab43e9fd4bffa0506f3075a660a040e55">ap</a>) &gt;&gt; 4;
<a name="l00558"></a>00558    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (state_ptr-&gt;<a class="code" href="structg726__state.html#ae912684497cad6bba9d0b7d85b3e3c0d">td</a> == 1)
<a name="l00559"></a>00559       state_ptr-&gt;<a class="code" href="structg726__state.html#ab43e9fd4bffa0506f3075a660a040e55">ap</a> += (0x200 - state_ptr-&gt;<a class="code" href="structg726__state.html#ab43e9fd4bffa0506f3075a660a040e55">ap</a>) &gt;&gt; 4;
<a name="l00560"></a>00560    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (abs((state_ptr-&gt;<a class="code" href="structg726__state.html#ab4b194a50b1b4a5db20c08e4982d7550">dms</a> &lt;&lt; 2) - state_ptr-&gt;<a class="code" href="structg726__state.html#a17320d9e1c5549138392f94a95540c6f">dml</a>) &gt;=
<a name="l00561"></a>00561        (state_ptr-&gt;<a class="code" href="structg726__state.html#a17320d9e1c5549138392f94a95540c6f">dml</a> &gt;&gt; 3))
<a name="l00562"></a>00562       state_ptr-&gt;<a class="code" href="structg726__state.html#ab43e9fd4bffa0506f3075a660a040e55">ap</a> += (0x200 - state_ptr-&gt;<a class="code" href="structg726__state.html#ab43e9fd4bffa0506f3075a660a040e55">ap</a>) &gt;&gt; 4;
<a name="l00563"></a>00563    <span class="keywordflow">else</span>
<a name="l00564"></a>00564       state_ptr-&gt;<a class="code" href="structg726__state.html#ab43e9fd4bffa0506f3075a660a040e55">ap</a> += (-state_ptr-&gt;<a class="code" href="structg726__state.html#ab43e9fd4bffa0506f3075a660a040e55">ap</a>) &gt;&gt; 4;
<a name="l00565"></a>00565 }
<a name="l00566"></a>00566 
<a name="l00567"></a>00567 <span class="comment">/*</span>
<a name="l00568"></a>00568 <span class="comment"> * g726_decode()</span>
<a name="l00569"></a>00569 <span class="comment"> *</span>
<a name="l00570"></a>00570 <span class="comment"> * Description:</span>
<a name="l00571"></a>00571 <span class="comment"> *</span>
<a name="l00572"></a>00572 <span class="comment"> * Decodes a 4-bit code of G.726-32 encoded data of i and</span>
<a name="l00573"></a>00573 <span class="comment"> * returns the resulting linear PCM, A-law or u-law value.</span>
<a name="l00574"></a>00574 <span class="comment"> * return -1 for unknown out_coding value.</span>
<a name="l00575"></a>00575 <span class="comment"> */</span>
<a name="l00576"></a><a class="code" href="codec__g726_8c.html#ad9966401176e6fde568066453b209fe4">00576</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="codec__g726_8c.html#ad9966401176e6fde568066453b209fe4">g726_decode</a>(<span class="keywordtype">int</span> i, <span class="keyword">struct</span> <a class="code" href="structg726__state.html">g726_state</a> *state_ptr)
<a name="l00577"></a>00577 {
<a name="l00578"></a>00578    <span class="keywordtype">int</span>      sezi, sez, se; <span class="comment">/* ACCUM */</span>
<a name="l00579"></a>00579    <span class="keywordtype">int</span>      y;       <span class="comment">/* MIX */</span>
<a name="l00580"></a>00580    <span class="keywordtype">int</span>      sr;         <span class="comment">/* ADDB */</span>
<a name="l00581"></a>00581    <span class="keywordtype">int</span>      dq;
<a name="l00582"></a>00582    <span class="keywordtype">int</span>      dqsez;
<a name="l00583"></a>00583 
<a name="l00584"></a>00584    i &amp;= 0x0f;        <span class="comment">/* mask to get proper bits */</span>
<a name="l00585"></a>00585 <span class="preprocessor">#ifdef NOT_BLI</span>
<a name="l00586"></a>00586 <span class="preprocessor"></span>   sezi = <a class="code" href="codec__g726_8c.html#a25bc3fa4bf5c7cf53cc31a753493ca0c">predictor_zero</a>(state_ptr);
<a name="l00587"></a>00587    sez = sezi;
<a name="l00588"></a>00588    se = sezi + <a class="code" href="codec__g726_8c.html#aa8f18e1457b16f935c543def8f7b76f4">predictor_pole</a>(state_ptr); <span class="comment">/* estimated signal */</span>
<a name="l00589"></a>00589 <span class="preprocessor">#else</span>
<a name="l00590"></a>00590 <span class="preprocessor"></span>   sezi = <a class="code" href="codec__g726_8c.html#a25bc3fa4bf5c7cf53cc31a753493ca0c">predictor_zero</a>(state_ptr);
<a name="l00591"></a>00591    sez = sezi &gt;&gt; 1;
<a name="l00592"></a>00592    se = (sezi + <a class="code" href="codec__g726_8c.html#aa8f18e1457b16f935c543def8f7b76f4">predictor_pole</a>(state_ptr)) &gt;&gt; 1;   <span class="comment">/* estimated signal */</span>
<a name="l00593"></a>00593 <span class="preprocessor">#endif</span>
<a name="l00594"></a>00594 <span class="preprocessor"></span>
<a name="l00595"></a>00595    y = <a class="code" href="codec__g726_8c.html#a19c4e074d472c28d949cb493e6e2c77f">step_size</a>(state_ptr);  <span class="comment">/* dynamic quantizer step size */</span>
<a name="l00596"></a>00596 
<a name="l00597"></a>00597    dq = <a class="code" href="codec__g726_8c.html#aab1f392cff37399fc43db0d4b2cc11c8">reconstruct</a>(i &amp; 8, _dqlntab[i], y); <span class="comment">/* quantized diff. */</span>
<a name="l00598"></a>00598 
<a name="l00599"></a>00599 <span class="preprocessor">#ifdef NOT_BLI</span>
<a name="l00600"></a>00600 <span class="preprocessor"></span>   sr = se + dq;           <span class="comment">/* reconst. signal */</span>
<a name="l00601"></a>00601    dqsez = dq + sez;       <span class="comment">/* pole prediction diff. */</span>
<a name="l00602"></a>00602 <span class="preprocessor">#else</span>
<a name="l00603"></a>00603 <span class="preprocessor"></span>   sr = (dq &lt; 0) ? se - (dq &amp; 0x3FFF) : se + dq;   <span class="comment">/* reconst. signal */</span>
<a name="l00604"></a>00604    dqsez = sr - se + sez;     <span class="comment">/* pole prediction diff. */</span>
<a name="l00605"></a>00605 <span class="preprocessor">#endif</span>
<a name="l00606"></a>00606 <span class="preprocessor"></span>
<a name="l00607"></a>00607    <a class="code" href="codec__g726_8c.html#a8c58a1d1fd9436ff5145385d3ef7a430">update</a>(4, y, _witab[i] &lt;&lt; 5, _fitab[i], dq, sr, dqsez, state_ptr);
<a name="l00608"></a>00608 
<a name="l00609"></a>00609 <span class="preprocessor">#ifdef NOT_BLI</span>
<a name="l00610"></a>00610 <span class="preprocessor"></span>   <span class="keywordflow">return</span> (sr &gt;&gt; 10);   <span class="comment">/* sr was 26-bit dynamic range */</span>
<a name="l00611"></a>00611 <span class="preprocessor">#else</span>
<a name="l00612"></a>00612 <span class="preprocessor"></span>   <span class="keywordflow">return</span> (sr &lt;&lt; 2); <span class="comment">/* sr was 14-bit dynamic range */</span>
<a name="l00613"></a>00613 <span class="preprocessor">#endif</span>
<a name="l00614"></a>00614 <span class="preprocessor"></span>}
<a name="l00615"></a>00615 
<a name="l00616"></a>00616 <span class="comment">/*</span>
<a name="l00617"></a>00617 <span class="comment"> * g726_encode()</span>
<a name="l00618"></a>00618 <span class="comment"> *</span>
<a name="l00619"></a>00619 <span class="comment"> * Encodes the input vale of linear PCM, A-law or u-law data sl and returns</span>
<a name="l00620"></a>00620 <span class="comment"> * the resulting code. -1 is returned for unknown input coding value.</span>
<a name="l00621"></a>00621 <span class="comment"> */</span>
<a name="l00622"></a><a class="code" href="codec__g726_8c.html#ae0a9062ebb00533311442013a7d2b2c1">00622</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="codec__g726_8c.html#ae0a9062ebb00533311442013a7d2b2c1">g726_encode</a>(<span class="keywordtype">int</span> sl, <span class="keyword">struct</span> <a class="code" href="structg726__state.html">g726_state</a> *state_ptr)
<a name="l00623"></a>00623 {
<a name="l00624"></a>00624    <span class="keywordtype">int</span>      sezi, se, sez;    <span class="comment">/* ACCUM */</span>
<a name="l00625"></a>00625    <span class="keywordtype">int</span>      d;       <span class="comment">/* SUBTA */</span>
<a name="l00626"></a>00626    <span class="keywordtype">int</span>      sr;         <span class="comment">/* ADDB */</span>
<a name="l00627"></a>00627    <span class="keywordtype">int</span>      y;       <span class="comment">/* MIX */</span>
<a name="l00628"></a>00628    <span class="keywordtype">int</span>      dqsez;         <span class="comment">/* ADDC */</span>
<a name="l00629"></a>00629    <span class="keywordtype">int</span>      dq, i;
<a name="l00630"></a>00630 
<a name="l00631"></a>00631 <span class="preprocessor">#ifdef NOT_BLI</span>
<a name="l00632"></a>00632 <span class="preprocessor"></span>   sl &lt;&lt;= 10;        <span class="comment">/* 26-bit dynamic range */</span>
<a name="l00633"></a>00633 
<a name="l00634"></a>00634    sezi = <a class="code" href="codec__g726_8c.html#a25bc3fa4bf5c7cf53cc31a753493ca0c">predictor_zero</a>(state_ptr);
<a name="l00635"></a>00635    sez = sezi;
<a name="l00636"></a>00636    se = sezi + <a class="code" href="codec__g726_8c.html#aa8f18e1457b16f935c543def8f7b76f4">predictor_pole</a>(state_ptr); <span class="comment">/* estimated signal */</span>
<a name="l00637"></a>00637 <span class="preprocessor">#else</span>
<a name="l00638"></a>00638 <span class="preprocessor"></span>   sl &gt;&gt;= 2;         <span class="comment">/* 14-bit dynamic range */</span>
<a name="l00639"></a>00639 
<a name="l00640"></a>00640    sezi = <a class="code" href="codec__g726_8c.html#a25bc3fa4bf5c7cf53cc31a753493ca0c">predictor_zero</a>(state_ptr);
<a name="l00641"></a>00641    sez = sezi &gt;&gt; 1;
<a name="l00642"></a>00642    se = (sezi + <a class="code" href="codec__g726_8c.html#aa8f18e1457b16f935c543def8f7b76f4">predictor_pole</a>(state_ptr)) &gt;&gt; 1;   <span class="comment">/* estimated signal */</span>
<a name="l00643"></a>00643 <span class="preprocessor">#endif</span>
<a name="l00644"></a>00644 <span class="preprocessor"></span>
<a name="l00645"></a>00645    d = sl - se;            <span class="comment">/* estimation difference */</span>
<a name="l00646"></a>00646 
<a name="l00647"></a>00647    <span class="comment">/* quantize the prediction difference */</span>
<a name="l00648"></a>00648    y = <a class="code" href="codec__g726_8c.html#a19c4e074d472c28d949cb493e6e2c77f">step_size</a>(state_ptr);     <span class="comment">/* quantizer step size */</span>
<a name="l00649"></a>00649 <span class="preprocessor">#ifdef NOT_BLI</span>
<a name="l00650"></a>00650 <span class="preprocessor"></span>   d /= 0x1000;
<a name="l00651"></a>00651 <span class="preprocessor">#endif</span>
<a name="l00652"></a>00652 <span class="preprocessor"></span>   i = <a class="code" href="codec__g726_8c.html#a97f877849366e51ff303c25633e12829">quantize</a>(d, y, qtab_721, 7); <span class="comment">/* i = G726 code */</span>
<a name="l00653"></a>00653 
<a name="l00654"></a>00654    dq = <a class="code" href="codec__g726_8c.html#aab1f392cff37399fc43db0d4b2cc11c8">reconstruct</a>(i &amp; 8, _dqlntab[i], y);  <span class="comment">/* quantized est diff */</span>
<a name="l00655"></a>00655 
<a name="l00656"></a>00656 <span class="preprocessor">#ifdef NOT_BLI</span>
<a name="l00657"></a>00657 <span class="preprocessor"></span>   sr = se + dq;           <span class="comment">/* reconst. signal */</span>
<a name="l00658"></a>00658    dqsez = dq + sez;       <span class="comment">/* pole prediction diff. */</span>
<a name="l00659"></a>00659 <span class="preprocessor">#else</span>
<a name="l00660"></a>00660 <span class="preprocessor"></span>   sr = (dq &lt; 0) ? se - (dq &amp; 0x3FFF) : se + dq;   <span class="comment">/* reconst. signal */</span>
<a name="l00661"></a>00661    dqsez = sr - se + sez;        <span class="comment">/* pole prediction diff. */</span>
<a name="l00662"></a>00662 <span class="preprocessor">#endif</span>
<a name="l00663"></a>00663 <span class="preprocessor"></span>
<a name="l00664"></a>00664    <a class="code" href="codec__g726_8c.html#a8c58a1d1fd9436ff5145385d3ef7a430">update</a>(4, y, _witab[i] &lt;&lt; 5, _fitab[i], dq, sr, dqsez, state_ptr);
<a name="l00665"></a>00665 
<a name="l00666"></a>00666    <span class="keywordflow">return</span> (i);
<a name="l00667"></a>00667 }
<a name="l00668"></a>00668 
<a name="l00669"></a>00669 <span class="comment">/*</span>
<a name="l00670"></a>00670 <span class="comment"> * Private workspace for translating signed linear signals to G726.</span>
<a name="l00671"></a>00671 <span class="comment"> * Don&apos;t bother to define two distinct structs.</span>
<a name="l00672"></a>00672 <span class="comment"> */</span>
<a name="l00673"></a>00673 
<a name="l00674"></a><a class="code" href="structg726__coder__pvt.html">00674</a> <span class="keyword">struct </span><a class="code" href="structg726__coder__pvt.html">g726_coder_pvt</a> {
<a name="l00675"></a>00675    <span class="comment">/* buffer any odd byte in input - 0x80 + (value &amp; 0xf) if present */</span>
<a name="l00676"></a><a class="code" href="structg726__coder__pvt.html#a757f83d1c3cd8afd0bc960c9233e782f">00676</a>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structg726__coder__pvt.html#a757f83d1c3cd8afd0bc960c9233e782f">next_flag</a>;
<a name="l00677"></a><a class="code" href="structg726__coder__pvt.html#aa091aa315e7e2fda3e01c8e68adb2e3a">00677</a>    <span class="keyword">struct </span><a class="code" href="structg726__state.html">g726_state</a> <a class="code" href="structg726__coder__pvt.html#aa091aa315e7e2fda3e01c8e68adb2e3a">g726</a>;
<a name="l00678"></a>00678 };
<a name="l00679"></a>00679 <span class="comment"></span>
<a name="l00680"></a>00680 <span class="comment">/*! \brief init a new instance of g726_coder_pvt. */</span>
<a name="l00681"></a><a class="code" href="codec__g726_8c.html#a970269a25554c6b596144a6836aa7137">00681</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="codec__g726_8c.html#a970269a25554c6b596144a6836aa7137" title="init a new instance of g726_coder_pvt.">lintog726_new</a>(<span class="keyword">struct</span> <a class="code" href="structast__trans__pvt.html" title="Default structure for translators, with the basic fields and buffers, all allocated...">ast_trans_pvt</a> *pvt)
<a name="l00682"></a>00682 {
<a name="l00683"></a>00683    <span class="keyword">struct </span><a class="code" href="structg726__coder__pvt.html">g726_coder_pvt</a> *tmp = pvt-&gt;<a class="code" href="structast__trans__pvt.html#a77153a7ab7ba05031fbbb4e67aa9dcfc">pvt</a>;
<a name="l00684"></a>00684 
<a name="l00685"></a>00685    <a class="code" href="codec__g726_8c.html#a4ed96ee853ed1effaccd28027ebe2f8d">g726_init_state</a>(&amp;tmp-&gt;<a class="code" href="structg726__coder__pvt.html#aa091aa315e7e2fda3e01c8e68adb2e3a">g726</a>);
<a name="l00686"></a>00686 
<a name="l00687"></a>00687    <span class="keywordflow">return</span> 0;
<a name="l00688"></a>00688 }
<a name="l00689"></a>00689 <span class="comment"></span>
<a name="l00690"></a>00690 <span class="comment">/*! \brief decode packed 4-bit G726 values (AAL2 packing) and store in buffer. */</span>
<a name="l00691"></a><a class="code" href="codec__g726_8c.html#ab3ffc3546b18f0c34c101738330bfe96">00691</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="codec__g726_8c.html#ab3ffc3546b18f0c34c101738330bfe96" title="decode packed 4-bit G726 values (AAL2 packing) and store in buffer.">g726aal2tolin_framein</a> (<span class="keyword">struct</span> <a class="code" href="structast__trans__pvt.html" title="Default structure for translators, with the basic fields and buffers, all allocated...">ast_trans_pvt</a> *pvt, <span class="keyword">struct</span> <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>)
<a name="l00692"></a>00692 {
<a name="l00693"></a>00693    <span class="keyword">struct </span><a class="code" href="structg726__coder__pvt.html">g726_coder_pvt</a> *tmp = pvt-&gt;<a class="code" href="structast__trans__pvt.html#a77153a7ab7ba05031fbbb4e67aa9dcfc">pvt</a>;
<a name="l00694"></a>00694    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *src = f-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>;
<a name="l00695"></a>00695    int16_t *dst = pvt-&gt;<a class="code" href="structast__trans__pvt.html#a7e0e7648fece2e6e98e7b0b0a8a60381">outbuf</a>.<a class="code" href="structast__trans__pvt.html#ae2d3d0f45d05517ad82ab98e887666be">i16</a> + pvt-&gt;<a class="code" href="structast__trans__pvt.html#a37672e6b906143604cefd3e959777b31">samples</a>;
<a name="l00696"></a>00696    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;
<a name="l00697"></a>00697 
<a name="l00698"></a>00698    <span class="keywordflow">for</span> (i = 0; i &lt; f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>; i++) {
<a name="l00699"></a>00699       *dst++ = <a class="code" href="codec__g726_8c.html#ad9966401176e6fde568066453b209fe4">g726_decode</a>((src[i] &gt;&gt; 4) &amp; 0xf, &amp;tmp-&gt;<a class="code" href="structg726__coder__pvt.html#aa091aa315e7e2fda3e01c8e68adb2e3a">g726</a>);
<a name="l00700"></a>00700       *dst++ = <a class="code" href="codec__g726_8c.html#ad9966401176e6fde568066453b209fe4">g726_decode</a>(src[i] &amp; 0x0f, &amp;tmp-&gt;<a class="code" href="structg726__coder__pvt.html#aa091aa315e7e2fda3e01c8e68adb2e3a">g726</a>);
<a name="l00701"></a>00701    }
<a name="l00702"></a>00702 
<a name="l00703"></a>00703    pvt-&gt;<a class="code" href="structast__trans__pvt.html#a37672e6b906143604cefd3e959777b31">samples</a> += f-&gt;<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>;
<a name="l00704"></a>00704    pvt-&gt;<a class="code" href="structast__trans__pvt.html#ad67e07841d1233e596e6f822a3c81f6b" title="actual space used in outbuf">datalen</a> += 2 * f-&gt;<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>; <span class="comment">/* 2 bytes/sample */</span>
<a name="l00705"></a>00705 
<a name="l00706"></a>00706    <span class="keywordflow">return</span> 0;
<a name="l00707"></a>00707 }
<a name="l00708"></a>00708 <span class="comment"></span>
<a name="l00709"></a>00709 <span class="comment">/*! \brief compress and store data (4-bit G726 samples, AAL2 packing) in outbuf */</span>
<a name="l00710"></a><a class="code" href="codec__g726_8c.html#a5366aac7547a2db20f14193232db53cd">00710</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="codec__g726_8c.html#a5366aac7547a2db20f14193232db53cd" title="compress and store data (4-bit G726 samples, AAL2 packing) in outbuf">lintog726aal2_framein</a>(<span class="keyword">struct</span> <a class="code" href="structast__trans__pvt.html" title="Default structure for translators, with the basic fields and buffers, all allocated...">ast_trans_pvt</a> *pvt, <span class="keyword">struct</span> <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>)
<a name="l00711"></a>00711 {
<a name="l00712"></a>00712    <span class="keyword">struct </span><a class="code" href="structg726__coder__pvt.html">g726_coder_pvt</a> *tmp = pvt-&gt;<a class="code" href="structast__trans__pvt.html#a77153a7ab7ba05031fbbb4e67aa9dcfc">pvt</a>;
<a name="l00713"></a>00713    int16_t *src = f-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>;
<a name="l00714"></a>00714    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;
<a name="l00715"></a>00715 
<a name="l00716"></a>00716    <span class="keywordflow">for</span> (i = 0; i &lt; f-&gt;<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>; i++) {
<a name="l00717"></a>00717       <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> d = <a class="code" href="codec__g726_8c.html#ae0a9062ebb00533311442013a7d2b2c1">g726_encode</a>(src[i], &amp;tmp-&gt;<a class="code" href="structg726__coder__pvt.html#aa091aa315e7e2fda3e01c8e68adb2e3a">g726</a>); <span class="comment">/* this sample */</span>
<a name="l00718"></a>00718 
<a name="l00719"></a>00719       <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="structg726__coder__pvt.html#a757f83d1c3cd8afd0bc960c9233e782f">next_flag</a> &amp; 0x80) {  <span class="comment">/* merge with leftover sample */</span>
<a name="l00720"></a>00720          pvt-&gt;<a class="code" href="structast__trans__pvt.html#a7e0e7648fece2e6e98e7b0b0a8a60381">outbuf</a>.<a class="code" href="structast__trans__pvt.html#a9df78bd38aa81763ad1c56f3de8d5d3e">c</a>[pvt-&gt;<a class="code" href="structast__trans__pvt.html#ad67e07841d1233e596e6f822a3c81f6b" title="actual space used in outbuf">datalen</a>++] = ((tmp-&gt;<a class="code" href="structg726__coder__pvt.html#a757f83d1c3cd8afd0bc960c9233e782f">next_flag</a> &amp; 0xf)&lt;&lt; 4) | d;
<a name="l00721"></a>00721          pvt-&gt;<a class="code" href="structast__trans__pvt.html#a37672e6b906143604cefd3e959777b31">samples</a> += 2;   <span class="comment">/* 2 samples per byte */</span>
<a name="l00722"></a>00722          tmp-&gt;<a class="code" href="structg726__coder__pvt.html#a757f83d1c3cd8afd0bc960c9233e782f">next_flag</a> = 0;
<a name="l00723"></a>00723       } <span class="keywordflow">else</span> {
<a name="l00724"></a>00724          tmp-&gt;<a class="code" href="structg726__coder__pvt.html#a757f83d1c3cd8afd0bc960c9233e782f">next_flag</a> = 0x80 | d;
<a name="l00725"></a>00725       }
<a name="l00726"></a>00726    }
<a name="l00727"></a>00727 
<a name="l00728"></a>00728    <span class="keywordflow">return</span> 0;
<a name="l00729"></a>00729 }
<a name="l00730"></a>00730 <span class="comment"></span>
<a name="l00731"></a>00731 <span class="comment">/*! \brief decode packed 4-bit G726 values (RFC3551 packing) and store in buffer. */</span>
<a name="l00732"></a><a class="code" href="codec__g726_8c.html#a396597e5bfa17d6518e10139fdcaf354">00732</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="codec__g726_8c.html#a396597e5bfa17d6518e10139fdcaf354" title="decode packed 4-bit G726 values (RFC3551 packing) and store in buffer.">g726tolin_framein</a> (<span class="keyword">struct</span> <a class="code" href="structast__trans__pvt.html" title="Default structure for translators, with the basic fields and buffers, all allocated...">ast_trans_pvt</a> *pvt, <span class="keyword">struct</span> <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>)
<a name="l00733"></a>00733 {
<a name="l00734"></a>00734    <span class="keyword">struct </span><a class="code" href="structg726__coder__pvt.html">g726_coder_pvt</a> *tmp = pvt-&gt;<a class="code" href="structast__trans__pvt.html#a77153a7ab7ba05031fbbb4e67aa9dcfc">pvt</a>;
<a name="l00735"></a>00735    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *src = f-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>;
<a name="l00736"></a>00736    int16_t *dst = pvt-&gt;<a class="code" href="structast__trans__pvt.html#a7e0e7648fece2e6e98e7b0b0a8a60381">outbuf</a>.<a class="code" href="structast__trans__pvt.html#ae2d3d0f45d05517ad82ab98e887666be">i16</a> + pvt-&gt;<a class="code" href="structast__trans__pvt.html#a37672e6b906143604cefd3e959777b31">samples</a>;
<a name="l00737"></a>00737    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;
<a name="l00738"></a>00738 
<a name="l00739"></a>00739    <span class="keywordflow">for</span> (i = 0; i &lt; f-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>; i++) {
<a name="l00740"></a>00740       *dst++ = <a class="code" href="codec__g726_8c.html#ad9966401176e6fde568066453b209fe4">g726_decode</a>(src[i] &amp; 0x0f, &amp;tmp-&gt;<a class="code" href="structg726__coder__pvt.html#aa091aa315e7e2fda3e01c8e68adb2e3a">g726</a>);
<a name="l00741"></a>00741       *dst++ = <a class="code" href="codec__g726_8c.html#ad9966401176e6fde568066453b209fe4">g726_decode</a>((src[i] &gt;&gt; 4) &amp; 0xf, &amp;tmp-&gt;<a class="code" href="structg726__coder__pvt.html#aa091aa315e7e2fda3e01c8e68adb2e3a">g726</a>);
<a name="l00742"></a>00742    }
<a name="l00743"></a>00743 
<a name="l00744"></a>00744    pvt-&gt;<a class="code" href="structast__trans__pvt.html#a37672e6b906143604cefd3e959777b31">samples</a> += f-&gt;<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>;
<a name="l00745"></a>00745    pvt-&gt;<a class="code" href="structast__trans__pvt.html#ad67e07841d1233e596e6f822a3c81f6b" title="actual space used in outbuf">datalen</a> += 2 * f-&gt;<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>; <span class="comment">/* 2 bytes/sample */</span>
<a name="l00746"></a>00746 
<a name="l00747"></a>00747    <span class="keywordflow">return</span> 0;
<a name="l00748"></a>00748 }
<a name="l00749"></a>00749 <span class="comment"></span>
<a name="l00750"></a>00750 <span class="comment">/*! \brief compress and store data (4-bit G726 samples, RFC3551 packing) in outbuf */</span>
<a name="l00751"></a><a class="code" href="codec__g726_8c.html#afbef0b800112bb35a6fe0e59a555a10c">00751</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="codec__g726_8c.html#afbef0b800112bb35a6fe0e59a555a10c" title="compress and store data (4-bit G726 samples, RFC3551 packing) in outbuf">lintog726_framein</a>(<span class="keyword">struct</span> <a class="code" href="structast__trans__pvt.html" title="Default structure for translators, with the basic fields and buffers, all allocated...">ast_trans_pvt</a> *pvt, <span class="keyword">struct</span> <a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>)
<a name="l00752"></a>00752 {
<a name="l00753"></a>00753    <span class="keyword">struct </span><a class="code" href="structg726__coder__pvt.html">g726_coder_pvt</a> *tmp = pvt-&gt;<a class="code" href="structast__trans__pvt.html#a77153a7ab7ba05031fbbb4e67aa9dcfc">pvt</a>;
<a name="l00754"></a>00754    int16_t *src = f-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>;
<a name="l00755"></a>00755    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;
<a name="l00756"></a>00756 
<a name="l00757"></a>00757    <span class="keywordflow">for</span> (i = 0; i &lt; f-&gt;<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>; i++) {
<a name="l00758"></a>00758       <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> d = <a class="code" href="codec__g726_8c.html#ae0a9062ebb00533311442013a7d2b2c1">g726_encode</a>(src[i], &amp;tmp-&gt;<a class="code" href="structg726__coder__pvt.html#aa091aa315e7e2fda3e01c8e68adb2e3a">g726</a>); <span class="comment">/* this sample */</span>
<a name="l00759"></a>00759 
<a name="l00760"></a>00760       <span class="keywordflow">if</span> (tmp-&gt;<a class="code" href="structg726__coder__pvt.html#a757f83d1c3cd8afd0bc960c9233e782f">next_flag</a> &amp; 0x80) {  <span class="comment">/* merge with leftover sample */</span>
<a name="l00761"></a>00761          pvt-&gt;<a class="code" href="structast__trans__pvt.html#a7e0e7648fece2e6e98e7b0b0a8a60381">outbuf</a>.<a class="code" href="structast__trans__pvt.html#a9df78bd38aa81763ad1c56f3de8d5d3e">c</a>[pvt-&gt;<a class="code" href="structast__trans__pvt.html#ad67e07841d1233e596e6f822a3c81f6b" title="actual space used in outbuf">datalen</a>++] = (d &lt;&lt; 4) | (tmp-&gt;<a class="code" href="structg726__coder__pvt.html#a757f83d1c3cd8afd0bc960c9233e782f">next_flag</a> &amp; 0xf);
<a name="l00762"></a>00762          pvt-&gt;<a class="code" href="structast__trans__pvt.html#a37672e6b906143604cefd3e959777b31">samples</a> += 2;   <span class="comment">/* 2 samples per byte */</span>
<a name="l00763"></a>00763          tmp-&gt;<a class="code" href="structg726__coder__pvt.html#a757f83d1c3cd8afd0bc960c9233e782f">next_flag</a> = 0;
<a name="l00764"></a>00764       } <span class="keywordflow">else</span> {
<a name="l00765"></a>00765          tmp-&gt;<a class="code" href="structg726__coder__pvt.html#a757f83d1c3cd8afd0bc960c9233e782f">next_flag</a> = 0x80 | d;
<a name="l00766"></a>00766       }
<a name="l00767"></a>00767    }
<a name="l00768"></a>00768 
<a name="l00769"></a>00769    <span class="keywordflow">return</span> 0;
<a name="l00770"></a>00770 }
<a name="l00771"></a>00771 
<a name="l00772"></a><a class="code" href="codec__g726_8c.html#a79f398c87c226f64607d1bb2ba20b2c6">00772</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structast__translator.html" title="Descriptor of a translator.">ast_translator</a> <a class="code" href="codec__g726_8c.html#a79f398c87c226f64607d1bb2ba20b2c6">g726tolin</a> = {
<a name="l00773"></a>00773    .<a class="code" href="structast__translator.html#a40d6d251fb11e94f6a0a3504c1805e42">name</a> = <span class="stringliteral">&quot;g726tolin&quot;</span>,
<a name="l00774"></a>00774    .srcfmt = <a class="code" href="frame_8h.html#a030c77081bc2aff5ae5a384769f46418">AST_FORMAT_G726</a>,
<a name="l00775"></a>00775    .dstfmt = <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>,
<a name="l00776"></a>00776    .newpvt = <a class="code" href="codec__g726_8c.html#a970269a25554c6b596144a6836aa7137" title="init a new instance of g726_coder_pvt.">lintog726_new</a>,   <span class="comment">/* same for both directions */</span>
<a name="l00777"></a>00777    .framein = <a class="code" href="codec__g726_8c.html#a396597e5bfa17d6518e10139fdcaf354" title="decode packed 4-bit G726 values (RFC3551 packing) and store in buffer.">g726tolin_framein</a>,
<a name="l00778"></a>00778    .sample = <a class="code" href="ex__g726_8h.html#afe5eeab9ada43ad96d5e5b32c3615844">g726_sample</a>,
<a name="l00779"></a>00779    .desc_size = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structg726__coder__pvt.html">g726_coder_pvt</a>),
<a name="l00780"></a>00780    .buffer_samples = <a class="code" href="codec__a__mu_8c.html#a26ea4db54e582d52795474df3ebb981a">BUFFER_SAMPLES</a>,
<a name="l00781"></a>00781    .buf_size = <a class="code" href="codec__a__mu_8c.html#a26ea4db54e582d52795474df3ebb981a">BUFFER_SAMPLES</a> * 2,
<a name="l00782"></a>00782    .plc_samples = 160,
<a name="l00783"></a>00783 };
<a name="l00784"></a>00784 
<a name="l00785"></a><a class="code" href="codec__g726_8c.html#a7de820e05ec15a47616cb31c45519a21">00785</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structast__translator.html" title="Descriptor of a translator.">ast_translator</a> <a class="code" href="codec__g726_8c.html#a7de820e05ec15a47616cb31c45519a21">lintog726</a> = {
<a name="l00786"></a>00786    .<a class="code" href="structast__translator.html#a40d6d251fb11e94f6a0a3504c1805e42">name</a> = <span class="stringliteral">&quot;lintog726&quot;</span>,
<a name="l00787"></a>00787    .srcfmt = <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>,
<a name="l00788"></a>00788    .dstfmt = <a class="code" href="frame_8h.html#a030c77081bc2aff5ae5a384769f46418">AST_FORMAT_G726</a>,
<a name="l00789"></a>00789    .newpvt = <a class="code" href="codec__g726_8c.html#a970269a25554c6b596144a6836aa7137" title="init a new instance of g726_coder_pvt.">lintog726_new</a>,   <span class="comment">/* same for both directions */</span>
<a name="l00790"></a>00790    .framein = <a class="code" href="codec__g726_8c.html#afbef0b800112bb35a6fe0e59a555a10c" title="compress and store data (4-bit G726 samples, RFC3551 packing) in outbuf">lintog726_framein</a>,
<a name="l00791"></a>00791    .sample = <a class="code" href="slin_8h.html#a06a9fea453a43e8d8e0d62abcc1f3f1b">slin8_sample</a>,
<a name="l00792"></a>00792    .desc_size = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structg726__coder__pvt.html">g726_coder_pvt</a>),
<a name="l00793"></a>00793    .buffer_samples = <a class="code" href="codec__a__mu_8c.html#a26ea4db54e582d52795474df3ebb981a">BUFFER_SAMPLES</a>,
<a name="l00794"></a>00794    .buf_size = <a class="code" href="codec__a__mu_8c.html#a26ea4db54e582d52795474df3ebb981a">BUFFER_SAMPLES</a>/2,
<a name="l00795"></a>00795 };
<a name="l00796"></a>00796 
<a name="l00797"></a><a class="code" href="codec__g726_8c.html#a9f0e74d77708c82028b79afb4352401d">00797</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structast__translator.html" title="Descriptor of a translator.">ast_translator</a> <a class="code" href="codec__g726_8c.html#a9f0e74d77708c82028b79afb4352401d">g726aal2tolin</a> = {
<a name="l00798"></a>00798    .<a class="code" href="structast__translator.html#a40d6d251fb11e94f6a0a3504c1805e42">name</a> = <span class="stringliteral">&quot;g726aal2tolin&quot;</span>,
<a name="l00799"></a>00799    .srcfmt = <a class="code" href="frame_8h.html#a536fbd427f197a33e679c7721afad420">AST_FORMAT_G726_AAL2</a>,
<a name="l00800"></a>00800    .dstfmt = <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>,
<a name="l00801"></a>00801    .newpvt = <a class="code" href="codec__g726_8c.html#a970269a25554c6b596144a6836aa7137" title="init a new instance of g726_coder_pvt.">lintog726_new</a>,   <span class="comment">/* same for both directions */</span>
<a name="l00802"></a>00802    .framein = <a class="code" href="codec__g726_8c.html#ab3ffc3546b18f0c34c101738330bfe96" title="decode packed 4-bit G726 values (AAL2 packing) and store in buffer.">g726aal2tolin_framein</a>,
<a name="l00803"></a>00803    .sample = <a class="code" href="ex__g726_8h.html#afe5eeab9ada43ad96d5e5b32c3615844">g726_sample</a>,
<a name="l00804"></a>00804    .desc_size = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structg726__coder__pvt.html">g726_coder_pvt</a>),
<a name="l00805"></a>00805    .buffer_samples = <a class="code" href="codec__a__mu_8c.html#a26ea4db54e582d52795474df3ebb981a">BUFFER_SAMPLES</a>,
<a name="l00806"></a>00806    .buf_size = <a class="code" href="codec__a__mu_8c.html#a26ea4db54e582d52795474df3ebb981a">BUFFER_SAMPLES</a> * 2,
<a name="l00807"></a>00807    .plc_samples = 160,
<a name="l00808"></a>00808 };
<a name="l00809"></a>00809 
<a name="l00810"></a><a class="code" href="codec__g726_8c.html#a3a5f993fcab6849272cc1c802b7cfcfd">00810</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structast__translator.html" title="Descriptor of a translator.">ast_translator</a> <a class="code" href="codec__g726_8c.html#a3a5f993fcab6849272cc1c802b7cfcfd">lintog726aal2</a> = {
<a name="l00811"></a>00811    .<a class="code" href="structast__translator.html#a40d6d251fb11e94f6a0a3504c1805e42">name</a> = <span class="stringliteral">&quot;lintog726aal2&quot;</span>,
<a name="l00812"></a>00812    .srcfmt = <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>,
<a name="l00813"></a>00813    .dstfmt = <a class="code" href="frame_8h.html#a536fbd427f197a33e679c7721afad420">AST_FORMAT_G726_AAL2</a>,
<a name="l00814"></a>00814    .newpvt = <a class="code" href="codec__g726_8c.html#a970269a25554c6b596144a6836aa7137" title="init a new instance of g726_coder_pvt.">lintog726_new</a>,   <span class="comment">/* same for both directions */</span>
<a name="l00815"></a>00815    .framein = <a class="code" href="codec__g726_8c.html#a5366aac7547a2db20f14193232db53cd" title="compress and store data (4-bit G726 samples, AAL2 packing) in outbuf">lintog726aal2_framein</a>,
<a name="l00816"></a>00816    .sample = <a class="code" href="slin_8h.html#a06a9fea453a43e8d8e0d62abcc1f3f1b">slin8_sample</a>,
<a name="l00817"></a>00817    .desc_size = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structg726__coder__pvt.html">g726_coder_pvt</a>),
<a name="l00818"></a>00818    .buffer_samples = <a class="code" href="codec__a__mu_8c.html#a26ea4db54e582d52795474df3ebb981a">BUFFER_SAMPLES</a>,
<a name="l00819"></a>00819    .buf_size = <a class="code" href="codec__a__mu_8c.html#a26ea4db54e582d52795474df3ebb981a">BUFFER_SAMPLES</a> / 2,
<a name="l00820"></a>00820 };
<a name="l00821"></a>00821 
<a name="l00822"></a><a class="code" href="codec__g726_8c.html#a0dc068d63cb9df28d4b885bb7b5c5560">00822</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="codec__g726_8c.html#a0dc068d63cb9df28d4b885bb7b5c5560">parse_config</a>(<span class="keywordtype">int</span> <a class="code" href="codec__g726_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a>)
<a name="l00823"></a>00823 {
<a name="l00824"></a>00824    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>;
<a name="l00825"></a>00825    <span class="keyword">struct </span><a class="code" href="structast__flags.html" title="Structure used to handle boolean flags.">ast_flags</a> config_flags = { reload ? <a class="code" href="config_8h.html#a2d5492e116eebd5075f247d21fb9db26afa887389dc380bbdcffb65fec379f037">CONFIG_FLAG_FILEUNCHANGED</a> : 0 };
<a name="l00826"></a>00826    <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *cfg = <a class="code" href="config_8h.html#a0a07ddd6bbcf44485e01c14c96109482">ast_config_load</a>(<span class="stringliteral">&quot;codecs.conf&quot;</span>, config_flags);
<a name="l00827"></a>00827 
<a name="l00828"></a>00828    <span class="keywordflow">if</span> (cfg == <a class="code" href="config_8h.html#a39bacaabcacf47583204c7634e64a2a0">CONFIG_STATUS_FILEMISSING</a> || cfg == <a class="code" href="config_8h.html#a846844eb2c4eb44554445936b3770711">CONFIG_STATUS_FILEUNCHANGED</a> || cfg == <a class="code" href="config_8h.html#a8d1a63cdf2c7aff22a77b6e75d93b377">CONFIG_STATUS_FILEINVALID</a>)
<a name="l00829"></a>00829       <span class="keywordflow">return</span> 0;
<a name="l00830"></a>00830    <span class="keywordflow">for</span> (var = <a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(cfg, <span class="stringliteral">&quot;plc&quot;</span>); var; var = var-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l00831"></a>00831       <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;genericplc&quot;</span>)) {
<a name="l00832"></a>00832          g726tolin.<a class="code" href="structast__translator.html#afc59f2b3fed18060eb9965249ada884e">useplc</a> = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(var-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>) ? 1 : 0;
<a name="l00833"></a>00833          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;codec_g726: %susing generic PLC\n&quot;</span>,
<a name="l00834"></a>00834                g726tolin.<a class="code" href="structast__translator.html#afc59f2b3fed18060eb9965249ada884e">useplc</a> ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;not &quot;</span>);
<a name="l00835"></a>00835       }
<a name="l00836"></a>00836    }
<a name="l00837"></a>00837    <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(cfg);
<a name="l00838"></a>00838    <span class="keywordflow">return</span> 0;
<a name="l00839"></a>00839 }
<a name="l00840"></a>00840 
<a name="l00841"></a><a class="code" href="codec__g726_8c.html#ad1982509765f4870f1f63412a53ea668">00841</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="codec__g726_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a>(<span class="keywordtype">void</span>)
<a name="l00842"></a>00842 {
<a name="l00843"></a>00843    <span class="keywordflow">if</span> (<a class="code" href="codec__g726_8c.html#a0dc068d63cb9df28d4b885bb7b5c5560">parse_config</a>(1))
<a name="l00844"></a>00844       <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;
<a name="l00845"></a>00845    <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a>;
<a name="l00846"></a>00846 }
<a name="l00847"></a>00847 
<a name="l00848"></a><a class="code" href="codec__g726_8c.html#ad09fa931f468002152a3cc2d5ce25eae">00848</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="agent_8c.html#a95bac1db604c69a01ef7b3995342cd7a">unload_module</a>(<span class="keywordtype">void</span>)
<a name="l00849"></a>00849 {
<a name="l00850"></a>00850    <span class="keywordtype">int</span> res = 0;
<a name="l00851"></a>00851 
<a name="l00852"></a>00852    res |= <a class="code" href="translate_8h.html#a3db4bb4ca3540f7d09a9d57e820dbe8a" title="Unregister a translator Unregisters the given tranlator.">ast_unregister_translator</a>(&amp;g726tolin);
<a name="l00853"></a>00853    res |= <a class="code" href="translate_8h.html#a3db4bb4ca3540f7d09a9d57e820dbe8a" title="Unregister a translator Unregisters the given tranlator.">ast_unregister_translator</a>(&amp;lintog726);
<a name="l00854"></a>00854 
<a name="l00855"></a>00855    res |= <a class="code" href="translate_8h.html#a3db4bb4ca3540f7d09a9d57e820dbe8a" title="Unregister a translator Unregisters the given tranlator.">ast_unregister_translator</a>(&amp;g726aal2tolin);
<a name="l00856"></a>00856    res |= <a class="code" href="translate_8h.html#a3db4bb4ca3540f7d09a9d57e820dbe8a" title="Unregister a translator Unregisters the given tranlator.">ast_unregister_translator</a>(&amp;lintog726aal2);
<a name="l00857"></a>00857 
<a name="l00858"></a>00858    <span class="keywordflow">return</span> res;
<a name="l00859"></a>00859 }
<a name="l00860"></a>00860 
<a name="l00861"></a><a class="code" href="codec__g726_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">00861</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="codec__g726_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a>(<span class="keywordtype">void</span>)
<a name="l00862"></a>00862 {
<a name="l00863"></a>00863    <span class="keywordtype">int</span> res = 0;
<a name="l00864"></a>00864 
<a name="l00865"></a>00865 
<a name="l00866"></a>00866    <span class="keywordflow">if</span> (<a class="code" href="codec__g726_8c.html#a0dc068d63cb9df28d4b885bb7b5c5560">parse_config</a>(0))
<a name="l00867"></a>00867       <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;
<a name="l00868"></a>00868 
<a name="l00869"></a>00869    res |= <a class="code" href="translate_8h.html#a2484bca30181b604502e9038a6fd06fe" title="See __ast_register_translator().">ast_register_translator</a>(&amp;g726tolin);
<a name="l00870"></a>00870    res |= <a class="code" href="translate_8h.html#a2484bca30181b604502e9038a6fd06fe" title="See __ast_register_translator().">ast_register_translator</a>(&amp;lintog726);
<a name="l00871"></a>00871 
<a name="l00872"></a>00872    res |= <a class="code" href="translate_8h.html#a2484bca30181b604502e9038a6fd06fe" title="See __ast_register_translator().">ast_register_translator</a>(&amp;g726aal2tolin);
<a name="l00873"></a>00873    res |= <a class="code" href="translate_8h.html#a2484bca30181b604502e9038a6fd06fe" title="See __ast_register_translator().">ast_register_translator</a>(&amp;lintog726aal2);
<a name="l00874"></a>00874 
<a name="l00875"></a>00875    <span class="keywordflow">if</span> (res) {
<a name="l00876"></a>00876       <a class="code" href="agent_8c.html#a95bac1db604c69a01ef7b3995342cd7a">unload_module</a>();
<a name="l00877"></a>00877       <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfa8724da3ad620df86524280e760add388">AST_MODULE_LOAD_FAILURE</a>;
<a name="l00878"></a>00878    }  
<a name="l00879"></a>00879 
<a name="l00880"></a>00880    <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a>;
<a name="l00881"></a>00881 }
<a name="l00882"></a>00882 
<a name="l00883"></a>00883 <a class="code" href="module_8h.html#a9f4aa0e21486bdbcef428335268690c9">AST_MODULE_INFO</a>(<a class="code" href="module_8h.html#aba2c8d4be709a254658b21a834f8294a" title="The text the key() function should return.">ASTERISK_GPL_KEY</a>, <a class="code" href="module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a54af2a9b29d140908cc9dffd0618951b">AST_MODFLAG_DEFAULT</a>, <span class="stringliteral">&quot;ITU G.726-32kbps G726 Transcoder&quot;</span>,
<a name="l00884"></a>00884       .load = <a class="code" href="codec__g726_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a>,
<a name="l00885"></a>00885       .unload = <a class="code" href="agent_8c.html#a95bac1db604c69a01ef7b3995342cd7a">unload_module</a>,
<a name="l00886"></a>00886       .<a class="code" href="codec__g726_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a> = <a class="code" href="codec__g726_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a>,
<a name="l00887"></a>00887           );
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:18:38 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
