<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:19:40 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_1ab815038f534adda65c8b4ae4993449.html">include</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_16d825f1fa9ecca2e70b1a8d9256d0e6.html">asterisk</a>
  </div>
</div>
<div class="contents">
<h1>audiohook.h File Reference</h1>
<p>Audiohooks Architecture.  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="lock_8h_source.html">asterisk/lock.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="linkedlists_8h_source.html">asterisk/linkedlists.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="slinfactory_8h_source.html">asterisk/slinfactory.h</a>&quot;</code><br/>

<p><a href="audiohook_8h_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__audiohook.html">ast_audiohook</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__audiohook__options.html">ast_audiohook_options</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="audiohook_8h.html#a6456e346fe813617f13d5bbf7e92db5a">ast_audiohook_lock</a>(ah)&nbsp;&nbsp;&nbsp;ast_mutex_lock(&amp;(ah)-&gt;<a class="el" href="res__timing__pthread_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Lock an audiohook.  <a href="#a6456e346fe813617f13d5bbf7e92db5a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="audiohook_8h.html#a4f988050ac148e5a281fc86313999be6">AST_AUDIOHOOK_SYNC_TOLERANCE</a>&nbsp;&nbsp;&nbsp;100</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="audiohook_8h.html#aae4ac794c0f7ab8decd713cb9c43acf4">ast_audiohook_unlock</a>(ah)&nbsp;&nbsp;&nbsp;ast_mutex_unlock(&amp;(ah)-&gt;<a class="el" href="res__timing__pthread_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Unlock an audiohook.  <a href="#aae4ac794c0f7ab8decd713cb9c43acf4"></a><br/></td></tr>
<tr><td colspan="2"><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef int(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="audiohook_8h.html#abc72b112b5e11d7e57ae6892b7431107">ast_audiohook_manipulate_callback</a> )(struct <a class="el" href="structast__audiohook.html">ast_audiohook</a> *audiohook, struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structast__frame.html">ast_frame</a> *frame, enum <a class="el" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899">ast_audiohook_direction</a> direction)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Callback function for manipulate audiohook type.  <a href="#abc72b112b5e11d7e57ae6892b7431107"></a><br/></td></tr>
<tr><td colspan="2"><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899">ast_audiohook_direction</a> { <a class="el" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899a56916f7012e7fe0ec9b6dd4e4c0e2a65">AST_AUDIOHOOK_DIRECTION_READ</a> =  0, 
<a class="el" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899a8254a5b3fc181d3fe3f2af892010b586">AST_AUDIOHOOK_DIRECTION_WRITE</a>, 
<a class="el" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899af84e1c36b65319be79e79b03c8f4a360">AST_AUDIOHOOK_DIRECTION_BOTH</a>
 }</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="audiohook_8h.html#a6d4c98ade1d3dd2e755ffb52b1106951">ast_audiohook_flags</a> { <br/>
&nbsp;&nbsp;<a class="el" href="audiohook_8h.html#a6d4c98ade1d3dd2e755ffb52b1106951a9114a8e97375acbc3a3202c2d75a9226">AST_AUDIOHOOK_TRIGGER_MODE</a> =  (3 &lt;&lt; 0), 
<a class="el" href="audiohook_8h.html#a6d4c98ade1d3dd2e755ffb52b1106951ae6f7d2c4b49d2585445408f917be7e6e">AST_AUDIOHOOK_TRIGGER_READ</a> =  (1 &lt;&lt; 0), 
<a class="el" href="audiohook_8h.html#a6d4c98ade1d3dd2e755ffb52b1106951af3c73a99c0171f1121551b38cee3d6c6">AST_AUDIOHOOK_TRIGGER_WRITE</a> =  (2 &lt;&lt; 0), 
<a class="el" href="audiohook_8h.html#a6d4c98ade1d3dd2e755ffb52b1106951a76af7a6555f4582850cfaef9d5391e32">AST_AUDIOHOOK_WANTS_DTMF</a> =  (1 &lt;&lt; 1), 
<br/>
&nbsp;&nbsp;<a class="el" href="audiohook_8h.html#a6d4c98ade1d3dd2e755ffb52b1106951afe01f1fbfa9f1096386a2c7905f2630e">AST_AUDIOHOOK_TRIGGER_SYNC</a> =  (1 &lt;&lt; 2), 
<a class="el" href="audiohook_8h.html#a6d4c98ade1d3dd2e755ffb52b1106951abffa78ee38fcba6555775cd6b5f46622">AST_AUDIOHOOK_SMALL_QUEUE</a> =  (1 &lt;&lt; 3)
<br/>
 }</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="audiohook_8h.html#acf2dd361123daa6446ade7c7ecfe55ad">ast_audiohook_status</a> { <a class="el" href="audiohook_8h.html#acf2dd361123daa6446ade7c7ecfe55adab303a4f550e2d8232d9803bf2d95f480">AST_AUDIOHOOK_STATUS_NEW</a> =  0, 
<a class="el" href="audiohook_8h.html#acf2dd361123daa6446ade7c7ecfe55adabcc7793ac9fbdcaa9e727aacfda27f26">AST_AUDIOHOOK_STATUS_RUNNING</a>, 
<a class="el" href="audiohook_8h.html#acf2dd361123daa6446ade7c7ecfe55adac1d3e44970c0af0ebd25b95f59b5cf57">AST_AUDIOHOOK_STATUS_SHUTDOWN</a>, 
<a class="el" href="audiohook_8h.html#acf2dd361123daa6446ade7c7ecfe55ada82b3db86f4b5d34ca212dfb6fec2db14">AST_AUDIOHOOK_STATUS_DONE</a>
 }</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="audiohook_8h.html#abce1d2faae234aa016905215014542b0">ast_audiohook_type</a> { <a class="el" href="audiohook_8h.html#abce1d2faae234aa016905215014542b0a29865bbf4732a7e78748db47b91e46f5">AST_AUDIOHOOK_TYPE_SPY</a> =  0, 
<a class="el" href="audiohook_8h.html#abce1d2faae234aa016905215014542b0aecdafbcdb7048512d25cd19089198edd">AST_AUDIOHOOK_TYPE_WHISPER</a>, 
<a class="el" href="audiohook_8h.html#abce1d2faae234aa016905215014542b0a20dda44508f42e63dc8ed45760affe08">AST_AUDIOHOOK_TYPE_MANIPULATE</a>
 }</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="audiohook_8h.html#a94abfad20db137f9d6a33f641d37ac31">ast_audiohook_attach</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structast__audiohook.html">ast_audiohook</a> *audiohook)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Attach audiohook to channel.  <a href="#a94abfad20db137f9d6a33f641d37ac31"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="audiohook_8h.html#a9fa661730d6fa6b9b12e410d66a3437b">ast_audiohook_destroy</a> (struct <a class="el" href="structast__audiohook.html">ast_audiohook</a> *audiohook)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Destroys an audiohook structure.  <a href="#a9fa661730d6fa6b9b12e410d66a3437b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="audiohook_8h.html#a88b9ad3730e7adbc3b396bef4e85b12a">ast_audiohook_detach</a> (struct <a class="el" href="structast__audiohook.html">ast_audiohook</a> *audiohook)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Detach audiohook from channel.  <a href="#a88b9ad3730e7adbc3b396bef4e85b12a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="audiohook_8h.html#a97fef5ce6c1baffe0051c8f8b70ad2f8">ast_audiohook_detach_list</a> (struct <a class="el" href="structast__audiohook__list.html">ast_audiohook_list</a> *audiohook_list)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Detach audiohooks from list and destroy said list.  <a href="#a97fef5ce6c1baffe0051c8f8b70ad2f8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="audiohook_8h.html#a34ed9fa0751083523ea90d1ad7c81fbf">ast_audiohook_detach_source</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *source)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Detach specified source audiohook from channel.  <a href="#a34ed9fa0751083523ea90d1ad7c81fbf"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="audiohook_8h.html#a94bd83e9f3444f406174971481b862c2">ast_audiohook_init</a> (struct <a class="el" href="structast__audiohook.html">ast_audiohook</a> *audiohook, enum <a class="el" href="audiohook_8h.html#abce1d2faae234aa016905215014542b0">ast_audiohook_type</a> <a class="el" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>, const char *source)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize an audiohook structure.  <a href="#a94bd83e9f3444f406174971481b862c2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="audiohook_8h.html#ae09727634eabe798d8abc95d46fa7b1e">ast_audiohook_move_by_source</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *old_chan, struct <a class="el" href="structast__channel.html">ast_channel</a> *new_chan, const char *source)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Move an audiohook from one channel to a new one.  <a href="#ae09727634eabe798d8abc95d46fa7b1e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="audiohook_8h.html#a0e5d69771f8bd48682ca3d40bc2111c2">ast_audiohook_read_frame</a> (struct <a class="el" href="structast__audiohook.html">ast_audiohook</a> *audiohook, size_t samples, enum <a class="el" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899">ast_audiohook_direction</a> direction, int <a class="el" href="chan__alsa_8c.html#a98f5e70e98f6dc48e3c5ba316066d540">format</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Reads a frame in from the audiohook structure.  <a href="#a0e5d69771f8bd48682ca3d40bc2111c2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="audiohook_8h.html#a34c80f85a6c8c76a4138323837c116d4">ast_audiohook_remove</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structast__audiohook.html">ast_audiohook</a> *audiohook)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Remove an audiohook from a specified channel.  <a href="#a34c80f85a6c8c76a4138323837c116d4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="audiohook_8h.html#a47bb160cbe5e534c0fca6560015ffe59">ast_audiohook_trigger_wait</a> (struct <a class="el" href="structast__audiohook.html">ast_audiohook</a> *audiohook)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Wait for audiohook trigger to be triggered.  <a href="#a47bb160cbe5e534c0fca6560015ffe59"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="audiohook_8h.html#a5f263b2006fa3bd3e9a96d4580d0125c">ast_audiohook_update_status</a> (struct <a class="el" href="structast__audiohook.html">ast_audiohook</a> *audiohook, enum <a class="el" href="audiohook_8h.html#acf2dd361123daa6446ade7c7ecfe55ad">ast_audiohook_status</a> <a class="el" href="app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Update audiohook's status.  <a href="#a5f263b2006fa3bd3e9a96d4580d0125c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="audiohook_8h.html#acf8f4fc0dfd6a5f54e301ac66c5bc434">ast_audiohook_volume_adjust</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, enum <a class="el" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899">ast_audiohook_direction</a> direction, int <a class="el" href="structvolume.html">volume</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Adjust the <a class="el" href="structvolume.html">volume</a> on frames read from or written to a channel.  <a href="#acf8f4fc0dfd6a5f54e301ac66c5bc434"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="audiohook_8h.html#a39f5dbdf5ef7a979d4ba48f9ee71a422">ast_audiohook_volume_get</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, enum <a class="el" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899">ast_audiohook_direction</a> direction)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Retrieve the <a class="el" href="structvolume.html">volume</a> adjustment value on frames read from or written to a channel.  <a href="#a39f5dbdf5ef7a979d4ba48f9ee71a422"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="audiohook_8h.html#ae042519f3d210ea48604952be74044a2">ast_audiohook_volume_set</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, enum <a class="el" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899">ast_audiohook_direction</a> direction, int <a class="el" href="structvolume.html">volume</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Adjust the <a class="el" href="structvolume.html">volume</a> on frames read from or written to a channel.  <a href="#ae042519f3d210ea48604952be74044a2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="audiohook_8h.html#a3391dbd95c95f041cf14fa30e0f5c73d">ast_audiohook_write_frame</a> (struct <a class="el" href="structast__audiohook.html">ast_audiohook</a> *audiohook, enum <a class="el" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899">ast_audiohook_direction</a> direction, struct <a class="el" href="structast__frame.html">ast_frame</a> *frame)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Writes a frame into the audiohook structure.  <a href="#a3391dbd95c95f041cf14fa30e0f5c73d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="audiohook_8h.html#a6351c89eb98b1832e85fa9c0fca7383f">ast_audiohook_write_list</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structast__audiohook__list.html">ast_audiohook_list</a> *audiohook_list, enum <a class="el" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899">ast_audiohook_direction</a> direction, struct <a class="el" href="structast__frame.html">ast_frame</a> *frame)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Pass a frame off to be handled by the audiohook core.  <a href="#a6351c89eb98b1832e85fa9c0fca7383f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="audiohook_8h.html#a86f07afe75e6c2405d124d98faaf9800">ast_channel_audiohook_count_by_source</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *source, enum <a class="el" href="audiohook_8h.html#abce1d2faae234aa016905215014542b0">ast_audiohook_type</a> <a class="el" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Find out how many audiohooks from a certain source exist on a given channel, regardless of status.  <a href="#a86f07afe75e6c2405d124d98faaf9800"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="audiohook_8h.html#a9c85bb250bc65d74fecce3a388ef30bd">ast_channel_audiohook_count_by_source_running</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *source, enum <a class="el" href="audiohook_8h.html#abce1d2faae234aa016905215014542b0">ast_audiohook_type</a> <a class="el" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Find out how many spies of a certain type exist on a given channel, and are in <a class="el" href="structstate.html">state</a> running.  <a href="#a9c85bb250bc65d74fecce3a388ef30bd"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Audiohooks Architecture. </p>

<p>Definition in file <a class="el" href="audiohook_8h_source.html">audiohook.h</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a6456e346fe813617f13d5bbf7e92db5a"></a><!-- doxytag: member="audiohook.h::ast_audiohook_lock" ref="a6456e346fe813617f13d5bbf7e92db5a" args="(ah)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ast_audiohook_lock</td>
          <td>(</td>
          <td class="paramtype">ah&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;ast_mutex_lock(&amp;(ah)-&gt;<a class="el" href="res__timing__pthread_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Lock an audiohook. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>ah</em>&nbsp;</td><td>Audiohook structure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="audiohook_8h_source.html#l00244">244</a> of file <a class="el" href="audiohook_8h_source.html">audiohook.h</a>.</p>

<p>Referenced by <a class="el" href="audiohook_8c_source.html#l00462">ast_audiohook_move_by_source()</a>, <a class="el" href="audiohook_8c_source.html#l00369">ast_audiohook_update_status()</a>, <a class="el" href="audiohook_8c_source.html#l00582">audio_audiohook_write_list()</a>, <a class="el" href="app__chanspy_8c_source.html#l00445">channel_spy()</a>, <a class="el" href="app__mixmonitor_8c_source.html#l00236">destroy_monitor_audiohook()</a>, <a class="el" href="audiohook_8c_source.html#l00553">dtmf_audiohook_write_list()</a>, <a class="el" href="app__mixmonitor_8c_source.html#l00280">mixmonitor_thread()</a>, <a class="el" href="app__chanspy_8c_source.html#l00361">spy_generate()</a>, and <a class="el" href="app__mixmonitor_8c_source.html#l00550">stop_mixmonitor_exec()</a>.</p>

</div>
</div>
<a class="anchor" id="a4f988050ac148e5a281fc86313999be6"></a><!-- doxytag: member="audiohook.h::AST_AUDIOHOOK_SYNC_TOLERANCE" ref="a4f988050ac148e5a281fc86313999be6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_AUDIOHOOK_SYNC_TOLERANCE&nbsp;&nbsp;&nbsp;100</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="audiohook_8h_source.html#l00067">67</a> of file <a class="el" href="audiohook_8h_source.html">audiohook.h</a>.</p>

<p>Referenced by <a class="el" href="audiohook_8c_source.html#l00121">ast_audiohook_write_frame()</a>.</p>

</div>
</div>
<a class="anchor" id="aae4ac794c0f7ab8decd713cb9c43acf4"></a><!-- doxytag: member="audiohook.h::ast_audiohook_unlock" ref="aae4ac794c0f7ab8decd713cb9c43acf4" args="(ah)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ast_audiohook_unlock</td>
          <td>(</td>
          <td class="paramtype">ah&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;ast_mutex_unlock(&amp;(ah)-&gt;<a class="el" href="res__timing__pthread_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Unlock an audiohook. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>ah</em>&nbsp;</td><td>Audiohook structure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="audiohook_8h_source.html#l00249">249</a> of file <a class="el" href="audiohook_8h_source.html">audiohook.h</a>.</p>

<p>Referenced by <a class="el" href="audiohook_8c_source.html#l00462">ast_audiohook_move_by_source()</a>, <a class="el" href="audiohook_8c_source.html#l00369">ast_audiohook_update_status()</a>, <a class="el" href="audiohook_8c_source.html#l00582">audio_audiohook_write_list()</a>, <a class="el" href="app__chanspy_8c_source.html#l00445">channel_spy()</a>, <a class="el" href="app__mixmonitor_8c_source.html#l00236">destroy_monitor_audiohook()</a>, <a class="el" href="audiohook_8c_source.html#l00553">dtmf_audiohook_write_list()</a>, <a class="el" href="app__mixmonitor_8c_source.html#l00280">mixmonitor_thread()</a>, <a class="el" href="app__chanspy_8c_source.html#l00361">spy_generate()</a>, and <a class="el" href="app__mixmonitor_8c_source.html#l00550">stop_mixmonitor_exec()</a>.</p>

</div>
</div>
<hr/><h2>Typedef Documentation</h2>
<a class="anchor" id="abc72b112b5e11d7e57ae6892b7431107"></a><!-- doxytag: member="audiohook.h::ast_audiohook_manipulate_callback" ref="abc72b112b5e11d7e57ae6892b7431107" args=")(struct ast_audiohook *audiohook, struct ast_channel *chan, struct ast_frame *frame, enum ast_audiohook_direction direction)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef int(* <a class="el" href="audiohook_8h.html#abc72b112b5e11d7e57ae6892b7431107">ast_audiohook_manipulate_callback</a>)(struct <a class="el" href="structast__audiohook.html">ast_audiohook</a> *audiohook, struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structast__frame.html">ast_frame</a> *frame, enum <a class="el" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899">ast_audiohook_direction</a> direction)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Callback function for manipulate audiohook type. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>audiohook</em>&nbsp;</td><td>Audiohook structure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>frame</em>&nbsp;</td><td>Frame of audio to manipulate </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>direction</em>&nbsp;</td><td>Direction frame came from </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns 0 on success, -1 on failure </dd></dl>
<dl class="note"><dt><b>Note:</b></dt><dd>An audiohook does not have any reference to a private data structure for manipulate types. It is up to the manipulate callback to store this data via it's own method. An example would be datastores. </dd></dl>

<p>Definition at line <a class="el" href="audiohook_8h_source.html#l00080">80</a> of file <a class="el" href="audiohook_8h_source.html">audiohook.h</a>.</p>

</div>
</div>
<hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="a34d75d3d5e7418b6a772e3d522a16899"></a><!-- doxytag: member="audiohook.h::ast_audiohook_direction" ref="a34d75d3d5e7418b6a772e3d522a16899" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899">ast_audiohook_direction</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a34d75d3d5e7418b6a772e3d522a16899a56916f7012e7fe0ec9b6dd4e4c0e2a65"></a><!-- doxytag: member="AST_AUDIOHOOK_DIRECTION_READ" ref="a34d75d3d5e7418b6a772e3d522a16899a56916f7012e7fe0ec9b6dd4e4c0e2a65" args="" -->AST_AUDIOHOOK_DIRECTION_READ</em>&nbsp;</td><td>
<p>Reading audio in </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a34d75d3d5e7418b6a772e3d522a16899a8254a5b3fc181d3fe3f2af892010b586"></a><!-- doxytag: member="AST_AUDIOHOOK_DIRECTION_WRITE" ref="a34d75d3d5e7418b6a772e3d522a16899a8254a5b3fc181d3fe3f2af892010b586" args="" -->AST_AUDIOHOOK_DIRECTION_WRITE</em>&nbsp;</td><td>
<p>Writing audio out </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a34d75d3d5e7418b6a772e3d522a16899af84e1c36b65319be79e79b03c8f4a360"></a><!-- doxytag: member="AST_AUDIOHOOK_DIRECTION_BOTH" ref="a34d75d3d5e7418b6a772e3d522a16899af84e1c36b65319be79e79b03c8f4a360" args="" -->AST_AUDIOHOOK_DIRECTION_BOTH</em>&nbsp;</td><td>
<p>Both reading audio in and writing audio out </p>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="audiohook_8h_source.html#l00049">49</a> of file <a class="el" href="audiohook_8h_source.html">audiohook.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00049"></a>00049                              {
<a name="l00050"></a>00050    <a class="code" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899a56916f7012e7fe0ec9b6dd4e4c0e2a65">AST_AUDIOHOOK_DIRECTION_READ</a> = 0, <span class="comment">/*!&lt; Reading audio in */</span>
<a name="l00051"></a>00051    <a class="code" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899a8254a5b3fc181d3fe3f2af892010b586">AST_AUDIOHOOK_DIRECTION_WRITE</a>,    <span class="comment">/*!&lt; Writing audio out */</span>
<a name="l00052"></a>00052    <a class="code" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899af84e1c36b65319be79e79b03c8f4a360">AST_AUDIOHOOK_DIRECTION_BOTH</a>,     <span class="comment">/*!&lt; Both reading audio in and writing audio out */</span>
<a name="l00053"></a>00053 };
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6d4c98ade1d3dd2e755ffb52b1106951"></a><!-- doxytag: member="audiohook.h::ast_audiohook_flags" ref="a6d4c98ade1d3dd2e755ffb52b1106951" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="audiohook_8h.html#a6d4c98ade1d3dd2e755ffb52b1106951">ast_audiohook_flags</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a6d4c98ade1d3dd2e755ffb52b1106951a9114a8e97375acbc3a3202c2d75a9226"></a><!-- doxytag: member="AST_AUDIOHOOK_TRIGGER_MODE" ref="a6d4c98ade1d3dd2e755ffb52b1106951a9114a8e97375acbc3a3202c2d75a9226" args="" -->AST_AUDIOHOOK_TRIGGER_MODE</em>&nbsp;</td><td>
<p>When audiohook should be triggered to do something </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a6d4c98ade1d3dd2e755ffb52b1106951ae6f7d2c4b49d2585445408f917be7e6e"></a><!-- doxytag: member="AST_AUDIOHOOK_TRIGGER_READ" ref="a6d4c98ade1d3dd2e755ffb52b1106951ae6f7d2c4b49d2585445408f917be7e6e" args="" -->AST_AUDIOHOOK_TRIGGER_READ</em>&nbsp;</td><td>
<p>Audiohook wants to be triggered when reading audio in </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a6d4c98ade1d3dd2e755ffb52b1106951af3c73a99c0171f1121551b38cee3d6c6"></a><!-- doxytag: member="AST_AUDIOHOOK_TRIGGER_WRITE" ref="a6d4c98ade1d3dd2e755ffb52b1106951af3c73a99c0171f1121551b38cee3d6c6" args="" -->AST_AUDIOHOOK_TRIGGER_WRITE</em>&nbsp;</td><td>
<p>Audiohook wants to be triggered when writing audio out </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a6d4c98ade1d3dd2e755ffb52b1106951a76af7a6555f4582850cfaef9d5391e32"></a><!-- doxytag: member="AST_AUDIOHOOK_WANTS_DTMF" ref="a6d4c98ade1d3dd2e755ffb52b1106951a76af7a6555f4582850cfaef9d5391e32" args="" -->AST_AUDIOHOOK_WANTS_DTMF</em>&nbsp;</td><td>
<p>Audiohook also wants to receive DTMF frames </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a6d4c98ade1d3dd2e755ffb52b1106951afe01f1fbfa9f1096386a2c7905f2630e"></a><!-- doxytag: member="AST_AUDIOHOOK_TRIGGER_SYNC" ref="a6d4c98ade1d3dd2e755ffb52b1106951afe01f1fbfa9f1096386a2c7905f2630e" args="" -->AST_AUDIOHOOK_TRIGGER_SYNC</em>&nbsp;</td><td>
<p>Audiohook wants to be triggered when both sides have combined audio available </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a6d4c98ade1d3dd2e755ffb52b1106951abffa78ee38fcba6555775cd6b5f46622"></a><!-- doxytag: member="AST_AUDIOHOOK_SMALL_QUEUE" ref="a6d4c98ade1d3dd2e755ffb52b1106951abffa78ee38fcba6555775cd6b5f46622" args="" -->AST_AUDIOHOOK_SMALL_QUEUE</em>&nbsp;</td><td>
<p>Audiohooks with this flag set will not allow for a large amount of samples to build up on its slinfactories. We will flush the factories if they contain too many samples. </p>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="audiohook_8h_source.html#l00055">55</a> of file <a class="el" href="audiohook_8h_source.html">audiohook.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00055"></a>00055                          {
<a name="l00056"></a>00056    <a class="code" href="audiohook_8h.html#a6d4c98ade1d3dd2e755ffb52b1106951a9114a8e97375acbc3a3202c2d75a9226">AST_AUDIOHOOK_TRIGGER_MODE</a> = (3 &lt;&lt; 0),  <span class="comment">/*!&lt; When audiohook should be triggered to do something */</span>
<a name="l00057"></a>00057    <a class="code" href="audiohook_8h.html#a6d4c98ade1d3dd2e755ffb52b1106951ae6f7d2c4b49d2585445408f917be7e6e">AST_AUDIOHOOK_TRIGGER_READ</a> = (1 &lt;&lt; 0),  <span class="comment">/*!&lt; Audiohook wants to be triggered when reading audio in */</span>
<a name="l00058"></a>00058    <a class="code" href="audiohook_8h.html#a6d4c98ade1d3dd2e755ffb52b1106951af3c73a99c0171f1121551b38cee3d6c6">AST_AUDIOHOOK_TRIGGER_WRITE</a> = (2 &lt;&lt; 0), <span class="comment">/*!&lt; Audiohook wants to be triggered when writing audio out */</span>
<a name="l00059"></a>00059    <a class="code" href="audiohook_8h.html#a6d4c98ade1d3dd2e755ffb52b1106951a76af7a6555f4582850cfaef9d5391e32">AST_AUDIOHOOK_WANTS_DTMF</a> = (1 &lt;&lt; 1),    <span class="comment">/*!&lt; Audiohook also wants to receive DTMF frames */</span>
<a name="l00060"></a>00060    <a class="code" href="audiohook_8h.html#a6d4c98ade1d3dd2e755ffb52b1106951afe01f1fbfa9f1096386a2c7905f2630e">AST_AUDIOHOOK_TRIGGER_SYNC</a> = (1 &lt;&lt; 2),  <span class="comment">/*!&lt; Audiohook wants to be triggered when both sides have combined audio available */</span><span class="comment"></span>
<a name="l00061"></a>00061 <span class="comment">   /*! Audiohooks with this flag set will not allow for a large amount of samples to build up on its</span>
<a name="l00062"></a>00062 <span class="comment">    * slinfactories. We will flush the factories if they contain too many samples.</span>
<a name="l00063"></a>00063 <span class="comment">    */</span>
<a name="l00064"></a>00064    <a class="code" href="audiohook_8h.html#a6d4c98ade1d3dd2e755ffb52b1106951abffa78ee38fcba6555775cd6b5f46622">AST_AUDIOHOOK_SMALL_QUEUE</a> = (1 &lt;&lt; 3),
<a name="l00065"></a>00065 };
</pre></div></p>

</div>
</div>
<a class="anchor" id="acf2dd361123daa6446ade7c7ecfe55ad"></a><!-- doxytag: member="audiohook.h::ast_audiohook_status" ref="acf2dd361123daa6446ade7c7ecfe55ad" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="audiohook_8h.html#acf2dd361123daa6446ade7c7ecfe55ad">ast_audiohook_status</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="acf2dd361123daa6446ade7c7ecfe55adab303a4f550e2d8232d9803bf2d95f480"></a><!-- doxytag: member="AST_AUDIOHOOK_STATUS_NEW" ref="acf2dd361123daa6446ade7c7ecfe55adab303a4f550e2d8232d9803bf2d95f480" args="" -->AST_AUDIOHOOK_STATUS_NEW</em>&nbsp;</td><td>
<p>Audiohook was just created, not in use yet </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="acf2dd361123daa6446ade7c7ecfe55adabcc7793ac9fbdcaa9e727aacfda27f26"></a><!-- doxytag: member="AST_AUDIOHOOK_STATUS_RUNNING" ref="acf2dd361123daa6446ade7c7ecfe55adabcc7793ac9fbdcaa9e727aacfda27f26" args="" -->AST_AUDIOHOOK_STATUS_RUNNING</em>&nbsp;</td><td>
<p>Audiohook is running on a channel </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="acf2dd361123daa6446ade7c7ecfe55adac1d3e44970c0af0ebd25b95f59b5cf57"></a><!-- doxytag: member="AST_AUDIOHOOK_STATUS_SHUTDOWN" ref="acf2dd361123daa6446ade7c7ecfe55adac1d3e44970c0af0ebd25b95f59b5cf57" args="" -->AST_AUDIOHOOK_STATUS_SHUTDOWN</em>&nbsp;</td><td>
<p>Audiohook is being shutdown </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="acf2dd361123daa6446ade7c7ecfe55ada82b3db86f4b5d34ca212dfb6fec2db14"></a><!-- doxytag: member="AST_AUDIOHOOK_STATUS_DONE" ref="acf2dd361123daa6446ade7c7ecfe55ada82b3db86f4b5d34ca212dfb6fec2db14" args="" -->AST_AUDIOHOOK_STATUS_DONE</em>&nbsp;</td><td>
<p>Audiohook has shutdown and is not running on a channel any longer </p>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="audiohook_8h_source.html#l00042">42</a> of file <a class="el" href="audiohook_8h_source.html">audiohook.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00042"></a>00042                           {
<a name="l00043"></a>00043    <a class="code" href="audiohook_8h.html#acf2dd361123daa6446ade7c7ecfe55adab303a4f550e2d8232d9803bf2d95f480">AST_AUDIOHOOK_STATUS_NEW</a> = 0,  <span class="comment">/*!&lt; Audiohook was just created, not in use yet */</span>
<a name="l00044"></a>00044    <a class="code" href="audiohook_8h.html#acf2dd361123daa6446ade7c7ecfe55adabcc7793ac9fbdcaa9e727aacfda27f26">AST_AUDIOHOOK_STATUS_RUNNING</a>,  <span class="comment">/*!&lt; Audiohook is running on a channel */</span>
<a name="l00045"></a>00045    <a class="code" href="audiohook_8h.html#acf2dd361123daa6446ade7c7ecfe55adac1d3e44970c0af0ebd25b95f59b5cf57">AST_AUDIOHOOK_STATUS_SHUTDOWN</a>, <span class="comment">/*!&lt; Audiohook is being shutdown */</span>
<a name="l00046"></a>00046    <a class="code" href="audiohook_8h.html#acf2dd361123daa6446ade7c7ecfe55ada82b3db86f4b5d34ca212dfb6fec2db14">AST_AUDIOHOOK_STATUS_DONE</a>,     <span class="comment">/*!&lt; Audiohook has shutdown and is not running on a channel any longer */</span>
<a name="l00047"></a>00047 };
</pre></div></p>

</div>
</div>
<a class="anchor" id="abce1d2faae234aa016905215014542b0"></a><!-- doxytag: member="audiohook.h::ast_audiohook_type" ref="abce1d2faae234aa016905215014542b0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="audiohook_8h.html#abce1d2faae234aa016905215014542b0">ast_audiohook_type</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="abce1d2faae234aa016905215014542b0a29865bbf4732a7e78748db47b91e46f5"></a><!-- doxytag: member="AST_AUDIOHOOK_TYPE_SPY" ref="abce1d2faae234aa016905215014542b0a29865bbf4732a7e78748db47b91e46f5" args="" -->AST_AUDIOHOOK_TYPE_SPY</em>&nbsp;</td><td>
<p>Audiohook wants to receive audio </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="abce1d2faae234aa016905215014542b0aecdafbcdb7048512d25cd19089198edd"></a><!-- doxytag: member="AST_AUDIOHOOK_TYPE_WHISPER" ref="abce1d2faae234aa016905215014542b0aecdafbcdb7048512d25cd19089198edd" args="" -->AST_AUDIOHOOK_TYPE_WHISPER</em>&nbsp;</td><td>
<p>Audiohook wants to provide audio to be mixed with existing audio </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="abce1d2faae234aa016905215014542b0a20dda44508f42e63dc8ed45760affe08"></a><!-- doxytag: member="AST_AUDIOHOOK_TYPE_MANIPULATE" ref="abce1d2faae234aa016905215014542b0a20dda44508f42e63dc8ed45760affe08" args="" -->AST_AUDIOHOOK_TYPE_MANIPULATE</em>&nbsp;</td><td>
<p>Audiohook wants to manipulate the audio </p>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="audiohook_8h_source.html#l00036">36</a> of file <a class="el" href="audiohook_8h_source.html">audiohook.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00036"></a>00036                         {
<a name="l00037"></a>00037    <a class="code" href="audiohook_8h.html#abce1d2faae234aa016905215014542b0a29865bbf4732a7e78748db47b91e46f5">AST_AUDIOHOOK_TYPE_SPY</a> = 0,    <span class="comment">/*!&lt; Audiohook wants to receive audio */</span>
<a name="l00038"></a>00038    <a class="code" href="audiohook_8h.html#abce1d2faae234aa016905215014542b0aecdafbcdb7048512d25cd19089198edd">AST_AUDIOHOOK_TYPE_WHISPER</a>,    <span class="comment">/*!&lt; Audiohook wants to provide audio to be mixed with existing audio */</span>
<a name="l00039"></a>00039    <a class="code" href="audiohook_8h.html#abce1d2faae234aa016905215014542b0a20dda44508f42e63dc8ed45760affe08">AST_AUDIOHOOK_TYPE_MANIPULATE</a>, <span class="comment">/*!&lt; Audiohook wants to manipulate the audio */</span>
<a name="l00040"></a>00040 };
</pre></div></p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a94abfad20db137f9d6a33f641d37ac31"></a><!-- doxytag: member="audiohook.h::ast_audiohook_attach" ref="a94abfad20db137f9d6a33f641d37ac31" args="(struct ast_channel *chan, struct ast_audiohook *audiohook)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_audiohook_attach </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__audiohook.html">ast_audiohook</a> *&nbsp;</td>
          <td class="paramname"> <em>audiohook</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Attach audiohook to channel. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>audiohook</em>&nbsp;</td><td>Audiohook structure </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns 0 on success, -1 on failure </dd></dl>

<p>Definition at line <a class="el" href="audiohook_8c_source.html#l00330">330</a> of file <a class="el" href="audiohook_8c_source.html">audiohook.c</a>.</p>

<p>References <a class="el" href="audiohook_8h_source.html#l00044">AST_AUDIOHOOK_STATUS_RUNNING</a>, <a class="el" href="audiohook_8h_source.html#l00039">AST_AUDIOHOOK_TYPE_MANIPULATE</a>, <a class="el" href="audiohook_8h_source.html#l00037">AST_AUDIOHOOK_TYPE_SPY</a>, <a class="el" href="audiohook_8h_source.html#l00038">AST_AUDIOHOOK_TYPE_WHISPER</a>, <a class="el" href="audiohook_8c_source.html#l00369">ast_audiohook_update_status()</a>, <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="linkedlists_8h_source.html#l00665">AST_LIST_HEAD_INIT_NOLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00715">AST_LIST_INSERT_TAIL</a>, <a class="el" href="channel_8h_source.html#l00421">ast_channel::audiohooks</a>, <a class="el" href="structast__audiohook__list.html#acdea2991ba0b3828e72ba3d936aa33dd">ast_audiohook_list::manipulate_list</a>, <a class="el" href="structast__audiohook__list.html#ab1b7108d32768b87015db450e753302c">ast_audiohook_list::spy_list</a>, <a class="el" href="audiohook_8h_source.html#l00090">ast_audiohook::type</a>, and <a class="el" href="structast__audiohook__list.html#a463b768292e522f67f80733d5dc1c5e0">ast_audiohook_list::whisper_list</a>.</p>

<p>Referenced by <a class="el" href="audiohook_8c_source.html#l00462">ast_audiohook_move_by_source()</a>, <a class="el" href="audiohook_8c_source.html#l00893">audiohook_volume_get()</a>, <a class="el" href="app__jack_8c_source.html#l00859">enable_jack_hook()</a>, <a class="el" href="func__speex_8c_source.html#l00194">speex_write()</a>, <a class="el" href="app__chanspy_8c_source.html#l00409">start_spying()</a>, <a class="el" href="app__mixmonitor_8c_source.html#l00250">startmon()</a>, and <a class="el" href="func__volume_8c_source.html#l00121">volume_write()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00331"></a>00331 {
<a name="l00332"></a>00332    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l00333"></a>00333 
<a name="l00334"></a>00334    <span class="keywordflow">if</span> (!chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>) {
<a name="l00335"></a>00335       <span class="comment">/* Whoops... allocate a new structure */</span>
<a name="l00336"></a>00336       <span class="keywordflow">if</span> (!(chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a> = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>)))) {
<a name="l00337"></a>00337          <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l00338"></a>00338          <span class="keywordflow">return</span> -1;
<a name="l00339"></a>00339       }
<a name="l00340"></a>00340       <a class="code" href="linkedlists_8h.html#a0d1f922e093ac18824a7863fe3f5fa27" title="Initializes a list head structure.">AST_LIST_HEAD_INIT_NOLOCK</a>(&amp;chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>-&gt;<a class="code" href="structast__audiohook__list.html#ab1b7108d32768b87015db450e753302c">spy_list</a>);
<a name="l00341"></a>00341       <a class="code" href="linkedlists_8h.html#a0d1f922e093ac18824a7863fe3f5fa27" title="Initializes a list head structure.">AST_LIST_HEAD_INIT_NOLOCK</a>(&amp;chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>-&gt;<a class="code" href="structast__audiohook__list.html#a463b768292e522f67f80733d5dc1c5e0">whisper_list</a>);
<a name="l00342"></a>00342       <a class="code" href="linkedlists_8h.html#a0d1f922e093ac18824a7863fe3f5fa27" title="Initializes a list head structure.">AST_LIST_HEAD_INIT_NOLOCK</a>(&amp;chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>-&gt;<a class="code" href="structast__audiohook__list.html#acdea2991ba0b3828e72ba3d936aa33dd">manipulate_list</a>);
<a name="l00343"></a>00343    }
<a name="l00344"></a>00344 
<a name="l00345"></a>00345    <span class="comment">/* Drop into respective list */</span>
<a name="l00346"></a>00346    <span class="keywordflow">if</span> (audiohook-&gt;<a class="code" href="structast__audiohook.html#a2ad9abd9447a1c58bfe6b03e05f98335">type</a> == <a class="code" href="audiohook_8h.html#abce1d2faae234aa016905215014542b0a29865bbf4732a7e78748db47b91e46f5">AST_AUDIOHOOK_TYPE_SPY</a>)
<a name="l00347"></a>00347       <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(&amp;chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>-&gt;<a class="code" href="structast__audiohook__list.html#ab1b7108d32768b87015db450e753302c">spy_list</a>, audiohook, list);
<a name="l00348"></a>00348    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (audiohook-&gt;<a class="code" href="structast__audiohook.html#a2ad9abd9447a1c58bfe6b03e05f98335">type</a> == <a class="code" href="audiohook_8h.html#abce1d2faae234aa016905215014542b0aecdafbcdb7048512d25cd19089198edd">AST_AUDIOHOOK_TYPE_WHISPER</a>)
<a name="l00349"></a>00349       <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(&amp;chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>-&gt;<a class="code" href="structast__audiohook__list.html#a463b768292e522f67f80733d5dc1c5e0">whisper_list</a>, audiohook, list);
<a name="l00350"></a>00350    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (audiohook-&gt;<a class="code" href="structast__audiohook.html#a2ad9abd9447a1c58bfe6b03e05f98335">type</a> == <a class="code" href="audiohook_8h.html#abce1d2faae234aa016905215014542b0a20dda44508f42e63dc8ed45760affe08">AST_AUDIOHOOK_TYPE_MANIPULATE</a>)
<a name="l00351"></a>00351       <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(&amp;chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>-&gt;<a class="code" href="structast__audiohook__list.html#acdea2991ba0b3828e72ba3d936aa33dd">manipulate_list</a>, audiohook, list);
<a name="l00352"></a>00352 
<a name="l00353"></a>00353    <span class="comment">/* Change status over to running since it is now attached */</span>
<a name="l00354"></a>00354    <a class="code" href="audiohook_8h.html#a5f263b2006fa3bd3e9a96d4580d0125c" title="Update audiohook&amp;#39;s status.">ast_audiohook_update_status</a>(audiohook, <a class="code" href="audiohook_8h.html#acf2dd361123daa6446ade7c7ecfe55adabcc7793ac9fbdcaa9e727aacfda27f26">AST_AUDIOHOOK_STATUS_RUNNING</a>);
<a name="l00355"></a>00355 
<a name="l00356"></a>00356    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l00357"></a>00357 
<a name="l00358"></a>00358    <span class="keywordflow">return</span> 0;
<a name="l00359"></a>00359 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9fa661730d6fa6b9b12e410d66a3437b"></a><!-- doxytag: member="audiohook.h::ast_audiohook_destroy" ref="a9fa661730d6fa6b9b12e410d66a3437b" args="(struct ast_audiohook *audiohook)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_audiohook_destroy </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__audiohook.html">ast_audiohook</a> *&nbsp;</td>
          <td class="paramname"> <em>audiohook</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Destroys an audiohook structure. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>audiohook</em>&nbsp;</td><td>Audiohook structure </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns 0 on success, -1 on failure </dd></dl>

<p>Definition at line <a class="el" href="audiohook_8c_source.html#l00091">91</a> of file <a class="el" href="audiohook_8c_source.html">audiohook.c</a>.</p>

<p>References <a class="el" href="audiohook_8h_source.html#l00037">AST_AUDIOHOOK_TYPE_SPY</a>, <a class="el" href="audiohook_8h_source.html#l00038">AST_AUDIOHOOK_TYPE_WHISPER</a>, <a class="el" href="lock_8h_source.html#l01744">ast_cond_destroy()</a>, <a class="el" href="lock_8h_source.html#l01712">ast_mutex_destroy()</a>, <a class="el" href="slinfactory_8c_source.html#l00060">ast_slinfactory_destroy()</a>, <a class="el" href="translate_8c_source.html#l00253">ast_translator_free_path()</a>, <a class="el" href="audiohook_8h_source.html#l00088">ast_audiohook::lock</a>, <a class="el" href="audiohook_8h_source.html#l00094">ast_audiohook::read_factory</a>, <a class="el" href="audiohook_8h_source.html#l00099">ast_audiohook::trans_pvt</a>, <a class="el" href="audiohook_8h_source.html#l00089">ast_audiohook::trigger</a>, <a class="el" href="audiohook_8h_source.html#l00090">ast_audiohook::type</a>, and <a class="el" href="audiohook_8h_source.html#l00095">ast_audiohook::write_factory</a>.</p>

<p>Referenced by <a class="el" href="audiohook_8c_source.html#l00829">audiohook_volume_destroy()</a>, <a class="el" href="app__chanspy_8c_source.html#l00445">channel_spy()</a>, <a class="el" href="func__speex_8c_source.html#l00110">destroy_callback()</a>, <a class="el" href="app__jack_8c_source.html#l00340">destroy_jack_data()</a>, <a class="el" href="app__mixmonitor_8c_source.html#l00236">destroy_monitor_audiohook()</a>, and <a class="el" href="app__mixmonitor_8c_source.html#l00398">launch_monitor_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00092"></a>00092 {
<a name="l00093"></a>00093    <span class="comment">/* Drop the factories used by this audiohook type */</span>
<a name="l00094"></a>00094    <span class="keywordflow">switch</span> (audiohook-&gt;<a class="code" href="structast__audiohook.html#a2ad9abd9447a1c58bfe6b03e05f98335">type</a>) {
<a name="l00095"></a>00095    <span class="keywordflow">case</span> <a class="code" href="audiohook_8h.html#abce1d2faae234aa016905215014542b0a29865bbf4732a7e78748db47b91e46f5">AST_AUDIOHOOK_TYPE_SPY</a>:
<a name="l00096"></a>00096       <a class="code" href="slinfactory_8h.html#ab5361491bac02fb60732df5671879652" title="Destroy the contents of a slinfactory.">ast_slinfactory_destroy</a>(&amp;audiohook-&gt;<a class="code" href="structast__audiohook.html#a72d12418b888e36b3d47a7703d2edced">read_factory</a>);
<a name="l00097"></a>00097    <span class="keywordflow">case</span> <a class="code" href="audiohook_8h.html#abce1d2faae234aa016905215014542b0aecdafbcdb7048512d25cd19089198edd">AST_AUDIOHOOK_TYPE_WHISPER</a>:
<a name="l00098"></a>00098       <a class="code" href="slinfactory_8h.html#ab5361491bac02fb60732df5671879652" title="Destroy the contents of a slinfactory.">ast_slinfactory_destroy</a>(&amp;audiohook-&gt;<a class="code" href="structast__audiohook.html#aecd1ea17a6f1a4cc3bf683296792b262">write_factory</a>);
<a name="l00099"></a>00099       <span class="keywordflow">break</span>;
<a name="l00100"></a>00100    <span class="keywordflow">default</span>:
<a name="l00101"></a>00101       <span class="keywordflow">break</span>;
<a name="l00102"></a>00102    }
<a name="l00103"></a>00103 
<a name="l00104"></a>00104    <span class="comment">/* Destroy translation path if present */</span>
<a name="l00105"></a>00105    <span class="keywordflow">if</span> (audiohook-&gt;<a class="code" href="structast__audiohook.html#a747ca6507654d33f73cf289e8172a5dd">trans_pvt</a>)
<a name="l00106"></a>00106       <a class="code" href="translate_8h.html#a8f767bf5c2095f182e7cbaa73e391207" title="Frees a translator path Frees the given translator path structure.">ast_translator_free_path</a>(audiohook-&gt;<a class="code" href="structast__audiohook.html#a747ca6507654d33f73cf289e8172a5dd">trans_pvt</a>);
<a name="l00107"></a>00107 
<a name="l00108"></a>00108    <span class="comment">/* Lock and trigger be gone! */</span>
<a name="l00109"></a>00109    <a class="code" href="lock_8h.html#a7752bcadc38f1d7a7a8528c538569115">ast_cond_destroy</a>(&amp;audiohook-&gt;<a class="code" href="structast__audiohook.html#a1730983172cdc5373cf60e0e40294fb0">trigger</a>);
<a name="l00110"></a>00110    <a class="code" href="lock_8h.html#ab237e70b569019bfb490ab0c3c09b8c5">ast_mutex_destroy</a>(&amp;audiohook-&gt;<a class="code" href="structast__audiohook.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00111"></a>00111 
<a name="l00112"></a>00112    <span class="keywordflow">return</span> 0;
<a name="l00113"></a>00113 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a88b9ad3730e7adbc3b396bef4e85b12a"></a><!-- doxytag: member="audiohook.h::ast_audiohook_detach" ref="a88b9ad3730e7adbc3b396bef4e85b12a" args="(struct ast_audiohook *audiohook)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_audiohook_detach </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__audiohook.html">ast_audiohook</a> *&nbsp;</td>
          <td class="paramname"> <em>audiohook</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Detach audiohook from channel. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>audiohook</em>&nbsp;</td><td>Audiohook structure </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns 0 on success, -1 on failure </dd></dl>

<p>Definition at line <a class="el" href="audiohook_8c_source.html#l00383">383</a> of file <a class="el" href="audiohook_8c_source.html">audiohook.c</a>.</p>

<p>References <a class="el" href="audiohook_8h_source.html#l00046">AST_AUDIOHOOK_STATUS_DONE</a>, <a class="el" href="audiohook_8h_source.html#l00043">AST_AUDIOHOOK_STATUS_NEW</a>, <a class="el" href="audiohook_8h_source.html#l00045">AST_AUDIOHOOK_STATUS_SHUTDOWN</a>, <a class="el" href="audiohook_8c_source.html#l00725">ast_audiohook_trigger_wait()</a>, <a class="el" href="audiohook_8c_source.html#l00369">ast_audiohook_update_status()</a>, and <a class="el" href="audiohook_8h_source.html#l00091">ast_audiohook::status</a>.</p>

<p>Referenced by <a class="el" href="app__chanspy_8c_source.html#l00445">channel_spy()</a>, <a class="el" href="app__mixmonitor_8c_source.html#l00236">destroy_monitor_audiohook()</a>, <a class="el" href="app__jack_8c_source.html#l00920">disable_jack_hook()</a>, and <a class="el" href="func__speex_8c_source.html#l00194">speex_write()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00384"></a>00384 {
<a name="l00385"></a>00385    <span class="keywordflow">if</span> (audiohook-&gt;<a class="code" href="structast__audiohook.html#a9c2c1a66c786d5e486ac428388d62e28">status</a> == <a class="code" href="audiohook_8h.html#acf2dd361123daa6446ade7c7ecfe55adab303a4f550e2d8232d9803bf2d95f480">AST_AUDIOHOOK_STATUS_NEW</a> || audiohook-&gt;<a class="code" href="structast__audiohook.html#a9c2c1a66c786d5e486ac428388d62e28">status</a> == <a class="code" href="audiohook_8h.html#acf2dd361123daa6446ade7c7ecfe55ada82b3db86f4b5d34ca212dfb6fec2db14">AST_AUDIOHOOK_STATUS_DONE</a>)
<a name="l00386"></a>00386       <span class="keywordflow">return</span> 0;
<a name="l00387"></a>00387 
<a name="l00388"></a>00388    <a class="code" href="audiohook_8h.html#a5f263b2006fa3bd3e9a96d4580d0125c" title="Update audiohook&amp;#39;s status.">ast_audiohook_update_status</a>(audiohook, <a class="code" href="audiohook_8h.html#acf2dd361123daa6446ade7c7ecfe55adac1d3e44970c0af0ebd25b95f59b5cf57">AST_AUDIOHOOK_STATUS_SHUTDOWN</a>);
<a name="l00389"></a>00389 
<a name="l00390"></a>00390    <span class="keywordflow">while</span> (audiohook-&gt;<a class="code" href="structast__audiohook.html#a9c2c1a66c786d5e486ac428388d62e28">status</a> != <a class="code" href="audiohook_8h.html#acf2dd361123daa6446ade7c7ecfe55ada82b3db86f4b5d34ca212dfb6fec2db14">AST_AUDIOHOOK_STATUS_DONE</a>)
<a name="l00391"></a>00391       <a class="code" href="audiohook_8h.html#a47bb160cbe5e534c0fca6560015ffe59" title="Wait for audiohook trigger to be triggered.">ast_audiohook_trigger_wait</a>(audiohook);
<a name="l00392"></a>00392 
<a name="l00393"></a>00393    <span class="keywordflow">return</span> 0;
<a name="l00394"></a>00394 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a97fef5ce6c1baffe0051c8f8b70ad2f8"></a><!-- doxytag: member="audiohook.h::ast_audiohook_detach_list" ref="a97fef5ce6c1baffe0051c8f8b70ad2f8" args="(struct ast_audiohook_list *audiohook_list)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_audiohook_detach_list </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__audiohook__list.html">ast_audiohook_list</a> *&nbsp;</td>
          <td class="paramname"> <em>audiohook_list</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Detach audiohooks from list and destroy said list. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>audiohook_list</em>&nbsp;</td><td>List of audiohooks </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns 0 on success, -1 on failure </dd></dl>

<p>Definition at line <a class="el" href="audiohook_8c_source.html#l00400">400</a> of file <a class="el" href="audiohook_8c_source.html">audiohook.c</a>.</p>

<p>References <a class="el" href="audiohook_8h_source.html#l00046">AST_AUDIOHOOK_STATUS_DONE</a>, <a class="el" href="audiohook_8c_source.html#l00369">ast_audiohook_update_status()</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="linkedlists_8h_source.html#l00817">AST_LIST_REMOVE_HEAD</a>, <a class="el" href="translate_8c_source.html#l00253">ast_translator_free_path()</a>, <a class="el" href="audiohook_8c_source.html#l00047">ast_audiohook_list::in_translate</a>, <a class="el" href="audiohook_8h_source.html#l00100">ast_audiohook::manipulate_callback</a>, <a class="el" href="structast__audiohook__list.html#acdea2991ba0b3828e72ba3d936aa33dd">ast_audiohook_list::manipulate_list</a>, <a class="el" href="audiohook_8c_source.html#l00048">ast_audiohook_list::out_translate</a>, <a class="el" href="structast__audiohook__list.html#ab1b7108d32768b87015db450e753302c">ast_audiohook_list::spy_list</a>, <a class="el" href="audiohook_8c_source.html#l00042">ast_audiohook_translate::trans_pvt</a>, and <a class="el" href="structast__audiohook__list.html#a463b768292e522f67f80733d5dc1c5e0">ast_audiohook_list::whisper_list</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l01690">ast_hangup()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00401"></a>00401 {
<a name="l00402"></a>00402    <span class="keywordtype">int</span> i = 0;
<a name="l00403"></a>00403    <span class="keyword">struct </span><a class="code" href="structast__audiohook.html">ast_audiohook</a> *audiohook = NULL;
<a name="l00404"></a>00404 
<a name="l00405"></a>00405    <span class="comment">/* Drop any spies */</span>
<a name="l00406"></a>00406    <span class="keywordflow">while</span> ((audiohook = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;audiohook_list-&gt;<a class="code" href="structast__audiohook__list.html#ab1b7108d32768b87015db450e753302c">spy_list</a>, list))) {
<a name="l00407"></a>00407       <a class="code" href="audiohook_8h.html#a5f263b2006fa3bd3e9a96d4580d0125c" title="Update audiohook&amp;#39;s status.">ast_audiohook_update_status</a>(audiohook, <a class="code" href="audiohook_8h.html#acf2dd361123daa6446ade7c7ecfe55ada82b3db86f4b5d34ca212dfb6fec2db14">AST_AUDIOHOOK_STATUS_DONE</a>);
<a name="l00408"></a>00408    }
<a name="l00409"></a>00409 
<a name="l00410"></a>00410    <span class="comment">/* Drop any whispering sources */</span>
<a name="l00411"></a>00411    <span class="keywordflow">while</span> ((audiohook = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;audiohook_list-&gt;<a class="code" href="structast__audiohook__list.html#a463b768292e522f67f80733d5dc1c5e0">whisper_list</a>, list))) {
<a name="l00412"></a>00412       <a class="code" href="audiohook_8h.html#a5f263b2006fa3bd3e9a96d4580d0125c" title="Update audiohook&amp;#39;s status.">ast_audiohook_update_status</a>(audiohook, <a class="code" href="audiohook_8h.html#acf2dd361123daa6446ade7c7ecfe55ada82b3db86f4b5d34ca212dfb6fec2db14">AST_AUDIOHOOK_STATUS_DONE</a>);
<a name="l00413"></a>00413    }
<a name="l00414"></a>00414 
<a name="l00415"></a>00415    <span class="comment">/* Drop any manipulaters */</span>
<a name="l00416"></a>00416    <span class="keywordflow">while</span> ((audiohook = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;audiohook_list-&gt;<a class="code" href="structast__audiohook__list.html#acdea2991ba0b3828e72ba3d936aa33dd">manipulate_list</a>, list))) {
<a name="l00417"></a>00417       <a class="code" href="audiohook_8h.html#a5f263b2006fa3bd3e9a96d4580d0125c" title="Update audiohook&amp;#39;s status.">ast_audiohook_update_status</a>(audiohook, <a class="code" href="audiohook_8h.html#acf2dd361123daa6446ade7c7ecfe55ada82b3db86f4b5d34ca212dfb6fec2db14">AST_AUDIOHOOK_STATUS_DONE</a>);
<a name="l00418"></a>00418       audiohook-&gt;<a class="code" href="structast__audiohook.html#a4592709f9cf7b13798a0afcafbd96893">manipulate_callback</a>(audiohook, NULL, NULL, 0);
<a name="l00419"></a>00419    }
<a name="l00420"></a>00420 
<a name="l00421"></a>00421    <span class="comment">/* Drop translation paths if present */</span>
<a name="l00422"></a>00422    <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++) {
<a name="l00423"></a>00423       <span class="keywordflow">if</span> (audiohook_list-&gt;<a class="code" href="structast__audiohook__list.html#afe31074fcddab60b8fb0019b1f16e67d">in_translate</a>[i].<a class="code" href="structast__audiohook__translate.html#a747ca6507654d33f73cf289e8172a5dd">trans_pvt</a>)
<a name="l00424"></a>00424          <a class="code" href="translate_8h.html#a8f767bf5c2095f182e7cbaa73e391207" title="Frees a translator path Frees the given translator path structure.">ast_translator_free_path</a>(audiohook_list-&gt;<a class="code" href="structast__audiohook__list.html#afe31074fcddab60b8fb0019b1f16e67d">in_translate</a>[i].<a class="code" href="structast__audiohook__translate.html#a747ca6507654d33f73cf289e8172a5dd">trans_pvt</a>);
<a name="l00425"></a>00425       <span class="keywordflow">if</span> (audiohook_list-&gt;<a class="code" href="structast__audiohook__list.html#a0ef356831a74b5632d5223819b992069">out_translate</a>[i].<a class="code" href="structast__audiohook__translate.html#a747ca6507654d33f73cf289e8172a5dd">trans_pvt</a>)
<a name="l00426"></a>00426          <a class="code" href="translate_8h.html#a8f767bf5c2095f182e7cbaa73e391207" title="Frees a translator path Frees the given translator path structure.">ast_translator_free_path</a>(audiohook_list-&gt;<a class="code" href="structast__audiohook__list.html#a0ef356831a74b5632d5223819b992069">out_translate</a>[i].<a class="code" href="structast__audiohook__translate.html#a747ca6507654d33f73cf289e8172a5dd">trans_pvt</a>);
<a name="l00427"></a>00427    }
<a name="l00428"></a>00428    
<a name="l00429"></a>00429    <span class="comment">/* Free ourselves */</span>
<a name="l00430"></a>00430    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(audiohook_list);
<a name="l00431"></a>00431 
<a name="l00432"></a>00432    <span class="keywordflow">return</span> 0;
<a name="l00433"></a>00433 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a34ed9fa0751083523ea90d1ad7c81fbf"></a><!-- doxytag: member="audiohook.h::ast_audiohook_detach_source" ref="a34ed9fa0751083523ea90d1ad7c81fbf" args="(struct ast_channel *chan, const char *source)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_audiohook_detach_source </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>source</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Detach specified source audiohook from channel. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel to detach from </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>source</em>&nbsp;</td><td>Name of source to detach</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns 0 on success, -1 on failure</dd></dl>
<dl class="note"><dt><b>Note:</b></dt><dd>The channel does not need to be locked before calling this function.</dd></dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel to detach from </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>source</em>&nbsp;</td><td>Name of source to detach </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns 0 on success, -1 on failure </dd></dl>

<p>Definition at line <a class="el" href="audiohook_8c_source.html#l00491">491</a> of file <a class="el" href="audiohook_8c_source.html">audiohook.c</a>.</p>

<p>References <a class="el" href="audiohook_8h_source.html#l00046">AST_AUDIOHOOK_STATUS_DONE</a>, <a class="el" href="audiohook_8h_source.html#l00045">AST_AUDIOHOOK_STATUS_SHUTDOWN</a>, <a class="el" href="audiohook_8c_source.html#l00369">ast_audiohook_update_status()</a>, <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="channel_8h_source.html#l00421">ast_channel::audiohooks</a>, <a class="el" href="audiohook_8c_source.html#l00440">find_audiohook_by_source()</a>, and <a class="el" href="audiohook_8h_source.html#l00091">ast_audiohook::status</a>.</p>

<p>Referenced by <a class="el" href="app__mixmonitor_8c_source.html#l00587">handle_cli_mixmonitor()</a>, and <a class="el" href="app__mixmonitor_8c_source.html#l00550">stop_mixmonitor_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00492"></a>00492 {
<a name="l00493"></a>00493    <span class="keyword">struct </span><a class="code" href="structast__audiohook.html">ast_audiohook</a> *audiohook = NULL;
<a name="l00494"></a>00494 
<a name="l00495"></a>00495    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l00496"></a>00496 
<a name="l00497"></a>00497    <span class="comment">/* Ensure the channel has audiohooks on it */</span>
<a name="l00498"></a>00498    <span class="keywordflow">if</span> (!chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>) {
<a name="l00499"></a>00499       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l00500"></a>00500       <span class="keywordflow">return</span> -1;
<a name="l00501"></a>00501    }
<a name="l00502"></a>00502 
<a name="l00503"></a>00503    audiohook = <a class="code" href="audiohook_8c.html#a1e0a923b8b1fa6d4be9060b3ece13b3b" title="find an audiohook based on its source">find_audiohook_by_source</a>(chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>, <a class="code" href="structast__audiohook.html#af2ed45b90afa2ef4ec6e09625335a082">source</a>);
<a name="l00504"></a>00504 
<a name="l00505"></a>00505    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l00506"></a>00506 
<a name="l00507"></a>00507    <span class="keywordflow">if</span> (audiohook &amp;&amp; audiohook-&gt;<a class="code" href="structast__audiohook.html#a9c2c1a66c786d5e486ac428388d62e28">status</a> != <a class="code" href="audiohook_8h.html#acf2dd361123daa6446ade7c7ecfe55ada82b3db86f4b5d34ca212dfb6fec2db14">AST_AUDIOHOOK_STATUS_DONE</a>)
<a name="l00508"></a>00508       <a class="code" href="audiohook_8h.html#a5f263b2006fa3bd3e9a96d4580d0125c" title="Update audiohook&amp;#39;s status.">ast_audiohook_update_status</a>(audiohook, <a class="code" href="audiohook_8h.html#acf2dd361123daa6446ade7c7ecfe55adac1d3e44970c0af0ebd25b95f59b5cf57">AST_AUDIOHOOK_STATUS_SHUTDOWN</a>);
<a name="l00509"></a>00509 
<a name="l00510"></a>00510    <span class="keywordflow">return</span> (audiohook ? 0 : -1);
<a name="l00511"></a>00511 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a94bd83e9f3444f406174971481b862c2"></a><!-- doxytag: member="audiohook.h::ast_audiohook_init" ref="a94bd83e9f3444f406174971481b862c2" args="(struct ast_audiohook *audiohook, enum ast_audiohook_type type, const char *source)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_audiohook_init </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__audiohook.html">ast_audiohook</a> *&nbsp;</td>
          <td class="paramname"> <em>audiohook</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="audiohook_8h.html#abce1d2faae234aa016905215014542b0">ast_audiohook_type</a>&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>source</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize an audiohook structure. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>audiohook</em>&nbsp;</td><td>Audiohook structure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>type</em>&nbsp;</td><td>Type of audiohook to initialize this as </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>source</em>&nbsp;</td><td>Who is initializing this audiohook </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns 0 on success, -1 on failure</dd></dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>audiohook</em>&nbsp;</td><td>Audiohook structure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>type</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>source</em>&nbsp;</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns 0 on success, -1 on failure </dd></dl>

<p>Definition at line <a class="el" href="audiohook_8c_source.html#l00060">60</a> of file <a class="el" href="audiohook_8c_source.html">audiohook.c</a>.</p>

<p>References <a class="el" href="audiohook_8h_source.html#l00043">AST_AUDIOHOOK_STATUS_NEW</a>, <a class="el" href="audiohook_8h_source.html#l00037">AST_AUDIOHOOK_TYPE_SPY</a>, <a class="el" href="audiohook_8h_source.html#l00038">AST_AUDIOHOOK_TYPE_WHISPER</a>, <a class="el" href="audiohook_8c_source.html#l00369">ast_audiohook_update_status()</a>, <a class="el" href="lock_8h_source.html#l01729">ast_cond_init()</a>, <a class="el" href="lock_8h_source.html#l01692">ast_mutex_init()</a>, and <a class="el" href="slinfactory_8c_source.html#l00035">ast_slinfactory_init()</a>.</p>

<p>Referenced by <a class="el" href="audiohook_8c_source.html#l00893">audiohook_volume_get()</a>, <a class="el" href="app__chanspy_8c_source.html#l00445">channel_spy()</a>, <a class="el" href="app__jack_8c_source.html#l00859">enable_jack_hook()</a>, <a class="el" href="app__mixmonitor_8c_source.html#l00398">launch_monitor_thread()</a>, <a class="el" href="func__speex_8c_source.html#l00194">speex_write()</a>, and <a class="el" href="func__volume_8c_source.html#l00121">volume_write()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00061"></a>00061 {
<a name="l00062"></a>00062    <span class="comment">/* Need to keep the type and source */</span>
<a name="l00063"></a>00063    audiohook-&gt;<a class="code" href="structast__audiohook.html#a2ad9abd9447a1c58bfe6b03e05f98335">type</a> = <a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>;
<a name="l00064"></a>00064    audiohook-&gt;<a class="code" href="structast__audiohook.html#af2ed45b90afa2ef4ec6e09625335a082">source</a> = <a class="code" href="structast__audiohook.html#af2ed45b90afa2ef4ec6e09625335a082">source</a>;
<a name="l00065"></a>00065 
<a name="l00066"></a>00066    <span class="comment">/* Initialize lock that protects our audiohook */</span>
<a name="l00067"></a>00067    <a class="code" href="lock_8h.html#a5dc895fe6e8c089175159fc22e33fc3b">ast_mutex_init</a>(&amp;audiohook-&gt;<a class="code" href="structast__audiohook.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00068"></a>00068    <a class="code" href="lock_8h.html#a21f75f462115427718d78aa66cc61f9b">ast_cond_init</a>(&amp;audiohook-&gt;<a class="code" href="structast__audiohook.html#a1730983172cdc5373cf60e0e40294fb0">trigger</a>, NULL);
<a name="l00069"></a>00069 
<a name="l00070"></a>00070    <span class="comment">/* Setup the factories that are needed for this audiohook type */</span>
<a name="l00071"></a>00071    <span class="keywordflow">switch</span> (<a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>) {
<a name="l00072"></a>00072    <span class="keywordflow">case</span> <a class="code" href="audiohook_8h.html#abce1d2faae234aa016905215014542b0a29865bbf4732a7e78748db47b91e46f5">AST_AUDIOHOOK_TYPE_SPY</a>:
<a name="l00073"></a>00073       <a class="code" href="slinfactory_8h.html#a213f392fc2df73230ec61af35072c1b2" title="Initialize a slinfactory.">ast_slinfactory_init</a>(&amp;audiohook-&gt;<a class="code" href="structast__audiohook.html#a72d12418b888e36b3d47a7703d2edced">read_factory</a>);
<a name="l00074"></a>00074    <span class="keywordflow">case</span> <a class="code" href="audiohook_8h.html#abce1d2faae234aa016905215014542b0aecdafbcdb7048512d25cd19089198edd">AST_AUDIOHOOK_TYPE_WHISPER</a>:
<a name="l00075"></a>00075       <a class="code" href="slinfactory_8h.html#a213f392fc2df73230ec61af35072c1b2" title="Initialize a slinfactory.">ast_slinfactory_init</a>(&amp;audiohook-&gt;<a class="code" href="structast__audiohook.html#aecd1ea17a6f1a4cc3bf683296792b262">write_factory</a>);
<a name="l00076"></a>00076       <span class="keywordflow">break</span>;
<a name="l00077"></a>00077    <span class="keywordflow">default</span>:
<a name="l00078"></a>00078       <span class="keywordflow">break</span>;
<a name="l00079"></a>00079    }
<a name="l00080"></a>00080 
<a name="l00081"></a>00081    <span class="comment">/* Since we are just starting out... this audiohook is new */</span>
<a name="l00082"></a>00082    <a class="code" href="audiohook_8h.html#a5f263b2006fa3bd3e9a96d4580d0125c" title="Update audiohook&amp;#39;s status.">ast_audiohook_update_status</a>(audiohook, <a class="code" href="audiohook_8h.html#acf2dd361123daa6446ade7c7ecfe55adab303a4f550e2d8232d9803bf2d95f480">AST_AUDIOHOOK_STATUS_NEW</a>);
<a name="l00083"></a>00083 
<a name="l00084"></a>00084    <span class="keywordflow">return</span> 0;
<a name="l00085"></a>00085 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae09727634eabe798d8abc95d46fa7b1e"></a><!-- doxytag: member="audiohook.h::ast_audiohook_move_by_source" ref="ae09727634eabe798d8abc95d46fa7b1e" args="(struct ast_channel *old_chan, struct ast_channel *new_chan, const char *source)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_audiohook_move_by_source </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>old_chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>new_chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>source</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Move an audiohook from one channel to a new one. </p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000057">Todo:</a></b></dt><dd>Currently only the first audiohook of a specific source found will be moved. We should add the capability to move multiple audiohooks from a single source as well.</dd></dl>
<dl class="note"><dt><b>Note:</b></dt><dd>It is required that both old_chan and new_chan are locked prior to calling this function. Besides needing to protect the data within the <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>, not locking these <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> can lead to a potential deadlock</dd></dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>old_chan</em>&nbsp;</td><td>The source of the audiohook to move </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>new_chan</em>&nbsp;</td><td>The destination to which we want the audiohook to move </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>source</em>&nbsp;</td><td>The source of the audiohook we want to move </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="audiohook_8c_source.html#l00462">462</a> of file <a class="el" href="audiohook_8c_source.html">audiohook.c</a>.</p>

<p>References <a class="el" href="audiohook_8c_source.html#l00330">ast_audiohook_attach()</a>, <a class="el" href="audiohook_8h_source.html#l00244">ast_audiohook_lock</a>, <a class="el" href="audiohook_8c_source.html#l00523">ast_audiohook_remove()</a>, <a class="el" href="audiohook_8h_source.html#l00249">ast_audiohook_unlock</a>, <a class="el" href="channel_8h_source.html#l00421">ast_channel::audiohooks</a>, <a class="el" href="audiohook_8c_source.html#l00440">find_audiohook_by_source()</a>, and <a class="el" href="audiohook_8h_source.html#l00091">ast_audiohook::status</a>.</p>

<p>Referenced by <a class="el" href="func__audiohookinherit_8c_source.html#l00117">audiohook_inheritance_fixup()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00463"></a>00463 {
<a name="l00464"></a>00464    <span class="keyword">struct </span><a class="code" href="structast__audiohook.html">ast_audiohook</a> *audiohook;
<a name="l00465"></a>00465    <span class="keyword">enum</span> <a class="code" href="audiohook_8h.html#acf2dd361123daa6446ade7c7ecfe55ad">ast_audiohook_status</a> oldstatus;
<a name="l00466"></a>00466 
<a name="l00467"></a>00467    <span class="keywordflow">if</span> (!old_chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a> || !(audiohook = <a class="code" href="audiohook_8c.html#a1e0a923b8b1fa6d4be9060b3ece13b3b" title="find an audiohook based on its source">find_audiohook_by_source</a>(old_chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>, <a class="code" href="structast__audiohook.html#af2ed45b90afa2ef4ec6e09625335a082">source</a>))) {
<a name="l00468"></a>00468       <span class="keywordflow">return</span>;
<a name="l00469"></a>00469    }
<a name="l00470"></a>00470 
<a name="l00471"></a>00471    <span class="comment">/* By locking both channels and the audiohook, we can assure that</span>
<a name="l00472"></a>00472 <span class="comment">    * another thread will not have a chance to read the audiohook&apos;s status</span>
<a name="l00473"></a>00473 <span class="comment">    * as done, even though ast_audiohook_remove signals the trigger</span>
<a name="l00474"></a>00474 <span class="comment">    * condition.</span>
<a name="l00475"></a>00475 <span class="comment">    */</span>
<a name="l00476"></a>00476    <a class="code" href="audiohook_8h.html#a6456e346fe813617f13d5bbf7e92db5a" title="Lock an audiohook.">ast_audiohook_lock</a>(audiohook);
<a name="l00477"></a>00477    oldstatus = audiohook-&gt;<a class="code" href="structast__audiohook.html#a9c2c1a66c786d5e486ac428388d62e28">status</a>;
<a name="l00478"></a>00478 
<a name="l00479"></a>00479    <a class="code" href="audiohook_8h.html#a34c80f85a6c8c76a4138323837c116d4" title="Remove an audiohook from a specified channel.">ast_audiohook_remove</a>(old_chan, audiohook);
<a name="l00480"></a>00480    <a class="code" href="audiohook_8h.html#a94abfad20db137f9d6a33f641d37ac31" title="Attach audiohook to channel.">ast_audiohook_attach</a>(new_chan, audiohook);
<a name="l00481"></a>00481 
<a name="l00482"></a>00482    audiohook-&gt;<a class="code" href="structast__audiohook.html#a9c2c1a66c786d5e486ac428388d62e28">status</a> = oldstatus;
<a name="l00483"></a>00483    <a class="code" href="audiohook_8h.html#aae4ac794c0f7ab8decd713cb9c43acf4" title="Unlock an audiohook.">ast_audiohook_unlock</a>(audiohook);
<a name="l00484"></a>00484 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0e5d69771f8bd48682ca3d40bc2111c2"></a><!-- doxytag: member="audiohook.h::ast_audiohook_read_frame" ref="a0e5d69771f8bd48682ca3d40bc2111c2" args="(struct ast_audiohook *audiohook, size_t samples, enum ast_audiohook_direction direction, int format)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__frame.html">ast_frame</a>* ast_audiohook_read_frame </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__audiohook.html">ast_audiohook</a> *&nbsp;</td>
          <td class="paramname"> <em>audiohook</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>samples</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899">ast_audiohook_direction</a>&nbsp;</td>
          <td class="paramname"> <em>direction</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>format</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reads a frame in from the audiohook structure. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>audiohook</em>&nbsp;</td><td>Audiohook structure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>samples</em>&nbsp;</td><td>Number of samples wanted </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>direction</em>&nbsp;</td><td>Direction the audio frame came from </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>format</em>&nbsp;</td><td>Format of frame remote side wants back </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns frame on success, NULL on failure </dd></dl>

<p>Definition at line <a class="el" href="audiohook_8c_source.html#l00295">295</a> of file <a class="el" href="audiohook_8c_source.html">audiohook.c</a>.</p>

<p>References <a class="el" href="audiohook_8h_source.html#l00052">AST_AUDIOHOOK_DIRECTION_BOTH</a>, <a class="el" href="frame_8h_source.html#l00253">AST_FORMAT_SLINEAR</a>, <a class="el" href="frame_8h_source.html#l00462">ast_frfree</a>, <a class="el" href="translate_8c_source.html#l00308">ast_translate()</a>, <a class="el" href="translate_8c_source.html#l00263">ast_translator_build_path()</a>, <a class="el" href="translate_8c_source.html#l00253">ast_translator_free_path()</a>, <a class="el" href="audiohook_8c_source.html#l00197">audiohook_read_frame_both()</a>, <a class="el" href="audiohook_8c_source.html#l00169">audiohook_read_frame_single()</a>, <a class="el" href="audiohook_8h_source.html#l00098">ast_audiohook::format</a>, <a class="el" href="file_8c_source.html#l00695">read_frame()</a>, and <a class="el" href="audiohook_8h_source.html#l00099">ast_audiohook::trans_pvt</a>.</p>

<p>Referenced by <a class="el" href="app__mixmonitor_8c_source.html#l00280">mixmonitor_thread()</a>, and <a class="el" href="app__chanspy_8c_source.html#l00361">spy_generate()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00296"></a>00296 {
<a name="l00297"></a>00297    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="file_8c.html#a3d11f27997994d366d52d54a084ec944">read_frame</a> = NULL, *final_frame = NULL;
<a name="l00298"></a>00298 
<a name="l00299"></a>00299    <span class="keywordflow">if</span> (!(read_frame = (direction == <a class="code" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899af84e1c36b65319be79e79b03c8f4a360">AST_AUDIOHOOK_DIRECTION_BOTH</a> ? <a class="code" href="audiohook_8c.html#a6b731ffecc7e0cbd1cfa81d1a4903c82">audiohook_read_frame_both</a>(audiohook, <a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>) : <a class="code" href="audiohook_8c.html#aa8a53e1c05b3e841adf5435fc19a10f2">audiohook_read_frame_single</a>(audiohook, <a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>, direction))))
<a name="l00300"></a>00300       <span class="keywordflow">return</span> NULL;
<a name="l00301"></a>00301 
<a name="l00302"></a>00302    <span class="comment">/* If they don&apos;t want signed linear back out, we&apos;ll have to send it through the translation path */</span>
<a name="l00303"></a>00303    <span class="keywordflow">if</span> (<a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a> != <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>) {
<a name="l00304"></a>00304       <span class="comment">/* Rebuild translation path if different format then previously */</span>
<a name="l00305"></a>00305       <span class="keywordflow">if</span> (audiohook-&gt;<a class="code" href="structast__audiohook.html#a317afff57d87a89158c2b038d37b2b08">format</a> != <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>) {
<a name="l00306"></a>00306          <span class="keywordflow">if</span> (audiohook-&gt;<a class="code" href="structast__audiohook.html#a747ca6507654d33f73cf289e8172a5dd">trans_pvt</a>) {
<a name="l00307"></a>00307             <a class="code" href="translate_8h.html#a8f767bf5c2095f182e7cbaa73e391207" title="Frees a translator path Frees the given translator path structure.">ast_translator_free_path</a>(audiohook-&gt;<a class="code" href="structast__audiohook.html#a747ca6507654d33f73cf289e8172a5dd">trans_pvt</a>);
<a name="l00308"></a>00308             audiohook-&gt;<a class="code" href="structast__audiohook.html#a747ca6507654d33f73cf289e8172a5dd">trans_pvt</a> = NULL;
<a name="l00309"></a>00309          }
<a name="l00310"></a>00310          <span class="comment">/* Setup new translation path for this format... if we fail we can&apos;t very well return signed linear so free the frame and return nothing */</span>
<a name="l00311"></a>00311          <span class="keywordflow">if</span> (!(audiohook-&gt;<a class="code" href="structast__audiohook.html#a747ca6507654d33f73cf289e8172a5dd">trans_pvt</a> = <a class="code" href="translate_8h.html#ae53a058fb0d55f3f0b3264813b50232a" title="Builds a translator path Build a path (possibly NULL) from source to dest.">ast_translator_build_path</a>(<a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>, <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>))) {
<a name="l00312"></a>00312             <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(read_frame);
<a name="l00313"></a>00313             <span class="keywordflow">return</span> NULL;
<a name="l00314"></a>00314          }
<a name="l00315"></a>00315       }
<a name="l00316"></a>00316       <span class="comment">/* Convert to requested format, and allow the read in frame to be freed */</span>
<a name="l00317"></a>00317       final_frame = <a class="code" href="translate_8h.html#ab09d3ccb95d1f828d2871530226f9456" title="translates one or more frames Apply an input frame into the translator and receive...">ast_translate</a>(audiohook-&gt;<a class="code" href="structast__audiohook.html#a747ca6507654d33f73cf289e8172a5dd">trans_pvt</a>, read_frame, 1);
<a name="l00318"></a>00318    } <span class="keywordflow">else</span> {
<a name="l00319"></a>00319       final_frame = read_frame;
<a name="l00320"></a>00320    }
<a name="l00321"></a>00321 
<a name="l00322"></a>00322    <span class="keywordflow">return</span> final_frame;
<a name="l00323"></a>00323 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a34c80f85a6c8c76a4138323837c116d4"></a><!-- doxytag: member="audiohook.h::ast_audiohook_remove" ref="a34c80f85a6c8c76a4138323837c116d4" args="(struct ast_channel *chan, struct ast_audiohook *audiohook)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_audiohook_remove </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__audiohook.html">ast_audiohook</a> *&nbsp;</td>
          <td class="paramname"> <em>audiohook</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Remove an audiohook from a specified channel. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel to remove from </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>audiohook</em>&nbsp;</td><td>Audiohook to remove</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns 0 on success, -1 on failure</dd></dl>
<dl class="note"><dt><b>Note:</b></dt><dd>The channel does not need to be locked before calling this function </dd></dl>

<p>Definition at line <a class="el" href="audiohook_8c_source.html#l00523">523</a> of file <a class="el" href="audiohook_8c_source.html">audiohook.c</a>.</p>

<p>References <a class="el" href="audiohook_8h_source.html#l00046">AST_AUDIOHOOK_STATUS_DONE</a>, <a class="el" href="audiohook_8h_source.html#l00039">AST_AUDIOHOOK_TYPE_MANIPULATE</a>, <a class="el" href="audiohook_8h_source.html#l00037">AST_AUDIOHOOK_TYPE_SPY</a>, <a class="el" href="audiohook_8h_source.html#l00038">AST_AUDIOHOOK_TYPE_WHISPER</a>, <a class="el" href="audiohook_8c_source.html#l00369">ast_audiohook_update_status()</a>, <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="linkedlists_8h_source.html#l00838">AST_LIST_REMOVE</a>, <a class="el" href="channel_8h_source.html#l00421">ast_channel::audiohooks</a>, <a class="el" href="structast__audiohook__list.html#acdea2991ba0b3828e72ba3d936aa33dd">ast_audiohook_list::manipulate_list</a>, <a class="el" href="structast__audiohook__list.html#ab1b7108d32768b87015db450e753302c">ast_audiohook_list::spy_list</a>, <a class="el" href="audiohook_8h_source.html#l00090">ast_audiohook::type</a>, and <a class="el" href="structast__audiohook__list.html#a463b768292e522f67f80733d5dc1c5e0">ast_audiohook_list::whisper_list</a>.</p>

<p>Referenced by <a class="el" href="audiohook_8c_source.html#l00462">ast_audiohook_move_by_source()</a>, and <a class="el" href="func__speex_8c_source.html#l00194">speex_write()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00524"></a>00524 {
<a name="l00525"></a>00525    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l00526"></a>00526 
<a name="l00527"></a>00527    <span class="keywordflow">if</span> (!chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>) {
<a name="l00528"></a>00528       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l00529"></a>00529       <span class="keywordflow">return</span> -1;
<a name="l00530"></a>00530    }
<a name="l00531"></a>00531 
<a name="l00532"></a>00532    <span class="keywordflow">if</span> (audiohook-&gt;<a class="code" href="structast__audiohook.html#a2ad9abd9447a1c58bfe6b03e05f98335">type</a> == <a class="code" href="audiohook_8h.html#abce1d2faae234aa016905215014542b0a29865bbf4732a7e78748db47b91e46f5">AST_AUDIOHOOK_TYPE_SPY</a>)
<a name="l00533"></a>00533       <a class="code" href="linkedlists_8h.html#aa36e72b77f1b80881cd0a9fcca66ce19" title="Removes a specific entry from a list.">AST_LIST_REMOVE</a>(&amp;chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>-&gt;<a class="code" href="structast__audiohook__list.html#ab1b7108d32768b87015db450e753302c">spy_list</a>, audiohook, list);
<a name="l00534"></a>00534    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (audiohook-&gt;<a class="code" href="structast__audiohook.html#a2ad9abd9447a1c58bfe6b03e05f98335">type</a> == <a class="code" href="audiohook_8h.html#abce1d2faae234aa016905215014542b0aecdafbcdb7048512d25cd19089198edd">AST_AUDIOHOOK_TYPE_WHISPER</a>)
<a name="l00535"></a>00535       <a class="code" href="linkedlists_8h.html#aa36e72b77f1b80881cd0a9fcca66ce19" title="Removes a specific entry from a list.">AST_LIST_REMOVE</a>(&amp;chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>-&gt;<a class="code" href="structast__audiohook__list.html#a463b768292e522f67f80733d5dc1c5e0">whisper_list</a>, audiohook, list);
<a name="l00536"></a>00536    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (audiohook-&gt;<a class="code" href="structast__audiohook.html#a2ad9abd9447a1c58bfe6b03e05f98335">type</a> == <a class="code" href="audiohook_8h.html#abce1d2faae234aa016905215014542b0a20dda44508f42e63dc8ed45760affe08">AST_AUDIOHOOK_TYPE_MANIPULATE</a>)
<a name="l00537"></a>00537       <a class="code" href="linkedlists_8h.html#aa36e72b77f1b80881cd0a9fcca66ce19" title="Removes a specific entry from a list.">AST_LIST_REMOVE</a>(&amp;chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>-&gt;<a class="code" href="structast__audiohook__list.html#acdea2991ba0b3828e72ba3d936aa33dd">manipulate_list</a>, audiohook, list);
<a name="l00538"></a>00538 
<a name="l00539"></a>00539    <a class="code" href="audiohook_8h.html#a5f263b2006fa3bd3e9a96d4580d0125c" title="Update audiohook&amp;#39;s status.">ast_audiohook_update_status</a>(audiohook, <a class="code" href="audiohook_8h.html#acf2dd361123daa6446ade7c7ecfe55ada82b3db86f4b5d34ca212dfb6fec2db14">AST_AUDIOHOOK_STATUS_DONE</a>);
<a name="l00540"></a>00540 
<a name="l00541"></a>00541    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l00542"></a>00542 
<a name="l00543"></a>00543    <span class="keywordflow">return</span> 0;
<a name="l00544"></a>00544 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a47bb160cbe5e534c0fca6560015ffe59"></a><!-- doxytag: member="audiohook.h::ast_audiohook_trigger_wait" ref="a47bb160cbe5e534c0fca6560015ffe59" args="(struct ast_audiohook *audiohook)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_audiohook_trigger_wait </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__audiohook.html">ast_audiohook</a> *&nbsp;</td>
          <td class="paramname"> <em>audiohook</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Wait for audiohook trigger to be triggered. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>audiohook</em>&nbsp;</td><td>Audiohook to wait on </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="audiohook_8c_source.html#l00725">725</a> of file <a class="el" href="audiohook_8c_source.html">audiohook.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l01754">ast_cond_timedwait()</a>, <a class="el" href="time_8h_source.html#l00176">ast_samp2tv()</a>, <a class="el" href="utils_8c_source.html#l01365">ast_tvadd()</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="audiohook_8h_source.html#l00088">ast_audiohook::lock</a>, and <a class="el" href="audiohook_8h_source.html#l00089">ast_audiohook::trigger</a>.</p>

<p>Referenced by <a class="el" href="audiohook_8c_source.html#l00383">ast_audiohook_detach()</a>, and <a class="el" href="app__mixmonitor_8c_source.html#l00280">mixmonitor_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00726"></a>00726 {
<a name="l00727"></a>00727    <span class="keyword">struct </span>timeval wait;
<a name="l00728"></a>00728    <span class="keyword">struct </span>timespec ts;
<a name="l00729"></a>00729 
<a name="l00730"></a>00730    wait = <a class="code" href="time_8h.html#a97e1bb8fbd7a103212789e87e7ed6073" title="Returns the sum of two timevals a + b.">ast_tvadd</a>(<a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>(), <a class="code" href="time_8h.html#a147d132412d7188c1dcebf25b8d31c0c" title="Returns a timeval corresponding to the duration of n samples at rate r. Useful to...">ast_samp2tv</a>(50000, 1000));
<a name="l00731"></a>00731    ts.tv_sec = wait.tv_sec;
<a name="l00732"></a>00732    ts.tv_nsec = wait.tv_usec * 1000;
<a name="l00733"></a>00733    
<a name="l00734"></a>00734    <a class="code" href="lock_8h.html#aa6fec4bba2b7190b94a1a4c7b6c541a4">ast_cond_timedwait</a>(&amp;audiohook-&gt;<a class="code" href="structast__audiohook.html#a1730983172cdc5373cf60e0e40294fb0">trigger</a>, &amp;audiohook-&gt;<a class="code" href="structast__audiohook.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>, &amp;ts);
<a name="l00735"></a>00735    
<a name="l00736"></a>00736    <span class="keywordflow">return</span>;
<a name="l00737"></a>00737 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5f263b2006fa3bd3e9a96d4580d0125c"></a><!-- doxytag: member="audiohook.h::ast_audiohook_update_status" ref="a5f263b2006fa3bd3e9a96d4580d0125c" args="(struct ast_audiohook *audiohook, enum ast_audiohook_status status)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_audiohook_update_status </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__audiohook.html">ast_audiohook</a> *&nbsp;</td>
          <td class="paramname"> <em>audiohook</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="audiohook_8h.html#acf2dd361123daa6446ade7c7ecfe55ad">ast_audiohook_status</a>&nbsp;</td>
          <td class="paramname"> <em>status</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Update audiohook's status. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>audiohook</em>&nbsp;</td><td>Audiohook structure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>audiohook</em>&nbsp;</td><td>status enum</td></tr>
  </table>
  </dd>
</dl>
<dl class="note"><dt><b>Note:</b></dt><dd>once status is updated to DONE, this function can not be used to set the status back to any other setting. Setting DONE effectively locks the status as such.</dd></dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>audiohook</em>&nbsp;</td><td>status enum </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>audiohook</em>&nbsp;</td><td>Audiohook structure</td></tr>
  </table>
  </dd>
</dl>
<dl class="note"><dt><b>Note:</b></dt><dd>once status is updated to DONE, this function can not be used to set the status back to any other setting. Setting DONE effectively locks the status as such. </dd></dl>

<p>Definition at line <a class="el" href="audiohook_8c_source.html#l00369">369</a> of file <a class="el" href="audiohook_8c_source.html">audiohook.c</a>.</p>

<p>References <a class="el" href="audiohook_8h_source.html#l00244">ast_audiohook_lock</a>, <a class="el" href="audiohook_8h_source.html#l00046">AST_AUDIOHOOK_STATUS_DONE</a>, <a class="el" href="audiohook_8h_source.html#l00249">ast_audiohook_unlock</a>, <a class="el" href="lock_8h_source.html#l01734">ast_cond_signal()</a>, <a class="el" href="audiohook_8h_source.html#l00091">ast_audiohook::status</a>, and <a class="el" href="audiohook_8h_source.html#l00089">ast_audiohook::trigger</a>.</p>

<p>Referenced by <a class="el" href="audiohook_8c_source.html#l00330">ast_audiohook_attach()</a>, <a class="el" href="audiohook_8c_source.html#l00383">ast_audiohook_detach()</a>, <a class="el" href="audiohook_8c_source.html#l00400">ast_audiohook_detach_list()</a>, <a class="el" href="audiohook_8c_source.html#l00491">ast_audiohook_detach_source()</a>, <a class="el" href="audiohook_8c_source.html#l00060">ast_audiohook_init()</a>, <a class="el" href="audiohook_8c_source.html#l00523">ast_audiohook_remove()</a>, <a class="el" href="audiohook_8c_source.html#l00582">audio_audiohook_write_list()</a>, and <a class="el" href="audiohook_8c_source.html#l00553">dtmf_audiohook_write_list()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00370"></a>00370 {
<a name="l00371"></a>00371    <a class="code" href="audiohook_8h.html#a6456e346fe813617f13d5bbf7e92db5a" title="Lock an audiohook.">ast_audiohook_lock</a>(audiohook);
<a name="l00372"></a>00372    <span class="keywordflow">if</span> (audiohook-&gt;<a class="code" href="structast__audiohook.html#a9c2c1a66c786d5e486ac428388d62e28">status</a> != <a class="code" href="audiohook_8h.html#acf2dd361123daa6446ade7c7ecfe55ada82b3db86f4b5d34ca212dfb6fec2db14">AST_AUDIOHOOK_STATUS_DONE</a>) {
<a name="l00373"></a>00373       audiohook-&gt;<a class="code" href="structast__audiohook.html#a9c2c1a66c786d5e486ac428388d62e28">status</a> = <a class="code" href="app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a>;
<a name="l00374"></a>00374       <a class="code" href="lock_8h.html#a02a91e30acdea6d13208d23636d37c87">ast_cond_signal</a>(&amp;audiohook-&gt;<a class="code" href="structast__audiohook.html#a1730983172cdc5373cf60e0e40294fb0">trigger</a>);
<a name="l00375"></a>00375    }
<a name="l00376"></a>00376    <a class="code" href="audiohook_8h.html#aae4ac794c0f7ab8decd713cb9c43acf4" title="Unlock an audiohook.">ast_audiohook_unlock</a>(audiohook);
<a name="l00377"></a>00377 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="acf8f4fc0dfd6a5f54e301ac66c5bc434"></a><!-- doxytag: member="audiohook.h::ast_audiohook_volume_adjust" ref="acf8f4fc0dfd6a5f54e301ac66c5bc434" args="(struct ast_channel *chan, enum ast_audiohook_direction direction, int volume)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_audiohook_volume_adjust </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899">ast_audiohook_direction</a>&nbsp;</td>
          <td class="paramname"> <em>direction</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>volume</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Adjust the <a class="el" href="structvolume.html">volume</a> on frames read from or written to a channel. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel to muck with </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>direction</em>&nbsp;</td><td>Direction to increase </td></tr>
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structvolume.html">volume</a></em>&nbsp;</td><td>Value to adjust the adjustment by </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns 0 on success, -1 on failure </dd></dl>
<dl class="since"><dt><b>Since:</b></dt><dd>1.6.1</dd></dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel to muck with </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>direction</em>&nbsp;</td><td>Direction to increase </td></tr>
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structvolume.html">volume</a></em>&nbsp;</td><td>Value to adjust the adjustment by </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns 0 on success, -1 on failure </dd></dl>

<p>Definition at line <a class="el" href="audiohook_8c_source.html#l00985">985</a> of file <a class="el" href="audiohook_8c_source.html">audiohook.c</a>.</p>

<p>References <a class="el" href="audiohook_8h_source.html#l00052">AST_AUDIOHOOK_DIRECTION_BOTH</a>, <a class="el" href="audiohook_8h_source.html#l00050">AST_AUDIOHOOK_DIRECTION_READ</a>, <a class="el" href="audiohook_8h_source.html#l00051">AST_AUDIOHOOK_DIRECTION_WRITE</a>, <a class="el" href="audiohook_8c_source.html#l00893">audiohook_volume_get()</a>, <a class="el" href="audiohook_8c_source.html#l00821">audiohook_volume::read_adjustment</a>, and <a class="el" href="audiohook_8c_source.html#l00822">audiohook_volume::write_adjustment</a>.</p>

<p>Referenced by <a class="el" href="app__confbridge_8c_source.html#l00607">menu_callback()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00986"></a>00986 {
<a name="l00987"></a>00987    <span class="keyword">struct </span><a class="code" href="structaudiohook__volume.html" title="Audiohook volume adjustment structure.">audiohook_volume</a> *<a class="code" href="structaudiohook__volume.html" title="Audiohook volume adjustment structure.">audiohook_volume</a> = NULL;
<a name="l00988"></a>00988 
<a name="l00989"></a>00989    <span class="comment">/* Attempt to find the audiohook volume information, and create an audiohook if none exists */</span>
<a name="l00990"></a>00990    <span class="keywordflow">if</span> (!(audiohook_volume = <a class="code" href="audiohook_8c.html#afe3e6285c5a976be492b202f870f6845" title="Helper function which finds and optionally creates an audiohook_volume_datastore...">audiohook_volume_get</a>(chan, 1))) {
<a name="l00991"></a>00991       <span class="keywordflow">return</span> -1;
<a name="l00992"></a>00992    }
<a name="l00993"></a>00993 
<a name="l00994"></a>00994    <span class="comment">/* Based on the direction change the specific adjustment value */</span>
<a name="l00995"></a>00995    <span class="keywordflow">if</span> (direction == <a class="code" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899a56916f7012e7fe0ec9b6dd4e4c0e2a65">AST_AUDIOHOOK_DIRECTION_READ</a> || direction == <a class="code" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899af84e1c36b65319be79e79b03c8f4a360">AST_AUDIOHOOK_DIRECTION_BOTH</a>) {
<a name="l00996"></a>00996       audiohook_volume-&gt;<a class="code" href="structaudiohook__volume.html#a0a766b2643ed747312a40990b7792a07">read_adjustment</a> += <a class="code" href="structvolume.html">volume</a>;
<a name="l00997"></a>00997    }
<a name="l00998"></a>00998    <span class="keywordflow">if</span> (direction == <a class="code" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899a8254a5b3fc181d3fe3f2af892010b586">AST_AUDIOHOOK_DIRECTION_WRITE</a> || direction == <a class="code" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899af84e1c36b65319be79e79b03c8f4a360">AST_AUDIOHOOK_DIRECTION_BOTH</a>) {
<a name="l00999"></a>00999       audiohook_volume-&gt;<a class="code" href="structaudiohook__volume.html#ac97a76d6712af0af6937fe394d4c8432">write_adjustment</a> += <a class="code" href="structvolume.html">volume</a>;
<a name="l01000"></a>01000    }
<a name="l01001"></a>01001 
<a name="l01002"></a>01002    <span class="keywordflow">return</span> 0;
<a name="l01003"></a>01003 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a39f5dbdf5ef7a979d4ba48f9ee71a422"></a><!-- doxytag: member="audiohook.h::ast_audiohook_volume_get" ref="a39f5dbdf5ef7a979d4ba48f9ee71a422" args="(struct ast_channel *chan, enum ast_audiohook_direction direction)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_audiohook_volume_get </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899">ast_audiohook_direction</a>&nbsp;</td>
          <td class="paramname"> <em>direction</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Retrieve the <a class="el" href="structvolume.html">volume</a> adjustment value on frames read from or written to a channel. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel to retrieve <a class="el" href="structvolume.html">volume</a> adjustment from </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>direction</em>&nbsp;</td><td>Direction to retrieve </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns adjustment value </dd></dl>
<dl class="since"><dt><b>Since:</b></dt><dd>1.6.1</dd></dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel to retrieve <a class="el" href="structvolume.html">volume</a> adjustment from </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>direction</em>&nbsp;</td><td>Direction to retrieve </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns adjustment value </dd></dl>

<p>Definition at line <a class="el" href="audiohook_8c_source.html#l00959">959</a> of file <a class="el" href="audiohook_8c_source.html">audiohook.c</a>.</p>

<p>References <a class="el" href="audiohook_8h_source.html#l00050">AST_AUDIOHOOK_DIRECTION_READ</a>, <a class="el" href="audiohook_8h_source.html#l00051">AST_AUDIOHOOK_DIRECTION_WRITE</a>, <a class="el" href="audiohook_8c_source.html#l00893">audiohook_volume_get()</a>, <a class="el" href="audiohook_8c_source.html#l00821">audiohook_volume::read_adjustment</a>, and <a class="el" href="audiohook_8c_source.html#l00822">audiohook_volume::write_adjustment</a>.</p>

<p>Referenced by <a class="el" href="app__confbridge_8c_source.html#l00687">confbridge_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00960"></a>00960 {
<a name="l00961"></a>00961    <span class="keyword">struct </span><a class="code" href="structaudiohook__volume.html" title="Audiohook volume adjustment structure.">audiohook_volume</a> *<a class="code" href="structaudiohook__volume.html" title="Audiohook volume adjustment structure.">audiohook_volume</a> = NULL;
<a name="l00962"></a>00962    <span class="keywordtype">int</span> adjustment = 0;
<a name="l00963"></a>00963 
<a name="l00964"></a>00964    <span class="comment">/* Attempt to find the audiohook volume information, but do not create it as we only want to look at the values */</span>
<a name="l00965"></a>00965    <span class="keywordflow">if</span> (!(audiohook_volume = <a class="code" href="audiohook_8c.html#afe3e6285c5a976be492b202f870f6845" title="Helper function which finds and optionally creates an audiohook_volume_datastore...">audiohook_volume_get</a>(chan, 0))) {
<a name="l00966"></a>00966       <span class="keywordflow">return</span> 0;
<a name="l00967"></a>00967    }
<a name="l00968"></a>00968 
<a name="l00969"></a>00969    <span class="comment">/* Grab the adjustment value based on direction given */</span>
<a name="l00970"></a>00970    <span class="keywordflow">if</span> (direction == <a class="code" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899a56916f7012e7fe0ec9b6dd4e4c0e2a65">AST_AUDIOHOOK_DIRECTION_READ</a>) {
<a name="l00971"></a>00971       adjustment = audiohook_volume-&gt;<a class="code" href="structaudiohook__volume.html#a0a766b2643ed747312a40990b7792a07">read_adjustment</a>;
<a name="l00972"></a>00972    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (direction == <a class="code" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899a8254a5b3fc181d3fe3f2af892010b586">AST_AUDIOHOOK_DIRECTION_WRITE</a>) {
<a name="l00973"></a>00973       adjustment = audiohook_volume-&gt;<a class="code" href="structaudiohook__volume.html#ac97a76d6712af0af6937fe394d4c8432">write_adjustment</a>;
<a name="l00974"></a>00974    }
<a name="l00975"></a>00975 
<a name="l00976"></a>00976    <span class="keywordflow">return</span> adjustment;
<a name="l00977"></a>00977 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae042519f3d210ea48604952be74044a2"></a><!-- doxytag: member="audiohook.h::ast_audiohook_volume_set" ref="ae042519f3d210ea48604952be74044a2" args="(struct ast_channel *chan, enum ast_audiohook_direction direction, int volume)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_audiohook_volume_set </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899">ast_audiohook_direction</a>&nbsp;</td>
          <td class="paramname"> <em>direction</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>volume</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Adjust the <a class="el" href="structvolume.html">volume</a> on frames read from or written to a channel. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel to muck with </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>direction</em>&nbsp;</td><td>Direction to set on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structvolume.html">volume</a></em>&nbsp;</td><td>Value to adjust the <a class="el" href="structvolume.html">volume</a> by </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns 0 on success, -1 on failure </dd></dl>
<dl class="since"><dt><b>Since:</b></dt><dd>1.6.1</dd></dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel to muck with </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>direction</em>&nbsp;</td><td>Direction to set on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structvolume.html">volume</a></em>&nbsp;</td><td>Value to adjust the <a class="el" href="structvolume.html">volume</a> by </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns 0 on success, -1 on failure </dd></dl>

<p>Definition at line <a class="el" href="audiohook_8c_source.html#l00934">934</a> of file <a class="el" href="audiohook_8c_source.html">audiohook.c</a>.</p>

<p>References <a class="el" href="audiohook_8h_source.html#l00052">AST_AUDIOHOOK_DIRECTION_BOTH</a>, <a class="el" href="audiohook_8h_source.html#l00050">AST_AUDIOHOOK_DIRECTION_READ</a>, <a class="el" href="audiohook_8h_source.html#l00051">AST_AUDIOHOOK_DIRECTION_WRITE</a>, <a class="el" href="audiohook_8c_source.html#l00893">audiohook_volume_get()</a>, <a class="el" href="audiohook_8c_source.html#l00821">audiohook_volume::read_adjustment</a>, and <a class="el" href="audiohook_8c_source.html#l00822">audiohook_volume::write_adjustment</a>.</p>

<p>Referenced by <a class="el" href="app__confbridge_8c_source.html#l00687">confbridge_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00935"></a>00935 {
<a name="l00936"></a>00936    <span class="keyword">struct </span><a class="code" href="structaudiohook__volume.html" title="Audiohook volume adjustment structure.">audiohook_volume</a> *<a class="code" href="structaudiohook__volume.html" title="Audiohook volume adjustment structure.">audiohook_volume</a> = NULL;
<a name="l00937"></a>00937 
<a name="l00938"></a>00938    <span class="comment">/* Attempt to find the audiohook volume information, but only create it if we are not setting the adjustment value to zero */</span>
<a name="l00939"></a>00939    <span class="keywordflow">if</span> (!(audiohook_volume = <a class="code" href="audiohook_8c.html#afe3e6285c5a976be492b202f870f6845" title="Helper function which finds and optionally creates an audiohook_volume_datastore...">audiohook_volume_get</a>(chan, (<a class="code" href="structvolume.html">volume</a> ? 1 : 0)))) {
<a name="l00940"></a>00940       <span class="keywordflow">return</span> -1;
<a name="l00941"></a>00941    }
<a name="l00942"></a>00942 
<a name="l00943"></a>00943    <span class="comment">/* Now based on the direction set the proper value */</span>
<a name="l00944"></a>00944    <span class="keywordflow">if</span> (direction == <a class="code" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899a56916f7012e7fe0ec9b6dd4e4c0e2a65">AST_AUDIOHOOK_DIRECTION_READ</a> || direction == <a class="code" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899af84e1c36b65319be79e79b03c8f4a360">AST_AUDIOHOOK_DIRECTION_BOTH</a>) {
<a name="l00945"></a>00945       audiohook_volume-&gt;<a class="code" href="structaudiohook__volume.html#a0a766b2643ed747312a40990b7792a07">read_adjustment</a> = <a class="code" href="structvolume.html">volume</a>;
<a name="l00946"></a>00946    }
<a name="l00947"></a>00947    <span class="keywordflow">if</span> (direction == <a class="code" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899a8254a5b3fc181d3fe3f2af892010b586">AST_AUDIOHOOK_DIRECTION_WRITE</a> || direction == <a class="code" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899af84e1c36b65319be79e79b03c8f4a360">AST_AUDIOHOOK_DIRECTION_BOTH</a>) {
<a name="l00948"></a>00948       audiohook_volume-&gt;<a class="code" href="structaudiohook__volume.html#ac97a76d6712af0af6937fe394d4c8432">write_adjustment</a> = <a class="code" href="structvolume.html">volume</a>;
<a name="l00949"></a>00949    }
<a name="l00950"></a>00950 
<a name="l00951"></a>00951    <span class="keywordflow">return</span> 0;
<a name="l00952"></a>00952 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3391dbd95c95f041cf14fa30e0f5c73d"></a><!-- doxytag: member="audiohook.h::ast_audiohook_write_frame" ref="a3391dbd95c95f041cf14fa30e0f5c73d" args="(struct ast_audiohook *audiohook, enum ast_audiohook_direction direction, struct ast_frame *frame)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_audiohook_write_frame </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__audiohook.html">ast_audiohook</a> *&nbsp;</td>
          <td class="paramname"> <em>audiohook</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899">ast_audiohook_direction</a>&nbsp;</td>
          <td class="paramname"> <em>direction</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td>
          <td class="paramname"> <em>frame</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Writes a frame into the audiohook structure. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>audiohook</em>&nbsp;</td><td>Audiohook structure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>direction</em>&nbsp;</td><td>Direction the audio frame came from </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>frame</em>&nbsp;</td><td>Frame to write in </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns 0 on success, -1 on failure </dd></dl>

<p>Definition at line <a class="el" href="audiohook_8c_source.html#l00121">121</a> of file <a class="el" href="audiohook_8c_source.html">audiohook.c</a>.</p>

<p>References <a class="el" href="audiohook_8h_source.html#l00050">AST_AUDIOHOOK_DIRECTION_READ</a>, <a class="el" href="audiohook_8h_source.html#l00051">AST_AUDIOHOOK_DIRECTION_WRITE</a>, <a class="el" href="audiohook_8h_source.html#l00064">AST_AUDIOHOOK_SMALL_QUEUE</a>, <a class="el" href="audiohook_8h_source.html#l00067">AST_AUDIOHOOK_SYNC_TOLERANCE</a>, <a class="el" href="audiohook_8h_source.html#l00056">AST_AUDIOHOOK_TRIGGER_MODE</a>, <a class="el" href="audiohook_8h_source.html#l00057">AST_AUDIOHOOK_TRIGGER_READ</a>, <a class="el" href="audiohook_8h_source.html#l00060">AST_AUDIOHOOK_TRIGGER_SYNC</a>, <a class="el" href="audiohook_8h_source.html#l00058">AST_AUDIOHOOK_TRIGGER_WRITE</a>, <a class="el" href="lock_8h_source.html#l01734">ast_cond_signal()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="slinfactory_8c_source.html#l00192">ast_slinfactory_available()</a>, <a class="el" href="slinfactory_8c_source.html#l00073">ast_slinfactory_feed()</a>, <a class="el" href="slinfactory_8c_source.html#l00197">ast_slinfactory_flush()</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="time_8h_source.html#l00089">ast_tvdiff_ms()</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="logger_8h_source.html#l00119">LOG_DEBUG</a>, <a class="el" href="asterisk_8c_source.html#l00175">option_debug</a>, <a class="el" href="audiohook_8h_source.html#l00094">ast_audiohook::read_factory</a>, <a class="el" href="audiohook_8h_source.html#l00096">ast_audiohook::read_time</a>, <a class="el" href="audiohook_8h_source.html#l00089">ast_audiohook::trigger</a>, <a class="el" href="audiohook_8h_source.html#l00095">ast_audiohook::write_factory</a>, and <a class="el" href="audiohook_8h_source.html#l00097">ast_audiohook::write_time</a>.</p>

<p>Referenced by <a class="el" href="audiohook_8c_source.html#l00582">audio_audiohook_write_list()</a>, and <a class="el" href="app__chanspy_8c_source.html#l00445">channel_spy()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00122"></a>00122 {
<a name="l00123"></a>00123    <span class="keyword">struct </span><a class="code" href="structast__slinfactory.html">ast_slinfactory</a> *factory = (direction == <a class="code" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899a56916f7012e7fe0ec9b6dd4e4c0e2a65">AST_AUDIOHOOK_DIRECTION_READ</a> ? &amp;audiohook-&gt;<a class="code" href="structast__audiohook.html#a72d12418b888e36b3d47a7703d2edced">read_factory</a> : &amp;audiohook-&gt;<a class="code" href="structast__audiohook.html#aecd1ea17a6f1a4cc3bf683296792b262">write_factory</a>);
<a name="l00124"></a>00124    <span class="keyword">struct </span><a class="code" href="structast__slinfactory.html">ast_slinfactory</a> *other_factory = (direction == <a class="code" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899a56916f7012e7fe0ec9b6dd4e4c0e2a65">AST_AUDIOHOOK_DIRECTION_READ</a> ? &amp;audiohook-&gt;<a class="code" href="structast__audiohook.html#aecd1ea17a6f1a4cc3bf683296792b262">write_factory</a> : &amp;audiohook-&gt;<a class="code" href="structast__audiohook.html#a72d12418b888e36b3d47a7703d2edced">read_factory</a>);
<a name="l00125"></a>00125    <span class="keyword">struct </span>timeval *rwtime = (direction == <a class="code" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899a56916f7012e7fe0ec9b6dd4e4c0e2a65">AST_AUDIOHOOK_DIRECTION_READ</a> ? &amp;audiohook-&gt;<a class="code" href="structast__audiohook.html#a384631601a0f954752c9dc823974e2ce">read_time</a> : &amp;audiohook-&gt;<a class="code" href="structast__audiohook.html#a1d0413130ca2d50bf809f74d6e4bfa21">write_time</a>), previous_time = *rwtime;
<a name="l00126"></a>00126    <span class="keywordtype">int</span> our_factory_samples;
<a name="l00127"></a>00127    <span class="keywordtype">int</span> our_factory_ms;
<a name="l00128"></a>00128    <span class="keywordtype">int</span> other_factory_samples;
<a name="l00129"></a>00129    <span class="keywordtype">int</span> other_factory_ms;
<a name="l00130"></a>00130 
<a name="l00131"></a>00131    <span class="comment">/* Update last feeding time to be current */</span>
<a name="l00132"></a>00132    *rwtime = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l00133"></a>00133 
<a name="l00134"></a>00134    our_factory_samples = <a class="code" href="slinfactory_8h.html#a6c48d283b3d2bce6af0a09c3b8b7fd0e" title="Retrieve number of samples currently in a slinfactory.">ast_slinfactory_available</a>(factory);
<a name="l00135"></a>00135    our_factory_ms = <a class="code" href="time_8h.html#a74e35cffcd45ad6cd7c8587921e8a4c2" title="Computes the difference (in milliseconds) between two struct timeval instances.">ast_tvdiff_ms</a>(*rwtime, previous_time) + (our_factory_samples / 8);
<a name="l00136"></a>00136    other_factory_samples = <a class="code" href="slinfactory_8h.html#a6c48d283b3d2bce6af0a09c3b8b7fd0e" title="Retrieve number of samples currently in a slinfactory.">ast_slinfactory_available</a>(other_factory);
<a name="l00137"></a>00137    other_factory_ms = other_factory_samples / 8;
<a name="l00138"></a>00138 
<a name="l00139"></a>00139    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(audiohook, <a class="code" href="audiohook_8h.html#a6d4c98ade1d3dd2e755ffb52b1106951afe01f1fbfa9f1096386a2c7905f2630e">AST_AUDIOHOOK_TRIGGER_SYNC</a>) &amp;&amp; other_factory_samples &amp;&amp; (our_factory_ms - other_factory_ms &gt; <a class="code" href="audiohook_8h.html#a4f988050ac148e5a281fc86313999be6">AST_AUDIOHOOK_SYNC_TOLERANCE</a>)) {
<a name="l00140"></a>00140       <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#ga40f8fb2e731031d99f732f515cec680f">option_debug</a>)
<a name="l00141"></a>00141          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;Flushing audiohook %p so it remains in sync\n&quot;</span>, audiohook);
<a name="l00142"></a>00142       <a class="code" href="slinfactory_8h.html#a808da481a1c8673571179c51a97fb009" title="Flush the contents of a slinfactory.">ast_slinfactory_flush</a>(factory);
<a name="l00143"></a>00143       <a class="code" href="slinfactory_8h.html#a808da481a1c8673571179c51a97fb009" title="Flush the contents of a slinfactory.">ast_slinfactory_flush</a>(other_factory);
<a name="l00144"></a>00144    }
<a name="l00145"></a>00145 
<a name="l00146"></a>00146    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(audiohook, <a class="code" href="audiohook_8h.html#a6d4c98ade1d3dd2e755ffb52b1106951abffa78ee38fcba6555775cd6b5f46622">AST_AUDIOHOOK_SMALL_QUEUE</a>) &amp;&amp; (our_factory_samples &gt; 640 || other_factory_samples &gt; 640)) {
<a name="l00147"></a>00147       <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#ga40f8fb2e731031d99f732f515cec680f">option_debug</a>) {
<a name="l00148"></a>00148          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;Audiohook %p has stale audio in its factories. Flushing them both\n&quot;</span>, audiohook);
<a name="l00149"></a>00149       }
<a name="l00150"></a>00150       <a class="code" href="slinfactory_8h.html#a808da481a1c8673571179c51a97fb009" title="Flush the contents of a slinfactory.">ast_slinfactory_flush</a>(factory);
<a name="l00151"></a>00151       <a class="code" href="slinfactory_8h.html#a808da481a1c8673571179c51a97fb009" title="Flush the contents of a slinfactory.">ast_slinfactory_flush</a>(other_factory);
<a name="l00152"></a>00152    }
<a name="l00153"></a>00153 
<a name="l00154"></a>00154    <span class="comment">/* Write frame out to respective factory */</span>
<a name="l00155"></a>00155    <a class="code" href="slinfactory_8h.html#a83e5056051013853a0d80fc5862a9fe8" title="Feed audio into a slinfactory.">ast_slinfactory_feed</a>(factory, frame);
<a name="l00156"></a>00156 
<a name="l00157"></a>00157    <span class="comment">/* If we need to notify the respective handler of this audiohook, do so */</span>
<a name="l00158"></a>00158    <span class="keywordflow">if</span> ((<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(audiohook, <a class="code" href="audiohook_8h.html#a6d4c98ade1d3dd2e755ffb52b1106951a9114a8e97375acbc3a3202c2d75a9226">AST_AUDIOHOOK_TRIGGER_MODE</a>) == <a class="code" href="audiohook_8h.html#a6d4c98ade1d3dd2e755ffb52b1106951ae6f7d2c4b49d2585445408f917be7e6e">AST_AUDIOHOOK_TRIGGER_READ</a>) &amp;&amp; (direction == <a class="code" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899a56916f7012e7fe0ec9b6dd4e4c0e2a65">AST_AUDIOHOOK_DIRECTION_READ</a>)) {
<a name="l00159"></a>00159       <a class="code" href="lock_8h.html#a02a91e30acdea6d13208d23636d37c87">ast_cond_signal</a>(&amp;audiohook-&gt;<a class="code" href="structast__audiohook.html#a1730983172cdc5373cf60e0e40294fb0">trigger</a>);
<a name="l00160"></a>00160    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(audiohook, <a class="code" href="audiohook_8h.html#a6d4c98ade1d3dd2e755ffb52b1106951a9114a8e97375acbc3a3202c2d75a9226">AST_AUDIOHOOK_TRIGGER_MODE</a>) == <a class="code" href="audiohook_8h.html#a6d4c98ade1d3dd2e755ffb52b1106951af3c73a99c0171f1121551b38cee3d6c6">AST_AUDIOHOOK_TRIGGER_WRITE</a>) &amp;&amp; (direction == <a class="code" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899a8254a5b3fc181d3fe3f2af892010b586">AST_AUDIOHOOK_DIRECTION_WRITE</a>)) {
<a name="l00161"></a>00161       <a class="code" href="lock_8h.html#a02a91e30acdea6d13208d23636d37c87">ast_cond_signal</a>(&amp;audiohook-&gt;<a class="code" href="structast__audiohook.html#a1730983172cdc5373cf60e0e40294fb0">trigger</a>);
<a name="l00162"></a>00162    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(audiohook, <a class="code" href="audiohook_8h.html#a6d4c98ade1d3dd2e755ffb52b1106951afe01f1fbfa9f1096386a2c7905f2630e">AST_AUDIOHOOK_TRIGGER_SYNC</a>)) {
<a name="l00163"></a>00163       <a class="code" href="lock_8h.html#a02a91e30acdea6d13208d23636d37c87">ast_cond_signal</a>(&amp;audiohook-&gt;<a class="code" href="structast__audiohook.html#a1730983172cdc5373cf60e0e40294fb0">trigger</a>);
<a name="l00164"></a>00164    }
<a name="l00165"></a>00165 
<a name="l00166"></a>00166    <span class="keywordflow">return</span> 0;
<a name="l00167"></a>00167 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6351c89eb98b1832e85fa9c0fca7383f"></a><!-- doxytag: member="audiohook.h::ast_audiohook_write_list" ref="a6351c89eb98b1832e85fa9c0fca7383f" args="(struct ast_channel *chan, struct ast_audiohook_list *audiohook_list, enum ast_audiohook_direction direction, struct ast_frame *frame)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__frame.html">ast_frame</a>* ast_audiohook_write_list </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__audiohook__list.html">ast_audiohook_list</a> *&nbsp;</td>
          <td class="paramname"> <em>audiohook_list</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="audiohook_8h.html#a34d75d3d5e7418b6a772e3d522a16899">ast_audiohook_direction</a>&nbsp;</td>
          <td class="paramname"> <em>direction</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td>
          <td class="paramname"> <em>frame</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Pass a frame off to be handled by the audiohook core. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel that the list is coming off of </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>audiohook_list</em>&nbsp;</td><td>List of audiohooks </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>direction</em>&nbsp;</td><td>Direction frame is coming in from </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>frame</em>&nbsp;</td><td>The frame itself </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Return frame on success, NULL on failure </dd></dl>

<p>Definition at line <a class="el" href="audiohook_8c_source.html#l00710">710</a> of file <a class="el" href="audiohook_8c_source.html">audiohook.c</a>.</p>

<p>References <a class="el" href="frame_8h_source.html#l00124">AST_FRAME_DTMF</a>, <a class="el" href="frame_8h_source.html#l00101">AST_FRAME_VOICE</a>, <a class="el" href="audiohook_8c_source.html#l00582">audio_audiohook_write_list()</a>, <a class="el" href="audiohook_8c_source.html#l00553">dtmf_audiohook_write_list()</a>, and <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l02636">__ast_read()</a>, and <a class="el" href="channel_8c_source.html#l03411">ast_write()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00711"></a>00711 {
<a name="l00712"></a>00712    <span class="comment">/* Pass off frame to it&apos;s respective list write function */</span>
<a name="l00713"></a>00713    <span class="keywordflow">if</span> (frame-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>)
<a name="l00714"></a>00714       <span class="keywordflow">return</span> <a class="code" href="audiohook_8c.html#aa670562cb376cb726a122412d173127c" title="Pass an AUDIO frame off to be handled by the audiohook core.">audio_audiohook_write_list</a>(chan, audiohook_list, direction, frame);
<a name="l00715"></a>00715    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (frame-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#a248afd6c02044259a386f6b7aee922a2">AST_FRAME_DTMF</a>)
<a name="l00716"></a>00716       <span class="keywordflow">return</span> <a class="code" href="audiohook_8c.html#a24cd014c45720f22b594db9cda49ee12" title="Pass a DTMF frame off to be handled by the audiohook core.">dtmf_audiohook_write_list</a>(chan, audiohook_list, direction, frame);
<a name="l00717"></a>00717    <span class="keywordflow">else</span>
<a name="l00718"></a>00718       <span class="keywordflow">return</span> frame;
<a name="l00719"></a>00719 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a86f07afe75e6c2405d124d98faaf9800"></a><!-- doxytag: member="audiohook.h::ast_channel_audiohook_count_by_source" ref="a86f07afe75e6c2405d124d98faaf9800" args="(struct ast_channel *chan, const char *source, enum ast_audiohook_type type)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_channel_audiohook_count_by_source </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>source</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="audiohook_8h.html#abce1d2faae234aa016905215014542b0">ast_audiohook_type</a>&nbsp;</td>
          <td class="paramname"> <em>type</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Find out how many audiohooks from a certain source exist on a given channel, regardless of status. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>The channel on which to find the spies </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>source</em>&nbsp;</td><td>The audiohook's source </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>type</em>&nbsp;</td><td>The type of audiohook </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Return the <a class="el" href="structnumber.html" title="Number structure.">number</a> of audiohooks which are from the source specified</dd></dl>
<p>Note: Function performs nlocking. </p>

<p>Definition at line <a class="el" href="audiohook_8c_source.html#l00740">740</a> of file <a class="el" href="audiohook_8c_source.html">audiohook.c</a>.</p>

<p>References <a class="el" href="audiohook_8h_source.html#l00039">AST_AUDIOHOOK_TYPE_MANIPULATE</a>, <a class="el" href="audiohook_8h_source.html#l00037">AST_AUDIOHOOK_TYPE_SPY</a>, <a class="el" href="audiohook_8h_source.html#l00038">AST_AUDIOHOOK_TYPE_WHISPER</a>, <a class="el" href="linkedlists_8h_source.html#l00528">AST_LIST_TRAVERSE_SAFE_BEGIN</a>, <a class="el" href="linkedlists_8h_source.html#l00599">AST_LIST_TRAVERSE_SAFE_END</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8h_source.html#l00421">ast_channel::audiohooks</a>, <a class="el" href="logger_8h_source.html#l00119">LOG_DEBUG</a>, <a class="el" href="structast__audiohook__list.html#acdea2991ba0b3828e72ba3d936aa33dd">ast_audiohook_list::manipulate_list</a>, <a class="el" href="audiohook_8h_source.html#l00092">ast_audiohook::source</a>, <a class="el" href="structast__audiohook__list.html#ab1b7108d32768b87015db450e753302c">ast_audiohook_list::spy_list</a>, and <a class="el" href="structast__audiohook__list.html#a463b768292e522f67f80733d5dc1c5e0">ast_audiohook_list::whisper_list</a>.</p>

<p>Referenced by <a class="el" href="features_8c_source.html#l01105">builtin_automixmonitor()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00741"></a>00741 {
<a name="l00742"></a>00742    <span class="keywordtype">int</span> count = 0;
<a name="l00743"></a>00743    <span class="keyword">struct </span><a class="code" href="structast__audiohook.html">ast_audiohook</a> *ah = NULL;
<a name="l00744"></a>00744 
<a name="l00745"></a>00745    <span class="keywordflow">if</span> (!chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>)
<a name="l00746"></a>00746       <span class="keywordflow">return</span> -1;
<a name="l00747"></a>00747 
<a name="l00748"></a>00748    <span class="keywordflow">switch</span> (<a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>) {
<a name="l00749"></a>00749       <span class="keywordflow">case</span> <a class="code" href="audiohook_8h.html#abce1d2faae234aa016905215014542b0a29865bbf4732a7e78748db47b91e46f5">AST_AUDIOHOOK_TYPE_SPY</a>:
<a name="l00750"></a>00750          <a class="code" href="linkedlists_8h.html#aa5be52067bf16bdc7e56ca19b5ba858d" title="Loops safely over (traverses) the entries in a list.">AST_LIST_TRAVERSE_SAFE_BEGIN</a>(&amp;chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>-&gt;<a class="code" href="structast__audiohook__list.html#ab1b7108d32768b87015db450e753302c">spy_list</a>, ah, list) {
<a name="l00751"></a>00751             <span class="keywordflow">if</span> (!strcmp(ah-&gt;<a class="code" href="structast__audiohook.html#af2ed45b90afa2ef4ec6e09625335a082">source</a>, <a class="code" href="structast__audiohook.html#af2ed45b90afa2ef4ec6e09625335a082">source</a>)) {
<a name="l00752"></a>00752                count++;
<a name="l00753"></a>00753             }
<a name="l00754"></a>00754          }
<a name="l00755"></a>00755          <a class="code" href="linkedlists_8h.html#a712c04b4493919a7052399cd30ee8fb9" title="Closes a safe loop traversal block.">AST_LIST_TRAVERSE_SAFE_END</a>;
<a name="l00756"></a>00756          <span class="keywordflow">break</span>;
<a name="l00757"></a>00757       <span class="keywordflow">case</span> <a class="code" href="audiohook_8h.html#abce1d2faae234aa016905215014542b0aecdafbcdb7048512d25cd19089198edd">AST_AUDIOHOOK_TYPE_WHISPER</a>:
<a name="l00758"></a>00758          <a class="code" href="linkedlists_8h.html#aa5be52067bf16bdc7e56ca19b5ba858d" title="Loops safely over (traverses) the entries in a list.">AST_LIST_TRAVERSE_SAFE_BEGIN</a>(&amp;chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>-&gt;<a class="code" href="structast__audiohook__list.html#a463b768292e522f67f80733d5dc1c5e0">whisper_list</a>, ah, list) {
<a name="l00759"></a>00759             <span class="keywordflow">if</span> (!strcmp(ah-&gt;<a class="code" href="structast__audiohook.html#af2ed45b90afa2ef4ec6e09625335a082">source</a>, <a class="code" href="structast__audiohook.html#af2ed45b90afa2ef4ec6e09625335a082">source</a>)) {
<a name="l00760"></a>00760                count++;
<a name="l00761"></a>00761             }
<a name="l00762"></a>00762          }
<a name="l00763"></a>00763          <a class="code" href="linkedlists_8h.html#a712c04b4493919a7052399cd30ee8fb9" title="Closes a safe loop traversal block.">AST_LIST_TRAVERSE_SAFE_END</a>;
<a name="l00764"></a>00764          <span class="keywordflow">break</span>;
<a name="l00765"></a>00765       <span class="keywordflow">case</span> <a class="code" href="audiohook_8h.html#abce1d2faae234aa016905215014542b0a20dda44508f42e63dc8ed45760affe08">AST_AUDIOHOOK_TYPE_MANIPULATE</a>:
<a name="l00766"></a>00766          <a class="code" href="linkedlists_8h.html#aa5be52067bf16bdc7e56ca19b5ba858d" title="Loops safely over (traverses) the entries in a list.">AST_LIST_TRAVERSE_SAFE_BEGIN</a>(&amp;chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>-&gt;<a class="code" href="structast__audiohook__list.html#acdea2991ba0b3828e72ba3d936aa33dd">manipulate_list</a>, ah, list) {
<a name="l00767"></a>00767             <span class="keywordflow">if</span> (!strcmp(ah-&gt;<a class="code" href="structast__audiohook.html#af2ed45b90afa2ef4ec6e09625335a082">source</a>, <a class="code" href="structast__audiohook.html#af2ed45b90afa2ef4ec6e09625335a082">source</a>)) {
<a name="l00768"></a>00768                count++;
<a name="l00769"></a>00769             }
<a name="l00770"></a>00770          }
<a name="l00771"></a>00771          <a class="code" href="linkedlists_8h.html#a712c04b4493919a7052399cd30ee8fb9" title="Closes a safe loop traversal block.">AST_LIST_TRAVERSE_SAFE_END</a>;
<a name="l00772"></a>00772          <span class="keywordflow">break</span>;
<a name="l00773"></a>00773       <span class="keywordflow">default</span>:
<a name="l00774"></a>00774          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;Invalid audiohook type supplied, (%d)\n&quot;</span>, <a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>);
<a name="l00775"></a>00775          <span class="keywordflow">return</span> -1;
<a name="l00776"></a>00776    }
<a name="l00777"></a>00777 
<a name="l00778"></a>00778    <span class="keywordflow">return</span> count;
<a name="l00779"></a>00779 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9c85bb250bc65d74fecce3a388ef30bd"></a><!-- doxytag: member="audiohook.h::ast_channel_audiohook_count_by_source_running" ref="a9c85bb250bc65d74fecce3a388ef30bd" args="(struct ast_channel *chan, const char *source, enum ast_audiohook_type type)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_channel_audiohook_count_by_source_running </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>source</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="audiohook_8h.html#abce1d2faae234aa016905215014542b0">ast_audiohook_type</a>&nbsp;</td>
          <td class="paramname"> <em>type</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Find out how many spies of a certain type exist on a given channel, and are in <a class="el" href="structstate.html">state</a> running. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>The channel on which to find the spies </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>source</em>&nbsp;</td><td>The source of the audiohook </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>type</em>&nbsp;</td><td>The type of spy to look for </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Return the <a class="el" href="structnumber.html" title="Number structure.">number</a> of running audiohooks which are from the source specified</dd></dl>
<p>Note: Function performs no locking. </p>

<p>Definition at line <a class="el" href="audiohook_8c_source.html#l00782">782</a> of file <a class="el" href="audiohook_8c_source.html">audiohook.c</a>.</p>

<p>References <a class="el" href="audiohook_8h_source.html#l00044">AST_AUDIOHOOK_STATUS_RUNNING</a>, <a class="el" href="audiohook_8h_source.html#l00039">AST_AUDIOHOOK_TYPE_MANIPULATE</a>, <a class="el" href="audiohook_8h_source.html#l00037">AST_AUDIOHOOK_TYPE_SPY</a>, <a class="el" href="audiohook_8h_source.html#l00038">AST_AUDIOHOOK_TYPE_WHISPER</a>, <a class="el" href="linkedlists_8h_source.html#l00528">AST_LIST_TRAVERSE_SAFE_BEGIN</a>, <a class="el" href="linkedlists_8h_source.html#l00599">AST_LIST_TRAVERSE_SAFE_END</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8h_source.html#l00421">ast_channel::audiohooks</a>, <a class="el" href="logger_8h_source.html#l00119">LOG_DEBUG</a>, <a class="el" href="structast__audiohook__list.html#acdea2991ba0b3828e72ba3d936aa33dd">ast_audiohook_list::manipulate_list</a>, <a class="el" href="audiohook_8h_source.html#l00092">ast_audiohook::source</a>, <a class="el" href="structast__audiohook__list.html#ab1b7108d32768b87015db450e753302c">ast_audiohook_list::spy_list</a>, <a class="el" href="audiohook_8h_source.html#l00091">ast_audiohook::status</a>, and <a class="el" href="structast__audiohook__list.html#a463b768292e522f67f80733d5dc1c5e0">ast_audiohook_list::whisper_list</a>.</p>

<p>Referenced by <a class="el" href="features_8c_source.html#l01105">builtin_automixmonitor()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00783"></a>00783 {
<a name="l00784"></a>00784    <span class="keywordtype">int</span> count = 0;
<a name="l00785"></a>00785    <span class="keyword">struct </span><a class="code" href="structast__audiohook.html">ast_audiohook</a> *ah = NULL;
<a name="l00786"></a>00786    <span class="keywordflow">if</span> (!chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>)
<a name="l00787"></a>00787       <span class="keywordflow">return</span> -1;
<a name="l00788"></a>00788 
<a name="l00789"></a>00789    <span class="keywordflow">switch</span> (<a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>) {
<a name="l00790"></a>00790       <span class="keywordflow">case</span> <a class="code" href="audiohook_8h.html#abce1d2faae234aa016905215014542b0a29865bbf4732a7e78748db47b91e46f5">AST_AUDIOHOOK_TYPE_SPY</a>:
<a name="l00791"></a>00791          <a class="code" href="linkedlists_8h.html#aa5be52067bf16bdc7e56ca19b5ba858d" title="Loops safely over (traverses) the entries in a list.">AST_LIST_TRAVERSE_SAFE_BEGIN</a>(&amp;chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>-&gt;<a class="code" href="structast__audiohook__list.html#ab1b7108d32768b87015db450e753302c">spy_list</a>, ah, list) {
<a name="l00792"></a>00792             <span class="keywordflow">if</span> ((!strcmp(ah-&gt;<a class="code" href="structast__audiohook.html#af2ed45b90afa2ef4ec6e09625335a082">source</a>, <a class="code" href="structast__audiohook.html#af2ed45b90afa2ef4ec6e09625335a082">source</a>)) &amp;&amp; (ah-&gt;<a class="code" href="structast__audiohook.html#a9c2c1a66c786d5e486ac428388d62e28">status</a> == <a class="code" href="audiohook_8h.html#acf2dd361123daa6446ade7c7ecfe55adabcc7793ac9fbdcaa9e727aacfda27f26">AST_AUDIOHOOK_STATUS_RUNNING</a>))
<a name="l00793"></a>00793                count++;
<a name="l00794"></a>00794          }
<a name="l00795"></a>00795          <a class="code" href="linkedlists_8h.html#a712c04b4493919a7052399cd30ee8fb9" title="Closes a safe loop traversal block.">AST_LIST_TRAVERSE_SAFE_END</a>;
<a name="l00796"></a>00796          <span class="keywordflow">break</span>;
<a name="l00797"></a>00797       <span class="keywordflow">case</span> <a class="code" href="audiohook_8h.html#abce1d2faae234aa016905215014542b0aecdafbcdb7048512d25cd19089198edd">AST_AUDIOHOOK_TYPE_WHISPER</a>:
<a name="l00798"></a>00798          <a class="code" href="linkedlists_8h.html#aa5be52067bf16bdc7e56ca19b5ba858d" title="Loops safely over (traverses) the entries in a list.">AST_LIST_TRAVERSE_SAFE_BEGIN</a>(&amp;chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>-&gt;<a class="code" href="structast__audiohook__list.html#a463b768292e522f67f80733d5dc1c5e0">whisper_list</a>, ah, list) {
<a name="l00799"></a>00799             <span class="keywordflow">if</span> ((!strcmp(ah-&gt;<a class="code" href="structast__audiohook.html#af2ed45b90afa2ef4ec6e09625335a082">source</a>, <a class="code" href="structast__audiohook.html#af2ed45b90afa2ef4ec6e09625335a082">source</a>)) &amp;&amp; (ah-&gt;<a class="code" href="structast__audiohook.html#a9c2c1a66c786d5e486ac428388d62e28">status</a> == <a class="code" href="audiohook_8h.html#acf2dd361123daa6446ade7c7ecfe55adabcc7793ac9fbdcaa9e727aacfda27f26">AST_AUDIOHOOK_STATUS_RUNNING</a>))
<a name="l00800"></a>00800                count++;
<a name="l00801"></a>00801          }
<a name="l00802"></a>00802          <a class="code" href="linkedlists_8h.html#a712c04b4493919a7052399cd30ee8fb9" title="Closes a safe loop traversal block.">AST_LIST_TRAVERSE_SAFE_END</a>;
<a name="l00803"></a>00803          <span class="keywordflow">break</span>;
<a name="l00804"></a>00804       <span class="keywordflow">case</span> <a class="code" href="audiohook_8h.html#abce1d2faae234aa016905215014542b0a20dda44508f42e63dc8ed45760affe08">AST_AUDIOHOOK_TYPE_MANIPULATE</a>:
<a name="l00805"></a>00805          <a class="code" href="linkedlists_8h.html#aa5be52067bf16bdc7e56ca19b5ba858d" title="Loops safely over (traverses) the entries in a list.">AST_LIST_TRAVERSE_SAFE_BEGIN</a>(&amp;chan-&gt;<a class="code" href="structast__channel.html#adb878b3a8ff24d396a59dda13418a301">audiohooks</a>-&gt;<a class="code" href="structast__audiohook__list.html#acdea2991ba0b3828e72ba3d936aa33dd">manipulate_list</a>, ah, list) {
<a name="l00806"></a>00806             <span class="keywordflow">if</span> ((!strcmp(ah-&gt;<a class="code" href="structast__audiohook.html#af2ed45b90afa2ef4ec6e09625335a082">source</a>, <a class="code" href="structast__audiohook.html#af2ed45b90afa2ef4ec6e09625335a082">source</a>)) &amp;&amp; (ah-&gt;<a class="code" href="structast__audiohook.html#a9c2c1a66c786d5e486ac428388d62e28">status</a> == <a class="code" href="audiohook_8h.html#acf2dd361123daa6446ade7c7ecfe55adabcc7793ac9fbdcaa9e727aacfda27f26">AST_AUDIOHOOK_STATUS_RUNNING</a>))
<a name="l00807"></a>00807                count++;
<a name="l00808"></a>00808          }
<a name="l00809"></a>00809          <a class="code" href="linkedlists_8h.html#a712c04b4493919a7052399cd30ee8fb9" title="Closes a safe loop traversal block.">AST_LIST_TRAVERSE_SAFE_END</a>;
<a name="l00810"></a>00810          <span class="keywordflow">break</span>;
<a name="l00811"></a>00811       <span class="keywordflow">default</span>:
<a name="l00812"></a>00812          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;Invalid audiohook type supplied, (%d)\n&quot;</span>, <a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>);
<a name="l00813"></a>00813          <span class="keywordflow">return</span> -1;
<a name="l00814"></a>00814    }
<a name="l00815"></a>00815    <span class="keywordflow">return</span> count;
<a name="l00816"></a>00816 }
</pre></div></p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:19:40 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
