<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:23:40 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li class="current"><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="classes.html"><span>Data&nbsp;Structure&nbsp;Index</span></a></li>
      <li><a href="functions.html"><span>Data&nbsp;Fields</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>ao2_iterator Struct Reference</h1><!-- doxytag: class="ao2_iterator" -->
<p>When we need to walk through a container, we use an <a class="el" href="structao2__iterator.html" title="When we need to walk through a container, we use an ao2_iterator to keep track of...">ao2_iterator</a> to keep track of the current position.  
<a href="#_details">More...</a></p>

<p><code>#include &lt;<a class="el" href="astobj2_8h_source.html">astobj2.h</a>&gt;</code></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Fields</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structao2__iterator.html#af3b6402e08f8dd9f3302dac6289d8088">bucket</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structao2__container.html">ao2_container</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structao2__iterator.html#add66ef9875bb0ff1bd4747707d6f3333">c</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structao2__iterator.html#a31c8806ca907e988690301fd352fa1a3">c_version</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structao2__iterator.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structao2__iterator.html#aa919482768c0eac179575481f77e0fa3">obj</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structao2__iterator.html#a5408ac5df4c170828874e1b10b4c35a0">version</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>When we need to walk through a container, we use an <a class="el" href="structao2__iterator.html" title="When we need to walk through a container, we use an ao2_iterator to keep track of...">ao2_iterator</a> to keep track of the current position. </p>
<p>Because the navigation is typically done without holding the lock on the container across the loop, objects can be inserted or deleted or moved while we work. As a consequence, there is no guarantee that we manage to touch all the elements in the container, and it is possible that we touch the same object multiple times.</p>
<p>However, within the current hash table container, the following is true:</p>
<ul>
<li>It is not possible to miss an object in the container while iterating unless it gets added after the iteration begins and is added to a <a class="el" href="structbucket.html">bucket</a> that is before the one the current object is in. In this case, even if you locked the container around the entire iteration loop, you still would not see this object, because it would still be waiting on the container lock so that it can be added.</li>
<li>It would be extremely rare to see an object twice. The only way this can happen is if an object got unlinked from the container and added again during the same iteration. Furthermore, when the object gets added back, it has to be in the current or later <a class="el" href="structbucket.html">bucket</a> for it to be seen again.</li>
</ul>
<p>An iterator must be first initialized with <a class="el" href="astobj2_8h.html#a288075de687152d297308ea1ea963edb" title="Create an iterator for a container.">ao2_iterator_init()</a>, then we can use o = <a class="el" href="astobj2_8h.html#a1cf2fe1aafd3cb9e613eb48535a37ad5">ao2_iterator_next()</a> to move from one element to the next. Remember that the object returned by <a class="el" href="astobj2_8h.html#a1cf2fe1aafd3cb9e613eb48535a37ad5">ao2_iterator_next()</a> has its refcount incremented, and the reference must be explicitly released when done with it.</p>
<p>In addition, <a class="el" href="astobj2_8h.html#a288075de687152d297308ea1ea963edb" title="Create an iterator for a container.">ao2_iterator_init()</a> will hold a reference to the container being iterated, which will be freed when <a class="el" href="astobj2_8h.html#a62d5d9e9d0fa281168e6a08ef4a52450" title="Destroy a container iterator.">ao2_iterator_destroy()</a> is called to free up the resources used by the iterator (if any).</p>
<p>Example:</p>
<div class="fragment"><pre class="fragment">  <span class="keyword">struct </span><a class="code" href="structao2__container.html">ao2_container</a> *<a class="code" href="structao2__iterator.html#add66ef9875bb0ff1bd4747707d6f3333">c</a> = ... <span class="comment">// the container we want to iterate on</span>
  <span class="keyword">struct </span><a class="code" href="structao2__iterator.html" title="When we need to walk through a container, we use an ao2_iterator to keep track of...">ao2_iterator</a> i;
  <span class="keyword">struct </span>my_obj *o;

  i = <a class="code" href="astobj2_8h.html#a288075de687152d297308ea1ea963edb" title="Create an iterator for a container.">ao2_iterator_init</a>(c, <a class="code" href="structao2__iterator.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a>);

  <span class="keywordflow">while</span> ( (o = <a class="code" href="astobj2_8h.html#a1cf2fe1aafd3cb9e613eb48535a37ad5">ao2_iterator_next</a>(&amp;i)) ) {
     ... <span class="keywordflow">do</span> something on o ...
     <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(o, -1);
  }

  <a class="code" href="astobj2_8h.html#a62d5d9e9d0fa281168e6a08ef4a52450" title="Destroy a container iterator.">ao2_iterator_destroy</a>(&amp;i);
</pre></div><p>The <a class="el" href="structastobj2.html">astobj2</a> iterator </p>
<dl class="note"><dt><b>Note:</b></dt><dd>You are not supposed to know the internals of an iterator! We would like the iterator to be opaque, unfortunately its size needs to be known if we want to store it around without too much trouble. Anyways... The iterator has a pointer to the container, and a flags field specifying various things e.g. whether the container should be locked or not while navigating on it. The iterator "points" to the current object, which is identified by three <a class="el" href="structvalues.html">values</a>:</dd></dl>
<ul>
<li>a <a class="el" href="structbucket.html">bucket</a> <a class="el" href="structnumber.html" title="Number structure.">number</a>;</li>
<li>the object_id, which is also the container version <a class="el" href="structnumber.html" title="Number structure.">number</a> when the object was inserted. This identifies the object uniquely, however reaching the desired object requires scanning a list.</li>
<li>a pointer, and a container version when we saved the pointer. If the container has not changed its version <a class="el" href="structnumber.html" title="Number structure.">number</a>, then we can safely follow the pointer to reach the object in constant time.</li>
</ul>
<p>Details are in the implementation of <a class="el" href="astobj2_8h.html#a1cf2fe1aafd3cb9e613eb48535a37ad5">ao2_iterator_next()</a> A freshly-initialized iterator has bucket=0, version=0. </p>

<p>Definition at line <a class="el" href="astobj2_8h_source.html#l01056">1056</a> of file <a class="el" href="astobj2_8h_source.html">astobj2.h</a>.</p>
<hr/><h2>Field Documentation</h2>
<a class="anchor" id="af3b6402e08f8dd9f3302dac6289d8088"></a><!-- doxytag: member="ao2_iterator::bucket" ref="af3b6402e08f8dd9f3302dac6289d8088" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="structbucket.html">bucket</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>current <a class="el" href="structbucket.html">bucket</a> </p>

<p>Definition at line <a class="el" href="astobj2_8h_source.html#l01062">1062</a> of file <a class="el" href="astobj2_8h_source.html">astobj2.h</a>.</p>

<p>Referenced by <a class="el" href="astobj2_8c_source.html#l00804">__ao2_iterator_next()</a>.</p>

</div>
</div>
<a class="anchor" id="add66ef9875bb0ff1bd4747707d6f3333"></a><!-- doxytag: member="ao2_iterator::c" ref="add66ef9875bb0ff1bd4747707d6f3333" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structao2__container.html">ao2_container</a>* <a class="el" href="structao2__iterator.html#add66ef9875bb0ff1bd4747707d6f3333">c</a><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>the container </p>

<p>Definition at line <a class="el" href="astobj2_8h_source.html#l01058">1058</a> of file <a class="el" href="astobj2_8h_source.html">astobj2.h</a>.</p>

<p>Referenced by <a class="el" href="astobj2_8c_source.html#l00804">__ao2_iterator_next()</a>, <a class="el" href="astobj2_8c_source.html#l00877">_ao2_iterator_next()</a>, <a class="el" href="astobj2_8c_source.html#l00859">_ao2_iterator_next_debug()</a>, <a class="el" href="astobj2_8c_source.html#l00795">ao2_iterator_destroy()</a>, and <a class="el" href="astobj2_8c_source.html#l00780">ao2_iterator_init()</a>.</p>

</div>
</div>
<a class="anchor" id="a31c8806ca907e988690301fd352fa1a3"></a><!-- doxytag: member="ao2_iterator::c_version" ref="a31c8806ca907e988690301fd352fa1a3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int <a class="el" href="structao2__iterator.html#a31c8806ca907e988690301fd352fa1a3">c_version</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>container version </p>

<p>Definition at line <a class="el" href="astobj2_8h_source.html#l01064">1064</a> of file <a class="el" href="astobj2_8h_source.html">astobj2.h</a>.</p>

<p>Referenced by <a class="el" href="astobj2_8c_source.html#l00804">__ao2_iterator_next()</a>.</p>

</div>
</div>
<a class="anchor" id="ac8bf36fe0577cba66bccda3a6f7e80a4"></a><!-- doxytag: member="ao2_iterator::flags" ref="ac8bf36fe0577cba66bccda3a6f7e80a4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="structao2__iterator.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>operation flags </p>

<p>Definition at line <a class="el" href="astobj2_8h_source.html#l01060">1060</a> of file <a class="el" href="astobj2_8h_source.html">astobj2.h</a>.</p>

<p>Referenced by <a class="el" href="astobj2_8c_source.html#l00804">__ao2_iterator_next()</a>, <a class="el" href="astobj2_8c_source.html#l00877">_ao2_iterator_next()</a>, <a class="el" href="astobj2_8c_source.html#l00859">_ao2_iterator_next_debug()</a>, and <a class="el" href="astobj2_8c_source.html#l00780">ao2_iterator_init()</a>.</p>

</div>
</div>
<a class="anchor" id="aa919482768c0eac179575481f77e0fa3"></a><!-- doxytag: member="ao2_iterator::obj" ref="aa919482768c0eac179575481f77e0fa3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* <a class="el" href="structao2__iterator.html#aa919482768c0eac179575481f77e0fa3">obj</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>pointer to the current object </p>

<p>Definition at line <a class="el" href="astobj2_8h_source.html#l01066">1066</a> of file <a class="el" href="astobj2_8h_source.html">astobj2.h</a>.</p>

<p>Referenced by <a class="el" href="astobj2_8c_source.html#l00804">__ao2_iterator_next()</a>.</p>

</div>
</div>
<a class="anchor" id="a5408ac5df4c170828874e1b10b4c35a0"></a><!-- doxytag: member="ao2_iterator::version" ref="a5408ac5df4c170828874e1b10b4c35a0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int <a class="el" href="structao2__iterator.html#a5408ac5df4c170828874e1b10b4c35a0">version</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>container version when the object was created </p>

<p>Definition at line <a class="el" href="astobj2_8h_source.html#l01068">1068</a> of file <a class="el" href="astobj2_8h_source.html">astobj2.h</a>.</p>

<p>Referenced by <a class="el" href="astobj2_8c_source.html#l00804">__ao2_iterator_next()</a>.</p>

</div>
</div>
<hr/>The documentation for this struct was generated from the following file:<ul>
<li><a class="el" href="astobj2_8h_source.html">astobj2.h</a></li>
</ul>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:23:40 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
