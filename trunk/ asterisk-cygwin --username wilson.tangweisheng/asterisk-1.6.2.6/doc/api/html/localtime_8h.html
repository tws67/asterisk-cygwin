<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:22:19 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_1ab815038f534adda65c8b4ae4993449.html">include</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_16d825f1fa9ecca2e70b1a8d9256d0e6.html">asterisk</a>
  </div>
</div>
<div class="contents">
<h1>localtime.h File Reference</h1>
<p>Custom localtime functions for multiple timezones.  
<a href="#_details">More...</a></p>

<p><a href="localtime_8h_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__tm.html">ast_tm</a></td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="localtime_8h.html#aad52af6afe205a03aecf3fa6518dbdb0">ast_get_dst_info</a> (const time_t *const timep, int *dst_enabled, time_t *dst_start, time_t *dst_end, int *gmt_off, const char *const zone)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__tm.html">ast_tm</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="localtime_8h.html#ae9fbda728350a9a5b9c09b29214d718e">ast_localtime</a> (const struct timeval *timep, struct <a class="el" href="structast__tm.html">ast_tm</a> *p_tm, const char *zone)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Timezone-independent version of <a class="el" href="utils_8h.html#a9e7c6104cccbed67c8f0fd510cd5c099">localtime_r(3)</a>.  <a href="#ae9fbda728350a9a5b9c09b29214d718e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct timeval&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="localtime_8h.html#ae0843e4dbbd1fed36d2676dda58e0c44">ast_mktime</a> (struct <a class="el" href="structast__tm.html">ast_tm</a> *const tmp, const char *zone)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Timezone-independent version of mktime(3).  <a href="#ae0843e4dbbd1fed36d2676dda58e0c44"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="localtime_8h.html#aa8e63928b14a347bd3973d680b885f93">ast_strftime</a> (char *<a class="el" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, size_t len, const char *<a class="el" href="chan__alsa_8c.html#a98f5e70e98f6dc48e3c5ba316066d540">format</a>, const struct <a class="el" href="structast__tm.html">ast_tm</a> *tm)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Special version of strftime(3) that handles fractions of a second. Takes the same arguments as strftime(3), with the addition of q, which specifies microseconds.  <a href="#aa8e63928b14a347bd3973d680b885f93"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="localtime_8h.html#a3eb2c73accce1b149ce597de80d1677a">ast_strptime</a> (const char *s, const char *<a class="el" href="chan__alsa_8c.html#a98f5e70e98f6dc48e3c5ba316066d540">format</a>, struct <a class="el" href="structast__tm.html">ast_tm</a> *tm)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Special version of strptime(3) which places the answer in the common structure <a class="el" href="structast__tm.html">ast_tm</a>. Also, unlike strptime(3), <a class="el" href="localtime_8h.html#a3eb2c73accce1b149ce597de80d1677a" title="Special version of strptime(3) which places the answer in the common structure ast_tm...">ast_strptime()</a> initializes its memory prior to use.  <a href="#a3eb2c73accce1b149ce597de80d1677a"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Custom localtime functions for multiple timezones. </p>

<p>Definition in file <a class="el" href="localtime_8h_source.html">localtime.h</a>.</p>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="aad52af6afe205a03aecf3fa6518dbdb0"></a><!-- doxytag: member="localtime.h::ast_get_dst_info" ref="aad52af6afe205a03aecf3fa6518dbdb0" args="(const time_t *const timep, int *dst_enabled, time_t *dst_start, time_t *dst_end, int *gmt_off, const char *const zone)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_get_dst_info </td>
          <td>(</td>
          <td class="paramtype">const time_t *const &nbsp;</td>
          <td class="paramname"> <em>timep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>dst_enabled</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t *&nbsp;</td>
          <td class="paramname"> <em>dst_start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t *&nbsp;</td>
          <td class="paramname"> <em>dst_end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>gmt_off</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const &nbsp;</td>
          <td class="paramname"> <em>zone</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="localtime_8c_source.html#l01320">1320</a> of file <a class="el" href="localtime_8c_source.html">localtime.c</a>.</p>

<p>References <a class="el" href="localtime_8c_source.html#l01175">ast_tzset()</a>, <a class="el" href="localtime_8c_source.html#l00147">state::ats</a>, <a class="el" href="private_8h_source.html#l00343">AVGSECSPERYEAR</a>, <a class="el" href="localtime_8c_source.html#l00146">state::goahead</a>, <a class="el" href="localtime_8c_source.html#l00145">state::goback</a>, <a class="el" href="localtime_8c_source.html#l00142">state::timecnt</a>, <a class="el" href="localtime_8c_source.html#l00113">ttinfo::tt_gmtoff</a>, <a class="el" href="localtime_8c_source.html#l00114">ttinfo::tt_isdst</a>, <a class="el" href="localtime_8c_source.html#l00149">state::ttis</a>, <a class="el" href="localtime_8c_source.html#l00143">state::typecnt</a>, <a class="el" href="localtime_8c_source.html#l00148">state::types</a>, and <a class="el" href="private_8h_source.html#l00335">YEARSPERREPEAT</a>.</p>

<p>Referenced by <a class="el" href="res__phoneprov_8c_source.html#l00344">set_timezone_variables()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01321"></a>01321 {
<a name="l01322"></a>01322    <span class="keywordtype">int</span> i;   
<a name="l01323"></a>01323    <span class="keywordtype">int</span> transition1 = -1;
<a name="l01324"></a>01324    <span class="keywordtype">int</span> transition2 = -1;
<a name="l01325"></a>01325    time_t      seconds;
<a name="l01326"></a>01326    <span class="keywordtype">int</span>  bounds_exceeded = 0;
<a name="l01327"></a>01327    time_t  t = *timep;
<a name="l01328"></a>01328    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structstate.html">state</a> *sp;
<a name="l01329"></a>01329    
<a name="l01330"></a>01330    <span class="keywordflow">if</span> (NULL == dst_enabled)
<a name="l01331"></a>01331       <span class="keywordflow">return</span>;
<a name="l01332"></a>01332    *dst_enabled = 0;
<a name="l01333"></a>01333 
<a name="l01334"></a>01334    <span class="keywordflow">if</span> (NULL == dst_start || NULL == dst_end || NULL == gmt_off)
<a name="l01335"></a>01335       <span class="keywordflow">return</span>;
<a name="l01336"></a>01336 
<a name="l01337"></a>01337    *gmt_off = 0; 
<a name="l01338"></a>01338    
<a name="l01339"></a>01339    sp = <a class="code" href="localtime_8c.html#a965846adf8ba00b83dad4f1870e2864c">ast_tzset</a>(zone);
<a name="l01340"></a>01340    <span class="keywordflow">if</span> (NULL == sp) 
<a name="l01341"></a>01341       <span class="keywordflow">return</span>;
<a name="l01342"></a>01342    
<a name="l01343"></a>01343    <span class="comment">/* If the desired time exceeds the bounds of the defined time transitions  </span>
<a name="l01344"></a>01344 <span class="comment">   * then give give up on determining DST info and simply look for gmt offset </span>
<a name="l01345"></a>01345 <span class="comment">   * This requires that I adjust the given time using increments of Gregorian </span>
<a name="l01346"></a>01346 <span class="comment">   * repeats to place the time within the defined time transitions in the </span>
<a name="l01347"></a>01347 <span class="comment">   * timezone structure.  </span>
<a name="l01348"></a>01348 <span class="comment">   */</span>
<a name="l01349"></a>01349    <span class="keywordflow">if</span> ((sp-&gt;<a class="code" href="structstate.html#a2673165d739a554bca5de774c50e4be1">goback</a> &amp;&amp; t &lt; sp-&gt;<a class="code" href="structstate.html#a4509623ad925758e6f33ead8935ab268">ats</a>[0]) ||
<a name="l01350"></a>01350          (sp-&gt;<a class="code" href="structstate.html#ac9ff4ce036117be2251d8e4e4c02fd46">goahead</a> &amp;&amp; t &gt; sp-&gt;<a class="code" href="structstate.html#a4509623ad925758e6f33ead8935ab268">ats</a>[sp-&gt;<a class="code" href="structstate.html#a6035af427143aa9f018d1dbf499d1c1b">timecnt</a> - 1])) {
<a name="l01351"></a>01351       time_t      tcycles;
<a name="l01352"></a>01352       <a class="code" href="private_8h.html#af5900ccb937acd8e8e52f40fe38b204d">int_fast64_t</a>   icycles;
<a name="l01353"></a>01353 
<a name="l01354"></a>01354       <span class="keywordflow">if</span> (t &lt; sp-&gt;ats[0])
<a name="l01355"></a>01355          seconds = sp-&gt;<a class="code" href="structstate.html#a4509623ad925758e6f33ead8935ab268">ats</a>[0] - t;
<a name="l01356"></a>01356       <span class="keywordflow">else</span>  seconds = t - sp-&gt;<a class="code" href="structstate.html#a4509623ad925758e6f33ead8935ab268">ats</a>[sp-&gt;<a class="code" href="structstate.html#a6035af427143aa9f018d1dbf499d1c1b">timecnt</a> - 1];
<a name="l01357"></a>01357       --seconds;
<a name="l01358"></a>01358       tcycles = seconds / <a class="code" href="private_8h.html#abfda64cd9c2adcfb0d9d7780f06e08a5">YEARSPERREPEAT</a> / <a class="code" href="private_8h.html#a43037bd5c750ed5100b35d2dda4c4ea0">AVGSECSPERYEAR</a>;
<a name="l01359"></a>01359       ++tcycles;
<a name="l01360"></a>01360       icycles = tcycles;
<a name="l01361"></a>01361       <span class="keywordflow">if</span> (tcycles - icycles &gt;= 1 || icycles - tcycles &gt;= 1)
<a name="l01362"></a>01362          <span class="keywordflow">return</span>;
<a name="l01363"></a>01363       seconds = icycles;
<a name="l01364"></a>01364       seconds *= <a class="code" href="private_8h.html#abfda64cd9c2adcfb0d9d7780f06e08a5">YEARSPERREPEAT</a>;
<a name="l01365"></a>01365       seconds *= <a class="code" href="private_8h.html#a43037bd5c750ed5100b35d2dda4c4ea0">AVGSECSPERYEAR</a>;
<a name="l01366"></a>01366       <span class="keywordflow">if</span> (t &lt; sp-&gt;ats[0])
<a name="l01367"></a>01367          t += seconds;
<a name="l01368"></a>01368       <span class="keywordflow">else</span>
<a name="l01369"></a>01369          t -= seconds;
<a name="l01370"></a>01370       
<a name="l01371"></a>01371       <span class="keywordflow">if</span> (t &lt; sp-&gt;ats[0] || t &gt; sp-&gt;<a class="code" href="structstate.html#a4509623ad925758e6f33ead8935ab268">ats</a>[sp-&gt;<a class="code" href="structstate.html#a6035af427143aa9f018d1dbf499d1c1b">timecnt</a> - 1])
<a name="l01372"></a>01372          <span class="keywordflow">return</span>;  <span class="comment">/* &quot;cannot happen&quot; */</span>
<a name="l01373"></a>01373 
<a name="l01374"></a>01374       bounds_exceeded = 1;
<a name="l01375"></a>01375    }
<a name="l01376"></a>01376 
<a name="l01377"></a>01377    <span class="keywordflow">if</span> (sp-&gt;<a class="code" href="structstate.html#a6035af427143aa9f018d1dbf499d1c1b">timecnt</a> == 0 || t &lt; sp-&gt;ats[0]) {
<a name="l01378"></a>01378       <span class="comment">/* I have no transition times or I&apos;m before time */</span>
<a name="l01379"></a>01379       *dst_enabled = 0;
<a name="l01380"></a>01380       <span class="comment">/* Find where I can get gmtoff */</span>
<a name="l01381"></a>01381       i = 0;
<a name="l01382"></a>01382       <span class="keywordflow">while</span> (sp-&gt;<a class="code" href="structstate.html#a9b9717d762927b5cd3ad33ea8e400e33">ttis</a>[i].<a class="code" href="structttinfo.html#a6a7790e950b3e36831bc53f4216ad9b2">tt_isdst</a>)
<a name="l01383"></a>01383          <span class="keywordflow">if</span> (++i &gt;= sp-&gt;<a class="code" href="structstate.html#a04ec6babf8c0a1bda31e414d4964090d">typecnt</a>) {
<a name="l01384"></a>01384          i = 0;
<a name="l01385"></a>01385          <span class="keywordflow">break</span>;
<a name="l01386"></a>01386          }
<a name="l01387"></a>01387          *gmt_off = sp-&gt;<a class="code" href="structstate.html#a9b9717d762927b5cd3ad33ea8e400e33">ttis</a>[i].<a class="code" href="structttinfo.html#a782693343700e53e6749e693391874e5">tt_gmtoff</a>;
<a name="l01388"></a>01388          <span class="keywordflow">return</span>;
<a name="l01389"></a>01389    } 
<a name="l01390"></a>01390 
<a name="l01391"></a>01391    <span class="keywordflow">for</span> (i = 1; i &lt; sp-&gt;<a class="code" href="structstate.html#a6035af427143aa9f018d1dbf499d1c1b">timecnt</a>; ++i) {
<a name="l01392"></a>01392       <span class="keywordflow">if</span> (t &lt; sp-&gt;ats[i]) {
<a name="l01393"></a>01393          transition1 = sp-&gt;<a class="code" href="structstate.html#a9f3a6df4e5685559b1ebb963e97ef60a">types</a>[i - 1];
<a name="l01394"></a>01394          transition2 = sp-&gt;<a class="code" href="structstate.html#a9f3a6df4e5685559b1ebb963e97ef60a">types</a>[i];
<a name="l01395"></a>01395          <span class="keywordflow">break</span>;
<a name="l01396"></a>01396       } 
<a name="l01397"></a>01397    }
<a name="l01398"></a>01398    <span class="comment">/* if I found transition times that do not bounded the given time and these correspond to </span>
<a name="l01399"></a>01399 <span class="comment">      or the bounding zones do not reflect a changes in day light savings, then I do not have dst active */</span>
<a name="l01400"></a>01400    <span class="keywordflow">if</span> (i &gt;= sp-&gt;<a class="code" href="structstate.html#a6035af427143aa9f018d1dbf499d1c1b">timecnt</a> || 0 &gt; transition1 || 0 &gt; transition2 ||
<a name="l01401"></a>01401          (sp-&gt;<a class="code" href="structstate.html#a9b9717d762927b5cd3ad33ea8e400e33">ttis</a>[transition1].<a class="code" href="structttinfo.html#a6a7790e950b3e36831bc53f4216ad9b2">tt_isdst</a> == sp-&gt;<a class="code" href="structstate.html#a9b9717d762927b5cd3ad33ea8e400e33">ttis</a>[transition2].<a class="code" href="structttinfo.html#a6a7790e950b3e36831bc53f4216ad9b2">tt_isdst</a>)) {
<a name="l01402"></a>01402       *dst_enabled = 0;
<a name="l01403"></a>01403       *gmt_off     = sp-&gt;<a class="code" href="structstate.html#a9b9717d762927b5cd3ad33ea8e400e33">ttis</a>[sp-&gt;<a class="code" href="structstate.html#a9f3a6df4e5685559b1ebb963e97ef60a">types</a>[sp-&gt;<a class="code" href="structstate.html#a6035af427143aa9f018d1dbf499d1c1b">timecnt</a> -1]].<a class="code" href="structttinfo.html#a782693343700e53e6749e693391874e5">tt_gmtoff</a>;
<a name="l01404"></a>01404    } <span class="keywordflow">else</span> {
<a name="l01405"></a>01405       <span class="comment">/* I have valid daylight savings information. */</span>
<a name="l01406"></a>01406       <span class="keywordflow">if</span>(sp-&gt;<a class="code" href="structstate.html#a9b9717d762927b5cd3ad33ea8e400e33">ttis</a>[transition2].<a class="code" href="structttinfo.html#a6a7790e950b3e36831bc53f4216ad9b2">tt_isdst</a>) 
<a name="l01407"></a>01407          *gmt_off = sp-&gt;<a class="code" href="structstate.html#a9b9717d762927b5cd3ad33ea8e400e33">ttis</a>[transition1].<a class="code" href="structttinfo.html#a782693343700e53e6749e693391874e5">tt_gmtoff</a>;
<a name="l01408"></a>01408       <span class="keywordflow">else</span> 
<a name="l01409"></a>01409          *gmt_off = sp-&gt;<a class="code" href="structstate.html#a9b9717d762927b5cd3ad33ea8e400e33">ttis</a>[transition2].<a class="code" href="structttinfo.html#a782693343700e53e6749e693391874e5">tt_gmtoff</a>;
<a name="l01410"></a>01410 
<a name="l01411"></a>01411       <span class="comment">/* If I adjusted the time earlier, indicate that the dst is invalid */</span>
<a name="l01412"></a>01412       <span class="keywordflow">if</span> (!bounds_exceeded) {
<a name="l01413"></a>01413          *dst_enabled = 1;
<a name="l01414"></a>01414          <span class="comment">/* Determine which of the bounds is the start of daylight savings and which is the end */</span>
<a name="l01415"></a>01415          <span class="keywordflow">if</span>(sp-&gt;<a class="code" href="structstate.html#a9b9717d762927b5cd3ad33ea8e400e33">ttis</a>[transition2].<a class="code" href="structttinfo.html#a6a7790e950b3e36831bc53f4216ad9b2">tt_isdst</a>) {
<a name="l01416"></a>01416             *dst_start = sp-&gt;<a class="code" href="structstate.html#a4509623ad925758e6f33ead8935ab268">ats</a>[i];
<a name="l01417"></a>01417             *dst_end = sp-&gt;<a class="code" href="structstate.html#a4509623ad925758e6f33ead8935ab268">ats</a>[i -1];
<a name="l01418"></a>01418          } <span class="keywordflow">else</span> {
<a name="l01419"></a>01419             *dst_start = sp-&gt;<a class="code" href="structstate.html#a4509623ad925758e6f33ead8935ab268">ats</a>[i -1];
<a name="l01420"></a>01420             *dst_end = sp-&gt;<a class="code" href="structstate.html#a4509623ad925758e6f33ead8935ab268">ats</a>[i];
<a name="l01421"></a>01421          }
<a name="l01422"></a>01422       }
<a name="l01423"></a>01423    }  
<a name="l01424"></a>01424    <span class="keywordflow">return</span>;
<a name="l01425"></a>01425 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae9fbda728350a9a5b9c09b29214d718e"></a><!-- doxytag: member="localtime.h::ast_localtime" ref="ae9fbda728350a9a5b9c09b29214d718e" args="(const struct timeval *timep, struct ast_tm *p_tm, const char *zone)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__tm.html">ast_tm</a>* ast_localtime </td>
          <td>(</td>
          <td class="paramtype">const struct timeval *&nbsp;</td>
          <td class="paramname"> <em>timep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__tm.html">ast_tm</a> *&nbsp;</td>
          <td class="paramname"> <em>p_tm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>zone</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Timezone-independent version of <a class="el" href="utils_8h.html#a9e7c6104cccbed67c8f0fd510cd5c099">localtime_r(3)</a>. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>timep</em>&nbsp;</td><td>Current time, including microseconds </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>p_tm</em>&nbsp;</td><td>Pointer to memory where the broken-out time will be stored </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>zone</em>&nbsp;</td><td>Text string of a standard system zoneinfo file. If NULL, the system localtime will be used. </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>p_tm</em>&nbsp;</td><td>is returned for convenience </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="localtime_8c_source.html#l01305">1305</a> of file <a class="el" href="localtime_8c_source.html">localtime.c</a>.</p>

<p>References <a class="el" href="localtime_8c_source.html#l01175">ast_tzset()</a>, and <a class="el" href="localtime_8c_source.html#l01214">localsub()</a>.</p>

<p>Referenced by <a class="el" href="logger_8c_source.html#l01239">__ast_verbose_ap()</a>, <a class="el" href="func__strings_8c_source.html#l00838">acf_strftime()</a>, <a class="el" href="manager_8c_source.html#l02755">action_corestatus()</a>, <a class="el" href="cdr__csv_8c_source.html#l00181">append_date()</a>, <a class="el" href="pbx_8c_source.html#l06982">ast_check_timing()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="say_8c_source.html#l03148">ast_say_date_da()</a>, <a class="el" href="say_8c_source.html#l03197">ast_say_date_de()</a>, <a class="el" href="say_8c_source.html#l03119">ast_say_date_en()</a>, <a class="el" href="say_8c_source.html#l03279">ast_say_date_fr()</a>, <a class="el" href="say_8c_source.html#l07159">ast_say_date_gr()</a>, <a class="el" href="say_8c_source.html#l03400">ast_say_date_he()</a>, <a class="el" href="say_8c_source.html#l03247">ast_say_date_hu()</a>, <a class="el" href="say_8c_source.html#l07696">ast_say_date_ka()</a>, <a class="el" href="say_8c_source.html#l03308">ast_say_date_nl()</a>, <a class="el" href="say_8c_source.html#l03373">ast_say_date_pt()</a>, <a class="el" href="say_8c_source.html#l03337">ast_say_date_th()</a>, <a class="el" href="say_8c_source.html#l03727">ast_say_date_with_format_da()</a>, <a class="el" href="say_8c_source.html#l03929">ast_say_date_with_format_de()</a>, <a class="el" href="say_8c_source.html#l03480">ast_say_date_with_format_en()</a>, <a class="el" href="say_8c_source.html#l04466">ast_say_date_with_format_es()</a>, <a class="el" href="say_8c_source.html#l04655">ast_say_date_with_format_fr()</a>, <a class="el" href="say_8c_source.html#l07283">ast_say_date_with_format_gr()</a>, <a class="el" href="say_8c_source.html#l04322">ast_say_date_with_format_he()</a>, <a class="el" href="say_8c_source.html#l04850">ast_say_date_with_format_it()</a>, <a class="el" href="say_8c_source.html#l05080">ast_say_date_with_format_nl()</a>, <a class="el" href="say_8c_source.html#l05285">ast_say_date_with_format_pl()</a>, <a class="el" href="say_8c_source.html#l05502">ast_say_date_with_format_pt()</a>, <a class="el" href="say_8c_source.html#l04132">ast_say_date_with_format_th()</a>, <a class="el" href="say_8c_source.html#l05794">ast_say_date_with_format_zh()</a>, <a class="el" href="say_8c_source.html#l06500">ast_say_datetime_de()</a>, <a class="el" href="say_8c_source.html#l06433">ast_say_datetime_en()</a>, <a class="el" href="say_8c_source.html#l06529">ast_say_datetime_fr()</a>, <a class="el" href="say_8c_source.html#l06862">ast_say_datetime_from_now_en()</a>, <a class="el" href="say_8c_source.html#l06900">ast_say_datetime_from_now_fr()</a>, <a class="el" href="say_8c_source.html#l06988">ast_say_datetime_from_now_he()</a>, <a class="el" href="say_8c_source.html#l07786">ast_say_datetime_from_now_ka()</a>, <a class="el" href="say_8c_source.html#l06938">ast_say_datetime_from_now_pt()</a>, <a class="el" href="say_8c_source.html#l07251">ast_say_datetime_gr()</a>, <a class="el" href="say_8c_source.html#l06773">ast_say_datetime_he()</a>, <a class="el" href="say_8c_source.html#l06515">ast_say_datetime_hu()</a>, <a class="el" href="say_8c_source.html#l07768">ast_say_datetime_ka()</a>, <a class="el" href="say_8c_source.html#l06570">ast_say_datetime_nl()</a>, <a class="el" href="say_8c_source.html#l06589">ast_say_datetime_pt()</a>, <a class="el" href="say_8c_source.html#l06656">ast_say_datetime_pt_BR()</a>, <a class="el" href="say_8c_source.html#l06670">ast_say_datetime_th()</a>, <a class="el" href="say_8c_source.html#l06713">ast_say_datetime_zh()</a>, <a class="el" href="say_8c_source.html#l06153">ast_say_time_de()</a>, <a class="el" href="say_8c_source.html#l06104">ast_say_time_en()</a>, <a class="el" href="say_8c_source.html#l06196">ast_say_time_fr()</a>, <a class="el" href="say_8c_source.html#l07203">ast_say_time_gr()</a>, <a class="el" href="say_8c_source.html#l06354">ast_say_time_he()</a>, <a class="el" href="say_8c_source.html#l06173">ast_say_time_hu()</a>, <a class="el" href="say_8c_source.html#l07736">ast_say_time_ka()</a>, <a class="el" href="say_8c_source.html#l06215">ast_say_time_nl()</a>, <a class="el" href="say_8c_source.html#l06235">ast_say_time_pt()</a>, <a class="el" href="say_8c_source.html#l06264">ast_say_time_pt_BR()</a>, <a class="el" href="say_8c_source.html#l06294">ast_say_time_th()</a>, <a class="el" href="say_8c_source.html#l06312">ast_say_time_zh()</a>, <a class="el" href="chan__unistim_8c_source.html#l04998">build_device()</a>, <a class="el" href="cdr__radius_8c_source.html#l00090">build_radius_record()</a>, <a class="el" href="callerid_8c_source.html#l00723">callerid_genmsg()</a>, <a class="el" href="cdr_8c_source.html#l00204">cdr_get_tv()</a>, <a class="el" href="asterisk_8c_source.html#l02164">cli_prompt()</a>, <a class="el" href="app__meetme_8c_source.html#l01998">conf_run()</a>, <a class="el" href="ie_8c_source.html#l00856">enc_ie_date()</a>, <a class="el" href="cdr__odbc_8c_source.html#l00062">execute_cb()</a>, <a class="el" href="app__meetme_8c_source.html#l03372">find_conf_realtime()</a>, <a class="el" href="cdr__sqlite_8c_source.html#l00090">format_date()</a>, <a class="el" href="app__minivm_8c_source.html#l00852">get_date()</a>, <a class="el" href="app__minivm_8c_source.html#l02897">handle_minivm_show_stats()</a>, <a class="el" href="asterisk_8c_source.html#l00413">handle_show_settings()</a>, <a class="el" href="chan__skinny_8c_source.html#l05307">handle_time_date_req_message()</a>, <a class="el" href="http_8c_source.html#l00659">httpd_helper_thread()</a>, <a class="el" href="chan__iax2_8c_source.html#l04448">iax2_datetime()</a>, <a class="el" href="app__sms_8c_source.html#l00295">isodate()</a>, <a class="el" href="app__minivm_8c_source.html#l01604">leave_voicemail()</a>, <a class="el" href="test_8c_source.html#l00008">main()</a>, <a class="el" href="app__voicemail_8c_source.html#l04163">make_email_file()</a>, <a class="el" href="cdr__manager_8c_source.html#l00134">manager_log()</a>, <a class="el" href="cdr__adaptive__odbc_8c_source.html#l00343">odbc_log()</a>, <a class="el" href="app__sms_8c_source.html#l00545">packdate()</a>, <a class="el" href="cdr__pgsql_8c_source.html#l00103">pgsql_log()</a>, <a class="el" href="chan__phone_8c_source.html#l00287">phone_call()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00401">phoneprov_callback()</a>, <a class="el" href="app__voicemail_8c_source.html#l06865">play_message_datetime()</a>, <a class="el" href="app__voicemail_8c_source.html#l03977">prep_email_sub_vars()</a>, <a class="el" href="app__rpt_8c_source.html#l02174">rpt_localtime()</a>, <a class="el" href="app__meetme_8c_source.html#l01815">rt_extend_conf()</a>, <a class="el" href="app__playback_8c_source.html#l00300">say_date_generic()</a>, <a class="el" href="chan__unistim_8c_source.html#l01361">send_date_time()</a>, <a class="el" href="chan__unistim_8c_source.html#l01378">send_date_time2()</a>, <a class="el" href="chan__unistim_8c_source.html#l01399">send_date_time3()</a>, <a class="el" href="app__minivm_8c_source.html#l01027">sendmail()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00344">set_timezone_variables()</a>, <a class="el" href="chan__sip_8c_source.html#l15748">sip_show_registry()</a>, <a class="el" href="app__sms_8c_source.html#l01199">sms_compose2()</a>, <a class="el" href="app__sms_8c_source.html#l01248">sms_handleincoming_proto2()</a>, <a class="el" href="http_8c_source.html#l00154">static_callback()</a>, <a class="el" href="func__timeout_8c_source.html#l00119">timeout_write()</a>, <a class="el" href="chan__mgcp_8c_source.html#l02238">transmit_notify_request_with_callerid()</a>, <a class="el" href="app__voicemail_8c_source.html#l04060">vmu_tm()</a>, <a class="el" href="chan__unistim_8c_source.html#l01693">write_history()</a>, and <a class="el" href="app__alarmreceiver_8c_source.html#l00296">write_metadata()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01306"></a>01306 {
<a name="l01307"></a>01307    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structstate.html">state</a> *sp = <a class="code" href="localtime_8c.html#a965846adf8ba00b83dad4f1870e2864c">ast_tzset</a>(zone);
<a name="l01308"></a>01308    memset(tmp, 0, <span class="keyword">sizeof</span>(*tmp));
<a name="l01309"></a>01309    <span class="keywordflow">return</span> sp ? <a class="code" href="localtime_8c.html#a8371be21ee5b80ea5d3bb8d4cb0a19c2">localsub</a>(timep, 0L, tmp, sp) : NULL;
<a name="l01310"></a>01310 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae0843e4dbbd1fed36d2676dda58e0c44"></a><!-- doxytag: member="localtime.h::ast_mktime" ref="ae0843e4dbbd1fed36d2676dda58e0c44" args="(struct ast_tm *const tmp, const char *zone)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct timeval ast_mktime </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__tm.html">ast_tm</a> *const &nbsp;</td>
          <td class="paramname"> <em>tmp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>zone</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Timezone-independent version of mktime(3). </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>tmp</em>&nbsp;</td><td>Current broken-out time, including microseconds </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>zone</em>&nbsp;</td><td>Text string of a standard system zoneinfo file. If NULL, the system localtime will be used. </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>A</em>&nbsp;</td><td>structure containing both seconds and fractional thereof since January 1st, 1970 UTC </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="localtime_8c_source.html#l01920">1920</a> of file <a class="el" href="localtime_8c_source.html">localtime.c</a>.</p>

<p>References <a class="el" href="localtime_8c_source.html#l01175">ast_tzset()</a>, <a class="el" href="localtime_8c_source.html#l01214">localsub()</a>, and <a class="el" href="localtime_8c_source.html#l01855">time1()</a>.</p>

<p>Referenced by <a class="el" href="func__strings_8c_source.html#l00872">acf_strptime()</a>, <a class="el" href="app__meetme_8c_source.html#l01998">conf_run()</a>, <a class="el" href="app__meetme_8c_source.html#l03372">find_conf_realtime()</a>, <a class="el" href="app__meetme_8c_source.html#l01815">rt_extend_conf()</a>, <a class="el" href="app__sms_8c_source.html#l01248">sms_handleincoming_proto2()</a>, <a class="el" href="app__sms_8c_source.html#l00813">sms_readfile()</a>, and <a class="el" href="app__sms_8c_source.html#l00571">unpackdate()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01921"></a>01921 {
<a name="l01922"></a>01922    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structstate.html">state</a> *sp;
<a name="l01923"></a>01923    <span class="keywordflow">if</span> (!(sp = <a class="code" href="localtime_8c.html#a965846adf8ba00b83dad4f1870e2864c">ast_tzset</a>(zone)))
<a name="l01924"></a>01924       <span class="keywordflow">return</span> <a class="code" href="localtime_8c.html#a296ac770414ea2c5e07cd748624bfd11">WRONG</a>;
<a name="l01925"></a>01925    <span class="keywordflow">return</span> <a class="code" href="localtime_8c.html#aecff377689b9165c40c7badfadb03b23">time1</a>(tmp, <a class="code" href="localtime_8c.html#a8371be21ee5b80ea5d3bb8d4cb0a19c2">localsub</a>, 0L, sp);
<a name="l01926"></a>01926 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa8e63928b14a347bd3973d680b885f93"></a><!-- doxytag: member="localtime.h::ast_strftime" ref="aa8e63928b14a347bd3973d680b885f93" args="(char *buf, size_t len, const char *format, const struct ast_tm *tm)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_strftime </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>format</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structast__tm.html">ast_tm</a> *&nbsp;</td>
          <td class="paramname"> <em>tm</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Special version of strftime(3) that handles fractions of a second. Takes the same arguments as strftime(3), with the addition of q, which specifies microseconds. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>buf</em>&nbsp;</td><td>Address in memory where the resulting string will be stored. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>len</em>&nbsp;</td><td>Size of the chunk of memory buf. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>format</em>&nbsp;</td><td>A string specifying the format of time to be placed into buf. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>tm</em>&nbsp;</td><td>Pointer to the broken out time to be used for the format. </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>An</em>&nbsp;</td><td>integer value specifying the <a class="el" href="structnumber.html" title="Number structure.">number</a> of bytes placed into buf or -1 on error. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="localtime_8c_source.html#l01928">1928</a> of file <a class="el" href="localtime_8c_source.html">localtime.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="astmm_8h_source.html#l00093">ast_realloc</a>, <a class="el" href="cdr__custom_8c_source.html#l00058">format</a>, and <a class="el" href="localtime_8h_source.html#l00040">ast_tm::tm_usec</a>.</p>

<p>Referenced by <a class="el" href="logger_8c_source.html#l01239">__ast_verbose_ap()</a>, <a class="el" href="func__strings_8c_source.html#l00838">acf_strftime()</a>, <a class="el" href="manager_8c_source.html#l02755">action_corestatus()</a>, <a class="el" href="cdr__csv_8c_source.html#l00181">append_date()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="cdr__radius_8c_source.html#l00090">build_radius_record()</a>, <a class="el" href="cdr_8c_source.html#l00204">cdr_get_tv()</a>, <a class="el" href="asterisk_8c_source.html#l02164">cli_prompt()</a>, <a class="el" href="app__meetme_8c_source.html#l01998">conf_run()</a>, <a class="el" href="iax2-parser_8c_source.html#l00153">dump_datetime()</a>, <a class="el" href="cdr__odbc_8c_source.html#l00062">execute_cb()</a>, <a class="el" href="app__meetme_8c_source.html#l03372">find_conf_realtime()</a>, <a class="el" href="cdr__sqlite_8c_source.html#l00090">format_date()</a>, <a class="el" href="app__minivm_8c_source.html#l00852">get_date()</a>, <a class="el" href="app__minivm_8c_source.html#l02897">handle_minivm_show_stats()</a>, <a class="el" href="asterisk_8c_source.html#l00413">handle_show_settings()</a>, <a class="el" href="http_8c_source.html#l00659">httpd_helper_thread()</a>, <a class="el" href="app__sms_8c_source.html#l00295">isodate()</a>, <a class="el" href="app__minivm_8c_source.html#l01604">leave_voicemail()</a>, <a class="el" href="app__voicemail_8c_source.html#l04163">make_email_file()</a>, <a class="el" href="cdr__manager_8c_source.html#l00134">manager_log()</a>, <a class="el" href="cdr__adaptive__odbc_8c_source.html#l00343">odbc_log()</a>, <a class="el" href="cdr__pgsql_8c_source.html#l00103">pgsql_log()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00401">phoneprov_callback()</a>, <a class="el" href="app__voicemail_8c_source.html#l03977">prep_email_sub_vars()</a>, <a class="el" href="app__meetme_8c_source.html#l01815">rt_extend_conf()</a>, <a class="el" href="app__minivm_8c_source.html#l01027">sendmail()</a>, <a class="el" href="app__voicemail_8c_source.html#l04513">sendpage()</a>, <a class="el" href="chan__sip_8c_source.html#l15748">sip_show_registry()</a>, <a class="el" href="http_8c_source.html#l00154">static_callback()</a>, <a class="el" href="func__timeout_8c_source.html#l00119">timeout_write()</a>, and <a class="el" href="app__alarmreceiver_8c_source.html#l00296">write_metadata()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01929"></a>01929 {
<a name="l01930"></a>01930    <span class="keywordtype">size_t</span> fmtlen = strlen(tmp) + 1;
<a name="l01931"></a>01931    <span class="keywordtype">char</span> *<a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a> = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, fmtlen), *fptr = format, *newfmt;
<a name="l01932"></a>01932    <span class="keywordtype">int</span> decimals = -1, i, res;
<a name="l01933"></a>01933    <span class="keywordtype">long</span> fraction;
<a name="l01934"></a>01934 
<a name="l01935"></a>01935    <span class="keywordflow">if</span> (!format)
<a name="l01936"></a>01936       <span class="keywordflow">return</span> -1;
<a name="l01937"></a>01937    <span class="keywordflow">for</span> (; *tmp; tmp++) {
<a name="l01938"></a>01938       <span class="keywordflow">if</span> (*tmp == <span class="charliteral">&apos;%&apos;</span>) {
<a name="l01939"></a>01939          <span class="keywordflow">switch</span> (tmp[1]) {
<a name="l01940"></a>01940          <span class="keywordflow">case</span> <span class="charliteral">&apos;1&apos;</span>:
<a name="l01941"></a>01941          <span class="keywordflow">case</span> <span class="charliteral">&apos;2&apos;</span>:
<a name="l01942"></a>01942          <span class="keywordflow">case</span> <span class="charliteral">&apos;3&apos;</span>:
<a name="l01943"></a>01943          <span class="keywordflow">case</span> <span class="charliteral">&apos;4&apos;</span>:
<a name="l01944"></a>01944          <span class="keywordflow">case</span> <span class="charliteral">&apos;5&apos;</span>:
<a name="l01945"></a>01945          <span class="keywordflow">case</span> <span class="charliteral">&apos;6&apos;</span>:
<a name="l01946"></a>01946             <span class="keywordflow">if</span> (tmp[2] != <span class="charliteral">&apos;q&apos;</span>)
<a name="l01947"></a>01947                <span class="keywordflow">goto</span> defcase;
<a name="l01948"></a>01948             decimals = tmp[1] - <span class="charliteral">&apos;0&apos;</span>;
<a name="l01949"></a>01949             tmp++;
<a name="l01950"></a>01950             <span class="comment">/* Fall through */</span>
<a name="l01951"></a>01951          <span class="keywordflow">case</span> <span class="charliteral">&apos;q&apos;</span>: <span class="comment">/* Milliseconds */</span>
<a name="l01952"></a>01952             <span class="keywordflow">if</span> (decimals == -1)
<a name="l01953"></a>01953                decimals = 3;
<a name="l01954"></a>01954 
<a name="l01955"></a>01955             <span class="comment">/* Juggle some memory to fit the item */</span>
<a name="l01956"></a>01956             newfmt = <a class="code" href="astmm_8h.html#aa852314efa0cfeecee97ffc51b649734">ast_realloc</a>(format, fmtlen + decimals);
<a name="l01957"></a>01957             <span class="keywordflow">if</span> (!newfmt) {
<a name="l01958"></a>01958                <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(format);
<a name="l01959"></a>01959                <span class="keywordflow">return</span> -1;
<a name="l01960"></a>01960             }
<a name="l01961"></a>01961             fptr = fptr - format + newfmt;
<a name="l01962"></a>01962             format = newfmt;
<a name="l01963"></a>01963             fmtlen += decimals;
<a name="l01964"></a>01964 
<a name="l01965"></a>01965             <span class="comment">/* Reduce the fraction of time to the accuracy needed */</span>
<a name="l01966"></a>01966             <span class="keywordflow">for</span> (i = 6, fraction = tm-&gt;<a class="code" href="structast__tm.html#aefbab7d1223d156a8cfaaf3ff170540b">tm_usec</a>; i &gt; decimals; i--)
<a name="l01967"></a>01967                fraction /= 10;
<a name="l01968"></a>01968             fptr += sprintf(fptr, <span class="stringliteral">&quot;%0*ld&quot;</span>, decimals, fraction);
<a name="l01969"></a>01969 
<a name="l01970"></a>01970             <span class="comment">/* Reset, in case more than one &apos;q&apos; specifier exists */</span>
<a name="l01971"></a>01971             decimals = -1;
<a name="l01972"></a>01972             tmp++;
<a name="l01973"></a>01973             <span class="keywordflow">break</span>;
<a name="l01974"></a>01974          <span class="keywordflow">default</span>:
<a name="l01975"></a>01975             <span class="keywordflow">goto</span> defcase;
<a name="l01976"></a>01976          }
<a name="l01977"></a>01977       } <span class="keywordflow">else</span>
<a name="l01978"></a>01978 defcase: *fptr++ = *tmp;
<a name="l01979"></a>01979    }
<a name="l01980"></a>01980    *fptr = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01981"></a>01981 <span class="preprocessor">#undef strftime</span>
<a name="l01982"></a>01982 <span class="preprocessor"></span>   res = (int)strftime(<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, format, (<span class="keyword">struct</span> tm *)tm);
<a name="l01983"></a>01983    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(format);
<a name="l01984"></a>01984    <span class="keywordflow">return</span> res;
<a name="l01985"></a>01985 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3eb2c73accce1b149ce597de80d1677a"></a><!-- doxytag: member="localtime.h::ast_strptime" ref="a3eb2c73accce1b149ce597de80d1677a" args="(const char *s, const char *format, struct ast_tm *tm)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* ast_strptime </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>format</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__tm.html">ast_tm</a> *&nbsp;</td>
          <td class="paramname"> <em>tm</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Special version of strptime(3) which places the answer in the common structure <a class="el" href="structast__tm.html">ast_tm</a>. Also, unlike strptime(3), <a class="el" href="localtime_8h.html#a3eb2c73accce1b149ce597de80d1677a" title="Special version of strptime(3) which places the answer in the common structure ast_tm...">ast_strptime()</a> initializes its memory prior to use. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>s</em>&nbsp;</td><td>A string specifying some portion of a date and time. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>format</em>&nbsp;</td><td>The format in which the string, s, is expected. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>tm</em>&nbsp;</td><td>The broken-out time structure into which the parsed data is expected. </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>A</em>&nbsp;</td><td>pointer to the first character within s not used to parse the date and time. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="localtime_8c_source.html#l01987">1987</a> of file <a class="el" href="localtime_8c_source.html">localtime.c</a>.</p>

<p>References <a class="el" href="localtime_8h_source.html#l00036">ast_tm::tm_isdst</a>, and <a class="el" href="localtime_8h_source.html#l00040">ast_tm::tm_usec</a>.</p>

<p>Referenced by <a class="el" href="func__strings_8c_source.html#l00872">acf_strptime()</a>, <a class="el" href="app__meetme_8c_source.html#l01998">conf_run()</a>, <a class="el" href="app__meetme_8c_source.html#l03372">find_conf_realtime()</a>, and <a class="el" href="app__meetme_8c_source.html#l01815">rt_extend_conf()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01988"></a>01988 {
<a name="l01989"></a>01989    <span class="keyword">struct </span>tm tm2 = { 0, };
<a name="l01990"></a>01990    <span class="keywordtype">char</span> *res = strptime(<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>, <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>, &amp;tm2);
<a name="l01991"></a>01991    memcpy(tm, &amp;tm2, <span class="keyword">sizeof</span>(*tm));
<a name="l01992"></a>01992    tm-&gt;<a class="code" href="structast__tm.html#aefbab7d1223d156a8cfaaf3ff170540b">tm_usec</a> = 0;
<a name="l01993"></a>01993    <span class="comment">/* strptime(3) doesn&apos;t set .tm_isdst correctly, so to force ast_mktime(3)</span>
<a name="l01994"></a>01994 <span class="comment">    * to deal with it correctly, we set it to -1. */</span>
<a name="l01995"></a>01995    tm-&gt;<a class="code" href="structast__tm.html#a7d102a87f898878ebf37ebd87504e099">tm_isdst</a> = -1;
<a name="l01996"></a>01996    <span class="keywordflow">return</span> res;
<a name="l01997"></a>01997 }
</pre></div></p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:22:20 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
