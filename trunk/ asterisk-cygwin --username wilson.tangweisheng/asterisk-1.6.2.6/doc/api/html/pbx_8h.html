<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:22:39 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_1ab815038f534adda65c8b4ae4993449.html">include</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_16d825f1fa9ecca2e70b1a8d9256d0e6.html">asterisk</a>
  </div>
</div>
<div class="contents">
<h1>pbx.h File Reference</h1>
<p>Core PBX routines and definitions.  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="sched_8h_source.html">asterisk/sched.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="devicestate_8h_source.html">asterisk/devicestate.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="chanvars_8h_source.html">asterisk/chanvars.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="hashtab_8h_source.html">asterisk/hashtab.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="stringfields_8h_source.html">asterisk/stringfields.h</a>&quot;</code><br/>

<p><a href="pbx_8h_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__custom__function.html">ast_custom_function</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Data structure associated with a custom dialplan function.  <a href="structast__custom__function.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__pbx.html">ast_pbx</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__pbx__args.html">ast_pbx_args</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Options for <a class="el" href="pbx_8h.html#a44b6406c9220f7f2b610ac712369f405" title="Execute the PBX in the current thread.">ast_pbx_run()</a>.  <a href="structast__pbx__args.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__switch.html">ast_switch</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__timing.html">ast_timing</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structpbx__find__info.html">pbx_find_info</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a8af0e93442a9e468425f63cc52b0ac7b">ast_custom_function_register</a>(acf)&nbsp;&nbsp;&nbsp;__ast_custom_function_register(acf, <a class="el" href="structast__module__info.html">ast_module_info</a>-&gt;self)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Register a custom function.  <a href="#a8af0e93442a9e468425f63cc52b0ac7b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a3414b82af9b33fe907c9377c5c73c453">AST_MAX_APP</a>&nbsp;&nbsp;&nbsp;32</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a7b423f7cbc393639fde9085830313f03">AST_PBX_KEEP</a>&nbsp;&nbsp;&nbsp;0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a05848c0de74d85dc2fb259f332d33f25">AST_PBX_MAX_STACK</a>&nbsp;&nbsp;&nbsp;128</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#aed4e41b2b2c49b629e2eef07c702c2c4">AST_PBX_REPLACE</a>&nbsp;&nbsp;&nbsp;1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#ad2e753a683024fad0b34ece3b1aef83a">PRIORITY_HINT</a>&nbsp;&nbsp;&nbsp;-1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#aa2d7a93c24186594d8c09e904fa17132">STATUS_NO_CONTEXT</a>&nbsp;&nbsp;&nbsp;1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a53e8d9faad7e0156772e9559df5f8c2e">STATUS_NO_EXTENSION</a>&nbsp;&nbsp;&nbsp;2</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a5062f2413e9425755149f855577b602f">STATUS_NO_LABEL</a>&nbsp;&nbsp;&nbsp;4</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#ab6422b4f1e9de4cb16307bd081b8706b">STATUS_NO_PRIORITY</a>&nbsp;&nbsp;&nbsp;3</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#ae56fdb340b23940f7a64ed2e37c1774a">STATUS_SUCCESS</a>&nbsp;&nbsp;&nbsp;5</td></tr>
<tr><td colspan="2"><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef int(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#aa158b092800168cef19ea3fdd5b47538">ast_state_cb_type</a> )(char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, char *<a class="el" href="res__ais_8c.html#a2465fd4497a7402ad72da7d6e03f9934">id</a>, enum <a class="el" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625f">ast_extension_states</a> <a class="el" href="structstate.html">state</a>, void *data)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Typedef for devicestate and hint callbacks.  <a href="#aa158b092800168cef19ea3fdd5b47538"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef int(&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a93ee7200f8a12fa56224b85d2483693d">ast_switch_f</a> )(struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, const char *<a class="el" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, int priority, const char *callerid, const char *data)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">All switch functions have the same interface, so define a type for them.  <a href="#a93ee7200f8a12fa56224b85d2483693d"></a><br/></td></tr>
<tr><td colspan="2"><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a8717a951656993c40bd851ebf50f58e3">ast_doc_src</a> { <a class="el" href="pbx_8h.html#a8717a951656993c40bd851ebf50f58e3a24212840b7b1b0e9c1eebc8cfd89ab3e">AST_XML_DOC</a>, 
<a class="el" href="pbx_8h.html#a8717a951656993c40bd851ebf50f58e3a7273ed64a1fd4a93692986eac376124a">AST_STATIC_DOC</a>
 }</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p>From where the documentation come from. </p>
 <a href="pbx_8h.html#a8717a951656993c40bd851ebf50f58e3">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625f">ast_extension_states</a> { <br/>
&nbsp;&nbsp;<a class="el" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa3e2a2f5572580f74e94b6d5e80261ea7">AST_EXTENSION_REMOVED</a> =  -2, 
<a class="el" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625faf53cb090b99fb8e952c8151990bd4192">AST_EXTENSION_DEACTIVATED</a> =  -1, 
<a class="el" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa435abb1e907b1cee83ec44d2d77866e6">AST_EXTENSION_NOT_INUSE</a> =  0, 
<a class="el" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa47e9214860b5f9b887945f7cd1baec1a">AST_EXTENSION_INUSE</a> =  1 &lt;&lt; 0, 
<br/>
&nbsp;&nbsp;<a class="el" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fad62d357f0ccde2a718c374a0a4af2b98">AST_EXTENSION_BUSY</a> =  1 &lt;&lt; 1, 
<a class="el" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa5820eb407f3a3dbc5046c97ad43ee1f3">AST_EXTENSION_UNAVAILABLE</a> =  1 &lt;&lt; 2, 
<a class="el" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa4063bf4e94e14df04126be6f08cc7bfc">AST_EXTENSION_RINGING</a> =  1 &lt;&lt; 3, 
<a class="el" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa83180bb058ded006c01229431fc887f9">AST_EXTENSION_ONHOLD</a> =  1 &lt;&lt; 4
<br/>
 }</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p>Extension states. </p>
 <a href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625f">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735">ast_pbx_result</a> { <a class="el" href="pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735ae1482e87c137b03ef9f9c17cf4fb5ec4">AST_PBX_SUCCESS</a> =  0, 
<a class="el" href="pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735a4a46cde728f5cd375af4f2d5b1542490">AST_PBX_FAILED</a> =  -1, 
<a class="el" href="pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735ab69a419c47206542956e9d933b6605f5">AST_PBX_CALL_LIMIT</a> =  -2
 }</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p>The result codes when starting the PBX on a channel with. </p>
 <a href="pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a2b7f0fafc6995b2630658a4fd8df26be">ext_match_t</a> { <br/>
&nbsp;&nbsp;<a class="el" href="extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7e20dcb277877b81e8099470cd631277">E_MATCHMORE</a> =  0x00, 
<a class="el" href="extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea413c09377a892aa154e7669cbdaf27ba">E_CANMATCH</a> =  0x01, 
<a class="el" href="extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea2e605157e82dec388ffc89c1694fb7be">E_MATCH</a> =  0x02, 
<a class="el" href="extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea108ea5cb21cb0de3a1be976972c0a59c">E_MATCH_MASK</a> =  0x03, 
<br/>
&nbsp;&nbsp;<a class="el" href="extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea8f986496ee140e4c7167ae25ad28d0ee">E_SPAWN</a> =  0x12, 
<a class="el" href="extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7b10ab7b3dd6af9d933dbb03dd183eb5">E_FINDLABEL</a> =  0x22, 
<a class="el" href="pbx_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7e20dcb277877b81e8099470cd631277">E_MATCHMORE</a> =  0x00, 
<a class="el" href="pbx_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea413c09377a892aa154e7669cbdaf27ba">E_CANMATCH</a> =  0x01, 
<br/>
&nbsp;&nbsp;<a class="el" href="pbx_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea2e605157e82dec388ffc89c1694fb7be">E_MATCH</a> =  0x02, 
<a class="el" href="pbx_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea108ea5cb21cb0de3a1be976972c0a59c">E_MATCH_MASK</a> =  0x03, 
<a class="el" href="pbx_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea8f986496ee140e4c7167ae25ad28d0ee">E_SPAWN</a> =  0x12, 
<a class="el" href="pbx_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7b10ab7b3dd6af9d933dbb03dd183eb5">E_FINDLABEL</a> =  0x22
<br/>
 }</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#aad8771c7e3b2170a749946f1a8b758aa">__ast_custom_function_register</a> (struct <a class="el" href="structast__custom__function.html">ast_custom_function</a> *acf, struct <a class="el" href="structast__module.html">ast_module</a> *mod)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Register a custom function.  <a href="#aad8771c7e3b2170a749946f1a8b758aa"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a52a37e9e2d9a1482ef5b7d91001b61ac">ast_active_calls</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Retrieve the <a class="el" href="structnumber.html" title="Number structure.">number</a> of active calls.  <a href="#a52a37e9e2d9a1482ef5b7d91001b61ac"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a07176e8d314eb68b3b50279fafa11390">ast_add_extension</a> (const char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, int replace, const char *<a class="el" href="structextension.html">extension</a>, int priority, const char *label, const char *callerid, const char *application, void *data, void(*datad)(void *), const char *<a class="el" href="pval_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add and <a class="el" href="structextension.html">extension</a> to an <a class="el" href="structextension.html">extension</a> context.  <a href="#a07176e8d314eb68b3b50279fafa11390"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a8790db69940f3c32c2d7943ee73f2180">ast_add_extension2</a> (struct <a class="el" href="structast__context.html">ast_context</a> *con, int replace, const char *<a class="el" href="structextension.html">extension</a>, int priority, const char *label, const char *callerid, const char *application, void *data, void(*datad)(void *), const char *<a class="el" href="pval_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add an <a class="el" href="structextension.html">extension</a> to an <a class="el" href="structextension.html">extension</a> context, this time with an <a class="el" href="structast__context.html" title="ast_context: An extension context">ast_context</a> *.  <a href="#a8790db69940f3c32c2d7943ee73f2180"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#ae0ba2eb966a9e3376de61d30513f7302">ast_async_goto</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, const char *<a class="el" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, int priority)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set the channel to next execute the specified dialplan location.  <a href="#ae0ba2eb966a9e3376de61d30513f7302"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#aa43c73d212f6a5c3256cc90a7d7980a1">ast_async_goto_by_name</a> (const char *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, const char *<a class="el" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, int priority)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set the channel to next execute the specified dialplan location.  <a href="#aa43c73d212f6a5c3256cc90a7d7980a1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a281fc61f41a1be7fdd6c620372c4510b">ast_async_goto_if_exists</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, const char *<a class="el" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, int priority)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#aa2caee9cd93973d6f2bc806b34f564d6">ast_async_parseable_goto</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *goto_string)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a018549fd5d5470b676da92f6034b7347">ast_build_timing</a> (struct <a class="el" href="structast__timing.html">ast_timing</a> *i, const char *info)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Construct a timing bitmap, for use in time-based conditionals.  <a href="#a018549fd5d5470b676da92f6034b7347"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a93f9868530c1e8a9d9d367d1ead8782e">ast_canmatch_extension</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c, const char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, const char *<a class="el" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, int priority, const char *callerid)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Looks for a valid matching <a class="el" href="structextension.html">extension</a>.  <a href="#a93f9868530c1e8a9d9d367d1ead8782e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a17b7d6ec799c60a8fda825cf59aea7eb">ast_check_timing</a> (const struct <a class="el" href="structast__timing.html">ast_timing</a> *i)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Evaluate a pre-constructed bitmap as to whether the current time falls within the range specified.  <a href="#a17b7d6ec799c60a8fda825cf59aea7eb"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a24d57cdfe3409c388e4b81b67ecdee70">ast_context_add_ignorepat</a> (const char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, const char *ignorepat, const char *<a class="el" href="pval_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add an ignorepat.  <a href="#a24d57cdfe3409c388e4b81b67ecdee70"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a82c040aa706c09bd6294b2333a2a0587">ast_context_add_ignorepat2</a> (struct <a class="el" href="structast__context.html">ast_context</a> *con, const char *ignorepat, const char *<a class="el" href="pval_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a3903111827b675ec313e56a28ac80cf9">ast_context_add_include</a> (const char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, const char *include, const char *<a class="el" href="pval_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add a context include.  <a href="#a3903111827b675ec313e56a28ac80cf9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#aceaa74fb91df5e8f7892f59953ff6283">ast_context_add_include2</a> (struct <a class="el" href="structast__context.html">ast_context</a> *con, const char *include, const char *<a class="el" href="pval_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add a context include.  <a href="#aceaa74fb91df5e8f7892f59953ff6283"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a7677cd4c8e3a0c3d205f412e396a7d5c">ast_context_add_switch</a> (const char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, const char *sw, const char *data, int eval, const char *<a class="el" href="pval_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add a switch.  <a href="#a7677cd4c8e3a0c3d205f412e396a7d5c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a98b8af4a068416ee570f9d78cb9af724">ast_context_add_switch2</a> (struct <a class="el" href="structast__context.html">ast_context</a> *con, const char *sw, const char *data, int eval, const char *<a class="el" href="pval_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Adds a switch (first param is a <a class="el" href="structast__context.html" title="ast_context: An extension context">ast_context</a>).  <a href="#a98b8af4a068416ee570f9d78cb9af724"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a9546b830c22c693a2baed08e48569401">ast_context_destroy</a> (struct <a class="el" href="structast__context.html">ast_context</a> *con, const char *<a class="el" href="pval_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Destroy a context (matches the specified context (or ANY context if NULL).  <a href="#a9546b830c22c693a2baed08e48569401"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__context.html">ast_context</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a2af2d2771e5347b18454a05dbc98e35f">ast_context_find</a> (const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Find a context.  <a href="#a2af2d2771e5347b18454a05dbc98e35f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__context.html">ast_context</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a8a07400b41b3302edf8aef9f53644698">ast_context_find_or_create</a> (struct <a class="el" href="structast__context.html">ast_context</a> **extcontexts, struct <a class="el" href="structast__hashtab.html">ast_hashtab</a> *exttable, const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, const char *<a class="el" href="pval_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Register a new context or find an existing one.  <a href="#a8a07400b41b3302edf8aef9f53644698"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a0425cd7146d66b6ae06f16ddfd53307a">ast_context_lockmacro</a> (const char *macrocontext)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">locks the macrolock in the given given context  <a href="#a0425cd7146d66b6ae06f16ddfd53307a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a08e43dc093c586991af4e2f86fa14f2e">ast_context_remove_ignorepat</a> (const char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, const char *ignorepat, const char *<a class="el" href="pval_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a3c599ffe1436debbdccd45a28685b567">ast_context_remove_ignorepat2</a> (struct <a class="el" href="structast__context.html">ast_context</a> *con, const char *ignorepat, const char *<a class="el" href="pval_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#acec5cab19e772712434bf03875b57e9a">ast_context_remove_include</a> (const char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, const char *include, const char *<a class="el" href="pval_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Remove a context include.  <a href="#acec5cab19e772712434bf03875b57e9a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a8c23053e0d4d87545a93ec837a19b908">ast_context_remove_include2</a> (struct <a class="el" href="structast__context.html">ast_context</a> *con, const char *include, const char *<a class="el" href="pval_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Removes an include by an <a class="el" href="structast__context.html" title="ast_context: An extension context">ast_context</a> structure.  <a href="#a8c23053e0d4d87545a93ec837a19b908"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a9800750a3fb79caa282c98556473f392">ast_context_remove_switch</a> (const char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, const char *sw, const char *data, const char *<a class="el" href="pval_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Remove a switch.  <a href="#a9800750a3fb79caa282c98556473f392"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a23a51e49bea958a8d27c61f2a51931d9">ast_context_remove_switch2</a> (struct <a class="el" href="structast__context.html">ast_context</a> *con, const char *sw, const char *data, const char *<a class="el" href="pval_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function locks given context, removes switch, unlock context and return.  <a href="#a23a51e49bea958a8d27c61f2a51931d9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a0cb6fe63e51dd357d3146a1f1c64bd95">ast_context_unlockmacro</a> (const char *macrocontext)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Unlocks the macrolock in the given context.  <a href="#a0cb6fe63e51dd357d3146a1f1c64bd95"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#aca6b16b4b7433a12e65103a2f1ab8028">ast_context_verify_includes</a> (struct <a class="el" href="structast__context.html">ast_context</a> *con)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Verifies includes in an ast_contect structure.  <a href="#aca6b16b4b7433a12e65103a2f1ab8028"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__custom__function.html">ast_custom_function</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a5e0f8c2ce2a3c8994648254799a0c3b7">ast_custom_function_find</a> (const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a965977ea9a3144bc203e0ce7a64680a1">ast_custom_function_unregister</a> (struct <a class="el" href="structast__custom__function.html">ast_custom_function</a> *acf)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Unregister a custom function.  <a href="#a965977ea9a3144bc203e0ce7a64680a1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a2bc52adc4f80137db9161ed499f82a00">ast_destroy_timing</a> (struct <a class="el" href="structast__timing.html">ast_timing</a> *i)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Deallocates memory structures associated with a timing bitmap.  <a href="#a2bc52adc4f80137db9161ed499f82a00"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625f">ast_extension_states</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a3aa0b9f1691104cb6214ba66c5dc3a30">ast_devstate_to_extenstate</a> (enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a> devstate)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Map devstate to an <a class="el" href="structextension.html">extension</a> <a class="el" href="structstate.html">state</a>.  <a href="#a3aa0b9f1691104cb6214ba66c5dc3a30"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a64a5b8fdc919806135ad427aca9e71b7">ast_exists_extension</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c, const char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, const char *<a class="el" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, int priority, const char *callerid)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Determine whether an <a class="el" href="structextension.html">extension</a> exists.  <a href="#a64a5b8fdc919806135ad427aca9e71b7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a9f840db4b5ef461ac2c0c975a57c9e89">ast_explicit_goto</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, const char *<a class="el" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, int priority)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a83192a0099558f6a539fdb4e065ff99d">ast_extension_close</a> (const char *pattern, const char *data, int needmore)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#aa9130cb982e3e236c465136e0637cfaa">ast_extension_cmp</a> (const char *a, const char *b)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Determine if one <a class="el" href="structextension.html">extension</a> should match before another.  <a href="#aa9130cb982e3e236c465136e0637cfaa"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a94cf2f099462a906620b5566871af797">ast_extension_match</a> (const char *pattern, const char *<a class="el" href="structextension.html">extension</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Determine if a given <a class="el" href="structextension.html">extension</a> matches a given pattern (in NXX format).  <a href="#a94cf2f099462a906620b5566871af797"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#adf9249eff9d5037968d55e11de1dce5f">ast_extension_patmatch</a> (const char *pattern, const char *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#aed6cfe76441ef995ab80609020a9990c">ast_extension_state</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c, const char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, const char *<a class="el" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Uses hint and devicestate callback to get the <a class="el" href="structstate.html">state</a> of an <a class="el" href="structextension.html">extension</a>.  <a href="#aed6cfe76441ef995ab80609020a9990c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a3261603753916b98888a5a5fc1d505c3">ast_extension_state2str</a> (int extension_state)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return string representation of the <a class="el" href="structstate.html">state</a> of an <a class="el" href="structextension.html">extension</a>.  <a href="#a3261603753916b98888a5a5fc1d505c3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#aa3a30d0a841ee2bc0d87af763a99629f">ast_extension_state_add</a> (const char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, const char *<a class="el" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, <a class="el" href="pbx_8h.html#aa158b092800168cef19ea3fdd5b47538">ast_state_cb_type</a> callback, void *data)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Registers a <a class="el" href="structstate.html">state</a> change callback.  <a href="#aa3a30d0a841ee2bc0d87af763a99629f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a6740b689b39aa1503d1b858daf730873">ast_extension_state_del</a> (int <a class="el" href="res__ais_8c.html#a2465fd4497a7402ad72da7d6e03f9934">id</a>, <a class="el" href="pbx_8h.html#aa158b092800168cef19ea3fdd5b47538">ast_state_cb_type</a> callback)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Deletes a registered <a class="el" href="structstate.html">state</a> change callback by ID.  <a href="#a6740b689b39aa1503d1b858daf730873"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a0be9518646cf9aca4878b313cc02e901">ast_findlabel_extension</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c, const char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, const char *<a class="el" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, const char *label, const char *callerid)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Find the priority of an <a class="el" href="structextension.html">extension</a> that has the specified label.  <a href="#a0be9518646cf9aca4878b313cc02e901"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#aa3c47773f118e7775a5c052dbb4bb3aa">ast_findlabel_extension2</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c, struct <a class="el" href="structast__context.html">ast_context</a> *con, const char *<a class="el" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, const char *label, const char *callerid)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Find the priority of an <a class="el" href="structextension.html">extension</a> that has the specified label.  <a href="#aa3c47773f118e7775a5c052dbb4bb3aa"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#aa4e9618aa036a586af7d7663afd9b507">ast_func_read</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *function, char *workspace, size_t len)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">executes a read operation on a function  <a href="#aa4e9618aa036a586af7d7663afd9b507"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#ae70e64cdf669396c88ea8eda900b0b3b">ast_func_write</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *function, const char *value)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">executes a write operation on a function  <a href="#ae70e64cdf669396c88ea8eda900b0b3b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#ac778ac642def88a06e5d59e11a964c43">ast_get_hint</a> (char *hint, int hintsize, char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, int namesize, struct <a class="el" href="structast__channel.html">ast_channel</a> *c, const char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, const char *<a class="el" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">If an <a class="el" href="structextension.html">extension</a> hint exists, return non-zero.  <a href="#ac778ac642def88a06e5d59e11a964c43"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a8f7166f50cb9642179c9b321b8143f55">ast_goto_if_exists</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, const char *<a class="el" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, int priority)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#aa73d176ed4f1ce51e5db6beafba45fe3">ast_ignore_pattern</a> (const char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, const char *pattern)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Checks to see if a <a class="el" href="structnumber.html" title="Number structure.">number</a> should be ignored.  <a href="#aa73d176ed4f1ce51e5db6beafba45fe3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#ac359af75b9494f50904583d2168a7577">ast_matchmore_extension</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c, const char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, const char *<a class="el" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, int priority, const char *callerid)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Looks to see if adding anything to this <a class="el" href="structextension.html">extension</a> might match something. (exists ^ canmatch).  <a href="#ac359af75b9494f50904583d2168a7577"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a833a703b21d8f6bcb9f68e57185bca67">ast_merge_contexts_and_delete</a> (struct <a class="el" href="structast__context.html">ast_context</a> **extcontexts, struct <a class="el" href="structast__hashtab.html">ast_hashtab</a> *exttable, const char *<a class="el" href="pval_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Merge the temporary contexts into a global contexts list and delete from the global list the ones that are being added.  <a href="#a833a703b21d8f6bcb9f68e57185bca67"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#ae9b65b0515d88371a5293dd354bfd92f">ast_parseable_goto</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *goto_string)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#ade584ae5e3eafb878535626ebe79e26d">ast_pbx_outgoing_app</a> (const char *<a class="el" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>, int <a class="el" href="chan__alsa_8c.html#a98f5e70e98f6dc48e3c5ba316066d540">format</a>, void *data, int timeout, const char *<a class="el" href="res__agi_8c.html#a9e5f57131367eff409b9e0bd7b31aa1a">app</a>, const char *appdata, int *reason, int sync, const char *<a class="el" href="chan__phone_8c.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>, const char *<a class="el" href="chan__phone_8c.html#ade5a89f9bee15a492c760ec1765a292d">cid_name</a>, struct <a class="el" href="structast__variable.html">ast_variable</a> *vars, const char *account, struct <a class="el" href="structast__channel.html">ast_channel</a> **locked_channel)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a7705e0c38bd69f8dceb03861f7527b60">ast_pbx_outgoing_exten</a> (const char *<a class="el" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>, int <a class="el" href="chan__alsa_8c.html#a98f5e70e98f6dc48e3c5ba316066d540">format</a>, void *data, int timeout, const char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, const char *<a class="el" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, int priority, int *reason, int sync, const char *<a class="el" href="chan__phone_8c.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>, const char *<a class="el" href="chan__phone_8c.html#ade5a89f9bee15a492c760ec1765a292d">cid_name</a>, struct <a class="el" href="structast__variable.html">ast_variable</a> *vars, const char *account, struct <a class="el" href="structast__channel.html">ast_channel</a> **locked_channel)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735">ast_pbx_result</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a44b6406c9220f7f2b610ac712369f405">ast_pbx_run</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Execute the PBX in the current thread.  <a href="#a44b6406c9220f7f2b610ac712369f405"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735">ast_pbx_result</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a2c502c100b8b4791d9efe395e08d620b">ast_pbx_run_args</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c, struct <a class="el" href="structast__pbx__args.html">ast_pbx_args</a> *args)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Execute the PBX in the current thread.  <a href="#a2c502c100b8b4791d9efe395e08d620b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735">ast_pbx_result</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a9a937fbb3b5f4e68880a9c5714a29ce5">ast_pbx_start</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create a new thread and start the PBX.  <a href="#a9a937fbb3b5f4e68880a9c5714a29ce5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a6cd4c64e374623ea3393fbc5d580f68e">ast_processed_calls</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Retrieve the total <a class="el" href="structnumber.html" title="Number structure.">number</a> of calls processed through the PBX since last restart.  <a href="#a6cd4c64e374623ea3393fbc5d580f68e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#af1a624244a07626a8f70843005206c95">ast_rdlock_context</a> (struct <a class="el" href="structast__context.html">ast_context</a> *con)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read locks a given context.  <a href="#af1a624244a07626a8f70843005206c95"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#aa2c309331fff0a086ab8e216f803d546">ast_rdlock_contexts</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read locks the context list.  <a href="#aa2c309331fff0a086ab8e216f803d546"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a5297fa9c52ff50da5b08c7217d9251b4">ast_register_switch</a> (struct <a class="el" href="structast__switch.html">ast_switch</a> *sw)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Register an alternative dialplan switch.  <a href="#a5297fa9c52ff50da5b08c7217d9251b4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a94ca71e502d95d1cb0a815072e059aee">ast_spawn_extension</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c, const char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, const char *<a class="el" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, int priority, const char *callerid, int *found, int combined_find_spawn)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Launch a new <a class="el" href="structextension.html">extension</a> (i.e. new stack).  <a href="#a94ca71e502d95d1cb0a815072e059aee"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a805796e4728845bff70c4caf5b224308">ast_unlock_context</a> (struct <a class="el" href="structast__context.html">ast_context</a> *con)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#ae517a87b356aec60d5de4591ef94581b">ast_unlock_contexts</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Unlocks contexts.  <a href="#ae517a87b356aec60d5de4591ef94581b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a4b11d763a689cb0df33a4a16c9d89ef3">ast_unregister_switch</a> (struct <a class="el" href="structast__switch.html">ast_switch</a> *sw)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Unregister an alternative switch.  <a href="#a4b11d763a689cb0df33a4a16c9d89ef3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a2c961dcbdcade8fac28960ed67c89bd2">ast_wrlock_context</a> (struct <a class="el" href="structast__context.html">ast_context</a> *con)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Write locks a given context.  <a href="#a2c961dcbdcade8fac28960ed67c89bd2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a18c87dac5f7f4368c11b67d8026adc22">ast_wrlock_contexts</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Write locks the context list.  <a href="#a18c87dac5f7f4368c11b67d8026adc22"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a4e6adb9c7783644ea993758d9c7e28c8">ast_wrlock_contexts_version</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a92a606276589c513842f0cd7e455126b">pbx_builtin_clear_globals</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b">pbx_builtin_getvar_helper</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return a pointer to the value of the corresponding channel variable.  <a href="#a98c5425b90ec7c5e136a40f529170b1b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a9e00ba1268d8792b95063aeedd9244ea">pbx_builtin_pushvar_helper</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, const char *value)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add a variable to the channel variable stack, without removing any previously set value.  <a href="#a9e00ba1268d8792b95063aeedd9244ea"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#abc705e1c806491af6419892a1237d920">pbx_builtin_raise_exception</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a847dc86089ce693d89a534512f16dad1">pbx_builtin_serialize_variables</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structast__str.html">ast_str</a> **<a class="el" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create a human-readable string, specifying all variables and their corresponding <a class="el" href="structvalues.html">values</a>.  <a href="#a847dc86089ce693d89a534512f16dad1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#aa2489c1ea3b067f827ad20abf363cdcd">pbx_builtin_setvar</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, void *data)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Parse and set a single channel variable, where the name and value are separated with an '=' character.  <a href="#aa2489c1ea3b067f827ad20abf363cdcd"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c">pbx_builtin_setvar_helper</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, const char *value)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add a variable to the channel variable stack, removing the most recently set value for the same name.  <a href="#ac74f20f5a5f022a60fdf2db0dc84889c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a990bfc8582dc017423d8518bcc110a2c">pbx_builtin_setvar_multiple</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, void *data)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Parse and set multiple channel variables, where the pairs are separated by the ',' character, and name and value are separated with an '=' character.  <a href="#a990bfc8582dc017423d8518bcc110a2c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#ac8447d16749d15c783e1dff4d8f8e495">pbx_checkcondition</a> (const char *condition)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Evaluate a condition.  <a href="#ac8447d16749d15c783e1dff4d8f8e495"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#afb87ff7a4504ef6031a45ae4170acaad">pbx_exec</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c, struct <a class="el" href="structast__app.html">ast_app</a> *<a class="el" href="res__agi_8c.html#a9e5f57131367eff409b9e0bd7b31aa1a">app</a>, void *data)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Execute an application.  <a href="#afb87ff7a4504ef6031a45ae4170acaad"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__exten.html">ast_exten</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a63e03245dc48558e55da8890b3dbb87e">pbx_find_extension</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structast__context.html">ast_context</a> *bypass, struct <a class="el" href="structpbx__find__info.html">pbx_find_info</a> *q, const char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, const char *<a class="el" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, int priority, const char *label, const char *callerid, enum <a class="el" href="extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26be">ext_match_t</a> action)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__app.html">ast_app</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a0db9808b647984133225652170b22b79">pbx_findapp</a> (const char *<a class="el" href="res__agi_8c.html#a9e5f57131367eff409b9e0bd7b31aa1a">app</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Look up an application.  <a href="#a0db9808b647984133225652170b22b79"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#aaf906a18ba2dcd53c35f59869757521f">pbx_retrieve_variable</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c, const char *var, char **ret, char *workspace, int workspacelen, struct varshead *headp)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Retrieve the value of a builtin variable or variable from the channel variable stack.  <a href="#aaf906a18ba2dcd53c35f59869757521f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#aeb0407c693573096981db1a00fab4eb8">pbx_set_autofallthrough</a> (int newval)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a86a7469073a22661d4db7086245c5b18">pbx_set_extenpatternmatchnew</a> (int newval)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a7a46e2644221be6cb7ca7ba2723006cd">pbx_set_overrideswitch</a> (const char *newval)</td></tr>
<tr><td colspan="2"><div class="groupHeader">Registrar info functions ...</div></td></tr>
<tr><td colspan="2"><div class="groupText"><p><a class="anchor" id="amgrpc2c1062849308d00547988793404e0aa"></a> </p>
<br/><br/></div></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a9df0a5d301454fe924172cf89c7165a4">ast_get_context_registrar</a> (struct <a class="el" href="structast__context.html">ast_context</a> *c)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a7f23f7c798d61e68c32b21d3e0cd15a2">ast_get_extension_registrar</a> (struct <a class="el" href="structast__exten.html">ast_exten</a> *e)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a1a219215514e9ed08ff67cc02c2dd1d3">ast_get_ignorepat_registrar</a> (struct <a class="el" href="structast__ignorepat.html">ast_ignorepat</a> *ip)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a7a9aa5cd362edc7d593196f57686c2b9">ast_get_include_registrar</a> (struct <a class="el" href="structast__include.html">ast_include</a> *i)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a1361d2a84278cee910c8ca0c7964c84c">ast_get_switch_registrar</a> (struct <a class="el" href="structast__sw.html">ast_sw</a> *sw)</td></tr>
<tr><td colspan="2"><div class="groupHeader">Other Extension stuff</div></td></tr>
<tr><td colspan="2"><div class="groupText"><p><a class="anchor" id="amgrp486480a02ac456a4e64adfab465900f1"></a> </p>
<br/><br/></div></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a6594bb017b4d4fe1bc42370cc32ec974">ast_get_extension_app</a> (struct <a class="el" href="structast__exten.html">ast_exten</a> *e)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#ac0a6c0c39796f36864868365d8989f02">ast_get_extension_app_data</a> (struct <a class="el" href="structast__exten.html">ast_exten</a> *e)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#aee004b6fcfccea3fa6acf9b7264f42c9">ast_get_extension_cidmatch</a> (struct <a class="el" href="structast__exten.html">ast_exten</a> *e)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a266960fe6aa4db1066ed0b012fb7eb62">ast_get_extension_label</a> (struct <a class="el" href="structast__exten.html">ast_exten</a> *e)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a26c679c70c1a8dd0968579be0c1755ab">ast_get_extension_matchcid</a> (struct <a class="el" href="structast__exten.html">ast_exten</a> *e)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a1662981db35d4125afaf6de98b2ba52f">ast_get_extension_priority</a> (struct <a class="el" href="structast__exten.html">ast_exten</a> *<a class="el" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>)</td></tr>
<tr><td colspan="2"><div class="groupHeader">Substitution routines, using static string buffers</div></td></tr>
<tr><td colspan="2"><div class="groupText"><p><a class="anchor" id="amgrp622c36f42aae01a14f57718cb0b39710"></a> </p>
<br/><br/></div></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a6e3d30e37949465cd18bae8bfdd3cc0f">ast_str_substitute_variables</a> (struct <a class="el" href="structast__str.html">ast_str</a> **<a class="el" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, size_t maxlen, struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *templ)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a3eac2009888ce9c4a108e882d02cb04d">pbx_substitute_variables_helper</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c, const char *cp1, char *cp2, int count)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a4019ca376e3f30f3cd342e29d3145742">pbx_substitute_variables_helper_full</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c, struct varshead *headp, const char *cp1, char *cp2, int cp2_size, size_t *used)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a2b3355625306d4b98ca8047cd2245459">pbx_substitute_variables_varshead</a> (struct varshead *headp, const char *cp1, char *cp2, int count)</td></tr>
<tr><td colspan="2"><div class="groupHeader">Walking functions ...</div></td></tr>
<tr><td colspan="2"><div class="groupText"><p><a class="anchor" id="amgrp6d36db2fa87c97498d07073a66372632"></a> </p>
<br/><br/></div></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__exten.html">ast_exten</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#aa63685577f3479dcf31a9e77b2ff05a7">ast_walk_context_extensions</a> (struct <a class="el" href="structast__context.html">ast_context</a> *con, struct <a class="el" href="structast__exten.html">ast_exten</a> *priority)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__ignorepat.html">ast_ignorepat</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a0e9dbe4e0003f65b67c78979f2fbfa8e">ast_walk_context_ignorepats</a> (struct <a class="el" href="structast__context.html">ast_context</a> *con, struct <a class="el" href="structast__ignorepat.html">ast_ignorepat</a> *ip)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__include.html">ast_include</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a142de6e0271ada6b306f2f7420a3fd77">ast_walk_context_includes</a> (struct <a class="el" href="structast__context.html">ast_context</a> *con, struct <a class="el" href="structast__include.html">ast_include</a> *inc)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__sw.html">ast_sw</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a64653e3c5cdfab48075b4001bd74655d">ast_walk_context_switches</a> (struct <a class="el" href="structast__context.html">ast_context</a> *con, struct <a class="el" href="structast__sw.html">ast_sw</a> *sw)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__context.html">ast_context</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a4cd5282ca555370652a7304c0c7ea4c4">ast_walk_contexts</a> (struct <a class="el" href="structast__context.html">ast_context</a> *con)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__exten.html">ast_exten</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a6772ce6e8de86d4b6c382dbf68ea4755">ast_walk_extension_priorities</a> (struct <a class="el" href="structast__exten.html">ast_exten</a> *<a class="el" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, struct <a class="el" href="structast__exten.html">ast_exten</a> *priority)</td></tr>
<tr><td colspan="2"><p><a class="anchor" id="amgrpd41d8cd98f00b204e9800998ecf8427e"></a> </p>
<br/><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#aabc320b5f03ccc254bde047d2e2ec0e0">AST_PBX_ERROR</a>&nbsp;&nbsp;&nbsp;1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a3dde03e263918d8ba87126173deda611">AST_PBX_HANGUP</a>&nbsp;&nbsp;&nbsp;-1</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Special return <a class="el" href="structvalues.html">values</a> from applications to the PBX.  <a href="#a3dde03e263918d8ba87126173deda611"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a653bef57d41c00d6b1f79c94fe19ec7b">AST_PBX_INCOMPLETE</a>&nbsp;&nbsp;&nbsp;12</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#ad45f3e76d15c861a07dd65d6c3784018">AST_PBX_OK</a>&nbsp;&nbsp;&nbsp;0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a721c6ba091102f155a586e09b2a526bf">ast_context_remove_extension</a> (const char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, const char *<a class="el" href="structextension.html">extension</a>, int priority, const char *<a class="el" href="pval_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Simply remove <a class="el" href="structextension.html">extension</a> from context.  <a href="#a721c6ba091102f155a586e09b2a526bf"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a25dad382feec89a9bbc6c5284bb30e25">ast_context_remove_extension2</a> (struct <a class="el" href="structast__context.html">ast_context</a> *con, const char *<a class="el" href="structextension.html">extension</a>, int priority, const char *<a class="el" href="pval_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>, int already_locked)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This functionc locks given context, search for the right <a class="el" href="structextension.html">extension</a> and fires out all peer in this extensions with given priority. If priority is set to 0, all <a class="el" href="structpeers.html">peers</a> are removed. After that, unlock context and return.  <a href="#a25dad382feec89a9bbc6c5284bb30e25"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a85ffdbb47cc54f8d125b4276d6bd3170">ast_context_remove_extension_callerid</a> (const char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, const char *<a class="el" href="structextension.html">extension</a>, int priority, const char *callerid, int matchcid, const char *<a class="el" href="pval_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#abb8840d8ea2dd143fa4f606d048ad6b7">ast_context_remove_extension_callerid2</a> (struct <a class="el" href="structast__context.html">ast_context</a> *con, const char *<a class="el" href="structextension.html">extension</a>, int priority, const char *callerid, int matchcid, const char *<a class="el" href="pval_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>, int already_locked)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a> (struct <a class="el" href="structast__context.html">ast_context</a> *con)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__context.html">ast_context</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a65bb6651308bdad136b637965835cb82">ast_get_extension_context</a> (struct <a class="el" href="structast__exten.html">ast_exten</a> *<a class="el" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a6fb940c1fd9c74b9d573e0a91bb23697">ast_get_extension_name</a> (struct <a class="el" href="structast__exten.html">ast_exten</a> *<a class="el" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a0c324514fc22df9cc5b32ceb68006e79">ast_get_ignorepat_name</a> (struct <a class="el" href="structast__ignorepat.html">ast_ignorepat</a> *ip)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#acb52f47bcc03f9dd5d781d7e272040b0">ast_get_include_name</a> (struct <a class="el" href="structast__include.html">ast_include</a> *include)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#accdca3b300f8f1ff523872bd3a129adc">ast_get_switch_data</a> (struct <a class="el" href="structast__sw.html">ast_sw</a> *sw)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#af947a04e100465f0c03b870129ba3e48">ast_get_switch_eval</a> (struct <a class="el" href="structast__sw.html">ast_sw</a> *sw)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a87693eca302936ade0be97cab21e4f56">ast_get_switch_name</a> (struct <a class="el" href="structast__sw.html">ast_sw</a> *sw)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a20a2f5668173430437db02cdd0acc9f3">ast_hashtab_compare_contexts</a> (const void *ah_a, const void *ah_b)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">hashtable functions for contexts  <a href="#a20a2f5668173430437db02cdd0acc9f3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pbx_8h.html#a56461864a4e21b14e753b78f9ac7afb7">ast_hashtab_hash_contexts</a> (const void *obj)</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Core PBX routines and definitions. </p>

<p>Definition in file <a class="el" href="pbx_8h_source.html">pbx.h</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a8af0e93442a9e468425f63cc52b0ac7b"></a><!-- doxytag: member="pbx.h::ast_custom_function_register" ref="a8af0e93442a9e468425f63cc52b0ac7b" args="(acf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ast_custom_function_register</td>
          <td>(</td>
          <td class="paramtype">acf&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;__ast_custom_function_register(acf, <a class="el" href="structast__module__info.html">ast_module_info</a>-&gt;self)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Register a custom function. </p>

<p>Definition at line <a class="el" href="pbx_8h_source.html#l01028">1028</a> of file <a class="el" href="pbx_8h_source.html">pbx.h</a>.</p>

<p>Referenced by <a class="el" href="app__jack_8c_source.html#l01011">load_module()</a>, and <a class="el" href="func__odbc_8c_source.html#l01394">reload()</a>.</p>

</div>
</div>
<a class="anchor" id="a3414b82af9b33fe907c9377c5c73c453"></a><!-- doxytag: member="pbx.h::AST_MAX_APP" ref="a3414b82af9b33fe907c9377c5c73c453" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_MAX_APP&nbsp;&nbsp;&nbsp;32</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Max length of an application </p>

<p>Definition at line <a class="el" href="pbx_8h_source.html#l00036">36</a> of file <a class="el" href="pbx_8h_source.html">pbx.h</a>.</p>

<p>Referenced by <a class="el" href="app__meetme_8c_source.html#l05973">destroy_station()</a>, <a class="el" href="pbx_8c_source.html#l03095">handle_show_function()</a>, <a class="el" href="pbx_8c_source.html#l05186">print_app_docs()</a>, and <a class="el" href="app__meetme_8c_source.html#l06177">sla_build_station()</a>.</p>

</div>
</div>
<a class="anchor" id="aabc320b5f03ccc254bde047d2e2ec0e0"></a><!-- doxytag: member="pbx.h::AST_PBX_ERROR" ref="aabc320b5f03ccc254bde047d2e2ec0e0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_PBX_ERROR&nbsp;&nbsp;&nbsp;1</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Jump to the 'e' exten </p>

<p>Definition at line <a class="el" href="pbx_8h_source.html#l00045">45</a> of file <a class="el" href="pbx_8h_source.html">pbx.h</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l04214">__ast_pbx_run()</a>.</p>

</div>
</div>
<a class="anchor" id="a3dde03e263918d8ba87126173deda611"></a><!-- doxytag: member="pbx.h::AST_PBX_HANGUP" ref="a3dde03e263918d8ba87126173deda611" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_PBX_HANGUP&nbsp;&nbsp;&nbsp;-1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Special return <a class="el" href="structvalues.html">values</a> from applications to the PBX. </p>
<p>Jump to the 'h' exten </p>

<p>Definition at line <a class="el" href="pbx_8h_source.html#l00043">43</a> of file <a class="el" href="pbx_8h_source.html">pbx.h</a>.</p>

</div>
</div>
<a class="anchor" id="a653bef57d41c00d6b1f79c94fe19ec7b"></a><!-- doxytag: member="pbx.h::AST_PBX_INCOMPLETE" ref="a653bef57d41c00d6b1f79c94fe19ec7b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_PBX_INCOMPLETE&nbsp;&nbsp;&nbsp;12</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Return to PBX matching, allowing more digits for the <a class="el" href="structextension.html">extension</a> </p>

<p>Definition at line <a class="el" href="pbx_8h_source.html#l00046">46</a> of file <a class="el" href="pbx_8h_source.html">pbx.h</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l04214">__ast_pbx_run()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="pbx_8c_source.html#l08536">pbx_builtin_incomplete()</a>, and <a class="el" href="app__dial_8c_source.html#l02345">retrydial_exec()</a>.</p>

</div>
</div>
<a class="anchor" id="a7b423f7cbc393639fde9085830313f03"></a><!-- doxytag: member="pbx.h::AST_PBX_KEEP" ref="a7b423f7cbc393639fde9085830313f03" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_PBX_KEEP&nbsp;&nbsp;&nbsp;0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8h_source.html#l00038">38</a> of file <a class="el" href="pbx_8h_source.html">pbx.h</a>.</p>

</div>
</div>
<a class="anchor" id="a05848c0de74d85dc2fb259f332d33f25"></a><!-- doxytag: member="pbx.h::AST_PBX_MAX_STACK" ref="a05848c0de74d85dc2fb259f332d33f25" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_PBX_MAX_STACK&nbsp;&nbsp;&nbsp;128</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8h_source.html#l01095">1095</a> of file <a class="el" href="pbx_8h_source.html">pbx.h</a>.</p>

</div>
</div>
<a class="anchor" id="ad45f3e76d15c861a07dd65d6c3784018"></a><!-- doxytag: member="pbx.h::AST_PBX_OK" ref="ad45f3e76d15c861a07dd65d6c3784018" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_PBX_OK&nbsp;&nbsp;&nbsp;0</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>No errors </p>

<p>Definition at line <a class="el" href="pbx_8h_source.html#l00044">44</a> of file <a class="el" href="pbx_8h_source.html">pbx.h</a>.</p>

</div>
</div>
<a class="anchor" id="aed4e41b2b2c49b629e2eef07c702c2c4"></a><!-- doxytag: member="pbx.h::AST_PBX_REPLACE" ref="aed4e41b2b2c49b629e2eef07c702c2c4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_PBX_REPLACE&nbsp;&nbsp;&nbsp;1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8h_source.html#l00039">39</a> of file <a class="el" href="pbx_8h_source.html">pbx.h</a>.</p>

</div>
</div>
<a class="anchor" id="ad2e753a683024fad0b34ece3b1aef83a"></a><!-- doxytag: member="pbx.h::PRIORITY_HINT" ref="ad2e753a683024fad0b34ece3b1aef83a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PRIORITY_HINT&nbsp;&nbsp;&nbsp;-1</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Special Priority for a hint </p>

<p>Definition at line <a class="el" href="pbx_8h_source.html#l00049">49</a> of file <a class="el" href="pbx_8h_source.html">pbx.h</a>.</p>

<p>Referenced by <a class="el" href="pval_8c_source.html#l04207">add_extensions()</a>, <a class="el" href="pbx_8c_source.html#l07451">add_pri_lockopt()</a>, <a class="el" href="pbx_8c_source.html#l07637">ast_add_extension2_lockopt()</a>, <a class="el" href="pbx_8c_source.html#l03755">ast_hint_extension_nolock()</a>, <a class="el" href="pbx_8c_source.html#l06623">ast_merge_contexts_and_delete()</a>, <a class="el" href="pbx_8c_source.html#l04525">destroy_exten()</a>, <a class="el" href="app__meetme_8c_source.html#l05973">destroy_station()</a>, <a class="el" href="pbx__config_8c_source.html#l00902">handle_cli_dialplan_add_extension()</a>, <a class="el" href="pbx__config_8c_source.html#l00305">handle_cli_dialplan_remove_extension()</a>, <a class="el" href="pbx__config_8c_source.html#l00672">handle_cli_dialplan_save()</a>, <a class="el" href="pbx_8c_source.html#l05957">manager_show_dialplan_helper()</a>, <a class="el" href="features_8c_source.html#l03659">park_add_hints()</a>, <a class="el" href="pbx__config_8c_source.html#l01367">pbx_load_config()</a>, <a class="el" href="pbx_8c_source.html#l05607">print_ext()</a>, and <a class="el" href="app__meetme_8c_source.html#l06177">sla_build_station()</a>.</p>

</div>
</div>
<a class="anchor" id="aa2d7a93c24186594d8c09e904fa17132"></a><!-- doxytag: member="pbx.h::STATUS_NO_CONTEXT" ref="aa2d7a93c24186594d8c09e904fa17132" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATUS_NO_CONTEXT&nbsp;&nbsp;&nbsp;1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8h_source.html#l01090">1090</a> of file <a class="el" href="pbx_8h_source.html">pbx.h</a>.</p>

</div>
</div>
<a class="anchor" id="a53e8d9faad7e0156772e9559df5f8c2e"></a><!-- doxytag: member="pbx.h::STATUS_NO_EXTENSION" ref="a53e8d9faad7e0156772e9559df5f8c2e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATUS_NO_EXTENSION&nbsp;&nbsp;&nbsp;2</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8h_source.html#l01091">1091</a> of file <a class="el" href="pbx_8h_source.html">pbx.h</a>.</p>

</div>
</div>
<a class="anchor" id="a5062f2413e9425755149f855577b602f"></a><!-- doxytag: member="pbx.h::STATUS_NO_LABEL" ref="a5062f2413e9425755149f855577b602f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATUS_NO_LABEL&nbsp;&nbsp;&nbsp;4</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8h_source.html#l01093">1093</a> of file <a class="el" href="pbx_8h_source.html">pbx.h</a>.</p>

</div>
</div>
<a class="anchor" id="ab6422b4f1e9de4cb16307bd081b8706b"></a><!-- doxytag: member="pbx.h::STATUS_NO_PRIORITY" ref="ab6422b4f1e9de4cb16307bd081b8706b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATUS_NO_PRIORITY&nbsp;&nbsp;&nbsp;3</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8h_source.html#l01092">1092</a> of file <a class="el" href="pbx_8h_source.html">pbx.h</a>.</p>

</div>
</div>
<a class="anchor" id="ae56fdb340b23940f7a64ed2e37c1774a"></a><!-- doxytag: member="pbx.h::STATUS_SUCCESS" ref="ae56fdb340b23940f7a64ed2e37c1774a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATUS_SUCCESS&nbsp;&nbsp;&nbsp;5</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8h_source.html#l01094">1094</a> of file <a class="el" href="pbx_8h_source.html">pbx.h</a>.</p>

</div>
</div>
<hr/><h2>Typedef Documentation</h2>
<a class="anchor" id="aa158b092800168cef19ea3fdd5b47538"></a><!-- doxytag: member="pbx.h::ast_state_cb_type" ref="aa158b092800168cef19ea3fdd5b47538" args=")(char *context, char *id, enum ast_extension_states state, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef int(* <a class="el" href="pbx_8h.html#aa158b092800168cef19ea3fdd5b47538">ast_state_cb_type</a>)(char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, char *<a class="el" href="res__ais_8c.html#a2465fd4497a7402ad72da7d6e03f9934">id</a>, enum <a class="el" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625f">ast_extension_states</a> <a class="el" href="structstate.html">state</a>, void *data)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Typedef for devicestate and hint callbacks. </p>

<p>Definition at line <a class="el" href="pbx_8h_source.html#l00074">74</a> of file <a class="el" href="pbx_8h_source.html">pbx.h</a>.</p>

</div>
</div>
<a class="anchor" id="a93ee7200f8a12fa56224b85d2483693d"></a><!-- doxytag: member="pbx.h::ast_switch_f" ref="a93ee7200f8a12fa56224b85d2483693d" args=")(struct ast_channel *chan, const char *context, const char *exten, int priority, const char *callerid, const char *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef int( <a class="el" href="pbx_8h.html#a93ee7200f8a12fa56224b85d2483693d">ast_switch_f</a>)(struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, const char *<a class="el" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, int priority, const char *callerid, const char *data)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>All switch functions have the same interface, so define a type for them. </p>
<p>Data structure associated with an Asterisk switch </p>

<p>Definition at line <a class="el" href="pbx_8h_source.html#l00100">100</a> of file <a class="el" href="pbx_8h_source.html">pbx.h</a>.</p>

</div>
</div>
<hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="a8717a951656993c40bd851ebf50f58e3"></a><!-- doxytag: member="pbx.h::ast_doc_src" ref="a8717a951656993c40bd851ebf50f58e3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="pbx_8h.html#a8717a951656993c40bd851ebf50f58e3">ast_doc_src</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>From where the documentation come from. </p>
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a8717a951656993c40bd851ebf50f58e3a24212840b7b1b0e9c1eebc8cfd89ab3e"></a><!-- doxytag: member="AST_XML_DOC" ref="a8717a951656993c40bd851ebf50f58e3a24212840b7b1b0e9c1eebc8cfd89ab3e" args="" -->AST_XML_DOC</em>&nbsp;</td><td>
<p>From XML documentation </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a8717a951656993c40bd851ebf50f58e3a7273ed64a1fd4a93692986eac376124a"></a><!-- doxytag: member="AST_STATIC_DOC" ref="a8717a951656993c40bd851ebf50f58e3a7273ed64a1fd4a93692986eac376124a" args="" -->AST_STATIC_DOC</em>&nbsp;</td><td>
<p>From application/function registration </p>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="pbx_8h_source.html#l00077">77</a> of file <a class="el" href="pbx_8h_source.html">pbx.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00077"></a>00077                  {
<a name="l00078"></a>00078    <a class="code" href="pbx_8h.html#a8717a951656993c40bd851ebf50f58e3a24212840b7b1b0e9c1eebc8cfd89ab3e">AST_XML_DOC</a>,            <span class="comment">/*!&lt; From XML documentation */</span>
<a name="l00079"></a>00079    <a class="code" href="pbx_8h.html#a8717a951656993c40bd851ebf50f58e3a7273ed64a1fd4a93692986eac376124a">AST_STATIC_DOC</a>          <span class="comment">/*!&lt; From application/function registration */</span>
<a name="l00080"></a>00080 };
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7e545df4a5f38ef25616c7bdf55d625f"></a><!-- doxytag: member="pbx.h::ast_extension_states" ref="a7e545df4a5f38ef25616c7bdf55d625f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625f">ast_extension_states</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Extension states. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>States can be combined<ul>
<li><a class="el" href="AstExtState.html">Extension and device states in Asterisk</a> </li>
</ul>
</dd></dl>
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a7e545df4a5f38ef25616c7bdf55d625fa3e2a2f5572580f74e94b6d5e80261ea7"></a><!-- doxytag: member="AST_EXTENSION_REMOVED" ref="a7e545df4a5f38ef25616c7bdf55d625fa3e2a2f5572580f74e94b6d5e80261ea7" args="" -->AST_EXTENSION_REMOVED</em>&nbsp;</td><td>
<p>Extension removed </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a7e545df4a5f38ef25616c7bdf55d625faf53cb090b99fb8e952c8151990bd4192"></a><!-- doxytag: member="AST_EXTENSION_DEACTIVATED" ref="a7e545df4a5f38ef25616c7bdf55d625faf53cb090b99fb8e952c8151990bd4192" args="" -->AST_EXTENSION_DEACTIVATED</em>&nbsp;</td><td>
<p>Extension hint removed </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a7e545df4a5f38ef25616c7bdf55d625fa435abb1e907b1cee83ec44d2d77866e6"></a><!-- doxytag: member="AST_EXTENSION_NOT_INUSE" ref="a7e545df4a5f38ef25616c7bdf55d625fa435abb1e907b1cee83ec44d2d77866e6" args="" -->AST_EXTENSION_NOT_INUSE</em>&nbsp;</td><td>
<p>No device INUSE or BUSY </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a7e545df4a5f38ef25616c7bdf55d625fa47e9214860b5f9b887945f7cd1baec1a"></a><!-- doxytag: member="AST_EXTENSION_INUSE" ref="a7e545df4a5f38ef25616c7bdf55d625fa47e9214860b5f9b887945f7cd1baec1a" args="" -->AST_EXTENSION_INUSE</em>&nbsp;</td><td>
<p>One or more devices INUSE </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a7e545df4a5f38ef25616c7bdf55d625fad62d357f0ccde2a718c374a0a4af2b98"></a><!-- doxytag: member="AST_EXTENSION_BUSY" ref="a7e545df4a5f38ef25616c7bdf55d625fad62d357f0ccde2a718c374a0a4af2b98" args="" -->AST_EXTENSION_BUSY</em>&nbsp;</td><td>
<p>All devices BUSY </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a7e545df4a5f38ef25616c7bdf55d625fa5820eb407f3a3dbc5046c97ad43ee1f3"></a><!-- doxytag: member="AST_EXTENSION_UNAVAILABLE" ref="a7e545df4a5f38ef25616c7bdf55d625fa5820eb407f3a3dbc5046c97ad43ee1f3" args="" -->AST_EXTENSION_UNAVAILABLE</em>&nbsp;</td><td>
<p>All devices UNAVAILABLE/UNREGISTERED </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a7e545df4a5f38ef25616c7bdf55d625fa4063bf4e94e14df04126be6f08cc7bfc"></a><!-- doxytag: member="AST_EXTENSION_RINGING" ref="a7e545df4a5f38ef25616c7bdf55d625fa4063bf4e94e14df04126be6f08cc7bfc" args="" -->AST_EXTENSION_RINGING</em>&nbsp;</td><td>
<p>All devices RINGING </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a7e545df4a5f38ef25616c7bdf55d625fa83180bb058ded006c01229431fc887f9"></a><!-- doxytag: member="AST_EXTENSION_ONHOLD" ref="a7e545df4a5f38ef25616c7bdf55d625fa83180bb058ded006c01229431fc887f9" args="" -->AST_EXTENSION_ONHOLD</em>&nbsp;</td><td>
<p>All devices ONHOLD </p>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="pbx_8h_source.html#l00055">55</a> of file <a class="el" href="pbx_8h_source.html">pbx.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00055"></a>00055                           {
<a name="l00056"></a>00056    <a class="code" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa3e2a2f5572580f74e94b6d5e80261ea7">AST_EXTENSION_REMOVED</a> = -2,   <span class="comment">/*!&lt; Extension removed */</span>
<a name="l00057"></a>00057    <a class="code" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625faf53cb090b99fb8e952c8151990bd4192">AST_EXTENSION_DEACTIVATED</a> = -1,  <span class="comment">/*!&lt; Extension hint removed */</span>
<a name="l00058"></a>00058    <a class="code" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa435abb1e907b1cee83ec44d2d77866e6">AST_EXTENSION_NOT_INUSE</a> = 0,  <span class="comment">/*!&lt; No device INUSE or BUSY  */</span>
<a name="l00059"></a>00059    <a class="code" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa47e9214860b5f9b887945f7cd1baec1a">AST_EXTENSION_INUSE</a> = 1 &lt;&lt; 0, <span class="comment">/*!&lt; One or more devices INUSE */</span>
<a name="l00060"></a>00060    <a class="code" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fad62d357f0ccde2a718c374a0a4af2b98">AST_EXTENSION_BUSY</a> = 1 &lt;&lt; 1,  <span class="comment">/*!&lt; All devices BUSY */</span>
<a name="l00061"></a>00061    <a class="code" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa5820eb407f3a3dbc5046c97ad43ee1f3">AST_EXTENSION_UNAVAILABLE</a> = 1 &lt;&lt; 2, <span class="comment">/*!&lt; All devices UNAVAILABLE/UNREGISTERED */</span>
<a name="l00062"></a>00062    <a class="code" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa4063bf4e94e14df04126be6f08cc7bfc">AST_EXTENSION_RINGING</a> = 1 &lt;&lt; 3,  <span class="comment">/*!&lt; All devices RINGING */</span>
<a name="l00063"></a>00063    <a class="code" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa83180bb058ded006c01229431fc887f9">AST_EXTENSION_ONHOLD</a> = 1 &lt;&lt; 4,   <span class="comment">/*!&lt; All devices ONHOLD */</span>
<a name="l00064"></a>00064 };
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0e4eb357d2ef42629fbcf191a473f735"></a><!-- doxytag: member="pbx.h::ast_pbx_result" ref="a0e4eb357d2ef42629fbcf191a473f735" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735">ast_pbx_result</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The result codes when starting the PBX on a channel with. </p>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="pbx_8c.html#a9a937fbb3b5f4e68880a9c5714a29ce5" title="Create a new thread and start the PBX.">ast_pbx_start</a>. <a class="el" href="pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735ab69a419c47206542956e9d933b6605f5">AST_PBX_CALL_LIMIT</a> refers to the maxcalls call limit in asterisk.conf </dd></dl>
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a0e4eb357d2ef42629fbcf191a473f735ae1482e87c137b03ef9f9c17cf4fb5ec4"></a><!-- doxytag: member="AST_PBX_SUCCESS" ref="a0e4eb357d2ef42629fbcf191a473f735ae1482e87c137b03ef9f9c17cf4fb5ec4" args="" -->AST_PBX_SUCCESS</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a0e4eb357d2ef42629fbcf191a473f735a4a46cde728f5cd375af4f2d5b1542490"></a><!-- doxytag: member="AST_PBX_FAILED" ref="a0e4eb357d2ef42629fbcf191a473f735a4a46cde728f5cd375af4f2d5b1542490" args="" -->AST_PBX_FAILED</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a0e4eb357d2ef42629fbcf191a473f735ab69a419c47206542956e9d933b6605f5"></a><!-- doxytag: member="AST_PBX_CALL_LIMIT" ref="a0e4eb357d2ef42629fbcf191a473f735ab69a419c47206542956e9d933b6605f5" args="" -->AST_PBX_CALL_LIMIT</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="pbx_8h_source.html#l00262">262</a> of file <a class="el" href="pbx_8h_source.html">pbx.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00262"></a>00262                     {
<a name="l00263"></a>00263    <a class="code" href="pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735ae1482e87c137b03ef9f9c17cf4fb5ec4">AST_PBX_SUCCESS</a> = 0,
<a name="l00264"></a>00264    <a class="code" href="pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735a4a46cde728f5cd375af4f2d5b1542490">AST_PBX_FAILED</a> = -1,
<a name="l00265"></a>00265    <a class="code" href="pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735ab69a419c47206542956e9d933b6605f5">AST_PBX_CALL_LIMIT</a> = -2,
<a name="l00266"></a>00266 };
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2b7f0fafc6995b2630658a4fd8df26be"></a><!-- doxytag: member="pbx.h::ext_match_t" ref="a2b7f0fafc6995b2630658a4fd8df26be" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26be">ext_match_t</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>When looking up extensions, we can have different <a class="el" href="structrequests.html">requests</a> identified by the 'action' argument, as follows. Note that the coding is such that the low 4 bits are the third argument to extension_match_core. </p>
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a2b7f0fafc6995b2630658a4fd8df26bea7e20dcb277877b81e8099470cd631277"></a><!-- doxytag: member="E_MATCHMORE" ref="a2b7f0fafc6995b2630658a4fd8df26bea7e20dcb277877b81e8099470cd631277" args="" -->E_MATCHMORE</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a2b7f0fafc6995b2630658a4fd8df26bea413c09377a892aa154e7669cbdaf27ba"></a><!-- doxytag: member="E_CANMATCH" ref="a2b7f0fafc6995b2630658a4fd8df26bea413c09377a892aa154e7669cbdaf27ba" args="" -->E_CANMATCH</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a2b7f0fafc6995b2630658a4fd8df26bea2e605157e82dec388ffc89c1694fb7be"></a><!-- doxytag: member="E_MATCH" ref="a2b7f0fafc6995b2630658a4fd8df26bea2e605157e82dec388ffc89c1694fb7be" args="" -->E_MATCH</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a2b7f0fafc6995b2630658a4fd8df26bea108ea5cb21cb0de3a1be976972c0a59c"></a><!-- doxytag: member="E_MATCH_MASK" ref="a2b7f0fafc6995b2630658a4fd8df26bea108ea5cb21cb0de3a1be976972c0a59c" args="" -->E_MATCH_MASK</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a2b7f0fafc6995b2630658a4fd8df26bea8f986496ee140e4c7167ae25ad28d0ee"></a><!-- doxytag: member="E_SPAWN" ref="a2b7f0fafc6995b2630658a4fd8df26bea8f986496ee140e4c7167ae25ad28d0ee" args="" -->E_SPAWN</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a2b7f0fafc6995b2630658a4fd8df26bea7b10ab7b3dd6af9d933dbb03dd183eb5"></a><!-- doxytag: member="E_FINDLABEL" ref="a2b7f0fafc6995b2630658a4fd8df26bea7b10ab7b3dd6af9d933dbb03dd183eb5" args="" -->E_FINDLABEL</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a2b7f0fafc6995b2630658a4fd8df26bea7e20dcb277877b81e8099470cd631277"></a><!-- doxytag: member="E_MATCHMORE" ref="a2b7f0fafc6995b2630658a4fd8df26bea7e20dcb277877b81e8099470cd631277" args="" -->E_MATCHMORE</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a2b7f0fafc6995b2630658a4fd8df26bea413c09377a892aa154e7669cbdaf27ba"></a><!-- doxytag: member="E_CANMATCH" ref="a2b7f0fafc6995b2630658a4fd8df26bea413c09377a892aa154e7669cbdaf27ba" args="" -->E_CANMATCH</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a2b7f0fafc6995b2630658a4fd8df26bea2e605157e82dec388ffc89c1694fb7be"></a><!-- doxytag: member="E_MATCH" ref="a2b7f0fafc6995b2630658a4fd8df26bea2e605157e82dec388ffc89c1694fb7be" args="" -->E_MATCH</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a2b7f0fafc6995b2630658a4fd8df26bea108ea5cb21cb0de3a1be976972c0a59c"></a><!-- doxytag: member="E_MATCH_MASK" ref="a2b7f0fafc6995b2630658a4fd8df26bea108ea5cb21cb0de3a1be976972c0a59c" args="" -->E_MATCH_MASK</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a2b7f0fafc6995b2630658a4fd8df26bea8f986496ee140e4c7167ae25ad28d0ee"></a><!-- doxytag: member="E_SPAWN" ref="a2b7f0fafc6995b2630658a4fd8df26bea8f986496ee140e4c7167ae25ad28d0ee" args="" -->E_SPAWN</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a2b7f0fafc6995b2630658a4fd8df26bea7b10ab7b3dd6af9d933dbb03dd183eb5"></a><!-- doxytag: member="E_FINDLABEL" ref="a2b7f0fafc6995b2630658a4fd8df26bea7b10ab7b3dd6af9d933dbb03dd183eb5" args="" -->E_FINDLABEL</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="pbx_8h_source.html#l01081">1081</a> of file <a class="el" href="pbx_8h_source.html">pbx.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01081"></a>01081                  {
<a name="l01082"></a>01082    <a class="code" href="extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7e20dcb277877b81e8099470cd631277">E_MATCHMORE</a> =  0x00, <span class="comment">/* extension can match but only with more &apos;digits&apos; */</span>
<a name="l01083"></a>01083    <a class="code" href="extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea413c09377a892aa154e7669cbdaf27ba">E_CANMATCH</a> =   0x01, <span class="comment">/* extension can match with or without more &apos;digits&apos; */</span>
<a name="l01084"></a>01084    <a class="code" href="extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea2e605157e82dec388ffc89c1694fb7be">E_MATCH</a> =   0x02, <span class="comment">/* extension is an exact match */</span>
<a name="l01085"></a>01085    <a class="code" href="extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea108ea5cb21cb0de3a1be976972c0a59c">E_MATCH_MASK</a> = 0x03, <span class="comment">/* mask for the argument to extension_match_core() */</span>
<a name="l01086"></a>01086    <a class="code" href="extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea8f986496ee140e4c7167ae25ad28d0ee">E_SPAWN</a> =   0x12, <span class="comment">/* want to spawn an extension. Requires exact match */</span>
<a name="l01087"></a>01087    <a class="code" href="extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7b10ab7b3dd6af9d933dbb03dd183eb5">E_FINDLABEL</a> =  0x22  <span class="comment">/* returns the priority for a given label. Requires exact match */</span>
<a name="l01088"></a>01088 };
</pre></div></p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="aad8771c7e3b2170a749946f1a8b758aa"></a><!-- doxytag: member="pbx.h::__ast_custom_function_register" ref="aad8771c7e3b2170a749946f1a8b758aa" args="(struct ast_custom_function *acf, struct ast_module *mod)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int __ast_custom_function_register </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__custom__function.html">ast_custom_function</a> *&nbsp;</td>
          <td class="paramname"> <em>acf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__module.html">ast_module</a> *&nbsp;</td>
          <td class="paramname"> <em>mod</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Register a custom function. </p>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l03289">3289</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l03244">acf_retrieve_docs()</a>, <a class="el" href="structast__custom__function.html#afdf1f4a1680938ef9b90fbe3ecafbca4">ast_custom_function::acflist</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="linkedlists_8h_source.html#l00594">AST_RWLIST_INSERT_BEFORE_CURRENT</a>, <a class="el" href="linkedlists_8h_source.html#l00725">AST_RWLIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h_source.html#l00493">AST_RWLIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00541">AST_RWLIST_TRAVERSE_SAFE_BEGIN</a>, <a class="el" href="linkedlists_8h_source.html#l00601">AST_RWLIST_TRAVERSE_SAFE_END</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, <a class="el" href="pbx_8h_source.html#l00079">AST_STATIC_DOC</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="term_8h_source.html#l00060">COLOR_BRCYAN</a>, <a class="el" href="pbx_8h_source.html#l00092">ast_custom_function::docsrc</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="pbx_8h_source.html#l00095">ast_custom_function::mod</a>, <a class="el" href="pbx_8h_source.html#l00084">ast_custom_function::name</a>, and <a class="el" href="term_8c_source.html#l00168">term_color()</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l09302">load_pbx()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03290"></a>03290 {
<a name="l03291"></a>03291    <span class="keyword">struct </span><a class="code" href="structast__custom__function.html" title="Data structure associated with a custom dialplan function.">ast_custom_function</a> *cur;
<a name="l03292"></a>03292    <span class="keywordtype">char</span> tmps[80];
<a name="l03293"></a>03293 
<a name="l03294"></a>03294    <span class="keywordflow">if</span> (!acf) {
<a name="l03295"></a>03295       <span class="keywordflow">return</span> -1;
<a name="l03296"></a>03296    }
<a name="l03297"></a>03297 
<a name="l03298"></a>03298    acf-&gt;<a class="code" href="structast__custom__function.html#a782aff512368932b8d71b3633f88cb04">mod</a> = mod;
<a name="l03299"></a>03299    acf-&gt;<a class="code" href="structast__custom__function.html#aa871ca3c361d229d4e37edf3c6016cc1">docsrc</a> = <a class="code" href="pbx_8h.html#a8717a951656993c40bd851ebf50f58e3a7273ed64a1fd4a93692986eac376124a">AST_STATIC_DOC</a>;
<a name="l03300"></a>03300 
<a name="l03301"></a>03301    <span class="keywordflow">if</span> (<a class="code" href="pbx_8c.html#a65ccacb4a7ea0a0b3a043beb8b9c4cb2">acf_retrieve_docs</a>(acf)) {
<a name="l03302"></a>03302       <span class="keywordflow">return</span> -1;
<a name="l03303"></a>03303    }
<a name="l03304"></a>03304 
<a name="l03305"></a>03305    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structacf__root.html">acf_root</a>);
<a name="l03306"></a>03306 
<a name="l03307"></a>03307    <a class="code" href="linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;<a class="code" href="structacf__root.html">acf_root</a>, cur, <a class="code" href="structast__custom__function.html#afdf1f4a1680938ef9b90fbe3ecafbca4">acflist</a>) {
<a name="l03308"></a>03308       <span class="keywordflow">if</span> (!strcmp(acf-&gt;<a class="code" href="structast__custom__function.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, cur-&gt;<a class="code" href="structast__custom__function.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)) {
<a name="l03309"></a>03309          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Function %s already registered.\n&quot;</span>, acf-&gt;<a class="code" href="structast__custom__function.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);
<a name="l03310"></a>03310          <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structacf__root.html">acf_root</a>);
<a name="l03311"></a>03311          <span class="keywordflow">return</span> -1;
<a name="l03312"></a>03312       }
<a name="l03313"></a>03313    }
<a name="l03314"></a>03314 
<a name="l03315"></a>03315    <span class="comment">/* Store in alphabetical order */</span>
<a name="l03316"></a>03316    <a class="code" href="linkedlists_8h.html#a21be6da4b2146b04b4868c2be5cae750">AST_RWLIST_TRAVERSE_SAFE_BEGIN</a>(&amp;<a class="code" href="structacf__root.html">acf_root</a>, cur, <a class="code" href="structast__custom__function.html#afdf1f4a1680938ef9b90fbe3ecafbca4">acflist</a>) {
<a name="l03317"></a>03317       <span class="keywordflow">if</span> (strcasecmp(acf-&gt;<a class="code" href="structast__custom__function.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, cur-&gt;<a class="code" href="structast__custom__function.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>) &lt; 0) {
<a name="l03318"></a>03318          <a class="code" href="linkedlists_8h.html#acf8253a64f9a4e2170454f4bf0559e33">AST_RWLIST_INSERT_BEFORE_CURRENT</a>(acf, <a class="code" href="structast__custom__function.html#afdf1f4a1680938ef9b90fbe3ecafbca4">acflist</a>);
<a name="l03319"></a>03319          <span class="keywordflow">break</span>;
<a name="l03320"></a>03320       }
<a name="l03321"></a>03321    }
<a name="l03322"></a>03322    <a class="code" href="linkedlists_8h.html#a6bf0e81cb6ef01532ddebaba68f6de28">AST_RWLIST_TRAVERSE_SAFE_END</a>;
<a name="l03323"></a>03323 
<a name="l03324"></a>03324    <span class="keywordflow">if</span> (!cur) {
<a name="l03325"></a>03325       <a class="code" href="linkedlists_8h.html#aadda916488b2d151af4426e2f06ad332">AST_RWLIST_INSERT_TAIL</a>(&amp;<a class="code" href="structacf__root.html">acf_root</a>, acf, <a class="code" href="structast__custom__function.html#afdf1f4a1680938ef9b90fbe3ecafbca4">acflist</a>);
<a name="l03326"></a>03326    }
<a name="l03327"></a>03327 
<a name="l03328"></a>03328    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structacf__root.html">acf_root</a>);
<a name="l03329"></a>03329 
<a name="l03330"></a>03330    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Registered custom function &apos;%s&apos;\n&quot;</span>, <a class="code" href="term_8h.html#a7b6c72116c334f40bf7c1e50e793c93b">term_color</a>(tmps, acf-&gt;<a class="code" href="structast__custom__function.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <a class="code" href="term_8h.html#a23aeefae76b2cacc1a6162de88c3fff0">COLOR_BRCYAN</a>, 0, <span class="keyword">sizeof</span>(tmps)));
<a name="l03331"></a>03331 
<a name="l03332"></a>03332    <span class="keywordflow">return</span> 0;
<a name="l03333"></a>03333 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a52a37e9e2d9a1482ef5b7d91001b61ac"></a><!-- doxytag: member="pbx.h::ast_active_calls" ref="a52a37e9e2d9a1482ef5b7d91001b61ac" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_active_calls </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Retrieve the <a class="el" href="structnumber.html" title="Number structure.">number</a> of active calls. </p>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l04601">4601</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l01077">countcalls</a>.</p>

<p>Referenced by <a class="el" href="agent_8c_source.html#l00604">ast_var_Config()</a>, <a class="el" href="cli_8c_source.html#l00790">handle_chanlist()</a>, <a class="el" href="cli_8c_source.html#l00735">handle_showcalls()</a>, and <a class="el" href="func__sysinfo_8c_source.html#l00039">sysinfo_helper()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04602"></a>04602 {
<a name="l04603"></a>04603    <span class="keywordflow">return</span> <a class="code" href="pbx_8c.html#a098053e0fabe1ebd3f0b70fd7c9f8a71">countcalls</a>;
<a name="l04604"></a>04604 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a07176e8d314eb68b3b50279fafa11390"></a><!-- doxytag: member="pbx.h::ast_add_extension" ref="a07176e8d314eb68b3b50279fafa11390" args="(const char *context, int replace, const char *extension, int priority, const char *label, const char *callerid, const char *application, void *data, void(*datad)(void *), const char *registrar)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_add_extension </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>replace</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>extension</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>priority</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>label</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>callerid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>application</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*)(void *)&nbsp;</td>
          <td class="paramname"> <em>datad</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>registrar</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add and <a class="el" href="structextension.html">extension</a> to an <a class="el" href="structextension.html">extension</a> context. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>context</em>&nbsp;</td><td>context to add the <a class="el" href="structextension.html">extension</a> to </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>replace</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structextension.html">extension</a></em>&nbsp;</td><td><a class="el" href="structextension.html">extension</a> to add </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>priority</em>&nbsp;</td><td>priority level of <a class="el" href="structextension.html">extension</a> addition </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>label</em>&nbsp;</td><td><a class="el" href="structextension.html">extension</a> label </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>callerid</em>&nbsp;</td><td>pattern to match CallerID, or NULL to match any CallerID </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>application</em>&nbsp;</td><td>application to run on the <a class="el" href="structextension.html">extension</a> with that priority level </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>data to pass to the application </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>datad</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>registrar</em>&nbsp;</td><td>who registered the <a class="el" href="structextension.html">extension</a></td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l07305">7305</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l07624">ast_add_extension2()</a>, <a class="el" href="pbx_8c_source.html#l09358">ast_unlock_contexts()</a>, and <a class="el" href="pbx_8c_source.html#l04658">find_context_locked()</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l03896">ast_extension_state_add()</a>, <a class="el" href="pbx__config_8c_source.html#l00902">handle_cli_dialplan_add_extension()</a>, <a class="el" href="features_8c_source.html#l03659">park_add_hints()</a>, <a class="el" href="chan__skinny_8c_source.html#l01764">register_exten()</a>, <a class="el" href="chan__iax2_8c_source.html#l08216">register_peer_exten()</a>, and <a class="el" href="chan__unistim_8c_source.html#l01086">RegisterExtension()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l07308"></a>07308 {
<a name="l07309"></a>07309    <span class="keywordtype">int</span> ret = -1;
<a name="l07310"></a>07310    <span class="keyword">struct </span><a class="code" href="structast__context.html" title="ast_context: An extension context">ast_context</a> *c = <a class="code" href="pbx_8c.html#ad3380fed080cd2af7c01774b9fa9086e" title="lookup for a context with a given name,">find_context_locked</a>(<a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>);
<a name="l07311"></a>07311 
<a name="l07312"></a>07312    <span class="keywordflow">if</span> (c) {
<a name="l07313"></a>07313       ret = <a class="code" href="pbx_8h.html#a8790db69940f3c32c2d7943ee73f2180" title="Add an extension to an extension context, this time with an ast_context *.">ast_add_extension2</a>(c, replace, <a class="code" href="structextension.html">extension</a>, priority, label, callerid,
<a name="l07314"></a>07314          application, data, datad, <a class="code" href="features_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>);
<a name="l07315"></a>07315       <a class="code" href="pbx_8h.html#ae517a87b356aec60d5de4591ef94581b" title="Unlocks contexts.">ast_unlock_contexts</a>();
<a name="l07316"></a>07316    }
<a name="l07317"></a>07317 
<a name="l07318"></a>07318    <span class="keywordflow">return</span> ret;
<a name="l07319"></a>07319 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8790db69940f3c32c2d7943ee73f2180"></a><!-- doxytag: member="pbx.h::ast_add_extension2" ref="a8790db69940f3c32c2d7943ee73f2180" args="(struct ast_context *con, int replace, const char *extension, int priority, const char *label, const char *callerid, const char *application, void *data, void(*datad)(void *), const char *registrar)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_add_extension2 </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__context.html">ast_context</a> *&nbsp;</td>
          <td class="paramname"> <em>con</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>replace</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>extension</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>priority</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>label</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>callerid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>application</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*)(void *)&nbsp;</td>
          <td class="paramname"> <em>datad</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>registrar</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add an <a class="el" href="structextension.html">extension</a> to an <a class="el" href="structextension.html">extension</a> context, this time with an <a class="el" href="structast__context.html" title="ast_context: An extension context">ast_context</a> *. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>For details about the arguments, check <a class="el" href="pbx_8h.html#a07176e8d314eb68b3b50279fafa11390" title="Add and extension to an extension context.">ast_add_extension()</a></dd></dl>
<p>Add an <a class="el" href="structextension.html">extension</a> to an <a class="el" href="structextension.html">extension</a> context, this time with an <a class="el" href="structast__context.html" title="ast_context: An extension context">ast_context</a> *.</p>
<p>We sort extensions in order of matching preference, so that we can stop the search as soon as we find a suitable match. This ordering also takes care of wildcards such as '.' (meaning "one or more of any character") and '!' (which is 'earlymatch', meaning "zero or more of any character" but also impacts the return value from CANMATCH and EARLYMATCH.</p>
<p>The <a class="el" href="structextension.html">extension</a> match rules defined in the devmeeting 2006.05.05 are quite simple: WE SELECT THE LONGEST MATCH. In detail, "longest" means the <a class="el" href="structnumber.html" title="Number structure.">number</a> of matched characters in the <a class="el" href="structextension.html">extension</a>. In case of ties (e.g. _XXX and 333) in the length of a pattern, we give priority to entries with the smallest cardinality (e.g, [5-9] comes before [2-8] before the former has only 5 elements, while the latter has 7, etc. In case of same cardinality, the first element in the range counts. If we still have a tie, any final '!' will make this as a possibly less specific pattern.</p>
<p>EBUSY - can't lock EEXIST - <a class="el" href="structextension.html">extension</a> with the same priority exist and no replace is set </p>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l07624">7624</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l07637">ast_add_extension2_lockopt()</a>.</p>

<p>Referenced by <a class="el" href="pval_8c_source.html#l04207">add_extensions()</a>, <a class="el" href="pbx_8c_source.html#l07305">ast_add_extension()</a>, <a class="el" href="features_8c_source.html#l03554">build_parkinglot()</a>, <a class="el" href="pbx_8c_source.html#l06539">context_merge()</a>, <a class="el" href="features_8c_source.html#l03672">load_config()</a>, <a class="el" href="app__dial_8c_source.html#l02469">load_module()</a>, <a class="el" href="features_8c_source.html#l03009">manage_parkinglot()</a>, <a class="el" href="features_8c_source.html#l00678">park_call_full()</a>, <a class="el" href="pbx__config_8c_source.html#l01367">pbx_load_config()</a>, <a class="el" href="pbx__config_8c_source.html#l01608">pbx_load_users()</a>, <a class="el" href="app__meetme_8c_source.html#l06177">sla_build_station()</a>, and <a class="el" href="app__meetme_8c_source.html#l06042">sla_build_trunk()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l07628"></a>07628 {
<a name="l07629"></a>07629    <span class="keywordflow">return</span> <a class="code" href="pbx_8c.html#adb069bbd2459e4cc80cf858655d0c62f" title="Does all the work of ast_add_extension2, but adds two args, to determine if context...">ast_add_extension2_lockopt</a>(con, replace, <a class="code" href="structextension.html">extension</a>, priority, label, callerid, application, data, datad, <a class="code" href="features_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>, 1, 1);
<a name="l07630"></a>07630 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae0ba2eb966a9e3376de61d30513f7302"></a><!-- doxytag: member="pbx.h::ast_async_goto" ref="ae0ba2eb966a9e3376de61d30513f7302" args="(struct ast_channel *chan, const char *context, const char *exten, int priority)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_async_goto </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>exten</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>priority</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set the channel to next execute the specified dialplan location. </p>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="pbx_8c.html#aa2caee9cd93973d6f2bc806b34f564d6">ast_async_parseable_goto</a>, <a class="el" href="pbx_8c.html#a281fc61f41a1be7fdd6c620372c4510b">ast_async_goto_if_exists</a> </dd></dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l07344">7344</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00469">ast_channel::_state</a>, <a class="el" href="channel_8h_source.html#l00473">ast_channel::amaflags</a>, <a class="el" href="cdr_8c_source.html#l00441">ast_cdr_discard()</a>, <a class="el" href="cdr_8c_source.html#l00168">ast_cdr_dup()</a>, <a class="el" href="channel_8h_source.html#l00730">ast_channel_alloc</a>, <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="channel_8c_source.html#l04217">ast_channel_masquerade()</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="channel_8c_source.html#l04393">ast_do_masquerade()</a>, <a class="el" href="pbx_8c_source.html#l07321">ast_explicit_goto()</a>, <a class="el" href="channel_8c_source.html#l01690">ast_hangup()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="pbx_8c_source.html#l04559">ast_pbx_start()</a>, <a class="el" href="channel_8h_source.html#l00635">AST_SOFTHANGUP_ASYNCGOTO</a>, <a class="el" href="channel_8c_source.html#l01653">ast_softhangup_nolock()</a>, <a class="el" href="channel_8h_source.html#l00422">ast_channel::cdr</a>, <a class="el" href="channel_8h_source.html#l00503">ast_channel::context</a>, <a class="el" href="channel_8h_source.html#l00504">ast_channel::exten</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="channel_8h_source.html#l00418">ast_channel::pbx</a>, <a class="el" href="channel_8h_source.html#l00483">ast_channel::readformat</a>, <a class="el" href="strings_8h_source.html#l00072">S_OR</a>, and <a class="el" href="channel_8h_source.html#l00484">ast_channel::writeformat</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l09551">__ast_goto_if_exists()</a>, <a class="el" href="manager_8c_source.html#l02084">action_redirect()</a>, <a class="el" href="pbx_8c_source.html#l07397">ast_async_goto_by_name()</a>, <a class="el" href="features_8c_source.html#l01265">builtin_blindtransfer()</a>, <a class="el" href="chan__oss_8c_source.html#l01153">console_transfer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05607">dahdi_handle_dtmfup()</a>, <a class="el" href="chan__sip_8c_source.html#l21024">handle_request_bye()</a>, <a class="el" href="chan__sip_8c_source.html#l20572">handle_request_refer()</a>, <a class="el" href="pbx_8c_source.html#l09580">pbx_parseable_goto()</a>, <a class="el" href="chan__misdn_8c_source.html#l02961">process_ast_dsp()</a>, <a class="el" href="chan__sip_8c_source.html#l07045">sip_read()</a>, and <a class="el" href="chan__iax2_8c_source.html#l09458">socket_process()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l07345"></a>07345 {
<a name="l07346"></a>07346    <span class="keywordtype">int</span> res = 0;
<a name="l07347"></a>07347 
<a name="l07348"></a>07348    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l07349"></a>07349 
<a name="l07350"></a>07350    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#aebc9ecdf679da616c7d975b827e1f4b4">pbx</a>) { <span class="comment">/* This channel is currently in the PBX */</span>
<a name="l07351"></a>07351       <a class="code" href="pbx_8h.html#a9f840db4b5ef461ac2c0c975a57c9e89">ast_explicit_goto</a>(chan, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, priority + 1);
<a name="l07352"></a>07352       <a class="code" href="channel_8h.html#ae90da1877e143b996d202d4c88a9c862" title="Softly hangup up a channel (no channel lock).">ast_softhangup_nolock</a>(chan, <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709a085c0c603de12dc2474a17a92e1cb5a4">AST_SOFTHANGUP_ASYNCGOTO</a>);
<a name="l07353"></a>07353    } <span class="keywordflow">else</span> {
<a name="l07354"></a>07354       <span class="comment">/* In order to do it when the channel doesn&apos;t really exist within</span>
<a name="l07355"></a>07355 <span class="comment">         the PBX, we have to make a new channel, masquerade, and start the PBX</span>
<a name="l07356"></a>07356 <span class="comment">         at the new location */</span>
<a name="l07357"></a>07357       <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *tmpchan = <a class="code" href="channel_8h.html#adfbceb39821586c0f9be0c47496a4e18">ast_channel_alloc</a>(0, chan-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a>, 0, 0, chan-&gt;accountcode, chan-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>, chan-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, chan-&gt;<a class="code" href="structast__channel.html#ad2cfb0f821c065261382a9298bb5a16b">amaflags</a>, <span class="stringliteral">&quot;AsyncGoto/%s&quot;</span>, chan-&gt;name);
<a name="l07358"></a>07358       <span class="keywordflow">if</span> (!tmpchan) {
<a name="l07359"></a>07359          res = -1;
<a name="l07360"></a>07360       } <span class="keywordflow">else</span> {
<a name="l07361"></a>07361          <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>) {
<a name="l07362"></a>07362             <a class="code" href="cdr_8h.html#a0a672ffbd29adf8622596a36ccb25e65" title="Discard and free a CDR record.">ast_cdr_discard</a>(tmpchan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>);
<a name="l07363"></a>07363             tmpchan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a> = <a class="code" href="cdr_8h.html#a7e8acc90934bc4647dd675a251d9e6ab" title="Duplicate a record.">ast_cdr_dup</a>(chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>);  <span class="comment">/* share the love */</span>
<a name="l07364"></a>07364          }
<a name="l07365"></a>07365          <span class="comment">/* Make formats okay */</span>
<a name="l07366"></a>07366          tmpchan-&gt;<a class="code" href="structast__channel.html#ab7786a0f5b9a9ebf83daed87be4f3868">readformat</a> = chan-&gt;<a class="code" href="structast__channel.html#ab7786a0f5b9a9ebf83daed87be4f3868">readformat</a>;
<a name="l07367"></a>07367          tmpchan-&gt;<a class="code" href="structast__channel.html#a00f5ce2ad53ff8523f8e46ea5aceba48">writeformat</a> = chan-&gt;<a class="code" href="structast__channel.html#a00f5ce2ad53ff8523f8e46ea5aceba48">writeformat</a>;
<a name="l07368"></a>07368          <span class="comment">/* Setup proper location */</span>
<a name="l07369"></a>07369          <a class="code" href="pbx_8h.html#a9f840db4b5ef461ac2c0c975a57c9e89">ast_explicit_goto</a>(tmpchan,
<a name="l07370"></a>07370             <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(<a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, chan-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>), <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(<a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, chan-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>), <a class="code" href="structast__channel.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>);
<a name="l07371"></a>07371 
<a name="l07372"></a>07372          <span class="comment">/* Masquerade into temp channel */</span>
<a name="l07373"></a>07373          <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a84fa04f019436467dc17f9bdd5341dce" title="Weird function made for call transfers.">ast_channel_masquerade</a>(tmpchan, chan)) {
<a name="l07374"></a>07374             <span class="comment">/* Failed to set up the masquerade.  It&apos;s probably chan_local</span>
<a name="l07375"></a>07375 <span class="comment">             * in the middle of optimizing itself out.  Sad. :( */</span>
<a name="l07376"></a>07376             <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(tmpchan);
<a name="l07377"></a>07377             tmpchan = NULL;
<a name="l07378"></a>07378             res = -1;
<a name="l07379"></a>07379          } <span class="keywordflow">else</span> {
<a name="l07380"></a>07380             <span class="comment">/* Grab the locks and get going */</span>
<a name="l07381"></a>07381             <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(tmpchan);
<a name="l07382"></a>07382             <a class="code" href="channel_8h.html#ab26f03fb10f1b2e8e52bfbbb1ee02f78" title="Start masquerading a channel XXX This is a seriously whacked out operation. We&amp;#39;re...">ast_do_masquerade</a>(tmpchan);
<a name="l07383"></a>07383             <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(tmpchan);
<a name="l07384"></a>07384             <span class="comment">/* Start the PBX going on our stolen channel */</span>
<a name="l07385"></a>07385             <span class="keywordflow">if</span> (<a class="code" href="pbx_8h.html#a9a937fbb3b5f4e68880a9c5714a29ce5" title="Create a new thread and start the PBX.">ast_pbx_start</a>(tmpchan)) {
<a name="l07386"></a>07386                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to start PBX on %s\n&quot;</span>, tmpchan-&gt;name);
<a name="l07387"></a>07387                <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(tmpchan);
<a name="l07388"></a>07388                res = -1;
<a name="l07389"></a>07389             }
<a name="l07390"></a>07390          }
<a name="l07391"></a>07391       }
<a name="l07392"></a>07392    }
<a name="l07393"></a>07393    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l07394"></a>07394    <span class="keywordflow">return</span> res;
<a name="l07395"></a>07395 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa43c73d212f6a5c3256cc90a7d7980a1"></a><!-- doxytag: member="pbx.h::ast_async_goto_by_name" ref="aa43c73d212f6a5c3256cc90a7d7980a1" args="(const char *chan, const char *context, const char *exten, int priority)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_async_goto_by_name </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>exten</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>priority</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set the channel to next execute the specified dialplan location. </p>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l07397">7397</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l07344">ast_async_goto()</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, and <a class="el" href="channel_8c_source.html#l01278">ast_get_channel_by_name_locked()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l07398"></a>07398 {
<a name="l07399"></a>07399    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>;
<a name="l07400"></a>07400    <span class="keywordtype">int</span> res = -1;
<a name="l07401"></a>07401 
<a name="l07402"></a>07402    chan = <a class="code" href="channel_8h.html#a03e8287876c59ddc00f5567064b2b9ca" title="Get channel by name or uniqueid (locks channel).">ast_get_channel_by_name_locked</a>(channame);
<a name="l07403"></a>07403    <span class="keywordflow">if</span> (chan) {
<a name="l07404"></a>07404       res = <a class="code" href="pbx_8h.html#ae0ba2eb966a9e3376de61d30513f7302" title="Set the channel to next execute the specified dialplan location.">ast_async_goto</a>(chan, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, <a class="code" href="structast__channel.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>);
<a name="l07405"></a>07405       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l07406"></a>07406    }
<a name="l07407"></a>07407    <span class="keywordflow">return</span> res;
<a name="l07408"></a>07408 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a281fc61f41a1be7fdd6c620372c4510b"></a><!-- doxytag: member="pbx.h::ast_async_goto_if_exists" ref="a281fc61f41a1be7fdd6c620372c4510b" args="(struct ast_channel *chan, const char *context, const char *exten, int priority)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_async_goto_if_exists </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>exten</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>priority</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl class="note"><dt><b>Note:</b></dt><dd>This function will handle locking the channel as needed. </dd></dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09575">9575</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l09551">__ast_goto_if_exists()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09576"></a>09576 {
<a name="l09577"></a>09577    <span class="keywordflow">return</span> <a class="code" href="pbx_8c.html#a5c2ad0729efb2f13f192ee283f6f13c2">__ast_goto_if_exists</a>(chan, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, <a class="code" href="structast__channel.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>, 1);
<a name="l09578"></a>09578 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa2caee9cd93973d6f2bc806b34f564d6"></a><!-- doxytag: member="pbx.h::ast_async_parseable_goto" ref="aa2caee9cd93973d6f2bc806b34f564d6" args="(struct ast_channel *chan, const char *goto_string)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_async_parseable_goto </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>goto_string</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl class="note"><dt><b>Note:</b></dt><dd>This function will handle locking the channel as needed. </dd></dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09638">9638</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l09580">pbx_parseable_goto()</a>.</p>

<p>Referenced by <a class="el" href="app__channelredirect_8c_source.html#l00065">asyncgoto_exec()</a>, and <a class="el" href="res__clioriginate_8c_source.html#l00175">handle_redirect()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09639"></a>09639 {
<a name="l09640"></a>09640    <span class="keywordflow">return</span> <a class="code" href="pbx_8c.html#aa18771ce9668fbafeb630ce5c802e6f8">pbx_parseable_goto</a>(chan, goto_string, 1);
<a name="l09641"></a>09641 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a018549fd5d5470b676da92f6034b7347"></a><!-- doxytag: member="pbx.h::ast_build_timing" ref="a018549fd5d5470b676da92f6034b7347" args="(struct ast_timing *i, const char *info)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_build_timing </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__timing.html">ast_timing</a> *&nbsp;</td>
          <td class="paramname"> <em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>info</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Construct a timing bitmap, for use in time-based conditionals. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>i</em>&nbsp;</td><td>Pointer to an <a class="el" href="structast__timing.html">ast_timing</a> structure. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>info</em>&nbsp;</td><td>Standard string containing a timerange, weekday range, monthday range, and month range, as well as an optional timezone. </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>Returns</em>&nbsp;</td><td>1 on success or 0 on failure. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l06939">6939</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="pbx_8h_source.html#l00118">ast_timing::daymask</a>, <a class="el" href="pbx_8c_source.html#l06910">days</a>, <a class="el" href="pbx_8h_source.html#l00119">ast_timing::dowmask</a>, <a class="el" href="pbx_8c_source.html#l06807">get_range()</a>, <a class="el" href="pbx_8c_source.html#l06850">get_timerange()</a>, <a class="el" href="pbx_8h_source.html#l00117">ast_timing::monthmask</a>, <a class="el" href="pbx_8c_source.html#l06922">months</a>, <a class="el" href="agi_2strcompat_8c_source.html#l00027">strsep()</a>, and <a class="el" href="pbx_8h_source.html#l00121">ast_timing::timezone</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l07032">ast_context_add_include2()</a>, <a class="el" href="func__logic_8c_source.html#l00130">iftime()</a>, <a class="el" href="pbx_8c_source.html#l08659">pbx_builtin_execiftime()</a>, and <a class="el" href="pbx_8c_source.html#l08624">pbx_builtin_gotoiftime()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l06940"></a>06940 {
<a name="l06941"></a>06941    <span class="keywordtype">char</span> *info_save, *info;
<a name="l06942"></a>06942    <span class="keywordtype">int</span> j, num_fields, last_sep = -1;
<a name="l06943"></a>06943 
<a name="l06944"></a>06944    <span class="comment">/* Check for empty just in case */</span>
<a name="l06945"></a>06945    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(info_in)) {
<a name="l06946"></a>06946       <span class="keywordflow">return</span> 0;
<a name="l06947"></a>06947    }
<a name="l06948"></a>06948 
<a name="l06949"></a>06949    <span class="comment">/* make a copy just in case we were passed a static string */</span>
<a name="l06950"></a>06950    info_save = info = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(info_in);
<a name="l06951"></a>06951 
<a name="l06952"></a>06952    <span class="comment">/* count the number of fields in the timespec */</span>
<a name="l06953"></a>06953    <span class="keywordflow">for</span> (j = 0, num_fields = 1; info[j] != <span class="charliteral">&apos;\0&apos;</span>; j++) {
<a name="l06954"></a>06954       <span class="keywordflow">if</span> (info[j] == <span class="charliteral">&apos;,&apos;</span>) {
<a name="l06955"></a>06955          last_sep = j;
<a name="l06956"></a>06956          num_fields++;
<a name="l06957"></a>06957       }
<a name="l06958"></a>06958    }
<a name="l06959"></a>06959 
<a name="l06960"></a>06960    <span class="comment">/* save the timezone, if it is specified */</span>
<a name="l06961"></a>06961    <span class="keywordflow">if</span> (num_fields == 5) {
<a name="l06962"></a>06962       i-&gt;<a class="code" href="structast__timing.html#a18b6f7534e9068b65611571b05db0eee">timezone</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(info + last_sep + 1);
<a name="l06963"></a>06963    } <span class="keywordflow">else</span> {
<a name="l06964"></a>06964       i-&gt;<a class="code" href="structast__timing.html#a18b6f7534e9068b65611571b05db0eee">timezone</a> = NULL;
<a name="l06965"></a>06965    }
<a name="l06966"></a>06966 
<a name="l06967"></a>06967    <span class="comment">/* Assume everything except time */</span>
<a name="l06968"></a>06968    i-&gt;<a class="code" href="structast__timing.html#a3fdc5726e142f466b67b8feea4da21cf">monthmask</a> = 0xfff;   <span class="comment">/* 12 bits */</span>
<a name="l06969"></a>06969    i-&gt;<a class="code" href="structast__timing.html#a53851cc9d2020ded355f2a52e0d32238">daymask</a> = 0x7fffffffU; <span class="comment">/* 31 bits */</span>
<a name="l06970"></a>06970    i-&gt;<a class="code" href="structast__timing.html#a88d1a72894c612b57b2d2160f8ffadce">dowmask</a> = 0x7f; <span class="comment">/* 7 bits */</span>
<a name="l06971"></a>06971    <span class="comment">/* on each call, use strsep() to move info to the next argument */</span>
<a name="l06972"></a>06972    <a class="code" href="pbx_8c.html#a75160d417c742f4c432dbccbc6d14d4a" title="store a bitmask of valid times, one bit each 1 minute">get_timerange</a>(i, <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;info, <span class="stringliteral">&quot;|,&quot;</span>));
<a name="l06973"></a>06973    <span class="keywordflow">if</span> (info)
<a name="l06974"></a>06974       i-&gt;<a class="code" href="structast__timing.html#a88d1a72894c612b57b2d2160f8ffadce">dowmask</a> = <a class="code" href="pbx_8c.html#a77d85ac80b9171604f30e87a2382cdd0" title="helper function to return a range up to max (7, 12, 31 respectively). names, if supplied...">get_range</a>(<a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;info, <span class="stringliteral">&quot;|,&quot;</span>), 7, <a class="code" href="pbx_8c.html#a0cf0c4efde69b8309ac3a154d157d7ea">days</a>, <span class="stringliteral">&quot;day of week&quot;</span>);
<a name="l06975"></a>06975    <span class="keywordflow">if</span> (info)
<a name="l06976"></a>06976       i-&gt;<a class="code" href="structast__timing.html#a53851cc9d2020ded355f2a52e0d32238">daymask</a> = <a class="code" href="pbx_8c.html#a77d85ac80b9171604f30e87a2382cdd0" title="helper function to return a range up to max (7, 12, 31 respectively). names, if supplied...">get_range</a>(<a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;info, <span class="stringliteral">&quot;|,&quot;</span>), 31, NULL, <span class="stringliteral">&quot;day&quot;</span>);
<a name="l06977"></a>06977    <span class="keywordflow">if</span> (info)
<a name="l06978"></a>06978       i-&gt;<a class="code" href="structast__timing.html#a3fdc5726e142f466b67b8feea4da21cf">monthmask</a> = <a class="code" href="pbx_8c.html#a77d85ac80b9171604f30e87a2382cdd0" title="helper function to return a range up to max (7, 12, 31 respectively). names, if supplied...">get_range</a>(<a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;info, <span class="stringliteral">&quot;|,&quot;</span>), 12, <a class="code" href="pbx_8c.html#a9878e6d5a52b0b77dd7857ae80601910">months</a>, <span class="stringliteral">&quot;month&quot;</span>);
<a name="l06979"></a>06979    <span class="keywordflow">return</span> 1;
<a name="l06980"></a>06980 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a93f9868530c1e8a9d9d367d1ead8782e"></a><!-- doxytag: member="pbx.h::ast_canmatch_extension" ref="a93f9868530c1e8a9d9d367d1ead8782e" args="(struct ast_channel *c, const char *context, const char *exten, int priority, const char *callerid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_canmatch_extension </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>exten</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>priority</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>callerid</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Looks for a valid matching <a class="el" href="structextension.html">extension</a>. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>c</em>&nbsp;</td><td>not really important </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>context</em>&nbsp;</td><td>context to serach within </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>exten</em>&nbsp;</td><td><a class="el" href="structextension.html">extension</a> to check </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>priority</em>&nbsp;</td><td>priority of <a class="el" href="structextension.html">extension</a> path </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>callerid</em>&nbsp;</td><td>callerid of <a class="el" href="structextension.html">extension</a> being searched for</td></tr>
  </table>
  </dd>
</dl>
<dl class="note"><dt><b>Note:</b></dt><dd>It is possible for autoservice to be started and stopped on c during this function call, it is important that c is not locked prior to calling this. Otherwise a deadlock may occur</dd></dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>If "exten" *could be* a valid <a class="el" href="structextension.html">extension</a> in this context with or without some more digits, return non-zero. Basically, when this returns 0, no matter what you add to exten, it's not going to be a valid <a class="el" href="structextension.html">extension</a> anymore </dd></dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l04158">4158</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="extconf_8h_source.html#l00217">E_CANMATCH</a>, and <a class="el" href="pbx_8c_source.html#l03647">pbx_extension_helper()</a>.</p>

<p>Referenced by <a class="el" href="app__talkdetect_8c_source.html#l00076">background_detect_exec()</a>, <a class="el" href="chan__misdn_8c_source.html#l04379">cb_events()</a>, <a class="el" href="chan__misdn_8c_source.html#l04143">do_immediate_setup()</a>, <a class="el" href="chan__iax2_8c_source.html#l08855">dp_lookup()</a>, <a class="el" href="pbx__dundi_8c_source.html#l00561">dundi_lookup_local()</a>, <a class="el" href="chan__sip_8c_source.html#l13667">get_also_info()</a>, <a class="el" href="chan__sip_8c_source.html#l13269">get_destination()</a>, <a class="el" href="app__rpt_8c_source.html#l06676">handle_link_data()</a>, <a class="el" href="app__rpt_8c_source.html#l07021">handle_link_phone_dtmf()</a>, <a class="el" href="app__voicemail_8c_source.html#l05141">leave_voicemail()</a>, <a class="el" href="app__rpt_8c_source.html#l10410">local_dtmf_helper()</a>, <a class="el" href="pbx__loopback_8c_source.html#l00135">loopback_canmatch()</a>, <a class="el" href="chan__mgcp_8c_source.html#l02637">mgcp_ss()</a>, <a class="el" href="pbx_8c_source.html#l08798">pbx_builtin_background()</a>, <a class="el" href="chan__phone_8c_source.html#l00919">phone_check_exception()</a>, <a class="el" href="chan__skinny_8c_source.html#l03619">skinny_ss()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>, and <a class="el" href="app__queue_8c_source.html#l02047">valid_exit()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04159"></a>04159 {
<a name="l04160"></a>04160    <span class="keywordflow">return</span> <a class="code" href="pbx_8c.html#ae381d99bea85b43f022470b64171018d" title="The return value depends on the action:.">pbx_extension_helper</a>(c, NULL, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, <a class="code" href="structast__channel.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>, NULL, callerid, <a class="code" href="extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea413c09377a892aa154e7669cbdaf27ba">E_CANMATCH</a>, 0, 0);
<a name="l04161"></a>04161 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a17b7d6ec799c60a8fda825cf59aea7eb"></a><!-- doxytag: member="pbx.h::ast_check_timing" ref="a17b7d6ec799c60a8fda825cf59aea7eb" args="(const struct ast_timing *i)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_check_timing </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structast__timing.html">ast_timing</a> *&nbsp;</td>
          <td class="paramname"> <em>i</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Evaluate a pre-constructed bitmap as to whether the current time falls within the range specified. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>i</em>&nbsp;</td><td>Pointer to an <a class="el" href="structast__timing.html">ast_timing</a> structure. </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>Returns</em>&nbsp;</td><td>1, if the time matches or 0, if the current time falls outside of the specified range. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l06982">6982</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="localtime_8c_source.html#l01305">ast_localtime()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="pbx_8h_source.html#l00118">ast_timing::daymask</a>, <a class="el" href="pbx_8h_source.html#l00119">ast_timing::dowmask</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="pbx_8h_source.html#l00120">ast_timing::minmask</a>, <a class="el" href="pbx_8h_source.html#l00117">ast_timing::monthmask</a>, <a class="el" href="pbx_8h_source.html#l00121">ast_timing::timezone</a>, <a class="el" href="localtime_8h_source.html#l00030">ast_tm::tm_hour</a>, <a class="el" href="localtime_8h_source.html#l00031">ast_tm::tm_mday</a>, <a class="el" href="localtime_8h_source.html#l00029">ast_tm::tm_min</a>, <a class="el" href="localtime_8h_source.html#l00032">ast_tm::tm_mon</a>, and <a class="el" href="localtime_8h_source.html#l00034">ast_tm::tm_wday</a>.</p>

<p>Referenced by <a class="el" href="func__logic_8c_source.html#l00130">iftime()</a>, <a class="el" href="pbx_8c_source.html#l01391">include_valid()</a>, <a class="el" href="pbx_8c_source.html#l08659">pbx_builtin_execiftime()</a>, and <a class="el" href="pbx_8c_source.html#l08624">pbx_builtin_gotoiftime()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l06983"></a>06983 {
<a name="l06984"></a>06984    <span class="keyword">struct </span><a class="code" href="structast__tm.html">ast_tm</a> tm;
<a name="l06985"></a>06985    <span class="keyword">struct </span>timeval now = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l06986"></a>06986 
<a name="l06987"></a>06987    <a class="code" href="localtime_8h.html#ae9fbda728350a9a5b9c09b29214d718e" title="Timezone-independent version of localtime_r(3).">ast_localtime</a>(&amp;now, &amp;tm, i-&gt;<a class="code" href="structast__timing.html#a18b6f7534e9068b65611571b05db0eee">timezone</a>);
<a name="l06988"></a>06988 
<a name="l06989"></a>06989    <span class="comment">/* If it&apos;s not the right month, return */</span>
<a name="l06990"></a>06990    <span class="keywordflow">if</span> (!(i-&gt;<a class="code" href="structast__timing.html#a3fdc5726e142f466b67b8feea4da21cf">monthmask</a> &amp; (1 &lt;&lt; tm.tm_mon)))
<a name="l06991"></a>06991       <span class="keywordflow">return</span> 0;
<a name="l06992"></a>06992 
<a name="l06993"></a>06993    <span class="comment">/* If it&apos;s not that time of the month.... */</span>
<a name="l06994"></a>06994    <span class="comment">/* Warning, tm_mday has range 1..31! */</span>
<a name="l06995"></a>06995    <span class="keywordflow">if</span> (!(i-&gt;<a class="code" href="structast__timing.html#a53851cc9d2020ded355f2a52e0d32238">daymask</a> &amp; (1 &lt;&lt; (tm.tm_mday-1))))
<a name="l06996"></a>06996       <span class="keywordflow">return</span> 0;
<a name="l06997"></a>06997 
<a name="l06998"></a>06998    <span class="comment">/* If it&apos;s not the right day of the week */</span>
<a name="l06999"></a>06999    <span class="keywordflow">if</span> (!(i-&gt;<a class="code" href="structast__timing.html#a88d1a72894c612b57b2d2160f8ffadce">dowmask</a> &amp; (1 &lt;&lt; tm.tm_wday)))
<a name="l07000"></a>07000       <span class="keywordflow">return</span> 0;
<a name="l07001"></a>07001 
<a name="l07002"></a>07002    <span class="comment">/* Sanity check the hour just to be safe */</span>
<a name="l07003"></a>07003    <span class="keywordflow">if</span> ((tm.tm_hour &lt; 0) || (tm.tm_hour &gt; 23)) {
<a name="l07004"></a>07004       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Insane time...\n&quot;</span>);
<a name="l07005"></a>07005       <span class="keywordflow">return</span> 0;
<a name="l07006"></a>07006    }
<a name="l07007"></a>07007 
<a name="l07008"></a>07008    <span class="comment">/* Now the tough part, we calculate if it fits</span>
<a name="l07009"></a>07009 <span class="comment">      in the right time based on min/hour */</span>
<a name="l07010"></a>07010    <span class="keywordflow">if</span> (!(i-&gt;<a class="code" href="structast__timing.html#a51894ab93df62f69a337f1703444c872">minmask</a>[tm.tm_hour * 2 + (tm.tm_min &gt;= 30 ? 1 : 0)] &amp; (1 &lt;&lt; (tm.tm_min &gt;= 30 ? tm.tm_min - 30 : tm.tm_min))))
<a name="l07011"></a>07011       <span class="keywordflow">return</span> 0;
<a name="l07012"></a>07012 
<a name="l07013"></a>07013    <span class="comment">/* If we got this far, then we&apos;re good */</span>
<a name="l07014"></a>07014    <span class="keywordflow">return</span> 1;
<a name="l07015"></a>07015 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a24d57cdfe3409c388e4b81b67ecdee70"></a><!-- doxytag: member="pbx.h::ast_context_add_ignorepat" ref="a24d57cdfe3409c388e4b81b67ecdee70" args="(const char *context, const char *ignorepat, const char *registrar)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_context_add_ignorepat </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>ignorepat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>registrar</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add an ignorepat. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>context</em>&nbsp;</td><td>which context to add the ignorpattern to </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ignorepat</em>&nbsp;</td><td>ignorepattern to set up for the <a class="el" href="structextension.html">extension</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>registrar</em>&nbsp;</td><td>registrar of the ignore pattern</td></tr>
  </table>
  </dd>
</dl>
<p>Adds an ignore pattern to a particular context.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l07217">7217</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l07229">ast_context_add_ignorepat2()</a>, <a class="el" href="pbx_8c_source.html#l09358">ast_unlock_contexts()</a>, and <a class="el" href="pbx_8c_source.html#l04658">find_context_locked()</a>.</p>

<p>Referenced by <a class="el" href="pbx__config_8c_source.html#l01047">handle_cli_dialplan_add_ignorepat()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l07218"></a>07218 {
<a name="l07219"></a>07219    <span class="keywordtype">int</span> ret = -1;
<a name="l07220"></a>07220    <span class="keyword">struct </span><a class="code" href="structast__context.html" title="ast_context: An extension context">ast_context</a> *c = <a class="code" href="pbx_8c.html#ad3380fed080cd2af7c01774b9fa9086e" title="lookup for a context with a given name,">find_context_locked</a>(<a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>);
<a name="l07221"></a>07221 
<a name="l07222"></a>07222    <span class="keywordflow">if</span> (c) {
<a name="l07223"></a>07223       ret = <a class="code" href="pbx_8h.html#a82c040aa706c09bd6294b2333a2a0587">ast_context_add_ignorepat2</a>(c, value, <a class="code" href="features_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>);
<a name="l07224"></a>07224       <a class="code" href="pbx_8h.html#ae517a87b356aec60d5de4591ef94581b" title="Unlocks contexts.">ast_unlock_contexts</a>();
<a name="l07225"></a>07225    }
<a name="l07226"></a>07226    <span class="keywordflow">return</span> ret;
<a name="l07227"></a>07227 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a82c040aa706c09bd6294b2333a2a0587"></a><!-- doxytag: member="pbx.h::ast_context_add_ignorepat2" ref="a82c040aa706c09bd6294b2333a2a0587" args="(struct ast_context *con, const char *ignorepat, const char *registrar)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_context_add_ignorepat2 </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__context.html">ast_context</a> *&nbsp;</td>
          <td class="paramname"> <em>con</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>ignorepat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>registrar</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8c_source.html#l07229">7229</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="pbx_8c_source.html#l09376">ast_unlock_context()</a>, <a class="el" href="pbx_8c_source.html#l09366">ast_wrlock_context()</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="pbx_8c_source.html#l00847">ast_context::ignorepats</a>, <a class="el" href="pbx_8c_source.html#l00812">ast_ignorepat::next</a>, <a class="el" href="pbx_8c_source.html#l00813">ast_ignorepat::pattern</a>, and <a class="el" href="pbx_8c_source.html#l00811">ast_ignorepat::registrar</a>.</p>

<p>Referenced by <a class="el" href="pval_8c_source.html#l04393">ast_compile_ael2()</a>, <a class="el" href="pbx_8c_source.html#l07217">ast_context_add_ignorepat()</a>, <a class="el" href="pbx_8c_source.html#l06506">context_merge_incls_swits_igps_other_registrars()</a>, and <a class="el" href="pbx__config_8c_source.html#l01367">pbx_load_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l07230"></a>07230 {
<a name="l07231"></a>07231    <span class="keyword">struct </span><a class="code" href="structast__ignorepat.html" title="ast_ignorepat: Ignore patterns in dial plan">ast_ignorepat</a> *ignorepat, *ignorepatc, *ignorepatl = NULL;
<a name="l07232"></a>07232    <span class="keywordtype">int</span> length;
<a name="l07233"></a>07233    <span class="keywordtype">char</span> *<a class="code" href="structast__ignorepat.html#a22c50d97e30c98ae5e62eaed74605c78">pattern</a>;
<a name="l07234"></a>07234    length = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structast__ignorepat.html" title="ast_ignorepat: Ignore patterns in dial plan">ast_ignorepat</a>);
<a name="l07235"></a>07235    length += strlen(value) + 1;
<a name="l07236"></a>07236    <span class="keywordflow">if</span> (!(ignorepat = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, length)))
<a name="l07237"></a>07237       <span class="keywordflow">return</span> -1;
<a name="l07238"></a>07238    <span class="comment">/* The cast to char * is because we need to write the initial value.</span>
<a name="l07239"></a>07239 <span class="comment">    * The field is not supposed to be modified otherwise.  Also, gcc 4.2</span>
<a name="l07240"></a>07240 <span class="comment">    * sees the cast as dereferencing a type-punned pointer and warns about</span>
<a name="l07241"></a>07241 <span class="comment">    * it.  This is the workaround (we&apos;re telling gcc, yes, that&apos;s really</span>
<a name="l07242"></a>07242 <span class="comment">    * what we wanted to do).</span>
<a name="l07243"></a>07243 <span class="comment">    */</span>
<a name="l07244"></a>07244    pattern = (<span class="keywordtype">char</span> *) ignorepat-&gt;<a class="code" href="structast__ignorepat.html#a22c50d97e30c98ae5e62eaed74605c78">pattern</a>;
<a name="l07245"></a>07245    strcpy(pattern, value);
<a name="l07246"></a>07246    ignorepat-&gt;<a class="code" href="structast__ignorepat.html#a8ffe03069b70f493ab982ba43faced7f">next</a> = NULL;
<a name="l07247"></a>07247    ignorepat-&gt;<a class="code" href="structast__ignorepat.html#aa05090666ce7a4905fe1b56b4fdd3be3">registrar</a> = <a class="code" href="features_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>;
<a name="l07248"></a>07248    <a class="code" href="pbx_8h.html#a2c961dcbdcade8fac28960ed67c89bd2" title="Write locks a given context.">ast_wrlock_context</a>(con);
<a name="l07249"></a>07249    <span class="keywordflow">for</span> (ignorepatc = con-&gt;<a class="code" href="structast__context.html#aedb0afcd332920e51d2f82860f794347">ignorepats</a>; ignorepatc; ignorepatc = ignorepatc-&gt;<a class="code" href="structast__ignorepat.html#a8ffe03069b70f493ab982ba43faced7f">next</a>) {
<a name="l07250"></a>07250       ignorepatl = ignorepatc;
<a name="l07251"></a>07251       <span class="keywordflow">if</span> (!strcasecmp(ignorepatc-&gt;<a class="code" href="structast__ignorepat.html#a22c50d97e30c98ae5e62eaed74605c78">pattern</a>, value)) {
<a name="l07252"></a>07252          <span class="comment">/* Already there */</span>
<a name="l07253"></a>07253          <a class="code" href="pbx_8h.html#a805796e4728845bff70c4caf5b224308">ast_unlock_context</a>(con);
<a name="l07254"></a>07254          <a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> = EEXIST;
<a name="l07255"></a>07255          <span class="keywordflow">return</span> -1;
<a name="l07256"></a>07256       }
<a name="l07257"></a>07257    }
<a name="l07258"></a>07258    <span class="keywordflow">if</span> (ignorepatl)
<a name="l07259"></a>07259       ignorepatl-&gt;<a class="code" href="structast__ignorepat.html#a8ffe03069b70f493ab982ba43faced7f">next</a> = ignorepat;
<a name="l07260"></a>07260    <span class="keywordflow">else</span>
<a name="l07261"></a>07261       con-&gt;<a class="code" href="structast__context.html#aedb0afcd332920e51d2f82860f794347">ignorepats</a> = ignorepat;
<a name="l07262"></a>07262    <a class="code" href="pbx_8h.html#a805796e4728845bff70c4caf5b224308">ast_unlock_context</a>(con);
<a name="l07263"></a>07263    <span class="keywordflow">return</span> 0;
<a name="l07264"></a>07264 
<a name="l07265"></a>07265 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3903111827b675ec313e56a28ac80cf9"></a><!-- doxytag: member="pbx.h::ast_context_add_include" ref="a3903111827b675ec313e56a28ac80cf9" args="(const char *context, const char *include, const char *registrar)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_context_add_include </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>include</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>registrar</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add a context include. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>context</em>&nbsp;</td><td>context to add include to </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>include</em>&nbsp;</td><td>new include to add </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>registrar</em>&nbsp;</td><td>who's registering it</td></tr>
  </table>
  </dd>
</dl>
<p>Adds an include taking a char * string as the context parameter</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l06768">6768</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l07032">ast_context_add_include2()</a>, <a class="el" href="pbx_8c_source.html#l09358">ast_unlock_contexts()</a>, and <a class="el" href="pbx_8c_source.html#l04658">find_context_locked()</a>.</p>

<p>Referenced by <a class="el" href="pbx__config_8c_source.html#l00519">handle_cli_dialplan_add_include()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l06769"></a>06769 {
<a name="l06770"></a>06770    <span class="keywordtype">int</span> ret = -1;
<a name="l06771"></a>06771    <span class="keyword">struct </span><a class="code" href="structast__context.html" title="ast_context: An extension context">ast_context</a> *c = <a class="code" href="pbx_8c.html#ad3380fed080cd2af7c01774b9fa9086e" title="lookup for a context with a given name,">find_context_locked</a>(<a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>);
<a name="l06772"></a>06772 
<a name="l06773"></a>06773    <span class="keywordflow">if</span> (c) {
<a name="l06774"></a>06774       ret = <a class="code" href="pbx_8h.html#aceaa74fb91df5e8f7892f59953ff6283" title="Add a context include.">ast_context_add_include2</a>(c, include, <a class="code" href="features_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>);
<a name="l06775"></a>06775       <a class="code" href="pbx_8h.html#ae517a87b356aec60d5de4591ef94581b" title="Unlocks contexts.">ast_unlock_contexts</a>();
<a name="l06776"></a>06776    }
<a name="l06777"></a>06777    <span class="keywordflow">return</span> ret;
<a name="l06778"></a>06778 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aceaa74fb91df5e8f7892f59953ff6283"></a><!-- doxytag: member="pbx.h::ast_context_add_include2" ref="aceaa74fb91df5e8f7892f59953ff6283" args="(struct ast_context *con, const char *include, const char *registrar)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_context_add_include2 </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__context.html">ast_context</a> *&nbsp;</td>
          <td class="paramname"> <em>con</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>include</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>registrar</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add a context include. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>con</em>&nbsp;</td><td>context to add the include to </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>include</em>&nbsp;</td><td>include to add </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>registrar</em>&nbsp;</td><td>who registered the context</td></tr>
  </table>
  </dd>
</dl>
<p>Adds an include taking a struct <a class="el" href="structast__context.html" title="ast_context: An extension context">ast_context</a> as the first parameter</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l07032">7032</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l06939">ast_build_timing()</a>, <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="pbx_8c_source.html#l07017">ast_destroy_timing()</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="pbx_8c_source.html#l09384">ast_get_context_name()</a>, <a class="el" href="pbx_8c_source.html#l09376">ast_unlock_context()</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="pbx_8c_source.html#l09366">ast_wrlock_context()</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="pbx_8c_source.html#l00793">ast_include::hastime</a>, <a class="el" href="pbx_8c_source.html#l00846">ast_context::includes</a>, <a class="el" href="pbx_8c_source.html#l00790">ast_include::name</a>, <a class="el" href="pbx_8c_source.html#l00795">ast_include::next</a>, <a class="el" href="pbx_8c_source.html#l00792">ast_include::registrar</a>, <a class="el" href="pbx_8c_source.html#l00791">ast_include::rname</a>, <a class="el" href="pbx_8c_source.html#l00796">ast_include::stuff</a>, and <a class="el" href="pbx_8c_source.html#l00794">ast_include::timing</a>.</p>

<p>Referenced by <a class="el" href="pval_8c_source.html#l04393">ast_compile_ael2()</a>, <a class="el" href="pbx_8c_source.html#l06768">ast_context_add_include()</a>, <a class="el" href="pbx_8c_source.html#l06506">context_merge_incls_swits_igps_other_registrars()</a>, and <a class="el" href="pbx__config_8c_source.html#l01367">pbx_load_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l07034"></a>07034 {
<a name="l07035"></a>07035    <span class="keyword">struct </span><a class="code" href="structast__include.html" title="ast_include: include= support in extensions.conf">ast_include</a> *new_include;
<a name="l07036"></a>07036    <span class="keywordtype">char</span> *c;
<a name="l07037"></a>07037    <span class="keyword">struct </span><a class="code" href="structast__include.html" title="ast_include: include= support in extensions.conf">ast_include</a> *i, *il = NULL; <span class="comment">/* include, include_last */</span>
<a name="l07038"></a>07038    <span class="keywordtype">int</span> length;
<a name="l07039"></a>07039    <span class="keywordtype">char</span> *p;
<a name="l07040"></a>07040 
<a name="l07041"></a>07041    length = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structast__include.html" title="ast_include: include= support in extensions.conf">ast_include</a>);
<a name="l07042"></a>07042    length += 2 * (strlen(value) + 1);
<a name="l07043"></a>07043 
<a name="l07044"></a>07044    <span class="comment">/* allocate new include structure ... */</span>
<a name="l07045"></a>07045    <span class="keywordflow">if</span> (!(new_include = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, length)))
<a name="l07046"></a>07046       <span class="keywordflow">return</span> -1;
<a name="l07047"></a>07047    <span class="comment">/* Fill in this structure. Use &apos;p&apos; for assignments, as the fields</span>
<a name="l07048"></a>07048 <span class="comment">    * in the structure are &apos;const char *&apos;</span>
<a name="l07049"></a>07049 <span class="comment">    */</span>
<a name="l07050"></a>07050    p = new_include-&gt;<a class="code" href="structast__include.html#a7af2365ea6fa5bbbf507c1666e946824">stuff</a>;
<a name="l07051"></a>07051    new_include-&gt;<a class="code" href="structast__include.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = p;
<a name="l07052"></a>07052    strcpy(p, value);
<a name="l07053"></a>07053    p += strlen(value) + 1;
<a name="l07054"></a>07054    new_include-&gt;<a class="code" href="structast__include.html#a0fc4d731325a10cc181d26c7e5549b40">rname</a> = p;
<a name="l07055"></a>07055    strcpy(p, value);
<a name="l07056"></a>07056    <span class="comment">/* Strip off timing info, and process if it is there */</span>
<a name="l07057"></a>07057    <span class="keywordflow">if</span> ( (c = strchr(p, <span class="charliteral">&apos;,&apos;</span>)) ) {
<a name="l07058"></a>07058       *c++ = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l07059"></a>07059       new_include-&gt;<a class="code" href="structast__include.html#a5e1a4fa8d4d02bae74f72169ade15143">hastime</a> = <a class="code" href="pbx_8h.html#a018549fd5d5470b676da92f6034b7347" title="Construct a timing bitmap, for use in time-based conditionals.">ast_build_timing</a>(&amp;(new_include-&gt;<a class="code" href="structast__include.html#a137134920b381175bea34c57d2565f91">timing</a>), c);
<a name="l07060"></a>07060    }
<a name="l07061"></a>07061    new_include-&gt;<a class="code" href="structast__include.html#ad21fd2a65c1cfe0ed6a0aa46f40c2083">next</a>      = NULL;
<a name="l07062"></a>07062    new_include-&gt;<a class="code" href="structast__include.html#aa05090666ce7a4905fe1b56b4fdd3be3">registrar</a> = <a class="code" href="features_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>;
<a name="l07063"></a>07063 
<a name="l07064"></a>07064    <a class="code" href="pbx_8h.html#a2c961dcbdcade8fac28960ed67c89bd2" title="Write locks a given context.">ast_wrlock_context</a>(con);
<a name="l07065"></a>07065 
<a name="l07066"></a>07066    <span class="comment">/* ... go to last include and check if context is already included too... */</span>
<a name="l07067"></a>07067    <span class="keywordflow">for</span> (i = con-&gt;<a class="code" href="structast__context.html#abaa8691efe3e8fe26f5930720bfd8edb">includes</a>; i; i = i-&gt;<a class="code" href="structast__include.html#ad21fd2a65c1cfe0ed6a0aa46f40c2083">next</a>) {
<a name="l07068"></a>07068       <span class="keywordflow">if</span> (!strcasecmp(i-&gt;<a class="code" href="structast__include.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, new_include-&gt;<a class="code" href="structast__include.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)) {
<a name="l07069"></a>07069          <a class="code" href="pbx_8h.html#a2bc52adc4f80137db9161ed499f82a00" title="Deallocates memory structures associated with a timing bitmap.">ast_destroy_timing</a>(&amp;(new_include-&gt;<a class="code" href="structast__include.html#a137134920b381175bea34c57d2565f91">timing</a>));
<a name="l07070"></a>07070          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(new_include);
<a name="l07071"></a>07071          <a class="code" href="pbx_8h.html#a805796e4728845bff70c4caf5b224308">ast_unlock_context</a>(con);
<a name="l07072"></a>07072          <a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> = EEXIST;
<a name="l07073"></a>07073          <span class="keywordflow">return</span> -1;
<a name="l07074"></a>07074       }
<a name="l07075"></a>07075       il = i;
<a name="l07076"></a>07076    }
<a name="l07077"></a>07077 
<a name="l07078"></a>07078    <span class="comment">/* ... include new context into context list, unlock, return */</span>
<a name="l07079"></a>07079    <span class="keywordflow">if</span> (il)
<a name="l07080"></a>07080       il-&gt;<a class="code" href="structast__include.html#ad21fd2a65c1cfe0ed6a0aa46f40c2083">next</a> = new_include;
<a name="l07081"></a>07081    <span class="keywordflow">else</span>
<a name="l07082"></a>07082       con-&gt;<a class="code" href="structast__context.html#abaa8691efe3e8fe26f5930720bfd8edb">includes</a> = new_include;
<a name="l07083"></a>07083    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Including context &apos;%s&apos; in context &apos;%s&apos;\n&quot;</span>, new_include-&gt;<a class="code" href="structast__include.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <a class="code" href="pbx_8h.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a>(con));
<a name="l07084"></a>07084 
<a name="l07085"></a>07085    <a class="code" href="pbx_8h.html#a805796e4728845bff70c4caf5b224308">ast_unlock_context</a>(con);
<a name="l07086"></a>07086 
<a name="l07087"></a>07087    <span class="keywordflow">return</span> 0;
<a name="l07088"></a>07088 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7677cd4c8e3a0c3d205f412e396a7d5c"></a><!-- doxytag: member="pbx.h::ast_context_add_switch" ref="a7677cd4c8e3a0c3d205f412e396a7d5c" args="(const char *context, const char *sw, const char *data, int eval, const char *registrar)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_context_add_switch </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>sw</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>eval</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>registrar</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add a switch. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>context</em>&nbsp;</td><td>context to which to add the switch </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>sw</em>&nbsp;</td><td>switch to add </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>data to pass to switch </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>eval</em>&nbsp;</td><td>whether to evaluate variables when running switch </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>registrar</em>&nbsp;</td><td>whoever registered the switch</td></tr>
  </table>
  </dd>
</dl>
<p>This function registers a switch with the asterisk switch architecture</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l07095">7095</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l07114">ast_context_add_switch2()</a>, <a class="el" href="pbx_8c_source.html#l09358">ast_unlock_contexts()</a>, and <a class="el" href="pbx_8c_source.html#l04658">find_context_locked()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l07096"></a>07096 {
<a name="l07097"></a>07097    <span class="keywordtype">int</span> ret = -1;
<a name="l07098"></a>07098    <span class="keyword">struct </span><a class="code" href="structast__context.html" title="ast_context: An extension context">ast_context</a> *c = <a class="code" href="pbx_8c.html#ad3380fed080cd2af7c01774b9fa9086e" title="lookup for a context with a given name,">find_context_locked</a>(<a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>);
<a name="l07099"></a>07099 
<a name="l07100"></a>07100    <span class="keywordflow">if</span> (c) { <span class="comment">/* found, add switch to this context */</span>
<a name="l07101"></a>07101       ret = <a class="code" href="pbx_8h.html#a98b8af4a068416ee570f9d78cb9af724" title="Adds a switch (first param is a ast_context).">ast_context_add_switch2</a>(c, sw, data, eval, <a class="code" href="features_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>);
<a name="l07102"></a>07102       <a class="code" href="pbx_8h.html#ae517a87b356aec60d5de4591ef94581b" title="Unlocks contexts.">ast_unlock_contexts</a>();
<a name="l07103"></a>07103    }
<a name="l07104"></a>07104    <span class="keywordflow">return</span> ret;
<a name="l07105"></a>07105 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a98b8af4a068416ee570f9d78cb9af724"></a><!-- doxytag: member="pbx.h::ast_context_add_switch2" ref="a98b8af4a068416ee570f9d78cb9af724" args="(struct ast_context *con, const char *sw, const char *data, int eval, const char *registrar)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_context_add_switch2 </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__context.html">ast_context</a> *&nbsp;</td>
          <td class="paramname"> <em>con</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>sw</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>eval</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>registrar</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Adds a switch (first param is a <a class="el" href="structast__context.html" title="ast_context: An extension context">ast_context</a>). </p>
<dl class="note"><dt><b>Note:</b></dt><dd>See <a class="el" href="pbx_8h.html#a7677cd4c8e3a0c3d205f412e396a7d5c" title="Add a switch.">ast_context_add_switch()</a> for argument information, with the exception of the first argument. In this case, it's a pointer to an <a class="el" href="structast__context.html" title="ast_context: An extension context">ast_context</a> structure as opposed to the name. </dd></dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l07114">7114</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="structast__context.html#a1a88e64f1d400d544879fb192cb155e7">ast_context::alts</a>, <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="pbx_8c_source.html#l09384">ast_get_context_name()</a>, <a class="el" href="linkedlists_8h_source.html#l00715">AST_LIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="pbx_8c_source.html#l09376">ast_unlock_context()</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="pbx_8c_source.html#l09366">ast_wrlock_context()</a>, <a class="el" href="pbx_8c_source.html#l00803">ast_sw::data</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="pbx_8c_source.html#l00804">ast_sw::eval</a>, <a class="el" href="pbx_8c_source.html#l00801">ast_sw::name</a>, <a class="el" href="pbx_8c_source.html#l00802">ast_sw::registrar</a>, and <a class="el" href="pbx_8c_source.html#l00806">ast_sw::stuff</a>.</p>

<p>Referenced by <a class="el" href="pval_8c_source.html#l04393">ast_compile_ael2()</a>, <a class="el" href="pbx_8c_source.html#l07095">ast_context_add_switch()</a>, <a class="el" href="pbx_8c_source.html#l06506">context_merge_incls_swits_igps_other_registrars()</a>, <a class="el" href="pbx__lua_8c_source.html#l00845">lua_register_switches()</a>, and <a class="el" href="pbx__config_8c_source.html#l01367">pbx_load_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l07116"></a>07116 {
<a name="l07117"></a>07117    <span class="keyword">struct </span><a class="code" href="structast__sw.html" title="ast_sw: Switch statement in extensions.conf">ast_sw</a> *new_sw;
<a name="l07118"></a>07118    <span class="keyword">struct </span><a class="code" href="structast__sw.html" title="ast_sw: Switch statement in extensions.conf">ast_sw</a> *i;
<a name="l07119"></a>07119    <span class="keywordtype">int</span> length;
<a name="l07120"></a>07120    <span class="keywordtype">char</span> *p;
<a name="l07121"></a>07121 
<a name="l07122"></a>07122    length = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structast__sw.html" title="ast_sw: Switch statement in extensions.conf">ast_sw</a>);
<a name="l07123"></a>07123    length += strlen(value) + 1;
<a name="l07124"></a>07124    <span class="keywordflow">if</span> (<a class="code" href="structast__sw.html#a91a70b77df95bd8b0830b49a094c2acb">data</a>)
<a name="l07125"></a>07125       length += strlen(<a class="code" href="structast__sw.html#a91a70b77df95bd8b0830b49a094c2acb">data</a>);
<a name="l07126"></a>07126    length++;
<a name="l07127"></a>07127 
<a name="l07128"></a>07128    <span class="comment">/* allocate new sw structure ... */</span>
<a name="l07129"></a>07129    <span class="keywordflow">if</span> (!(new_sw = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, length)))
<a name="l07130"></a>07130       <span class="keywordflow">return</span> -1;
<a name="l07131"></a>07131    <span class="comment">/* ... fill in this structure ... */</span>
<a name="l07132"></a>07132    p = new_sw-&gt;<a class="code" href="structast__sw.html#a7af2365ea6fa5bbbf507c1666e946824">stuff</a>;
<a name="l07133"></a>07133    new_sw-&gt;<a class="code" href="structast__sw.html#a5ac083a645d964373f022d03df4849c8">name</a> = p;
<a name="l07134"></a>07134    strcpy(new_sw-&gt;<a class="code" href="structast__sw.html#a5ac083a645d964373f022d03df4849c8">name</a>, value);
<a name="l07135"></a>07135    p += strlen(value) + 1;
<a name="l07136"></a>07136    new_sw-&gt;<a class="code" href="structast__sw.html#a91a70b77df95bd8b0830b49a094c2acb">data</a> = p;
<a name="l07137"></a>07137    <span class="keywordflow">if</span> (<a class="code" href="structast__sw.html#a91a70b77df95bd8b0830b49a094c2acb">data</a>) {
<a name="l07138"></a>07138       strcpy(new_sw-&gt;<a class="code" href="structast__sw.html#a91a70b77df95bd8b0830b49a094c2acb">data</a>, <a class="code" href="structast__sw.html#a91a70b77df95bd8b0830b49a094c2acb">data</a>);
<a name="l07139"></a>07139       p += strlen(<a class="code" href="structast__sw.html#a91a70b77df95bd8b0830b49a094c2acb">data</a>) + 1;
<a name="l07140"></a>07140    } <span class="keywordflow">else</span> {
<a name="l07141"></a>07141       strcpy(new_sw-&gt;<a class="code" href="structast__sw.html#a91a70b77df95bd8b0830b49a094c2acb">data</a>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l07142"></a>07142       p++;
<a name="l07143"></a>07143    }
<a name="l07144"></a>07144    new_sw-&gt;<a class="code" href="structast__sw.html#a4e3f077fec8b035a2678e7740f366dea">eval</a>     = <a class="code" href="structast__sw.html#a4e3f077fec8b035a2678e7740f366dea">eval</a>;
<a name="l07145"></a>07145    new_sw-&gt;<a class="code" href="structast__sw.html#aa05090666ce7a4905fe1b56b4fdd3be3">registrar</a> = <a class="code" href="features_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>;
<a name="l07146"></a>07146 
<a name="l07147"></a>07147    <span class="comment">/* ... try to lock this context ... */</span>
<a name="l07148"></a>07148    <a class="code" href="pbx_8h.html#a2c961dcbdcade8fac28960ed67c89bd2" title="Write locks a given context.">ast_wrlock_context</a>(con);
<a name="l07149"></a>07149 
<a name="l07150"></a>07150    <span class="comment">/* ... go to last sw and check if context is already swd too... */</span>
<a name="l07151"></a>07151    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;con-&gt;<a class="code" href="structast__context.html#a1a88e64f1d400d544879fb192cb155e7">alts</a>, i, <a class="code" href="structast__sw.html#a7012dbab4ff0b0e3f8df13e88a017b18">list</a>) {
<a name="l07152"></a>07152       <span class="keywordflow">if</span> (!strcasecmp(i-&gt;<a class="code" href="structast__sw.html#a5ac083a645d964373f022d03df4849c8">name</a>, new_sw-&gt;<a class="code" href="structast__sw.html#a5ac083a645d964373f022d03df4849c8">name</a>) &amp;&amp; !strcasecmp(i-&gt;<a class="code" href="structast__sw.html#a91a70b77df95bd8b0830b49a094c2acb">data</a>, new_sw-&gt;<a class="code" href="structast__sw.html#a91a70b77df95bd8b0830b49a094c2acb">data</a>)) {
<a name="l07153"></a>07153          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(new_sw);
<a name="l07154"></a>07154          <a class="code" href="pbx_8h.html#a805796e4728845bff70c4caf5b224308">ast_unlock_context</a>(con);
<a name="l07155"></a>07155          <a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> = EEXIST;
<a name="l07156"></a>07156          <span class="keywordflow">return</span> -1;
<a name="l07157"></a>07157       }
<a name="l07158"></a>07158    }
<a name="l07159"></a>07159 
<a name="l07160"></a>07160    <span class="comment">/* ... sw new context into context list, unlock, return */</span>
<a name="l07161"></a>07161    <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(&amp;con-&gt;<a class="code" href="structast__context.html#a1a88e64f1d400d544879fb192cb155e7">alts</a>, new_sw, <a class="code" href="structast__sw.html#a7012dbab4ff0b0e3f8df13e88a017b18">list</a>);
<a name="l07162"></a>07162 
<a name="l07163"></a>07163    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Including switch &apos;%s/%s&apos; in context &apos;%s&apos;\n&quot;</span>, new_sw-&gt;<a class="code" href="structast__sw.html#a5ac083a645d964373f022d03df4849c8">name</a>, new_sw-&gt;<a class="code" href="structast__sw.html#a91a70b77df95bd8b0830b49a094c2acb">data</a>, <a class="code" href="pbx_8h.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a>(con));
<a name="l07164"></a>07164 
<a name="l07165"></a>07165    <a class="code" href="pbx_8h.html#a805796e4728845bff70c4caf5b224308">ast_unlock_context</a>(con);
<a name="l07166"></a>07166 
<a name="l07167"></a>07167    <span class="keywordflow">return</span> 0;
<a name="l07168"></a>07168 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9546b830c22c693a2baed08e48569401"></a><!-- doxytag: member="pbx.h::ast_context_destroy" ref="a9546b830c22c693a2baed08e48569401" args="(struct ast_context *con, const char *registrar)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_context_destroy </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__context.html">ast_context</a> *&nbsp;</td>
          <td class="paramname"> <em>con</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>registrar</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Destroy a context (matches the specified context (or ANY context if NULL). </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>con</em>&nbsp;</td><td>context to destroy </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>registrar</em>&nbsp;</td><td>who registered it</td></tr>
  </table>
  </dd>
</dl>
<p>You can optionally leave out either parameter. It will find it based on either the <a class="el" href="structast__context.html" title="ast_context: An extension context">ast_context</a> or the registrar name.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>nothing </dd></dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l08415">8415</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l08276">__ast_context_destroy()</a>, <a class="el" href="pbx_8c_source.html#l09358">ast_unlock_contexts()</a>, <a class="el" href="pbx_8c_source.html#l09345">ast_wrlock_contexts()</a>, <a class="el" href="pbx_8c_source.html#l01119">contexts</a>, and <a class="el" href="pbx_8c_source.html#l01120">contexts_table</a>.</p>

<p>Referenced by <a class="el" href="chan__iax2_8c_source.html#l13611">__unload_module()</a>, <a class="el" href="chan__sip_8c_source.html#l14933">cleanup_stale_contexts()</a>, <a class="el" href="features_8c_source.html#l03543">parkinglot_destroy()</a>, <a class="el" href="app__meetme_8c_source.html#l05999">sla_destroy()</a>, and <a class="el" href="app__dial_8c_source.html#l02453">unload_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l08416"></a>08416 {
<a name="l08417"></a>08417    <a class="code" href="pbx_8h.html#a18c87dac5f7f4368c11b67d8026adc22" title="Write locks the context list.">ast_wrlock_contexts</a>();
<a name="l08418"></a>08418    <a class="code" href="pbx_8c.html#a06e285124697319566d67b82c25aba19">__ast_context_destroy</a>(<a class="code" href="pbx_8c.html#aae85d5aab50f2d1b8392d6df276f2561">contexts</a>, <a class="code" href="pbx_8c.html#a4571322b2dc5414f61e4f3fe7af2331c">contexts_table</a>, con,<a class="code" href="features_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>);
<a name="l08419"></a>08419    <a class="code" href="pbx_8h.html#ae517a87b356aec60d5de4591ef94581b" title="Unlocks contexts.">ast_unlock_contexts</a>();
<a name="l08420"></a>08420 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2af2d2771e5347b18454a05dbc98e35f"></a><!-- doxytag: member="pbx.h::ast_context_find" ref="a2af2d2771e5347b18454a05dbc98e35f" args="(const char *name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__context.html">ast_context</a>* ast_context_find </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Find a context. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>name of the context to find</td></tr>
  </table>
  </dd>
</dl>
<p>Will search for the context with the given name.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>the <a class="el" href="structast__context.html" title="ast_context: An extension context">ast_context</a> on success, NULL on failure. </dd></dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l02430">2430</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="hashtab_8c_source.html#l00530">ast_hashtab_lookup()</a>, <a class="el" href="pbx_8c_source.html#l09353">ast_rdlock_contexts()</a>, <a class="el" href="pbx_8c_source.html#l09358">ast_unlock_contexts()</a>, <a class="el" href="pbx_8c_source.html#l09485">ast_walk_contexts()</a>, <a class="el" href="pbx_8c_source.html#l01120">contexts_table</a>, <a class="el" href="pbx_8c_source.html#l00852">ast_context::name</a>, and <a class="el" href="pbx_8c_source.html#l02427">fake_context::name</a>.</p>

<p>Referenced by <a class="el" href="chan__iax2_8c_source.html#l13611">__unload_module()</a>, <a class="el" href="app__macro_8c_source.html#l00219">_macro_exec()</a>, <a class="el" href="pbx_8c_source.html#l09532">ast_context_verify_includes()</a>, <a class="el" href="pbx_8c_source.html#l07267">ast_ignore_pattern()</a>, <a class="el" href="chan__sip_8c_source.html#l14933">cleanup_stale_contexts()</a>, <a class="el" href="func__dialplan_8c_source.html#l00053">isexten_function_read()</a>, <a class="el" href="features_8c_source.html#l03672">load_config()</a>, <a class="el" href="features_8c_source.html#l03009">manage_parkinglot()</a>, <a class="el" href="features_8c_source.html#l03335">park_exec_full()</a>, <a class="el" href="features_8c_source.html#l03543">parkinglot_destroy()</a>, <a class="el" href="chan__skinny_8c_source.html#l01764">register_exten()</a>, <a class="el" href="chan__sip_8c_source.html#l04586">register_peer_exten()</a>, <a class="el" href="app__dial_8c_source.html#l02453">unload_module()</a>, and <a class="el" href="chan__skinny_8c_source.html#l01789">unregister_exten()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02431"></a>02431 {
<a name="l02432"></a>02432    <span class="keyword">struct </span><a class="code" href="structast__context.html" title="ast_context: An extension context">ast_context</a> *tmp = NULL;
<a name="l02433"></a>02433    <span class="keyword">struct </span><a class="code" href="structfake__context.html">fake_context</a> item;
<a name="l02434"></a>02434 
<a name="l02435"></a>02435    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(item.name, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keyword">sizeof</span>(item.name));
<a name="l02436"></a>02436 
<a name="l02437"></a>02437    <a class="code" href="pbx_8h.html#aa2c309331fff0a086ab8e216f803d546" title="Read locks the context list.">ast_rdlock_contexts</a>();
<a name="l02438"></a>02438    <span class="keywordflow">if</span>( <a class="code" href="pbx_8c.html#a4571322b2dc5414f61e4f3fe7af2331c">contexts_table</a> ) {
<a name="l02439"></a>02439       tmp = <a class="code" href="hashtab_8h.html#a78b1f7bc201afd020f6270378173bb79" title="Lookup this object in the hash table.">ast_hashtab_lookup</a>(<a class="code" href="pbx_8c.html#a4571322b2dc5414f61e4f3fe7af2331c">contexts_table</a>,&amp;item);
<a name="l02440"></a>02440    } <span class="keywordflow">else</span> {
<a name="l02441"></a>02441       <span class="keywordflow">while</span> ( (tmp = <a class="code" href="pbx_8h.html#a4cd5282ca555370652a7304c0c7ea4c4">ast_walk_contexts</a>(tmp)) ) {
<a name="l02442"></a>02442          <span class="keywordflow">if</span> (!<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a> || !strcasecmp(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, tmp-&gt;<a class="code" href="structast__context.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>)) {
<a name="l02443"></a>02443             <span class="keywordflow">break</span>;
<a name="l02444"></a>02444          }
<a name="l02445"></a>02445       }
<a name="l02446"></a>02446    }
<a name="l02447"></a>02447    <a class="code" href="pbx_8h.html#ae517a87b356aec60d5de4591ef94581b" title="Unlocks contexts.">ast_unlock_contexts</a>();
<a name="l02448"></a>02448    <span class="keywordflow">return</span> tmp;
<a name="l02449"></a>02449 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8a07400b41b3302edf8aef9f53644698"></a><!-- doxytag: member="pbx.h::ast_context_find_or_create" ref="a8a07400b41b3302edf8aef9f53644698" args="(struct ast_context **extcontexts, struct ast_hashtab *exttable, const char *name, const char *registrar)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__context.html">ast_context</a>* ast_context_find_or_create </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__context.html">ast_context</a> **&nbsp;</td>
          <td class="paramname"> <em>extcontexts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__hashtab.html">ast_hashtab</a> *&nbsp;</td>
          <td class="paramname"> <em>exttable</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>registrar</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Register a new context or find an existing one. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>extcontexts</em>&nbsp;</td><td>pointer to the <a class="el" href="structast__context.html" title="ast_context: An extension context">ast_context</a> structure pointer </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>exttable</em>&nbsp;</td><td>pointer to the hashtable that contains all the elements in extcontexts </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>name of the new context </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>registrar</em>&nbsp;</td><td>registrar of the context</td></tr>
  </table>
  </dd>
</dl>
<p>This function allows you to play in two environments: the global contexts (active dialplan) or an external context set of your choosing. To act on the external set, make sure extcontexts and exttable are set; for the globals, make sure both extcontexts and exttable are NULL.</p>
<p>This will first search for a context with your name. If it exists already, it will not create a new one. If it does not exist, it will create a new one with the given name and registrar.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>NULL on failure, and an <a class="el" href="structast__context.html" title="ast_context: An extension context">ast_context</a> structure on success </dd></dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l06424">6424</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="pbx_8c_source.html#l00994">ast_hashtab_compare_contexts()</a>, <a class="el" href="hashtab_8c_source.html#l00222">ast_hashtab_create()</a>, <a class="el" href="pbx_8c_source.html#l01037">ast_hashtab_hash_contexts()</a>, <a class="el" href="hashtab_8c_source.html#l00428">ast_hashtab_insert_immediate()</a>, <a class="el" href="hashtab_8c_source.html#l00499">ast_hashtab_insert_safe()</a>, <a class="el" href="hashtab_8c_source.html#l00530">ast_hashtab_lookup()</a>, <a class="el" href="hashtab_8c_source.html#l00127">ast_hashtab_newsize_java()</a>, <a class="el" href="hashtab_8c_source.html#l00084">ast_hashtab_resize_java()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01692">ast_mutex_init()</a>, <a class="el" href="pbx_8c_source.html#l09353">ast_rdlock_contexts()</a>, <a class="el" href="lock_8h_source.html#l01770">ast_rwlock_init()</a>, <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="pbx_8c_source.html#l09358">ast_unlock_contexts()</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="pbx_8c_source.html#l09345">ast_wrlock_contexts()</a>, <a class="el" href="pbx_8c_source.html#l01119">contexts</a>, <a class="el" href="pbx_8c_source.html#l01120">contexts_table</a>, <a class="el" href="pbx_8c_source.html#l00847">ast_context::ignorepats</a>, <a class="el" href="pbx_8c_source.html#l00846">ast_context::includes</a>, <a class="el" href="pbx__config_8c_source.html#l00054">local_contexts</a>, <a class="el" href="pbx_8c_source.html#l00841">ast_context::lock</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="pbx_8c_source.html#l00851">ast_context::macrolock</a>, <a class="el" href="pbx_8c_source.html#l00852">ast_context::name</a>, <a class="el" href="pbx_8c_source.html#l02427">fake_context::name</a>, <a class="el" href="pbx_8c_source.html#l00845">ast_context::next</a>, <a class="el" href="pbx_8c_source.html#l00849">ast_context::refcount</a>, <a class="el" href="pbx_8c_source.html#l00848">ast_context::registrar</a>, <a class="el" href="pbx_8c_source.html#l00842">ast_context::root</a>, and <a class="el" href="pbx_8c_source.html#l00843">ast_context::root_table</a>.</p>

<p>Referenced by <a class="el" href="pval_8c_source.html#l04393">ast_compile_ael2()</a>, <a class="el" href="features_8c_source.html#l03554">build_parkinglot()</a>, <a class="el" href="chan__skinny_8c_source.html#l06537">config_parse_variables()</a>, <a class="el" href="pbx_8c_source.html#l06539">context_merge()</a>, <a class="el" href="features_8c_source.html#l03672">load_config()</a>, <a class="el" href="app__dial_8c_source.html#l02469">load_module()</a>, <a class="el" href="pbx__lua_8c_source.html#l00845">lua_register_switches()</a>, <a class="el" href="features_8c_source.html#l03009">manage_parkinglot()</a>, <a class="el" href="features_8c_source.html#l00678">park_call_full()</a>, <a class="el" href="pbx__config_8c_source.html#l01367">pbx_load_config()</a>, <a class="el" href="pbx__config_8c_source.html#l01608">pbx_load_users()</a>, <a class="el" href="chan__sip_8c_source.html#l24245">reload_config()</a>, <a class="el" href="chan__iax2_8c_source.html#l12493">set_config()</a>, <a class="el" href="app__meetme_8c_source.html#l06177">sla_build_station()</a>, and <a class="el" href="app__meetme_8c_source.html#l06042">sla_build_trunk()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l06425"></a>06425 {
<a name="l06426"></a>06426    <span class="keyword">struct </span><a class="code" href="structast__context.html" title="ast_context: An extension context">ast_context</a> *tmp, **<a class="code" href="pbx__config_8c.html#a71549c9ba7fb62eeb7c04b697e716543">local_contexts</a>;
<a name="l06427"></a>06427    <span class="keyword">struct </span><a class="code" href="structfake__context.html">fake_context</a> search;
<a name="l06428"></a>06428    <span class="keywordtype">int</span> length = <span class="keyword">sizeof</span>(<span class="keyword">struct </span><a class="code" href="structast__context.html" title="ast_context: An extension context">ast_context</a>) + strlen(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>) + 1;
<a name="l06429"></a>06429 
<a name="l06430"></a>06430    <span class="keywordflow">if</span> (!<a class="code" href="pbx_8c.html#a4571322b2dc5414f61e4f3fe7af2331c">contexts_table</a>) {
<a name="l06431"></a>06431       <a class="code" href="pbx_8c.html#a4571322b2dc5414f61e4f3fe7af2331c">contexts_table</a> = <a class="code" href="hashtab_8h.html#a85701d44df4ea1e746bde709a91a4192" title="Create the hashtable list.">ast_hashtab_create</a>(17,
<a name="l06432"></a>06432                                  <a class="code" href="pbx_8h.html#a20a2f5668173430437db02cdd0acc9f3" title="hashtable functions for contexts">ast_hashtab_compare_contexts</a>,
<a name="l06433"></a>06433                                  <a class="code" href="hashtab_8h.html#aef63906caa0b965e9c8d8561600038e9" title="Determines if a table resize should occur using the Java algorithm (if the table...">ast_hashtab_resize_java</a>,
<a name="l06434"></a>06434                                  <a class="code" href="hashtab_8h.html#a743bfd52a8c9eb5d939ff5944758d846" title="Create a prime number roughly 2x the current table size.">ast_hashtab_newsize_java</a>,
<a name="l06435"></a>06435                                  <a class="code" href="pbx_8h.html#a56461864a4e21b14e753b78f9ac7afb7">ast_hashtab_hash_contexts</a>,
<a name="l06436"></a>06436                                  0);
<a name="l06437"></a>06437    }
<a name="l06438"></a>06438 
<a name="l06439"></a>06439    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(search.name, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keyword">sizeof</span>(search.name));
<a name="l06440"></a>06440    <span class="keywordflow">if</span> (!extcontexts) {
<a name="l06441"></a>06441       <a class="code" href="pbx_8h.html#aa2c309331fff0a086ab8e216f803d546" title="Read locks the context list.">ast_rdlock_contexts</a>();
<a name="l06442"></a>06442       local_contexts = &amp;<a class="code" href="pbx_8c.html#aae85d5aab50f2d1b8392d6df276f2561">contexts</a>;
<a name="l06443"></a>06443       tmp = <a class="code" href="hashtab_8h.html#a78b1f7bc201afd020f6270378173bb79" title="Lookup this object in the hash table.">ast_hashtab_lookup</a>(<a class="code" href="pbx_8c.html#a4571322b2dc5414f61e4f3fe7af2331c">contexts_table</a>, &amp;search);
<a name="l06444"></a>06444       <a class="code" href="pbx_8h.html#ae517a87b356aec60d5de4591ef94581b" title="Unlocks contexts.">ast_unlock_contexts</a>();
<a name="l06445"></a>06445       <span class="keywordflow">if</span> (tmp) {
<a name="l06446"></a>06446          tmp-&gt;<a class="code" href="structast__context.html#a6022c8a609170c7365fb96e83cb2df48">refcount</a>++;
<a name="l06447"></a>06447          <span class="keywordflow">return</span> tmp;
<a name="l06448"></a>06448       }
<a name="l06449"></a>06449    } <span class="keywordflow">else</span> { <span class="comment">/* local contexts just in a linked list; search there for the new context; slow, linear search, but not frequent */</span>
<a name="l06450"></a>06450       local_contexts = extcontexts;
<a name="l06451"></a>06451       tmp = <a class="code" href="hashtab_8h.html#a78b1f7bc201afd020f6270378173bb79" title="Lookup this object in the hash table.">ast_hashtab_lookup</a>(exttable, &amp;search);
<a name="l06452"></a>06452       <span class="keywordflow">if</span> (tmp) {
<a name="l06453"></a>06453          tmp-&gt;<a class="code" href="structast__context.html#a6022c8a609170c7365fb96e83cb2df48">refcount</a>++;
<a name="l06454"></a>06454          <span class="keywordflow">return</span> tmp;
<a name="l06455"></a>06455       }
<a name="l06456"></a>06456    }
<a name="l06457"></a>06457 
<a name="l06458"></a>06458    <span class="keywordflow">if</span> ((tmp = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, length))) {
<a name="l06459"></a>06459       <a class="code" href="lock_8h.html#aeae3552501126e03a4fa95f4acd0ee67">ast_rwlock_init</a>(&amp;tmp-&gt;<a class="code" href="structast__context.html#ace4e0066a5b24f84b90536e9906619f6">lock</a>);
<a name="l06460"></a>06460       <a class="code" href="lock_8h.html#a5dc895fe6e8c089175159fc22e33fc3b">ast_mutex_init</a>(&amp;tmp-&gt;<a class="code" href="structast__context.html#a34eb63008d294b713376e64bb2a7b2ef">macrolock</a>);
<a name="l06461"></a>06461       strcpy(tmp-&gt;<a class="code" href="structast__context.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l06462"></a>06462       tmp-&gt;<a class="code" href="structast__context.html#a6611ebb8017b475186f83b2a62bc25d2">root</a> = NULL;
<a name="l06463"></a>06463       tmp-&gt;<a class="code" href="structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a> = NULL;
<a name="l06464"></a>06464       tmp-&gt;<a class="code" href="structast__context.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(<a class="code" href="features_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>);
<a name="l06465"></a>06465       tmp-&gt;<a class="code" href="structast__context.html#abaa8691efe3e8fe26f5930720bfd8edb">includes</a> = NULL;
<a name="l06466"></a>06466       tmp-&gt;<a class="code" href="structast__context.html#aedb0afcd332920e51d2f82860f794347">ignorepats</a> = NULL;
<a name="l06467"></a>06467       tmp-&gt;<a class="code" href="structast__context.html#a6022c8a609170c7365fb96e83cb2df48">refcount</a> = 1;
<a name="l06468"></a>06468    } <span class="keywordflow">else</span> {
<a name="l06469"></a>06469       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Danger! We failed to allocate a context for %s!\n&quot;</span>, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l06470"></a>06470       <span class="keywordflow">return</span> NULL;
<a name="l06471"></a>06471    }
<a name="l06472"></a>06472 
<a name="l06473"></a>06473    <span class="keywordflow">if</span> (!extcontexts) {
<a name="l06474"></a>06474       <a class="code" href="pbx_8h.html#a18c87dac5f7f4368c11b67d8026adc22" title="Write locks the context list.">ast_wrlock_contexts</a>();
<a name="l06475"></a>06475       tmp-&gt;<a class="code" href="structast__context.html#a0d9eeadf3cb7b27fdcf4f70247dceec6">next</a> = *local_contexts;
<a name="l06476"></a>06476       *local_contexts = tmp;
<a name="l06477"></a>06477       <a class="code" href="hashtab_8h.html#afc129daca552e4483e6990a1e37d7e51" title="Check and insert new object only if it is not there.">ast_hashtab_insert_safe</a>(<a class="code" href="pbx_8c.html#a4571322b2dc5414f61e4f3fe7af2331c">contexts_table</a>, tmp); <span class="comment">/*put this context into the tree */</span>
<a name="l06478"></a>06478       <a class="code" href="pbx_8h.html#ae517a87b356aec60d5de4591ef94581b" title="Unlocks contexts.">ast_unlock_contexts</a>();
<a name="l06479"></a>06479       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Registered context &apos;%s&apos;(%p) in table %p registrar: %s\n&quot;</span>, tmp-&gt;<a class="code" href="structast__context.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>, tmp, <a class="code" href="pbx_8c.html#a4571322b2dc5414f61e4f3fe7af2331c">contexts_table</a>, <a class="code" href="features_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>);
<a name="l06480"></a>06480       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Registered extension context &apos;%s&apos; (%p) in table %p; registrar: %s\n&quot;</span>, tmp-&gt;<a class="code" href="structast__context.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>, tmp, <a class="code" href="pbx_8c.html#a4571322b2dc5414f61e4f3fe7af2331c">contexts_table</a>, <a class="code" href="features_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>);
<a name="l06481"></a>06481    } <span class="keywordflow">else</span> {
<a name="l06482"></a>06482       tmp-&gt;<a class="code" href="structast__context.html#a0d9eeadf3cb7b27fdcf4f70247dceec6">next</a> = *local_contexts;
<a name="l06483"></a>06483       <span class="keywordflow">if</span> (exttable)
<a name="l06484"></a>06484          <a class="code" href="hashtab_8h.html#af3e13ed429193a2bf4f0b9d93ac5d7c1" title="Insert without checking.">ast_hashtab_insert_immediate</a>(exttable, tmp); <span class="comment">/*put this context into the tree */</span>
<a name="l06485"></a>06485 
<a name="l06486"></a>06486       *local_contexts = tmp;
<a name="l06487"></a>06487       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Registered context &apos;%s&apos;(%p) in local table %p; registrar: %s\n&quot;</span>, tmp-&gt;<a class="code" href="structast__context.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>, tmp, exttable, <a class="code" href="features_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>);
<a name="l06488"></a>06488       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Registered extension context &apos;%s&apos; (%p) in local table %p; registrar: %s\n&quot;</span>, tmp-&gt;<a class="code" href="structast__context.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>, tmp, exttable, <a class="code" href="features_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>);
<a name="l06489"></a>06489    }
<a name="l06490"></a>06490    <span class="keywordflow">return</span> tmp;
<a name="l06491"></a>06491 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0425cd7146d66b6ae06f16ddfd53307a"></a><!-- doxytag: member="pbx.h::ast_context_lockmacro" ref="a0425cd7146d66b6ae06f16ddfd53307a" args="(const char *macrocontext)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_context_lockmacro </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>context</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>locks the macrolock in the given given context </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>macrocontext</em>&nbsp;</td><td>name of the macro-context to lock</td></tr>
  </table>
  </dd>
</dl>
<p>Locks the given macro-context to ensure only one thread (call) can execute it at a time</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure</td></tr>
  </table>
  </dd>
</dl>
<dl class="note"><dt><b>Note:</b></dt><dd>This function locks contexts list by &amp;conlist, searches for the right context structure, and locks the macrolock mutex in that context. macrolock is used to limit a macro to be executed by one call at a time. </dd></dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l04988">4988</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="pbx_8c_source.html#l09384">ast_get_context_name()</a>, <a class="el" href="hashtab_8c_source.html#l00530">ast_hashtab_lookup()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="pbx_8c_source.html#l09353">ast_rdlock_contexts()</a>, <a class="el" href="pbx_8c_source.html#l09358">ast_unlock_contexts()</a>, <a class="el" href="pbx_8c_source.html#l09485">ast_walk_contexts()</a>, <a class="el" href="pbx_8c_source.html#l01120">contexts_table</a>, <a class="el" href="pbx_8c_source.html#l00851">ast_context::macrolock</a>, and <a class="el" href="pbx_8c_source.html#l02427">fake_context::name</a>.</p>

<p>Referenced by <a class="el" href="app__macro_8c_source.html#l00219">_macro_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04989"></a>04989 {
<a name="l04990"></a>04990    <span class="keyword">struct </span><a class="code" href="structast__context.html" title="ast_context: An extension context">ast_context</a> *c = NULL;
<a name="l04991"></a>04991    <span class="keywordtype">int</span> ret = -1;
<a name="l04992"></a>04992    <span class="keyword">struct </span><a class="code" href="structfake__context.html">fake_context</a> item;
<a name="l04993"></a>04993 
<a name="l04994"></a>04994    <a class="code" href="pbx_8h.html#aa2c309331fff0a086ab8e216f803d546" title="Read locks the context list.">ast_rdlock_contexts</a>();
<a name="l04995"></a>04995 
<a name="l04996"></a>04996    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(item.name, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <span class="keyword">sizeof</span>(item.name));
<a name="l04997"></a>04997 
<a name="l04998"></a>04998    c = <a class="code" href="hashtab_8h.html#a78b1f7bc201afd020f6270378173bb79" title="Lookup this object in the hash table.">ast_hashtab_lookup</a>(<a class="code" href="pbx_8c.html#a4571322b2dc5414f61e4f3fe7af2331c">contexts_table</a>,&amp;item);
<a name="l04999"></a>04999    <span class="keywordflow">if</span> (c)
<a name="l05000"></a>05000       ret = 0;
<a name="l05001"></a>05001 
<a name="l05002"></a>05002 
<a name="l05003"></a>05003 <span class="preprocessor">#ifdef NOTNOW</span>
<a name="l05004"></a>05004 <span class="preprocessor"></span>
<a name="l05005"></a>05005    <span class="keywordflow">while</span> ((c = <a class="code" href="pbx_8h.html#a4cd5282ca555370652a7304c0c7ea4c4">ast_walk_contexts</a>(c))) {
<a name="l05006"></a>05006       <span class="keywordflow">if</span> (!strcmp(<a class="code" href="pbx_8h.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a>(c), <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>)) {
<a name="l05007"></a>05007          ret = 0;
<a name="l05008"></a>05008          <span class="keywordflow">break</span>;
<a name="l05009"></a>05009       }
<a name="l05010"></a>05010    }
<a name="l05011"></a>05011 
<a name="l05012"></a>05012 <span class="preprocessor">#endif</span>
<a name="l05013"></a>05013 <span class="preprocessor"></span>   <a class="code" href="pbx_8h.html#ae517a87b356aec60d5de4591ef94581b" title="Unlocks contexts.">ast_unlock_contexts</a>();
<a name="l05014"></a>05014 
<a name="l05015"></a>05015    <span class="comment">/* if we found context, lock macrolock */</span>
<a name="l05016"></a>05016    <span class="keywordflow">if</span> (ret == 0) {
<a name="l05017"></a>05017       ret = <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;c-&gt;<a class="code" href="structast__context.html#a34eb63008d294b713376e64bb2a7b2ef">macrolock</a>);
<a name="l05018"></a>05018    }
<a name="l05019"></a>05019 
<a name="l05020"></a>05020    <span class="keywordflow">return</span> ret;
<a name="l05021"></a>05021 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a721c6ba091102f155a586e09b2a526bf"></a><!-- doxytag: member="pbx.h::ast_context_remove_extension" ref="a721c6ba091102f155a586e09b2a526bf" args="(const char *context, const char *extension, int priority, const char *registrar)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_context_remove_extension </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>extension</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>priority</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>registrar</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Simply remove <a class="el" href="structextension.html">extension</a> from context. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>context</em>&nbsp;</td><td>context to remove <a class="el" href="structextension.html">extension</a> from </td></tr>
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structextension.html">extension</a></em>&nbsp;</td><td>which <a class="el" href="structextension.html">extension</a> to remove </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>priority</em>&nbsp;</td><td>priority of <a class="el" href="structextension.html">extension</a> to remove (0 to remove all) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>callerid</em>&nbsp;</td><td>NULL to remove all; non-NULL to match a single record per priority </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>matchcid</em>&nbsp;</td><td>non-zero to match callerid element (if non-NULL); 0 to match default case </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>registrar</em>&nbsp;</td><td>registrar of the <a class="el" href="structextension.html">extension</a></td></tr>
  </table>
  </dd>
</dl>
<p>This function removes an <a class="el" href="structextension.html">extension</a> from a given context.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l04796">4796</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l04801">ast_context_remove_extension_callerid()</a>.</p>

<p>Referenced by <a class="el" href="app__meetme_8c_source.html#l05973">destroy_station()</a>, <a class="el" href="app__meetme_8c_source.html#l05959">destroy_trunk()</a>, <a class="el" href="chan__iax2_8c_source.html#l08216">register_peer_exten()</a>, <a class="el" href="chan__skinny_8c_source.html#l01789">unregister_exten()</a>, and <a class="el" href="chan__unistim_8c_source.html#l01097">UnregisterExtension()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04797"></a>04797 {
<a name="l04798"></a>04798    <span class="keywordflow">return</span> <a class="code" href="pbx_8h.html#a85ffdbb47cc54f8d125b4276d6bd3170">ast_context_remove_extension_callerid</a>(<a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <a class="code" href="structextension.html">extension</a>, priority, NULL, 0, <a class="code" href="features_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>);
<a name="l04799"></a>04799 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a25dad382feec89a9bbc6c5284bb30e25"></a><!-- doxytag: member="pbx.h::ast_context_remove_extension2" ref="a25dad382feec89a9bbc6c5284bb30e25" args="(struct ast_context *con, const char *extension, int priority, const char *registrar, int already_locked)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_context_remove_extension2 </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__context.html">ast_context</a> *&nbsp;</td>
          <td class="paramname"> <em>con</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>extension</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>priority</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>registrar</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>already_locked</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This functionc locks given context, search for the right <a class="el" href="structextension.html">extension</a> and fires out all peer in this extensions with given priority. If priority is set to 0, all <a class="el" href="structpeers.html">peers</a> are removed. After that, unlock context and return. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>When do you want to call this function, make sure that &amp;conlock is locked, because some process can handle with your *con context before you lock it. </dd></dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l04823">4823</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l04828">ast_context_remove_extension_callerid2()</a>.</p>

<p>Referenced by <a class="el" href="features_8c_source.html#l03672">load_config()</a>, <a class="el" href="features_8c_source.html#l03009">manage_parkinglot()</a>, <a class="el" href="features_8c_source.html#l03335">park_exec_full()</a>, and <a class="el" href="app__dial_8c_source.html#l02453">unload_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04824"></a>04824 {
<a name="l04825"></a>04825    <span class="keywordflow">return</span> <a class="code" href="pbx_8h.html#abb8840d8ea2dd143fa4f606d048ad6b7">ast_context_remove_extension_callerid2</a>(con, <a class="code" href="structextension.html">extension</a>, priority, NULL, 0, <a class="code" href="features_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>, already_locked);
<a name="l04826"></a>04826 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a85ffdbb47cc54f8d125b4276d6bd3170"></a><!-- doxytag: member="pbx.h::ast_context_remove_extension_callerid" ref="a85ffdbb47cc54f8d125b4276d6bd3170" args="(const char *context, const char *extension, int priority, const char *callerid, int matchcid, const char *registrar)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_context_remove_extension_callerid </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>extension</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>priority</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>callerid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>matchcid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>registrar</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8c_source.html#l04801">4801</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l04828">ast_context_remove_extension_callerid2()</a>, <a class="el" href="pbx_8c_source.html#l09358">ast_unlock_contexts()</a>, and <a class="el" href="pbx_8c_source.html#l04658">find_context_locked()</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l04796">ast_context_remove_extension()</a>, and <a class="el" href="pbx__config_8c_source.html#l00305">handle_cli_dialplan_remove_extension()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04802"></a>04802 {
<a name="l04803"></a>04803    <span class="keywordtype">int</span> ret = -1; <span class="comment">/* default error return */</span>
<a name="l04804"></a>04804    <span class="keyword">struct </span><a class="code" href="structast__context.html" title="ast_context: An extension context">ast_context</a> *c = <a class="code" href="pbx_8c.html#ad3380fed080cd2af7c01774b9fa9086e" title="lookup for a context with a given name,">find_context_locked</a>(<a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>);
<a name="l04805"></a>04805 
<a name="l04806"></a>04806    <span class="keywordflow">if</span> (c) { <span class="comment">/* ... remove extension ... */</span>
<a name="l04807"></a>04807       ret = <a class="code" href="pbx_8h.html#abb8840d8ea2dd143fa4f606d048ad6b7">ast_context_remove_extension_callerid2</a>(c, <a class="code" href="structextension.html">extension</a>, priority, callerid, matchcallerid, <a class="code" href="features_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>, 1);
<a name="l04808"></a>04808       <a class="code" href="pbx_8h.html#ae517a87b356aec60d5de4591ef94581b" title="Unlocks contexts.">ast_unlock_contexts</a>();
<a name="l04809"></a>04809    }
<a name="l04810"></a>04810    <span class="keywordflow">return</span> ret;
<a name="l04811"></a>04811 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="abb8840d8ea2dd143fa4f606d048ad6b7"></a><!-- doxytag: member="pbx.h::ast_context_remove_extension_callerid2" ref="abb8840d8ea2dd143fa4f606d048ad6b7" args="(struct ast_context *con, const char *extension, int priority, const char *callerid, int matchcid, const char *registrar, int already_locked)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_context_remove_extension_callerid2 </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__context.html">ast_context</a> *&nbsp;</td>
          <td class="paramname"> <em>con</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>extension</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>priority</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>callerid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>matchcid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>registrar</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>already_locked</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8c_source.html#l04828">4828</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l01873">add_exten_to_pattern_tree()</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="hashtab_8c_source.html#l00428">ast_hashtab_insert_immediate()</a>, <a class="el" href="hashtab_8c_source.html#l00530">ast_hashtab_lookup()</a>, <a class="el" href="hashtab_8c_source.html#l00855">ast_hashtab_remove_this_object()</a>, <a class="el" href="hashtab_8c_source.html#l00621">ast_hashtab_size()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="pbx_8c_source.html#l09376">ast_unlock_context()</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="pbx_8c_source.html#l09366">ast_wrlock_context()</a>, <a class="el" href="pbx_8c_source.html#l00772">ast_exten::cidmatch</a>, <a class="el" href="pbx_8c_source.html#l00820">match_char::deleted</a>, <a class="el" href="pbx_8c_source.html#l04525">destroy_exten()</a>, <a class="el" href="pbx_8c_source.html#l00825">match_char::exten</a>, <a class="el" href="pbx_8c_source.html#l00770">ast_exten::exten</a>, <a class="el" href="pbx_8c_source.html#l00774">ast_exten::label</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="pbx_8c_source.html#l01494">log_match_char_tree()</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="pbx_8c_source.html#l00771">ast_exten::matchcid</a>, <a class="el" href="pbx_8c_source.html#l00852">ast_context::name</a>, <a class="el" href="pbx_8c_source.html#l00784">ast_exten::next</a>, <a class="el" href="pbx_8c_source.html#l00844">ast_context::pattern_tree</a>, <a class="el" href="pbx_8c_source.html#l00780">ast_exten::peer</a>, <a class="el" href="pbx_8c_source.html#l00782">ast_exten::peer_label_table</a>, <a class="el" href="pbx_8c_source.html#l00781">ast_exten::peer_table</a>, <a class="el" href="pbx_8c_source.html#l00773">ast_exten::priority</a>, <a class="el" href="pbx_8c_source.html#l00783">ast_exten::registrar</a>, <a class="el" href="pbx_8c_source.html#l00842">ast_context::root</a>, <a class="el" href="pbx_8c_source.html#l00843">ast_context::root_table</a>, and <a class="el" href="pbx_8c_source.html#l00821">match_char::x</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l08276">__ast_context_destroy()</a>, <a class="el" href="pbx_8c_source.html#l04823">ast_context_remove_extension2()</a>, and <a class="el" href="pbx_8c_source.html#l04801">ast_context_remove_extension_callerid()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04829"></a>04829 {
<a name="l04830"></a>04830    <span class="keyword">struct </span><a class="code" href="structast__exten.html" title="ast_exten: An extension The dialplan is saved as a linked list with each context...">ast_exten</a> *<a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, *prev_exten = NULL;
<a name="l04831"></a>04831    <span class="keyword">struct </span><a class="code" href="structast__exten.html" title="ast_exten: An extension The dialplan is saved as a linked list with each context...">ast_exten</a> *<a class="code" href="structast__exten.html#a82ac0c5fa68c0f0aafe79462d3b36eee">peer</a>;
<a name="l04832"></a>04832    <span class="keyword">struct </span><a class="code" href="structast__exten.html" title="ast_exten: An extension The dialplan is saved as a linked list with each context...">ast_exten</a> ex, *exten2, *exten3;
<a name="l04833"></a>04833    <span class="keywordtype">char</span> dummy_name[1024];
<a name="l04834"></a>04834    <span class="keyword">struct </span><a class="code" href="structast__exten.html" title="ast_exten: An extension The dialplan is saved as a linked list with each context...">ast_exten</a> *previous_peer = NULL;
<a name="l04835"></a>04835    <span class="keyword">struct </span><a class="code" href="structast__exten.html" title="ast_exten: An extension The dialplan is saved as a linked list with each context...">ast_exten</a> *next_peer = NULL;
<a name="l04836"></a>04836    <span class="keywordtype">int</span> found = 0;
<a name="l04837"></a>04837 
<a name="l04838"></a>04838    <span class="keywordflow">if</span> (!already_locked)
<a name="l04839"></a>04839       <a class="code" href="pbx_8h.html#a2c961dcbdcade8fac28960ed67c89bd2" title="Write locks a given context.">ast_wrlock_context</a>(con);
<a name="l04840"></a>04840 
<a name="l04841"></a>04841    <span class="comment">/* Handle this is in the new world */</span>
<a name="l04842"></a>04842 
<a name="l04843"></a>04843    <span class="comment">/* FIXME For backwards compatibility, if callerid==NULL, then remove ALL</span>
<a name="l04844"></a>04844 <span class="comment">    * peers, not just those matching the callerid. */</span>
<a name="l04845"></a>04845 <span class="preprocessor">#ifdef NEED_DEBUG</span>
<a name="l04846"></a>04846 <span class="preprocessor"></span>   <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3,<span class="stringliteral">&quot;Removing %s/%s/%d%s%s from trees, registrar=%s\n&quot;</span>, con-&gt;<a class="code" href="structast__context.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>, <a class="code" href="structextension.html">extension</a>, <a class="code" href="structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>, matchcallerid ? <span class="stringliteral">&quot;/&quot;</span> : <span class="stringliteral">&quot;&quot;</span>, matchcallerid ? callerid : <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="features_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>);
<a name="l04847"></a>04847 <span class="preprocessor">#endif</span>
<a name="l04848"></a>04848 <span class="preprocessor"></span><span class="preprocessor">#ifdef CONTEXT_DEBUG</span>
<a name="l04849"></a>04849 <span class="preprocessor"></span>   check_contexts(__FILE__, __LINE__);
<a name="l04850"></a>04850 <span class="preprocessor">#endif</span>
<a name="l04851"></a>04851 <span class="preprocessor"></span>   <span class="comment">/* find this particular extension */</span>
<a name="l04852"></a>04852    ex.exten = dummy_name;
<a name="l04853"></a>04853    ex.matchcid = matchcallerid &amp;&amp; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(callerid); <span class="comment">/* don&apos;t say match if there&apos;s no callerid */</span>
<a name="l04854"></a>04854    ex.cidmatch = callerid;
<a name="l04855"></a>04855    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(dummy_name, <a class="code" href="structextension.html">extension</a>, <span class="keyword">sizeof</span>(dummy_name));
<a name="l04856"></a>04856    exten = <a class="code" href="hashtab_8h.html#a78b1f7bc201afd020f6270378173bb79" title="Lookup this object in the hash table.">ast_hashtab_lookup</a>(con-&gt;<a class="code" href="structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a>, &amp;ex);
<a name="l04857"></a>04857    <span class="keywordflow">if</span> (exten) {
<a name="l04858"></a>04858       <span class="keywordflow">if</span> (<a class="code" href="structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> == 0) {
<a name="l04859"></a>04859          exten2 = <a class="code" href="hashtab_8h.html#a71bd19ff2f6fad1cf5e01f9b8cad6f66" title="Hash the object and then compare ptrs in bucket list instead of calling the compare...">ast_hashtab_remove_this_object</a>(con-&gt;<a class="code" href="structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a>, exten);
<a name="l04860"></a>04860          <span class="keywordflow">if</span> (!exten2)
<a name="l04861"></a>04861             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,<span class="stringliteral">&quot;Trying to delete the exten %s from context %s, but could not remove from the root_table\n&quot;</span>, <a class="code" href="structextension.html">extension</a>, con-&gt;<a class="code" href="structast__context.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>);
<a name="l04862"></a>04862          <span class="keywordflow">if</span> (con-&gt;<a class="code" href="structast__context.html#a2fa7eba1ccec8820c766879753569da0">pattern_tree</a>) {
<a name="l04863"></a>04863             <span class="keyword">struct </span><a class="code" href="structmatch__char.html" title="match_char: forms a syntax tree for quick matching of extension patterns">match_char</a> *<a class="code" href="structmatch__char.html#a87d9da60be62fb1a74b56404c392bf74">x</a> = <a class="code" href="pbx_8c.html#aa638cd9d03f5d710b6a320ffda6d6392">add_exten_to_pattern_tree</a>(con, exten, 1);
<a name="l04864"></a>04864 
<a name="l04865"></a>04865             <span class="keywordflow">if</span> (x-&gt;<a class="code" href="structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>) { <span class="comment">/* this test for safety purposes */</span>
<a name="l04866"></a>04866                x-&gt;<a class="code" href="structmatch__char.html#a3cb0d95aa820737d010fdfaccac92ec3">deleted</a> = 1; <span class="comment">/* with this marked as deleted, it will never show up in the scoreboard, and therefore never be found */</span>
<a name="l04867"></a>04867                x-&gt;<a class="code" href="structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a> = 0; <span class="comment">/* get rid of what will become a bad pointer */</span>
<a name="l04868"></a>04868             } <span class="keywordflow">else</span> {
<a name="l04869"></a>04869                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,<span class="stringliteral">&quot;Trying to delete an exten from a context, but the pattern tree node returned isn&apos;t a full extension\n&quot;</span>);
<a name="l04870"></a>04870             }
<a name="l04871"></a>04871          }
<a name="l04872"></a>04872       } <span class="keywordflow">else</span> {
<a name="l04873"></a>04873          ex.priority = priority;
<a name="l04874"></a>04874          exten2 = <a class="code" href="hashtab_8h.html#a78b1f7bc201afd020f6270378173bb79" title="Lookup this object in the hash table.">ast_hashtab_lookup</a>(exten-&gt;<a class="code" href="structast__exten.html#a11a2e693c2355642149ba92ac86db8f9">peer_table</a>, &amp;ex);
<a name="l04875"></a>04875          <span class="keywordflow">if</span> (exten2) {
<a name="l04876"></a>04876 
<a name="l04877"></a>04877             <span class="keywordflow">if</span> (exten2-&gt;<a class="code" href="structast__exten.html#ab5fbdb5052858ca8d2538566229fbe64">label</a>) { <span class="comment">/* if this exten has a label, remove that, too */</span>
<a name="l04878"></a>04878                exten3 = <a class="code" href="hashtab_8h.html#a71bd19ff2f6fad1cf5e01f9b8cad6f66" title="Hash the object and then compare ptrs in bucket list instead of calling the compare...">ast_hashtab_remove_this_object</a>(exten-&gt;<a class="code" href="structast__exten.html#a10c9abe707a81a9cabd06ee4b53ac0fe">peer_label_table</a>,exten2);
<a name="l04879"></a>04879                <span class="keywordflow">if</span> (!exten3)
<a name="l04880"></a>04880                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,<span class="stringliteral">&quot;Did not remove this priority label (%d/%s) from the peer_label_table of context %s, extension %s!\n&quot;</span>, priority, exten2-&gt;<a class="code" href="structast__exten.html#ab5fbdb5052858ca8d2538566229fbe64">label</a>, con-&gt;<a class="code" href="structast__context.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>, exten2-&gt;<a class="code" href="structast__exten.html#a9c2cb8c1611452928af0def998e36335">exten</a>);
<a name="l04881"></a>04881             }
<a name="l04882"></a>04882 
<a name="l04883"></a>04883             exten3 = <a class="code" href="hashtab_8h.html#a71bd19ff2f6fad1cf5e01f9b8cad6f66" title="Hash the object and then compare ptrs in bucket list instead of calling the compare...">ast_hashtab_remove_this_object</a>(exten-&gt;<a class="code" href="structast__exten.html#a11a2e693c2355642149ba92ac86db8f9">peer_table</a>, exten2);
<a name="l04884"></a>04884             <span class="keywordflow">if</span> (!exten3)
<a name="l04885"></a>04885                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,<span class="stringliteral">&quot;Did not remove this priority (%d) from the peer_table of context %s, extension %s!\n&quot;</span>, priority, con-&gt;<a class="code" href="structast__context.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>, exten2-&gt;<a class="code" href="structast__exten.html#a9c2cb8c1611452928af0def998e36335">exten</a>);
<a name="l04886"></a>04886             <span class="keywordflow">if</span> (exten2 == exten &amp;&amp; exten2-&gt;<a class="code" href="structast__exten.html#a82ac0c5fa68c0f0aafe79462d3b36eee">peer</a>) {
<a name="l04887"></a>04887                exten2 = <a class="code" href="hashtab_8h.html#a71bd19ff2f6fad1cf5e01f9b8cad6f66" title="Hash the object and then compare ptrs in bucket list instead of calling the compare...">ast_hashtab_remove_this_object</a>(con-&gt;<a class="code" href="structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a>, exten);
<a name="l04888"></a>04888                <a class="code" href="hashtab_8h.html#af3e13ed429193a2bf4f0b9d93ac5d7c1" title="Insert without checking.">ast_hashtab_insert_immediate</a>(con-&gt;<a class="code" href="structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a>, exten2-&gt;<a class="code" href="structast__exten.html#a82ac0c5fa68c0f0aafe79462d3b36eee">peer</a>);
<a name="l04889"></a>04889             }
<a name="l04890"></a>04890             <span class="keywordflow">if</span> (<a class="code" href="hashtab_8h.html#ac3452d3a8bca5b4f2611bb96b7a44f31" title="Returns the number of elements stored in the hashtab.">ast_hashtab_size</a>(exten-&gt;<a class="code" href="structast__exten.html#a11a2e693c2355642149ba92ac86db8f9">peer_table</a>) == 0) {
<a name="l04891"></a>04891                <span class="comment">/* well, if the last priority of an exten is to be removed,</span>
<a name="l04892"></a>04892 <span class="comment">                  then, the extension is removed, too! */</span>
<a name="l04893"></a>04893                exten3 = <a class="code" href="hashtab_8h.html#a71bd19ff2f6fad1cf5e01f9b8cad6f66" title="Hash the object and then compare ptrs in bucket list instead of calling the compare...">ast_hashtab_remove_this_object</a>(con-&gt;<a class="code" href="structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a>, exten);
<a name="l04894"></a>04894                <span class="keywordflow">if</span> (!exten3)
<a name="l04895"></a>04895                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,<span class="stringliteral">&quot;Did not remove this exten (%s) from the context root_table (%s) (priority %d)\n&quot;</span>, exten-&gt;<a class="code" href="structast__exten.html#a9c2cb8c1611452928af0def998e36335">exten</a>, con-&gt;<a class="code" href="structast__context.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>, priority);
<a name="l04896"></a>04896                <span class="keywordflow">if</span> (con-&gt;<a class="code" href="structast__context.html#a2fa7eba1ccec8820c766879753569da0">pattern_tree</a>) {
<a name="l04897"></a>04897                   <span class="keyword">struct </span><a class="code" href="structmatch__char.html" title="match_char: forms a syntax tree for quick matching of extension patterns">match_char</a> *<a class="code" href="structmatch__char.html#a87d9da60be62fb1a74b56404c392bf74">x</a> = <a class="code" href="pbx_8c.html#aa638cd9d03f5d710b6a320ffda6d6392">add_exten_to_pattern_tree</a>(con, exten, 1);
<a name="l04898"></a>04898                   <span class="keywordflow">if</span> (x-&gt;<a class="code" href="structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>) { <span class="comment">/* this test for safety purposes */</span>
<a name="l04899"></a>04899                      x-&gt;<a class="code" href="structmatch__char.html#a3cb0d95aa820737d010fdfaccac92ec3">deleted</a> = 1; <span class="comment">/* with this marked as deleted, it will never show up in the scoreboard, and therefore never be found */</span>
<a name="l04900"></a>04900                      x-&gt;<a class="code" href="structmatch__char.html#afc8cfd0aed370c037cd78797da3313e7">exten</a> = 0; <span class="comment">/* get rid of what will become a bad pointer */</span>
<a name="l04901"></a>04901                   }
<a name="l04902"></a>04902                }
<a name="l04903"></a>04903             }
<a name="l04904"></a>04904          } <span class="keywordflow">else</span> {
<a name="l04905"></a>04905             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,<span class="stringliteral">&quot;Could not find priority %d of exten %s in context %s!\n&quot;</span>,
<a name="l04906"></a>04906                   priority, exten-&gt;<a class="code" href="structast__exten.html#a9c2cb8c1611452928af0def998e36335">exten</a>, con-&gt;<a class="code" href="structast__context.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>);
<a name="l04907"></a>04907          }
<a name="l04908"></a>04908       }
<a name="l04909"></a>04909    } <span class="keywordflow">else</span> {
<a name="l04910"></a>04910       <span class="comment">/* hmmm? this exten is not in this pattern tree? */</span>
<a name="l04911"></a>04911       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,<span class="stringliteral">&quot;Cannot find extension %s in root_table in context %s\n&quot;</span>,
<a name="l04912"></a>04912             <a class="code" href="structextension.html">extension</a>, con-&gt;<a class="code" href="structast__context.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>);
<a name="l04913"></a>04913    }
<a name="l04914"></a>04914 <span class="preprocessor">#ifdef NEED_DEBUG</span>
<a name="l04915"></a>04915 <span class="preprocessor"></span>   <span class="keywordflow">if</span> (con-&gt;<a class="code" href="structast__context.html#a2fa7eba1ccec8820c766879753569da0">pattern_tree</a>) {
<a name="l04916"></a>04916       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;match char tree after exten removal:\n&quot;</span>);
<a name="l04917"></a>04917       <a class="code" href="pbx_8c.html#a45d3d0857a56e9ec039a20350bbb7d7f">log_match_char_tree</a>(con-&gt;<a class="code" href="structast__context.html#a2fa7eba1ccec8820c766879753569da0">pattern_tree</a>, <span class="stringliteral">&quot; &quot;</span>);
<a name="l04918"></a>04918    }
<a name="l04919"></a>04919 <span class="preprocessor">#endif</span>
<a name="l04920"></a>04920 <span class="preprocessor"></span>
<a name="l04921"></a>04921    <span class="comment">/* scan the extension list to find first matching extension-registrar */</span>
<a name="l04922"></a>04922    <span class="keywordflow">for</span> (exten = con-&gt;<a class="code" href="structast__context.html#a6611ebb8017b475186f83b2a62bc25d2">root</a>; exten; prev_exten = exten, exten = exten-&gt;<a class="code" href="structast__exten.html#a559687cbebb609d8efb545c78d6c216f">next</a>) {
<a name="l04923"></a>04923       <span class="keywordflow">if</span> (!strcmp(exten-&gt;<a class="code" href="structast__exten.html#a9c2cb8c1611452928af0def998e36335">exten</a>, <a class="code" href="structextension.html">extension</a>) &amp;&amp;
<a name="l04924"></a>04924          (!<a class="code" href="features_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a> || !strcmp(exten-&gt;<a class="code" href="structast__exten.html#aa05090666ce7a4905fe1b56b4fdd3be3">registrar</a>, <a class="code" href="features_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>)) &amp;&amp;
<a name="l04925"></a>04925          (!matchcallerid || (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(callerid) &amp;&amp; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(exten-&gt;<a class="code" href="structast__exten.html#aa40e509d3af869c736d2c5e2d67ce97e">cidmatch</a>) &amp;&amp; !strcmp(exten-&gt;<a class="code" href="structast__exten.html#aa40e509d3af869c736d2c5e2d67ce97e">cidmatch</a>, callerid)) || (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(callerid) &amp;&amp; <a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(exten-&gt;<a class="code" href="structast__exten.html#aa40e509d3af869c736d2c5e2d67ce97e">cidmatch</a>))))
<a name="l04926"></a>04926          <span class="keywordflow">break</span>;
<a name="l04927"></a>04927    }
<a name="l04928"></a>04928    <span class="keywordflow">if</span> (!exten) {
<a name="l04929"></a>04929       <span class="comment">/* we can&apos;t find right extension */</span>
<a name="l04930"></a>04930       <span class="keywordflow">if</span> (!already_locked)
<a name="l04931"></a>04931          <a class="code" href="pbx_8h.html#a805796e4728845bff70c4caf5b224308">ast_unlock_context</a>(con);
<a name="l04932"></a>04932       <span class="keywordflow">return</span> -1;
<a name="l04933"></a>04933    }
<a name="l04934"></a>04934 
<a name="l04935"></a>04935    <span class="comment">/* scan the priority list to remove extension with exten-&gt;priority == priority */</span>
<a name="l04936"></a>04936    <span class="keywordflow">for</span> (peer = exten, next_peer = exten-&gt;<a class="code" href="structast__exten.html#a82ac0c5fa68c0f0aafe79462d3b36eee">peer</a> ? exten-&gt;<a class="code" href="structast__exten.html#a82ac0c5fa68c0f0aafe79462d3b36eee">peer</a> : exten-&gt;<a class="code" href="structast__exten.html#a559687cbebb609d8efb545c78d6c216f">next</a>;
<a name="l04937"></a>04937        peer &amp;&amp; !strcmp(peer-&gt;<a class="code" href="structast__exten.html#a9c2cb8c1611452928af0def998e36335">exten</a>, <a class="code" href="structextension.html">extension</a>) &amp;&amp; (!matchcallerid || (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(callerid) &amp;&amp; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(peer-&gt;<a class="code" href="structast__exten.html#aa40e509d3af869c736d2c5e2d67ce97e">cidmatch</a>) &amp;&amp; !strcmp(peer-&gt;<a class="code" href="structast__exten.html#aa40e509d3af869c736d2c5e2d67ce97e">cidmatch</a>,callerid)) || (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(callerid) &amp;&amp; <a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(peer-&gt;<a class="code" href="structast__exten.html#aa40e509d3af869c736d2c5e2d67ce97e">cidmatch</a>)));
<a name="l04938"></a>04938          peer = next_peer, next_peer = next_peer ? (next_peer-&gt;<a class="code" href="structast__exten.html#a82ac0c5fa68c0f0aafe79462d3b36eee">peer</a> ? next_peer-&gt;<a class="code" href="structast__exten.html#a82ac0c5fa68c0f0aafe79462d3b36eee">peer</a> : next_peer-&gt;<a class="code" href="structast__exten.html#a559687cbebb609d8efb545c78d6c216f">next</a>) : NULL) {
<a name="l04939"></a>04939       <span class="keywordflow">if</span> ((priority == 0 || peer-&gt;<a class="code" href="structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> == priority) &amp;&amp;
<a name="l04940"></a>04940             (!callerid || !matchcallerid || (matchcallerid &amp;&amp; !strcmp(peer-&gt;<a class="code" href="structast__exten.html#aa40e509d3af869c736d2c5e2d67ce97e">cidmatch</a>, callerid))) &amp;&amp;
<a name="l04941"></a>04941             (!<a class="code" href="features_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a> || !strcmp(peer-&gt;<a class="code" href="structast__exten.html#aa05090666ce7a4905fe1b56b4fdd3be3">registrar</a>, <a class="code" href="features_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>) )) {
<a name="l04942"></a>04942          found = 1;
<a name="l04943"></a>04943 
<a name="l04944"></a>04944          <span class="comment">/* we are first priority extension? */</span>
<a name="l04945"></a>04945          <span class="keywordflow">if</span> (!previous_peer) {
<a name="l04946"></a>04946             <span class="comment">/*</span>
<a name="l04947"></a>04947 <span class="comment">             * We are first in the priority chain, so must update the extension chain.</span>
<a name="l04948"></a>04948 <span class="comment">             * The next node is either the next priority or the next extension</span>
<a name="l04949"></a>04949 <span class="comment">             */</span>
<a name="l04950"></a>04950             <span class="keyword">struct </span><a class="code" href="structast__exten.html" title="ast_exten: An extension The dialplan is saved as a linked list with each context...">ast_exten</a> *next_node = peer-&gt;<a class="code" href="structast__exten.html#a82ac0c5fa68c0f0aafe79462d3b36eee">peer</a> ? peer-&gt;<a class="code" href="structast__exten.html#a82ac0c5fa68c0f0aafe79462d3b36eee">peer</a> : peer-&gt;<a class="code" href="structast__exten.html#a559687cbebb609d8efb545c78d6c216f">next</a>;
<a name="l04951"></a>04951             <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structast__exten.html#a82ac0c5fa68c0f0aafe79462d3b36eee">peer</a>) {
<a name="l04952"></a>04952                <span class="comment">/* move the peer_table and peer_label_table down to the next peer, if</span>
<a name="l04953"></a>04953 <span class="comment">                  it is there */</span>
<a name="l04954"></a>04954                peer-&gt;<a class="code" href="structast__exten.html#a82ac0c5fa68c0f0aafe79462d3b36eee">peer</a>-&gt;<a class="code" href="structast__exten.html#a11a2e693c2355642149ba92ac86db8f9">peer_table</a> = peer-&gt;<a class="code" href="structast__exten.html#a11a2e693c2355642149ba92ac86db8f9">peer_table</a>;
<a name="l04955"></a>04955                peer-&gt;<a class="code" href="structast__exten.html#a82ac0c5fa68c0f0aafe79462d3b36eee">peer</a>-&gt;<a class="code" href="structast__exten.html#a10c9abe707a81a9cabd06ee4b53ac0fe">peer_label_table</a> = peer-&gt;<a class="code" href="structast__exten.html#a10c9abe707a81a9cabd06ee4b53ac0fe">peer_label_table</a>;
<a name="l04956"></a>04956                peer-&gt;<a class="code" href="structast__exten.html#a11a2e693c2355642149ba92ac86db8f9">peer_table</a> = NULL;
<a name="l04957"></a>04957                peer-&gt;<a class="code" href="structast__exten.html#a10c9abe707a81a9cabd06ee4b53ac0fe">peer_label_table</a> = NULL;
<a name="l04958"></a>04958             }
<a name="l04959"></a>04959             <span class="keywordflow">if</span> (!prev_exten) {   <span class="comment">/* change the root... */</span>
<a name="l04960"></a>04960                con-&gt;<a class="code" href="structast__context.html#a6611ebb8017b475186f83b2a62bc25d2">root</a> = next_node;
<a name="l04961"></a>04961             } <span class="keywordflow">else</span> {
<a name="l04962"></a>04962                prev_exten-&gt;<a class="code" href="structast__exten.html#a559687cbebb609d8efb545c78d6c216f">next</a> = next_node; <span class="comment">/* unlink */</span>
<a name="l04963"></a>04963             }
<a name="l04964"></a>04964             <span class="keywordflow">if</span> (peer-&gt;<a class="code" href="structast__exten.html#a82ac0c5fa68c0f0aafe79462d3b36eee">peer</a>)   { <span class="comment">/* update the new head of the pri list */</span>
<a name="l04965"></a>04965                peer-&gt;<a class="code" href="structast__exten.html#a82ac0c5fa68c0f0aafe79462d3b36eee">peer</a>-&gt;<a class="code" href="structast__exten.html#a559687cbebb609d8efb545c78d6c216f">next</a> = peer-&gt;<a class="code" href="structast__exten.html#a559687cbebb609d8efb545c78d6c216f">next</a>;
<a name="l04966"></a>04966             }
<a name="l04967"></a>04967          } <span class="keywordflow">else</span> { <span class="comment">/* easy, we are not first priority in extension */</span>
<a name="l04968"></a>04968             previous_peer-&gt;<a class="code" href="structast__exten.html#a82ac0c5fa68c0f0aafe79462d3b36eee">peer</a> = peer-&gt;<a class="code" href="structast__exten.html#a82ac0c5fa68c0f0aafe79462d3b36eee">peer</a>;
<a name="l04969"></a>04969          }
<a name="l04970"></a>04970 
<a name="l04971"></a>04971          <span class="comment">/* now, free whole priority extension */</span>
<a name="l04972"></a>04972          <a class="code" href="pbx_8c.html#ae25a2122becbf9b94f5d55bc86753fea">destroy_exten</a>(peer);
<a name="l04973"></a>04973       } <span class="keywordflow">else</span> {
<a name="l04974"></a>04974          previous_peer = peer;
<a name="l04975"></a>04975       }
<a name="l04976"></a>04976    }
<a name="l04977"></a>04977    <span class="keywordflow">if</span> (!already_locked)
<a name="l04978"></a>04978       <a class="code" href="pbx_8h.html#a805796e4728845bff70c4caf5b224308">ast_unlock_context</a>(con);
<a name="l04979"></a>04979    <span class="keywordflow">return</span> found ? 0 : -1;
<a name="l04980"></a>04980 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a08e43dc093c586991af4e2f86fa14f2e"></a><!-- doxytag: member="pbx.h::ast_context_remove_ignorepat" ref="a08e43dc093c586991af4e2f86fa14f2e" args="(const char *context, const char *ignorepat, const char *registrar)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_context_remove_ignorepat </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>ignorepat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>registrar</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8c_source.html#l07174">7174</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l07186">ast_context_remove_ignorepat2()</a>, <a class="el" href="pbx_8c_source.html#l09358">ast_unlock_contexts()</a>, and <a class="el" href="pbx_8c_source.html#l04658">find_context_locked()</a>.</p>

<p>Referenced by <a class="el" href="pbx__config_8c_source.html#l01148">handle_cli_dialplan_remove_ignorepat()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l07175"></a>07175 {
<a name="l07176"></a>07176    <span class="keywordtype">int</span> ret = -1;
<a name="l07177"></a>07177    <span class="keyword">struct </span><a class="code" href="structast__context.html" title="ast_context: An extension context">ast_context</a> *c = <a class="code" href="pbx_8c.html#ad3380fed080cd2af7c01774b9fa9086e" title="lookup for a context with a given name,">find_context_locked</a>(<a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>);
<a name="l07178"></a>07178 
<a name="l07179"></a>07179    <span class="keywordflow">if</span> (c) {
<a name="l07180"></a>07180       ret = <a class="code" href="pbx_8h.html#a3c599ffe1436debbdccd45a28685b567">ast_context_remove_ignorepat2</a>(c, ignorepat, <a class="code" href="features_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>);
<a name="l07181"></a>07181       <a class="code" href="pbx_8h.html#ae517a87b356aec60d5de4591ef94581b" title="Unlocks contexts.">ast_unlock_contexts</a>();
<a name="l07182"></a>07182    }
<a name="l07183"></a>07183    <span class="keywordflow">return</span> ret;
<a name="l07184"></a>07184 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3c599ffe1436debbdccd45a28685b567"></a><!-- doxytag: member="pbx.h::ast_context_remove_ignorepat2" ref="a3c599ffe1436debbdccd45a28685b567" args="(struct ast_context *con, const char *ignorepat, const char *registrar)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_context_remove_ignorepat2 </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__context.html">ast_context</a> *&nbsp;</td>
          <td class="paramname"> <em>con</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>ignorepat</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>registrar</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8c_source.html#l07186">7186</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="pbx_8c_source.html#l09376">ast_unlock_context()</a>, <a class="el" href="pbx_8c_source.html#l09366">ast_wrlock_context()</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="pbx_8c_source.html#l00847">ast_context::ignorepats</a>, <a class="el" href="pbx_8c_source.html#l00812">ast_ignorepat::next</a>, <a class="el" href="pbx_8c_source.html#l00813">ast_ignorepat::pattern</a>, and <a class="el" href="pbx_8c_source.html#l00811">ast_ignorepat::registrar</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l07174">ast_context_remove_ignorepat()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l07187"></a>07187 {
<a name="l07188"></a>07188    <span class="keyword">struct </span><a class="code" href="structast__ignorepat.html" title="ast_ignorepat: Ignore patterns in dial plan">ast_ignorepat</a> *ip, *ipl = NULL;
<a name="l07189"></a>07189 
<a name="l07190"></a>07190    <a class="code" href="pbx_8h.html#a2c961dcbdcade8fac28960ed67c89bd2" title="Write locks a given context.">ast_wrlock_context</a>(con);
<a name="l07191"></a>07191 
<a name="l07192"></a>07192    <span class="keywordflow">for</span> (ip = con-&gt;<a class="code" href="structast__context.html#aedb0afcd332920e51d2f82860f794347">ignorepats</a>; ip; ip = ip-&gt;<a class="code" href="structast__ignorepat.html#a8ffe03069b70f493ab982ba43faced7f">next</a>) {
<a name="l07193"></a>07193       <span class="keywordflow">if</span> (!strcmp(ip-&gt;<a class="code" href="structast__ignorepat.html#a22c50d97e30c98ae5e62eaed74605c78">pattern</a>, ignorepat) &amp;&amp;
<a name="l07194"></a>07194          (!<a class="code" href="features_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a> || (<a class="code" href="features_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a> == ip-&gt;<a class="code" href="structast__ignorepat.html#aa05090666ce7a4905fe1b56b4fdd3be3">registrar</a>))) {
<a name="l07195"></a>07195          <span class="keywordflow">if</span> (ipl) {
<a name="l07196"></a>07196             ipl-&gt;<a class="code" href="structast__ignorepat.html#a8ffe03069b70f493ab982ba43faced7f">next</a> = ip-&gt;<a class="code" href="structast__ignorepat.html#a8ffe03069b70f493ab982ba43faced7f">next</a>;
<a name="l07197"></a>07197             <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(ip);
<a name="l07198"></a>07198          } <span class="keywordflow">else</span> {
<a name="l07199"></a>07199             con-&gt;<a class="code" href="structast__context.html#aedb0afcd332920e51d2f82860f794347">ignorepats</a> = ip-&gt;<a class="code" href="structast__ignorepat.html#a8ffe03069b70f493ab982ba43faced7f">next</a>;
<a name="l07200"></a>07200             <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(ip);
<a name="l07201"></a>07201          }
<a name="l07202"></a>07202          <a class="code" href="pbx_8h.html#a805796e4728845bff70c4caf5b224308">ast_unlock_context</a>(con);
<a name="l07203"></a>07203          <span class="keywordflow">return</span> 0;
<a name="l07204"></a>07204       }
<a name="l07205"></a>07205       ipl = ip;
<a name="l07206"></a>07206    }
<a name="l07207"></a>07207 
<a name="l07208"></a>07208    <a class="code" href="pbx_8h.html#a805796e4728845bff70c4caf5b224308">ast_unlock_context</a>(con);
<a name="l07209"></a>07209    <a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> = EINVAL;
<a name="l07210"></a>07210    <span class="keywordflow">return</span> -1;
<a name="l07211"></a>07211 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="acec5cab19e772712434bf03875b57e9a"></a><!-- doxytag: member="pbx.h::ast_context_remove_include" ref="acec5cab19e772712434bf03875b57e9a" args="(const char *context, const char *include, const char *registrar)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_context_remove_include </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>include</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>registrar</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Remove a context include. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>See ast_context_add_include for information on arguments</dd></dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l04687">4687</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l04709">ast_context_remove_include2()</a>, <a class="el" href="pbx_8c_source.html#l09358">ast_unlock_contexts()</a>, and <a class="el" href="pbx_8c_source.html#l04658">find_context_locked()</a>.</p>

<p>Referenced by <a class="el" href="pbx__config_8c_source.html#l00073">handle_cli_dialplan_remove_include()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04688"></a>04688 {
<a name="l04689"></a>04689    <span class="keywordtype">int</span> ret = -1;
<a name="l04690"></a>04690    <span class="keyword">struct </span><a class="code" href="structast__context.html" title="ast_context: An extension context">ast_context</a> *c = <a class="code" href="pbx_8c.html#ad3380fed080cd2af7c01774b9fa9086e" title="lookup for a context with a given name,">find_context_locked</a>(<a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>);
<a name="l04691"></a>04691 
<a name="l04692"></a>04692    <span class="keywordflow">if</span> (c) {
<a name="l04693"></a>04693       <span class="comment">/* found, remove include from this context ... */</span>
<a name="l04694"></a>04694       ret = <a class="code" href="pbx_8h.html#a8c23053e0d4d87545a93ec837a19b908" title="Removes an include by an ast_context structure.">ast_context_remove_include2</a>(c, include, <a class="code" href="features_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>);
<a name="l04695"></a>04695       <a class="code" href="pbx_8h.html#ae517a87b356aec60d5de4591ef94581b" title="Unlocks contexts.">ast_unlock_contexts</a>();
<a name="l04696"></a>04696    }
<a name="l04697"></a>04697    <span class="keywordflow">return</span> ret;
<a name="l04698"></a>04698 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8c23053e0d4d87545a93ec837a19b908"></a><!-- doxytag: member="pbx.h::ast_context_remove_include2" ref="a8c23053e0d4d87545a93ec837a19b908" args="(struct ast_context *con, const char *include, const char *registrar)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_context_remove_include2 </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__context.html">ast_context</a> *&nbsp;</td>
          <td class="paramname"> <em>con</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>include</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>registrar</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Removes an include by an <a class="el" href="structast__context.html" title="ast_context: An extension context">ast_context</a> structure. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>See ast_context_add_include2 for information on arguments</dd></dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on success</td></tr>
  </table>
  </dd>
</dl>
<p>Removes an include by an <a class="el" href="structast__context.html" title="ast_context: An extension context">ast_context</a> structure.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l04709">4709</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l07017">ast_destroy_timing()</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="pbx_8c_source.html#l09384">ast_get_context_name()</a>, <a class="el" href="pbx_8c_source.html#l09376">ast_unlock_context()</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="pbx_8c_source.html#l09366">ast_wrlock_context()</a>, <a class="el" href="pbx_8c_source.html#l00846">ast_context::includes</a>, <a class="el" href="pbx_8c_source.html#l00790">ast_include::name</a>, <a class="el" href="pbx_8c_source.html#l00795">ast_include::next</a>, <a class="el" href="pbx_8c_source.html#l00792">ast_include::registrar</a>, and <a class="el" href="pbx_8c_source.html#l00794">ast_include::timing</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l04687">ast_context_remove_include()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04710"></a>04710 {
<a name="l04711"></a>04711    <span class="keyword">struct </span><a class="code" href="structast__include.html" title="ast_include: include= support in extensions.conf">ast_include</a> *i, *pi = NULL;
<a name="l04712"></a>04712    <span class="keywordtype">int</span> ret = -1;
<a name="l04713"></a>04713 
<a name="l04714"></a>04714    <a class="code" href="pbx_8h.html#a2c961dcbdcade8fac28960ed67c89bd2" title="Write locks a given context.">ast_wrlock_context</a>(con);
<a name="l04715"></a>04715 
<a name="l04716"></a>04716    <span class="comment">/* find our include */</span>
<a name="l04717"></a>04717    <span class="keywordflow">for</span> (i = con-&gt;<a class="code" href="structast__context.html#abaa8691efe3e8fe26f5930720bfd8edb">includes</a>; i; pi = i, i = i-&gt;<a class="code" href="structast__include.html#ad21fd2a65c1cfe0ed6a0aa46f40c2083">next</a>) {
<a name="l04718"></a>04718       <span class="keywordflow">if</span> (!strcmp(i-&gt;<a class="code" href="structast__include.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, include) &amp;&amp;
<a name="l04719"></a>04719             (!<a class="code" href="features_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a> || !strcmp(i-&gt;<a class="code" href="structast__include.html#aa05090666ce7a4905fe1b56b4fdd3be3">registrar</a>, <a class="code" href="features_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>))) {
<a name="l04720"></a>04720          <span class="comment">/* remove from list */</span>
<a name="l04721"></a>04721          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Removing inclusion of context &apos;%s&apos; in context &apos;%s; registrar=%s&apos;\n&quot;</span>, include, <a class="code" href="pbx_8h.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a>(con), <a class="code" href="features_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>);
<a name="l04722"></a>04722          <span class="keywordflow">if</span> (pi)
<a name="l04723"></a>04723             pi-&gt;<a class="code" href="structast__include.html#ad21fd2a65c1cfe0ed6a0aa46f40c2083">next</a> = i-&gt;<a class="code" href="structast__include.html#ad21fd2a65c1cfe0ed6a0aa46f40c2083">next</a>;
<a name="l04724"></a>04724          <span class="keywordflow">else</span>
<a name="l04725"></a>04725             con-&gt;<a class="code" href="structast__context.html#abaa8691efe3e8fe26f5930720bfd8edb">includes</a> = i-&gt;<a class="code" href="structast__include.html#ad21fd2a65c1cfe0ed6a0aa46f40c2083">next</a>;
<a name="l04726"></a>04726          <span class="comment">/* free include and return */</span>
<a name="l04727"></a>04727          <a class="code" href="pbx_8h.html#a2bc52adc4f80137db9161ed499f82a00" title="Deallocates memory structures associated with a timing bitmap.">ast_destroy_timing</a>(&amp;(i-&gt;<a class="code" href="structast__include.html#a137134920b381175bea34c57d2565f91">timing</a>));
<a name="l04728"></a>04728          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(i);
<a name="l04729"></a>04729          ret = 0;
<a name="l04730"></a>04730          <span class="keywordflow">break</span>;
<a name="l04731"></a>04731       }
<a name="l04732"></a>04732    }
<a name="l04733"></a>04733 
<a name="l04734"></a>04734    <a class="code" href="pbx_8h.html#a805796e4728845bff70c4caf5b224308">ast_unlock_context</a>(con);
<a name="l04735"></a>04735 
<a name="l04736"></a>04736    <span class="keywordflow">return</span> ret;
<a name="l04737"></a>04737 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9800750a3fb79caa282c98556473f392"></a><!-- doxytag: member="pbx.h::ast_context_remove_switch" ref="a9800750a3fb79caa282c98556473f392" args="(const char *context, const char *sw, const char *data, const char *registrar)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_context_remove_switch </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>sw</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>registrar</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Remove a switch. </p>
<p>Removes a switch with the given parameters</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure</td></tr>
  </table>
  </dd>
</dl>
<dl class="note"><dt><b>Note:</b></dt><dd>This function locks contexts list by &amp;conlist, search for the rigt context structure, leave context list locked and call ast_context_remove_switch2 which removes switch, unlock contexts list and return ... </dd></dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l04744">4744</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l04765">ast_context_remove_switch2()</a>, <a class="el" href="pbx_8c_source.html#l09358">ast_unlock_contexts()</a>, and <a class="el" href="pbx_8c_source.html#l04658">find_context_locked()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04745"></a>04745 {
<a name="l04746"></a>04746    <span class="keywordtype">int</span> ret = -1; <span class="comment">/* default error return */</span>
<a name="l04747"></a>04747    <span class="keyword">struct </span><a class="code" href="structast__context.html" title="ast_context: An extension context">ast_context</a> *c = <a class="code" href="pbx_8c.html#ad3380fed080cd2af7c01774b9fa9086e" title="lookup for a context with a given name,">find_context_locked</a>(<a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>);
<a name="l04748"></a>04748 
<a name="l04749"></a>04749    <span class="keywordflow">if</span> (c) {
<a name="l04750"></a>04750       <span class="comment">/* remove switch from this context ... */</span>
<a name="l04751"></a>04751       ret = <a class="code" href="pbx_8h.html#a23a51e49bea958a8d27c61f2a51931d9" title="This function locks given context, removes switch, unlock context and return.">ast_context_remove_switch2</a>(c, sw, data, <a class="code" href="features_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>);
<a name="l04752"></a>04752       <a class="code" href="pbx_8h.html#ae517a87b356aec60d5de4591ef94581b" title="Unlocks contexts.">ast_unlock_contexts</a>();
<a name="l04753"></a>04753    }
<a name="l04754"></a>04754    <span class="keywordflow">return</span> ret;
<a name="l04755"></a>04755 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a23a51e49bea958a8d27c61f2a51931d9"></a><!-- doxytag: member="pbx.h::ast_context_remove_switch2" ref="a23a51e49bea958a8d27c61f2a51931d9" args="(struct ast_context *con, const char *sw, const char *data, const char *registrar)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_context_remove_switch2 </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__context.html">ast_context</a> *&nbsp;</td>
          <td class="paramname"> <em>con</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>sw</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>registrar</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This function locks given context, removes switch, unlock context and return. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>When we call this function, &amp;conlock lock must be locked, because when we giving *con argument, some process can remove/change this context and after that there can be segfault. </dd></dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l04765">4765</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="structast__context.html#a1a88e64f1d400d544879fb192cb155e7">ast_context::alts</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="pbx_8c_source.html#l09384">ast_get_context_name()</a>, <a class="el" href="linkedlists_8h_source.html#l00553">AST_LIST_REMOVE_CURRENT</a>, <a class="el" href="linkedlists_8h_source.html#l00528">AST_LIST_TRAVERSE_SAFE_BEGIN</a>, <a class="el" href="linkedlists_8h_source.html#l00599">AST_LIST_TRAVERSE_SAFE_END</a>, <a class="el" href="pbx_8c_source.html#l09376">ast_unlock_context()</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="pbx_8c_source.html#l09366">ast_wrlock_context()</a>, <a class="el" href="pbx_8c_source.html#l00803">ast_sw::data</a>, <a class="el" href="pbx_8c_source.html#l00801">ast_sw::name</a>, and <a class="el" href="pbx_8c_source.html#l00802">ast_sw::registrar</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l04744">ast_context_remove_switch()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04766"></a>04766 {
<a name="l04767"></a>04767    <span class="keyword">struct </span><a class="code" href="structast__sw.html" title="ast_sw: Switch statement in extensions.conf">ast_sw</a> *i;
<a name="l04768"></a>04768    <span class="keywordtype">int</span> ret = -1;
<a name="l04769"></a>04769 
<a name="l04770"></a>04770    <a class="code" href="pbx_8h.html#a2c961dcbdcade8fac28960ed67c89bd2" title="Write locks a given context.">ast_wrlock_context</a>(con);
<a name="l04771"></a>04771 
<a name="l04772"></a>04772    <span class="comment">/* walk switches */</span>
<a name="l04773"></a>04773    <a class="code" href="linkedlists_8h.html#aa5be52067bf16bdc7e56ca19b5ba858d" title="Loops safely over (traverses) the entries in a list.">AST_LIST_TRAVERSE_SAFE_BEGIN</a>(&amp;con-&gt;<a class="code" href="structast__context.html#a1a88e64f1d400d544879fb192cb155e7">alts</a>, i, <a class="code" href="structast__sw.html#a7012dbab4ff0b0e3f8df13e88a017b18">list</a>) {
<a name="l04774"></a>04774       <span class="keywordflow">if</span> (!strcmp(i-&gt;<a class="code" href="structast__sw.html#a5ac083a645d964373f022d03df4849c8">name</a>, sw) &amp;&amp; !strcmp(i-&gt;<a class="code" href="structast__sw.html#a91a70b77df95bd8b0830b49a094c2acb">data</a>, <a class="code" href="structast__sw.html#a91a70b77df95bd8b0830b49a094c2acb">data</a>) &amp;&amp;
<a name="l04775"></a>04775          (!<a class="code" href="features_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a> || !strcmp(i-&gt;<a class="code" href="structast__sw.html#aa05090666ce7a4905fe1b56b4fdd3be3">registrar</a>, <a class="code" href="features_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>))) {
<a name="l04776"></a>04776          <span class="comment">/* found, remove from list */</span>
<a name="l04777"></a>04777          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Removing switch &apos;%s&apos; from context &apos;%s; registrar=%s&apos;\n&quot;</span>, sw, <a class="code" href="pbx_8h.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a>(con), <a class="code" href="features_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>);
<a name="l04778"></a>04778          <a class="code" href="linkedlists_8h.html#aa8ac496fa9c717d5afb99a02e1e2760c" title="Removes the current entry from a list during a traversal.">AST_LIST_REMOVE_CURRENT</a>(<a class="code" href="structast__sw.html#a7012dbab4ff0b0e3f8df13e88a017b18">list</a>);
<a name="l04779"></a>04779          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(i); <span class="comment">/* free switch and return */</span>
<a name="l04780"></a>04780          ret = 0;
<a name="l04781"></a>04781          <span class="keywordflow">break</span>;
<a name="l04782"></a>04782       }
<a name="l04783"></a>04783    }
<a name="l04784"></a>04784    <a class="code" href="linkedlists_8h.html#a712c04b4493919a7052399cd30ee8fb9" title="Closes a safe loop traversal block.">AST_LIST_TRAVERSE_SAFE_END</a>;
<a name="l04785"></a>04785 
<a name="l04786"></a>04786    <a class="code" href="pbx_8h.html#a805796e4728845bff70c4caf5b224308">ast_unlock_context</a>(con);
<a name="l04787"></a>04787 
<a name="l04788"></a>04788    <span class="keywordflow">return</span> ret;
<a name="l04789"></a>04789 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0cb6fe63e51dd357d3146a1f1c64bd95"></a><!-- doxytag: member="pbx.h::ast_context_unlockmacro" ref="a0cb6fe63e51dd357d3146a1f1c64bd95" args="(const char *macrocontext)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_context_unlockmacro </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>context</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Unlocks the macrolock in the given context. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>macrocontext</em>&nbsp;</td><td>name of the macro-context to unlock</td></tr>
  </table>
  </dd>
</dl>
<p>Unlocks the given macro-context so that another thread (call) can execute it</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure</td></tr>
  </table>
  </dd>
</dl>
<dl class="note"><dt><b>Note:</b></dt><dd>This function locks contexts list by &amp;conlist, searches for the right context structure, and unlocks the macrolock mutex in that context. macrolock is used to limit a macro to be executed by one call at a time. </dd></dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l05028">5028</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="pbx_8c_source.html#l09384">ast_get_context_name()</a>, <a class="el" href="hashtab_8c_source.html#l00530">ast_hashtab_lookup()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="pbx_8c_source.html#l09353">ast_rdlock_contexts()</a>, <a class="el" href="pbx_8c_source.html#l09358">ast_unlock_contexts()</a>, <a class="el" href="pbx_8c_source.html#l09485">ast_walk_contexts()</a>, <a class="el" href="pbx_8c_source.html#l01120">contexts_table</a>, <a class="el" href="pbx_8c_source.html#l00851">ast_context::macrolock</a>, and <a class="el" href="pbx_8c_source.html#l02427">fake_context::name</a>.</p>

<p>Referenced by <a class="el" href="app__macro_8c_source.html#l00219">_macro_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05029"></a>05029 {
<a name="l05030"></a>05030    <span class="keyword">struct </span><a class="code" href="structast__context.html" title="ast_context: An extension context">ast_context</a> *c = NULL;
<a name="l05031"></a>05031    <span class="keywordtype">int</span> ret = -1;
<a name="l05032"></a>05032    <span class="keyword">struct </span><a class="code" href="structfake__context.html">fake_context</a> item;
<a name="l05033"></a>05033 
<a name="l05034"></a>05034    <a class="code" href="pbx_8h.html#aa2c309331fff0a086ab8e216f803d546" title="Read locks the context list.">ast_rdlock_contexts</a>();
<a name="l05035"></a>05035 
<a name="l05036"></a>05036    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(item.name, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <span class="keyword">sizeof</span>(item.name));
<a name="l05037"></a>05037 
<a name="l05038"></a>05038    c = <a class="code" href="hashtab_8h.html#a78b1f7bc201afd020f6270378173bb79" title="Lookup this object in the hash table.">ast_hashtab_lookup</a>(<a class="code" href="pbx_8c.html#a4571322b2dc5414f61e4f3fe7af2331c">contexts_table</a>,&amp;item);
<a name="l05039"></a>05039    <span class="keywordflow">if</span> (c)
<a name="l05040"></a>05040       ret = 0;
<a name="l05041"></a>05041 <span class="preprocessor">#ifdef NOTNOW</span>
<a name="l05042"></a>05042 <span class="preprocessor"></span>
<a name="l05043"></a>05043    <span class="keywordflow">while</span> ((c = <a class="code" href="pbx_8h.html#a4cd5282ca555370652a7304c0c7ea4c4">ast_walk_contexts</a>(c))) {
<a name="l05044"></a>05044       <span class="keywordflow">if</span> (!strcmp(<a class="code" href="pbx_8h.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a>(c), <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>)) {
<a name="l05045"></a>05045          ret = 0;
<a name="l05046"></a>05046          <span class="keywordflow">break</span>;
<a name="l05047"></a>05047       }
<a name="l05048"></a>05048    }
<a name="l05049"></a>05049 
<a name="l05050"></a>05050 <span class="preprocessor">#endif</span>
<a name="l05051"></a>05051 <span class="preprocessor"></span>   <a class="code" href="pbx_8h.html#ae517a87b356aec60d5de4591ef94581b" title="Unlocks contexts.">ast_unlock_contexts</a>();
<a name="l05052"></a>05052 
<a name="l05053"></a>05053    <span class="comment">/* if we found context, unlock macrolock */</span>
<a name="l05054"></a>05054    <span class="keywordflow">if</span> (ret == 0) {
<a name="l05055"></a>05055       ret = <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;c-&gt;<a class="code" href="structast__context.html#a34eb63008d294b713376e64bb2a7b2ef">macrolock</a>);
<a name="l05056"></a>05056    }
<a name="l05057"></a>05057 
<a name="l05058"></a>05058    <span class="keywordflow">return</span> ret;
<a name="l05059"></a>05059 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aca6b16b4b7433a12e65103a2f1ab8028"></a><!-- doxytag: member="pbx.h::ast_context_verify_includes" ref="aca6b16b4b7433a12e65103a2f1ab8028" args="(struct ast_context *con)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_context_verify_includes </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__context.html">ast_context</a> *&nbsp;</td>
          <td class="paramname"> <em>con</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Verifies includes in an ast_contect structure. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>con</em>&nbsp;</td><td>context in which to verify the includes</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if no problems found </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>if there were any missing context </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09532">9532</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l02430">ast_context_find()</a>, <a class="el" href="pbx_8c_source.html#l09384">ast_get_context_name()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="pbx_8c_source.html#l09514">ast_walk_context_includes()</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, and <a class="el" href="pbx_8c_source.html#l00791">ast_include::rname</a>.</p>

<p>Referenced by <a class="el" href="pbx__ael_8c_source.html#l00113">pbx_load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09533"></a>09533 {
<a name="l09534"></a>09534    <span class="keyword">struct </span><a class="code" href="structast__include.html" title="ast_include: include= support in extensions.conf">ast_include</a> *inc = NULL;
<a name="l09535"></a>09535    <span class="keywordtype">int</span> res = 0;
<a name="l09536"></a>09536 
<a name="l09537"></a>09537    <span class="keywordflow">while</span> ( (inc = <a class="code" href="pbx_8h.html#a142de6e0271ada6b306f2f7420a3fd77">ast_walk_context_includes</a>(con, inc)) ) {
<a name="l09538"></a>09538       <span class="keywordflow">if</span> (<a class="code" href="pbx_8h.html#a2af2d2771e5347b18454a05dbc98e35f" title="Find a context.">ast_context_find</a>(inc-&gt;<a class="code" href="structast__include.html#a0fc4d731325a10cc181d26c7e5549b40">rname</a>))
<a name="l09539"></a>09539          <span class="keywordflow">continue</span>;
<a name="l09540"></a>09540 
<a name="l09541"></a>09541       res = -1;
<a name="l09542"></a>09542       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Context &apos;%s&apos; tries to include nonexistent context &apos;%s&apos;\n&quot;</span>,
<a name="l09543"></a>09543          <a class="code" href="pbx_8h.html#aa42372790072cff15f75c674917115b0">ast_get_context_name</a>(con), inc-&gt;<a class="code" href="structast__include.html#a0fc4d731325a10cc181d26c7e5549b40">rname</a>);
<a name="l09544"></a>09544       <span class="keywordflow">break</span>;
<a name="l09545"></a>09545    }
<a name="l09546"></a>09546 
<a name="l09547"></a>09547    <span class="keywordflow">return</span> res;
<a name="l09548"></a>09548 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5e0f8c2ce2a3c8994648254799a0c3b7"></a><!-- doxytag: member="pbx.h::ast_custom_function_find" ref="a5e0f8c2ce2a3c8994648254799a0c3b7" args="(const char *name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__custom__function.html">ast_custom_function</a>* ast_custom_function_find </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8c_source.html#l03202">3202</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="structast__custom__function.html#afdf1f4a1680938ef9b90fbe3ecafbca4">ast_custom_function::acflist</a>, <a class="el" href="linkedlists_8h_source.html#l00077">AST_RWLIST_RDLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00493">AST_RWLIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, and <a class="el" href="pbx_8h_source.html#l00084">ast_custom_function::name</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l03356">ast_func_read()</a>, <a class="el" href="pbx_8c_source.html#l03379">ast_func_write()</a>, <a class="el" href="res__config__curl_8c_source.html#l00518">config_curl()</a>, <a class="el" href="res__config__curl_8c_source.html#l00419">destroy_curl()</a>, <a class="el" href="pbx_8c_source.html#l03095">handle_show_function()</a>, <a class="el" href="ast__expr2_8c_source.html#l02651">op_func()</a>, <a class="el" href="res__config__curl_8c_source.html#l00056">realtime_curl()</a>, <a class="el" href="res__config__curl_8c_source.html#l00128">realtime_multi_curl()</a>, <a class="el" href="res__config__curl_8c_source.html#l00472">require_curl()</a>, <a class="el" href="res__config__curl_8c_source.html#l00354">store_curl()</a>, <a class="el" href="res__config__curl_8c_source.html#l00278">update2_curl()</a>, and <a class="el" href="res__config__curl_8c_source.html#l00225">update_curl()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03203"></a>03203 {
<a name="l03204"></a>03204    <span class="keyword">struct </span><a class="code" href="structast__custom__function.html" title="Data structure associated with a custom dialplan function.">ast_custom_function</a> *acf = NULL;
<a name="l03205"></a>03205 
<a name="l03206"></a>03206    <a class="code" href="linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc" title="Read locks a list.">AST_RWLIST_RDLOCK</a>(&amp;<a class="code" href="structacf__root.html">acf_root</a>);
<a name="l03207"></a>03207    <a class="code" href="linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;<a class="code" href="structacf__root.html">acf_root</a>, acf, <a class="code" href="structast__custom__function.html#afdf1f4a1680938ef9b90fbe3ecafbca4">acflist</a>) {
<a name="l03208"></a>03208       <span class="keywordflow">if</span> (!strcmp(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, acf-&gt;<a class="code" href="structast__custom__function.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>))
<a name="l03209"></a>03209          <span class="keywordflow">break</span>;
<a name="l03210"></a>03210    }
<a name="l03211"></a>03211    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structacf__root.html">acf_root</a>);
<a name="l03212"></a>03212 
<a name="l03213"></a>03213    <span class="keywordflow">return</span> acf;
<a name="l03214"></a>03214 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a965977ea9a3144bc203e0ce7a64680a1"></a><!-- doxytag: member="pbx.h::ast_custom_function_unregister" ref="a965977ea9a3144bc203e0ce7a64680a1" args="(struct ast_custom_function *acf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_custom_function_unregister </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__custom__function.html">ast_custom_function</a> *&nbsp;</td>
          <td class="paramname"> <em>acf</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Unregister a custom function. </p>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l03216">3216</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="structast__custom__function.html#afdf1f4a1680938ef9b90fbe3ecafbca4">ast_custom_function::acflist</a>, <a class="el" href="linkedlists_8h_source.html#l00860">AST_RWLIST_REMOVE</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, <a class="el" href="stringfields_8h_source.html#l00245">ast_string_field_free_memory</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="pbx_8h_source.html#l00078">AST_XML_DOC</a>, <a class="el" href="pbx_8h_source.html#l00092">ast_custom_function::docsrc</a>, and <a class="el" href="pbx_8h_source.html#l00084">ast_custom_function::name</a>.</p>

<p>Referenced by <a class="el" href="func__speex_8c_source.html#l00361">load_module()</a>, <a class="el" href="func__odbc_8c_source.html#l01394">reload()</a>, and <a class="el" href="app__jack_8c_source.html#l01001">unload_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03217"></a>03217 {
<a name="l03218"></a>03218    <span class="keyword">struct </span><a class="code" href="structast__custom__function.html" title="Data structure associated with a custom dialplan function.">ast_custom_function</a> *cur;
<a name="l03219"></a>03219 
<a name="l03220"></a>03220    <span class="keywordflow">if</span> (!acf) {
<a name="l03221"></a>03221       <span class="keywordflow">return</span> -1;
<a name="l03222"></a>03222    }
<a name="l03223"></a>03223 
<a name="l03224"></a>03224    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structacf__root.html">acf_root</a>);
<a name="l03225"></a>03225    <span class="keywordflow">if</span> ((cur = <a class="code" href="linkedlists_8h.html#a6091f0518f8b6f443fd9f5150f3ac407">AST_RWLIST_REMOVE</a>(&amp;<a class="code" href="structacf__root.html">acf_root</a>, acf, <a class="code" href="structast__custom__function.html#afdf1f4a1680938ef9b90fbe3ecafbca4">acflist</a>))) {
<a name="l03226"></a>03226       <span class="keywordflow">if</span> (cur-&gt;<a class="code" href="structast__custom__function.html#aa871ca3c361d229d4e37edf3c6016cc1">docsrc</a> == <a class="code" href="pbx_8h.html#a8717a951656993c40bd851ebf50f58e3a24212840b7b1b0e9c1eebc8cfd89ab3e">AST_XML_DOC</a>) {
<a name="l03227"></a>03227          <a class="code" href="stringfields_8h.html#abf60f862ae6a141d2f86a0f5e82792de" title="free all memory - to be called before destroying the object">ast_string_field_free_memory</a>(acf);
<a name="l03228"></a>03228       }
<a name="l03229"></a>03229       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Unregistered custom function %s\n&quot;</span>, cur-&gt;<a class="code" href="structast__custom__function.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);
<a name="l03230"></a>03230    }
<a name="l03231"></a>03231    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structacf__root.html">acf_root</a>);
<a name="l03232"></a>03232 
<a name="l03233"></a>03233    <span class="keywordflow">return</span> cur ? 0 : -1;
<a name="l03234"></a>03234 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2bc52adc4f80137db9161ed499f82a00"></a><!-- doxytag: member="pbx.h::ast_destroy_timing" ref="a2bc52adc4f80137db9161ed499f82a00" args="(struct ast_timing *i)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_destroy_timing </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__timing.html">ast_timing</a> *&nbsp;</td>
          <td class="paramname"> <em>i</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Deallocates memory structures associated with a timing bitmap. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>i</em>&nbsp;</td><td>Pointer to an <a class="el" href="structast__timing.html">ast_timing</a> structure. </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>non-zero</em>&nbsp;</td><td>failure (<a class="el" href="structnumber.html" title="Number structure.">number</a> suitable to pass to </td></tr>
  </table>
  </dd>
</dl>
<dl class="see"><dt><b>See also:</b></dt><dd>strerror) </dd></dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l07017">7017</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, and <a class="el" href="pbx_8h_source.html#l00121">ast_timing::timezone</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l07032">ast_context_add_include2()</a>, <a class="el" href="pbx_8c_source.html#l04709">ast_context_remove_include2()</a>, <a class="el" href="func__logic_8c_source.html#l00130">iftime()</a>, <a class="el" href="pbx_8c_source.html#l08659">pbx_builtin_execiftime()</a>, and <a class="el" href="pbx_8c_source.html#l08624">pbx_builtin_gotoiftime()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l07018"></a>07018 {
<a name="l07019"></a>07019    <span class="keywordflow">if</span> (i-&gt;<a class="code" href="structast__timing.html#a18b6f7534e9068b65611571b05db0eee">timezone</a>) {
<a name="l07020"></a>07020       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(i-&gt;<a class="code" href="structast__timing.html#a18b6f7534e9068b65611571b05db0eee">timezone</a>);
<a name="l07021"></a>07021       i-&gt;<a class="code" href="structast__timing.html#a18b6f7534e9068b65611571b05db0eee">timezone</a> = NULL;
<a name="l07022"></a>07022    }
<a name="l07023"></a>07023    <span class="keywordflow">return</span> 0;
<a name="l07024"></a>07024 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3aa0b9f1691104cb6214ba66c5dc3a30"></a><!-- doxytag: member="pbx.h::ast_devstate_to_extenstate" ref="a3aa0b9f1691104cb6214ba66c5dc3a30" args="(enum ast_device_state devstate)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625f">ast_extension_states</a> ast_devstate_to_extenstate </td>
          <td>(</td>
          <td class="paramtype">enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a>&nbsp;</td>
          <td class="paramname"> <em>devstate</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Map devstate to an <a class="el" href="structextension.html">extension</a> <a class="el" href="structstate.html">state</a>. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>device</em>&nbsp;</td><td><a class="el" href="structstate.html">state</a></td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>the <a class="el" href="structextension.html">extension</a> <a class="el" href="structstate.html">state</a> mapping. </dd></dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l03770">3770</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="devicestate_8h_source.html#l00055">AST_DEVICE_BUSY</a>, <a class="el" href="devicestate_8h_source.html#l00054">AST_DEVICE_INUSE</a>, <a class="el" href="devicestate_8h_source.html#l00056">AST_DEVICE_INVALID</a>, <a class="el" href="devicestate_8h_source.html#l00053">AST_DEVICE_NOT_INUSE</a>, <a class="el" href="devicestate_8h_source.html#l00060">AST_DEVICE_ONHOLD</a>, <a class="el" href="devicestate_8h_source.html#l00058">AST_DEVICE_RINGING</a>, <a class="el" href="devicestate_8h_source.html#l00059">AST_DEVICE_RINGINUSE</a>, <a class="el" href="devicestate_8h_source.html#l00061">AST_DEVICE_TOTAL</a>, <a class="el" href="devicestate_8h_source.html#l00057">AST_DEVICE_UNAVAILABLE</a>, <a class="el" href="devicestate_8h_source.html#l00052">AST_DEVICE_UNKNOWN</a>, <a class="el" href="pbx_8h_source.html#l00060">AST_EXTENSION_BUSY</a>, <a class="el" href="pbx_8h_source.html#l00059">AST_EXTENSION_INUSE</a>, <a class="el" href="pbx_8h_source.html#l00058">AST_EXTENSION_NOT_INUSE</a>, <a class="el" href="pbx_8h_source.html#l00063">AST_EXTENSION_ONHOLD</a>, <a class="el" href="pbx_8h_source.html#l00062">AST_EXTENSION_RINGING</a>, and <a class="el" href="pbx_8h_source.html#l00061">AST_EXTENSION_UNAVAILABLE</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l03797">ast_extension_state2()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03771"></a>03771 {
<a name="l03772"></a>03772    <span class="keywordflow">switch</span> (devstate) {
<a name="l03773"></a>03773    <span class="keywordflow">case</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea6b7416bea92d3bc5ee8e36f0a484cdc1">AST_DEVICE_ONHOLD</a>:
<a name="l03774"></a>03774       <span class="keywordflow">return</span> <a class="code" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa83180bb058ded006c01229431fc887f9">AST_EXTENSION_ONHOLD</a>;
<a name="l03775"></a>03775    <span class="keywordflow">case</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeab43afabf5bcd4ad1f531ad78c48ccb6f">AST_DEVICE_BUSY</a>:
<a name="l03776"></a>03776       <span class="keywordflow">return</span> <a class="code" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fad62d357f0ccde2a718c374a0a4af2b98">AST_EXTENSION_BUSY</a>;
<a name="l03777"></a>03777    <span class="keywordflow">case</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeafac147cbabf3ccb80e50e86027710549">AST_DEVICE_UNAVAILABLE</a>:
<a name="l03778"></a>03778    <span class="keywordflow">case</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea41983b6678528bfcdf919b24d6e08d9a">AST_DEVICE_UNKNOWN</a>:
<a name="l03779"></a>03779    <span class="keywordflow">case</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea9c008e1d20858cbc3275c157e02ebc94">AST_DEVICE_INVALID</a>:
<a name="l03780"></a>03780       <span class="keywordflow">return</span> <a class="code" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa5820eb407f3a3dbc5046c97ad43ee1f3">AST_EXTENSION_UNAVAILABLE</a>;
<a name="l03781"></a>03781    <span class="keywordflow">case</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea17b87dfa3f4de5909b401017e229091d">AST_DEVICE_RINGINUSE</a>:
<a name="l03782"></a>03782       <span class="keywordflow">return</span> (<a class="code" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa47e9214860b5f9b887945f7cd1baec1a">AST_EXTENSION_INUSE</a> | <a class="code" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa4063bf4e94e14df04126be6f08cc7bfc">AST_EXTENSION_RINGING</a>);
<a name="l03783"></a>03783    <span class="keywordflow">case</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea76d91d5d654cfa3edafb2afbe3e09b46">AST_DEVICE_RINGING</a>:
<a name="l03784"></a>03784       <span class="keywordflow">return</span> <a class="code" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa4063bf4e94e14df04126be6f08cc7bfc">AST_EXTENSION_RINGING</a>;
<a name="l03785"></a>03785    <span class="keywordflow">case</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea23aa227468c09b5ebd0fb01b4c895190">AST_DEVICE_INUSE</a>:
<a name="l03786"></a>03786       <span class="keywordflow">return</span> <a class="code" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa47e9214860b5f9b887945f7cd1baec1a">AST_EXTENSION_INUSE</a>;
<a name="l03787"></a>03787    <span class="keywordflow">case</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeadee91fc4886ffc7b4efb8459cef48fe2">AST_DEVICE_NOT_INUSE</a>:
<a name="l03788"></a>03788       <span class="keywordflow">return</span> <a class="code" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa435abb1e907b1cee83ec44d2d77866e6">AST_EXTENSION_NOT_INUSE</a>;
<a name="l03789"></a>03789    <span class="keywordflow">case</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeaf790c1f212837af8d2db5193228102d7">AST_DEVICE_TOTAL</a>: <span class="comment">/* not a device state, included for completeness */</span>
<a name="l03790"></a>03790       <span class="keywordflow">break</span>;
<a name="l03791"></a>03791    }
<a name="l03792"></a>03792 
<a name="l03793"></a>03793    <span class="keywordflow">return</span> <a class="code" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa435abb1e907b1cee83ec44d2d77866e6">AST_EXTENSION_NOT_INUSE</a>;
<a name="l03794"></a>03794 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a64a5b8fdc919806135ad427aca9e71b7"></a><!-- doxytag: member="pbx.h::ast_exists_extension" ref="a64a5b8fdc919806135ad427aca9e71b7" args="(struct ast_channel *c, const char *context, const char *exten, int priority, const char *callerid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_exists_extension </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>exten</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>priority</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>callerid</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Determine whether an <a class="el" href="structextension.html">extension</a> exists. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>c</em>&nbsp;</td><td>this is not important </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>context</em>&nbsp;</td><td>which context to look in </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>exten</em>&nbsp;</td><td>which <a class="el" href="structextension.html">extension</a> to search for </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>priority</em>&nbsp;</td><td>priority of the action within the <a class="el" href="structextension.html">extension</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>callerid</em>&nbsp;</td><td>callerid to search for</td></tr>
  </table>
  </dd>
</dl>
<dl class="note"><dt><b>Note:</b></dt><dd>It is possible for autoservice to be started and stopped on c during this function call, it is important that c is not locked prior to calling this. Otherwise a deadlock may occur</dd></dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>If an <a class="el" href="structextension.html">extension</a> within the given context(or callerid) with the given priority is found a non zero value will be returned. Otherwise, 0 is returned. </dd></dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l04143">4143</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="extconf_8h_source.html#l00218">E_MATCH</a>, and <a class="el" href="pbx_8c_source.html#l03647">pbx_extension_helper()</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l09551">__ast_goto_if_exists()</a>, <a class="el" href="pbx_8c_source.html#l04214">__ast_pbx_run()</a>, <a class="el" href="app__macro_8c_source.html#l00219">_macro_exec()</a>, <a class="el" href="app__readexten_8c_source.html#l00263">acf_isexten_exec()</a>, <a class="el" href="chan__h323_8c_source.html#l02220">answer_call()</a>, <a class="el" href="app_8c_source.html#l00076">ast_app_dtget()</a>, <a class="el" href="features_8c_source.html#l02441">ast_bridge_call()</a>, <a class="el" href="pbx_8c_source.html#l07940">ast_pbx_outgoing_exten()</a>, <a class="el" href="features_8c_source.html#l01396">builtin_atxfer()</a>, <a class="el" href="features_8c_source.html#l01265">builtin_blindtransfer()</a>, <a class="el" href="chan__misdn_8c_source.html#l04379">cb_events()</a>, <a class="el" href="chan__console_8c_source.html#l00768">cli_console_dial()</a>, <a class="el" href="app__meetme_8c_source.html#l01998">conf_run()</a>, <a class="el" href="chan__alsa_8c_source.html#l00779">console_dial()</a>, <a class="el" href="chan__oss_8c_source.html#l01153">console_transfer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05607">dahdi_handle_dtmfup()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="app__disa_8c_source.html#l00143">disa_exec()</a>, <a class="el" href="chan__iax2_8c_source.html#l08855">dp_lookup()</a>, <a class="el" href="pbx__dundi_8c_source.html#l00561">dundi_lookup_local()</a>, <a class="el" href="chan__sip_8c_source.html#l13667">get_also_info()</a>, <a class="el" href="chan__sip_8c_source.html#l13269">get_destination()</a>, <a class="el" href="chan__sip_8c_source.html#l13489">get_refer_info()</a>, <a class="el" href="app__stack_8c_source.html#l00328">gosub_exec()</a>, <a class="el" href="app__stack_8c_source.html#l00550">handle_gosub()</a>, <a class="el" href="app__rpt_8c_source.html#l06676">handle_link_data()</a>, <a class="el" href="app__rpt_8c_source.html#l07021">handle_link_phone_dtmf()</a>, <a class="el" href="chan__skinny_8c_source.html#l04699">handle_stimulus_message()</a>, <a class="el" href="func__dialplan_8c_source.html#l00053">isexten_function_read()</a>, <a class="el" href="app__voicemail_8c_source.html#l05141">leave_voicemail()</a>, <a class="el" href="chan__local_8c_source.html#l00670">local_alloc()</a>, <a class="el" href="chan__local_8c_source.html#l00518">local_call()</a>, <a class="el" href="chan__local_8c_source.html#l00128">local_devicestate()</a>, <a class="el" href="app__rpt_8c_source.html#l10410">local_dtmf_helper()</a>, <a class="el" href="pbx__loopback_8c_source.html#l00126">loopback_exists()</a>, <a class="el" href="features_8c_source.html#l00519">metermaidstate()</a>, <a class="el" href="chan__mgcp_8c_source.html#l02637">mgcp_ss()</a>, <a class="el" href="app__minivm_8c_source.html#l01971">minivm_greet_exec()</a>, <a class="el" href="chan__misdn_8c_source.html#l00846">misdn_overlap_dial_task()</a>, <a class="el" href="features_8c_source.html#l00566">park_space_reserve()</a>, <a class="el" href="app__parkandannounce_8c_source.html#l00088">parkandannounce_exec()</a>, <a class="el" href="pbx_8c_source.html#l08729">pbx_builtin_waitexten()</a>, <a class="el" href="chan__phone_8c_source.html#l00919">phone_check_exception()</a>, <a class="el" href="app__privacy_8c_source.html#l00083">privacy_exec()</a>, <a class="el" href="chan__misdn_8c_source.html#l02961">process_ast_dsp()</a>, <a class="el" href="app__readexten_8c_source.html#l00128">readexten_exec()</a>, <a class="el" href="chan__iax2_8c_source.html#l08216">register_peer_exten()</a>, <a class="el" href="app__rpt_8c_source.html#l13122">rpt_exec()</a>, <a class="el" href="pbx_8c_source.html#l05772">show_debug_helper()</a>, <a class="el" href="chan__sip_8c_source.html#l07045">sip_read()</a>, <a class="el" href="chan__skinny_8c_source.html#l03619">skinny_ss()</a>, <a class="el" href="chan__iax2_8c_source.html#l09458">socket_process()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>, and <a class="el" href="file_8c_source.html#l01168">waitstream_core()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04144"></a>04144 {
<a name="l04145"></a>04145    <span class="keywordflow">return</span> <a class="code" href="pbx_8c.html#ae381d99bea85b43f022470b64171018d" title="The return value depends on the action:.">pbx_extension_helper</a>(c, NULL, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, priority, NULL, callerid, <a class="code" href="extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea2e605157e82dec388ffc89c1694fb7be">E_MATCH</a>, 0, 0);
<a name="l04146"></a>04146 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9f840db4b5ef461ac2c0c975a57c9e89"></a><!-- doxytag: member="pbx.h::ast_explicit_goto" ref="a9f840db4b5ef461ac2c0c975a57c9e89" args="(struct ast_channel *chan, const char *context, const char *exten, int priority)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_explicit_goto </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>exten</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>priority</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl class="note"><dt><b>Note:</b></dt><dd>This function will handle locking the channel as needed. </dd></dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l07321">7321</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="channel_8h_source.html#l00541">AST_FLAG_IN_AUTOLOOP</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="channel_8h_source.html#l00503">ast_channel::context</a>, <a class="el" href="channel_8h_source.html#l00504">ast_channel::exten</a>, and <a class="el" href="channel_8h_source.html#l00471">ast_channel::priority</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l09551">__ast_goto_if_exists()</a>, <a class="el" href="pbx_8c_source.html#l07344">ast_async_goto()</a>, <a class="el" href="features_8c_source.html#l01396">builtin_atxfer()</a>, <a class="el" href="app__disa_8c_source.html#l00143">disa_exec()</a>, <a class="el" href="features_8c_source.html#l04126">do_bridge_masquerade()</a>, <a class="el" href="res__agi_8c_source.html#l01477">handle_setpriority()</a>, <a class="el" href="pbx_8c_source.html#l09580">pbx_parseable_goto()</a>, and <a class="el" href="app__stack_8c_source.html#l00294">return_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l07322"></a>07322 {
<a name="l07323"></a>07323    <span class="keywordflow">if</span> (!chan)
<a name="l07324"></a>07324       <span class="keywordflow">return</span> -1;
<a name="l07325"></a>07325 
<a name="l07326"></a>07326    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l07327"></a>07327 
<a name="l07328"></a>07328    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>))
<a name="l07329"></a>07329       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(chan-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <span class="keyword">sizeof</span>(chan-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>));
<a name="l07330"></a>07330    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>))
<a name="l07331"></a>07331       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(chan-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>, <a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, <span class="keyword">sizeof</span>(chan-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>));
<a name="l07332"></a>07332    <span class="keywordflow">if</span> (priority &gt; -1) {
<a name="l07333"></a>07333       chan-&gt;<a class="code" href="structast__channel.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> = priority;
<a name="l07334"></a>07334       <span class="comment">/* see flag description in channel.h for explanation */</span>
<a name="l07335"></a>07335       <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(chan, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a5ff4f7a94a36fcc2b8628186cb643d4b">AST_FLAG_IN_AUTOLOOP</a>))
<a name="l07336"></a>07336          chan-&gt;<a class="code" href="structast__channel.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>--;
<a name="l07337"></a>07337    }
<a name="l07338"></a>07338 
<a name="l07339"></a>07339    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l07340"></a>07340 
<a name="l07341"></a>07341    <span class="keywordflow">return</span> 0;
<a name="l07342"></a>07342 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a83192a0099558f6a539fdb4e065ff99d"></a><!-- doxytag: member="pbx.h::ast_extension_close" ref="a83192a0099558f6a539fdb4e065ff99d" args="(const char *pattern, const char *data, int needmore)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_extension_close </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>pattern</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>needmore</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8c_source.html#l02407">2407</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="extconf_8h_source.html#l00217">E_CANMATCH</a>, <a class="el" href="extconf_8h_source.html#l00216">E_MATCHMORE</a>, <a class="el" href="pbx_8c_source.html#l02389">extension_match_core()</a>, and <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>.</p>

<p>Referenced by <a class="el" href="pbx__lua_8c_source.html#l01285">lua_find_extension()</a>, and <a class="el" href="pbx__realtime_8c_source.html#l00079">realtime_switch_common()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02408"></a>02408 {
<a name="l02409"></a>02409    <span class="keywordflow">if</span> (needmore != <a class="code" href="extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7e20dcb277877b81e8099470cd631277">E_MATCHMORE</a> &amp;&amp; needmore != <a class="code" href="extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea413c09377a892aa154e7669cbdaf27ba">E_CANMATCH</a>)
<a name="l02410"></a>02410       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;invalid argument %d\n&quot;</span>, needmore);
<a name="l02411"></a>02411    <span class="keywordflow">return</span> <a class="code" href="pbx_8c.html#aef34845bd9203c43797706dc4edc05d7">extension_match_core</a>(pattern, data, needmore);
<a name="l02412"></a>02412 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa9130cb982e3e236c465136e0637cfaa"></a><!-- doxytag: member="pbx.h::ast_extension_cmp" ref="aa9130cb982e3e236c465136e0637cfaa" args="(const char *a, const char *b)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_extension_cmp </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>b</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Determine if one <a class="el" href="structextension.html">extension</a> should match before another. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>a</em>&nbsp;</td><td><a class="el" href="structextension.html">extension</a> to compare with b </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>b</em>&nbsp;</td><td><a class="el" href="structextension.html">extension</a> to compare with a</td></tr>
  </table>
  </dd>
</dl>
<p>Checks whether or <a class="el" href="structextension.html">extension</a> a should match before <a class="el" href="structextension.html">extension</a> b</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if the two extensions have equal matching priority </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>1</em>&nbsp;</td><td>on a &gt; b </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on a &lt; b </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l02209">2209</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l02176">ext_cmp()</a>.</p>

<p>Referenced by <a class="el" href="pbx__lua_8c_source.html#l00903">lua_extension_cmp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02210"></a>02210 {
<a name="l02211"></a>02211    <span class="keywordflow">return</span> <a class="code" href="pbx_8c.html#a12793cf64a2e55f7b94646b9c8fb2f5d" title="the full routine to compare extensions in rules.">ext_cmp</a>(a, b);
<a name="l02212"></a>02212 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a94cf2f099462a906620b5566871af797"></a><!-- doxytag: member="pbx.h::ast_extension_match" ref="a94cf2f099462a906620b5566871af797" args="(const char *pattern, const char *extension)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_extension_match </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>pattern</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>extension</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Determine if a given <a class="el" href="structextension.html">extension</a> matches a given pattern (in NXX format). </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pattern</em>&nbsp;</td><td>pattern to match </td></tr>
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structextension.html">extension</a></em>&nbsp;</td><td><a class="el" href="structextension.html">extension</a> to check against the pattern.</td></tr>
  </table>
  </dd>
</dl>
<p>Checks whether or not the given <a class="el" href="structextension.html">extension</a> matches the given pattern.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>1</em>&nbsp;</td><td>on match </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l02402">2402</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="extconf_8h_source.html#l00218">E_MATCH</a>, and <a class="el" href="pbx_8c_source.html#l02389">extension_match_core()</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l07267">ast_ignore_pattern()</a>, <a class="el" href="app__playback_8c_source.html#l00162">do_say()</a>, <a class="el" href="app__macro_8c_source.html#l00184">find_matching_priority()</a>, <a class="el" href="app__playback_8c_source.html#l00531">load_module()</a>, <a class="el" href="pbx__loopback_8c_source.html#l00135">loopback_canmatch()</a>, <a class="el" href="pbx__loopback_8c_source.html#l00126">loopback_exists()</a>, <a class="el" href="pbx__loopback_8c_source.html#l00152">loopback_matchmore()</a>, <a class="el" href="pbx__lua_8c_source.html#l01285">lua_find_extension()</a>, <a class="el" href="pbx_8c_source.html#l05957">manager_show_dialplan_helper()</a>, <a class="el" href="pbx_8c_source.html#l02457">matchcid()</a>, <a class="el" href="misdn__config_8c_source.html#l00649">misdn_cfg_is_msn_valid()</a>, <a class="el" href="pbx__realtime_8c_source.html#l00079">realtime_switch_common()</a>, <a class="el" href="app__playback_8c_source.html#l00482">reload()</a>, and <a class="el" href="pbx_8c_source.html#l05621">show_dialplan_helper()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02403"></a>02403 {
<a name="l02404"></a>02404    <span class="keywordflow">return</span> <a class="code" href="pbx_8c.html#aef34845bd9203c43797706dc4edc05d7">extension_match_core</a>(pattern, data, <a class="code" href="extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea2e605157e82dec388ffc89c1694fb7be">E_MATCH</a>);
<a name="l02405"></a>02405 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="adf9249eff9d5037968d55e11de1dce5f"></a><!-- doxytag: member="pbx.h::ast_extension_patmatch" ref="adf9249eff9d5037968d55e11de1dce5f" args="(const char *pattern, const char *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_extension_patmatch </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>pattern</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="aed6cfe76441ef995ab80609020a9990c"></a><!-- doxytag: member="pbx.h::ast_extension_state" ref="aed6cfe76441ef995ab80609020a9990c" args="(struct ast_channel *c, const char *context, const char *exten)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_extension_state </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>exten</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Uses hint and devicestate callback to get the <a class="el" href="structstate.html">state</a> of an <a class="el" href="structextension.html">extension</a>. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>c</em>&nbsp;</td><td>this is not important </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>context</em>&nbsp;</td><td>which context to look in </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>exten</em>&nbsp;</td><td>which <a class="el" href="structextension.html">extension</a> to get <a class="el" href="structstate.html">state</a></td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd><a class="el" href="structextension.html">extension</a> <a class="el" href="structstate.html">state</a> as defined in the ast_extension_states enum </dd></dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l03832">3832</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l03797">ast_extension_state2()</a>, and <a class="el" href="pbx_8c_source.html#l03761">ast_hint_extension()</a>.</p>

<p>Referenced by <a class="el" href="manager_8c_source.html#l02590">action_extensionstate()</a>, <a class="el" href="func__extstate_8c_source.html#l00096">extstate_read()</a>, and <a class="el" href="chan__sip_8c_source.html#l21175">handle_request_subscribe()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03833"></a>03833 {
<a name="l03834"></a>03834    <span class="keyword">struct </span><a class="code" href="structast__exten.html" title="ast_exten: An extension The dialplan is saved as a linked list with each context...">ast_exten</a> *e;
<a name="l03835"></a>03835 
<a name="l03836"></a>03836    <span class="keywordflow">if</span> (!(e = <a class="code" href="pbx_8c.html#a666d27d15c01c2b36dd8523a0146ba40">ast_hint_extension</a>(c, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>))) {  <span class="comment">/* Do we have a hint for this extension ? */</span>
<a name="l03837"></a>03837       <span class="keywordflow">return</span> -1;                   <span class="comment">/* No hint, return -1 */</span>
<a name="l03838"></a>03838    }
<a name="l03839"></a>03839 
<a name="l03840"></a>03840    <span class="keywordflow">return</span> <a class="code" href="pbx_8c.html#a1ffd31790fbd06b1fcf1b44fd1333034" title="Check state of extension by using hints.">ast_extension_state2</a>(e);  <span class="comment">/* Check all devices in the hint */</span>
<a name="l03841"></a>03841 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3261603753916b98888a5a5fc1d505c3"></a><!-- doxytag: member="pbx.h::ast_extension_state2str" ref="a3261603753916b98888a5a5fc1d505c3" args="(int extension_state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* ast_extension_state2str </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>extension_state</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Return string representation of the <a class="el" href="structstate.html">state</a> of an <a class="el" href="structextension.html">extension</a>. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>extension_state</em>&nbsp;</td><td>is the numerical <a class="el" href="structstate.html">state</a> delivered by ast_extension_state</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>the <a class="el" href="structstate.html">state</a> of an <a class="el" href="structextension.html">extension</a> as string </dd></dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l03820">3820</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="pbx_8c.html#a56ab82243e18b6c036a9bb41725dd549">extension_states</a>, and <a class="el" href="pbx_8c_source.html#l00894">cfextension_states::text</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l12781">cb_extensionstate()</a>, <a class="el" href="chan__sip_8c_source.html#l21175">handle_request_subscribe()</a>, <a class="el" href="pbx_8c_source.html#l05397">handle_show_hint()</a>, <a class="el" href="pbx_8c_source.html#l05326">handle_show_hints()</a>, and <a class="el" href="chan__sip_8c_source.html#l16189">show_channels_cb()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03821"></a>03821 {
<a name="l03822"></a>03822    <span class="keywordtype">int</span> i;
<a name="l03823"></a>03823 
<a name="l03824"></a>03824    <span class="keywordflow">for</span> (i = 0; (i &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="pbx_8c.html#a56ab82243e18b6c036a9bb41725dd549">extension_states</a>)); i++) {
<a name="l03825"></a>03825       <span class="keywordflow">if</span> (<a class="code" href="pbx_8c.html#a56ab82243e18b6c036a9bb41725dd549">extension_states</a>[i].extension_state == extension_state)
<a name="l03826"></a>03826          <span class="keywordflow">return</span> <a class="code" href="pbx_8c.html#a56ab82243e18b6c036a9bb41725dd549">extension_states</a>[i].<a class="code" href="structcfextension__states.html#aecfd3170c3d94608e5e5c038085fdf3f">text</a>;
<a name="l03827"></a>03827    }
<a name="l03828"></a>03828    <span class="keywordflow">return</span> <span class="stringliteral">&quot;Unknown&quot;</span>;
<a name="l03829"></a>03829 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa3a30d0a841ee2bc0d87af763a99629f"></a><!-- doxytag: member="pbx.h::ast_extension_state_add" ref="aa3a30d0a841ee2bc0d87af763a99629f" args="(const char *context, const char *exten, ast_state_cb_type callback, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_extension_state_add </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>exten</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="pbx_8h.html#aa158b092800168cef19ea3fdd5b47538">ast_state_cb_type</a>&nbsp;</td>
          <td class="paramname"> <em>callback</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Registers a <a class="el" href="structstate.html">state</a> change callback. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>context</em>&nbsp;</td><td>which context to look in </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>exten</em>&nbsp;</td><td>which <a class="el" href="structextension.html">extension</a> to get <a class="el" href="structstate.html">state</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>callback</em>&nbsp;</td><td>callback to call if <a class="el" href="structstate.html">state</a> changed </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>to pass to callback</td></tr>
  </table>
  </dd>
</dl>
<p>The callback is called if the <a class="el" href="structstate.html">state</a> of an <a class="el" href="structextension.html">extension</a> is changed.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ID</em>&nbsp;</td><td>on success </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l03896">3896</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l00776">ast_exten::app</a>, <a class="el" href="pbx_8c_source.html#l07305">ast_add_extension()</a>, <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="utils_8h_source.html#l00415">ast_free_ptr()</a>, <a class="el" href="pbx_8c_source.html#l03761">ast_hint_extension()</a>, <a class="el" href="linkedlists_8h_source.html#l00695">AST_LIST_INSERT_HEAD</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00493">AST_RWLIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="pbx_8c_source.html#l00875">ast_state_cb::callback</a>, <a class="el" href="structast__hint.html#aa3e3352bf7668925eba2e02ccdaf017a">ast_hint::callbacks</a>, <a class="el" href="pbx_8c_source.html#l00772">ast_exten::cidmatch</a>, <a class="el" href="pbx_8c_source.html#l00778">ast_exten::data</a>, <a class="el" href="pbx_8c_source.html#l00874">ast_state_cb::data</a>, <a class="el" href="pbx_8c_source.html#l00886">ast_hint::exten</a>, <a class="el" href="pbx_8c_source.html#l00770">ast_exten::exten</a>, <a class="el" href="pbx_8c_source.html#l00873">ast_state_cb::id</a>, <a class="el" href="pbx_8c_source.html#l00774">ast_exten::label</a>, <a class="el" href="pbx_8c_source.html#l00771">ast_exten::matchcid</a>, <a class="el" href="pbx_8c_source.html#l00852">ast_context::name</a>, <a class="el" href="pbx_8c_source.html#l00775">ast_exten::parent</a>, <a class="el" href="pbx_8c_source.html#l00773">ast_exten::priority</a>, <a class="el" href="pbx_8c_source.html#l00783">ast_exten::registrar</a>, and <a class="el" href="pbx_8c_source.html#l01128">stateid</a>.</p>

<p>Referenced by <a class="el" href="manager_8c_source.html#l04061">__init_manager()</a>, <a class="el" href="chan__sip_8c_source.html#l21175">handle_request_subscribe()</a>, and <a class="el" href="chan__skinny_8c_source.html#l01813">skinny_register()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03898"></a>03898 {
<a name="l03899"></a>03899    <span class="keyword">struct </span><a class="code" href="structast__hint.html" title="Structure for dial plan hints.">ast_hint</a> *hint;
<a name="l03900"></a>03900    <span class="keyword">struct </span><a class="code" href="structast__state__cb.html" title="ast_state_cb: An extension state notify register item">ast_state_cb</a> *cblist;
<a name="l03901"></a>03901    <span class="keyword">struct </span><a class="code" href="structast__exten.html" title="ast_exten: An extension The dialplan is saved as a linked list with each context...">ast_exten</a> *e;
<a name="l03902"></a>03902 
<a name="l03903"></a>03903    <span class="comment">/* If there&apos;s no context and extension:  add callback to statecbs list */</span>
<a name="l03904"></a>03904    <span class="keywordflow">if</span> (!<a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a> &amp;&amp; !<a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>) {
<a name="l03905"></a>03905       <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structhints.html">hints</a>);
<a name="l03906"></a>03906 
<a name="l03907"></a>03907       <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="structstatecbs.html">statecbs</a>, cblist, entry) {
<a name="l03908"></a>03908          <span class="keywordflow">if</span> (cblist-&gt;<a class="code" href="structast__state__cb.html#a51f35e8871a0e589626a6c24024a2e17">callback</a> == callback) {
<a name="l03909"></a>03909             cblist-&gt;<a class="code" href="structast__state__cb.html#a735984d41155bc1032e09bece8f8d66d">data</a> = <a class="code" href="structast__exten.html#a735984d41155bc1032e09bece8f8d66d">data</a>;
<a name="l03910"></a>03910             <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structhints.html">hints</a>);
<a name="l03911"></a>03911             <span class="keywordflow">return</span> 0;
<a name="l03912"></a>03912          }
<a name="l03913"></a>03913       }
<a name="l03914"></a>03914 
<a name="l03915"></a>03915       <span class="comment">/* Now insert the callback */</span>
<a name="l03916"></a>03916       <span class="keywordflow">if</span> (!(cblist = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*cblist)))) {
<a name="l03917"></a>03917          <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structhints.html">hints</a>);
<a name="l03918"></a>03918          <span class="keywordflow">return</span> -1;
<a name="l03919"></a>03919       }
<a name="l03920"></a>03920       cblist-&gt;<a class="code" href="structast__state__cb.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a> = 0;
<a name="l03921"></a>03921       cblist-&gt;<a class="code" href="structast__state__cb.html#a51f35e8871a0e589626a6c24024a2e17">callback</a> = callback;
<a name="l03922"></a>03922       cblist-&gt;<a class="code" href="structast__state__cb.html#a735984d41155bc1032e09bece8f8d66d">data</a> = <a class="code" href="structast__exten.html#a735984d41155bc1032e09bece8f8d66d">data</a>;
<a name="l03923"></a>03923 
<a name="l03924"></a>03924       <a class="code" href="linkedlists_8h.html#aa2ded2af046bb513f77056c27c083307" title="Inserts a list entry at the head of a list.">AST_LIST_INSERT_HEAD</a>(&amp;<a class="code" href="structstatecbs.html">statecbs</a>, cblist, entry);
<a name="l03925"></a>03925 
<a name="l03926"></a>03926       <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structhints.html">hints</a>);
<a name="l03927"></a>03927 
<a name="l03928"></a>03928       <span class="keywordflow">return</span> 0;
<a name="l03929"></a>03929    }
<a name="l03930"></a>03930 
<a name="l03931"></a>03931    <span class="keywordflow">if</span> (!<a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a> || !<a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>)
<a name="l03932"></a>03932       <span class="keywordflow">return</span> -1;
<a name="l03933"></a>03933 
<a name="l03934"></a>03934    <span class="comment">/* This callback type is for only one hint, so get the hint */</span>
<a name="l03935"></a>03935    e = <a class="code" href="pbx_8c.html#a666d27d15c01c2b36dd8523a0146ba40">ast_hint_extension</a>(NULL, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>);
<a name="l03936"></a>03936    <span class="keywordflow">if</span> (!e) {
<a name="l03937"></a>03937       <span class="keywordflow">return</span> -1;
<a name="l03938"></a>03938    }
<a name="l03939"></a>03939 
<a name="l03940"></a>03940    <span class="comment">/* If this is a pattern, dynamically create a new extension for this</span>
<a name="l03941"></a>03941 <span class="comment">    * particular match.  Note that this will only happen once for each</span>
<a name="l03942"></a>03942 <span class="comment">    * individual extension, because the pattern will no longer match first.</span>
<a name="l03943"></a>03943 <span class="comment">    */</span>
<a name="l03944"></a>03944    <span class="keywordflow">if</span> (e-&gt;<a class="code" href="structast__exten.html#a9c2cb8c1611452928af0def998e36335">exten</a>[0] == <span class="charliteral">&apos;_&apos;</span>) {
<a name="l03945"></a>03945       <a class="code" href="pbx_8h.html#a07176e8d314eb68b3b50279fafa11390" title="Add and extension to an extension context.">ast_add_extension</a>(e-&gt;<a class="code" href="structast__exten.html#a7733606f3f625c2782402ba971995641">parent</a>-&gt;<a class="code" href="structast__context.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>, 0, <a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, e-&gt;<a class="code" href="structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>, e-&gt;<a class="code" href="structast__exten.html#ab5fbdb5052858ca8d2538566229fbe64">label</a>,
<a name="l03946"></a>03946          e-&gt;<a class="code" href="structast__exten.html#af0803fced1d4ccfbc6ec4d8577d30525">matchcid</a> ? e-&gt;<a class="code" href="structast__exten.html#aa40e509d3af869c736d2c5e2d67ce97e">cidmatch</a> : NULL, e-&gt;<a class="code" href="structast__exten.html#a83a793edb3d6a3a15f2a7fc99ffe8c90">app</a>, <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(e-&gt;<a class="code" href="structast__exten.html#a735984d41155bc1032e09bece8f8d66d">data</a>), <a class="code" href="utils_8h.html#a4e6aceb50eca868b7c38064c6c1a4789" title="free() wrapper">ast_free_ptr</a>,
<a name="l03947"></a>03947          e-&gt;<a class="code" href="structast__exten.html#aa05090666ce7a4905fe1b56b4fdd3be3">registrar</a>);
<a name="l03948"></a>03948       e = <a class="code" href="pbx_8c.html#a666d27d15c01c2b36dd8523a0146ba40">ast_hint_extension</a>(NULL, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>);
<a name="l03949"></a>03949       <span class="keywordflow">if</span> (!e || e-&gt;<a class="code" href="structast__exten.html#a9c2cb8c1611452928af0def998e36335">exten</a>[0] == <span class="charliteral">&apos;_&apos;</span>) {
<a name="l03950"></a>03950          <span class="keywordflow">return</span> -1;
<a name="l03951"></a>03951       }
<a name="l03952"></a>03952    }
<a name="l03953"></a>03953 
<a name="l03954"></a>03954    <span class="comment">/* Find the hint in the list of hints */</span>
<a name="l03955"></a>03955    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structhints.html">hints</a>);
<a name="l03956"></a>03956 
<a name="l03957"></a>03957    <a class="code" href="linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;<a class="code" href="structhints.html">hints</a>, hint, list) {
<a name="l03958"></a>03958       <span class="keywordflow">if</span> (hint-&gt;<a class="code" href="structast__hint.html#afc8cfd0aed370c037cd78797da3313e7">exten</a> == e)
<a name="l03959"></a>03959          <span class="keywordflow">break</span>;
<a name="l03960"></a>03960    }
<a name="l03961"></a>03961 
<a name="l03962"></a>03962    <span class="keywordflow">if</span> (!hint) {
<a name="l03963"></a>03963       <span class="comment">/* We have no hint, sorry */</span>
<a name="l03964"></a>03964       <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structhints.html">hints</a>);
<a name="l03965"></a>03965       <span class="keywordflow">return</span> -1;
<a name="l03966"></a>03966    }
<a name="l03967"></a>03967 
<a name="l03968"></a>03968    <span class="comment">/* Now insert the callback in the callback list  */</span>
<a name="l03969"></a>03969    <span class="keywordflow">if</span> (!(cblist = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*cblist)))) {
<a name="l03970"></a>03970       <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structhints.html">hints</a>);
<a name="l03971"></a>03971       <span class="keywordflow">return</span> -1;
<a name="l03972"></a>03972    }
<a name="l03973"></a>03973 
<a name="l03974"></a>03974    cblist-&gt;<a class="code" href="structast__state__cb.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a> = <a class="code" href="pbx_8c.html#a70382561daaa758a201b7a711d566e24">stateid</a>++;    <span class="comment">/* Unique ID for this callback */</span>
<a name="l03975"></a>03975    cblist-&gt;<a class="code" href="structast__state__cb.html#a51f35e8871a0e589626a6c24024a2e17">callback</a> = callback;  <span class="comment">/* Pointer to callback routine */</span>
<a name="l03976"></a>03976    cblist-&gt;<a class="code" href="structast__state__cb.html#a735984d41155bc1032e09bece8f8d66d">data</a> = <a class="code" href="structast__exten.html#a735984d41155bc1032e09bece8f8d66d">data</a>;    <span class="comment">/* Data for the callback */</span>
<a name="l03977"></a>03977 
<a name="l03978"></a>03978    <a class="code" href="linkedlists_8h.html#aa2ded2af046bb513f77056c27c083307" title="Inserts a list entry at the head of a list.">AST_LIST_INSERT_HEAD</a>(&amp;hint-&gt;<a class="code" href="structast__hint.html#aa3e3352bf7668925eba2e02ccdaf017a">callbacks</a>, cblist, entry);
<a name="l03979"></a>03979 
<a name="l03980"></a>03980    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structhints.html">hints</a>);
<a name="l03981"></a>03981 
<a name="l03982"></a>03982    <span class="keywordflow">return</span> cblist-&gt;<a class="code" href="structast__state__cb.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a>;
<a name="l03983"></a>03983 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6740b689b39aa1503d1b858daf730873"></a><!-- doxytag: member="pbx.h::ast_extension_state_del" ref="a6740b689b39aa1503d1b858daf730873" args="(int id, ast_state_cb_type callback)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_extension_state_del </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="pbx_8h.html#aa158b092800168cef19ea3fdd5b47538">ast_state_cb_type</a>&nbsp;</td>
          <td class="paramname"> <em>callback</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Deletes a registered <a class="el" href="structstate.html">state</a> change callback by ID. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>id</em>&nbsp;</td><td>of the callback to delete </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>callback</em>&nbsp;</td><td>callback</td></tr>
  </table>
  </dd>
</dl>
<p>Removes the callback from list of callbacks</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l03986">3986</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="linkedlists_8h_source.html#l00553">AST_LIST_REMOVE_CURRENT</a>, <a class="el" href="linkedlists_8h_source.html#l00528">AST_LIST_TRAVERSE_SAFE_BEGIN</a>, <a class="el" href="linkedlists_8h_source.html#l00599">AST_LIST_TRAVERSE_SAFE_END</a>, <a class="el" href="linkedlists_8h_source.html#l00493">AST_RWLIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, <a class="el" href="pbx_8c_source.html#l00875">ast_state_cb::callback</a>, <a class="el" href="structast__hint.html#aa3e3352bf7668925eba2e02ccdaf017a">ast_hint::callbacks</a>, and <a class="el" href="pbx_8c_source.html#l00873">ast_state_cb::id</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l03161">dialog_unlink_all()</a>, <a class="el" href="chan__sip_8c_source.html#l21175">handle_request_subscribe()</a>, and <a class="el" href="chan__skinny_8c_source.html#l01881">skinny_unregister()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03987"></a>03987 {
<a name="l03988"></a>03988    <span class="keyword">struct </span><a class="code" href="structast__state__cb.html" title="ast_state_cb: An extension state notify register item">ast_state_cb</a> *p_cur = NULL;
<a name="l03989"></a>03989    <span class="keywordtype">int</span> ret = -1;
<a name="l03990"></a>03990 
<a name="l03991"></a>03991    <span class="keywordflow">if</span> (!<span class="keywordtype">id</span> &amp;&amp; !<a class="code" href="structast__state__cb.html#a51f35e8871a0e589626a6c24024a2e17">callback</a>)
<a name="l03992"></a>03992       <span class="keywordflow">return</span> -1;
<a name="l03993"></a>03993 
<a name="l03994"></a>03994    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structhints.html">hints</a>);
<a name="l03995"></a>03995 
<a name="l03996"></a>03996    <span class="keywordflow">if</span> (!<span class="keywordtype">id</span>) {  <span class="comment">/* id == 0 is a callback without extension */</span>
<a name="l03997"></a>03997       <a class="code" href="linkedlists_8h.html#aa5be52067bf16bdc7e56ca19b5ba858d" title="Loops safely over (traverses) the entries in a list.">AST_LIST_TRAVERSE_SAFE_BEGIN</a>(&amp;<a class="code" href="structstatecbs.html">statecbs</a>, p_cur, <a class="code" href="structast__state__cb.html#ac7e3475c891c7e7939f57d22444fef9b">entry</a>) {
<a name="l03998"></a>03998          <span class="keywordflow">if</span> (p_cur-&gt;<a class="code" href="structast__state__cb.html#a51f35e8871a0e589626a6c24024a2e17">callback</a> == <a class="code" href="structast__state__cb.html#a51f35e8871a0e589626a6c24024a2e17">callback</a>) {
<a name="l03999"></a>03999             <a class="code" href="linkedlists_8h.html#aa8ac496fa9c717d5afb99a02e1e2760c" title="Removes the current entry from a list during a traversal.">AST_LIST_REMOVE_CURRENT</a>(<a class="code" href="structast__state__cb.html#ac7e3475c891c7e7939f57d22444fef9b">entry</a>);
<a name="l04000"></a>04000             <span class="keywordflow">break</span>;
<a name="l04001"></a>04001          }
<a name="l04002"></a>04002       }
<a name="l04003"></a>04003       <a class="code" href="linkedlists_8h.html#a712c04b4493919a7052399cd30ee8fb9" title="Closes a safe loop traversal block.">AST_LIST_TRAVERSE_SAFE_END</a>;
<a name="l04004"></a>04004    } <span class="keywordflow">else</span> { <span class="comment">/* callback with extension, find the callback based on ID */</span>
<a name="l04005"></a>04005       <span class="keyword">struct </span><a class="code" href="structast__hint.html" title="Structure for dial plan hints.">ast_hint</a> *hint;
<a name="l04006"></a>04006       <a class="code" href="linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;<a class="code" href="structhints.html">hints</a>, hint, <a class="code" href="structast__hint.html#a84f278845899948faaf9d0c1af3908c1">list</a>) {
<a name="l04007"></a>04007          <a class="code" href="linkedlists_8h.html#aa5be52067bf16bdc7e56ca19b5ba858d" title="Loops safely over (traverses) the entries in a list.">AST_LIST_TRAVERSE_SAFE_BEGIN</a>(&amp;hint-&gt;<a class="code" href="structast__hint.html#aa3e3352bf7668925eba2e02ccdaf017a">callbacks</a>, p_cur, entry) {
<a name="l04008"></a>04008             <span class="keywordflow">if</span> (p_cur-&gt;<a class="code" href="structast__state__cb.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a> == <span class="keywordtype">id</span>) {
<a name="l04009"></a>04009                <a class="code" href="linkedlists_8h.html#aa8ac496fa9c717d5afb99a02e1e2760c" title="Removes the current entry from a list during a traversal.">AST_LIST_REMOVE_CURRENT</a>(entry);
<a name="l04010"></a>04010                <span class="keywordflow">break</span>;
<a name="l04011"></a>04011             }
<a name="l04012"></a>04012          }
<a name="l04013"></a>04013          <a class="code" href="linkedlists_8h.html#a712c04b4493919a7052399cd30ee8fb9" title="Closes a safe loop traversal block.">AST_LIST_TRAVERSE_SAFE_END</a>;
<a name="l04014"></a>04014 
<a name="l04015"></a>04015          <span class="keywordflow">if</span> (p_cur)
<a name="l04016"></a>04016             <span class="keywordflow">break</span>;
<a name="l04017"></a>04017       }
<a name="l04018"></a>04018    }
<a name="l04019"></a>04019 
<a name="l04020"></a>04020    <span class="keywordflow">if</span> (p_cur) {
<a name="l04021"></a>04021       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(p_cur);
<a name="l04022"></a>04022    }
<a name="l04023"></a>04023 
<a name="l04024"></a>04024    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structhints.html">hints</a>);
<a name="l04025"></a>04025 
<a name="l04026"></a>04026    <span class="keywordflow">return</span> ret;
<a name="l04027"></a>04027 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0be9518646cf9aca4878b313cc02e901"></a><!-- doxytag: member="pbx.h::ast_findlabel_extension" ref="a0be9518646cf9aca4878b313cc02e901" args="(struct ast_channel *c, const char *context, const char *exten, const char *label, const char *callerid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_findlabel_extension </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>exten</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>label</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>callerid</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Find the priority of an <a class="el" href="structextension.html">extension</a> that has the specified label. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>c</em>&nbsp;</td><td>this is not important </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>context</em>&nbsp;</td><td>which context to look in </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>exten</em>&nbsp;</td><td>which <a class="el" href="structextension.html">extension</a> to search for </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>label</em>&nbsp;</td><td>label of the action within the <a class="el" href="structextension.html">extension</a> to match to priority </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>callerid</em>&nbsp;</td><td>callerid to search for</td></tr>
  </table>
  </dd>
</dl>
<dl class="note"><dt><b>Note:</b></dt><dd>It is possible for autoservice to be started and stopped on c during this function call, it is important that c is not locked prior to calling this. Otherwise a deadlock may occur</dd></dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>the</em>&nbsp;</td><td>priority which matches the given label in the <a class="el" href="structextension.html">extension</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>if not found. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l04148">4148</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="extconf_8h_source.html#l00221">E_FINDLABEL</a>, and <a class="el" href="pbx_8c_source.html#l03647">pbx_extension_helper()</a>.</p>

<p>Referenced by <a class="el" href="manager_8c_source.html#l02392">action_originate()</a>, <a class="el" href="manager_8c_source.html#l02084">action_redirect()</a>, <a class="el" href="app__stack_8c_source.html#l00550">handle_gosub()</a>, <a class="el" href="res__agi_8c_source.html#l01477">handle_setpriority()</a>, <a class="el" href="func__dialplan_8c_source.html#l00053">isexten_function_read()</a>, and <a class="el" href="pbx_8c_source.html#l09580">pbx_parseable_goto()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04149"></a>04149 {
<a name="l04150"></a>04150    <span class="keywordflow">return</span> <a class="code" href="pbx_8c.html#ae381d99bea85b43f022470b64171018d" title="The return value depends on the action:.">pbx_extension_helper</a>(c, NULL, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, 0, label, callerid, <a class="code" href="extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7b10ab7b3dd6af9d933dbb03dd183eb5">E_FINDLABEL</a>, 0, 0);
<a name="l04151"></a>04151 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa3c47773f118e7775a5c052dbb4bb3aa"></a><!-- doxytag: member="pbx.h::ast_findlabel_extension2" ref="aa3c47773f118e7775a5c052dbb4bb3aa" args="(struct ast_channel *c, struct ast_context *con, const char *exten, const char *label, const char *callerid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_findlabel_extension2 </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__context.html">ast_context</a> *&nbsp;</td>
          <td class="paramname"> <em>con</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>exten</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>label</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>callerid</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Find the priority of an <a class="el" href="structextension.html">extension</a> that has the specified label. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>It is possible for autoservice to be started and stopped on c during this function call, it is important that c is not locked prior to calling this. Otherwise a deadlock may occur</dd>
<dd>
This function is the same as ast_findlabel_extension, except that it accepts a pointer to an <a class="el" href="structast__context.html" title="ast_context: An extension context">ast_context</a> structure to specify the context instead of the name of the context. Otherwise, the functions behave the same. </dd></dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l04153">4153</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="extconf_8h_source.html#l00221">E_FINDLABEL</a>, and <a class="el" href="pbx_8c_source.html#l03647">pbx_extension_helper()</a>.</p>

<p>Referenced by <a class="el" href="pbx__config_8c_source.html#l01367">pbx_load_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04154"></a>04154 {
<a name="l04155"></a>04155    <span class="keywordflow">return</span> <a class="code" href="pbx_8c.html#ae381d99bea85b43f022470b64171018d" title="The return value depends on the action:.">pbx_extension_helper</a>(c, con, NULL, <a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, 0, label, callerid, <a class="code" href="extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7b10ab7b3dd6af9d933dbb03dd183eb5">E_FINDLABEL</a>, 0, 0);
<a name="l04156"></a>04156 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa4e9618aa036a586af7d7663afd9b507"></a><!-- doxytag: member="pbx.h::ast_func_read" ref="aa4e9618aa036a586af7d7663afd9b507" args="(struct ast_channel *chan, const char *function, char *workspace, size_t len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_func_read </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>function</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>workspace</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>len</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>executes a read operation on a function </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel to execute on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>function</em>&nbsp;</td><td>Data containing the function call string (will be modified) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>workspace</em>&nbsp;</td><td>A pointer to safe memory to use for a return value </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>len</em>&nbsp;</td><td>the <a class="el" href="structnumber.html" title="Number structure.">number</a> of bytes in workspace</td></tr>
  </table>
  </dd>
</dl>
<p>This application executes a function in read mode on a given channel.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>non-zero</em>&nbsp;</td><td>failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l03356">3356</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="loader_8c_source.html#l00195">__ast_module_user_add()</a>, <a class="el" href="loader_8c_source.html#l00216">__ast_module_user_remove()</a>, <a class="el" href="pbx_8c_source.html#l03202">ast_custom_function_find()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="app__voicemail_8c_source.html#l03724">copy()</a>, <a class="el" href="pbx_8c_source.html#l03338">func_args()</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="pbx_8h_source.html#l00095">ast_custom_function::mod</a>, and <a class="el" href="structast__custom__function.html#a0e793527a2a61bb88fa61f3a7c88b65f">ast_custom_function::read</a>.</p>

<p>Referenced by <a class="el" href="manager_8c_source.html#l01847">action_getvar()</a>, <a class="el" href="manager_8c_source.html#l01904">action_status()</a>, <a class="el" href="res__agi_8c_source.html#l01818">handle_getvariable()</a>, <a class="el" href="pbx__lua_8c_source.html#l00260">lua_get_variable_value()</a>, and <a class="el" href="pbx_8c_source.html#l03403">pbx_substitute_variables_helper_full()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03357"></a>03357 {
<a name="l03358"></a>03358    <span class="keywordtype">char</span> *<a class="code" href="app__voicemail_8c.html#abe15777a07ac747625b018ac01f92531" title="Utility function to copy a file.">copy</a> = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(function);
<a name="l03359"></a>03359    <span class="keywordtype">char</span> *args = <a class="code" href="pbx_8c.html#a2d0f37f8baa5d6fcf93cf4fab6342c36" title="return a pointer to the arguments of the function, and terminates the function name...">func_args</a>(copy);
<a name="l03360"></a>03360    <span class="keyword">struct </span><a class="code" href="structast__custom__function.html" title="Data structure associated with a custom dialplan function.">ast_custom_function</a> *acfptr = <a class="code" href="pbx_8h.html#a5e0f8c2ce2a3c8994648254799a0c3b7">ast_custom_function_find</a>(copy);
<a name="l03361"></a>03361 
<a name="l03362"></a>03362    <span class="keywordflow">if</span> (acfptr == NULL)
<a name="l03363"></a>03363       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Function %s not registered\n&quot;</span>, copy);
<a name="l03364"></a>03364    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!acfptr-&gt;<a class="code" href="structast__custom__function.html#a0e793527a2a61bb88fa61f3a7c88b65f">read</a>)
<a name="l03365"></a>03365       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Function %s cannot be read\n&quot;</span>, copy);
<a name="l03366"></a>03366    <span class="keywordflow">else</span> {
<a name="l03367"></a>03367       <span class="keywordtype">int</span> res;
<a name="l03368"></a>03368       <span class="keyword">struct </span><a class="code" href="structast__module__user.html">ast_module_user</a> *u = NULL;
<a name="l03369"></a>03369       <span class="keywordflow">if</span> (acfptr-&gt;<a class="code" href="structast__custom__function.html#a782aff512368932b8d71b3633f88cb04">mod</a>)
<a name="l03370"></a>03370          u = <a class="code" href="module_8h.html#ad315d50d0a7d61cb9feac19223fff8c0">__ast_module_user_add</a>(acfptr-&gt;<a class="code" href="structast__custom__function.html#a782aff512368932b8d71b3633f88cb04">mod</a>, chan);
<a name="l03371"></a>03371       res = acfptr-&gt;<a class="code" href="structast__custom__function.html#a0e793527a2a61bb88fa61f3a7c88b65f">read</a>(chan, copy, args, workspace, <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>);
<a name="l03372"></a>03372       <span class="keywordflow">if</span> (acfptr-&gt;<a class="code" href="structast__custom__function.html#a782aff512368932b8d71b3633f88cb04">mod</a> &amp;&amp; u)
<a name="l03373"></a>03373          <a class="code" href="module_8h.html#aee5ac94e279928d1d1f7b6aafb62ec7a">__ast_module_user_remove</a>(acfptr-&gt;<a class="code" href="structast__custom__function.html#a782aff512368932b8d71b3633f88cb04">mod</a>, u);
<a name="l03374"></a>03374       <span class="keywordflow">return</span> res;
<a name="l03375"></a>03375    }
<a name="l03376"></a>03376    <span class="keywordflow">return</span> -1;
<a name="l03377"></a>03377 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae70e64cdf669396c88ea8eda900b0b3b"></a><!-- doxytag: member="pbx.h::ast_func_write" ref="ae70e64cdf669396c88ea8eda900b0b3b" args="(struct ast_channel *chan, const char *function, const char *value)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_func_write </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>function</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>value</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>executes a write operation on a function </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel to execute on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>function</em>&nbsp;</td><td>Data containing the function call string (will be modified) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>value</em>&nbsp;</td><td>A value parameter to pass for writing</td></tr>
  </table>
  </dd>
</dl>
<p>This application executes a function in write mode on a given channel.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>non-zero</em>&nbsp;</td><td>failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l03379">3379</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="loader_8c_source.html#l00195">__ast_module_user_add()</a>, <a class="el" href="loader_8c_source.html#l00216">__ast_module_user_remove()</a>, <a class="el" href="pbx_8c_source.html#l03202">ast_custom_function_find()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="app__voicemail_8c_source.html#l03724">copy()</a>, <a class="el" href="pbx_8c_source.html#l03338">func_args()</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="pbx_8h_source.html#l00095">ast_custom_function::mod</a>, and <a class="el" href="structast__custom__function.html#a1d0ca9a282b63162660f551d833f57cf">ast_custom_function::write</a>.</p>

<p>Referenced by <a class="el" href="manager_8c_source.html#l01803">action_setvar()</a>, <a class="el" href="pbx_8c_source.html#l08989">pbx_builtin_pushvar_helper()</a>, and <a class="el" href="pbx_8c_source.html#l09023">pbx_builtin_setvar_helper()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03380"></a>03380 {
<a name="l03381"></a>03381    <span class="keywordtype">char</span> *<a class="code" href="app__voicemail_8c.html#abe15777a07ac747625b018ac01f92531" title="Utility function to copy a file.">copy</a> = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(function);
<a name="l03382"></a>03382    <span class="keywordtype">char</span> *args = <a class="code" href="pbx_8c.html#a2d0f37f8baa5d6fcf93cf4fab6342c36" title="return a pointer to the arguments of the function, and terminates the function name...">func_args</a>(copy);
<a name="l03383"></a>03383    <span class="keyword">struct </span><a class="code" href="structast__custom__function.html" title="Data structure associated with a custom dialplan function.">ast_custom_function</a> *acfptr = <a class="code" href="pbx_8h.html#a5e0f8c2ce2a3c8994648254799a0c3b7">ast_custom_function_find</a>(copy);
<a name="l03384"></a>03384 
<a name="l03385"></a>03385    <span class="keywordflow">if</span> (acfptr == NULL)
<a name="l03386"></a>03386       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Function %s not registered\n&quot;</span>, copy);
<a name="l03387"></a>03387    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!acfptr-&gt;<a class="code" href="structast__custom__function.html#a1d0ca9a282b63162660f551d833f57cf">write</a>)
<a name="l03388"></a>03388       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Function %s cannot be written to\n&quot;</span>, copy);
<a name="l03389"></a>03389    <span class="keywordflow">else</span> {
<a name="l03390"></a>03390       <span class="keywordtype">int</span> res;
<a name="l03391"></a>03391       <span class="keyword">struct </span><a class="code" href="structast__module__user.html">ast_module_user</a> *u = NULL;
<a name="l03392"></a>03392       <span class="keywordflow">if</span> (acfptr-&gt;<a class="code" href="structast__custom__function.html#a782aff512368932b8d71b3633f88cb04">mod</a>)
<a name="l03393"></a>03393          u = <a class="code" href="module_8h.html#ad315d50d0a7d61cb9feac19223fff8c0">__ast_module_user_add</a>(acfptr-&gt;<a class="code" href="structast__custom__function.html#a782aff512368932b8d71b3633f88cb04">mod</a>, chan);
<a name="l03394"></a>03394       res = acfptr-&gt;<a class="code" href="structast__custom__function.html#a1d0ca9a282b63162660f551d833f57cf">write</a>(chan, copy, args, value);
<a name="l03395"></a>03395       <span class="keywordflow">if</span> (acfptr-&gt;<a class="code" href="structast__custom__function.html#a782aff512368932b8d71b3633f88cb04">mod</a> &amp;&amp; u)
<a name="l03396"></a>03396          <a class="code" href="module_8h.html#aee5ac94e279928d1d1f7b6aafb62ec7a">__ast_module_user_remove</a>(acfptr-&gt;<a class="code" href="structast__custom__function.html#a782aff512368932b8d71b3633f88cb04">mod</a>, u);
<a name="l03397"></a>03397       <span class="keywordflow">return</span> res;
<a name="l03398"></a>03398    }
<a name="l03399"></a>03399 
<a name="l03400"></a>03400    <span class="keywordflow">return</span> -1;
<a name="l03401"></a>03401 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa42372790072cff15f75c674917115b0"></a><!-- doxytag: member="pbx.h::ast_get_context_name" ref="aa42372790072cff15f75c674917115b0" args="(struct ast_context *con)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* ast_get_context_name </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__context.html">ast_context</a> *&nbsp;</td>
          <td class="paramname"> <em>con</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09384">9384</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l00852">ast_context::name</a>.</p>

<p>Referenced by <a class="el" href="app__macro_8c_source.html#l00219">_macro_exec()</a>, <a class="el" href="pbx_8c_source.html#l07032">ast_context_add_include2()</a>, <a class="el" href="pbx_8c_source.html#l07114">ast_context_add_switch2()</a>, <a class="el" href="pbx_8c_source.html#l04988">ast_context_lockmacro()</a>, <a class="el" href="pbx_8c_source.html#l04709">ast_context_remove_include2()</a>, <a class="el" href="pbx_8c_source.html#l04765">ast_context_remove_switch2()</a>, <a class="el" href="pbx_8c_source.html#l05028">ast_context_unlockmacro()</a>, <a class="el" href="pbx_8c_source.html#l09532">ast_context_verify_includes()</a>, <a class="el" href="pbx__config_8c_source.html#l01015">complete_dialplan_add_extension()</a>, <a class="el" href="pbx__config_8c_source.html#l01101">complete_dialplan_add_ignorepat()</a>, <a class="el" href="pbx__config_8c_source.html#l00575">complete_dialplan_add_include()</a>, <a class="el" href="pbx__config_8c_source.html#l00392">complete_dialplan_remove_extension()</a>, <a class="el" href="pbx__config_8c_source.html#l01197">complete_dialplan_remove_ignorepat()</a>, <a class="el" href="pbx__config_8c_source.html#l00182">complete_dialplan_remove_include()</a>, <a class="el" href="pbx_8c_source.html#l05567">complete_show_dialplan_context()</a>, <a class="el" href="pbx_8c_source.html#l06506">context_merge_incls_swits_igps_other_registrars()</a>, <a class="el" href="pbx__dundi_8c_source.html#l03723">dundi_precache_full()</a>, <a class="el" href="pbx_8c_source.html#l04658">find_context_locked()</a>, <a class="el" href="app__while_8c_source.html#l00148">find_matching_endwhile()</a>, <a class="el" href="app__macro_8c_source.html#l00184">find_matching_priority()</a>, <a class="el" href="pbx__config_8c_source.html#l00672">handle_cli_dialplan_save()</a>, <a class="el" href="pbx_8c_source.html#l05397">handle_show_hint()</a>, <a class="el" href="pbx_8c_source.html#l05326">handle_show_hints()</a>, <a class="el" href="pbx_8c_source.html#l05957">manager_show_dialplan_helper()</a>, <a class="el" href="pbx_8c_source.html#l05772">show_debug_helper()</a>, and <a class="el" href="pbx_8c_source.html#l05621">show_dialplan_helper()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09385"></a>09385 {
<a name="l09386"></a>09386    <span class="keywordflow">return</span> con ? con-&gt;<a class="code" href="structast__context.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a> : NULL;
<a name="l09387"></a>09387 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9df0a5d301454fe924172cf89c7165a4"></a><!-- doxytag: member="pbx.h::ast_get_context_registrar" ref="a9df0a5d301454fe924172cf89c7165a4" args="(struct ast_context *c)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* ast_get_context_registrar </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__context.html">ast_context</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09422">9422</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l00848">ast_context::registrar</a>.</p>

<p>Referenced by <a class="el" href="pbx__config_8c_source.html#l00672">handle_cli_dialplan_save()</a>, <a class="el" href="pbx_8c_source.html#l05772">show_debug_helper()</a>, and <a class="el" href="pbx_8c_source.html#l05621">show_dialplan_helper()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09423"></a>09423 {
<a name="l09424"></a>09424    <span class="keywordflow">return</span> c ? c-&gt;<a class="code" href="structast__context.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a> : NULL;
<a name="l09425"></a>09425 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6594bb017b4d4fe1bc42370cc32ec974"></a><!-- doxytag: member="pbx.h::ast_get_extension_app" ref="a6594bb017b4d4fe1bc42370cc32ec974" args="(struct ast_exten *e)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* ast_get_extension_app </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__exten.html">ast_exten</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09452">9452</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l00776">ast_exten::app</a>.</p>

<p>Referenced by <a class="el" href="app__macro_8c_source.html#l00219">_macro_exec()</a>, <a class="el" href="pbx_8c_source.html#l04031">ast_add_hint_nolock()</a>, <a class="el" href="pbx_8c_source.html#l03797">ast_extension_state2()</a>, <a class="el" href="pbx_8c_source.html#l04126">ast_get_hint()</a>, <a class="el" href="app__while_8c_source.html#l00148">find_matching_endwhile()</a>, <a class="el" href="pbx__config_8c_source.html#l00672">handle_cli_dialplan_save()</a>, <a class="el" href="pbx_8c_source.html#l05397">handle_show_hint()</a>, <a class="el" href="pbx_8c_source.html#l05326">handle_show_hints()</a>, <a class="el" href="pbx_8c_source.html#l03843">handle_statechange()</a>, <a class="el" href="pbx_8c_source.html#l05957">manager_show_dialplan_helper()</a>, and <a class="el" href="pbx_8c_source.html#l05607">print_ext()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09453"></a>09453 {
<a name="l09454"></a>09454    <span class="keywordflow">return</span> e ? e-&gt;<a class="code" href="structast__exten.html#a83a793edb3d6a3a15f2a7fc99ffe8c90">app</a> : NULL;
<a name="l09455"></a>09455 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac0a6c0c39796f36864868365d8989f02"></a><!-- doxytag: member="pbx.h::ast_get_extension_app_data" ref="ac0a6c0c39796f36864868365d8989f02" args="(struct ast_exten *e)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* ast_get_extension_app_data </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__exten.html">ast_exten</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09457">9457</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l00778">ast_exten::data</a>.</p>

<p>Referenced by <a class="el" href="app__macro_8c_source.html#l00219">_macro_exec()</a>, <a class="el" href="pbx_8c_source.html#l04126">ast_get_hint()</a>, <a class="el" href="pbx__config_8c_source.html#l00672">handle_cli_dialplan_save()</a>, <a class="el" href="pbx_8c_source.html#l05957">manager_show_dialplan_helper()</a>, and <a class="el" href="pbx_8c_source.html#l05607">print_ext()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09458"></a>09458 {
<a name="l09459"></a>09459    <span class="keywordflow">return</span> e ? e-&gt;<a class="code" href="structast__exten.html#a735984d41155bc1032e09bece8f8d66d">data</a> : NULL;
<a name="l09460"></a>09460 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aee004b6fcfccea3fa6acf9b7264f42c9"></a><!-- doxytag: member="pbx.h::ast_get_extension_cidmatch" ref="aee004b6fcfccea3fa6acf9b7264f42c9" args="(struct ast_exten *e)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* ast_get_extension_cidmatch </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__exten.html">ast_exten</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09447">9447</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l00772">ast_exten::cidmatch</a>.</p>

<p>Referenced by <a class="el" href="pbx__config_8c_source.html#l00392">complete_dialplan_remove_extension()</a>, <a class="el" href="app__macro_8c_source.html#l00184">find_matching_priority()</a>, and <a class="el" href="pbx__config_8c_source.html#l00672">handle_cli_dialplan_save()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09448"></a>09448 {
<a name="l09449"></a>09449    <span class="keywordflow">return</span> e ? e-&gt;<a class="code" href="structast__exten.html#aa40e509d3af869c736d2c5e2d67ce97e">cidmatch</a> : NULL;
<a name="l09450"></a>09450 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a65bb6651308bdad136b637965835cb82"></a><!-- doxytag: member="pbx.h::ast_get_extension_context" ref="a65bb6651308bdad136b637965835cb82" args="(struct ast_exten *exten)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__context.html">ast_context</a>* ast_get_extension_context </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__exten.html">ast_exten</a> *&nbsp;</td>
          <td class="paramname"> <em>exten</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09389">9389</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l00775">ast_exten::parent</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l05397">handle_show_hint()</a>, and <a class="el" href="pbx_8c_source.html#l05326">handle_show_hints()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09390"></a>09390 {
<a name="l09391"></a>09391    <span class="keywordflow">return</span> exten ? exten-&gt;<a class="code" href="structast__exten.html#a7733606f3f625c2782402ba971995641">parent</a> : NULL;
<a name="l09392"></a>09392 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a266960fe6aa4db1066ed0b012fb7eb62"></a><!-- doxytag: member="pbx.h::ast_get_extension_label" ref="a266960fe6aa4db1066ed0b012fb7eb62" args="(struct ast_exten *e)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* ast_get_extension_label </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__exten.html">ast_exten</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09399">9399</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l00774">ast_exten::label</a>.</p>

<p>Referenced by <a class="el" href="pbx__config_8c_source.html#l00672">handle_cli_dialplan_save()</a>, <a class="el" href="pbx_8c_source.html#l05957">manager_show_dialplan_helper()</a>, and <a class="el" href="pbx_8c_source.html#l05621">show_dialplan_helper()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09400"></a>09400 {
<a name="l09401"></a>09401    <span class="keywordflow">return</span> <a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a> ? <a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>-&gt;label : NULL;
<a name="l09402"></a>09402 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a26c679c70c1a8dd0968579be0c1755ab"></a><!-- doxytag: member="pbx.h::ast_get_extension_matchcid" ref="a26c679c70c1a8dd0968579be0c1755ab" args="(struct ast_exten *e)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_get_extension_matchcid </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__exten.html">ast_exten</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09442">9442</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l00771">ast_exten::matchcid</a>.</p>

<p>Referenced by <a class="el" href="pbx__config_8c_source.html#l00392">complete_dialplan_remove_extension()</a>, <a class="el" href="app__macro_8c_source.html#l00184">find_matching_priority()</a>, and <a class="el" href="pbx__config_8c_source.html#l00672">handle_cli_dialplan_save()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09443"></a>09443 {
<a name="l09444"></a>09444    <span class="keywordflow">return</span> e ? e-&gt;<a class="code" href="structast__exten.html#af0803fced1d4ccfbc6ec4d8577d30525">matchcid</a> : 0;
<a name="l09445"></a>09445 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6fb940c1fd9c74b9d573e0a91bb23697"></a><!-- doxytag: member="pbx.h::ast_get_extension_name" ref="a6fb940c1fd9c74b9d573e0a91bb23697" args="(struct ast_exten *exten)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* ast_get_extension_name </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__exten.html">ast_exten</a> *&nbsp;</td>
          <td class="paramname"> <em>exten</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09394">9394</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l00770">ast_exten::exten</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l04031">ast_add_hint_nolock()</a>, <a class="el" href="pbx_8c_source.html#l05371">complete_core_show_hint()</a>, <a class="el" href="pbx__config_8c_source.html#l00392">complete_dialplan_remove_extension()</a>, <a class="el" href="pbx__dundi_8c_source.html#l03723">dundi_precache_full()</a>, <a class="el" href="app__macro_8c_source.html#l00184">find_matching_priority()</a>, <a class="el" href="pbx__config_8c_source.html#l00672">handle_cli_dialplan_save()</a>, <a class="el" href="pbx_8c_source.html#l05397">handle_show_hint()</a>, <a class="el" href="pbx_8c_source.html#l05326">handle_show_hints()</a>, <a class="el" href="pbx_8c_source.html#l05957">manager_show_dialplan_helper()</a>, and <a class="el" href="pbx_8c_source.html#l05621">show_dialplan_helper()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09395"></a>09395 {
<a name="l09396"></a>09396    <span class="keywordflow">return</span> exten ? exten-&gt;<a class="code" href="structast__exten.html#a9c2cb8c1611452928af0def998e36335">exten</a> : NULL;
<a name="l09397"></a>09397 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1662981db35d4125afaf6de98b2ba52f"></a><!-- doxytag: member="pbx.h::ast_get_extension_priority" ref="a1662981db35d4125afaf6de98b2ba52f" args="(struct ast_exten *exten)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_get_extension_priority </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__exten.html">ast_exten</a> *&nbsp;</td>
          <td class="paramname"> <em>exten</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09414">9414</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l00773">ast_exten::priority</a>.</p>

<p>Referenced by <a class="el" href="pbx__config_8c_source.html#l00392">complete_dialplan_remove_extension()</a>, <a class="el" href="app__macro_8c_source.html#l00184">find_matching_priority()</a>, <a class="el" href="pbx__config_8c_source.html#l00672">handle_cli_dialplan_save()</a>, <a class="el" href="pbx_8c_source.html#l05957">manager_show_dialplan_helper()</a>, and <a class="el" href="pbx_8c_source.html#l05607">print_ext()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09415"></a>09415 {
<a name="l09416"></a>09416    <span class="keywordflow">return</span> exten ? exten-&gt;<a class="code" href="structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> : -1;
<a name="l09417"></a>09417 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7f23f7c798d61e68c32b21d3e0cd15a2"></a><!-- doxytag: member="pbx.h::ast_get_extension_registrar" ref="a7f23f7c798d61e68c32b21d3e0cd15a2" args="(struct ast_exten *e)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* ast_get_extension_registrar </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__exten.html">ast_exten</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09427">9427</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l00783">ast_exten::registrar</a>.</p>

<p>Referenced by <a class="el" href="pbx__config_8c_source.html#l00672">handle_cli_dialplan_save()</a>, <a class="el" href="pbx_8c_source.html#l05957">manager_show_dialplan_helper()</a>, and <a class="el" href="pbx_8c_source.html#l05621">show_dialplan_helper()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09428"></a>09428 {
<a name="l09429"></a>09429    <span class="keywordflow">return</span> e ? e-&gt;<a class="code" href="structast__exten.html#aa05090666ce7a4905fe1b56b4fdd3be3">registrar</a> : NULL;
<a name="l09430"></a>09430 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac778ac642def88a06e5d59e11a964c43"></a><!-- doxytag: member="pbx.h::ast_get_hint" ref="ac778ac642def88a06e5d59e11a964c43" args="(char *hint, int hintsize, char *name, int namesize, struct ast_channel *c, const char *context, const char *exten)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_get_hint </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>hint</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>hintsize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>namesize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>exten</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>If an <a class="el" href="structextension.html">extension</a> hint exists, return non-zero. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>hint</em>&nbsp;</td><td>buffer for hint </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>hintsize</em>&nbsp;</td><td>size of hint buffer, in bytes </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>buffer for name portion of hint </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>namesize</em>&nbsp;</td><td>size of name buffer </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>c</em>&nbsp;</td><td>Channel from which to return the hint. This is only important when the hint or name contains an expression to be expanded. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>context</em>&nbsp;</td><td>which context to look in </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>exten</em>&nbsp;</td><td>which <a class="el" href="structextension.html">extension</a> to search for</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>If an <a class="el" href="structextension.html">extension</a> within the given context with the priority PRIORITY_HINT is found, a non zero value will be returned. Otherwise, 0 is returned. </dd></dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l04126">4126</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="pbx_8c_source.html#l09452">ast_get_extension_app()</a>, <a class="el" href="pbx_8c_source.html#l09457">ast_get_extension_app_data()</a>, and <a class="el" href="pbx_8c_source.html#l03761">ast_hint_extension()</a>.</p>

<p>Referenced by <a class="el" href="manager_8c_source.html#l02590">action_extensionstate()</a>, <a class="el" href="app__dial_8c_source.html#l00672">get_cid_name()</a>, <a class="el" href="chan__sip_8c_source.html#l13269">get_destination()</a>, <a class="el" href="func__devstate_8c_source.html#l00144">hint_read()</a>, <a class="el" href="manager_8c_source.html#l03402">manager_state_cb()</a>, <a class="el" href="pbx_8c_source.html#l02867">pbx_retrieve_variable()</a>, <a class="el" href="chan__skinny_8c_source.html#l02468">skinny_extensionstate_cb()</a>, and <a class="el" href="chan__sip_8c_source.html#l11046">transmit_state_notify()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04127"></a>04127 {
<a name="l04128"></a>04128    <span class="keyword">struct </span><a class="code" href="structast__exten.html" title="ast_exten: An extension The dialplan is saved as a linked list with each context...">ast_exten</a> *e = <a class="code" href="pbx_8c.html#a666d27d15c01c2b36dd8523a0146ba40">ast_hint_extension</a>(c, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>);
<a name="l04129"></a>04129 
<a name="l04130"></a>04130    <span class="keywordflow">if</span> (e) {
<a name="l04131"></a>04131       <span class="keywordflow">if</span> (hint)
<a name="l04132"></a>04132          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(hint, <a class="code" href="pbx_8h.html#a6594bb017b4d4fe1bc42370cc32ec974">ast_get_extension_app</a>(e), hintsize);
<a name="l04133"></a>04133       <span class="keywordflow">if</span> (<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>) {
<a name="l04134"></a>04134          <span class="keyword">const</span> <span class="keywordtype">char</span> *tmp = <a class="code" href="pbx_8h.html#ac0a6c0c39796f36864868365d8989f02">ast_get_extension_app_data</a>(e);
<a name="l04135"></a>04135          <span class="keywordflow">if</span> (tmp)
<a name="l04136"></a>04136             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, tmp, namesize);
<a name="l04137"></a>04137       }
<a name="l04138"></a>04138       <span class="keywordflow">return</span> -1;
<a name="l04139"></a>04139    }
<a name="l04140"></a>04140    <span class="keywordflow">return</span> 0;
<a name="l04141"></a>04141 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0c324514fc22df9cc5b32ceb68006e79"></a><!-- doxytag: member="pbx.h::ast_get_ignorepat_name" ref="a0c324514fc22df9cc5b32ceb68006e79" args="(struct ast_ignorepat *ip)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* ast_get_ignorepat_name </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__ignorepat.html">ast_ignorepat</a> *&nbsp;</td>
          <td class="paramname"> <em>ip</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09409">9409</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l00813">ast_ignorepat::pattern</a>.</p>

<p>Referenced by <a class="el" href="pbx__config_8c_source.html#l01197">complete_dialplan_remove_ignorepat()</a>, <a class="el" href="pbx_8c_source.html#l06506">context_merge_incls_swits_igps_other_registrars()</a>, <a class="el" href="pbx__config_8c_source.html#l00672">handle_cli_dialplan_save()</a>, <a class="el" href="pbx__config_8c_source.html#l00115">lookup_c_ip()</a>, <a class="el" href="pbx_8c_source.html#l05957">manager_show_dialplan_helper()</a>, and <a class="el" href="pbx_8c_source.html#l05621">show_dialplan_helper()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09410"></a>09410 {
<a name="l09411"></a>09411    <span class="keywordflow">return</span> ip ? ip-&gt;<a class="code" href="structast__ignorepat.html#a22c50d97e30c98ae5e62eaed74605c78">pattern</a> : NULL;
<a name="l09412"></a>09412 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1a219215514e9ed08ff67cc02c2dd1d3"></a><!-- doxytag: member="pbx.h::ast_get_ignorepat_registrar" ref="a1a219215514e9ed08ff67cc02c2dd1d3" args="(struct ast_ignorepat *ip)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* ast_get_ignorepat_registrar </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__ignorepat.html">ast_ignorepat</a> *&nbsp;</td>
          <td class="paramname"> <em>ip</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09437">9437</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l00811">ast_ignorepat::registrar</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l06506">context_merge_incls_swits_igps_other_registrars()</a>, <a class="el" href="pbx__config_8c_source.html#l00672">handle_cli_dialplan_save()</a>, <a class="el" href="pbx_8c_source.html#l05957">manager_show_dialplan_helper()</a>, and <a class="el" href="pbx_8c_source.html#l05621">show_dialplan_helper()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09438"></a>09438 {
<a name="l09439"></a>09439    <span class="keywordflow">return</span> ip ? ip-&gt;<a class="code" href="structast__ignorepat.html#aa05090666ce7a4905fe1b56b4fdd3be3">registrar</a> : NULL;
<a name="l09440"></a>09440 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="acb52f47bcc03f9dd5d781d7e272040b0"></a><!-- doxytag: member="pbx.h::ast_get_include_name" ref="acb52f47bcc03f9dd5d781d7e272040b0" args="(struct ast_include *include)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* ast_get_include_name </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__include.html">ast_include</a> *&nbsp;</td>
          <td class="paramname"> <em>include</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09404">9404</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l00790">ast_include::name</a>.</p>

<p>Referenced by <a class="el" href="pbx__config_8c_source.html#l00182">complete_dialplan_remove_include()</a>, <a class="el" href="pbx_8c_source.html#l06506">context_merge_incls_swits_igps_other_registrars()</a>, <a class="el" href="app__macro_8c_source.html#l00184">find_matching_priority()</a>, <a class="el" href="pbx__config_8c_source.html#l00672">handle_cli_dialplan_save()</a>, <a class="el" href="pbx__config_8c_source.html#l00101">lookup_ci()</a>, <a class="el" href="pbx_8c_source.html#l05957">manager_show_dialplan_helper()</a>, and <a class="el" href="pbx_8c_source.html#l05621">show_dialplan_helper()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09405"></a>09405 {
<a name="l09406"></a>09406    <span class="keywordflow">return</span> inc ? inc-&gt;name : NULL;
<a name="l09407"></a>09407 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7a9aa5cd362edc7d593196f57686c2b9"></a><!-- doxytag: member="pbx.h::ast_get_include_registrar" ref="a7a9aa5cd362edc7d593196f57686c2b9" args="(struct ast_include *i)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* ast_get_include_registrar </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__include.html">ast_include</a> *&nbsp;</td>
          <td class="paramname"> <em>i</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09432">9432</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l00792">ast_include::registrar</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l06506">context_merge_incls_swits_igps_other_registrars()</a>, <a class="el" href="pbx__config_8c_source.html#l00672">handle_cli_dialplan_save()</a>, <a class="el" href="pbx_8c_source.html#l05957">manager_show_dialplan_helper()</a>, and <a class="el" href="pbx_8c_source.html#l05621">show_dialplan_helper()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09433"></a>09433 {
<a name="l09434"></a>09434    <span class="keywordflow">return</span> i ? i-&gt;<a class="code" href="structast__include.html#aa05090666ce7a4905fe1b56b4fdd3be3">registrar</a> : NULL;
<a name="l09435"></a>09435 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="accdca3b300f8f1ff523872bd3a129adc"></a><!-- doxytag: member="pbx.h::ast_get_switch_data" ref="accdca3b300f8f1ff523872bd3a129adc" args="(struct ast_sw *sw)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* ast_get_switch_data </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__sw.html">ast_sw</a> *&nbsp;</td>
          <td class="paramname"> <em>sw</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09467">9467</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l00803">ast_sw::data</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l06506">context_merge_incls_swits_igps_other_registrars()</a>, <a class="el" href="pbx__config_8c_source.html#l00672">handle_cli_dialplan_save()</a>, <a class="el" href="pbx_8c_source.html#l05957">manager_show_dialplan_helper()</a>, and <a class="el" href="pbx_8c_source.html#l05621">show_dialplan_helper()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09468"></a>09468 {
<a name="l09469"></a>09469    <span class="keywordflow">return</span> sw ? sw-&gt;<a class="code" href="structast__sw.html#a91a70b77df95bd8b0830b49a094c2acb">data</a> : NULL;
<a name="l09470"></a>09470 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af947a04e100465f0c03b870129ba3e48"></a><!-- doxytag: member="pbx.h::ast_get_switch_eval" ref="af947a04e100465f0c03b870129ba3e48" args="(struct ast_sw *sw)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_get_switch_eval </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__sw.html">ast_sw</a> *&nbsp;</td>
          <td class="paramname"> <em>sw</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09472">9472</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l00804">ast_sw::eval</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l06506">context_merge_incls_swits_igps_other_registrars()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09473"></a>09473 {
<a name="l09474"></a>09474    <span class="keywordflow">return</span> sw-&gt;<a class="code" href="structast__sw.html#a4e3f077fec8b035a2678e7740f366dea">eval</a>;
<a name="l09475"></a>09475 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a87693eca302936ade0be97cab21e4f56"></a><!-- doxytag: member="pbx.h::ast_get_switch_name" ref="a87693eca302936ade0be97cab21e4f56" args="(struct ast_sw *sw)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* ast_get_switch_name </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__sw.html">ast_sw</a> *&nbsp;</td>
          <td class="paramname"> <em>sw</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09462">9462</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l00801">ast_sw::name</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l06506">context_merge_incls_swits_igps_other_registrars()</a>, <a class="el" href="pbx__config_8c_source.html#l00672">handle_cli_dialplan_save()</a>, <a class="el" href="pbx_8c_source.html#l05957">manager_show_dialplan_helper()</a>, and <a class="el" href="pbx_8c_source.html#l05621">show_dialplan_helper()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09463"></a>09463 {
<a name="l09464"></a>09464    <span class="keywordflow">return</span> sw ? sw-&gt;<a class="code" href="structast__sw.html#a5ac083a645d964373f022d03df4849c8">name</a> : NULL;
<a name="l09465"></a>09465 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1361d2a84278cee910c8ca0c7964c84c"></a><!-- doxytag: member="pbx.h::ast_get_switch_registrar" ref="a1361d2a84278cee910c8ca0c7964c84c" args="(struct ast_sw *sw)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* ast_get_switch_registrar </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__sw.html">ast_sw</a> *&nbsp;</td>
          <td class="paramname"> <em>sw</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09477">9477</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l00802">ast_sw::registrar</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l06506">context_merge_incls_swits_igps_other_registrars()</a>, <a class="el" href="pbx__config_8c_source.html#l00672">handle_cli_dialplan_save()</a>, <a class="el" href="pbx_8c_source.html#l05957">manager_show_dialplan_helper()</a>, and <a class="el" href="pbx_8c_source.html#l05621">show_dialplan_helper()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09478"></a>09478 {
<a name="l09479"></a>09479    <span class="keywordflow">return</span> sw ? sw-&gt;<a class="code" href="structast__sw.html#aa05090666ce7a4905fe1b56b4fdd3be3">registrar</a> : NULL;
<a name="l09480"></a>09480 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8f7166f50cb9642179c9b321b8143f55"></a><!-- doxytag: member="pbx.h::ast_goto_if_exists" ref="a8f7166f50cb9642179c9b321b8143f55" args="(struct ast_channel *chan, const char *context, const char *exten, int priority)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_goto_if_exists </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>exten</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>priority</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl class="note"><dt><b>Note:</b></dt><dd>This function will handle locking the channel as needed. </dd></dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09570">9570</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l09551">__ast_goto_if_exists()</a>.</p>

<p>Referenced by <a class="el" href="app__talkdetect_8c_source.html#l00076">background_detect_exec()</a>, <a class="el" href="app__chanspy_8c_source.html#l00445">channel_spy()</a>, <a class="el" href="app__chanspy_8c_source.html#l00767">common_exec()</a>, <a class="el" href="app__meetme_8c_source.html#l01998">conf_run()</a>, <a class="el" href="app__directory_8c_source.html#l00633">goto_exten()</a>, <a class="el" href="app__dial_8c_source.html#l00653">onedigit_goto()</a>, <a class="el" href="app__rpt_8c_source.html#l01365">priority_jump()</a>, <a class="el" href="app__directory_8c_source.html#l00269">select_entry()</a>, and <a class="el" href="app__queue_8c_source.html#l02047">valid_exit()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09571"></a>09571 {
<a name="l09572"></a>09572    <span class="keywordflow">return</span> <a class="code" href="pbx_8c.html#a5c2ad0729efb2f13f192ee283f6f13c2">__ast_goto_if_exists</a>(chan, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, <a class="code" href="structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>, 0);
<a name="l09573"></a>09573 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a20a2f5668173430437db02cdd0acc9f3"></a><!-- doxytag: member="pbx.h::ast_hashtab_compare_contexts" ref="a20a2f5668173430437db02cdd0acc9f3" args="(const void *ah_a, const void *ah_b)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_hashtab_compare_contexts </td>
          <td>(</td>
          <td class="paramtype">const void *&nbsp;</td>
          <td class="paramname"> <em>ah_a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&nbsp;</td>
          <td class="paramname"> <em>ah_b</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>hashtable functions for contexts </p>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l00994">994</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l00852">ast_context::name</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l06424">ast_context_find_or_create()</a>, <a class="el" href="pbx__lua_8c_source.html#l00845">lua_register_switches()</a>, and <a class="el" href="pbx__ael_8c_source.html#l00113">pbx_load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00995"></a>00995 {
<a name="l00996"></a>00996    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structast__context.html" title="ast_context: An extension context">ast_context</a> *ac = ah_a;
<a name="l00997"></a>00997    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structast__context.html" title="ast_context: An extension context">ast_context</a> *bc = ah_b;
<a name="l00998"></a>00998    <span class="keywordflow">if</span> (!ac || !bc) <span class="comment">/* safety valve, but it might prevent a crash you&apos;d rather have happen */</span>
<a name="l00999"></a>00999       <span class="keywordflow">return</span> 1;
<a name="l01000"></a>01000    <span class="comment">/* assume context names are registered in a string table! */</span>
<a name="l01001"></a>01001    <span class="keywordflow">return</span> strcmp(ac-&gt;<a class="code" href="structast__context.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>, bc-&gt;<a class="code" href="structast__context.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>);
<a name="l01002"></a>01002 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a56461864a4e21b14e753b78f9ac7afb7"></a><!-- doxytag: member="pbx.h::ast_hashtab_hash_contexts" ref="a56461864a4e21b14e753b78f9ac7afb7" args="(const void *obj)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int ast_hashtab_hash_contexts </td>
          <td>(</td>
          <td class="paramtype">const void *&nbsp;</td>
          <td class="paramname"> <em>obj</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8c_source.html#l01037">1037</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="hashtab_8c_source.html#l00153">ast_hashtab_hash_string()</a>, and <a class="el" href="pbx_8c_source.html#l00852">ast_context::name</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l06424">ast_context_find_or_create()</a>, <a class="el" href="pbx__lua_8c_source.html#l00845">lua_register_switches()</a>, and <a class="el" href="pbx__ael_8c_source.html#l00113">pbx_load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01038"></a>01038 {
<a name="l01039"></a>01039    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structast__context.html" title="ast_context: An extension context">ast_context</a> *ac = obj;
<a name="l01040"></a>01040    <span class="keywordflow">return</span> <a class="code" href="hashtab_8h.html#af8904cce564fd39de28b566bb8c261eb" title="Hashes a string to a number.">ast_hashtab_hash_string</a>(ac-&gt;<a class="code" href="structast__context.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>);
<a name="l01041"></a>01041 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa73d176ed4f1ce51e5db6beafba45fe3"></a><!-- doxytag: member="pbx.h::ast_ignore_pattern" ref="aa73d176ed4f1ce51e5db6beafba45fe3" args="(const char *context, const char *pattern)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_ignore_pattern </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>pattern</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Checks to see if a <a class="el" href="structnumber.html" title="Number structure.">number</a> should be ignored. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>context</em>&nbsp;</td><td>context to search within </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pattern</em>&nbsp;</td><td>to check whether it should be ignored or not</td></tr>
  </table>
  </dd>
</dl>
<p>Check if a <a class="el" href="structnumber.html" title="Number structure.">number</a> should be ignored with respect to dialtone cancellation.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if the pattern should not be ignored </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>non-zero</em>&nbsp;</td><td>if the pattern should be ignored </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l07267">7267</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l02430">ast_context_find()</a>, <a class="el" href="pbx_8c_source.html#l02402">ast_extension_match()</a>, <a class="el" href="pbx_8c_source.html#l00847">ast_context::ignorepats</a>, <a class="el" href="pbx_8c_source.html#l00812">ast_ignorepat::next</a>, and <a class="el" href="pbx_8c_source.html#l00813">ast_ignorepat::pattern</a>.</p>

<p>Referenced by <a class="el" href="app_8c_source.html#l00076">ast_app_dtget()</a>, <a class="el" href="app__disa_8c_source.html#l00143">disa_exec()</a>, <a class="el" href="chan__iax2_8c_source.html#l08855">dp_lookup()</a>, <a class="el" href="pbx__dundi_8c_source.html#l00561">dundi_lookup_local()</a>, <a class="el" href="chan__skinny_8c_source.html#l05578">handle_enbloc_call_message()</a>, <a class="el" href="chan__skinny_8c_source.html#l05662">handle_soft_key_event_message()</a>, <a class="el" href="chan__skinny_8c_source.html#l04699">handle_stimulus_message()</a>, <a class="el" href="chan__mgcp_8c_source.html#l02637">mgcp_ss()</a>, <a class="el" href="chan__skinny_8c_source.html#l03619">skinny_ss()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l07268"></a>07268 {
<a name="l07269"></a>07269    <span class="keyword">struct </span><a class="code" href="structast__context.html" title="ast_context: An extension context">ast_context</a> *con = <a class="code" href="pbx_8h.html#a2af2d2771e5347b18454a05dbc98e35f" title="Find a context.">ast_context_find</a>(<a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>);
<a name="l07270"></a>07270    <span class="keywordflow">if</span> (con) {
<a name="l07271"></a>07271       <span class="keyword">struct </span><a class="code" href="structast__ignorepat.html" title="ast_ignorepat: Ignore patterns in dial plan">ast_ignorepat</a> *pat;
<a name="l07272"></a>07272       <span class="keywordflow">for</span> (pat = con-&gt;<a class="code" href="structast__context.html#aedb0afcd332920e51d2f82860f794347">ignorepats</a>; pat; pat = pat-&gt;<a class="code" href="structast__ignorepat.html#a8ffe03069b70f493ab982ba43faced7f">next</a>) {
<a name="l07273"></a>07273          <span class="keywordflow">if</span> (<a class="code" href="pbx_8h.html#a94cf2f099462a906620b5566871af797" title="Determine if a given extension matches a given pattern (in NXX format).">ast_extension_match</a>(pat-&gt;<a class="code" href="structast__ignorepat.html#a22c50d97e30c98ae5e62eaed74605c78">pattern</a>, <a class="code" href="structast__ignorepat.html#a22c50d97e30c98ae5e62eaed74605c78">pattern</a>))
<a name="l07274"></a>07274             <span class="keywordflow">return</span> 1;
<a name="l07275"></a>07275       }
<a name="l07276"></a>07276    }
<a name="l07277"></a>07277 
<a name="l07278"></a>07278    <span class="keywordflow">return</span> 0;
<a name="l07279"></a>07279 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac359af75b9494f50904583d2168a7577"></a><!-- doxytag: member="pbx.h::ast_matchmore_extension" ref="ac359af75b9494f50904583d2168a7577" args="(struct ast_channel *c, const char *context, const char *exten, int priority, const char *callerid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_matchmore_extension </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>exten</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>priority</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>callerid</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Looks to see if adding anything to this <a class="el" href="structextension.html">extension</a> might match something. (exists ^ canmatch). </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>c</em>&nbsp;</td><td>not really important XXX </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>context</em>&nbsp;</td><td>context to serach within </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>exten</em>&nbsp;</td><td><a class="el" href="structextension.html">extension</a> to check </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>priority</em>&nbsp;</td><td>priority of <a class="el" href="structextension.html">extension</a> path </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>callerid</em>&nbsp;</td><td>callerid of <a class="el" href="structextension.html">extension</a> being searched for</td></tr>
  </table>
  </dd>
</dl>
<dl class="note"><dt><b>Note:</b></dt><dd>It is possible for autoservice to be started and stopped on c during this function call, it is important that c is not locked prior to calling this. Otherwise a deadlock may occur</dd></dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>If "exten" *could match* a valid <a class="el" href="structextension.html">extension</a> in this context with some more digits, return non-zero. Does NOT return non-zero if this is an exact-match only. Basically, when this returns 0, no matter what you add to exten, it's not going to be a valid <a class="el" href="structextension.html">extension</a> anymore </dd></dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l04163">4163</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="extconf_8h_source.html#l00216">E_MATCHMORE</a>, and <a class="el" href="pbx_8c_source.html#l03647">pbx_extension_helper()</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l04214">__ast_pbx_run()</a>, <a class="el" href="app_8c_source.html#l00076">ast_app_dtget()</a>, <a class="el" href="pbx_8c_source.html#l04188">collect_digits()</a>, <a class="el" href="app__disa_8c_source.html#l00143">disa_exec()</a>, <a class="el" href="chan__iax2_8c_source.html#l08855">dp_lookup()</a>, <a class="el" href="pbx__dundi_8c_source.html#l00561">dundi_lookup_local()</a>, <a class="el" href="app__rpt_8c_source.html#l06676">handle_link_data()</a>, <a class="el" href="app__rpt_8c_source.html#l07021">handle_link_phone_dtmf()</a>, <a class="el" href="app__rpt_8c_source.html#l10410">local_dtmf_helper()</a>, <a class="el" href="pbx__loopback_8c_source.html#l00152">loopback_matchmore()</a>, <a class="el" href="chan__mgcp_8c_source.html#l02637">mgcp_ss()</a>, <a class="el" href="pbx_8c_source.html#l08798">pbx_builtin_background()</a>, <a class="el" href="app__readexten_8c_source.html#l00128">readexten_exec()</a>, <a class="el" href="chan__skinny_8c_source.html#l03619">skinny_ss()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04164"></a>04164 {
<a name="l04165"></a>04165    <span class="keywordflow">return</span> <a class="code" href="pbx_8c.html#ae381d99bea85b43f022470b64171018d" title="The return value depends on the action:.">pbx_extension_helper</a>(c, NULL, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, priority, NULL, callerid, <a class="code" href="extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7e20dcb277877b81e8099470cd631277">E_MATCHMORE</a>, 0, 0);
<a name="l04166"></a>04166 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a833a703b21d8f6bcb9f68e57185bca67"></a><!-- doxytag: member="pbx.h::ast_merge_contexts_and_delete" ref="a833a703b21d8f6bcb9f68e57185bca67" args="(struct ast_context **extcontexts, struct ast_hashtab *exttable, const char *registrar)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_merge_contexts_and_delete </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__context.html">ast_context</a> **&nbsp;</td>
          <td class="paramname"> <em>extcontexts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__hashtab.html">ast_hashtab</a> *&nbsp;</td>
          <td class="paramname"> <em>exttable</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>registrar</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Merge the temporary contexts into a global contexts list and delete from the global list the ones that are being added. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>extcontexts</em>&nbsp;</td><td>pointer to the <a class="el" href="structast__context.html" title="ast_context: An extension context">ast_context</a> structure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>exttable</em>&nbsp;</td><td>pointer to the <a class="el" href="structast__hashtab.html">ast_hashtab</a> structure that contains all the elements in extcontexts </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>registrar</em>&nbsp;</td><td>of the context; if it's set the routine will delete all contexts that belong to that registrar; if NULL only the contexts that are specified in extcontexts </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l06623">6623</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l08229">__ast_internal_context_destroy()</a>, <a class="el" href="pbx_8c_source.html#l00776">ast_exten::app</a>, <a class="el" href="pbx_8c_source.html#l07286">ast_add_extension_nolock()</a>, <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="pbx_8h_source.html#l00056">AST_EXTENSION_REMOVED</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="utils_8h_source.html#l00415">ast_free_ptr()</a>, <a class="el" href="hashtab_8c_source.html#l00384">ast_hashtab_destroy()</a>, <a class="el" href="hashtab_8c_source.html#l00742">ast_hashtab_end_traversal()</a>, <a class="el" href="hashtab_8c_source.html#l00749">ast_hashtab_next()</a>, <a class="el" href="hashtab_8c_source.html#l00692">ast_hashtab_start_traversal()</a>, <a class="el" href="pbx_8c_source.html#l03755">ast_hint_extension_nolock()</a>, <a class="el" href="linkedlists_8h_source.html#l00767">AST_LIST_APPEND_LIST</a>, <a class="el" href="linkedlists_8h_source.html#l00449">AST_LIST_EMPTY</a>, <a class="el" href="linkedlists_8h_source.html#l00233">AST_LIST_HEAD_INIT_VALUE</a>, <a class="el" href="linkedlists_8h_source.html#l00695">AST_LIST_INSERT_HEAD</a>, <a class="el" href="linkedlists_8h_source.html#l00817">AST_LIST_REMOVE_HEAD</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="pbx_8c_source.html#l09353">ast_rdlock_contexts()</a>, <a class="el" href="linkedlists_8h_source.html#l00493">AST_RWLIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="time_8h_source.html#l00070">ast_tvdiff_us()</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="pbx_8c_source.html#l09358">ast_unlock_contexts()</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="pbx_8c_source.html#l09345">ast_wrlock_contexts()</a>, <a class="el" href="pbx_8c_source.html#l09337">ast_wrlock_contexts_version()</a>, <a class="el" href="pbx_8c_source.html#l00875">ast_state_cb::callback</a>, <a class="el" href="structast__hint.html#aa3e3352bf7668925eba2e02ccdaf017a">ast_hint::callbacks</a>, <a class="el" href="pbx_8c_source.html#l06539">context_merge()</a>, <a class="el" href="pbx_8c_source.html#l01119">contexts</a>, <a class="el" href="pbx_8c_source.html#l01120">contexts_table</a>, <a class="el" href="pbx_8c_source.html#l00874">ast_state_cb::data</a>, <a class="el" href="pbx_8c_source.html#l00778">ast_exten::data</a>, <a class="el" href="extconf_8h_source.html#l00218">E_MATCH</a>, <a class="el" href="pbx_8c_source.html#l00770">ast_exten::exten</a>, <a class="el" href="pbx_8c_source.html#l00886">ast_hint::exten</a>, <a class="el" href="pbx_8c_source.html#l00887">ast_hint::laststate</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="pbx_8c_source.html#l00852">ast_context::name</a>, <a class="el" href="pbx_8c_source.html#l00845">ast_context::next</a>, <a class="el" href="pbx_8c_source.html#l00805">ast_sw::next</a>, <a class="el" href="pbx_8c_source.html#l00775">ast_exten::parent</a>, <a class="el" href="pbx_8c_source.html#l02469">pbx_find_extension()</a>, <a class="el" href="pbx_8h_source.html#l00049">PRIORITY_HINT</a>, <a class="el" href="pbx_8c_source.html#l00783">ast_exten::registrar</a>, and <a class="el" href="extconf_8h_source.html#l00234">pbx_find_info::stacklen</a>.</p>

<p>Referenced by <a class="el" href="pbx__lua_8c_source.html#l01026">lua_reload_extensions()</a>, and <a class="el" href="pbx__ael_8c_source.html#l00113">pbx_load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l06624"></a>06624 {
<a name="l06625"></a>06625    <span class="keywordtype">double</span> ft;
<a name="l06626"></a>06626    <span class="keyword">struct </span><a class="code" href="structast__context.html" title="ast_context: An extension context">ast_context</a> *tmp, *oldcontextslist;
<a name="l06627"></a>06627    <span class="keyword">struct </span><a class="code" href="structast__hashtab.html">ast_hashtab</a> *oldtable;
<a name="l06628"></a>06628    <span class="keyword">struct </span><a class="code" href="structstore__hints.html">store_hints</a> store = <a class="code" href="linkedlists_8h.html#a312e85d30d91d1db3ad0573c37c3f0cf" title="Defines initial values for a declaration of AST_LIST_HEAD.">AST_LIST_HEAD_INIT_VALUE</a>;
<a name="l06629"></a>06629    <span class="keyword">struct </span><a class="code" href="structstore__hint.html">store_hint</a> *<span class="keyword">this</span>;
<a name="l06630"></a>06630    <span class="keyword">struct </span><a class="code" href="structast__hint.html" title="Structure for dial plan hints.">ast_hint</a> *hint;
<a name="l06631"></a>06631    <span class="keyword">struct </span><a class="code" href="structast__exten.html" title="ast_exten: An extension The dialplan is saved as a linked list with each context...">ast_exten</a> *<a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>;
<a name="l06632"></a>06632    <span class="keywordtype">int</span> length;
<a name="l06633"></a>06633    <span class="keyword">struct </span><a class="code" href="structast__state__cb.html" title="ast_state_cb: An extension state notify register item">ast_state_cb</a> *thiscb;
<a name="l06634"></a>06634    <span class="keyword">struct </span><a class="code" href="structast__hashtab__iter.html" title="an iterator for traversing the buckets">ast_hashtab_iter</a> *iter;
<a name="l06635"></a>06635 
<a name="l06636"></a>06636    <span class="comment">/* it is very important that this function hold the hint list lock _and_ the conlock</span>
<a name="l06637"></a>06637 <span class="comment">      during its operation; not only do we need to ensure that the list of contexts</span>
<a name="l06638"></a>06638 <span class="comment">      and extensions does not change, but also that no hint callbacks (watchers) are</span>
<a name="l06639"></a>06639 <span class="comment">      added or removed during the merge/delete process</span>
<a name="l06640"></a>06640 <span class="comment"></span>
<a name="l06641"></a>06641 <span class="comment">      in addition, the locks _must_ be taken in this order, because there are already</span>
<a name="l06642"></a>06642 <span class="comment">      other code paths that use this order</span>
<a name="l06643"></a>06643 <span class="comment">   */</span>
<a name="l06644"></a>06644 
<a name="l06645"></a>06645    <span class="keyword">struct </span>timeval begintime, writelocktime, endlocktime, enddeltime;
<a name="l06646"></a>06646    <span class="keywordtype">int</span> wrlock_ver;
<a name="l06647"></a>06647 
<a name="l06648"></a>06648    begintime = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l06649"></a>06649    <a class="code" href="pbx_8h.html#aa2c309331fff0a086ab8e216f803d546" title="Read locks the context list.">ast_rdlock_contexts</a>();
<a name="l06650"></a>06650    iter = <a class="code" href="hashtab_8h.html#ac5a19bffadbbd4eb31f190e576f88512" title="Gives an iterator to hastable.">ast_hashtab_start_traversal</a>(<a class="code" href="pbx_8c.html#a4571322b2dc5414f61e4f3fe7af2331c">contexts_table</a>);
<a name="l06651"></a>06651    <span class="keywordflow">while</span> ((tmp = <a class="code" href="hashtab_8h.html#a43983b6169e9a0f9af48cca5cf9d3197" title="Gets the next object in the list, advances iter one step returns null on end of traversal...">ast_hashtab_next</a>(iter))) {
<a name="l06652"></a>06652       <a class="code" href="pbx_8c.html#a68752b8c650f91f9f3e36d6ce36bba2e">context_merge</a>(extcontexts, exttable, tmp, <a class="code" href="features_8c.html#ab990a3529ebde2681a00468cad7c0b48">registrar</a>);
<a name="l06653"></a>06653    }
<a name="l06654"></a>06654    <a class="code" href="hashtab_8h.html#a9c804e9bfc8355c25197187f0c6d0265" title="end the traversal, free the iterator, unlock if necc.">ast_hashtab_end_traversal</a>(iter);
<a name="l06655"></a>06655    wrlock_ver = <a class="code" href="pbx_8h.html#a4e6adb9c7783644ea993758d9c7e28c8">ast_wrlock_contexts_version</a>();
<a name="l06656"></a>06656 
<a name="l06657"></a>06657    <a class="code" href="pbx_8h.html#ae517a87b356aec60d5de4591ef94581b" title="Unlocks contexts.">ast_unlock_contexts</a>(); <span class="comment">/* this feels real retarded, but you must do</span>
<a name="l06658"></a>06658 <span class="comment">                       what you must do If this isn&apos;t done, the following </span>
<a name="l06659"></a>06659 <span class="comment">                        wrlock is a guraranteed deadlock */</span>
<a name="l06660"></a>06660    <a class="code" href="pbx_8h.html#a18c87dac5f7f4368c11b67d8026adc22" title="Write locks the context list.">ast_wrlock_contexts</a>();
<a name="l06661"></a>06661    <span class="keywordflow">if</span> (<a class="code" href="pbx_8h.html#a4e6adb9c7783644ea993758d9c7e28c8">ast_wrlock_contexts_version</a>() &gt; wrlock_ver+1) {
<a name="l06662"></a>06662       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,<span class="stringliteral">&quot;==================!!!!!!!!!!!!!!!Something changed the contexts in the middle of merging contexts!\n&quot;</span>);
<a name="l06663"></a>06663    }
<a name="l06664"></a>06664 
<a name="l06665"></a>06665    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structhints.html">hints</a>);
<a name="l06666"></a>06666    writelocktime = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l06667"></a>06667 
<a name="l06668"></a>06668    <span class="comment">/* preserve all watchers for hints */</span>
<a name="l06669"></a>06669    <a class="code" href="linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;<a class="code" href="structhints.html">hints</a>, hint, list) {
<a name="l06670"></a>06670       <span class="keywordflow">if</span> (!<a class="code" href="linkedlists_8h.html#a4a1884cde93e53bef32ca85c194a1d05" title="Checks whether the specified list contains any entries.">AST_LIST_EMPTY</a>(&amp;hint-&gt;<a class="code" href="structast__hint.html#aa3e3352bf7668925eba2e02ccdaf017a">callbacks</a>)) {
<a name="l06671"></a>06671          length = strlen(hint-&gt;<a class="code" href="structast__hint.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>-&gt;<a class="code" href="structast__exten.html#a9c2cb8c1611452928af0def998e36335">exten</a>) + strlen(hint-&gt;<a class="code" href="structast__hint.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>-&gt;<a class="code" href="structast__exten.html#a7733606f3f625c2782402ba971995641">parent</a>-&gt;<a class="code" href="structast__context.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>) + 2 + <span class="keyword">sizeof</span>(*this);
<a name="l06672"></a>06672          <span class="keywordflow">if</span> (!(<span class="keyword">this</span> = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, length)))
<a name="l06673"></a>06673             <span class="keywordflow">continue</span>;
<a name="l06674"></a>06674          <span class="comment">/* this removes all the callbacks from the hint into this. */</span>
<a name="l06675"></a>06675          <a class="code" href="linkedlists_8h.html#ad66405f1d0b9e1fb484643d9a36e94ed" title="Appends a whole list to the tail of a list.">AST_LIST_APPEND_LIST</a>(&amp;this-&gt;callbacks, &amp;hint-&gt;<a class="code" href="structast__hint.html#aa3e3352bf7668925eba2e02ccdaf017a">callbacks</a>, entry);
<a name="l06676"></a>06676          this-&gt;laststate = hint-&gt;<a class="code" href="structast__hint.html#a0078d2e3ae10f15d7634c01199f33d4f">laststate</a>;
<a name="l06677"></a>06677          this-&gt;<a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a> = this-&gt;data;
<a name="l06678"></a>06678          strcpy(this-&gt;data, hint-&gt;<a class="code" href="structast__hint.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>-&gt;<a class="code" href="structast__exten.html#a7733606f3f625c2782402ba971995641">parent</a>-&gt;<a class="code" href="structast__context.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>);
<a name="l06679"></a>06679          this-&gt;exten = this-&gt;data + strlen(this-&gt;<a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>) + 1;
<a name="l06680"></a>06680          strcpy(this-&gt;exten, hint-&gt;<a class="code" href="structast__hint.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>-&gt;<a class="code" href="structast__exten.html#a9c2cb8c1611452928af0def998e36335">exten</a>);
<a name="l06681"></a>06681          <a class="code" href="linkedlists_8h.html#aa2ded2af046bb513f77056c27c083307" title="Inserts a list entry at the head of a list.">AST_LIST_INSERT_HEAD</a>(&amp;store, <span class="keyword">this</span>, list);
<a name="l06682"></a>06682       }
<a name="l06683"></a>06683    }
<a name="l06684"></a>06684 
<a name="l06685"></a>06685    <span class="comment">/* save the old table and list */</span>
<a name="l06686"></a>06686    oldtable = <a class="code" href="pbx_8c.html#a4571322b2dc5414f61e4f3fe7af2331c">contexts_table</a>;
<a name="l06687"></a>06687    oldcontextslist = <a class="code" href="pbx_8c.html#aae85d5aab50f2d1b8392d6df276f2561">contexts</a>;
<a name="l06688"></a>06688 
<a name="l06689"></a>06689    <span class="comment">/* move in the new table and list */</span>
<a name="l06690"></a>06690    <a class="code" href="pbx_8c.html#a4571322b2dc5414f61e4f3fe7af2331c">contexts_table</a> = exttable;
<a name="l06691"></a>06691    <a class="code" href="pbx_8c.html#aae85d5aab50f2d1b8392d6df276f2561">contexts</a> = *extcontexts;
<a name="l06692"></a>06692 
<a name="l06693"></a>06693    <span class="comment">/* restore the watchers for hints that can be found; notify those that</span>
<a name="l06694"></a>06694 <span class="comment">      cannot be restored</span>
<a name="l06695"></a>06695 <span class="comment">   */</span>
<a name="l06696"></a>06696    <span class="keywordflow">while</span> ((<span class="keyword">this</span> = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;store, list))) {
<a name="l06697"></a>06697       <span class="keyword">struct </span><a class="code" href="structpbx__find__info.html">pbx_find_info</a> q = { .stacklen = 0 };
<a name="l06698"></a>06698       exten = <a class="code" href="pbx_8h.html#a63e03245dc48558e55da8890b3dbb87e">pbx_find_extension</a>(NULL, NULL, &amp;q, this-&gt;<a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, this-&gt;exten, <a class="code" href="pbx_8h.html#ad2e753a683024fad0b34ece3b1aef83a">PRIORITY_HINT</a>, NULL, <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea2e605157e82dec388ffc89c1694fb7be">E_MATCH</a>);
<a name="l06699"></a>06699       <span class="comment">/* If this is a pattern, dynamically create a new extension for this</span>
<a name="l06700"></a>06700 <span class="comment">       * particular match.  Note that this will only happen once for each</span>
<a name="l06701"></a>06701 <span class="comment">       * individual extension, because the pattern will no longer match first.</span>
<a name="l06702"></a>06702 <span class="comment">       */</span>
<a name="l06703"></a>06703       <span class="keywordflow">if</span> (exten &amp;&amp; exten-&gt;<a class="code" href="structast__exten.html#a9c2cb8c1611452928af0def998e36335">exten</a>[0] == <span class="charliteral">&apos;_&apos;</span>) {
<a name="l06704"></a>06704          <a class="code" href="pbx_8c.html#a62350bf22ada5eec5dcb16986c1909b9">ast_add_extension_nolock</a>(exten-&gt;<a class="code" href="structast__exten.html#a7733606f3f625c2782402ba971995641">parent</a>-&gt;<a class="code" href="structast__context.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>, 0, this-&gt;exten, <a class="code" href="pbx_8h.html#ad2e753a683024fad0b34ece3b1aef83a">PRIORITY_HINT</a>, NULL,
<a name="l06705"></a>06705             0, exten-&gt;<a class="code" href="structast__exten.html#a83a793edb3d6a3a15f2a7fc99ffe8c90">app</a>, <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(exten-&gt;<a class="code" href="structast__exten.html#a735984d41155bc1032e09bece8f8d66d">data</a>), <a class="code" href="utils_8h.html#a4e6aceb50eca868b7c38064c6c1a4789" title="free() wrapper">ast_free_ptr</a>, exten-&gt;<a class="code" href="structast__exten.html#aa05090666ce7a4905fe1b56b4fdd3be3">registrar</a>);
<a name="l06706"></a>06706          <span class="comment">/* rwlocks are not recursive locks */</span>
<a name="l06707"></a>06707          exten = <a class="code" href="pbx_8c.html#ad121506517c1a92626d906f787f17358" title="Find hint for given extension in context.">ast_hint_extension_nolock</a>(NULL, this-&gt;<a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, this-&gt;exten);
<a name="l06708"></a>06708       }
<a name="l06709"></a>06709 
<a name="l06710"></a>06710       <span class="comment">/* Find the hint in the list of hints */</span>
<a name="l06711"></a>06711       <a class="code" href="linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;<a class="code" href="structhints.html">hints</a>, hint, list) {
<a name="l06712"></a>06712          <span class="keywordflow">if</span> (hint-&gt;<a class="code" href="structast__hint.html#afc8cfd0aed370c037cd78797da3313e7">exten</a> == exten)
<a name="l06713"></a>06713             <span class="keywordflow">break</span>;
<a name="l06714"></a>06714       }
<a name="l06715"></a>06715       <span class="keywordflow">if</span> (!exten || !hint) {
<a name="l06716"></a>06716          <span class="comment">/* this hint has been removed, notify the watchers */</span>
<a name="l06717"></a>06717          <span class="keywordflow">while</span> ((thiscb = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;this-&gt;callbacks, entry))) {
<a name="l06718"></a>06718             thiscb-&gt;<a class="code" href="structast__state__cb.html#a51f35e8871a0e589626a6c24024a2e17">callback</a>(this-&gt;<a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, this-&gt;exten, <a class="code" href="pbx_8h.html#a7e545df4a5f38ef25616c7bdf55d625fa3e2a2f5572580f74e94b6d5e80261ea7">AST_EXTENSION_REMOVED</a>, thiscb-&gt;<a class="code" href="structast__state__cb.html#a735984d41155bc1032e09bece8f8d66d">data</a>);
<a name="l06719"></a>06719             <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(thiscb);
<a name="l06720"></a>06720          }
<a name="l06721"></a>06721       } <span class="keywordflow">else</span> {
<a name="l06722"></a>06722          <a class="code" href="linkedlists_8h.html#ad66405f1d0b9e1fb484643d9a36e94ed" title="Appends a whole list to the tail of a list.">AST_LIST_APPEND_LIST</a>(&amp;hint-&gt;<a class="code" href="structast__hint.html#aa3e3352bf7668925eba2e02ccdaf017a">callbacks</a>, &amp;this-&gt;<a class="code" href="structast__hint.html#aa3e3352bf7668925eba2e02ccdaf017a">callbacks</a>, entry);
<a name="l06723"></a>06723          hint-&gt;<a class="code" href="structast__hint.html#a0078d2e3ae10f15d7634c01199f33d4f">laststate</a> = this-&gt;laststate;
<a name="l06724"></a>06724       }
<a name="l06725"></a>06725       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(<span class="keyword">this</span>);
<a name="l06726"></a>06726    }
<a name="l06727"></a>06727 
<a name="l06728"></a>06728    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structhints.html">hints</a>);
<a name="l06729"></a>06729    <a class="code" href="pbx_8h.html#ae517a87b356aec60d5de4591ef94581b" title="Unlocks contexts.">ast_unlock_contexts</a>();
<a name="l06730"></a>06730    endlocktime = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l06731"></a>06731 
<a name="l06732"></a>06732    <span class="comment">/* the old list and hashtab no longer are relevant, delete them while the rest of asterisk</span>
<a name="l06733"></a>06733 <span class="comment">      is now freely using the new stuff instead */</span>
<a name="l06734"></a>06734 
<a name="l06735"></a>06735    <a class="code" href="hashtab_8h.html#a6103589badf8d9440a0cece2802c4c3a" title="This func will free the hash table and all its memory.">ast_hashtab_destroy</a>(oldtable, NULL);
<a name="l06736"></a>06736 
<a name="l06737"></a>06737    <span class="keywordflow">for</span> (tmp = oldcontextslist; tmp; ) {
<a name="l06738"></a>06738       <span class="keyword">struct </span><a class="code" href="structast__context.html" title="ast_context: An extension context">ast_context</a> *<a class="code" href="structast__context.html#a0d9eeadf3cb7b27fdcf4f70247dceec6">next</a>;  <span class="comment">/* next starting point */</span>
<a name="l06739"></a>06739       next = tmp-&gt;<a class="code" href="structast__context.html#a0d9eeadf3cb7b27fdcf4f70247dceec6">next</a>;
<a name="l06740"></a>06740       <a class="code" href="pbx_8c.html#af51adb9b78f628397d7b0c1781b6d79e">__ast_internal_context_destroy</a>(tmp);
<a name="l06741"></a>06741       tmp = next;
<a name="l06742"></a>06742    }
<a name="l06743"></a>06743    enddeltime = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l06744"></a>06744 
<a name="l06745"></a>06745    ft = <a class="code" href="time_8h.html#a140711bcdd1612c6baafc3e92c54caa1" title="Computes the difference (in microseconds) between two struct timeval instances.">ast_tvdiff_us</a>(writelocktime, begintime);
<a name="l06746"></a>06746    ft /= 1000000.0;
<a name="l06747"></a>06747    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3,<span class="stringliteral">&quot;Time to scan old dialplan and merge leftovers back into the new: %8.6f sec\n&quot;</span>, ft);
<a name="l06748"></a>06748 
<a name="l06749"></a>06749    ft = <a class="code" href="time_8h.html#a140711bcdd1612c6baafc3e92c54caa1" title="Computes the difference (in microseconds) between two struct timeval instances.">ast_tvdiff_us</a>(endlocktime, writelocktime);
<a name="l06750"></a>06750    ft /= 1000000.0;
<a name="l06751"></a>06751    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3,<span class="stringliteral">&quot;Time to restore hints and swap in new dialplan: %8.6f sec\n&quot;</span>, ft);
<a name="l06752"></a>06752 
<a name="l06753"></a>06753    ft = <a class="code" href="time_8h.html#a140711bcdd1612c6baafc3e92c54caa1" title="Computes the difference (in microseconds) between two struct timeval instances.">ast_tvdiff_us</a>(enddeltime, endlocktime);
<a name="l06754"></a>06754    ft /= 1000000.0;
<a name="l06755"></a>06755    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3,<span class="stringliteral">&quot;Time to delete the old dialplan: %8.6f sec\n&quot;</span>, ft);
<a name="l06756"></a>06756 
<a name="l06757"></a>06757    ft = <a class="code" href="time_8h.html#a140711bcdd1612c6baafc3e92c54caa1" title="Computes the difference (in microseconds) between two struct timeval instances.">ast_tvdiff_us</a>(enddeltime, begintime);
<a name="l06758"></a>06758    ft /= 1000000.0;
<a name="l06759"></a>06759    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3,<span class="stringliteral">&quot;Total time merge_contexts_delete: %8.6f sec\n&quot;</span>, ft);
<a name="l06760"></a>06760    <span class="keywordflow">return</span>;
<a name="l06761"></a>06761 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae9b65b0515d88371a5293dd354bfd92f"></a><!-- doxytag: member="pbx.h::ast_parseable_goto" ref="ae9b65b0515d88371a5293dd354bfd92f" args="(struct ast_channel *chan, const char *goto_string)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_parseable_goto </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>goto_string</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl class="note"><dt><b>Note:</b></dt><dd>This function will handle locking the channel as needed. </dd></dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09633">9633</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l09580">pbx_parseable_goto()</a>.</p>

<p>Referenced by <a class="el" href="app__while_8c_source.html#l00189">_while_exec()</a>, <a class="el" href="features_8c_source.html#l00366">check_goto_on_transfer()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="app__stack_8c_source.html#l00328">gosub_exec()</a>, <a class="el" href="app_8c_source.html#l01540">ivr_dispatch()</a>, <a class="el" href="app__parkandannounce_8c_source.html#l00088">parkandannounce_exec()</a>, <a class="el" href="pbx_8c_source.html#l08911">pbx_builtin_goto()</a>, and <a class="el" href="app__while_8c_source.html#l00311">while_continue_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09634"></a>09634 {
<a name="l09635"></a>09635    <span class="keywordflow">return</span> <a class="code" href="pbx_8c.html#aa18771ce9668fbafeb630ce5c802e6f8">pbx_parseable_goto</a>(chan, goto_string, 0);
<a name="l09636"></a>09636 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ade584ae5e3eafb878535626ebe79e26d"></a><!-- doxytag: member="pbx.h::ast_pbx_outgoing_app" ref="ade584ae5e3eafb878535626ebe79e26d" args="(const char *type, int format, void *data, int timeout, const char *app, const char *appdata, int *reason, int sync, const char *cid_num, const char *cid_name, struct ast_variable *vars, const char *account, struct ast_channel **locked_channel)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_pbx_outgoing_app </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>format</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>timeout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>app</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>appdata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>reason</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>sync</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>cid_num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>cid_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__variable.html">ast_variable</a> *&nbsp;</td>
          <td class="paramname"> <em>vars</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>account</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> **&nbsp;</td>
          <td class="paramname"> <em>locked_channel</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Synchronously or asynchronously make an outbound call and send it to a particular application with given <a class="el" href="structextension.html">extension</a> </p>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l08106">8106</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l03851">__ast_request_and_dial()</a>, <a class="el" href="channel_8h_source.html#l00469">ast_channel::_state</a>, <a class="el" href="channel_8h_source.html#l00619">outgoing_helper::account</a>, <a class="el" href="pbx_8c_source.html#l07849">async_stat::app</a>, <a class="el" href="pbx_8c_source.html#l08084">app_tmp::app</a>, <a class="el" href="pbx_8c_source.html#l07850">async_stat::appdata</a>, <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="cdr_8c_source.html#l00746">ast_cdr_disposition()</a>, <a class="el" href="cdr_8c_source.html#l00715">ast_cdr_failed()</a>, <a class="el" href="cdr_8c_source.html#l00936">ast_cdr_setaccount()</a>, <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="channel_8c_source.html#l01690">ast_hangup()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="pbx_8c_source.html#l07914">ast_pbx_outgoing_cdr_failed()</a>, <a class="el" href="pbx_8c_source.html#l08091">ast_pbx_run_app()</a>, <a class="el" href="utils_8h_source.html#l00380">ast_pthread_create_detached</a>, <a class="el" href="channel_8c_source.html#l05592">ast_set_variables()</a>, <a class="el" href="channel_8h_source.html#l00365">AST_STATE_UP</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="config_8c_source.html#l00397">ast_variables_destroy()</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="pbx_8c_source.html#l07853">async_wait()</a>, <a class="el" href="channel_8h_source.html#l00422">ast_channel::cdr</a>, <a class="el" href="pbx_8c_source.html#l07844">async_stat::chan</a>, <a class="el" href="pbx_8c_source.html#l08086">app_tmp::chan</a>, <a class="el" href="pbx_8c_source.html#l08085">app_tmp::data</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="channel_8h_source.html#l00479">ast_channel::hangupcause</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="pbx_8c_source.html#l07843">async_stat::p</a>, <a class="el" href="pbx_8c_source.html#l08087">app_tmp::t</a>, <a class="el" href="pbx_8c_source.html#l07848">async_stat::timeout</a>, and <a class="el" href="channel_8h_source.html#l00620">outgoing_helper::vars</a>.</p>

<p>Referenced by <a class="el" href="manager_8c_source.html#l02392">action_originate()</a>, <a class="el" href="pbx__spool_8c_source.html#l00325">attempt_thread()</a>, <a class="el" href="manager_8c_source.html#l02329">fast_originate()</a>, <a class="el" href="res__clioriginate_8c_source.html#l00050">orig_app()</a>, and <a class="el" href="app__originate_8c_source.html#l00092">originate_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l08107"></a>08107 {
<a name="l08108"></a>08108    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>;
<a name="l08109"></a>08109    <span class="keyword">struct </span><a class="code" href="structapp__tmp.html">app_tmp</a> *tmp;
<a name="l08110"></a>08110    <span class="keywordtype">int</span> res = -1, cdr_res = -1;
<a name="l08111"></a>08111    <span class="keyword">struct </span><a class="code" href="structoutgoing__helper.html">outgoing_helper</a> oh;
<a name="l08112"></a>08112 
<a name="l08113"></a>08113    memset(&amp;oh, 0, <span class="keyword">sizeof</span>(oh));
<a name="l08114"></a>08114    oh.vars = vars;
<a name="l08115"></a>08115    oh.account = <a class="code" href="structoutgoing__helper.html#a54735dbbeb30eacadc7e823d15cf03c6">account</a>;
<a name="l08116"></a>08116 
<a name="l08117"></a>08117    <span class="keywordflow">if</span> (locked_channel)
<a name="l08118"></a>08118       *locked_channel = NULL;
<a name="l08119"></a>08119    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="adsistub_8c.html#ad194d73de26c0d836555e029d245493d">app</a>)) {
<a name="l08120"></a>08120       res = -1;
<a name="l08121"></a>08121       <span class="keywordflow">goto</span> outgoing_app_cleanup;
<a name="l08122"></a>08122    }
<a name="l08123"></a>08123    <span class="keywordflow">if</span> (synchronous) {
<a name="l08124"></a>08124       chan = <a class="code" href="channel_8h.html#ad95519a1a1059cd3561ec5ae6c9a2e93" title="Request a channel of a given type, with data as optional information used by the...">__ast_request_and_dial</a>(<a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>, <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>, data, timeout, reason, <a class="code" href="chan__mgcp_8c.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>, <a class="code" href="chan__mgcp_8c.html#ade5a89f9bee15a492c760ec1765a292d">cid_name</a>, &amp;oh);
<a name="l08125"></a>08125       <span class="keywordflow">if</span> (chan) {
<a name="l08126"></a>08126          <a class="code" href="channel_8h.html#a5b14bfe21364dd8f73d45f15cf313524" title="adds a list of channel variables to a channel">ast_set_variables</a>(chan, vars);
<a name="l08127"></a>08127          <span class="keywordflow">if</span> (<a class="code" href="structoutgoing__helper.html#a54735dbbeb30eacadc7e823d15cf03c6">account</a>)
<a name="l08128"></a>08128             <a class="code" href="cdr_8h.html#af6bbc762c1482a5489a761733d785813" title="Set account code, will generate AMI event.">ast_cdr_setaccount</a>(chan, <a class="code" href="structoutgoing__helper.html#a54735dbbeb30eacadc7e823d15cf03c6">account</a>);
<a name="l08129"></a>08129          <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>) {
<a name="l08130"></a>08130             res = 0;
<a name="l08131"></a>08131             <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(4, <span class="stringliteral">&quot;Channel %s was answered.\n&quot;</span>, chan-&gt;name);
<a name="l08132"></a>08132             tmp = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*tmp));
<a name="l08133"></a>08133             <span class="keywordflow">if</span> (!tmp)
<a name="l08134"></a>08134                res = -1;
<a name="l08135"></a>08135             <span class="keywordflow">else</span> {
<a name="l08136"></a>08136                <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmp-&gt;<a class="code" href="structapp__tmp.html#a92669f702fa7ba792683dc1775f54b3a">app</a>, <a class="code" href="adsistub_8c.html#ad194d73de26c0d836555e029d245493d">app</a>, <span class="keyword">sizeof</span>(tmp-&gt;<a class="code" href="structapp__tmp.html#a92669f702fa7ba792683dc1775f54b3a">app</a>));
<a name="l08137"></a>08137                <span class="keywordflow">if</span> (appdata)
<a name="l08138"></a>08138                   <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmp-&gt;<a class="code" href="structapp__tmp.html#a8014e17e1c0d6bbf7ec1aec8d167a963">data</a>, appdata, <span class="keyword">sizeof</span>(tmp-&gt;<a class="code" href="structapp__tmp.html#a8014e17e1c0d6bbf7ec1aec8d167a963">data</a>));
<a name="l08139"></a>08139                tmp-&gt;<a class="code" href="structapp__tmp.html#a84d1435c5b8d387806714ea7079304b7">chan</a> = chan;
<a name="l08140"></a>08140                <span class="keywordflow">if</span> (synchronous &gt; 1) {
<a name="l08141"></a>08141                   <span class="keywordflow">if</span> (locked_channel)
<a name="l08142"></a>08142                      <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l08143"></a>08143                   <a class="code" href="pbx_8c.html#a9c507fd424bcfbe9d23caf2dd3457168" title="run the application and free the descriptor once done">ast_pbx_run_app</a>(tmp);
<a name="l08144"></a>08144                } <span class="keywordflow">else</span> {
<a name="l08145"></a>08145                   <span class="keywordflow">if</span> (locked_channel)
<a name="l08146"></a>08146                      <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l08147"></a>08147                   <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a832647380b1f97e7ac1b4492f8816d46">ast_pthread_create_detached</a>(&amp;tmp-&gt;<a class="code" href="structapp__tmp.html#aa49d6a06775253352589280dc7f30018">t</a>, NULL, <a class="code" href="pbx_8c.html#a9c507fd424bcfbe9d23caf2dd3457168" title="run the application and free the descriptor once done">ast_pbx_run_app</a>, tmp)) {
<a name="l08148"></a>08148                      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to spawn execute thread on %s: %s\n&quot;</span>, chan-&gt;name, strerror(errno));
<a name="l08149"></a>08149                      <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(tmp);
<a name="l08150"></a>08150                      <span class="keywordflow">if</span> (locked_channel)
<a name="l08151"></a>08151                         <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l08152"></a>08152                      <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l08153"></a>08153                      res = -1;
<a name="l08154"></a>08154                   } <span class="keywordflow">else</span> {
<a name="l08155"></a>08155                      <span class="keywordflow">if</span> (locked_channel)
<a name="l08156"></a>08156                         *locked_channel = chan;
<a name="l08157"></a>08157                   }
<a name="l08158"></a>08158                }
<a name="l08159"></a>08159             }
<a name="l08160"></a>08160          } <span class="keywordflow">else</span> {
<a name="l08161"></a>08161             <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(4, <span class="stringliteral">&quot;Channel %s was never answered.\n&quot;</span>, chan-&gt;name);
<a name="l08162"></a>08162             <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>) { <span class="comment">/* update the cdr */</span>
<a name="l08163"></a>08163                <span class="comment">/* here we update the status of the call, which sould be busy.</span>
<a name="l08164"></a>08164 <span class="comment">                * if that fails then we set the status to failed */</span>
<a name="l08165"></a>08165                <span class="keywordflow">if</span> (<a class="code" href="cdr_8h.html#a5468ad8b7a45f1f976728be1b23dde47" title="Save the result of the call based on the AST_CAUSE_*.">ast_cdr_disposition</a>(chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>, chan-&gt;<a class="code" href="structast__channel.html#aa4261b664d6712ba8551bde24ad17382">hangupcause</a>))
<a name="l08166"></a>08166                   <a class="code" href="cdr_8h.html#acdce2d9d0af5180090b70149ce18e554" title="Fail a call.">ast_cdr_failed</a>(chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>);
<a name="l08167"></a>08167             }
<a name="l08168"></a>08168             <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l08169"></a>08169          }
<a name="l08170"></a>08170       }
<a name="l08171"></a>08171 
<a name="l08172"></a>08172       <span class="keywordflow">if</span> (res &lt; 0) { <span class="comment">/* the call failed for some reason */</span>
<a name="l08173"></a>08173          <span class="keywordflow">if</span> (*reason == 0) { <span class="comment">/* if the call failed (not busy or no answer)</span>
<a name="l08174"></a>08174 <span class="comment">                        * update the cdr with the failed message */</span>
<a name="l08175"></a>08175             cdr_res = <a class="code" href="pbx_8c.html#a5a3064670e827b600404223a674d8bd1" title="Function to post an empty cdr after a spool call fails.">ast_pbx_outgoing_cdr_failed</a>();
<a name="l08176"></a>08176             <span class="keywordflow">if</span> (cdr_res != 0) {
<a name="l08177"></a>08177                res = cdr_res;
<a name="l08178"></a>08178                <span class="keywordflow">goto</span> outgoing_app_cleanup;
<a name="l08179"></a>08179             }
<a name="l08180"></a>08180          }
<a name="l08181"></a>08181       }
<a name="l08182"></a>08182 
<a name="l08183"></a>08183    } <span class="keywordflow">else</span> {
<a name="l08184"></a>08184       <span class="keyword">struct </span><a class="code" href="structasync__stat.html">async_stat</a> *as;
<a name="l08185"></a>08185       <span class="keywordflow">if</span> (!(as = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*as)))) {
<a name="l08186"></a>08186          res = -1;
<a name="l08187"></a>08187          <span class="keywordflow">goto</span> outgoing_app_cleanup;
<a name="l08188"></a>08188       }
<a name="l08189"></a>08189       chan = <a class="code" href="channel_8h.html#ad95519a1a1059cd3561ec5ae6c9a2e93" title="Request a channel of a given type, with data as optional information used by the...">__ast_request_and_dial</a>(<a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>, <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>, data, <a class="code" href="structasync__stat.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a>, reason, <a class="code" href="chan__mgcp_8c.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>, <a class="code" href="chan__mgcp_8c.html#ade5a89f9bee15a492c760ec1765a292d">cid_name</a>, &amp;oh);
<a name="l08190"></a>08190       <span class="keywordflow">if</span> (!chan) {
<a name="l08191"></a>08191          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(as);
<a name="l08192"></a>08192          res = -1;
<a name="l08193"></a>08193          <span class="keywordflow">goto</span> outgoing_app_cleanup;
<a name="l08194"></a>08194       }
<a name="l08195"></a>08195       as-&gt;<a class="code" href="structasync__stat.html#a84d1435c5b8d387806714ea7079304b7">chan</a> = chan;
<a name="l08196"></a>08196       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(as-&gt;<a class="code" href="structasync__stat.html#aec08c35c18f813f66ece0fe52fed7a6d">app</a>, <a class="code" href="adsistub_8c.html#ad194d73de26c0d836555e029d245493d">app</a>, <span class="keyword">sizeof</span>(as-&gt;<a class="code" href="structasync__stat.html#aec08c35c18f813f66ece0fe52fed7a6d">app</a>));
<a name="l08197"></a>08197       <span class="keywordflow">if</span> (<a class="code" href="structasync__stat.html#a365df2111e505119a9cc91ea9e6d43bd">appdata</a>)
<a name="l08198"></a>08198          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(as-&gt;<a class="code" href="structasync__stat.html#a365df2111e505119a9cc91ea9e6d43bd">appdata</a>,  <a class="code" href="structasync__stat.html#a365df2111e505119a9cc91ea9e6d43bd">appdata</a>, <span class="keyword">sizeof</span>(as-&gt;<a class="code" href="structasync__stat.html#a365df2111e505119a9cc91ea9e6d43bd">appdata</a>));
<a name="l08199"></a>08199       as-&gt;<a class="code" href="structasync__stat.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a> = <a class="code" href="structasync__stat.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a>;
<a name="l08200"></a>08200       <a class="code" href="channel_8h.html#a5b14bfe21364dd8f73d45f15cf313524" title="adds a list of channel variables to a channel">ast_set_variables</a>(chan, vars);
<a name="l08201"></a>08201       <span class="keywordflow">if</span> (account)
<a name="l08202"></a>08202          <a class="code" href="cdr_8h.html#af6bbc762c1482a5489a761733d785813" title="Set account code, will generate AMI event.">ast_cdr_setaccount</a>(chan, account);
<a name="l08203"></a>08203       <span class="comment">/* Start a new thread, and get something handling this channel. */</span>
<a name="l08204"></a>08204       <span class="keywordflow">if</span> (locked_channel)
<a name="l08205"></a>08205          <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l08206"></a>08206       <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a832647380b1f97e7ac1b4492f8816d46">ast_pthread_create_detached</a>(&amp;as-&gt;<a class="code" href="structasync__stat.html#a1ad90c6e2b5f6774919078d93f443e30">p</a>, NULL, <a class="code" href="pbx_8c.html#a4f84706d30062086de7265597688040f">async_wait</a>, as)) {
<a name="l08207"></a>08207          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to start async wait\n&quot;</span>);
<a name="l08208"></a>08208          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(as);
<a name="l08209"></a>08209          <span class="keywordflow">if</span> (locked_channel)
<a name="l08210"></a>08210             <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l08211"></a>08211          <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l08212"></a>08212          res = -1;
<a name="l08213"></a>08213          <span class="keywordflow">goto</span> outgoing_app_cleanup;
<a name="l08214"></a>08214       } <span class="keywordflow">else</span> {
<a name="l08215"></a>08215          <span class="keywordflow">if</span> (locked_channel)
<a name="l08216"></a>08216             *locked_channel = chan;
<a name="l08217"></a>08217       }
<a name="l08218"></a>08218       res = 0;
<a name="l08219"></a>08219    }
<a name="l08220"></a>08220 outgoing_app_cleanup:
<a name="l08221"></a>08221    <a class="code" href="config_8h.html#ad3d8122172af6f13687a07840411d65d" title="Free variable list.">ast_variables_destroy</a>(vars);
<a name="l08222"></a>08222    <span class="keywordflow">return</span> res;
<a name="l08223"></a>08223 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7705e0c38bd69f8dceb03861f7527b60"></a><!-- doxytag: member="pbx.h::ast_pbx_outgoing_exten" ref="a7705e0c38bd69f8dceb03861f7527b60" args="(const char *type, int format, void *data, int timeout, const char *context, const char *exten, int priority, int *reason, int sync, const char *cid_num, const char *cid_name, struct ast_variable *vars, const char *account, struct ast_channel **locked_channel)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_pbx_outgoing_exten </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>format</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>timeout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>exten</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>priority</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>reason</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>sync</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>cid_num</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>cid_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__variable.html">ast_variable</a> *&nbsp;</td>
          <td class="paramname"> <em>vars</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>account</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> **&nbsp;</td>
          <td class="paramname"> <em>locked_channel</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Synchronously or asynchronously make an outbound call and send it to a particular <a class="el" href="structextension.html">extension</a> </p>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l07940">7940</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l03851">__ast_request_and_dial()</a>, <a class="el" href="channel_8h_source.html#l00469">ast_channel::_state</a>, <a class="el" href="channel_8h_source.html#l00619">outgoing_helper::account</a>, <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="cdr_8c_source.html#l00746">ast_cdr_disposition()</a>, <a class="el" href="cdr_8c_source.html#l00715">ast_cdr_failed()</a>, <a class="el" href="cdr_8c_source.html#l00936">ast_cdr_setaccount()</a>, <a class="el" href="channel_8h_source.html#l00730">ast_channel_alloc</a>, <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="pbx_8c_source.html#l04143">ast_exists_extension()</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="channel_8c_source.html#l01690">ast_hangup()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="pbx_8c_source.html#l07914">ast_pbx_outgoing_cdr_failed()</a>, <a class="el" href="pbx_8c_source.html#l04596">ast_pbx_run()</a>, <a class="el" href="pbx_8c_source.html#l04559">ast_pbx_start()</a>, <a class="el" href="utils_8h_source.html#l00380">ast_pthread_create_detached</a>, <a class="el" href="channel_8c_source.html#l03981">ast_request_and_dial()</a>, <a class="el" href="channel_8c_source.html#l05592">ast_set_variables()</a>, <a class="el" href="channel_8h_source.html#l00359">AST_STATE_DOWN</a>, <a class="el" href="channel_8h_source.html#l00365">AST_STATE_UP</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="config_8c_source.html#l00397">ast_variables_destroy()</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="pbx_8c_source.html#l07853">async_wait()</a>, <a class="el" href="channel_8h_source.html#l00422">ast_channel::cdr</a>, <a class="el" href="pbx_8c_source.html#l07844">async_stat::chan</a>, <a class="el" href="channel_8h_source.html#l00618">outgoing_helper::cid_name</a>, <a class="el" href="channel_8h_source.html#l00617">outgoing_helper::cid_num</a>, <a class="el" href="pbx_8c_source.html#l07845">async_stat::context</a>, <a class="el" href="channel_8h_source.html#l00503">ast_channel::context</a>, <a class="el" href="channel_8h_source.html#l00614">outgoing_helper::context</a>, <a class="el" href="channel_8h_source.html#l00615">outgoing_helper::exten</a>, <a class="el" href="channel_8h_source.html#l00479">ast_channel::hangupcause</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="pbx_8c_source.html#l07843">async_stat::p</a>, <a class="el" href="channel_8h_source.html#l00621">outgoing_helper::parent_channel</a>, <a class="el" href="pbx_8c_source.html#l09023">pbx_builtin_setvar_helper()</a>, <a class="el" href="channel_8h_source.html#l00616">outgoing_helper::priority</a>, <a class="el" href="pbx_8c_source.html#l04174">set_ext_pri()</a>, <a class="el" href="pbx_8c_source.html#l07848">async_stat::timeout</a>, and <a class="el" href="channel_8h_source.html#l00620">outgoing_helper::vars</a>.</p>

<p>Referenced by <a class="el" href="manager_8c_source.html#l02392">action_originate()</a>, <a class="el" href="pbx__spool_8c_source.html#l00325">attempt_thread()</a>, <a class="el" href="manager_8c_source.html#l02329">fast_originate()</a>, <a class="el" href="res__clioriginate_8c_source.html#l00080">orig_exten()</a>, and <a class="el" href="app__originate_8c_source.html#l00092">originate_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l07941"></a>07941 {
<a name="l07942"></a>07942    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>;
<a name="l07943"></a>07943    <span class="keyword">struct </span><a class="code" href="structasync__stat.html">async_stat</a> *as;
<a name="l07944"></a>07944    <span class="keywordtype">int</span> res = -1, cdr_res = -1;
<a name="l07945"></a>07945    <span class="keyword">struct </span><a class="code" href="structoutgoing__helper.html">outgoing_helper</a> oh;
<a name="l07946"></a>07946 
<a name="l07947"></a>07947    <span class="keywordflow">if</span> (synchronous) {
<a name="l07948"></a>07948       oh.<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a> = <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>;
<a name="l07949"></a>07949       oh.exten = <a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>;
<a name="l07950"></a>07950       oh.priority = <a class="code" href="structoutgoing__helper.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>;
<a name="l07951"></a>07951       oh.cid_num = <a class="code" href="chan__mgcp_8c.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>;
<a name="l07952"></a>07952       oh.cid_name = <a class="code" href="chan__mgcp_8c.html#ade5a89f9bee15a492c760ec1765a292d">cid_name</a>;
<a name="l07953"></a>07953       oh.account = <a class="code" href="structoutgoing__helper.html#a54735dbbeb30eacadc7e823d15cf03c6">account</a>;
<a name="l07954"></a>07954       oh.vars = vars;
<a name="l07955"></a>07955       oh.parent_channel = NULL;
<a name="l07956"></a>07956 
<a name="l07957"></a>07957       chan = <a class="code" href="channel_8h.html#ad95519a1a1059cd3561ec5ae6c9a2e93" title="Request a channel of a given type, with data as optional information used by the...">__ast_request_and_dial</a>(<a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>, <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>, data, timeout, reason, <a class="code" href="chan__mgcp_8c.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>, <a class="code" href="chan__mgcp_8c.html#ade5a89f9bee15a492c760ec1765a292d">cid_name</a>, &amp;oh);
<a name="l07958"></a>07958       <span class="keywordflow">if</span> (channel) {
<a name="l07959"></a>07959          *channel = chan;
<a name="l07960"></a>07960          <span class="keywordflow">if</span> (chan)
<a name="l07961"></a>07961             <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l07962"></a>07962       }
<a name="l07963"></a>07963       <span class="keywordflow">if</span> (chan) {
<a name="l07964"></a>07964          <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>) {
<a name="l07965"></a>07965                res = 0;
<a name="l07966"></a>07966             <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(4, <span class="stringliteral">&quot;Channel %s was answered.\n&quot;</span>, chan-&gt;name);
<a name="l07967"></a>07967 
<a name="l07968"></a>07968             <span class="keywordflow">if</span> (synchronous &gt; 1) {
<a name="l07969"></a>07969                <span class="keywordflow">if</span> (channel)
<a name="l07970"></a>07970                   <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l07971"></a>07971                <span class="keywordflow">if</span> (<a class="code" href="pbx_8h.html#a44b6406c9220f7f2b610ac712369f405" title="Execute the PBX in the current thread.">ast_pbx_run</a>(chan)) {
<a name="l07972"></a>07972                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to run PBX on %s\n&quot;</span>, chan-&gt;name);
<a name="l07973"></a>07973                   <span class="keywordflow">if</span> (channel)
<a name="l07974"></a>07974                      *channel = NULL;
<a name="l07975"></a>07975                   <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l07976"></a>07976                   chan = NULL;
<a name="l07977"></a>07977                   res = -1;
<a name="l07978"></a>07978                }
<a name="l07979"></a>07979             } <span class="keywordflow">else</span> {
<a name="l07980"></a>07980                <span class="keywordflow">if</span> (<a class="code" href="pbx_8h.html#a9a937fbb3b5f4e68880a9c5714a29ce5" title="Create a new thread and start the PBX.">ast_pbx_start</a>(chan)) {
<a name="l07981"></a>07981                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to start PBX on %s\n&quot;</span>, chan-&gt;name);
<a name="l07982"></a>07982                   <span class="keywordflow">if</span> (channel) {
<a name="l07983"></a>07983                      *channel = NULL;
<a name="l07984"></a>07984                      <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l07985"></a>07985                   }
<a name="l07986"></a>07986                   <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l07987"></a>07987                   res = -1;
<a name="l07988"></a>07988                }
<a name="l07989"></a>07989                chan = NULL;
<a name="l07990"></a>07990             }
<a name="l07991"></a>07991          } <span class="keywordflow">else</span> {
<a name="l07992"></a>07992             <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(4, <span class="stringliteral">&quot;Channel %s was never answered.\n&quot;</span>, chan-&gt;name);
<a name="l07993"></a>07993 
<a name="l07994"></a>07994             <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>) { <span class="comment">/* update the cdr */</span>
<a name="l07995"></a>07995                <span class="comment">/* here we update the status of the call, which sould be busy.</span>
<a name="l07996"></a>07996 <span class="comment">                * if that fails then we set the status to failed */</span>
<a name="l07997"></a>07997                <span class="keywordflow">if</span> (<a class="code" href="cdr_8h.html#a5468ad8b7a45f1f976728be1b23dde47" title="Save the result of the call based on the AST_CAUSE_*.">ast_cdr_disposition</a>(chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>, chan-&gt;<a class="code" href="structast__channel.html#aa4261b664d6712ba8551bde24ad17382">hangupcause</a>))
<a name="l07998"></a>07998                   <a class="code" href="cdr_8h.html#acdce2d9d0af5180090b70149ce18e554" title="Fail a call.">ast_cdr_failed</a>(chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>);
<a name="l07999"></a>07999             }
<a name="l08000"></a>08000 
<a name="l08001"></a>08001             <span class="keywordflow">if</span> (channel) {
<a name="l08002"></a>08002                *channel = NULL;
<a name="l08003"></a>08003                <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l08004"></a>08004             }
<a name="l08005"></a>08005             <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l08006"></a>08006             chan = NULL;
<a name="l08007"></a>08007          }
<a name="l08008"></a>08008       }
<a name="l08009"></a>08009 
<a name="l08010"></a>08010       <span class="keywordflow">if</span> (res &lt; 0) { <span class="comment">/* the call failed for some reason */</span>
<a name="l08011"></a>08011          <span class="keywordflow">if</span> (*reason == 0) { <span class="comment">/* if the call failed (not busy or no answer)</span>
<a name="l08012"></a>08012 <span class="comment">                        * update the cdr with the failed message */</span>
<a name="l08013"></a>08013             cdr_res = <a class="code" href="pbx_8c.html#a5a3064670e827b600404223a674d8bd1" title="Function to post an empty cdr after a spool call fails.">ast_pbx_outgoing_cdr_failed</a>();
<a name="l08014"></a>08014             <span class="keywordflow">if</span> (cdr_res != 0) {
<a name="l08015"></a>08015                res = cdr_res;
<a name="l08016"></a>08016                <span class="keywordflow">goto</span> outgoing_exten_cleanup;
<a name="l08017"></a>08017             }
<a name="l08018"></a>08018          }
<a name="l08019"></a>08019 
<a name="l08020"></a>08020          <span class="comment">/* create a fake channel and execute the &quot;failed&quot; extension (if it exists) within the requested context */</span>
<a name="l08021"></a>08021          <span class="comment">/* check if &quot;failed&quot; exists */</span>
<a name="l08022"></a>08022          <span class="keywordflow">if</span> (<a class="code" href="pbx_8h.html#a64a5b8fdc919806135ad427aca9e71b7" title="Determine whether an extension exists.">ast_exists_extension</a>(chan, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <span class="stringliteral">&quot;failed&quot;</span>, 1, NULL)) {
<a name="l08023"></a>08023             chan = <a class="code" href="channel_8h.html#adfbceb39821586c0f9be0c47496a4e18">ast_channel_alloc</a>(0, <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a81348336816e0a2f6f3a76da487a46dc">AST_STATE_DOWN</a>, 0, 0, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, 0, <span class="stringliteral">&quot;OutgoingSpoolFailed&quot;</span>);
<a name="l08024"></a>08024             <span class="keywordflow">if</span> (chan) {
<a name="l08025"></a>08025                <span class="keywordtype">char</span> failed_reason[4] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l08026"></a>08026                <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>))
<a name="l08027"></a>08027                   <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(chan-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <span class="keyword">sizeof</span>(chan-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>));
<a name="l08028"></a>08028                <a class="code" href="pbx_8c.html#ae269f012897ae046fe6e785ba8521c88">set_ext_pri</a>(chan, <span class="stringliteral">&quot;failed&quot;</span>, 1);
<a name="l08029"></a>08029                <a class="code" href="channel_8h.html#a5b14bfe21364dd8f73d45f15cf313524" title="adds a list of channel variables to a channel">ast_set_variables</a>(chan, vars);
<a name="l08030"></a>08030                snprintf(failed_reason, <span class="keyword">sizeof</span>(failed_reason), <span class="stringliteral">&quot;%d&quot;</span>, *reason);
<a name="l08031"></a>08031                <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;REASON&quot;</span>, failed_reason);
<a name="l08032"></a>08032                <span class="keywordflow">if</span> (<a class="code" href="structoutgoing__helper.html#a54735dbbeb30eacadc7e823d15cf03c6">account</a>)
<a name="l08033"></a>08033                   <a class="code" href="cdr_8h.html#af6bbc762c1482a5489a761733d785813" title="Set account code, will generate AMI event.">ast_cdr_setaccount</a>(chan, <a class="code" href="structoutgoing__helper.html#a54735dbbeb30eacadc7e823d15cf03c6">account</a>);
<a name="l08034"></a>08034                <span class="keywordflow">if</span> (<a class="code" href="pbx_8h.html#a44b6406c9220f7f2b610ac712369f405" title="Execute the PBX in the current thread.">ast_pbx_run</a>(chan)) {
<a name="l08035"></a>08035                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to run PBX on %s\n&quot;</span>, chan-&gt;name);
<a name="l08036"></a>08036                   <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l08037"></a>08037                }
<a name="l08038"></a>08038                chan = NULL;
<a name="l08039"></a>08039             }
<a name="l08040"></a>08040          }
<a name="l08041"></a>08041       }
<a name="l08042"></a>08042    } <span class="keywordflow">else</span> {
<a name="l08043"></a>08043       <span class="keywordflow">if</span> (!(as = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*as)))) {
<a name="l08044"></a>08044          res = -1;
<a name="l08045"></a>08045          <span class="keywordflow">goto</span> outgoing_exten_cleanup;
<a name="l08046"></a>08046       }
<a name="l08047"></a>08047       chan = <a class="code" href="channel_8h.html#a24294594867068bcff6adad3fb868a25" title="Request a channel of a given type, with data as optional information used by the...">ast_request_and_dial</a>(<a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>, <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>, data, timeout, reason, <a class="code" href="chan__mgcp_8c.html#a29e973bd94bfbaf59d939bd1bc988c32">cid_num</a>, <a class="code" href="chan__mgcp_8c.html#ade5a89f9bee15a492c760ec1765a292d">cid_name</a>);
<a name="l08048"></a>08048       <span class="keywordflow">if</span> (channel) {
<a name="l08049"></a>08049          *channel = chan;
<a name="l08050"></a>08050          <span class="keywordflow">if</span> (chan)
<a name="l08051"></a>08051             <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l08052"></a>08052       }
<a name="l08053"></a>08053       <span class="keywordflow">if</span> (!chan) {
<a name="l08054"></a>08054          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(as);
<a name="l08055"></a>08055          res = -1;
<a name="l08056"></a>08056          <span class="keywordflow">goto</span> outgoing_exten_cleanup;
<a name="l08057"></a>08057       }
<a name="l08058"></a>08058       as-&gt;<a class="code" href="structasync__stat.html#a84d1435c5b8d387806714ea7079304b7">chan</a> = chan;
<a name="l08059"></a>08059       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(as-&gt;<a class="code" href="structasync__stat.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <span class="keyword">sizeof</span>(as-&gt;<a class="code" href="structasync__stat.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>));
<a name="l08060"></a>08060       <a class="code" href="pbx_8c.html#ae269f012897ae046fe6e785ba8521c88">set_ext_pri</a>(as-&gt;<a class="code" href="structasync__stat.html#a84d1435c5b8d387806714ea7079304b7">chan</a>,  <a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, <a class="code" href="structoutgoing__helper.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>);
<a name="l08061"></a>08061       as-&gt;<a class="code" href="structasync__stat.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a> = timeout;
<a name="l08062"></a>08062       <a class="code" href="channel_8h.html#a5b14bfe21364dd8f73d45f15cf313524" title="adds a list of channel variables to a channel">ast_set_variables</a>(chan, vars);
<a name="l08063"></a>08063       <span class="keywordflow">if</span> (<a class="code" href="structoutgoing__helper.html#a54735dbbeb30eacadc7e823d15cf03c6">account</a>)
<a name="l08064"></a>08064          <a class="code" href="cdr_8h.html#af6bbc762c1482a5489a761733d785813" title="Set account code, will generate AMI event.">ast_cdr_setaccount</a>(chan, <a class="code" href="structoutgoing__helper.html#a54735dbbeb30eacadc7e823d15cf03c6">account</a>);
<a name="l08065"></a>08065       <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a832647380b1f97e7ac1b4492f8816d46">ast_pthread_create_detached</a>(&amp;as-&gt;<a class="code" href="structasync__stat.html#a1ad90c6e2b5f6774919078d93f443e30">p</a>, NULL, <a class="code" href="pbx_8c.html#a4f84706d30062086de7265597688040f">async_wait</a>, as)) {
<a name="l08066"></a>08066          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to start async wait\n&quot;</span>);
<a name="l08067"></a>08067          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(as);
<a name="l08068"></a>08068          <span class="keywordflow">if</span> (channel) {
<a name="l08069"></a>08069             *channel = NULL;
<a name="l08070"></a>08070             <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l08071"></a>08071          }
<a name="l08072"></a>08072          <a class="code" href="channel_8h.html#a8f2c0f3dcafbc3a74d84a8dddcce6b9c" title="Hang up a channel.">ast_hangup</a>(chan);
<a name="l08073"></a>08073          res = -1;
<a name="l08074"></a>08074          <span class="keywordflow">goto</span> outgoing_exten_cleanup;
<a name="l08075"></a>08075       }
<a name="l08076"></a>08076       res = 0;
<a name="l08077"></a>08077    }
<a name="l08078"></a>08078 outgoing_exten_cleanup:
<a name="l08079"></a>08079    <a class="code" href="config_8h.html#ad3d8122172af6f13687a07840411d65d" title="Free variable list.">ast_variables_destroy</a>(vars);
<a name="l08080"></a>08080    <span class="keywordflow">return</span> res;
<a name="l08081"></a>08081 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a44b6406c9220f7f2b610ac712369f405"></a><!-- doxytag: member="pbx.h::ast_pbx_run" ref="a44b6406c9220f7f2b610ac712369f405" args="(struct ast_channel *c)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735">ast_pbx_result</a> ast_pbx_run </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Execute the PBX in the current thread. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>c</em>&nbsp;</td><td>channel to run the pbx on</td></tr>
  </table>
  </dd>
</dl>
<p>This executes the PBX on a given channel. It allocates a new PBX structure for the channel, and provides all PBX functionality. See ast_pbx_start for an asynchronous function to run the PBX in a new thread as opposed to the current one.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>Zero</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>non-zero</em>&nbsp;</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l04596">4596</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l04581">ast_pbx_run_args()</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l07940">ast_pbx_outgoing_exten()</a>, <a class="el" href="pbx_8c_source.html#l07853">async_wait()</a>, <a class="el" href="chan__mgcp_8c_source.html#l02637">mgcp_ss()</a>, <a class="el" href="chan__skinny_8c_source.html#l03594">skinny_newcall()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>, and <a class="el" href="chan__unistim_8c_source.html#l02007">unistim_ss()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04597"></a>04597 {
<a name="l04598"></a>04598    <span class="keywordflow">return</span> <a class="code" href="pbx_8h.html#a2c502c100b8b4791d9efe395e08d620b" title="Execute the PBX in the current thread.">ast_pbx_run_args</a>(c, NULL);
<a name="l04599"></a>04599 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2c502c100b8b4791d9efe395e08d620b"></a><!-- doxytag: member="pbx.h::ast_pbx_run_args" ref="a2c502c100b8b4791d9efe395e08d620b" args="(struct ast_channel *c, struct ast_pbx_args *args)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735">ast_pbx_result</a> ast_pbx_run_args </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__pbx__args.html">ast_pbx_args</a> *&nbsp;</td>
          <td class="paramname"> <em>args</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Execute the PBX in the current thread. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>c</em>&nbsp;</td><td>channel to run the pbx on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>args</em>&nbsp;</td><td>options for the pbx</td></tr>
  </table>
  </dd>
</dl>
<p>This executes the PBX on a given channel. It allocates a new PBX structure for the channel, and provides all PBX functionality. See ast_pbx_start for an asynchronous function to run the PBX in a new thread as opposed to the current one.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>Zero</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>non-zero</em>&nbsp;</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l04581">4581</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l04214">__ast_pbx_run()</a>, <a class="el" href="pbx_8h_source.html#l00265">AST_PBX_CALL_LIMIT</a>, <a class="el" href="pbx_8h_source.html#l00263">AST_PBX_SUCCESS</a>, <a class="el" href="pbx_8c_source.html#l04517">decrease_call_count()</a>, and <a class="el" href="pbx_8c_source.html#l04470">increase_call_count()</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l04596">ast_pbx_run()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="app__stack_8c_source.html#l00550">handle_gosub()</a>, and <a class="el" href="app__queue_8c_source.html#l03569">try_calling()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04582"></a>04582 {
<a name="l04583"></a>04583    <span class="keyword">enum</span> <a class="code" href="pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735" title="The result codes when starting the PBX on a channel with.">ast_pbx_result</a> res = <a class="code" href="pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735ae1482e87c137b03ef9f9c17cf4fb5ec4">AST_PBX_SUCCESS</a>;
<a name="l04584"></a>04584 
<a name="l04585"></a>04585    <span class="keywordflow">if</span> (<a class="code" href="pbx_8c.html#a829520d1350a9bfcd02e2106e5a22a24" title="Increase call count for channel.">increase_call_count</a>(c)) {
<a name="l04586"></a>04586       <span class="keywordflow">return</span> <a class="code" href="pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735ab69a419c47206542956e9d933b6605f5">AST_PBX_CALL_LIMIT</a>;
<a name="l04587"></a>04587    }
<a name="l04588"></a>04588 
<a name="l04589"></a>04589    res = <a class="code" href="pbx_8c.html#ab203ba8e71a7c11736a40f7967ba1fdf">__ast_pbx_run</a>(c, args);
<a name="l04590"></a>04590 
<a name="l04591"></a>04591    <a class="code" href="pbx_8c.html#a3bf2bd297c32c358066446ceb1f4551b">decrease_call_count</a>();
<a name="l04592"></a>04592 
<a name="l04593"></a>04593    <span class="keywordflow">return</span> res;
<a name="l04594"></a>04594 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9a937fbb3b5f4e68880a9c5714a29ce5"></a><!-- doxytag: member="pbx.h::ast_pbx_start" ref="a9a937fbb3b5f4e68880a9c5714a29ce5" args="(struct ast_channel *c)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735">ast_pbx_result</a> ast_pbx_start </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Create a new thread and start the PBX. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>c</em>&nbsp;</td><td>channel to start the pbx on</td></tr>
  </table>
  </dd>
</dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="pbx_8c.html#a44b6406c9220f7f2b610ac712369f405" title="Execute the PBX in the current thread.">ast_pbx_run</a> for a synchronous function to run the PBX in the current <a class="el" href="res__timing__pthread_8c.html#a01f75a9ad916f63a94e06a27635ba278">thread</a>, as opposed to starting a new one.</dd></dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>Zero</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>non-zero</em>&nbsp;</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l04559">4559</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="pbx_8h_source.html#l00265">AST_PBX_CALL_LIMIT</a>, <a class="el" href="pbx_8h_source.html#l00264">AST_PBX_FAILED</a>, <a class="el" href="pbx_8h_source.html#l00263">AST_PBX_SUCCESS</a>, <a class="el" href="utils_8h_source.html#l00380">ast_pthread_create_detached</a>, <a class="el" href="pbx_8c_source.html#l04517">decrease_call_count()</a>, <a class="el" href="pbx_8c_source.html#l04470">increase_call_count()</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, and <a class="el" href="pbx_8c_source.html#l04539">pbx_thread()</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l00999">__oh323_new()</a>, <a class="el" href="chan__alsa_8c_source.html#l00536">alsa_new()</a>, <a class="el" href="pbx_8c_source.html#l07344">ast_async_goto()</a>, <a class="el" href="chan__iax2_8c_source.html#l05415">ast_iax2_new()</a>, <a class="el" href="pbx_8c_source.html#l07940">ast_pbx_outgoing_exten()</a>, <a class="el" href="features_8c_source.html#l00412">bridge_call_thread()</a>, <a class="el" href="features_8c_source.html#l04524">bridge_exec()</a>, <a class="el" href="features_8c_source.html#l00366">check_goto_on_transfer()</a>, <a class="el" href="chan__console_8c_source.html#l00410">console_new()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07417">dahdi_new()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00989">gtalk_new()</a>, <a class="el" href="chan__gtalk_8c_source.html#l01154">gtalk_newcall()</a>, <a class="el" href="chan__sip_8c_source.html#l19641">handle_request_invite()</a>, <a class="el" href="chan__jingle_8c_source.html#l00800">jingle_new()</a>, <a class="el" href="chan__jingle_8c_source.html#l00954">jingle_newcall()</a>, <a class="el" href="chan__local_8c_source.html#l00518">local_call()</a>, <a class="el" href="features_8c_source.html#l03009">manage_parkinglot()</a>, <a class="el" href="chan__mgcp_8c_source.html#l01470">mgcp_new()</a>, <a class="el" href="chan__nbs_8c_source.html#l00222">nbs_new()</a>, <a class="el" href="chan__oss_8c_source.html#l00784">oss_new()</a>, <a class="el" href="chan__misdn_8c_source.html#l03923">pbx_start_chan()</a>, <a class="el" href="chan__phone_8c_source.html#l00846">phone_new()</a>, <a class="el" href="app__rpt_8c_source.html#l05280">rpt_call()</a>, <a class="el" href="chan__sip_8c_source.html#l06599">sip_new()</a>, <a class="el" href="chan__skinny_8c_source.html#l04268">skinny_new()</a>, <a class="el" href="chan__unistim_8c_source.html#l04422">unistim_new()</a>, and <a class="el" href="chan__usbradio_8c_source.html#l02183">usbradio_new()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04560"></a>04560 {
<a name="l04561"></a>04561    pthread_t t;
<a name="l04562"></a>04562 
<a name="l04563"></a>04563    <span class="keywordflow">if</span> (!c) {
<a name="l04564"></a>04564       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Asked to start thread on NULL channel?\n&quot;</span>);
<a name="l04565"></a>04565       <span class="keywordflow">return</span> <a class="code" href="pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735a4a46cde728f5cd375af4f2d5b1542490">AST_PBX_FAILED</a>;
<a name="l04566"></a>04566    }
<a name="l04567"></a>04567 
<a name="l04568"></a>04568    <span class="keywordflow">if</span> (<a class="code" href="pbx_8c.html#a829520d1350a9bfcd02e2106e5a22a24" title="Increase call count for channel.">increase_call_count</a>(c))
<a name="l04569"></a>04569       <span class="keywordflow">return</span> <a class="code" href="pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735ab69a419c47206542956e9d933b6605f5">AST_PBX_CALL_LIMIT</a>;
<a name="l04570"></a>04570 
<a name="l04571"></a>04571    <span class="comment">/* Start a new thread, and get something handling this channel. */</span>
<a name="l04572"></a>04572    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a832647380b1f97e7ac1b4492f8816d46">ast_pthread_create_detached</a>(&amp;t, NULL, <a class="code" href="pbx_8c.html#a61bf09bfdadba04e51d6576aa014e097">pbx_thread</a>, c)) {
<a name="l04573"></a>04573       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to create new channel thread\n&quot;</span>);
<a name="l04574"></a>04574       <a class="code" href="pbx_8c.html#a3bf2bd297c32c358066446ceb1f4551b">decrease_call_count</a>();
<a name="l04575"></a>04575       <span class="keywordflow">return</span> <a class="code" href="pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735a4a46cde728f5cd375af4f2d5b1542490">AST_PBX_FAILED</a>;
<a name="l04576"></a>04576    }
<a name="l04577"></a>04577 
<a name="l04578"></a>04578    <span class="keywordflow">return</span> <a class="code" href="pbx_8h.html#a0e4eb357d2ef42629fbcf191a473f735ae1482e87c137b03ef9f9c17cf4fb5ec4">AST_PBX_SUCCESS</a>;
<a name="l04579"></a>04579 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6cd4c64e374623ea3393fbc5d580f68e"></a><!-- doxytag: member="pbx.h::ast_processed_calls" ref="a6cd4c64e374623ea3393fbc5d580f68e" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_processed_calls </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Retrieve the total <a class="el" href="structnumber.html" title="Number structure.">number</a> of calls processed through the PBX since last restart. </p>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l04606">4606</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l01078">totalcalls</a>.</p>

<p>Referenced by <a class="el" href="agent_8c_source.html#l00604">ast_var_Config()</a>, <a class="el" href="cli_8c_source.html#l00790">handle_chanlist()</a>, and <a class="el" href="cli_8c_source.html#l00735">handle_showcalls()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04607"></a>04607 {
<a name="l04608"></a>04608    <span class="keywordflow">return</span> <a class="code" href="pbx_8c.html#a078330b9a32065ec6a0c0731c06719cd">totalcalls</a>;
<a name="l04609"></a>04609 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af1a624244a07626a8f70843005206c95"></a><!-- doxytag: member="pbx.h::ast_rdlock_context" ref="af1a624244a07626a8f70843005206c95" args="(struct ast_context *con)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_rdlock_context </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__context.html">ast_context</a> *&nbsp;</td>
          <td class="paramname"> <em>con</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Read locks a given context. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>con</em>&nbsp;</td><td>context to lock</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09371">9371</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l01796">ast_rwlock_rdlock()</a>, and <a class="el" href="pbx_8c_source.html#l00841">ast_context::lock</a>.</p>

<p>Referenced by <a class="el" href="app__macro_8c_source.html#l00219">_macro_exec()</a>, <a class="el" href="pbx__config_8c_source.html#l01197">complete_dialplan_remove_ignorepat()</a>, <a class="el" href="pbx__config_8c_source.html#l00182">complete_dialplan_remove_include()</a>, <a class="el" href="pbx__dundi_8c_source.html#l03723">dundi_precache_full()</a>, <a class="el" href="app__while_8c_source.html#l00148">find_matching_endwhile()</a>, <a class="el" href="pbx__config_8c_source.html#l00672">handle_cli_dialplan_save()</a>, <a class="el" href="pbx__config_8c_source.html#l00115">lookup_c_ip()</a>, <a class="el" href="pbx__config_8c_source.html#l00101">lookup_ci()</a>, <a class="el" href="pbx_8c_source.html#l05957">manager_show_dialplan_helper()</a>, <a class="el" href="pbx_8c_source.html#l05772">show_debug_helper()</a>, and <a class="el" href="pbx_8c_source.html#l05621">show_dialplan_helper()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09372"></a>09372 {
<a name="l09373"></a>09373    <span class="keywordflow">return</span> <a class="code" href="lock_8h.html#ae6703edce409c34119e27bdca1186d10">ast_rwlock_rdlock</a>(&amp;con-&gt;<a class="code" href="structast__context.html#ace4e0066a5b24f84b90536e9906619f6">lock</a>);
<a name="l09374"></a>09374 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa2c309331fff0a086ab8e216f803d546"></a><!-- doxytag: member="pbx.h::ast_rdlock_contexts" ref="aa2c309331fff0a086ab8e216f803d546" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_rdlock_contexts </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Read locks the context list. </p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09353">9353</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l01796">ast_rwlock_rdlock()</a>, and <a class="el" href="pbx_8c_source.html#l01122">conlock</a>.</p>

<p>Referenced by <a class="el" href="app__macro_8c_source.html#l00219">_macro_exec()</a>, <a class="el" href="pbx_8c_source.html#l02430">ast_context_find()</a>, <a class="el" href="pbx_8c_source.html#l06424">ast_context_find_or_create()</a>, <a class="el" href="pbx_8c_source.html#l04988">ast_context_lockmacro()</a>, <a class="el" href="pbx_8c_source.html#l05028">ast_context_unlockmacro()</a>, <a class="el" href="pbx_8c_source.html#l03761">ast_hint_extension()</a>, <a class="el" href="pbx_8c_source.html#l06623">ast_merge_contexts_and_delete()</a>, <a class="el" href="pbx__config_8c_source.html#l01015">complete_dialplan_add_extension()</a>, <a class="el" href="pbx__config_8c_source.html#l01101">complete_dialplan_add_ignorepat()</a>, <a class="el" href="pbx__config_8c_source.html#l00575">complete_dialplan_add_include()</a>, <a class="el" href="pbx__config_8c_source.html#l00392">complete_dialplan_remove_extension()</a>, <a class="el" href="pbx__config_8c_source.html#l01197">complete_dialplan_remove_ignorepat()</a>, <a class="el" href="pbx__config_8c_source.html#l00182">complete_dialplan_remove_include()</a>, <a class="el" href="pbx_8c_source.html#l05567">complete_show_dialplan_context()</a>, <a class="el" href="pbx__dundi_8c_source.html#l03723">dundi_precache_full()</a>, <a class="el" href="pbx_8c_source.html#l04658">find_context_locked()</a>, <a class="el" href="app__while_8c_source.html#l00148">find_matching_endwhile()</a>, <a class="el" href="pbx__config_8c_source.html#l00672">handle_cli_dialplan_save()</a>, <a class="el" href="pbx_8c_source.html#l03843">handle_statechange()</a>, <a class="el" href="pbx_8c_source.html#l05957">manager_show_dialplan_helper()</a>, <a class="el" href="pbx_8c_source.html#l03647">pbx_extension_helper()</a>, <a class="el" href="pbx_8c_source.html#l05772">show_debug_helper()</a>, <a class="el" href="pbx_8c_source.html#l05621">show_dialplan_helper()</a>, and <a class="el" href="pbx_8c_source.html#l06384">unreference_cached_app()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09354"></a>09354 {
<a name="l09355"></a>09355    <span class="keywordflow">return</span> <a class="code" href="lock_8h.html#ae6703edce409c34119e27bdca1186d10">ast_rwlock_rdlock</a>(&amp;<a class="code" href="pbx_8c.html#aa0a1f2323798ac5928ae23d6fb55449e">conlock</a>);
<a name="l09356"></a>09356 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5297fa9c52ff50da5b08c7217d9251b4"></a><!-- doxytag: member="pbx.h::ast_register_switch" ref="a5297fa9c52ff50da5b08c7217d9251b4" args="(struct ast_switch *sw)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_register_switch </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__switch.html">ast_switch</a> *&nbsp;</td>
          <td class="paramname"> <em>sw</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Register an alternative dialplan switch. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sw</em>&nbsp;</td><td>switch to register</td></tr>
  </table>
  </dd>
</dl>
<p>This function registers a populated <a class="el" href="structast__switch.html">ast_switch</a> structure with the asterisk switching architecture.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>non-zero</em>&nbsp;</td><td>failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l05157">5157</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="linkedlists_8h_source.html#l00725">AST_RWLIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h_source.html#l00493">AST_RWLIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, and <a class="el" href="pbx_8h_source.html#l00106">ast_switch::name</a>.</p>

<p>Referenced by <a class="el" href="chan__iax2_8c_source.html#l13805">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05158"></a>05158 {
<a name="l05159"></a>05159    <span class="keyword">struct </span><a class="code" href="structast__switch.html">ast_switch</a> *tmp;
<a name="l05160"></a>05160 
<a name="l05161"></a>05161    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structswitches.html">switches</a>);
<a name="l05162"></a>05162    <a class="code" href="linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;<a class="code" href="structswitches.html">switches</a>, tmp, <a class="code" href="structast__switch.html#aa57e8aaf62c5f123225c6168521cf214">list</a>) {
<a name="l05163"></a>05163       <span class="keywordflow">if</span> (!strcasecmp(tmp-&gt;<a class="code" href="structast__switch.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, sw-&gt;<a class="code" href="structast__switch.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)) {
<a name="l05164"></a>05164          <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structswitches.html">switches</a>);
<a name="l05165"></a>05165          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Switch &apos;%s&apos; already found\n&quot;</span>, sw-&gt;<a class="code" href="structast__switch.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);
<a name="l05166"></a>05166          <span class="keywordflow">return</span> -1;
<a name="l05167"></a>05167       }
<a name="l05168"></a>05168    }
<a name="l05169"></a>05169    <a class="code" href="linkedlists_8h.html#aadda916488b2d151af4426e2f06ad332">AST_RWLIST_INSERT_TAIL</a>(&amp;<a class="code" href="structswitches.html">switches</a>, sw, <a class="code" href="structast__switch.html#aa57e8aaf62c5f123225c6168521cf214">list</a>);
<a name="l05170"></a>05170    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structswitches.html">switches</a>);
<a name="l05171"></a>05171 
<a name="l05172"></a>05172    <span class="keywordflow">return</span> 0;
<a name="l05173"></a>05173 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a94ca71e502d95d1cb0a815072e059aee"></a><!-- doxytag: member="pbx.h::ast_spawn_extension" ref="a94ca71e502d95d1cb0a815072e059aee" args="(struct ast_channel *c, const char *context, const char *exten, int priority, const char *callerid, int *found, int combined_find_spawn)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_spawn_extension </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>exten</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>priority</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>callerid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>found</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>combined_find_spawn</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Launch a new <a class="el" href="structextension.html">extension</a> (i.e. new stack). </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>c</em>&nbsp;</td><td>not important </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>context</em>&nbsp;</td><td>which context to generate the <a class="el" href="structextension.html">extension</a> within </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>exten</em>&nbsp;</td><td>new <a class="el" href="structextension.html">extension</a> to add </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>priority</em>&nbsp;</td><td>priority of new <a class="el" href="structextension.html">extension</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>callerid</em>&nbsp;</td><td>callerid of <a class="el" href="structextension.html">extension</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>found</em>&nbsp;</td><td></td></tr>
    <tr><td valign="top"></td><td valign="top"><em>combined_find_spawn</em>&nbsp;</td><td></td></tr>
  </table>
  </dd>
</dl>
<p>This adds a new <a class="el" href="structextension.html">extension</a> to the asterisk <a class="el" href="structextension.html">extension</a> list.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>It is possible for autoservice to be started and stopped on c during this function call, it is important that c is not locked prior to calling this. Otherwise a deadlock may occur</dd></dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l04168">4168</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="extconf_8h_source.html#l00220">E_SPAWN</a>, and <a class="el" href="pbx_8c_source.html#l03647">pbx_extension_helper()</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l04214">__ast_pbx_run()</a>, <a class="el" href="app__macro_8c_source.html#l00219">_macro_exec()</a>, <a class="el" href="features_8c_source.html#l02441">ast_bridge_call()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, and <a class="el" href="pbx__loopback_8c_source.html#l00144">loopback_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04169"></a>04169 {
<a name="l04170"></a>04170    <span class="keywordflow">return</span> <a class="code" href="pbx_8c.html#ae381d99bea85b43f022470b64171018d" title="The return value depends on the action:.">pbx_extension_helper</a>(c, NULL, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, priority, NULL, callerid, <a class="code" href="extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea8f986496ee140e4c7167ae25ad28d0ee">E_SPAWN</a>, found, combined_find_spawn);
<a name="l04171"></a>04171 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6e3d30e37949465cd18bae8bfdd3cc0f"></a><!-- doxytag: member="pbx.h::ast_str_substitute_variables" ref="a6e3d30e37949465cd18bae8bfdd3cc0f" args="(struct ast_str **buf, size_t maxlen, struct ast_channel *chan, const char *templ)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_str_substitute_variables </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__str.html">ast_str</a> **&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>maxlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>templ</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="strings_8c_source.html#l00114">114</a> of file <a class="el" href="strings_8c_source.html">strings.c</a>.</p>

<p>References <a class="el" href="strings_8h_source.html#l00573">ast_str_make_space()</a>, <a class="el" href="devicestate_8c_source.html#l00198">first</a>, and <a class="el" href="pbx_8c_source.html#l03403">pbx_substitute_variables_helper_full()</a>.</p>

<p>Referenced by <a class="el" href="func__odbc_8c_source.html#l00375">acf_odbc_read()</a>, <a class="el" href="func__odbc_8c_source.html#l00203">acf_odbc_write()</a>, <a class="el" href="func__odbc_8c_source.html#l00978">cli_odbc_read()</a>, and <a class="el" href="func__odbc_8c_source.html#l01177">cli_odbc_write()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00115"></a>00115 {
<a name="l00116"></a>00116    <span class="keywordtype">int</span> <a class="code" href="devicestate_8c.html#abd2135e6f8a41bc900933b1985d97165">first</a> = 1;
<a name="l00117"></a>00117    <span class="keywordflow">do</span> {
<a name="l00118"></a>00118       <a class="code" href="strings_8h.html#a7f20a4560b028f55b5d723f02f5830cb">ast_str_make_space</a>(buf, maxlen ? maxlen :
<a name="l00119"></a>00119          (first ? strlen(<span class="keyword">template</span>) * 2 : (*buf)-&gt;__AST_STR_LEN * 2));
<a name="l00120"></a>00120       <a class="code" href="pbx_8h.html#a4019ca376e3f30f3cd342e29d3145742">pbx_substitute_variables_helper_full</a>(chan, NULL, <span class="keyword">template</span>, (*buf)-&gt;__AST_STR_STR, (*buf)-&gt;__AST_STR_LEN - 1, &amp;((*buf)-&gt;__AST_STR_USED));
<a name="l00121"></a>00121       first = 0;
<a name="l00122"></a>00122    } <span class="keywordflow">while</span> (maxlen == 0 &amp;&amp; (*buf)-&gt;__AST_STR_LEN - 5 &lt; (*buf)-&gt;__AST_STR_USED);
<a name="l00123"></a>00123 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a805796e4728845bff70c4caf5b224308"></a><!-- doxytag: member="pbx.h::ast_unlock_context" ref="a805796e4728845bff70c4caf5b224308" args="(struct ast_context *con)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_unlock_context </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__context.html">ast_context</a> *&nbsp;</td>
          <td class="paramname"> <em>con</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>Unlocks</em>&nbsp;</td><td>the given context</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>con</em>&nbsp;</td><td>context to unlock</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09376">9376</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l01791">ast_rwlock_unlock()</a>, and <a class="el" href="pbx_8c_source.html#l00841">ast_context::lock</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l08276">__ast_context_destroy()</a>, <a class="el" href="app__macro_8c_source.html#l00219">_macro_exec()</a>, <a class="el" href="pbx_8c_source.html#l07637">ast_add_extension2_lockopt()</a>, <a class="el" href="pbx_8c_source.html#l07229">ast_context_add_ignorepat2()</a>, <a class="el" href="pbx_8c_source.html#l07032">ast_context_add_include2()</a>, <a class="el" href="pbx_8c_source.html#l07114">ast_context_add_switch2()</a>, <a class="el" href="pbx_8c_source.html#l04828">ast_context_remove_extension_callerid2()</a>, <a class="el" href="pbx_8c_source.html#l07186">ast_context_remove_ignorepat2()</a>, <a class="el" href="pbx_8c_source.html#l04709">ast_context_remove_include2()</a>, <a class="el" href="pbx_8c_source.html#l04765">ast_context_remove_switch2()</a>, <a class="el" href="pbx__config_8c_source.html#l01197">complete_dialplan_remove_ignorepat()</a>, <a class="el" href="pbx__config_8c_source.html#l00182">complete_dialplan_remove_include()</a>, <a class="el" href="pbx__dundi_8c_source.html#l03723">dundi_precache_full()</a>, <a class="el" href="app__while_8c_source.html#l00148">find_matching_endwhile()</a>, <a class="el" href="pbx__config_8c_source.html#l00672">handle_cli_dialplan_save()</a>, <a class="el" href="pbx__config_8c_source.html#l00115">lookup_c_ip()</a>, <a class="el" href="pbx__config_8c_source.html#l00101">lookup_ci()</a>, <a class="el" href="pbx_8c_source.html#l05957">manager_show_dialplan_helper()</a>, <a class="el" href="pbx_8c_source.html#l05772">show_debug_helper()</a>, and <a class="el" href="pbx_8c_source.html#l05621">show_dialplan_helper()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09377"></a>09377 {
<a name="l09378"></a>09378    <span class="keywordflow">return</span> <a class="code" href="lock_8h.html#a21ce13cd6c771d5855f47ae7a1dd50b6">ast_rwlock_unlock</a>(&amp;con-&gt;<a class="code" href="structast__context.html#ace4e0066a5b24f84b90536e9906619f6">lock</a>);
<a name="l09379"></a>09379 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae517a87b356aec60d5de4591ef94581b"></a><!-- doxytag: member="pbx.h::ast_unlock_contexts" ref="ae517a87b356aec60d5de4591ef94581b" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_unlock_contexts </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Unlocks contexts. </p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09358">9358</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l01791">ast_rwlock_unlock()</a>, and <a class="el" href="pbx_8c_source.html#l01122">conlock</a>.</p>

<p>Referenced by <a class="el" href="app__macro_8c_source.html#l00219">_macro_exec()</a>, <a class="el" href="pbx_8c_source.html#l07305">ast_add_extension()</a>, <a class="el" href="pbx_8c_source.html#l07217">ast_context_add_ignorepat()</a>, <a class="el" href="pbx_8c_source.html#l06768">ast_context_add_include()</a>, <a class="el" href="pbx_8c_source.html#l07095">ast_context_add_switch()</a>, <a class="el" href="pbx_8c_source.html#l08415">ast_context_destroy()</a>, <a class="el" href="pbx_8c_source.html#l02430">ast_context_find()</a>, <a class="el" href="pbx_8c_source.html#l06424">ast_context_find_or_create()</a>, <a class="el" href="pbx_8c_source.html#l04988">ast_context_lockmacro()</a>, <a class="el" href="pbx_8c_source.html#l04801">ast_context_remove_extension_callerid()</a>, <a class="el" href="pbx_8c_source.html#l07174">ast_context_remove_ignorepat()</a>, <a class="el" href="pbx_8c_source.html#l04687">ast_context_remove_include()</a>, <a class="el" href="pbx_8c_source.html#l04744">ast_context_remove_switch()</a>, <a class="el" href="pbx_8c_source.html#l05028">ast_context_unlockmacro()</a>, <a class="el" href="pbx_8c_source.html#l03761">ast_hint_extension()</a>, <a class="el" href="pbx_8c_source.html#l06623">ast_merge_contexts_and_delete()</a>, <a class="el" href="pbx__config_8c_source.html#l01015">complete_dialplan_add_extension()</a>, <a class="el" href="pbx__config_8c_source.html#l01101">complete_dialplan_add_ignorepat()</a>, <a class="el" href="pbx__config_8c_source.html#l00575">complete_dialplan_add_include()</a>, <a class="el" href="pbx__config_8c_source.html#l00392">complete_dialplan_remove_extension()</a>, <a class="el" href="pbx__config_8c_source.html#l01197">complete_dialplan_remove_ignorepat()</a>, <a class="el" href="pbx__config_8c_source.html#l00182">complete_dialplan_remove_include()</a>, <a class="el" href="pbx_8c_source.html#l05567">complete_show_dialplan_context()</a>, <a class="el" href="pbx__dundi_8c_source.html#l03723">dundi_precache_full()</a>, <a class="el" href="pbx_8c_source.html#l04658">find_context_locked()</a>, <a class="el" href="app__while_8c_source.html#l00148">find_matching_endwhile()</a>, <a class="el" href="pbx__config_8c_source.html#l00672">handle_cli_dialplan_save()</a>, <a class="el" href="pbx_8c_source.html#l03843">handle_statechange()</a>, <a class="el" href="pbx_8c_source.html#l05957">manager_show_dialplan_helper()</a>, <a class="el" href="pbx_8c_source.html#l03647">pbx_extension_helper()</a>, <a class="el" href="pbx_8c_source.html#l05772">show_debug_helper()</a>, <a class="el" href="pbx_8c_source.html#l05621">show_dialplan_helper()</a>, and <a class="el" href="pbx_8c_source.html#l06384">unreference_cached_app()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09359"></a>09359 {
<a name="l09360"></a>09360    <span class="keywordflow">return</span> <a class="code" href="lock_8h.html#a21ce13cd6c771d5855f47ae7a1dd50b6">ast_rwlock_unlock</a>(&amp;<a class="code" href="pbx_8c.html#aa0a1f2323798ac5928ae23d6fb55449e">conlock</a>);
<a name="l09361"></a>09361 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4b11d763a689cb0df33a4a16c9d89ef3"></a><!-- doxytag: member="pbx.h::ast_unregister_switch" ref="a4b11d763a689cb0df33a4a16c9d89ef3" args="(struct ast_switch *sw)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_unregister_switch </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__switch.html">ast_switch</a> *&nbsp;</td>
          <td class="paramname"> <em>sw</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Unregister an alternative switch. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>sw</em>&nbsp;</td><td>switch to unregister</td></tr>
  </table>
  </dd>
</dl>
<p>Unregisters a switch from asterisk.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>nothing </dd></dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l05175">5175</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00860">AST_RWLIST_REMOVE</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, and <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>.</p>

<p>Referenced by <a class="el" href="chan__iax2_8c_source.html#l13611">__unload_module()</a>, and <a class="el" href="pbx__dundi_8c_source.html#l04776">unload_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l05176"></a>05176 {
<a name="l05177"></a>05177    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structswitches.html">switches</a>);
<a name="l05178"></a>05178    <a class="code" href="linkedlists_8h.html#a6091f0518f8b6f443fd9f5150f3ac407">AST_RWLIST_REMOVE</a>(&amp;<a class="code" href="structswitches.html">switches</a>, sw, <a class="code" href="structast__switch.html#aa57e8aaf62c5f123225c6168521cf214">list</a>);
<a name="l05179"></a>05179    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structswitches.html">switches</a>);
<a name="l05180"></a>05180 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa63685577f3479dcf31a9e77b2ff05a7"></a><!-- doxytag: member="pbx.h::ast_walk_context_extensions" ref="aa63685577f3479dcf31a9e77b2ff05a7" args="(struct ast_context *con, struct ast_exten *priority)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__exten.html">ast_exten</a>* ast_walk_context_extensions </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__context.html">ast_context</a> *&nbsp;</td>
          <td class="paramname"> <em>con</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__exten.html">ast_exten</a> *&nbsp;</td>
          <td class="paramname"> <em>priority</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09490">9490</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l00784">ast_exten::next</a>, and <a class="el" href="pbx_8c_source.html#l00842">ast_context::root</a>.</p>

<p>Referenced by <a class="el" href="pbx__config_8c_source.html#l00392">complete_dialplan_remove_extension()</a>, <a class="el" href="pbx__dundi_8c_source.html#l03723">dundi_precache_full()</a>, <a class="el" href="app__macro_8c_source.html#l00184">find_matching_priority()</a>, <a class="el" href="pbx__config_8c_source.html#l00672">handle_cli_dialplan_save()</a>, <a class="el" href="pbx_8c_source.html#l05957">manager_show_dialplan_helper()</a>, <a class="el" href="pbx_8c_source.html#l02469">pbx_find_extension()</a>, <a class="el" href="pbx_8c_source.html#l05621">show_dialplan_helper()</a>, and <a class="el" href="pbx_8c_source.html#l06384">unreference_cached_app()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09492"></a>09492 {
<a name="l09493"></a>09493    <span class="keywordflow">if</span> (!<a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>)
<a name="l09494"></a>09494       <span class="keywordflow">return</span> con ? con-&gt;<a class="code" href="structast__context.html#a6611ebb8017b475186f83b2a62bc25d2">root</a> : NULL;
<a name="l09495"></a>09495    <span class="keywordflow">else</span>
<a name="l09496"></a>09496       <span class="keywordflow">return</span> <a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>-&gt;next;
<a name="l09497"></a>09497 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0e9dbe4e0003f65b67c78979f2fbfa8e"></a><!-- doxytag: member="pbx.h::ast_walk_context_ignorepats" ref="a0e9dbe4e0003f65b67c78979f2fbfa8e" args="(struct ast_context *con, struct ast_ignorepat *ip)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__ignorepat.html">ast_ignorepat</a>* ast_walk_context_ignorepats </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__context.html">ast_context</a> *&nbsp;</td>
          <td class="paramname"> <em>con</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__ignorepat.html">ast_ignorepat</a> *&nbsp;</td>
          <td class="paramname"> <em>ip</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09523">9523</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l00847">ast_context::ignorepats</a>, and <a class="el" href="pbx_8c_source.html#l00812">ast_ignorepat::next</a>.</p>

<p>Referenced by <a class="el" href="pbx__config_8c_source.html#l01197">complete_dialplan_remove_ignorepat()</a>, <a class="el" href="pbx_8c_source.html#l06506">context_merge_incls_swits_igps_other_registrars()</a>, <a class="el" href="pbx__config_8c_source.html#l00672">handle_cli_dialplan_save()</a>, <a class="el" href="pbx__config_8c_source.html#l00115">lookup_c_ip()</a>, <a class="el" href="pbx_8c_source.html#l05957">manager_show_dialplan_helper()</a>, and <a class="el" href="pbx_8c_source.html#l05621">show_dialplan_helper()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09525"></a>09525 {
<a name="l09526"></a>09526    <span class="keywordflow">if</span> (!ip)
<a name="l09527"></a>09527       <span class="keywordflow">return</span> con ? con-&gt;<a class="code" href="structast__context.html#aedb0afcd332920e51d2f82860f794347">ignorepats</a> : NULL;
<a name="l09528"></a>09528    <span class="keywordflow">else</span>
<a name="l09529"></a>09529       <span class="keywordflow">return</span> ip-&gt;<a class="code" href="structast__ignorepat.html#a8ffe03069b70f493ab982ba43faced7f">next</a>;
<a name="l09530"></a>09530 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a142de6e0271ada6b306f2f7420a3fd77"></a><!-- doxytag: member="pbx.h::ast_walk_context_includes" ref="a142de6e0271ada6b306f2f7420a3fd77" args="(struct ast_context *con, struct ast_include *inc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__include.html">ast_include</a>* ast_walk_context_includes </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__context.html">ast_context</a> *&nbsp;</td>
          <td class="paramname"> <em>con</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__include.html">ast_include</a> *&nbsp;</td>
          <td class="paramname"> <em>inc</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09514">9514</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l00846">ast_context::includes</a>, and <a class="el" href="pbx_8c_source.html#l00795">ast_include::next</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l09532">ast_context_verify_includes()</a>, <a class="el" href="pbx__config_8c_source.html#l00182">complete_dialplan_remove_include()</a>, <a class="el" href="pbx_8c_source.html#l06506">context_merge_incls_swits_igps_other_registrars()</a>, <a class="el" href="app__macro_8c_source.html#l00184">find_matching_priority()</a>, <a class="el" href="pbx__config_8c_source.html#l00672">handle_cli_dialplan_save()</a>, <a class="el" href="pbx__config_8c_source.html#l00101">lookup_ci()</a>, <a class="el" href="pbx_8c_source.html#l05957">manager_show_dialplan_helper()</a>, and <a class="el" href="pbx_8c_source.html#l05621">show_dialplan_helper()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09516"></a>09516 {
<a name="l09517"></a>09517    <span class="keywordflow">if</span> (!inc)
<a name="l09518"></a>09518       <span class="keywordflow">return</span> con ? con-&gt;<a class="code" href="structast__context.html#abaa8691efe3e8fe26f5930720bfd8edb">includes</a> : NULL;
<a name="l09519"></a>09519    <span class="keywordflow">else</span>
<a name="l09520"></a>09520       <span class="keywordflow">return</span> inc-&gt;<a class="code" href="structast__include.html#ad21fd2a65c1cfe0ed6a0aa46f40c2083">next</a>;
<a name="l09521"></a>09521 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a64653e3c5cdfab48075b4001bd74655d"></a><!-- doxytag: member="pbx.h::ast_walk_context_switches" ref="a64653e3c5cdfab48075b4001bd74655d" args="(struct ast_context *con, struct ast_sw *sw)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__sw.html">ast_sw</a>* ast_walk_context_switches </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__context.html">ast_context</a> *&nbsp;</td>
          <td class="paramname"> <em>con</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__sw.html">ast_sw</a> *&nbsp;</td>
          <td class="paramname"> <em>sw</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09499">9499</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="structast__context.html#a1a88e64f1d400d544879fb192cb155e7">ast_context::alts</a>, <a class="el" href="linkedlists_8h_source.html#l00420">AST_LIST_FIRST</a>, and <a class="el" href="linkedlists_8h_source.html#l00438">AST_LIST_NEXT</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l06506">context_merge_incls_swits_igps_other_registrars()</a>, <a class="el" href="pbx__config_8c_source.html#l00672">handle_cli_dialplan_save()</a>, <a class="el" href="pbx_8c_source.html#l05957">manager_show_dialplan_helper()</a>, and <a class="el" href="pbx_8c_source.html#l05621">show_dialplan_helper()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09501"></a>09501 {
<a name="l09502"></a>09502    <span class="keywordflow">if</span> (!sw)
<a name="l09503"></a>09503       <span class="keywordflow">return</span> con ? <a class="code" href="linkedlists_8h.html#adf1959c5c03a3a706da97ad2f49617e5" title="Returns the first entry contained in a list.">AST_LIST_FIRST</a>(&amp;con-&gt;<a class="code" href="structast__context.html#a1a88e64f1d400d544879fb192cb155e7">alts</a>) : NULL;
<a name="l09504"></a>09504    <span class="keywordflow">else</span>
<a name="l09505"></a>09505       <span class="keywordflow">return</span> <a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(sw, <a class="code" href="structast__switch.html#aa57e8aaf62c5f123225c6168521cf214">list</a>);
<a name="l09506"></a>09506 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4cd5282ca555370652a7304c0c7ea4c4"></a><!-- doxytag: member="pbx.h::ast_walk_contexts" ref="a4cd5282ca555370652a7304c0c7ea4c4" args="(struct ast_context *con)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__context.html">ast_context</a>* ast_walk_contexts </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__context.html">ast_context</a> *&nbsp;</td>
          <td class="paramname"> <em>con</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09485">9485</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l01119">contexts</a>, and <a class="el" href="pbx_8c_source.html#l00845">ast_context::next</a>.</p>

<p>Referenced by <a class="el" href="app__macro_8c_source.html#l00219">_macro_exec()</a>, <a class="el" href="pbx_8c_source.html#l02430">ast_context_find()</a>, <a class="el" href="pbx_8c_source.html#l04988">ast_context_lockmacro()</a>, <a class="el" href="pbx_8c_source.html#l05028">ast_context_unlockmacro()</a>, <a class="el" href="pbx__config_8c_source.html#l01015">complete_dialplan_add_extension()</a>, <a class="el" href="pbx__config_8c_source.html#l01101">complete_dialplan_add_ignorepat()</a>, <a class="el" href="pbx__config_8c_source.html#l00575">complete_dialplan_add_include()</a>, <a class="el" href="pbx__config_8c_source.html#l00392">complete_dialplan_remove_extension()</a>, <a class="el" href="pbx__config_8c_source.html#l01197">complete_dialplan_remove_ignorepat()</a>, <a class="el" href="pbx__config_8c_source.html#l00182">complete_dialplan_remove_include()</a>, <a class="el" href="pbx_8c_source.html#l05567">complete_show_dialplan_context()</a>, <a class="el" href="pbx__dundi_8c_source.html#l03723">dundi_precache_full()</a>, <a class="el" href="pbx_8c_source.html#l04658">find_context_locked()</a>, <a class="el" href="app__while_8c_source.html#l00148">find_matching_endwhile()</a>, <a class="el" href="app__macro_8c_source.html#l00184">find_matching_priority()</a>, <a class="el" href="pbx__config_8c_source.html#l00672">handle_cli_dialplan_save()</a>, <a class="el" href="pbx_8c_source.html#l05957">manager_show_dialplan_helper()</a>, <a class="el" href="pbx_8c_source.html#l02469">pbx_find_extension()</a>, <a class="el" href="pbx__ael_8c_source.html#l00113">pbx_load_module()</a>, <a class="el" href="pbx_8c_source.html#l05772">show_debug_helper()</a>, <a class="el" href="pbx_8c_source.html#l05621">show_dialplan_helper()</a>, and <a class="el" href="pbx_8c_source.html#l06384">unreference_cached_app()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09486"></a>09486 {
<a name="l09487"></a>09487    <span class="keywordflow">return</span> con ? con-&gt;<a class="code" href="structast__context.html#a0d9eeadf3cb7b27fdcf4f70247dceec6">next</a> : <a class="code" href="pbx_8c.html#aae85d5aab50f2d1b8392d6df276f2561">contexts</a>;
<a name="l09488"></a>09488 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6772ce6e8de86d4b6c382dbf68ea4755"></a><!-- doxytag: member="pbx.h::ast_walk_extension_priorities" ref="a6772ce6e8de86d4b6c382dbf68ea4755" args="(struct ast_exten *exten, struct ast_exten *priority)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__exten.html">ast_exten</a>* ast_walk_extension_priorities </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__exten.html">ast_exten</a> *&nbsp;</td>
          <td class="paramname"> <em>exten</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__exten.html">ast_exten</a> *&nbsp;</td>
          <td class="paramname"> <em>priority</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09508">9508</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l00780">ast_exten::peer</a>.</p>

<p>Referenced by <a class="el" href="pbx__config_8c_source.html#l00392">complete_dialplan_remove_extension()</a>, <a class="el" href="app__macro_8c_source.html#l00184">find_matching_priority()</a>, <a class="el" href="pbx__config_8c_source.html#l00672">handle_cli_dialplan_save()</a>, <a class="el" href="pbx_8c_source.html#l05957">manager_show_dialplan_helper()</a>, <a class="el" href="pbx_8c_source.html#l02469">pbx_find_extension()</a>, <a class="el" href="pbx_8c_source.html#l05621">show_dialplan_helper()</a>, and <a class="el" href="pbx_8c_source.html#l06384">unreference_cached_app()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09510"></a>09510 {
<a name="l09511"></a>09511    <span class="keywordflow">return</span> priority ? priority-&gt;<a class="code" href="structast__exten.html#a82ac0c5fa68c0f0aafe79462d3b36eee">peer</a> : exten;
<a name="l09512"></a>09512 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2c961dcbdcade8fac28960ed67c89bd2"></a><!-- doxytag: member="pbx.h::ast_wrlock_context" ref="a2c961dcbdcade8fac28960ed67c89bd2" args="(struct ast_context *con)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_wrlock_context </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__context.html">ast_context</a> *&nbsp;</td>
          <td class="paramname"> <em>con</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Write locks a given context. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>con</em>&nbsp;</td><td>context to lock</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09366">9366</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l01827">ast_rwlock_wrlock()</a>, and <a class="el" href="pbx_8c_source.html#l00841">ast_context::lock</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l08276">__ast_context_destroy()</a>, <a class="el" href="pbx_8c_source.html#l07637">ast_add_extension2_lockopt()</a>, <a class="el" href="pbx_8c_source.html#l07229">ast_context_add_ignorepat2()</a>, <a class="el" href="pbx_8c_source.html#l07032">ast_context_add_include2()</a>, <a class="el" href="pbx_8c_source.html#l07114">ast_context_add_switch2()</a>, <a class="el" href="pbx_8c_source.html#l04828">ast_context_remove_extension_callerid2()</a>, <a class="el" href="pbx_8c_source.html#l07186">ast_context_remove_ignorepat2()</a>, <a class="el" href="pbx_8c_source.html#l04709">ast_context_remove_include2()</a>, and <a class="el" href="pbx_8c_source.html#l04765">ast_context_remove_switch2()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09367"></a>09367 {
<a name="l09368"></a>09368    <span class="keywordflow">return</span> <a class="code" href="lock_8h.html#a952527792bba2a323118ae911f9aa1f7">ast_rwlock_wrlock</a>(&amp;con-&gt;<a class="code" href="structast__context.html#ace4e0066a5b24f84b90536e9906619f6">lock</a>);
<a name="l09369"></a>09369 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a18c87dac5f7f4368c11b67d8026adc22"></a><!-- doxytag: member="pbx.h::ast_wrlock_contexts" ref="a18c87dac5f7f4368c11b67d8026adc22" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_wrlock_contexts </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Write locks the context list. </p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09345">9345</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l01964">ast_atomic_fetchadd_int()</a>, <a class="el" href="lock_8h_source.html#l01827">ast_rwlock_wrlock()</a>, <a class="el" href="pbx_8c_source.html#l01122">conlock</a>, and <a class="el" href="pbx_8c_source.html#l09335">conlock_wrlock_version</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l08415">ast_context_destroy()</a>, <a class="el" href="pbx_8c_source.html#l06424">ast_context_find_or_create()</a>, <a class="el" href="pbx_8c_source.html#l06623">ast_merge_contexts_and_delete()</a>, and <a class="el" href="pbx__config_8c_source.html#l00182">complete_dialplan_remove_include()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09346"></a>09346 {
<a name="l09347"></a>09347    <span class="keywordtype">int</span> res = <a class="code" href="lock_8h.html#a952527792bba2a323118ae911f9aa1f7">ast_rwlock_wrlock</a>(&amp;<a class="code" href="pbx_8c.html#aa0a1f2323798ac5928ae23d6fb55449e">conlock</a>);
<a name="l09348"></a>09348    <span class="keywordflow">if</span> (!res)
<a name="l09349"></a>09349       <a class="code" href="lock_8h.html#a30df186a6f53f66621e88fae2e7adaf9" title="Atomically add v to *p and return * the previous value of *p. This can be used to...">ast_atomic_fetchadd_int</a>(&amp;<a class="code" href="pbx_8c.html#ac28a7ad3697ac6c336e4aa198cf3b890">conlock_wrlock_version</a>, 1);
<a name="l09350"></a>09350    <span class="keywordflow">return</span> res;
<a name="l09351"></a>09351 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4e6adb9c7783644ea993758d9c7e28c8"></a><!-- doxytag: member="pbx.h::ast_wrlock_contexts_version" ref="a4e6adb9c7783644ea993758d9c7e28c8" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_wrlock_contexts_version </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09337">9337</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l09335">conlock_wrlock_version</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l06623">ast_merge_contexts_and_delete()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09338"></a>09338 {
<a name="l09339"></a>09339    <span class="keywordflow">return</span> <a class="code" href="pbx_8c.html#ac28a7ad3697ac6c336e4aa198cf3b890">conlock_wrlock_version</a>;
<a name="l09340"></a>09340 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a92a606276589c513842f0cd7e455126b"></a><!-- doxytag: member="pbx.h::pbx_builtin_clear_globals" ref="a92a606276589c513842f0cd7e455126b" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pbx_builtin_clear_globals </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09182">9182</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00817">AST_LIST_REMOVE_HEAD</a>, <a class="el" href="lock_8h_source.html#l01791">ast_rwlock_unlock()</a>, <a class="el" href="lock_8h_source.html#l01827">ast_rwlock_wrlock()</a>, <a class="el" href="chanvars_8c_source.html#l00059">ast_var_delete()</a>, <a class="el" href="pbx_8c_source.html#l01067">globals</a>, and <a class="el" href="pbx_8c_source.html#l01066">globalslock</a>.</p>

<p>Referenced by <a class="el" href="pbx__config_8c_source.html#l01280">handle_cli_dialplan_reload()</a>, and <a class="el" href="pbx__config_8c_source.html#l01752">reload()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09183"></a>09183 {
<a name="l09184"></a>09184    <span class="keyword">struct </span><a class="code" href="structast__var__t.html">ast_var_t</a> *vardata;
<a name="l09185"></a>09185 
<a name="l09186"></a>09186    <a class="code" href="lock_8h.html#a952527792bba2a323118ae911f9aa1f7">ast_rwlock_wrlock</a>(&amp;<a class="code" href="pbx_8c.html#a3bbd0f743b066c2670d7301b078f6510">globalslock</a>);
<a name="l09187"></a>09187    <span class="keywordflow">while</span> ((vardata = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;<a class="code" href="pbx_8c.html#aec3689c71194f8504dafc644005a97db">globals</a>, entries)))
<a name="l09188"></a>09188       <a class="code" href="chanvars_8h.html#a52aaa758ed30031250c2d356b993c6d9">ast_var_delete</a>(vardata);
<a name="l09189"></a>09189    <a class="code" href="lock_8h.html#a21ce13cd6c771d5855f47ae7a1dd50b6">ast_rwlock_unlock</a>(&amp;<a class="code" href="pbx_8c.html#a3bbd0f743b066c2670d7301b078f6510">globalslock</a>);
<a name="l09190"></a>09190 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a98c5425b90ec7c5e136a40f529170b1b"></a><!-- doxytag: member="pbx.h::pbx_builtin_getvar_helper" ref="a98c5425b90ec7c5e136a40f529170b1b" args="(struct ast_channel *chan, const char *name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* pbx_builtin_getvar_helper </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Return a pointer to the value of the corresponding channel variable. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>Will lock the channel.</dd>
<dd>
This function will return a pointer to the buffer inside the channel variable. This value should only be accessed with the channel locked. If the value needs to be kept around, it should be done by using the following thread-safe code: <div class="fragment"><pre class="fragment">      <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>;

      <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>);
      <span class="keywordflow">if</span> ((var = <a class="code" href="pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b" title="Return a pointer to the value of the corresponding channel variable.">pbx_builtin_getvar_helper</a>(<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, <span class="stringliteral">&quot;MYVAR&quot;</span>))) {
         var = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(var);
      }
      <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>);
</pre></div> </dd></dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l08951">8951</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="lock_8h_source.html#l01796">ast_rwlock_rdlock()</a>, <a class="el" href="lock_8h_source.html#l01791">ast_rwlock_unlock()</a>, <a class="el" href="chanvars_8c_source.html#l00065">ast_var_name()</a>, <a class="el" href="chanvars_8c_source.html#l00085">ast_var_value()</a>, <a class="el" href="pbx_8c_source.html#l01067">globals</a>, <a class="el" href="pbx_8c_source.html#l01066">globalslock</a>, and <a class="el" href="channel_8h_source.html#l00446">ast_channel::varshead</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l04214">__ast_pbx_run()</a>, <a class="el" href="app__macro_8c_source.html#l00219">_macro_exec()</a>, <a class="el" href="app__while_8c_source.html#l00189">_while_exec()</a>, <a class="el" href="chan__agent_8c_source.html#l00893">agent_hangup()</a>, <a class="el" href="chan__agent_8c_source.html#l00519">agent_read()</a>, <a class="el" href="chan__agent_8c_source.html#l02309">agentmonitoroutgoing_exec()</a>, <a class="el" href="func__strings_8c_source.html#l00577">array()</a>, <a class="el" href="features_8c_source.html#l02441">ast_bridge_call()</a>, <a class="el" href="channel_8c_source.html#l03779">ast_call_forward()</a>, <a class="el" href="app__externalivr_8c_source.html#l00250">ast_eivr_getvariable()</a>, <a class="el" href="res__monitor_8c_source.html#l00291">ast_monitor_stop()</a>, <a class="el" href="channel_8c_source.html#l05027">bridge_play_sounds()</a>, <a class="el" href="features_8c_source.html#l01396">builtin_atxfer()</a>, <a class="el" href="features_8c_source.html#l01105">builtin_automixmonitor()</a>, <a class="el" href="features_8c_source.html#l01012">builtin_automonitor()</a>, <a class="el" href="features_8c_source.html#l00366">check_goto_on_transfer()</a>, <a class="el" href="app__chanspy_8c_source.html#l00767">common_exec()</a>, <a class="el" href="app__dahdiscan_8c_source.html#l00290">conf_exec()</a>, <a class="el" href="app__meetme_8c_source.html#l01998">conf_run()</a>, <a class="el" href="app__confbridge_8c_source.html#l00687">confbridge_exec()</a>, <a class="el" href="chan__dahdi_8c_source.html#l03101">dahdi_call()</a>, <a class="el" href="chan__dahdi_8c_source.html#l04313">dahdi_hangup()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="app__dial_8c_source.html#l00712">do_forward()</a>, <a class="el" href="app__dial_8c_source.html#l01143">do_timelimit()</a>, <a class="el" href="pbx__dundi_8c_source.html#l04566">dundi_exec()</a>, <a class="el" href="pbx__dundi_8c_source.html#l04517">dundi_helper()</a>, <a class="el" href="features_8c_source.html#l01996">feature_interpret()</a>, <a class="el" href="app__directed__pickup_8c_source.html#l00209">find_by_mark()</a>, <a class="el" href="app__meetme_8c_source.html#l03372">find_conf_realtime()</a>, <a class="el" href="features_8c_source.html#l00493">findparkinglotname()</a>, <a class="el" href="chan__sip_8c_source.html#l13667">get_also_info()</a>, <a class="el" href="app__while_8c_source.html#l00106">get_index()</a>, <a class="el" href="chan__sip_8c_source.html#l13489">get_refer_info()</a>, <a class="el" href="func__global_8c_source.html#l00103">global_read()</a>, <a class="el" href="func__strings_8c_source.html#l00684">hash_read()</a>, <a class="el" href="chan__iax2_8c_source.html#l04777">iax2_call()</a>, <a class="el" href="chan__iax2_8c_source.html#l13273">iax2_exec()</a>, <a class="el" href="chan__misdn_8c_source.html#l04259">import_ch()</a>, <a class="el" href="app__voicemail_8c_source.html#l05141">leave_voicemail()</a>, <a class="el" href="func__strings_8c_source.html#l00331">listfilter()</a>, <a class="el" href="chan__sip_8c_source.html#l20405">local_attended_transfer()</a>, <a class="el" href="chan__local_8c_source.html#l00582">local_hangup()</a>, <a class="el" href="app__stack_8c_source.html#l00455">local_read()</a>, <a class="el" href="chan__agent_8c_source.html#l01981">login_exec()</a>, <a class="el" href="app__macro_8c_source.html#l00166">macro_fixup()</a>, <a class="el" href="app__minivm_8c_source.html#l02157">minivm_delete_exec()</a>, <a class="el" href="app__minivm_8c_source.html#l01836">minivm_notify_exec()</a>, <a class="el" href="chan__misdn_8c_source.html#l02539">misdn_answer()</a>, <a class="el" href="chan__misdn_8c_source.html#l02789">misdn_hangup()</a>, <a class="el" href="app__morsecode_8c_source.html#l00121">morsecode_exec()</a>, <a class="el" href="app__minivm_8c_source.html#l01527">notify_new_message()</a>, <a class="el" href="chan__h323_8c_source.html#l00579">oh323_call()</a>, <a class="el" href="chan__h323_8c_source.html#l00681">oh323_hangup()</a>, <a class="el" href="features_8c_source.html#l00678">park_call_full()</a>, <a class="el" href="features_8c_source.html#l00566">park_space_reserve()</a>, <a class="el" href="pbx_8c_source.html#l08798">pbx_builtin_background()</a>, <a class="el" href="app__queue_8c_source.html#l05031">queue_exec()</a>, <a class="el" href="features_8c_source.html#l01236">real_ctx()</a>, <a class="el" href="app__dial_8c_source.html#l02345">retrydial_exec()</a>, <a class="el" href="app__queue_8c_source.html#l02467">ring_entry()</a>, <a class="el" href="res__agi_8c_source.html#l02853">run_agi()</a>, <a class="el" href="features_8c_source.html#l02099">set_config_flags()</a>, <a class="el" href="app__fax_8c_source.html#l00288">set_local_info()</a>, <a class="el" href="chan__sip_8c_source.html#l25438">sip_addheader()</a>, <a class="el" href="app__meetme_8c_source.html#l05808">sla_trunk_exec()</a>, <a class="el" href="app__speech__utils_8c_source.html#l00639">speech_background()</a>, <a class="el" href="app__queue_8c_source.html#l03569">try_calling()</a>, <a class="el" href="chan__sip_8c_source.html#l06163">try_suggested_sip_codec()</a>, <a class="el" href="channel_8c_source.html#l04990">update_bridge_vars()</a>, and <a class="el" href="app__dial_8c_source.html#l00818">wait_for_answer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l08952"></a>08952 {
<a name="l08953"></a>08953    <span class="keyword">struct </span><a class="code" href="structast__var__t.html">ast_var_t</a> *variables;
<a name="l08954"></a>08954    <span class="keyword">const</span> <span class="keywordtype">char</span> *ret = NULL;
<a name="l08955"></a>08955    <span class="keywordtype">int</span> i;
<a name="l08956"></a>08956    <span class="keyword">struct </span>varshead *places[2] = { NULL, &amp;<a class="code" href="pbx_8c.html#aec3689c71194f8504dafc644005a97db">globals</a> };
<a name="l08957"></a>08957 
<a name="l08958"></a>08958    <span class="keywordflow">if</span> (!<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>)
<a name="l08959"></a>08959       <span class="keywordflow">return</span> NULL;
<a name="l08960"></a>08960 
<a name="l08961"></a>08961    <span class="keywordflow">if</span> (chan) {
<a name="l08962"></a>08962       <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l08963"></a>08963       places[0] = &amp;chan-&gt;<a class="code" href="structast__channel.html#a9ffb22045a8f14bef8f2137cd779ab25">varshead</a>;
<a name="l08964"></a>08964    }
<a name="l08965"></a>08965 
<a name="l08966"></a>08966    <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++) {
<a name="l08967"></a>08967       <span class="keywordflow">if</span> (!places[i])
<a name="l08968"></a>08968          <span class="keywordflow">continue</span>;
<a name="l08969"></a>08969       <span class="keywordflow">if</span> (places[i] == &amp;<a class="code" href="pbx_8c.html#aec3689c71194f8504dafc644005a97db">globals</a>)
<a name="l08970"></a>08970          <a class="code" href="lock_8h.html#ae6703edce409c34119e27bdca1186d10">ast_rwlock_rdlock</a>(&amp;<a class="code" href="pbx_8c.html#a3bbd0f743b066c2670d7301b078f6510">globalslock</a>);
<a name="l08971"></a>08971       <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(places[i], variables, entries) {
<a name="l08972"></a>08972          <span class="keywordflow">if</span> (!strcmp(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <a class="code" href="chanvars_8h.html#a356a31cd608ec07d3668dcd589be49d8">ast_var_name</a>(variables))) {
<a name="l08973"></a>08973             ret = <a class="code" href="chanvars_8h.html#a8e0081172db71c5021d20706c50d959c">ast_var_value</a>(variables);
<a name="l08974"></a>08974             <span class="keywordflow">break</span>;
<a name="l08975"></a>08975          }
<a name="l08976"></a>08976       }
<a name="l08977"></a>08977       <span class="keywordflow">if</span> (places[i] == &amp;<a class="code" href="pbx_8c.html#aec3689c71194f8504dafc644005a97db">globals</a>)
<a name="l08978"></a>08978          <a class="code" href="lock_8h.html#a21ce13cd6c771d5855f47ae7a1dd50b6">ast_rwlock_unlock</a>(&amp;<a class="code" href="pbx_8c.html#a3bbd0f743b066c2670d7301b078f6510">globalslock</a>);
<a name="l08979"></a>08979       <span class="keywordflow">if</span> (ret)
<a name="l08980"></a>08980          <span class="keywordflow">break</span>;
<a name="l08981"></a>08981    }
<a name="l08982"></a>08982 
<a name="l08983"></a>08983    <span class="keywordflow">if</span> (chan)
<a name="l08984"></a>08984       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l08985"></a>08985 
<a name="l08986"></a>08986    <span class="keywordflow">return</span> ret;
<a name="l08987"></a>08987 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9e00ba1268d8792b95063aeedd9244ea"></a><!-- doxytag: member="pbx.h::pbx_builtin_pushvar_helper" ref="a9e00ba1268d8792b95063aeedd9244ea" args="(struct ast_channel *chan, const char *name, const char *value)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pbx_builtin_pushvar_helper </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>value</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add a variable to the channel variable stack, without removing any previously set value. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>Will lock the channel. </dd></dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l08989">8989</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="pbx_8c_source.html#l03379">ast_func_write()</a>, <a class="el" href="linkedlists_8h_source.html#l00695">AST_LIST_INSERT_HEAD</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01791">ast_rwlock_unlock()</a>, <a class="el" href="lock_8h_source.html#l01827">ast_rwlock_wrlock()</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="chanvars_8c_source.html#l00037">ast_var_assign()</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="pbx_8c_source.html#l01067">globals</a>, <a class="el" href="pbx_8c_source.html#l01066">globalslock</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, and <a class="el" href="channel_8h_source.html#l00446">ast_channel::varshead</a>.</p>

<p>Referenced by <a class="el" href="func__odbc_8c_source.html#l00375">acf_odbc_read()</a>, <a class="el" href="func__odbc_8c_source.html#l00203">acf_odbc_write()</a>, <a class="el" href="func__odbc_8c_source.html#l00978">cli_odbc_read()</a>, <a class="el" href="func__odbc_8c_source.html#l01177">cli_odbc_write()</a>, and <a class="el" href="app__stack_8c_source.html#l00192">frame_set_var()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l08990"></a>08990 {
<a name="l08991"></a>08991    <span class="keyword">struct </span><a class="code" href="structast__var__t.html">ast_var_t</a> *newvariable;
<a name="l08992"></a>08992    <span class="keyword">struct </span>varshead *headp;
<a name="l08993"></a>08993 
<a name="l08994"></a>08994    <span class="keywordflow">if</span> (<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>[strlen(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>)-1] == <span class="charliteral">&apos;)&apos;</span>) {
<a name="l08995"></a>08995       <span class="keywordtype">char</span> *function = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l08996"></a>08996 
<a name="l08997"></a>08997       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Cannot push a value onto a function\n&quot;</span>);
<a name="l08998"></a>08998       <a class="code" href="pbx_8h.html#ae70e64cdf669396c88ea8eda900b0b3b" title="executes a write operation on a function">ast_func_write</a>(chan, function, value);
<a name="l08999"></a>08999       <span class="keywordflow">return</span>;
<a name="l09000"></a>09000    }
<a name="l09001"></a>09001 
<a name="l09002"></a>09002    <span class="keywordflow">if</span> (chan) {
<a name="l09003"></a>09003       <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l09004"></a>09004       headp = &amp;chan-&gt;<a class="code" href="structast__channel.html#a9ffb22045a8f14bef8f2137cd779ab25">varshead</a>;
<a name="l09005"></a>09005    } <span class="keywordflow">else</span> {
<a name="l09006"></a>09006       <a class="code" href="lock_8h.html#a952527792bba2a323118ae911f9aa1f7">ast_rwlock_wrlock</a>(&amp;<a class="code" href="pbx_8c.html#a3bbd0f743b066c2670d7301b078f6510">globalslock</a>);
<a name="l09007"></a>09007       headp = &amp;<a class="code" href="pbx_8c.html#aec3689c71194f8504dafc644005a97db">globals</a>;
<a name="l09008"></a>09008    }
<a name="l09009"></a>09009 
<a name="l09010"></a>09010    <span class="keywordflow">if</span> (value) {
<a name="l09011"></a>09011       <span class="keywordflow">if</span> (headp == &amp;<a class="code" href="pbx_8c.html#aec3689c71194f8504dafc644005a97db">globals</a>)
<a name="l09012"></a>09012          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Setting global variable &apos;%s&apos; to &apos;%s&apos;\n&quot;</span>, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, value);
<a name="l09013"></a>09013       newvariable = <a class="code" href="chanvars_8h.html#a8ea2b5a29fa275115c7ed27a593b727d">ast_var_assign</a>(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, value);
<a name="l09014"></a>09014       <a class="code" href="linkedlists_8h.html#aa2ded2af046bb513f77056c27c083307" title="Inserts a list entry at the head of a list.">AST_LIST_INSERT_HEAD</a>(headp, newvariable, entries);
<a name="l09015"></a>09015    }
<a name="l09016"></a>09016 
<a name="l09017"></a>09017    <span class="keywordflow">if</span> (chan)
<a name="l09018"></a>09018       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l09019"></a>09019    <span class="keywordflow">else</span>
<a name="l09020"></a>09020       <a class="code" href="lock_8h.html#a21ce13cd6c771d5855f47ae7a1dd50b6">ast_rwlock_unlock</a>(&amp;<a class="code" href="pbx_8c.html#a3bbd0f743b066c2670d7301b078f6510">globalslock</a>);
<a name="l09021"></a>09021 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="abc705e1c806491af6419892a1237d920"></a><!-- doxytag: member="pbx.h::pbx_builtin_raise_exception" ref="abc705e1c806491af6419892a1237d920" args="(struct ast_channel *chan, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int pbx_builtin_raise_exception </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8c_source.html#l02995">2995</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="channel_8c_source.html#l01534">ast_channel_datastore_add()</a>, <a class="el" href="channel_8c_source.html#l01548">ast_channel_datastore_find()</a>, <a class="el" href="datastore_8h_source.html#l00071">ast_datastore_alloc</a>, <a class="el" href="datastore_8c_source.html#l00058">ast_datastore_free()</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="stringfields_8h_source.html#l00241">ast_string_field_init</a>, <a class="el" href="stringfields_8h_source.html#l00285">ast_string_field_set</a>, <a class="el" href="channel_8h_source.html#l00503">ast_channel::context</a>, <a class="el" href="datastore_8h_source.html#l00056">ast_datastore::data</a>, <a class="el" href="pbx_8c_source.html#l02990">exception_store_info</a>, <a class="el" href="channel_8h_source.html#l00504">ast_channel::exten</a>, <a class="el" href="channel_8h_source.html#l00471">ast_channel::priority</a>, <a class="el" href="pbx_8c_source.html#l00918">pbx_exception::priority</a>, and <a class="el" href="pbx_8c_source.html#l04174">set_ext_pri()</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l04214">__ast_pbx_run()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02996"></a>02996 {
<a name="l02997"></a>02997    <span class="keyword">const</span> <span class="keywordtype">char</span> *reason = vreason;
<a name="l02998"></a>02998    <span class="keyword">struct </span><a class="code" href="structast__datastore.html" title="Structure for a data store object.">ast_datastore</a> *ds = <a class="code" href="channel_8h.html#aad1e09cd7c79237d05cffb45d6cdfd7c" title="Find a datastore on a channel.">ast_channel_datastore_find</a>(chan, &amp;<a class="code" href="pbx_8c.html#a805b54680c64fe964e8326102f6d540a">exception_store_info</a>, NULL);
<a name="l02999"></a>02999    <span class="keyword">struct </span><a class="code" href="structpbx__exception.html">pbx_exception</a> *exception = NULL;
<a name="l03000"></a>03000 
<a name="l03001"></a>03001    <span class="keywordflow">if</span> (!ds) {
<a name="l03002"></a>03002       ds = <a class="code" href="datastore_8h.html#a666afb07fd77d50782cc10f83e029159">ast_datastore_alloc</a>(&amp;<a class="code" href="pbx_8c.html#a805b54680c64fe964e8326102f6d540a">exception_store_info</a>, NULL);
<a name="l03003"></a>03003       <span class="keywordflow">if</span> (!ds)
<a name="l03004"></a>03004          <span class="keywordflow">return</span> -1;
<a name="l03005"></a>03005       exception = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structpbx__exception.html">pbx_exception</a>));
<a name="l03006"></a>03006       <span class="keywordflow">if</span> (!exception) {
<a name="l03007"></a>03007          <a class="code" href="datastore_8h.html#aee27286888b30c6448a9bce928040a14" title="Free a data store object.">ast_datastore_free</a>(ds);
<a name="l03008"></a>03008          <span class="keywordflow">return</span> -1;
<a name="l03009"></a>03009       }
<a name="l03010"></a>03010       <span class="keywordflow">if</span> (<a class="code" href="stringfields_8h.html#a871274fa4fd2687c7a44849a84df3665" title="Initialize a field pool and fields.">ast_string_field_init</a>(exception, 128)) {
<a name="l03011"></a>03011          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(exception);
<a name="l03012"></a>03012          <a class="code" href="datastore_8h.html#aee27286888b30c6448a9bce928040a14" title="Free a data store object.">ast_datastore_free</a>(ds);
<a name="l03013"></a>03013          <span class="keywordflow">return</span> -1;
<a name="l03014"></a>03014       }
<a name="l03015"></a>03015       ds-&gt;<a class="code" href="structast__datastore.html#a735984d41155bc1032e09bece8f8d66d">data</a> = exception;
<a name="l03016"></a>03016       <a class="code" href="channel_8h.html#a1ed3e98d33d5587948a0e2ef67a81f52" title="Add a datastore to a channel.">ast_channel_datastore_add</a>(chan, ds);
<a name="l03017"></a>03017    } <span class="keywordflow">else</span>
<a name="l03018"></a>03018       exception = ds-&gt;<a class="code" href="structast__datastore.html#a735984d41155bc1032e09bece8f8d66d">data</a>;
<a name="l03019"></a>03019 
<a name="l03020"></a>03020    <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(exception, reason, reason);
<a name="l03021"></a>03021    <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(exception, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, chan-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>);
<a name="l03022"></a>03022    <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(exception, <a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, chan-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>);
<a name="l03023"></a>03023    exception-&gt;<a class="code" href="structpbx__exception.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> = chan-&gt;<a class="code" href="structast__channel.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>;
<a name="l03024"></a>03024    <a class="code" href="pbx_8c.html#ae269f012897ae046fe6e785ba8521c88">set_ext_pri</a>(chan, <span class="stringliteral">&quot;e&quot;</span>, 0);
<a name="l03025"></a>03025    <span class="keywordflow">return</span> 0;
<a name="l03026"></a>03026 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a847dc86089ce693d89a534512f16dad1"></a><!-- doxytag: member="pbx.h::pbx_builtin_serialize_variables" ref="a847dc86089ce693d89a534512f16dad1" args="(struct ast_channel *chan, struct ast_str **buf)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int pbx_builtin_serialize_variables </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__str.html">ast_str</a> **&nbsp;</td>
          <td class="paramname"> <em>buf</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Create a human-readable string, specifying all variables and their corresponding <a class="el" href="structvalues.html">values</a>. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel from which to read variables </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>buf</em>&nbsp;</td><td>Dynamic string in which to place the result (should be allocated with </td></tr>
  </table>
  </dd>
</dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="strings_8h.html#a8ec37e4acb6ecb20eb6f6edd1141cd76" title="Create a malloc&#39;ed dynamic length string.">ast_str_create</a>). </dd></dl>
<dl class="note"><dt><b>Note:</b></dt><dd>Will lock the channel. </dd></dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l08920">8920</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="strings_8h_source.html#l00846">ast_str_append()</a>, <a class="el" href="strings_8h_source.html#l00431">ast_str_reset()</a>, <a class="el" href="chanvars_8c_source.html#l00065">ast_var_name()</a>, <a class="el" href="chanvars_8c_source.html#l00085">ast_var_value()</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="res__adsi_8c_source.html#l00893">total</a>, <a class="el" href="ast__expr2f_8c_source.html#l00613">var</a>, and <a class="el" href="channel_8h_source.html#l00446">ast_channel::varshead</a>.</p>

<p>Referenced by <a class="el" href="agent_8c_source.html#l00228">ast_var_channels_table()</a>, <a class="el" href="app__dumpchan_8c_source.html#l00150">dumpchan_exec()</a>, <a class="el" href="pbx_8c_source.html#l06215">handle_show_chanvar()</a>, <a class="el" href="cli_8c_source.html#l01268">handle_showchan()</a>, and <a class="el" href="app__queue_8c_source.html#l02416">vars2manager()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l08921"></a>08921 {
<a name="l08922"></a>08922    <span class="keyword">struct </span><a class="code" href="structast__var__t.html">ast_var_t</a> *variables;
<a name="l08923"></a>08923    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>, *<a class="code" href="structval.html">val</a>;
<a name="l08924"></a>08924    <span class="keywordtype">int</span> <a class="code" href="res__adsi_8c.html#ac7af894858cf396a219d632f40afdc8d">total</a> = 0;
<a name="l08925"></a>08925 
<a name="l08926"></a>08926    <span class="keywordflow">if</span> (!chan)
<a name="l08927"></a>08927       <span class="keywordflow">return</span> 0;
<a name="l08928"></a>08928 
<a name="l08929"></a>08929    <a class="code" href="strings_8h.html#a7820deea616cbb2e28f16d518de91c80" title="Reset the content of a dynamic string. Useful before a series of ast_str_append.">ast_str_reset</a>(*buf);
<a name="l08930"></a>08930 
<a name="l08931"></a>08931    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l08932"></a>08932 
<a name="l08933"></a>08933    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;chan-&gt;<a class="code" href="structast__channel.html#a9ffb22045a8f14bef8f2137cd779ab25">varshead</a>, variables, entries) {
<a name="l08934"></a>08934       <span class="keywordflow">if</span> ((var = <a class="code" href="chanvars_8h.html#a356a31cd608ec07d3668dcd589be49d8">ast_var_name</a>(variables)) &amp;&amp; (val = <a class="code" href="chanvars_8h.html#a8e0081172db71c5021d20706c50d959c">ast_var_value</a>(variables))
<a name="l08935"></a>08935          <span class="comment">/* &amp;&amp; !ast_strlen_zero(var) &amp;&amp; !ast_strlen_zero(val) */</span>
<a name="l08936"></a>08936          ) {
<a name="l08937"></a>08937          <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a85cd5a8ef499e39d22b4bfeb8b9a64f7" title="Append to a thread local dynamic string.">ast_str_append</a>(buf, 0, <span class="stringliteral">&quot;%s=%s\n&quot;</span>, var, val) &lt; 0) {
<a name="l08938"></a>08938             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Data Buffer Size Exceeded!\n&quot;</span>);
<a name="l08939"></a>08939             <span class="keywordflow">break</span>;
<a name="l08940"></a>08940          } <span class="keywordflow">else</span>
<a name="l08941"></a>08941             total++;
<a name="l08942"></a>08942       } <span class="keywordflow">else</span>
<a name="l08943"></a>08943          <span class="keywordflow">break</span>;
<a name="l08944"></a>08944    }
<a name="l08945"></a>08945 
<a name="l08946"></a>08946    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l08947"></a>08947 
<a name="l08948"></a>08948    <span class="keywordflow">return</span> total;
<a name="l08949"></a>08949 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa2489c1ea3b067f827ad20abf363cdcd"></a><!-- doxytag: member="pbx.h::pbx_builtin_setvar" ref="aa2489c1ea3b067f827ad20abf363cdcd" args="(struct ast_channel *chan, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int pbx_builtin_setvar </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Parse and set a single channel variable, where the name and value are separated with an '=' character. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>Will lock the channel. </dd></dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09081">9081</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="options_8h_source.html#l00136">ast_compat_app_set</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="pbx_8c_source.html#l09023">pbx_builtin_setvar_helper()</a>, <a class="el" href="pbx_8c_source.html#l09104">pbx_builtin_setvar_multiple()</a>, and <a class="el" href="agi_2strcompat_8c_source.html#l00027">strsep()</a>.</p>

<p>Referenced by <a class="el" href="pval_8c_source.html#l04393">ast_compile_ael2()</a>, and <a class="el" href="app__rpt_8c_source.html#l13122">rpt_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09082"></a>09082 {
<a name="l09083"></a>09083    <span class="keywordtype">char</span> *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, *<a class="code" href="structast__var__t.html#a4e9aec275e566b978a3ccb4e043d8c61">value</a>, *mydata;
<a name="l09084"></a>09084 
<a name="l09085"></a>09085    <span class="keywordflow">if</span> (<a class="code" href="options_8h.html#ae1b271c99d5fa3676962041210536327">ast_compat_app_set</a>) {
<a name="l09086"></a>09086       <span class="keywordflow">return</span> <a class="code" href="pbx_8h.html#a990bfc8582dc017423d8518bcc110a2c" title="Parse and set multiple channel variables, where the pairs are separated by the &amp;#39;...">pbx_builtin_setvar_multiple</a>(chan, data);
<a name="l09087"></a>09087    }
<a name="l09088"></a>09088 
<a name="l09089"></a>09089    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(data)) {
<a name="l09090"></a>09090       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Set requires one variable name/value pair.\n&quot;</span>);
<a name="l09091"></a>09091       <span class="keywordflow">return</span> 0;
<a name="l09092"></a>09092    }
<a name="l09093"></a>09093 
<a name="l09094"></a>09094    mydata = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(data);
<a name="l09095"></a>09095    name = <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;mydata, <span class="stringliteral">&quot;=&quot;</span>);
<a name="l09096"></a>09096    value = mydata;
<a name="l09097"></a>09097    <span class="keywordflow">if</span> (strchr(name, <span class="charliteral">&apos; &apos;</span>))
<a name="l09098"></a>09098       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Please avoid unnecessary spaces on variables as it may lead to unexpected results (&apos;%s&apos; set to &apos;%s&apos;).\n&quot;</span>, name, mydata);
<a name="l09099"></a>09099 
<a name="l09100"></a>09100    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, name, value);
<a name="l09101"></a>09101    <span class="keywordflow">return</span>(0);
<a name="l09102"></a>09102 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac74f20f5a5f022a60fdf2db0dc84889c"></a><!-- doxytag: member="pbx.h::pbx_builtin_setvar_helper" ref="ac74f20f5a5f022a60fdf2db0dc84889c" args="(struct ast_channel *chan, const char *name, const char *value)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pbx_builtin_setvar_helper </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>value</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add a variable to the channel variable stack, removing the most recently set value for the same name. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>Will lock the channel. May also be used to set a channel dialplan function to a particular value. </dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="pbx_8c.html#ae70e64cdf669396c88ea8eda900b0b3b" title="executes a write operation on a function">ast_func_write</a> </dd></dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09023">9023</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="pbx_8c_source.html#l03379">ast_func_write()</a>, <a class="el" href="linkedlists_8h_source.html#l00695">AST_LIST_INSERT_HEAD</a>, <a class="el" href="linkedlists_8h_source.html#l00553">AST_LIST_REMOVE_CURRENT</a>, <a class="el" href="linkedlists_8h_source.html#l00528">AST_LIST_TRAVERSE_SAFE_BEGIN</a>, <a class="el" href="linkedlists_8h_source.html#l00599">AST_LIST_TRAVERSE_SAFE_END</a>, <a class="el" href="lock_8h_source.html#l01791">ast_rwlock_unlock()</a>, <a class="el" href="lock_8h_source.html#l01827">ast_rwlock_wrlock()</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="chanvars_8c_source.html#l00037">ast_var_assign()</a>, <a class="el" href="chanvars_8c_source.html#l00059">ast_var_delete()</a>, <a class="el" href="chanvars_8c_source.html#l00065">ast_var_name()</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="manager_8h_source.html#l00072">EVENT_FLAG_DIALPLAN</a>, <a class="el" href="pbx_8c_source.html#l01067">globals</a>, <a class="el" href="pbx_8c_source.html#l01066">globalslock</a>, <a class="el" href="manager_8h_source.html#l00181">manager_event</a>, and <a class="el" href="channel_8h_source.html#l00446">ast_channel::varshead</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l04214">__ast_pbx_run()</a>, <a class="el" href="chan__h323_8c_source.html#l00999">__oh323_new()</a>, <a class="el" href="app__macro_8c_source.html#l00219">_macro_exec()</a>, <a class="el" href="app__while_8c_source.html#l00189">_while_exec()</a>, <a class="el" href="func__curl_8c_source.html#l00397">acf_curl_exec()</a>, <a class="el" href="func__odbc_8c_source.html#l00699">acf_fetch()</a>, <a class="el" href="func__odbc_8c_source.html#l00375">acf_odbc_read()</a>, <a class="el" href="func__odbc_8c_source.html#l00203">acf_odbc_write()</a>, <a class="el" href="res__odbc_8c_source.html#l01502">acf_transaction_write()</a>, <a class="el" href="manager_8c_source.html#l02168">action_atxfer()</a>, <a class="el" href="manager_8c_source.html#l01803">action_setvar()</a>, <a class="el" href="app__meetme_8c_source.html#l03969">admin_exec()</a>, <a class="el" href="res__agi_8c_source.html#l03212">agi_exec_full()</a>, <a class="el" href="res__jabber_8c_source.html#l00432">aji_status_exec()</a>, <a class="el" href="app__queue_8c_source.html#l04893">aqm_exec()</a>, <a class="el" href="func__strings_8c_source.html#l00577">array()</a>, <a class="el" href="features_8c_source.html#l02441">ast_bridge_call()</a>, <a class="el" href="app__externalivr_8c_source.html#l00283">ast_eivr_setvariable()</a>, <a class="el" href="chan__iax2_8c_source.html#l05415">ast_iax2_new()</a>, <a class="el" href="res__monitor_8c_source.html#l00148">ast_monitor_start()</a>, <a class="el" href="pbx_8c_source.html#l07940">ast_pbx_outgoing_exten()</a>, <a class="el" href="rtp_8c_source.html#l02835">ast_rtp_set_vars()</a>, <a class="el" href="channel_8c_source.html#l05592">ast_set_variables()</a>, <a class="el" href="app__channelredirect_8c_source.html#l00065">asyncgoto_exec()</a>, <a class="el" href="app__talkdetect_8c_source.html#l00076">background_detect_exec()</a>, <a class="el" href="features_8c_source.html#l04524">bridge_exec()</a>, <a class="el" href="channel_8c_source.html#l05027">bridge_play_sounds()</a>, <a class="el" href="features_8c_source.html#l01396">builtin_atxfer()</a>, <a class="el" href="features_8c_source.html#l01105">builtin_automixmonitor()</a>, <a class="el" href="features_8c_source.html#l01012">builtin_automonitor()</a>, <a class="el" href="features_8c_source.html#l01265">builtin_blindtransfer()</a>, <a class="el" href="chan__misdn_8c_source.html#l04379">cb_events()</a>, <a class="el" href="app__chanisavail_8c_source.html#l00097">chanavail_exec()</a>, <a class="el" href="app__chanspy_8c_source.html#l00445">channel_spy()</a>, <a class="el" href="res__odbc_8c_source.html#l01052">commit_exec()</a>, <a class="el" href="app__meetme_8c_source.html#l01998">conf_run()</a>, <a class="el" href="app__controlplayback_8c_source.html#l00128">controlplayback_exec()</a>, <a class="el" href="app__meetme_8c_source.html#l03650">count_exec()</a>, <a class="el" href="chan__dahdi_8c_source.html#l05607">dahdi_handle_dtmfup()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07417">dahdi_new()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="app__disa_8c_source.html#l00143">disa_exec()</a>, <a class="el" href="app__waitforsilence_8c_source.html#l00125">do_waiting()</a>, <a class="el" href="app__dial_8c_source.html#l01486">end_bridge_callback()</a>, <a class="el" href="chan__misdn_8c_source.html#l00683">export_aoc_vars()</a>, <a class="el" href="chan__misdn_8c_source.html#l04296">export_ch()</a>, <a class="el" href="features_8c_source.html#l02152">feature_request_and_dial()</a>, <a class="el" href="app__stack_8c_source.html#l00192">frame_set_var()</a>, <a class="el" href="func__db_8c_source.html#l00206">function_db_delete()</a>, <a class="el" href="func__db_8c_source.html#l00169">function_db_exists()</a>, <a class="el" href="func__db_8c_source.html#l00105">function_db_read()</a>, <a class="el" href="func__realtime_8c_source.html#l00309">function_realtime_store()</a>, <a class="el" href="chan__sip_8c_source.html#l13195">get_rdnis()</a>, <a class="el" href="chan__sip_8c_source.html#l13489">get_refer_info()</a>, <a class="el" href="func__global_8c_source.html#l00115">global_write()</a>, <a class="el" href="app__stack_8c_source.html#l00222">gosub_release_frame()</a>, <a class="el" href="chan__sip_8c_source.html#l21024">handle_request_bye()</a>, <a class="el" href="chan__sip_8c_source.html#l20572">handle_request_refer()</a>, <a class="el" href="pbx_8c_source.html#l06269">handle_set_chanvar()</a>, <a class="el" href="pbx_8c_source.html#l06247">handle_set_global()</a>, <a class="el" href="res__agi_8c_source.html#l01809">handle_setvariable()</a>, <a class="el" href="func__strings_8c_source.html#l00684">hash_read()</a>, <a class="el" href="func__strings_8c_source.html#l00664">hash_write()</a>, <a class="el" href="app__amd_8c_source.html#l00146">isAnsweringMachine()</a>, <a class="el" href="app__minivm_8c_source.html#l01604">leave_voicemail()</a>, <a class="el" href="chan__local_8c_source.html#l00582">local_hangup()</a>, <a class="el" href="pbx__lua_8c_source.html#l00554">lua_set_variable()</a>, <a class="el" href="pbx__lua_8c_source.html#l00320">lua_set_variable_value()</a>, <a class="el" href="app__macro_8c_source.html#l00166">macro_fixup()</a>, <a class="el" href="features_8c_source.html#l03009">manage_parkinglot()</a>, <a class="el" href="app__minivm_8c_source.html#l02195">minivm_accmess_exec()</a>, <a class="el" href="app__minivm_8c_source.html#l02157">minivm_delete_exec()</a>, <a class="el" href="app__minivm_8c_source.html#l01971">minivm_greet_exec()</a>, <a class="el" href="app__minivm_8c_source.html#l01836">minivm_notify_exec()</a>, <a class="el" href="app__minivm_8c_source.html#l01915">minivm_record_exec()</a>, <a class="el" href="chan__misdn_8c_source.html#l02394">misdn_call()</a>, <a class="el" href="app__mixmonitor_8c_source.html#l00469">mixmonitor_exec()</a>, <a class="el" href="app__originate_8c_source.html#l00092">originate_exec()</a>, <a class="el" href="app__osplookup_8c_source.html#l01255">ospauth_exec()</a>, <a class="el" href="app__osplookup_8c_source.html#l01657">ospfinished_exec()</a>, <a class="el" href="app__osplookup_8c_source.html#l01335">osplookup_exec()</a>, <a class="el" href="app__osplookup_8c_source.html#l01503">ospnext_exec()</a>, <a class="el" href="features_8c_source.html#l03335">park_exec_full()</a>, <a class="el" href="chan__sip_8c_source.html#l17435">parse_moved_contact()</a>, <a class="el" href="pbx_8c_source.html#l08798">pbx_builtin_background()</a>, <a class="el" href="pbx_8c_source.html#l09140">pbx_builtin_importvar()</a>, <a class="el" href="pbx_8c_source.html#l09081">pbx_builtin_setvar()</a>, <a class="el" href="pbx_8c_source.html#l09104">pbx_builtin_setvar_multiple()</a>, <a class="el" href="pbx__config_8c_source.html#l01367">pbx_load_config()</a>, <a class="el" href="app__fax_8c_source.html#l00202">phase_e_handler()</a>, <a class="el" href="app__voicemail_8c_source.html#l06865">play_message_datetime()</a>, <a class="el" href="app__playback_8c_source.html#l00418">playback_exec()</a>, <a class="el" href="app__queue_8c_source.html#l04764">pqm_exec()</a>, <a class="el" href="app__minivm_8c_source.html#l00875">prep_email_sub_vars()</a>, <a class="el" href="app__privacy_8c_source.html#l00083">privacy_exec()</a>, <a class="el" href="chan__misdn_8c_source.html#l02961">process_ast_dsp()</a>, <a class="el" href="app__read_8c_source.html#l00127">read_exec()</a>, <a class="el" href="app__readexten_8c_source.html#l00128">readexten_exec()</a>, <a class="el" href="app__readfile_8c_source.html#l00070">readfile_exec()</a>, <a class="el" href="func__realtime_8c_source.html#l00233">realtimefield_read()</a>, <a class="el" href="app__record_8c_source.html#l00132">record_exec()</a>, <a class="el" href="app__stack_8c_source.html#l00294">return_exec()</a>, <a class="el" href="res__odbc_8c_source.html#l01089">rollback_exec()</a>, <a class="el" href="logger_8c_source.html#l00500">rotate_file()</a>, <a class="el" href="app__rpt_8c_source.html#l13122">rpt_exec()</a>, <a class="el" href="app__queue_8c_source.html#l04836">rqm_exec()</a>, <a class="el" href="app__image_8c_source.html#l00072">sendimage_exec()</a>, <a class="el" href="app__sendtext_8c_source.html#l00075">sendtext_exec()</a>, <a class="el" href="app__url_8c_source.html#l00093">sendurl_exec()</a>, <a class="el" href="func__logic_8c_source.html#l00204">set()</a>, <a class="el" href="chan__agent_8c_source.html#l00847">set_agentbycallerid()</a>, <a class="el" href="app__queue_8c_source.html#l00827">set_queue_result()</a>, <a class="el" href="chan__sip_8c_source.html#l25438">sip_addheader()</a>, <a class="el" href="chan__sip_8c_source.html#l05956">sip_hangup()</a>, <a class="el" href="chan__sip_8c_source.html#l06599">sip_new()</a>, <a class="el" href="chan__sip_8c_source.html#l07045">sip_read()</a>, <a class="el" href="chan__skinny_8c_source.html#l04268">skinny_new()</a>, <a class="el" href="app__meetme_8c_source.html#l05173">sla_calc_trunk_timeouts()</a>, <a class="el" href="app__meetme_8c_source.html#l05601">sla_station_exec()</a>, <a class="el" href="app__meetme_8c_source.html#l05808">sla_trunk_exec()</a>, <a class="el" href="chan__iax2_8c_source.html#l09458">socket_process()</a>, <a class="el" href="app__speech__utils_8c_source.html#l00484">speech_create()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>, <a class="el" href="res__monitor_8c_source.html#l00495">start_monitor_exec()</a>, <a class="el" href="app__system_8c_source.html#l00103">system_exec_helper()</a>, <a class="el" href="app__transfer_8c_source.html#l00077">transfer_exec()</a>, <a class="el" href="app__fax_8c_source.html#l00772">transmit()</a>, <a class="el" href="app__exec_8c_source.html#l00163">tryexec_exec()</a>, <a class="el" href="channel_8c_source.html#l04990">update_bridge_vars()</a>, <a class="el" href="app__queue_8c_source.html#l03163">update_qe_rule()</a>, <a class="el" href="app__queue_8c_source.html#l04800">upqm_exec()</a>, <a class="el" href="app__voicemail_8c_source.html#l09942">vm_box_exists()</a>, <a class="el" href="app__voicemail_8c_source.html#l09810">vm_exec()</a>, <a class="el" href="app__voicemail_8c_source.html#l10006">vmauthenticate()</a>, <a class="el" href="app__waituntil_8c_source.html#l00070">waituntil_exec()</a>, and <a class="el" href="app__zapateller_8c_source.html#l00077">zapateller_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09024"></a>09024 {
<a name="l09025"></a>09025    <span class="keyword">struct </span><a class="code" href="structast__var__t.html">ast_var_t</a> *newvariable;
<a name="l09026"></a>09026    <span class="keyword">struct </span>varshead *headp;
<a name="l09027"></a>09027    <span class="keyword">const</span> <span class="keywordtype">char</span> *nametail = <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>;
<a name="l09028"></a>09028 
<a name="l09029"></a>09029    <span class="keywordflow">if</span> (<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>[strlen(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>) - 1] == <span class="charliteral">&apos;)&apos;</span>) {
<a name="l09030"></a>09030       <span class="keywordtype">char</span> *function = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l09031"></a>09031 
<a name="l09032"></a>09032       <a class="code" href="pbx_8h.html#ae70e64cdf669396c88ea8eda900b0b3b" title="executes a write operation on a function">ast_func_write</a>(chan, function, value);
<a name="l09033"></a>09033       <span class="keywordflow">return</span>;
<a name="l09034"></a>09034    }
<a name="l09035"></a>09035 
<a name="l09036"></a>09036    <span class="keywordflow">if</span> (chan) {
<a name="l09037"></a>09037       <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(chan);
<a name="l09038"></a>09038       headp = &amp;chan-&gt;<a class="code" href="structast__channel.html#a9ffb22045a8f14bef8f2137cd779ab25">varshead</a>;
<a name="l09039"></a>09039    } <span class="keywordflow">else</span> {
<a name="l09040"></a>09040       <a class="code" href="lock_8h.html#a952527792bba2a323118ae911f9aa1f7">ast_rwlock_wrlock</a>(&amp;<a class="code" href="pbx_8c.html#a3bbd0f743b066c2670d7301b078f6510">globalslock</a>);
<a name="l09041"></a>09041       headp = &amp;<a class="code" href="pbx_8c.html#aec3689c71194f8504dafc644005a97db">globals</a>;
<a name="l09042"></a>09042    }
<a name="l09043"></a>09043 
<a name="l09044"></a>09044    <span class="comment">/* For comparison purposes, we have to strip leading underscores */</span>
<a name="l09045"></a>09045    <span class="keywordflow">if</span> (*nametail == <span class="charliteral">&apos;_&apos;</span>) {
<a name="l09046"></a>09046       nametail++;
<a name="l09047"></a>09047       <span class="keywordflow">if</span> (*nametail == <span class="charliteral">&apos;_&apos;</span>)
<a name="l09048"></a>09048          nametail++;
<a name="l09049"></a>09049    }
<a name="l09050"></a>09050 
<a name="l09051"></a>09051    <a class="code" href="linkedlists_8h.html#aa5be52067bf16bdc7e56ca19b5ba858d" title="Loops safely over (traverses) the entries in a list.">AST_LIST_TRAVERSE_SAFE_BEGIN</a>(headp, newvariable, entries) {
<a name="l09052"></a>09052       <span class="keywordflow">if</span> (strcasecmp(<a class="code" href="chanvars_8h.html#a356a31cd608ec07d3668dcd589be49d8">ast_var_name</a>(newvariable), nametail) == 0) {
<a name="l09053"></a>09053          <span class="comment">/* there is already such a variable, delete it */</span>
<a name="l09054"></a>09054          <a class="code" href="linkedlists_8h.html#aa8ac496fa9c717d5afb99a02e1e2760c" title="Removes the current entry from a list during a traversal.">AST_LIST_REMOVE_CURRENT</a>(entries);
<a name="l09055"></a>09055          <a class="code" href="chanvars_8h.html#a52aaa758ed30031250c2d356b993c6d9">ast_var_delete</a>(newvariable);
<a name="l09056"></a>09056          <span class="keywordflow">break</span>;
<a name="l09057"></a>09057       }
<a name="l09058"></a>09058    }
<a name="l09059"></a>09059    <a class="code" href="linkedlists_8h.html#a712c04b4493919a7052399cd30ee8fb9" title="Closes a safe loop traversal block.">AST_LIST_TRAVERSE_SAFE_END</a>;
<a name="l09060"></a>09060 
<a name="l09061"></a>09061    <span class="keywordflow">if</span> (value) {
<a name="l09062"></a>09062       <span class="keywordflow">if</span> (headp == &amp;<a class="code" href="pbx_8c.html#aec3689c71194f8504dafc644005a97db">globals</a>)
<a name="l09063"></a>09063          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Setting global variable &apos;%s&apos; to &apos;%s&apos;\n&quot;</span>, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, value);
<a name="l09064"></a>09064       newvariable = <a class="code" href="chanvars_8h.html#a8ea2b5a29fa275115c7ed27a593b727d">ast_var_assign</a>(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, value);
<a name="l09065"></a>09065       <a class="code" href="linkedlists_8h.html#aa2ded2af046bb513f77056c27c083307" title="Inserts a list entry at the head of a list.">AST_LIST_INSERT_HEAD</a>(headp, newvariable, entries);
<a name="l09066"></a>09066       <a class="code" href="manager_8h.html#a1ef0ee0044dbbeb4c3a5abc6c046b208" title="External routines may send asterisk manager events this way.">manager_event</a>(<a class="code" href="manager_8h.html#ad602e069591b527f28e36dd472425e7e">EVENT_FLAG_DIALPLAN</a>, <span class="stringliteral">&quot;VarSet&quot;</span>,
<a name="l09067"></a>09067          <span class="stringliteral">&quot;Channel: %s\r\n&quot;</span>
<a name="l09068"></a>09068          <span class="stringliteral">&quot;Variable: %s\r\n&quot;</span>
<a name="l09069"></a>09069          <span class="stringliteral">&quot;Value: %s\r\n&quot;</span>
<a name="l09070"></a>09070          <span class="stringliteral">&quot;Uniqueid: %s\r\n&quot;</span>,
<a name="l09071"></a>09071          chan ? chan-&gt;name : <span class="stringliteral">&quot;none&quot;</span>, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, value,
<a name="l09072"></a>09072          chan ? chan-&gt;uniqueid : <span class="stringliteral">&quot;none&quot;</span>);
<a name="l09073"></a>09073    }
<a name="l09074"></a>09074 
<a name="l09075"></a>09075    <span class="keywordflow">if</span> (chan)
<a name="l09076"></a>09076       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l09077"></a>09077    <span class="keywordflow">else</span>
<a name="l09078"></a>09078       <a class="code" href="lock_8h.html#a21ce13cd6c771d5855f47ae7a1dd50b6">ast_rwlock_unlock</a>(&amp;<a class="code" href="pbx_8c.html#a3bbd0f743b066c2670d7301b078f6510">globalslock</a>);
<a name="l09079"></a>09079 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a990bfc8582dc017423d8518bcc110a2c"></a><!-- doxytag: member="pbx.h::pbx_builtin_setvar_multiple" ref="a990bfc8582dc017423d8518bcc110a2c" args="(struct ast_channel *chan, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int pbx_builtin_setvar_multiple </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Parse and set multiple channel variables, where the pairs are separated by the ',' character, and name and value are separated with an '=' character. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>Will lock the channel. </dd></dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09104">9104</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="app_8h_source.html#l00338">AST_APP_ARG</a>, <a class="el" href="app_8h_source.html#l00355">AST_DECLARE_APP_ARGS</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="app_8h_source.html#l00402">AST_NONSTANDARD_APP_ARGS</a>, <a class="el" href="app_8h_source.html#l00387">AST_STANDARD_APP_ARGS</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="channel_8h_source.html#l00503">ast_channel::context</a>, <a class="el" href="channel_8h_source.html#l00504">ast_channel::exten</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="pbx_8c_source.html#l09023">pbx_builtin_setvar_helper()</a>, and <a class="el" href="channel_8h_source.html#l00471">ast_channel::priority</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l09081">pbx_builtin_setvar()</a>, <a class="el" href="app__queue_8c_source.html#l05317">queue_function_var()</a>, <a class="el" href="app__queue_8c_source.html#l00902">set_queue_variables()</a>, and <a class="el" href="app__queue_8c_source.html#l03569">try_calling()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09105"></a>09105 {
<a name="l09106"></a>09106    <span class="keywordtype">char</span> *data;
<a name="l09107"></a>09107    <span class="keywordtype">int</span> x;
<a name="l09108"></a>09108    <a class="code" href="app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2" title="Declare a structure to hold an application&amp;#39;s arguments.">AST_DECLARE_APP_ARGS</a>(args,
<a name="l09109"></a>09109       <a class="code" href="app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5" title="Define an application argument.">AST_APP_ARG</a>(pair)[24];
<a name="l09110"></a>09110    );
<a name="l09111"></a>09111    <a class="code" href="app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2" title="Declare a structure to hold an application&amp;#39;s arguments.">AST_DECLARE_APP_ARGS</a>(pair,
<a name="l09112"></a>09112       <a class="code" href="app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5" title="Define an application argument.">AST_APP_ARG</a>(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l09113"></a>09113       <a class="code" href="app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5" title="Define an application argument.">AST_APP_ARG</a>(value);
<a name="l09114"></a>09114    );
<a name="l09115"></a>09115 
<a name="l09116"></a>09116    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(vdata)) {
<a name="l09117"></a>09117       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;MSet requires at least one variable name/value pair.\n&quot;</span>);
<a name="l09118"></a>09118       <span class="keywordflow">return</span> 0;
<a name="l09119"></a>09119    }
<a name="l09120"></a>09120 
<a name="l09121"></a>09121    data = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(vdata);
<a name="l09122"></a>09122    <a class="code" href="app_8h.html#ac08f7eb1eb9476b30987c73e1052ada8" title="Performs the &amp;#39;standard&amp;#39; argument separation process for an application.">AST_STANDARD_APP_ARGS</a>(args, data);
<a name="l09123"></a>09123 
<a name="l09124"></a>09124    <span class="keywordflow">for</span> (x = 0; x &lt; args.argc; x++) {
<a name="l09125"></a>09125       <a class="code" href="app_8h.html#accfcb380df76a64251d88ef49c2dd4e3" title="Performs the &amp;#39;nonstandard&amp;#39; argument separation process for an application...">AST_NONSTANDARD_APP_ARGS</a>(pair, args.pair[x], <span class="charliteral">&apos;=&apos;</span>);
<a name="l09126"></a>09126       <span class="keywordflow">if</span> (pair.argc == 2) {
<a name="l09127"></a>09127          <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, pair.name, pair.value);
<a name="l09128"></a>09128          <span class="keywordflow">if</span> (strchr(pair.name, <span class="charliteral">&apos; &apos;</span>))
<a name="l09129"></a>09129             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Please avoid unnecessary spaces on variables as it may lead to unexpected results (&apos;%s&apos; set to &apos;%s&apos;).\n&quot;</span>, pair.name, pair.value);
<a name="l09130"></a>09130       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!chan) {
<a name="l09131"></a>09131          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;MSet: ignoring entry &apos;%s&apos; with no &apos;=&apos;\n&quot;</span>, pair.name);
<a name="l09132"></a>09132       } <span class="keywordflow">else</span> {
<a name="l09133"></a>09133          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;MSet: ignoring entry &apos;%s&apos; with no &apos;=&apos; (in %s@%s:%d\n&quot;</span>, pair.name, chan-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>, chan-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, chan-&gt;<a class="code" href="structast__channel.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>);
<a name="l09134"></a>09134       }
<a name="l09135"></a>09135    }
<a name="l09136"></a>09136 
<a name="l09137"></a>09137    <span class="keywordflow">return</span> 0;
<a name="l09138"></a>09138 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac8447d16749d15c783e1dff4d8f8e495"></a><!-- doxytag: member="pbx.h::pbx_checkcondition" ref="ac8447d16749d15c783e1dff4d8f8e495" args="(const char *condition)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int pbx_checkcondition </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>condition</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Evaluate a condition. </p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if the condition is NULL or of zero length </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>int</em>&nbsp;</td><td>If the string is an integer, the integer representation of the integer is returned </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>1</em>&nbsp;</td><td>Any other non-empty string </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l09192">9192</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>.</p>

<p>Referenced by <a class="el" href="app__macro_8c_source.html#l00219">_macro_exec()</a>, <a class="el" href="app__while_8c_source.html#l00189">_while_exec()</a>, <a class="el" href="func__logic_8c_source.html#l00166">acf_if()</a>, <a class="el" href="app__exec_8c_source.html#l00195">execif_exec()</a>, <a class="el" href="app__stack_8c_source.html#l00418">gosubif_exec()</a>, <a class="el" href="app__macro_8c_source.html#l00569">macroif_exec()</a>, and <a class="el" href="pbx_8c_source.html#l09204">pbx_builtin_gotoif()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l09193"></a>09193 {
<a name="l09194"></a>09194    <span class="keywordtype">int</span> res;
<a name="l09195"></a>09195    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(condition)) {                <span class="comment">/* NULL or empty strings are false */</span>
<a name="l09196"></a>09196       <span class="keywordflow">return</span> 0;
<a name="l09197"></a>09197    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sscanf(condition, <span class="stringliteral">&quot;%30d&quot;</span>, &amp;res) == 1) { <span class="comment">/* Numbers are evaluated for truth */</span>
<a name="l09198"></a>09198       <span class="keywordflow">return</span> res;
<a name="l09199"></a>09199    } <span class="keywordflow">else</span> {                                         <span class="comment">/* Strings are true */</span>
<a name="l09200"></a>09200       <span class="keywordflow">return</span> 1;
<a name="l09201"></a>09201    }
<a name="l09202"></a>09202 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="afb87ff7a4504ef6031a45ae4170acaad"></a><!-- doxytag: member="pbx.h::pbx_exec" ref="afb87ff7a4504ef6031a45ae4170acaad" args="(struct ast_channel *c, struct ast_app *app, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int pbx_exec </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__app.html">ast_app</a> *&nbsp;</td>
          <td class="paramname"> <em>app</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Execute an application. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>c</em>&nbsp;</td><td>channel to execute on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>app</em>&nbsp;</td><td>which app to execute </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>the data passed into the app</td></tr>
  </table>
  </dd>
</dl>
<p>This application executes an application on a given channel. It saves the stack and executes the given application passing in the given data.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>failure </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>c</em>&nbsp;</td><td>Channel </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>app</em>&nbsp;</td><td>Application </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>Data for execution </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l01322">1322</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="loader_8c_source.html#l00195">__ast_module_user_add()</a>, <a class="el" href="loader_8c_source.html#l00216">__ast_module_user_remove()</a>, <a class="el" href="channel_8h_source.html#l00411">ast_channel::appl</a>, <a class="el" href="cdr_8c_source.html#l00778">ast_cdr_setapp()</a>, <a class="el" href="channel_8c_source.html#l00461">ast_check_hangup()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="options_8h_source.html#l00115">ast_opt_dont_warn</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="channel_8h_source.html#l00422">ast_channel::cdr</a>, <a class="el" href="channel_8h_source.html#l00412">ast_channel::data</a>, <a class="el" href="structast__app.html#aaa273c19af19ad4f2f0cd376bd1b5f8f">ast_app::execute</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="pbx_8c_source.html#l00867">ast_app::module</a>, <a class="el" href="pbx_8c_source.html#l00868">ast_app::name</a>, and <a class="el" href="strings_8h_source.html#l00072">S_OR</a>.</p>

<p>Referenced by <a class="el" href="dial_8c_source.html#l00140">answer_exec_run()</a>, <a class="el" href="features_8c_source.html#l02441">ast_bridge_call()</a>, <a class="el" href="pbx_8c_source.html#l08091">ast_pbx_run_app()</a>, <a class="el" href="pbx_8c_source.html#l07853">async_wait()</a>, <a class="el" href="features_8c_source.html#l01105">builtin_automixmonitor()</a>, <a class="el" href="features_8c_source.html#l01012">builtin_automonitor()</a>, <a class="el" href="app__meetme_8c_source.html#l01998">conf_run()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="chan__sip_8c_source.html#l19601">do_magic_pickup()</a>, <a class="el" href="pbx__dundi_8c_source.html#l04566">dundi_exec()</a>, <a class="el" href="app__exec_8c_source.html#l00132">exec_exec()</a>, <a class="el" href="app__exec_8c_source.html#l00195">execif_exec()</a>, <a class="el" href="features_8c_source.html#l01903">feature_exec_app()</a>, <a class="el" href="app__voicemail_8c_source.html#l06582">forward_message()</a>, <a class="el" href="res__agi_8c_source.html#l01718">handle_exec()</a>, <a class="el" href="app__stack_8c_source.html#l00550">handle_gosub()</a>, <a class="el" href="chan__iax2_8c_source.html#l13273">iax2_exec()</a>, <a class="el" href="pbx__lua_8c_source.html#l00165">lua_pbx_exec()</a>, <a class="el" href="app__page_8c_source.html#l00121">page_exec()</a>, <a class="el" href="pbx_8c_source.html#l08659">pbx_builtin_execiftime()</a>, <a class="el" href="pbx_8c_source.html#l03647">pbx_extension_helper()</a>, <a class="el" href="pbx__realtime_8c_source.html#l00186">realtime_exec()</a>, <a class="el" href="app__queue_8c_source.html#l03569">try_calling()</a>, and <a class="el" href="app__exec_8c_source.html#l00163">tryexec_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01325"></a>01325 {
<a name="l01326"></a>01326    <span class="keywordtype">int</span> res;
<a name="l01327"></a>01327    <span class="keyword">struct </span><a class="code" href="structast__module__user.html">ast_module_user</a> *u = NULL;
<a name="l01328"></a>01328    <span class="keyword">const</span> <span class="keywordtype">char</span> *saved_c_appl;
<a name="l01329"></a>01329    <span class="keyword">const</span> <span class="keywordtype">char</span> *saved_c_data;
<a name="l01330"></a>01330 
<a name="l01331"></a>01331    <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a> &amp;&amp; !<a class="code" href="channel_8h.html#a9c63fff1d736568d1ee332dd7ea502bd" title="Check to see if a channel is needing hang up.">ast_check_hangup</a>(c))
<a name="l01332"></a>01332       <a class="code" href="cdr_8h.html#a877162d212a320e7daec6aa7f695e9a8" title="Set the last executed application.">ast_cdr_setapp</a>(c-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>, app-&gt;<a class="code" href="structast__app.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>, data);
<a name="l01333"></a>01333 
<a name="l01334"></a>01334    <span class="comment">/* save channel values */</span>
<a name="l01335"></a>01335    saved_c_appl= c-&gt;<a class="code" href="structast__channel.html#a1fe656155481623fac9882b1f79bc5a3">appl</a>;
<a name="l01336"></a>01336    saved_c_data= c-&gt;<a class="code" href="structast__channel.html#a8f64897c7ccc5c13f276d1d07c4e7095">data</a>;
<a name="l01337"></a>01337 
<a name="l01338"></a>01338    c-&gt;<a class="code" href="structast__channel.html#a1fe656155481623fac9882b1f79bc5a3">appl</a> = app-&gt;<a class="code" href="structast__app.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>;
<a name="l01339"></a>01339    c-&gt;<a class="code" href="structast__channel.html#a8f64897c7ccc5c13f276d1d07c4e7095">data</a> = data;
<a name="l01340"></a>01340    <span class="keywordflow">if</span> (app-&gt;<a class="code" href="structast__app.html#a8637433cfbb88aeb10ce2ed5dcba0eb1">module</a>)
<a name="l01341"></a>01341       u = <a class="code" href="module_8h.html#ad315d50d0a7d61cb9feac19223fff8c0">__ast_module_user_add</a>(app-&gt;<a class="code" href="structast__app.html#a8637433cfbb88aeb10ce2ed5dcba0eb1">module</a>, c);
<a name="l01342"></a>01342    <span class="keywordflow">if</span> (strcasecmp(app-&gt;<a class="code" href="structast__app.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>, <span class="stringliteral">&quot;system&quot;</span>) &amp;&amp; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(data) &amp;&amp;
<a name="l01343"></a>01343          strchr(data, <span class="charliteral">&apos;|&apos;</span>) &amp;&amp; !strchr(data, <span class="charliteral">&apos;,&apos;</span>) &amp;&amp; !<a class="code" href="options_8h.html#a5240f07b6ff8003ff47b856d44ef7226">ast_opt_dont_warn</a>) {
<a name="l01344"></a>01344       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;The application delimiter is now the comma, not &quot;</span>
<a name="l01345"></a>01345          <span class="stringliteral">&quot;the pipe.  Did you forget to convert your dialplan?  (%s(%s))\n&quot;</span>,
<a name="l01346"></a>01346          app-&gt;<a class="code" href="structast__app.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>, (<span class="keywordtype">char</span> *) data);
<a name="l01347"></a>01347    }
<a name="l01348"></a>01348    res = app-&gt;<a class="code" href="structast__app.html#aaa273c19af19ad4f2f0cd376bd1b5f8f">execute</a>(c, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>((<span class="keywordtype">char</span> *) data, <span class="stringliteral">&quot;&quot;</span>));
<a name="l01349"></a>01349    <span class="keywordflow">if</span> (app-&gt;<a class="code" href="structast__app.html#a8637433cfbb88aeb10ce2ed5dcba0eb1">module</a> &amp;&amp; u)
<a name="l01350"></a>01350       <a class="code" href="module_8h.html#aee5ac94e279928d1d1f7b6aafb62ec7a">__ast_module_user_remove</a>(app-&gt;<a class="code" href="structast__app.html#a8637433cfbb88aeb10ce2ed5dcba0eb1">module</a>, u);
<a name="l01351"></a>01351    <span class="comment">/* restore channel values */</span>
<a name="l01352"></a>01352    c-&gt;<a class="code" href="structast__channel.html#a1fe656155481623fac9882b1f79bc5a3">appl</a> = saved_c_appl;
<a name="l01353"></a>01353    c-&gt;<a class="code" href="structast__channel.html#a8f64897c7ccc5c13f276d1d07c4e7095">data</a> = saved_c_data;
<a name="l01354"></a>01354    <span class="keywordflow">return</span> res;
<a name="l01355"></a>01355 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a63e03245dc48558e55da8890b3dbb87e"></a><!-- doxytag: member="pbx.h::pbx_find_extension" ref="a63e03245dc48558e55da8890b3dbb87e" args="(struct ast_channel *chan, struct ast_context *bypass, struct pbx_find_info *q, const char *context, const char *exten, int priority, const char *label, const char *callerid, enum ext_match_t action)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__exten.html">ast_exten</a>* pbx_find_extension </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__context.html">ast_context</a> *&nbsp;</td>
          <td class="paramname"> <em>bypass</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structpbx__find__info.html">pbx_find_info</a> *&nbsp;</td>
          <td class="paramname"> <em>q</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>exten</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>priority</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>label</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>callerid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26be">ext_match_t</a>&nbsp;</td>
          <td class="paramname"> <em>action</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8c_source.html#l02469">2469</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="structast__context.html#a1a88e64f1d400d544879fb192cb155e7">ast_context::alts</a>, <a class="el" href="autoservice_8c_source.html#l00192">ast_autoservice_start()</a>, <a class="el" href="autoservice_8c_source.html#l00251">ast_autoservice_stop()</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="hashtab_8c_source.html#l00530">ast_hashtab_lookup()</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="extconf_8h_source.html#l00223">AST_PBX_MAX_STACK</a>, <a class="el" href="strings_8h_source.html#l00488">ast_str_buffer()</a>, <a class="el" href="strings_8h_source.html#l00477">ast_str_size()</a>, <a class="el" href="strings_8h_source.html#l00637">ast_str_thread_get()</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="pbx_8c_source.html#l09490">ast_walk_context_extensions()</a>, <a class="el" href="pbx_8c_source.html#l09485">ast_walk_contexts()</a>, <a class="el" href="pbx_8c_source.html#l09508">ast_walk_extension_priorities()</a>, <a class="el" href="pbx_8h_source.html#l00110">ast_switch::canmatch</a>, <a class="el" href="pbx_8c_source.html#l00835">scoreboard::canmatch_exten</a>, <a class="el" href="pbx_8c_source.html#l01120">contexts_table</a>, <a class="el" href="pbx_8c_source.html#l02000">create_match_char_tree()</a>, <a class="el" href="pbx_8c_source.html#l00803">ast_sw::data</a>, <a class="el" href="extconf_8h_source.html#l00237">pbx_find_info::data</a>, <a class="el" href="extconf_8h_source.html#l00217">E_CANMATCH</a>, <a class="el" href="extconf_8h_source.html#l00221">E_FINDLABEL</a>, <a class="el" href="extconf_8h_source.html#l00216">E_MATCHMORE</a>, <a class="el" href="pbx_8c_source.html#l00804">ast_sw::eval</a>, <a class="el" href="pbx_8h_source.html#l00109">ast_switch::exists</a>, <a class="el" href="pbx_8c_source.html#l00770">ast_exten::exten</a>, <a class="el" href="pbx_8c_source.html#l00836">scoreboard::exten</a>, <a class="el" href="pbx_8c_source.html#l01070">extenpatternmatchnew</a>, <a class="el" href="pbx_8c_source.html#l02389">extension_match_core()</a>, <a class="el" href="extconf_8h_source.html#l00238">pbx_find_info::foundcontext</a>, <a class="el" href="pbx_8c_source.html#l01391">include_valid()</a>, <a class="el" href="pbx_8c_source.html#l00846">ast_context::includes</a>, <a class="el" href="extconf_8h_source.html#l00233">pbx_find_info::incstack</a>, <a class="el" href="pbx_8c_source.html#l00774">ast_exten::label</a>, <a class="el" href="pbx_8c_source.html#l00832">scoreboard::last_char</a>, <a class="el" href="logger_8h_source.html#l00119">LOG_DEBUG</a>, <a class="el" href="pbx_8c_source.html#l01494">log_match_char_tree()</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="chan__iax2_8c_source.html#l01834">match()</a>, <a class="el" href="pbx_8c_source.html#l02457">matchcid()</a>, <a class="el" href="pbx_8h_source.html#l00112">ast_switch::matchmore</a>, <a class="el" href="pbx_8c_source.html#l00801">ast_sw::name</a>, <a class="el" href="pbx_8c_source.html#l00852">ast_context::name</a>, <a class="el" href="pbx_8c_source.html#l02427">fake_context::name</a>, <a class="el" href="pbx_8c_source.html#l01629">new_find_extension()</a>, <a class="el" href="pbx_8c_source.html#l00795">ast_include::next</a>, <a class="el" href="pbx_8c_source.html#l00834">scoreboard::node</a>, <a class="el" href="pbx_8c_source.html#l01071">overrideswitch</a>, <a class="el" href="pbx_8c_source.html#l00844">ast_context::pattern_tree</a>, <a class="el" href="pbx_8c_source.html#l02469">pbx_find_extension()</a>, <a class="el" href="pbx_8c_source.html#l01377">pbx_findswitch()</a>, <a class="el" href="pbx_8c_source.html#l03598">pbx_substitute_variables_helper()</a>, <a class="el" href="pbx_8c_source.html#l00773">ast_exten::priority</a>, <a class="el" href="pbx_8c_source.html#l00791">ast_include::rname</a>, <a class="el" href="pbx_8c_source.html#l00843">ast_context::root_table</a>, <a class="el" href="extconf_8h_source.html#l00234">pbx_find_info::stacklen</a>, <a class="el" href="extconf_8h_source.html#l00235">pbx_find_info::status</a>, <a class="el" href="extconf_8h_source.html#l00241">STATUS_NO_CONTEXT</a>, <a class="el" href="extconf_8h_source.html#l00242">STATUS_NO_EXTENSION</a>, <a class="el" href="extconf_8h_source.html#l00244">STATUS_NO_LABEL</a>, <a class="el" href="extconf_8h_source.html#l00243">STATUS_NO_PRIORITY</a>, <a class="el" href="extconf_8h_source.html#l00245">STATUS_SUCCESS</a>, <a class="el" href="agi_2strcompat_8c_source.html#l00027">strsep()</a>, <a class="el" href="pbx_8c_source.html#l00760">switch_data</a>, <a class="el" href="extconf_8h_source.html#l00236">pbx_find_info::swo</a>, <a class="el" href="pbx_8c_source.html#l00831">scoreboard::total_length</a>, <a class="el" href="pbx_8c_source.html#l00830">scoreboard::total_specificity</a>, and <a class="el" href="pbx_8c_source.html#l01571">trie_find_next_match()</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l03755">ast_hint_extension_nolock()</a>, <a class="el" href="pbx_8c_source.html#l06623">ast_merge_contexts_and_delete()</a>, <a class="el" href="pval_8c_source.html#l01224">check_goto()</a>, <a class="el" href="pval_8c_source.html#l02353">check_pval_item()</a>, <a class="el" href="pbx_8c_source.html#l03647">pbx_extension_helper()</a>, <a class="el" href="pbx_8c_source.html#l02469">pbx_find_extension()</a>, and <a class="el" href="chan__sip_8c_source.html#l04586">register_peer_exten()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02473"></a>02473 {
<a name="l02474"></a>02474    <span class="keywordtype">int</span> x, res;
<a name="l02475"></a>02475    <span class="keyword">struct </span><a class="code" href="structast__context.html" title="ast_context: An extension context">ast_context</a> *tmp = NULL;
<a name="l02476"></a>02476    <span class="keyword">struct </span><a class="code" href="structast__exten.html" title="ast_exten: An extension The dialplan is saved as a linked list with each context...">ast_exten</a> *e = NULL, *eroot = NULL;
<a name="l02477"></a>02477    <span class="keyword">struct </span><a class="code" href="structast__include.html" title="ast_include: include= support in extensions.conf">ast_include</a> *i = NULL;
<a name="l02478"></a>02478    <span class="keyword">struct </span><a class="code" href="structast__sw.html" title="ast_sw: Switch statement in extensions.conf">ast_sw</a> *sw = NULL;
<a name="l02479"></a>02479    <span class="keyword">struct </span><a class="code" href="structast__exten.html" title="ast_exten: An extension The dialplan is saved as a linked list with each context...">ast_exten</a> pattern = {NULL, };
<a name="l02480"></a>02480    <span class="keyword">struct </span><a class="code" href="structscoreboard.html">scoreboard</a> score = {0, };
<a name="l02481"></a>02481    <span class="keyword">struct </span><a class="code" href="structast__str.html" title="The descriptor of a dynamic string XXX storage will be optimized later if needed...">ast_str</a> *tmpdata = NULL;
<a name="l02482"></a>02482 
<a name="l02483"></a>02483    pattern.<a class="code" href="structast__exten.html#ab5fbdb5052858ca8d2538566229fbe64">label</a> = label;
<a name="l02484"></a>02484    pattern.<a class="code" href="structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> = priority;
<a name="l02485"></a>02485 <span class="preprocessor">#ifdef NEED_DEBUG_HERE</span>
<a name="l02486"></a>02486 <span class="preprocessor"></span>   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Looking for cont/ext/prio/label/action = %s/%s/%d/%s/%d\n&quot;</span>, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, priority, label, (<span class="keywordtype">int</span>) action);
<a name="l02487"></a>02487 <span class="preprocessor">#endif</span>
<a name="l02488"></a>02488 <span class="preprocessor"></span>
<a name="l02489"></a>02489    <span class="comment">/* Initialize status if appropriate */</span>
<a name="l02490"></a>02490    <span class="keywordflow">if</span> (q-&gt;<a class="code" href="structpbx__find__info.html#a31dd453024f17e9e35717368cf8c87fb">stacklen</a> == 0) {
<a name="l02491"></a>02491       q-&gt;<a class="code" href="structpbx__find__info.html#a6e27f49150e9a14580fb313cc2777e00">status</a> = <a class="code" href="extconf_8h.html#aa2d7a93c24186594d8c09e904fa17132">STATUS_NO_CONTEXT</a>;
<a name="l02492"></a>02492       q-&gt;<a class="code" href="structpbx__find__info.html#a3215a7f1fa2be1b8f6872b5b388b55a8">swo</a> = NULL;
<a name="l02493"></a>02493       q-&gt;<a class="code" href="structpbx__find__info.html#ae4950db1dbfff8459a712737063b61aa">data</a> = NULL;
<a name="l02494"></a>02494       q-&gt;<a class="code" href="structpbx__find__info.html#a71796127253dfc9a1830ede1904c653b">foundcontext</a> = NULL;
<a name="l02495"></a>02495    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (q-&gt;<a class="code" href="structpbx__find__info.html#a31dd453024f17e9e35717368cf8c87fb">stacklen</a> &gt;= <a class="code" href="extconf_8h.html#a05848c0de74d85dc2fb259f332d33f25">AST_PBX_MAX_STACK</a>) {
<a name="l02496"></a>02496       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Maximum PBX stack exceeded\n&quot;</span>);
<a name="l02497"></a>02497       <span class="keywordflow">return</span> NULL;
<a name="l02498"></a>02498    }
<a name="l02499"></a>02499 
<a name="l02500"></a>02500    <span class="comment">/* Check first to see if we&apos;ve already been checked */</span>
<a name="l02501"></a>02501    <span class="keywordflow">for</span> (x = 0; x &lt; q-&gt;<a class="code" href="structpbx__find__info.html#a31dd453024f17e9e35717368cf8c87fb">stacklen</a>; x++) {
<a name="l02502"></a>02502       <span class="keywordflow">if</span> (!strcasecmp(q-&gt;<a class="code" href="structpbx__find__info.html#a5316dcae577cc913943c7a2b6e00c6da">incstack</a>[x], <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>))
<a name="l02503"></a>02503          <span class="keywordflow">return</span> NULL;
<a name="l02504"></a>02504    }
<a name="l02505"></a>02505 
<a name="l02506"></a>02506    <span class="keywordflow">if</span> (bypass) { <span class="comment">/* bypass means we only look there */</span>
<a name="l02507"></a>02507       tmp = bypass;
<a name="l02508"></a>02508    } <span class="keywordflow">else</span> {      <span class="comment">/* look in contexts */</span>
<a name="l02509"></a>02509       <span class="keyword">struct </span><a class="code" href="structfake__context.html">fake_context</a> item;
<a name="l02510"></a>02510 
<a name="l02511"></a>02511       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(item.name, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <span class="keyword">sizeof</span>(item.name));
<a name="l02512"></a>02512 
<a name="l02513"></a>02513       tmp = <a class="code" href="hashtab_8h.html#a78b1f7bc201afd020f6270378173bb79" title="Lookup this object in the hash table.">ast_hashtab_lookup</a>(<a class="code" href="pbx_8c.html#a4571322b2dc5414f61e4f3fe7af2331c">contexts_table</a>, &amp;item);
<a name="l02514"></a>02514 <span class="preprocessor">#ifdef NOTNOW</span>
<a name="l02515"></a>02515 <span class="preprocessor"></span>      tmp = NULL;
<a name="l02516"></a>02516       <span class="keywordflow">while</span> ((tmp = <a class="code" href="pbx_8h.html#a4cd5282ca555370652a7304c0c7ea4c4">ast_walk_contexts</a>(tmp)) ) {
<a name="l02517"></a>02517          <span class="keywordflow">if</span> (!strcmp(tmp-&gt;<a class="code" href="structast__context.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>)) {
<a name="l02518"></a>02518             <span class="keywordflow">break</span>;
<a name="l02519"></a>02519          }
<a name="l02520"></a>02520       }
<a name="l02521"></a>02521 <span class="preprocessor">#endif</span>
<a name="l02522"></a>02522 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (!tmp) {
<a name="l02523"></a>02523          <span class="keywordflow">return</span> NULL;
<a name="l02524"></a>02524       }
<a name="l02525"></a>02525    }
<a name="l02526"></a>02526 
<a name="l02527"></a>02527    <span class="keywordflow">if</span> (q-&gt;<a class="code" href="structpbx__find__info.html#a6e27f49150e9a14580fb313cc2777e00">status</a> &lt; <a class="code" href="extconf_8h.html#a53e8d9faad7e0156772e9559df5f8c2e">STATUS_NO_EXTENSION</a>)
<a name="l02528"></a>02528       q-&gt;<a class="code" href="structpbx__find__info.html#a6e27f49150e9a14580fb313cc2777e00">status</a> = <a class="code" href="extconf_8h.html#a53e8d9faad7e0156772e9559df5f8c2e">STATUS_NO_EXTENSION</a>;
<a name="l02529"></a>02529 
<a name="l02530"></a>02530    <span class="comment">/* Do a search for matching extension */</span>
<a name="l02531"></a>02531 
<a name="l02532"></a>02532    eroot = NULL;
<a name="l02533"></a>02533    score.<a class="code" href="structscoreboard.html#a4de425bb2743e2e19c2e954dfe1f0bf8">total_specificity</a> = 0;
<a name="l02534"></a>02534    score.<a class="code" href="structscoreboard.html#afc8cfd0aed370c037cd78797da3313e7">exten</a> = 0;
<a name="l02535"></a>02535    score.<a class="code" href="structscoreboard.html#a411afdaaca990dd80881e20637dc44af">total_length</a> = 0;
<a name="l02536"></a>02536    <span class="keywordflow">if</span> (!tmp-&gt;<a class="code" href="structast__context.html#a2fa7eba1ccec8820c766879753569da0">pattern_tree</a> &amp;&amp; tmp-&gt;<a class="code" href="structast__context.html#ab89d9c8c0b08ae6e239f17da8f25a7b3">root_table</a>) {
<a name="l02537"></a>02537       <a class="code" href="pbx_8c.html#a705ac1563ea8e4c1e3f369e6ad952fda">create_match_char_tree</a>(tmp);
<a name="l02538"></a>02538 <span class="preprocessor">#ifdef NEED_DEBUG</span>
<a name="l02539"></a>02539 <span class="preprocessor"></span>      <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;Tree Created in context %s:\n&quot;</span>, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>);
<a name="l02540"></a>02540       <a class="code" href="pbx_8c.html#a45d3d0857a56e9ec039a20350bbb7d7f">log_match_char_tree</a>(tmp-&gt;<a class="code" href="structast__context.html#a2fa7eba1ccec8820c766879753569da0">pattern_tree</a>,<span class="stringliteral">&quot; &quot;</span>);
<a name="l02541"></a>02541 <span class="preprocessor">#endif</span>
<a name="l02542"></a>02542 <span class="preprocessor"></span>   }
<a name="l02543"></a>02543 <span class="preprocessor">#ifdef NEED_DEBUG</span>
<a name="l02544"></a>02544 <span class="preprocessor"></span>   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;The Trie we are searching in:\n&quot;</span>);
<a name="l02545"></a>02545    <a class="code" href="pbx_8c.html#a45d3d0857a56e9ec039a20350bbb7d7f">log_match_char_tree</a>(tmp-&gt;<a class="code" href="structast__context.html#a2fa7eba1ccec8820c766879753569da0">pattern_tree</a>, <span class="stringliteral">&quot;::  &quot;</span>);
<a name="l02546"></a>02546 <span class="preprocessor">#endif</span>
<a name="l02547"></a>02547 <span class="preprocessor"></span>
<a name="l02548"></a>02548    <span class="keywordflow">do</span> {
<a name="l02549"></a>02549       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="pbx_8c.html#a8f600ca9999b2d9c3d64cbcdb503895c">overrideswitch</a>)) {
<a name="l02550"></a>02550          <span class="keywordtype">char</span> *osw = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(<a class="code" href="pbx_8c.html#a8f600ca9999b2d9c3d64cbcdb503895c">overrideswitch</a>), *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>;
<a name="l02551"></a>02551          <span class="keyword">struct </span><a class="code" href="structast__switch.html">ast_switch</a> *asw;
<a name="l02552"></a>02552          <a class="code" href="pbx_8h.html#a93ee7200f8a12fa56224b85d2483693d" title="All switch functions have the same interface, so define a type for them.">ast_switch_f</a> *aswf = NULL;
<a name="l02553"></a>02553          <span class="keywordtype">char</span> *datap;
<a name="l02554"></a>02554          <span class="keywordtype">int</span> eval = 0;
<a name="l02555"></a>02555 
<a name="l02556"></a>02556          <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a> = <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;osw, <span class="stringliteral">&quot;/&quot;</span>);
<a name="l02557"></a>02557          asw = <a class="code" href="pbx_8c.html#a7b44c1c9eafe43b4400fd90794078cef">pbx_findswitch</a>(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l02558"></a>02558 
<a name="l02559"></a>02559          <span class="keywordflow">if</span> (!asw) {
<a name="l02560"></a>02560             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No such switch &apos;%s&apos;\n&quot;</span>, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l02561"></a>02561             <span class="keywordflow">break</span>;
<a name="l02562"></a>02562          }
<a name="l02563"></a>02563 
<a name="l02564"></a>02564          <span class="keywordflow">if</span> (osw &amp;&amp; strchr(osw, <span class="charliteral">&apos;$&apos;</span>)) {
<a name="l02565"></a>02565             eval = 1;
<a name="l02566"></a>02566          }
<a name="l02567"></a>02567 
<a name="l02568"></a>02568          <span class="keywordflow">if</span> (eval &amp;&amp; !(tmpdata = <a class="code" href="strings_8h.html#affe8ca3cf8ee9ab07fe29d11bc824ac4" title="Retrieve a thread locally stored dynamic string.">ast_str_thread_get</a>(&amp;<a class="code" href="pbx_8c.html#a34c5d02998c18d892113d659590cd28e">switch_data</a>, 512))) {
<a name="l02569"></a>02569             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Can&apos;t evaluate overrideswitch?!&quot;</span>);
<a name="l02570"></a>02570             <span class="keywordflow">break</span>;
<a name="l02571"></a>02571          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (eval) {
<a name="l02572"></a>02572             <span class="comment">/* Substitute variables now */</span>
<a name="l02573"></a>02573             <a class="code" href="pbx_8h.html#a3eac2009888ce9c4a108e882d02cb04d">pbx_substitute_variables_helper</a>(chan, osw, <a class="code" href="strings_8h.html#a053bdfc229997a75f112bdd7b995e00b" title="Returns the string buffer within the ast_str buf.">ast_str_buffer</a>(tmpdata), <a class="code" href="strings_8h.html#ab9726d03e7f9f4746876d71bea28de33" title="Returns the current maximum length (without reallocation) of the current buffer.">ast_str_size</a>(tmpdata));
<a name="l02574"></a>02574             datap = <a class="code" href="strings_8h.html#a053bdfc229997a75f112bdd7b995e00b" title="Returns the string buffer within the ast_str buf.">ast_str_buffer</a>(tmpdata);
<a name="l02575"></a>02575          } <span class="keywordflow">else</span> {
<a name="l02576"></a>02576             datap = osw;
<a name="l02577"></a>02577          }
<a name="l02578"></a>02578 
<a name="l02579"></a>02579          <span class="comment">/* equivalent of extension_match_core() at the switch level */</span>
<a name="l02580"></a>02580          <span class="keywordflow">if</span> (action == <a class="code" href="extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea413c09377a892aa154e7669cbdaf27ba">E_CANMATCH</a>)
<a name="l02581"></a>02581             aswf = asw-&gt;<a class="code" href="structast__switch.html#a0d48d66b2172f7ea362a20ae01640053">canmatch</a>;
<a name="l02582"></a>02582          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (action == <a class="code" href="extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7e20dcb277877b81e8099470cd631277">E_MATCHMORE</a>)
<a name="l02583"></a>02583             aswf = asw-&gt;<a class="code" href="structast__switch.html#a89b178ebf5ac0c92ab2ac79ae939f27e">matchmore</a>;
<a name="l02584"></a>02584          <span class="keywordflow">else</span> <span class="comment">/* action == E_MATCH */</span>
<a name="l02585"></a>02585             aswf = asw-&gt;<a class="code" href="structast__switch.html#ad4ed18d92b082c9ce55f73a5b7979068">exists</a>;
<a name="l02586"></a>02586          <span class="keywordflow">if</span> (!aswf) {
<a name="l02587"></a>02587             res = 0;
<a name="l02588"></a>02588          } <span class="keywordflow">else</span> {
<a name="l02589"></a>02589             <span class="keywordflow">if</span> (chan) {
<a name="l02590"></a>02590                <a class="code" href="channel_8h.html#a7a8f6a50f3db42cb40cad7cfbd1d54f9" title="Automatically service a channel for us...">ast_autoservice_start</a>(chan);
<a name="l02591"></a>02591             }
<a name="l02592"></a>02592             res = aswf(chan, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, priority, callerid, datap);
<a name="l02593"></a>02593             <span class="keywordflow">if</span> (chan) {
<a name="l02594"></a>02594                <a class="code" href="channel_8h.html#a08bde7d8cf72457fc8c519a4443b413b" title="Stop servicing a channel for us...">ast_autoservice_stop</a>(chan);
<a name="l02595"></a>02595             }
<a name="l02596"></a>02596          }
<a name="l02597"></a>02597          <span class="keywordflow">if</span> (res) {  <span class="comment">/* Got a match */</span>
<a name="l02598"></a>02598             q-&gt;<a class="code" href="structpbx__find__info.html#a3215a7f1fa2be1b8f6872b5b388b55a8">swo</a> = asw;
<a name="l02599"></a>02599             q-&gt;<a class="code" href="structpbx__find__info.html#ae4950db1dbfff8459a712737063b61aa">data</a> = datap;
<a name="l02600"></a>02600             q-&gt;<a class="code" href="structpbx__find__info.html#a71796127253dfc9a1830ede1904c653b">foundcontext</a> = <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>;
<a name="l02601"></a>02601             <span class="comment">/* XXX keep status = STATUS_NO_CONTEXT ? */</span>
<a name="l02602"></a>02602             <span class="keywordflow">return</span> NULL;
<a name="l02603"></a>02603          }
<a name="l02604"></a>02604       }
<a name="l02605"></a>02605    } <span class="keywordflow">while</span> (0);
<a name="l02606"></a>02606 
<a name="l02607"></a>02607    <span class="keywordflow">if</span> (<a class="code" href="pbx_8c.html#a3a7600857afccfa4f7a5c55dcaec8407">extenpatternmatchnew</a>) {
<a name="l02608"></a>02608       <a class="code" href="pbx_8c.html#a2c64874adba109557bade6a7cbfd1eea">new_find_extension</a>(<a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, &amp;score, tmp-&gt;<a class="code" href="structast__context.html#a2fa7eba1ccec8820c766879753569da0">pattern_tree</a>, 0, 0, callerid, label, action);
<a name="l02609"></a>02609       eroot = score.<a class="code" href="structscoreboard.html#afc8cfd0aed370c037cd78797da3313e7">exten</a>;
<a name="l02610"></a>02610 
<a name="l02611"></a>02611       <span class="keywordflow">if</span> (score.<a class="code" href="structscoreboard.html#a58353d0395200b159f144de279d0a9b2">last_char</a> == <span class="charliteral">&apos;!&apos;</span> &amp;&amp; action == <a class="code" href="extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7e20dcb277877b81e8099470cd631277">E_MATCHMORE</a>) {
<a name="l02612"></a>02612          <span class="comment">/* We match an extension ending in &apos;!&apos;.</span>
<a name="l02613"></a>02613 <span class="comment">          * The decision in this case is final and is NULL (no match).</span>
<a name="l02614"></a>02614 <span class="comment">          */</span>
<a name="l02615"></a>02615 <span class="preprocessor">#ifdef NEED_DEBUG_HERE</span>
<a name="l02616"></a>02616 <span class="preprocessor"></span>         <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;Returning MATCHMORE NULL with exclamation point.\n&quot;</span>);
<a name="l02617"></a>02617 <span class="preprocessor">#endif</span>
<a name="l02618"></a>02618 <span class="preprocessor"></span>         <span class="keywordflow">return</span> NULL;
<a name="l02619"></a>02619       }
<a name="l02620"></a>02620 
<a name="l02621"></a>02621       <span class="keywordflow">if</span> (!eroot &amp;&amp; (action == <a class="code" href="extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea413c09377a892aa154e7669cbdaf27ba">E_CANMATCH</a> || action == <a class="code" href="extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7e20dcb277877b81e8099470cd631277">E_MATCHMORE</a>) &amp;&amp; score.<a class="code" href="structscoreboard.html#afd6db51221fa39c96b9469fa115db1cb">canmatch_exten</a>) {
<a name="l02622"></a>02622          q-&gt;<a class="code" href="structpbx__find__info.html#a6e27f49150e9a14580fb313cc2777e00">status</a> = <a class="code" href="extconf_8h.html#ae56fdb340b23940f7a64ed2e37c1774a">STATUS_SUCCESS</a>;
<a name="l02623"></a>02623 <span class="preprocessor">#ifdef NEED_DEBUG_HERE</span>
<a name="l02624"></a>02624 <span class="preprocessor"></span>         <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;Returning CANMATCH exten %s\n&quot;</span>, score.<a class="code" href="structscoreboard.html#afd6db51221fa39c96b9469fa115db1cb">canmatch_exten</a>-&gt;<a class="code" href="structast__exten.html#a9c2cb8c1611452928af0def998e36335">exten</a>);
<a name="l02625"></a>02625 <span class="preprocessor">#endif</span>
<a name="l02626"></a>02626 <span class="preprocessor"></span>         <span class="keywordflow">return</span> score.<a class="code" href="structscoreboard.html#afd6db51221fa39c96b9469fa115db1cb">canmatch_exten</a>;
<a name="l02627"></a>02627       }
<a name="l02628"></a>02628 
<a name="l02629"></a>02629       <span class="keywordflow">if</span> ((action == <a class="code" href="extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7e20dcb277877b81e8099470cd631277">E_MATCHMORE</a> || action == <a class="code" href="extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea413c09377a892aa154e7669cbdaf27ba">E_CANMATCH</a>)  &amp;&amp; eroot) {
<a name="l02630"></a>02630          <span class="keywordflow">if</span> (score.<a class="code" href="structscoreboard.html#ae6f7c8319cca7a79bdab95ecfa8b57eb">node</a>) {
<a name="l02631"></a>02631             <span class="keyword">struct </span><a class="code" href="structast__exten.html" title="ast_exten: An extension The dialplan is saved as a linked list with each context...">ast_exten</a> *z = <a class="code" href="pbx_8c.html#ae41a2e0750d89ec626fd85b4f24d1e5d">trie_find_next_match</a>(score.<a class="code" href="structscoreboard.html#ae6f7c8319cca7a79bdab95ecfa8b57eb">node</a>);
<a name="l02632"></a>02632             <span class="keywordflow">if</span> (z) {
<a name="l02633"></a>02633 <span class="preprocessor">#ifdef NEED_DEBUG_HERE</span>
<a name="l02634"></a>02634 <span class="preprocessor"></span>               <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;Returning CANMATCH/MATCHMORE next_match exten %s\n&quot;</span>, z-&gt;<a class="code" href="structast__exten.html#a9c2cb8c1611452928af0def998e36335">exten</a>);
<a name="l02635"></a>02635 <span class="preprocessor">#endif</span>
<a name="l02636"></a>02636 <span class="preprocessor"></span>            } <span class="keywordflow">else</span> {
<a name="l02637"></a>02637                <span class="keywordflow">if</span> (score.<a class="code" href="structscoreboard.html#afd6db51221fa39c96b9469fa115db1cb">canmatch_exten</a>) {
<a name="l02638"></a>02638 <span class="preprocessor">#ifdef NEED_DEBUG_HERE</span>
<a name="l02639"></a>02639 <span class="preprocessor"></span>                  <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;Returning CANMATCH/MATCHMORE canmatchmatch exten %s(%p)\n&quot;</span>, score.<a class="code" href="structscoreboard.html#afd6db51221fa39c96b9469fa115db1cb">canmatch_exten</a>-&gt;<a class="code" href="structast__exten.html#a9c2cb8c1611452928af0def998e36335">exten</a>, score.<a class="code" href="structscoreboard.html#afd6db51221fa39c96b9469fa115db1cb">canmatch_exten</a>);
<a name="l02640"></a>02640 <span class="preprocessor">#endif</span>
<a name="l02641"></a>02641 <span class="preprocessor"></span>                  <span class="keywordflow">return</span> score.<a class="code" href="structscoreboard.html#afd6db51221fa39c96b9469fa115db1cb">canmatch_exten</a>;
<a name="l02642"></a>02642                } <span class="keywordflow">else</span> {
<a name="l02643"></a>02643 <span class="preprocessor">#ifdef NEED_DEBUG_HERE</span>
<a name="l02644"></a>02644 <span class="preprocessor"></span>                  <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;Returning CANMATCH/MATCHMORE next_match exten NULL\n&quot;</span>);
<a name="l02645"></a>02645 <span class="preprocessor">#endif</span>
<a name="l02646"></a>02646 <span class="preprocessor"></span>               }
<a name="l02647"></a>02647             }
<a name="l02648"></a>02648             <span class="keywordflow">return</span> z;
<a name="l02649"></a>02649          }
<a name="l02650"></a>02650 <span class="preprocessor">#ifdef NEED_DEBUG_HERE</span>
<a name="l02651"></a>02651 <span class="preprocessor"></span>         <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Returning CANMATCH/MATCHMORE NULL (no next_match)\n&quot;</span>);
<a name="l02652"></a>02652 <span class="preprocessor">#endif</span>
<a name="l02653"></a>02653 <span class="preprocessor"></span>         <span class="keywordflow">return</span> NULL;  <span class="comment">/* according to the code, complete matches are null matches in MATCHMORE mode */</span>
<a name="l02654"></a>02654       }
<a name="l02655"></a>02655 
<a name="l02656"></a>02656       <span class="keywordflow">if</span> (eroot) {
<a name="l02657"></a>02657          <span class="comment">/* found entry, now look for the right priority */</span>
<a name="l02658"></a>02658          <span class="keywordflow">if</span> (q-&gt;<a class="code" href="structpbx__find__info.html#a6e27f49150e9a14580fb313cc2777e00">status</a> &lt; <a class="code" href="extconf_8h.html#ab6422b4f1e9de4cb16307bd081b8706b">STATUS_NO_PRIORITY</a>)
<a name="l02659"></a>02659             q-&gt;<a class="code" href="structpbx__find__info.html#a6e27f49150e9a14580fb313cc2777e00">status</a> = <a class="code" href="extconf_8h.html#ab6422b4f1e9de4cb16307bd081b8706b">STATUS_NO_PRIORITY</a>;
<a name="l02660"></a>02660          e = NULL;
<a name="l02661"></a>02661          <span class="keywordflow">if</span> (action == <a class="code" href="extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7b10ab7b3dd6af9d933dbb03dd183eb5">E_FINDLABEL</a> &amp;&amp; <a class="code" href="structast__exten.html#ab5fbdb5052858ca8d2538566229fbe64">label</a> ) {
<a name="l02662"></a>02662             <span class="keywordflow">if</span> (q-&gt;<a class="code" href="structpbx__find__info.html#a6e27f49150e9a14580fb313cc2777e00">status</a> &lt; <a class="code" href="extconf_8h.html#a5062f2413e9425755149f855577b602f">STATUS_NO_LABEL</a>)
<a name="l02663"></a>02663                q-&gt;<a class="code" href="structpbx__find__info.html#a6e27f49150e9a14580fb313cc2777e00">status</a> = <a class="code" href="extconf_8h.html#a5062f2413e9425755149f855577b602f">STATUS_NO_LABEL</a>;
<a name="l02664"></a>02664             e = <a class="code" href="hashtab_8h.html#a78b1f7bc201afd020f6270378173bb79" title="Lookup this object in the hash table.">ast_hashtab_lookup</a>(eroot-&gt;peer_label_table, &amp;pattern);
<a name="l02665"></a>02665          } <span class="keywordflow">else</span> {
<a name="l02666"></a>02666             e = <a class="code" href="hashtab_8h.html#a78b1f7bc201afd020f6270378173bb79" title="Lookup this object in the hash table.">ast_hashtab_lookup</a>(eroot-&gt;peer_table, &amp;pattern);
<a name="l02667"></a>02667          }
<a name="l02668"></a>02668          <span class="keywordflow">if</span> (e) { <span class="comment">/* found a valid match */</span>
<a name="l02669"></a>02669             q-&gt;<a class="code" href="structpbx__find__info.html#a6e27f49150e9a14580fb313cc2777e00">status</a> = <a class="code" href="extconf_8h.html#ae56fdb340b23940f7a64ed2e37c1774a">STATUS_SUCCESS</a>;
<a name="l02670"></a>02670             q-&gt;<a class="code" href="structpbx__find__info.html#a71796127253dfc9a1830ede1904c653b">foundcontext</a> = <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>;
<a name="l02671"></a>02671 <span class="preprocessor">#ifdef NEED_DEBUG_HERE</span>
<a name="l02672"></a>02672 <span class="preprocessor"></span>            <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;Returning complete match of exten %s\n&quot;</span>, e-&gt;<a class="code" href="structast__exten.html#a9c2cb8c1611452928af0def998e36335">exten</a>);
<a name="l02673"></a>02673 <span class="preprocessor">#endif</span>
<a name="l02674"></a>02674 <span class="preprocessor"></span>            <span class="keywordflow">return</span> e;
<a name="l02675"></a>02675          }
<a name="l02676"></a>02676       }
<a name="l02677"></a>02677    } <span class="keywordflow">else</span> {   <span class="comment">/* the old/current default exten pattern match algorithm */</span>
<a name="l02678"></a>02678 
<a name="l02679"></a>02679       <span class="comment">/* scan the list trying to match extension and CID */</span>
<a name="l02680"></a>02680       eroot = NULL;
<a name="l02681"></a>02681       <span class="keywordflow">while</span> ( (eroot = <a class="code" href="pbx_8h.html#aa63685577f3479dcf31a9e77b2ff05a7">ast_walk_context_extensions</a>(tmp, eroot)) ) {
<a name="l02682"></a>02682          <span class="keywordtype">int</span> <a class="code" href="chan__iax2_8c.html#aa27930d6214f6421994d6bef51efb7aa">match</a> = <a class="code" href="pbx_8c.html#aef34845bd9203c43797706dc4edc05d7">extension_match_core</a>(eroot-&gt;exten, <a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, action);
<a name="l02683"></a>02683          <span class="comment">/* 0 on fail, 1 on match, 2 on earlymatch */</span>
<a name="l02684"></a>02684 
<a name="l02685"></a>02685          <span class="keywordflow">if</span> (!match || (eroot-&gt;matchcid &amp;&amp; !<a class="code" href="pbx_8c.html#aa387123ad981d4889f47275234042a2e">matchcid</a>(eroot-&gt;cidmatch, callerid)))
<a name="l02686"></a>02686             <span class="keywordflow">continue</span>;   <span class="comment">/* keep trying */</span>
<a name="l02687"></a>02687          <span class="keywordflow">if</span> (match == 2 &amp;&amp; action == <a class="code" href="extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7e20dcb277877b81e8099470cd631277">E_MATCHMORE</a>) {
<a name="l02688"></a>02688             <span class="comment">/* We match an extension ending in &apos;!&apos;.</span>
<a name="l02689"></a>02689 <span class="comment">             * The decision in this case is final and is NULL (no match).</span>
<a name="l02690"></a>02690 <span class="comment">             */</span>
<a name="l02691"></a>02691             <span class="keywordflow">return</span> NULL;
<a name="l02692"></a>02692          }
<a name="l02693"></a>02693          <span class="comment">/* found entry, now look for the right priority */</span>
<a name="l02694"></a>02694          <span class="keywordflow">if</span> (q-&gt;<a class="code" href="structpbx__find__info.html#a6e27f49150e9a14580fb313cc2777e00">status</a> &lt; <a class="code" href="extconf_8h.html#ab6422b4f1e9de4cb16307bd081b8706b">STATUS_NO_PRIORITY</a>)
<a name="l02695"></a>02695             q-&gt;<a class="code" href="structpbx__find__info.html#a6e27f49150e9a14580fb313cc2777e00">status</a> = <a class="code" href="extconf_8h.html#ab6422b4f1e9de4cb16307bd081b8706b">STATUS_NO_PRIORITY</a>;
<a name="l02696"></a>02696          e = NULL;
<a name="l02697"></a>02697          <span class="keywordflow">if</span> (action == <a class="code" href="extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7b10ab7b3dd6af9d933dbb03dd183eb5">E_FINDLABEL</a> &amp;&amp; <a class="code" href="structast__exten.html#ab5fbdb5052858ca8d2538566229fbe64">label</a> ) {
<a name="l02698"></a>02698             <span class="keywordflow">if</span> (q-&gt;<a class="code" href="structpbx__find__info.html#a6e27f49150e9a14580fb313cc2777e00">status</a> &lt; <a class="code" href="extconf_8h.html#a5062f2413e9425755149f855577b602f">STATUS_NO_LABEL</a>)
<a name="l02699"></a>02699                q-&gt;<a class="code" href="structpbx__find__info.html#a6e27f49150e9a14580fb313cc2777e00">status</a> = <a class="code" href="extconf_8h.html#a5062f2413e9425755149f855577b602f">STATUS_NO_LABEL</a>;
<a name="l02700"></a>02700             e = <a class="code" href="hashtab_8h.html#a78b1f7bc201afd020f6270378173bb79" title="Lookup this object in the hash table.">ast_hashtab_lookup</a>(eroot-&gt;peer_label_table, &amp;pattern);
<a name="l02701"></a>02701          } <span class="keywordflow">else</span> {
<a name="l02702"></a>02702             e = <a class="code" href="hashtab_8h.html#a78b1f7bc201afd020f6270378173bb79" title="Lookup this object in the hash table.">ast_hashtab_lookup</a>(eroot-&gt;peer_table, &amp;pattern);
<a name="l02703"></a>02703          }
<a name="l02704"></a>02704 <span class="preprocessor">#ifdef NOTNOW</span>
<a name="l02705"></a>02705 <span class="preprocessor"></span>         <span class="keywordflow">while</span> ( (e = <a class="code" href="pbx_8h.html#a6772ce6e8de86d4b6c382dbf68ea4755">ast_walk_extension_priorities</a>(eroot, e)) ) {
<a name="l02706"></a>02706             <span class="comment">/* Match label or priority */</span>
<a name="l02707"></a>02707             <span class="keywordflow">if</span> (action == <a class="code" href="extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7b10ab7b3dd6af9d933dbb03dd183eb5">E_FINDLABEL</a>) {
<a name="l02708"></a>02708                <span class="keywordflow">if</span> (q-&gt;<a class="code" href="structpbx__find__info.html#a6e27f49150e9a14580fb313cc2777e00">status</a> &lt; <a class="code" href="extconf_8h.html#a5062f2413e9425755149f855577b602f">STATUS_NO_LABEL</a>)
<a name="l02709"></a>02709                   q-&gt;<a class="code" href="structpbx__find__info.html#a6e27f49150e9a14580fb313cc2777e00">status</a> = <a class="code" href="extconf_8h.html#a5062f2413e9425755149f855577b602f">STATUS_NO_LABEL</a>;
<a name="l02710"></a>02710                <span class="keywordflow">if</span> (<a class="code" href="structast__exten.html#ab5fbdb5052858ca8d2538566229fbe64">label</a> &amp;&amp; e-&gt;<a class="code" href="structast__exten.html#ab5fbdb5052858ca8d2538566229fbe64">label</a> &amp;&amp; !strcmp(<a class="code" href="structast__exten.html#ab5fbdb5052858ca8d2538566229fbe64">label</a>, e-&gt;<a class="code" href="structast__exten.html#ab5fbdb5052858ca8d2538566229fbe64">label</a>))
<a name="l02711"></a>02711                   <span class="keywordflow">break</span>;   <span class="comment">/* found it */</span>
<a name="l02712"></a>02712             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (e-&gt;<a class="code" href="structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> == <a class="code" href="structast__exten.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>) {
<a name="l02713"></a>02713                <span class="keywordflow">break</span>;   <span class="comment">/* found it */</span>
<a name="l02714"></a>02714             } <span class="comment">/* else keep searching */</span>
<a name="l02715"></a>02715          }
<a name="l02716"></a>02716 <span class="preprocessor">#endif</span>
<a name="l02717"></a>02717 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (e) { <span class="comment">/* found a valid match */</span>
<a name="l02718"></a>02718             q-&gt;<a class="code" href="structpbx__find__info.html#a6e27f49150e9a14580fb313cc2777e00">status</a> = <a class="code" href="extconf_8h.html#ae56fdb340b23940f7a64ed2e37c1774a">STATUS_SUCCESS</a>;
<a name="l02719"></a>02719             q-&gt;<a class="code" href="structpbx__find__info.html#a71796127253dfc9a1830ede1904c653b">foundcontext</a> = <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>;
<a name="l02720"></a>02720             <span class="keywordflow">return</span> e;
<a name="l02721"></a>02721          }
<a name="l02722"></a>02722       }
<a name="l02723"></a>02723    }
<a name="l02724"></a>02724 
<a name="l02725"></a>02725    <span class="comment">/* Check alternative switches */</span>
<a name="l02726"></a>02726    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;tmp-&gt;<a class="code" href="structast__context.html#a1a88e64f1d400d544879fb192cb155e7">alts</a>, sw, list) {
<a name="l02727"></a>02727       <span class="keyword">struct </span><a class="code" href="structast__switch.html">ast_switch</a> *asw = <a class="code" href="pbx_8c.html#a7b44c1c9eafe43b4400fd90794078cef">pbx_findswitch</a>(sw-&gt;<a class="code" href="structast__sw.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l02728"></a>02728       <a class="code" href="pbx_8h.html#a93ee7200f8a12fa56224b85d2483693d" title="All switch functions have the same interface, so define a type for them.">ast_switch_f</a> *aswf = NULL;
<a name="l02729"></a>02729       <span class="keywordtype">char</span> *datap;
<a name="l02730"></a>02730 
<a name="l02731"></a>02731       <span class="keywordflow">if</span> (!asw) {
<a name="l02732"></a>02732          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No such switch &apos;%s&apos;\n&quot;</span>, sw-&gt;<a class="code" href="structast__sw.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l02733"></a>02733          <span class="keywordflow">continue</span>;
<a name="l02734"></a>02734       }
<a name="l02735"></a>02735 
<a name="l02736"></a>02736       <span class="comment">/* Substitute variables now */</span>
<a name="l02737"></a>02737       <span class="keywordflow">if</span> (sw-&gt;<a class="code" href="structast__sw.html#a4e3f077fec8b035a2678e7740f366dea">eval</a>) {
<a name="l02738"></a>02738          <span class="keywordflow">if</span> (!(tmpdata = <a class="code" href="strings_8h.html#affe8ca3cf8ee9ab07fe29d11bc824ac4" title="Retrieve a thread locally stored dynamic string.">ast_str_thread_get</a>(&amp;<a class="code" href="pbx_8c.html#a34c5d02998c18d892113d659590cd28e">switch_data</a>, 512))) {
<a name="l02739"></a>02739             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Can&apos;t evaluate switch?!&quot;</span>);
<a name="l02740"></a>02740             <span class="keywordflow">continue</span>;
<a name="l02741"></a>02741          }
<a name="l02742"></a>02742          <a class="code" href="pbx_8h.html#a3eac2009888ce9c4a108e882d02cb04d">pbx_substitute_variables_helper</a>(chan, sw-&gt;<a class="code" href="structast__sw.html#a91a70b77df95bd8b0830b49a094c2acb">data</a>, <a class="code" href="strings_8h.html#a053bdfc229997a75f112bdd7b995e00b" title="Returns the string buffer within the ast_str buf.">ast_str_buffer</a>(tmpdata), <a class="code" href="strings_8h.html#ab9726d03e7f9f4746876d71bea28de33" title="Returns the current maximum length (without reallocation) of the current buffer.">ast_str_size</a>(tmpdata));
<a name="l02743"></a>02743       }
<a name="l02744"></a>02744 
<a name="l02745"></a>02745       <span class="comment">/* equivalent of extension_match_core() at the switch level */</span>
<a name="l02746"></a>02746       <span class="keywordflow">if</span> (action == <a class="code" href="extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea413c09377a892aa154e7669cbdaf27ba">E_CANMATCH</a>)
<a name="l02747"></a>02747          aswf = asw-&gt;<a class="code" href="structast__switch.html#a0d48d66b2172f7ea362a20ae01640053">canmatch</a>;
<a name="l02748"></a>02748       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (action == <a class="code" href="extconf_8h.html#a2b7f0fafc6995b2630658a4fd8df26bea7e20dcb277877b81e8099470cd631277">E_MATCHMORE</a>)
<a name="l02749"></a>02749          aswf = asw-&gt;<a class="code" href="structast__switch.html#a89b178ebf5ac0c92ab2ac79ae939f27e">matchmore</a>;
<a name="l02750"></a>02750       <span class="keywordflow">else</span> <span class="comment">/* action == E_MATCH */</span>
<a name="l02751"></a>02751          aswf = asw-&gt;<a class="code" href="structast__switch.html#ad4ed18d92b082c9ce55f73a5b7979068">exists</a>;
<a name="l02752"></a>02752       datap = sw-&gt;<a class="code" href="structast__sw.html#a4e3f077fec8b035a2678e7740f366dea">eval</a> ? <a class="code" href="strings_8h.html#a053bdfc229997a75f112bdd7b995e00b" title="Returns the string buffer within the ast_str buf.">ast_str_buffer</a>(tmpdata) : sw-&gt;data;
<a name="l02753"></a>02753       <span class="keywordflow">if</span> (!aswf)
<a name="l02754"></a>02754          res = 0;
<a name="l02755"></a>02755       <span class="keywordflow">else</span> {
<a name="l02756"></a>02756          <span class="keywordflow">if</span> (chan)
<a name="l02757"></a>02757             <a class="code" href="channel_8h.html#a7a8f6a50f3db42cb40cad7cfbd1d54f9" title="Automatically service a channel for us...">ast_autoservice_start</a>(chan);
<a name="l02758"></a>02758          res = aswf(chan, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, <a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, priority, callerid, datap);
<a name="l02759"></a>02759          <span class="keywordflow">if</span> (chan)
<a name="l02760"></a>02760             <a class="code" href="channel_8h.html#a08bde7d8cf72457fc8c519a4443b413b" title="Stop servicing a channel for us...">ast_autoservice_stop</a>(chan);
<a name="l02761"></a>02761       }
<a name="l02762"></a>02762       <span class="keywordflow">if</span> (res) {  <span class="comment">/* Got a match */</span>
<a name="l02763"></a>02763          q-&gt;<a class="code" href="structpbx__find__info.html#a3215a7f1fa2be1b8f6872b5b388b55a8">swo</a> = asw;
<a name="l02764"></a>02764          q-&gt;<a class="code" href="structpbx__find__info.html#ae4950db1dbfff8459a712737063b61aa">data</a> = datap;
<a name="l02765"></a>02765          q-&gt;<a class="code" href="structpbx__find__info.html#a71796127253dfc9a1830ede1904c653b">foundcontext</a> = <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>;
<a name="l02766"></a>02766          <span class="comment">/* XXX keep status = STATUS_NO_CONTEXT ? */</span>
<a name="l02767"></a>02767          <span class="keywordflow">return</span> NULL;
<a name="l02768"></a>02768       }
<a name="l02769"></a>02769    }
<a name="l02770"></a>02770    q-&gt;<a class="code" href="structpbx__find__info.html#a5316dcae577cc913943c7a2b6e00c6da">incstack</a>[q-&gt;<a class="code" href="structpbx__find__info.html#a31dd453024f17e9e35717368cf8c87fb">stacklen</a>++] = tmp-&gt;<a class="code" href="structast__context.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>;   <span class="comment">/* Setup the stack */</span>
<a name="l02771"></a>02771    <span class="comment">/* Now try any includes we have in this context */</span>
<a name="l02772"></a>02772    <span class="keywordflow">for</span> (i = tmp-&gt;<a class="code" href="structast__context.html#abaa8691efe3e8fe26f5930720bfd8edb">includes</a>; i; i = i-&gt;<a class="code" href="structast__include.html#ad21fd2a65c1cfe0ed6a0aa46f40c2083">next</a>) {
<a name="l02773"></a>02773       <span class="keywordflow">if</span> (<a class="code" href="pbx_8c.html#a6a57ed16bf75bd443baa0c8a7ad74a1a">include_valid</a>(i)) {
<a name="l02774"></a>02774          <span class="keywordflow">if</span> ((e = <a class="code" href="pbx_8h.html#a63e03245dc48558e55da8890b3dbb87e">pbx_find_extension</a>(chan, bypass, q, i-&gt;<a class="code" href="structast__include.html#a0fc4d731325a10cc181d26c7e5549b40">rname</a>, <a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>, priority, label, callerid, action))) {
<a name="l02775"></a>02775 <span class="preprocessor">#ifdef NEED_DEBUG_HERE</span>
<a name="l02776"></a>02776 <span class="preprocessor"></span>            <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>,<span class="stringliteral">&quot;Returning recursive match of %s\n&quot;</span>, e-&gt;<a class="code" href="structast__exten.html#a9c2cb8c1611452928af0def998e36335">exten</a>);
<a name="l02777"></a>02777 <span class="preprocessor">#endif</span>
<a name="l02778"></a>02778 <span class="preprocessor"></span>            <span class="keywordflow">return</span> e;
<a name="l02779"></a>02779          }
<a name="l02780"></a>02780          <span class="keywordflow">if</span> (q-&gt;<a class="code" href="structpbx__find__info.html#a3215a7f1fa2be1b8f6872b5b388b55a8">swo</a>)
<a name="l02781"></a>02781             <span class="keywordflow">return</span> NULL;
<a name="l02782"></a>02782       }
<a name="l02783"></a>02783    }
<a name="l02784"></a>02784    <span class="keywordflow">return</span> NULL;
<a name="l02785"></a>02785 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0db9808b647984133225652170b22b79"></a><!-- doxytag: member="pbx.h::pbx_findapp" ref="a0db9808b647984133225652170b22b79" args="(const char *app)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__app.html">ast_app</a>* pbx_findapp </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>app</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Look up an application. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>app</em>&nbsp;</td><td>name of the app</td></tr>
  </table>
  </dd>
</dl>
<p>This function searches for the <a class="el" href="structast__app.html" title="ast_app: A registered application">ast_app</a> structure within the <a class="el" href="structapps.html">apps</a> that are registered for the one with the name you passed in.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>the <a class="el" href="structast__app.html" title="ast_app: A registered application">ast_app</a> structure that matches on success, or NULL on failure </dd></dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l01363">1363</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00077">AST_RWLIST_RDLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00493">AST_RWLIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, and <a class="el" href="pbx_8c_source.html#l00868">ast_app::name</a>.</p>

<p>Referenced by <a class="el" href="dial_8c_source.html#l00140">answer_exec_run()</a>, <a class="el" href="features_8c_source.html#l02441">ast_bridge_call()</a>, <a class="el" href="pbx_8c_source.html#l08091">ast_pbx_run_app()</a>, <a class="el" href="pbx_8c_source.html#l07853">async_wait()</a>, <a class="el" href="features_8c_source.html#l01105">builtin_automixmonitor()</a>, <a class="el" href="features_8c_source.html#l01012">builtin_automonitor()</a>, <a class="el" href="app__meetme_8c_source.html#l01998">conf_run()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="chan__sip_8c_source.html#l19601">do_magic_pickup()</a>, <a class="el" href="pbx__dundi_8c_source.html#l04566">dundi_exec()</a>, <a class="el" href="app__exec_8c_source.html#l00132">exec_exec()</a>, <a class="el" href="app__exec_8c_source.html#l00195">execif_exec()</a>, <a class="el" href="features_8c_source.html#l01903">feature_exec_app()</a>, <a class="el" href="app__voicemail_8c_source.html#l06582">forward_message()</a>, <a class="el" href="res__agi_8c_source.html#l01718">handle_exec()</a>, <a class="el" href="app__stack_8c_source.html#l00550">handle_gosub()</a>, <a class="el" href="chan__iax2_8c_source.html#l13273">iax2_exec()</a>, <a class="el" href="pbx__lua_8c_source.html#l00165">lua_pbx_exec()</a>, <a class="el" href="app__page_8c_source.html#l00121">page_exec()</a>, <a class="el" href="pbx_8c_source.html#l08659">pbx_builtin_execiftime()</a>, <a class="el" href="pbx_8c_source.html#l03647">pbx_extension_helper()</a>, <a class="el" href="pbx__realtime_8c_source.html#l00186">realtime_exec()</a>, <a class="el" href="app__queue_8c_source.html#l03569">try_calling()</a>, and <a class="el" href="app__exec_8c_source.html#l00163">tryexec_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01364"></a>01364 {
<a name="l01365"></a>01365    <span class="keyword">struct </span><a class="code" href="structast__app.html" title="ast_app: A registered application">ast_app</a> *tmp;
<a name="l01366"></a>01366 
<a name="l01367"></a>01367    <a class="code" href="linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc" title="Read locks a list.">AST_RWLIST_RDLOCK</a>(&amp;<a class="code" href="structapps.html">apps</a>);
<a name="l01368"></a>01368    <a class="code" href="linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;<a class="code" href="structapps.html">apps</a>, tmp, <a class="code" href="structast__app.html#a6f572a784cf87cd7e7efa625534f9d4e">list</a>) {
<a name="l01369"></a>01369       <span class="keywordflow">if</span> (!strcasecmp(tmp-&gt;<a class="code" href="structast__app.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>, <a class="code" href="adsistub_8c.html#ad194d73de26c0d836555e029d245493d">app</a>))
<a name="l01370"></a>01370          <span class="keywordflow">break</span>;
<a name="l01371"></a>01371    }
<a name="l01372"></a>01372    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structapps.html">apps</a>);
<a name="l01373"></a>01373 
<a name="l01374"></a>01374    <span class="keywordflow">return</span> tmp;
<a name="l01375"></a>01375 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aaf906a18ba2dcd53c35f59869757521f"></a><!-- doxytag: member="pbx.h::pbx_retrieve_variable" ref="aaf906a18ba2dcd53c35f59869757521f" args="(struct ast_channel *c, const char *var, char **ret, char *workspace, int workspacelen, struct varshead *headp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pbx_retrieve_variable </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>var</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&nbsp;</td>
          <td class="paramname"> <em>ret</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>workspace</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>workspacelen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct varshead *&nbsp;</td>
          <td class="paramname"> <em>headp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Retrieve the value of a builtin variable or variable from the channel variable stack. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>Will lock the channel.</dd></dl>
<p>Retrieve the value of a builtin variable or variable from the channel variable stack.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>See also<ul>
<li><a class="el" href="AstVar.html">Globally predefined channel variables</a> Channel variables</li>
<li><a class="el" href="AstCauses.html">Hangup Causes for Asterisk</a> The HANGUPCAUSE variable </li>
</ul>
</dd></dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l02867">2867</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="asterisk_8c_source.html#l00265">ast_config_AST_SYSTEM_NAME</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="asterisk_8c_source.html#l00185">ast_eid_default</a>, <a class="el" href="netsock_8c_source.html#l00218">ast_eid_to_str()</a>, <a class="el" href="pbx_8c_source.html#l04126">ast_get_hint()</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="lock_8h_source.html#l01796">ast_rwlock_rdlock()</a>, <a class="el" href="lock_8h_source.html#l01791">ast_rwlock_unlock()</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="chanvars_8c_source.html#l00065">ast_var_name()</a>, <a class="el" href="chanvars_8c_source.html#l00085">ast_var_value()</a>, <a class="el" href="channel_8h_source.html#l00444">ast_channel::cid</a>, <a class="el" href="channel_8h_source.html#l00208">ast_callerid::cid_ani2</a>, <a class="el" href="channel_8h_source.html#l00207">ast_callerid::cid_pres</a>, <a class="el" href="channel_8h_source.html#l00210">ast_callerid::cid_tns</a>, <a class="el" href="channel_8h_source.html#l00209">ast_callerid::cid_ton</a>, <a class="el" href="channel_8h_source.html#l00503">ast_channel::context</a>, <a class="el" href="channel_8h_source.html#l00504">ast_channel::exten</a>, <a class="el" href="pbx_8c_source.html#l01067">globals</a>, <a class="el" href="pbx_8c_source.html#l01066">globalslock</a>, <a class="el" href="channel_8h_source.html#l00479">ast_channel::hangupcause</a>, <a class="el" href="pbx_8c_source.html#l02792">parse_variable_name()</a>, <a class="el" href="channel_8h_source.html#l00471">ast_channel::priority</a>, <a class="el" href="aesopt_8h_source.html#l00399">s</a>, <a class="el" href="pbx_8c_source.html#l02825">substring()</a>, and <a class="el" href="channel_8h_source.html#l00446">ast_channel::varshead</a>.</p>

<p>Referenced by <a class="el" href="manager_8c_source.html#l01847">action_getvar()</a>, <a class="el" href="manager_8c_source.html#l01904">action_status()</a>, <a class="el" href="res__agi_8c_source.html#l01818">handle_getvariable()</a>, <a class="el" href="pbx__lua_8c_source.html#l00515">lua_get_variable()</a>, <a class="el" href="pbx__lua_8c_source.html#l00260">lua_get_variable_value()</a>, and <a class="el" href="pbx_8c_source.html#l03403">pbx_substitute_variables_helper_full()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02868"></a>02868 {
<a name="l02869"></a>02869    <span class="keyword">const</span> <span class="keywordtype">char</span> not_found = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l02870"></a>02870    <span class="keywordtype">char</span> *tmpvar;
<a name="l02871"></a>02871    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>; <span class="comment">/* the result */</span>
<a name="l02872"></a>02872    <span class="keywordtype">int</span> offset, length;
<a name="l02873"></a>02873    <span class="keywordtype">int</span> i, need_substring;
<a name="l02874"></a>02874    <span class="keyword">struct </span>varshead *places[2] = { headp, &amp;<a class="code" href="pbx_8c.html#aec3689c71194f8504dafc644005a97db">globals</a> };  <span class="comment">/* list of places where we may look */</span>
<a name="l02875"></a>02875 
<a name="l02876"></a>02876    <span class="keywordflow">if</span> (c) {
<a name="l02877"></a>02877       <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(c);
<a name="l02878"></a>02878       places[0] = &amp;c-&gt;<a class="code" href="structast__channel.html#a9ffb22045a8f14bef8f2137cd779ab25">varshead</a>;
<a name="l02879"></a>02879    }
<a name="l02880"></a>02880    <span class="comment">/*</span>
<a name="l02881"></a>02881 <span class="comment">    * Make a copy of var because parse_variable_name() modifies the string.</span>
<a name="l02882"></a>02882 <span class="comment">    * Then if called directly, we might need to run substring() on the result;</span>
<a name="l02883"></a>02883 <span class="comment">    * remember this for later in &apos;need_substring&apos;, &apos;offset&apos; and &apos;length&apos;</span>
<a name="l02884"></a>02884 <span class="comment">    */</span>
<a name="l02885"></a>02885    tmpvar = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>); <span class="comment">/* parse_variable_name modifies the string */</span>
<a name="l02886"></a>02886    need_substring = <a class="code" href="pbx_8c.html#ac280b071ffa8f9e016cc011d77c41a86" title="extract offset:length from variable name.">parse_variable_name</a>(tmpvar, &amp;offset, &amp;length, &amp;i <span class="comment">/* ignored */</span>);
<a name="l02887"></a>02887 
<a name="l02888"></a>02888    <span class="comment">/*</span>
<a name="l02889"></a>02889 <span class="comment">    * Look first into predefined variables, then into variable lists.</span>
<a name="l02890"></a>02890 <span class="comment">    * Variable &apos;s&apos; points to the result, according to the following rules:</span>
<a name="l02891"></a>02891 <span class="comment">    * s == &amp;not_found (set at the beginning) means that we did not find a</span>
<a name="l02892"></a>02892 <span class="comment">    * matching variable and need to look into more places.</span>
<a name="l02893"></a>02893 <span class="comment">    * If s != &amp;not_found, s is a valid result string as follows:</span>
<a name="l02894"></a>02894 <span class="comment">    * s = NULL if the variable does not have a value;</span>
<a name="l02895"></a>02895 <span class="comment">    * you typically do this when looking for an unset predefined variable.</span>
<a name="l02896"></a>02896 <span class="comment">    * s = workspace if the result has been assembled there;</span>
<a name="l02897"></a>02897 <span class="comment">    * typically done when the result is built e.g. with an snprintf(),</span>
<a name="l02898"></a>02898 <span class="comment">    * so we don&apos;t need to do an additional copy.</span>
<a name="l02899"></a>02899 <span class="comment">    * s != workspace in case we have a string, that needs to be copied</span>
<a name="l02900"></a>02900 <span class="comment">    * (the ast_copy_string is done once for all at the end).</span>
<a name="l02901"></a>02901 <span class="comment">    * Typically done when the result is already available in some string.</span>
<a name="l02902"></a>02902 <span class="comment">    */</span>
<a name="l02903"></a>02903    s = &amp;not_found;   <span class="comment">/* default value */</span>
<a name="l02904"></a>02904    <span class="keywordflow">if</span> (c) { <span class="comment">/* This group requires a valid channel */</span>
<a name="l02905"></a>02905       <span class="comment">/* Names with common parts are looked up a piece at a time using strncmp. */</span>
<a name="l02906"></a>02906       <span class="keywordflow">if</span> (!strncmp(<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>, <span class="stringliteral">&quot;CALL&quot;</span>, 4)) {
<a name="l02907"></a>02907          <span class="keywordflow">if</span> (!strncmp(<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a> + 4, <span class="stringliteral">&quot;ING&quot;</span>, 3)) {
<a name="l02908"></a>02908             <span class="keywordflow">if</span> (!strcmp(<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a> + 7, <span class="stringliteral">&quot;PRES&quot;</span>)) {        <span class="comment">/* CALLINGPRES */</span>
<a name="l02909"></a>02909                snprintf(workspace, workspacelen, <span class="stringliteral">&quot;%d&quot;</span>, c-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a5674af3fa5ce1dd1fe052be1477d4110">cid_pres</a>);
<a name="l02910"></a>02910                s = workspace;
<a name="l02911"></a>02911             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a> + 7, <span class="stringliteral">&quot;ANI2&quot;</span>)) {    <span class="comment">/* CALLINGANI2 */</span>
<a name="l02912"></a>02912                snprintf(workspace, workspacelen, <span class="stringliteral">&quot;%d&quot;</span>, c-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a9540aaac76be952860ef25d607eb33fb">cid_ani2</a>);
<a name="l02913"></a>02913                s = workspace;
<a name="l02914"></a>02914             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a> + 7, <span class="stringliteral">&quot;TON&quot;</span>)) {     <span class="comment">/* CALLINGTON */</span>
<a name="l02915"></a>02915                snprintf(workspace, workspacelen, <span class="stringliteral">&quot;%d&quot;</span>, c-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#aff456ca48d31a9813584e799064cf88e">cid_ton</a>);
<a name="l02916"></a>02916                s = workspace;
<a name="l02917"></a>02917             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a> + 7, <span class="stringliteral">&quot;TNS&quot;</span>)) {     <span class="comment">/* CALLINGTNS */</span>
<a name="l02918"></a>02918                snprintf(workspace, workspacelen, <span class="stringliteral">&quot;%d&quot;</span>, c-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#aae7e57d784da2bfe6b85cb36516edca0">cid_tns</a>);
<a name="l02919"></a>02919                s = workspace;
<a name="l02920"></a>02920             }
<a name="l02921"></a>02921          }
<a name="l02922"></a>02922       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>, <span class="stringliteral">&quot;HINT&quot;</span>)) {
<a name="l02923"></a>02923          s = <a class="code" href="pbx_8h.html#ac778ac642def88a06e5d59e11a964c43" title="If an extension hint exists, return non-zero.">ast_get_hint</a>(workspace, workspacelen, NULL, 0, c, c-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, c-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>) ? workspace : NULL;
<a name="l02924"></a>02924       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>, <span class="stringliteral">&quot;HINTNAME&quot;</span>)) {
<a name="l02925"></a>02925          s = <a class="code" href="pbx_8h.html#ac778ac642def88a06e5d59e11a964c43" title="If an extension hint exists, return non-zero.">ast_get_hint</a>(NULL, 0, workspace, workspacelen, c, c-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, c-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>) ? workspace : NULL;
<a name="l02926"></a>02926       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>, <span class="stringliteral">&quot;EXTEN&quot;</span>)) {
<a name="l02927"></a>02927          s = c-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>;
<a name="l02928"></a>02928       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>, <span class="stringliteral">&quot;CONTEXT&quot;</span>)) {
<a name="l02929"></a>02929          s = c-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>;
<a name="l02930"></a>02930       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>, <span class="stringliteral">&quot;PRIORITY&quot;</span>)) {
<a name="l02931"></a>02931          snprintf(workspace, workspacelen, <span class="stringliteral">&quot;%d&quot;</span>, c-&gt;<a class="code" href="structast__channel.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>);
<a name="l02932"></a>02932          s = workspace;
<a name="l02933"></a>02933       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>, <span class="stringliteral">&quot;CHANNEL&quot;</span>)) {
<a name="l02934"></a>02934          s = c-&gt;name;
<a name="l02935"></a>02935       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>, <span class="stringliteral">&quot;UNIQUEID&quot;</span>)) {
<a name="l02936"></a>02936          s = c-&gt;uniqueid;
<a name="l02937"></a>02937       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>, <span class="stringliteral">&quot;HANGUPCAUSE&quot;</span>)) {
<a name="l02938"></a>02938          snprintf(workspace, workspacelen, <span class="stringliteral">&quot;%d&quot;</span>, c-&gt;<a class="code" href="structast__channel.html#aa4261b664d6712ba8551bde24ad17382">hangupcause</a>);
<a name="l02939"></a>02939          s = workspace;
<a name="l02940"></a>02940       }
<a name="l02941"></a>02941    }
<a name="l02942"></a>02942    <span class="keywordflow">if</span> (s == &amp;not_found) { <span class="comment">/* look for more */</span>
<a name="l02943"></a>02943       <span class="keywordflow">if</span> (!strcmp(<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>, <span class="stringliteral">&quot;EPOCH&quot;</span>)) {
<a name="l02944"></a>02944          snprintf(workspace, workspacelen, <span class="stringliteral">&quot;%u&quot;</span>,(<span class="keywordtype">int</span>)time(NULL));
<a name="l02945"></a>02945          s = workspace;
<a name="l02946"></a>02946       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>, <span class="stringliteral">&quot;SYSTEMNAME&quot;</span>)) {
<a name="l02947"></a>02947          s = <a class="code" href="paths_8h.html#ab9f9346c7a41bdf3720f7b1ed02ec703">ast_config_AST_SYSTEM_NAME</a>;
<a name="l02948"></a>02948       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>, <span class="stringliteral">&quot;ENTITYID&quot;</span>)) {
<a name="l02949"></a>02949          <a class="code" href="utils_8h.html#a8ebf6841073ea2a063a0c86a5092a85b">ast_eid_to_str</a>(workspace, workspacelen, &amp;<a class="code" href="utils_8h.html#ad5db11fa27352e2b9a3c669adc76955f" title="Global EID.">ast_eid_default</a>);
<a name="l02950"></a>02950          s = workspace;
<a name="l02951"></a>02951       }
<a name="l02952"></a>02952    }
<a name="l02953"></a>02953    <span class="comment">/* if not found, look into chanvars or global vars */</span>
<a name="l02954"></a>02954    <span class="keywordflow">for</span> (i = 0; s == &amp;not_found &amp;&amp; i &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(places); i++) {
<a name="l02955"></a>02955       <span class="keyword">struct </span><a class="code" href="structast__var__t.html">ast_var_t</a> *variables;
<a name="l02956"></a>02956       <span class="keywordflow">if</span> (!places[i])
<a name="l02957"></a>02957          <span class="keywordflow">continue</span>;
<a name="l02958"></a>02958       <span class="keywordflow">if</span> (places[i] == &amp;<a class="code" href="pbx_8c.html#aec3689c71194f8504dafc644005a97db">globals</a>)
<a name="l02959"></a>02959          <a class="code" href="lock_8h.html#ae6703edce409c34119e27bdca1186d10">ast_rwlock_rdlock</a>(&amp;<a class="code" href="pbx_8c.html#a3bbd0f743b066c2670d7301b078f6510">globalslock</a>);
<a name="l02960"></a>02960       <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(places[i], variables, entries) {
<a name="l02961"></a>02961          <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="chanvars_8h.html#a356a31cd608ec07d3668dcd589be49d8">ast_var_name</a>(variables), <a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>)) {
<a name="l02962"></a>02962             s = <a class="code" href="chanvars_8h.html#a8e0081172db71c5021d20706c50d959c">ast_var_value</a>(variables);
<a name="l02963"></a>02963             <span class="keywordflow">break</span>;
<a name="l02964"></a>02964          }
<a name="l02965"></a>02965       }
<a name="l02966"></a>02966       <span class="keywordflow">if</span> (places[i] == &amp;<a class="code" href="pbx_8c.html#aec3689c71194f8504dafc644005a97db">globals</a>)
<a name="l02967"></a>02967          <a class="code" href="lock_8h.html#a21ce13cd6c771d5855f47ae7a1dd50b6">ast_rwlock_unlock</a>(&amp;<a class="code" href="pbx_8c.html#a3bbd0f743b066c2670d7301b078f6510">globalslock</a>);
<a name="l02968"></a>02968    }
<a name="l02969"></a>02969    <span class="keywordflow">if</span> (s == &amp;not_found || s == NULL)
<a name="l02970"></a>02970       *ret = NULL;
<a name="l02971"></a>02971    <span class="keywordflow">else</span> {
<a name="l02972"></a>02972       <span class="keywordflow">if</span> (s != workspace)
<a name="l02973"></a>02973          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(workspace, s, workspacelen);
<a name="l02974"></a>02974       *ret = workspace;
<a name="l02975"></a>02975       <span class="keywordflow">if</span> (need_substring)
<a name="l02976"></a>02976          *ret = <a class="code" href="pbx_8c.html#ac79353a3cba653bbeea7eabd8e4d073c" title="takes a substring. It is ok to call with value == workspace.">substring</a>(*ret, offset, length, workspace, workspacelen);
<a name="l02977"></a>02977    }
<a name="l02978"></a>02978 
<a name="l02979"></a>02979    <span class="keywordflow">if</span> (c)
<a name="l02980"></a>02980       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c);
<a name="l02981"></a>02981 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aeb0407c693573096981db1a00fab4eb8"></a><!-- doxytag: member="pbx.h::pbx_set_autofallthrough" ref="aeb0407c693573096981db1a00fab4eb8" args="(int newval)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int pbx_set_autofallthrough </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>newval</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Set "autofallthrough" flag, if newval is &lt;0, does not actually set. If set to 1, sets to auto fall through. If newval set to 0, sets to no auto fall through (reads <a class="el" href="structextension.html">extension</a> instead). Returns previous value. </p>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l04611">4611</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l01069">autofallthrough</a>.</p>

<p>Referenced by <a class="el" href="pbx__config_8c_source.html#l01714">pbx_load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04612"></a>04612 {
<a name="l04613"></a>04613    <span class="keywordtype">int</span> oldval = <a class="code" href="pbx_8c.html#a5f7ea48b3f8614ef9314e5aece1f1bc3">autofallthrough</a>;
<a name="l04614"></a>04614    <a class="code" href="pbx_8c.html#a5f7ea48b3f8614ef9314e5aece1f1bc3">autofallthrough</a> = newval;
<a name="l04615"></a>04615    <span class="keywordflow">return</span> oldval;
<a name="l04616"></a>04616 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a86a7469073a22661d4db7086245c5b18"></a><!-- doxytag: member="pbx.h::pbx_set_extenpatternmatchnew" ref="a86a7469073a22661d4db7086245c5b18" args="(int newval)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int pbx_set_extenpatternmatchnew </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>newval</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Set "extenpatternmatchnew" flag, if newval is &lt;0, does not actually set. If set to 1, sets to use the new Trie-based pattern matcher. If newval set to 0, sets to use the old linear-search algorithm. Returns previous value. </p>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l04618">4618</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l01070">extenpatternmatchnew</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l06304">handle_set_extenpatternmatchnew()</a>, <a class="el" href="pbx_8c_source.html#l06332">handle_unset_extenpatternmatchnew()</a>, and <a class="el" href="pbx__config_8c_source.html#l01714">pbx_load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04619"></a>04619 {
<a name="l04620"></a>04620    <span class="keywordtype">int</span> oldval = <a class="code" href="pbx_8c.html#a3a7600857afccfa4f7a5c55dcaec8407">extenpatternmatchnew</a>;
<a name="l04621"></a>04621    <a class="code" href="pbx_8c.html#a3a7600857afccfa4f7a5c55dcaec8407">extenpatternmatchnew</a> = newval;
<a name="l04622"></a>04622    <span class="keywordflow">return</span> oldval;
<a name="l04623"></a>04623 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7a46e2644221be6cb7ca7ba2723006cd"></a><!-- doxytag: member="pbx.h::pbx_set_overrideswitch" ref="a7a46e2644221be6cb7ca7ba2723006cd" args="(const char *newval)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pbx_set_overrideswitch </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>newval</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Set "overrideswitch" field. If set and of nonzero length, all contexts will be tried directly through the named switch prior to any other matching within that context. </p>
<dl class="since"><dt><b>Since:</b></dt><dd>1.6.1 </dd></dl>

<p>Definition at line <a class="el" href="pbx_8c_source.html#l04625">4625</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, and <a class="el" href="pbx_8c_source.html#l01071">overrideswitch</a>.</p>

<p>Referenced by <a class="el" href="pbx__config_8c_source.html#l01714">pbx_load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l04626"></a>04626 {
<a name="l04627"></a>04627    <span class="keywordflow">if</span> (<a class="code" href="pbx_8c.html#a8f600ca9999b2d9c3d64cbcdb503895c">overrideswitch</a>) {
<a name="l04628"></a>04628       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(<a class="code" href="pbx_8c.html#a8f600ca9999b2d9c3d64cbcdb503895c">overrideswitch</a>);
<a name="l04629"></a>04629    }
<a name="l04630"></a>04630    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(newval)) {
<a name="l04631"></a>04631       <a class="code" href="pbx_8c.html#a8f600ca9999b2d9c3d64cbcdb503895c">overrideswitch</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(newval);
<a name="l04632"></a>04632    } <span class="keywordflow">else</span> {
<a name="l04633"></a>04633       <a class="code" href="pbx_8c.html#a8f600ca9999b2d9c3d64cbcdb503895c">overrideswitch</a> = NULL;
<a name="l04634"></a>04634    }
<a name="l04635"></a>04635 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3eac2009888ce9c4a108e882d02cb04d"></a><!-- doxytag: member="pbx.h::pbx_substitute_variables_helper" ref="a3eac2009888ce9c4a108e882d02cb04d" args="(struct ast_channel *c, const char *cp1, char *cp2, int count)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pbx_substitute_variables_helper </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>cp1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>cp2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>count</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8c_source.html#l03598">3598</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l03403">pbx_substitute_variables_helper_full()</a>, and <a class="el" href="channel_8h_source.html#l00446">ast_channel::varshead</a>.</p>

<p>Referenced by <a class="el" href="app__macro_8c_source.html#l00219">_macro_exec()</a>, <a class="el" href="func__logic_8c_source.html#l00226">acf_import()</a>, <a class="el" href="pval_8c_source.html#l04207">add_extensions()</a>, <a class="el" href="pbx_8c_source.html#l07637">ast_add_extension2_lockopt()</a>, <a class="el" href="res__config__curl_8c_source.html#l00518">config_curl()</a>, <a class="el" href="cdr__custom_8c_source.html#l00110">custom_log()</a>, <a class="el" href="func__cut_8c_source.html#l00154">cut_internal()</a>, <a class="el" href="res__config__curl_8c_source.html#l00419">destroy_curl()</a>, <a class="el" href="app__exec_8c_source.html#l00132">exec_exec()</a>, <a class="el" href="func__strings_8c_source.html#l00914">function_eval()</a>, <a class="el" href="func__strings_8c_source.html#l00292">function_fieldqty()</a>, <a class="el" href="pbx__dundi_8c_source.html#l00547">get_mapping_weight()</a>, <a class="el" href="res__agi_8c_source.html#l01841">handle_getvariablefull()</a>, <a class="el" href="app__mixmonitor_8c_source.html#l00398">launch_monitor_thread()</a>, <a class="el" href="app__voicemail_8c_source.html#l04163">make_email_file()</a>, <a class="el" href="cdr__manager_8c_source.html#l00134">manager_log()</a>, <a class="el" href="pbx_8c_source.html#l09140">pbx_builtin_importvar()</a>, <a class="el" href="pbx_8c_source.html#l02469">pbx_find_extension()</a>, <a class="el" href="pbx__config_8c_source.html#l01367">pbx_load_config()</a>, <a class="el" href="pbx_8c_source.html#l03610">pbx_substitute_variables()</a>, <a class="el" href="res__config__curl_8c_source.html#l00056">realtime_curl()</a>, <a class="el" href="pbx__realtime_8c_source.html#l00186">realtime_exec()</a>, <a class="el" href="res__config__curl_8c_source.html#l00128">realtime_multi_curl()</a>, <a class="el" href="res__config__curl_8c_source.html#l00472">require_curl()</a>, <a class="el" href="logger_8c_source.html#l00500">rotate_file()</a>, <a class="el" href="app__rpt_8c_source.html#l02917">rpt_do_lstats()</a>, <a class="el" href="app__rpt_8c_source.html#l13122">rpt_exec()</a>, <a class="el" href="app__minivm_8c_source.html#l01027">sendmail()</a>, <a class="el" href="app__voicemail_8c_source.html#l04513">sendpage()</a>, <a class="el" href="cdr__sqlite3__custom_8c_source.html#l00223">sqlite3_log()</a>, <a class="el" href="res__config__curl_8c_source.html#l00354">store_curl()</a>, <a class="el" href="res__config__ldap_8c_source.html#l00621">substituted()</a>, <a class="el" href="app__queue_8c_source.html#l03569">try_calling()</a>, <a class="el" href="app__exec_8c_source.html#l00163">tryexec_exec()</a>, <a class="el" href="res__config__curl_8c_source.html#l00278">update2_curl()</a>, and <a class="el" href="res__config__curl_8c_source.html#l00225">update_curl()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03599"></a>03599 {
<a name="l03600"></a>03600    <span class="keywordtype">size_t</span> used;
<a name="l03601"></a>03601    <a class="code" href="pbx_8h.html#a4019ca376e3f30f3cd342e29d3145742">pbx_substitute_variables_helper_full</a>(c, (c) ? &amp;c-&gt;<a class="code" href="structast__channel.html#a9ffb22045a8f14bef8f2137cd779ab25">varshead</a> : NULL, cp1, cp2, count, &amp;used);
<a name="l03602"></a>03602 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4019ca376e3f30f3cd342e29d3145742"></a><!-- doxytag: member="pbx.h::pbx_substitute_variables_helper_full" ref="a4019ca376e3f30f3cd342e29d3145742" args="(struct ast_channel *c, struct varshead *headp, const char *cp1, char *cp2, int cp2_size, size_t *used)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pbx_substitute_variables_helper_full </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct varshead *&nbsp;</td>
          <td class="paramname"> <em>headp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>cp1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>cp2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cp2_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&nbsp;</td>
          <td class="paramname"> <em>used</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8c_source.html#l03403">3403</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00730">ast_channel_alloc</a>, <a class="el" href="channel_8c_source.html#l01388">ast_channel_free()</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="ast__expr2f_8c_source.html#l02399">ast_expr()</a>, <a class="el" href="pbx_8c_source.html#l03356">ast_func_read()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="func__strings_8c_source.html#l00821">len()</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="pbx_8c_source.html#l02792">parse_variable_name()</a>, <a class="el" href="pbx_8c_source.html#l02867">pbx_retrieve_variable()</a>, <a class="el" href="pbx_8c_source.html#l03403">pbx_substitute_variables_helper_full()</a>, <a class="el" href="pbx_8c_source.html#l02825">substring()</a>, <a class="el" href="ast__expr2f_8c_source.html#l00613">var</a>, <a class="el" href="pbx_8c_source.html#l00729">VAR_BUF_SIZE</a>, and <a class="el" href="channel_8h_source.html#l00446">ast_channel::varshead</a>.</p>

<p>Referenced by <a class="el" href="strings_8c_source.html#l00114">ast_str_substitute_variables()</a>, <a class="el" href="pbx_8c_source.html#l03598">pbx_substitute_variables_helper()</a>, <a class="el" href="pbx_8c_source.html#l03403">pbx_substitute_variables_helper_full()</a>, and <a class="el" href="pbx_8c_source.html#l03604">pbx_substitute_variables_varshead()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03404"></a>03404 {
<a name="l03405"></a>03405    <span class="comment">/* Substitutes variables into cp2, based on string cp1, cp2 NO LONGER NEEDS TO BE ZEROED OUT!!!!  */</span>
<a name="l03406"></a>03406    <span class="keywordtype">char</span> *cp4;
<a name="l03407"></a>03407    <span class="keyword">const</span> <span class="keywordtype">char</span> *tmp, *whereweare, *orig_cp2 = cp2;
<a name="l03408"></a>03408    <span class="keywordtype">int</span> length, offset, offset2, isfunction;
<a name="l03409"></a>03409    <span class="keywordtype">char</span> *workspace = NULL;
<a name="l03410"></a>03410    <span class="keywordtype">char</span> *ltmp = NULL, *<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a> = NULL;
<a name="l03411"></a>03411    <span class="keywordtype">char</span> *nextvar, *nextexp, *nextthing;
<a name="l03412"></a>03412    <span class="keywordtype">char</span> *vars, *vare;
<a name="l03413"></a>03413    <span class="keywordtype">int</span> pos, brackets, needsub, <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>;
<a name="l03414"></a>03414 
<a name="l03415"></a>03415    *cp2 = 0; <span class="comment">/* just in case nothing ends up there */</span>
<a name="l03416"></a>03416    whereweare=tmp=cp1;
<a name="l03417"></a>03417    <span class="keywordflow">while</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(whereweare) &amp;&amp; count) {
<a name="l03418"></a>03418       <span class="comment">/* Assume we&apos;re copying the whole remaining string */</span>
<a name="l03419"></a>03419       pos = strlen(whereweare);
<a name="l03420"></a>03420       nextvar = NULL;
<a name="l03421"></a>03421       nextexp = NULL;
<a name="l03422"></a>03422       nextthing = strchr(whereweare, <span class="charliteral">&apos;$&apos;</span>);
<a name="l03423"></a>03423       <span class="keywordflow">if</span> (nextthing) {
<a name="l03424"></a>03424          <span class="keywordflow">switch</span> (nextthing[1]) {
<a name="l03425"></a>03425          <span class="keywordflow">case</span> <span class="charliteral">&apos;{&apos;</span>:
<a name="l03426"></a>03426             nextvar = nextthing;
<a name="l03427"></a>03427             pos = nextvar - whereweare;
<a name="l03428"></a>03428             <span class="keywordflow">break</span>;
<a name="l03429"></a>03429          <span class="keywordflow">case</span> <span class="charliteral">&apos;[&apos;</span>:
<a name="l03430"></a>03430             nextexp = nextthing;
<a name="l03431"></a>03431             pos = nextexp - whereweare;
<a name="l03432"></a>03432             <span class="keywordflow">break</span>;
<a name="l03433"></a>03433          <span class="keywordflow">default</span>:
<a name="l03434"></a>03434             pos = 1;
<a name="l03435"></a>03435          }
<a name="l03436"></a>03436       }
<a name="l03437"></a>03437 
<a name="l03438"></a>03438       <span class="keywordflow">if</span> (pos) {
<a name="l03439"></a>03439          <span class="comment">/* Can&apos;t copy more than &apos;count&apos; bytes */</span>
<a name="l03440"></a>03440          <span class="keywordflow">if</span> (pos &gt; count)
<a name="l03441"></a>03441             pos = count;
<a name="l03442"></a>03442 
<a name="l03443"></a>03443          <span class="comment">/* Copy that many bytes */</span>
<a name="l03444"></a>03444          memcpy(cp2, whereweare, pos);
<a name="l03445"></a>03445 
<a name="l03446"></a>03446          count -= pos;
<a name="l03447"></a>03447          cp2 += pos;
<a name="l03448"></a>03448          whereweare += pos;
<a name="l03449"></a>03449          *cp2 = 0;
<a name="l03450"></a>03450       }
<a name="l03451"></a>03451 
<a name="l03452"></a>03452       <span class="keywordflow">if</span> (nextvar) {
<a name="l03453"></a>03453          <span class="comment">/* We have a variable.  Find the start and end, and determine</span>
<a name="l03454"></a>03454 <span class="comment">            if we are going to have to recursively call ourselves on the</span>
<a name="l03455"></a>03455 <span class="comment">            contents */</span>
<a name="l03456"></a>03456          vars = vare = nextvar + 2;
<a name="l03457"></a>03457          brackets = 1;
<a name="l03458"></a>03458          needsub = 0;
<a name="l03459"></a>03459 
<a name="l03460"></a>03460          <span class="comment">/* Find the end of it */</span>
<a name="l03461"></a>03461          <span class="keywordflow">while</span> (brackets &amp;&amp; *vare) {
<a name="l03462"></a>03462             <span class="keywordflow">if</span> ((vare[0] == <span class="charliteral">&apos;$&apos;</span>) &amp;&amp; (vare[1] == <span class="charliteral">&apos;{&apos;</span>)) {
<a name="l03463"></a>03463                needsub++;
<a name="l03464"></a>03464             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (vare[0] == <span class="charliteral">&apos;{&apos;</span>) {
<a name="l03465"></a>03465                brackets++;
<a name="l03466"></a>03466             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (vare[0] == <span class="charliteral">&apos;}&apos;</span>) {
<a name="l03467"></a>03467                brackets--;
<a name="l03468"></a>03468             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((vare[0] == <span class="charliteral">&apos;$&apos;</span>) &amp;&amp; (vare[1] == <span class="charliteral">&apos;[&apos;</span>))
<a name="l03469"></a>03469                needsub++;
<a name="l03470"></a>03470             vare++;
<a name="l03471"></a>03471          }
<a name="l03472"></a>03472          <span class="keywordflow">if</span> (brackets)
<a name="l03473"></a>03473             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Error in extension logic (missing &apos;}&apos;)\n&quot;</span>);
<a name="l03474"></a>03474          len = vare - vars - 1;
<a name="l03475"></a>03475 
<a name="l03476"></a>03476          <span class="comment">/* Skip totally over variable string */</span>
<a name="l03477"></a>03477          whereweare += (len + 3);
<a name="l03478"></a>03478 
<a name="l03479"></a>03479          <span class="keywordflow">if</span> (!var)
<a name="l03480"></a>03480             var = alloca(<a class="code" href="pbx_8c.html#ae1761f6ffd7763505cd891d3314cd7e4">VAR_BUF_SIZE</a>);
<a name="l03481"></a>03481 
<a name="l03482"></a>03482          <span class="comment">/* Store variable name (and truncate) */</span>
<a name="l03483"></a>03483          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(var, vars, len + 1);
<a name="l03484"></a>03484 
<a name="l03485"></a>03485          <span class="comment">/* Substitute if necessary */</span>
<a name="l03486"></a>03486          <span class="keywordflow">if</span> (needsub) {
<a name="l03487"></a>03487             <span class="keywordtype">size_t</span> used;
<a name="l03488"></a>03488             <span class="keywordflow">if</span> (!ltmp)
<a name="l03489"></a>03489                ltmp = alloca(<a class="code" href="pbx_8c.html#ae1761f6ffd7763505cd891d3314cd7e4">VAR_BUF_SIZE</a>);
<a name="l03490"></a>03490 
<a name="l03491"></a>03491             <a class="code" href="pbx_8h.html#a4019ca376e3f30f3cd342e29d3145742">pbx_substitute_variables_helper_full</a>(c, headp, var, ltmp, <a class="code" href="pbx_8c.html#ae1761f6ffd7763505cd891d3314cd7e4">VAR_BUF_SIZE</a> - 1, &amp;used);
<a name="l03492"></a>03492             vars = ltmp;
<a name="l03493"></a>03493          } <span class="keywordflow">else</span> {
<a name="l03494"></a>03494             vars = var;
<a name="l03495"></a>03495          }
<a name="l03496"></a>03496 
<a name="l03497"></a>03497          <span class="keywordflow">if</span> (!workspace)
<a name="l03498"></a>03498             workspace = alloca(<a class="code" href="pbx_8c.html#ae1761f6ffd7763505cd891d3314cd7e4">VAR_BUF_SIZE</a>);
<a name="l03499"></a>03499 
<a name="l03500"></a>03500          workspace[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l03501"></a>03501 
<a name="l03502"></a>03502          <a class="code" href="pbx_8c.html#ac280b071ffa8f9e016cc011d77c41a86" title="extract offset:length from variable name.">parse_variable_name</a>(vars, &amp;offset, &amp;offset2, &amp;isfunction);
<a name="l03503"></a>03503          <span class="keywordflow">if</span> (isfunction) {
<a name="l03504"></a>03504             <span class="comment">/* Evaluate function */</span>
<a name="l03505"></a>03505             <span class="keywordflow">if</span> (c || !headp)
<a name="l03506"></a>03506                cp4 = <a class="code" href="pbx_8h.html#aa4e9618aa036a586af7d7663afd9b507" title="executes a read operation on a function">ast_func_read</a>(c, vars, workspace, <a class="code" href="pbx_8c.html#ae1761f6ffd7763505cd891d3314cd7e4">VAR_BUF_SIZE</a>) ? NULL : workspace;
<a name="l03507"></a>03507             <span class="keywordflow">else</span> {
<a name="l03508"></a>03508                <span class="keyword">struct </span>varshead old;
<a name="l03509"></a>03509                <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *bogus = <a class="code" href="channel_8h.html#adfbceb39821586c0f9be0c47496a4e18">ast_channel_alloc</a>(0, 0, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, 0, <span class="stringliteral">&quot;Bogus/%p&quot;</span>, vars);
<a name="l03510"></a>03510                <span class="keywordflow">if</span> (bogus) {
<a name="l03511"></a>03511                   memcpy(&amp;old, &amp;bogus-&gt;<a class="code" href="structast__channel.html#a9ffb22045a8f14bef8f2137cd779ab25">varshead</a>, <span class="keyword">sizeof</span>(old));
<a name="l03512"></a>03512                   memcpy(&amp;bogus-&gt;<a class="code" href="structast__channel.html#a9ffb22045a8f14bef8f2137cd779ab25">varshead</a>, headp, <span class="keyword">sizeof</span>(bogus-&gt;<a class="code" href="structast__channel.html#a9ffb22045a8f14bef8f2137cd779ab25">varshead</a>));
<a name="l03513"></a>03513                   cp4 = <a class="code" href="pbx_8h.html#aa4e9618aa036a586af7d7663afd9b507" title="executes a read operation on a function">ast_func_read</a>(bogus, vars, workspace, <a class="code" href="pbx_8c.html#ae1761f6ffd7763505cd891d3314cd7e4">VAR_BUF_SIZE</a>) ? NULL : workspace;
<a name="l03514"></a>03514                   <span class="comment">/* Don&apos;t deallocate the varshead that was passed in */</span>
<a name="l03515"></a>03515                   memcpy(&amp;bogus-&gt;<a class="code" href="structast__channel.html#a9ffb22045a8f14bef8f2137cd779ab25">varshead</a>, &amp;old, <span class="keyword">sizeof</span>(bogus-&gt;<a class="code" href="structast__channel.html#a9ffb22045a8f14bef8f2137cd779ab25">varshead</a>));
<a name="l03516"></a>03516                   <a class="code" href="channel_8h.html#a239d899b30002db4e8b08c055ac9d8e5" title="Free a channel structure.">ast_channel_free</a>(bogus);
<a name="l03517"></a>03517                } <span class="keywordflow">else</span>
<a name="l03518"></a>03518                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to allocate bogus channel for variable substitution.  Function results may be blank.\n&quot;</span>);
<a name="l03519"></a>03519             }
<a name="l03520"></a>03520             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;Function result is &apos;%s&apos;\n&quot;</span>, cp4 ? cp4 : <span class="stringliteral">&quot;(null)&quot;</span>);
<a name="l03521"></a>03521          } <span class="keywordflow">else</span> {
<a name="l03522"></a>03522             <span class="comment">/* Retrieve variable value */</span>
<a name="l03523"></a>03523             <a class="code" href="pbx_8h.html#aaf906a18ba2dcd53c35f59869757521f" title="Retrieve the value of a builtin variable or variable from the channel variable stack...">pbx_retrieve_variable</a>(c, vars, &amp;cp4, workspace, <a class="code" href="pbx_8c.html#ae1761f6ffd7763505cd891d3314cd7e4">VAR_BUF_SIZE</a>, headp);
<a name="l03524"></a>03524          }
<a name="l03525"></a>03525          <span class="keywordflow">if</span> (cp4) {
<a name="l03526"></a>03526             cp4 = <a class="code" href="pbx_8c.html#ac79353a3cba653bbeea7eabd8e4d073c" title="takes a substring. It is ok to call with value == workspace.">substring</a>(cp4, offset, offset2, workspace, <a class="code" href="pbx_8c.html#ae1761f6ffd7763505cd891d3314cd7e4">VAR_BUF_SIZE</a>);
<a name="l03527"></a>03527 
<a name="l03528"></a>03528             length = strlen(cp4);
<a name="l03529"></a>03529             <span class="keywordflow">if</span> (length &gt; count)
<a name="l03530"></a>03530                length = count;
<a name="l03531"></a>03531             memcpy(cp2, cp4, length);
<a name="l03532"></a>03532             count -= length;
<a name="l03533"></a>03533             cp2 += length;
<a name="l03534"></a>03534             *cp2 = 0;
<a name="l03535"></a>03535          }
<a name="l03536"></a>03536       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nextexp) {
<a name="l03537"></a>03537          <span class="comment">/* We have an expression.  Find the start and end, and determine</span>
<a name="l03538"></a>03538 <span class="comment">            if we are going to have to recursively call ourselves on the</span>
<a name="l03539"></a>03539 <span class="comment">            contents */</span>
<a name="l03540"></a>03540          vars = vare = nextexp + 2;
<a name="l03541"></a>03541          brackets = 1;
<a name="l03542"></a>03542          needsub = 0;
<a name="l03543"></a>03543 
<a name="l03544"></a>03544          <span class="comment">/* Find the end of it */</span>
<a name="l03545"></a>03545          <span class="keywordflow">while</span> (brackets &amp;&amp; *vare) {
<a name="l03546"></a>03546             <span class="keywordflow">if</span> ((vare[0] == <span class="charliteral">&apos;$&apos;</span>) &amp;&amp; (vare[1] == <span class="charliteral">&apos;[&apos;</span>)) {
<a name="l03547"></a>03547                needsub++;
<a name="l03548"></a>03548                brackets++;
<a name="l03549"></a>03549                vare++;
<a name="l03550"></a>03550             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (vare[0] == <span class="charliteral">&apos;[&apos;</span>) {
<a name="l03551"></a>03551                brackets++;
<a name="l03552"></a>03552             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (vare[0] == <span class="charliteral">&apos;]&apos;</span>) {
<a name="l03553"></a>03553                brackets--;
<a name="l03554"></a>03554             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((vare[0] == <span class="charliteral">&apos;$&apos;</span>) &amp;&amp; (vare[1] == <span class="charliteral">&apos;{&apos;</span>)) {
<a name="l03555"></a>03555                needsub++;
<a name="l03556"></a>03556                vare++;
<a name="l03557"></a>03557             }
<a name="l03558"></a>03558             vare++;
<a name="l03559"></a>03559          }
<a name="l03560"></a>03560          <span class="keywordflow">if</span> (brackets)
<a name="l03561"></a>03561             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Error in extension logic (missing &apos;]&apos;)\n&quot;</span>);
<a name="l03562"></a>03562          len = vare - vars - 1;
<a name="l03563"></a>03563 
<a name="l03564"></a>03564          <span class="comment">/* Skip totally over expression */</span>
<a name="l03565"></a>03565          whereweare += (len + 3);
<a name="l03566"></a>03566 
<a name="l03567"></a>03567          <span class="keywordflow">if</span> (!var)
<a name="l03568"></a>03568             var = alloca(<a class="code" href="pbx_8c.html#ae1761f6ffd7763505cd891d3314cd7e4">VAR_BUF_SIZE</a>);
<a name="l03569"></a>03569 
<a name="l03570"></a>03570          <span class="comment">/* Store variable name (and truncate) */</span>
<a name="l03571"></a>03571          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(var, vars, len + 1);
<a name="l03572"></a>03572 
<a name="l03573"></a>03573          <span class="comment">/* Substitute if necessary */</span>
<a name="l03574"></a>03574          <span class="keywordflow">if</span> (needsub) {
<a name="l03575"></a>03575             <span class="keywordtype">size_t</span> used;
<a name="l03576"></a>03576             <span class="keywordflow">if</span> (!ltmp)
<a name="l03577"></a>03577                ltmp = alloca(<a class="code" href="pbx_8c.html#ae1761f6ffd7763505cd891d3314cd7e4">VAR_BUF_SIZE</a>);
<a name="l03578"></a>03578 
<a name="l03579"></a>03579             <a class="code" href="pbx_8h.html#a4019ca376e3f30f3cd342e29d3145742">pbx_substitute_variables_helper_full</a>(c, headp, var, ltmp, <a class="code" href="pbx_8c.html#ae1761f6ffd7763505cd891d3314cd7e4">VAR_BUF_SIZE</a> - 1, &amp;used);
<a name="l03580"></a>03580             vars = ltmp;
<a name="l03581"></a>03581          } <span class="keywordflow">else</span> {
<a name="l03582"></a>03582             vars = var;
<a name="l03583"></a>03583          }
<a name="l03584"></a>03584 
<a name="l03585"></a>03585          length = <a class="code" href="ast__expr_8h.html#a7aefd8d0694c8f4241d64ffaf5145b4c">ast_expr</a>(vars, cp2, count, c);
<a name="l03586"></a>03586 
<a name="l03587"></a>03587          <span class="keywordflow">if</span> (length) {
<a name="l03588"></a>03588             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Expression result is &apos;%s&apos;\n&quot;</span>, cp2);
<a name="l03589"></a>03589             count -= length;
<a name="l03590"></a>03590             cp2 += length;
<a name="l03591"></a>03591             *cp2 = 0;
<a name="l03592"></a>03592          }
<a name="l03593"></a>03593       }
<a name="l03594"></a>03594    }
<a name="l03595"></a>03595    *used = cp2 - orig_cp2;
<a name="l03596"></a>03596 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2b3355625306d4b98ca8047cd2245459"></a><!-- doxytag: member="pbx.h::pbx_substitute_variables_varshead" ref="a2b3355625306d4b98ca8047cd2245459" args="(struct varshead *headp, const char *cp1, char *cp2, int count)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pbx_substitute_variables_varshead </td>
          <td>(</td>
          <td class="paramtype">struct varshead *&nbsp;</td>
          <td class="paramname"> <em>headp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>cp1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>cp2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>count</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pbx_8c_source.html#l03604">3604</a> of file <a class="el" href="pbx_8c_source.html">pbx.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l03403">pbx_substitute_variables_helper_full()</a>.</p>

<p>Referenced by <a class="el" href="res__phoneprov_8c_source.html#l00860">add_user_extension()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00897">build_user_routes()</a>, <a class="el" href="app__playback_8c_source.html#l00162">do_say()</a>, <a class="el" href="pbx__dundi_8c_source.html#l00561">dundi_lookup_local()</a>, <a class="el" href="pbx__loopback_8c_source.html#l00083">loopback_subst()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00401">phoneprov_callback()</a>, <a class="el" href="res__phoneprov_8c_source.html#l01131">pp_each_extension_exec()</a>, and <a class="el" href="res__phoneprov_8c_source.html#l01088">pp_each_user_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l03605"></a>03605 {
<a name="l03606"></a>03606    <span class="keywordtype">size_t</span> used;
<a name="l03607"></a>03607    <a class="code" href="pbx_8h.html#a4019ca376e3f30f3cd342e29d3145742">pbx_substitute_variables_helper_full</a>(NULL, headp, cp1, cp2, count, &amp;used);
<a name="l03608"></a>03608 }
</pre></div></p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:22:48 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
