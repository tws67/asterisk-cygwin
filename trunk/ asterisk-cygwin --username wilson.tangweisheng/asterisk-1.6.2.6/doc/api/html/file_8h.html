<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:22:06 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_1ab815038f534adda65c8b4ae4993449.html">include</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_16d825f1fa9ecca2e70b1a8d9256d0e6.html">asterisk</a>
  </div>
</div>
<div class="contents">
<h1>file.h File Reference</h1>
<p>Generic File Format Support. Should be included by clients of the file handling routines. File service providers should instead include <a class="el" href="mod__format_8h.html" title="Header for providers of file and format handling routines. Clients of these routines...">mod_format.h</a>.  
<a href="#_details">More...</a></p>
<code>#include &lt;fcntl.h&gt;</code><br/>

<p><a href="file_8h_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#afa92b0106fb7a918ea994c2867ac0a04">AST_DIGIT_ANY</a>&nbsp;&nbsp;&nbsp;&quot;0123456789#*ABCD&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#abd91337f5cce3ab7448c54a0d2aa4272">AST_DIGIT_ANYNUM</a>&nbsp;&nbsp;&nbsp;&quot;0123456789&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#aa932272aad0c1610b79e9b04e54e57ea">AST_MAX_FORMATS</a>&nbsp;&nbsp;&nbsp;10</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#a8db5048680510188c111d19ebaaa85c4">AST_RESERVED_POINTERS</a>&nbsp;&nbsp;&nbsp;20</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#abd4aebd901cf2e2251920acfbe22fa22">SEEK_FORCECUR</a>&nbsp;&nbsp;&nbsp;10</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#a618e3120b6d019312ef2d617d9f14571">ast_applystream</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structast__filestream.html">ast_filestream</a> *s)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Applys a open stream to a channel.  <a href="#a618e3120b6d019312ef2d617d9f14571"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#ab53bd2c3c55d509790c7f7620aac6373">ast_closestream</a> (struct <a class="el" href="structast__filestream.html">ast_filestream</a> *<a class="el" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Closes a stream.  <a href="#ab53bd2c3c55d509790c7f7620aac6373"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#aeac4fbc3c21ddf2548bc7ae7fab717f3">ast_file_init</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#aab7814972ae21f8cc68e1d62b97fc88b">ast_filecopy</a> (const char *oldname, const char *newname, const char *fmt)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Copies a file.  <a href="#aab7814972ae21f8cc68e1d62b97fc88b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#adb15d6efecc1a13b8835bee6d3562ddb">ast_filedelete</a> (const char *filename, const char *fmt)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Deletes a file.  <a href="#adb15d6efecc1a13b8835bee6d3562ddb"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#ab9b8ab8e5ee34c9b4da25779255cafde">ast_fileexists</a> (const char *filename, const char *fmt, const char *preflang)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Checks for the existence of a given file.  <a href="#ab9b8ab8e5ee34c9b4da25779255cafde"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#a57ea6065cde7fb5258c1f6a4595643ba">ast_filerename</a> (const char *oldname, const char *newname, const char *fmt)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Renames a file.  <a href="#a57ea6065cde7fb5258c1f6a4595643ba"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#aa526fd9bb57d7d9afac2113c30d236f8">ast_format_str_reduce</a> (char *fmts)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__filestream.html">ast_filestream</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#ad85c951fa1d6988d2d7e169833a951a8">ast_openstream</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *filename, const char *preflang)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Opens stream for use in seeking, playing.  <a href="#ad85c951fa1d6988d2d7e169833a951a8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__filestream.html">ast_filestream</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#ae2d6dfeafd18a99d47195178cd752a3d">ast_openstream_full</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *filename, const char *preflang, int asis)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Opens stream for use in seeking, playing.  <a href="#ae2d6dfeafd18a99d47195178cd752a3d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__filestream.html">ast_filestream</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#aeed49fff2d6008a89f996230988d944d">ast_openvstream</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *filename, const char *preflang)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Opens stream for use in seeking, playing.  <a href="#aeed49fff2d6008a89f996230988d944d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#ad59224750b8b617f9590b28b88457b14">ast_playstream</a> (struct <a class="el" href="structast__filestream.html">ast_filestream</a> *s)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Play a open stream on a channel.  <a href="#ad59224750b8b617f9590b28b88457b14"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__filestream.html">ast_filestream</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#ad572060ea434390db3d1ccde4511dfcd">ast_readfile</a> (const char *filename, const char *<a class="el" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>, const char *comment, int flags, int check, mode_t mode)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Starts reading from a file.  <a href="#ad572060ea434390db3d1ccde4511dfcd"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#a962bc31d7a953b0a0290c72b168d41a7">ast_readframe</a> (struct <a class="el" href="structast__filestream.html">ast_filestream</a> *s)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read a frame from a filestream.  <a href="#a962bc31d7a953b0a0290c72b168d41a7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#a36f6bba05952162d5d1ee7fb9819bd07">ast_seekstream</a> (struct <a class="el" href="structast__filestream.html">ast_filestream</a> *fs, off_t sample_offset, int whence)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Seeks into stream.  <a href="#a36f6bba05952162d5d1ee7fb9819bd07"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#a3092bf11d4bba66f646562759608b1bc">ast_stopstream</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Stops a stream.  <a href="#a3092bf11d4bba66f646562759608b1bc"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#a95b94a020720147325a486e210b36775">ast_stream_and_wait</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *file, const char *digits)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">stream file until digit If the file name is non-empty, try to play it.  <a href="#a95b94a020720147325a486e210b36775"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#ac2137b5da91f3408f86d580952f32e94">ast_stream_fastforward</a> (struct <a class="el" href="structast__filestream.html">ast_filestream</a> *fs, off_t ms)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Fast forward stream ms.  <a href="#ac2137b5da91f3408f86d580952f32e94"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#a4c7c02a659b09bb06dd63e1f42692666">ast_stream_rewind</a> (struct <a class="el" href="structast__filestream.html">ast_filestream</a> *fs, off_t ms)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Rewind stream ms.  <a href="#a4c7c02a659b09bb06dd63e1f42692666"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#a67c7e271b4ca70aca6d48fd48d121857">ast_streamfile</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c, const char *filename, const char *preflang)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Streams a file.  <a href="#a67c7e271b4ca70aca6d48fd48d121857"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">off_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#a01771a318e7adea51499040f27b4278a">ast_tellstream</a> (struct <a class="el" href="structast__filestream.html">ast_filestream</a> *fs)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Tell where we are in a stream.  <a href="#a01771a318e7adea51499040f27b4278a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#aa647ac352a00b559131f90ffffea2c3c">ast_truncstream</a> (struct <a class="el" href="structast__filestream.html">ast_filestream</a> *fs)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Trunc stream at current location.  <a href="#aa647ac352a00b559131f90ffffea2c3c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#affc21cb57c6bf72a2cb7ec8a379b2137">ast_waitstream</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c, const char *breakon)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Waits for a stream to stop or digit to be pressed.  <a href="#affc21cb57c6bf72a2cb7ec8a379b2137"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#ae6eb4e1e4576abe04a4b185688f6690c">ast_waitstream_exten</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c, const char *<a class="el" href="chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Waits for a stream to stop or digit matching a valid one digit exten to be pressed.  <a href="#ae6eb4e1e4576abe04a4b185688f6690c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#a5ce837632e3746a3af17f8311060e510">ast_waitstream_fr</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c, const char *breakon, const char *forward, const char *rewind, int ms)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Same as waitstream but allows stream to be forwarded or rewound.  <a href="#a5ce837632e3746a3af17f8311060e510"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#a3089874cd5223053f670c8499e911ec4">ast_waitstream_full</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c, const char *breakon, int audiofd, int monfd)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__filestream.html">ast_filestream</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#a964f8ef393c07609d7b9e02937faed52">ast_writefile</a> (const char *filename, const char *<a class="el" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>, const char *comment, int flags, int check, mode_t mode)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Starts writing a file.  <a href="#a964f8ef393c07609d7b9e02937faed52"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="file_8h.html#a3608386b919ef0949d2858cdeb02d12e">ast_writestream</a> (struct <a class="el" href="structast__filestream.html">ast_filestream</a> *fs, struct <a class="el" href="structast__frame.html">ast_frame</a> *<a class="el" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Writes a frame to a stream.  <a href="#a3608386b919ef0949d2858cdeb02d12e"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Generic File Format Support. Should be included by clients of the file handling routines. File service providers should instead include <a class="el" href="mod__format_8h.html" title="Header for providers of file and format handling routines. Clients of these routines...">mod_format.h</a>. </p>

<p>Definition in file <a class="el" href="file_8h_source.html">file.h</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="afa92b0106fb7a918ea994c2867ac0a04"></a><!-- doxytag: member="file.h::AST_DIGIT_ANY" ref="afa92b0106fb7a918ea994c2867ac0a04" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_DIGIT_ANY&nbsp;&nbsp;&nbsp;&quot;0123456789#*ABCD&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Convenient for waiting </p>

<p>Definition at line <a class="el" href="file_8h_source.html#l00047">47</a> of file <a class="el" href="file_8h_source.html">file.h</a>.</p>

<p>Referenced by <a class="el" href="app_8c_source.html#l01650">ast_ivr_menu_run_internal()</a>, <a class="el" href="app_8c_source.html#l00634">ast_play_and_wait()</a>, <a class="el" href="channel_8c_source.html#l04093">ast_readstring_full()</a>, <a class="el" href="app_8c_source.html#l01439">ast_record_review()</a>, <a class="el" href="channel_8c_source.html#l04742">bridge_playfile()</a>, <a class="el" href="features_8c_source.html#l01396">builtin_atxfer()</a>, <a class="el" href="features_8c_source.html#l01265">builtin_blindtransfer()</a>, <a class="el" href="app__dahdiscan_8c_source.html#l00290">conf_exec()</a>, <a class="el" href="app__meetme_8c_source.html#l01998">conf_run()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="app__dictate_8c_source.html#l00084">dictate_exec()</a>, <a class="el" href="app__directory_8c_source.html#l00723">directory_exec()</a>, <a class="el" href="bridge__builtin__features_8c_source.html#l00157">feature_attended_transfer()</a>, <a class="el" href="bridge__builtin__features_8c_source.html#l00095">feature_blind_transfer()</a>, <a class="el" href="app__festival_8c_source.html#l00268">festival_exec()</a>, <a class="el" href="app__voicemail_8c_source.html#l06238">get_folder()</a>, <a class="el" href="bridge__builtin__features_8c_source.html#l00048">grab_transfer()</a>, <a class="el" href="app_8c_source.html#l01540">ivr_dispatch()</a>, <a class="el" href="app__confbridge_8c_source.html#l00607">menu_callback()</a>, <a class="el" href="pbx_8c_source.html#l08798">pbx_builtin_background()</a>, <a class="el" href="app__queue_8c_source.html#l02023">play_file()</a>, <a class="el" href="app__directory_8c_source.html#l00247">play_mailbox_owner()</a>, <a class="el" href="app__voicemail_8c_source.html#l07051">play_message()</a>, <a class="el" href="app__voicemail_8c_source.html#l06937">play_message_callerid()</a>, <a class="el" href="app__voicemail_8c_source.html#l06865">play_message_datetime()</a>, <a class="el" href="app__voicemail_8c_source.html#l07001">play_message_duration()</a>, <a class="el" href="app__minivm_8c_source.html#l01378">play_record_review()</a>, <a class="el" href="app__dial_8c_source.html#l02345">retrydial_exec()</a>, <a class="el" href="app__voicemail_8c_source.html#l05658">say_and_wait()</a>, <a class="el" href="app__queue_8c_source.html#l02080">say_position()</a>, <a class="el" href="app__voicemail_8c_source.html#l11261">sayname()</a>, <a class="el" href="app__sayunixtime_8c_source.html#l00092">sayunixtime_exec()</a>, <a class="el" href="app__directory_8c_source.html#l00322">select_item_menu()</a>, <a class="el" href="app__directory_8c_source.html#l00287">select_item_seq()</a>, <a class="el" href="app__queue_8c_source.html#l03569">try_calling()</a>, <a class="el" href="app__voicemail_8c_source.html#l07468">vm_intro_gr()</a>, <a class="el" href="app__voicemail_8c_source.html#l07602">vm_intro_he()</a>, <a class="el" href="app__voicemail_8c_source.html#l07562">vm_intro_multilang()</a>, <a class="el" href="app__voicemail_8c_source.html#l08161">vm_intro_pt()</a>, <a class="el" href="app__voicemail_8c_source.html#l08022">vm_intro_pt_BR()</a>, and <a class="el" href="app__voicemail_8c_source.html#l06837">wait_file2()</a>.</p>

</div>
</div>
<a class="anchor" id="abd91337f5cce3ab7448c54a0d2aa4272"></a><!-- doxytag: member="file.h::AST_DIGIT_ANYNUM" ref="abd91337f5cce3ab7448c54a0d2aa4272" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_DIGIT_ANYNUM&nbsp;&nbsp;&nbsp;&quot;0123456789&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="file_8h_source.html#l00048">48</a> of file <a class="el" href="file_8h_source.html">file.h</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l10657">initreqprep()</a>.</p>

</div>
</div>
<a class="anchor" id="aa932272aad0c1610b79e9b04e54e57ea"></a><!-- doxytag: member="file.h::AST_MAX_FORMATS" ref="aa932272aad0c1610b79e9b04e54e57ea" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_MAX_FORMATS&nbsp;&nbsp;&nbsp;10</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>The maximum <a class="el" href="structnumber.html" title="Number structure.">number</a> of <a class="el" href="structformats.html">formats</a> we expect to see in a format string </p>

<p>Definition at line <a class="el" href="file_8h_source.html#l00044">44</a> of file <a class="el" href="file_8h_source.html">file.h</a>.</p>

<p>Referenced by <a class="el" href="app_8c_source.html#l00668">__ast_play_and_record()</a>, and <a class="el" href="file_8c_source.html#l01354">ast_format_str_reduce()</a>.</p>

</div>
</div>
<a class="anchor" id="a8db5048680510188c111d19ebaaa85c4"></a><!-- doxytag: member="file.h::AST_RESERVED_POINTERS" ref="a8db5048680510188c111d19ebaaa85c4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_RESERVED_POINTERS&nbsp;&nbsp;&nbsp;20</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="file_8h_source.html#l00329">329</a> of file <a class="el" href="file_8h_source.html">file.h</a>.</p>

</div>
</div>
<a class="anchor" id="abd4aebd901cf2e2251920acfbe22fa22"></a><!-- doxytag: member="file.h::SEEK_FORCECUR" ref="abd4aebd901cf2e2251920acfbe22fa22" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SEEK_FORCECUR&nbsp;&nbsp;&nbsp;10</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="file_8h_source.html#l00050">50</a> of file <a class="el" href="file_8h_source.html">file.h</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l02636">__ast_read()</a>, <a class="el" href="channel_8c_source.html#l03411">ast_write()</a>, <a class="el" href="format__pcm_8c_source.html#l00371">au_seek()</a>, <a class="el" href="format__g729_8c_source.html#l00084">g729_seek()</a>, <a class="el" href="format__gsm_8c_source.html#l00105">gsm_seek()</a>, <a class="el" href="format__ilbc_8c_source.html#l00082">ilbc_seek()</a>, <a class="el" href="format__pcm_8c_source.html#l00099">pcm_seek()</a>, <a class="el" href="format__siren14_8c_source.html#l00075">siren14seek()</a>, <a class="el" href="format__siren7_8c_source.html#l00075">siren7seek()</a>, <a class="el" href="format__sln_8c_source.html#l00073">slinear_seek()</a>, <a class="el" href="format__vox_8c_source.html#l00075">vox_seek()</a>, and <a class="el" href="format__wav_8c_source.html#l00432">wav_seek()</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a618e3120b6d019312ef2d617d9f14571"></a><!-- doxytag: member="file.h::ast_applystream" ref="a618e3120b6d019312ef2d617d9f14571" args="(struct ast_channel *chan, struct ast_filestream *s)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_applystream </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__filestream.html">ast_filestream</a> *&nbsp;</td>
          <td class="paramname"> <em>s</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Applys a open stream to a channel. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>channel to work </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>s</em>&nbsp;</td><td><a class="el" href="structast__filestream.html" title="This structure is allocated by file.c in one chunk, together with buf_size and desc_size...">ast_filestream</a> to apply </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="file_8c_source.html#l00844">844</a> of file <a class="el" href="file_8c_source.html">file.c</a>.</p>

<p>References <a class="el" href="mod__format_8h_source.html#l00114">ast_filestream::owner</a>.</p>

<p>Referenced by <a class="el" href="file_8c_source.html#l00943">ast_streamfile()</a>, <a class="el" href="res__agi_8c_source.html#l01239">handle_getoption()</a>, <a class="el" href="res__agi_8c_source.html#l01494">handle_recordfile()</a>, <a class="el" href="res__agi_8c_source.html#l01189">handle_streamfile()</a>, and <a class="el" href="app__speech__utils_8c_source.html#l00615">speech_streamfile()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00845"></a>00845 {
<a name="l00846"></a>00846    s-&gt;<a class="code" href="structast__filestream.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a> = chan;
<a name="l00847"></a>00847    <span class="keywordflow">return</span> 0;
<a name="l00848"></a>00848 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab53bd2c3c55d509790c7f7620aac6373"></a><!-- doxytag: member="file.h::ast_closestream" ref="ab53bd2c3c55d509790c7f7620aac6373" args="(struct ast_filestream *f)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_closestream </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__filestream.html">ast_filestream</a> *&nbsp;</td>
          <td class="paramname"> <em>f</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Closes a stream. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>f</em>&nbsp;</td><td>filestream to close Close a playback or recording stream </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="file_8c_source.html#l00887">887</a> of file <a class="el" href="file_8c_source.html">file.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00459">ao2_ref</a>, <a class="el" href="frame_8h_source.html#l00273">AST_FORMAT_AUDIO_MASK</a>, <a class="el" href="sched_8h_source.html#l00051">AST_SCHED_DEL</a>, <a class="el" href="channel_8c_source.html#l02405">ast_settimeout()</a>, <a class="el" href="mod__format_8h_source.html#l00102">ast_filestream::fmt</a>, <a class="el" href="mod__format_8h_source.html#l00047">ast_format::format</a>, <a class="el" href="mod__format_8h_source.html#l00114">ast_filestream::owner</a>, <a class="el" href="channel_8h_source.html#l00413">ast_channel::sched</a>, <a class="el" href="channel_8h_source.html#l00414">ast_channel::stream</a>, <a class="el" href="channel_8h_source.html#l00465">ast_channel::streamid</a>, <a class="el" href="channel_8h_source.html#l00415">ast_channel::vstream</a>, and <a class="el" href="channel_8h_source.html#l00466">ast_channel::vstreamid</a>.</p>

<p>Referenced by <a class="el" href="app_8c_source.html#l00668">__ast_play_and_record()</a>, <a class="el" href="file_8c_source.html#l00408">ast_filehelper()</a>, <a class="el" href="channel_8c_source.html#l01690">ast_hangup()</a>, <a class="el" href="res__musiconhold_8c_source.html#l00256">ast_moh_files_next()</a>, <a class="el" href="res__monitor_8c_source.html#l00148">ast_monitor_start()</a>, <a class="el" href="res__monitor_8c_source.html#l00291">ast_monitor_stop()</a>, <a class="el" href="file_8c_source.html#l00985">ast_readfile()</a>, <a class="el" href="file_8c_source.html#l00122">ast_stopstream()</a>, <a class="el" href="file_8c_source.html#l01033">ast_writefile()</a>, <a class="el" href="app__dictate_8c_source.html#l00084">dictate_exec()</a>, <a class="el" href="file_8c_source.html#l00290">filestream_destructor()</a>, <a class="el" href="app__externalivr_8c_source.html#l00142">gen_closestream()</a>, <a class="el" href="res__convert_8c_source.html#l00062">handle_cli_file_convert()</a>, <a class="el" href="res__agi_8c_source.html#l01494">handle_recordfile()</a>, <a class="el" href="res__musiconhold_8c_source.html#l01433">local_ast_moh_stop()</a>, <a class="el" href="app__mixmonitor_8c_source.html#l00199">mixmonitor_ds_close_fs()</a>, <a class="el" href="res__musiconhold_8c_source.html#l00228">moh_files_release()</a>, <a class="el" href="app__record_8c_source.html#l00132">record_exec()</a>, <a class="el" href="app__meetme_8c_source.html#l04359">recordthread()</a>, and <a class="el" href="app__rpt_8c_source.html#l10730">rpt()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00888"></a>00888 {
<a name="l00889"></a>00889    <span class="comment">/* This used to destroy the filestream, but it now just decrements a refcount.</span>
<a name="l00890"></a>00890 <span class="comment">    * We need to force the stream to quit queuing frames now, because we might</span>
<a name="l00891"></a>00891 <span class="comment">    * change the writeformat, which could result in a subsequent write error, if</span>
<a name="l00892"></a>00892 <span class="comment">    * the format is different. */</span>
<a name="l00893"></a>00893 
<a name="l00894"></a>00894    <span class="comment">/* Stop a running stream if there is one */</span>
<a name="l00895"></a>00895    <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__filestream.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {
<a name="l00896"></a>00896       <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__filestream.html#af4e7a9f36c380991c59c9a49122de100">fmt</a>-&gt;<a class="code" href="structast__format.html#a317afff57d87a89158c2b038d37b2b08">format</a> &lt; <a class="code" href="frame_8h.html#a3f680b9c15596de927d507a664fd2803">AST_FORMAT_AUDIO_MASK</a>) {
<a name="l00897"></a>00897          f-&gt;<a class="code" href="structast__filestream.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#a016ccfa2a88444ffde0ad0168a0f231d">stream</a> = NULL;
<a name="l00898"></a>00898          <a class="code" href="sched_8h.html#a25647782014f8dc012994efcd1b81d32" title="a loop construct to ensure that the scheduled task get deleted. The idea is that...">AST_SCHED_DEL</a>(f-&gt;<a class="code" href="structast__filestream.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#aea6233539fc73fc5303bf7525ec27e73">sched</a>, f-&gt;<a class="code" href="structast__filestream.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#a7de986d04c859684e7754ac888e18532">streamid</a>);
<a name="l00899"></a>00899          <a class="code" href="channel_8h.html#abb39926813ff8874f8e453ca04307e53" title="Enable or disable timer ticks for a channel.">ast_settimeout</a>(f-&gt;<a class="code" href="structast__filestream.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>, 0, NULL, NULL);
<a name="l00900"></a>00900       } <span class="keywordflow">else</span> {
<a name="l00901"></a>00901          f-&gt;<a class="code" href="structast__filestream.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#ad224fea293daa62d4fba90f86c3503ee">vstream</a> = NULL;
<a name="l00902"></a>00902          <a class="code" href="sched_8h.html#a25647782014f8dc012994efcd1b81d32" title="a loop construct to ensure that the scheduled task get deleted. The idea is that...">AST_SCHED_DEL</a>(f-&gt;<a class="code" href="structast__filestream.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#aea6233539fc73fc5303bf7525ec27e73">sched</a>, f-&gt;<a class="code" href="structast__filestream.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>-&gt;<a class="code" href="structast__channel.html#a3b898697f8133bfc6b3e23906b7d6877">vstreamid</a>);
<a name="l00903"></a>00903       }
<a name="l00904"></a>00904    }
<a name="l00905"></a>00905 
<a name="l00906"></a>00906    <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(f, -1);
<a name="l00907"></a>00907    <span class="keywordflow">return</span> 0;
<a name="l00908"></a>00908 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aeac4fbc3c21ddf2548bc7ae7fab717f3"></a><!-- doxytag: member="file.h::ast_file_init" ref="aeac4fbc3c21ddf2548bc7ae7fab717f3" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_file_init </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Initialize file stuff</p>
<p>Initializes all the various file stuff. Basically just registers the cli stuff Returns 0 all the time</p>
<p>Provided by <a class="el" href="file_8c.html" title="Generic File Format Support.">file.c</a> </p>

<p>Definition at line <a class="el" href="file_8c_source.html#l01470">1470</a> of file <a class="el" href="file_8c_source.html">file.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, and <a class="el" href="cli_8c_source.html#l01927">ast_cli_register_multiple()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01471"></a>01471 {
<a name="l01472"></a>01472    <a class="code" href="cli_8h.html#aadeef34f3106bb78aeb3414032ad7fb7" title="Register multiple commands.">ast_cli_register_multiple</a>(<a class="code" href="file_8c.html#abaef9acc752363813eb89bb0b72721a7">cli_file</a>, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="file_8c.html#abaef9acc752363813eb89bb0b72721a7">cli_file</a>));
<a name="l01473"></a>01473    <span class="keywordflow">return</span> 0;
<a name="l01474"></a>01474 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aab7814972ae21f8cc68e1d62b97fc88b"></a><!-- doxytag: member="file.h::ast_filecopy" ref="aab7814972ae21f8cc68e1d62b97fc88b" args="(const char *oldname, const char *newname, const char *fmt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_filecopy </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>oldname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>newname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>fmt</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Copies a file. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>oldname</em>&nbsp;</td><td>name of the file you wish to copy (minus <a class="el" href="structextension.html">extension</a>) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>newname</em>&nbsp;</td><td>name you wish the file to be copied to (minus <a class="el" href="structextension.html">extension</a>) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fmt</em>&nbsp;</td><td>the format of the file Copy a given file in a given format, or if fmt is NULL, then do so for all </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="file_8c_source.html#l00938">938</a> of file <a class="el" href="file_8c_source.html">file.c</a>.</p>

<p>References <a class="el" href="file_8c_source.html#l00396">ACTION_COPY</a>, and <a class="el" href="file_8c_source.html#l00408">ast_filehelper()</a>.</p>

<p>Referenced by <a class="el" href="app__voicemail_8c_source.html#l03783">copy_plain_file()</a>, and <a class="el" href="app__voicemail_8c_source.html#l06307">vm_forwardoptions()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00939"></a>00939 {
<a name="l00940"></a>00940    <span class="keywordflow">return</span> <a class="code" href="file_8c.html#ae45ebf66fbe68ddba09480cf2e89ce71" title="perform various actions on a file. Second argument arg2 depends on the command: unused...">ast_filehelper</a>(filename, filename2, fmt, <a class="code" href="file_8c.html#a8944b5bc4c79736a07589a3761113d01a7930542f31154bb3b8a33654af6cfd4f">ACTION_COPY</a>);
<a name="l00941"></a>00941 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="adb15d6efecc1a13b8835bee6d3562ddb"></a><!-- doxytag: member="file.h::ast_filedelete" ref="adb15d6efecc1a13b8835bee6d3562ddb" args="(const char *filename, const char *fmt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_filedelete </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>filename</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>fmt</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Deletes a file. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>filename</em>&nbsp;</td><td>name of the file you wish to delete (minus the <a class="el" href="structextension.html">extension</a>) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fmt</em>&nbsp;</td><td>of the file Delete a given file in a given format, or if fmt is NULL, then do so for all </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="file_8c_source.html#l00928">928</a> of file <a class="el" href="file_8c_source.html">file.c</a>.</p>

<p>References <a class="el" href="file_8c_source.html#l00393">ACTION_DELETE</a>, and <a class="el" href="file_8c_source.html#l00408">ast_filehelper()</a>.</p>

<p>Referenced by <a class="el" href="app_8c_source.html#l00668">__ast_play_and_record()</a>, <a class="el" href="app__meetme_8c_source.html#l01907">announce_thread()</a>, <a class="el" href="res__monitor_8c_source.html#l00148">ast_monitor_start()</a>, <a class="el" href="res__monitor_8c_source.html#l00291">ast_monitor_stop()</a>, <a class="el" href="app__meetme_8c_source.html#l01648">conf_free()</a>, <a class="el" href="app__meetme_8c_source.html#l01998">conf_run()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="res__convert_8c_source.html#l00062">handle_cli_file_convert()</a>, <a class="el" href="app__minivm_8c_source.html#l01604">leave_voicemail()</a>, <a class="el" href="app__voicemail_8c_source.html#l11604">play_record_review()</a>, <a class="el" href="app__record_8c_source.html#l00132">record_exec()</a>, <a class="el" href="app__dial_8c_source.html#l01385">setup_privacy_args()</a>, and <a class="el" href="app__minivm_8c_source.html#l01365">vm_delete()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00929"></a>00929 {
<a name="l00930"></a>00930    <span class="keywordflow">return</span> <a class="code" href="file_8c.html#ae45ebf66fbe68ddba09480cf2e89ce71" title="perform various actions on a file. Second argument arg2 depends on the command: unused...">ast_filehelper</a>(filename, NULL, fmt, <a class="code" href="file_8c.html#a8944b5bc4c79736a07589a3761113d01a92f147f69db5353fd464f636eaf02904">ACTION_DELETE</a>);
<a name="l00931"></a>00931 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab9b8ab8e5ee34c9b4da25779255cafde"></a><!-- doxytag: member="file.h::ast_fileexists" ref="ab9b8ab8e5ee34c9b4da25779255cafde" args="(const char *filename, const char *fmt, const char *preflang)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_fileexists </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>filename</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>preflang</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Checks for the existence of a given file. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>filename</em>&nbsp;</td><td>name of the file you wish to check, minus the <a class="el" href="structextension.html">extension</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fmt</em>&nbsp;</td><td>the format you wish to check (the <a class="el" href="structextension.html">extension</a>) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>preflang</em>&nbsp;</td><td>(the preferred language you wisht to find the file in) See if a given file exists in a given format. If fmt is NULL, any format is accepted. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>-1 if file does not exist, non-zero positive otherwise. </dd></dl>

<p>Definition at line <a class="el" href="file_8c_source.html#l00914">914</a> of file <a class="el" href="file_8c_source.html">file.c</a>.</p>

<p>References <a class="el" href="adsistub_8c_source.html#l00059">buf</a>, and <a class="el" href="file_8c_source.html#l00568">fileexists_core()</a>.</p>

<p>Referenced by <a class="el" href="app__meetme_8c_source.html#l01907">announce_thread()</a>, <a class="el" href="app__followme_8c_source.html#l01003">app_exec()</a>, <a class="el" href="res__musiconhold_8c_source.html#l00256">ast_moh_files_next()</a>, <a class="el" href="res__monitor_8c_source.html#l00148">ast_monitor_start()</a>, <a class="el" href="res__monitor_8c_source.html#l00291">ast_monitor_stop()</a>, <a class="el" href="app__chanspy_8c_source.html#l00767">common_exec()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="app__externalivr_8c_source.html#l00521">eivr_comm()</a>, <a class="el" href="app__voicemail_8c_source.html#l06582">forward_message()</a>, <a class="el" href="app__rpt_8c_source.html#l06349">function_playback()</a>, <a class="el" href="app__minivm_8c_source.html#l01309">invent_message()</a>, <a class="el" href="app__minivm_8c_source.html#l01604">leave_voicemail()</a>, <a class="el" href="app__minivm_8c_source.html#l02157">minivm_delete_exec()</a>, <a class="el" href="app__voicemail_8c_source.html#l07051">play_message()</a>, <a class="el" href="app__voicemail_8c_source.html#l06937">play_message_callerid()</a>, <a class="el" href="app__record_8c_source.html#l00132">record_exec()</a>, <a class="el" href="app__dial_8c_source.html#l02345">retrydial_exec()</a>, <a class="el" href="app__rpt_8c_source.html#l03937">rpt_tele_thread()</a>, <a class="el" href="say_8c_source.html#l00059">say_character_str_full()</a>, <a class="el" href="say_8c_source.html#l00221">say_digit_str_full()</a>, <a class="el" href="say_8c_source.html#l00141">say_phonetic_str_full()</a>, <a class="el" href="app__voicemail_8c_source.html#l11261">sayname()</a>, <a class="el" href="app__rpt_8c_source.html#l03722">saynode()</a>, <a class="el" href="app__dial_8c_source.html#l01385">setup_privacy_args()</a>, <a class="el" href="app__voicemail_8c_source.html#l08323">vm_intro()</a>, <a class="el" href="app__voicemail_8c_source.html#l08493">vm_newuser()</a>, <a class="el" href="app__voicemail_8c_source.html#l08588">vm_options()</a>, and <a class="el" href="app__voicemail_8c_source.html#l08725">vm_tempgreeting()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00915"></a>00915 {
<a name="l00916"></a>00916    <span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>;
<a name="l00917"></a>00917    <span class="keywordtype">int</span> buflen;
<a name="l00918"></a>00918 
<a name="l00919"></a>00919    <span class="keywordflow">if</span> (preflang == NULL)
<a name="l00920"></a>00920       preflang = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00921"></a>00921    buflen = strlen(preflang) + strlen(filename) + 4;  <span class="comment">/* room for everything */</span>
<a name="l00922"></a>00922    buf = alloca(buflen);
<a name="l00923"></a>00923    <span class="keywordflow">if</span> (buf == NULL)
<a name="l00924"></a>00924       <span class="keywordflow">return</span> 0;
<a name="l00925"></a>00925    <span class="keywordflow">return</span> <a class="code" href="file_8c.html#a8306f2512acb0dfd082c61a023cefe0c" title="helper routine to locate a file with a given format and language preference. Try...">fileexists_core</a>(filename, fmt, preflang, buf, buflen);
<a name="l00926"></a>00926 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a57ea6065cde7fb5258c1f6a4595643ba"></a><!-- doxytag: member="file.h::ast_filerename" ref="a57ea6065cde7fb5258c1f6a4595643ba" args="(const char *oldname, const char *newname, const char *fmt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_filerename </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>oldname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>newname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>fmt</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Renames a file. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>oldname</em>&nbsp;</td><td>the name of the file you wish to act upon (minus the <a class="el" href="structextension.html">extension</a>) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>newname</em>&nbsp;</td><td>the name you wish to rename the file to (minus the <a class="el" href="structextension.html">extension</a>) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fmt</em>&nbsp;</td><td>the format of the file Rename a given file in a given format, or if fmt is NULL, then do so for all </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>-1 on failure </dd></dl>

<p>Definition at line <a class="el" href="file_8c_source.html#l00933">933</a> of file <a class="el" href="file_8c_source.html">file.c</a>.</p>

<p>References <a class="el" href="file_8c_source.html#l00394">ACTION_RENAME</a>, and <a class="el" href="file_8c_source.html#l00408">ast_filehelper()</a>.</p>

<p>Referenced by <a class="el" href="app_8c_source.html#l00668">__ast_play_and_record()</a>, <a class="el" href="res__monitor_8c_source.html#l00291">ast_monitor_stop()</a>, <a class="el" href="app__voicemail_8c_source.html#l06582">forward_message()</a>, <a class="el" href="app__voicemail_8c_source.html#l05141">leave_voicemail()</a>, <a class="el" href="app__voicemail_8c_source.html#l11604">play_record_review()</a>, <a class="el" href="app__voicemail_8c_source.html#l03657">rename_file()</a>, and <a class="el" href="app__voicemail_8c_source.html#l06307">vm_forwardoptions()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00934"></a>00934 {
<a name="l00935"></a>00935    <span class="keywordflow">return</span> <a class="code" href="file_8c.html#ae45ebf66fbe68ddba09480cf2e89ce71" title="perform various actions on a file. Second argument arg2 depends on the command: unused...">ast_filehelper</a>(filename, filename2, fmt, <a class="code" href="file_8c.html#a8944b5bc4c79736a07589a3761113d01ae266c94c6d3f3d0940c34c798e5842a6">ACTION_RENAME</a>);
<a name="l00936"></a>00936 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa526fd9bb57d7d9afac2113c30d236f8"></a><!-- doxytag: member="file.h::ast_format_str_reduce" ref="aa526fd9bb57d7d9afac2113c30d236f8" args="(char *fmts)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* ast_format_str_reduce </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>fmts</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Remove duplicate <a class="el" href="structformats.html">formats</a> from a format string.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fmts</em>&nbsp;</td><td>a format string, this string will be modified </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>NULL</em>&nbsp;</td><td>error </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>a pointer to the reduced format string, this is a pointer to fmts </dd></dl>

<p>Definition at line <a class="el" href="file_8c_source.html#l01354">1354</a> of file <a class="el" href="file_8c_source.html">file.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="file_8h_source.html#l00044">AST_MAX_FORMATS</a>, <a class="el" href="linkedlists_8h_source.html#l00077">AST_RWLIST_RDLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00493">AST_RWLIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="mod__format_8h_source.html#l00045">ast_format::exts</a>, <a class="el" href="file_8c_source.html#l00276">exts_compare()</a>, <a class="el" href="format__g726_8c_source.html#l00177">f</a>, <a class="el" href="devicestate_8c_source.html#l00198">first</a>, <a class="el" href="func__strings_8c_source.html#l00821">len()</a>, <a class="el" href="structast__format.html#ad0c8f8a1ef89f35f7f1fcce75787632f">ast_format::list</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="agi_2strcompat_8c_source.html#l00027">strsep()</a>, and <a class="el" href="evt_8c_source.html#l00071">type</a>.</p>

<p>Referenced by <a class="el" href="app__voicemail_8c_source.html#l10603">load_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01355"></a>01355 {
<a name="l01356"></a>01356    <span class="keyword">struct </span><a class="code" href="structast__format.html" title="Each supported file format is described by the following structure.">ast_format</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l01357"></a>01357    <span class="keyword">struct </span><a class="code" href="structast__format.html" title="Each supported file format is described by the following structure.">ast_format</a> *fmts_ptr[<a class="code" href="file_8h.html#aa932272aad0c1610b79e9b04e54e57ea">AST_MAX_FORMATS</a>];
<a name="l01358"></a>01358    <span class="keywordtype">char</span> *fmts_str[<a class="code" href="file_8h.html#aa932272aad0c1610b79e9b04e54e57ea">AST_MAX_FORMATS</a>];
<a name="l01359"></a>01359    <span class="keywordtype">char</span> *stringp, *<a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>;
<a name="l01360"></a>01360    <span class="keywordtype">char</span> *orig = fmts;
<a name="l01361"></a>01361    <span class="keywordtype">int</span> i, j, x, <a class="code" href="devicestate_8c.html#abd2135e6f8a41bc900933b1985d97165">first</a>, found = 0;
<a name="l01362"></a>01362    <span class="keywordtype">int</span> <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> = strlen(fmts) + 1;
<a name="l01363"></a>01363    <span class="keywordtype">int</span> res;
<a name="l01364"></a>01364 
<a name="l01365"></a>01365    <span class="keywordflow">if</span> (<a class="code" href="linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc" title="Read locks a list.">AST_RWLIST_RDLOCK</a>(&amp;<a class="code" href="structformats.html">formats</a>)) {
<a name="l01366"></a>01366       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to lock format list\n&quot;</span>);
<a name="l01367"></a>01367       <span class="keywordflow">return</span> NULL;
<a name="l01368"></a>01368    }
<a name="l01369"></a>01369 
<a name="l01370"></a>01370    stringp = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(fmts);
<a name="l01371"></a>01371 
<a name="l01372"></a>01372    <span class="keywordflow">for</span> (x = 0; (type = <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;stringp, <span class="stringliteral">&quot;|&quot;</span>)) &amp;&amp; x &lt; <a class="code" href="file_8h.html#aa932272aad0c1610b79e9b04e54e57ea">AST_MAX_FORMATS</a>; x++) {
<a name="l01373"></a>01373       <a class="code" href="linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;<a class="code" href="structformats.html">formats</a>, f, <a class="code" href="structast__format.html#ad0c8f8a1ef89f35f7f1fcce75787632f">list</a>) {
<a name="l01374"></a>01374          <span class="keywordflow">if</span> (<a class="code" href="file_8c.html#a553ad7eb5306fd161fae25fa17c665ef">exts_compare</a>(f-&gt;<a class="code" href="structast__format.html#ade71f534a49925f1955a1598556219e2">exts</a>, type)) {
<a name="l01375"></a>01375             found = 1;
<a name="l01376"></a>01376             <span class="keywordflow">break</span>;
<a name="l01377"></a>01377          }
<a name="l01378"></a>01378       }
<a name="l01379"></a>01379 
<a name="l01380"></a>01380       fmts_str[x] = type;
<a name="l01381"></a>01381       <span class="keywordflow">if</span> (found) {
<a name="l01382"></a>01382          fmts_ptr[x] = f;
<a name="l01383"></a>01383       } <span class="keywordflow">else</span> {
<a name="l01384"></a>01384          fmts_ptr[x] = NULL;
<a name="l01385"></a>01385       }
<a name="l01386"></a>01386    }
<a name="l01387"></a>01387    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structformats.html">formats</a>);
<a name="l01388"></a>01388 
<a name="l01389"></a>01389    first = 1;
<a name="l01390"></a>01390    <span class="keywordflow">for</span> (i = 0; i &lt; x; i++) {
<a name="l01391"></a>01391       <span class="comment">/* ignore invalid entries */</span>
<a name="l01392"></a>01392       <span class="keywordflow">if</span> (!fmts_ptr[i]) {
<a name="l01393"></a>01393          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;ignoring unknown format &apos;%s&apos;\n&quot;</span>, fmts_str[i]);
<a name="l01394"></a>01394          <span class="keywordflow">continue</span>;
<a name="l01395"></a>01395       }
<a name="l01396"></a>01396 
<a name="l01397"></a>01397       <span class="comment">/* special handling for the first entry */</span>
<a name="l01398"></a>01398       <span class="keywordflow">if</span> (first) {
<a name="l01399"></a>01399          res = snprintf(fmts, len, <span class="stringliteral">&quot;%s&quot;</span>, fmts_str[i]);
<a name="l01400"></a>01400          fmts += res;
<a name="l01401"></a>01401          len -= res;
<a name="l01402"></a>01402          first = 0;
<a name="l01403"></a>01403          <span class="keywordflow">continue</span>;
<a name="l01404"></a>01404       }
<a name="l01405"></a>01405 
<a name="l01406"></a>01406       found = 0;
<a name="l01407"></a>01407       <span class="keywordflow">for</span> (j = 0; j &lt; i; j++) {
<a name="l01408"></a>01408          <span class="comment">/* this is a duplicate */</span>
<a name="l01409"></a>01409          <span class="keywordflow">if</span> (fmts_ptr[j] == fmts_ptr[i]) {
<a name="l01410"></a>01410             found = 1;
<a name="l01411"></a>01411             <span class="keywordflow">break</span>;
<a name="l01412"></a>01412          }
<a name="l01413"></a>01413       }
<a name="l01414"></a>01414 
<a name="l01415"></a>01415       <span class="keywordflow">if</span> (!found) {
<a name="l01416"></a>01416          res = snprintf(fmts, len, <span class="stringliteral">&quot;|%s&quot;</span>, fmts_str[i]);
<a name="l01417"></a>01417          fmts += res;
<a name="l01418"></a>01418          len -= res;
<a name="l01419"></a>01419       }
<a name="l01420"></a>01420    }
<a name="l01421"></a>01421 
<a name="l01422"></a>01422    <span class="keywordflow">if</span> (first) {
<a name="l01423"></a>01423       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;no known formats found in format list (%s)\n&quot;</span>, orig);
<a name="l01424"></a>01424       <span class="keywordflow">return</span> NULL;
<a name="l01425"></a>01425    }
<a name="l01426"></a>01426 
<a name="l01427"></a>01427    <span class="keywordflow">return</span> orig;
<a name="l01428"></a>01428 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad85c951fa1d6988d2d7e169833a951a8"></a><!-- doxytag: member="file.h::ast_openstream" ref="ad85c951fa1d6988d2d7e169833a951a8" args="(struct ast_channel *chan, const char *filename, const char *preflang)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__filestream.html">ast_filestream</a>* ast_openstream </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>filename</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>preflang</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Opens stream for use in seeking, playing. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>channel to work with </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>filename</em>&nbsp;</td><td>to use </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>preflang</em>&nbsp;</td><td>prefered language to use </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>a</em>&nbsp;</td><td><a class="el" href="structast__filestream.html" title="This structure is allocated by file.c in one chunk, together with buf_size and desc_size...">ast_filestream</a> pointer if it opens the file. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>NULL</em>&nbsp;</td><td>on error. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="file_8c_source.html#l00619">619</a> of file <a class="el" href="file_8c_source.html">file.c</a>.</p>

<p>References <a class="el" href="file_8c_source.html#l00624">ast_openstream_full()</a>.</p>

<p>Referenced by <a class="el" href="file_8c_source.html#l00943">ast_streamfile()</a>, <a class="el" href="app__dictate_8c_source.html#l00084">dictate_exec()</a>, <a class="el" href="res__agi_8c_source.html#l01239">handle_getoption()</a>, <a class="el" href="res__agi_8c_source.html#l01189">handle_streamfile()</a>, and <a class="el" href="app__speech__utils_8c_source.html#l00615">speech_streamfile()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00620"></a>00620 {
<a name="l00621"></a>00621    <span class="keywordflow">return</span> <a class="code" href="file_8h.html#ae2d6dfeafd18a99d47195178cd752a3d" title="Opens stream for use in seeking, playing.">ast_openstream_full</a>(chan, filename, preflang, 0);
<a name="l00622"></a>00622 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae2d6dfeafd18a99d47195178cd752a3d"></a><!-- doxytag: member="file.h::ast_openstream_full" ref="ae2d6dfeafd18a99d47195178cd752a3d" args="(struct ast_channel *chan, const char *filename, const char *preflang, int asis)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__filestream.html">ast_filestream</a>* ast_openstream_full </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>filename</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>preflang</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>asis</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Opens stream for use in seeking, playing. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>channel to work with </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>filename</em>&nbsp;</td><td>to use </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>preflang</em>&nbsp;</td><td>prefered language to use </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>asis</em>&nbsp;</td><td>if set, don't clear generators </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>a</em>&nbsp;</td><td><a class="el" href="structast__filestream.html" title="This structure is allocated by file.c in one chunk, together with buf_size and desc_size...">ast_filestream</a> pointer if it opens the file. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>NULL</em>&nbsp;</td><td>on error. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="file_8c_source.html#l00624">624</a> of file <a class="el" href="file_8c_source.html">file.c</a>.</p>

<p>References <a class="el" href="file_8c_source.html#l00395">ACTION_OPEN</a>, <a class="el" href="channel_8c_source.html#l01956">ast_deactivate_generator()</a>, <a class="el" href="file_8c_source.html#l00408">ast_filehelper()</a>, <a class="el" href="frame_8h_source.html#l00273">AST_FORMAT_AUDIO_MASK</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8c_source.html#l03737">ast_set_write_format()</a>, <a class="el" href="file_8c_source.html#l00122">ast_stopstream()</a>, <a class="el" href="adsistub_8c_source.html#l00059">buf</a>, <a class="el" href="file_8c_source.html#l00568">fileexists_core()</a>, <a class="el" href="channel_8h_source.html#l00404">ast_channel::generator</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="channel_8h_source.html#l00467">ast_channel::oldwriteformat</a>, <a class="el" href="channel_8h_source.html#l00414">ast_channel::stream</a>, and <a class="el" href="channel_8h_source.html#l00484">ast_channel::writeformat</a>.</p>

<p>Referenced by <a class="el" href="res__musiconhold_8c_source.html#l00256">ast_moh_files_next()</a>, <a class="el" href="file_8c_source.html#l00619">ast_openstream()</a>, and <a class="el" href="app__externalivr_8c_source.html#l00161">gen_nextfile()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00625"></a>00625 {
<a name="l00626"></a>00626    <span class="comment">/* </span>
<a name="l00627"></a>00627 <span class="comment">    * Use fileexists_core() to find a file in a compatible</span>
<a name="l00628"></a>00628 <span class="comment">    * language and format, set up a suitable translator,</span>
<a name="l00629"></a>00629 <span class="comment">    * and open the stream.</span>
<a name="l00630"></a>00630 <span class="comment">    */</span>
<a name="l00631"></a>00631    <span class="keywordtype">int</span> fmts, res, buflen;
<a name="l00632"></a>00632    <span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>;
<a name="l00633"></a>00633 
<a name="l00634"></a>00634    <span class="keywordflow">if</span> (!asis) {
<a name="l00635"></a>00635       <span class="comment">/* do this first, otherwise we detect the wrong writeformat */</span>
<a name="l00636"></a>00636       <a class="code" href="file_8h.html#a3092bf11d4bba66f646562759608b1bc" title="Stops a stream.">ast_stopstream</a>(chan);
<a name="l00637"></a>00637       <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a4e855ab0f984741b9083b2c5a0fdfe18">generator</a>)
<a name="l00638"></a>00638          <a class="code" href="channel_8h.html#a7160355005776732fba88cc020f4a45b">ast_deactivate_generator</a>(chan);
<a name="l00639"></a>00639    }
<a name="l00640"></a>00640    <span class="keywordflow">if</span> (preflang == NULL)
<a name="l00641"></a>00641       preflang = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00642"></a>00642    buflen = strlen(preflang) + strlen(filename) + 4;
<a name="l00643"></a>00643    buf = alloca(buflen);
<a name="l00644"></a>00644    <span class="keywordflow">if</span> (buf == NULL)
<a name="l00645"></a>00645       <span class="keywordflow">return</span> NULL;
<a name="l00646"></a>00646    fmts = <a class="code" href="file_8c.html#a8306f2512acb0dfd082c61a023cefe0c" title="helper routine to locate a file with a given format and language preference. Try...">fileexists_core</a>(filename, NULL, preflang, buf, buflen);
<a name="l00647"></a>00647    <span class="keywordflow">if</span> (fmts &gt; 0)
<a name="l00648"></a>00648       fmts &amp;= <a class="code" href="frame_8h.html#a3f680b9c15596de927d507a664fd2803">AST_FORMAT_AUDIO_MASK</a>;
<a name="l00649"></a>00649    <span class="keywordflow">if</span> (fmts &lt; 1) {
<a name="l00650"></a>00650       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;File %s does not exist in any format\n&quot;</span>, filename);
<a name="l00651"></a>00651       <span class="keywordflow">return</span> NULL;
<a name="l00652"></a>00652    }
<a name="l00653"></a>00653    chan-&gt;<a class="code" href="structast__channel.html#a8668180049a7ed4e28b17842144e6d05">oldwriteformat</a> = chan-&gt;<a class="code" href="structast__channel.html#a00f5ce2ad53ff8523f8e46ea5aceba48">writeformat</a>;
<a name="l00654"></a>00654    <span class="comment">/* Set the channel to a format we can work with */</span>
<a name="l00655"></a>00655    res = <a class="code" href="channel_8h.html#a978161a52d98fdaee374d1f6e1359544" title="Sets write format on channel chan Set write format for channel to whichever component...">ast_set_write_format</a>(chan, fmts);
<a name="l00656"></a>00656    res = <a class="code" href="file_8c.html#ae45ebf66fbe68ddba09480cf2e89ce71" title="perform various actions on a file. Second argument arg2 depends on the command: unused...">ast_filehelper</a>(buf, chan, NULL, <a class="code" href="file_8c.html#a8944b5bc4c79736a07589a3761113d01a04bda3b7d3fbe904b2d0c85602e73cc7">ACTION_OPEN</a>);
<a name="l00657"></a>00657    <span class="keywordflow">if</span> (res &gt;= 0)
<a name="l00658"></a>00658       <span class="keywordflow">return</span> chan-&gt;<a class="code" href="structast__channel.html#a016ccfa2a88444ffde0ad0168a0f231d">stream</a>;
<a name="l00659"></a>00659    <span class="keywordflow">return</span> NULL;
<a name="l00660"></a>00660 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aeed49fff2d6008a89f996230988d944d"></a><!-- doxytag: member="file.h::ast_openvstream" ref="aeed49fff2d6008a89f996230988d944d" args="(struct ast_channel *chan, const char *filename, const char *preflang)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__filestream.html">ast_filestream</a>* ast_openvstream </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>filename</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>preflang</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Opens stream for use in seeking, playing. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>channel to work with </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>filename</em>&nbsp;</td><td>to use </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>preflang</em>&nbsp;</td><td>prefered language to use </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>a</em>&nbsp;</td><td><a class="el" href="structast__filestream.html" title="This structure is allocated by file.c in one chunk, together with buf_size and desc_size...">ast_filestream</a> pointer if it opens the file. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>NULL</em>&nbsp;</td><td>on error. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="file_8c_source.html#l00662">662</a> of file <a class="el" href="file_8c_source.html">file.c</a>.</p>

<p>References <a class="el" href="file_8c_source.html#l00395">ACTION_OPEN</a>, <a class="el" href="file_8c_source.html#l00408">ast_filehelper()</a>, <a class="el" href="frame_8h_source.html#l00273">AST_FORMAT_AUDIO_MASK</a>, <a class="el" href="frame_8h_source.html#l00288">AST_FORMAT_VIDEO_MASK</a>, <a class="el" href="frame_8c_source.html#l00573">ast_getformatname()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="adsistub_8c_source.html#l00059">buf</a>, <a class="el" href="file_8c_source.html#l00568">fileexists_core()</a>, <a class="el" href="mod__format_8h_source.html#l00102">ast_filestream::fmt</a>, <a class="el" href="cdr__custom_8c_source.html#l00058">format</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="channel_8h_source.html#l00482">ast_channel::nativeformats</a>, and <a class="el" href="channel_8h_source.html#l00415">ast_channel::vstream</a>.</p>

<p>Referenced by <a class="el" href="file_8c_source.html#l00943">ast_streamfile()</a>, <a class="el" href="res__agi_8c_source.html#l01239">handle_getoption()</a>, and <a class="el" href="res__agi_8c_source.html#l01189">handle_streamfile()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00663"></a>00663 {
<a name="l00664"></a>00664    <span class="comment">/* As above, but for video. But here we don&apos;t have translators</span>
<a name="l00665"></a>00665 <span class="comment">    * so we must enforce a format.</span>
<a name="l00666"></a>00666 <span class="comment">    */</span>
<a name="l00667"></a>00667    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>;
<a name="l00668"></a>00668    <span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>;
<a name="l00669"></a>00669    <span class="keywordtype">int</span> buflen;
<a name="l00670"></a>00670 
<a name="l00671"></a>00671    <span class="keywordflow">if</span> (preflang == NULL)
<a name="l00672"></a>00672       preflang = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00673"></a>00673    buflen = strlen(preflang) + strlen(filename) + 4;
<a name="l00674"></a>00674    buf = alloca(buflen);
<a name="l00675"></a>00675    <span class="keywordflow">if</span> (buf == NULL)
<a name="l00676"></a>00676       <span class="keywordflow">return</span> NULL;
<a name="l00677"></a>00677 
<a name="l00678"></a>00678    <span class="keywordflow">for</span> (format = <a class="code" href="frame_8h.html#a3f680b9c15596de927d507a664fd2803">AST_FORMAT_AUDIO_MASK</a> + 1; format &lt;= <a class="code" href="frame_8h.html#ad048231af8a6271706585e3c8630dc69">AST_FORMAT_VIDEO_MASK</a>; format = format &lt;&lt; 1) {
<a name="l00679"></a>00679       <span class="keywordtype">int</span> fd;
<a name="l00680"></a>00680       <span class="keyword">const</span> <span class="keywordtype">char</span> *fmt;
<a name="l00681"></a>00681 
<a name="l00682"></a>00682       <span class="keywordflow">if</span> (!(chan-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a> &amp; format))
<a name="l00683"></a>00683          <span class="keywordflow">continue</span>;
<a name="l00684"></a>00684       fmt = <a class="code" href="frame_8h.html#afe8f690984f8ba95cd01a431198c10bf" title="Get the name of a format.">ast_getformatname</a>(format);
<a name="l00685"></a>00685       <span class="keywordflow">if</span> ( <a class="code" href="file_8c.html#a8306f2512acb0dfd082c61a023cefe0c" title="helper routine to locate a file with a given format and language preference. Try...">fileexists_core</a>(filename, fmt, preflang, buf, buflen) &lt; 1)   <span class="comment">/* no valid format */</span>
<a name="l00686"></a>00686          <span class="keywordflow">continue</span>;
<a name="l00687"></a>00687       fd = <a class="code" href="file_8c.html#ae45ebf66fbe68ddba09480cf2e89ce71" title="perform various actions on a file. Second argument arg2 depends on the command: unused...">ast_filehelper</a>(buf, chan, fmt, <a class="code" href="file_8c.html#a8944b5bc4c79736a07589a3761113d01a04bda3b7d3fbe904b2d0c85602e73cc7">ACTION_OPEN</a>);
<a name="l00688"></a>00688       <span class="keywordflow">if</span> (fd &gt;= 0)
<a name="l00689"></a>00689          <span class="keywordflow">return</span> chan-&gt;<a class="code" href="structast__channel.html#ad224fea293daa62d4fba90f86c3503ee">vstream</a>;
<a name="l00690"></a>00690       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;File %s has video but couldn&apos;t be opened\n&quot;</span>, filename);
<a name="l00691"></a>00691    }
<a name="l00692"></a>00692    <span class="keywordflow">return</span> NULL;
<a name="l00693"></a>00693 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad59224750b8b617f9590b28b88457b14"></a><!-- doxytag: member="file.h::ast_playstream" ref="ad59224750b8b617f9590b28b88457b14" args="(struct ast_filestream *s)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_playstream </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__filestream.html">ast_filestream</a> *&nbsp;</td>
          <td class="paramname"> <em>s</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Play a open stream on a channel. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>s</em>&nbsp;</td><td>filestream to play </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="file_8c_source.html#l00850">850</a> of file <a class="el" href="file_8c_source.html">file.c</a>.</p>

<p>References <a class="el" href="frame_8h_source.html#l00273">AST_FORMAT_AUDIO_MASK</a>, <a class="el" href="file_8c_source.html#l00735">ast_readaudio_callback()</a>, <a class="el" href="file_8c_source.html#l00799">ast_readvideo_callback()</a>, <a class="el" href="mod__format_8h_source.html#l00102">ast_filestream::fmt</a>, <a class="el" href="mod__format_8h_source.html#l00047">ast_format::format</a>, and <a class="el" href="file_8c_source.html#l00728">FSREAD_FAILURE</a>.</p>

<p>Referenced by <a class="el" href="file_8c_source.html#l00943">ast_streamfile()</a>, <a class="el" href="res__agi_8c_source.html#l01239">handle_getoption()</a>, <a class="el" href="res__agi_8c_source.html#l01189">handle_streamfile()</a>, and <a class="el" href="app__speech__utils_8c_source.html#l00615">speech_streamfile()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00851"></a>00851 {
<a name="l00852"></a>00852    <span class="keyword">enum</span> <a class="code" href="file_8c.html#a0245c792fdf4fe895383125a79000fa7">fsread_res</a> res;
<a name="l00853"></a>00853 
<a name="l00854"></a>00854    <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structast__filestream.html#af4e7a9f36c380991c59c9a49122de100">fmt</a>-&gt;<a class="code" href="structast__format.html#a317afff57d87a89158c2b038d37b2b08">format</a> &amp; <a class="code" href="frame_8h.html#a3f680b9c15596de927d507a664fd2803">AST_FORMAT_AUDIO_MASK</a>)
<a name="l00855"></a>00855       res = <a class="code" href="file_8c.html#aa6782e0130a721c4eeb51d2d10d791f8">ast_readaudio_callback</a>(s);
<a name="l00856"></a>00856    <span class="keywordflow">else</span>
<a name="l00857"></a>00857       res = <a class="code" href="file_8c.html#af8b623c146b07dbc4a96be4d8adbcfc4">ast_readvideo_callback</a>(s);
<a name="l00858"></a>00858 
<a name="l00859"></a>00859    <span class="keywordflow">return</span> (res == <a class="code" href="file_8c.html#a0245c792fdf4fe895383125a79000fa7a51689576f6677be835337676977f6d3b">FSREAD_FAILURE</a>) ? -1 : 0;
<a name="l00860"></a>00860 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad572060ea434390db3d1ccde4511dfcd"></a><!-- doxytag: member="file.h::ast_readfile" ref="ad572060ea434390db3d1ccde4511dfcd" args="(const char *filename, const char *type, const char *comment, int flags, int check, mode_t mode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__filestream.html">ast_filestream</a>* ast_readfile </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>filename</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>comment</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>check</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">mode_t&nbsp;</td>
          <td class="paramname"> <em>mode</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Starts reading from a file. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>filename</em>&nbsp;</td><td>the name of the file to read from </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>type</em>&nbsp;</td><td>format of file you wish to read from </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>comment</em>&nbsp;</td><td>comment to go with </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>flags</em>&nbsp;</td><td>file flags </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>check</em>&nbsp;</td><td>(unimplemented, hence negligible) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>mode</em>&nbsp;</td><td>Open mode Open an incoming file stream. flags are flags for the open() command, and if check is non-zero, then it will not read a file if there are any files that start with that name and have an <a class="el" href="structextension.html">extension</a> Please note, this is a blocking function. Program execution will not return until ast_waitstream completes it's execution. </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>a</em>&nbsp;</td><td>struct <a class="el" href="structast__filestream.html" title="This structure is allocated by file.c in one chunk, together with buf_size and desc_size...">ast_filestream</a> on success. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>NULL</em>&nbsp;</td><td>on failure. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="file_8c_source.html#l00985">985</a> of file <a class="el" href="file_8c_source.html">file.c</a>.</p>

<p>References <a class="el" href="file_8c_source.html#l00887">ast_closestream()</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="linkedlists_8h_source.html#l00077">AST_RWLIST_RDLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00493">AST_RWLIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="file_8c_source.html#l00252">build_filename()</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="mod__format_8h_source.html#l00045">ast_format::exts</a>, <a class="el" href="file_8c_source.html#l00276">exts_compare()</a>, <a class="el" href="format__g726_8c_source.html#l00177">f</a>, <a class="el" href="mod__format_8h_source.html#l00105">ast_filestream::filename</a>, <a class="el" href="mod__format_8h_source.html#l00103">ast_filestream::flags</a>, <a class="el" href="mod__format_8h_source.html#l00102">ast_filestream::fmt</a>, <a class="el" href="file_8c_source.html#l00339">get_filestream()</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="mod__format_8h_source.html#l00104">ast_filestream::mode</a>, <a class="el" href="file_8c_source.html#l00386">open_wrapper()</a>, <a class="el" href="mod__format_8h_source.html#l00110">ast_filestream::trans</a>, and <a class="el" href="mod__format_8h_source.html#l00108">ast_filestream::vfs</a>.</p>

<p>Referenced by <a class="el" href="app_8c_source.html#l00668">__ast_play_and_record()</a>, and <a class="el" href="res__convert_8c_source.html#l00062">handle_cli_file_convert()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00986"></a>00986 {
<a name="l00987"></a>00987    FILE *bfile;
<a name="l00988"></a>00988    <span class="keyword">struct </span><a class="code" href="structast__format.html" title="Each supported file format is described by the following structure.">ast_format</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l00989"></a>00989    <span class="keyword">struct </span><a class="code" href="structast__filestream.html" title="This structure is allocated by file.c in one chunk, together with buf_size and desc_size...">ast_filestream</a> *fs = NULL;
<a name="l00990"></a>00990    <span class="keywordtype">char</span> *fn;
<a name="l00991"></a>00991    <span class="keywordtype">int</span> format_found = 0;   
<a name="l00992"></a>00992 
<a name="l00993"></a>00993    <a class="code" href="linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc" title="Read locks a list.">AST_RWLIST_RDLOCK</a>(&amp;<a class="code" href="structformats.html">formats</a>);
<a name="l00994"></a>00994 
<a name="l00995"></a>00995    <a class="code" href="linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;<a class="code" href="structformats.html">formats</a>, f, list) {
<a name="l00996"></a>00996       fs = NULL;
<a name="l00997"></a>00997       <span class="keywordflow">if</span> (!<a class="code" href="file_8c.html#a553ad7eb5306fd161fae25fa17c665ef">exts_compare</a>(f-&gt;<a class="code" href="structast__format.html#ade71f534a49925f1955a1598556219e2">exts</a>, <a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>))
<a name="l00998"></a>00998          <span class="keywordflow">continue</span>;
<a name="l00999"></a>00999       <span class="keywordflow">else</span> 
<a name="l01000"></a>01000          format_found = 1;
<a name="l01001"></a>01001 
<a name="l01002"></a>01002       fn = <a class="code" href="file_8c.html#a2a836416f6627399f3b75ef2705bcd89" title="construct a filename. Absolute pathnames are preserved, relative names are prefixed...">build_filename</a>(<a class="code" href="structast__filestream.html#aeac90097f29f7529968697163cea5c18">filename</a>, <a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>);
<a name="l01003"></a>01003       <a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> = 0;
<a name="l01004"></a>01004       bfile = fopen(fn, <span class="stringliteral">&quot;r&quot;</span>);
<a name="l01005"></a>01005 
<a name="l01006"></a>01006       <span class="keywordflow">if</span> (!bfile || (fs = <a class="code" href="file_8c.html#a6c638cbfc5c6d1f62231935f80a8986a">get_filestream</a>(f, bfile)) == NULL || <a class="code" href="file_8c.html#ac17ab5a9432e8fbe75d7968221897716">open_wrapper</a>(fs) ) {
<a name="l01007"></a>01007          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to open %s\n&quot;</span>, fn);
<a name="l01008"></a>01008          <span class="keywordflow">if</span> (fs) {
<a name="l01009"></a>01009             <a class="code" href="file_8h.html#ab53bd2c3c55d509790c7f7620aac6373" title="Closes a stream.">ast_closestream</a>(fs);
<a name="l01010"></a>01010          }
<a name="l01011"></a>01011          fs = NULL;
<a name="l01012"></a>01012          bfile = NULL;
<a name="l01013"></a>01013          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(fn);
<a name="l01014"></a>01014          <span class="keywordflow">break</span>;            
<a name="l01015"></a>01015       }
<a name="l01016"></a>01016       <span class="comment">/* found it */</span>
<a name="l01017"></a>01017       fs-&gt;<a class="code" href="structast__filestream.html#ad98134a98f3e3e3b5611a5fd2117e8e4">trans</a> = NULL;
<a name="l01018"></a>01018       fs-&gt;<a class="code" href="structast__filestream.html#af4e7a9f36c380991c59c9a49122de100">fmt</a> = f;
<a name="l01019"></a>01019       fs-&gt;<a class="code" href="structast__filestream.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> = <a class="code" href="structast__filestream.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a>;
<a name="l01020"></a>01020       fs-&gt;<a class="code" href="structast__filestream.html#adc8d3cf511ceb277aea0cfa1cd027c59">mode</a> = <a class="code" href="structast__filestream.html#adc8d3cf511ceb277aea0cfa1cd027c59">mode</a>;
<a name="l01021"></a>01021       fs-&gt;<a class="code" href="structast__filestream.html#aeac90097f29f7529968697163cea5c18">filename</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(<a class="code" href="structast__filestream.html#aeac90097f29f7529968697163cea5c18">filename</a>);
<a name="l01022"></a>01022       fs-&gt;<a class="code" href="structast__filestream.html#a084d8f087c50442f51245ec3333abac4">vfs</a> = NULL;
<a name="l01023"></a>01023       <span class="keywordflow">break</span>;
<a name="l01024"></a>01024    }
<a name="l01025"></a>01025 
<a name="l01026"></a>01026    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structformats.html">formats</a>);
<a name="l01027"></a>01027    <span class="keywordflow">if</span> (!format_found)
<a name="l01028"></a>01028       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No such format &apos;%s&apos;\n&quot;</span>, <a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>);
<a name="l01029"></a>01029 
<a name="l01030"></a>01030    <span class="keywordflow">return</span> fs;
<a name="l01031"></a>01031 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a962bc31d7a953b0a0290c72b168d41a7"></a><!-- doxytag: member="file.h::ast_readframe" ref="a962bc31d7a953b0a0290c72b168d41a7" args="(struct ast_filestream *s)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__frame.html">ast_frame</a>* ast_readframe </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__filestream.html">ast_filestream</a> *&nbsp;</td>
          <td class="paramname"> <em>s</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Read a frame from a filestream. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>s</em>&nbsp;</td><td><a class="el" href="structast__filestream.html" title="This structure is allocated by file.c in one chunk, together with buf_size and desc_size...">ast_filestream</a> to act on </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>a frame. </dd></dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>NULL</em>&nbsp;</td><td>if read failed. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="file_8c_source.html#l00720">720</a> of file <a class="el" href="file_8c_source.html">file.c</a>.</p>

<p>References <a class="el" href="file_8c_source.html#l00695">read_frame()</a>.</p>

<p>Referenced by <a class="el" href="app_8c_source.html#l00668">__ast_play_and_record()</a>, <a class="el" href="app__dictate_8c_source.html#l00084">dictate_exec()</a>, <a class="el" href="app__externalivr_8c_source.html#l00192">gen_readframe()</a>, <a class="el" href="res__convert_8c_source.html#l00062">handle_cli_file_convert()</a>, and <a class="el" href="res__musiconhold_8c_source.html#l00311">moh_files_readframe()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00721"></a>00721 {
<a name="l00722"></a>00722    <span class="keywordtype">int</span> whennext = 0;
<a name="l00723"></a>00723 
<a name="l00724"></a>00724    <span class="keywordflow">return</span> <a class="code" href="file_8c.html#a3d11f27997994d366d52d54a084ec944">read_frame</a>(s, &amp;whennext);
<a name="l00725"></a>00725 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a36f6bba05952162d5d1ee7fb9819bd07"></a><!-- doxytag: member="file.h::ast_seekstream" ref="a36f6bba05952162d5d1ee7fb9819bd07" args="(struct ast_filestream *fs, off_t sample_offset, int whence)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_seekstream </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__filestream.html">ast_filestream</a> *&nbsp;</td>
          <td class="paramname"> <em>fs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">off_t&nbsp;</td>
          <td class="paramname"> <em>sample_offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>whence</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Seeks into stream. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fs</em>&nbsp;</td><td><a class="el" href="structast__filestream.html" title="This structure is allocated by file.c in one chunk, together with buf_size and desc_size...">ast_filestream</a> to perform seek on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>sample_offset</em>&nbsp;</td><td>numbers of samples to seek </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>whence</em>&nbsp;</td><td>SEEK_SET, SEEK_CUR, SEEK_END </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="file_8c_source.html#l00862">862</a> of file <a class="el" href="file_8c_source.html">file.c</a>.</p>

<p>References <a class="el" href="mod__format_8h_source.html#l00102">ast_filestream::fmt</a>, and <a class="el" href="structast__format.html#ace04d77265c68620f1f1f7c2c4eb4123">ast_format::seek</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l02636">__ast_read()</a>, <a class="el" href="app_8c_source.html#l00496">ast_control_streamfile()</a>, <a class="el" href="res__musiconhold_8c_source.html#l00256">ast_moh_files_next()</a>, <a class="el" href="file_8c_source.html#l00877">ast_stream_fastforward()</a>, <a class="el" href="file_8c_source.html#l00882">ast_stream_rewind()</a>, <a class="el" href="file_8c_source.html#l00943">ast_streamfile()</a>, <a class="el" href="channel_8c_source.html#l03411">ast_write()</a>, <a class="el" href="app__dictate_8c_source.html#l00084">dictate_exec()</a>, <a class="el" href="res__agi_8c_source.html#l01239">handle_getoption()</a>, <a class="el" href="res__agi_8c_source.html#l01494">handle_recordfile()</a>, <a class="el" href="res__agi_8c_source.html#l01189">handle_streamfile()</a>, and <a class="el" href="res__agi_8c_source.html#l02118">speech_streamfile()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00863"></a>00863 {
<a name="l00864"></a>00864    <span class="keywordflow">return</span> fs-&gt;<a class="code" href="structast__filestream.html#af4e7a9f36c380991c59c9a49122de100">fmt</a>-&gt;<a class="code" href="structast__format.html#ace04d77265c68620f1f1f7c2c4eb4123">seek</a>(fs, sample_offset, whence);
<a name="l00865"></a>00865 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3092bf11d4bba66f646562759608b1bc"></a><!-- doxytag: member="file.h::ast_stopstream" ref="a3092bf11d4bba66f646562759608b1bc" args="(struct ast_channel *c)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_stopstream </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Stops a stream. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>c</em>&nbsp;</td><td>The channel you wish to stop playback on</td></tr>
  </table>
  </dd>
</dl>
<p>Stop playback of a stream</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>always</td></tr>
  </table>
  </dd>
</dl>
<dl class="note"><dt><b>Note:</b></dt><dd>The channel does not need to be locked before calling this function. </dd></dl>

<p>Definition at line <a class="el" href="file_8c_source.html#l00122">122</a> of file <a class="el" href="file_8c_source.html">file.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l02031">ast_channel_lock</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="file_8c_source.html#l00887">ast_closestream()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8c_source.html#l03737">ast_set_write_format()</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="channel_8h_source.html#l00467">ast_channel::oldwriteformat</a>, <a class="el" href="channel_8h_source.html#l00414">ast_channel::stream</a>, and <a class="el" href="channel_8h_source.html#l00415">ast_channel::vstream</a>.</p>

<p>Referenced by <a class="el" href="res__adsi_8c_source.html#l00341">_ast_adsi_transmit_message_full()</a>, <a class="el" href="app_8c_source.html#l00496">ast_control_streamfile()</a>, <a class="el" href="file_8c_source.html#l00624">ast_openstream_full()</a>, <a class="el" href="app_8c_source.html#l00634">ast_play_and_wait()</a>, <a class="el" href="channel_8c_source.html#l04093">ast_readstring_full()</a>, <a class="el" href="say_8c_source.html#l02669">ast_say_enumeration_full_da()</a>, <a class="el" href="say_8c_source.html#l02832">ast_say_enumeration_full_de()</a>, <a class="el" href="say_8c_source.html#l02571">ast_say_enumeration_full_en()</a>, <a class="el" href="say_8c_source.html#l02994">ast_say_enumeration_full_he()</a>, <a class="el" href="say_8c_source.html#l00597">ast_say_number_full_cs()</a>, <a class="el" href="say_8c_source.html#l00695">ast_say_number_full_da()</a>, <a class="el" href="say_8c_source.html#l00808">ast_say_number_full_de()</a>, <a class="el" href="say_8c_source.html#l00504">ast_say_number_full_en()</a>, <a class="el" href="say_8c_source.html#l00943">ast_say_number_full_en_GB()</a>, <a class="el" href="say_8c_source.html#l01021">ast_say_number_full_es()</a>, <a class="el" href="say_8c_source.html#l01125">ast_say_number_full_fr()</a>, <a class="el" href="say_8c_source.html#l07079">ast_say_number_full_gr()</a>, <a class="el" href="say_8c_source.html#l01217">ast_say_number_full_he()</a>, <a class="el" href="say_8c_source.html#l01388">ast_say_number_full_hu()</a>, <a class="el" href="say_8c_source.html#l01465">ast_say_number_full_it()</a>, <a class="el" href="say_8c_source.html#l07619">ast_say_number_full_ka()</a>, <a class="el" href="say_8c_source.html#l01620">ast_say_number_full_nl()</a>, <a class="el" href="say_8c_source.html#l01712">ast_say_number_full_no()</a>, <a class="el" href="say_8c_source.html#l02099">ast_say_number_full_pt()</a>, <a class="el" href="say_8c_source.html#l02404">ast_say_number_full_ru()</a>, <a class="el" href="say_8c_source.html#l02195">ast_say_number_full_se()</a>, <a class="el" href="say_8c_source.html#l02482">ast_say_number_full_th()</a>, <a class="el" href="say_8c_source.html#l02267">ast_say_number_full_zh()</a>, <a class="el" href="app__talkdetect_8c_source.html#l00076">background_detect_exec()</a>, <a class="el" href="features_8c_source.html#l01265">builtin_blindtransfer()</a>, <a class="el" href="app__dahdiscan_8c_source.html#l00290">conf_exec()</a>, <a class="el" href="app__meetme_8c_source.html#l01998">conf_run()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="app__directory_8c_source.html#l00723">directory_exec()</a>, <a class="el" href="bridge__builtin__features_8c_source.html#l00048">grab_transfer()</a>, <a class="el" href="res__agi_8c_source.html#l01239">handle_getoption()</a>, <a class="el" href="res__agi_8c_source.html#l02137">handle_speechrecognize()</a>, <a class="el" href="res__agi_8c_source.html#l01189">handle_streamfile()</a>, <a class="el" href="app__ices_8c_source.html#l00107">ices_exec()</a>, <a class="el" href="app_8c_source.html#l01540">ivr_dispatch()</a>, <a class="el" href="app__voicemail_8c_source.html#l05141">leave_voicemail()</a>, <a class="el" href="app__confbridge_8c_source.html#l00607">menu_callback()</a>, <a class="el" href="app__minivm_8c_source.html#l01971">minivm_greet_exec()</a>, <a class="el" href="app__mp3_8c_source.html#l00120">mp3_exec()</a>, <a class="el" href="app__nbscat_8c_source.html#l00108">NBScat_exec()</a>, <a class="el" href="app__parkandannounce_8c_source.html#l00088">parkandannounce_exec()</a>, <a class="el" href="pbx_8c_source.html#l08798">pbx_builtin_background()</a>, <a class="el" href="say_8c_source.html#l01830">pl_odtworz_plik()</a>, <a class="el" href="app__queue_8c_source.html#l02023">play_file()</a>, <a class="el" href="app__directory_8c_source.html#l00247">play_mailbox_owner()</a>, <a class="el" href="app__playback_8c_source.html#l00418">playback_exec()</a>, <a class="el" href="app__queue_8c_source.html#l05031">queue_exec()</a>, <a class="el" href="app__read_8c_source.html#l00127">read_exec()</a>, <a class="el" href="app__readexten_8c_source.html#l00128">readexten_exec()</a>, <a class="el" href="app__record_8c_source.html#l00132">record_exec()</a>, <a class="el" href="app__meetme_8c_source.html#l04359">recordthread()</a>, <a class="el" href="app__rpt_8c_source.html#l03937">rpt_tele_thread()</a>, <a class="el" href="app__playback_8c_source.html#l00144">s_streamwait3()</a>, <a class="el" href="say_8c_source.html#l00059">say_character_str_full()</a>, <a class="el" href="say_8c_source.html#l00221">say_digit_str_full()</a>, <a class="el" href="say_8c_source.html#l00141">say_phonetic_str_full()</a>, <a class="el" href="app__rpt_8c_source.html#l03694">saycharstr()</a>, <a class="el" href="app__rpt_8c_source.html#l03681">sayfile()</a>, <a class="el" href="app__rpt_8c_source.html#l03707">saynum()</a>, <a class="el" href="app__directory_8c_source.html#l00287">select_item_seq()</a>, <a class="el" href="app__rpt_8c_source.html#l03462">send_morse()</a>, <a class="el" href="app__rpt_8c_source.html#l03624">send_tone_telemetry()</a>, <a class="el" href="app__festival_8c_source.html#l00161">send_waveform_to_channel()</a>, <a class="el" href="app__speech__utils_8c_source.html#l00639">speech_background()</a>, <a class="el" href="app__voicemail_8c_source.html#l08999">vm_authenticate()</a>, <a class="el" href="app__voicemail_8c_source.html#l09099">vm_execmain()</a>, <a class="el" href="app__followme_8c_source.html#l00509">wait_for_winner()</a>, <a class="el" href="file_8c_source.html#l01168">waitstream_core()</a>, and <a class="el" href="app__zapateller_8c_source.html#l00077">zapateller_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00123"></a>00123 {
<a name="l00124"></a>00124    <a class="code" href="lock_8h.html#acbcec0b11bb6e43e0ebcd82828bc8684" title="Lock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_lock</a>(tmp);
<a name="l00125"></a>00125 
<a name="l00126"></a>00126    <span class="comment">/* Stop a running stream if there is one */</span>
<a name="l00127"></a>00127    <span class="keywordflow">if</span> (tmp-&gt;stream) {
<a name="l00128"></a>00128       <a class="code" href="file_8h.html#ab53bd2c3c55d509790c7f7620aac6373" title="Closes a stream.">ast_closestream</a>(tmp-&gt;stream);
<a name="l00129"></a>00129       tmp-&gt;stream = NULL;
<a name="l00130"></a>00130       <span class="keywordflow">if</span> (tmp-&gt;oldwriteformat &amp;&amp; <a class="code" href="channel_8h.html#a978161a52d98fdaee374d1f6e1359544" title="Sets write format on channel chan Set write format for channel to whichever component...">ast_set_write_format</a>(tmp, tmp-&gt;oldwriteformat))
<a name="l00131"></a>00131          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to restore format back to %d\n&quot;</span>, tmp-&gt;oldwriteformat);
<a name="l00132"></a>00132    }
<a name="l00133"></a>00133    <span class="comment">/* Stop the video stream too */</span>
<a name="l00134"></a>00134    <span class="keywordflow">if</span> (tmp-&gt;vstream != NULL) {
<a name="l00135"></a>00135       <a class="code" href="file_8h.html#ab53bd2c3c55d509790c7f7620aac6373" title="Closes a stream.">ast_closestream</a>(tmp-&gt;vstream);
<a name="l00136"></a>00136       tmp-&gt;vstream = NULL;
<a name="l00137"></a>00137    }
<a name="l00138"></a>00138 
<a name="l00139"></a>00139    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(tmp);
<a name="l00140"></a>00140 
<a name="l00141"></a>00141    <span class="keywordflow">return</span> 0;
<a name="l00142"></a>00142 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a95b94a020720147325a486e210b36775"></a><!-- doxytag: member="file.h::ast_stream_and_wait" ref="a95b94a020720147325a486e210b36775" args="(struct ast_channel *chan, const char *file, const char *digits)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_stream_and_wait </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>digits</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>stream file until digit If the file name is non-empty, try to play it. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>If digits == "" then we can simply check for non-zero. </dd></dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 if success. </dd></dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>if error. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>digit</em>&nbsp;</td><td>if interrupted by a digit. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="file_8c_source.html#l01342">1342</a> of file <a class="el" href="file_8c_source.html">file.c</a>.</p>

<p>References <a class="el" href="file_8c_source.html#l00943">ast_streamfile()</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, and <a class="el" href="file_8c_source.html#l01315">ast_waitstream()</a>.</p>

<p>Referenced by <a class="el" href="app_8c_source.html#l00668">__ast_play_and_record()</a>, <a class="el" href="app__confbridge_8c_source.html#l00203">announce_user_count()</a>, <a class="el" href="app__followme_8c_source.html#l01003">app_exec()</a>, <a class="el" href="features_8c_source.html#l04475">ast_pickup_call()</a>, <a class="el" href="app_8c_source.html#l01439">ast_record_review()</a>, <a class="el" href="channel_8c_source.html#l04742">bridge_playfile()</a>, <a class="el" href="features_8c_source.html#l01396">builtin_atxfer()</a>, <a class="el" href="features_8c_source.html#l01105">builtin_automixmonitor()</a>, <a class="el" href="features_8c_source.html#l01265">builtin_blindtransfer()</a>, <a class="el" href="app__confbridge_8c_source.html#l00687">confbridge_exec()</a>, <a class="el" href="app__directory_8c_source.html#l00723">directory_exec()</a>, <a class="el" href="bridge__builtin__features_8c_source.html#l00157">feature_attended_transfer()</a>, <a class="el" href="bridge__builtin__features_8c_source.html#l00095">feature_blind_transfer()</a>, <a class="el" href="app__voicemail_8c_source.html#l06582">forward_message()</a>, <a class="el" href="bridge__builtin__features_8c_source.html#l00048">grab_transfer()</a>, <a class="el" href="app__voicemail_8c_source.html#l04618">invent_message()</a>, <a class="el" href="app_8c_source.html#l01540">ivr_dispatch()</a>, <a class="el" href="app__confbridge_8c_source.html#l00394">join_conference_bridge()</a>, <a class="el" href="app__voicemail_8c_source.html#l05141">leave_voicemail()</a>, <a class="el" href="features_8c_source.html#l00833">masq_park_call()</a>, <a class="el" href="app__confbridge_8c_source.html#l00607">menu_callback()</a>, <a class="el" href="features_8c_source.html#l03335">park_exec_full()</a>, <a class="el" href="app__directory_8c_source.html#l00247">play_mailbox_owner()</a>, <a class="el" href="app__voicemail_8c_source.html#l06937">play_message_callerid()</a>, <a class="el" href="features_8c_source.html#l00973">play_message_in_bridged_call()</a>, <a class="el" href="app__confbridge_8c_source.html#l00238">play_prompt_to_channel()</a>, <a class="el" href="app__minivm_8c_source.html#l01378">play_record_review()</a>, <a class="el" href="app__confbridge_8c_source.html#l00554">play_sound_file()</a>, <a class="el" href="app__voicemail_8c_source.html#l11261">sayname()</a>, <a class="el" href="app__directory_8c_source.html#l00287">select_item_seq()</a>, and <a class="el" href="app__voicemail_8c_source.html#l06837">wait_file2()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01343"></a>01343 {
<a name="l01344"></a>01344    <span class="keywordtype">int</span> res = 0;
<a name="l01345"></a>01345    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(file)) {
<a name="l01346"></a>01346       res = <a class="code" href="file_8h.html#a67c7e271b4ca70aca6d48fd48d121857" title="Streams a file.">ast_streamfile</a>(chan, file, chan-&gt;language);
<a name="l01347"></a>01347       <span class="keywordflow">if</span> (!res) {
<a name="l01348"></a>01348          res = <a class="code" href="file_8h.html#affc21cb57c6bf72a2cb7ec8a379b2137" title="Waits for a stream to stop or digit to be pressed.">ast_waitstream</a>(chan, digits);
<a name="l01349"></a>01349       }
<a name="l01350"></a>01350    }
<a name="l01351"></a>01351    <span class="keywordflow">return</span> res;
<a name="l01352"></a>01352 } 
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac2137b5da91f3408f86d580952f32e94"></a><!-- doxytag: member="file.h::ast_stream_fastforward" ref="ac2137b5da91f3408f86d580952f32e94" args="(struct ast_filestream *fs, off_t ms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_stream_fastforward </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__filestream.html">ast_filestream</a> *&nbsp;</td>
          <td class="paramname"> <em>fs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">off_t&nbsp;</td>
          <td class="paramname"> <em>ms</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Fast forward stream ms. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fs</em>&nbsp;</td><td>filestream to act on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ms</em>&nbsp;</td><td>milliseconds to move </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="file_8c_source.html#l00877">877</a> of file <a class="el" href="file_8c_source.html">file.c</a>.</p>

<p>References <a class="el" href="file_8c_source.html#l00862">ast_seekstream()</a>, and <a class="el" href="asterisk_8h_source.html#l00042">DEFAULT_SAMPLES_PER_MS</a>.</p>

<p>Referenced by <a class="el" href="file_8c_source.html#l01168">waitstream_core()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00878"></a>00878 {
<a name="l00879"></a>00879    <span class="keywordflow">return</span> <a class="code" href="file_8h.html#a36f6bba05952162d5d1ee7fb9819bd07" title="Seeks into stream.">ast_seekstream</a>(fs, ms * <a class="code" href="asterisk_8h.html#ab2dba0d8b577d63452ed65647bb22a3f">DEFAULT_SAMPLES_PER_MS</a>, SEEK_CUR);
<a name="l00880"></a>00880 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4c7c02a659b09bb06dd63e1f42692666"></a><!-- doxytag: member="file.h::ast_stream_rewind" ref="a4c7c02a659b09bb06dd63e1f42692666" args="(struct ast_filestream *fs, off_t ms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_stream_rewind </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__filestream.html">ast_filestream</a> *&nbsp;</td>
          <td class="paramname"> <em>fs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">off_t&nbsp;</td>
          <td class="paramname"> <em>ms</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Rewind stream ms. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fs</em>&nbsp;</td><td>filestream to act on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ms</em>&nbsp;</td><td>milliseconds to move </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="file_8c_source.html#l00882">882</a> of file <a class="el" href="file_8c_source.html">file.c</a>.</p>

<p>References <a class="el" href="file_8c_source.html#l00862">ast_seekstream()</a>, and <a class="el" href="asterisk_8h_source.html#l00042">DEFAULT_SAMPLES_PER_MS</a>.</p>

<p>Referenced by <a class="el" href="app_8c_source.html#l00668">__ast_play_and_record()</a>, <a class="el" href="res__agi_8c_source.html#l01494">handle_recordfile()</a>, <a class="el" href="app__record_8c_source.html#l00132">record_exec()</a>, and <a class="el" href="file_8c_source.html#l01168">waitstream_core()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00883"></a>00883 {
<a name="l00884"></a>00884    <span class="keywordflow">return</span> <a class="code" href="file_8h.html#a36f6bba05952162d5d1ee7fb9819bd07" title="Seeks into stream.">ast_seekstream</a>(fs, -ms * <a class="code" href="asterisk_8h.html#ab2dba0d8b577d63452ed65647bb22a3f">DEFAULT_SAMPLES_PER_MS</a>, SEEK_CUR);
<a name="l00885"></a>00885 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a67c7e271b4ca70aca6d48fd48d121857"></a><!-- doxytag: member="file.h::ast_streamfile" ref="a67c7e271b4ca70aca6d48fd48d121857" args="(struct ast_channel *c, const char *filename, const char *preflang)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_streamfile </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>filename</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>preflang</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Streams a file. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>c</em>&nbsp;</td><td>channel to stream the file to </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>filename</em>&nbsp;</td><td>the name of the file you wish to stream, minus the <a class="el" href="structextension.html">extension</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>preflang</em>&nbsp;</td><td>the preferred language you wish to have the file streamed to you in Prepares a channel for the streaming of a file. To start the stream, afterward do a <a class="el" href="file_8h.html#affc21cb57c6bf72a2cb7ec8a379b2137" title="Waits for a stream to stop or digit to be pressed.">ast_waitstream()</a> on the channel Also, it will stop any existing streams on the channel. </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="file_8c_source.html#l00943">943</a> of file <a class="el" href="file_8c_source.html">file.c</a>.</p>

<p>References <a class="el" href="file_8c_source.html#l00844">ast_applystream()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="channel_8h_source.html#l00557">AST_FLAG_MASQ_NOSTREAM</a>, <a class="el" href="frame_8c_source.html#l00573">ast_getformatname()</a>, <a class="el" href="frame_8c_source.html#l00586">ast_getformatname_multiple()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="file_8c_source.html#l00619">ast_openstream()</a>, <a class="el" href="file_8c_source.html#l00662">ast_openvstream()</a>, <a class="el" href="file_8c_source.html#l00850">ast_playstream()</a>, <a class="el" href="file_8c_source.html#l00862">ast_seekstream()</a>, <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="mod__format_8h_source.html#l00115">ast_filestream::f</a>, <a class="el" href="mod__format_8h_source.html#l00102">ast_filestream::fmt</a>, <a class="el" href="mod__format_8h_source.html#l00047">ast_format::format</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="channel_8h_source.html#l00482">ast_channel::nativeformats</a>, <a class="el" href="mod__format_8h_source.html#l00119">ast_filestream::orig_chan_name</a>, <a class="el" href="mod__format_8h_source.html#l00108">ast_filestream::vfs</a>, and <a class="el" href="channel_8h_source.html#l00484">ast_channel::writeformat</a>.</p>

<p>Referenced by <a class="el" href="features_8c_source.html#l04156">action_bridge()</a>, <a class="el" href="chan__agent_8c_source.html#l00770">agent_call()</a>, <a class="el" href="app__meetme_8c_source.html#l01907">announce_thread()</a>, <a class="el" href="app__followme_8c_source.html#l01003">app_exec()</a>, <a class="el" href="app_8c_source.html#l00130">ast_app_getdata()</a>, <a class="el" href="app_8c_source.html#l00183">ast_app_getdata_full()</a>, <a class="el" href="app_8c_source.html#l00496">ast_control_streamfile()</a>, <a class="el" href="app_8c_source.html#l00634">ast_play_and_wait()</a>, <a class="el" href="say_8c_source.html#l03148">ast_say_date_da()</a>, <a class="el" href="say_8c_source.html#l03197">ast_say_date_de()</a>, <a class="el" href="say_8c_source.html#l03119">ast_say_date_en()</a>, <a class="el" href="say_8c_source.html#l03279">ast_say_date_fr()</a>, <a class="el" href="say_8c_source.html#l07159">ast_say_date_gr()</a>, <a class="el" href="say_8c_source.html#l03400">ast_say_date_he()</a>, <a class="el" href="say_8c_source.html#l03247">ast_say_date_hu()</a>, <a class="el" href="say_8c_source.html#l07696">ast_say_date_ka()</a>, <a class="el" href="say_8c_source.html#l03308">ast_say_date_nl()</a>, <a class="el" href="say_8c_source.html#l03337">ast_say_date_th()</a>, <a class="el" href="say_8c_source.html#l07283">ast_say_date_with_format_gr()</a>, <a class="el" href="say_8c_source.html#l06433">ast_say_datetime_en()</a>, <a class="el" href="say_8c_source.html#l06529">ast_say_datetime_fr()</a>, <a class="el" href="say_8c_source.html#l06862">ast_say_datetime_from_now_en()</a>, <a class="el" href="say_8c_source.html#l06900">ast_say_datetime_from_now_fr()</a>, <a class="el" href="say_8c_source.html#l06988">ast_say_datetime_from_now_he()</a>, <a class="el" href="say_8c_source.html#l07786">ast_say_datetime_from_now_ka()</a>, <a class="el" href="say_8c_source.html#l07251">ast_say_datetime_gr()</a>, <a class="el" href="say_8c_source.html#l06773">ast_say_datetime_he()</a>, <a class="el" href="say_8c_source.html#l06570">ast_say_datetime_nl()</a>, <a class="el" href="say_8c_source.html#l06589">ast_say_datetime_pt()</a>, <a class="el" href="say_8c_source.html#l06670">ast_say_datetime_th()</a>, <a class="el" href="say_8c_source.html#l06713">ast_say_datetime_zh()</a>, <a class="el" href="say_8c_source.html#l02669">ast_say_enumeration_full_da()</a>, <a class="el" href="say_8c_source.html#l02832">ast_say_enumeration_full_de()</a>, <a class="el" href="say_8c_source.html#l02571">ast_say_enumeration_full_en()</a>, <a class="el" href="say_8c_source.html#l02994">ast_say_enumeration_full_he()</a>, <a class="el" href="say_8c_source.html#l00597">ast_say_number_full_cs()</a>, <a class="el" href="say_8c_source.html#l00695">ast_say_number_full_da()</a>, <a class="el" href="say_8c_source.html#l00808">ast_say_number_full_de()</a>, <a class="el" href="say_8c_source.html#l00504">ast_say_number_full_en()</a>, <a class="el" href="say_8c_source.html#l00943">ast_say_number_full_en_GB()</a>, <a class="el" href="say_8c_source.html#l01021">ast_say_number_full_es()</a>, <a class="el" href="say_8c_source.html#l01125">ast_say_number_full_fr()</a>, <a class="el" href="say_8c_source.html#l07079">ast_say_number_full_gr()</a>, <a class="el" href="say_8c_source.html#l01217">ast_say_number_full_he()</a>, <a class="el" href="say_8c_source.html#l01388">ast_say_number_full_hu()</a>, <a class="el" href="say_8c_source.html#l01465">ast_say_number_full_it()</a>, <a class="el" href="say_8c_source.html#l07619">ast_say_number_full_ka()</a>, <a class="el" href="say_8c_source.html#l01620">ast_say_number_full_nl()</a>, <a class="el" href="say_8c_source.html#l01712">ast_say_number_full_no()</a>, <a class="el" href="say_8c_source.html#l02099">ast_say_number_full_pt()</a>, <a class="el" href="say_8c_source.html#l02404">ast_say_number_full_ru()</a>, <a class="el" href="say_8c_source.html#l02195">ast_say_number_full_se()</a>, <a class="el" href="say_8c_source.html#l02482">ast_say_number_full_th()</a>, <a class="el" href="say_8c_source.html#l02267">ast_say_number_full_zh()</a>, <a class="el" href="say_8c_source.html#l06153">ast_say_time_de()</a>, <a class="el" href="say_8c_source.html#l06104">ast_say_time_en()</a>, <a class="el" href="say_8c_source.html#l06196">ast_say_time_fr()</a>, <a class="el" href="say_8c_source.html#l07203">ast_say_time_gr()</a>, <a class="el" href="say_8c_source.html#l06173">ast_say_time_hu()</a>, <a class="el" href="say_8c_source.html#l07736">ast_say_time_ka()</a>, <a class="el" href="say_8c_source.html#l06215">ast_say_time_nl()</a>, <a class="el" href="say_8c_source.html#l06312">ast_say_time_zh()</a>, <a class="el" href="file_8c_source.html#l01342">ast_stream_and_wait()</a>, <a class="el" href="app__authenticate_8c_source.html#l00108">auth_exec()</a>, <a class="el" href="app__talkdetect_8c_source.html#l00076">background_detect_exec()</a>, <a class="el" href="features_8c_source.html#l04524">bridge_exec()</a>, <a class="el" href="chan__agent_8c_source.html#l01350">check_availability()</a>, <a class="el" href="chan__agent_8c_source.html#l01415">check_beep()</a>, <a class="el" href="app__chanspy_8c_source.html#l00767">common_exec()</a>, <a class="el" href="app__meetme_8c_source.html#l03696">conf_exec()</a>, <a class="el" href="app__meetme_8c_source.html#l01998">conf_run()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="app__directory_8c_source.html#l00646">do_directory()</a>, <a class="el" href="app__meetme_8c_source.html#l03372">find_conf_realtime()</a>, <a class="el" href="app__voicemail_8c_source.html#l06582">forward_message()</a>, <a class="el" href="say_8c_source.html#l07033">gr_say_number_female()</a>, <a class="el" href="res__agi_8c_source.html#l01494">handle_recordfile()</a>, <a class="el" href="app__minivm_8c_source.html#l01309">invent_message()</a>, <a class="el" href="app__minivm_8c_source.html#l01604">leave_voicemail()</a>, <a class="el" href="chan__sip_8c_source.html#l20405">local_attended_transfer()</a>, <a class="el" href="chan__agent_8c_source.html#l01981">login_exec()</a>, <a class="el" href="app__confbridge_8c_source.html#l00607">menu_callback()</a>, <a class="el" href="app__minivm_8c_source.html#l01971">minivm_greet_exec()</a>, <a class="el" href="app__page_8c_source.html#l00121">page_exec()</a>, <a class="el" href="features_8c_source.html#l03335">park_exec_full()</a>, <a class="el" href="app__parkandannounce_8c_source.html#l00088">parkandannounce_exec()</a>, <a class="el" href="pbx_8c_source.html#l08798">pbx_builtin_background()</a>, <a class="el" href="say_8c_source.html#l01830">pl_odtworz_plik()</a>, <a class="el" href="app__dictate_8c_source.html#l00075">play_and_wait()</a>, <a class="el" href="app__queue_8c_source.html#l02023">play_file()</a>, <a class="el" href="app__minivm_8c_source.html#l01378">play_record_review()</a>, <a class="el" href="app__playback_8c_source.html#l00418">playback_exec()</a>, <a class="el" href="app__privacy_8c_source.html#l00083">privacy_exec()</a>, <a class="el" href="app__readexten_8c_source.html#l00128">readexten_exec()</a>, <a class="el" href="app__record_8c_source.html#l00132">record_exec()</a>, <a class="el" href="app__dial_8c_source.html#l02345">retrydial_exec()</a>, <a class="el" href="app__rpt_8c_source.html#l03937">rpt_tele_thread()</a>, <a class="el" href="app__playback_8c_source.html#l00144">s_streamwait3()</a>, <a class="el" href="say_8c_source.html#l00059">say_character_str_full()</a>, <a class="el" href="say_8c_source.html#l00221">say_digit_str_full()</a>, <a class="el" href="say_8c_source.html#l00141">say_phonetic_str_full()</a>, <a class="el" href="app__rpt_8c_source.html#l03681">sayfile()</a>, <a class="el" href="app__directory_8c_source.html#l00322">select_item_menu()</a>, <a class="el" href="app__dial_8c_source.html#l01385">setup_privacy_args()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>, <a class="el" href="app__voicemail_8c_source.html#l08999">vm_authenticate()</a>, <a class="el" href="say_8c_source.html#l00418">wait_file()</a>, and <a class="el" href="app__followme_8c_source.html#l00509">wait_for_winner()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00944"></a>00944 {
<a name="l00945"></a>00945    <span class="keyword">struct </span><a class="code" href="structast__filestream.html" title="This structure is allocated by file.c in one chunk, together with buf_size and desc_size...">ast_filestream</a> *fs;
<a name="l00946"></a>00946    <span class="keyword">struct </span><a class="code" href="structast__filestream.html" title="This structure is allocated by file.c in one chunk, together with buf_size and desc_size...">ast_filestream</a> *<a class="code" href="structast__filestream.html#a084d8f087c50442f51245ec3333abac4">vfs</a>=NULL;
<a name="l00947"></a>00947    <span class="keywordtype">char</span> <a class="code" href="structast__filestream.html#af4e7a9f36c380991c59c9a49122de100">fmt</a>[256];
<a name="l00948"></a>00948    <span class="keywordtype">int</span> seekattempt;
<a name="l00949"></a>00949    <span class="keywordtype">int</span> res;
<a name="l00950"></a>00950 
<a name="l00951"></a>00951    fs = <a class="code" href="file_8h.html#ad85c951fa1d6988d2d7e169833a951a8" title="Opens stream for use in seeking, playing.">ast_openstream</a>(<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, <a class="code" href="structast__filestream.html#aeac90097f29f7529968697163cea5c18">filename</a>, preflang);
<a name="l00952"></a>00952    <span class="keywordflow">if</span> (!fs) {
<a name="l00953"></a>00953       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to open %s (format %s): %s\n&quot;</span>, <a class="code" href="structast__filestream.html#aeac90097f29f7529968697163cea5c18">filename</a>, <a class="code" href="frame_8h.html#a37cdc7e78686b0bfa4e47e645f782b30" title="Get the names of a set of formats.">ast_getformatname_multiple</a>(fmt, <span class="keyword">sizeof</span>(fmt), <a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a>), strerror(errno));
<a name="l00954"></a>00954       <span class="keywordflow">return</span> -1;
<a name="l00955"></a>00955    }
<a name="l00956"></a>00956 
<a name="l00957"></a>00957    <span class="comment">/* check to see if there is any data present (not a zero length file),</span>
<a name="l00958"></a>00958 <span class="comment">    * done this way because there is no where for ast_openstream_full to</span>
<a name="l00959"></a>00959 <span class="comment">    * return the file had no data. */</span>
<a name="l00960"></a>00960    seekattempt = fseek(fs-&gt;<a class="code" href="structast__filestream.html#a3efb0e1a16208deecbd84c15401f7cf8">f</a>, -1, SEEK_END);
<a name="l00961"></a>00961    <span class="keywordflow">if</span> (!seekattempt)
<a name="l00962"></a>00962       <a class="code" href="file_8h.html#a36f6bba05952162d5d1ee7fb9819bd07" title="Seeks into stream.">ast_seekstream</a>(fs, 0, SEEK_SET);
<a name="l00963"></a>00963    <span class="keywordflow">else</span>
<a name="l00964"></a>00964       <span class="keywordflow">return</span> 0;
<a name="l00965"></a>00965 
<a name="l00966"></a>00966    vfs = <a class="code" href="file_8h.html#aeed49fff2d6008a89f996230988d944d" title="Opens stream for use in seeking, playing.">ast_openvstream</a>(<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, <a class="code" href="structast__filestream.html#aeac90097f29f7529968697163cea5c18">filename</a>, preflang);
<a name="l00967"></a>00967    <span class="keywordflow">if</span> (vfs) {
<a name="l00968"></a>00968       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Ooh, found a video stream, too, format %s\n&quot;</span>, <a class="code" href="frame_8h.html#afe8f690984f8ba95cd01a431198c10bf" title="Get the name of a format.">ast_getformatname</a>(vfs-&gt;<a class="code" href="structast__filestream.html#af4e7a9f36c380991c59c9a49122de100">fmt</a>-&gt;<a class="code" href="structast__format.html#a317afff57d87a89158c2b038d37b2b08">format</a>));
<a name="l00969"></a>00969    }
<a name="l00970"></a>00970 
<a name="l00971"></a>00971    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329a44e6b334058bf9555fd4b834ad532046">AST_FLAG_MASQ_NOSTREAM</a>))
<a name="l00972"></a>00972       fs-&gt;<a class="code" href="structast__filestream.html#afa3ba2491683e48895a1e174f7bd7431">orig_chan_name</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>-&gt;name);
<a name="l00973"></a>00973    <span class="keywordflow">if</span> (<a class="code" href="file_8h.html#a618e3120b6d019312ef2d617d9f14571" title="Applys a open stream to a channel.">ast_applystream</a>(<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, fs))
<a name="l00974"></a>00974       <span class="keywordflow">return</span> -1;
<a name="l00975"></a>00975    <span class="keywordflow">if</span> (vfs &amp;&amp; <a class="code" href="file_8h.html#a618e3120b6d019312ef2d617d9f14571" title="Applys a open stream to a channel.">ast_applystream</a>(<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, vfs))
<a name="l00976"></a>00976       <span class="keywordflow">return</span> -1;
<a name="l00977"></a>00977    res = <a class="code" href="file_8h.html#ad59224750b8b617f9590b28b88457b14" title="Play a open stream on a channel.">ast_playstream</a>(fs);
<a name="l00978"></a>00978    <span class="keywordflow">if</span> (!res &amp;&amp; vfs)
<a name="l00979"></a>00979       res = <a class="code" href="file_8h.html#ad59224750b8b617f9590b28b88457b14" title="Play a open stream on a channel.">ast_playstream</a>(vfs);
<a name="l00980"></a>00980    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;&lt;%s&gt; Playing &apos;%s.%s&apos; (language &apos;%s&apos;)\n&quot;</span>, <a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>-&gt;name, <a class="code" href="structast__filestream.html#aeac90097f29f7529968697163cea5c18">filename</a>, <a class="code" href="frame_8h.html#afe8f690984f8ba95cd01a431198c10bf" title="Get the name of a format.">ast_getformatname</a>(<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>-&gt;<a class="code" href="structast__channel.html#a00f5ce2ad53ff8523f8e46ea5aceba48">writeformat</a>), preflang ? preflang : <span class="stringliteral">&quot;default&quot;</span>);
<a name="l00981"></a>00981 
<a name="l00982"></a>00982    <span class="keywordflow">return</span> res;
<a name="l00983"></a>00983 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a01771a318e7adea51499040f27b4278a"></a><!-- doxytag: member="file.h::ast_tellstream" ref="a01771a318e7adea51499040f27b4278a" args="(struct ast_filestream *fs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">off_t ast_tellstream </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__filestream.html">ast_filestream</a> *&nbsp;</td>
          <td class="paramname"> <em>fs</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Tell where we are in a stream. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fs</em>&nbsp;</td><td>fs to act on </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>a long as a sample offset into stream </dd></dl>

<p>Definition at line <a class="el" href="file_8c_source.html#l00872">872</a> of file <a class="el" href="file_8c_source.html">file.c</a>.</p>

<p>References <a class="el" href="mod__format_8h_source.html#l00102">ast_filestream::fmt</a>, and <a class="el" href="structast__format.html#af6d9675f12feb1f1bca6b99c35ba6d8a">ast_format::tell</a>.</p>

<p>Referenced by <a class="el" href="app_8c_source.html#l00668">__ast_play_and_record()</a>, <a class="el" href="app_8c_source.html#l00496">ast_control_streamfile()</a>, <a class="el" href="res__agi_8c_source.html#l01239">handle_getoption()</a>, <a class="el" href="res__agi_8c_source.html#l01494">handle_recordfile()</a>, <a class="el" href="res__agi_8c_source.html#l02137">handle_speechrecognize()</a>, and <a class="el" href="res__agi_8c_source.html#l01189">handle_streamfile()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00873"></a>00873 {
<a name="l00874"></a>00874    <span class="keywordflow">return</span> fs-&gt;<a class="code" href="structast__filestream.html#af4e7a9f36c380991c59c9a49122de100">fmt</a>-&gt;<a class="code" href="structast__format.html#af6d9675f12feb1f1bca6b99c35ba6d8a">tell</a>(fs);
<a name="l00875"></a>00875 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa647ac352a00b559131f90ffffea2c3c"></a><!-- doxytag: member="file.h::ast_truncstream" ref="aa647ac352a00b559131f90ffffea2c3c" args="(struct ast_filestream *fs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_truncstream </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__filestream.html">ast_filestream</a> *&nbsp;</td>
          <td class="paramname"> <em>fs</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Trunc stream at current location. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fs</em>&nbsp;</td><td>filestream to act on </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="file_8c_source.html#l00867">867</a> of file <a class="el" href="file_8c_source.html">file.c</a>.</p>

<p>References <a class="el" href="mod__format_8h_source.html#l00102">ast_filestream::fmt</a>, and <a class="el" href="structast__format.html#a81ae1164851a9963c1680ee92436ce91">ast_format::trunc</a>.</p>

<p>Referenced by <a class="el" href="app_8c_source.html#l00668">__ast_play_and_record()</a>, <a class="el" href="res__agi_8c_source.html#l01494">handle_recordfile()</a>, and <a class="el" href="app__record_8c_source.html#l00132">record_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00868"></a>00868 {
<a name="l00869"></a>00869    <span class="keywordflow">return</span> fs-&gt;<a class="code" href="structast__filestream.html#af4e7a9f36c380991c59c9a49122de100">fmt</a>-&gt;<a class="code" href="structast__format.html#a81ae1164851a9963c1680ee92436ce91">trunc</a>(fs);
<a name="l00870"></a>00870 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="affc21cb57c6bf72a2cb7ec8a379b2137"></a><!-- doxytag: member="file.h::ast_waitstream" ref="affc21cb57c6bf72a2cb7ec8a379b2137" args="(struct ast_channel *c, const char *breakon)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_waitstream </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>breakon</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Waits for a stream to stop or digit to be pressed. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>c</em>&nbsp;</td><td>channel to waitstream on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>breakon</em>&nbsp;</td><td>string of DTMF digits to break upon Begins playback of a stream... Wait for a stream to stop or for any one of a given digit to arrive, </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if the stream finishes </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>the</em>&nbsp;</td><td>character if it was interrupted, </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on error </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="file_8c_source.html#l01315">1315</a> of file <a class="el" href="file_8c_source.html">file.c</a>.</p>

<p>References <a class="el" href="file_8c_source.html#l01168">waitstream_core()</a>.</p>

<p>Referenced by <a class="el" href="features_8c_source.html#l04156">action_bridge()</a>, <a class="el" href="chan__agent_8c_source.html#l00770">agent_call()</a>, <a class="el" href="app__meetme_8c_source.html#l01907">announce_thread()</a>, <a class="el" href="app__followme_8c_source.html#l01003">app_exec()</a>, <a class="el" href="app_8c_source.html#l00634">ast_play_and_wait()</a>, <a class="el" href="say_8c_source.html#l03148">ast_say_date_da()</a>, <a class="el" href="say_8c_source.html#l03197">ast_say_date_de()</a>, <a class="el" href="say_8c_source.html#l03119">ast_say_date_en()</a>, <a class="el" href="say_8c_source.html#l03279">ast_say_date_fr()</a>, <a class="el" href="say_8c_source.html#l07159">ast_say_date_gr()</a>, <a class="el" href="say_8c_source.html#l03400">ast_say_date_he()</a>, <a class="el" href="say_8c_source.html#l03247">ast_say_date_hu()</a>, <a class="el" href="say_8c_source.html#l07696">ast_say_date_ka()</a>, <a class="el" href="say_8c_source.html#l03308">ast_say_date_nl()</a>, <a class="el" href="say_8c_source.html#l03337">ast_say_date_th()</a>, <a class="el" href="say_8c_source.html#l07283">ast_say_date_with_format_gr()</a>, <a class="el" href="say_8c_source.html#l06433">ast_say_datetime_en()</a>, <a class="el" href="say_8c_source.html#l06529">ast_say_datetime_fr()</a>, <a class="el" href="say_8c_source.html#l06862">ast_say_datetime_from_now_en()</a>, <a class="el" href="say_8c_source.html#l06900">ast_say_datetime_from_now_fr()</a>, <a class="el" href="say_8c_source.html#l06988">ast_say_datetime_from_now_he()</a>, <a class="el" href="say_8c_source.html#l07786">ast_say_datetime_from_now_ka()</a>, <a class="el" href="say_8c_source.html#l07251">ast_say_datetime_gr()</a>, <a class="el" href="say_8c_source.html#l06773">ast_say_datetime_he()</a>, <a class="el" href="say_8c_source.html#l06570">ast_say_datetime_nl()</a>, <a class="el" href="say_8c_source.html#l06589">ast_say_datetime_pt()</a>, <a class="el" href="say_8c_source.html#l06670">ast_say_datetime_th()</a>, <a class="el" href="say_8c_source.html#l06713">ast_say_datetime_zh()</a>, <a class="el" href="say_8c_source.html#l02669">ast_say_enumeration_full_da()</a>, <a class="el" href="say_8c_source.html#l02832">ast_say_enumeration_full_de()</a>, <a class="el" href="say_8c_source.html#l02571">ast_say_enumeration_full_en()</a>, <a class="el" href="say_8c_source.html#l02994">ast_say_enumeration_full_he()</a>, <a class="el" href="say_8c_source.html#l00597">ast_say_number_full_cs()</a>, <a class="el" href="say_8c_source.html#l00695">ast_say_number_full_da()</a>, <a class="el" href="say_8c_source.html#l00808">ast_say_number_full_de()</a>, <a class="el" href="say_8c_source.html#l00504">ast_say_number_full_en()</a>, <a class="el" href="say_8c_source.html#l00943">ast_say_number_full_en_GB()</a>, <a class="el" href="say_8c_source.html#l01021">ast_say_number_full_es()</a>, <a class="el" href="say_8c_source.html#l01125">ast_say_number_full_fr()</a>, <a class="el" href="say_8c_source.html#l07079">ast_say_number_full_gr()</a>, <a class="el" href="say_8c_source.html#l01217">ast_say_number_full_he()</a>, <a class="el" href="say_8c_source.html#l01388">ast_say_number_full_hu()</a>, <a class="el" href="say_8c_source.html#l01465">ast_say_number_full_it()</a>, <a class="el" href="say_8c_source.html#l07619">ast_say_number_full_ka()</a>, <a class="el" href="say_8c_source.html#l01620">ast_say_number_full_nl()</a>, <a class="el" href="say_8c_source.html#l01712">ast_say_number_full_no()</a>, <a class="el" href="say_8c_source.html#l02099">ast_say_number_full_pt()</a>, <a class="el" href="say_8c_source.html#l02404">ast_say_number_full_ru()</a>, <a class="el" href="say_8c_source.html#l02195">ast_say_number_full_se()</a>, <a class="el" href="say_8c_source.html#l02482">ast_say_number_full_th()</a>, <a class="el" href="say_8c_source.html#l02267">ast_say_number_full_zh()</a>, <a class="el" href="say_8c_source.html#l06153">ast_say_time_de()</a>, <a class="el" href="say_8c_source.html#l06104">ast_say_time_en()</a>, <a class="el" href="say_8c_source.html#l07203">ast_say_time_gr()</a>, <a class="el" href="say_8c_source.html#l06354">ast_say_time_he()</a>, <a class="el" href="say_8c_source.html#l06173">ast_say_time_hu()</a>, <a class="el" href="say_8c_source.html#l07736">ast_say_time_ka()</a>, <a class="el" href="say_8c_source.html#l06215">ast_say_time_nl()</a>, <a class="el" href="say_8c_source.html#l06312">ast_say_time_zh()</a>, <a class="el" href="file_8c_source.html#l01342">ast_stream_and_wait()</a>, <a class="el" href="app__authenticate_8c_source.html#l00108">auth_exec()</a>, <a class="el" href="features_8c_source.html#l04524">bridge_exec()</a>, <a class="el" href="chan__agent_8c_source.html#l01350">check_availability()</a>, <a class="el" href="chan__agent_8c_source.html#l01415">check_beep()</a>, <a class="el" href="app__chanspy_8c_source.html#l00767">common_exec()</a>, <a class="el" href="app__meetme_8c_source.html#l03696">conf_exec()</a>, <a class="el" href="app__meetme_8c_source.html#l01998">conf_run()</a>, <a class="el" href="app__directory_8c_source.html#l00723">directory_exec()</a>, <a class="el" href="app__meetme_8c_source.html#l03372">find_conf_realtime()</a>, <a class="el" href="say_8c_source.html#l07033">gr_say_number_female()</a>, <a class="el" href="res__agi_8c_source.html#l01494">handle_recordfile()</a>, <a class="el" href="app__minivm_8c_source.html#l01309">invent_message()</a>, <a class="el" href="app__minivm_8c_source.html#l01604">leave_voicemail()</a>, <a class="el" href="chan__sip_8c_source.html#l20405">local_attended_transfer()</a>, <a class="el" href="chan__agent_8c_source.html#l01981">login_exec()</a>, <a class="el" href="app__confbridge_8c_source.html#l00607">menu_callback()</a>, <a class="el" href="app__minivm_8c_source.html#l01971">minivm_greet_exec()</a>, <a class="el" href="app__page_8c_source.html#l00121">page_exec()</a>, <a class="el" href="features_8c_source.html#l03335">park_exec_full()</a>, <a class="el" href="app__parkandannounce_8c_source.html#l00088">parkandannounce_exec()</a>, <a class="el" href="pbx_8c_source.html#l08798">pbx_builtin_background()</a>, <a class="el" href="say_8c_source.html#l01830">pl_odtworz_plik()</a>, <a class="el" href="app__dictate_8c_source.html#l00075">play_and_wait()</a>, <a class="el" href="app__queue_8c_source.html#l02023">play_file()</a>, <a class="el" href="app__minivm_8c_source.html#l01378">play_record_review()</a>, <a class="el" href="app__playback_8c_source.html#l00418">playback_exec()</a>, <a class="el" href="app__privacy_8c_source.html#l00083">privacy_exec()</a>, <a class="el" href="app__record_8c_source.html#l00132">record_exec()</a>, <a class="el" href="app__dial_8c_source.html#l02345">retrydial_exec()</a>, <a class="el" href="app__rpt_8c_source.html#l03937">rpt_tele_thread()</a>, <a class="el" href="app__playback_8c_source.html#l00144">s_streamwait3()</a>, <a class="el" href="say_8c_source.html#l00059">say_character_str_full()</a>, <a class="el" href="say_8c_source.html#l00221">say_digit_str_full()</a>, <a class="el" href="say_8c_source.html#l00141">say_phonetic_str_full()</a>, <a class="el" href="app__rpt_8c_source.html#l03694">saycharstr()</a>, <a class="el" href="app__rpt_8c_source.html#l03681">sayfile()</a>, <a class="el" href="app__rpt_8c_source.html#l03707">saynum()</a>, <a class="el" href="app__directory_8c_source.html#l00322">select_item_menu()</a>, <a class="el" href="app__rpt_8c_source.html#l03462">send_morse()</a>, <a class="el" href="app__rpt_8c_source.html#l03624">send_tone_telemetry()</a>, <a class="el" href="app__dial_8c_source.html#l01385">setup_privacy_args()</a>, <a class="el" href="chan__dahdi_8c_source.html#l07675">ss_thread()</a>, <a class="el" href="app__voicemail_8c_source.html#l08999">vm_authenticate()</a>, and <a class="el" href="say_8c_source.html#l00418">wait_file()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01316"></a>01316 {
<a name="l01317"></a>01317    <span class="keywordflow">return</span> <a class="code" href="file_8c.html#a8498b7140122fecadf08ae1c7b2c033c" title="the core of all waitstream() functions">waitstream_core</a>(c, breakon, NULL, NULL, 0, -1, -1, NULL);
<a name="l01318"></a>01318 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae6eb4e1e4576abe04a4b185688f6690c"></a><!-- doxytag: member="file.h::ast_waitstream_exten" ref="ae6eb4e1e4576abe04a4b185688f6690c" args="(struct ast_channel *c, const char *context)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_waitstream_exten </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>context</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Waits for a stream to stop or digit matching a valid one digit exten to be pressed. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>c</em>&nbsp;</td><td>channel to waitstream on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>context</em>&nbsp;</td><td>string of context to match digits to break upon Begins playback of a stream... Wait for a stream to stop or for any one of a valid <a class="el" href="structextension.html">extension</a> digit to arrive, </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if the stream finishes. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>the</em>&nbsp;</td><td>character if it was interrupted. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on error. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="file_8c_source.html#l01326">1326</a> of file <a class="el" href="file_8c_source.html">file.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00503">ast_channel::context</a>, and <a class="el" href="file_8c_source.html#l01168">waitstream_core()</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l08798">pbx_builtin_background()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01327"></a>01327 {
<a name="l01328"></a>01328    <span class="comment">/* Waitstream, with return in the case of a valid 1 digit extension */</span>
<a name="l01329"></a>01329    <span class="comment">/* in the current or specified context being pressed */</span>
<a name="l01330"></a>01330 
<a name="l01331"></a>01331    <span class="keywordflow">if</span> (!<a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>)
<a name="l01332"></a>01332       <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a> = c-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>;
<a name="l01333"></a>01333    <span class="keywordflow">return</span> <a class="code" href="file_8c.html#a8498b7140122fecadf08ae1c7b2c033c" title="the core of all waitstream() functions">waitstream_core</a>(c, NULL, NULL, NULL, 0,
<a name="l01334"></a>01334       -1, -1, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>);
<a name="l01335"></a>01335 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5ce837632e3746a3af17f8311060e510"></a><!-- doxytag: member="file.h::ast_waitstream_fr" ref="a5ce837632e3746a3af17f8311060e510" args="(struct ast_channel *c, const char *breakon, const char *forward, const char *rewind, int ms)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_waitstream_fr </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>breakon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>forward</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>rewind</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>ms</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Same as waitstream but allows stream to be forwarded or rewound. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>c</em>&nbsp;</td><td>channel to waitstream on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>breakon</em>&nbsp;</td><td>string of DTMF digits to break upon </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>forward</em>&nbsp;</td><td>DTMF digit to fast forward upon </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>rewind</em>&nbsp;</td><td>DTMF digit to rewind upon </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ms</em>&nbsp;</td><td>How many miliseconds to skip forward/back Begins playback of a stream... Wait for a stream to stop or for any one of a given digit to arrive, </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if the stream finishes. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>the</em>&nbsp;</td><td>character if it was interrupted. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on error. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="file_8c_source.html#l01309">1309</a> of file <a class="el" href="file_8c_source.html">file.c</a>.</p>

<p>References <a class="el" href="file_8c_source.html#l01168">waitstream_core()</a>.</p>

<p>Referenced by <a class="el" href="app_8c_source.html#l00496">ast_control_streamfile()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01310"></a>01310 {
<a name="l01311"></a>01311    <span class="keywordflow">return</span> <a class="code" href="file_8c.html#a8498b7140122fecadf08ae1c7b2c033c" title="the core of all waitstream() functions">waitstream_core</a>(c, breakon, forward, reverse, ms,
<a name="l01312"></a>01312       -1 <span class="comment">/* no audiofd */</span>, -1 <span class="comment">/* no cmdfd */</span>, NULL <span class="comment">/* no context */</span>);
<a name="l01313"></a>01313 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3089874cd5223053f670c8499e911ec4"></a><!-- doxytag: member="file.h::ast_waitstream_full" ref="a3089874cd5223053f670c8499e911ec4" args="(struct ast_channel *c, const char *breakon, int audiofd, int monfd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_waitstream_full </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>breakon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>audiofd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>monfd</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Same as waitstream, but with audio output to fd and monitored fd checking.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>1 if monfd is ready for reading </dd></dl>

<p>Definition at line <a class="el" href="file_8c_source.html#l01320">1320</a> of file <a class="el" href="file_8c_source.html">file.c</a>.</p>

<p>References <a class="el" href="file_8c_source.html#l01168">waitstream_core()</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l04093">ast_readstring_full()</a>, <a class="el" href="say_8c_source.html#l02669">ast_say_enumeration_full_da()</a>, <a class="el" href="say_8c_source.html#l02832">ast_say_enumeration_full_de()</a>, <a class="el" href="say_8c_source.html#l02571">ast_say_enumeration_full_en()</a>, <a class="el" href="say_8c_source.html#l02994">ast_say_enumeration_full_he()</a>, <a class="el" href="say_8c_source.html#l00597">ast_say_number_full_cs()</a>, <a class="el" href="say_8c_source.html#l00695">ast_say_number_full_da()</a>, <a class="el" href="say_8c_source.html#l00808">ast_say_number_full_de()</a>, <a class="el" href="say_8c_source.html#l00504">ast_say_number_full_en()</a>, <a class="el" href="say_8c_source.html#l00943">ast_say_number_full_en_GB()</a>, <a class="el" href="say_8c_source.html#l01021">ast_say_number_full_es()</a>, <a class="el" href="say_8c_source.html#l01125">ast_say_number_full_fr()</a>, <a class="el" href="say_8c_source.html#l07079">ast_say_number_full_gr()</a>, <a class="el" href="say_8c_source.html#l01217">ast_say_number_full_he()</a>, <a class="el" href="say_8c_source.html#l01388">ast_say_number_full_hu()</a>, <a class="el" href="say_8c_source.html#l01465">ast_say_number_full_it()</a>, <a class="el" href="say_8c_source.html#l07619">ast_say_number_full_ka()</a>, <a class="el" href="say_8c_source.html#l01620">ast_say_number_full_nl()</a>, <a class="el" href="say_8c_source.html#l01712">ast_say_number_full_no()</a>, <a class="el" href="say_8c_source.html#l02099">ast_say_number_full_pt()</a>, <a class="el" href="say_8c_source.html#l02404">ast_say_number_full_ru()</a>, <a class="el" href="say_8c_source.html#l02195">ast_say_number_full_se()</a>, <a class="el" href="say_8c_source.html#l02482">ast_say_number_full_th()</a>, <a class="el" href="say_8c_source.html#l02267">ast_say_number_full_zh()</a>, <a class="el" href="res__agi_8c_source.html#l01239">handle_getoption()</a>, <a class="el" href="res__agi_8c_source.html#l01189">handle_streamfile()</a>, <a class="el" href="say_8c_source.html#l01830">pl_odtworz_plik()</a>, <a class="el" href="app__playback_8c_source.html#l00144">s_streamwait3()</a>, <a class="el" href="say_8c_source.html#l00059">say_character_str_full()</a>, <a class="el" href="say_8c_source.html#l00221">say_digit_str_full()</a>, and <a class="el" href="say_8c_source.html#l00141">say_phonetic_str_full()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01321"></a>01321 {
<a name="l01322"></a>01322    <span class="keywordflow">return</span> <a class="code" href="file_8c.html#a8498b7140122fecadf08ae1c7b2c033c" title="the core of all waitstream() functions">waitstream_core</a>(c, breakon, NULL, NULL, 0,
<a name="l01323"></a>01323       audiofd, cmdfd, NULL <span class="comment">/* no context */</span>);
<a name="l01324"></a>01324 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a964f8ef393c07609d7b9e02937faed52"></a><!-- doxytag: member="file.h::ast_writefile" ref="a964f8ef393c07609d7b9e02937faed52" args="(const char *filename, const char *type, const char *comment, int flags, int check, mode_t mode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__filestream.html">ast_filestream</a>* ast_writefile </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>filename</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>comment</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>check</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">mode_t&nbsp;</td>
          <td class="paramname"> <em>mode</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Starts writing a file. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>filename</em>&nbsp;</td><td>the name of the file to write to </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>type</em>&nbsp;</td><td>format of file you wish to write out to </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>comment</em>&nbsp;</td><td>comment to go with </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>flags</em>&nbsp;</td><td>output file flags </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>check</em>&nbsp;</td><td>(unimplemented, hence negligible) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>mode</em>&nbsp;</td><td>Open mode Create an <a class="el" href="structoutgoing.html">outgoing</a> file stream. oflags are flags for the open() command, and if check is non-zero, then it will not write a file if there are any files that start with that name and have an <a class="el" href="structextension.html">extension</a> Please note, this is a blocking function. Program execution will not return until ast_waitstream completes it's execution. </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>a</em>&nbsp;</td><td>struct <a class="el" href="structast__filestream.html" title="This structure is allocated by file.c in one chunk, together with buf_size and desc_size...">ast_filestream</a> on success. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>NULL</em>&nbsp;</td><td>on failure. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="file_8c_source.html#l01033">1033</a> of file <a class="el" href="file_8c_source.html">file.c</a>.</p>

<p>References <a class="el" href="file_8c_source.html#l00887">ast_closestream()</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="astmm_8h_source.html#l00081">ast_malloc</a>, <a class="el" href="options_8h_source.html#l00110">ast_opt_cache_record_files</a>, <a class="el" href="linkedlists_8h_source.html#l00077">AST_RWLIST_RDLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00493">AST_RWLIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="adsistub_8c_source.html#l00059">buf</a>, <a class="el" href="file_8c_source.html#l00252">build_filename()</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="mod__format_8h_source.html#l00045">ast_format::exts</a>, <a class="el" href="file_8c_source.html#l00276">exts_compare()</a>, <a class="el" href="mod__format_8h_source.html#l00115">ast_filestream::f</a>, <a class="el" href="format__g726_8c_source.html#l00177">f</a>, <a class="el" href="mod__format_8h_source.html#l00105">ast_filestream::filename</a>, <a class="el" href="mod__format_8h_source.html#l00103">ast_filestream::flags</a>, <a class="el" href="mod__format_8h_source.html#l00102">ast_filestream::fmt</a>, <a class="el" href="file_8c_source.html#l00339">get_filestream()</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="mod__format_8h_source.html#l00104">ast_filestream::mode</a>, <a class="el" href="mod__format_8h_source.html#l00106">ast_filestream::realfilename</a>, <a class="el" href="asterisk_8c_source.html#l00188">record_cache_dir</a>, <a class="el" href="file_8c_source.html#l00381">rewrite_wrapper()</a>, <a class="el" href="structast__format.html#ace04d77265c68620f1f1f7c2c4eb4123">ast_format::seek</a>, <a class="el" href="mod__format_8h_source.html#l00110">ast_filestream::trans</a>, <a class="el" href="mod__format_8h_source.html#l00108">ast_filestream::vfs</a>, and <a class="el" href="mod__format_8h_source.html#l00120">ast_filestream::write_buffer</a>.</p>

<p>Referenced by <a class="el" href="app_8c_source.html#l00668">__ast_play_and_record()</a>, <a class="el" href="res__monitor_8c_source.html#l00148">ast_monitor_start()</a>, <a class="el" href="file_8c_source.html#l00144">ast_writestream()</a>, <a class="el" href="app__dictate_8c_source.html#l00084">dictate_exec()</a>, <a class="el" href="res__convert_8c_source.html#l00062">handle_cli_file_convert()</a>, <a class="el" href="res__agi_8c_source.html#l01494">handle_recordfile()</a>, <a class="el" href="app__mixmonitor_8c_source.html#l00280">mixmonitor_thread()</a>, <a class="el" href="app__record_8c_source.html#l00132">record_exec()</a>, <a class="el" href="app__meetme_8c_source.html#l04359">recordthread()</a>, and <a class="el" href="app__rpt_8c_source.html#l10730">rpt()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01034"></a>01034 {
<a name="l01035"></a>01035    <span class="keywordtype">int</span> fd, myflags = 0;
<a name="l01036"></a>01036    <span class="comment">/* compiler claims this variable can be used before initialization... */</span>
<a name="l01037"></a>01037    FILE *bfile = NULL;
<a name="l01038"></a>01038    <span class="keyword">struct </span><a class="code" href="structast__format.html" title="Each supported file format is described by the following structure.">ast_format</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l01039"></a>01039    <span class="keyword">struct </span><a class="code" href="structast__filestream.html" title="This structure is allocated by file.c in one chunk, together with buf_size and desc_size...">ast_filestream</a> *fs = NULL;
<a name="l01040"></a>01040    <span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a> = NULL;
<a name="l01041"></a>01041    <span class="keywordtype">size_t</span> size = 0;
<a name="l01042"></a>01042    <span class="keywordtype">int</span> format_found = 0;
<a name="l01043"></a>01043 
<a name="l01044"></a>01044    <a class="code" href="linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc" title="Read locks a list.">AST_RWLIST_RDLOCK</a>(&amp;<a class="code" href="structformats.html">formats</a>);
<a name="l01045"></a>01045 
<a name="l01046"></a>01046    <span class="comment">/* set the O_TRUNC flag if and only if there is no O_APPEND specified */</span>
<a name="l01047"></a>01047    <span class="comment">/* We really can&apos;t use O_APPEND as it will break WAV header updates */</span>
<a name="l01048"></a>01048    <span class="keywordflow">if</span> (<a class="code" href="structast__filestream.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> &amp; O_APPEND) { 
<a name="l01049"></a>01049       <a class="code" href="structast__filestream.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> &amp;= ~O_APPEND;
<a name="l01050"></a>01050    } <span class="keywordflow">else</span> {
<a name="l01051"></a>01051       myflags = O_TRUNC;
<a name="l01052"></a>01052    }
<a name="l01053"></a>01053    
<a name="l01054"></a>01054    myflags |= O_WRONLY | O_CREAT;
<a name="l01055"></a>01055 
<a name="l01056"></a>01056    <span class="comment">/* XXX need to fix this - we should just do the fopen,</span>
<a name="l01057"></a>01057 <span class="comment">    * not open followed by fdopen()</span>
<a name="l01058"></a>01058 <span class="comment">    */</span>
<a name="l01059"></a>01059    <a class="code" href="linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;<a class="code" href="structformats.html">formats</a>, f, list) {
<a name="l01060"></a>01060       <span class="keywordtype">char</span> *fn, *orig_fn = NULL;
<a name="l01061"></a>01061       <span class="keywordflow">if</span> (fs)
<a name="l01062"></a>01062          <span class="keywordflow">break</span>;
<a name="l01063"></a>01063 
<a name="l01064"></a>01064       <span class="keywordflow">if</span> (!<a class="code" href="file_8c.html#a553ad7eb5306fd161fae25fa17c665ef">exts_compare</a>(f-&gt;<a class="code" href="structast__format.html#ade71f534a49925f1955a1598556219e2">exts</a>, <a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>))
<a name="l01065"></a>01065          <span class="keywordflow">continue</span>;
<a name="l01066"></a>01066       <span class="keywordflow">else</span>
<a name="l01067"></a>01067          format_found = 1;
<a name="l01068"></a>01068 
<a name="l01069"></a>01069       fn = <a class="code" href="file_8c.html#a2a836416f6627399f3b75ef2705bcd89" title="construct a filename. Absolute pathnames are preserved, relative names are prefixed...">build_filename</a>(<a class="code" href="structast__filestream.html#aeac90097f29f7529968697163cea5c18">filename</a>, <a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>);
<a name="l01070"></a>01070       fd = open(fn, <a class="code" href="structast__filestream.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> | myflags, <a class="code" href="structast__filestream.html#adc8d3cf511ceb277aea0cfa1cd027c59">mode</a>);
<a name="l01071"></a>01071       <span class="keywordflow">if</span> (fd &gt; -1) {
<a name="l01072"></a>01072          <span class="comment">/* fdopen() the resulting file stream */</span>
<a name="l01073"></a>01073          bfile = fdopen(fd, ((<a class="code" href="structast__filestream.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> | myflags) &amp; O_RDWR) ? <span class="stringliteral">&quot;w+&quot;</span> : <span class="stringliteral">&quot;w&quot;</span>);
<a name="l01074"></a>01074          <span class="keywordflow">if</span> (!bfile) {
<a name="l01075"></a>01075             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Whoa, fdopen failed: %s!\n&quot;</span>, strerror(errno));
<a name="l01076"></a>01076             close(fd);
<a name="l01077"></a>01077             fd = -1;
<a name="l01078"></a>01078          }
<a name="l01079"></a>01079       }
<a name="l01080"></a>01080       
<a name="l01081"></a>01081       <span class="keywordflow">if</span> (<a class="code" href="options_8h.html#a3472349abbba9eb4a158cdf4299bf740">ast_opt_cache_record_files</a> &amp;&amp; (fd &gt; -1)) {
<a name="l01082"></a>01082          <span class="keywordtype">char</span> *c;
<a name="l01083"></a>01083 
<a name="l01084"></a>01084          fclose(bfile); <span class="comment">/* this also closes fd */</span>
<a name="l01085"></a>01085          <span class="comment">/*</span>
<a name="l01086"></a>01086 <span class="comment">           We touch orig_fn just as a place-holder so other things (like vmail) see the file is there.</span>
<a name="l01087"></a>01087 <span class="comment">           What we are really doing is writing to record_cache_dir until we are done then we will mv the file into place.</span>
<a name="l01088"></a>01088 <span class="comment">         */</span>
<a name="l01089"></a>01089          orig_fn = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(fn);
<a name="l01090"></a>01090          <span class="keywordflow">for</span> (c = fn; *c; c++)
<a name="l01091"></a>01091             <span class="keywordflow">if</span> (*c == <span class="charliteral">&apos;/&apos;</span>)
<a name="l01092"></a>01092                *c = <span class="charliteral">&apos;_&apos;</span>;
<a name="l01093"></a>01093 
<a name="l01094"></a>01094          size = strlen(fn) + strlen(<a class="code" href="options_8h.html#a08a845bf43007945cede2f5a6a62225c">record_cache_dir</a>) + 2;
<a name="l01095"></a>01095          buf = alloca(size);
<a name="l01096"></a>01096          strcpy(buf, <a class="code" href="options_8h.html#a08a845bf43007945cede2f5a6a62225c">record_cache_dir</a>);
<a name="l01097"></a>01097          strcat(buf, <span class="stringliteral">&quot;/&quot;</span>);
<a name="l01098"></a>01098          strcat(buf, fn);
<a name="l01099"></a>01099          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(fn);
<a name="l01100"></a>01100          fn = buf;
<a name="l01101"></a>01101          fd = open(fn, <a class="code" href="structast__filestream.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> | myflags, <a class="code" href="structast__filestream.html#adc8d3cf511ceb277aea0cfa1cd027c59">mode</a>);
<a name="l01102"></a>01102          <span class="keywordflow">if</span> (fd &gt; -1) {
<a name="l01103"></a>01103             <span class="comment">/* fdopen() the resulting file stream */</span>
<a name="l01104"></a>01104             bfile = fdopen(fd, ((<a class="code" href="structast__filestream.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> | myflags) &amp; O_RDWR) ? <span class="stringliteral">&quot;w+&quot;</span> : <span class="stringliteral">&quot;w&quot;</span>);
<a name="l01105"></a>01105             <span class="keywordflow">if</span> (!bfile) {
<a name="l01106"></a>01106                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Whoa, fdopen failed: %s!\n&quot;</span>, strerror(errno));
<a name="l01107"></a>01107                close(fd);
<a name="l01108"></a>01108                fd = -1;
<a name="l01109"></a>01109             }
<a name="l01110"></a>01110          }
<a name="l01111"></a>01111       }
<a name="l01112"></a>01112       <span class="keywordflow">if</span> (fd &gt; -1) {
<a name="l01113"></a>01113          <a class="code" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> = 0;
<a name="l01114"></a>01114          fs = <a class="code" href="file_8c.html#a6c638cbfc5c6d1f62231935f80a8986a">get_filestream</a>(f, bfile);
<a name="l01115"></a>01115          <span class="keywordflow">if</span> (!fs || <a class="code" href="file_8c.html#acbe06882238f9fabfff485fefc6fa619">rewrite_wrapper</a>(fs, <a class="code" href="ael__lex_8c.html#a43be22b7a1b528eaf759e034ec581543">comment</a>)) {
<a name="l01116"></a>01116             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to rewrite %s\n&quot;</span>, fn);
<a name="l01117"></a>01117             close(fd);
<a name="l01118"></a>01118             <span class="keywordflow">if</span> (orig_fn) {
<a name="l01119"></a>01119                unlink(fn);
<a name="l01120"></a>01120                unlink(orig_fn);
<a name="l01121"></a>01121             }
<a name="l01122"></a>01122             <span class="keywordflow">if</span> (fs) {
<a name="l01123"></a>01123                <a class="code" href="file_8h.html#ab53bd2c3c55d509790c7f7620aac6373" title="Closes a stream.">ast_closestream</a>(fs);
<a name="l01124"></a>01124                fs = NULL;
<a name="l01125"></a>01125             }
<a name="l01126"></a>01126             <span class="keywordflow">continue</span>;
<a name="l01127"></a>01127          }
<a name="l01128"></a>01128          fs-&gt;<a class="code" href="structast__filestream.html#ad98134a98f3e3e3b5611a5fd2117e8e4">trans</a> = NULL;
<a name="l01129"></a>01129          fs-&gt;<a class="code" href="structast__filestream.html#af4e7a9f36c380991c59c9a49122de100">fmt</a> = f;
<a name="l01130"></a>01130          fs-&gt;<a class="code" href="structast__filestream.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> = <a class="code" href="structast__filestream.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a>;
<a name="l01131"></a>01131          fs-&gt;<a class="code" href="structast__filestream.html#adc8d3cf511ceb277aea0cfa1cd027c59">mode</a> = <a class="code" href="structast__filestream.html#adc8d3cf511ceb277aea0cfa1cd027c59">mode</a>;
<a name="l01132"></a>01132          <span class="keywordflow">if</span> (orig_fn) {
<a name="l01133"></a>01133             fs-&gt;<a class="code" href="structast__filestream.html#a198a1121327381d95b1bb6c501e38333">realfilename</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(orig_fn);
<a name="l01134"></a>01134             fs-&gt;<a class="code" href="structast__filestream.html#aeac90097f29f7529968697163cea5c18">filename</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(fn);
<a name="l01135"></a>01135          } <span class="keywordflow">else</span> {
<a name="l01136"></a>01136             fs-&gt;<a class="code" href="structast__filestream.html#a198a1121327381d95b1bb6c501e38333">realfilename</a> = NULL;
<a name="l01137"></a>01137             fs-&gt;<a class="code" href="structast__filestream.html#aeac90097f29f7529968697163cea5c18">filename</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(<a class="code" href="structast__filestream.html#aeac90097f29f7529968697163cea5c18">filename</a>);
<a name="l01138"></a>01138          }
<a name="l01139"></a>01139          fs-&gt;<a class="code" href="structast__filestream.html#a084d8f087c50442f51245ec3333abac4">vfs</a> = NULL;
<a name="l01140"></a>01140          <span class="comment">/* If truncated, we&apos;ll be at the beginning; if not truncated, then append */</span>
<a name="l01141"></a>01141 
<a name="l01142"></a>01142          <span class="keywordflow">if</span> ((fs-&gt;<a class="code" href="structast__filestream.html#a6de7f628c7786f3686214488c8edfc27">write_buffer</a> = <a class="code" href="astmm_8h.html#a64a0e7a3ab511a3777ac56f5d43c628e">ast_malloc</a>(32768))){
<a name="l01143"></a>01143             setvbuf(fs-&gt;<a class="code" href="structast__filestream.html#a3efb0e1a16208deecbd84c15401f7cf8">f</a>, fs-&gt;<a class="code" href="structast__filestream.html#a6de7f628c7786f3686214488c8edfc27">write_buffer</a>, _IOFBF, 32768);
<a name="l01144"></a>01144          }
<a name="l01145"></a>01145 
<a name="l01146"></a>01146          f-&gt;<a class="code" href="structast__format.html#ace04d77265c68620f1f1f7c2c4eb4123">seek</a>(fs, 0, SEEK_END);
<a name="l01147"></a>01147       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (errno != EEXIST) {
<a name="l01148"></a>01148          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to open file %s: %s\n&quot;</span>, fn, strerror(errno));
<a name="l01149"></a>01149          <span class="keywordflow">if</span> (orig_fn)
<a name="l01150"></a>01150             unlink(orig_fn);
<a name="l01151"></a>01151       }
<a name="l01152"></a>01152       <span class="comment">/* if buf != NULL then fn is already free and pointing to it */</span>
<a name="l01153"></a>01153       <span class="keywordflow">if</span> (!buf)
<a name="l01154"></a>01154          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(fn);
<a name="l01155"></a>01155    }
<a name="l01156"></a>01156 
<a name="l01157"></a>01157    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structformats.html">formats</a>);
<a name="l01158"></a>01158 
<a name="l01159"></a>01159    <span class="keywordflow">if</span> (!format_found)
<a name="l01160"></a>01160       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No such format &apos;%s&apos;\n&quot;</span>, <a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>);
<a name="l01161"></a>01161 
<a name="l01162"></a>01162    <span class="keywordflow">return</span> fs;
<a name="l01163"></a>01163 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3608386b919ef0949d2858cdeb02d12e"></a><!-- doxytag: member="file.h::ast_writestream" ref="a3608386b919ef0949d2858cdeb02d12e" args="(struct ast_filestream *fs, struct ast_frame *f)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_writestream </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__filestream.html">ast_filestream</a> *&nbsp;</td>
          <td class="paramname"> <em>fs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__frame.html">ast_frame</a> *&nbsp;</td>
          <td class="paramname"> <em>f</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Writes a frame to a stream. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fs</em>&nbsp;</td><td>filestream to write to </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>f</em>&nbsp;</td><td>frame to write to the filestream Send a frame to a filestream -- note: does NOT free the frame, call ast_frfree manually </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="file_8c_source.html#l00144">144</a> of file <a class="el" href="file_8c_source.html">file.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="frame_8h_source.html#l00273">AST_FORMAT_AUDIO_MASK</a>, <a class="el" href="frame_8h_source.html#l00103">AST_FRAME_VIDEO</a>, <a class="el" href="frame_8h_source.html#l00101">AST_FRAME_VOICE</a>, <a class="el" href="frame_8h_source.html#l00462">ast_frfree</a>, <a class="el" href="frame_8c_source.html#l00573">ast_getformatname()</a>, <a class="el" href="linkedlists_8h_source.html#l00438">AST_LIST_NEXT</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="translate_8c_source.html#l00308">ast_translate()</a>, <a class="el" href="translate_8c_source.html#l00263">ast_translator_build_path()</a>, <a class="el" href="translate_8c_source.html#l00253">ast_translator_free_path()</a>, <a class="el" href="file_8c_source.html#l01033">ast_writefile()</a>, <a class="el" href="file_8c_source.html#l00144">ast_writestream()</a>, <a class="el" href="mod__format_8h_source.html#l00105">ast_filestream::filename</a>, <a class="el" href="mod__format_8h_source.html#l00103">ast_filestream::flags</a>, <a class="el" href="mod__format_8h_source.html#l00102">ast_filestream::fmt</a>, <a class="el" href="mod__format_8h_source.html#l00047">ast_format::format</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="mod__format_8h_source.html#l00112">ast_filestream::lastwriteformat</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="mod__format_8h_source.html#l00104">ast_filestream::mode</a>, <a class="el" href="mod__format_8h_source.html#l00044">ast_format::name</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, <a class="el" href="mod__format_8h_source.html#l00110">ast_filestream::trans</a>, <a class="el" href="evt_8c_source.html#l00071">type</a>, <a class="el" href="mod__format_8h_source.html#l00108">ast_filestream::vfs</a>, and <a class="el" href="structast__format.html#add47f1ec31efb08853aacc02c294bfb5">ast_format::write</a>.</p>

<p>Referenced by <a class="el" href="app_8c_source.html#l00668">__ast_play_and_record()</a>, <a class="el" href="channel_8c_source.html#l02636">__ast_read()</a>, <a class="el" href="channel_8c_source.html#l03411">ast_write()</a>, <a class="el" href="file_8c_source.html#l00144">ast_writestream()</a>, <a class="el" href="app__dictate_8c_source.html#l00084">dictate_exec()</a>, <a class="el" href="res__convert_8c_source.html#l00062">handle_cli_file_convert()</a>, <a class="el" href="res__agi_8c_source.html#l01494">handle_recordfile()</a>, <a class="el" href="app__mixmonitor_8c_source.html#l00280">mixmonitor_thread()</a>, <a class="el" href="app__record_8c_source.html#l00132">record_exec()</a>, <a class="el" href="app__meetme_8c_source.html#l04359">recordthread()</a>, and <a class="el" href="app__rpt_8c_source.html#l10730">rpt()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00145"></a>00145 {
<a name="l00146"></a>00146    <span class="keywordtype">int</span> res = -1;
<a name="l00147"></a>00147    <span class="keywordtype">int</span> alt = 0;
<a name="l00148"></a>00148    <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0a17ae96b6ea8a2388bb0d409e8124ff30">AST_FRAME_VIDEO</a>) {
<a name="l00149"></a>00149       <span class="keywordflow">if</span> (fs-&gt;<a class="code" href="structast__filestream.html#af4e7a9f36c380991c59c9a49122de100">fmt</a>-&gt;<a class="code" href="structast__format.html#a317afff57d87a89158c2b038d37b2b08">format</a> &amp; <a class="code" href="frame_8h.html#a3f680b9c15596de927d507a664fd2803">AST_FORMAT_AUDIO_MASK</a>) {
<a name="l00150"></a>00150          <span class="comment">/* This is the audio portion.  Call the video one... */</span>
<a name="l00151"></a>00151          <span class="keywordflow">if</span> (!fs-&gt;<a class="code" href="structast__filestream.html#a084d8f087c50442f51245ec3333abac4">vfs</a> &amp;&amp; fs-&gt;<a class="code" href="structast__filestream.html#aeac90097f29f7529968697163cea5c18">filename</a>) {
<a name="l00152"></a>00152             <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a> = <a class="code" href="frame_8h.html#afe8f690984f8ba95cd01a431198c10bf" title="Get the name of a format.">ast_getformatname</a>(f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> &amp; ~0x1);
<a name="l00153"></a>00153             fs-&gt;<a class="code" href="structast__filestream.html#a084d8f087c50442f51245ec3333abac4">vfs</a> = <a class="code" href="file_8h.html#a964f8ef393c07609d7b9e02937faed52" title="Starts writing a file.">ast_writefile</a>(fs-&gt;<a class="code" href="structast__filestream.html#aeac90097f29f7529968697163cea5c18">filename</a>, type, NULL, fs-&gt;<a class="code" href="structast__filestream.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a>, 0, fs-&gt;<a class="code" href="structast__filestream.html#adc8d3cf511ceb277aea0cfa1cd027c59">mode</a>);
<a name="l00154"></a>00154             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Opened video output file\n&quot;</span>);
<a name="l00155"></a>00155          }
<a name="l00156"></a>00156          <span class="keywordflow">if</span> (fs-&gt;<a class="code" href="structast__filestream.html#a084d8f087c50442f51245ec3333abac4">vfs</a>)
<a name="l00157"></a>00157             <span class="keywordflow">return</span> <a class="code" href="file_8h.html#a3608386b919ef0949d2858cdeb02d12e" title="Writes a frame to a stream.">ast_writestream</a>(fs-&gt;<a class="code" href="structast__filestream.html#a084d8f087c50442f51245ec3333abac4">vfs</a>, f);
<a name="l00158"></a>00158          <span class="comment">/* else ignore */</span>
<a name="l00159"></a>00159          <span class="keywordflow">return</span> 0;            
<a name="l00160"></a>00160       } <span class="keywordflow">else</span> {
<a name="l00161"></a>00161          <span class="comment">/* Might / might not have mark set */</span>
<a name="l00162"></a>00162          alt = 1;
<a name="l00163"></a>00163       }
<a name="l00164"></a>00164    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> != <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>) {
<a name="l00165"></a>00165       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Tried to write non-voice frame\n&quot;</span>);
<a name="l00166"></a>00166       <span class="keywordflow">return</span> -1;
<a name="l00167"></a>00167    }
<a name="l00168"></a>00168    <span class="keywordflow">if</span> (((fs-&gt;<a class="code" href="structast__filestream.html#af4e7a9f36c380991c59c9a49122de100">fmt</a>-&gt;<a class="code" href="structast__format.html#a317afff57d87a89158c2b038d37b2b08">format</a> | alt) &amp; f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>) == f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>) {
<a name="l00169"></a>00169       res =  fs-&gt;<a class="code" href="structast__filestream.html#af4e7a9f36c380991c59c9a49122de100">fmt</a>-&gt;<a class="code" href="structast__format.html#add47f1ec31efb08853aacc02c294bfb5">write</a>(fs, f);
<a name="l00170"></a>00170       <span class="keywordflow">if</span> (res &lt; 0) 
<a name="l00171"></a>00171          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Natural write failed\n&quot;</span>);
<a name="l00172"></a>00172       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res &gt; 0)
<a name="l00173"></a>00173          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Huh??\n&quot;</span>);
<a name="l00174"></a>00174    } <span class="keywordflow">else</span> {
<a name="l00175"></a>00175       <span class="comment">/* XXX If they try to send us a type of frame that isn&apos;t the normal frame, and isn&apos;t</span>
<a name="l00176"></a>00176 <span class="comment">             the one we&apos;ve setup a translator for, we do the &quot;wrong thing&quot; XXX */</span>
<a name="l00177"></a>00177       <span class="keywordflow">if</span> (fs-&gt;<a class="code" href="structast__filestream.html#ad98134a98f3e3e3b5611a5fd2117e8e4">trans</a> &amp;&amp; f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> != fs-&gt;<a class="code" href="structast__filestream.html#a5f69e0efa6b940c8909dc7e32a06c95b">lastwriteformat</a>) {
<a name="l00178"></a>00178          <a class="code" href="translate_8h.html#a8f767bf5c2095f182e7cbaa73e391207" title="Frees a translator path Frees the given translator path structure.">ast_translator_free_path</a>(fs-&gt;<a class="code" href="structast__filestream.html#ad98134a98f3e3e3b5611a5fd2117e8e4">trans</a>);
<a name="l00179"></a>00179          fs-&gt;<a class="code" href="structast__filestream.html#ad98134a98f3e3e3b5611a5fd2117e8e4">trans</a> = NULL;
<a name="l00180"></a>00180       }
<a name="l00181"></a>00181       <span class="keywordflow">if</span> (!fs-&gt;<a class="code" href="structast__filestream.html#ad98134a98f3e3e3b5611a5fd2117e8e4">trans</a>) 
<a name="l00182"></a>00182          fs-&gt;<a class="code" href="structast__filestream.html#ad98134a98f3e3e3b5611a5fd2117e8e4">trans</a> = <a class="code" href="translate_8h.html#ae53a058fb0d55f3f0b3264813b50232a" title="Builds a translator path Build a path (possibly NULL) from source to dest.">ast_translator_build_path</a>(fs-&gt;<a class="code" href="structast__filestream.html#af4e7a9f36c380991c59c9a49122de100">fmt</a>-&gt;<a class="code" href="structast__format.html#a317afff57d87a89158c2b038d37b2b08">format</a>, f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>);
<a name="l00183"></a>00183       <span class="keywordflow">if</span> (!fs-&gt;<a class="code" href="structast__filestream.html#ad98134a98f3e3e3b5611a5fd2117e8e4">trans</a>)
<a name="l00184"></a>00184          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to translate to format %s, source format %s\n&quot;</span>,
<a name="l00185"></a>00185             fs-&gt;<a class="code" href="structast__filestream.html#af4e7a9f36c380991c59c9a49122de100">fmt</a>-&gt;<a class="code" href="structast__format.html#a3777dbae63a15da001b2baa317a25149">name</a>, <a class="code" href="frame_8h.html#afe8f690984f8ba95cd01a431198c10bf" title="Get the name of a format.">ast_getformatname</a>(f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>));
<a name="l00186"></a>00186       <span class="keywordflow">else</span> {
<a name="l00187"></a>00187          <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *trf;
<a name="l00188"></a>00188          fs-&gt;<a class="code" href="structast__filestream.html#a5f69e0efa6b940c8909dc7e32a06c95b">lastwriteformat</a> = f-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>;
<a name="l00189"></a>00189          <span class="comment">/* Get the translated frame but don&apos;t consume the original in case they&apos;re using it on another stream */</span>
<a name="l00190"></a>00190          <span class="keywordflow">if</span> ((trf = <a class="code" href="translate_8h.html#ab09d3ccb95d1f828d2871530226f9456" title="translates one or more frames Apply an input frame into the translator and receive...">ast_translate</a>(fs-&gt;<a class="code" href="structast__filestream.html#ad98134a98f3e3e3b5611a5fd2117e8e4">trans</a>, f, 0))) {
<a name="l00191"></a>00191             <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *cur;
<a name="l00192"></a>00192 
<a name="l00193"></a>00193             <span class="comment">/* the translator may have returned multiple frames, so process them */</span>
<a name="l00194"></a>00194             <span class="keywordflow">for</span> (cur = trf; cur; cur = <a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(cur, frame_list)) {
<a name="l00195"></a>00195                <span class="keywordflow">if</span> ((res = fs-&gt;<a class="code" href="structast__filestream.html#af4e7a9f36c380991c59c9a49122de100">fmt</a>-&gt;<a class="code" href="structast__format.html#add47f1ec31efb08853aacc02c294bfb5">write</a>(fs, trf))) {
<a name="l00196"></a>00196                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Translated frame write failed\n&quot;</span>);
<a name="l00197"></a>00197                   <span class="keywordflow">break</span>;
<a name="l00198"></a>00198                }
<a name="l00199"></a>00199             }
<a name="l00200"></a>00200             <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(trf);
<a name="l00201"></a>00201          } <span class="keywordflow">else</span> {
<a name="l00202"></a>00202             res = 0;
<a name="l00203"></a>00203          }
<a name="l00204"></a>00204       }
<a name="l00205"></a>00205    }
<a name="l00206"></a>00206    <span class="keywordflow">return</span> res;
<a name="l00207"></a>00207 }
</pre></div></p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:22:06 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
