<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:21:54 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_afe38fc0ccf2e9eefca5d5c6b03503d9.html">main</a>
  </div>
</div>
<div class="contents">
<h1>cli.c File Reference</h1>
<p>Standard Command Line Interface.  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="asterisk_8h_source.html">asterisk.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="__private_8h_source.html">asterisk/_private.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="paths_8h_source.html">asterisk/paths.h</a>&quot;</code><br/>
<code>#include &lt;sys/signal.h&gt;</code><br/>
<code>#include &lt;signal.h&gt;</code><br/>
<code>#include &lt;ctype.h&gt;</code><br/>
<code>#include &lt;regex.h&gt;</code><br/>
<code>#include &lt;pwd.h&gt;</code><br/>
<code>#include &lt;grp.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="cli_8h_source.html">asterisk/cli.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="linkedlists_8h_source.html">asterisk/linkedlists.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="module_8h_source.html">asterisk/module.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="pbx_8h_source.html">asterisk/pbx.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="channel_8h_source.html">asterisk/channel.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="utils_8h_source.html">asterisk/utils.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="app_8h_source.html">asterisk/app.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="lock_8h_source.html">asterisk/lock.h</a>&quot;</code><br/>
<code>#include &quot;editline/readline/readline.h&quot;</code><br/>
<code>#include &quot;<a class="el" href="threadstorage_8h_source.html">asterisk/threadstorage.h</a>&quot;</code><br/>

<p><a href="cli_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__debug__file.html">ast_debug_file</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">map a debug or verbose value to a filename  <a href="structast__debug__file.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcli__perm.html">cli_perm</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">List of restrictions per <a class="el" href="structuser.html" title="structure to hold users read from users.conf">user</a>.  <a href="structcli__perm.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcli__perm__head.html">cli_perm_head</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcli__perms.html">cli_perms</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">List of <a class="el" href="structusers.html" title="list of users found in the config file">users</a> and permissions.  <a href="structcli__perms.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structdebug__file__list.html">debug_file_list</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structhelpers.html">helpers</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structusergroup__cli__perm.html">usergroup_cli_perm</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">list of <a class="el" href="structusers.html" title="list of users found in the config file">users</a> to apply restrictions.  <a href="structusergroup__cli__perm.html#_details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a36101c4872c2f1497c964aca51661c7f">AST_CLI_INITLEN</a>&nbsp;&nbsp;&nbsp;256</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initial buffer size for resulting strings in <a class="el" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli()</a>.  <a href="#a36101c4872c2f1497c964aca51661c7f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a823f7fdf9a34c2f6664d989c6ec7f5d1">CONCISE_FORMAT_STRING</a>&nbsp;&nbsp;&nbsp;&quot;%s!%s!%s!%d!%s!%s!%s!%s!%s!%d!%s!%s!%s\n&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a509a01c55cbe47386fe24602b7c7fda1">DAY</a>&nbsp;&nbsp;&nbsp;(HOUR*24)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a4610636f10e4604ba296cbf9287b0c7b">FORMAT_STRING</a>&nbsp;&nbsp;&nbsp;&quot;%-25s  %-20s  %-20s\n&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a4610636f10e4604ba296cbf9287b0c7b">FORMAT_STRING</a>&nbsp;&nbsp;&nbsp;&quot;%-20.20s %-20.20s %-7.7s %-30.30s\n&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#ae0d41c71069898a93aa08261e2b751e3">FORMAT_STRING2</a>&nbsp;&nbsp;&nbsp;&quot;%-20.20s %-20.20s %-7.7s %-30.30s\n&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a4698ae12cf6a8acb5886fffd0ec897e6">HOUR</a>&nbsp;&nbsp;&nbsp;(MINUTE*60)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#ac1454fa04f41c693f39425697a137d82">MINUTE</a>&nbsp;&nbsp;&nbsp;(SECOND*60)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a97d3f8deb4e3d6888056cf1149bcc61a">MODLIST_FORMAT</a>&nbsp;&nbsp;&nbsp;&quot;%-30s %-40.40s %-10d\n&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#ab4eccad80b693a6b52fd1706c60fef0e">MODLIST_FORMAT2</a>&nbsp;&nbsp;&nbsp;&quot;%-30s %-40.40s %-10s\n&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a5f8f259f27c085a147c1f3d12dea87a5">NEEDCOMMA</a>(x)&nbsp;&nbsp;&nbsp;((x)? &quot;,&quot;: &quot;&quot;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a94212be2394d2d37d9dfd33d07d82dba">SECOND</a>&nbsp;&nbsp;&nbsp;(1)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#aefb5368e504e2c52d6f040ce7c17e4f7">VERBOSE_FORMAT_STRING</a>&nbsp;&nbsp;&nbsp;&quot;%-20.20s %-20.20s %-16.16s %4d %-7.7s %-12.12s %-25.25s %-15.15s %8.8s %-11.11s %-20.20s\n&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a6db2285a7884aad0dae73e6d6e523703">VERBOSE_FORMAT_STRING2</a>&nbsp;&nbsp;&nbsp;&quot;%-20.20s %-20.20s %-16.16s %-4.4s %-7.7s %-12.12s %-25.25s %-15.15s %8.8s %-11.11s %-20.20s\n&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a4a0cf4182a1661d0eb7a55494a2dd6e5">WEEK</a>&nbsp;&nbsp;&nbsp;(DAY*7)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a5871356500f559add06ea81d60331b1b">YEAR</a>&nbsp;&nbsp;&nbsp;(DAY*365)</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#ad05311723605fd9bf9bcf9ebe05323dc">__ast_cli_generator</a> (const char *<a class="el" href="app__queue_8c.html#a5633b1433389cec21ade3811bbe9ca5b">text</a>, const char *word, int <a class="el" href="structstate.html">state</a>, int <a class="el" href="res__timing__pthread_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#ad74d8c6eeaf21a198049ae7b9f6032f8">__ast_cli_register</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *ed)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#af4b26605236b79438f56ddf82c7bfe4e">__ast_cli_unregister</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *ed)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a8dada33b18dec1f0b09b879f2e11523c">__init_ast_cli_buf</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#aa0cfcd5a898ed77170a7f2c09581d91a">ast_builtins_init</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">initialize the _full_cmd string in * each of the builtins.  <a href="#aa0cfcd5a898ed77170a7f2c09581d91a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a> (int fd, const char *fmt,...)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#aed9a4dab62dbb614240800509ccfac1c">ast_cli_command_full</a> (int uid, int gid, int fd, const char *s)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Interprets a command Interpret a command s, sending output to fd if uid:gid has permissions to run this command. uid = CLI_NO_PERMS to avoid checking <a class="el" href="structuser.html" title="structure to hold users read from users.conf">user</a> permissions gid = CLI_NO_PERMS to avoid checking <a class="el" href="structgroup.html">group</a> permissions.  <a href="#aed9a4dab62dbb614240800509ccfac1c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#ab1d4a1fb19a2a81cc450e1173b346eca">ast_cli_command_multiple_full</a> (int uid, int gid, int fd, size_t size, const char *s)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Executes multiple CLI commands Interpret strings separated by NULL and execute each one, sending output to fd if uid has permissions, uid = CLI_NO_PERMS to avoid checking <a class="el" href="structusers.html" title="list of users found in the config file">users</a> permissions. gid = CLI_NO_PERMS to avoid checking <a class="el" href="structgroup.html">group</a> permissions.  <a href="#ab1d4a1fb19a2a81cc450e1173b346eca"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a398bbbd46cab5e1fe414d43cb1f8e1a8">ast_cli_complete</a> (const char *word, char *const choices[], int <a class="el" href="structstate.html">state</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char **&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a1069d2d27b3c28328ab20ab898c36960">ast_cli_completion_matches</a> (const char *<a class="el" href="app__queue_8c.html#a5633b1433389cec21ade3811bbe9ca5b">text</a>, const char *word)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Generates a NULL-terminated array of strings that 1) begin with the string in the second parameter, and 2) are valid in a command after the string in the first parameter.  <a href="#a1069d2d27b3c28328ab20ab898c36960"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#ab884a0f2d24bec68f1d61564d9f857b9">ast_cli_generator</a> (const char *<a class="el" href="app__queue_8c.html#a5633b1433389cec21ade3811bbe9ca5b">text</a>, const char *word, int <a class="el" href="structstate.html">state</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Readline madness Useful for readline, that's about it.  <a href="#ab884a0f2d24bec68f1d61564d9f857b9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#af0454163e128ba7fdba510bb848f07cb">ast_cli_generatornummatches</a> (const char *<a class="el" href="app__queue_8c.html#a5633b1433389cec21ade3811bbe9ca5b">text</a>, const char *word)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return the <a class="el" href="structnumber.html" title="Number structure.">number</a> of unique matches for the generator.  <a href="#af0454163e128ba7fdba510bb848f07cb"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#ade6dbc4196f2fc99250aaafededfb41b">ast_cli_perms_init</a> (int reload)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a0ca7e108aceb1cd488bb9e3ee26e4ebc">ast_cli_register</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Registers a command or an array of commands.  <a href="#a0ca7e108aceb1cd488bb9e3ee26e4ebc"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#aadeef34f3106bb78aeb3414032ad7fb7">ast_cli_register_multiple</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int len)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Register multiple commands.  <a href="#aadeef34f3106bb78aeb3414032ad7fb7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a3189e6720486808603d13f5d2b58daf4">ast_cli_unregister</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Unregisters a command or an array of commands.  <a href="#a3189e6720486808603d13f5d2b58daf4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a56b6b59ee2eaa994597a5b0f4e9f9d09">ast_cli_unregister_multiple</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int len)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Unregister multiple commands.  <a href="#a56b6b59ee2eaa994597a5b0f4e9f9d09"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a3a116acde8f18aa530e5b4a6df420273">ast_complete_channels</a> (const char *line, const char *word, int pos, int <a class="el" href="structstate.html">state</a>, int rpos)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Command completion for the list of active <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>.  <a href="#a3a116acde8f18aa530e5b4a6df420273"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#aaac45eb83fb2730cac249a509862110d">ast_debug_get_by_file</a> (const char *file)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get the debug level for a file.  <a href="#aaac45eb83fb2730cac249a509862110d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a96552d7ad69aa626b6ab4fa9f93d1b2f">ast_verbose_get_by_file</a> (const char *file)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get the debug level for a file.  <a href="#a96552d7ad69aa626b6ab4fa9f93d1b2f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a97c81620d61e3249bf35cada6df2a088">cli_has_permissions</a> (int uid, int gid, const char *command)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#adac48ec5ae21bd48d7f3dac6c44b2868">cli_next</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#ab71256f27aa5cbbad9931bc2ae9b2e36">complete_fn</a> (const char *word, int <a class="el" href="structstate.html">state</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a7b9a2847dbc64bf8d127b45890e21a89">complete_number</a> (const char *partial, unsigned int min, unsigned int max, int n)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#aa09e50353ce1962ccd90b269e3beb793">destroy_user_perms</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">cleanup (free) <a class="el" href="structcli__perms.html" title="List of users and permissions.">cli_perms</a> linkedlist.  <a href="#aa09e50353ce1962ccd90b269e3beb793"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a8a1ff15e1264d5177e9975142a0e9be8">find_best</a> (char *argv[])</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a7ae95494897a62695433cb697e7fc53b">find_cli</a> (char *const cmds[], int match_type)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__debug__file.html">ast_debug_file</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a765e2a1e8b6f1bb3ab5f6136d3a73564">find_debug_file</a> (const char *fn, unsigned int <a class="el" href="app__rpt_8c.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Find the debug or verbose file setting.  <a href="#a765e2a1e8b6f1bb3ab5f6136d3a73564"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a37dd4151926b835c10cc956f14a47857">group_show_channels</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a864ccd72b72ef6f3e8595bd56d611f5f">handle_chanlist</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a3e8d2dcbe23247ed8025ec7cbc383861">handle_cli_check_permissions</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">handles CLI command 'cli check permissions'  <a href="#a3e8d2dcbe23247ed8025ec7cbc383861"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#ac09450fa9355a3e44c87c1adada60307">handle_cli_reload_permissions</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">handles CLI command 'cli reload permissions'  <a href="#ac09450fa9355a3e44c87c1adada60307"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a11684ce17d4f8b062422b7320eef1015">handle_cli_show_permissions</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">handles CLI command 'cli show permissions'  <a href="#a11684ce17d4f8b062422b7320eef1015"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#ac1db63599c1347e2a626f63499c3c018">handle_commandcomplete</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a6b6e0b5f4ca0072eadaddf04e6334f63">handle_commandmatchesarray</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#ad09ea0d383b50baecfa8d3c828e59a0f">handle_commandnummatches</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#ab1c36f45ca7d85999d12b028d6445662">handle_core_set_debug_channel</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a904ad4d54f223c3e46085fbe746d3891">handle_help</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#ae1d61920ef9c62e876cc6d8ab809ce16">handle_load</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a6271e5ca0474681db9b080dae8c544f4">handle_logger_mute</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a0d2c4cd94a20114dd29790a508b83d99">handle_modlist</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#ade46ebd034310224ed0055553eb89af9">handle_nodebugchan_deprecated</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a22ca8c73dfd64aee98f04d3015c46bf4">handle_reload</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a814d1ddca930627ac11a3b2d824fc62e">handle_showcalls</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a9507ef3d00c28f297846fd44595db1c8">handle_showchan</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#ab1e834548243108d1f0a6ed298451f0e">handle_showuptime</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#ac430b627eac1469fcadb602741d8c247">handle_softhangup</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a066fdc101e74c3d7ec12645a44e48eb9">handle_unload</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a5151d42e59bf1fcba488149926269792">handle_verbose</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a3b12e002bbf802ab6de30c1609838abd">help1</a> (int fd, char *match[], int locked)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">helper for final part of handle_help if locked = 1, assume the list is already locked  <a href="#a3b12e002bbf802ab6de30c1609838abd"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a5e4bb02679737eab93085669c640b778">is_prefix</a> (const char *word, const char *token, int pos, int *actual)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">if word is a valid prefix for token, returns the pos-th match as a malloced string, or NULL otherwise. Always tell in *actual how many matches we got.  <a href="#a5e4bb02679737eab93085669c640b778"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#af1e37c3b4eb5f2c938dff2311d621296">modlist_modentry</a> (const char *module, const char *<a class="el" href="callerid_8c.html#a68344fa88cf4e86b5079fd69a5c22d57">description</a>, int <a class="el" href="chan__unistim_8c.html#a2f8d20b887dab5677a21b650895a0dec">usecnt</a>, const char *like)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#aa19d0e275db21c1821c50b403517d1b1">more_words</a> (char *const *dst)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">returns true if there are more words to match  <a href="#aa19d0e275db21c1821c50b403517d1b1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#ad1176051c0fb523f0e068ff4737f54ce">parse_args</a> (const char *s, int *argc, char *argv[], int max, int *trailingwhitespace)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a39eebea4b2788ae0175ffa54c61fe276">print_uptimestr</a> (int fd, struct timeval timeval, const char *<a class="el" href="res__http__post_8c.html#a6f25bc812d09fedb86bf394c01061c56">prefix</a>, int printsec)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a49eaa638334191d1c0d9e901ed5e59f5">set_full_cmd</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a7e2ed1ce1c57688bd381362ae8918d23">word_match</a> (const char *cmd, const char *cli_word)</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__threadstorage.html">ast_threadstorage</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a2b3ef6f86e718331bfe64b859228e388">ast_cli_buf</a> = { .once = PTHREAD_ONCE_INIT , .key_init = __init_ast_cli_buf , .custom_init = NULL , }</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a4d8f5feeefd2ef02881efa9181b57913">cli_cli</a> []</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a8b908b1af31513eae2e84e5346661d58">cli_default_perm</a> = 1</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Default permissions value 1=Permit 0=Deny.  <a href="#a8b908b1af31513eae2e84e5346661d58"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a895466d470ce2fa13f141e05c81225f6">cli_rsvd</a> [] = &quot;[]{}|*%&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#aa5a37575f5e5a07b25c6ee3107d46008">climodentryfd</a> = -1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="lock_8h.html#a2d9118a2a8939f115eea771bce3a52f2">ast_mutex_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#ac7a1346decd3388ab226f4bddc88189a">climodentrylock</a> = ((<a class="el" href="lock_8h.html#a2d9118a2a8939f115eea771bce3a52f2">ast_mutex_t</a>) PTHREAD_MUTEX_INITIALIZER )</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structdebug__file__list.html">debug_file_list</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#adf077cec50df93f97b46d8b6261c6f04">debug_files</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#ae473ef191024f9043e7388e1a0585791">perms_config</a> [] = &quot;cli_permissions.conf&quot;</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">CLI permissions config file.  <a href="#ae473ef191024f9043e7388e1a0585791"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="lock_8h.html#a2d9118a2a8939f115eea771bce3a52f2">ast_mutex_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#a69909b2c3c4a62443fc781e20ba3ddc5">permsconfiglock</a> = ((<a class="el" href="lock_8h.html#a2d9118a2a8939f115eea771bce3a52f2">ast_mutex_t</a>) PTHREAD_MUTEX_INITIALIZER )</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">mutex used to prevent a <a class="el" href="structuser.html" title="structure to hold users read from users.conf">user</a> from running the 'cli reload permissions' command while it is already running.  <a href="#a69909b2c3c4a62443fc781e20ba3ddc5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structdebug__file__list.html">debug_file_list</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cli_8c.html#afeb8a3babc8d262f1ae1dabacc656b84">verbose_files</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Standard Command Line Interface. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Mark Spencer &lt;<a href="mailto:markster@digium.com">markster@digium.com</a>&gt; </dd></dl>

<p>Definition in file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a36101c4872c2f1497c964aca51661c7f"></a><!-- doxytag: member="cli.c::AST_CLI_INITLEN" ref="a36101c4872c2f1497c964aca51661c7f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_CLI_INITLEN&nbsp;&nbsp;&nbsp;256</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initial buffer size for resulting strings in <a class="el" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli()</a>. </p>

<p>Definition at line <a class="el" href="cli_8c_source.html#l00098">98</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>Referenced by <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>.</p>

</div>
</div>
<a class="anchor" id="a823f7fdf9a34c2f6664d989c6ec7f5d1"></a><!-- doxytag: member="cli.c::CONCISE_FORMAT_STRING" ref="a823f7fdf9a34c2f6664d989c6ec7f5d1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CONCISE_FORMAT_STRING&nbsp;&nbsp;&nbsp;&quot;%s!%s!%s!%d!%s!%s!%s!%s!%s!%d!%s!%s!%s\n&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="cli_8c_source.html#l00790">handle_chanlist()</a>.</p>

</div>
</div>
<a class="anchor" id="a509a01c55cbe47386fe24602b7c7fda1"></a><!-- doxytag: member="cli.c::DAY" ref="a509a01c55cbe47386fe24602b7c7fda1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DAY&nbsp;&nbsp;&nbsp;(HOUR*24)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="cli_8c_source.html#l00605">print_uptimestr()</a>.</p>

</div>
</div>
<a class="anchor" id="a4610636f10e4604ba296cbf9287b0c7b"></a><!-- doxytag: member="cli.c::FORMAT_STRING" ref="a4610636f10e4604ba296cbf9287b0c7b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FORMAT_STRING&nbsp;&nbsp;&nbsp;&quot;%-25s  %-20s  %-20s\n&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a4610636f10e4604ba296cbf9287b0c7b"></a><!-- doxytag: member="cli.c::FORMAT_STRING" ref="a4610636f10e4604ba296cbf9287b0c7b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FORMAT_STRING&nbsp;&nbsp;&nbsp;&quot;%-20.20s %-20.20s %-7.7s %-30.30s\n&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="cli_8c_source.html#l01411">group_show_channels()</a>, and <a class="el" href="cli_8c_source.html#l00790">handle_chanlist()</a>.</p>

</div>
</div>
<a class="anchor" id="ae0d41c71069898a93aa08261e2b751e3"></a><!-- doxytag: member="cli.c::FORMAT_STRING2" ref="ae0d41c71069898a93aa08261e2b751e3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FORMAT_STRING2&nbsp;&nbsp;&nbsp;&quot;%-20.20s %-20.20s %-7.7s %-30.30s\n&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="cli_8c_source.html#l00790">handle_chanlist()</a>.</p>

</div>
</div>
<a class="anchor" id="a4698ae12cf6a8acb5886fffd0ec897e6"></a><!-- doxytag: member="cli.c::HOUR" ref="a4698ae12cf6a8acb5886fffd0ec897e6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HOUR&nbsp;&nbsp;&nbsp;(MINUTE*60)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="cli_8c_source.html#l00605">print_uptimestr()</a>.</p>

</div>
</div>
<a class="anchor" id="ac1454fa04f41c693f39425697a137d82"></a><!-- doxytag: member="cli.c::MINUTE" ref="ac1454fa04f41c693f39425697a137d82" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MINUTE&nbsp;&nbsp;&nbsp;(SECOND*60)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="cli_8c_source.html#l00605">print_uptimestr()</a>.</p>

</div>
</div>
<a class="anchor" id="a97d3f8deb4e3d6888056cf1149bcc61a"></a><!-- doxytag: member="cli.c::MODLIST_FORMAT" ref="a97d3f8deb4e3d6888056cf1149bcc61a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MODLIST_FORMAT&nbsp;&nbsp;&nbsp;&quot;%-30s %-40.40s %-10d\n&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cli_8c_source.html#l00589">589</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>Referenced by <a class="el" href="cli_8c_source.html#l00595">modlist_modentry()</a>.</p>

</div>
</div>
<a class="anchor" id="ab4eccad80b693a6b52fd1706c60fef0e"></a><!-- doxytag: member="cli.c::MODLIST_FORMAT2" ref="ab4eccad80b693a6b52fd1706c60fef0e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MODLIST_FORMAT2&nbsp;&nbsp;&nbsp;&quot;%-30s %-40.40s %-10s\n&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cli_8c_source.html#l00590">590</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>Referenced by <a class="el" href="cli_8c_source.html#l00696">handle_modlist()</a>.</p>

</div>
</div>
<a class="anchor" id="a5f8f259f27c085a147c1f3d12dea87a5"></a><!-- doxytag: member="cli.c::NEEDCOMMA" ref="a5f8f259f27c085a147c1f3d12dea87a5" args="(x)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NEEDCOMMA</td>
          <td>(</td>
          <td class="paramtype">x&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;((x)? &quot;,&quot;: &quot;&quot;)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="cli_8c_source.html#l00605">print_uptimestr()</a>.</p>

</div>
</div>
<a class="anchor" id="a94212be2394d2d37d9dfd33d07d82dba"></a><!-- doxytag: member="cli.c::SECOND" ref="a94212be2394d2d37d9dfd33d07d82dba" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SECOND&nbsp;&nbsp;&nbsp;(1)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="aefb5368e504e2c52d6f040ce7c17e4f7"></a><!-- doxytag: member="cli.c::VERBOSE_FORMAT_STRING" ref="aefb5368e504e2c52d6f040ce7c17e4f7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VERBOSE_FORMAT_STRING&nbsp;&nbsp;&nbsp;&quot;%-20.20s %-20.20s %-16.16s %4d %-7.7s %-12.12s %-25.25s %-15.15s %8.8s %-11.11s %-20.20s\n&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="cli_8c_source.html#l00790">handle_chanlist()</a>.</p>

</div>
</div>
<a class="anchor" id="a6db2285a7884aad0dae73e6d6e523703"></a><!-- doxytag: member="cli.c::VERBOSE_FORMAT_STRING2" ref="a6db2285a7884aad0dae73e6d6e523703" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VERBOSE_FORMAT_STRING2&nbsp;&nbsp;&nbsp;&quot;%-20.20s %-20.20s %-16.16s %-4.4s %-7.7s %-12.12s %-25.25s %-15.15s %8.8s %-11.11s %-20.20s\n&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="cli_8c_source.html#l00790">handle_chanlist()</a>.</p>

</div>
</div>
<a class="anchor" id="a4a0cf4182a1661d0eb7a55494a2dd6e5"></a><!-- doxytag: member="cli.c::WEEK" ref="a4a0cf4182a1661d0eb7a55494a2dd6e5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define WEEK&nbsp;&nbsp;&nbsp;(DAY*7)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="cli_8c_source.html#l00605">print_uptimestr()</a>.</p>

</div>
</div>
<a class="anchor" id="a5871356500f559add06ea81d60331b1b"></a><!-- doxytag: member="cli.c::YEAR" ref="a5871356500f559add06ea81d60331b1b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define YEAR&nbsp;&nbsp;&nbsp;(DAY*365)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="cli_8c_source.html#l00605">print_uptimestr()</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ad05311723605fd9bf9bcf9ebe05323dc"></a><!-- doxytag: member="cli.c::__ast_cli_generator" ref="ad05311723605fd9bf9bcf9ebe05323dc" args="(const char *text, const char *word, int state, int lock)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char * __ast_cli_generator </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>text</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>word</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>lock</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cli_8c_source.html#l02170">2170</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="utils_8c_source.html#l01451">ast_join()</a>, <a class="el" href="cli_8h_source.html#l00049">AST_MAX_ARGS</a>, <a class="el" href="linkedlists_8h_source.html#l00077">AST_RWLIST_RDLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8c_source.html#l00656">cli_next()</a>, <a class="el" href="cli_8h_source.html#l00155">ast_cli_entry::cmda</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="cli_8h_source.html#l00169">ast_cli_entry::handler</a>, <a class="el" href="cli_8c_source.html#l01722">is_prefix()</a>, <a class="el" href="cli_8h_source.html#l00142">ast_cli_args::line</a>, <a class="el" href="cli_8c_source.html#l02157">more_words()</a>, <a class="el" href="cli_8c_source.html#l02026">parse_args()</a>, and <a class="el" href="cli_8c_source.html#l01693">word_match()</a>.</p>

<p>Referenced by <a class="el" href="cli_8c_source.html#l02253">ast_cli_generator()</a>, <a class="el" href="cli_8c_source.html#l01162">handle_commandcomplete()</a>, and <a class="el" href="cli_8c_source.html#l01980">handle_help()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02171"></a>02171 {
<a name="l02172"></a>02172    <span class="keywordtype">char</span> *argv[<a class="code" href="cli_8h.html#a72e6114dccaa5a6f2c8e7d369360db9e">AST_MAX_ARGS</a>];
<a name="l02173"></a>02173    <span class="keyword">struct </span><a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a> *e = NULL;
<a name="l02174"></a>02174    <span class="keywordtype">int</span> x = 0, argindex, matchlen;
<a name="l02175"></a>02175    <span class="keywordtype">int</span> matchnum=0;
<a name="l02176"></a>02176    <span class="keywordtype">char</span> *ret = NULL;
<a name="l02177"></a>02177    <span class="keywordtype">char</span> matchstr[80] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l02178"></a>02178    <span class="keywordtype">int</span> tws = 0;
<a name="l02179"></a>02179    <span class="comment">/* Split the argument into an array of words */</span>
<a name="l02180"></a>02180    <span class="keywordtype">char</span> *duplicate = <a class="code" href="cli_8c.html#ad1176051c0fb523f0e068ff4737f54ce">parse_args</a>(<a class="code" href="app__queue_8c.html#a5633b1433389cec21ade3811bbe9ca5b">text</a>, &amp;x, argv, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(argv), &amp;tws);
<a name="l02181"></a>02181 
<a name="l02182"></a>02182    <span class="keywordflow">if</span> (!duplicate)   <span class="comment">/* malloc error */</span>
<a name="l02183"></a>02183       <span class="keywordflow">return</span> NULL;
<a name="l02184"></a>02184 
<a name="l02185"></a>02185    <span class="comment">/* Compute the index of the last argument (could be an empty string) */</span>
<a name="l02186"></a>02186    argindex = (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="ael_8tab_8c.html#a836535f59bf515522a395858a8029d42">word</a>) &amp;&amp; x&gt;0) ? x-1 : x;
<a name="l02187"></a>02187 
<a name="l02188"></a>02188    <span class="comment">/* rebuild the command, ignore terminating white space and flatten space */</span>
<a name="l02189"></a>02189    <a class="code" href="strings_8h.html#a0c9c27a9e6b4a6d1e2b868525ae3d0c1">ast_join</a>(matchstr, <span class="keyword">sizeof</span>(matchstr)-1, argv);
<a name="l02190"></a>02190    matchlen = strlen(matchstr);
<a name="l02191"></a>02191    <span class="keywordflow">if</span> (tws) {
<a name="l02192"></a>02192       strcat(matchstr, <span class="stringliteral">&quot; &quot;</span>); <span class="comment">/* XXX */</span>
<a name="l02193"></a>02193       <span class="keywordflow">if</span> (matchlen)
<a name="l02194"></a>02194          matchlen++;
<a name="l02195"></a>02195    }
<a name="l02196"></a>02196    <span class="keywordflow">if</span> (<a class="code" href="app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>)
<a name="l02197"></a>02197       <a class="code" href="linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc" title="Read locks a list.">AST_RWLIST_RDLOCK</a>(&amp;<a class="code" href="structhelpers.html">helpers</a>);
<a name="l02198"></a>02198    <span class="keywordflow">while</span> ( (e = <a class="code" href="cli_8c.html#adac48ec5ae21bd48d7f3dac6c44b2868">cli_next</a>(e)) ) {
<a name="l02199"></a>02199       <span class="comment">/* XXX repeated code */</span>
<a name="l02200"></a>02200       <span class="keywordtype">int</span> src = 0, dst = 0, n = 0;
<a name="l02201"></a>02201 
<a name="l02202"></a>02202       <span class="keywordflow">if</span> (e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a>[0] == <span class="charliteral">&apos;_&apos;</span>)
<a name="l02203"></a>02203          <span class="keywordflow">continue</span>;
<a name="l02204"></a>02204 
<a name="l02205"></a>02205       <span class="comment">/*</span>
<a name="l02206"></a>02206 <span class="comment">       * Try to match words, up to and excluding the last word, which</span>
<a name="l02207"></a>02207 <span class="comment">       * is either a blank or something that we want to extend.</span>
<a name="l02208"></a>02208 <span class="comment">       */</span>
<a name="l02209"></a>02209       <span class="keywordflow">for</span> (;src &lt; argindex; dst++, src += n) {
<a name="l02210"></a>02210          n = <a class="code" href="cli_8c.html#a7e2ed1ce1c57688bd381362ae8918d23">word_match</a>(argv[src], e-&gt;<a class="code" href="structast__cli__entry.html#a17db870e4c2bb6e969b89cd6f96c991c">cmda</a>[dst]);
<a name="l02211"></a>02211          <span class="keywordflow">if</span> (n &lt; 0)
<a name="l02212"></a>02212             <span class="keywordflow">break</span>;
<a name="l02213"></a>02213       }
<a name="l02214"></a>02214 
<a name="l02215"></a>02215       <span class="keywordflow">if</span> (src != argindex &amp;&amp; <a class="code" href="cli_8c.html#aa19d0e275db21c1821c50b403517d1b1" title="returns true if there are more words to match">more_words</a>(e-&gt;<a class="code" href="structast__cli__entry.html#a17db870e4c2bb6e969b89cd6f96c991c">cmda</a> + dst))  <span class="comment">/* not a match */</span>
<a name="l02216"></a>02216          <span class="keywordflow">continue</span>;
<a name="l02217"></a>02217       ret = <a class="code" href="cli_8c.html#a5e4bb02679737eab93085669c640b778" title="if word is a valid prefix for token, returns the pos-th match as a malloced string...">is_prefix</a>(argv[src], e-&gt;<a class="code" href="structast__cli__entry.html#a17db870e4c2bb6e969b89cd6f96c991c">cmda</a>[dst], <a class="code" href="structstate.html">state</a> - matchnum, &amp;n);
<a name="l02218"></a>02218       matchnum += n; <span class="comment">/* this many matches here */</span>
<a name="l02219"></a>02219       <span class="keywordflow">if</span> (ret) {
<a name="l02220"></a>02220          <span class="comment">/*</span>
<a name="l02221"></a>02221 <span class="comment">          * argv[src] is a valid prefix of the next word in this</span>
<a name="l02222"></a>02222 <span class="comment">          * command. If this is also the correct entry, return it.</span>
<a name="l02223"></a>02223 <span class="comment">          */</span>
<a name="l02224"></a>02224          <span class="keywordflow">if</span> (matchnum &gt; <a class="code" href="structstate.html">state</a>)
<a name="l02225"></a>02225             <span class="keywordflow">break</span>;
<a name="l02226"></a>02226          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(ret);
<a name="l02227"></a>02227          ret = NULL;
<a name="l02228"></a>02228       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(e-&gt;<a class="code" href="structast__cli__entry.html#a17db870e4c2bb6e969b89cd6f96c991c">cmda</a>[dst])) {
<a name="l02229"></a>02229          <span class="comment">/*</span>
<a name="l02230"></a>02230 <span class="comment">          * This entry is a prefix of the command string entered</span>
<a name="l02231"></a>02231 <span class="comment">          * (only one entry in the list should have this property).</span>
<a name="l02232"></a>02232 <span class="comment">          * Run the generator if one is available. In any case we are done.</span>
<a name="l02233"></a>02233 <span class="comment">          */</span>
<a name="l02234"></a>02234          <span class="keywordflow">if</span> (e-&gt;<a class="code" href="structast__cli__entry.html#af0e07e1d04656663ca8b452904abe99b">handler</a>) { <span class="comment">/* new style command */</span>
<a name="l02235"></a>02235             <span class="keyword">struct </span><a class="code" href="structast__cli__args.html">ast_cli_args</a> a = {
<a name="l02236"></a>02236                .line = matchstr, .word = <a class="code" href="ael_8tab_8c.html#a836535f59bf515522a395858a8029d42">word</a>,
<a name="l02237"></a>02237                .pos = argindex,
<a name="l02238"></a>02238                .n = <a class="code" href="structstate.html">state</a> - matchnum,
<a name="l02239"></a>02239                .argv = argv,
<a name="l02240"></a>02240                .argc = x};
<a name="l02241"></a>02241             ret = e-&gt;<a class="code" href="structast__cli__entry.html#af0e07e1d04656663ca8b452904abe99b">handler</a>(e, <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>, &amp;a);
<a name="l02242"></a>02242          }
<a name="l02243"></a>02243          <span class="keywordflow">if</span> (ret)
<a name="l02244"></a>02244             <span class="keywordflow">break</span>;
<a name="l02245"></a>02245       }
<a name="l02246"></a>02246    }
<a name="l02247"></a>02247    <span class="keywordflow">if</span> (<a class="code" href="app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>)
<a name="l02248"></a>02248       <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structhelpers.html">helpers</a>);
<a name="l02249"></a>02249    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(duplicate);
<a name="l02250"></a>02250    <span class="keywordflow">return</span> ret;
<a name="l02251"></a>02251 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad74d8c6eeaf21a198049ae7b9f6032f8"></a><!-- doxytag: member="cli.c::__ast_cli_register" ref="ad74d8c6eeaf21a198049ae7b9f6032f8" args="(struct ast_cli_entry *e, struct ast_cli_entry *ed)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int __ast_cli_register </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>ed</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cli_8c_source.html#l01857">1857</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00163">ast_cli_entry::_full_cmd</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="cli_8h_source.html#l00047">AST_MAX_CMD_LEN</a>, <a class="el" href="linkedlists_8h_source.html#l00594">AST_RWLIST_INSERT_BEFORE_CURRENT</a>, <a class="el" href="linkedlists_8h_source.html#l00725">AST_RWLIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h_source.html#l00541">AST_RWLIST_TRAVERSE_SAFE_BEGIN</a>, <a class="el" href="linkedlists_8h_source.html#l00601">AST_RWLIST_TRAVERSE_SAFE_END</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, <a class="el" href="strings_8h_source.html#l00092">ast_skip_blanks()</a>, <a class="el" href="strings_8h_source.html#l00131">ast_skip_nonblanks()</a>, <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00155">ast_cli_entry::cmda</a>, <a class="el" href="cli_8h_source.html#l00164">ast_cli_entry::cmdlen</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="cli_8c_source.html#l01772">find_cli()</a>, <a class="el" href="cli_8h_source.html#l00169">ast_cli_entry::handler</a>, <a class="el" href="func__strings_8c_source.html#l00821">len()</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="aesopt_8h_source.html#l00399">s</a>, <a class="el" href="strings_8h_source.html#l00072">S_OR</a>, and <a class="el" href="cli_8c_source.html#l01519">set_full_cmd()</a>.</p>

<p>Referenced by <a class="el" href="cli_8c_source.html#l01919">ast_cli_register()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01858"></a>01858 {
<a name="l01859"></a>01859    <span class="keyword">struct </span><a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a> *cur;
<a name="l01860"></a>01860    <span class="keywordtype">int</span> i, lf, ret = -1;
<a name="l01861"></a>01861 
<a name="l01862"></a>01862    <span class="keyword">struct </span><a class="code" href="structast__cli__args.html">ast_cli_args</a> a;  <span class="comment">/* fake argument */</span>
<a name="l01863"></a>01863    <span class="keywordtype">char</span> **dst = (<span class="keywordtype">char</span> **)e-&gt;<a class="code" href="structast__cli__entry.html#a17db870e4c2bb6e969b89cd6f96c991c">cmda</a>;   <span class="comment">/* need to cast as the entry is readonly */</span>
<a name="l01864"></a>01864    <span class="keywordtype">char</span> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>;
<a name="l01865"></a>01865 
<a name="l01866"></a>01866    memset(&amp;a, <span class="charliteral">&apos;\0&apos;</span>, <span class="keyword">sizeof</span>(a));
<a name="l01867"></a>01867    e-&gt;<a class="code" href="structast__cli__entry.html#af0e07e1d04656663ca8b452904abe99b">handler</a>(e, <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>, &amp;a);
<a name="l01868"></a>01868    <span class="comment">/* XXX check that usage and command are filled up */</span>
<a name="l01869"></a>01869    <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a> = <a class="code" href="strings_8h.html#aba29020090d7b4238027c5746e7ad722" title="Gets a pointer to the first non-whitespace character in a string.">ast_skip_blanks</a>(e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a>);
<a name="l01870"></a>01870    <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a> = e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>);
<a name="l01871"></a>01871    <span class="keywordflow">for</span> (i=0; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>) &amp;&amp; i &lt; <a class="code" href="cli_8h.html#ae88634c402fdd8b46fd5d686dad8bfb9">AST_MAX_CMD_LEN</a>-1; i++) {
<a name="l01872"></a>01872       *dst++ = <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>; <span class="comment">/* store string */</span>
<a name="l01873"></a>01873       <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a> = <a class="code" href="strings_8h.html#a7d452227c6dc0b921257b1dd01853fb8" title="Gets a pointer to first whitespace character in a string.">ast_skip_nonblanks</a>(<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>);
<a name="l01874"></a>01874       <span class="keywordflow">if</span> (*<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a> == <span class="charliteral">&apos;\0&apos;</span>)   <span class="comment">/* we are done */</span>
<a name="l01875"></a>01875          <span class="keywordflow">break</span>;
<a name="l01876"></a>01876       *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>++ = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01877"></a>01877       <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a> = <a class="code" href="strings_8h.html#aba29020090d7b4238027c5746e7ad722" title="Gets a pointer to the first non-whitespace character in a string.">ast_skip_blanks</a>(<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>);
<a name="l01878"></a>01878    }
<a name="l01879"></a>01879    *dst++ = NULL;
<a name="l01880"></a>01880    
<a name="l01881"></a>01881    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structhelpers.html">helpers</a>);
<a name="l01882"></a>01882    
<a name="l01883"></a>01883    <span class="keywordflow">if</span> (<a class="code" href="cli_8c.html#a7ae95494897a62695433cb697e7fc53b">find_cli</a>(e-&gt;<a class="code" href="structast__cli__entry.html#a17db870e4c2bb6e969b89cd6f96c991c">cmda</a>, 1)) {
<a name="l01884"></a>01884       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Command &apos;%s&apos; already registered (or something close enough)\n&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(e-&gt;<a class="code" href="structast__cli__entry.html#ac15e0df3344959107453d9ba01503746">_full_cmd</a>, e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a>));
<a name="l01885"></a>01885       <span class="keywordflow">goto</span> done;
<a name="l01886"></a>01886    }
<a name="l01887"></a>01887    <span class="keywordflow">if</span> (<a class="code" href="cli_8c.html#a49eaa638334191d1c0d9e901ed5e59f5">set_full_cmd</a>(e))
<a name="l01888"></a>01888       <span class="keywordflow">goto</span> done;
<a name="l01889"></a>01889 
<a name="l01890"></a>01890    lf = e-&gt;<a class="code" href="structast__cli__entry.html#a461d5235a36284d30ec1d9fe480a89f2">cmdlen</a>;
<a name="l01891"></a>01891    <a class="code" href="linkedlists_8h.html#a21be6da4b2146b04b4868c2be5cae750">AST_RWLIST_TRAVERSE_SAFE_BEGIN</a>(&amp;<a class="code" href="structhelpers.html">helpers</a>, cur, list) {
<a name="l01892"></a>01892       <span class="keywordtype">int</span> <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> = cur-&gt;<a class="code" href="structast__cli__entry.html#a461d5235a36284d30ec1d9fe480a89f2">cmdlen</a>;
<a name="l01893"></a>01893       <span class="keywordflow">if</span> (lf &lt; len)
<a name="l01894"></a>01894          len = lf;
<a name="l01895"></a>01895       <span class="keywordflow">if</span> (strncasecmp(e-&gt;<a class="code" href="structast__cli__entry.html#ac15e0df3344959107453d9ba01503746">_full_cmd</a>, cur-&gt;<a class="code" href="structast__cli__entry.html#ac15e0df3344959107453d9ba01503746">_full_cmd</a>, len) &lt; 0) {
<a name="l01896"></a>01896          <a class="code" href="linkedlists_8h.html#acf8253a64f9a4e2170454f4bf0559e33">AST_RWLIST_INSERT_BEFORE_CURRENT</a>(e, list); 
<a name="l01897"></a>01897          <span class="keywordflow">break</span>;
<a name="l01898"></a>01898       }
<a name="l01899"></a>01899    }
<a name="l01900"></a>01900    <a class="code" href="linkedlists_8h.html#a6bf0e81cb6ef01532ddebaba68f6de28">AST_RWLIST_TRAVERSE_SAFE_END</a>;
<a name="l01901"></a>01901 
<a name="l01902"></a>01902    <span class="keywordflow">if</span> (!cur)
<a name="l01903"></a>01903       <a class="code" href="linkedlists_8h.html#aadda916488b2d151af4426e2f06ad332">AST_RWLIST_INSERT_TAIL</a>(&amp;<a class="code" href="structhelpers.html">helpers</a>, e, list); 
<a name="l01904"></a>01904    ret = 0; <span class="comment">/* success */</span>
<a name="l01905"></a>01905 
<a name="l01906"></a>01906 done:
<a name="l01907"></a>01907    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structhelpers.html">helpers</a>);
<a name="l01908"></a>01908 
<a name="l01909"></a>01909    <span class="keywordflow">return</span> ret;
<a name="l01910"></a>01910 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af4b26605236b79438f56ddf82c7bfe4e"></a><!-- doxytag: member="cli.c::__ast_cli_unregister" ref="af4b26605236b79438f56ddf82c7bfe4e" args="(struct ast_cli_entry *e, struct ast_cli_entry *ed)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int __ast_cli_unregister </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>ed</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cli_8c_source.html#l01835">1835</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00163">ast_cli_entry::_full_cmd</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="linkedlists_8h_source.html#l00860">AST_RWLIST_REMOVE</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, <a class="el" href="cli_8h_source.html#l00155">ast_cli_entry::cmda</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="cli_8h_source.html#l00169">ast_cli_entry::handler</a>, <a class="el" href="cli_8h_source.html#l00161">ast_cli_entry::inuse</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, and <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>.</p>

<p>Referenced by <a class="el" href="cli_8c_source.html#l01913">ast_cli_unregister()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01836"></a>01836 {
<a name="l01837"></a>01837    <span class="keywordflow">if</span> (e-&gt;<a class="code" href="structast__cli__entry.html#a679cabe3b846f2e363f43d8e57433834">inuse</a>) {
<a name="l01838"></a>01838       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Can&apos;t remove command that is in use\n&quot;</span>);
<a name="l01839"></a>01839    } <span class="keywordflow">else</span> {
<a name="l01840"></a>01840       <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structhelpers.html">helpers</a>);
<a name="l01841"></a>01841       <a class="code" href="linkedlists_8h.html#a6091f0518f8b6f443fd9f5150f3ac407">AST_RWLIST_REMOVE</a>(&amp;<a class="code" href="structhelpers.html">helpers</a>, e, list);
<a name="l01842"></a>01842       <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structhelpers.html">helpers</a>);
<a name="l01843"></a>01843       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(e-&gt;<a class="code" href="structast__cli__entry.html#ac15e0df3344959107453d9ba01503746">_full_cmd</a>);
<a name="l01844"></a>01844       e-&gt;<a class="code" href="structast__cli__entry.html#ac15e0df3344959107453d9ba01503746">_full_cmd</a> = NULL;
<a name="l01845"></a>01845       <span class="keywordflow">if</span> (e-&gt;<a class="code" href="structast__cli__entry.html#af0e07e1d04656663ca8b452904abe99b">handler</a>) {
<a name="l01846"></a>01846          <span class="comment">/* this is a new-style entry. Reset fields and free memory. */</span>
<a name="l01847"></a>01847          <span class="keywordtype">char</span> *cmda = (<span class="keywordtype">char</span> *) e-&gt;<a class="code" href="structast__cli__entry.html#a17db870e4c2bb6e969b89cd6f96c991c">cmda</a>;
<a name="l01848"></a>01848          memset(cmda, <span class="charliteral">&apos;\0&apos;</span>, <span class="keyword">sizeof</span>(e-&gt;<a class="code" href="structast__cli__entry.html#a17db870e4c2bb6e969b89cd6f96c991c">cmda</a>));
<a name="l01849"></a>01849          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a>);
<a name="l01850"></a>01850          e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = NULL;
<a name="l01851"></a>01851          e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> = NULL;
<a name="l01852"></a>01852       }
<a name="l01853"></a>01853    }
<a name="l01854"></a>01854    <span class="keywordflow">return</span> 0;
<a name="l01855"></a>01855 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8dada33b18dec1f0b09b879f2e11523c"></a><!-- doxytag: member="cli.c::__init_ast_cli_buf" ref="a8dada33b18dec1f0b09b879f2e11523c" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void __init_ast_cli_buf </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cli_8c_source.html#l00095">95</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00101"></a>00101 {
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa0cfcd5a898ed77170a7f2c09581d91a"></a><!-- doxytag: member="cli.c::ast_builtins_init" ref="aa0cfcd5a898ed77170a7f2c09581d91a" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_builtins_init </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>initialize the _full_cmd string in * each of the builtins. </p>
<p>Provided by <a class="el" href="cli_8c.html" title="Standard Command Line Interface.">cli.c</a> </p>

<p>Definition at line <a class="el" href="cli_8c_source.html#l01677">1677</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, and <a class="el" href="cli_8c_source.html#l01927">ast_cli_register_multiple()</a>.</p>

<p>Referenced by <a class="el" href="asterisk_8c_source.html#l03095">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01678"></a>01678 {
<a name="l01679"></a>01679    <a class="code" href="cli_8h.html#aadeef34f3106bb78aeb3414032ad7fb7" title="Register multiple commands.">ast_cli_register_multiple</a>(<a class="code" href="cli_8c.html#a4d8f5feeefd2ef02881efa9181b57913">cli_cli</a>, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="cli_8c.html#a4d8f5feeefd2ef02881efa9181b57913">cli_cli</a>));
<a name="l01680"></a>01680 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a791bf9f5637185bee5e8f0907c762130"></a><!-- doxytag: member="cli.c::ast_cli" ref="a791bf9f5637185bee5e8f0907c762130" args="(int fd, const char *fmt,...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_cli </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>...</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cli_8c_source.html#l00100">100</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="utils_8c_source.html#l01113">ast_carefulwrite()</a>, <a class="el" href="cli_8c_source.html#l00098">AST_CLI_INITLEN</a>, <a class="el" href="strings_8h_source.html#l00671">AST_DYNSTR_BUILD_FAILED</a>, <a class="el" href="strings_8h_source.html#l00488">ast_str_buffer()</a>, <a class="el" href="strings_8h_source.html#l00754">ast_str_set_va()</a>, <a class="el" href="strings_8h_source.html#l00466">ast_str_strlen()</a>, <a class="el" href="strings_8h_source.html#l00637">ast_str_thread_get()</a>, and <a class="el" href="adsistub_8c_source.html#l00059">buf</a>.</p>

<p>Referenced by <a class="el" href="chan__iax2_8c_source.html#l06324">__iax2_show_peers()</a>, <a class="el" href="app__playback_8c_source.html#l00380">__say_cli_init()</a>, <a class="el" href="chan__sip_8c_source.html#l15264">_sip_qualify_peer()</a>, <a class="el" href="chan__sip_8c_source.html#l15349">_sip_show_peer()</a>, <a class="el" href="chan__sip_8c_source.html#l14666">_sip_show_peers()</a>, <a class="el" href="chan__skinny_8c_source.html#l03063">_skinny_show_device()</a>, <a class="el" href="chan__skinny_8c_source.html#l02945">_skinny_show_devices()</a>, <a class="el" href="chan__skinny_8c_source.html#l03337">_skinny_show_line()</a>, <a class="el" href="chan__skinny_8c_source.html#l03202">_skinny_show_lines()</a>, <a class="el" href="chan__agent_8c_source.html#l01730">agent_logoff_cmd()</a>, <a class="el" href="chan__agent_8c_source.html#l01817">agents_show()</a>, <a class="el" href="chan__agent_8c_source.html#l01895">agents_show_online()</a>, <a class="el" href="clm_8c_source.html#l00072">ais_clm_show_members()</a>, <a class="el" href="evt_8c_source.html#l00242">ais_evt_show_event_channels()</a>, <a class="el" href="res__jabber_8c_source.html#l02482">aji_do_reload()</a>, <a class="el" href="res__jabber_8c_source.html#l02442">aji_do_set_debug()</a>, <a class="el" href="res__jabber_8c_source.html#l02549">aji_show_buddies()</a>, <a class="el" href="res__jabber_8c_source.html#l02504">aji_show_clients()</a>, <a class="el" href="res__jabber_8c_source.html#l02595">aji_test()</a>, <a class="el" href="res__clialiases_8c_source.html#l00137">alias_show()</a>, <a class="el" href="cli_8c_source.html#l02258">ast_cli_command_full()</a>, <a class="el" href="chan__iax2_8c_source.html#l06891">ast_cli_netstats()</a>, <a class="el" href="asterisk_8c_source.html#l01071">ast_console_toggle_mute()</a>, <a class="el" href="chan__console_8c_source.html#l01146">cli_console_active()</a>, <a class="el" href="chan__console_8c_source.html#l01026">cli_console_answer()</a>, <a class="el" href="chan__console_8c_source.html#l00683">cli_console_autoanswer()</a>, <a class="el" href="chan__console_8c_source.html#l00768">cli_console_dial()</a>, <a class="el" href="chan__console_8c_source.html#l00731">cli_console_flash()</a>, <a class="el" href="chan__console_8c_source.html#l00842">cli_console_hangup()</a>, <a class="el" href="chan__console_8c_source.html#l00878">cli_console_mute()</a>, <a class="el" href="chan__console_8c_source.html#l01076">cli_console_sendtext()</a>, <a class="el" href="chan__console_8c_source.html#l00917">cli_list_available()</a>, <a class="el" href="chan__console_8c_source.html#l00965">cli_list_devices()</a>, <a class="el" href="pbx_8c_source.html#l01523">cli_match_char_tree()</a>, <a class="el" href="func__odbc_8c_source.html#l00978">cli_odbc_read()</a>, <a class="el" href="func__odbc_8c_source.html#l01177">cli_odbc_write()</a>, <a class="el" href="res__realtime_8c_source.html#l00206">cli_realtime_destroy()</a>, <a class="el" href="res__realtime_8c_source.html#l00043">cli_realtime_load()</a>, <a class="el" href="res__realtime_8c_source.html#l00161">cli_realtime_store()</a>, <a class="el" href="res__realtime_8c_source.html#l00081">cli_realtime_update()</a>, <a class="el" href="res__realtime_8c_source.html#l00114">cli_realtime_update2()</a>, <a class="el" href="taskprocessor_8c_source.html#l00189">cli_tps_ping()</a>, <a class="el" href="taskprocessor_8c_source.html#l00235">cli_tps_report()</a>, <a class="el" href="chan__oss_8c_source.html#l01195">console_active()</a>, <a class="el" href="chan__alsa_8c_source.html#l00645">console_answer()</a>, <a class="el" href="chan__alsa_8c_source.html#l00609">console_autoanswer()</a>, <a class="el" href="chan__oss_8c_source.html#l01252">console_boost()</a>, <a class="el" href="chan__oss_8c_source.html#l00868">console_cmd()</a>, <a class="el" href="chan__alsa_8c_source.html#l00779">console_dial()</a>, <a class="el" href="chan__oss_8c_source.html#l00943">console_do_answer()</a>, <a class="el" href="chan__oss_8c_source.html#l01044">console_flash()</a>, <a class="el" href="chan__alsa_8c_source.html#l00741">console_hangup()</a>, <a class="el" href="chan__oss_8c_source.html#l01120">console_mute()</a>, <a class="el" href="chan__alsa_8c_source.html#l00688">console_sendtext()</a>, <a class="el" href="chan__oss_8c_source.html#l01153">console_transfer()</a>, <a class="el" href="chan__dahdi_8c_source.html#l15112">dahdi_set_dnd()</a>, <a class="el" href="chan__dahdi_8c_source.html#l14969">dahdi_set_hwgain()</a>, <a class="el" href="chan__dahdi_8c_source.html#l15038">dahdi_set_swgain()</a>, <a class="el" href="chan__dahdi_8c_source.html#l14609">dahdi_show_channel()</a>, <a class="el" href="chan__dahdi_8c_source.html#l14485">dahdi_show_channels()</a>, <a class="el" href="chan__dahdi_8c_source.html#l14854">dahdi_show_status()</a>, <a class="el" href="chan__dahdi_8c_source.html#l14936">dahdi_show_version()</a>, <a class="el" href="chan__sip_8c_source.html#l14849">dialog_dump_func()</a>, <a class="el" href="app__queue_8c_source.html#l06069">do_print()</a>, <a class="el" href="pbx__dundi_8c_source.html#l02422">dundi_do_lookup()</a>, <a class="el" href="pbx__dundi_8c_source.html#l02476">dundi_do_precache()</a>, <a class="el" href="pbx__dundi_8c_source.html#l02513">dundi_do_query()</a>, <a class="el" href="pbx__dundi_8c_source.html#l02324">dundi_flush()</a>, <a class="el" href="pbx__dundi_8c_source.html#l02271">dundi_set_debug()</a>, <a class="el" href="pbx__dundi_8c_source.html#l02760">dundi_show_entityid()</a>, <a class="el" href="pbx__dundi_8c_source.html#l02814">dundi_show_mappings()</a>, <a class="el" href="pbx__dundi_8c_source.html#l02563">dundi_show_peer()</a>, <a class="el" href="pbx__dundi_8c_source.html#l02636">dundi_show_peers()</a>, <a class="el" href="pbx__dundi_8c_source.html#l02847">dundi_show_precache()</a>, <a class="el" href="pbx__dundi_8c_source.html#l02782">dundi_show_requests()</a>, <a class="el" href="pbx__dundi_8c_source.html#l02731">dundi_show_trans()</a>, <a class="el" href="pbx__dundi_8c_source.html#l02297">dundi_store_history()</a>, <a class="el" href="cli_8c_source.html#l01411">group_show_channels()</a>, <a class="el" href="chan__gtalk_8c_source.html#l01683">gtalk_show_channels()</a>, <a class="el" href="cli_8c_source.html#l00790">handle_chanlist()</a>, <a class="el" href="res__agi_8c_source.html#l01951">handle_cli_agi_debug()</a>, <a class="el" href="res__agi_8c_source.html#l03188">handle_cli_agi_dump_html()</a>, <a class="el" href="res__agi_8c_source.html#l02996">handle_cli_agi_show()</a>, <a class="el" href="cli_8c_source.html#l01004">handle_cli_check_permissions()</a>, <a class="el" href="config_8c_source.html#l02528">handle_cli_config_list()</a>, <a class="el" href="channel_8c_source.html#l00269">handle_cli_core_show_channeltype()</a>, <a class="el" href="channel_8c_source.html#l00203">handle_cli_core_show_channeltypes()</a>, <a class="el" href="config_8c_source.html#l02427">handle_cli_core_show_config_mappings()</a>, <a class="el" href="file_8c_source.html#l01430">handle_cli_core_show_file_formats()</a>, <a class="el" href="translate_8c_source.html#l00518">handle_cli_core_show_translation()</a>, <a class="el" href="db_8c_source.html#l00292">handle_cli_database_del()</a>, <a class="el" href="db_8c_source.html#l00319">handle_cli_database_deltree()</a>, <a class="el" href="db_8c_source.html#l00264">handle_cli_database_get()</a>, <a class="el" href="db_8c_source.html#l00237">handle_cli_database_put()</a>, <a class="el" href="db_8c_source.html#l00350">handle_cli_database_show()</a>, <a class="el" href="db_8c_source.html#l00415">handle_cli_database_showkey()</a>, <a class="el" href="func__devstate_8c_source.html#l00235">handle_cli_devstate_change()</a>, <a class="el" href="func__devstate_8c_source.html#l00191">handle_cli_devstate_list()</a>, <a class="el" href="pbx__config_8c_source.html#l00902">handle_cli_dialplan_add_extension()</a>, <a class="el" href="pbx__config_8c_source.html#l01047">handle_cli_dialplan_add_ignorepat()</a>, <a class="el" href="pbx__config_8c_source.html#l00519">handle_cli_dialplan_add_include()</a>, <a class="el" href="pbx__config_8c_source.html#l01280">handle_cli_dialplan_reload()</a>, <a class="el" href="pbx__config_8c_source.html#l00305">handle_cli_dialplan_remove_extension()</a>, <a class="el" href="pbx__config_8c_source.html#l01148">handle_cli_dialplan_remove_ignorepat()</a>, <a class="el" href="pbx__config_8c_source.html#l00073">handle_cli_dialplan_remove_include()</a>, <a class="el" href="pbx__config_8c_source.html#l00672">handle_cli_dialplan_save()</a>, <a class="el" href="res__convert_8c_source.html#l00062">handle_cli_file_convert()</a>, <a class="el" href="chan__h323_8c_source.html#l02658">handle_cli_h323_set_debug()</a>, <a class="el" href="chan__h323_8c_source.html#l02629">handle_cli_h323_set_trace()</a>, <a class="el" href="chan__iax2_8c_source.html#l11402">handle_cli_iax2_provision()</a>, <a class="el" href="chan__iax2_8c_source.html#l03393">handle_cli_iax2_prune_realtime()</a>, <a class="el" href="chan__iax2_8c_source.html#l06998">handle_cli_iax2_set_debug()</a>, <a class="el" href="chan__iax2_8c_source.html#l07073">handle_cli_iax2_set_debug_jb()</a>, <a class="el" href="chan__iax2_8c_source.html#l07047">handle_cli_iax2_set_debug_trunk()</a>, <a class="el" href="chan__iax2_8c_source.html#l03714">handle_cli_iax2_set_mtu()</a>, <a class="el" href="chan__iax2_8c_source.html#l03755">handle_cli_iax2_show_cache()</a>, <a class="el" href="chan__iax2_8c_source.html#l02374">handle_cli_iax2_show_callno_limits()</a>, <a class="el" href="chan__iax2_8c_source.html#l06825">handle_cli_iax2_show_channels()</a>, <a class="el" href="chan__iax2_8c_source.html#l06623">handle_cli_iax2_show_firmware()</a>, <a class="el" href="chan__iax2_8c_source.html#l06975">handle_cli_iax2_show_netstats()</a>, <a class="el" href="chan__iax2_8c_source.html#l03568">handle_cli_iax2_show_peer()</a>, <a class="el" href="chan__iax2_8c_source.html#l06735">handle_cli_iax2_show_registry()</a>, <a class="el" href="chan__iax2_8c_source.html#l03670">handle_cli_iax2_show_stats()</a>, <a class="el" href="chan__iax2_8c_source.html#l06454">handle_cli_iax2_show_threads()</a>, <a class="el" href="chan__iax2_8c_source.html#l06250">handle_cli_iax2_show_users()</a>, <a class="el" href="chan__iax2_8c_source.html#l06523">handle_cli_iax2_unregister()</a>, <a class="el" href="indications_8c_source.html#l00793">handle_cli_indication_show()</a>, <a class="el" href="res__crypto_8c_source.html#l00498">handle_cli_keys_show()</a>, <a class="el" href="chan__misdn_8c_source.html#l01352">handle_cli_misdn_reload()</a>, <a class="el" href="chan__misdn_8c_source.html#l01763">handle_cli_misdn_send_digit()</a>, <a class="el" href="chan__misdn_8c_source.html#l01858">handle_cli_misdn_send_display()</a>, <a class="el" href="chan__misdn_8c_source.html#l00935">handle_cli_misdn_set_debug()</a>, <a class="el" href="chan__misdn_8c_source.html#l01430">handle_cli_misdn_show_channels()</a>, <a class="el" href="chan__misdn_8c_source.html#l01200">handle_cli_misdn_show_config()</a>, <a class="el" href="chan__misdn_8c_source.html#l01611">handle_cli_misdn_show_port()</a>, <a class="el" href="chan__misdn_8c_source.html#l01582">handle_cli_misdn_show_ports_stats()</a>, <a class="el" href="chan__misdn_8c_source.html#l01552">handle_cli_misdn_show_stacks()</a>, <a class="el" href="chan__misdn_8c_source.html#l01812">handle_cli_misdn_toggle_echocancel()</a>, <a class="el" href="app__mixmonitor_8c_source.html#l00587">handle_cli_mixmonitor()</a>, <a class="el" href="res__musiconhold_8c_source.html#l01717">handle_cli_moh_show_classes()</a>, <a class="el" href="res__musiconhold_8c_source.html#l01679">handle_cli_moh_show_files()</a>, <a class="el" href="res__odbc_8c_source.html#l00871">handle_cli_odbc_show()</a>, <a class="el" href="app__osplookup_8c_source.html#l01863">handle_cli_osp_show()</a>, <a class="el" href="res__config__pgsql_8c_source.html#l01484">handle_cli_realtime_pgsql_cache()</a>, <a class="el" href="res__config__pgsql_8c_source.html#l01538">handle_cli_realtime_pgsql_status()</a>, <a class="el" href="dnsmgr_8c_source.html#l00273">handle_cli_refresh()</a>, <a class="el" href="rtp_8c_source.html#l04644">handle_cli_rtcp_set_debug()</a>, <a class="el" href="rtp_8c_source.html#l04677">handle_cli_rtcp_set_stats()</a>, <a class="el" href="rtp_8c_source.html#l04611">handle_cli_rtp_set_debug()</a>, <a class="el" href="cli_8c_source.html#l00940">handle_cli_show_permissions()</a>, <a class="el" href="res__config__sqlite_8c_source.html#l01663">handle_cli_show_sqlite_status()</a>, <a class="el" href="res__config__sqlite_8c_source.html#l01697">handle_cli_sqlite_show_tables()</a>, <a class="el" href="cdr_8c_source.html#l01314">handle_cli_status()</a>, <a class="el" href="rtp_8c_source.html#l04704">handle_cli_stun_set_debug()</a>, <a class="el" href="cdr_8c_source.html#l01372">handle_cli_submit()</a>, <a class="el" href="codec__dahdi_8c_source.html#l00133">handle_cli_transcoder_show()</a>, <a class="el" href="udptl_8c_source.html#l01275">handle_cli_udptl_set_debug()</a>, <a class="el" href="res__limit_8c_source.html#l00101">handle_cli_ulimit()</a>, <a class="el" href="cli_8c_source.html#l01162">handle_commandcomplete()</a>, <a class="el" href="cli_8c_source.html#l01081">handle_commandmatchesarray()</a>, <a class="el" href="cli_8c_source.html#l01136">handle_commandnummatches()</a>, <a class="el" href="cli_8c_source.html#l01187">handle_core_set_debug_channel()</a>, <a class="el" href="image_8c_source.html#l00169">handle_core_show_image_formats()</a>, <a class="el" href="chan__dahdi_8c_source.html#l14817">handle_dahdi_show_cadences()</a>, <a class="el" href="pbx_8c_source.html#l05892">handle_debug_dialplan()</a>, <a class="el" href="features_8c_source.html#l04019">handle_feature_show()</a>, <a class="el" href="cli_8c_source.html#l01980">handle_help()</a>, <a class="el" href="cli_8c_source.html#l00244">handle_load()</a>, <a class="el" href="logger_8c_source.html#l00694">handle_logger_reload()</a>, <a class="el" href="logger_8c_source.html#l00713">handle_logger_rotate()</a>, <a class="el" href="logger_8c_source.html#l00732">handle_logger_set_level()</a>, <a class="el" href="logger_8c_source.html#l00771">handle_logger_show_channels()</a>, <a class="el" href="manager_8c_source.html#l00565">handle_mandebug()</a>, <a class="el" href="astmm_8c_source.html#l00325">handle_memory_show()</a>, <a class="el" href="astmm_8c_source.html#l00387">handle_memory_show_summary()</a>, <a class="el" href="chan__mgcp_8c_source.html#l01077">handle_mgcp_audit_endpoint()</a>, <a class="el" href="chan__mgcp_8c_source.html#l01142">handle_mgcp_set_debug()</a>, <a class="el" href="chan__mgcp_8c_source.html#l01037">handle_mgcp_show_endpoints()</a>, <a class="el" href="app__minivm_8c_source.html#l02714">handle_minivm_list_templates()</a>, <a class="el" href="app__minivm_8c_source.html#l03303">handle_minivm_reload()</a>, <a class="el" href="app__minivm_8c_source.html#l02865">handle_minivm_show_settings()</a>, <a class="el" href="app__minivm_8c_source.html#l02897">handle_minivm_show_stats()</a>, <a class="el" href="app__minivm_8c_source.html#l02780">handle_minivm_show_users()</a>, <a class="el" href="app__minivm_8c_source.html#l02828">handle_minivm_show_zones()</a>, <a class="el" href="cli_8c_source.html#l00696">handle_modlist()</a>, <a class="el" href="features_8c_source.html#l04276">handle_parkedcalls()</a>, <a class="el" href="app__queue_8c_source.html#l06699">handle_queue_add_member()</a>, <a class="el" href="app__queue_8c_source.html#l06883">handle_queue_pause_member()</a>, <a class="el" href="app__queue_8c_source.html#l06818">handle_queue_remove_member()</a>, <a class="el" href="app__queue_8c_source.html#l07019">handle_queue_rule_show()</a>, <a class="el" href="app__queue_8c_source.html#l06957">handle_queue_set_member_penalty()</a>, <a class="el" href="res__clioriginate_8c_source.html#l00175">handle_redirect()</a>, <a class="el" href="cli_8c_source.html#l00269">handle_reload()</a>, <a class="el" href="asterisk_8c_source.html#l01900">handle_restart_when_convenient()</a>, <a class="el" href="pbx_8c_source.html#l06269">handle_set_chanvar()</a>, <a class="el" href="pbx_8c_source.html#l06304">handle_set_extenpatternmatchnew()</a>, <a class="el" href="pbx_8c_source.html#l06247">handle_set_global()</a>, <a class="el" href="pbx_8c_source.html#l05261">handle_show_application()</a>, <a class="el" href="pbx_8c_source.html#l05481">handle_show_applications()</a>, <a class="el" href="pbx_8c_source.html#l06215">handle_show_chanvar()</a>, <a class="el" href="pbx_8c_source.html#l05825">handle_show_dialplan()</a>, <a class="el" href="pbx_8c_source.html#l03095">handle_show_function()</a>, <a class="el" href="pbx_8c_source.html#l03053">handle_show_functions()</a>, <a class="el" href="pbx_8c_source.html#l06157">handle_show_globals()</a>, <a class="el" href="pbx_8c_source.html#l05397">handle_show_hint()</a>, <a class="el" href="pbx_8c_source.html#l05326">handle_show_hints()</a>, <a class="el" href="http_8c_source.html#l00956">handle_show_http()</a>, <a class="el" href="asterisk_8c_source.html#l00767">handle_show_profile()</a>, <a class="el" href="res__phoneprov_8c_source.html#l01193">handle_show_routes()</a>, <a class="el" href="asterisk_8c_source.html#l00413">handle_show_settings()</a>, <a class="el" href="pbx_8c_source.html#l05449">handle_show_switches()</a>, <a class="el" href="asterisk_8c_source.html#l00488">handle_show_threads()</a>, <a class="el" href="asterisk_8c_source.html#l00831">handle_show_version_files()</a>, <a class="el" href="cli_8c_source.html#l00735">handle_showcalls()</a>, <a class="el" href="cli_8c_source.html#l01268">handle_showchan()</a>, <a class="el" href="manager_8c_source.html#l00588">handle_showmanager()</a>, <a class="el" href="manager_8c_source.html#l00651">handle_showmanagers()</a>, <a class="el" href="manager_8c_source.html#l00518">handle_showmancmd()</a>, <a class="el" href="manager_8c_source.html#l00695">handle_showmancmds()</a>, <a class="el" href="manager_8c_source.html#l00723">handle_showmanconn()</a>, <a class="el" href="manager_8c_source.html#l00758">handle_showmaneventq()</a>, <a class="el" href="chan__skinny_8c_source.html#l02686">handle_skinny_set_debug()</a>, <a class="el" href="chan__skinny_8c_source.html#l03513">handle_skinny_show_settings()</a>, <a class="el" href="cli_8c_source.html#l00912">handle_softhangup()</a>, <a class="el" href="asterisk_8c_source.html#l01840">handle_stop_when_convenient()</a>, <a class="el" href="cli_8c_source.html#l00542">handle_unload()</a>, <a class="el" href="pbx_8c_source.html#l06332">handle_unset_extenpatternmatchnew()</a>, <a class="el" href="cli_8c_source.html#l00361">handle_verbose()</a>, <a class="el" href="asterisk_8c_source.html#l01770">handle_version()</a>, <a class="el" href="app__voicemail_8c_source.html#l10216">handle_voicemail_reload()</a>, <a class="el" href="app__voicemail_8c_source.html#l10106">handle_voicemail_show_users()</a>, <a class="el" href="app__voicemail_8c_source.html#l10180">handle_voicemail_show_zones()</a>, <a class="el" href="cli_8c_source.html#l01951">help1()</a>, <a class="el" href="res__agi_8c_source.html#l02530">help_workhorse()</a>, <a class="el" href="iax2-provision_8c_source.html#l00431">iax_show_provisioning()</a>, <a class="el" href="chan__jingle_8c_source.html#l01513">jingle_show_channels()</a>, <a class="el" href="chan__local_8c_source.html#l00817">locals_show()</a>, <a class="el" href="app__meetme_8c_source.html#l01363">meetme_cmd()</a>, <a class="el" href="app__meetme_8c_source.html#l01209">meetme_show_cmd()</a>, <a class="el" href="cli_8c_source.html#l00595">modlist_modentry()</a>, <a class="el" href="res__clioriginate_8c_source.html#l00050">orig_app()</a>, <a class="el" href="res__clioriginate_8c_source.html#l00080">orig_exten()</a>, <a class="el" href="chan__sip_8c_source.html#l14838">peer_dump_func()</a>, <a class="el" href="pbx_8c_source.html#l05186">print_app_docs()</a>, <a class="el" href="chan__misdn_8c_source.html#l01375">print_bc_info()</a>, <a class="el" href="chan__sip_8c_source.html#l15155">print_codec_to_cli()</a>, <a class="el" href="chan__sip_8c_source.html#l14888">print_group()</a>, <a class="el" href="cli_8c_source.html#l00605">print_uptimestr()</a>, <a class="el" href="chan__usbradio_8c_source.html#l02575">radio_active()</a>, <a class="el" href="chan__usbradio_8c_source.html#l02557">radio_set_debug()</a>, <a class="el" href="chan__usbradio_8c_source.html#l02566">radio_set_debug_off()</a>, <a class="el" href="chan__usbradio_8c_source.html#l02604">radio_set_xpmr_debug()</a>, <a class="el" href="chan__usbradio_8c_source.html#l02285">radio_tune()</a>, <a class="el" href="res__config__ldap_8c_source.html#l01717">realtime_ldap_status()</a>, <a class="el" href="app__rpt_8c_source.html#l03185">rpt_do_cmd()</a>, <a class="el" href="app__rpt_8c_source.html#l02622">rpt_do_debug()</a>, <a class="el" href="app__rpt_8c_source.html#l02644">rpt_do_dump()</a>, <a class="el" href="app__rpt_8c_source.html#l03107">rpt_do_fun()</a>, <a class="el" href="app__rpt_8c_source.html#l03057">rpt_do_local_nodes()</a>, <a class="el" href="app__rpt_8c_source.html#l02917">rpt_do_lstats()</a>, <a class="el" href="app__rpt_8c_source.html#l03007">rpt_do_nodes()</a>, <a class="el" href="app__rpt_8c_source.html#l02667">rpt_do_stats()</a>, <a class="el" href="rtp_8c_source.html#l04581">rtcp_do_debug_ip()</a>, <a class="el" href="rtp_8c_source.html#l04551">rtp_do_debug_ip()</a>, <a class="el" href="chan__sip_8c_source.html#l16189">show_channels_cb()</a>, <a class="el" href="chan__sip_8c_source.html#l15831">show_chanstats_cb()</a>, <a class="el" href="frame_8c_source.html#l00722">show_codec_n()</a>, <a class="el" href="frame_8c_source.html#l00667">show_codecs()</a>, <a class="el" href="chan__misdn_8c_source.html#l01175">show_config_description()</a>, <a class="el" href="pbx_8c_source.html#l05772">show_debug_helper()</a>, <a class="el" href="pbx_8c_source.html#l05621">show_dialplan_helper()</a>, <a class="el" href="asterisk_8c_source.html#l02018">show_license()</a>, <a class="el" href="app__voicemail_8c_source.html#l10042">show_users_realtime()</a>, <a class="el" href="asterisk_8c_source.html#l01981">show_warranty()</a>, <a class="el" href="chan__sip_8c_source.html#l16891">sip_cli_notify()</a>, <a class="el" href="chan__sip_8c_source.html#l16848">sip_do_debug()</a>, <a class="el" href="chan__sip_8c_source.html#l16798">sip_do_debug_ip()</a>, <a class="el" href="chan__sip_8c_source.html#l16827">sip_do_debug_peer()</a>, <a class="el" href="chan__sip_8c_source.html#l15021">sip_prune_realtime()</a>, <a class="el" href="chan__sip_8c_source.html#l16959">sip_set_history()</a>, <a class="el" href="chan__sip_8c_source.html#l16415">sip_show_channel()</a>, <a class="el" href="chan__sip_8c_source.html#l16236">sip_show_channels()</a>, <a class="el" href="chan__sip_8c_source.html#l15890">sip_show_channelstats()</a>, <a class="el" href="chan__sip_8c_source.html#l15186">sip_show_domains()</a>, <a class="el" href="chan__sip_8c_source.html#l16526">sip_show_history()</a>, <a class="el" href="chan__sip_8c_source.html#l14279">sip_show_inuse()</a>, <a class="el" href="chan__sip_8c_source.html#l16120">sip_show_mwi()</a>, <a class="el" href="chan__sip_8c_source.html#l14862">sip_show_objects()</a>, <a class="el" href="chan__sip_8c_source.html#l15748">sip_show_registry()</a>, <a class="el" href="chan__sip_8c_source.html#l15705">sip_show_sched()</a>, <a class="el" href="chan__sip_8c_source.html#l15919">sip_show_settings()</a>, <a class="el" href="chan__sip_8c_source.html#l14450">sip_show_tcp()</a>, <a class="el" href="chan__sip_8c_source.html#l15630">sip_show_user()</a>, <a class="el" href="chan__sip_8c_source.html#l14488">sip_show_users()</a>, <a class="el" href="chan__sip_8c_source.html#l15794">sip_unregister()</a>, <a class="el" href="app__meetme_8c_source.html#l01534">sla_show_stations()</a>, <a class="el" href="app__meetme_8c_source.html#l01469">sla_show_trunks()</a>, <a class="el" href="timing_8c_source.html#l00208">timing_test()</a>, <a class="el" href="chan__usbradio_8c_source.html#l03016">tune_rxctcss()</a>, <a class="el" href="chan__usbradio_8c_source.html#l02870">tune_rxinput()</a>, <a class="el" href="chan__usbradio_8c_source.html#l02950">tune_rxvoice()</a>, <a class="el" href="chan__usbradio_8c_source.html#l02856">tune_txoutput()</a>, <a class="el" href="chan__unistim_8c_source.html#l04803">unistim_do_debug()</a>, <a class="el" href="chan__unistim_8c_source.html#l04673">unistim_info()</a>, and <a class="el" href="chan__unistim_8c_source.html#l04743">unistim_sp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00101"></a>00101 {
<a name="l00102"></a>00102    <span class="keywordtype">int</span> res;
<a name="l00103"></a>00103    <span class="keyword">struct </span><a class="code" href="structast__str.html" title="The descriptor of a dynamic string XXX storage will be optimized later if needed...">ast_str</a> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>;
<a name="l00104"></a>00104    va_list ap;
<a name="l00105"></a>00105 
<a name="l00106"></a>00106    <span class="keywordflow">if</span> (!(buf = <a class="code" href="strings_8h.html#affe8ca3cf8ee9ab07fe29d11bc824ac4" title="Retrieve a thread locally stored dynamic string.">ast_str_thread_get</a>(&amp;<a class="code" href="cli_8c.html#a2b3ef6f86e718331bfe64b859228e388">ast_cli_buf</a>, <a class="code" href="cli_8c.html#a36101c4872c2f1497c964aca51661c7f" title="Initial buffer size for resulting strings in ast_cli().">AST_CLI_INITLEN</a>)))
<a name="l00107"></a>00107       <span class="keywordflow">return</span>;
<a name="l00108"></a>00108 
<a name="l00109"></a>00109    va_start(ap, fmt);
<a name="l00110"></a>00110    res = <a class="code" href="strings_8h.html#a7ce3f97dd6d3f76f92304c1f5066c77b" title="Set a dynamic string from a va_list.">ast_str_set_va</a>(&amp;buf, 0, fmt, ap);
<a name="l00111"></a>00111    va_end(ap);
<a name="l00112"></a>00112 
<a name="l00113"></a>00113    <span class="keywordflow">if</span> (res != <a class="code" href="strings_8h.html#a1e06e534e565b0e44afdf96c77951725a46fbdfa757aef01471bab9679ce4281f">AST_DYNSTR_BUILD_FAILED</a>) {
<a name="l00114"></a>00114       <a class="code" href="utils_8h.html#a38faf2987c375335b2773964aabf69b3" title="Try to write string, but wait no more than ms milliseconds before timing out.">ast_carefulwrite</a>(fd, <a class="code" href="strings_8h.html#a053bdfc229997a75f112bdd7b995e00b" title="Returns the string buffer within the ast_str buf.">ast_str_buffer</a>(buf), <a class="code" href="strings_8h.html#a99409c17a1d20e1c3dc00039b7925a2d" title="Returns the current length of the string stored within buf.">ast_str_strlen</a>(buf), 100);
<a name="l00115"></a>00115    }
<a name="l00116"></a>00116 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aed9a4dab62dbb614240800509ccfac1c"></a><!-- doxytag: member="cli.c::ast_cli_command_full" ref="aed9a4dab62dbb614240800509ccfac1c" args="(int uid, int gid, int fd, const char *s)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_cli_command_full </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>uid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>gid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>s</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Interprets a command Interpret a command s, sending output to fd if uid:gid has permissions to run this command. uid = CLI_NO_PERMS to avoid checking <a class="el" href="structuser.html" title="structure to hold users read from users.conf">user</a> permissions gid = CLI_NO_PERMS to avoid checking <a class="el" href="structgroup.html">group</a> permissions. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>uid</em>&nbsp;</td><td>User ID that is trying to run the command. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>gid</em>&nbsp;</td><td>Group ID that is trying to run the command. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fd</em>&nbsp;</td><td>pipe </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>s</em>&nbsp;</td><td>incoming string </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="cli_8c_source.html#l02258">2258</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l01964">ast_atomic_fetchadd_int()</a>, <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="utils_8c_source.html#l01451">ast_join()</a>, <a class="el" href="cli_8h_source.html#l00049">AST_MAX_ARGS</a>, <a class="el" href="linkedlists_8h_source.html#l00077">AST_RWLIST_RDLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="cli_8h_source.html#l00045">CLI_FAILURE</a>, <a class="el" href="cli_8h_source.html#l00134">CLI_HANDLER</a>, <a class="el" href="cli_8c_source.html#l00165">cli_has_permissions()</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, <a class="el" href="cli_8c_source.html#l01816">find_best()</a>, <a class="el" href="cli_8c_source.html#l01772">find_cli()</a>, <a class="el" href="cli_8h_source.html#l00169">ast_cli_entry::handler</a>, <a class="el" href="cli_8h_source.html#l00161">ast_cli_entry::inuse</a>, <a class="el" href="cli_8c_source.html#l02026">parse_args()</a>, <a class="el" href="strings_8h_source.html#l00072">S_OR</a>, and <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>.</p>

<p>Referenced by <a class="el" href="cli_8c_source.html#l02313">ast_cli_command_multiple_full()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02259"></a>02259 {
<a name="l02260"></a>02260    <span class="keywordtype">char</span> *args[<a class="code" href="cli_8h.html#a72e6114dccaa5a6f2c8e7d369360db9e">AST_MAX_ARGS</a> + 1];
<a name="l02261"></a>02261    <span class="keyword">struct </span><a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a> *e;
<a name="l02262"></a>02262    <span class="keywordtype">int</span> x;
<a name="l02263"></a>02263    <span class="keywordtype">char</span> *duplicate = <a class="code" href="cli_8c.html#ad1176051c0fb523f0e068ff4737f54ce">parse_args</a>(<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>, &amp;x, args + 1, <a class="code" href="cli_8h.html#a72e6114dccaa5a6f2c8e7d369360db9e">AST_MAX_ARGS</a>, NULL);
<a name="l02264"></a>02264    <span class="keywordtype">char</span> tmp[<a class="code" href="cli_8h.html#a72e6114dccaa5a6f2c8e7d369360db9e">AST_MAX_ARGS</a> + 1];
<a name="l02265"></a>02265    <span class="keywordtype">char</span> *retval = NULL;
<a name="l02266"></a>02266    <span class="keyword">struct </span><a class="code" href="structast__cli__args.html">ast_cli_args</a> a = {
<a name="l02267"></a>02267       .fd = <a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, .argc = x, .argv = args+1 };
<a name="l02268"></a>02268 
<a name="l02269"></a>02269    <span class="keywordflow">if</span> (duplicate == NULL)
<a name="l02270"></a>02270       <span class="keywordflow">return</span> -1;
<a name="l02271"></a>02271 
<a name="l02272"></a>02272    <span class="keywordflow">if</span> (x &lt; 1)  <span class="comment">/* We need at least one entry, otherwise ignore */</span>
<a name="l02273"></a>02273       <span class="keywordflow">goto</span> done;
<a name="l02274"></a>02274 
<a name="l02275"></a>02275    <a class="code" href="linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc" title="Read locks a list.">AST_RWLIST_RDLOCK</a>(&amp;<a class="code" href="structhelpers.html">helpers</a>);
<a name="l02276"></a>02276    e = <a class="code" href="cli_8c.html#a7ae95494897a62695433cb697e7fc53b">find_cli</a>(args + 1, 0);
<a name="l02277"></a>02277    <span class="keywordflow">if</span> (e)
<a name="l02278"></a>02278       <a class="code" href="lock_8h.html#a30df186a6f53f66621e88fae2e7adaf9" title="Atomically add v to *p and return * the previous value of *p. This can be used to...">ast_atomic_fetchadd_int</a>(&amp;e-&gt;<a class="code" href="structast__cli__entry.html#a679cabe3b846f2e363f43d8e57433834">inuse</a>, 1);
<a name="l02279"></a>02279    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structhelpers.html">helpers</a>);
<a name="l02280"></a>02280    <span class="keywordflow">if</span> (e == NULL) {
<a name="l02281"></a>02281       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;No such command &apos;%s&apos; (type &apos;core show help %s&apos; for other possible commands)\n&quot;</span>, <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>, <a class="code" href="cli_8c.html#a8a1ff15e1264d5177e9975142a0e9be8">find_best</a>(args + 1));
<a name="l02282"></a>02282       <span class="keywordflow">goto</span> done;
<a name="l02283"></a>02283    }
<a name="l02284"></a>02284 
<a name="l02285"></a>02285    <a class="code" href="strings_8h.html#a0c9c27a9e6b4a6d1e2b868525ae3d0c1">ast_join</a>(tmp, <span class="keyword">sizeof</span>(tmp), args + 1);
<a name="l02286"></a>02286    <span class="comment">/* Check if the user has rights to run this command. */</span>
<a name="l02287"></a>02287    <span class="keywordflow">if</span> (!<a class="code" href="cli_8c.html#a97c81620d61e3249bf35cada6df2a088">cli_has_permissions</a>(uid, gid, tmp)) {
<a name="l02288"></a>02288       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;You don&apos;t have permissions to run &apos;%s&apos; command\n&quot;</span>, tmp);
<a name="l02289"></a>02289       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(duplicate);
<a name="l02290"></a>02290       <span class="keywordflow">return</span> 0;
<a name="l02291"></a>02291    }
<a name="l02292"></a>02292 
<a name="l02293"></a>02293    <span class="comment">/*</span>
<a name="l02294"></a>02294 <span class="comment">    * Within the handler, argv[-1] contains a pointer to the ast_cli_entry.</span>
<a name="l02295"></a>02295 <span class="comment">    * Remember that the array returned by parse_args is NULL-terminated.</span>
<a name="l02296"></a>02296 <span class="comment">    */</span>
<a name="l02297"></a>02297    args[0] = (<span class="keywordtype">char</span> *)e;
<a name="l02298"></a>02298 
<a name="l02299"></a>02299    retval = e-&gt;<a class="code" href="structast__cli__entry.html#af0e07e1d04656663ca8b452904abe99b">handler</a>(e, <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea2e4a68503bbadbeacf842a24c7d7f2df">CLI_HANDLER</a>, &amp;a);
<a name="l02300"></a>02300 
<a name="l02301"></a>02301    <span class="keywordflow">if</span> (retval == <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>) {
<a name="l02302"></a>02302       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;%s&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a>, <span class="stringliteral">&quot;Invalid usage, but no usage information available.\n&quot;</span>));
<a name="l02303"></a>02303    } <span class="keywordflow">else</span> {
<a name="l02304"></a>02304       <span class="keywordflow">if</span> (retval == <a class="code" href="cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>)
<a name="l02305"></a>02305          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Command &apos;%s&apos; failed.\n&quot;</span>, <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>);
<a name="l02306"></a>02306    }
<a name="l02307"></a>02307    <a class="code" href="lock_8h.html#a30df186a6f53f66621e88fae2e7adaf9" title="Atomically add v to *p and return * the previous value of *p. This can be used to...">ast_atomic_fetchadd_int</a>(&amp;e-&gt;<a class="code" href="structast__cli__entry.html#a679cabe3b846f2e363f43d8e57433834">inuse</a>, -1);
<a name="l02308"></a>02308 done:
<a name="l02309"></a>02309    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(duplicate);
<a name="l02310"></a>02310    <span class="keywordflow">return</span> 0;
<a name="l02311"></a>02311 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab1d4a1fb19a2a81cc450e1173b346eca"></a><!-- doxytag: member="cli.c::ast_cli_command_multiple_full" ref="ab1d4a1fb19a2a81cc450e1173b346eca" args="(int uid, int gid, int fd, size_t size, const char *s)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_cli_command_multiple_full </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>uid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>gid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>s</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Executes multiple CLI commands Interpret strings separated by NULL and execute each one, sending output to fd if uid has permissions, uid = CLI_NO_PERMS to avoid checking <a class="el" href="structusers.html" title="list of users found in the config file">users</a> permissions. gid = CLI_NO_PERMS to avoid checking <a class="el" href="structgroup.html">group</a> permissions. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>uid</em>&nbsp;</td><td>User ID that is trying to run the command. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>gid</em>&nbsp;</td><td>Group ID that is trying to run the command. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fd</em>&nbsp;</td><td>pipe </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>size</em>&nbsp;</td><td>is the total size of the string </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>s</em>&nbsp;</td><td>incoming string </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structnumber.html" title="Number structure.">number</a></em>&nbsp;</td><td>of commands executed </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="cli_8c_source.html#l02313">2313</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="cli_8c_source.html#l02258">ast_cli_command_full()</a>.</p>

<p>Referenced by <a class="el" href="asterisk_8c_source.html#l01195">netconsole()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02314"></a>02314 {
<a name="l02315"></a>02315    <span class="keywordtype">char</span> cmd[512];
<a name="l02316"></a>02316    <span class="keywordtype">int</span> x, y = 0, count = 0;
<a name="l02317"></a>02317 
<a name="l02318"></a>02318    <span class="keywordflow">for</span> (x = 0; x &lt; size; x++) {
<a name="l02319"></a>02319       cmd[y] = <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>[x];
<a name="l02320"></a>02320       y++;
<a name="l02321"></a>02321       <span class="keywordflow">if</span> (<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>[x] == <span class="charliteral">&apos;\0&apos;</span>) {
<a name="l02322"></a>02322          <a class="code" href="cli_8h.html#aed9a4dab62dbb614240800509ccfac1c" title="Interprets a command Interpret a command s, sending output to fd if uid:gid has permissions...">ast_cli_command_full</a>(uid, gid, <a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, cmd);
<a name="l02323"></a>02323          y = 0;
<a name="l02324"></a>02324          count++;
<a name="l02325"></a>02325       }
<a name="l02326"></a>02326    }
<a name="l02327"></a>02327    <span class="keywordflow">return</span> count;
<a name="l02328"></a>02328 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a398bbbd46cab5e1fe414d43cb1f8e1a8"></a><!-- doxytag: member="cli.c::ast_cli_complete" ref="a398bbbd46cab5e1fe414d43cb1f8e1a8" args="(const char *word, char *const choices[], int state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* ast_cli_complete </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>word</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *const &nbsp;</td>
          <td class="paramname"> <em>choices</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>pos</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Helper function to generate cli entries from a NULL-terminated array. Returns the n-th matching entry from the array, or NULL if not found. Can be used to implement generate() for static entries as below (in this example we complete the word in position 2): </p>
<div class="fragment"><pre class="fragment">    <span class="keywordtype">char</span> *my_generate(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structast__cli__args.html#a2a7a1aa13a4f14075411123a4495593c">line</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="ael_8tab_8c.html#a836535f59bf515522a395858a8029d42">word</a>, <span class="keywordtype">int</span> <a class="code" href="structast__cli__args.html#a1910d262855b71da353ed0d07a6c7823">pos</a>, <span class="keywordtype">int</span> <a class="code" href="structast__cli__args.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>)
    {
        <span class="keyword">static</span> <span class="keywordtype">char</span> *choices = { <span class="stringliteral">&quot;one&quot;</span>, <span class="stringliteral">&quot;two&quot;</span>, <span class="stringliteral">&quot;three&quot;</span>, NULL };
   <span class="keywordflow">if</span> (pos == 2)
         <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a7d198ac45b2d75bb30eb773582caf89f">ast_cli_complete</a>(word, choices, n);
   <span class="keywordflow">else</span>
      <span class="keywordflow">return</span> NULL;
    }
</pre></div> 
<p>Definition at line <a class="el" href="cli_8c_source.html#l01378">1378</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, and <a class="el" href="func__strings_8c_source.html#l00821">len()</a>.</p>

<p>Referenced by <a class="el" href="app__meetme_8c_source.html#l01148">complete_meetmecmd()</a>, <a class="el" href="func__devstate_8c_source.html#l00235">handle_cli_devstate_change()</a>, <a class="el" href="chan__iax2_8c_source.html#l03393">handle_cli_iax2_prune_realtime()</a>, <a class="el" href="res__clioriginate_8c_source.html#l00119">handle_orig()</a>, <a class="el" href="pbx_8c_source.html#l05481">handle_show_applications()</a>, and <a class="el" href="chan__sip_8c_source.html#l15021">sip_prune_realtime()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01379"></a>01379 {
<a name="l01380"></a>01380    <span class="keywordtype">int</span> i, which = 0, <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>;
<a name="l01381"></a>01381    <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> = <a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="ael_8tab_8c.html#a836535f59bf515522a395858a8029d42">word</a>) ? 0 : strlen(<a class="code" href="ael_8tab_8c.html#a836535f59bf515522a395858a8029d42">word</a>);
<a name="l01382"></a>01382 
<a name="l01383"></a>01383    <span class="keywordflow">for</span> (i = 0; choices[i]; i++) {
<a name="l01384"></a>01384       <span class="keywordflow">if</span> ((!<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> || !strncasecmp(<a class="code" href="ael_8tab_8c.html#a836535f59bf515522a395858a8029d42">word</a>, choices[i], <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>)) &amp;&amp; ++which &gt; <a class="code" href="structstate.html">state</a>)
<a name="l01385"></a>01385          <span class="keywordflow">return</span> <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(choices[i]);
<a name="l01386"></a>01386    }
<a name="l01387"></a>01387    <span class="keywordflow">return</span> NULL;
<a name="l01388"></a>01388 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1069d2d27b3c28328ab20ab898c36960"></a><!-- doxytag: member="cli.c::ast_cli_completion_matches" ref="a1069d2d27b3c28328ab20ab898c36960" args="(const char *text, const char *word)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char** ast_cli_completion_matches </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Generates a NULL-terminated array of strings that 1) begin with the string in the second parameter, and 2) are valid in a command after the string in the first parameter. </p>
<p>The first entry (offset 0) of the result is the longest common substring in the results, useful to extend the string that has been completed. Subsequent entries are all possible <a class="el" href="structvalues.html">values</a>, followed by a NULL. All strings and the array itself are malloc'ed and must be freed by the caller. </p>

<p>Definition at line <a class="el" href="cli_8c_source.html#l02109">2109</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="cli_8c_source.html#l02253">ast_cli_generator()</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="astmm_8h_source.html#l00081">ast_malloc</a>, and <a class="el" href="astmm_8h_source.html#l00093">ast_realloc</a>.</p>

<p>Referenced by <a class="el" href="asterisk_8c_source.html#l02392">cli_complete()</a>, and <a class="el" href="cli_8c_source.html#l01081">handle_commandmatchesarray()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02110"></a>02110 {
<a name="l02111"></a>02111    <span class="keywordtype">char</span> **match_list = NULL, *retstr, *prevstr;
<a name="l02112"></a>02112    <span class="keywordtype">size_t</span> match_list_len, max_equal, which, i;
<a name="l02113"></a>02113    <span class="keywordtype">int</span> matches = 0;
<a name="l02114"></a>02114 
<a name="l02115"></a>02115    <span class="comment">/* leave entry 0 free for the longest common substring */</span>
<a name="l02116"></a>02116    match_list_len = 1;
<a name="l02117"></a>02117    <span class="keywordflow">while</span> ((retstr = <a class="code" href="cli_8h.html#a21652cd28eeec8299b69288967f9a4a1" title="Readline madness Useful for readline, that&amp;#39;s about it.">ast_cli_generator</a>(<a class="code" href="app__queue_8c.html#a5633b1433389cec21ade3811bbe9ca5b">text</a>, <a class="code" href="ael_8tab_8c.html#a836535f59bf515522a395858a8029d42">word</a>, matches)) != NULL) {
<a name="l02118"></a>02118       <span class="keywordflow">if</span> (matches + 1 &gt;= match_list_len) {
<a name="l02119"></a>02119          match_list_len &lt;&lt;= 1;
<a name="l02120"></a>02120          <span class="keywordflow">if</span> (!(match_list = <a class="code" href="astmm_8h.html#aa852314efa0cfeecee97ffc51b649734">ast_realloc</a>(match_list, match_list_len * <span class="keyword">sizeof</span>(*match_list))))
<a name="l02121"></a>02121             <span class="keywordflow">return</span> NULL;
<a name="l02122"></a>02122       }
<a name="l02123"></a>02123       match_list[++matches] = retstr;
<a name="l02124"></a>02124    }
<a name="l02125"></a>02125 
<a name="l02126"></a>02126    <span class="keywordflow">if</span> (!match_list)
<a name="l02127"></a>02127       <span class="keywordflow">return</span> match_list; <span class="comment">/* NULL */</span>
<a name="l02128"></a>02128 
<a name="l02129"></a>02129    <span class="comment">/* Find the longest substring that is common to all results</span>
<a name="l02130"></a>02130 <span class="comment">    * (it is a candidate for completion), and store a copy in entry 0.</span>
<a name="l02131"></a>02131 <span class="comment">    */</span>
<a name="l02132"></a>02132    prevstr = match_list[1];
<a name="l02133"></a>02133    max_equal = strlen(prevstr);
<a name="l02134"></a>02134    <span class="keywordflow">for</span> (which = 2; which &lt;= matches; which++) {
<a name="l02135"></a>02135       <span class="keywordflow">for</span> (i = 0; i &lt; max_equal &amp;&amp; toupper(prevstr[i]) == toupper(match_list[which][i]); i++)
<a name="l02136"></a>02136          <span class="keywordflow">continue</span>;
<a name="l02137"></a>02137       max_equal = i;
<a name="l02138"></a>02138    }
<a name="l02139"></a>02139 
<a name="l02140"></a>02140    <span class="keywordflow">if</span> (!(retstr = <a class="code" href="astmm_8h.html#a64a0e7a3ab511a3777ac56f5d43c628e">ast_malloc</a>(max_equal + 1)))
<a name="l02141"></a>02141       <span class="keywordflow">return</span> NULL;
<a name="l02142"></a>02142    
<a name="l02143"></a>02143    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(retstr, match_list[1], max_equal + 1);
<a name="l02144"></a>02144    match_list[0] = retstr;
<a name="l02145"></a>02145 
<a name="l02146"></a>02146    <span class="comment">/* ensure that the array is NULL terminated */</span>
<a name="l02147"></a>02147    <span class="keywordflow">if</span> (matches + 1 &gt;= match_list_len) {
<a name="l02148"></a>02148       <span class="keywordflow">if</span> (!(match_list = <a class="code" href="astmm_8h.html#aa852314efa0cfeecee97ffc51b649734">ast_realloc</a>(match_list, (match_list_len + 1) * <span class="keyword">sizeof</span>(*match_list))))
<a name="l02149"></a>02149          <span class="keywordflow">return</span> NULL;
<a name="l02150"></a>02150    }
<a name="l02151"></a>02151    match_list[matches + 1] = NULL;
<a name="l02152"></a>02152 
<a name="l02153"></a>02153    <span class="keywordflow">return</span> match_list;
<a name="l02154"></a>02154 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab884a0f2d24bec68f1d61564d9f857b9"></a><!-- doxytag: member="cli.c::ast_cli_generator" ref="ab884a0f2d24bec68f1d61564d9f857b9" args="(const char *text, const char *word, int state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* ast_cli_generator </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Readline madness Useful for readline, that's about it. </p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="cli_8c_source.html#l02253">2253</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="cli_8c_source.html#l02170">__ast_cli_generator()</a>.</p>

<p>Referenced by <a class="el" href="cli_8c_source.html#l02109">ast_cli_completion_matches()</a>, <a class="el" href="cli_8c_source.html#l02092">ast_cli_generatornummatches()</a>, <a class="el" href="res__clialiases_8c_source.html#l00080">cli_alias_passthrough()</a>, and <a class="el" href="cli_8c_source.html#l01004">handle_cli_check_permissions()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02254"></a>02254 {
<a name="l02255"></a>02255    <span class="keywordflow">return</span> <a class="code" href="cli_8c.html#ad05311723605fd9bf9bcf9ebe05323dc">__ast_cli_generator</a>(<a class="code" href="app__queue_8c.html#a5633b1433389cec21ade3811bbe9ca5b">text</a>, <a class="code" href="ael_8tab_8c.html#a836535f59bf515522a395858a8029d42">word</a>, <a class="code" href="structstate.html">state</a>, 1);
<a name="l02256"></a>02256 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af0454163e128ba7fdba510bb848f07cb"></a><!-- doxytag: member="cli.c::ast_cli_generatornummatches" ref="af0454163e128ba7fdba510bb848f07cb" args="(const char *text, const char *word)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_cli_generatornummatches </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>text</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>word</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Return the <a class="el" href="structnumber.html" title="Number structure.">number</a> of unique matches for the generator. </p>

<p>Definition at line <a class="el" href="cli_8c_source.html#l02092">2092</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="cli_8c_source.html#l02253">ast_cli_generator()</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, and <a class="el" href="adsistub_8c_source.html#l00059">buf</a>.</p>

<p>Referenced by <a class="el" href="cli_8c_source.html#l01136">handle_commandnummatches()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02093"></a>02093 {
<a name="l02094"></a>02094    <span class="keywordtype">int</span> matches = 0, i = 0;
<a name="l02095"></a>02095    <span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a> = NULL, *oldbuf = NULL;
<a name="l02096"></a>02096 
<a name="l02097"></a>02097    <span class="keywordflow">while</span> ((buf = <a class="code" href="cli_8h.html#a21652cd28eeec8299b69288967f9a4a1" title="Readline madness Useful for readline, that&amp;#39;s about it.">ast_cli_generator</a>(<a class="code" href="app__queue_8c.html#a5633b1433389cec21ade3811bbe9ca5b">text</a>, <a class="code" href="ael_8tab_8c.html#a836535f59bf515522a395858a8029d42">word</a>, i++))) {
<a name="l02098"></a>02098       <span class="keywordflow">if</span> (!oldbuf || strcmp(buf,oldbuf))
<a name="l02099"></a>02099          matches++;
<a name="l02100"></a>02100       <span class="keywordflow">if</span> (oldbuf)
<a name="l02101"></a>02101          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(oldbuf);
<a name="l02102"></a>02102       oldbuf = buf;
<a name="l02103"></a>02103    }
<a name="l02104"></a>02104    <span class="keywordflow">if</span> (oldbuf)
<a name="l02105"></a>02105       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(oldbuf);
<a name="l02106"></a>02106    <span class="keywordflow">return</span> matches;
<a name="l02107"></a>02107 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ade6dbc4196f2fc99250aaafededfb41b"></a><!-- doxytag: member="cli.c::ast_cli_perms_init" ref="ade6dbc4196f2fc99250aaafededfb41b" args="(int reload)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_cli_perms_init </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>reload</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Provided by <a class="el" href="cli_8c.html" title="Standard Command Line Interface.">cli.c</a> </p>

<p>Definition at line <a class="el" href="cli_8c_source.html#l01554">1554</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="config_8c_source.html#l00613">ast_category_browse()</a>, <a class="el" href="config_8c_source.html#l00827">ast_config_destroy()</a>, <a class="el" href="config_8c_source.html#l02071">ast_config_load2()</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="linkedlists_8h_source.html#l00715">AST_LIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01722">ast_mutex_trylock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="linkedlists_8h_source.html#l00725">AST_RWLIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="config_8c_source.html#l00411">ast_variable_browse()</a>, <a class="el" href="cli_8c_source.html#l00055">cli_perm::command</a>, <a class="el" href="config_8h_source.html#l00043">CONFIG_FLAG_FILEUNCHANGED</a>, <a class="el" href="config_8h_source.html#l00049">CONFIG_STATUS_FILEUNCHANGED</a>, <a class="el" href="cli_8c_source.html#l01538">destroy_user_perms()</a>, <a class="el" href="cli_8c_source.html#l00064">usergroup_cli_perm::gid</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="config_8h_source.html#l00075">ast_variable::name</a>, <a class="el" href="config_8h_source.html#l00077">ast_variable::next</a>, <a class="el" href="cli_8c_source.html#l00054">cli_perm::permit</a>, <a class="el" href="cli_8c_source.html#l00065">usergroup_cli_perm::perms</a>, <a class="el" href="cli_8c_source.html#l00069">perms_config</a>, <a class="el" href="cli_8c_source.html#l00063">usergroup_cli_perm::uid</a>, and <a class="el" href="config_8h_source.html#l00076">ast_variable::value</a>.</p>

<p>Referenced by <a class="el" href="cli_8c_source.html#l00985">handle_cli_reload_permissions()</a>, and <a class="el" href="asterisk_8c_source.html#l03095">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01555"></a>01555 {
<a name="l01556"></a>01556    <span class="keyword">struct </span><a class="code" href="structast__flags.html" title="Structure used to handle boolean flags.">ast_flags</a> <a class="code" href="app__rpt_8c.html#a1f57f20c1f46890828791a4827fe8752">config_flags</a> = { <a class="code" href="app__amd_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a> ? <a class="code" href="config_8h.html#a2d5492e116eebd5075f247d21fb9db26afa887389dc380bbdcffb65fec379f037">CONFIG_FLAG_FILEUNCHANGED</a> : 0 };
<a name="l01557"></a>01557    <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *cfg;
<a name="l01558"></a>01558    <span class="keywordtype">char</span> *cat = NULL;
<a name="l01559"></a>01559    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *v;
<a name="l01560"></a>01560    <span class="keyword">struct </span><a class="code" href="structusergroup__cli__perm.html" title="list of users to apply restrictions.">usergroup_cli_perm</a> *user_group, *cp_entry;
<a name="l01561"></a>01561    <span class="keyword">struct </span><a class="code" href="structcli__perm.html" title="List of restrictions per user.">cli_perm</a> *perm = NULL;
<a name="l01562"></a>01562    <span class="keyword">struct </span>passwd *pw;
<a name="l01563"></a>01563    <span class="keyword">struct </span><a class="code" href="structgroup.html">group</a> *gr;
<a name="l01564"></a>01564 
<a name="l01565"></a>01565    <span class="keywordflow">if</span> (<a class="code" href="lock_8h.html#a036ccafa2339f674a46bc269bbd48c5f">ast_mutex_trylock</a>(&amp;<a class="code" href="cli_8c.html#a69909b2c3c4a62443fc781e20ba3ddc5" title="mutex used to prevent a user from running the &amp;#39;cli reload permissions&amp;#39; command...">permsconfiglock</a>)) {
<a name="l01566"></a>01566       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;You must wait until last &apos;cli reload permissions&apos; command finish\n&quot;</span>);
<a name="l01567"></a>01567       <span class="keywordflow">return</span> 1;
<a name="l01568"></a>01568    }
<a name="l01569"></a>01569 
<a name="l01570"></a>01570    cfg = <a class="code" href="config_8h.html#aab3eac8fa82a86a93c074deb7b77dbc9" title="Load a config file.">ast_config_load2</a>(<a class="code" href="cli_8c.html#ae473ef191024f9043e7388e1a0585791" title="CLI permissions config file.">perms_config</a>, <span class="stringliteral">&quot;&quot;</span> <span class="comment">/* core, can&apos;t reload */</span>, config_flags);
<a name="l01571"></a>01571    <span class="keywordflow">if</span> (!cfg) {
<a name="l01572"></a>01572       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="cli_8c.html#a69909b2c3c4a62443fc781e20ba3ddc5" title="mutex used to prevent a user from running the &amp;#39;cli reload permissions&amp;#39; command...">permsconfiglock</a>);
<a name="l01573"></a>01573       <span class="keywordflow">return</span> 1;
<a name="l01574"></a>01574    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cfg == <a class="code" href="config_8h.html#a846844eb2c4eb44554445936b3770711">CONFIG_STATUS_FILEUNCHANGED</a>) {
<a name="l01575"></a>01575       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="cli_8c.html#a69909b2c3c4a62443fc781e20ba3ddc5" title="mutex used to prevent a user from running the &amp;#39;cli reload permissions&amp;#39; command...">permsconfiglock</a>);
<a name="l01576"></a>01576       <span class="keywordflow">return</span> 0;
<a name="l01577"></a>01577    }
<a name="l01578"></a>01578 
<a name="l01579"></a>01579    <span class="comment">/* free current structures. */</span>
<a name="l01580"></a>01580    <a class="code" href="cli_8c.html#aa09e50353ce1962ccd90b269e3beb793" title="cleanup (free) cli_perms linkedlist.">destroy_user_perms</a>();
<a name="l01581"></a>01581 
<a name="l01582"></a>01582    <span class="keywordflow">while</span> ((cat = <a class="code" href="config_8h.html#a611776300f941a63266cb220ac62b4db" title="Goes through categories.">ast_category_browse</a>(cfg, cat))) {
<a name="l01583"></a>01583       <span class="keywordflow">if</span> (!strcasecmp(cat, <span class="stringliteral">&quot;general&quot;</span>)) {
<a name="l01584"></a>01584          <span class="comment">/* General options */</span>
<a name="l01585"></a>01585          <span class="keywordflow">for</span> (v = <a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(cfg, cat); v; v = v-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l01586"></a>01586             <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;default_perm&quot;</span>)) {
<a name="l01587"></a>01587                <a class="code" href="cli_8c.html#a8b908b1af31513eae2e84e5346661d58" title="Default permissions value 1=Permit 0=Deny.">cli_default_perm</a> = (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;permit&quot;</span>)) ? 1: 0;
<a name="l01588"></a>01588             }
<a name="l01589"></a>01589          }
<a name="l01590"></a>01590          <span class="keywordflow">continue</span>;
<a name="l01591"></a>01591       }
<a name="l01592"></a>01592 
<a name="l01593"></a>01593       <span class="comment">/* users or groups */</span>
<a name="l01594"></a>01594       gr = NULL, pw = NULL;
<a name="l01595"></a>01595       <span class="keywordflow">if</span> (cat[0] == <span class="charliteral">&apos;@&apos;</span>) {
<a name="l01596"></a>01596          <span class="comment">/* This is a group */</span>
<a name="l01597"></a>01597          gr = getgrnam(&amp;cat[1]);
<a name="l01598"></a>01598          <span class="keywordflow">if</span> (!gr) {
<a name="l01599"></a>01599             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a> (<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unknown group &apos;%s&apos;\n&quot;</span>, &amp;cat[1]);
<a name="l01600"></a>01600             <span class="keywordflow">continue</span>;
<a name="l01601"></a>01601          }
<a name="l01602"></a>01602       } <span class="keywordflow">else</span> {
<a name="l01603"></a>01603          <span class="comment">/* This is a user */</span>
<a name="l01604"></a>01604          pw = getpwnam(cat);
<a name="l01605"></a>01605          <span class="keywordflow">if</span> (!pw) {
<a name="l01606"></a>01606             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a> (<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unknown user &apos;%s&apos;\n&quot;</span>, cat);
<a name="l01607"></a>01607             <span class="keywordflow">continue</span>;
<a name="l01608"></a>01608          }
<a name="l01609"></a>01609       }
<a name="l01610"></a>01610       user_group = NULL;
<a name="l01611"></a>01611       <span class="comment">/* Check for duplicates */</span>
<a name="l01612"></a>01612       <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structcli__perms.html" title="List of users and permissions.">cli_perms</a>);
<a name="l01613"></a>01613       <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="structcli__perms.html" title="List of users and permissions.">cli_perms</a>, cp_entry, list) {
<a name="l01614"></a>01614          <span class="keywordflow">if</span> ((pw &amp;&amp; cp_entry-&gt;<a class="code" href="structusergroup__cli__perm.html#a60a34315f460179939054acaf3ed8163">uid</a> == pw-&gt;pw_uid) || (gr &amp;&amp; cp_entry-&gt;<a class="code" href="structusergroup__cli__perm.html#a6567680a890171fbaa1a026477a858d3">gid</a> == gr-&gt;gr_gid)) {
<a name="l01615"></a>01615             <span class="comment">/* if it is duplicated, just added this new settings, to </span>
<a name="l01616"></a>01616 <span class="comment">            the current list. */</span>
<a name="l01617"></a>01617             user_group = cp_entry;
<a name="l01618"></a>01618             <span class="keywordflow">break</span>;
<a name="l01619"></a>01619          }
<a name="l01620"></a>01620       }
<a name="l01621"></a>01621       <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structcli__perms.html" title="List of users and permissions.">cli_perms</a>);
<a name="l01622"></a>01622 
<a name="l01623"></a>01623       <span class="keywordflow">if</span> (!user_group) {
<a name="l01624"></a>01624          <span class="comment">/* alloc space for the new user config. */</span>
<a name="l01625"></a>01625          user_group = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*user_group));
<a name="l01626"></a>01626          <span class="keywordflow">if</span> (!user_group) {
<a name="l01627"></a>01627             <span class="keywordflow">continue</span>;
<a name="l01628"></a>01628          }
<a name="l01629"></a>01629          user_group-&gt;<a class="code" href="structusergroup__cli__perm.html#a60a34315f460179939054acaf3ed8163">uid</a> = (pw ? pw-&gt;pw_uid : -1);
<a name="l01630"></a>01630          user_group-&gt;<a class="code" href="structusergroup__cli__perm.html#a6567680a890171fbaa1a026477a858d3">gid</a> = (gr ? gr-&gt;gr_gid : -1);
<a name="l01631"></a>01631          user_group-&gt;<a class="code" href="structusergroup__cli__perm.html#a367ea8bb88f1de1371cb6bbeda0451ba">perms</a> = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*user_group-&gt;<a class="code" href="structusergroup__cli__perm.html#a367ea8bb88f1de1371cb6bbeda0451ba">perms</a>));
<a name="l01632"></a>01632          <span class="keywordflow">if</span> (!user_group-&gt;<a class="code" href="structusergroup__cli__perm.html#a367ea8bb88f1de1371cb6bbeda0451ba">perms</a>) {
<a name="l01633"></a>01633             <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(user_group);
<a name="l01634"></a>01634             <span class="keywordflow">continue</span>;
<a name="l01635"></a>01635          }
<a name="l01636"></a>01636       }
<a name="l01637"></a>01637       <span class="keywordflow">for</span> (v = <a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(cfg, cat); v; v = v-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l01638"></a>01638          <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>)) {
<a name="l01639"></a>01639             <span class="comment">/* we need to check this condition cause it could break security. */</span>
<a name="l01640"></a>01640             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Empty permit/deny option in user &apos;%s&apos;\n&quot;</span>, cat);
<a name="l01641"></a>01641             <span class="keywordflow">continue</span>;
<a name="l01642"></a>01642          }
<a name="l01643"></a>01643          <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;permit&quot;</span>)) {
<a name="l01644"></a>01644             perm = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*perm));
<a name="l01645"></a>01645             <span class="keywordflow">if</span> (perm) {
<a name="l01646"></a>01646                perm-&gt;<a class="code" href="structcli__perm.html#ab01e87324485f2f7b5858cab52e6726e">permit</a> = 1;
<a name="l01647"></a>01647                perm-&gt;<a class="code" href="structcli__perm.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l01648"></a>01648             }
<a name="l01649"></a>01649          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;deny&quot;</span>)) {
<a name="l01650"></a>01650             perm = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*perm));
<a name="l01651"></a>01651             <span class="keywordflow">if</span> (perm) {
<a name="l01652"></a>01652                perm-&gt;<a class="code" href="structcli__perm.html#ab01e87324485f2f7b5858cab52e6726e">permit</a> = 0;
<a name="l01653"></a>01653                perm-&gt;<a class="code" href="structcli__perm.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l01654"></a>01654             }
<a name="l01655"></a>01655          } <span class="keywordflow">else</span> {
<a name="l01656"></a>01656             <span class="comment">/* up to now, only &apos;permit&apos; and &apos;deny&apos; are possible values. */</span>
<a name="l01657"></a>01657             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unknown &apos;%s&apos; option\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);
<a name="l01658"></a>01658             <span class="keywordflow">continue</span>;
<a name="l01659"></a>01659          }
<a name="l01660"></a>01660          <span class="keywordflow">if</span> (perm) {
<a name="l01661"></a>01661             <span class="comment">/* Added the permission to the user&apos;s list. */</span>
<a name="l01662"></a>01662             <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(user_group-&gt;<a class="code" href="structusergroup__cli__perm.html#a367ea8bb88f1de1371cb6bbeda0451ba">perms</a>, perm, list);
<a name="l01663"></a>01663             perm = NULL;
<a name="l01664"></a>01664          }
<a name="l01665"></a>01665       }
<a name="l01666"></a>01666       <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structcli__perms.html" title="List of users and permissions.">cli_perms</a>);
<a name="l01667"></a>01667       <a class="code" href="linkedlists_8h.html#aadda916488b2d151af4426e2f06ad332">AST_RWLIST_INSERT_TAIL</a>(&amp;<a class="code" href="structcli__perms.html" title="List of users and permissions.">cli_perms</a>, user_group, list);
<a name="l01668"></a>01668       <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structcli__perms.html" title="List of users and permissions.">cli_perms</a>);
<a name="l01669"></a>01669    }
<a name="l01670"></a>01670 
<a name="l01671"></a>01671    <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(cfg);
<a name="l01672"></a>01672    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="cli_8c.html#a69909b2c3c4a62443fc781e20ba3ddc5" title="mutex used to prevent a user from running the &amp;#39;cli reload permissions&amp;#39; command...">permsconfiglock</a>);
<a name="l01673"></a>01673    <span class="keywordflow">return</span> 0;
<a name="l01674"></a>01674 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0ca7e108aceb1cd488bb9e3ee26e4ebc"></a><!-- doxytag: member="cli.c::ast_cli_register" ref="a0ca7e108aceb1cd488bb9e3ee26e4ebc" args="(struct ast_cli_entry *e)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_cli_register </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Registers a command or an array of commands. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>e</em>&nbsp;</td><td>which cli entry to register. Register your own command </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="cli_8c_source.html#l01919">1919</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="cli_8c_source.html#l01857">__ast_cli_register()</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l01522">ast_cdr_engine_init()</a>, <a class="el" href="cli_8c_source.html#l01927">ast_cli_register_multiple()</a>, <a class="el" href="dnsmgr_8c_source.html#l00350">dnsmgr_init()</a>, <a class="el" href="cdr_8c_source.html#l01396">do_reload()</a>, <a class="el" href="res__clialiases_8c_source.html#l00178">load_config()</a>, and <a class="el" href="app__rpt_8c_source.html#l15146">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01920"></a>01920 {
<a name="l01921"></a>01921    <span class="keywordflow">return</span> <a class="code" href="cli_8c.html#ad74d8c6eeaf21a198049ae7b9f6032f8">__ast_cli_register</a>(e, NULL);
<a name="l01922"></a>01922 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aadeef34f3106bb78aeb3414032ad7fb7"></a><!-- doxytag: member="cli.c::ast_cli_register_multiple" ref="aadeef34f3106bb78aeb3414032ad7fb7" args="(struct ast_cli_entry *e, int len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_cli_register_multiple </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>len</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Register multiple commands. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>e</em>&nbsp;</td><td>pointer to first cli entry to register </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>len</em>&nbsp;</td><td><a class="el" href="structnumber.html" title="Number structure.">number</a> of entries to register </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="cli_8c_source.html#l01927">1927</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="cli_8c_source.html#l01919">ast_cli_register()</a>.</p>

<p>Referenced by <a class="el" href="astmm_8c_source.html#l00481">__ast_mm_init()</a>, <a class="el" href="translate_8c_source.html#l00621">__ast_register_translator()</a>, <a class="el" href="manager_8c_source.html#l04061">__init_manager()</a>, <a class="el" href="clm_8c_source.html#l00135">ast_ais_clm_load_module()</a>, <a class="el" href="evt_8c_source.html#l00540">ast_ais_evt_load_module()</a>, <a class="el" href="cli_8c_source.html#l01677">ast_builtins_init()</a>, <a class="el" href="channel_8c_source.html#l05561">ast_channels_init()</a>, <a class="el" href="features_8c_source.html#l04642">ast_features_init()</a>, <a class="el" href="file_8c_source.html#l01470">ast_file_init()</a>, <a class="el" href="http_8c_source.html#l01023">ast_http_init()</a>, <a class="el" href="image_8c_source.html#l00204">ast_image_init()</a>, <a class="el" href="indications_8c_source.html#l01106">ast_indications_init()</a>, <a class="el" href="rtp_8c_source.html#l04817">ast_rtp_init()</a>, <a class="el" href="timing_8c_source.html#l00283">ast_timing_init()</a>, <a class="el" href="taskprocessor_8c_source.html#l00122">ast_tps_init()</a>, <a class="el" href="udptl_8c_source.html#l01448">ast_udptl_init()</a>, <a class="el" href="utils_8c_source.html#l01800">ast_utils_init()</a>, <a class="el" href="db_8c_source.html#l00665">astdb_init()</a>, <a class="el" href="astobj2_8c_source.html#l01081">astobj2_init()</a>, <a class="el" href="res__crypto_8c_source.html#l00586">crypto_init()</a>, <a class="el" href="iax2-provision_8c_source.html#l00490">iax_provision_init()</a>, <a class="el" href="frame_8c_source.html#l00968">init_framer()</a>, <a class="el" href="logger_8c_source.html#l01004">init_logger()</a>, <a class="el" href="app__meetme_8c_source.html#l06461">load_module()</a>, <a class="el" href="pbx_8c_source.html#l09302">load_pbx()</a>, <a class="el" href="asterisk_8c_source.html#l03095">main()</a>, and <a class="el" href="config_8c_source.html#l02558">register_config_cli()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01928"></a>01928 {
<a name="l01929"></a>01929    <span class="keywordtype">int</span> i, res = 0;
<a name="l01930"></a>01930 
<a name="l01931"></a>01931    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>; i++)
<a name="l01932"></a>01932       res |= <a class="code" href="cli_8h.html#a0ca7e108aceb1cd488bb9e3ee26e4ebc" title="Registers a command or an array of commands.">ast_cli_register</a>(e + i);
<a name="l01933"></a>01933 
<a name="l01934"></a>01934    <span class="keywordflow">return</span> res;
<a name="l01935"></a>01935 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3189e6720486808603d13f5d2b58daf4"></a><!-- doxytag: member="cli.c::ast_cli_unregister" ref="a3189e6720486808603d13f5d2b58daf4" args="(struct ast_cli_entry *e)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_cli_unregister </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Unregisters a command or an array of commands. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>e</em>&nbsp;</td><td>which cli entry to unregister Unregister your own command. You must pass a completed <a class="el" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a> structure </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 </dd></dl>

<p>Definition at line <a class="el" href="cli_8c_source.html#l01913">1913</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="cli_8c_source.html#l01835">__ast_cli_unregister()</a>.</p>

<p>Referenced by <a class="el" href="res__clialiases_8c_source.html#l00069">alias_destroy()</a>, <a class="el" href="cli_8c_source.html#l01937">ast_cli_unregister_multiple()</a>, <a class="el" href="cdr_8c_source.html#l01396">do_reload()</a>, <a class="el" href="chan__h323_8c_source.html#l03222">load_module()</a>, and <a class="el" href="app__rpt_8c_source.html#l15105">unload_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01914"></a>01914 {
<a name="l01915"></a>01915    <span class="keywordflow">return</span> <a class="code" href="cli_8c.html#af4b26605236b79438f56ddf82c7bfe4e">__ast_cli_unregister</a>(e, NULL);
<a name="l01916"></a>01916 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a56b6b59ee2eaa994597a5b0f4e9f9d09"></a><!-- doxytag: member="cli.c::ast_cli_unregister_multiple" ref="a56b6b59ee2eaa994597a5b0f4e9f9d09" args="(struct ast_cli_entry *e, int len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_cli_unregister_multiple </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>len</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Unregister multiple commands. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>e</em>&nbsp;</td><td>pointer to first cli entry to unregister </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>len</em>&nbsp;</td><td><a class="el" href="structnumber.html" title="Number structure.">number</a> of entries to unregister </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="cli_8c_source.html#l01937">1937</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="cli_8c_source.html#l01913">ast_cli_unregister()</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l15849">__unload_module()</a>, <a class="el" href="clm_8c_source.html#l00151">ast_ais_clm_unload_module()</a>, <a class="el" href="iax2-provision_8c_source.html#l00513">iax_provision_unload()</a>, <a class="el" href="chan__console_8c_source.html#l01469">load_module()</a>, and <a class="el" href="app__meetme_8c_source.html#l06435">unload_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01938"></a>01938 {
<a name="l01939"></a>01939    <span class="keywordtype">int</span> i, res = 0;
<a name="l01940"></a>01940 
<a name="l01941"></a>01941    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>; i++)
<a name="l01942"></a>01942       res |= <a class="code" href="cli_8h.html#a3189e6720486808603d13f5d2b58daf4" title="Unregisters a command or an array of commands.">ast_cli_unregister</a>(e + i);
<a name="l01943"></a>01943 
<a name="l01944"></a>01944    <span class="keywordflow">return</span> res;
<a name="l01945"></a>01945 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3a116acde8f18aa530e5b4a6df420273"></a><!-- doxytag: member="cli.c::ast_complete_channels" ref="a3a116acde8f18aa530e5b4a6df420273" args="(const char *line, const char *word, int pos, int state, int rpos)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* ast_complete_channels </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>line</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>word</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>rpos</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Command completion for the list of active <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>. </p>
<p>This can be called from a CLI command completion function that wants to complete from the list of active <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a>. 'rpos' is the required position in the command. This function will return NULL immediately if 'rpos' is not the same as the current position, 'pos'. </p>

<p>Definition at line <a class="el" href="cli_8c_source.html#l01390">1390</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="channel_8c_source.html#l01272">ast_channel_walk_locked()</a>, and <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>.</p>

<p>Referenced by <a class="el" href="chan__misdn_8c_source.html#l01897">complete_ch()</a>, <a class="el" href="res__agi_8c_source.html#l00544">handle_cli_agi_add_cmd()</a>, <a class="el" href="app__mixmonitor_8c_source.html#l00587">handle_cli_mixmonitor()</a>, <a class="el" href="cli_8c_source.html#l01187">handle_core_set_debug_channel()</a>, <a class="el" href="res__clioriginate_8c_source.html#l00175">handle_redirect()</a>, <a class="el" href="pbx_8c_source.html#l06269">handle_set_chanvar()</a>, <a class="el" href="pbx_8c_source.html#l06215">handle_show_chanvar()</a>, <a class="el" href="cli_8c_source.html#l01268">handle_showchan()</a>, and <a class="el" href="cli_8c_source.html#l00912">handle_softhangup()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01391"></a>01391 {
<a name="l01392"></a>01392    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c = NULL;
<a name="l01393"></a>01393    <span class="keywordtype">int</span> which = 0;
<a name="l01394"></a>01394    <span class="keywordtype">int</span> wordlen;
<a name="l01395"></a>01395    <span class="keywordtype">char</span> notfound = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01396"></a>01396    <span class="keywordtype">char</span> *ret = &amp;notfound; <span class="comment">/* so NULL can break the loop */</span>
<a name="l01397"></a>01397 
<a name="l01398"></a>01398    <span class="keywordflow">if</span> (pos != rpos)
<a name="l01399"></a>01399       <span class="keywordflow">return</span> NULL;
<a name="l01400"></a>01400 
<a name="l01401"></a>01401    wordlen = strlen(<a class="code" href="ael_8tab_8c.html#a836535f59bf515522a395858a8029d42">word</a>); 
<a name="l01402"></a>01402 
<a name="l01403"></a>01403    <span class="keywordflow">while</span> (ret == &amp;notfound &amp;&amp; (c = <a class="code" href="channel_8h.html#af287194cacb2db8ac7bb50d16a3a2d60" title="Browse channels in use Browse the channels currently in use.">ast_channel_walk_locked</a>(c))) {
<a name="l01404"></a>01404       <span class="keywordflow">if</span> (!strncasecmp(<a class="code" href="ael_8tab_8c.html#a836535f59bf515522a395858a8029d42">word</a>, c-&gt;name, wordlen) &amp;&amp; ++which &gt; <a class="code" href="structstate.html">state</a>)
<a name="l01405"></a>01405          ret = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(c-&gt;name);
<a name="l01406"></a>01406       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c);
<a name="l01407"></a>01407    }
<a name="l01408"></a>01408    <span class="keywordflow">return</span> ret == &amp;notfound ? NULL : ret;
<a name="l01409"></a>01409 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aaac45eb83fb2730cac249a509862110d"></a><!-- doxytag: member="cli.c::ast_debug_get_by_file" ref="aaac45eb83fb2730cac249a509862110d" args="(const char *file)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int ast_debug_get_by_file </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>file</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get the debug level for a file. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>file</em>&nbsp;</td><td>the filename </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>the debug level </dd></dl>

<p>Definition at line <a class="el" href="cli_8c_source.html#l00118">118</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00077">AST_RWLIST_RDLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="cli_8c_source.html#l00085">ast_debug_file::filename</a>, and <a class="el" href="cli_8c_source.html#l00083">ast_debug_file::level</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00119"></a>00119 {
<a name="l00120"></a>00120    <span class="keyword">struct </span><a class="code" href="structast__debug__file.html" title="map a debug or verbose value to a filename">ast_debug_file</a> *adf;
<a name="l00121"></a>00121    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> res = 0;
<a name="l00122"></a>00122 
<a name="l00123"></a>00123    <a class="code" href="linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc" title="Read locks a list.">AST_RWLIST_RDLOCK</a>(&amp;<a class="code" href="cli_8c.html#adf077cec50df93f97b46d8b6261c6f04">debug_files</a>);
<a name="l00124"></a>00124    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="cli_8c.html#adf077cec50df93f97b46d8b6261c6f04">debug_files</a>, adf, <a class="code" href="structast__debug__file.html#a3c3ab70d447808f20e62f4e26b521642">entry</a>) {
<a name="l00125"></a>00125       <span class="keywordflow">if</span> (!strncasecmp(adf-&gt;<a class="code" href="structast__debug__file.html#afae8c108f5d360038fa8b099eb4ab2f3">filename</a>, file, strlen(adf-&gt;<a class="code" href="structast__debug__file.html#afae8c108f5d360038fa8b099eb4ab2f3">filename</a>))) {
<a name="l00126"></a>00126          res = adf-&gt;<a class="code" href="structast__debug__file.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>;
<a name="l00127"></a>00127          <span class="keywordflow">break</span>;
<a name="l00128"></a>00128       }
<a name="l00129"></a>00129    }
<a name="l00130"></a>00130    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="cli_8c.html#adf077cec50df93f97b46d8b6261c6f04">debug_files</a>);
<a name="l00131"></a>00131 
<a name="l00132"></a>00132    <span class="keywordflow">return</span> res;
<a name="l00133"></a>00133 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a96552d7ad69aa626b6ab4fa9f93d1b2f"></a><!-- doxytag: member="cli.c::ast_verbose_get_by_file" ref="a96552d7ad69aa626b6ab4fa9f93d1b2f" args="(const char *file)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int ast_verbose_get_by_file </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>file</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get the debug level for a file. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>file</em>&nbsp;</td><td>the filename </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>the debug level </dd></dl>

<p>Definition at line <a class="el" href="cli_8c_source.html#l00135">135</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00077">AST_RWLIST_RDLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="cli_8c_source.html#l00085">ast_debug_file::filename</a>, and <a class="el" href="cli_8c_source.html#l00083">ast_debug_file::level</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00136"></a>00136 {
<a name="l00137"></a>00137    <span class="keyword">struct </span><a class="code" href="structast__debug__file.html" title="map a debug or verbose value to a filename">ast_debug_file</a> *adf;
<a name="l00138"></a>00138    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> res = 0;
<a name="l00139"></a>00139 
<a name="l00140"></a>00140    <a class="code" href="linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc" title="Read locks a list.">AST_RWLIST_RDLOCK</a>(&amp;<a class="code" href="cli_8c.html#afeb8a3babc8d262f1ae1dabacc656b84">verbose_files</a>);
<a name="l00141"></a>00141    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="cli_8c.html#afeb8a3babc8d262f1ae1dabacc656b84">verbose_files</a>, adf, <a class="code" href="structast__debug__file.html#a3c3ab70d447808f20e62f4e26b521642">entry</a>) {
<a name="l00142"></a>00142       <span class="keywordflow">if</span> (!strncasecmp(adf-&gt;<a class="code" href="structast__debug__file.html#afae8c108f5d360038fa8b099eb4ab2f3">filename</a>, file, strlen(file))) {
<a name="l00143"></a>00143          res = adf-&gt;<a class="code" href="structast__debug__file.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>;
<a name="l00144"></a>00144          <span class="keywordflow">break</span>;
<a name="l00145"></a>00145       }
<a name="l00146"></a>00146    }
<a name="l00147"></a>00147    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="cli_8c.html#afeb8a3babc8d262f1ae1dabacc656b84">verbose_files</a>);
<a name="l00148"></a>00148 
<a name="l00149"></a>00149    <span class="keywordflow">return</span> res;
<a name="l00150"></a>00150 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a97c81620d61e3249bf35cada6df2a088"></a><!-- doxytag: member="cli.c::cli_has_permissions" ref="a97c81620d61e3249bf35cada6df2a088" args="(int uid, int gid, const char *command)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int cli_has_permissions </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>uid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>gid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>command</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cli_8c_source.html#l00165">165</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00077">AST_RWLIST_RDLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="cli_8h_source.html#l00037">CLI_NO_PERMS</a>, <a class="el" href="cli_8c_source.html#l00055">cli_perm::command</a>, <a class="el" href="cli_8c_source.html#l00064">usergroup_cli_perm::gid</a>, <a class="el" href="cli_8c_source.html#l00054">cli_perm::permit</a>, <a class="el" href="cli_8c_source.html#l00065">usergroup_cli_perm::perms</a>, and <a class="el" href="cli_8c_source.html#l00063">usergroup_cli_perm::uid</a>.</p>

<p>Referenced by <a class="el" href="cli_8c_source.html#l02258">ast_cli_command_full()</a>, and <a class="el" href="cli_8c_source.html#l01004">handle_cli_check_permissions()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00166"></a>00166 {
<a name="l00167"></a>00167    <span class="keyword">struct </span><a class="code" href="structusergroup__cli__perm.html" title="list of users to apply restrictions.">usergroup_cli_perm</a> *user_perm;
<a name="l00168"></a>00168    <span class="keyword">struct </span><a class="code" href="structcli__perm.html" title="List of restrictions per user.">cli_perm</a> *perm;
<a name="l00169"></a>00169    <span class="comment">/* set to the default permissions general option. */</span>
<a name="l00170"></a>00170    <span class="keywordtype">int</span> isallowg = <a class="code" href="cli_8c.html#a8b908b1af31513eae2e84e5346661d58" title="Default permissions value 1=Permit 0=Deny.">cli_default_perm</a>, isallowu = -1, ispattern;
<a name="l00171"></a>00171    regex_t regexbuf;
<a name="l00172"></a>00172 
<a name="l00173"></a>00173    <span class="comment">/* if uid == -1 or gid == -1 do not check permissions.</span>
<a name="l00174"></a>00174 <span class="comment">      if uid == -2 and gid == -2 is because rasterisk client didn&apos;t send</span>
<a name="l00175"></a>00175 <span class="comment">      the credentials, so the cli_default_perm will be applied. */</span>
<a name="l00176"></a>00176    <span class="keywordflow">if</span> ((uid == <a class="code" href="cli_8h.html#a4f3ad5e5686a35a966c8bad5b8694654">CLI_NO_PERMS</a> &amp;&amp; gid == <a class="code" href="cli_8h.html#a4f3ad5e5686a35a966c8bad5b8694654">CLI_NO_PERMS</a>) || <a class="code" href="structcli__perm.html#ade9cba72805fe52685a1deea307a8e82">command</a>[0] == <span class="charliteral">&apos;_&apos;</span>) {
<a name="l00177"></a>00177       <span class="keywordflow">return</span> 1;
<a name="l00178"></a>00178    }
<a name="l00179"></a>00179 
<a name="l00180"></a>00180    <span class="keywordflow">if</span> (gid &lt; 0 &amp;&amp; uid &lt; 0) {
<a name="l00181"></a>00181       <span class="keywordflow">return</span> <a class="code" href="cli_8c.html#a8b908b1af31513eae2e84e5346661d58" title="Default permissions value 1=Permit 0=Deny.">cli_default_perm</a>;
<a name="l00182"></a>00182    }
<a name="l00183"></a>00183 
<a name="l00184"></a>00184    <a class="code" href="linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc" title="Read locks a list.">AST_RWLIST_RDLOCK</a>(&amp;<a class="code" href="structcli__perms.html" title="List of users and permissions.">cli_perms</a>);
<a name="l00185"></a>00185    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="structcli__perms.html" title="List of users and permissions.">cli_perms</a>, user_perm, <a class="code" href="structcli__perm.html#a57fc49456ff8578b794001445a8f2249">list</a>) {
<a name="l00186"></a>00186       <span class="keywordflow">if</span> (user_perm-&gt;<a class="code" href="structusergroup__cli__perm.html#a6567680a890171fbaa1a026477a858d3">gid</a> != gid &amp;&amp; user_perm-&gt;<a class="code" href="structusergroup__cli__perm.html#a60a34315f460179939054acaf3ed8163">uid</a> != uid) {
<a name="l00187"></a>00187          <span class="keywordflow">continue</span>;
<a name="l00188"></a>00188       }
<a name="l00189"></a>00189       <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(user_perm-&gt;<a class="code" href="structusergroup__cli__perm.html#a367ea8bb88f1de1371cb6bbeda0451ba">perms</a>, perm, <a class="code" href="structcli__perm.html#a57fc49456ff8578b794001445a8f2249">list</a>) {
<a name="l00190"></a>00190          <span class="keywordflow">if</span> (strcasecmp(perm-&gt;<a class="code" href="structcli__perm.html#ade9cba72805fe52685a1deea307a8e82">command</a>, <span class="stringliteral">&quot;all&quot;</span>) &amp;&amp; strncasecmp(perm-&gt;<a class="code" href="structcli__perm.html#ade9cba72805fe52685a1deea307a8e82">command</a>, <a class="code" href="structcli__perm.html#ade9cba72805fe52685a1deea307a8e82">command</a>, strlen(perm-&gt;<a class="code" href="structcli__perm.html#ade9cba72805fe52685a1deea307a8e82">command</a>))) {
<a name="l00191"></a>00191             <span class="comment">/* if the perm-&gt;command is a pattern, check it against command. */</span>
<a name="l00192"></a>00192             ispattern = !regcomp(&amp;regexbuf, perm-&gt;<a class="code" href="structcli__perm.html#ade9cba72805fe52685a1deea307a8e82">command</a>, REG_EXTENDED | REG_NOSUB | REG_ICASE);
<a name="l00193"></a>00193             <span class="keywordflow">if</span> (ispattern &amp;&amp; regexec(&amp;regexbuf, <a class="code" href="structcli__perm.html#ade9cba72805fe52685a1deea307a8e82">command</a>, 0, NULL, 0)) {
<a name="l00194"></a>00194                regfree(&amp;regexbuf);
<a name="l00195"></a>00195                <span class="keywordflow">continue</span>;
<a name="l00196"></a>00196             }
<a name="l00197"></a>00197             <span class="keywordflow">if</span> (!ispattern) {
<a name="l00198"></a>00198                <span class="keywordflow">continue</span>;
<a name="l00199"></a>00199             }
<a name="l00200"></a>00200             regfree(&amp;regexbuf);
<a name="l00201"></a>00201          }
<a name="l00202"></a>00202          <span class="keywordflow">if</span> (user_perm-&gt;<a class="code" href="structusergroup__cli__perm.html#a60a34315f460179939054acaf3ed8163">uid</a> == uid) {
<a name="l00203"></a>00203             <span class="comment">/* this is a user definition. */</span>
<a name="l00204"></a>00204             isallowu = perm-&gt;<a class="code" href="structcli__perm.html#ab01e87324485f2f7b5858cab52e6726e">permit</a>;
<a name="l00205"></a>00205          } <span class="keywordflow">else</span> {
<a name="l00206"></a>00206             <span class="comment">/* otherwise is a group definition. */</span>
<a name="l00207"></a>00207             isallowg = perm-&gt;<a class="code" href="structcli__perm.html#ab01e87324485f2f7b5858cab52e6726e">permit</a>;
<a name="l00208"></a>00208          }
<a name="l00209"></a>00209       }
<a name="l00210"></a>00210    }
<a name="l00211"></a>00211    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structcli__perms.html" title="List of users and permissions.">cli_perms</a>);
<a name="l00212"></a>00212    <span class="keywordflow">if</span> (isallowu &gt; -1) {
<a name="l00213"></a>00213       <span class="comment">/* user definition override group definition. */</span>
<a name="l00214"></a>00214       isallowg = isallowu;
<a name="l00215"></a>00215    }
<a name="l00216"></a>00216 
<a name="l00217"></a>00217    <span class="keywordflow">return</span> isallowg;
<a name="l00218"></a>00218 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="adac48ec5ae21bd48d7f3dac6c44b2868"></a><!-- doxytag: member="cli.c::cli_next" ref="adac48ec5ae21bd48d7f3dac6c44b2868" args="(struct ast_cli_entry *e)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a>* cli_next </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cli_8c_source.html#l00656">656</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00420">AST_LIST_FIRST</a>, and <a class="el" href="linkedlists_8h_source.html#l00438">AST_LIST_NEXT</a>.</p>

<p>Referenced by <a class="el" href="cli_8c_source.html#l02170">__ast_cli_generator()</a>, <a class="el" href="cli_8c_source.html#l01772">find_cli()</a>, <a class="el" href="cli_8c_source.html#l01004">handle_cli_check_permissions()</a>, and <a class="el" href="cli_8c_source.html#l01951">help1()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00657"></a>00657 {
<a name="l00658"></a>00658    <span class="keywordflow">if</span> (e) {
<a name="l00659"></a>00659       <span class="keywordflow">return</span> <a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(e, <a class="code" href="structcli__perm.html#a57fc49456ff8578b794001445a8f2249">list</a>);
<a name="l00660"></a>00660    } <span class="keywordflow">else</span> {
<a name="l00661"></a>00661       <span class="keywordflow">return</span> <a class="code" href="linkedlists_8h.html#adf1959c5c03a3a706da97ad2f49617e5" title="Returns the first entry contained in a list.">AST_LIST_FIRST</a>(&amp;<a class="code" href="structhelpers.html">helpers</a>);
<a name="l00662"></a>00662    }
<a name="l00663"></a>00663 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab71256f27aa5cbbad9931bc2ae9b2e36"></a><!-- doxytag: member="cli.c::complete_fn" ref="ab71256f27aa5cbbad9931bc2ae9b2e36" args="(const char *word, int state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* complete_fn </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>word</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>state</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cli_8c_source.html#l00222">222</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="asterisk_8c_source.html#l00250">ast_config_AST_MODULE_DIR</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, and <a class="el" href="astmm_8h_source.html#l00084">free</a>.</p>

<p>Referenced by <a class="el" href="cli_8c_source.html#l00244">handle_load()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00223"></a>00223 {
<a name="l00224"></a>00224    <span class="keywordtype">char</span> *c, *d;
<a name="l00225"></a>00225    <span class="keywordtype">char</span> filename[PATH_MAX];
<a name="l00226"></a>00226 
<a name="l00227"></a>00227    <span class="keywordflow">if</span> (<a class="code" href="ael_8tab_8c.html#a836535f59bf515522a395858a8029d42">word</a>[0] == <span class="charliteral">&apos;/&apos;</span>)
<a name="l00228"></a>00228       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(filename, <a class="code" href="ael_8tab_8c.html#a836535f59bf515522a395858a8029d42">word</a>, <span class="keyword">sizeof</span>(filename));
<a name="l00229"></a>00229    <span class="keywordflow">else</span>
<a name="l00230"></a>00230       snprintf(filename, <span class="keyword">sizeof</span>(filename), <span class="stringliteral">&quot;%s/%s&quot;</span>, <a class="code" href="paths_8h.html#a5852d8e3bf5485c09b0f3d2c2375eec3">ast_config_AST_MODULE_DIR</a>, <a class="code" href="ael_8tab_8c.html#a836535f59bf515522a395858a8029d42">word</a>);
<a name="l00231"></a>00231 
<a name="l00232"></a>00232    c = d = filename_completion_function(filename, <a class="code" href="structstate.html">state</a>);
<a name="l00233"></a>00233    
<a name="l00234"></a>00234    <span class="keywordflow">if</span> (c &amp;&amp; <a class="code" href="ael_8tab_8c.html#a836535f59bf515522a395858a8029d42">word</a>[0] != <span class="charliteral">&apos;/&apos;</span>)
<a name="l00235"></a>00235       c += (strlen(<a class="code" href="paths_8h.html#a5852d8e3bf5485c09b0f3d2c2375eec3">ast_config_AST_MODULE_DIR</a>) + 1);
<a name="l00236"></a>00236    <span class="keywordflow">if</span> (c)
<a name="l00237"></a>00237       c = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(c);
<a name="l00238"></a>00238 
<a name="l00239"></a>00239    <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(d);
<a name="l00240"></a>00240    
<a name="l00241"></a>00241    <span class="keywordflow">return</span> c;
<a name="l00242"></a>00242 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7b9a2847dbc64bf8d127b45890e21a89"></a><!-- doxytag: member="cli.c::complete_number" ref="a7b9a2847dbc64bf8d127b45890e21a89" args="(const char *partial, unsigned int min, unsigned int max, int n)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* complete_number </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>partial</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>min</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>max</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>n</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cli_8c_source.html#l00321">321</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, and <a class="el" href="cli_8c_source.html#l00056">cli_perm::next</a>.</p>

<p>Referenced by <a class="el" href="cli_8c_source.html#l00361">handle_verbose()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00322"></a>00322 {
<a name="l00323"></a>00323    <span class="keywordtype">int</span> i, count = 0;
<a name="l00324"></a>00324    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> prospective[2];
<a name="l00325"></a>00325    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> part = strtoul(partial, NULL, 10);
<a name="l00326"></a>00326    <span class="keywordtype">char</span> <a class="code" href="structcli__perm.html#ad670f4bd3ed1de353cfd64c0a896cdf7">next</a>[12];
<a name="l00327"></a>00327 
<a name="l00328"></a>00328    <span class="keywordflow">if</span> (part &lt; min || part &gt; max) {
<a name="l00329"></a>00329       <span class="keywordflow">return</span> NULL;
<a name="l00330"></a>00330    }
<a name="l00331"></a>00331 
<a name="l00332"></a>00332    <span class="keywordflow">for</span> (i = 0; i &lt; 21; i++) {
<a name="l00333"></a>00333       <span class="keywordflow">if</span> (i == 0) {
<a name="l00334"></a>00334          prospective[0] = prospective[1] = part;
<a name="l00335"></a>00335       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (part == 0 &amp;&amp; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(partial)) {
<a name="l00336"></a>00336          <span class="keywordflow">break</span>;
<a name="l00337"></a>00337       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i &lt; 11) {
<a name="l00338"></a>00338          prospective[0] = prospective[1] = part * 10 + (i - 1);
<a name="l00339"></a>00339       } <span class="keywordflow">else</span> {
<a name="l00340"></a>00340          prospective[0] = (part * 10 + (i - 11)) * 10;
<a name="l00341"></a>00341          prospective[1] = prospective[0] + 9;
<a name="l00342"></a>00342       }
<a name="l00343"></a>00343       <span class="keywordflow">if</span> (i &lt; 11 &amp;&amp; (prospective[0] &lt; min || prospective[0] &gt; max)) {
<a name="l00344"></a>00344          <span class="keywordflow">continue</span>;
<a name="l00345"></a>00345       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (prospective[1] &lt; min || prospective[0] &gt; max) {
<a name="l00346"></a>00346          <span class="keywordflow">continue</span>;
<a name="l00347"></a>00347       }
<a name="l00348"></a>00348 
<a name="l00349"></a>00349       <span class="keywordflow">if</span> (++count &gt; n) {
<a name="l00350"></a>00350          <span class="keywordflow">if</span> (i &lt; 11) {
<a name="l00351"></a>00351             snprintf(next, <span class="keyword">sizeof</span>(next), <span class="stringliteral">&quot;%u&quot;</span>, prospective[0]);
<a name="l00352"></a>00352          } <span class="keywordflow">else</span> {
<a name="l00353"></a>00353             snprintf(next, <span class="keyword">sizeof</span>(next), <span class="stringliteral">&quot;%u...&quot;</span>, prospective[0] / 10);
<a name="l00354"></a>00354          }
<a name="l00355"></a>00355          <span class="keywordflow">return</span> <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(next);
<a name="l00356"></a>00356       }
<a name="l00357"></a>00357    }
<a name="l00358"></a>00358    <span class="keywordflow">return</span> NULL;
<a name="l00359"></a>00359 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa09e50353ce1962ccd90b269e3beb793"></a><!-- doxytag: member="cli.c::destroy_user_perms" ref="aa09e50353ce1962ccd90b269e3beb793" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void destroy_user_perms </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>cleanup (free) <a class="el" href="structcli__perms.html" title="List of users and permissions.">cli_perms</a> linkedlist. </p>

<p>Definition at line <a class="el" href="cli_8c_source.html#l01538">1538</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="linkedlists_8h_source.html#l00817">AST_LIST_REMOVE_HEAD</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, <a class="el" href="cli_8c_source.html#l00055">cli_perm::command</a>, and <a class="el" href="cli_8c_source.html#l00065">usergroup_cli_perm::perms</a>.</p>

<p>Referenced by <a class="el" href="cli_8c_source.html#l01554">ast_cli_perms_init()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01539"></a>01539 {
<a name="l01540"></a>01540    <span class="keyword">struct </span><a class="code" href="structcli__perm.html" title="List of restrictions per user.">cli_perm</a> *perm;
<a name="l01541"></a>01541    <span class="keyword">struct </span><a class="code" href="structusergroup__cli__perm.html" title="list of users to apply restrictions.">usergroup_cli_perm</a> *user_perm;
<a name="l01542"></a>01542 
<a name="l01543"></a>01543    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structcli__perms.html" title="List of users and permissions.">cli_perms</a>);
<a name="l01544"></a>01544    <span class="keywordflow">while</span> ((user_perm = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;<a class="code" href="structcli__perms.html" title="List of users and permissions.">cli_perms</a>, <a class="code" href="structusergroup__cli__perm.html#ae8d794269a5a7fe4ab5c41d55811c113">list</a>))) {
<a name="l01545"></a>01545       <span class="keywordflow">while</span> ((perm = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(user_perm-&gt;<a class="code" href="structusergroup__cli__perm.html#a367ea8bb88f1de1371cb6bbeda0451ba">perms</a>, <a class="code" href="structusergroup__cli__perm.html#ae8d794269a5a7fe4ab5c41d55811c113">list</a>))) {
<a name="l01546"></a>01546          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(perm-&gt;<a class="code" href="structcli__perm.html#ade9cba72805fe52685a1deea307a8e82">command</a>);
<a name="l01547"></a>01547          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(perm);
<a name="l01548"></a>01548       }
<a name="l01549"></a>01549       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(user_perm);
<a name="l01550"></a>01550    }
<a name="l01551"></a>01551    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structcli__perms.html" title="List of users and permissions.">cli_perms</a>);
<a name="l01552"></a>01552 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8a1ff15e1264d5177e9975142a0e9be8"></a><!-- doxytag: member="cli.c::find_best" ref="a8a1ff15e1264d5177e9975142a0e9be8" args="(char *argv[])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* find_best </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>argv</em>[]</td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cli_8c_source.html#l01816">1816</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="utils_8c_source.html#l01451">ast_join()</a>, <a class="el" href="cli_8h_source.html#l00047">AST_MAX_CMD_LEN</a>, <a class="el" href="linkedlists_8h_source.html#l00077">AST_RWLIST_RDLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, and <a class="el" href="cli_8c_source.html#l01772">find_cli()</a>.</p>

<p>Referenced by <a class="el" href="cli_8c_source.html#l02258">ast_cli_command_full()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01817"></a>01817 {
<a name="l01818"></a>01818    <span class="keyword">static</span> <span class="keywordtype">char</span> cmdline[80];
<a name="l01819"></a>01819    <span class="keywordtype">int</span> x;
<a name="l01820"></a>01820    <span class="comment">/* See how close we get, then print the candidate */</span>
<a name="l01821"></a>01821    <span class="keywordtype">char</span> *myargv[<a class="code" href="cli_8h.html#ae88634c402fdd8b46fd5d686dad8bfb9">AST_MAX_CMD_LEN</a>];
<a name="l01822"></a>01822    <span class="keywordflow">for</span> (x=0;x&lt;<a class="code" href="cli_8h.html#ae88634c402fdd8b46fd5d686dad8bfb9">AST_MAX_CMD_LEN</a>;x++)
<a name="l01823"></a>01823       myargv[x]=NULL;
<a name="l01824"></a>01824    <a class="code" href="linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc" title="Read locks a list.">AST_RWLIST_RDLOCK</a>(&amp;<a class="code" href="structhelpers.html">helpers</a>);
<a name="l01825"></a>01825    <span class="keywordflow">for</span> (x=0;argv[x];x++) {
<a name="l01826"></a>01826       myargv[x] = argv[x];
<a name="l01827"></a>01827       <span class="keywordflow">if</span> (!<a class="code" href="cli_8c.html#a7ae95494897a62695433cb697e7fc53b">find_cli</a>(myargv, -1))
<a name="l01828"></a>01828          <span class="keywordflow">break</span>;
<a name="l01829"></a>01829    }
<a name="l01830"></a>01830    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structhelpers.html">helpers</a>);
<a name="l01831"></a>01831    <a class="code" href="strings_8h.html#a0c9c27a9e6b4a6d1e2b868525ae3d0c1">ast_join</a>(cmdline, <span class="keyword">sizeof</span>(cmdline), myargv);
<a name="l01832"></a>01832    <span class="keywordflow">return</span> cmdline;
<a name="l01833"></a>01833 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7ae95494897a62695433cb697e7fc53b"></a><!-- doxytag: member="cli.c::find_cli" ref="a7ae95494897a62695433cb697e7fc53b" args="(char *const cmds[], int match_type)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a>* find_cli </td>
          <td>(</td>
          <td class="paramtype">char *const &nbsp;</td>
          <td class="paramname"> <em>cmds</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>match_type</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cli_8c_source.html#l01772">1772</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="cli_8c_source.html#l00656">cli_next()</a>, <a class="el" href="cli_8h_source.html#l00155">ast_cli_entry::cmda</a>, and <a class="el" href="cli_8c_source.html#l01693">word_match()</a>.</p>

<p>Referenced by <a class="el" href="cli_8c_source.html#l01857">__ast_cli_register()</a>, <a class="el" href="cli_8c_source.html#l02258">ast_cli_command_full()</a>, <a class="el" href="cli_8c_source.html#l01816">find_best()</a>, and <a class="el" href="cli_8c_source.html#l01980">handle_help()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01773"></a>01773 {
<a name="l01774"></a>01774    <span class="keywordtype">int</span> matchlen = -1;   <span class="comment">/* length of longest match so far */</span>
<a name="l01775"></a>01775    <span class="keyword">struct </span><a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a> *cand = NULL, *e=NULL;
<a name="l01776"></a>01776 
<a name="l01777"></a>01777    <span class="keywordflow">while</span> ( (e = <a class="code" href="cli_8c.html#adac48ec5ae21bd48d7f3dac6c44b2868">cli_next</a>(e)) ) {
<a name="l01778"></a>01778       <span class="comment">/* word-by word regexp comparison */</span>
<a name="l01779"></a>01779       <span class="keywordtype">char</span> * <span class="keyword">const</span> *src = cmds;
<a name="l01780"></a>01780       <span class="keywordtype">char</span> * <span class="keyword">const</span> *dst = e-&gt;cmda;
<a name="l01781"></a>01781       <span class="keywordtype">int</span> n = 0;
<a name="l01782"></a>01782       <span class="keywordflow">for</span> (;; dst++, src += n) {
<a name="l01783"></a>01783          n = <a class="code" href="cli_8c.html#a7e2ed1ce1c57688bd381362ae8918d23">word_match</a>(*src, *dst);
<a name="l01784"></a>01784          <span class="keywordflow">if</span> (n &lt; 0)
<a name="l01785"></a>01785             <span class="keywordflow">break</span>;
<a name="l01786"></a>01786       }
<a name="l01787"></a>01787       <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(*dst) || ((*dst)[0] == <span class="charliteral">&apos;[&apos;</span> &amp;&amp; <a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(dst[1]))) {
<a name="l01788"></a>01788          <span class="comment">/* no more words in &apos;e&apos; */</span>
<a name="l01789"></a>01789          <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(*src)) <span class="comment">/* exact match, cannot do better */</span>
<a name="l01790"></a>01790             <span class="keywordflow">break</span>;
<a name="l01791"></a>01791          <span class="comment">/* Here, cmds has more words than the entry &apos;e&apos; */</span>
<a name="l01792"></a>01792          <span class="keywordflow">if</span> (match_type != 0) <span class="comment">/* but we look for almost exact match... */</span>
<a name="l01793"></a>01793             <span class="keywordflow">continue</span>;   <span class="comment">/* so we skip this one. */</span>
<a name="l01794"></a>01794          <span class="comment">/* otherwise we like it (case 0) */</span>
<a name="l01795"></a>01795       } <span class="keywordflow">else</span> { <span class="comment">/* still words in &apos;e&apos; */</span>
<a name="l01796"></a>01796          <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(*src))
<a name="l01797"></a>01797             <span class="keywordflow">continue</span>; <span class="comment">/* cmds is shorter than &apos;e&apos;, not good */</span>
<a name="l01798"></a>01798          <span class="comment">/* Here we have leftover words in cmds and &apos;e&apos;,</span>
<a name="l01799"></a>01799 <span class="comment">          * but there is a mismatch. We only accept this one if match_type == -1</span>
<a name="l01800"></a>01800 <span class="comment">          * and this is the last word for both.</span>
<a name="l01801"></a>01801 <span class="comment">          */</span>
<a name="l01802"></a>01802          <span class="keywordflow">if</span> (match_type != -1 || !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(src[1]) ||
<a name="l01803"></a>01803              !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(dst[1])) <span class="comment">/* not the one we look for */</span>
<a name="l01804"></a>01804             <span class="keywordflow">continue</span>;
<a name="l01805"></a>01805          <span class="comment">/* good, we are in case match_type == -1 and mismatch on last word */</span>
<a name="l01806"></a>01806       }
<a name="l01807"></a>01807       <span class="keywordflow">if</span> (src - cmds &gt; matchlen) {  <span class="comment">/* remember the candidate */</span>
<a name="l01808"></a>01808          matchlen = src - cmds;
<a name="l01809"></a>01809          cand = e;
<a name="l01810"></a>01810       }
<a name="l01811"></a>01811    }
<a name="l01812"></a>01812 
<a name="l01813"></a>01813    <span class="keywordflow">return</span> e ? e : cand;
<a name="l01814"></a>01814 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a765e2a1e8b6f1bb3ab5f6136d3a73564"></a><!-- doxytag: member="cli.c::find_debug_file" ref="a765e2a1e8b6f1bb3ab5f6136d3a73564" args="(const char *fn, unsigned int debug)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__debug__file.html">ast_debug_file</a>* find_debug_file </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>fn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>debug</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Find the debug or verbose file setting. </p>
<ul>
<li>debug 1 for debug, 0 for verbose </li>
</ul>

<p>Definition at line <a class="el" href="cli_8c_source.html#l00308">308</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, and <a class="el" href="cli_8c_source.html#l00085">ast_debug_file::filename</a>.</p>

<p>Referenced by <a class="el" href="cli_8c_source.html#l00361">handle_verbose()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00309"></a>00309 {
<a name="l00310"></a>00310    <span class="keyword">struct </span><a class="code" href="structast__debug__file.html" title="map a debug or verbose value to a filename">ast_debug_file</a> *df = NULL;
<a name="l00311"></a>00311    <span class="keyword">struct </span><a class="code" href="structdebug__file__list.html">debug_file_list</a> *dfl = <a class="code" href="app__rpt_8c.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a> ? &amp;<a class="code" href="cli_8c.html#adf077cec50df93f97b46d8b6261c6f04">debug_files</a> : &amp;<a class="code" href="cli_8c.html#afeb8a3babc8d262f1ae1dabacc656b84">verbose_files</a>;
<a name="l00312"></a>00312 
<a name="l00313"></a>00313    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(dfl, df, entry) {
<a name="l00314"></a>00314       <span class="keywordflow">if</span> (!strcasecmp(df-&gt;<a class="code" href="structast__debug__file.html#afae8c108f5d360038fa8b099eb4ab2f3">filename</a>, fn))
<a name="l00315"></a>00315          <span class="keywordflow">break</span>;
<a name="l00316"></a>00316    }
<a name="l00317"></a>00317 
<a name="l00318"></a>00318    <span class="keywordflow">return</span> df;
<a name="l00319"></a>00319 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a37dd4151926b835c10cc956f14a47857"></a><!-- doxytag: member="cli.c::group_show_channels" ref="a37dd4151926b835c10cc956f14a47857" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* group_show_channels </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cli_8c_source.html#l01411">1411</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8h_source.html#l00141">ast_cli_args::argv</a>, <a class="el" href="app_8c_source.html#l01140">ast_app_group_list_head()</a>, <a class="el" href="app_8c_source.html#l01135">ast_app_group_list_rdlock()</a>, <a class="el" href="app_8c_source.html#l01145">ast_app_group_list_unlock()</a>, <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="linkedlists_8h_source.html#l00438">AST_LIST_NEXT</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="channel_8h_source.html#l01797">ast_group_info::category</a>, <a class="el" href="channel_8h_source.html#l01796">ast_group_info::chan</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="cli_8h_source.html#l00058">ESS</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, <a class="el" href="cli_8c.html#a4610636f10e4604ba296cbf9287b0c7b">FORMAT_STRING</a>, <a class="el" href="channel_8h_source.html#l01798">ast_group_info::group</a>, and <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01412"></a>01412 {
<a name="l01413"></a>01413 <span class="preprocessor">#define FORMAT_STRING  &quot;%-25s  %-20s  %-20s\n&quot;</span>
<a name="l01414"></a>01414 <span class="preprocessor"></span>
<a name="l01415"></a>01415    <span class="keyword">struct </span><a class="code" href="structast__group__info.html" title="channel group info">ast_group_info</a> *gi = NULL;
<a name="l01416"></a>01416    <span class="keywordtype">int</span> numchans = 0;
<a name="l01417"></a>01417    regex_t regexbuf;
<a name="l01418"></a>01418    <span class="keywordtype">int</span> havepattern = 0;
<a name="l01419"></a>01419 
<a name="l01420"></a>01420    <span class="keywordflow">switch</span> (cmd) {
<a name="l01421"></a>01421    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l01422"></a>01422       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;group show channels&quot;</span>;
<a name="l01423"></a>01423       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> = 
<a name="l01424"></a>01424          <span class="stringliteral">&quot;Usage: group show channels [pattern]\n&quot;</span>
<a name="l01425"></a>01425          <span class="stringliteral">&quot;       Lists all currently active channels with channel group(s) specified.\n&quot;</span>
<a name="l01426"></a>01426          <span class="stringliteral">&quot;       Optional regular expression pattern is matched to group names for each\n&quot;</span>
<a name="l01427"></a>01427          <span class="stringliteral">&quot;       channel.\n&quot;</span>;
<a name="l01428"></a>01428       <span class="keywordflow">return</span> NULL;
<a name="l01429"></a>01429    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l01430"></a>01430       <span class="keywordflow">return</span> NULL;
<a name="l01431"></a>01431    }
<a name="l01432"></a>01432 
<a name="l01433"></a>01433    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> &lt; 3 || a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> &gt; 4)
<a name="l01434"></a>01434       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l01435"></a>01435    
<a name="l01436"></a>01436    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> == 4) {
<a name="l01437"></a>01437       <span class="keywordflow">if</span> (regcomp(&amp;regexbuf, a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3], REG_EXTENDED | REG_NOSUB))
<a name="l01438"></a>01438          <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l01439"></a>01439       havepattern = 1;
<a name="l01440"></a>01440    }
<a name="l01441"></a>01441 
<a name="l01442"></a>01442    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, FORMAT_STRING, <span class="stringliteral">&quot;Channel&quot;</span>, <span class="stringliteral">&quot;Group&quot;</span>, <span class="stringliteral">&quot;Category&quot;</span>);
<a name="l01443"></a>01443 
<a name="l01444"></a>01444    <a class="code" href="app_8h.html#afa354da7388ee1882ac981396f143bda" title="Read Lock the group count list.">ast_app_group_list_rdlock</a>();
<a name="l01445"></a>01445    
<a name="l01446"></a>01446    gi = <a class="code" href="app_8h.html#ae351dc6f23997a800e7a743d6411b8e7" title="Get the head of the group count list.">ast_app_group_list_head</a>();
<a name="l01447"></a>01447    <span class="keywordflow">while</span> (gi) {
<a name="l01448"></a>01448       <span class="keywordflow">if</span> (!havepattern || !regexec(&amp;regexbuf, gi-&gt;<a class="code" href="structast__group__info.html#a443519726cbe3c4f2b2fe1d42ce2fd2f">group</a>, 0, NULL, 0)) {
<a name="l01449"></a>01449          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, FORMAT_STRING, gi-&gt;<a class="code" href="structast__group__info.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;name, gi-&gt;<a class="code" href="structast__group__info.html#a443519726cbe3c4f2b2fe1d42ce2fd2f">group</a>, (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(gi-&gt;<a class="code" href="structast__group__info.html#a37188acb1b82f625d3313bc88ca82314">category</a>) ? <span class="stringliteral">&quot;(default)&quot;</span> : gi-&gt;<a class="code" href="structast__group__info.html#a37188acb1b82f625d3313bc88ca82314">category</a>));
<a name="l01450"></a>01450          numchans++;
<a name="l01451"></a>01451       }
<a name="l01452"></a>01452       gi = <a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(gi, group_list);
<a name="l01453"></a>01453    }
<a name="l01454"></a>01454    
<a name="l01455"></a>01455    <a class="code" href="app_8h.html#aa3d01e65e04cddfa84781590b37732e8" title="Unlock the group count list.">ast_app_group_list_unlock</a>();
<a name="l01456"></a>01456    
<a name="l01457"></a>01457    <span class="keywordflow">if</span> (havepattern)
<a name="l01458"></a>01458       regfree(&amp;regexbuf);
<a name="l01459"></a>01459 
<a name="l01460"></a>01460    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;%d active channel%s\n&quot;</span>, numchans, <a class="code" href="cli_8h.html#aa09c07179fe1c89f52bb28bc126d26f2">ESS</a>(numchans));
<a name="l01461"></a>01461    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l01462"></a>01462 <span class="preprocessor">#undef FORMAT_STRING</span>
<a name="l01463"></a>01463 <span class="preprocessor"></span>}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a864ccd72b72ef6f3e8595bd56d611f5f"></a><!-- doxytag: member="cli.c::handle_chanlist" ref="a864ccd72b72ef6f3e8595bd56d611f5f" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* handle_chanlist </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cli_8c_source.html#l00790">790</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00469">ast_channel::_state</a>, <a class="el" href="channel_8h_source.html#l00473">ast_channel::amaflags</a>, <a class="el" href="channel_8h_source.html#l00411">ast_channel::appl</a>, <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8h_source.html#l00167">ast_cli_entry::args</a>, <a class="el" href="cli_8h_source.html#l00141">ast_cli_args::argv</a>, <a class="el" href="pbx_8c_source.html#l04601">ast_active_calls()</a>, <a class="el" href="channel_8c_source.html#l04733">ast_bridged_channel()</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="channel_8c_source.html#l01272">ast_channel_walk_locked()</a>, <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="pbx_8c_source.html#l04606">ast_processed_calls()</a>, <a class="el" href="channel_8c_source.html#l00656">ast_state2str()</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="time_8h_source.html#l00089">ast_tvdiff_ms()</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="time_8h_source.html#l00099">ast_tvzero()</a>, <a class="el" href="channel_8h_source.html#l00422">ast_channel::cdr</a>, <a class="el" href="channel_8h_source.html#l00444">ast_channel::cid</a>, <a class="el" href="channel_8h_source.html#l00203">ast_callerid::cid_num</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="cli_8c.html#a823f7fdf9a34c2f6664d989c6ec7f5d1">CONCISE_FORMAT_STRING</a>, <a class="el" href="channel_8h_source.html#l00503">ast_channel::context</a>, <a class="el" href="channel_8h_source.html#l00412">ast_channel::data</a>, <a class="el" href="cli_8h_source.html#l00058">ESS</a>, <a class="el" href="channel_8h_source.html#l00504">ast_channel::exten</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, <a class="el" href="cli_8c.html#a4610636f10e4604ba296cbf9287b0c7b">FORMAT_STRING</a>, <a class="el" href="cli_8c.html#ae0d41c71069898a93aa08261e2b751e3">FORMAT_STRING2</a>, <a class="el" href="asterisk_8c_source.html#l00177">option_maxcalls</a>, <a class="el" href="channel_8h_source.html#l00471">ast_channel::priority</a>, <a class="el" href="strings_8h_source.html#l00072">S_OR</a>, <a class="el" href="cdr_8h_source.html#l00087">ast_cdr::start</a>, <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>, <a class="el" href="cli_8c.html#aefb5368e504e2c52d6f040ce7c17e4f7">VERBOSE_FORMAT_STRING</a>, and <a class="el" href="cli_8c.html#a6db2285a7884aad0dae73e6d6e523703">VERBOSE_FORMAT_STRING2</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00791"></a>00791 {
<a name="l00792"></a>00792 <span class="preprocessor">#define FORMAT_STRING  &quot;%-20.20s %-20.20s %-7.7s %-30.30s\n&quot;</span>
<a name="l00793"></a>00793 <span class="preprocessor"></span><span class="preprocessor">#define FORMAT_STRING2 &quot;%-20.20s %-20.20s %-7.7s %-30.30s\n&quot;</span>
<a name="l00794"></a>00794 <span class="preprocessor"></span><span class="preprocessor">#define CONCISE_FORMAT_STRING  &quot;%s!%s!%s!%d!%s!%s!%s!%s!%s!%d!%s!%s!%s\n&quot;</span>
<a name="l00795"></a>00795 <span class="preprocessor"></span><span class="preprocessor">#define VERBOSE_FORMAT_STRING  &quot;%-20.20s %-20.20s %-16.16s %4d %-7.7s %-12.12s %-25.25s %-15.15s %8.8s %-11.11s %-20.20s\n&quot;</span>
<a name="l00796"></a>00796 <span class="preprocessor"></span><span class="preprocessor">#define VERBOSE_FORMAT_STRING2 &quot;%-20.20s %-20.20s %-16.16s %-4.4s %-7.7s %-12.12s %-25.25s %-15.15s %8.8s %-11.11s %-20.20s\n&quot;</span>
<a name="l00797"></a>00797 <span class="preprocessor"></span>
<a name="l00798"></a>00798    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c = NULL;
<a name="l00799"></a>00799    <span class="keywordtype">int</span> numchans = 0, concise = 0, verbose = 0, count = 0;
<a name="l00800"></a>00800    <span class="keywordtype">int</span> fd, argc;
<a name="l00801"></a>00801    <span class="keywordtype">char</span> **argv;
<a name="l00802"></a>00802 
<a name="l00803"></a>00803    <span class="keywordflow">switch</span> (cmd) {
<a name="l00804"></a>00804    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l00805"></a>00805       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;core show channels [concise|verbose|count]&quot;</span>;
<a name="l00806"></a>00806       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l00807"></a>00807          <span class="stringliteral">&quot;Usage: core show channels [concise|verbose|count]\n&quot;</span>
<a name="l00808"></a>00808          <span class="stringliteral">&quot;       Lists currently defined channels and some information about them. If\n&quot;</span>
<a name="l00809"></a>00809          <span class="stringliteral">&quot;       &apos;concise&apos; is specified, the format is abridged and in a more easily\n&quot;</span>
<a name="l00810"></a>00810          <span class="stringliteral">&quot;       machine parsable format. If &apos;verbose&apos; is specified, the output includes\n&quot;</span>
<a name="l00811"></a>00811          <span class="stringliteral">&quot;       more and longer fields. If &apos;count&apos; is specified only the channel and call\n&quot;</span>
<a name="l00812"></a>00812          <span class="stringliteral">&quot;       count is output.\n&quot;</span>
<a name="l00813"></a>00813          <span class="stringliteral">&quot;  The &apos;concise&apos; option is deprecated and will be removed from future versions\n&quot;</span>
<a name="l00814"></a>00814          <span class="stringliteral">&quot;  of Asterisk.\n&quot;</span>;
<a name="l00815"></a>00815       <span class="keywordflow">return</span> NULL;
<a name="l00816"></a>00816 
<a name="l00817"></a>00817    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l00818"></a>00818       <span class="keywordflow">return</span> NULL;
<a name="l00819"></a>00819    }
<a name="l00820"></a>00820    fd = a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>;
<a name="l00821"></a>00821    argc = a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a>;
<a name="l00822"></a>00822    argv = a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>;
<a name="l00823"></a>00823 
<a name="l00824"></a>00824    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> == e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a>) {
<a name="l00825"></a>00825       <span class="keywordflow">if</span> (!strcasecmp(argv[e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a>-1],<span class="stringliteral">&quot;concise&quot;</span>))
<a name="l00826"></a>00826          concise = 1;
<a name="l00827"></a>00827       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(argv[e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a>-1],<span class="stringliteral">&quot;verbose&quot;</span>))
<a name="l00828"></a>00828          verbose = 1;
<a name="l00829"></a>00829       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(argv[e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a>-1],<span class="stringliteral">&quot;count&quot;</span>))
<a name="l00830"></a>00830          count = 1;
<a name="l00831"></a>00831       <span class="keywordflow">else</span>
<a name="l00832"></a>00832          <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l00833"></a>00833    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> != e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a> - 1)
<a name="l00834"></a>00834       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l00835"></a>00835 
<a name="l00836"></a>00836    <span class="keywordflow">if</span> (!count) {
<a name="l00837"></a>00837       <span class="keywordflow">if</span> (!concise &amp;&amp; !verbose)
<a name="l00838"></a>00838          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, FORMAT_STRING2, <span class="stringliteral">&quot;Channel&quot;</span>, <span class="stringliteral">&quot;Location&quot;</span>, <span class="stringliteral">&quot;State&quot;</span>, <span class="stringliteral">&quot;Application(Data)&quot;</span>);
<a name="l00839"></a>00839       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (verbose)
<a name="l00840"></a>00840          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, VERBOSE_FORMAT_STRING2, <span class="stringliteral">&quot;Channel&quot;</span>, <span class="stringliteral">&quot;Context&quot;</span>, <span class="stringliteral">&quot;Extension&quot;</span>, <span class="stringliteral">&quot;Priority&quot;</span>, <span class="stringliteral">&quot;State&quot;</span>, <span class="stringliteral">&quot;Application&quot;</span>, <span class="stringliteral">&quot;Data&quot;</span>, 
<a name="l00841"></a>00841             <span class="stringliteral">&quot;CallerID&quot;</span>, <span class="stringliteral">&quot;Duration&quot;</span>, <span class="stringliteral">&quot;Accountcode&quot;</span>, <span class="stringliteral">&quot;BridgedTo&quot;</span>);
<a name="l00842"></a>00842    }
<a name="l00843"></a>00843 
<a name="l00844"></a>00844    <span class="keywordflow">while</span> ((c = <a class="code" href="channel_8h.html#af287194cacb2db8ac7bb50d16a3a2d60" title="Browse channels in use Browse the channels currently in use.">ast_channel_walk_locked</a>(c)) != NULL) {
<a name="l00845"></a>00845       <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *bc = <a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(c);
<a name="l00846"></a>00846       <span class="keywordtype">char</span> durbuf[10] = <span class="stringliteral">&quot;-&quot;</span>;
<a name="l00847"></a>00847 
<a name="l00848"></a>00848       <span class="keywordflow">if</span> (!count) {
<a name="l00849"></a>00849          <span class="keywordflow">if</span> ((concise || verbose)  &amp;&amp; c-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a> &amp;&amp; !<a class="code" href="time_8h.html#a1b7c6177ea781fc11512de25805fc144" title="Returns true if the argument is 0,0.">ast_tvzero</a>(c-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>-&gt;<a class="code" href="structast__cdr.html#ad80305b5e16da9c2675d5f057bd69386">start</a>)) {
<a name="l00850"></a>00850             <span class="keywordtype">int</span> duration = (int)(<a class="code" href="time_8h.html#a74e35cffcd45ad6cd7c8587921e8a4c2" title="Computes the difference (in milliseconds) between two struct timeval instances.">ast_tvdiff_ms</a>(<a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>(), c-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>-&gt;<a class="code" href="structast__cdr.html#ad80305b5e16da9c2675d5f057bd69386">start</a>) / 1000);
<a name="l00851"></a>00851             <span class="keywordflow">if</span> (verbose) {
<a name="l00852"></a>00852                <span class="keywordtype">int</span> durh = duration / 3600;
<a name="l00853"></a>00853                <span class="keywordtype">int</span> durm = (duration % 3600) / 60;
<a name="l00854"></a>00854                <span class="keywordtype">int</span> durs = duration % 60;
<a name="l00855"></a>00855                snprintf(durbuf, <span class="keyword">sizeof</span>(durbuf), <span class="stringliteral">&quot;%02d:%02d:%02d&quot;</span>, durh, durm, durs);
<a name="l00856"></a>00856             } <span class="keywordflow">else</span> {
<a name="l00857"></a>00857                snprintf(durbuf, <span class="keyword">sizeof</span>(durbuf), <span class="stringliteral">&quot;%d&quot;</span>, duration);
<a name="l00858"></a>00858             }           
<a name="l00859"></a>00859          }
<a name="l00860"></a>00860          <span class="keywordflow">if</span> (concise) {
<a name="l00861"></a>00861             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, CONCISE_FORMAT_STRING, c-&gt;name, c-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, c-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>, c-&gt;<a class="code" href="structast__channel.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>, <a class="code" href="channel_8h.html#ac97b5983ea4bf3cc217ea898ca002759" title="Gives the string form of a given channel state.">ast_state2str</a>(c-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a>),
<a name="l00862"></a>00862                c-&gt;<a class="code" href="structast__channel.html#a1fe656155481623fac9882b1f79bc5a3">appl</a> ? c-&gt;<a class="code" href="structast__channel.html#a1fe656155481623fac9882b1f79bc5a3">appl</a> : <span class="stringliteral">&quot;(None)&quot;</span>,
<a name="l00863"></a>00863                <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(c-&gt;<a class="code" href="structast__channel.html#a8f64897c7ccc5c13f276d1d07c4e7095">data</a>, <span class="stringliteral">&quot;&quot;</span>),   <span class="comment">/* XXX different from verbose ? */</span>
<a name="l00864"></a>00864                <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(c-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>, <span class="stringliteral">&quot;&quot;</span>),
<a name="l00865"></a>00865                <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(c-&gt;accountcode, <span class="stringliteral">&quot;&quot;</span>),
<a name="l00866"></a>00866                c-&gt;<a class="code" href="structast__channel.html#ad2cfb0f821c065261382a9298bb5a16b">amaflags</a>, 
<a name="l00867"></a>00867                durbuf,
<a name="l00868"></a>00868                bc ? bc-&gt;name : <span class="stringliteral">&quot;(None)&quot;</span>,
<a name="l00869"></a>00869                c-&gt;uniqueid);
<a name="l00870"></a>00870          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (verbose) {
<a name="l00871"></a>00871             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, VERBOSE_FORMAT_STRING, c-&gt;name, c-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, c-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>, c-&gt;<a class="code" href="structast__channel.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>, <a class="code" href="channel_8h.html#ac97b5983ea4bf3cc217ea898ca002759" title="Gives the string form of a given channel state.">ast_state2str</a>(c-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a>),
<a name="l00872"></a>00872                c-&gt;<a class="code" href="structast__channel.html#a1fe656155481623fac9882b1f79bc5a3">appl</a> ? c-&gt;<a class="code" href="structast__channel.html#a1fe656155481623fac9882b1f79bc5a3">appl</a> : <span class="stringliteral">&quot;(None)&quot;</span>,
<a name="l00873"></a>00873                c-&gt;<a class="code" href="structast__channel.html#a8f64897c7ccc5c13f276d1d07c4e7095">data</a> ? <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(c-&gt;<a class="code" href="structast__channel.html#a8f64897c7ccc5c13f276d1d07c4e7095">data</a>, <span class="stringliteral">&quot;(Empty)&quot;</span> ): <span class="stringliteral">&quot;(None)&quot;</span>,
<a name="l00874"></a>00874                <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(c-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>, <span class="stringliteral">&quot;&quot;</span>),
<a name="l00875"></a>00875                durbuf,
<a name="l00876"></a>00876                <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(c-&gt;accountcode, <span class="stringliteral">&quot;&quot;</span>),
<a name="l00877"></a>00877                bc ? bc-&gt;name : <span class="stringliteral">&quot;(None)&quot;</span>);
<a name="l00878"></a>00878          } <span class="keywordflow">else</span> {
<a name="l00879"></a>00879             <span class="keywordtype">char</span> locbuf[40] = <span class="stringliteral">&quot;(None)&quot;</span>;
<a name="l00880"></a>00880             <span class="keywordtype">char</span> appdata[40] = <span class="stringliteral">&quot;(None)&quot;</span>;
<a name="l00881"></a>00881             
<a name="l00882"></a>00882             <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(c-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>) &amp;&amp; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(c-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>)) 
<a name="l00883"></a>00883                snprintf(locbuf, <span class="keyword">sizeof</span>(locbuf), <span class="stringliteral">&quot;%s@%s:%d&quot;</span>, c-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>, c-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, c-&gt;<a class="code" href="structast__channel.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>);
<a name="l00884"></a>00884             <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structast__channel.html#a1fe656155481623fac9882b1f79bc5a3">appl</a>)
<a name="l00885"></a>00885                snprintf(appdata, <span class="keyword">sizeof</span>(appdata), <span class="stringliteral">&quot;%s(%s)&quot;</span>, c-&gt;<a class="code" href="structast__channel.html#a1fe656155481623fac9882b1f79bc5a3">appl</a>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(c-&gt;<a class="code" href="structast__channel.html#a8f64897c7ccc5c13f276d1d07c4e7095">data</a>, <span class="stringliteral">&quot;&quot;</span>));
<a name="l00886"></a>00886             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, FORMAT_STRING, c-&gt;name, locbuf, <a class="code" href="channel_8h.html#ac97b5983ea4bf3cc217ea898ca002759" title="Gives the string form of a given channel state.">ast_state2str</a>(c-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a>), appdata);
<a name="l00887"></a>00887          }
<a name="l00888"></a>00888       }
<a name="l00889"></a>00889       numchans++;
<a name="l00890"></a>00890       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c);
<a name="l00891"></a>00891    }
<a name="l00892"></a>00892    <span class="keywordflow">if</span> (!concise) {
<a name="l00893"></a>00893       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%d active channel%s\n&quot;</span>, numchans, <a class="code" href="cli_8h.html#aa09c07179fe1c89f52bb28bc126d26f2">ESS</a>(numchans));
<a name="l00894"></a>00894       <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#ga3e1a333df2c22351f326bbfcc509edf3">option_maxcalls</a>)
<a name="l00895"></a>00895          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%d of %d max active call%s (%5.2f%% of capacity)\n&quot;</span>,
<a name="l00896"></a>00896             <a class="code" href="pbx_8h.html#a52a37e9e2d9a1482ef5b7d91001b61ac" title="Retrieve the number of active calls.">ast_active_calls</a>(), <a class="code" href="group__main__options.html#ga3e1a333df2c22351f326bbfcc509edf3">option_maxcalls</a>, <a class="code" href="cli_8h.html#aa09c07179fe1c89f52bb28bc126d26f2">ESS</a>(<a class="code" href="pbx_8h.html#a52a37e9e2d9a1482ef5b7d91001b61ac" title="Retrieve the number of active calls.">ast_active_calls</a>()),
<a name="l00897"></a>00897             ((<span class="keywordtype">double</span>)<a class="code" href="pbx_8h.html#a52a37e9e2d9a1482ef5b7d91001b61ac" title="Retrieve the number of active calls.">ast_active_calls</a>() / (<span class="keywordtype">double</span>)<a class="code" href="group__main__options.html#ga3e1a333df2c22351f326bbfcc509edf3">option_maxcalls</a>) * 100.0);
<a name="l00898"></a>00898       <span class="keywordflow">else</span>
<a name="l00899"></a>00899          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%d active call%s\n&quot;</span>, <a class="code" href="pbx_8h.html#a52a37e9e2d9a1482ef5b7d91001b61ac" title="Retrieve the number of active calls.">ast_active_calls</a>(), <a class="code" href="cli_8h.html#aa09c07179fe1c89f52bb28bc126d26f2">ESS</a>(<a class="code" href="pbx_8h.html#a52a37e9e2d9a1482ef5b7d91001b61ac" title="Retrieve the number of active calls.">ast_active_calls</a>()));
<a name="l00900"></a>00900 
<a name="l00901"></a>00901       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%d call%s processed\n&quot;</span>, <a class="code" href="pbx_8h.html#a6cd4c64e374623ea3393fbc5d580f68e" title="Retrieve the total number of calls processed through the PBX since last restart.">ast_processed_calls</a>(), <a class="code" href="cli_8h.html#aa09c07179fe1c89f52bb28bc126d26f2">ESS</a>(<a class="code" href="pbx_8h.html#a6cd4c64e374623ea3393fbc5d580f68e" title="Retrieve the total number of calls processed through the PBX since last restart.">ast_processed_calls</a>()));
<a name="l00902"></a>00902    }
<a name="l00903"></a>00903    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l00904"></a>00904    
<a name="l00905"></a>00905 <span class="preprocessor">#undef FORMAT_STRING</span>
<a name="l00906"></a>00906 <span class="preprocessor"></span><span class="preprocessor">#undef FORMAT_STRING2</span>
<a name="l00907"></a>00907 <span class="preprocessor"></span><span class="preprocessor">#undef CONCISE_FORMAT_STRING</span>
<a name="l00908"></a>00908 <span class="preprocessor"></span><span class="preprocessor">#undef VERBOSE_FORMAT_STRING</span>
<a name="l00909"></a>00909 <span class="preprocessor"></span><span class="preprocessor">#undef VERBOSE_FORMAT_STRING2</span>
<a name="l00910"></a>00910 <span class="preprocessor"></span>}
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3e8d2dcbe23247ed8025ec7cbc383861"></a><!-- doxytag: member="cli.c::handle_cli_check_permissions" ref="a3e8d2dcbe23247ed8025ec7cbc383861" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* handle_cli_check_permissions </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>handles CLI command 'cli check permissions' </p>

<p>Definition at line <a class="el" href="cli_8c_source.html#l01004">1004</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00163">ast_cli_entry::_full_cmd</a>, <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8h_source.html#l00141">ast_cli_args::argv</a>, <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="cli_8c_source.html#l02253">ast_cli_generator()</a>, <a class="el" href="utils_8c_source.html#l01451">ast_join()</a>, <a class="el" href="cli_8h_source.html#l00049">AST_MAX_ARGS</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="cli_8h_source.html#l00045">CLI_FAILURE</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8c_source.html#l00165">cli_has_permissions()</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8c_source.html#l00656">cli_next()</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="cli_8c_source.html#l00055">cli_perm::command</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, <a class="el" href="cli_8h_source.html#l00142">ast_cli_args::line</a>, <a class="el" href="cli_8h_source.html#l00145">ast_cli_args::n</a>, <a class="el" href="cli_8h_source.html#l00144">ast_cli_args::pos</a>, <a class="el" href="strings_8h_source.html#l00072">S_OR</a>, <a class="el" href="cli_8h_source.html#l00158">ast_cli_entry::summary</a>, <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>, and <a class="el" href="cli_8h_source.html#l00143">ast_cli_args::word</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01005"></a>01005 {
<a name="l01006"></a>01006    <span class="keyword">struct </span>passwd *pw = NULL;
<a name="l01007"></a>01007    <span class="keyword">struct </span><a class="code" href="structgroup.html">group</a> *gr;
<a name="l01008"></a>01008    <span class="keywordtype">int</span> gid = -1, uid = -1;
<a name="l01009"></a>01009    <span class="keywordtype">char</span> command[<a class="code" href="cli_8h.html#a72e6114dccaa5a6f2c8e7d369360db9e">AST_MAX_ARGS</a>] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01010"></a>01010    <span class="keyword">struct </span><a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a> *ce = NULL;
<a name="l01011"></a>01011    <span class="keywordtype">int</span> found = 0;
<a name="l01012"></a>01012    <span class="keywordtype">char</span> *<a class="code" href="structgroup.html">group</a>, *tmp;
<a name="l01013"></a>01013 
<a name="l01014"></a>01014    <span class="keywordflow">switch</span> (cmd) {
<a name="l01015"></a>01015    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l01016"></a>01016       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;cli check permissions&quot;</span>;
<a name="l01017"></a>01017       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l01018"></a>01018          <span class="stringliteral">&quot;Usage: cli check permissions {&lt;username&gt;|@&lt;groupname&gt;|&lt;username&gt;@&lt;groupname&gt;} [&lt;command&gt;]\n&quot;</span>
<a name="l01019"></a>01019          <span class="stringliteral">&quot;       Check permissions config for a user@group or list the allowed commands for the specified user.\n&quot;</span>
<a name="l01020"></a>01020          <span class="stringliteral">&quot;       The username or the groupname may be omitted.\n&quot;</span>;
<a name="l01021"></a>01021       <span class="keywordflow">return</span> NULL;
<a name="l01022"></a>01022    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l01023"></a>01023       <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#a1910d262855b71da353ed0d07a6c7823">pos</a> &gt;= 4) {
<a name="l01024"></a>01024          <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a21652cd28eeec8299b69288967f9a4a1" title="Readline madness Useful for readline, that&amp;#39;s about it.">ast_cli_generator</a>(a-&gt;<a class="code" href="structast__cli__args.html#a2a7a1aa13a4f14075411123a4495593c">line</a> + strlen(<span class="stringliteral">&quot;cli check permissions&quot;</span>) + strlen(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3]) + 1, a-&gt;<a class="code" href="structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">word</a>, a-&gt;<a class="code" href="structast__cli__args.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>);
<a name="l01025"></a>01025       }
<a name="l01026"></a>01026       <span class="keywordflow">return</span> NULL;
<a name="l01027"></a>01027    }
<a name="l01028"></a>01028 
<a name="l01029"></a>01029    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> &lt; 4) {
<a name="l01030"></a>01030       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l01031"></a>01031    }
<a name="l01032"></a>01032 
<a name="l01033"></a>01033    tmp = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3]);
<a name="l01034"></a>01034    group = strchr(tmp, <span class="charliteral">&apos;@&apos;</span>);
<a name="l01035"></a>01035    <span class="keywordflow">if</span> (group) {
<a name="l01036"></a>01036       gr = getgrnam(&amp;group[1]);
<a name="l01037"></a>01037       <span class="keywordflow">if</span> (!gr) {
<a name="l01038"></a>01038          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Unknown group &apos;%s&apos;\n&quot;</span>, &amp;group[1]);
<a name="l01039"></a>01039          <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;
<a name="l01040"></a>01040       }
<a name="l01041"></a>01041       group[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01042"></a>01042       gid = gr-&gt;gr_gid;
<a name="l01043"></a>01043    }
<a name="l01044"></a>01044 
<a name="l01045"></a>01045    <span class="keywordflow">if</span> (!group &amp;&amp; <a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(tmp)) {
<a name="l01046"></a>01046       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;You didn&apos;t supply a username\n&quot;</span>);
<a name="l01047"></a>01047    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(tmp) &amp;&amp; !(pw = getpwnam(tmp))) {
<a name="l01048"></a>01048       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Unknown user &apos;%s&apos;\n&quot;</span>, tmp);
<a name="l01049"></a>01049       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;
<a name="l01050"></a>01050    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pw) {
<a name="l01051"></a>01051       uid = pw-&gt;pw_uid;
<a name="l01052"></a>01052    }
<a name="l01053"></a>01053 
<a name="l01054"></a>01054    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> == 4) {
<a name="l01055"></a>01055       <span class="keywordflow">while</span> ((ce = <a class="code" href="cli_8c.html#adac48ec5ae21bd48d7f3dac6c44b2868">cli_next</a>(ce))) {
<a name="l01056"></a>01056          <span class="comment">/* Hide commands that start with &apos;_&apos; */</span>
<a name="l01057"></a>01057          <span class="keywordflow">if</span> (ce-&gt;<a class="code" href="structast__cli__entry.html#ac15e0df3344959107453d9ba01503746">_full_cmd</a>[0] == <span class="charliteral">&apos;_&apos;</span>) {
<a name="l01058"></a>01058             <span class="keywordflow">continue</span>;
<a name="l01059"></a>01059          }
<a name="l01060"></a>01060          <span class="keywordflow">if</span> (<a class="code" href="cli_8c.html#a97c81620d61e3249bf35cada6df2a088">cli_has_permissions</a>(uid, gid, ce-&gt;<a class="code" href="structast__cli__entry.html#ac15e0df3344959107453d9ba01503746">_full_cmd</a>)) {
<a name="l01061"></a>01061             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;%30.30s %s\n&quot;</span>, ce-&gt;<a class="code" href="structast__cli__entry.html#ac15e0df3344959107453d9ba01503746">_full_cmd</a>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(ce-&gt;<a class="code" href="structast__cli__entry.html#a01f3e852fed0577d6c8f059530d55d50">summary</a>, <span class="stringliteral">&quot;&lt;no description available&gt;&quot;</span>));
<a name="l01062"></a>01062             found++;
<a name="l01063"></a>01063          }
<a name="l01064"></a>01064       }
<a name="l01065"></a>01065       <span class="keywordflow">if</span> (!found) {
<a name="l01066"></a>01066          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;You are not allowed to run any command on Asterisk\n&quot;</span>);
<a name="l01067"></a>01067       }
<a name="l01068"></a>01068    } <span class="keywordflow">else</span> {
<a name="l01069"></a>01069       <a class="code" href="strings_8h.html#a0c9c27a9e6b4a6d1e2b868525ae3d0c1">ast_join</a>(command, <span class="keyword">sizeof</span>(command), a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a> + 4);
<a name="l01070"></a>01070       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;%s &apos;%s%s%s&apos; is %s to run command: &apos;%s&apos;\n&quot;</span>, uid &gt;= 0 ? <span class="stringliteral">&quot;User&quot;</span> : <span class="stringliteral">&quot;Group&quot;</span>, tmp,
<a name="l01071"></a>01071          group &amp;&amp; uid &gt;= 0 ? <span class="stringliteral">&quot;@&quot;</span> : <span class="stringliteral">&quot;&quot;</span>,
<a name="l01072"></a>01072          group ? &amp;group[1] : <span class="stringliteral">&quot;&quot;</span>,
<a name="l01073"></a>01073          <a class="code" href="cli_8c.html#a97c81620d61e3249bf35cada6df2a088">cli_has_permissions</a>(uid, gid, command) ? <span class="stringliteral">&quot;allowed&quot;</span> : <span class="stringliteral">&quot;not allowed&quot;</span>, command);
<a name="l01074"></a>01074    }
<a name="l01075"></a>01075 
<a name="l01076"></a>01076    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l01077"></a>01077 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac09450fa9355a3e44c87c1adada60307"></a><!-- doxytag: member="cli.c::handle_cli_reload_permissions" ref="ac09450fa9355a3e44c87c1adada60307" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* handle_cli_reload_permissions </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>handles CLI command 'cli reload permissions' </p>

<p>Definition at line <a class="el" href="cli_8c_source.html#l00985">985</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="cli_8c_source.html#l01554">ast_cli_perms_init()</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, and <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00986"></a>00986 {
<a name="l00987"></a>00987    <span class="keywordflow">switch</span> (cmd) {
<a name="l00988"></a>00988    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l00989"></a>00989       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;cli reload permissions&quot;</span>;
<a name="l00990"></a>00990       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l00991"></a>00991          <span class="stringliteral">&quot;Usage: cli reload permissions\n&quot;</span>
<a name="l00992"></a>00992          <span class="stringliteral">&quot;       Reload the &apos;cli_permissions.conf&apos; file.\n&quot;</span>;
<a name="l00993"></a>00993       <span class="keywordflow">return</span> NULL;
<a name="l00994"></a>00994    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l00995"></a>00995       <span class="keywordflow">return</span> NULL;
<a name="l00996"></a>00996    }
<a name="l00997"></a>00997 
<a name="l00998"></a>00998    <a class="code" href="__private_8h.html#ade6dbc4196f2fc99250aaafededfb41b">ast_cli_perms_init</a>(1);
<a name="l00999"></a>00999 
<a name="l01000"></a>01000    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l01001"></a>01001 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a11684ce17d4f8b062422b7320eef1015"></a><!-- doxytag: member="cli.c::handle_cli_show_permissions" ref="a11684ce17d4f8b062422b7320eef1015" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* handle_cli_show_permissions </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>handles CLI command 'cli show permissions' </p>

<p>Definition at line <a class="el" href="cli_8c_source.html#l00940">940</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00077">AST_RWLIST_RDLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8c_source.html#l00055">cli_perm::command</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, <a class="el" href="cli_8c_source.html#l00064">usergroup_cli_perm::gid</a>, <a class="el" href="cli_8c_source.html#l00054">cli_perm::permit</a>, <a class="el" href="cli_8c_source.html#l00065">usergroup_cli_perm::perms</a>, <a class="el" href="cli_8c_source.html#l00063">usergroup_cli_perm::uid</a>, and <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00941"></a>00941 {
<a name="l00942"></a>00942    <span class="keyword">struct </span><a class="code" href="structusergroup__cli__perm.html" title="list of users to apply restrictions.">usergroup_cli_perm</a> *cp;
<a name="l00943"></a>00943    <span class="keyword">struct </span><a class="code" href="structcli__perm.html" title="List of restrictions per user.">cli_perm</a> *perm;
<a name="l00944"></a>00944    <span class="keyword">struct </span>passwd *pw = NULL;
<a name="l00945"></a>00945    <span class="keyword">struct </span><a class="code" href="structgroup.html">group</a> *gr = NULL;
<a name="l00946"></a>00946 
<a name="l00947"></a>00947    <span class="keywordflow">switch</span> (cmd) {
<a name="l00948"></a>00948    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l00949"></a>00949       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;cli show permissions&quot;</span>;
<a name="l00950"></a>00950       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l00951"></a>00951          <span class="stringliteral">&quot;Usage: cli show permissions\n&quot;</span>
<a name="l00952"></a>00952          <span class="stringliteral">&quot;       Shows CLI configured permissions.\n&quot;</span>;
<a name="l00953"></a>00953       <span class="keywordflow">return</span> NULL;
<a name="l00954"></a>00954    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l00955"></a>00955       <span class="keywordflow">return</span> NULL;
<a name="l00956"></a>00956    }
<a name="l00957"></a>00957 
<a name="l00958"></a>00958    <a class="code" href="linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc" title="Read locks a list.">AST_RWLIST_RDLOCK</a>(&amp;<a class="code" href="structcli__perms.html" title="List of users and permissions.">cli_perms</a>);
<a name="l00959"></a>00959    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="structcli__perms.html" title="List of users and permissions.">cli_perms</a>, cp, list) {
<a name="l00960"></a>00960       <span class="keywordflow">if</span> (cp-&gt;<a class="code" href="structusergroup__cli__perm.html#a60a34315f460179939054acaf3ed8163">uid</a> &gt;= 0) {
<a name="l00961"></a>00961          pw = getpwuid(cp-&gt;<a class="code" href="structusergroup__cli__perm.html#a60a34315f460179939054acaf3ed8163">uid</a>);
<a name="l00962"></a>00962          <span class="keywordflow">if</span> (pw) {
<a name="l00963"></a>00963             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;user: %s [uid=%d]\n&quot;</span>, pw-&gt;pw_name, cp-&gt;<a class="code" href="structusergroup__cli__perm.html#a60a34315f460179939054acaf3ed8163">uid</a>);
<a name="l00964"></a>00964          }
<a name="l00965"></a>00965       } <span class="keywordflow">else</span> {
<a name="l00966"></a>00966          gr = getgrgid(cp-&gt;<a class="code" href="structusergroup__cli__perm.html#a6567680a890171fbaa1a026477a858d3">gid</a>);
<a name="l00967"></a>00967          <span class="keywordflow">if</span> (gr) {
<a name="l00968"></a>00968             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;group: %s [gid=%d]\n&quot;</span>, gr-&gt;gr_name, cp-&gt;<a class="code" href="structusergroup__cli__perm.html#a6567680a890171fbaa1a026477a858d3">gid</a>);
<a name="l00969"></a>00969          }
<a name="l00970"></a>00970       }
<a name="l00971"></a>00971       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Permissions:\n&quot;</span>);
<a name="l00972"></a>00972       <span class="keywordflow">if</span> (cp-&gt;<a class="code" href="structusergroup__cli__perm.html#a367ea8bb88f1de1371cb6bbeda0451ba">perms</a>) {
<a name="l00973"></a>00973          <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(cp-&gt;<a class="code" href="structusergroup__cli__perm.html#a367ea8bb88f1de1371cb6bbeda0451ba">perms</a>, perm, list) {
<a name="l00974"></a>00974             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;\t%s -&gt; %s\n&quot;</span>, perm-&gt;<a class="code" href="structcli__perm.html#ab01e87324485f2f7b5858cab52e6726e">permit</a> ? <span class="stringliteral">&quot;permit&quot;</span> : <span class="stringliteral">&quot;deny&quot;</span>, perm-&gt;<a class="code" href="structcli__perm.html#ade9cba72805fe52685a1deea307a8e82">command</a>);
<a name="l00975"></a>00975          }
<a name="l00976"></a>00976       }
<a name="l00977"></a>00977       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00978"></a>00978    }
<a name="l00979"></a>00979    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structcli__perms.html" title="List of users and permissions.">cli_perms</a>);
<a name="l00980"></a>00980 
<a name="l00981"></a>00981    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l00982"></a>00982 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac1db63599c1347e2a626f63499c3c018"></a><!-- doxytag: member="cli.c::handle_commandcomplete" ref="ac1db63599c1347e2a626f63499c3c018" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* handle_commandcomplete </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cli_8c_source.html#l01162">1162</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="cli_8c_source.html#l02170">__ast_cli_generator()</a>, <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8h_source.html#l00141">ast_cli_args::argv</a>, <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="adsistub_8c_source.html#l00059">buf</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, and <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01163"></a>01163 {
<a name="l01164"></a>01164    <span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>;
<a name="l01165"></a>01165    <span class="keywordflow">switch</span> (cmd) {
<a name="l01166"></a>01166    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l01167"></a>01167       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;_command complete&quot;</span>;
<a name="l01168"></a>01168       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> = 
<a name="l01169"></a>01169          <span class="stringliteral">&quot;Usage: _command complete \&quot;&lt;line&gt;\&quot; text state\n&quot;</span>
<a name="l01170"></a>01170          <span class="stringliteral">&quot;       This function is used internally to help with command completion and should.\n&quot;</span>
<a name="l01171"></a>01171          <span class="stringliteral">&quot;       never be called by the user directly.\n&quot;</span>;
<a name="l01172"></a>01172       <span class="keywordflow">return</span> NULL;
<a name="l01173"></a>01173    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l01174"></a>01174       <span class="keywordflow">return</span> NULL;
<a name="l01175"></a>01175    }
<a name="l01176"></a>01176    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> != 5)
<a name="l01177"></a>01177       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l01178"></a>01178    buf = <a class="code" href="cli_8c.html#ad05311723605fd9bf9bcf9ebe05323dc">__ast_cli_generator</a>(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[2], a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3], atoi(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[4]), 0);
<a name="l01179"></a>01179    <span class="keywordflow">if</span> (buf) {
<a name="l01180"></a>01180       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;%s&quot;</span>, buf);
<a name="l01181"></a>01181       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(buf);
<a name="l01182"></a>01182    } <span class="keywordflow">else</span>
<a name="l01183"></a>01183       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;NULL\n&quot;</span>);
<a name="l01184"></a>01184    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l01185"></a>01185 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6b6e0b5f4ca0072eadaddf04e6334f63"></a><!-- doxytag: member="cli.c::handle_commandmatchesarray" ref="a6b6e0b5f4ca0072eadaddf04e6334f63" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* handle_commandmatchesarray </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cli_8c_source.html#l01081">1081</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8h_source.html#l00141">ast_cli_args::argv</a>, <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="cli_8h_source.html#l00051">AST_CLI_COMPLETE_EOF</a>, <a class="el" href="cli_8c_source.html#l02109">ast_cli_completion_matches()</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="astmm_8h_source.html#l00081">ast_malloc</a>, <a class="el" href="astmm_8h_source.html#l00093">ast_realloc</a>, <a class="el" href="adsistub_8c_source.html#l00059">buf</a>, <a class="el" href="cli_8h_source.html#l00045">CLI_FAILURE</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, <a class="el" href="func__strings_8c_source.html#l00821">len()</a>, and <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01082"></a>01082 {
<a name="l01083"></a>01083    <span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, *obuf;
<a name="l01084"></a>01084    <span class="keywordtype">int</span> buflen = 2048;
<a name="l01085"></a>01085    <span class="keywordtype">int</span> <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> = 0;
<a name="l01086"></a>01086    <span class="keywordtype">char</span> **matches;
<a name="l01087"></a>01087    <span class="keywordtype">int</span> x, matchlen;
<a name="l01088"></a>01088    
<a name="l01089"></a>01089    <span class="keywordflow">switch</span> (cmd) {
<a name="l01090"></a>01090    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l01091"></a>01091       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;_command matchesarray&quot;</span>;
<a name="l01092"></a>01092       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> = 
<a name="l01093"></a>01093          <span class="stringliteral">&quot;Usage: _command matchesarray \&quot;&lt;line&gt;\&quot; text \n&quot;</span>
<a name="l01094"></a>01094          <span class="stringliteral">&quot;       This function is used internally to help with command completion and should.\n&quot;</span>
<a name="l01095"></a>01095          <span class="stringliteral">&quot;       never be called by the user directly.\n&quot;</span>;
<a name="l01096"></a>01096       <span class="keywordflow">return</span> NULL;
<a name="l01097"></a>01097    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l01098"></a>01098       <span class="keywordflow">return</span> NULL;
<a name="l01099"></a>01099    }
<a name="l01100"></a>01100 
<a name="l01101"></a>01101    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> != 4)
<a name="l01102"></a>01102       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l01103"></a>01103    <span class="keywordflow">if</span> (!(buf = <a class="code" href="astmm_8h.html#a64a0e7a3ab511a3777ac56f5d43c628e">ast_malloc</a>(buflen)))
<a name="l01104"></a>01104       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;
<a name="l01105"></a>01105    buf[len] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01106"></a>01106    matches = <a class="code" href="cli_8h.html#a068d40212b118f7bc09e851af6a45015" title="Generates a NULL-terminated array of strings that 1) begin with the string in the...">ast_cli_completion_matches</a>(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[2], a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3]);
<a name="l01107"></a>01107    <span class="keywordflow">if</span> (matches) {
<a name="l01108"></a>01108       <span class="keywordflow">for</span> (x=0; matches[x]; x++) {
<a name="l01109"></a>01109          matchlen = strlen(matches[x]) + 1;
<a name="l01110"></a>01110          <span class="keywordflow">if</span> (len + matchlen &gt;= buflen) {
<a name="l01111"></a>01111             buflen += matchlen * 3;
<a name="l01112"></a>01112             obuf = buf;
<a name="l01113"></a>01113             <span class="keywordflow">if</span> (!(buf = <a class="code" href="astmm_8h.html#aa852314efa0cfeecee97ffc51b649734">ast_realloc</a>(obuf, buflen))) 
<a name="l01114"></a>01114                <span class="comment">/* Memory allocation failure...  Just free old buffer and be done */</span>
<a name="l01115"></a>01115                <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(obuf);
<a name="l01116"></a>01116          }
<a name="l01117"></a>01117          <span class="keywordflow">if</span> (buf)
<a name="l01118"></a>01118             len += sprintf( buf + len, <span class="stringliteral">&quot;%s &quot;</span>, matches[x]);
<a name="l01119"></a>01119          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(matches[x]);
<a name="l01120"></a>01120          matches[x] = NULL;
<a name="l01121"></a>01121       }
<a name="l01122"></a>01122       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(matches);
<a name="l01123"></a>01123    }
<a name="l01124"></a>01124 
<a name="l01125"></a>01125    <span class="keywordflow">if</span> (buf) {
<a name="l01126"></a>01126       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;%s%s&quot;</span>,buf, <a class="code" href="cli_8h.html#a4970cad1f99a12bc6f6838d538496079">AST_CLI_COMPLETE_EOF</a>);
<a name="l01127"></a>01127       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(buf);
<a name="l01128"></a>01128    } <span class="keywordflow">else</span>
<a name="l01129"></a>01129       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;NULL\n&quot;</span>);
<a name="l01130"></a>01130 
<a name="l01131"></a>01131    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l01132"></a>01132 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad09ea0d383b50baecfa8d3c828e59a0f"></a><!-- doxytag: member="cli.c::handle_commandnummatches" ref="ad09ea0d383b50baecfa8d3c828e59a0f" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* handle_commandnummatches </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cli_8c_source.html#l01136">1136</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8h_source.html#l00141">ast_cli_args::argv</a>, <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="cli_8c_source.html#l02092">ast_cli_generatornummatches()</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, and <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01137"></a>01137 {
<a name="l01138"></a>01138    <span class="keywordtype">int</span> matches = 0;
<a name="l01139"></a>01139 
<a name="l01140"></a>01140    <span class="keywordflow">switch</span> (cmd) {
<a name="l01141"></a>01141    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l01142"></a>01142       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;_command nummatches&quot;</span>;
<a name="l01143"></a>01143       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> = 
<a name="l01144"></a>01144          <span class="stringliteral">&quot;Usage: _command nummatches \&quot;&lt;line&gt;\&quot; text \n&quot;</span>
<a name="l01145"></a>01145          <span class="stringliteral">&quot;       This function is used internally to help with command completion and should.\n&quot;</span>
<a name="l01146"></a>01146          <span class="stringliteral">&quot;       never be called by the user directly.\n&quot;</span>;
<a name="l01147"></a>01147       <span class="keywordflow">return</span> NULL;
<a name="l01148"></a>01148    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l01149"></a>01149       <span class="keywordflow">return</span> NULL;
<a name="l01150"></a>01150    }
<a name="l01151"></a>01151 
<a name="l01152"></a>01152    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> != 4)
<a name="l01153"></a>01153       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l01154"></a>01154 
<a name="l01155"></a>01155    matches = <a class="code" href="cli_8h.html#aeb2e977805785f2382807318e26c4829" title="Return the number of unique matches for the generator.">ast_cli_generatornummatches</a>(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[2], a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3]);
<a name="l01156"></a>01156 
<a name="l01157"></a>01157    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;%d&quot;</span>, matches);
<a name="l01158"></a>01158 
<a name="l01159"></a>01159    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l01160"></a>01160 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab1c36f45ca7d85999d12b028d6445662"></a><!-- doxytag: member="cli.c::handle_core_set_debug_channel" ref="ab1c36f45ca7d85999d12b028d6445662" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* handle_core_set_debug_channel </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cli_8c_source.html#l01187">1187</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8h_source.html#l00167">ast_cli_entry::args</a>, <a class="el" href="cli_8h_source.html#l00141">ast_cli_args::argv</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="channel_8c_source.html#l01272">ast_channel_walk_locked()</a>, <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="cli_8c_source.html#l01390">ast_complete_channels()</a>, <a class="el" href="channel_8c_source.html#l01278">ast_get_channel_by_name_locked()</a>, <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="channel_8h_source.html#l00334">DEBUGCHAN_FLAG</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, <a class="el" href="channel_8h_source.html#l00475">ast_channel::fin</a>, <a class="el" href="channel_8h_source.html#l00477">ast_channel::fout</a>, <a class="el" href="channel_8c_source.html#l00086">global_fin</a>, <a class="el" href="channel_8c_source.html#l00086">global_fout</a>, <a class="el" href="cli_8h_source.html#l00142">ast_cli_args::line</a>, <a class="el" href="cli_8h_source.html#l00145">ast_cli_args::n</a>, <a class="el" href="cli_8h_source.html#l00144">ast_cli_args::pos</a>, <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>, and <a class="el" href="cli_8h_source.html#l00143">ast_cli_args::word</a>.</p>

<p>Referenced by <a class="el" href="cli_8c_source.html#l01250">handle_nodebugchan_deprecated()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01188"></a>01188 {
<a name="l01189"></a>01189    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c = NULL;
<a name="l01190"></a>01190    <span class="keywordtype">int</span> is_all, is_off = 0;
<a name="l01191"></a>01191 
<a name="l01192"></a>01192    <span class="keywordflow">switch</span> (cmd) {
<a name="l01193"></a>01193    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l01194"></a>01194       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;core set debug channel&quot;</span>;
<a name="l01195"></a>01195       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l01196"></a>01196          <span class="stringliteral">&quot;Usage: core set debug channel &lt;all|channel&gt; [off]\n&quot;</span>
<a name="l01197"></a>01197          <span class="stringliteral">&quot;       Enables/disables debugging on all or on a specific channel.\n&quot;</span>;
<a name="l01198"></a>01198       <span class="keywordflow">return</span> NULL;
<a name="l01199"></a>01199 
<a name="l01200"></a>01200    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l01201"></a>01201       <span class="comment">/* XXX remember to handle the optional &quot;off&quot; */</span>
<a name="l01202"></a>01202       <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#a1910d262855b71da353ed0d07a6c7823">pos</a> != e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a>)
<a name="l01203"></a>01203          <span class="keywordflow">return</span> NULL;
<a name="l01204"></a>01204       <span class="keywordflow">return</span> a-&gt;<a class="code" href="structast__cli__args.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> == 0 ? <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(<span class="stringliteral">&quot;all&quot;</span>) : <a class="code" href="cli_8h.html#a3a116acde8f18aa530e5b4a6df420273" title="Command completion for the list of active channels.">ast_complete_channels</a>(a-&gt;line, a-&gt;<a class="code" href="ael_8tab_8c.html#a836535f59bf515522a395858a8029d42">word</a>, a-&gt;pos, a-&gt;n - 1, e-&gt;args);
<a name="l01205"></a>01205    }
<a name="l01206"></a>01206    <span class="comment">/* &apos;core set debug channel {all|chan_id}&apos; */</span>
<a name="l01207"></a>01207    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> == e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a> + 2) {
<a name="l01208"></a>01208       <span class="keywordflow">if</span> (!strcasecmp(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a> + 1], <span class="stringliteral">&quot;off&quot;</span>))
<a name="l01209"></a>01209          is_off = 1;
<a name="l01210"></a>01210       <span class="keywordflow">else</span>
<a name="l01211"></a>01211          <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l01212"></a>01212    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> != e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a> + 1)
<a name="l01213"></a>01213       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l01214"></a>01214 
<a name="l01215"></a>01215    is_all = !strcasecmp(<span class="stringliteral">&quot;all&quot;</span>, a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a>]);
<a name="l01216"></a>01216    <span class="keywordflow">if</span> (is_all) {
<a name="l01217"></a>01217       <span class="keywordflow">if</span> (is_off) {
<a name="l01218"></a>01218          <a class="code" href="channel_8h.html#a7457a2311fc74cc4a5b0aa0d2001835c">global_fin</a> &amp;= ~<a class="code" href="channel_8h.html#a2011c630205057fb4b67eb06145e4a7f">DEBUGCHAN_FLAG</a>;
<a name="l01219"></a>01219          <a class="code" href="channel_8h.html#ade9bc8493de7d579e2f06b55379fc673">global_fout</a> &amp;= ~<a class="code" href="channel_8h.html#a2011c630205057fb4b67eb06145e4a7f">DEBUGCHAN_FLAG</a>;
<a name="l01220"></a>01220       } <span class="keywordflow">else</span> {
<a name="l01221"></a>01221          <a class="code" href="channel_8h.html#a7457a2311fc74cc4a5b0aa0d2001835c">global_fin</a> |= <a class="code" href="channel_8h.html#a2011c630205057fb4b67eb06145e4a7f">DEBUGCHAN_FLAG</a>;
<a name="l01222"></a>01222          <a class="code" href="channel_8h.html#ade9bc8493de7d579e2f06b55379fc673">global_fout</a> |= <a class="code" href="channel_8h.html#a2011c630205057fb4b67eb06145e4a7f">DEBUGCHAN_FLAG</a>;
<a name="l01223"></a>01223       }
<a name="l01224"></a>01224       c = <a class="code" href="channel_8h.html#af287194cacb2db8ac7bb50d16a3a2d60" title="Browse channels in use Browse the channels currently in use.">ast_channel_walk_locked</a>(NULL);
<a name="l01225"></a>01225    } <span class="keywordflow">else</span> {
<a name="l01226"></a>01226       c = <a class="code" href="channel_8h.html#a03e8287876c59ddc00f5567064b2b9ca" title="Get channel by name or uniqueid (locks channel).">ast_get_channel_by_name_locked</a>(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a>]);
<a name="l01227"></a>01227       <span class="keywordflow">if</span> (c == NULL)
<a name="l01228"></a>01228          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;No such channel %s\n&quot;</span>, a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a>]);
<a name="l01229"></a>01229    }
<a name="l01230"></a>01230    <span class="keywordflow">while</span> (c) {
<a name="l01231"></a>01231       <span class="keywordflow">if</span> (!(c-&gt;<a class="code" href="structast__channel.html#aa4b0a5423e11c07e15c3a503c36be0fb">fin</a> &amp; <a class="code" href="channel_8h.html#a2011c630205057fb4b67eb06145e4a7f">DEBUGCHAN_FLAG</a>) || !(c-&gt;<a class="code" href="structast__channel.html#af2ef0dd0824e04b55a277f42c10f3dfa">fout</a> &amp; <a class="code" href="channel_8h.html#a2011c630205057fb4b67eb06145e4a7f">DEBUGCHAN_FLAG</a>)) {
<a name="l01232"></a>01232          <span class="keywordflow">if</span> (is_off) {
<a name="l01233"></a>01233             c-&gt;<a class="code" href="structast__channel.html#aa4b0a5423e11c07e15c3a503c36be0fb">fin</a> &amp;= ~<a class="code" href="channel_8h.html#a2011c630205057fb4b67eb06145e4a7f">DEBUGCHAN_FLAG</a>;
<a name="l01234"></a>01234             c-&gt;<a class="code" href="structast__channel.html#af2ef0dd0824e04b55a277f42c10f3dfa">fout</a> &amp;= ~<a class="code" href="channel_8h.html#a2011c630205057fb4b67eb06145e4a7f">DEBUGCHAN_FLAG</a>;
<a name="l01235"></a>01235          } <span class="keywordflow">else</span> {
<a name="l01236"></a>01236             c-&gt;<a class="code" href="structast__channel.html#aa4b0a5423e11c07e15c3a503c36be0fb">fin</a> |= <a class="code" href="channel_8h.html#a2011c630205057fb4b67eb06145e4a7f">DEBUGCHAN_FLAG</a>;
<a name="l01237"></a>01237             c-&gt;<a class="code" href="structast__channel.html#af2ef0dd0824e04b55a277f42c10f3dfa">fout</a> |= <a class="code" href="channel_8h.html#a2011c630205057fb4b67eb06145e4a7f">DEBUGCHAN_FLAG</a>;
<a name="l01238"></a>01238          }
<a name="l01239"></a>01239          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Debugging %s on channel %s\n&quot;</span>, is_off ? <span class="stringliteral">&quot;disabled&quot;</span> : <span class="stringliteral">&quot;enabled&quot;</span>, c-&gt;name);
<a name="l01240"></a>01240       }
<a name="l01241"></a>01241       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c);
<a name="l01242"></a>01242       <span class="keywordflow">if</span> (!is_all)
<a name="l01243"></a>01243          <span class="keywordflow">break</span>;
<a name="l01244"></a>01244       c = <a class="code" href="channel_8h.html#af287194cacb2db8ac7bb50d16a3a2d60" title="Browse channels in use Browse the channels currently in use.">ast_channel_walk_locked</a>(c);
<a name="l01245"></a>01245    }
<a name="l01246"></a>01246    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Debugging on new channels is %s\n&quot;</span>, is_off ? <span class="stringliteral">&quot;disabled&quot;</span> : <span class="stringliteral">&quot;enabled&quot;</span>);
<a name="l01247"></a>01247    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l01248"></a>01248 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a904ad4d54f223c3e46085fbe746d3891"></a><!-- doxytag: member="cli.c::handle_help" ref="a904ad4d54f223c3e46085fbe746d3891" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char * handle_help </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cli_8c_source.html#l01980">1980</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="cli_8c_source.html#l02170">__ast_cli_generator()</a>, <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8h_source.html#l00167">ast_cli_entry::args</a>, <a class="el" href="cli_8h_source.html#l00141">ast_cli_args::argv</a>, <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="utils_8c_source.html#l01451">ast_join()</a>, <a class="el" href="linkedlists_8h_source.html#l00077">AST_RWLIST_RDLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, <a class="el" href="cli_8c_source.html#l01772">find_cli()</a>, <a class="el" href="cli_8c_source.html#l01951">help1()</a>, <a class="el" href="cli_8h_source.html#l00142">ast_cli_args::line</a>, <a class="el" href="cli_8h_source.html#l00145">ast_cli_args::n</a>, <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>, and <a class="el" href="cli_8h_source.html#l00143">ast_cli_args::word</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01981"></a>01981 {
<a name="l01982"></a>01982    <span class="keywordtype">char</span> fullcmd[80];
<a name="l01983"></a>01983    <span class="keyword">struct </span><a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a> *my_e;
<a name="l01984"></a>01984    <span class="keywordtype">char</span> *res = <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l01985"></a>01985 
<a name="l01986"></a>01986    <span class="keywordflow">if</span> (cmd == <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>) {
<a name="l01987"></a>01987       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;core show help&quot;</span>;
<a name="l01988"></a>01988       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l01989"></a>01989          <span class="stringliteral">&quot;Usage: core show help [topic]\n&quot;</span>
<a name="l01990"></a>01990          <span class="stringliteral">&quot;       When called with a topic as an argument, displays usage\n&quot;</span>
<a name="l01991"></a>01991          <span class="stringliteral">&quot;       information on the given command. If called without a\n&quot;</span>
<a name="l01992"></a>01992          <span class="stringliteral">&quot;       topic, it provides a list of commands.\n&quot;</span>;
<a name="l01993"></a>01993       <span class="keywordflow">return</span> NULL;
<a name="l01994"></a>01994 
<a name="l01995"></a>01995    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cmd == <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>) {
<a name="l01996"></a>01996       <span class="comment">/* skip first 14 or 15 chars, &quot;core show help &quot; */</span>
<a name="l01997"></a>01997       <span class="keywordtype">int</span> l = strlen(a-&gt;<a class="code" href="structast__cli__args.html#a2a7a1aa13a4f14075411123a4495593c">line</a>);
<a name="l01998"></a>01998 
<a name="l01999"></a>01999       <span class="keywordflow">if</span> (l &gt; 15) {
<a name="l02000"></a>02000          l = 15;
<a name="l02001"></a>02001       }
<a name="l02002"></a>02002       <span class="comment">/* XXX watch out, should stop to the non-generator parts */</span>
<a name="l02003"></a>02003       <span class="keywordflow">return</span> <a class="code" href="cli_8c.html#ad05311723605fd9bf9bcf9ebe05323dc">__ast_cli_generator</a>(a-&gt;<a class="code" href="structast__cli__args.html#a2a7a1aa13a4f14075411123a4495593c">line</a> + l, a-&gt;<a class="code" href="structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">word</a>, a-&gt;<a class="code" href="structast__cli__args.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>, 0);
<a name="l02004"></a>02004    }
<a name="l02005"></a>02005    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> == e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a>) {
<a name="l02006"></a>02006       <span class="keywordflow">return</span> <a class="code" href="cli_8c.html#a3b12e002bbf802ab6de30c1609838abd" title="helper for final part of handle_help if locked = 1, assume the list is already locked...">help1</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, NULL, 0);
<a name="l02007"></a>02007    }
<a name="l02008"></a>02008 
<a name="l02009"></a>02009    <a class="code" href="linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc" title="Read locks a list.">AST_RWLIST_RDLOCK</a>(&amp;<a class="code" href="structhelpers.html">helpers</a>);
<a name="l02010"></a>02010    my_e = <a class="code" href="cli_8c.html#a7ae95494897a62695433cb697e7fc53b">find_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a> + 3, 1); <span class="comment">/* try exact match first */</span>
<a name="l02011"></a>02011    <span class="keywordflow">if</span> (!my_e) {
<a name="l02012"></a>02012       res = <a class="code" href="cli_8c.html#a3b12e002bbf802ab6de30c1609838abd" title="helper for final part of handle_help if locked = 1, assume the list is already locked...">help1</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a> + 3, 1 <span class="comment">/* locked */</span>);
<a name="l02013"></a>02013       <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structhelpers.html">helpers</a>);
<a name="l02014"></a>02014       <span class="keywordflow">return</span> res;
<a name="l02015"></a>02015    }
<a name="l02016"></a>02016    <span class="keywordflow">if</span> (my_e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a>)
<a name="l02017"></a>02017       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;%s&quot;</span>, my_e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a>);
<a name="l02018"></a>02018    <span class="keywordflow">else</span> {
<a name="l02019"></a>02019       <a class="code" href="strings_8h.html#a0c9c27a9e6b4a6d1e2b868525ae3d0c1">ast_join</a>(fullcmd, <span class="keyword">sizeof</span>(fullcmd), a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a> + 3);
<a name="l02020"></a>02020       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;No help text available for &apos;%s&apos;.\n&quot;</span>, fullcmd);
<a name="l02021"></a>02021    }
<a name="l02022"></a>02022    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structhelpers.html">helpers</a>);
<a name="l02023"></a>02023    <span class="keywordflow">return</span> res;
<a name="l02024"></a>02024 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae1d61920ef9c62e876cc6d8ab809ce16"></a><!-- doxytag: member="cli.c::handle_load" ref="ae1d61920ef9c62e876cc6d8ab809ce16" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* handle_load </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cli_8c_source.html#l00244">244</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8h_source.html#l00167">ast_cli_entry::args</a>, <a class="el" href="cli_8h_source.html#l00141">ast_cli_args::argv</a>, <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="loader_8c_source.html#l00831">ast_load_resource()</a>, <a class="el" href="cli_8h_source.html#l00045">CLI_FAILURE</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="cli_8c_source.html#l00222">complete_fn()</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, <a class="el" href="cli_8h_source.html#l00145">ast_cli_args::n</a>, <a class="el" href="cli_8h_source.html#l00144">ast_cli_args::pos</a>, <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>, and <a class="el" href="cli_8h_source.html#l00143">ast_cli_args::word</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00245"></a>00245 {
<a name="l00246"></a>00246    <span class="comment">/* &quot;module load &lt;mod&gt;&quot; */</span>
<a name="l00247"></a>00247    <span class="keywordflow">switch</span> (cmd) {
<a name="l00248"></a>00248    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l00249"></a>00249       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;module load&quot;</span>;
<a name="l00250"></a>00250       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l00251"></a>00251          <span class="stringliteral">&quot;Usage: module load &lt;module name&gt;\n&quot;</span>
<a name="l00252"></a>00252          <span class="stringliteral">&quot;       Loads the specified module into Asterisk.\n&quot;</span>;
<a name="l00253"></a>00253       <span class="keywordflow">return</span> NULL;
<a name="l00254"></a>00254 
<a name="l00255"></a>00255    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l00256"></a>00256       <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#a1910d262855b71da353ed0d07a6c7823">pos</a> != e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a>)
<a name="l00257"></a>00257          <span class="keywordflow">return</span> NULL;
<a name="l00258"></a>00258       <span class="keywordflow">return</span> <a class="code" href="cli_8c.html#ab71256f27aa5cbbad9931bc2ae9b2e36">complete_fn</a>(a-&gt;<a class="code" href="structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">word</a>, a-&gt;<a class="code" href="structast__cli__args.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>);
<a name="l00259"></a>00259    }
<a name="l00260"></a>00260    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> != e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a> + 1)
<a name="l00261"></a>00261       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l00262"></a>00262    <span class="keywordflow">if</span> (<a class="code" href="module_8h.html#a841766995d4e10ebb3950b10aab97d9e" title="Load a module.">ast_load_resource</a>(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a>])) {
<a name="l00263"></a>00263       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Unable to load module %s\n&quot;</span>, a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a>]);
<a name="l00264"></a>00264       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;
<a name="l00265"></a>00265    }
<a name="l00266"></a>00266    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l00267"></a>00267 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6271e5ca0474681db9b080dae8c544f4"></a><!-- doxytag: member="cli.c::handle_logger_mute" ref="a6271e5ca0474681db9b080dae8c544f4" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* handle_logger_mute </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cli_8c_source.html#l00517">517</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8h_source.html#l00141">ast_cli_args::argv</a>, <a class="el" href="asterisk_8c_source.html#l01071">ast_console_toggle_mute()</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, and <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00518"></a>00518 {
<a name="l00519"></a>00519    <span class="keywordflow">switch</span> (cmd) {
<a name="l00520"></a>00520    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l00521"></a>00521       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;logger mute&quot;</span>;
<a name="l00522"></a>00522       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> = 
<a name="l00523"></a>00523          <span class="stringliteral">&quot;Usage: logger mute\n&quot;</span>
<a name="l00524"></a>00524          <span class="stringliteral">&quot;       Disables logging output to the current console, making it possible to\n&quot;</span>
<a name="l00525"></a>00525          <span class="stringliteral">&quot;       gather information without being disturbed by scrolling lines.\n&quot;</span>;
<a name="l00526"></a>00526       <span class="keywordflow">return</span> NULL;
<a name="l00527"></a>00527    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l00528"></a>00528       <span class="keywordflow">return</span> NULL;
<a name="l00529"></a>00529    }
<a name="l00530"></a>00530 
<a name="l00531"></a>00531    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> &lt; 2 || a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> &gt; 3)
<a name="l00532"></a>00532       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l00533"></a>00533 
<a name="l00534"></a>00534    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> == 3 &amp;&amp; !strcasecmp(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[2], <span class="stringliteral">&quot;silent&quot;</span>))
<a name="l00535"></a>00535       <a class="code" href="logger_8h.html#a564debc26032b2a42212ac285b4113de" title="mute or unmute a console from logging">ast_console_toggle_mute</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, 1);
<a name="l00536"></a>00536    <span class="keywordflow">else</span>
<a name="l00537"></a>00537       <a class="code" href="logger_8h.html#a564debc26032b2a42212ac285b4113de" title="mute or unmute a console from logging">ast_console_toggle_mute</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, 0);
<a name="l00538"></a>00538 
<a name="l00539"></a>00539    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l00540"></a>00540 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0d2c4cd94a20114dd29790a508b83d99"></a><!-- doxytag: member="cli.c::handle_modlist" ref="a0d2c4cd94a20114dd29790a508b83d99" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* handle_modlist </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cli_8c_source.html#l00696">696</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8h_source.html#l00167">ast_cli_entry::args</a>, <a class="el" href="cli_8h_source.html#l00141">ast_cli_args::argv</a>, <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="loader_8c_source.html#l00542">ast_module_helper()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="loader_8c_source.html#l01097">ast_update_module_list()</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8c_source.html#l00592">climodentrylock</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, <a class="el" href="cli_8h_source.html#l00142">ast_cli_args::line</a>, <a class="el" href="cli_8c_source.html#l00590">MODLIST_FORMAT2</a>, <a class="el" href="cli_8c_source.html#l00595">modlist_modentry()</a>, <a class="el" href="cli_8h_source.html#l00145">ast_cli_args::n</a>, <a class="el" href="cli_8h_source.html#l00144">ast_cli_args::pos</a>, <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>, and <a class="el" href="cli_8h_source.html#l00143">ast_cli_args::word</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00697"></a>00697 {
<a name="l00698"></a>00698    <span class="keywordtype">char</span> *like;
<a name="l00699"></a>00699 
<a name="l00700"></a>00700    <span class="keywordflow">switch</span> (cmd) {
<a name="l00701"></a>00701    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l00702"></a>00702       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;module show [like]&quot;</span>;
<a name="l00703"></a>00703       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l00704"></a>00704          <span class="stringliteral">&quot;Usage: module show [like keyword]\n&quot;</span>
<a name="l00705"></a>00705          <span class="stringliteral">&quot;       Shows Asterisk modules currently in use, and usage statistics.\n&quot;</span>;
<a name="l00706"></a>00706       <span class="keywordflow">return</span> NULL;
<a name="l00707"></a>00707 
<a name="l00708"></a>00708    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l00709"></a>00709       <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#a1910d262855b71da353ed0d07a6c7823">pos</a> == e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a>)
<a name="l00710"></a>00710          <span class="keywordflow">return</span> <a class="code" href="module_8h.html#a2114c90d58e7c3c3638965d1811301e9" title="Match modules names for the Asterisk cli.">ast_module_helper</a>(a-&gt;<a class="code" href="structast__cli__args.html#a2a7a1aa13a4f14075411123a4495593c">line</a>, a-&gt;<a class="code" href="structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">word</a>, a-&gt;<a class="code" href="structast__cli__args.html#a1910d262855b71da353ed0d07a6c7823">pos</a>, a-&gt;<a class="code" href="structast__cli__args.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>, a-&gt;<a class="code" href="structast__cli__args.html#a1910d262855b71da353ed0d07a6c7823">pos</a>, 0);
<a name="l00711"></a>00711       <span class="keywordflow">else</span>
<a name="l00712"></a>00712          <span class="keywordflow">return</span> NULL;
<a name="l00713"></a>00713    }
<a name="l00714"></a>00714    <span class="comment">/* all the above return, so we proceed with the handler.</span>
<a name="l00715"></a>00715 <span class="comment">    * we are guaranteed to have argc &gt;= e-&gt;args</span>
<a name="l00716"></a>00716 <span class="comment">    */</span>
<a name="l00717"></a>00717    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> == e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a> - 1)
<a name="l00718"></a>00718       like = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00719"></a>00719    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> == e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a> + 1 &amp;&amp; !strcasecmp(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a>-1], <span class="stringliteral">&quot;like&quot;</span>) )
<a name="l00720"></a>00720       like = a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a>];
<a name="l00721"></a>00721    <span class="keywordflow">else</span>
<a name="l00722"></a>00722       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l00723"></a>00723       
<a name="l00724"></a>00724    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;<a class="code" href="cli_8c.html#ac7a1346decd3388ab226f4bddc88189a">climodentrylock</a>);
<a name="l00725"></a>00725    <a class="code" href="cli_8c.html#aa5a37575f5e5a07b25c6ee3107d46008">climodentryfd</a> = a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>; <span class="comment">/* global, protected by climodentrylock */</span>
<a name="l00726"></a>00726    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <a class="code" href="cli_8c.html#ab4eccad80b693a6b52fd1706c60fef0e">MODLIST_FORMAT2</a>, <span class="stringliteral">&quot;Module&quot;</span>, <span class="stringliteral">&quot;Description&quot;</span>, <span class="stringliteral">&quot;Use Count&quot;</span>);
<a name="l00727"></a>00727    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>,<span class="stringliteral">&quot;%d modules loaded\n&quot;</span>, <a class="code" href="module_8h.html#a19adc7caa79fecaf1257325ffb366fe7" title="Ask for a list of modules, descriptions, and use counts.">ast_update_module_list</a>(<a class="code" href="cli_8c.html#af1e37c3b4eb5f2c938dff2311d621296">modlist_modentry</a>, like));
<a name="l00728"></a>00728    <a class="code" href="cli_8c.html#aa5a37575f5e5a07b25c6ee3107d46008">climodentryfd</a> = -1;
<a name="l00729"></a>00729    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="cli_8c.html#ac7a1346decd3388ab226f4bddc88189a">climodentrylock</a>);
<a name="l00730"></a>00730    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l00731"></a>00731 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ade46ebd034310224ed0055553eb89af9"></a><!-- doxytag: member="cli.c::handle_nodebugchan_deprecated" ref="ade46ebd034310224ed0055553eb89af9" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* handle_nodebugchan_deprecated </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cli_8c_source.html#l01250">1250</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8h_source.html#l00167">ast_cli_entry::args</a>, <a class="el" href="cli_8h_source.html#l00141">ast_cli_args::argv</a>, <a class="el" href="cli_8h_source.html#l00134">CLI_HANDLER</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, and <a class="el" href="cli_8c_source.html#l01187">handle_core_set_debug_channel()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01251"></a>01251 {
<a name="l01252"></a>01252    <span class="keywordtype">char</span> *res;
<a name="l01253"></a>01253    <span class="keywordflow">if</span> (cmd == <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea2e4a68503bbadbeacf842a24c7d7f2df">CLI_HANDLER</a>) {
<a name="l01254"></a>01254       <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> != e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a> + 1)
<a name="l01255"></a>01255          <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l01256"></a>01256       <span class="comment">/* pretend we have an extra &quot;off&quot; at the end. We can do this as the array</span>
<a name="l01257"></a>01257 <span class="comment">       * is NULL terminated so we overwrite that entry.</span>
<a name="l01258"></a>01258 <span class="comment">       */</span>
<a name="l01259"></a>01259       a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a>+1] = <span class="stringliteral">&quot;off&quot;</span>;
<a name="l01260"></a>01260       a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a>++;
<a name="l01261"></a>01261    }
<a name="l01262"></a>01262    res = <a class="code" href="cli_8c.html#ab1c36f45ca7d85999d12b028d6445662">handle_core_set_debug_channel</a>(e, cmd, a);
<a name="l01263"></a>01263    <span class="keywordflow">if</span> (cmd == <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>)
<a name="l01264"></a>01264       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;no debug channel&quot;</span>;
<a name="l01265"></a>01265    <span class="keywordflow">return</span> res;
<a name="l01266"></a>01266 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a22ca8c73dfd64aee98f04d3015c46bf4"></a><!-- doxytag: member="cli.c::handle_reload" ref="a22ca8c73dfd64aee98f04d3015c46bf4" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* handle_reload </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cli_8c_source.html#l00269">269</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8h_source.html#l00167">ast_cli_entry::args</a>, <a class="el" href="cli_8h_source.html#l00141">ast_cli_args::argv</a>, <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="loader_8c_source.html#l00542">ast_module_helper()</a>, <a class="el" href="loader_8c_source.html#l00637">ast_module_reload()</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, <a class="el" href="cli_8h_source.html#l00142">ast_cli_args::line</a>, <a class="el" href="cli_8h_source.html#l00145">ast_cli_args::n</a>, <a class="el" href="cli_8h_source.html#l00144">ast_cli_args::pos</a>, <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>, and <a class="el" href="cli_8h_source.html#l00143">ast_cli_args::word</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00270"></a>00270 {
<a name="l00271"></a>00271    <span class="keywordtype">int</span> x;
<a name="l00272"></a>00272 
<a name="l00273"></a>00273    <span class="keywordflow">switch</span> (cmd) {
<a name="l00274"></a>00274    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l00275"></a>00275       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;module reload&quot;</span>;
<a name="l00276"></a>00276       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l00277"></a>00277          <span class="stringliteral">&quot;Usage: module reload [module ...]\n&quot;</span>
<a name="l00278"></a>00278          <span class="stringliteral">&quot;       Reloads configuration files for all listed modules which support\n&quot;</span>
<a name="l00279"></a>00279          <span class="stringliteral">&quot;       reloading, or for all supported modules if none are listed.\n&quot;</span>;
<a name="l00280"></a>00280       <span class="keywordflow">return</span> NULL;
<a name="l00281"></a>00281 
<a name="l00282"></a>00282    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l00283"></a>00283       <span class="keywordflow">return</span> <a class="code" href="module_8h.html#a2114c90d58e7c3c3638965d1811301e9" title="Match modules names for the Asterisk cli.">ast_module_helper</a>(a-&gt;<a class="code" href="structast__cli__args.html#a2a7a1aa13a4f14075411123a4495593c">line</a>, a-&gt;<a class="code" href="structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">word</a>, a-&gt;<a class="code" href="structast__cli__args.html#a1910d262855b71da353ed0d07a6c7823">pos</a>, a-&gt;<a class="code" href="structast__cli__args.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>, a-&gt;<a class="code" href="structast__cli__args.html#a1910d262855b71da353ed0d07a6c7823">pos</a>, 1);
<a name="l00284"></a>00284    }
<a name="l00285"></a>00285    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> == e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a>) {
<a name="l00286"></a>00286       <a class="code" href="__private_8h.html#a0d0ff279ff3f2dbbbfb1b49ee6f57add" title="Reload asterisk modules.">ast_module_reload</a>(NULL);
<a name="l00287"></a>00287       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l00288"></a>00288    }
<a name="l00289"></a>00289    <span class="keywordflow">for</span> (x = e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a>; x &lt; a-&gt;argc; x++) {
<a name="l00290"></a>00290       <span class="keywordtype">int</span> res = <a class="code" href="__private_8h.html#a0d0ff279ff3f2dbbbfb1b49ee6f57add" title="Reload asterisk modules.">ast_module_reload</a>(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[x]);
<a name="l00291"></a>00291       <span class="comment">/* XXX reload has multiple error returns, including -1 on error and 2 on success */</span>
<a name="l00292"></a>00292       <span class="keywordflow">switch</span> (res) {
<a name="l00293"></a>00293       <span class="keywordflow">case</span> 0:
<a name="l00294"></a>00294          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;No such module &apos;%s&apos;\n&quot;</span>, a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[x]);
<a name="l00295"></a>00295          <span class="keywordflow">break</span>;
<a name="l00296"></a>00296       <span class="keywordflow">case</span> 1:
<a name="l00297"></a>00297          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Module &apos;%s&apos; does not support reload\n&quot;</span>, a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[x]);
<a name="l00298"></a>00298          <span class="keywordflow">break</span>;
<a name="l00299"></a>00299       }
<a name="l00300"></a>00300    }
<a name="l00301"></a>00301    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l00302"></a>00302 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a814d1ddca930627ac11a3b2d824fc62e"></a><!-- doxytag: member="cli.c::handle_showcalls" ref="a814d1ddca930627ac11a3b2d824fc62e" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* handle_showcalls </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cli_8c_source.html#l00735">735</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8h_source.html#l00167">ast_cli_entry::args</a>, <a class="el" href="cli_8h_source.html#l00141">ast_cli_args::argv</a>, <a class="el" href="pbx_8c_source.html#l04601">ast_active_calls()</a>, <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="pbx_8c_source.html#l04606">ast_processed_calls()</a>, <a class="el" href="asterisk_8c_source.html#l00210">ast_startuptime</a>, <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="utils_8c_source.html#l01379">ast_tvsub()</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="cli_8h_source.html#l00058">ESS</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, <a class="el" href="cli_8h_source.html#l00145">ast_cli_args::n</a>, <a class="el" href="asterisk_8c_source.html#l00177">option_maxcalls</a>, <a class="el" href="cli_8h_source.html#l00144">ast_cli_args::pos</a>, <a class="el" href="cli_8c_source.html#l00605">print_uptimestr()</a>, <a class="el" href="cli_8h_source.html#l00039">RESULT_SUCCESS</a>, and <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00736"></a>00736 {
<a name="l00737"></a>00737    <span class="keyword">struct </span>timeval curtime = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l00738"></a>00738    <span class="keywordtype">int</span> showuptime, printsec;
<a name="l00739"></a>00739 
<a name="l00740"></a>00740    <span class="keywordflow">switch</span> (cmd) {
<a name="l00741"></a>00741    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l00742"></a>00742       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;core show calls [uptime]&quot;</span>;
<a name="l00743"></a>00743       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l00744"></a>00744          <span class="stringliteral">&quot;Usage: core show calls [uptime] [seconds]\n&quot;</span>
<a name="l00745"></a>00745          <span class="stringliteral">&quot;       Lists number of currently active calls and total number of calls\n&quot;</span>
<a name="l00746"></a>00746          <span class="stringliteral">&quot;       processed through PBX since last restart. If &apos;uptime&apos; is specified\n&quot;</span>
<a name="l00747"></a>00747          <span class="stringliteral">&quot;       the system uptime is also displayed. If &apos;seconds&apos; is specified in\n&quot;</span>
<a name="l00748"></a>00748          <span class="stringliteral">&quot;       addition to &apos;uptime&apos;, the system uptime is displayed in seconds.\n&quot;</span>;
<a name="l00749"></a>00749       <span class="keywordflow">return</span> NULL;
<a name="l00750"></a>00750 
<a name="l00751"></a>00751    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l00752"></a>00752       <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#a1910d262855b71da353ed0d07a6c7823">pos</a> != e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a>)
<a name="l00753"></a>00753          <span class="keywordflow">return</span> NULL;
<a name="l00754"></a>00754       <span class="keywordflow">return</span> a-&gt;<a class="code" href="structast__cli__args.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> == 0  ? <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(<span class="stringliteral">&quot;seconds&quot;</span>) : NULL;
<a name="l00755"></a>00755    }
<a name="l00756"></a>00756 
<a name="l00757"></a>00757    <span class="comment">/* regular handler */</span>
<a name="l00758"></a>00758    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> &gt;= e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a> &amp;&amp; !strcasecmp(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a>-1],<span class="stringliteral">&quot;uptime&quot;</span>)) {
<a name="l00759"></a>00759       showuptime = 1;
<a name="l00760"></a>00760 
<a name="l00761"></a>00761       <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> == e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a>+1 &amp;&amp; !strcasecmp(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a>],<span class="stringliteral">&quot;seconds&quot;</span>))
<a name="l00762"></a>00762          printsec = 1;
<a name="l00763"></a>00763       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> == e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a>)
<a name="l00764"></a>00764          printsec = 0;
<a name="l00765"></a>00765       <span class="keywordflow">else</span>
<a name="l00766"></a>00766          <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l00767"></a>00767    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> == e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a>-1) {
<a name="l00768"></a>00768       showuptime = 0;
<a name="l00769"></a>00769       printsec = 0;
<a name="l00770"></a>00770    } <span class="keywordflow">else</span>
<a name="l00771"></a>00771       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l00772"></a>00772 
<a name="l00773"></a>00773    <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#ga3e1a333df2c22351f326bbfcc509edf3">option_maxcalls</a>) {
<a name="l00774"></a>00774       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;%d of %d max active call%s (%5.2f%% of capacity)\n&quot;</span>,
<a name="l00775"></a>00775          <a class="code" href="pbx_8h.html#a52a37e9e2d9a1482ef5b7d91001b61ac" title="Retrieve the number of active calls.">ast_active_calls</a>(), <a class="code" href="group__main__options.html#ga3e1a333df2c22351f326bbfcc509edf3">option_maxcalls</a>, <a class="code" href="cli_8h.html#aa09c07179fe1c89f52bb28bc126d26f2">ESS</a>(<a class="code" href="pbx_8h.html#a52a37e9e2d9a1482ef5b7d91001b61ac" title="Retrieve the number of active calls.">ast_active_calls</a>()),
<a name="l00776"></a>00776          ((<span class="keywordtype">double</span>)<a class="code" href="pbx_8h.html#a52a37e9e2d9a1482ef5b7d91001b61ac" title="Retrieve the number of active calls.">ast_active_calls</a>() / (<span class="keywordtype">double</span>)<a class="code" href="group__main__options.html#ga3e1a333df2c22351f326bbfcc509edf3">option_maxcalls</a>) * 100.0);
<a name="l00777"></a>00777    } <span class="keywordflow">else</span> {
<a name="l00778"></a>00778       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;%d active call%s\n&quot;</span>, <a class="code" href="pbx_8h.html#a52a37e9e2d9a1482ef5b7d91001b61ac" title="Retrieve the number of active calls.">ast_active_calls</a>(), <a class="code" href="cli_8h.html#aa09c07179fe1c89f52bb28bc126d26f2">ESS</a>(<a class="code" href="pbx_8h.html#a52a37e9e2d9a1482ef5b7d91001b61ac" title="Retrieve the number of active calls.">ast_active_calls</a>()));
<a name="l00779"></a>00779    }
<a name="l00780"></a>00780    
<a name="l00781"></a>00781    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;%d call%s processed\n&quot;</span>, <a class="code" href="pbx_8h.html#a6cd4c64e374623ea3393fbc5d580f68e" title="Retrieve the total number of calls processed through the PBX since last restart.">ast_processed_calls</a>(), <a class="code" href="cli_8h.html#aa09c07179fe1c89f52bb28bc126d26f2">ESS</a>(<a class="code" href="pbx_8h.html#a6cd4c64e374623ea3393fbc5d580f68e" title="Retrieve the total number of calls processed through the PBX since last restart.">ast_processed_calls</a>()));
<a name="l00782"></a>00782 
<a name="l00783"></a>00783    <span class="keywordflow">if</span> (<a class="code" href="options_8h.html#acd462f81fa607939af36a9fa33cdbf9d">ast_startuptime</a>.tv_sec &amp;&amp; showuptime) {
<a name="l00784"></a>00784       <a class="code" href="cli_8c.html#a39eebea4b2788ae0175ffa54c61fe276">print_uptimestr</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <a class="code" href="time_8h.html#aa13b651c18bc6004cab21ac041d44dd8" title="Returns the difference of two timevals a - b.">ast_tvsub</a>(curtime, <a class="code" href="options_8h.html#acd462f81fa607939af36a9fa33cdbf9d">ast_startuptime</a>), <span class="stringliteral">&quot;System uptime&quot;</span>, printsec);
<a name="l00785"></a>00785    }
<a name="l00786"></a>00786 
<a name="l00787"></a>00787    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a7cc1753a05a0821f6c70dd2bccfbab5c">RESULT_SUCCESS</a>;
<a name="l00788"></a>00788 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9507ef3d00c28f297846fd44595db1c8"></a><!-- doxytag: member="cli.c::handle_showchan" ref="a9507ef3d00c28f297846fd44595db1c8" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* handle_showchan </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cli_8c_source.html#l01268">1268</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00405">ast_channel::_bridge</a>, <a class="el" href="channel_8h_source.html#l00469">ast_channel::_state</a>, <a class="el" href="channel_8h_source.html#l00411">ast_channel::appl</a>, <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8h_source.html#l00141">ast_cli_args::argv</a>, <a class="el" href="channel_8c_source.html#l04733">ast_bridged_channel()</a>, <a class="el" href="cdr_8c_source.html#l00362">ast_cdr_serialize_variables()</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="cli_8c_source.html#l01390">ast_complete_channels()</a>, <a class="el" href="channel_8h_source.html#l00527">AST_FLAG_BLOCKING</a>, <a class="el" href="channel_8c_source.html#l01278">ast_get_channel_by_name_locked()</a>, <a class="el" href="frame_8c_source.html#l00586">ast_getformatname_multiple()</a>, <a class="el" href="channel_8c_source.html#l00656">ast_state2str()</a>, <a class="el" href="strings_8h_source.html#l00488">ast_str_buffer()</a>, <a class="el" href="strings_8h_source.html#l00637">ast_str_thread_get()</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="channel_8h_source.html#l00410">ast_channel::blockproc</a>, <a class="el" href="channel_8h_source.html#l00447">ast_channel::callgroup</a>, <a class="el" href="channel_8h_source.html#l00422">ast_channel::cdr</a>, <a class="el" href="channel_8h_source.html#l00444">ast_channel::cid</a>, <a class="el" href="channel_8h_source.html#l00202">ast_callerid::cid_dnid</a>, <a class="el" href="channel_8h_source.html#l00204">ast_callerid::cid_name</a>, <a class="el" href="channel_8h_source.html#l00203">ast_callerid::cid_num</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="channel_8h_source.html#l00503">ast_channel::context</a>, <a class="el" href="channel_8h_source.html#l00412">ast_channel::data</a>, <a class="el" href="channel_8h_source.html#l00334">DEBUGCHAN_FLAG</a>, <a class="el" href="channel_8h_source.html#l00504">ast_channel::exten</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, <a class="el" href="channel_8h_source.html#l00458">ast_channel::fds</a>, <a class="el" href="channel_8h_source.html#l00475">ast_channel::fin</a>, <a class="el" href="channel_8h_source.html#l00477">ast_channel::fout</a>, <a class="el" href="cli_8h_source.html#l00142">ast_cli_args::line</a>, <a class="el" href="cli_8h_source.html#l00145">ast_cli_args::n</a>, <a class="el" href="cdr__adaptive__odbc_8c_source.html#l00053">name</a>, <a class="el" href="channel_8h_source.html#l00482">ast_channel::nativeformats</a>, <a class="el" href="pbx_8c_source.html#l08920">pbx_builtin_serialize_variables()</a>, <a class="el" href="channel_8h_source.html#l00448">ast_channel::pickupgroup</a>, <a class="el" href="cli_8h_source.html#l00144">ast_cli_args::pos</a>, <a class="el" href="channel_8h_source.html#l00471">ast_channel::priority</a>, <a class="el" href="channel_8h_source.html#l00483">ast_channel::readformat</a>, <a class="el" href="channel_8h_source.html#l00420">ast_channel::readtrans</a>, <a class="el" href="channel_8h_source.html#l00470">ast_channel::rings</a>, <a class="el" href="strings_8h_source.html#l00072">S_OR</a>, <a class="el" href="adsistub_8c_source.html#l00049">sec</a>, <a class="el" href="cdr_8h_source.html#l00087">ast_cdr::start</a>, <a class="el" href="channel_8h_source.html#l00400">ast_channel::tech</a>, <a class="el" href="channel_8h_source.html#l00226">ast_channel_tech::type</a>, <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>, <a class="el" href="channel_8h_source.html#l00441">ast_channel::whentohangup</a>, <a class="el" href="cli_8h_source.html#l00143">ast_cli_args::word</a>, <a class="el" href="channel_8h_source.html#l00484">ast_channel::writeformat</a>, and <a class="el" href="channel_8h_source.html#l00419">ast_channel::writetrans</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01269"></a>01269 {
<a name="l01270"></a>01270    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c=NULL;
<a name="l01271"></a>01271    <span class="keyword">struct </span>timeval now;
<a name="l01272"></a>01272    <span class="keyword">struct </span><a class="code" href="structast__str.html" title="The descriptor of a dynamic string XXX storage will be optimized later if needed...">ast_str</a> *out = <a class="code" href="strings_8h.html#affe8ca3cf8ee9ab07fe29d11bc824ac4" title="Retrieve a thread locally stored dynamic string.">ast_str_thread_get</a>(&amp;ast_str_thread_global_buf, 16);
<a name="l01273"></a>01273    <span class="keywordtype">char</span> cdrtime[256];
<a name="l01274"></a>01274    <span class="keywordtype">char</span> nf[256], wf[256], rf[256];
<a name="l01275"></a>01275    <span class="keywordtype">long</span> elapsed_seconds=0;
<a name="l01276"></a>01276    <span class="keywordtype">int</span> hour=0, min=0, <a class="code" href="adsistub_8c.html#a4ea74e506098ab381b9efa0200b1e1a4">sec</a>=0;
<a name="l01277"></a>01277 <span class="preprocessor">#ifdef CHANNEL_TRACE</span>
<a name="l01278"></a>01278 <span class="preprocessor"></span>   <span class="keywordtype">int</span> trace_enabled;
<a name="l01279"></a>01279 <span class="preprocessor">#endif</span>
<a name="l01280"></a>01280 <span class="preprocessor"></span>
<a name="l01281"></a>01281    <span class="keywordflow">switch</span> (cmd) {
<a name="l01282"></a>01282    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l01283"></a>01283       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;core show channel&quot;</span>;
<a name="l01284"></a>01284       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> = 
<a name="l01285"></a>01285          <span class="stringliteral">&quot;Usage: core show channel &lt;channel&gt;\n&quot;</span>
<a name="l01286"></a>01286          <span class="stringliteral">&quot;       Shows lots of information about the specified channel.\n&quot;</span>;
<a name="l01287"></a>01287       <span class="keywordflow">return</span> NULL;
<a name="l01288"></a>01288    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l01289"></a>01289       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a3a116acde8f18aa530e5b4a6df420273" title="Command completion for the list of active channels.">ast_complete_channels</a>(a-&gt;<a class="code" href="structast__cli__args.html#a2a7a1aa13a4f14075411123a4495593c">line</a>, a-&gt;<a class="code" href="structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">word</a>, a-&gt;<a class="code" href="structast__cli__args.html#a1910d262855b71da353ed0d07a6c7823">pos</a>, a-&gt;<a class="code" href="structast__cli__args.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>, 3);
<a name="l01290"></a>01290    }
<a name="l01291"></a>01291    
<a name="l01292"></a>01292    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> != 4)
<a name="l01293"></a>01293       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l01294"></a>01294    now = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l01295"></a>01295    c = <a class="code" href="channel_8h.html#a03e8287876c59ddc00f5567064b2b9ca" title="Get channel by name or uniqueid (locks channel).">ast_get_channel_by_name_locked</a>(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3]);
<a name="l01296"></a>01296    <span class="keywordflow">if</span> (!c) {
<a name="l01297"></a>01297       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;%s is not a known channel\n&quot;</span>, a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3]);
<a name="l01298"></a>01298       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l01299"></a>01299    }
<a name="l01300"></a>01300    <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>) {
<a name="l01301"></a>01301       elapsed_seconds = now.tv_sec - c-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>-&gt;<a class="code" href="structast__cdr.html#ad80305b5e16da9c2675d5f057bd69386">start</a>.tv_sec;
<a name="l01302"></a>01302       hour = elapsed_seconds / 3600;
<a name="l01303"></a>01303       min = (elapsed_seconds % 3600) / 60;
<a name="l01304"></a>01304       <a class="code" href="adsistub_8c.html#a4ea74e506098ab381b9efa0200b1e1a4">sec</a> = elapsed_seconds % 60;
<a name="l01305"></a>01305       snprintf(cdrtime, <span class="keyword">sizeof</span>(cdrtime), <span class="stringliteral">&quot;%dh%dm%ds&quot;</span>, hour, min, <a class="code" href="adsistub_8c.html#a4ea74e506098ab381b9efa0200b1e1a4">sec</a>);
<a name="l01306"></a>01306    } <span class="keywordflow">else</span>
<a name="l01307"></a>01307       strcpy(cdrtime, <span class="stringliteral">&quot;N/A&quot;</span>);
<a name="l01308"></a>01308    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, 
<a name="l01309"></a>01309       <span class="stringliteral">&quot; -- General --\n&quot;</span>
<a name="l01310"></a>01310       <span class="stringliteral">&quot;           Name: %s\n&quot;</span>
<a name="l01311"></a>01311       <span class="stringliteral">&quot;           Type: %s\n&quot;</span>
<a name="l01312"></a>01312       <span class="stringliteral">&quot;       UniqueID: %s\n&quot;</span>
<a name="l01313"></a>01313       <span class="stringliteral">&quot;      Caller ID: %s\n&quot;</span>
<a name="l01314"></a>01314       <span class="stringliteral">&quot; Caller ID Name: %s\n&quot;</span>
<a name="l01315"></a>01315       <span class="stringliteral">&quot;    DNID Digits: %s\n&quot;</span>
<a name="l01316"></a>01316       <span class="stringliteral">&quot;       Language: %s\n&quot;</span>
<a name="l01317"></a>01317       <span class="stringliteral">&quot;          State: %s (%d)\n&quot;</span>
<a name="l01318"></a>01318       <span class="stringliteral">&quot;          Rings: %d\n&quot;</span>
<a name="l01319"></a>01319       <span class="stringliteral">&quot;  NativeFormats: %s\n&quot;</span>
<a name="l01320"></a>01320       <span class="stringliteral">&quot;    WriteFormat: %s\n&quot;</span>
<a name="l01321"></a>01321       <span class="stringliteral">&quot;     ReadFormat: %s\n&quot;</span>
<a name="l01322"></a>01322       <span class="stringliteral">&quot; WriteTranscode: %s\n&quot;</span>
<a name="l01323"></a>01323       <span class="stringliteral">&quot;  ReadTranscode: %s\n&quot;</span>
<a name="l01324"></a>01324       <span class="stringliteral">&quot;1st File Descriptor: %d\n&quot;</span>
<a name="l01325"></a>01325       <span class="stringliteral">&quot;      Frames in: %d%s\n&quot;</span>
<a name="l01326"></a>01326       <span class="stringliteral">&quot;     Frames out: %d%s\n&quot;</span>
<a name="l01327"></a>01327       <span class="stringliteral">&quot; Time to Hangup: %ld\n&quot;</span>
<a name="l01328"></a>01328       <span class="stringliteral">&quot;   Elapsed Time: %s\n&quot;</span>
<a name="l01329"></a>01329       <span class="stringliteral">&quot;  Direct Bridge: %s\n&quot;</span>
<a name="l01330"></a>01330       <span class="stringliteral">&quot;Indirect Bridge: %s\n&quot;</span>
<a name="l01331"></a>01331       <span class="stringliteral">&quot; --   PBX   --\n&quot;</span>
<a name="l01332"></a>01332       <span class="stringliteral">&quot;        Context: %s\n&quot;</span>
<a name="l01333"></a>01333       <span class="stringliteral">&quot;      Extension: %s\n&quot;</span>
<a name="l01334"></a>01334       <span class="stringliteral">&quot;       Priority: %d\n&quot;</span>
<a name="l01335"></a>01335       <span class="stringliteral">&quot;     Call Group: %llu\n&quot;</span>
<a name="l01336"></a>01336       <span class="stringliteral">&quot;   Pickup Group: %llu\n&quot;</span>
<a name="l01337"></a>01337       <span class="stringliteral">&quot;    Application: %s\n&quot;</span>
<a name="l01338"></a>01338       <span class="stringliteral">&quot;           Data: %s\n&quot;</span>
<a name="l01339"></a>01339       <span class="stringliteral">&quot;    Blocking in: %s\n&quot;</span>,
<a name="l01340"></a>01340       c-&gt;name, c-&gt;<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>-&gt;<a class="code" href="structast__channel__tech.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>, c-&gt;uniqueid,
<a name="l01341"></a>01341       <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(c-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>, <span class="stringliteral">&quot;(N/A)&quot;</span>),
<a name="l01342"></a>01342       <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(c-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ab2461abe6e234fe4f763b0a2179184b5">cid_name</a>, <span class="stringliteral">&quot;(N/A)&quot;</span>),
<a name="l01343"></a>01343       <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(c-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#aa54ab157f47ac529034d524781e2a7e2">cid_dnid</a>, <span class="stringliteral">&quot;(N/A)&quot;</span>), 
<a name="l01344"></a>01344       c-&gt;language,   
<a name="l01345"></a>01345       <a class="code" href="channel_8h.html#ac97b5983ea4bf3cc217ea898ca002759" title="Gives the string form of a given channel state.">ast_state2str</a>(c-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a>), c-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a>, c-&gt;<a class="code" href="structast__channel.html#a358fd14658a0c5276190e48f1b1f251a">rings</a>, 
<a name="l01346"></a>01346       <a class="code" href="frame_8h.html#a37cdc7e78686b0bfa4e47e645f782b30" title="Get the names of a set of formats.">ast_getformatname_multiple</a>(nf, <span class="keyword">sizeof</span>(nf), c-&gt;<a class="code" href="structast__channel.html#a7be3e8823c2f7e6fe3fc48847ba9bdac">nativeformats</a>), 
<a name="l01347"></a>01347       <a class="code" href="frame_8h.html#a37cdc7e78686b0bfa4e47e645f782b30" title="Get the names of a set of formats.">ast_getformatname_multiple</a>(wf, <span class="keyword">sizeof</span>(wf), c-&gt;<a class="code" href="structast__channel.html#a00f5ce2ad53ff8523f8e46ea5aceba48">writeformat</a>), 
<a name="l01348"></a>01348       <a class="code" href="frame_8h.html#a37cdc7e78686b0bfa4e47e645f782b30" title="Get the names of a set of formats.">ast_getformatname_multiple</a>(rf, <span class="keyword">sizeof</span>(rf), c-&gt;<a class="code" href="structast__channel.html#ab7786a0f5b9a9ebf83daed87be4f3868">readformat</a>),
<a name="l01349"></a>01349       c-&gt;<a class="code" href="structast__channel.html#a58d0c117fa64b075eda1d9a7a7d73531">writetrans</a> ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>,
<a name="l01350"></a>01350       c-&gt;<a class="code" href="structast__channel.html#a9601e6aff2a4c59cbeb9d6fef81184f4">readtrans</a> ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>,
<a name="l01351"></a>01351       c-&gt;<a class="code" href="structast__channel.html#aef68cd3879b791a3b6c12cdb750f8e6a">fds</a>[0],
<a name="l01352"></a>01352       c-&gt;<a class="code" href="structast__channel.html#aa4b0a5423e11c07e15c3a503c36be0fb">fin</a> &amp; ~<a class="code" href="channel_8h.html#a2011c630205057fb4b67eb06145e4a7f">DEBUGCHAN_FLAG</a>, (c-&gt;<a class="code" href="structast__channel.html#aa4b0a5423e11c07e15c3a503c36be0fb">fin</a> &amp; <a class="code" href="channel_8h.html#a2011c630205057fb4b67eb06145e4a7f">DEBUGCHAN_FLAG</a>) ? <span class="stringliteral">&quot; (DEBUGGED)&quot;</span> : <span class="stringliteral">&quot;&quot;</span>,
<a name="l01353"></a>01353       c-&gt;<a class="code" href="structast__channel.html#af2ef0dd0824e04b55a277f42c10f3dfa">fout</a> &amp; ~<a class="code" href="channel_8h.html#a2011c630205057fb4b67eb06145e4a7f">DEBUGCHAN_FLAG</a>, (c-&gt;<a class="code" href="structast__channel.html#af2ef0dd0824e04b55a277f42c10f3dfa">fout</a> &amp; <a class="code" href="channel_8h.html#a2011c630205057fb4b67eb06145e4a7f">DEBUGCHAN_FLAG</a>) ? <span class="stringliteral">&quot; (DEBUGGED)&quot;</span> : <span class="stringliteral">&quot;&quot;</span>,
<a name="l01354"></a>01354       (<span class="keywordtype">long</span>)c-&gt;<a class="code" href="structast__channel.html#a645928dea02ce2132b83e7e61ef5b80a">whentohangup</a>.tv_sec,
<a name="l01355"></a>01355       cdrtime, c-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a> ? c-&gt;<a class="code" href="structast__channel.html#a81ab061f1622c159fe55ba4f17309cc5">_bridge</a>-&gt;name : <span class="stringliteral">&quot;&lt;none&gt;&quot;</span>, <a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(c) ? <a class="code" href="channel_8h.html#a3f52a5e35d47d8986ccaa66a86018e3a" title="Find bridged channel.">ast_bridged_channel</a>(c)-&gt;<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a> : <span class="stringliteral">&quot;&lt;none&gt;&quot;</span>, 
<a name="l01356"></a>01356       c-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, c-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>, c-&gt;<a class="code" href="structast__channel.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>, c-&gt;<a class="code" href="structast__channel.html#af0f007b48a9c8cf0629428bd0483e0d1">callgroup</a>, c-&gt;<a class="code" href="structast__channel.html#abc0651bcec68410023c036b7d8ec4d11">pickupgroup</a>, ( c-&gt;<a class="code" href="structast__channel.html#a1fe656155481623fac9882b1f79bc5a3">appl</a> ? c-&gt;<a class="code" href="structast__channel.html#a1fe656155481623fac9882b1f79bc5a3">appl</a> : <span class="stringliteral">&quot;(N/A)&quot;</span> ),
<a name="l01357"></a>01357       ( c-&gt; data ? <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(c-&gt;<a class="code" href="structast__channel.html#a8f64897c7ccc5c13f276d1d07c4e7095">data</a>, <span class="stringliteral">&quot;(Empty)&quot;</span>) : <span class="stringliteral">&quot;(None)&quot;</span>),
<a name="l01358"></a>01358       (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(c, <a class="code" href="channel_8h.html#adbaf9202177df73e6880eab6e6aab329ab5b2bec9425dd0cfc789d96ef229cb3a">AST_FLAG_BLOCKING</a>) ? c-&gt;<a class="code" href="structast__channel.html#ae9ef3ba2141dce73f755cdd3a34408d3">blockproc</a> : <span class="stringliteral">&quot;(Not Blocking)&quot;</span>));
<a name="l01359"></a>01359    
<a name="l01360"></a>01360    <span class="keywordflow">if</span> (<a class="code" href="pbx_8h.html#a847dc86089ce693d89a534512f16dad1" title="Create a human-readable string, specifying all variables and their corresponding...">pbx_builtin_serialize_variables</a>(c, &amp;out))
<a name="l01361"></a>01361       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>,<span class="stringliteral">&quot;      Variables:\n%s\n&quot;</span>, <a class="code" href="strings_8h.html#a053bdfc229997a75f112bdd7b995e00b" title="Returns the string buffer within the ast_str buf.">ast_str_buffer</a>(out));
<a name="l01362"></a>01362    <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a> &amp;&amp; <a class="code" href="cdr_8h.html#a3e3762a7867ecfa87531598bb8050874">ast_cdr_serialize_variables</a>(c-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>, &amp;out, <span class="charliteral">&apos;=&apos;</span>, <span class="charliteral">&apos;\n&apos;</span>, 1))
<a name="l01363"></a>01363       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>,<span class="stringliteral">&quot;  CDR Variables:\n%s\n&quot;</span>, <a class="code" href="strings_8h.html#a053bdfc229997a75f112bdd7b995e00b" title="Returns the string buffer within the ast_str buf.">ast_str_buffer</a>(out));
<a name="l01364"></a>01364 <span class="preprocessor">#ifdef CHANNEL_TRACE</span>
<a name="l01365"></a>01365 <span class="preprocessor"></span>   trace_enabled = ast_channel_trace_is_enabled(c);
<a name="l01366"></a>01366    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;  Context Trace: %s\n&quot;</span>, trace_enabled ? <span class="stringliteral">&quot;Enabled&quot;</span> : <span class="stringliteral">&quot;Disabled&quot;</span>);
<a name="l01367"></a>01367    <span class="keywordflow">if</span> (trace_enabled &amp;&amp; ast_channel_trace_serialize(c, &amp;out))
<a name="l01368"></a>01368       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;          Trace:\n%s\n&quot;</span>, <a class="code" href="strings_8h.html#a053bdfc229997a75f112bdd7b995e00b" title="Returns the string buffer within the ast_str buf.">ast_str_buffer</a>(out));
<a name="l01369"></a>01369 <span class="preprocessor">#endif</span>
<a name="l01370"></a>01370 <span class="preprocessor"></span>   <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c);
<a name="l01371"></a>01371    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l01372"></a>01372 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab1e834548243108d1f0a6ed298451f0e"></a><!-- doxytag: member="cli.c::handle_showuptime" ref="ab1e834548243108d1f0a6ed298451f0e" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* handle_showuptime </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cli_8c_source.html#l00665">665</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8h_source.html#l00167">ast_cli_entry::args</a>, <a class="el" href="cli_8h_source.html#l00141">ast_cli_args::argv</a>, <a class="el" href="asterisk_8c_source.html#l00211">ast_lastreloadtime</a>, <a class="el" href="asterisk_8c_source.html#l00210">ast_startuptime</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="utils_8c_source.html#l01379">ast_tvsub()</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, <a class="el" href="cli_8c_source.html#l00605">print_uptimestr()</a>, and <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00666"></a>00666 {
<a name="l00667"></a>00667    <span class="keyword">struct </span>timeval curtime = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l00668"></a>00668    <span class="keywordtype">int</span> printsec;
<a name="l00669"></a>00669 
<a name="l00670"></a>00670    <span class="keywordflow">switch</span> (cmd) {
<a name="l00671"></a>00671    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l00672"></a>00672       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;core show uptime [seconds]&quot;</span>;
<a name="l00673"></a>00673       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l00674"></a>00674          <span class="stringliteral">&quot;Usage: core show uptime [seconds]\n&quot;</span>
<a name="l00675"></a>00675          <span class="stringliteral">&quot;       Shows Asterisk uptime information.\n&quot;</span>
<a name="l00676"></a>00676          <span class="stringliteral">&quot;       The seconds word returns the uptime in seconds only.\n&quot;</span>;
<a name="l00677"></a>00677       <span class="keywordflow">return</span> NULL;
<a name="l00678"></a>00678 
<a name="l00679"></a>00679    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l00680"></a>00680       <span class="keywordflow">return</span> NULL;
<a name="l00681"></a>00681    }
<a name="l00682"></a>00682    <span class="comment">/* regular handler */</span>
<a name="l00683"></a>00683    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> == e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a> &amp;&amp; !strcasecmp(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a>-1],<span class="stringliteral">&quot;seconds&quot;</span>))
<a name="l00684"></a>00684       printsec = 1;
<a name="l00685"></a>00685    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> == e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a>-1)
<a name="l00686"></a>00686       printsec = 0;
<a name="l00687"></a>00687    <span class="keywordflow">else</span>
<a name="l00688"></a>00688       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l00689"></a>00689    <span class="keywordflow">if</span> (<a class="code" href="options_8h.html#acd462f81fa607939af36a9fa33cdbf9d">ast_startuptime</a>.tv_sec)
<a name="l00690"></a>00690       <a class="code" href="cli_8c.html#a39eebea4b2788ae0175ffa54c61fe276">print_uptimestr</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <a class="code" href="time_8h.html#aa13b651c18bc6004cab21ac041d44dd8" title="Returns the difference of two timevals a - b.">ast_tvsub</a>(curtime, <a class="code" href="options_8h.html#acd462f81fa607939af36a9fa33cdbf9d">ast_startuptime</a>), <span class="stringliteral">&quot;System uptime&quot;</span>, printsec);
<a name="l00691"></a>00691    <span class="keywordflow">if</span> (<a class="code" href="options_8h.html#a7cdafc5a121e87659887ffc9abe36760">ast_lastreloadtime</a>.tv_sec)
<a name="l00692"></a>00692       <a class="code" href="cli_8c.html#a39eebea4b2788ae0175ffa54c61fe276">print_uptimestr</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <a class="code" href="time_8h.html#aa13b651c18bc6004cab21ac041d44dd8" title="Returns the difference of two timevals a - b.">ast_tvsub</a>(curtime, <a class="code" href="options_8h.html#a7cdafc5a121e87659887ffc9abe36760">ast_lastreloadtime</a>), <span class="stringliteral">&quot;Last reload&quot;</span>, printsec);
<a name="l00693"></a>00693    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l00694"></a>00694 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac430b627eac1469fcadb602741d8c247"></a><!-- doxytag: member="cli.c::handle_softhangup" ref="ac430b627eac1469fcadb602741d8c247" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* handle_softhangup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cli_8c_source.html#l00912">912</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8h_source.html#l00167">ast_cli_entry::args</a>, <a class="el" href="cli_8h_source.html#l00141">ast_cli_args::argv</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="cli_8c_source.html#l01390">ast_complete_channels()</a>, <a class="el" href="channel_8c_source.html#l01278">ast_get_channel_by_name_locked()</a>, <a class="el" href="channel_8c_source.html#l01666">ast_softhangup()</a>, <a class="el" href="channel_8h_source.html#l00639">AST_SOFTHANGUP_EXPLICIT</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, <a class="el" href="cli_8h_source.html#l00142">ast_cli_args::line</a>, <a class="el" href="cli_8h_source.html#l00145">ast_cli_args::n</a>, <a class="el" href="cli_8h_source.html#l00144">ast_cli_args::pos</a>, <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>, and <a class="el" href="cli_8h_source.html#l00143">ast_cli_args::word</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00913"></a>00913 {
<a name="l00914"></a>00914    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *c=NULL;
<a name="l00915"></a>00915 
<a name="l00916"></a>00916    <span class="keywordflow">switch</span> (cmd) {
<a name="l00917"></a>00917    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l00918"></a>00918       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;channel request hangup&quot;</span>;
<a name="l00919"></a>00919       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l00920"></a>00920          <span class="stringliteral">&quot;Usage: channel request hangup &lt;channel&gt;\n&quot;</span>
<a name="l00921"></a>00921          <span class="stringliteral">&quot;       Request that a channel be hung up. The hangup takes effect\n&quot;</span>
<a name="l00922"></a>00922          <span class="stringliteral">&quot;       the next time the driver reads or writes from the channel\n&quot;</span>;
<a name="l00923"></a>00923       <span class="keywordflow">return</span> NULL;
<a name="l00924"></a>00924    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l00925"></a>00925       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a3a116acde8f18aa530e5b4a6df420273" title="Command completion for the list of active channels.">ast_complete_channels</a>(a-&gt;<a class="code" href="structast__cli__args.html#a2a7a1aa13a4f14075411123a4495593c">line</a>, a-&gt;<a class="code" href="structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">word</a>, a-&gt;<a class="code" href="structast__cli__args.html#a1910d262855b71da353ed0d07a6c7823">pos</a>, a-&gt;<a class="code" href="structast__cli__args.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>, e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a>);
<a name="l00926"></a>00926    }
<a name="l00927"></a>00927    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> != 4)
<a name="l00928"></a>00928       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l00929"></a>00929    c = <a class="code" href="channel_8h.html#a03e8287876c59ddc00f5567064b2b9ca" title="Get channel by name or uniqueid (locks channel).">ast_get_channel_by_name_locked</a>(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3]);
<a name="l00930"></a>00930    <span class="keywordflow">if</span> (c) {
<a name="l00931"></a>00931       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Requested Hangup on channel &apos;%s&apos;\n&quot;</span>, c-&gt;name);
<a name="l00932"></a>00932       <a class="code" href="channel_8h.html#ac2d6607253f7e8b272d4e845474eaa9b" title="Softly hangup up a channel.">ast_softhangup</a>(c, <a class="code" href="channel_8h.html#a2dbb833ef0dcc466dd02ee76badaf709a2b3b711afc65059c4b51008c9fbc7aee">AST_SOFTHANGUP_EXPLICIT</a>);
<a name="l00933"></a>00933       <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(c);
<a name="l00934"></a>00934    } <span class="keywordflow">else</span>
<a name="l00935"></a>00935       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;%s is not a known channel\n&quot;</span>, a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3]);
<a name="l00936"></a>00936    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l00937"></a>00937 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a066fdc101e74c3d7ec12645a44e48eb9"></a><!-- doxytag: member="cli.c::handle_unload" ref="a066fdc101e74c3d7ec12645a44e48eb9" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* handle_unload </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cli_8c_source.html#l00542">542</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8h_source.html#l00167">ast_cli_entry::args</a>, <a class="el" href="cli_8h_source.html#l00141">ast_cli_args::argv</a>, <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="module_8h_source.html#l00055">AST_FORCE_FIRM</a>, <a class="el" href="module_8h_source.html#l00056">AST_FORCE_HARD</a>, <a class="el" href="module_8h_source.html#l00054">AST_FORCE_SOFT</a>, <a class="el" href="loader_8c_source.html#l00542">ast_module_helper()</a>, <a class="el" href="loader_8c_source.html#l00482">ast_unload_resource()</a>, <a class="el" href="cli_8h_source.html#l00045">CLI_FAILURE</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, <a class="el" href="cli_8h_source.html#l00142">ast_cli_args::line</a>, <a class="el" href="cli_8h_source.html#l00145">ast_cli_args::n</a>, <a class="el" href="cli_8h_source.html#l00144">ast_cli_args::pos</a>, <a class="el" href="aesopt_8h_source.html#l00399">s</a>, <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>, and <a class="el" href="cli_8h_source.html#l00143">ast_cli_args::word</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00543"></a>00543 {
<a name="l00544"></a>00544    <span class="comment">/* &quot;module unload mod_1 [mod_2 .. mod_N]&quot; */</span>
<a name="l00545"></a>00545    <span class="keywordtype">int</span> x;
<a name="l00546"></a>00546    <span class="keywordtype">int</span> force = <a class="code" href="module_8h.html#ac034ec04e9dd255a0d39bdfcb73113b9a10bb7955de423b36c75f645de78d2f39">AST_FORCE_SOFT</a>;
<a name="l00547"></a>00547    <span class="keywordtype">char</span> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>;
<a name="l00548"></a>00548 
<a name="l00549"></a>00549    <span class="keywordflow">switch</span> (cmd) {
<a name="l00550"></a>00550    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l00551"></a>00551       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;module unload&quot;</span>;
<a name="l00552"></a>00552       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l00553"></a>00553          <span class="stringliteral">&quot;Usage: module unload [-f|-h] &lt;module_1&gt; [&lt;module_2&gt; ... ]\n&quot;</span>
<a name="l00554"></a>00554          <span class="stringliteral">&quot;       Unloads the specified module from Asterisk. The -f\n&quot;</span>
<a name="l00555"></a>00555          <span class="stringliteral">&quot;       option causes the module to be unloaded even if it is\n&quot;</span>
<a name="l00556"></a>00556          <span class="stringliteral">&quot;       in use (may cause a crash) and the -h module causes the\n&quot;</span>
<a name="l00557"></a>00557          <span class="stringliteral">&quot;       module to be unloaded even if the module says it cannot, \n&quot;</span>
<a name="l00558"></a>00558          <span class="stringliteral">&quot;       which almost always will cause a crash.\n&quot;</span>;
<a name="l00559"></a>00559       <span class="keywordflow">return</span> NULL;
<a name="l00560"></a>00560 
<a name="l00561"></a>00561    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l00562"></a>00562       <span class="keywordflow">return</span> <a class="code" href="module_8h.html#a2114c90d58e7c3c3638965d1811301e9" title="Match modules names for the Asterisk cli.">ast_module_helper</a>(a-&gt;<a class="code" href="structast__cli__args.html#a2a7a1aa13a4f14075411123a4495593c">line</a>, a-&gt;<a class="code" href="structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">word</a>, a-&gt;<a class="code" href="structast__cli__args.html#a1910d262855b71da353ed0d07a6c7823">pos</a>, a-&gt;<a class="code" href="structast__cli__args.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>, a-&gt;<a class="code" href="structast__cli__args.html#a1910d262855b71da353ed0d07a6c7823">pos</a>, 0);
<a name="l00563"></a>00563    }
<a name="l00564"></a>00564    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> &lt; e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a> + 1)
<a name="l00565"></a>00565       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l00566"></a>00566    x = e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a>;   <span class="comment">/* first argument */</span>
<a name="l00567"></a>00567    s = a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[x];
<a name="l00568"></a>00568    <span class="keywordflow">if</span> (s[0] == <span class="charliteral">&apos;-&apos;</span>) {
<a name="l00569"></a>00569       <span class="keywordflow">if</span> (s[1] == <span class="charliteral">&apos;f&apos;</span>)
<a name="l00570"></a>00570          force = <a class="code" href="module_8h.html#ac034ec04e9dd255a0d39bdfcb73113b9a8145144df4ddbc9122deba5069de0522">AST_FORCE_FIRM</a>;
<a name="l00571"></a>00571       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s[1] == <span class="charliteral">&apos;h&apos;</span>)
<a name="l00572"></a>00572          force = <a class="code" href="module_8h.html#ac034ec04e9dd255a0d39bdfcb73113b9a4fbd520c0fa0b70495fe9dd6aee373b9">AST_FORCE_HARD</a>;
<a name="l00573"></a>00573       <span class="keywordflow">else</span>
<a name="l00574"></a>00574          <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l00575"></a>00575       <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> &lt; e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a> + 2) <span class="comment">/* need at least one module name */</span>
<a name="l00576"></a>00576          <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l00577"></a>00577       x++;  <span class="comment">/* skip this argument */</span>
<a name="l00578"></a>00578    }
<a name="l00579"></a>00579 
<a name="l00580"></a>00580    <span class="keywordflow">for</span> (; x &lt; a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a>; x++) {
<a name="l00581"></a>00581       <span class="keywordflow">if</span> (<a class="code" href="module_8h.html#a52f6615f305951a0d61adc6e61920c34" title="Unload a module.">ast_unload_resource</a>(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[x], force)) {
<a name="l00582"></a>00582          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Unable to unload resource %s\n&quot;</span>, a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[x]);
<a name="l00583"></a>00583          <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;
<a name="l00584"></a>00584       }
<a name="l00585"></a>00585    }
<a name="l00586"></a>00586    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l00587"></a>00587 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5151d42e59bf1fcba488149926269792"></a><!-- doxytag: member="cli.c::handle_verbose" ref="a5151d42e59bf1fcba488149926269792" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* handle_verbose </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cli_8c_source.html#l00361">361</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8h_source.html#l00167">ast_cli_entry::args</a>, <a class="el" href="cli_8h_source.html#l00141">ast_cli_args::argv</a>, <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="utils_8h_source.html#l00075">ast_clear_flag</a>, <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="asterisk_8c_source.html#l00335">ast_complete_source_filename()</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="options_8h_source.html#l00082">AST_OPT_FLAG_DEBUG_FILE</a>, <a class="el" href="options_8h_source.html#l00084">AST_OPT_FLAG_VERBOSE_FILE</a>, <a class="el" href="asterisk_8c_source.html#l00171">ast_options</a>, <a class="el" href="linkedlists_8h_source.html#l00451">AST_RWLIST_EMPTY</a>, <a class="el" href="linkedlists_8h_source.html#l00725">AST_RWLIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h_source.html#l00860">AST_RWLIST_REMOVE</a>, <a class="el" href="linkedlists_8h_source.html#l00828">AST_RWLIST_REMOVE_HEAD</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, <a class="el" href="utils_8h_source.html#l00068">ast_set_flag</a>, <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="cli_8h_source.html#l00045">CLI_FAILURE</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="cli_8c_source.html#l00321">complete_number()</a>, <a class="el" href="app__rpt_8c_source.html#l00439">debug</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, <a class="el" href="cli_8c_source.html#l00085">ast_debug_file::filename</a>, <a class="el" href="cli_8c_source.html#l00308">find_debug_file()</a>, <a class="el" href="cli_8c_source.html#l00083">ast_debug_file::level</a>, <a class="el" href="cli_8h_source.html#l00145">ast_cli_args::n</a>, <a class="el" href="asterisk_8c_source.html#l00175">option_debug</a>, <a class="el" href="asterisk_8c_source.html#l00174">option_verbose</a>, <a class="el" href="cli_8h_source.html#l00144">ast_cli_args::pos</a>, <a class="el" href="strings_8h_source.html#l00072">S_OR</a>, and <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00362"></a>00362 {
<a name="l00363"></a>00363    <span class="keywordtype">int</span> oldval;
<a name="l00364"></a>00364    <span class="keywordtype">int</span> newlevel;
<a name="l00365"></a>00365    <span class="keywordtype">int</span> atleast = 0;
<a name="l00366"></a>00366    <span class="keywordtype">int</span> fd = a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>;
<a name="l00367"></a>00367    <span class="keywordtype">int</span> argc = a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a>;
<a name="l00368"></a>00368    <span class="keywordtype">char</span> **argv = a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>;
<a name="l00369"></a>00369    <span class="keywordtype">char</span> *argv3 = a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a> ? <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3], <span class="stringliteral">&quot;&quot;</span>) : <span class="stringliteral">&quot;&quot;</span>;
<a name="l00370"></a>00370    <span class="keywordtype">int</span> *dst;
<a name="l00371"></a>00371    <span class="keywordtype">char</span> *what;
<a name="l00372"></a>00372    <span class="keyword">struct </span><a class="code" href="structdebug__file__list.html">debug_file_list</a> *dfl;
<a name="l00373"></a>00373    <span class="keyword">struct </span><a class="code" href="structast__debug__file.html" title="map a debug or verbose value to a filename">ast_debug_file</a> *adf;
<a name="l00374"></a>00374    <span class="keywordtype">char</span> *fn;
<a name="l00375"></a>00375 
<a name="l00376"></a>00376    <span class="keywordflow">switch</span> (cmd) {
<a name="l00377"></a>00377    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l00378"></a>00378       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;core set {debug|verbose}&quot;</span>;
<a name="l00379"></a>00379       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l00380"></a>00380 <span class="preprocessor">#if !defined(LOW_MEMORY)</span>
<a name="l00381"></a>00381 <span class="preprocessor"></span>         <span class="stringliteral">&quot;Usage: core set {debug|verbose} [atleast] &lt;level&gt; [filename]\n&quot;</span>
<a name="l00382"></a>00382 <span class="preprocessor">#else</span>
<a name="l00383"></a>00383 <span class="preprocessor"></span>         <span class="stringliteral">&quot;Usage: core set {debug|verbose} [atleast] &lt;level&gt;\n&quot;</span>
<a name="l00384"></a>00384 <span class="preprocessor">#endif</span>
<a name="l00385"></a>00385 <span class="preprocessor"></span>         <span class="stringliteral">&quot;       core set {debug|verbose} off\n&quot;</span>
<a name="l00386"></a>00386 <span class="preprocessor">#if !defined(LOW_MEMORY)</span>
<a name="l00387"></a>00387 <span class="preprocessor"></span>         <span class="stringliteral">&quot;       Sets level of debug or verbose messages to be displayed or \n&quot;</span>
<a name="l00388"></a>00388          <span class="stringliteral">&quot;       sets a filename to display debug messages from.\n&quot;</span>
<a name="l00389"></a>00389 <span class="preprocessor">#else</span>
<a name="l00390"></a>00390 <span class="preprocessor"></span>         <span class="stringliteral">&quot;       Sets level of debug or verbose messages to be displayed.\n&quot;</span>
<a name="l00391"></a>00391 <span class="preprocessor">#endif</span>
<a name="l00392"></a>00392 <span class="preprocessor"></span>         <span class="stringliteral">&quot;  0 or off means no messages should be displayed.\n&quot;</span>
<a name="l00393"></a>00393          <span class="stringliteral">&quot;  Equivalent to -d[d[...]] or -v[v[v...]] on startup\n&quot;</span>;
<a name="l00394"></a>00394       <span class="keywordflow">return</span> NULL;
<a name="l00395"></a>00395 
<a name="l00396"></a>00396    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l00397"></a>00397       <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#a1910d262855b71da353ed0d07a6c7823">pos</a> == 3 || (a-&gt;<a class="code" href="structast__cli__args.html#a1910d262855b71da353ed0d07a6c7823">pos</a> == 4 &amp;&amp; !strcasecmp(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3], <span class="stringliteral">&quot;atleast&quot;</span>))) {
<a name="l00398"></a>00398          <span class="keywordtype">char</span> *pos = a-&gt;<a class="code" href="structast__cli__args.html#a1910d262855b71da353ed0d07a6c7823">pos</a> == 3 ? argv3 : <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[4], <span class="stringliteral">&quot;&quot;</span>);
<a name="l00399"></a>00399          <span class="keywordtype">int</span> numbermatch = (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(pos) || strchr(<span class="stringliteral">&quot;123456789&quot;</span>, pos[0])) ? 0 : 21;
<a name="l00400"></a>00400          <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> &lt; 21 &amp;&amp; numbermatch == 0) {
<a name="l00401"></a>00401             <span class="keywordflow">return</span> <a class="code" href="cli_8c.html#a7b9a2847dbc64bf8d127b45890e21a89">complete_number</a>(pos, 0, 0x7fffffff, a-&gt;<a class="code" href="structast__cli__args.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>);
<a name="l00402"></a>00402          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pos[0] == <span class="charliteral">&apos;0&apos;</span>) {
<a name="l00403"></a>00403             <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> == 0) {
<a name="l00404"></a>00404                <span class="keywordflow">return</span> <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(<span class="stringliteral">&quot;0&quot;</span>);
<a name="l00405"></a>00405             } <span class="keywordflow">else</span> {
<a name="l00406"></a>00406                <span class="keywordflow">return</span> NULL;
<a name="l00407"></a>00407             }
<a name="l00408"></a>00408          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> == (21 - numbermatch)) {
<a name="l00409"></a>00409             <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#a1910d262855b71da353ed0d07a6c7823">pos</a> == 3 &amp;&amp; !strncasecmp(argv3, <span class="stringliteral">&quot;off&quot;</span>, strlen(argv3))) {
<a name="l00410"></a>00410                <span class="keywordflow">return</span> <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(<span class="stringliteral">&quot;off&quot;</span>);
<a name="l00411"></a>00411             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#a1910d262855b71da353ed0d07a6c7823">pos</a> == 3 &amp;&amp; !strncasecmp(argv3, <span class="stringliteral">&quot;atleast&quot;</span>, strlen(argv3))) {
<a name="l00412"></a>00412                <span class="keywordflow">return</span> <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(<span class="stringliteral">&quot;atleast&quot;</span>);
<a name="l00413"></a>00413             }
<a name="l00414"></a>00414          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> == (22 - numbermatch) &amp;&amp; a-&gt;<a class="code" href="structast__cli__args.html#a1910d262855b71da353ed0d07a6c7823">pos</a> == 3 &amp;&amp; <a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(argv3)) {
<a name="l00415"></a>00415             <span class="keywordflow">return</span> <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(<span class="stringliteral">&quot;atleast&quot;</span>);
<a name="l00416"></a>00416          }
<a name="l00417"></a>00417 <span class="preprocessor">#if !defined(LOW_MEMORY)</span>
<a name="l00418"></a>00418 <span class="preprocessor"></span>      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#a1910d262855b71da353ed0d07a6c7823">pos</a> == 4 || (a-&gt;<a class="code" href="structast__cli__args.html#a1910d262855b71da353ed0d07a6c7823">pos</a> == 5 &amp;&amp; !strcasecmp(argv3, <span class="stringliteral">&quot;atleast&quot;</span>))) {
<a name="l00419"></a>00419          <span class="keywordflow">return</span> <a class="code" href="asterisk_8h.html#a826e3c1be1ea772fbdc32c1f312ec830">ast_complete_source_filename</a>(a-&gt;<a class="code" href="structast__cli__args.html#a1910d262855b71da353ed0d07a6c7823">pos</a> == 4 ? <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[4], <span class="stringliteral">&quot;&quot;</span>) : <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[5], <span class="stringliteral">&quot;&quot;</span>), a-&gt;<a class="code" href="structast__cli__args.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>);
<a name="l00420"></a>00420 <span class="preprocessor">#endif</span>
<a name="l00421"></a>00421 <span class="preprocessor"></span>      }
<a name="l00422"></a>00422       <span class="keywordflow">return</span> NULL;
<a name="l00423"></a>00423    }
<a name="l00424"></a>00424    <span class="comment">/* all the above return, so we proceed with the handler.</span>
<a name="l00425"></a>00425 <span class="comment">    * we are guaranteed to be called with argc &gt;= e-&gt;args;</span>
<a name="l00426"></a>00426 <span class="comment">    */</span>
<a name="l00427"></a>00427 
<a name="l00428"></a>00428    <span class="keywordflow">if</span> (argc &lt;= e-&gt;args)
<a name="l00429"></a>00429       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l00430"></a>00430    <span class="keywordflow">if</span> (!strcasecmp(argv[e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a> - 1], <span class="stringliteral">&quot;debug&quot;</span>)) {
<a name="l00431"></a>00431       dst = &amp;<a class="code" href="group__main__options.html#ga40f8fb2e731031d99f732f515cec680f">option_debug</a>;
<a name="l00432"></a>00432       oldval = <a class="code" href="group__main__options.html#ga40f8fb2e731031d99f732f515cec680f">option_debug</a>;
<a name="l00433"></a>00433       what = <span class="stringliteral">&quot;Core debug&quot;</span>;
<a name="l00434"></a>00434    } <span class="keywordflow">else</span> {
<a name="l00435"></a>00435       dst = &amp;<a class="code" href="group__main__options.html#gaa294d0efa6a89c1a3d162787cac4fff5">option_verbose</a>;
<a name="l00436"></a>00436       oldval = <a class="code" href="group__main__options.html#gaa294d0efa6a89c1a3d162787cac4fff5">option_verbose</a>;
<a name="l00437"></a>00437       what = <span class="stringliteral">&quot;Verbosity&quot;</span>;
<a name="l00438"></a>00438    }
<a name="l00439"></a>00439    <span class="keywordflow">if</span> (argc == e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a> + 1 &amp;&amp; !strcasecmp(argv[e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a>], <span class="stringliteral">&quot;off&quot;</span>)) {
<a name="l00440"></a>00440       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="app__rpt_8c.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a> = (*what == <span class="charliteral">&apos;C&apos;</span>);
<a name="l00441"></a>00441       newlevel = 0;
<a name="l00442"></a>00442 
<a name="l00443"></a>00443       dfl = debug ? &amp;<a class="code" href="cli_8c.html#adf077cec50df93f97b46d8b6261c6f04">debug_files</a> : &amp;<a class="code" href="cli_8c.html#afeb8a3babc8d262f1ae1dabacc656b84">verbose_files</a>;
<a name="l00444"></a>00444 
<a name="l00445"></a>00445       <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(dfl);
<a name="l00446"></a>00446       <span class="keywordflow">while</span> ((adf = <a class="code" href="linkedlists_8h.html#a3d3aa4fb3b4ba38ad8d6d255d97e037c">AST_RWLIST_REMOVE_HEAD</a>(dfl, <a class="code" href="structast__debug__file.html#a3c3ab70d447808f20e62f4e26b521642">entry</a>)))
<a name="l00447"></a>00447          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(adf);
<a name="l00448"></a>00448       <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(&amp;<a class="code" href="group__main__options.html#gaa5dba371db31dc4ebecdff7c929ff263">ast_options</a>, debug ? <a class="code" href="group__main__options.html#ggaf2588453b3a373a770741ad3ce353343a47453b67236995c94d001837d3ffe441">AST_OPT_FLAG_DEBUG_FILE</a> : <a class="code" href="group__main__options.html#ggaf2588453b3a373a770741ad3ce353343a0672151e97a7e960c9563fdf75242b2b">AST_OPT_FLAG_VERBOSE_FILE</a>);
<a name="l00449"></a>00449       <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(dfl);
<a name="l00450"></a>00450 
<a name="l00451"></a>00451       <span class="keywordflow">goto</span> done;
<a name="l00452"></a>00452    }
<a name="l00453"></a>00453    <span class="keywordflow">if</span> (!strcasecmp(argv[e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a>], <span class="stringliteral">&quot;atleast&quot;</span>))
<a name="l00454"></a>00454       atleast = 1;
<a name="l00455"></a>00455    <span class="keywordflow">if</span> (argc != e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a> + atleast + 1 &amp;&amp; argc != e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a> + atleast + 2)
<a name="l00456"></a>00456       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l00457"></a>00457    <span class="keywordflow">if</span> (sscanf(argv[e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a> + atleast], <span class="stringliteral">&quot;%30d&quot;</span>, &amp;newlevel) != 1)
<a name="l00458"></a>00458       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l00459"></a>00459    <span class="keywordflow">if</span> (argc == e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a> + atleast + 2) {
<a name="l00460"></a>00460       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> debug = (*what == <span class="charliteral">&apos;C&apos;</span>);
<a name="l00461"></a>00461       dfl = debug ? &amp;<a class="code" href="cli_8c.html#adf077cec50df93f97b46d8b6261c6f04">debug_files</a> : &amp;<a class="code" href="cli_8c.html#afeb8a3babc8d262f1ae1dabacc656b84">verbose_files</a>;
<a name="l00462"></a>00462 
<a name="l00463"></a>00463       fn = argv[e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a> + atleast + 1];
<a name="l00464"></a>00464 
<a name="l00465"></a>00465       <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(dfl);
<a name="l00466"></a>00466 
<a name="l00467"></a>00467       <span class="keywordflow">if</span> ((adf = <a class="code" href="cli_8c.html#a765e2a1e8b6f1bb3ab5f6136d3a73564" title="Find the debug or verbose file setting.">find_debug_file</a>(fn, debug)) &amp;&amp; !newlevel) {
<a name="l00468"></a>00468          <a class="code" href="linkedlists_8h.html#a6091f0518f8b6f443fd9f5150f3ac407">AST_RWLIST_REMOVE</a>(dfl, adf, <a class="code" href="structast__debug__file.html#a3c3ab70d447808f20e62f4e26b521642">entry</a>);
<a name="l00469"></a>00469          <span class="keywordflow">if</span> (<a class="code" href="linkedlists_8h.html#a0044f6572f50a89049b3b5272e51b0e7">AST_RWLIST_EMPTY</a>(dfl))
<a name="l00470"></a>00470             <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(&amp;<a class="code" href="group__main__options.html#gaa5dba371db31dc4ebecdff7c929ff263">ast_options</a>, debug ? <a class="code" href="group__main__options.html#ggaf2588453b3a373a770741ad3ce353343a47453b67236995c94d001837d3ffe441">AST_OPT_FLAG_DEBUG_FILE</a> : <a class="code" href="group__main__options.html#ggaf2588453b3a373a770741ad3ce353343a0672151e97a7e960c9563fdf75242b2b">AST_OPT_FLAG_VERBOSE_FILE</a>);
<a name="l00471"></a>00471          <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(dfl);
<a name="l00472"></a>00472          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%s was %d and has been set to 0 for &apos;%s&apos;\n&quot;</span>, what, adf-&gt;<a class="code" href="structast__debug__file.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>, fn);
<a name="l00473"></a>00473          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(adf);
<a name="l00474"></a>00474          <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l00475"></a>00475       }
<a name="l00476"></a>00476 
<a name="l00477"></a>00477       <span class="keywordflow">if</span> (adf) {
<a name="l00478"></a>00478          <span class="keywordflow">if</span> ((atleast &amp;&amp; newlevel &lt; adf-&gt;<a class="code" href="structast__debug__file.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>) || adf-&gt;<a class="code" href="structast__debug__file.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> == newlevel) {
<a name="l00479"></a>00479             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%s is %d for &apos;%s&apos;\n&quot;</span>, what, adf-&gt;<a class="code" href="structast__debug__file.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>, fn);
<a name="l00480"></a>00480             <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(dfl);
<a name="l00481"></a>00481             <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l00482"></a>00482          }
<a name="l00483"></a>00483       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!(adf = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*adf) + strlen(fn) + 1))) {
<a name="l00484"></a>00484          <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(dfl);
<a name="l00485"></a>00485          <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;
<a name="l00486"></a>00486       }
<a name="l00487"></a>00487 
<a name="l00488"></a>00488       oldval = adf-&gt;<a class="code" href="structast__debug__file.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>;
<a name="l00489"></a>00489       adf-&gt;<a class="code" href="structast__debug__file.html#a9082f945c1d289684d0bcd51ee08e11e">level</a> = newlevel;
<a name="l00490"></a>00490       strcpy(adf-&gt;<a class="code" href="structast__debug__file.html#afae8c108f5d360038fa8b099eb4ab2f3">filename</a>, fn);
<a name="l00491"></a>00491 
<a name="l00492"></a>00492       <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(&amp;<a class="code" href="group__main__options.html#gaa5dba371db31dc4ebecdff7c929ff263">ast_options</a>, debug ? <a class="code" href="group__main__options.html#ggaf2588453b3a373a770741ad3ce353343a47453b67236995c94d001837d3ffe441">AST_OPT_FLAG_DEBUG_FILE</a> : <a class="code" href="group__main__options.html#ggaf2588453b3a373a770741ad3ce353343a0672151e97a7e960c9563fdf75242b2b">AST_OPT_FLAG_VERBOSE_FILE</a>);
<a name="l00493"></a>00493 
<a name="l00494"></a>00494       <a class="code" href="linkedlists_8h.html#aadda916488b2d151af4426e2f06ad332">AST_RWLIST_INSERT_TAIL</a>(dfl, adf, <a class="code" href="structast__debug__file.html#a3c3ab70d447808f20e62f4e26b521642">entry</a>);
<a name="l00495"></a>00495       <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(dfl);
<a name="l00496"></a>00496 
<a name="l00497"></a>00497       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%s was %d and has been set to %d for &apos;%s&apos;\n&quot;</span>, what, oldval, adf-&gt;<a class="code" href="structast__debug__file.html#a9082f945c1d289684d0bcd51ee08e11e">level</a>, adf-&gt;<a class="code" href="structast__debug__file.html#afae8c108f5d360038fa8b099eb4ab2f3">filename</a>);
<a name="l00498"></a>00498 
<a name="l00499"></a>00499       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l00500"></a>00500    }
<a name="l00501"></a>00501 
<a name="l00502"></a>00502 done:
<a name="l00503"></a>00503    <span class="keywordflow">if</span> (!atleast || newlevel &gt; *dst)
<a name="l00504"></a>00504       *dst = newlevel;
<a name="l00505"></a>00505    <span class="keywordflow">if</span> (oldval &gt; 0 &amp;&amp; *dst == 0)
<a name="l00506"></a>00506       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%s is now OFF\n&quot;</span>, what);
<a name="l00507"></a>00507    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*dst &gt; 0) {
<a name="l00508"></a>00508       <span class="keywordflow">if</span> (oldval == *dst)
<a name="l00509"></a>00509          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%s is at least %d\n&quot;</span>, what, *dst);
<a name="l00510"></a>00510       <span class="keywordflow">else</span>
<a name="l00511"></a>00511          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%s was %d and is now %d\n&quot;</span>, what, oldval, *dst);
<a name="l00512"></a>00512    }
<a name="l00513"></a>00513 
<a name="l00514"></a>00514    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l00515"></a>00515 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3b12e002bbf802ab6de30c1609838abd"></a><!-- doxytag: member="cli.c::help1" ref="a3b12e002bbf802ab6de30c1609838abd" args="(int fd, char *match[], int locked)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* help1 </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>match</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>locked</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>helper for final part of handle_help if locked = 1, assume the list is already locked </p>

<p>Definition at line <a class="el" href="cli_8c_source.html#l01951">1951</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00163">ast_cli_entry::_full_cmd</a>, <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="utils_8c_source.html#l01451">ast_join()</a>, <a class="el" href="linkedlists_8h_source.html#l00077">AST_RWLIST_RDLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="cli_8c_source.html#l00656">cli_next()</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="func__strings_8c_source.html#l00821">len()</a>, <a class="el" href="strings_8h_source.html#l00072">S_OR</a>, and <a class="el" href="cli_8h_source.html#l00158">ast_cli_entry::summary</a>.</p>

<p>Referenced by <a class="el" href="cli_8c_source.html#l01980">handle_help()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01952"></a>01952 {
<a name="l01953"></a>01953    <span class="keywordtype">char</span> matchstr[80] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01954"></a>01954    <span class="keyword">struct </span><a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a> *e = NULL;
<a name="l01955"></a>01955    <span class="keywordtype">int</span> <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> = 0;
<a name="l01956"></a>01956    <span class="keywordtype">int</span> found = 0;
<a name="l01957"></a>01957 
<a name="l01958"></a>01958    <span class="keywordflow">if</span> (<a class="code" href="chan__iax2_8c.html#aa27930d6214f6421994d6bef51efb7aa">match</a>) {
<a name="l01959"></a>01959       <a class="code" href="strings_8h.html#a0c9c27a9e6b4a6d1e2b868525ae3d0c1">ast_join</a>(matchstr, <span class="keyword">sizeof</span>(matchstr), <a class="code" href="chan__iax2_8c.html#aa27930d6214f6421994d6bef51efb7aa">match</a>);
<a name="l01960"></a>01960       len = strlen(matchstr);
<a name="l01961"></a>01961    }
<a name="l01962"></a>01962    <span class="keywordflow">if</span> (!locked)
<a name="l01963"></a>01963       <a class="code" href="linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc" title="Read locks a list.">AST_RWLIST_RDLOCK</a>(&amp;<a class="code" href="structhelpers.html">helpers</a>);
<a name="l01964"></a>01964    <span class="keywordflow">while</span> ( (e = <a class="code" href="cli_8c.html#adac48ec5ae21bd48d7f3dac6c44b2868">cli_next</a>(e)) ) {
<a name="l01965"></a>01965       <span class="comment">/* Hide commands that start with &apos;_&apos; */</span>
<a name="l01966"></a>01966       <span class="keywordflow">if</span> (e-&gt;<a class="code" href="structast__cli__entry.html#ac15e0df3344959107453d9ba01503746">_full_cmd</a>[0] == <span class="charliteral">&apos;_&apos;</span>)
<a name="l01967"></a>01967          <span class="keywordflow">continue</span>;
<a name="l01968"></a>01968       <span class="keywordflow">if</span> (<a class="code" href="chan__iax2_8c.html#aa27930d6214f6421994d6bef51efb7aa">match</a> &amp;&amp; strncasecmp(matchstr, e-&gt;<a class="code" href="structast__cli__entry.html#ac15e0df3344959107453d9ba01503746">_full_cmd</a>, len))
<a name="l01969"></a>01969          <span class="keywordflow">continue</span>;
<a name="l01970"></a>01970       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%30.30s %s\n&quot;</span>, e-&gt;<a class="code" href="structast__cli__entry.html#ac15e0df3344959107453d9ba01503746">_full_cmd</a>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(e-&gt;<a class="code" href="structast__cli__entry.html#a01f3e852fed0577d6c8f059530d55d50">summary</a>, <span class="stringliteral">&quot;&lt;no description available&gt;&quot;</span>));
<a name="l01971"></a>01971       found++;
<a name="l01972"></a>01972    }
<a name="l01973"></a>01973    <span class="keywordflow">if</span> (!locked)
<a name="l01974"></a>01974       <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structhelpers.html">helpers</a>);
<a name="l01975"></a>01975    <span class="keywordflow">if</span> (!found &amp;&amp; matchstr[0])
<a name="l01976"></a>01976       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;No such command &apos;%s&apos;.\n&quot;</span>, matchstr);
<a name="l01977"></a>01977    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l01978"></a>01978 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5e4bb02679737eab93085669c640b778"></a><!-- doxytag: member="cli.c::is_prefix" ref="a5e4bb02679737eab93085669c640b778" args="(const char *word, const char *token, int pos, int *actual)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* is_prefix </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>word</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>token</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>actual</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>if word is a valid prefix for token, returns the pos-th match as a malloced string, or NULL otherwise. Always tell in *actual how many matches we got. </p>

<p>Definition at line <a class="el" href="cli_8c_source.html#l01722">1722</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="aesopt_8h_source.html#l00399">s</a>, and <a class="el" href="agi_2strcompat_8c_source.html#l00027">strsep()</a>.</p>

<p>Referenced by <a class="el" href="cli_8c_source.html#l02170">__ast_cli_generator()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01724"></a>01724 {
<a name="l01725"></a>01725    <span class="keywordtype">int</span> lw;
<a name="l01726"></a>01726    <span class="keywordtype">char</span> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>, *t1;
<a name="l01727"></a>01727 
<a name="l01728"></a>01728    *actual = 0;
<a name="l01729"></a>01729    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(token))
<a name="l01730"></a>01730       <span class="keywordflow">return</span> NULL;
<a name="l01731"></a>01731    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="ael_8tab_8c.html#a836535f59bf515522a395858a8029d42">word</a>))
<a name="l01732"></a>01732       <a class="code" href="ael_8tab_8c.html#a836535f59bf515522a395858a8029d42">word</a> = <span class="stringliteral">&quot;&quot;</span>;  <span class="comment">/* dummy */</span>
<a name="l01733"></a>01733    lw = strlen(<a class="code" href="ael_8tab_8c.html#a836535f59bf515522a395858a8029d42">word</a>);
<a name="l01734"></a>01734    <span class="keywordflow">if</span> (strcspn(<a class="code" href="ael_8tab_8c.html#a836535f59bf515522a395858a8029d42">word</a>, <a class="code" href="cli_8c.html#a895466d470ce2fa13f141e05c81225f6">cli_rsvd</a>) != lw)
<a name="l01735"></a>01735       <span class="keywordflow">return</span> NULL;   <span class="comment">/* no match if word has reserved chars */</span>
<a name="l01736"></a>01736    <span class="keywordflow">if</span> (strchr(<a class="code" href="cli_8c.html#a895466d470ce2fa13f141e05c81225f6">cli_rsvd</a>, token[0]) == NULL) { <span class="comment">/* regular match */</span>
<a name="l01737"></a>01737       <span class="keywordflow">if</span> (strncasecmp(token, <a class="code" href="ael_8tab_8c.html#a836535f59bf515522a395858a8029d42">word</a>, lw))   <span class="comment">/* no match */</span>
<a name="l01738"></a>01738          <span class="keywordflow">return</span> NULL;
<a name="l01739"></a>01739       *actual = 1;
<a name="l01740"></a>01740       <span class="keywordflow">return</span> (pos != 0) ? NULL : <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(token);
<a name="l01741"></a>01741    }
<a name="l01742"></a>01742    <span class="comment">/* now handle regexp match */</span>
<a name="l01743"></a>01743 
<a name="l01744"></a>01744    <span class="comment">/* Wildcard always matches, so we never do is_prefix on them */</span>
<a name="l01745"></a>01745 
<a name="l01746"></a>01746    t1 = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(token + 1);  <span class="comment">/* copy, skipping first char */</span>
<a name="l01747"></a>01747    <span class="keywordflow">while</span> (pos &gt;= 0 &amp;&amp; (s = <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;t1, <a class="code" href="cli_8c.html#a895466d470ce2fa13f141e05c81225f6">cli_rsvd</a>)) &amp;&amp; *s) {
<a name="l01748"></a>01748       <span class="keywordflow">if</span> (*s == <span class="charliteral">&apos;%&apos;</span>) <span class="comment">/* wildcard */</span>
<a name="l01749"></a>01749          <span class="keywordflow">continue</span>;
<a name="l01750"></a>01750       <span class="keywordflow">if</span> (strncasecmp(s, <a class="code" href="ael_8tab_8c.html#a836535f59bf515522a395858a8029d42">word</a>, lw)) <span class="comment">/* no match */</span>
<a name="l01751"></a>01751          <span class="keywordflow">continue</span>;
<a name="l01752"></a>01752       (*actual)++;
<a name="l01753"></a>01753       <span class="keywordflow">if</span> (pos-- == 0)
<a name="l01754"></a>01754          <span class="keywordflow">return</span> <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(s);
<a name="l01755"></a>01755    }
<a name="l01756"></a>01756    <span class="keywordflow">return</span> NULL;
<a name="l01757"></a>01757 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af1e37c3b4eb5f2c938dff2311d621296"></a><!-- doxytag: member="cli.c::modlist_modentry" ref="af1e37c3b4eb5f2c938dff2311d621296" args="(const char *module, const char *description, int usecnt, const char *like)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int modlist_modentry </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>module</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>description</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>usecnt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>like</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cli_8c_source.html#l00595">595</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="cli_8c_source.html#l00589">MODLIST_FORMAT</a>, and <a class="el" href="agi_2strcompat_8c_source.html#l00093">strcasestr()</a>.</p>

<p>Referenced by <a class="el" href="cli_8c_source.html#l00696">handle_modlist()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00596"></a>00596 {
<a name="l00597"></a>00597    <span class="comment">/* Comparing the like with the module */</span>
<a name="l00598"></a>00598    <span class="keywordflow">if</span> (<a class="code" href="agi_2strcompat_8c.html#ae9229017a4501f8d6a637b4498cfed2e">strcasestr</a>(<a class="code" href="structast__cli__entry.html#a0ceb9b960a71a1253fa9a879a5ffee0a">module</a>, like) ) {
<a name="l00599"></a>00599       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(<a class="code" href="cli_8c.html#aa5a37575f5e5a07b25c6ee3107d46008">climodentryfd</a>, <a class="code" href="cli_8c.html#a97d3f8deb4e3d6888056cf1149bcc61a">MODLIST_FORMAT</a>, <a class="code" href="structast__cli__entry.html#a0ceb9b960a71a1253fa9a879a5ffee0a">module</a>, <a class="code" href="callerid_8c.html#a68344fa88cf4e86b5079fd69a5c22d57">description</a>, <a class="code" href="chan__unistim_8c.html#a2f8d20b887dab5677a21b650895a0dec">usecnt</a>);
<a name="l00600"></a>00600       <span class="keywordflow">return</span> 1;
<a name="l00601"></a>00601    } 
<a name="l00602"></a>00602    <span class="keywordflow">return</span> 0;
<a name="l00603"></a>00603 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa19d0e275db21c1821c50b403517d1b1"></a><!-- doxytag: member="cli.c::more_words" ref="aa19d0e275db21c1821c50b403517d1b1" args="(char *const *dst)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int more_words </td>
          <td>(</td>
          <td class="paramtype">char *const *&nbsp;</td>
          <td class="paramname"> <em>dst</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>returns true if there are more words to match </p>

<p>Definition at line <a class="el" href="cli_8c_source.html#l02157">2157</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>Referenced by <a class="el" href="cli_8c_source.html#l02170">__ast_cli_generator()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02158"></a>02158 {
<a name="l02159"></a>02159    <span class="keywordtype">int</span> i;
<a name="l02160"></a>02160    <span class="keywordflow">for</span> (i = 0; dst[i]; i++) {
<a name="l02161"></a>02161       <span class="keywordflow">if</span> (dst[i][0] != <span class="charliteral">&apos;[&apos;</span>)
<a name="l02162"></a>02162          <span class="keywordflow">return</span> -1;
<a name="l02163"></a>02163    }
<a name="l02164"></a>02164    <span class="keywordflow">return</span> 0;
<a name="l02165"></a>02165 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad1176051c0fb523f0e068ff4737f54ce"></a><!-- doxytag: member="cli.c::parse_args" ref="ad1176051c0fb523f0e068ff4737f54ce" args="(const char *s, int *argc, char *argv[], int max, int *trailingwhitespace)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* parse_args </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>argv</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>max</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>trailingwhitespace</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cli_8c_source.html#l02026">2026</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="chan__unistim_8c_source.html#l00183">dummy()</a>, and <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>.</p>

<p>Referenced by <a class="el" href="cli_8c_source.html#l02170">__ast_cli_generator()</a>, and <a class="el" href="cli_8c_source.html#l02258">ast_cli_command_full()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02027"></a>02027 {
<a name="l02028"></a>02028    <span class="keywordtype">char</span> *duplicate, *cur;
<a name="l02029"></a>02029    <span class="keywordtype">int</span> x = 0;
<a name="l02030"></a>02030    <span class="keywordtype">int</span> quoted = 0;
<a name="l02031"></a>02031    <span class="keywordtype">int</span> escaped = 0;
<a name="l02032"></a>02032    <span class="keywordtype">int</span> whitespace = 1;
<a name="l02033"></a>02033    <span class="keywordtype">int</span> <a class="code" href="chan__unistim_8c.html#abc0ce15d00b4bfb69266c5fd016dc88c">dummy</a> = 0;
<a name="l02034"></a>02034 
<a name="l02035"></a>02035    <span class="keywordflow">if</span> (trailingwhitespace == NULL)
<a name="l02036"></a>02036       trailingwhitespace = &amp;dummy;
<a name="l02037"></a>02037    *trailingwhitespace = 0;
<a name="l02038"></a>02038    <span class="keywordflow">if</span> (<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a> == NULL) <span class="comment">/* invalid, though! */</span>
<a name="l02039"></a>02039       <span class="keywordflow">return</span> NULL;
<a name="l02040"></a>02040    <span class="comment">/* make a copy to store the parsed string */</span>
<a name="l02041"></a>02041    <span class="keywordflow">if</span> (!(duplicate = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>)))
<a name="l02042"></a>02042       <span class="keywordflow">return</span> NULL;
<a name="l02043"></a>02043 
<a name="l02044"></a>02044    cur = duplicate;
<a name="l02045"></a>02045    <span class="comment">/* scan the original string copying into cur when needed */</span>
<a name="l02046"></a>02046    <span class="keywordflow">for</span> (; *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a> ; <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>++) {
<a name="l02047"></a>02047       <span class="keywordflow">if</span> (x &gt;= max - 1) {
<a name="l02048"></a>02048          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Too many arguments, truncating at %s\n&quot;</span>, <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>);
<a name="l02049"></a>02049          <span class="keywordflow">break</span>;
<a name="l02050"></a>02050       }
<a name="l02051"></a>02051       <span class="keywordflow">if</span> (*<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a> == <span class="charliteral">&apos;&quot;&apos;</span> &amp;&amp; !escaped) {
<a name="l02052"></a>02052          quoted = !quoted;
<a name="l02053"></a>02053          <span class="keywordflow">if</span> (quoted &amp;&amp; whitespace) {
<a name="l02054"></a>02054             <span class="comment">/* start a quoted string from previous whitespace: new argument */</span>
<a name="l02055"></a>02055             argv[x++] = cur;
<a name="l02056"></a>02056             whitespace = 0;
<a name="l02057"></a>02057          }
<a name="l02058"></a>02058       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((*<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a> == <span class="charliteral">&apos; &apos;</span> || *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a> == <span class="charliteral">&apos;\t&apos;</span>) &amp;&amp; !(quoted || escaped)) {
<a name="l02059"></a>02059          <span class="comment">/* If we are not already in whitespace, and not in a quoted string or</span>
<a name="l02060"></a>02060 <span class="comment">            processing an escape sequence, and just entered whitespace, then</span>
<a name="l02061"></a>02061 <span class="comment">            finalize the previous argument and remember that we are in whitespace</span>
<a name="l02062"></a>02062 <span class="comment">         */</span>
<a name="l02063"></a>02063          <span class="keywordflow">if</span> (!whitespace) {
<a name="l02064"></a>02064             *cur++ = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l02065"></a>02065             whitespace = 1;
<a name="l02066"></a>02066          }
<a name="l02067"></a>02067       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a> == <span class="charliteral">&apos;\\&apos;</span> &amp;&amp; !escaped) {
<a name="l02068"></a>02068          escaped = 1;
<a name="l02069"></a>02069       } <span class="keywordflow">else</span> {
<a name="l02070"></a>02070          <span class="keywordflow">if</span> (whitespace) {
<a name="l02071"></a>02071             <span class="comment">/* we leave whitespace, and are not quoted. So it&apos;s a new argument */</span>
<a name="l02072"></a>02072             argv[x++] = cur;
<a name="l02073"></a>02073             whitespace = 0;
<a name="l02074"></a>02074          }
<a name="l02075"></a>02075          *cur++ = *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>;
<a name="l02076"></a>02076          escaped = 0;
<a name="l02077"></a>02077       }
<a name="l02078"></a>02078    }
<a name="l02079"></a>02079    <span class="comment">/* Null terminate */</span>
<a name="l02080"></a>02080    *cur++ = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l02081"></a>02081    <span class="comment">/* XXX put a NULL in the last argument, because some functions that take</span>
<a name="l02082"></a>02082 <span class="comment">    * the array may want a null-terminated array.</span>
<a name="l02083"></a>02083 <span class="comment">    * argc still reflects the number of non-NULL entries.</span>
<a name="l02084"></a>02084 <span class="comment">    */</span>
<a name="l02085"></a>02085    argv[x] = NULL;
<a name="l02086"></a>02086    *argc = x;
<a name="l02087"></a>02087    *trailingwhitespace = whitespace;
<a name="l02088"></a>02088    <span class="keywordflow">return</span> duplicate;
<a name="l02089"></a>02089 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a39eebea4b2788ae0175ffa54c61fe276"></a><!-- doxytag: member="cli.c::print_uptimestr" ref="a39eebea4b2788ae0175ffa54c61fe276" args="(int fd, struct timeval timeval, const char *prefix, int printsec)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void print_uptimestr </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct timeval&nbsp;</td>
          <td class="paramname"> <em>timeval</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>prefix</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>printsec</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cli_8c_source.html#l00605">605</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="strings_8h_source.html#l00576">ast_str_alloca</a>, <a class="el" href="strings_8h_source.html#l00846">ast_str_append()</a>, <a class="el" href="strings_8h_source.html#l00488">ast_str_buffer()</a>, <a class="el" href="strings_8h_source.html#l00466">ast_str_strlen()</a>, <a class="el" href="cli_8c.html#a509a01c55cbe47386fe24602b7c7fda1">DAY</a>, <a class="el" href="cli_8h_source.html#l00058">ESS</a>, <a class="el" href="cli_8c.html#a4698ae12cf6a8acb5886fffd0ec897e6">HOUR</a>, <a class="el" href="cli_8c.html#ac1454fa04f41c693f39425697a137d82">MINUTE</a>, <a class="el" href="cli_8c.html#a5f8f259f27c085a147c1f3d12dea87a5">NEEDCOMMA</a>, <a class="el" href="cli_8c.html#a4a0cf4182a1661d0eb7a55494a2dd6e5">WEEK</a>, and <a class="el" href="cli_8c.html#a5871356500f559add06ea81d60331b1b">YEAR</a>.</p>

<p>Referenced by <a class="el" href="cli_8c_source.html#l00735">handle_showcalls()</a>, and <a class="el" href="cli_8c_source.html#l00665">handle_showuptime()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00606"></a>00606 {
<a name="l00607"></a>00607    <span class="keywordtype">int</span> x; <span class="comment">/* the main part - years, weeks, etc. */</span>
<a name="l00608"></a>00608    <span class="keyword">struct </span><a class="code" href="structast__str.html" title="The descriptor of a dynamic string XXX storage will be optimized later if needed...">ast_str</a> *out;
<a name="l00609"></a>00609 
<a name="l00610"></a>00610 <span class="preprocessor">#define SECOND (1)</span>
<a name="l00611"></a>00611 <span class="preprocessor"></span><span class="preprocessor">#define MINUTE (SECOND*60)</span>
<a name="l00612"></a>00612 <span class="preprocessor"></span><span class="preprocessor">#define HOUR (MINUTE*60)</span>
<a name="l00613"></a>00613 <span class="preprocessor"></span><span class="preprocessor">#define DAY (HOUR*24)</span>
<a name="l00614"></a>00614 <span class="preprocessor"></span><span class="preprocessor">#define WEEK (DAY*7)</span>
<a name="l00615"></a>00615 <span class="preprocessor"></span><span class="preprocessor">#define YEAR (DAY*365)</span>
<a name="l00616"></a>00616 <span class="preprocessor"></span><span class="preprocessor">#define NEEDCOMMA(x) ((x)? &quot;,&quot;: &quot;&quot;) </span><span class="comment">/* define if we need a comma */</span>
<a name="l00617"></a>00617    <span class="keywordflow">if</span> (timeval.tv_sec &lt; 0) <span class="comment">/* invalid, nothing to show */</span>
<a name="l00618"></a>00618       <span class="keywordflow">return</span>;
<a name="l00619"></a>00619 
<a name="l00620"></a>00620    <span class="keywordflow">if</span> (printsec)  {  <span class="comment">/* plain seconds output */</span>
<a name="l00621"></a>00621       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%s: %lu\n&quot;</span>, <a class="code" href="http_8c.html#a6f25bc812d09fedb86bf394c01061c56">prefix</a>, (u_long)timeval.tv_sec);
<a name="l00622"></a>00622       <span class="keywordflow">return</span>;
<a name="l00623"></a>00623    }
<a name="l00624"></a>00624    out = <a class="code" href="strings_8h.html#a7fc844c12b769ccded05e7514036e241">ast_str_alloca</a>(256);
<a name="l00625"></a>00625    <span class="keywordflow">if</span> (timeval.tv_sec &gt; YEAR) {
<a name="l00626"></a>00626       x = (timeval.tv_sec / <a class="code" href="cli_8c.html#a5871356500f559add06ea81d60331b1b">YEAR</a>);
<a name="l00627"></a>00627       timeval.tv_sec -= (x * <a class="code" href="cli_8c.html#a5871356500f559add06ea81d60331b1b">YEAR</a>);
<a name="l00628"></a>00628       <a class="code" href="strings_8h.html#a85cd5a8ef499e39d22b4bfeb8b9a64f7" title="Append to a thread local dynamic string.">ast_str_append</a>(&amp;out, 0, <span class="stringliteral">&quot;%d year%s%s &quot;</span>, x, <a class="code" href="cli_8h.html#aa09c07179fe1c89f52bb28bc126d26f2">ESS</a>(x),<a class="code" href="cli_8c.html#a5f8f259f27c085a147c1f3d12dea87a5">NEEDCOMMA</a>(timeval.tv_sec));
<a name="l00629"></a>00629    }
<a name="l00630"></a>00630    <span class="keywordflow">if</span> (timeval.tv_sec &gt; WEEK) {
<a name="l00631"></a>00631       x = (timeval.tv_sec / <a class="code" href="cli_8c.html#a4a0cf4182a1661d0eb7a55494a2dd6e5">WEEK</a>);
<a name="l00632"></a>00632       timeval.tv_sec -= (x * <a class="code" href="cli_8c.html#a4a0cf4182a1661d0eb7a55494a2dd6e5">WEEK</a>);
<a name="l00633"></a>00633       <a class="code" href="strings_8h.html#a85cd5a8ef499e39d22b4bfeb8b9a64f7" title="Append to a thread local dynamic string.">ast_str_append</a>(&amp;out, 0, <span class="stringliteral">&quot;%d week%s%s &quot;</span>, x, <a class="code" href="cli_8h.html#aa09c07179fe1c89f52bb28bc126d26f2">ESS</a>(x),<a class="code" href="cli_8c.html#a5f8f259f27c085a147c1f3d12dea87a5">NEEDCOMMA</a>(timeval.tv_sec));
<a name="l00634"></a>00634    }
<a name="l00635"></a>00635    <span class="keywordflow">if</span> (timeval.tv_sec &gt; DAY) {
<a name="l00636"></a>00636       x = (timeval.tv_sec / <a class="code" href="cli_8c.html#a509a01c55cbe47386fe24602b7c7fda1">DAY</a>);
<a name="l00637"></a>00637       timeval.tv_sec -= (x * <a class="code" href="cli_8c.html#a509a01c55cbe47386fe24602b7c7fda1">DAY</a>);
<a name="l00638"></a>00638       <a class="code" href="strings_8h.html#a85cd5a8ef499e39d22b4bfeb8b9a64f7" title="Append to a thread local dynamic string.">ast_str_append</a>(&amp;out, 0, <span class="stringliteral">&quot;%d day%s%s &quot;</span>, x, <a class="code" href="cli_8h.html#aa09c07179fe1c89f52bb28bc126d26f2">ESS</a>(x),<a class="code" href="cli_8c.html#a5f8f259f27c085a147c1f3d12dea87a5">NEEDCOMMA</a>(timeval.tv_sec));
<a name="l00639"></a>00639    }
<a name="l00640"></a>00640    <span class="keywordflow">if</span> (timeval.tv_sec &gt; HOUR) {
<a name="l00641"></a>00641       x = (timeval.tv_sec / <a class="code" href="cli_8c.html#a4698ae12cf6a8acb5886fffd0ec897e6">HOUR</a>);
<a name="l00642"></a>00642       timeval.tv_sec -= (x * <a class="code" href="cli_8c.html#a4698ae12cf6a8acb5886fffd0ec897e6">HOUR</a>);
<a name="l00643"></a>00643       <a class="code" href="strings_8h.html#a85cd5a8ef499e39d22b4bfeb8b9a64f7" title="Append to a thread local dynamic string.">ast_str_append</a>(&amp;out, 0, <span class="stringliteral">&quot;%d hour%s%s &quot;</span>, x, <a class="code" href="cli_8h.html#aa09c07179fe1c89f52bb28bc126d26f2">ESS</a>(x),<a class="code" href="cli_8c.html#a5f8f259f27c085a147c1f3d12dea87a5">NEEDCOMMA</a>(timeval.tv_sec));
<a name="l00644"></a>00644    }
<a name="l00645"></a>00645    <span class="keywordflow">if</span> (timeval.tv_sec &gt; MINUTE) {
<a name="l00646"></a>00646       x = (timeval.tv_sec / <a class="code" href="cli_8c.html#ac1454fa04f41c693f39425697a137d82">MINUTE</a>);
<a name="l00647"></a>00647       timeval.tv_sec -= (x * <a class="code" href="cli_8c.html#ac1454fa04f41c693f39425697a137d82">MINUTE</a>);
<a name="l00648"></a>00648       <a class="code" href="strings_8h.html#a85cd5a8ef499e39d22b4bfeb8b9a64f7" title="Append to a thread local dynamic string.">ast_str_append</a>(&amp;out, 0, <span class="stringliteral">&quot;%d minute%s%s &quot;</span>, x, <a class="code" href="cli_8h.html#aa09c07179fe1c89f52bb28bc126d26f2">ESS</a>(x),<a class="code" href="cli_8c.html#a5f8f259f27c085a147c1f3d12dea87a5">NEEDCOMMA</a>(timeval.tv_sec));
<a name="l00649"></a>00649    }
<a name="l00650"></a>00650    x = timeval.tv_sec;
<a name="l00651"></a>00651    <span class="keywordflow">if</span> (x &gt; 0 || <a class="code" href="strings_8h.html#a99409c17a1d20e1c3dc00039b7925a2d" title="Returns the current length of the string stored within buf.">ast_str_strlen</a>(out) == 0) <span class="comment">/* if there is nothing, print 0 seconds */</span>
<a name="l00652"></a>00652       <a class="code" href="strings_8h.html#a85cd5a8ef499e39d22b4bfeb8b9a64f7" title="Append to a thread local dynamic string.">ast_str_append</a>(&amp;out, 0, <span class="stringliteral">&quot;%d second%s &quot;</span>, x, <a class="code" href="cli_8h.html#aa09c07179fe1c89f52bb28bc126d26f2">ESS</a>(x));
<a name="l00653"></a>00653    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%s: %s\n&quot;</span>, <a class="code" href="http_8c.html#a6f25bc812d09fedb86bf394c01061c56">prefix</a>, <a class="code" href="strings_8h.html#a053bdfc229997a75f112bdd7b995e00b" title="Returns the string buffer within the ast_str buf.">ast_str_buffer</a>(out));
<a name="l00654"></a>00654 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a49eaa638334191d1c0d9e901ed5e59f5"></a><!-- doxytag: member="cli.c::set_full_cmd" ref="a49eaa638334191d1c0d9e901ed5e59f5" args="(struct ast_cli_entry *e)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int set_full_cmd </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>initialize the _full_cmd string and related parameters, return 0 on success, -1 on error. </p>

<p>Definition at line <a class="el" href="cli_8c_source.html#l01519">1519</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00163">ast_cli_entry::_full_cmd</a>, <a class="el" href="cli_8h_source.html#l00167">ast_cli_entry::args</a>, <a class="el" href="utils_8c_source.html#l01451">ast_join()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="adsistub_8c_source.html#l00059">buf</a>, <a class="el" href="cli_8h_source.html#l00155">ast_cli_entry::cmda</a>, <a class="el" href="cli_8h_source.html#l00164">ast_cli_entry::cmdlen</a>, and <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>.</p>

<p>Referenced by <a class="el" href="cli_8c_source.html#l01857">__ast_cli_register()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01520"></a>01520 {
<a name="l01521"></a>01521    <span class="keywordtype">int</span> i;
<a name="l01522"></a>01522    <span class="keywordtype">char</span> <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[80];
<a name="l01523"></a>01523 
<a name="l01524"></a>01524    <a class="code" href="strings_8h.html#a0c9c27a9e6b4a6d1e2b868525ae3d0c1">ast_join</a>(buf, <span class="keyword">sizeof</span>(buf), e-&gt;<a class="code" href="structast__cli__entry.html#a17db870e4c2bb6e969b89cd6f96c991c">cmda</a>);
<a name="l01525"></a>01525    e-&gt;<a class="code" href="structast__cli__entry.html#ac15e0df3344959107453d9ba01503746">_full_cmd</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(buf);
<a name="l01526"></a>01526    <span class="keywordflow">if</span> (!e-&gt;<a class="code" href="structast__cli__entry.html#ac15e0df3344959107453d9ba01503746">_full_cmd</a>) {
<a name="l01527"></a>01527       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;-- cannot allocate &lt;%s&gt;\n&quot;</span>, buf);
<a name="l01528"></a>01528       <span class="keywordflow">return</span> -1;
<a name="l01529"></a>01529    }
<a name="l01530"></a>01530    e-&gt;<a class="code" href="structast__cli__entry.html#a461d5235a36284d30ec1d9fe480a89f2">cmdlen</a> = strcspn(e-&gt;<a class="code" href="structast__cli__entry.html#ac15e0df3344959107453d9ba01503746">_full_cmd</a>, <a class="code" href="cli_8c.html#a895466d470ce2fa13f141e05c81225f6">cli_rsvd</a>);
<a name="l01531"></a>01531    <span class="keywordflow">for</span> (i = 0; e-&gt;<a class="code" href="structast__cli__entry.html#a17db870e4c2bb6e969b89cd6f96c991c">cmda</a>[i]; i++)
<a name="l01532"></a>01532       ;
<a name="l01533"></a>01533    e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a> = i;
<a name="l01534"></a>01534    <span class="keywordflow">return</span> 0;
<a name="l01535"></a>01535 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7e2ed1ce1c57688bd381362ae8918d23"></a><!-- doxytag: member="cli.c::word_match" ref="a7e2ed1ce1c57688bd381362ae8918d23" args="(const char *cmd, const char *cli_word)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int word_match </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>cli_word</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>match a word in the CLI entry. returns -1 on mismatch, 0 on match of an optional word, 1 on match of a full word.</p>
<p>The pattern can be any_word match for equal [foo|bar|baz] optionally, one of these words {foo|bar|baz} exactly, one of these words % any word </p>

<p>Definition at line <a class="el" href="cli_8c_source.html#l01693">1693</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>References <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, and <a class="el" href="agi_2strcompat_8c_source.html#l00093">strcasestr()</a>.</p>

<p>Referenced by <a class="el" href="cli_8c_source.html#l02170">__ast_cli_generator()</a>, and <a class="el" href="cli_8c_source.html#l01772">find_cli()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01694"></a>01694 {
<a name="l01695"></a>01695    <span class="keywordtype">int</span> l;
<a name="l01696"></a>01696    <span class="keywordtype">char</span> *pos;
<a name="l01697"></a>01697 
<a name="l01698"></a>01698    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(cmd) || <a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(cli_word))
<a name="l01699"></a>01699       <span class="keywordflow">return</span> -1;
<a name="l01700"></a>01700    <span class="keywordflow">if</span> (!strchr(<a class="code" href="cli_8c.html#a895466d470ce2fa13f141e05c81225f6">cli_rsvd</a>, cli_word[0])) <span class="comment">/* normal match */</span>
<a name="l01701"></a>01701       <span class="keywordflow">return</span> (strcasecmp(cmd, cli_word) == 0) ? 1 : -1;
<a name="l01702"></a>01702    <span class="comment">/* regexp match, takes [foo|bar] or {foo|bar} */</span>
<a name="l01703"></a>01703    l = strlen(cmd);
<a name="l01704"></a>01704    <span class="comment">/* wildcard match - will extend in the future */</span>
<a name="l01705"></a>01705    <span class="keywordflow">if</span> (l &gt; 0 &amp;&amp; cli_word[0] == <span class="charliteral">&apos;%&apos;</span>) {
<a name="l01706"></a>01706       <span class="keywordflow">return</span> 1;   <span class="comment">/* wildcard */</span>
<a name="l01707"></a>01707    }
<a name="l01708"></a>01708    pos = <a class="code" href="agi_2strcompat_8c.html#ae9229017a4501f8d6a637b4498cfed2e">strcasestr</a>(cli_word, cmd);
<a name="l01709"></a>01709    <span class="keywordflow">if</span> (pos == NULL) <span class="comment">/* not found, say ok if optional */</span>
<a name="l01710"></a>01710       <span class="keywordflow">return</span> cli_word[0] == <span class="charliteral">&apos;[&apos;</span> ? 0 : -1;
<a name="l01711"></a>01711    <span class="keywordflow">if</span> (pos == cli_word) <span class="comment">/* no valid match at the beginning */</span>
<a name="l01712"></a>01712       <span class="keywordflow">return</span> -1;
<a name="l01713"></a>01713    <span class="keywordflow">if</span> (strchr(<a class="code" href="cli_8c.html#a895466d470ce2fa13f141e05c81225f6">cli_rsvd</a>, pos[-1]) &amp;&amp; strchr(<a class="code" href="cli_8c.html#a895466d470ce2fa13f141e05c81225f6">cli_rsvd</a>, pos[l]))
<a name="l01714"></a>01714       <span class="keywordflow">return</span> 1;   <span class="comment">/* valid match */</span>
<a name="l01715"></a>01715    <span class="keywordflow">return</span> -1;  <span class="comment">/* not found */</span>
<a name="l01716"></a>01716 }
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a2b3ef6f86e718331bfe64b859228e388"></a><!-- doxytag: member="cli.c::ast_cli_buf" ref="a2b3ef6f86e718331bfe64b859228e388" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__threadstorage.html">ast_threadstorage</a> <a class="el" href="cli_8c.html#a2b3ef6f86e718331bfe64b859228e388">ast_cli_buf</a> = { .once = PTHREAD_ONCE_INIT , .key_init = __init_ast_cli_buf , .custom_init = NULL , }<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cli_8c_source.html#l00095">95</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

</div>
</div>
<a class="anchor" id="a4d8f5feeefd2ef02881efa9181b57913"></a><!-- doxytag: member="cli.c::cli_cli" ref="a4d8f5feeefd2ef02881efa9181b57913" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> <a class="el" href="cli_8c.html#a4d8f5feeefd2ef02881efa9181b57913">cli_cli</a>[]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cli_8c_source.html#l01467">1467</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

</div>
</div>
<a class="anchor" id="a8b908b1af31513eae2e84e5346661d58"></a><!-- doxytag: member="cli.c::cli_default_perm" ref="a8b908b1af31513eae2e84e5346661d58" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="cli_8c.html#a8b908b1af31513eae2e84e5346661d58">cli_default_perm</a> = 1<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Default permissions value 1=Permit 0=Deny. </p>

<p>Definition at line <a class="el" href="cli_8c_source.html#l00071">71</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

</div>
</div>
<a class="anchor" id="a895466d470ce2fa13f141e05c81225f6"></a><!-- doxytag: member="cli.c::cli_rsvd" ref="a895466d470ce2fa13f141e05c81225f6" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char <a class="el" href="cli_8c.html#a895466d470ce2fa13f141e05c81225f6">cli_rsvd</a>[] = &quot;[]{}|*%&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Some regexp characters in cli arguments are reserved and used as separators. </p>

<p>Definition at line <a class="el" href="cli_8c_source.html#l01513">1513</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

</div>
</div>
<a class="anchor" id="aa5a37575f5e5a07b25c6ee3107d46008"></a><!-- doxytag: member="cli.c::climodentryfd" ref="aa5a37575f5e5a07b25c6ee3107d46008" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="cli_8c.html#aa5a37575f5e5a07b25c6ee3107d46008">climodentryfd</a> = -1<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cli_8c_source.html#l00593">593</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

</div>
</div>
<a class="anchor" id="ac7a1346decd3388ab226f4bddc88189a"></a><!-- doxytag: member="cli.c::climodentrylock" ref="ac7a1346decd3388ab226f4bddc88189a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="lock_8h.html#a2d9118a2a8939f115eea771bce3a52f2">ast_mutex_t</a> <a class="el" href="cli_8c.html#ac7a1346decd3388ab226f4bddc88189a">climodentrylock</a> = ((<a class="el" href="lock_8h.html#a2d9118a2a8939f115eea771bce3a52f2">ast_mutex_t</a>) PTHREAD_MUTEX_INITIALIZER )<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cli_8c_source.html#l00592">592</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>Referenced by <a class="el" href="cli_8c_source.html#l00696">handle_modlist()</a>.</p>

</div>
</div>
<a class="anchor" id="adf077cec50df93f97b46d8b6261c6f04"></a><!-- doxytag: member="cli.c::debug_files" ref="adf077cec50df93f97b46d8b6261c6f04" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structdebug__file__list.html">debug_file_list</a> <a class="el" href="cli_8c.html#adf077cec50df93f97b46d8b6261c6f04">debug_files</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>list of filenames and their debug settings </p>

<p>Definition at line <a class="el" href="cli_8c_source.html#l00091">91</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae473ef191024f9043e7388e1a0585791"></a><!-- doxytag: member="cli.c::perms_config" ref="ae473ef191024f9043e7388e1a0585791" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char <a class="el" href="cli_8c.html#ae473ef191024f9043e7388e1a0585791">perms_config</a>[] = &quot;cli_permissions.conf&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>CLI permissions config file. </p>

<p>Definition at line <a class="el" href="cli_8c_source.html#l00069">69</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

<p>Referenced by <a class="el" href="cli_8c_source.html#l01554">ast_cli_perms_init()</a>.</p>

</div>
</div>
<a class="anchor" id="a69909b2c3c4a62443fc781e20ba3ddc5"></a><!-- doxytag: member="cli.c::permsconfiglock" ref="a69909b2c3c4a62443fc781e20ba3ddc5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="lock_8h.html#a2d9118a2a8939f115eea771bce3a52f2">ast_mutex_t</a> <a class="el" href="cli_8c.html#a69909b2c3c4a62443fc781e20ba3ddc5">permsconfiglock</a> = ((<a class="el" href="lock_8h.html#a2d9118a2a8939f115eea771bce3a52f2">ast_mutex_t</a>) PTHREAD_MUTEX_INITIALIZER )<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>mutex used to prevent a <a class="el" href="structuser.html" title="structure to hold users read from users.conf">user</a> from running the 'cli reload permissions' command while it is already running. </p>

<p>Definition at line <a class="el" href="cli_8c_source.html#l00075">75</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

</div>
</div>
<a class="anchor" id="afeb8a3babc8d262f1ae1dabacc656b84"></a><!-- doxytag: member="cli.c::verbose_files" ref="afeb8a3babc8d262f1ae1dabacc656b84" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structdebug__file__list.html">debug_file_list</a> <a class="el" href="cli_8c.html#afeb8a3babc8d262f1ae1dabacc656b84">verbose_files</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>list of filenames and their verbose settings </p>

<p>Definition at line <a class="el" href="cli_8c_source.html#l00093">93</a> of file <a class="el" href="cli_8c_source.html">cli.c</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:21:54 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
