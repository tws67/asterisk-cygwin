<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:23:18 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_318a70d4e812a718d9ecaeea98fff199.html">res</a>
  </div>
</div>
<div class="contents">
<h1>res_timing_timerfd.c File Reference</h1>
<p>timerfd timing interface  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="asterisk_8h_source.html">asterisk.h</a>&quot;</code><br/>
<code>#include &lt;sys/timerfd.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="module_8h_source.html">asterisk/module.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="astobj2_8h_source.html">asterisk/astobj2.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="timing_8h_source.html">asterisk/timing.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="logger_8h_source.html">asterisk/logger.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="utils_8h_source.html">asterisk/utils.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="time_8h_source.html">asterisk/time.h</a>&quot;</code><br/>

<p><a href="res__timing__timerfd_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structtimerfd__timer.html">timerfd_timer</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__timerfd_8c.html#af2c33660343798f7b4632c023b780637">TIMERFD_MAX_RATE</a>&nbsp;&nbsp;&nbsp;1000</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__timerfd_8c.html#a8636fcc41a26456545001bacc6ea7039">TIMERFD_TIMER_BUCKETS</a>&nbsp;&nbsp;&nbsp;563</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__timerfd_8c.html#a88b7c88fed6b80fd18f34f97757dfc04">__reg_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__timerfd_8c.html#afeab1257bd17282b95875499393a147a">__unreg_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__timerfd_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__timerfd_8c.html#a73f0f48df6dcb3b2ceb819665303335a">timer_destroy</a> (void *obj)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__timerfd_8c.html#a2fcfd5500ca3003db98852f125c0ee87">timerfd_timer_ack</a> (int handle, unsigned int quantity)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__timerfd_8c.html#a27df1a6ad0af573a2c2f7b30f57261b4">timerfd_timer_close</a> (int handle)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__timerfd_8c.html#abf61bf2f98b9c56c91d6053769822a4c">timerfd_timer_cmp</a> (void *obj, void *args, int flags)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__timerfd_8c.html#af8432a50a7af1772fb9c354b85e3e87f">timerfd_timer_disable_continuous</a> (int handle)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__timerfd_8c.html#aa2413db267edab0ce3a468b74a7b63fe">timerfd_timer_enable_continuous</a> (int handle)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="timing_8h.html#aa21078cc57057eeda614cb7780bdc60a">ast_timer_event</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__timerfd_8c.html#a7f82d436e1f02ef18f55e955cd292aea">timerfd_timer_get_event</a> (int handle)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__timerfd_8c.html#ad9e45ff9139076c1d3e016093895e64e">timerfd_timer_get_max_rate</a> (int handle)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__timerfd_8c.html#a9a766553d420b728dd6fb771228ce8b0">timerfd_timer_hash</a> (const void *obj, const int flags)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__timerfd_8c.html#ac845946913d73bef9caefa3f0e6c6f95">timerfd_timer_open</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__timerfd_8c.html#a187959b4a84132dd2558c8911ede66a2">timerfd_timer_set_rate</a> (int handle, unsigned int rate)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__timerfd_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a> (void)</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__module__info.html">ast_module_info</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__timerfd_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a> = { .<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = AST_MODULE, .flags = AST_MODFLAG_LOAD_ORDER , .<a class="el" href="callerid_8c.html#a68344fa88cf4e86b5079fd69a5c22d57">description</a> = &quot;Timerfd Timing Interface&quot; , .key = &quot;This paragraph is copyright (c) 2006 by Digium, Inc. \In order for your module to load, it must return this \key via a function called \&quot;key\&quot;. Any code which \includes this paragraph must be licensed under the GNU \General Public License <a class="el" href="res__config__pgsql_8c.html#aad880fc4455c253781e8968f2239d56f">version</a> 2 or later (at your \option). In addition to Digium's general reservations \of rights, Digium expressly reserves the right to \allow other parties to license this paragraph under \different terms. Any use of Digium, Inc. trademarks or \logos (including \&quot;Asterisk\&quot; or \&quot;Digium\&quot;) without \express written <a class="el" href="structpermission.html">permission</a> of Digium, Inc. is prohibited.\n&quot; , .buildopt_sum = &quot;aefddfaffd51bc118c14a748e96eb9a0&quot; , .load = load_module, .unload = unload_module, .load_pri = 10, }</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__module__info.html">ast_module_info</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__timerfd_8c.html#ae25b9f3970870610911f8850897e8ead">ast_module_info</a> = &amp;<a class="el" href="res__timing__timerfd_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structao2__container.html">ao2_container</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__timerfd_8c.html#adf3a17f66556a42c199df64d980f8745">timerfd_timers</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__timing__interface.html">ast_timing_interface</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__timerfd_8c.html#a1479b98c6cb668f64c6f98881e30b824">timerfd_timing</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__timing__timerfd_8c.html#ac5071f22a1a673d4f64d2d7b86a72846">timing_funcs_handle</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>timerfd timing interface </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Mark Michelson &lt;<a href="mailto:mmichelson@digium.com">mmichelson@digium.com</a>&gt; </dd></dl>

<p>Definition in file <a class="el" href="res__timing__timerfd_8c_source.html">res_timing_timerfd.c</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="af2c33660343798f7b4632c023b780637"></a><!-- doxytag: member="res_timing_timerfd.c::TIMERFD_MAX_RATE" ref="af2c33660343798f7b4632c023b780637" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TIMERFD_MAX_RATE&nbsp;&nbsp;&nbsp;1000</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__timing__timerfd_8c_source.html#l00068">68</a> of file <a class="el" href="res__timing__timerfd_8c_source.html">res_timing_timerfd.c</a>.</p>

<p>Referenced by <a class="el" href="res__timing__timerfd_8c_source.html#l00258">timerfd_timer_get_max_rate()</a>.</p>

</div>
</div>
<a class="anchor" id="a8636fcc41a26456545001bacc6ea7039"></a><!-- doxytag: member="res_timing_timerfd.c::TIMERFD_TIMER_BUCKETS" ref="a8636fcc41a26456545001bacc6ea7039" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TIMERFD_TIMER_BUCKETS&nbsp;&nbsp;&nbsp;563</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__timing__timerfd_8c_source.html#l00067">67</a> of file <a class="el" href="res__timing__timerfd_8c_source.html">res_timing_timerfd.c</a>.</p>

<p>Referenced by <a class="el" href="res__timing__timerfd_8c_source.html#l00263">load_module()</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a88b7c88fed6b80fd18f34f97757dfc04"></a><!-- doxytag: member="res_timing_timerfd.c::__reg_module" ref="a88b7c88fed6b80fd18f34f97757dfc04" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void __reg_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__timing__timerfd_8c_source.html#l00303">303</a> of file <a class="el" href="res__timing__timerfd_8c_source.html">res_timing_timerfd.c</a>.</p>

</div>
</div>
<a class="anchor" id="afeab1257bd17282b95875499393a147a"></a><!-- doxytag: member="res_timing_timerfd.c::__unreg_module" ref="afeab1257bd17282b95875499393a147a" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void __unreg_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__timing__timerfd_8c_source.html#l00303">303</a> of file <a class="el" href="res__timing__timerfd_8c_source.html">res_timing_timerfd.c</a>.</p>

</div>
</div>
<a class="anchor" id="ac3382bf6da54c56b37069bd76bbdf4f9"></a><!-- doxytag: member="res_timing_timerfd.c::load_module" ref="ac3382bf6da54c56b37069bd76bbdf4f9" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int load_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__timing__timerfd_8c_source.html#l00263">263</a> of file <a class="el" href="res__timing__timerfd_8c_source.html">res_timing_timerfd.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00727">ao2_container_alloc</a>, <a class="el" href="astobj2_8h_source.html#l00459">ao2_ref</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="module_8h_source.html#l00062">AST_MODULE_LOAD_DECLINE</a>, <a class="el" href="module_8h_source.html#l00061">AST_MODULE_LOAD_SUCCESS</a>, <a class="el" href="timing_8h_source.html#l00094">ast_register_timing_interface</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="res__timing__timerfd_8c_source.html#l00067">TIMERFD_TIMER_BUCKETS</a>, <a class="el" href="res__timing__timerfd_8c_source.html#l00083">timerfd_timer_cmp()</a>, <a class="el" href="res__timing__timerfd_8c_source.html#l00076">timerfd_timer_hash()</a>, and <a class="el" href="res__timing__timerfd_8c_source.html#l00041">timing_funcs_handle</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00264"></a>00264 {
<a name="l00265"></a>00265    <span class="keywordtype">int</span> fd;
<a name="l00266"></a>00266 
<a name="l00267"></a>00267    <span class="comment">/* Make sure we support the necessary clock type */</span>
<a name="l00268"></a>00268    <span class="keywordflow">if</span> ((fd = timerfd_create(CLOCK_MONOTONIC, 0)) &lt; 0) {
<a name="l00269"></a>00269       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;CLOCK_MONOTONIC not supported.  Not loading.\n&quot;</span>);
<a name="l00270"></a>00270       <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;
<a name="l00271"></a>00271    }
<a name="l00272"></a>00272 
<a name="l00273"></a>00273    close(fd);
<a name="l00274"></a>00274 
<a name="l00275"></a>00275    <span class="keywordflow">if</span> (!(<a class="code" href="res__timing__timerfd_8c.html#adf3a17f66556a42c199df64d980f8745">timerfd_timers</a> = <a class="code" href="astobj2_8h.html#a82534c91be59ec9a3d3318ec85ac5695">ao2_container_alloc</a>(<a class="code" href="res__timing__timerfd_8c.html#a8636fcc41a26456545001bacc6ea7039">TIMERFD_TIMER_BUCKETS</a>, <a class="code" href="res__timing__timerfd_8c.html#a9a766553d420b728dd6fb771228ce8b0">timerfd_timer_hash</a>, <a class="code" href="res__timing__timerfd_8c.html#abf61bf2f98b9c56c91d6053769822a4c">timerfd_timer_cmp</a>))) {
<a name="l00276"></a>00276       <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;
<a name="l00277"></a>00277    }
<a name="l00278"></a>00278 
<a name="l00279"></a>00279    <span class="keywordflow">if</span> (!(<a class="code" href="res__timing__timerfd_8c.html#ac5071f22a1a673d4f64d2d7b86a72846">timing_funcs_handle</a> = <a class="code" href="timing_8h.html#a3f3f2e1390eb451dcc88dc09b0511af2" title="Register a set of timing functions.">ast_register_timing_interface</a>(&amp;<a class="code" href="res__timing__timerfd_8c.html#a1479b98c6cb668f64c6f98881e30b824">timerfd_timing</a>))) {
<a name="l00280"></a>00280       <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(<a class="code" href="res__timing__timerfd_8c.html#adf3a17f66556a42c199df64d980f8745">timerfd_timers</a>, -1);
<a name="l00281"></a>00281       <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;
<a name="l00282"></a>00282    }
<a name="l00283"></a>00283 
<a name="l00284"></a>00284    <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a>;
<a name="l00285"></a>00285 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a73f0f48df6dcb3b2ceb819665303335a"></a><!-- doxytag: member="res_timing_timerfd.c::timer_destroy" ref="a73f0f48df6dcb3b2ceb819665303335a" args="(void *obj)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void timer_destroy </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>obj</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__timing__timerfd_8c_source.html#l00089">89</a> of file <a class="el" href="res__timing__timerfd_8c_source.html">res_timing_timerfd.c</a>.</p>

<p>References <a class="el" href="res__timing__timerfd_8c_source.html#l00071">timerfd_timer::handle</a>, and <a class="el" href="chan__iax2_8c_source.html#l00261">timer</a>.</p>

<p>Referenced by <a class="el" href="res__timing__timerfd_8c_source.html#l00095">timerfd_timer_open()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00090"></a>00090 {
<a name="l00091"></a>00091    <span class="keyword">struct </span><a class="code" href="structtimerfd__timer.html">timerfd_timer</a> *<a class="code" href="chan__iax2_8c.html#a9aed6490b63794e6c9c00af4533f255f">timer</a> = obj;
<a name="l00092"></a>00092    close(timer-&gt;<a class="code" href="structtimerfd__timer.html#a3127ebf018e9da62fa464d348352037d">handle</a>);
<a name="l00093"></a>00093 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2fcfd5500ca3003db98852f125c0ee87"></a><!-- doxytag: member="res_timing_timerfd.c::timerfd_timer_ack" ref="a2fcfd5500ca3003db98852f125c0ee87" args="(int handle, unsigned int quantity)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void timerfd_timer_ack </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>quantity</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__timing__timerfd_8c_source.html#l00158">158</a> of file <a class="el" href="res__timing__timerfd_8c_source.html">res_timing_timerfd.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, and <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00159"></a>00159 {
<a name="l00160"></a>00160    uint64_t expirations;
<a name="l00161"></a>00161    <span class="keywordtype">int</span> read_result = 0;
<a name="l00162"></a>00162 
<a name="l00163"></a>00163    <span class="keywordflow">do</span> {
<a name="l00164"></a>00164       read_result = read(<a class="code" href="structtimerfd__timer.html#a3127ebf018e9da62fa464d348352037d">handle</a>, &amp;expirations, <span class="keyword">sizeof</span>(expirations));
<a name="l00165"></a>00165       <span class="keywordflow">if</span> (read_result == -1) {
<a name="l00166"></a>00166          <span class="keywordflow">if</span> (errno == EINTR) {
<a name="l00167"></a>00167             <span class="keywordflow">continue</span>;
<a name="l00168"></a>00168          } <span class="keywordflow">else</span> {
<a name="l00169"></a>00169             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Read error: %s\n&quot;</span>, strerror(errno));
<a name="l00170"></a>00170             <span class="keywordflow">break</span>;
<a name="l00171"></a>00171          }
<a name="l00172"></a>00172       }
<a name="l00173"></a>00173    } <span class="keywordflow">while</span> (read_result != <span class="keyword">sizeof</span>(expirations));
<a name="l00174"></a>00174 
<a name="l00175"></a>00175    <span class="keywordflow">if</span> (expirations != quantity) {
<a name="l00176"></a>00176       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;Expected to acknowledge %u ticks but got %llu instead\n&quot;</span>, quantity, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>) expirations);
<a name="l00177"></a>00177    }
<a name="l00178"></a>00178 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a27df1a6ad0af573a2c2f7b30f57261b4"></a><!-- doxytag: member="res_timing_timerfd.c::timerfd_timer_close" ref="a27df1a6ad0af573a2c2f7b30f57261b4" args="(int handle)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void timerfd_timer_close </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>handle</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__timing__timerfd_8c_source.html#l00117">117</a> of file <a class="el" href="res__timing__timerfd_8c_source.html">res_timing_timerfd.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00968">ao2_find</a>, <a class="el" href="astobj2_8h_source.html#l00459">ao2_ref</a>, <a class="el" href="astobj2_8h_source.html#l00813">ao2_unlink</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, and <a class="el" href="astobj2_8h_source.html#l00678">OBJ_POINTER</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00118"></a>00118 {
<a name="l00119"></a>00119    <span class="keyword">struct </span><a class="code" href="structtimerfd__timer.html">timerfd_timer</a> *our_timer, find_helper = {
<a name="l00120"></a>00120       .handle = <a class="code" href="structtimerfd__timer.html#a3127ebf018e9da62fa464d348352037d">handle</a>,
<a name="l00121"></a>00121    };
<a name="l00122"></a>00122 
<a name="l00123"></a>00123    <span class="keywordflow">if</span> (!(our_timer = <a class="code" href="astobj2_8h.html#a618587b42226725315b96db394b13673">ao2_find</a>(<a class="code" href="res__timing__timerfd_8c.html#adf3a17f66556a42c199df64d980f8745">timerfd_timers</a>, &amp;find_helper, <a class="code" href="astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca32d49976aaebc093266f0b080f9c9a73">OBJ_POINTER</a>))) {
<a name="l00124"></a>00124       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Couldn&apos;t find timer with handle %d\n&quot;</span>, <a class="code" href="structtimerfd__timer.html#a3127ebf018e9da62fa464d348352037d">handle</a>);
<a name="l00125"></a>00125       <span class="keywordflow">return</span>;
<a name="l00126"></a>00126    }
<a name="l00127"></a>00127 
<a name="l00128"></a>00128    <a class="code" href="astobj2_8h.html#a1bd301bcff8b41c07adbecf93eb7dce7">ao2_unlink</a>(<a class="code" href="res__timing__timerfd_8c.html#adf3a17f66556a42c199df64d980f8745">timerfd_timers</a>, our_timer);
<a name="l00129"></a>00129    <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(our_timer, -1);
<a name="l00130"></a>00130 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="abf61bf2f98b9c56c91d6053769822a4c"></a><!-- doxytag: member="res_timing_timerfd.c::timerfd_timer_cmp" ref="abf61bf2f98b9c56c91d6053769822a4c" args="(void *obj, void *args, int flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int timerfd_timer_cmp </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>args</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__timing__timerfd_8c_source.html#l00083">83</a> of file <a class="el" href="res__timing__timerfd_8c_source.html">res_timing_timerfd.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00653">CMP_MATCH</a>, <a class="el" href="astobj2_8h_source.html#l00654">CMP_STOP</a>, and <a class="el" href="res__timing__timerfd_8c_source.html#l00071">timerfd_timer::handle</a>.</p>

<p>Referenced by <a class="el" href="res__timing__timerfd_8c_source.html#l00263">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00084"></a>00084 {
<a name="l00085"></a>00085    <span class="keyword">struct </span><a class="code" href="structtimerfd__timer.html">timerfd_timer</a> *timer1 = obj, *timer2 = args;
<a name="l00086"></a>00086    <span class="keywordflow">return</span> timer1-&gt;<a class="code" href="structtimerfd__timer.html#a3127ebf018e9da62fa464d348352037d">handle</a> == timer2-&gt;handle ? <a class="code" href="astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a> | <a class="code" href="astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df">CMP_STOP</a> : 0;
<a name="l00087"></a>00087 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af8432a50a7af1772fb9c354b85e3e87f"></a><!-- doxytag: member="res_timing_timerfd.c::timerfd_timer_disable_continuous" ref="af8432a50a7af1772fb9c354b85e3e87f" args="(int handle)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int timerfd_timer_disable_continuous </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>handle</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__timing__timerfd_8c_source.html#l00209">209</a> of file <a class="el" href="res__timing__timerfd_8c_source.html">res_timing_timerfd.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00968">ao2_find</a>, <a class="el" href="astobj2_8h_source.html#l00459">ao2_ref</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="res__timing__timerfd_8c_source.html#l00073">timerfd_timer::is_continuous</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="astobj2_8h_source.html#l00678">OBJ_POINTER</a>, and <a class="el" href="res__timing__timerfd_8c_source.html#l00072">timerfd_timer::saved_timer</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00210"></a>00210 {
<a name="l00211"></a>00211    <span class="keywordtype">int</span> res;
<a name="l00212"></a>00212    <span class="keyword">struct </span><a class="code" href="structtimerfd__timer.html">timerfd_timer</a> *our_timer, find_helper = {
<a name="l00213"></a>00213       .handle = <a class="code" href="structtimerfd__timer.html#a3127ebf018e9da62fa464d348352037d">handle</a>,
<a name="l00214"></a>00214    };
<a name="l00215"></a>00215 
<a name="l00216"></a>00216    <span class="keywordflow">if</span> (!(our_timer = <a class="code" href="astobj2_8h.html#a618587b42226725315b96db394b13673">ao2_find</a>(<a class="code" href="res__timing__timerfd_8c.html#adf3a17f66556a42c199df64d980f8745">timerfd_timers</a>, &amp;find_helper, <a class="code" href="astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca32d49976aaebc093266f0b080f9c9a73">OBJ_POINTER</a>))) {
<a name="l00217"></a>00217       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Couldn&apos;t find timer with handle %d\n&quot;</span>, <a class="code" href="structtimerfd__timer.html#a3127ebf018e9da62fa464d348352037d">handle</a>);
<a name="l00218"></a>00218       <span class="keywordflow">return</span> -1;
<a name="l00219"></a>00219    }
<a name="l00220"></a>00220 
<a name="l00221"></a>00221    <span class="keywordflow">if</span>(!our_timer-&gt;<a class="code" href="structtimerfd__timer.html#aad44f4b6b414402fa3acad0166b1b506">is_continuous</a>) {
<a name="l00222"></a>00222       <span class="comment">/* No reason to do anything if we&apos;re not</span>
<a name="l00223"></a>00223 <span class="comment">       * in continuous mode</span>
<a name="l00224"></a>00224 <span class="comment">       */</span>
<a name="l00225"></a>00225       <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(our_timer, -1);
<a name="l00226"></a>00226       <span class="keywordflow">return</span> 0;
<a name="l00227"></a>00227    }
<a name="l00228"></a>00228 
<a name="l00229"></a>00229    res = timerfd_settime(<a class="code" href="structtimerfd__timer.html#a3127ebf018e9da62fa464d348352037d">handle</a>, 0, &amp;our_timer-&gt;<a class="code" href="structtimerfd__timer.html#ae4dffc3f6313e22f30b9f8bf960299f6">saved_timer</a>, NULL);
<a name="l00230"></a>00230    our_timer-&gt;<a class="code" href="structtimerfd__timer.html#aad44f4b6b414402fa3acad0166b1b506">is_continuous</a> = 0;
<a name="l00231"></a>00231    memset(&amp;our_timer-&gt;<a class="code" href="structtimerfd__timer.html#ae4dffc3f6313e22f30b9f8bf960299f6">saved_timer</a>, 0, <span class="keyword">sizeof</span>(our_timer-&gt;<a class="code" href="structtimerfd__timer.html#ae4dffc3f6313e22f30b9f8bf960299f6">saved_timer</a>));
<a name="l00232"></a>00232    <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(our_timer, -1);
<a name="l00233"></a>00233    <span class="keywordflow">return</span> res;
<a name="l00234"></a>00234 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa2413db267edab0ce3a468b74a7b63fe"></a><!-- doxytag: member="res_timing_timerfd.c::timerfd_timer_enable_continuous" ref="aa2413db267edab0ce3a468b74a7b63fe" args="(int handle)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int timerfd_timer_enable_continuous </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>handle</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__timing__timerfd_8c_source.html#l00180">180</a> of file <a class="el" href="res__timing__timerfd_8c_source.html">res_timing_timerfd.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00968">ao2_find</a>, <a class="el" href="astobj2_8h_source.html#l00459">ao2_ref</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="res__timing__timerfd_8c_source.html#l00073">timerfd_timer::is_continuous</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="astobj2_8h_source.html#l00678">OBJ_POINTER</a>, and <a class="el" href="res__timing__timerfd_8c_source.html#l00072">timerfd_timer::saved_timer</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00181"></a>00181 {
<a name="l00182"></a>00182    <span class="keywordtype">int</span> res;
<a name="l00183"></a>00183    <span class="keyword">struct </span>itimerspec continuous_timer = {
<a name="l00184"></a>00184       .it_value.tv_nsec = 1L,
<a name="l00185"></a>00185    };
<a name="l00186"></a>00186    <span class="keyword">struct </span><a class="code" href="structtimerfd__timer.html">timerfd_timer</a> *our_timer, find_helper = {
<a name="l00187"></a>00187       .handle = <a class="code" href="structtimerfd__timer.html#a3127ebf018e9da62fa464d348352037d">handle</a>,
<a name="l00188"></a>00188    };
<a name="l00189"></a>00189 
<a name="l00190"></a>00190    <span class="keywordflow">if</span> (!(our_timer = <a class="code" href="astobj2_8h.html#a618587b42226725315b96db394b13673">ao2_find</a>(<a class="code" href="res__timing__timerfd_8c.html#adf3a17f66556a42c199df64d980f8745">timerfd_timers</a>, &amp;find_helper, <a class="code" href="astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca32d49976aaebc093266f0b080f9c9a73">OBJ_POINTER</a>))) {
<a name="l00191"></a>00191       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Couldn&apos;t find timer with handle %d\n&quot;</span>, <a class="code" href="structtimerfd__timer.html#a3127ebf018e9da62fa464d348352037d">handle</a>);
<a name="l00192"></a>00192       <span class="keywordflow">return</span> -1;
<a name="l00193"></a>00193    }
<a name="l00194"></a>00194 
<a name="l00195"></a>00195    <span class="keywordflow">if</span> (our_timer-&gt;<a class="code" href="structtimerfd__timer.html#aad44f4b6b414402fa3acad0166b1b506">is_continuous</a>) {
<a name="l00196"></a>00196       <span class="comment">/*It&apos;s already in continous mode, no need to do</span>
<a name="l00197"></a>00197 <span class="comment">       * anything further</span>
<a name="l00198"></a>00198 <span class="comment">       */</span>
<a name="l00199"></a>00199       <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(our_timer, -1);
<a name="l00200"></a>00200       <span class="keywordflow">return</span> 0;
<a name="l00201"></a>00201    }
<a name="l00202"></a>00202 
<a name="l00203"></a>00203    res = timerfd_settime(<a class="code" href="structtimerfd__timer.html#a3127ebf018e9da62fa464d348352037d">handle</a>, 0, &amp;continuous_timer, &amp;our_timer-&gt;<a class="code" href="structtimerfd__timer.html#ae4dffc3f6313e22f30b9f8bf960299f6">saved_timer</a>);
<a name="l00204"></a>00204    our_timer-&gt;<a class="code" href="structtimerfd__timer.html#aad44f4b6b414402fa3acad0166b1b506">is_continuous</a> = 1;
<a name="l00205"></a>00205    <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(our_timer, -1);
<a name="l00206"></a>00206    <span class="keywordflow">return</span> res;
<a name="l00207"></a>00207 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7f82d436e1f02ef18f55e955cd292aea"></a><!-- doxytag: member="res_timing_timerfd.c::timerfd_timer_get_event" ref="a7f82d436e1f02ef18f55e955cd292aea" args="(int handle)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="timing_8h.html#aa21078cc57057eeda614cb7780bdc60a">ast_timer_event</a> timerfd_timer_get_event </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>handle</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__timing__timerfd_8c_source.html#l00236">236</a> of file <a class="el" href="res__timing__timerfd_8c_source.html">res_timing_timerfd.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00968">ao2_find</a>, <a class="el" href="astobj2_8h_source.html#l00459">ao2_ref</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="timing_8h_source.html#l00059">AST_TIMING_EVENT_CONTINUOUS</a>, <a class="el" href="timing_8h_source.html#l00058">AST_TIMING_EVENT_EXPIRED</a>, <a class="el" href="res__timing__timerfd_8c_source.html#l00073">timerfd_timer::is_continuous</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, and <a class="el" href="astobj2_8h_source.html#l00678">OBJ_POINTER</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00237"></a>00237 {
<a name="l00238"></a>00238    <span class="keyword">enum</span> <a class="code" href="timing_8h.html#aa21078cc57057eeda614cb7780bdc60a">ast_timer_event</a> res;
<a name="l00239"></a>00239    <span class="keyword">struct </span><a class="code" href="structtimerfd__timer.html">timerfd_timer</a> *our_timer, find_helper = {
<a name="l00240"></a>00240       .handle = <a class="code" href="structtimerfd__timer.html#a3127ebf018e9da62fa464d348352037d">handle</a>,
<a name="l00241"></a>00241    };
<a name="l00242"></a>00242 
<a name="l00243"></a>00243    <span class="keywordflow">if</span> (!(our_timer = <a class="code" href="astobj2_8h.html#a618587b42226725315b96db394b13673">ao2_find</a>(<a class="code" href="res__timing__timerfd_8c.html#adf3a17f66556a42c199df64d980f8745">timerfd_timers</a>, &amp;find_helper, <a class="code" href="astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca32d49976aaebc093266f0b080f9c9a73">OBJ_POINTER</a>))) {
<a name="l00244"></a>00244       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Couldn&apos;t find timer with handle %d\n&quot;</span>, <a class="code" href="structtimerfd__timer.html#a3127ebf018e9da62fa464d348352037d">handle</a>);
<a name="l00245"></a>00245       <span class="keywordflow">return</span> -1;
<a name="l00246"></a>00246    }
<a name="l00247"></a>00247 
<a name="l00248"></a>00248    <span class="keywordflow">if</span> (our_timer-&gt;<a class="code" href="structtimerfd__timer.html#aad44f4b6b414402fa3acad0166b1b506">is_continuous</a>) {
<a name="l00249"></a>00249       res = <a class="code" href="timing_8h.html#aa21078cc57057eeda614cb7780bdc60aa2f1a45286f54b8f415b28dc072b931e6">AST_TIMING_EVENT_CONTINUOUS</a>;
<a name="l00250"></a>00250    } <span class="keywordflow">else</span> {
<a name="l00251"></a>00251       res = <a class="code" href="timing_8h.html#aa21078cc57057eeda614cb7780bdc60aa6338cdd939adbc65d20e3412bf11fc3c">AST_TIMING_EVENT_EXPIRED</a>;
<a name="l00252"></a>00252    }
<a name="l00253"></a>00253 
<a name="l00254"></a>00254    <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(our_timer, -1);
<a name="l00255"></a>00255    <span class="keywordflow">return</span> res;
<a name="l00256"></a>00256 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad9e45ff9139076c1d3e016093895e64e"></a><!-- doxytag: member="res_timing_timerfd.c::timerfd_timer_get_max_rate" ref="ad9e45ff9139076c1d3e016093895e64e" args="(int handle)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static unsigned int timerfd_timer_get_max_rate </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>handle</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__timing__timerfd_8c_source.html#l00258">258</a> of file <a class="el" href="res__timing__timerfd_8c_source.html">res_timing_timerfd.c</a>.</p>

<p>References <a class="el" href="res__timing__timerfd_8c_source.html#l00068">TIMERFD_MAX_RATE</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00259"></a>00259 {
<a name="l00260"></a>00260    <span class="keywordflow">return</span> <a class="code" href="res__timing__timerfd_8c.html#af2c33660343798f7b4632c023b780637">TIMERFD_MAX_RATE</a>;
<a name="l00261"></a>00261 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9a766553d420b728dd6fb771228ce8b0"></a><!-- doxytag: member="res_timing_timerfd.c::timerfd_timer_hash" ref="a9a766553d420b728dd6fb771228ce8b0" args="(const void *obj, const int flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int timerfd_timer_hash </td>
          <td>(</td>
          <td class="paramtype">const void *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__timing__timerfd_8c_source.html#l00076">76</a> of file <a class="el" href="res__timing__timerfd_8c_source.html">res_timing_timerfd.c</a>.</p>

<p>References <a class="el" href="res__timing__timerfd_8c_source.html#l00071">timerfd_timer::handle</a>, and <a class="el" href="chan__iax2_8c_source.html#l00261">timer</a>.</p>

<p>Referenced by <a class="el" href="res__timing__timerfd_8c_source.html#l00263">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00077"></a>00077 {
<a name="l00078"></a>00078    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structtimerfd__timer.html">timerfd_timer</a> *<a class="code" href="chan__iax2_8c.html#a9aed6490b63794e6c9c00af4533f255f">timer</a> = obj;
<a name="l00079"></a>00079 
<a name="l00080"></a>00080    <span class="keywordflow">return</span> timer-&gt;<a class="code" href="structtimerfd__timer.html#a3127ebf018e9da62fa464d348352037d">handle</a>;
<a name="l00081"></a>00081 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac845946913d73bef9caefa3f0e6c6f95"></a><!-- doxytag: member="res_timing_timerfd.c::timerfd_timer_open" ref="ac845946913d73bef9caefa3f0e6c6f95" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int timerfd_timer_open </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__timing__timerfd_8c_source.html#l00095">95</a> of file <a class="el" href="res__timing__timerfd_8c_source.html">res_timing_timerfd.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00413">ao2_alloc</a>, <a class="el" href="astobj2_8h_source.html#l00782">ao2_link</a>, <a class="el" href="astobj2_8h_source.html#l00459">ao2_ref</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="res__timing__timerfd_8c_source.html#l00071">timerfd_timer::handle</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="chan__iax2_8c_source.html#l00261">timer</a>, and <a class="el" href="res__timing__timerfd_8c_source.html#l00089">timer_destroy()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00096"></a>00096 {
<a name="l00097"></a>00097    <span class="keyword">struct </span><a class="code" href="structtimerfd__timer.html">timerfd_timer</a> *<a class="code" href="chan__iax2_8c.html#a9aed6490b63794e6c9c00af4533f255f">timer</a>;
<a name="l00098"></a>00098    <span class="keywordtype">int</span> <a class="code" href="structtimerfd__timer.html#a3127ebf018e9da62fa464d348352037d">handle</a>;
<a name="l00099"></a>00099 
<a name="l00100"></a>00100    <span class="keywordflow">if</span> (!(timer = <a class="code" href="astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*timer), <a class="code" href="res__timing__timerfd_8c.html#a73f0f48df6dcb3b2ceb819665303335a">timer_destroy</a>))) {
<a name="l00101"></a>00101       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not allocate memory for timerfd_timer structure\n&quot;</span>);
<a name="l00102"></a>00102       <span class="keywordflow">return</span> -1;
<a name="l00103"></a>00103    }
<a name="l00104"></a>00104    <span class="keywordflow">if</span> ((handle = timerfd_create(CLOCK_MONOTONIC, 0)) &lt; 0) {
<a name="l00105"></a>00105       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to create timerfd timer: %s\n&quot;</span>, strerror(errno));
<a name="l00106"></a>00106       <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(timer, -1);
<a name="l00107"></a>00107       <span class="keywordflow">return</span> -1;
<a name="l00108"></a>00108    }
<a name="l00109"></a>00109 
<a name="l00110"></a>00110    timer-&gt;<a class="code" href="structtimerfd__timer.html#a3127ebf018e9da62fa464d348352037d">handle</a> = handle;
<a name="l00111"></a>00111    <a class="code" href="astobj2_8h.html#a210544bdcc5afe0601d01d6e529c22d8">ao2_link</a>(<a class="code" href="res__timing__timerfd_8c.html#adf3a17f66556a42c199df64d980f8745">timerfd_timers</a>, timer);
<a name="l00112"></a>00112    <span class="comment">/* Get rid of the reference from the allocation */</span>
<a name="l00113"></a>00113    <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(timer, -1);
<a name="l00114"></a>00114    <span class="keywordflow">return</span> handle;
<a name="l00115"></a>00115 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a187959b4a84132dd2558c8911ede66a2"></a><!-- doxytag: member="res_timing_timerfd.c::timerfd_timer_set_rate" ref="a187959b4a84132dd2558c8911ede66a2" args="(int handle, unsigned int rate)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int timerfd_timer_set_rate </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>rate</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__timing__timerfd_8c_source.html#l00132">132</a> of file <a class="el" href="res__timing__timerfd_8c_source.html">res_timing_timerfd.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00968">ao2_find</a>, <a class="el" href="astobj2_8h_source.html#l00459">ao2_ref</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="res__timing__timerfd_8c_source.html#l00073">timerfd_timer::is_continuous</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="astobj2_8h_source.html#l00678">OBJ_POINTER</a>, and <a class="el" href="res__timing__timerfd_8c_source.html#l00072">timerfd_timer::saved_timer</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00133"></a>00133 {
<a name="l00134"></a>00134    <span class="keyword">struct </span><a class="code" href="structtimerfd__timer.html">timerfd_timer</a> *our_timer, find_helper = {
<a name="l00135"></a>00135       .handle = <a class="code" href="structtimerfd__timer.html#a3127ebf018e9da62fa464d348352037d">handle</a>,
<a name="l00136"></a>00136    };
<a name="l00137"></a>00137    <span class="keywordtype">int</span> res = 0;
<a name="l00138"></a>00138 
<a name="l00139"></a>00139    <span class="keywordflow">if</span> (!(our_timer = <a class="code" href="astobj2_8h.html#a618587b42226725315b96db394b13673">ao2_find</a>(<a class="code" href="res__timing__timerfd_8c.html#adf3a17f66556a42c199df64d980f8745">timerfd_timers</a>, &amp;find_helper, <a class="code" href="astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca32d49976aaebc093266f0b080f9c9a73">OBJ_POINTER</a>))) {
<a name="l00140"></a>00140       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Couldn&apos;t find timer with handle %d\n&quot;</span>, <a class="code" href="structtimerfd__timer.html#a3127ebf018e9da62fa464d348352037d">handle</a>);
<a name="l00141"></a>00141       <span class="keywordflow">return</span> -1;
<a name="l00142"></a>00142    }
<a name="l00143"></a>00143 
<a name="l00144"></a>00144    our_timer-&gt;<a class="code" href="structtimerfd__timer.html#ae4dffc3f6313e22f30b9f8bf960299f6">saved_timer</a>.it_value.tv_sec = 0;
<a name="l00145"></a>00145    our_timer-&gt;<a class="code" href="structtimerfd__timer.html#ae4dffc3f6313e22f30b9f8bf960299f6">saved_timer</a>.it_value.tv_nsec = rate ? (long) (1000000000 / rate) : 0L;
<a name="l00146"></a>00146    our_timer-&gt;<a class="code" href="structtimerfd__timer.html#ae4dffc3f6313e22f30b9f8bf960299f6">saved_timer</a>.it_interval.tv_sec = our_timer-&gt;<a class="code" href="structtimerfd__timer.html#ae4dffc3f6313e22f30b9f8bf960299f6">saved_timer</a>.it_value.tv_sec;
<a name="l00147"></a>00147    our_timer-&gt;<a class="code" href="structtimerfd__timer.html#ae4dffc3f6313e22f30b9f8bf960299f6">saved_timer</a>.it_interval.tv_nsec = our_timer-&gt;<a class="code" href="structtimerfd__timer.html#ae4dffc3f6313e22f30b9f8bf960299f6">saved_timer</a>.it_value.tv_nsec;
<a name="l00148"></a>00148 
<a name="l00149"></a>00149    <span class="keywordflow">if</span> (!our_timer-&gt;<a class="code" href="structtimerfd__timer.html#aad44f4b6b414402fa3acad0166b1b506">is_continuous</a>) {
<a name="l00150"></a>00150       res = timerfd_settime(<a class="code" href="structtimerfd__timer.html#a3127ebf018e9da62fa464d348352037d">handle</a>, 0, &amp;our_timer-&gt;<a class="code" href="structtimerfd__timer.html#ae4dffc3f6313e22f30b9f8bf960299f6">saved_timer</a>, NULL);
<a name="l00151"></a>00151    }
<a name="l00152"></a>00152 
<a name="l00153"></a>00153    <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(our_timer, -1);
<a name="l00154"></a>00154 
<a name="l00155"></a>00155    <span class="keywordflow">return</span> res;
<a name="l00156"></a>00156 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad09fa931f468002152a3cc2d5ce25eae"></a><!-- doxytag: member="res_timing_timerfd.c::unload_module" ref="ad09fa931f468002152a3cc2d5ce25eae" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int unload_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__timing__timerfd_8c_source.html#l00287">287</a> of file <a class="el" href="res__timing__timerfd_8c_source.html">res_timing_timerfd.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00459">ao2_ref</a>, <a class="el" href="timing_8c_source.html#l00101">ast_unregister_timing_interface()</a>, and <a class="el" href="res__timing__timerfd_8c_source.html#l00041">timing_funcs_handle</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00288"></a>00288 {
<a name="l00289"></a>00289    <span class="keywordtype">int</span> res;
<a name="l00290"></a>00290 
<a name="l00291"></a>00291    <span class="keywordflow">if</span> (!(res = <a class="code" href="timing_8h.html#a5959c36b6984c24360cf99aaef9b2677" title="Unregister a previously registered timing interface.">ast_unregister_timing_interface</a>(<a class="code" href="res__timing__timerfd_8c.html#ac5071f22a1a673d4f64d2d7b86a72846">timing_funcs_handle</a>))) {
<a name="l00292"></a>00292       <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(<a class="code" href="res__timing__timerfd_8c.html#adf3a17f66556a42c199df64d980f8745">timerfd_timers</a>, -1);
<a name="l00293"></a>00293       <a class="code" href="res__timing__timerfd_8c.html#adf3a17f66556a42c199df64d980f8745">timerfd_timers</a> = NULL;
<a name="l00294"></a>00294    }
<a name="l00295"></a>00295 
<a name="l00296"></a>00296    <span class="keywordflow">return</span> res;
<a name="l00297"></a>00297 }
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="ab22f32016155f7f403e7178767163d7d"></a><!-- doxytag: member="res_timing_timerfd.c::__mod_info" ref="ab22f32016155f7f403e7178767163d7d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__module__info.html">ast_module_info</a> <a class="el" href="res__timing__timerfd_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a> = { .<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = AST_MODULE, .flags = AST_MODFLAG_LOAD_ORDER , .<a class="el" href="callerid_8c.html#a68344fa88cf4e86b5079fd69a5c22d57">description</a> = &quot;Timerfd Timing Interface&quot; , .key = &quot;This paragraph is copyright (c) 2006 by Digium, Inc. \In order for your module to load, it must return this \key via a function called \&quot;key\&quot;. Any code which \includes this paragraph must be licensed under the GNU \General Public License <a class="el" href="res__config__pgsql_8c.html#aad880fc4455c253781e8968f2239d56f">version</a> 2 or later (at your \option). In addition to Digium's general reservations \of rights, Digium expressly reserves the right to \allow other parties to license this paragraph under \different terms. Any use of Digium, Inc. trademarks or \logos (including \&quot;Asterisk\&quot; or \&quot;Digium\&quot;) without \express written <a class="el" href="structpermission.html">permission</a> of Digium, Inc. is prohibited.\n&quot; , .buildopt_sum = &quot;aefddfaffd51bc118c14a748e96eb9a0&quot; , .load = load_module, .unload = unload_module, .load_pri = 10, }<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__timing__timerfd_8c_source.html#l00303">303</a> of file <a class="el" href="res__timing__timerfd_8c_source.html">res_timing_timerfd.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae25b9f3970870610911f8850897e8ead"></a><!-- doxytag: member="res_timing_timerfd.c::ast_module_info" ref="ae25b9f3970870610911f8850897e8ead" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__module__info.html">ast_module_info</a>* <a class="el" href="structast__module__info.html">ast_module_info</a> = &amp;<a class="el" href="res__timing__timerfd_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__timing__timerfd_8c_source.html#l00303">303</a> of file <a class="el" href="res__timing__timerfd_8c_source.html">res_timing_timerfd.c</a>.</p>

</div>
</div>
<a class="anchor" id="adf3a17f66556a42c199df64d980f8745"></a><!-- doxytag: member="res_timing_timerfd.c::timerfd_timers" ref="adf3a17f66556a42c199df64d980f8745" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structao2__container.html">ao2_container</a>* <a class="el" href="res__timing__timerfd_8c.html#adf3a17f66556a42c199df64d980f8745">timerfd_timers</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__timing__timerfd_8c_source.html#l00065">65</a> of file <a class="el" href="res__timing__timerfd_8c_source.html">res_timing_timerfd.c</a>.</p>

</div>
</div>
<a class="anchor" id="a1479b98c6cb668f64c6f98881e30b824"></a><!-- doxytag: member="res_timing_timerfd.c::timerfd_timing" ref="a1479b98c6cb668f64c6f98881e30b824" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__timing__interface.html">ast_timing_interface</a> <a class="el" href="res__timing__timerfd_8c.html#a1479b98c6cb668f64c6f98881e30b824">timerfd_timing</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__timing__timerfd_8c_source.html#l00052">52</a> of file <a class="el" href="res__timing__timerfd_8c_source.html">res_timing_timerfd.c</a>.</p>

</div>
</div>
<a class="anchor" id="ac5071f22a1a673d4f64d2d7b86a72846"></a><!-- doxytag: member="res_timing_timerfd.c::timing_funcs_handle" ref="ac5071f22a1a673d4f64d2d7b86a72846" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* <a class="el" href="res__timing__timerfd_8c.html#ac5071f22a1a673d4f64d2d7b86a72846">timing_funcs_handle</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__timing__timerfd_8c_source.html#l00041">41</a> of file <a class="el" href="res__timing__timerfd_8c_source.html">res_timing_timerfd.c</a>.</p>

<p>Referenced by <a class="el" href="res__timing__timerfd_8c_source.html#l00263">load_module()</a>, and <a class="el" href="res__timing__timerfd_8c_source.html#l00287">unload_module()</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:23:18 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
