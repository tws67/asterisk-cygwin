<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:22:08 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_1ab815038f534adda65c8b4ae4993449.html">include</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_16d825f1fa9ecca2e70b1a8d9256d0e6.html">asterisk</a>
  </div>
</div>
<div class="contents">
<h1>fskmodem_int.h File Reference</h1>
<p>FSK Modem Support.  
<a href="#_details">More...</a></p>

<p><a href="fskmodem__int_8h_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfilter__struct.html">filter_struct</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfsk__data.html">fsk_data</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="fskmodem__int_8h.html#aecc3ef15571d35abf273bc8656c0e58b">NCOLA</a>&nbsp;&nbsp;&nbsp;0x4000</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="fskmodem__int_8h.html#a64de75e13d62a653f2a2b5c41e0374c2">PARITY_EVEN</a>&nbsp;&nbsp;&nbsp;1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="fskmodem__int_8h.html#a8342f22c7fd72713629efcf411a0d04b">PARITY_NONE</a>&nbsp;&nbsp;&nbsp;0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="fskmodem__int_8h.html#a25e17ce6ba7124885e170c47bcd833e5">PARITY_ODD</a>&nbsp;&nbsp;&nbsp;2</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="fskmodem__int_8h.html#a6315165519388f15eccffd8103769ee3">fsk_serial</a> (<a class="el" href="structfsk__data.html">fsk_data</a> *fskd, short *buffer, int *len, int *outbyte)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="fskmodem__int_8h.html#a183afaf79ee92e26e8aacd129d9be3cb">fskmodem_init</a> (<a class="el" href="structfsk__data.html">fsk_data</a> *fskd)</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>FSK Modem Support. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>Includes code and algorithms from the Zapata library. </dd></dl>

<p>Definition in file <a class="el" href="fskmodem__int_8h_source.html">fskmodem_int.h</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="aecc3ef15571d35abf273bc8656c0e58b"></a><!-- doxytag: member="fskmodem_int.h::NCOLA" ref="aecc3ef15571d35abf273bc8656c0e58b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NCOLA&nbsp;&nbsp;&nbsp;0x4000</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fskmodem__int_8h_source.html#l00032">32</a> of file <a class="el" href="fskmodem__int_8h_source.html">fskmodem_int.h</a>.</p>

</div>
</div>
<a class="anchor" id="a64de75e13d62a653f2a2b5c41e0374c2"></a><!-- doxytag: member="fskmodem_int.h::PARITY_EVEN" ref="a64de75e13d62a653f2a2b5c41e0374c2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PARITY_EVEN&nbsp;&nbsp;&nbsp;1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fskmodem__int_8h_source.html#l00028">28</a> of file <a class="el" href="fskmodem__int_8h_source.html">fskmodem_int.h</a>.</p>

</div>
</div>
<a class="anchor" id="a8342f22c7fd72713629efcf411a0d04b"></a><!-- doxytag: member="fskmodem_int.h::PARITY_NONE" ref="a8342f22c7fd72713629efcf411a0d04b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PARITY_NONE&nbsp;&nbsp;&nbsp;0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fskmodem__int_8h_source.html#l00027">27</a> of file <a class="el" href="fskmodem__int_8h_source.html">fskmodem_int.h</a>.</p>

</div>
</div>
<a class="anchor" id="a25e17ce6ba7124885e170c47bcd833e5"></a><!-- doxytag: member="fskmodem_int.h::PARITY_ODD" ref="a25e17ce6ba7124885e170c47bcd833e5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PARITY_ODD&nbsp;&nbsp;&nbsp;2</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fskmodem__int_8h_source.html#l00029">29</a> of file <a class="el" href="fskmodem__int_8h_source.html">fskmodem_int.h</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a6315165519388f15eccffd8103769ee3"></a><!-- doxytag: member="fskmodem_int.h::fsk_serial" ref="a6315165519388f15eccffd8103769ee3" args="(fsk_data *fskd, short *buffer, int *len, int *outbyte)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fsk_serial </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfsk__data.html">fsk_data</a> *&nbsp;</td>
          <td class="paramname"> <em>fskd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">short *&nbsp;</td>
          <td class="paramname"> <em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>outbyte</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fskmodem__float_8c_source.html#l00222">222</a> of file <a class="el" href="fskmodem__float_8c_source.html">fskmodem_float.c</a>.</p>

<p>References <a class="el" href="fskmodem__float_8c_source.html#l00167">demodulator()</a>, <a class="el" href="fskmodem__float_8c_source.html#l00187">get_bit_raw()</a>, <a class="el" href="fskmodem__float_8c_source.html#l00058">GET_SAMPLE</a>, <a class="el" href="fskmodem__int_8c_source.html#l00147">idemodulator()</a>, <a class="el" href="fskmodem__int_8c_source.html#l00056">IGET_SAMPLE</a>, <a class="el" href="fskmodem__int_8h_source.html#l00046">fsk_data::instop</a>, <a class="el" href="fskmodem__int_8h_source.html#l00052">fsk_data::ispb</a>, <a class="el" href="fskmodem__float_8h_source.html#l00036">fsk_data::nbit</a>, <a class="el" href="fskmodem__float_8h_source.html#l00037">fsk_data::nstop</a>, <a class="el" href="fskmodem__float_8h_source.html#l00038">fsk_data::parity</a>, <a class="el" href="frame_8h_source.html#l00149">ast_frame::samples</a>, <a class="el" href="fskmodem__float_8h_source.html#l00035">fsk_data::spb</a>, <a class="el" href="fskmodem__float_8h_source.html#l00053">fsk_data::state</a>, <a class="el" href="fskmodem__float_8c_source.html#l00047">STATE_GET_BYTE</a>, <a class="el" href="fskmodem__float_8c_source.html#l00044">STATE_SEARCH_STARTBIT</a>, <a class="el" href="fskmodem__float_8c_source.html#l00045">STATE_SEARCH_STARTBIT2</a>, <a class="el" href="fskmodem__float_8c_source.html#l00046">STATE_SEARCH_STARTBIT3</a>, <a class="el" href="fskmodem__float_8h_source.html#l00041">fsk_data::x1</a>, <a class="el" href="fskmodem__float_8h_source.html#l00042">fsk_data::x2</a>, <a class="el" href="fskmodem__int_8h_source.html#l00049">fsk_data::xi1</a>, and <a class="el" href="fskmodem__int_8h_source.html#l00050">fsk_data::xi2</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00223"></a>00223 {
<a name="l00224"></a>00224    <span class="keywordtype">int</span> a;
<a name="l00225"></a>00225    <span class="keywordtype">int</span> i,j,n1,r;
<a name="l00226"></a>00226    <span class="keywordtype">int</span> <a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a> = 0;
<a name="l00227"></a>00227    <span class="keywordtype">int</span> olen;
<a name="l00228"></a>00228    <span class="keywordtype">int</span> beginlen=*<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>;
<a name="l00229"></a>00229    <span class="keywordtype">int</span> beginlenx;
<a name="l00230"></a>00230    
<a name="l00231"></a>00231    <span class="keywordflow">switch</span> (fskd-&gt;<a class="code" href="structfsk__data.html#a89f234133d3efe315836311cbf21c64b">state</a>) {
<a name="l00232"></a>00232       <span class="comment">/* Pick up where we left off */</span>
<a name="l00233"></a>00233    <span class="keywordflow">case</span> <a class="code" href="fskmodem__float_8c.html#a73b827225345cd87e7753e4ae25a9f72">STATE_SEARCH_STARTBIT2</a>:
<a name="l00234"></a>00234       <span class="keywordflow">goto</span> search_startbit2;
<a name="l00235"></a>00235    <span class="keywordflow">case</span> <a class="code" href="fskmodem__float_8c.html#ac42c12b21d2e64b559044e2580874bd2">STATE_SEARCH_STARTBIT3</a>:
<a name="l00236"></a>00236       <span class="keywordflow">goto</span> search_startbit3;
<a name="l00237"></a>00237    <span class="keywordflow">case</span> <a class="code" href="fskmodem__float_8c.html#a889d2a905c2b500ebb083998d1c179de">STATE_GET_BYTE</a>:
<a name="l00238"></a>00238       <span class="keywordflow">goto</span> getbyte;
<a name="l00239"></a>00239    }
<a name="l00240"></a>00240    <span class="comment">/* We await for start bit  */</span>
<a name="l00241"></a>00241    <span class="keywordflow">do</span> {
<a name="l00242"></a>00242       <span class="comment">/* this was jesus&apos;s nice, reasonable, working (at least with RTTY) code</span>
<a name="l00243"></a>00243 <span class="comment">      to look for the beginning of the start bit. Unfortunately, since TTY/TDD&apos;s</span>
<a name="l00244"></a>00244 <span class="comment">      just start sending a start bit with nothing preceding it at the beginning</span>
<a name="l00245"></a>00245 <span class="comment">      of a transmission (what a LOSING design), we cant do it this elegantly */</span>
<a name="l00246"></a>00246       <span class="comment">/*</span>
<a name="l00247"></a>00247 <span class="comment">      if (demodulator(zap,&amp;x1)) return(-1);</span>
<a name="l00248"></a>00248 <span class="comment">      for (;;) {</span>
<a name="l00249"></a>00249 <span class="comment">         if (demodulator(zap,&amp;x2)) return(-1);</span>
<a name="l00250"></a>00250 <span class="comment">         if (x1&gt;0 &amp;&amp; x2&lt;0) break;</span>
<a name="l00251"></a>00251 <span class="comment">         x1 = x2;</span>
<a name="l00252"></a>00252 <span class="comment">      }</span>
<a name="l00253"></a>00253 <span class="comment">      */</span>
<a name="l00254"></a>00254       <span class="comment">/* this is now the imprecise, losing, but functional code to detect the</span>
<a name="l00255"></a>00255 <span class="comment">      beginning of a start bit in the TDD sceanario. It just looks for sufficient</span>
<a name="l00256"></a>00256 <span class="comment">      level to maybe, perhaps, guess, maybe that its maybe the beginning of</span>
<a name="l00257"></a>00257 <span class="comment">      a start bit, perhaps. This whole thing stinks! */</span>
<a name="l00258"></a>00258       beginlenx=beginlen; <span class="comment">/* just to avoid unused war warnings */</span>
<a name="l00259"></a>00259       <span class="keywordflow">if</span> (<a class="code" href="fskmodem__float_8c.html#a663231b68cad35b4e59c61acf0cc973d">demodulator</a>(fskd, &amp;fskd-&gt;<a class="code" href="structfsk__data.html#a3389d8b95846602e8f94cc15f41e48e9">x1</a>, <a class="code" href="fskmodem__float_8c.html#a907b804ac5c526294ca1ea3e0467747b">GET_SAMPLE</a>))
<a name="l00260"></a>00260          <span class="keywordflow">return</span> -1;
<a name="l00261"></a>00261       samples++;
<a name="l00262"></a>00262       <span class="keywordflow">for</span> (;;) {
<a name="l00263"></a>00263 search_startbit2:       
<a name="l00264"></a>00264          <span class="keywordflow">if</span> (*<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> &lt;= 0) {
<a name="l00265"></a>00265             fskd-&gt;<a class="code" href="structfsk__data.html#a89f234133d3efe315836311cbf21c64b">state</a>  =  <a class="code" href="fskmodem__float_8c.html#a73b827225345cd87e7753e4ae25a9f72">STATE_SEARCH_STARTBIT2</a>;
<a name="l00266"></a>00266             <span class="keywordflow">return</span> 0;
<a name="l00267"></a>00267          }
<a name="l00268"></a>00268          samples++;
<a name="l00269"></a>00269          <span class="keywordflow">if</span> (<a class="code" href="fskmodem__float_8c.html#a663231b68cad35b4e59c61acf0cc973d">demodulator</a>(fskd, &amp;fskd-&gt;<a class="code" href="structfsk__data.html#a24d6ffb6e8780eef0c81cd97e3f4fdaf">x2</a>, <a class="code" href="fskmodem__float_8c.html#a907b804ac5c526294ca1ea3e0467747b">GET_SAMPLE</a>))
<a name="l00270"></a>00270             <span class="keywordflow">return</span>(-1);
<a name="l00271"></a>00271 <span class="preprocessor">#if 0</span>
<a name="l00272"></a>00272 <span class="preprocessor"></span>         printf(<span class="stringliteral">&quot;x2  =  %5.5f &quot;</span>, fskd-&gt;<a class="code" href="structfsk__data.html#a24d6ffb6e8780eef0c81cd97e3f4fdaf">x2</a>);
<a name="l00273"></a>00273 <span class="preprocessor">#endif         </span>
<a name="l00274"></a>00274 <span class="preprocessor"></span>         <span class="keywordflow">if</span> (fskd-&gt;<a class="code" href="structfsk__data.html#a24d6ffb6e8780eef0c81cd97e3f4fdaf">x2</a> &lt; -0.5)
<a name="l00275"></a>00275             <span class="keywordflow">break</span>; 
<a name="l00276"></a>00276       }
<a name="l00277"></a>00277 search_startbit3:       
<a name="l00278"></a>00278       <span class="comment">/* We await for 0.5 bits before using DPLL */</span>
<a name="l00279"></a>00279       i = fskd-&gt;<a class="code" href="structfsk__data.html#a47e2a2415d4ac2c2f1b3303b23dd35a6">spb</a>/2;
<a name="l00280"></a>00280       <span class="keywordflow">if</span> (*<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> &lt; i) {
<a name="l00281"></a>00281          fskd-&gt;<a class="code" href="structfsk__data.html#a89f234133d3efe315836311cbf21c64b">state</a> = <a class="code" href="fskmodem__float_8c.html#ac42c12b21d2e64b559044e2580874bd2">STATE_SEARCH_STARTBIT3</a>;
<a name="l00282"></a>00282          <span class="keywordflow">return</span> 0;
<a name="l00283"></a>00283       }
<a name="l00284"></a>00284       <span class="keywordflow">for</span> (; i&gt;0; i--) {
<a name="l00285"></a>00285          <span class="keywordflow">if</span> (<a class="code" href="fskmodem__float_8c.html#a663231b68cad35b4e59c61acf0cc973d">demodulator</a>(fskd, &amp;fskd-&gt;<a class="code" href="structfsk__data.html#a3389d8b95846602e8f94cc15f41e48e9">x1</a>, <a class="code" href="fskmodem__float_8c.html#a907b804ac5c526294ca1ea3e0467747b">GET_SAMPLE</a>))
<a name="l00286"></a>00286             <span class="keywordflow">return</span>(-1); 
<a name="l00287"></a>00287 <span class="preprocessor">#if 0</span>
<a name="l00288"></a>00288 <span class="preprocessor"></span>         printf(<span class="stringliteral">&quot;x1 = %5.5f &quot;</span>, fskd-&gt;<a class="code" href="structfsk__data.html#a3389d8b95846602e8f94cc15f41e48e9">x1</a>);
<a name="l00289"></a>00289 <span class="preprocessor">#endif         </span>
<a name="l00290"></a>00290 <span class="preprocessor"></span>         samples++;
<a name="l00291"></a>00291       }
<a name="l00292"></a>00292 
<a name="l00293"></a>00293       <span class="comment">/* x1 must be negative (start bit confirmation) */</span>
<a name="l00294"></a>00294 
<a name="l00295"></a>00295    } <span class="keywordflow">while</span> (fskd-&gt;<a class="code" href="structfsk__data.html#a3389d8b95846602e8f94cc15f41e48e9">x1</a> &gt; 0);
<a name="l00296"></a>00296    fskd-&gt;<a class="code" href="structfsk__data.html#a89f234133d3efe315836311cbf21c64b">state</a> = <a class="code" href="fskmodem__float_8c.html#a889d2a905c2b500ebb083998d1c179de">STATE_GET_BYTE</a>;
<a name="l00297"></a>00297 
<a name="l00298"></a>00298 getbyte:
<a name="l00299"></a>00299 
<a name="l00300"></a>00300    <span class="comment">/* Need at least 80 samples (for 1200) or</span>
<a name="l00301"></a>00301 <span class="comment">      1320 (for 45.5) to be sure we&apos;ll have a byte */</span>
<a name="l00302"></a>00302    <span class="keywordflow">if</span> (fskd-&gt;<a class="code" href="structfsk__data.html#abe6ea42d56bb6b1cf335146f0877d7a9">nbit</a> &lt; 8) {
<a name="l00303"></a>00303       <span class="keywordflow">if</span> (*<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> &lt; 1320)
<a name="l00304"></a>00304          <span class="keywordflow">return</span> 0;
<a name="l00305"></a>00305    } <span class="keywordflow">else</span> {
<a name="l00306"></a>00306       <span class="keywordflow">if</span> (*<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> &lt; 80)
<a name="l00307"></a>00307          <span class="keywordflow">return</span> 0;
<a name="l00308"></a>00308    }
<a name="l00309"></a>00309    <span class="comment">/* Now we read the data bits */</span>
<a name="l00310"></a>00310    j = fskd-&gt;<a class="code" href="structfsk__data.html#abe6ea42d56bb6b1cf335146f0877d7a9">nbit</a>;
<a name="l00311"></a>00311    <span class="keywordflow">for</span> (a = n1 = 0; j; j--) {
<a name="l00312"></a>00312       olen = *<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>;
<a name="l00313"></a>00313       i = <a class="code" href="fskmodem__float_8c.html#a352dc6016a3e45d7f3573d4cb08c1927">get_bit_raw</a>(fskd, buffer, <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>);
<a name="l00314"></a>00314       buffer += (olen - *<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>);
<a name="l00315"></a>00315       <span class="keywordflow">if</span> (i == -1)
<a name="l00316"></a>00316          <span class="keywordflow">return</span>(-1);
<a name="l00317"></a>00317       <span class="keywordflow">if</span> (i)
<a name="l00318"></a>00318          n1++;
<a name="l00319"></a>00319       a &gt;&gt;= 1;
<a name="l00320"></a>00320       a |= i;
<a name="l00321"></a>00321    }
<a name="l00322"></a>00322    j = 8-fskd-&gt;<a class="code" href="structfsk__data.html#abe6ea42d56bb6b1cf335146f0877d7a9">nbit</a>;
<a name="l00323"></a>00323    a &gt;&gt;= j;
<a name="l00324"></a>00324 
<a name="l00325"></a>00325    <span class="comment">/* We read parity bit (if exists) and check parity */</span>
<a name="l00326"></a>00326    <span class="keywordflow">if</span> (fskd-&gt;<a class="code" href="structfsk__data.html#a22c1e0c27cee34369adf919eed3e3aac">parity</a>) {
<a name="l00327"></a>00327       olen = *<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>;
<a name="l00328"></a>00328       i = <a class="code" href="fskmodem__float_8c.html#a352dc6016a3e45d7f3573d4cb08c1927">get_bit_raw</a>(fskd, buffer, <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>); 
<a name="l00329"></a>00329       buffer += (olen - *<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>);
<a name="l00330"></a>00330       <span class="keywordflow">if</span> (i == -1)
<a name="l00331"></a>00331          <span class="keywordflow">return</span>(-1);
<a name="l00332"></a>00332       <span class="keywordflow">if</span> (i)
<a name="l00333"></a>00333          n1++;
<a name="l00334"></a>00334       <span class="keywordflow">if</span> (fskd-&gt;<a class="code" href="structfsk__data.html#a22c1e0c27cee34369adf919eed3e3aac">parity</a> == 1) {   <span class="comment">/* parity=1 (even) */</span>
<a name="l00335"></a>00335          <span class="keywordflow">if</span> (n1&amp;1)
<a name="l00336"></a>00336             a |= 0x100;    <span class="comment">/* error */</span>
<a name="l00337"></a>00337       } <span class="keywordflow">else</span> {       <span class="comment">/* parity=2 (odd) */</span>
<a name="l00338"></a>00338          <span class="keywordflow">if</span> (!(n1&amp;1))
<a name="l00339"></a>00339             a |= 0x100; <span class="comment">/* error */</span>
<a name="l00340"></a>00340       }
<a name="l00341"></a>00341    }
<a name="l00342"></a>00342    
<a name="l00343"></a>00343    <span class="comment">/* We read STOP bits. All of them must be 1 */</span>
<a name="l00344"></a>00344    
<a name="l00345"></a>00345    <span class="keywordflow">for</span> (j = fskd-&gt;<a class="code" href="structfsk__data.html#a7161c14fc5f3607c82bc97762fca2262">nstop</a>;j;j--) {
<a name="l00346"></a>00346       r = <a class="code" href="fskmodem__float_8c.html#a352dc6016a3e45d7f3573d4cb08c1927">get_bit_raw</a>(fskd, buffer, <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>);
<a name="l00347"></a>00347       <span class="keywordflow">if</span> (r == -1)
<a name="l00348"></a>00348          <span class="keywordflow">return</span>(-1);
<a name="l00349"></a>00349       <span class="keywordflow">if</span> (!r)
<a name="l00350"></a>00350          a |= 0x200;
<a name="l00351"></a>00351    }
<a name="l00352"></a>00352 
<a name="l00353"></a>00353    <span class="comment">/* And finally we return  */</span>
<a name="l00354"></a>00354    <span class="comment">/* Bit 8 : Parity error */</span>
<a name="l00355"></a>00355    <span class="comment">/* Bit 9 : Framming error*/</span>
<a name="l00356"></a>00356 
<a name="l00357"></a>00357    *outbyte = a;
<a name="l00358"></a>00358    fskd-&gt;<a class="code" href="structfsk__data.html#a89f234133d3efe315836311cbf21c64b">state</a> = <a class="code" href="fskmodem__float_8c.html#a7ea6438b983b0c97d1e3316b97399f2c">STATE_SEARCH_STARTBIT</a>;
<a name="l00359"></a>00359    <span class="keywordflow">return</span> 1;
<a name="l00360"></a>00360 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a183afaf79ee92e26e8aacd129d9be3cb"></a><!-- doxytag: member="fskmodem_int.h::fskmodem_init" ref="a183afaf79ee92e26e8aacd129d9be3cb" args="(fsk_data *fskd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int fskmodem_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfsk__data.html">fsk_data</a> *&nbsp;</td>
          <td class="paramname"> <em>fskd</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="fskmodem__int_8c_source.html#l00193">193</a> of file <a class="el" href="fskmodem__int_8c_source.html">fskmodem_int.c</a>.</p>

<p>References <a class="el" href="fskmodem__float_8h_source.html#l00044">fsk_data::bw</a>, <a class="el" href="fskmodem__int_8h_source.html#l00065">fsk_data::demod_filter</a>, <a class="el" href="fskmodem__float_8h_source.html#l00051">fsk_data::f_mark_idx</a>, <a class="el" href="fskmodem__float_8h_source.html#l00052">fsk_data::f_space_idx</a>, <a class="el" href="fskmodem__int_8h_source.html#l00037">filter_struct::icoefs</a>, <a class="el" href="fskmodem__int_8h_source.html#l00038">filter_struct::ip</a>, <a class="el" href="fskmodem__int_8h_source.html#l00039">filter_struct::ixv</a>, <a class="el" href="fskmodem__int_8h_source.html#l00040">filter_struct::iyv</a>, <a class="el" href="fskmodem__int_8h_source.html#l00063">fsk_data::mark_filter</a>, and <a class="el" href="fskmodem__int_8h_source.html#l00064">fsk_data::space_filter</a>.</p>

<p>Referenced by <a class="el" href="callerid_8c_source.html#l00126">callerid_new()</a>, and <a class="el" href="tdd_8c_source.html#l00098">tdd_new()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00194"></a>00194 {
<a name="l00195"></a>00195    <span class="keywordtype">int</span> i;
<a name="l00196"></a>00196 
<a name="l00197"></a>00197    fskd-&gt;<a class="code" href="structfsk__data.html#a4c5111991b250e57830d6e5bd21886be">space_filter</a>.<a class="code" href="structfilter__struct.html#addd335afdb9230f431842ebb6cbbce62">ip</a>  = 0;
<a name="l00198"></a>00198    fskd-&gt;<a class="code" href="structfsk__data.html#ac6f30ad8b853d7fcfd6ccb92e47cd62c">mark_filter</a>.<a class="code" href="structfilter__struct.html#addd335afdb9230f431842ebb6cbbce62">ip</a>   = 0;
<a name="l00199"></a>00199    fskd-&gt;<a class="code" href="structfsk__data.html#a47cfcf1cedd371f67f1f63a47b4bf2e4">demod_filter</a>.<a class="code" href="structfilter__struct.html#addd335afdb9230f431842ebb6cbbce62">ip</a>  = 0;
<a name="l00200"></a>00200 
<a name="l00201"></a>00201    <span class="keywordflow">for</span> ( i = 0 ; i &lt; 7 ; i++ ) {
<a name="l00202"></a>00202       fskd-&gt;<a class="code" href="structfsk__data.html#a4c5111991b250e57830d6e5bd21886be">space_filter</a>.<a class="code" href="structfilter__struct.html#a501f4a6891a674804e01264a71a58de2">icoefs</a>[i] = 
<a name="l00203"></a>00203          <a class="code" href="fskmodem__int_8c.html#abc7f57242aaf4ff6c9164dcdb585f625" title="Coefficients for input filters Coefficients table, generated by program &amp;quot;mkfilter&amp;quot;...">coef_in</a>[fskd-&gt;<a class="code" href="structfsk__data.html#aee1863152c02a253f722ffb0fda8251d">f_space_idx</a>][fskd-&gt;<a class="code" href="structfsk__data.html#a09f48e0ccba89e108e701fa07300d102">bw</a>][i] * 256;
<a name="l00204"></a>00204       fskd-&gt;<a class="code" href="structfsk__data.html#a4c5111991b250e57830d6e5bd21886be">space_filter</a>.<a class="code" href="structfilter__struct.html#a4158909966923d04b3ebbebcfe5cee01">ixv</a>[i] = 0;;
<a name="l00205"></a>00205       fskd-&gt;<a class="code" href="structfsk__data.html#a4c5111991b250e57830d6e5bd21886be">space_filter</a>.<a class="code" href="structfilter__struct.html#a3df5b5778a283cfe86f0c1739565e000">iyv</a>[i] = 0;;
<a name="l00206"></a>00206 
<a name="l00207"></a>00207       fskd-&gt;<a class="code" href="structfsk__data.html#ac6f30ad8b853d7fcfd6ccb92e47cd62c">mark_filter</a>.<a class="code" href="structfilter__struct.html#a501f4a6891a674804e01264a71a58de2">icoefs</a>[i] = 
<a name="l00208"></a>00208          <a class="code" href="fskmodem__int_8c.html#abc7f57242aaf4ff6c9164dcdb585f625" title="Coefficients for input filters Coefficients table, generated by program &amp;quot;mkfilter&amp;quot;...">coef_in</a>[fskd-&gt;<a class="code" href="structfsk__data.html#a55000e3ae1765fc3bcafb33740be41a9">f_mark_idx</a>][fskd-&gt;<a class="code" href="structfsk__data.html#a09f48e0ccba89e108e701fa07300d102">bw</a>][i] * 256;
<a name="l00209"></a>00209       fskd-&gt;<a class="code" href="structfsk__data.html#ac6f30ad8b853d7fcfd6ccb92e47cd62c">mark_filter</a>.<a class="code" href="structfilter__struct.html#a4158909966923d04b3ebbebcfe5cee01">ixv</a>[i] = 0;;
<a name="l00210"></a>00210       fskd-&gt;<a class="code" href="structfsk__data.html#ac6f30ad8b853d7fcfd6ccb92e47cd62c">mark_filter</a>.<a class="code" href="structfilter__struct.html#a3df5b5778a283cfe86f0c1739565e000">iyv</a>[i] = 0;;
<a name="l00211"></a>00211 
<a name="l00212"></a>00212       fskd-&gt;<a class="code" href="structfsk__data.html#a47cfcf1cedd371f67f1f63a47b4bf2e4">demod_filter</a>.<a class="code" href="structfilter__struct.html#a501f4a6891a674804e01264a71a58de2">icoefs</a>[i] = 
<a name="l00213"></a>00213          <a class="code" href="fskmodem__int_8c.html#ae0ab58005c92040e54824750d4b41768" title="Coefficients for output filter Coefficients table, generated by program &amp;quot;mkfilter&amp;quot;...">coef_out</a>[fskd-&gt;<a class="code" href="structfsk__data.html#a09f48e0ccba89e108e701fa07300d102">bw</a>][i] * 1024;
<a name="l00214"></a>00214       fskd-&gt;<a class="code" href="structfsk__data.html#a47cfcf1cedd371f67f1f63a47b4bf2e4">demod_filter</a>.<a class="code" href="structfilter__struct.html#a4158909966923d04b3ebbebcfe5cee01">ixv</a>[i] = 0;;
<a name="l00215"></a>00215       fskd-&gt;<a class="code" href="structfsk__data.html#a47cfcf1cedd371f67f1f63a47b4bf2e4">demod_filter</a>.<a class="code" href="structfilter__struct.html#a3df5b5778a283cfe86f0c1739565e000">iyv</a>[i] = 0;;
<a name="l00216"></a>00216    }
<a name="l00217"></a>00217    <span class="keywordflow">return</span> 0;
<a name="l00218"></a>00218 }
</pre></div></p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:22:08 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
