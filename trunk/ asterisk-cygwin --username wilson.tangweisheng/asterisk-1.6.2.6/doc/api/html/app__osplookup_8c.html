<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:19:03 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_7739c4bd2a7c382676c2c912043775c7.html">apps</a>
  </div>
</div>
<div class="contents">
<h1>app_osplookup.c File Reference</h1>
<p>Open Settlement Protocol (OSP) Applications.  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="asterisk_8h_source.html">asterisk.h</a>&quot;</code><br/>
<code>#include &lt;osp/osp.h&gt;</code><br/>
<code>#include &lt;osp/osputils.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="paths_8h_source.html">asterisk/paths.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="lock_8h_source.html">asterisk/lock.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="config_8h_source.html">asterisk/config.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="utils_8h_source.html">asterisk/utils.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="causes_8h_source.html">asterisk/causes.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="channel_8h_source.html">asterisk/channel.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="app_8h_source.html">asterisk/app.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="module_8h_source.html">asterisk/module.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="pbx_8h_source.html">asterisk/pbx.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="cli_8h_source.html">asterisk/cli.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="astosp_8h_source.html">asterisk/astosp.h</a>&quot;</code><br/>

<p><a href="app__osplookup_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structosp__callid.html">osp_callid</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structosp__provider.html">osp_provider</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structosp__result.html">osp_result</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#ac0bbc59083ee029dacfb9ff39944545c">OSP_AUDIT_URL</a>&nbsp;&nbsp;&nbsp;((const char*)&quot;localhost&quot;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a25a1a9044e69c1b41d40f79d1216d4c3">OSP_CALLID_H323</a>&nbsp;&nbsp;&nbsp;((unsigned int)(1 &lt;&lt; 0))</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#aa8a82820ad56cd5eb4b6baa00cf6f68a">OSP_CALLID_IAX</a>&nbsp;&nbsp;&nbsp;((unsigned int)(1 &lt;&lt; 2))</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a5b374a60989e0a5e46b9e3d493e62533">OSP_CALLID_MAXNUM</a>&nbsp;&nbsp;&nbsp;((unsigned int)3)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a1725c43ee772f3901c2bd542f9582ee1">OSP_CALLID_SIP</a>&nbsp;&nbsp;&nbsp;((unsigned int)(1 &lt;&lt; 1))</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#adbc9aec0d1c7059d1b29858f4d43c30d">OSP_CALLID_UNDEFINED</a>&nbsp;&nbsp;&nbsp;((unsigned int)0)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a3f0d992c57ee30bdaf32796741f827a8">OSP_CONFIG_FILE</a>&nbsp;&nbsp;&nbsp;((const char*)&quot;osp.conf&quot;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#adb4205a9cf5fb9fb31cb22b73d685e02">OSP_CUSTOMER_ID</a>&nbsp;&nbsp;&nbsp;((const char*)&quot;&quot;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a6ac883183e1140c2f254abca99cae0a2">OSP_DEF_AUTHPOLICY</a>&nbsp;&nbsp;&nbsp;((enum <a class="el" href="app__osplookup_8c.html#a973bb7ee8e420cae3117b3d08d395fcb">osp_authpolicy</a>)OSP_AUTH_YES)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a34def455e4e0a05ad865940f8067b371">OSP_DEF_DESTINATIONS</a>&nbsp;&nbsp;&nbsp;((unsigned int)5)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a3bed836b5b31244a172edbd2349cc887">OSP_DEF_MAXCONNECTIONS</a>&nbsp;&nbsp;&nbsp;((unsigned int)20)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#ac9ea65ddfcb75c30bd9a976bb3ac61a7">OSP_DEF_PROTOCOL</a>&nbsp;&nbsp;&nbsp;OSP_PROT_SIP</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#af74db93429d82818224639f0097189b2">OSP_DEF_PROVIDER</a>&nbsp;&nbsp;&nbsp;((const char*)&quot;default&quot;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a95dd1b545000ce7fc31a6dd3b53d3d2d">OSP_DEF_RETRYDELAY</a>&nbsp;&nbsp;&nbsp;((unsigned int)0)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#ad36c654250d30dc9f04f066078652ffd">OSP_DEF_RETRYLIMIT</a>&nbsp;&nbsp;&nbsp;((unsigned int)2)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#aa216d244dea7f5d816cc35504c4390cc">OSP_DEF_TIMELIMIT</a>&nbsp;&nbsp;&nbsp;((unsigned int)0)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#af41fd1b7d5fe4fab7275c19e5be93faf">OSP_DEF_TIMEOUT</a>&nbsp;&nbsp;&nbsp;((unsigned int)500)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#ab886d2f17400b1c84a703f2a78703f71">OSP_DEVICE_ID</a>&nbsp;&nbsp;&nbsp;((const char*)&quot;&quot;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a953047f54a6cca10a1546c6a9170df38">OSP_GENERAL_CAT</a>&nbsp;&nbsp;&nbsp;((const char*)&quot;general&quot;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a70ba2ad1a2c176493519a8401688f4a4">OSP_HTTP_PERSISTENCE</a>&nbsp;&nbsp;&nbsp;((int)1)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a93893abbaa41d3b57d9aaf4499fc2e93">OSP_INTSTR_SIZE</a>&nbsp;&nbsp;&nbsp;((unsigned int)16)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a693603e5e4556641af06c8ebec1dffc5">OSP_INVALID_HANDLE</a>&nbsp;&nbsp;&nbsp;((int)-1)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#adb174b635395f4dfa6aa18c620860ee9">OSP_LOCAL_VALIDATION</a>&nbsp;&nbsp;&nbsp;((int)1)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a7e5aa3485d963d46940150952788067e">OSP_MAX_CERTS</a>&nbsp;&nbsp;&nbsp;((unsigned int)10)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#ada8f79f9966042ba75e3b87f9032341d">OSP_MAX_MAXCONNECTIONS</a>&nbsp;&nbsp;&nbsp;((unsigned int)1000)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#aed8af19a7b6dc236071e11d067d3222a">OSP_MAX_RETRYDELAY</a>&nbsp;&nbsp;&nbsp;((unsigned int)10)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a345b7fdd7075bffae65d67aaf300fcb9">OSP_MAX_RETRYLIMIT</a>&nbsp;&nbsp;&nbsp;((unsigned int)100)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#ac79664c1f67bbb4b4569b63f3221a037">OSP_MAX_SRVS</a>&nbsp;&nbsp;&nbsp;((unsigned int)10)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#ac7a3ff9d63c0e30ee94430056b2ac82c">OSP_MAX_TIMEOUT</a>&nbsp;&nbsp;&nbsp;((unsigned int)10000)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a5d5f1ef1746ee3004e581ffa21317f18">OSP_MIN_MAXCONNECTIONS</a>&nbsp;&nbsp;&nbsp;((unsigned int)1)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#aecc0ca5e6e73e6f92cc828c409801700">OSP_MIN_RETRYDELAY</a>&nbsp;&nbsp;&nbsp;((unsigned int)0)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a258abbda51de2390bf0185bbbd4040ca">OSP_MIN_RETRYLIMIT</a>&nbsp;&nbsp;&nbsp;((unsigned int)0)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a73d87c526fda549fef6b81a22da2090a">OSP_MIN_TIMEOUT</a>&nbsp;&nbsp;&nbsp;((unsigned int)200)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#ab83d2712bd3bfe3e2f3631f97307fd0c">OSP_NORSTR_SIZE</a>&nbsp;&nbsp;&nbsp;((unsigned int)256)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#aece924ab64f6f37fb6b01b24816ecf7d">OSP_PROT_H323</a>&nbsp;&nbsp;&nbsp;((char*)&quot;H323&quot;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a37c83ec0ffd2dadcd13ab875afa37025">OSP_PROT_IAX</a>&nbsp;&nbsp;&nbsp;((char*)&quot;IAX&quot;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a97ded2bda6516df25b260682ac8952d8">OSP_PROT_OTHER</a>&nbsp;&nbsp;&nbsp;((char*)&quot;OTHER&quot;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a2d59871d2b33932ab6cd5acca414c2dc">OSP_PROT_SIP</a>&nbsp;&nbsp;&nbsp;((char*)&quot;SIP&quot;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a93310672c1358e732400908dc7a11ffd">OSP_SIP_HEADER</a>&nbsp;&nbsp;&nbsp;((char*)&quot;P-OSP-Auth-Token: &quot;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#aa3e4c2f6886beeb3167baea11338365b">OSP_SSL_LIFETIME</a>&nbsp;&nbsp;&nbsp;((unsigned int)300)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a232b5abec331065cc0ab6381c5ac5ea1">OSP_TECH_H323</a>&nbsp;&nbsp;&nbsp;((char*)&quot;H323&quot;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#ab00665d0be85f5bdb470e104eb3659b4">OSP_TECH_IAX</a>&nbsp;&nbsp;&nbsp;((char*)&quot;IAX2&quot;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a3bb2e8490ca2aae2ef00dd0666a0d637">OSP_TECH_SIP</a>&nbsp;&nbsp;&nbsp;((char*)&quot;SIP&quot;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a12925f86405ccd7518a12b4828d4c0d3">OSP_TECHSTR_SIZE</a>&nbsp;&nbsp;&nbsp;((unsigned int)32)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a6d56e8f42ac71c7e7cebd6d4e0aa6f78">OSP_TOKSTR_SIZE</a>&nbsp;&nbsp;&nbsp;((unsigned int)4096)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a313b6d61db7200ce2361164899971931">OSP_UUID_SIZE</a>&nbsp;&nbsp;&nbsp;((unsigned int)16)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a6a64dee4ca45cb275f994bfcd9ff7a01">OSP_UUIDSTR_SIZE</a>&nbsp;&nbsp;&nbsp;((unsigned int)36)</td></tr>
<tr><td colspan="2"><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a973bb7ee8e420cae3117b3d08d395fcb">osp_authpolicy</a> { <a class="el" href="app__osplookup_8c.html#a973bb7ee8e420cae3117b3d08d395fcbabdd97707a7a03ac645574bd924a77685">OSP_AUTH_NO</a>, 
<a class="el" href="app__osplookup_8c.html#a973bb7ee8e420cae3117b3d08d395fcba0d4b098bf4a527dd729e74819bb52b9c">OSP_AUTH_YES</a>, 
<a class="el" href="app__osplookup_8c.html#a973bb7ee8e420cae3117b3d08d395fcba85ba776173c4770738603da1a8c2cebc">OSP_AUTH_EXCLUSIVE</a>
 }</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#acf28e932014bd92c82c69ebbfca6921b">AST_MODULE_INFO</a> (ASTERISK_GPL_KEY, AST_MODFLAG_DEFAULT,&quot;Open Settlement Protocol Applications&quot;,.load=load_module,.unload=unload_module,.reload=reload,)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#abc5bac8644a07acc2c9fef322e8a0151">AST_MUTEX_DEFINE_STATIC</a> (osplock)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static OSPEFAILREASON&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#af51938903a4cc1d253bfbf03b2a70d90">asterisk2osp</a> (int <a class="el" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Convert Asterisk status to TC code.  <a href="#af51938903a4cc1d253bfbf03b2a70d90"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a8c819d70b0fbac62fc53d35fb9918ffd">handle_cli_osp_show</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#accd86e4e5ad2335945459345e2052161">osp_auth</a> (const char *provider, int *transaction, const char *source, const char *calling, const char *called, const char *token, unsigned int *timelimit)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">OSP Authentication function.  <a href="#accd86e4e5ad2335945459345e2052161"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#ab1f3dd789f1e830e5e53204fe908a9d9">osp_check_destination</a> (struct <a class="el" href="structosp__provider.html">osp_provider</a> *provider, const char *called, const char *calling, char *destination, unsigned int tokenlen, const char *token, OSPEFAILREASON *reason, struct <a class="el" href="structosp__result.html">osp_result</a> *result)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Choose min duration limit.  <a href="#ab1f3dd789f1e830e5e53204fe908a9d9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#acad1656c35ed21d307a509194041383e">osp_choose_timelimit</a> (unsigned int in, unsigned int out)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Choose min duration limit.  <a href="#acad1656c35ed21d307a509194041383e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#aa919e8f63ad9ab313b720151246ecc33">osp_convert_address</a> (const char *src, char *dst, int buffersize)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Convert address to "[x.x.x.x]" or "host.domain" format.  <a href="#aa919e8f63ad9ab313b720151246ecc33"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#ae9f5a73f76d19b25d7666d4a3517d64a">osp_create_callid</a> (unsigned int <a class="el" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>, struct <a class="el" href="structosp__callid.html">osp_callid</a> *callid)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create a call ID according to the type.  <a href="#ae9f5a73f76d19b25d7666d4a3517d64a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#aec25444bf96fbb06219720b4403cb60b">osp_create_provider</a> (struct <a class="el" href="structast__config.html">ast_config</a> *cfg, const char *provider)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create OSP provider handle according to configuration.  <a href="#aec25444bf96fbb06219720b4403cb60b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#aec704b16f5e3d6367e23b9cb3555d87a">osp_create_transaction</a> (const char *provider, int *transaction, unsigned int sourcesize, char *source)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create OSP transaction handle.  <a href="#aec704b16f5e3d6367e23b9cb3555d87a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a0eae4255384c0a3e0bc770a4ed6cddaa">osp_create_uuid</a> (unsigned char *uuid, unsigned int *buffersize)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create a UUID.  <a href="#a0eae4255384c0a3e0bc770a4ed6cddaa"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a88030927dfd5fa77661b8368cd6089e2">osp_finish</a> (int handle, int recorded, int <a class="el" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a>, time_t start, time_t connect, time_t end, unsigned int release)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">OSP Finish function.  <a href="#a88030927dfd5fa77661b8368cd6089e2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#af21fa85fa457a1235efc74c9e8d51bbb">osp_get_provider</a> (const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, struct <a class="el" href="structosp__provider.html">osp_provider</a> **provider)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get OSP provider by name.  <a href="#af21fa85fa457a1235efc74c9e8d51bbb"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#abbf1e551f818049bd8744a6ece49a5ba">osp_load</a> (int reload)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#ab6ffa47e432ada0aa3bab8796cb7a574">osp_lookup</a> (const char *provider, const char *srcdev, const char *calling, const char *called, unsigned int callidtypes, struct <a class="el" href="structosp__result.html">osp_result</a> *result)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">OSP Lookup function.  <a href="#ab6ffa47e432ada0aa3bab8796cb7a574"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#ad3c73a7443561060d02520615232ff9e">osp_next</a> (const char *provider, int <a class="el" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a>, struct <a class="el" href="structosp__result.html">osp_result</a> *result)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">OSP Lookup Next function.  <a href="#ad3c73a7443561060d02520615232ff9e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#aeaa07e9dab5c74f1438507a11962f9f4">osp_unload</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a2c7d2c2719f4021ede8420272bf5201d">osp_uuid2str</a> (unsigned char *uuid, char *buffer, unsigned int buffersize)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">UUID to string.  <a href="#a2c7d2c2719f4021ede8420272bf5201d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a435ee8a469fe74baa978a41ed722bc25">osp_validate_token</a> (int transaction, const char *source, const char *destination, const char *calling, const char *called, const char *token, unsigned int *timelimit)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Validate OSP token of inbound call.  <a href="#a435ee8a469fe74baa978a41ed722bc25"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a30e6f7b8ac96cab586c505f27a05c023">ospauth_exec</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, void *data)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">OSP Application OSPAuth.  <a href="#a30e6f7b8ac96cab586c505f27a05c023"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a010b3b9e4bae42c2d0d0c751295121bc">ospfinished_exec</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, void *data)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">OSP Application OSPFinish.  <a href="#a010b3b9e4bae42c2d0d0c751295121bc"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a4122506208193e0aa12724e0d8b39881">osplookup_exec</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, void *data)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">OSP Application OSPLookup.  <a href="#a4122506208193e0aa12724e0d8b39881"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a4dd57c9ab4ad09fd37eab55f2ed6859f">ospnext_exec</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, void *data)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">OSP Application OSPNext.  <a href="#a4dd57c9ab4ad09fd37eab55f2ed6859f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a> (void)</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#aee1c6fdb192d3bc745c949458f7de522">app1</a> = &quot;OSPAuth&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a226108d015a7b45044c5f4eb82ffaa1b">app2</a> = &quot;OSPLookup&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a3044a87a73ac4a63321105ddc9a77692">app3</a> = &quot;OSPNext&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a2f57c1b7cebdefada90f4dac8fd00fa6">app4</a> = &quot;OSPFinish&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a10d006ccda399620ddcbdac150680853">cli_osp</a> []</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a2691a482b4359db931cef4398d6f28ee">descrip1</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a1ab5c89130218223dca8d1f8b57fb218">descrip2</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a6a21c282600021fc9e5ca8fef5e2b18f">descrip3</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a2f7cb7b9188e1a2057a81e18292910e4">descrip4</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a5ef0958fa463ae932e3e71ec39cd1337">osp_hardware</a> = 0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a7b65a944814a9fe8b45330072c875e46">osp_initialized</a> = 0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static unsigned int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#ab918a4031e5d25153fe54e91be1ac56e">osp_tokenformat</a> = TOKEN_ALGO_SIGNED</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structosp__provider.html">osp_provider</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#ac9590e73571584ed17bed31f03b87900">ospproviders</a> = NULL</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#ac303a7fc87983f994599152c93f791ae">synopsis1</a> = &quot;OSP authentication&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a6c27de8205a98c27461ee7eeb69dd48a">synopsis2</a> = &quot;Lookup destination by OSP&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a6bb971d5c56ec38f85ed6e9c0ff60d42">synopsis3</a> = &quot;Lookup next destination by OSP&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__osplookup_8c.html#a9264bf933a240e13b35ae894365fe13c">synopsis4</a> = &quot;Record OSP entry&quot;</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Open Settlement Protocol (OSP) Applications. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Mark Spencer &lt;<a href="mailto:markster@digium.com">markster@digium.com</a>&gt;</dd></dl>
<dl class="extref"><dt><b><a class="el" href="extref.html#_extref000003">ExtRef:</a></b></dt><dd>The OSP Toolkit: <a href="http://www.transnexus.com">http://www.transnexus.com</a> </dd></dl>
<dl class="extref"><dt><b><a class="el" href="extref.html#_extref000004">ExtRef:</a></b></dt><dd>OpenSSL <a href="http://www.openssl.org">http://www.openssl.org</a></dd></dl>

<p>Definition in file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="ac0bbc59083ee029dacfb9ff39944545c"></a><!-- doxytag: member="app_osplookup.c::OSP_AUDIT_URL" ref="ac0bbc59083ee029dacfb9ff39944545c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_AUDIT_URL&nbsp;&nbsp;&nbsp;((const char*)&quot;localhost&quot;)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00114">114</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00181">osp_create_provider()</a>.</p>

</div>
</div>
<a class="anchor" id="a25a1a9044e69c1b41d40f79d1216d4c3"></a><!-- doxytag: member="app_osplookup.c::OSP_CALLID_H323" ref="a25a1a9044e69c1b41d40f79d1216d4c3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_CALLID_H323&nbsp;&nbsp;&nbsp;((unsigned int)(1 &lt;&lt; 0))</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00072">72</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00819">osp_create_callid()</a>, <a class="el" href="app__osplookup_8c_source.html#l01335">osplookup_exec()</a>, and <a class="el" href="app__osplookup_8c_source.html#l01503">ospnext_exec()</a>.</p>

</div>
</div>
<a class="anchor" id="aa8a82820ad56cd5eb4b6baa00cf6f68a"></a><!-- doxytag: member="app_osplookup.c::OSP_CALLID_IAX" ref="aa8a82820ad56cd5eb4b6baa00cf6f68a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_CALLID_IAX&nbsp;&nbsp;&nbsp;((unsigned int)(1 &lt;&lt; 2))</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00074">74</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00819">osp_create_callid()</a>, and <a class="el" href="app__osplookup_8c_source.html#l01335">osplookup_exec()</a>.</p>

</div>
</div>
<a class="anchor" id="a5b374a60989e0a5e46b9e3d493e62533"></a><!-- doxytag: member="app_osplookup.c::OSP_CALLID_MAXNUM" ref="a5b374a60989e0a5e46b9e3d493e62533" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_CALLID_MAXNUM&nbsp;&nbsp;&nbsp;((unsigned int)3)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00075">75</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00856">osp_lookup()</a>.</p>

</div>
</div>
<a class="anchor" id="a1725c43ee772f3901c2bd542f9582ee1"></a><!-- doxytag: member="app_osplookup.c::OSP_CALLID_SIP" ref="a1725c43ee772f3901c2bd542f9582ee1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_CALLID_SIP&nbsp;&nbsp;&nbsp;((unsigned int)(1 &lt;&lt; 1))</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00073">73</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00819">osp_create_callid()</a>, and <a class="el" href="app__osplookup_8c_source.html#l01335">osplookup_exec()</a>.</p>

</div>
</div>
<a class="anchor" id="adbc9aec0d1c7059d1b29858f4d43c30d"></a><!-- doxytag: member="app_osplookup.c::OSP_CALLID_UNDEFINED" ref="adbc9aec0d1c7059d1b29858f4d43c30d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_CALLID_UNDEFINED&nbsp;&nbsp;&nbsp;((unsigned int)0)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00071">71</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l01335">osplookup_exec()</a>, and <a class="el" href="app__osplookup_8c_source.html#l01503">ospnext_exec()</a>.</p>

</div>
</div>
<a class="anchor" id="a3f0d992c57ee30bdaf32796741f827a8"></a><!-- doxytag: member="app_osplookup.c::OSP_CONFIG_FILE" ref="a3f0d992c57ee30bdaf32796741f827a8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_CONFIG_FILE&nbsp;&nbsp;&nbsp;((const char*)&quot;osp.conf&quot;)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00096">96</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l01772">osp_load()</a>.</p>

</div>
</div>
<a class="anchor" id="adb4205a9cf5fb9fb31cb22b73d685e02"></a><!-- doxytag: member="app_osplookup.c::OSP_CUSTOMER_ID" ref="adb4205a9cf5fb9fb31cb22b73d685e02" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_CUSTOMER_ID&nbsp;&nbsp;&nbsp;((const char*)&quot;&quot;)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00118">118</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00181">osp_create_provider()</a>.</p>

</div>
</div>
<a class="anchor" id="a6ac883183e1140c2f254abca99cae0a2"></a><!-- doxytag: member="app_osplookup.c::OSP_DEF_AUTHPOLICY" ref="a6ac883183e1140c2f254abca99cae0a2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_DEF_AUTHPOLICY&nbsp;&nbsp;&nbsp;((enum <a class="el" href="app__osplookup_8c.html#a973bb7ee8e420cae3117b3d08d395fcb">osp_authpolicy</a>)OSP_AUTH_YES)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00113">113</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00181">osp_create_provider()</a>.</p>

</div>
</div>
<a class="anchor" id="a34def455e4e0a05ad865940f8067b371"></a><!-- doxytag: member="app_osplookup.c::OSP_DEF_DESTINATIONS" ref="a34def455e4e0a05ad865940f8067b371" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_DEF_DESTINATIONS&nbsp;&nbsp;&nbsp;((unsigned int)5)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00120">120</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00856">osp_lookup()</a>.</p>

</div>
</div>
<a class="anchor" id="a3bed836b5b31244a172edbd2349cc887"></a><!-- doxytag: member="app_osplookup.c::OSP_DEF_MAXCONNECTIONS" ref="a3bed836b5b31244a172edbd2349cc887" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_DEF_MAXCONNECTIONS&nbsp;&nbsp;&nbsp;((unsigned int)20)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00101">101</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00181">osp_create_provider()</a>.</p>

</div>
</div>
<a class="anchor" id="ac9ea65ddfcb75c30bd9a976bb3ac61a7"></a><!-- doxytag: member="app_osplookup.c::OSP_DEF_PROTOCOL" ref="ac9ea65ddfcb75c30bd9a976bb3ac61a7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_DEF_PROTOCOL&nbsp;&nbsp;&nbsp;OSP_PROT_SIP</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00122">122</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00181">osp_create_provider()</a>.</p>

</div>
</div>
<a class="anchor" id="af74db93429d82818224639f0097189b2"></a><!-- doxytag: member="app_osplookup.c::OSP_DEF_PROVIDER" ref="af74db93429d82818224639f0097189b2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_DEF_PROVIDER&nbsp;&nbsp;&nbsp;((const char*)&quot;default&quot;)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00098">98</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l01255">ospauth_exec()</a>, <a class="el" href="app__osplookup_8c_source.html#l01335">osplookup_exec()</a>, and <a class="el" href="app__osplookup_8c_source.html#l01503">ospnext_exec()</a>.</p>

</div>
</div>
<a class="anchor" id="a95dd1b545000ce7fc31a6dd3b53d3d2d"></a><!-- doxytag: member="app_osplookup.c::OSP_DEF_RETRYDELAY" ref="a95dd1b545000ce7fc31a6dd3b53d3d2d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_DEF_RETRYDELAY&nbsp;&nbsp;&nbsp;((unsigned int)0)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00104">104</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00181">osp_create_provider()</a>.</p>

</div>
</div>
<a class="anchor" id="ad36c654250d30dc9f04f066078652ffd"></a><!-- doxytag: member="app_osplookup.c::OSP_DEF_RETRYLIMIT" ref="ad36c654250d30dc9f04f066078652ffd" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_DEF_RETRYLIMIT&nbsp;&nbsp;&nbsp;((unsigned int)2)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00107">107</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00181">osp_create_provider()</a>.</p>

</div>
</div>
<a class="anchor" id="aa216d244dea7f5d816cc35504c4390cc"></a><!-- doxytag: member="app_osplookup.c::OSP_DEF_TIMELIMIT" ref="aa216d244dea7f5d816cc35504c4390cc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_DEF_TIMELIMIT&nbsp;&nbsp;&nbsp;((unsigned int)0)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00121">121</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00707">osp_auth()</a>, <a class="el" href="app__osplookup_8c_source.html#l00566">osp_choose_timelimit()</a>, <a class="el" href="app__osplookup_8c_source.html#l00856">osp_lookup()</a>, <a class="el" href="app__osplookup_8c_source.html#l01074">osp_next()</a>, <a class="el" href="app__osplookup_8c_source.html#l01255">ospauth_exec()</a>, <a class="el" href="app__osplookup_8c_source.html#l01335">osplookup_exec()</a>, and <a class="el" href="app__osplookup_8c_source.html#l01503">ospnext_exec()</a>.</p>

</div>
</div>
<a class="anchor" id="af41fd1b7d5fe4fab7275c19e5be93faf"></a><!-- doxytag: member="app_osplookup.c::OSP_DEF_TIMEOUT" ref="af41fd1b7d5fe4fab7275c19e5be93faf" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_DEF_TIMEOUT&nbsp;&nbsp;&nbsp;((unsigned int)500)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00110">110</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00181">osp_create_provider()</a>.</p>

</div>
</div>
<a class="anchor" id="ab886d2f17400b1c84a703f2a78703f71"></a><!-- doxytag: member="app_osplookup.c::OSP_DEVICE_ID" ref="ab886d2f17400b1c84a703f2a78703f71" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_DEVICE_ID&nbsp;&nbsp;&nbsp;((const char*)&quot;&quot;)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00119">119</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00181">osp_create_provider()</a>.</p>

</div>
</div>
<a class="anchor" id="a953047f54a6cca10a1546c6a9170df38"></a><!-- doxytag: member="app_osplookup.c::OSP_GENERAL_CAT" ref="a953047f54a6cca10a1546c6a9170df38" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_GENERAL_CAT&nbsp;&nbsp;&nbsp;((const char*)&quot;general&quot;)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00097">97</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l01772">osp_load()</a>.</p>

</div>
</div>
<a class="anchor" id="a70ba2ad1a2c176493519a8401688f4a4"></a><!-- doxytag: member="app_osplookup.c::OSP_HTTP_PERSISTENCE" ref="a70ba2ad1a2c176493519a8401688f4a4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_HTTP_PERSISTENCE&nbsp;&nbsp;&nbsp;((int)1)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00117">117</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00181">osp_create_provider()</a>.</p>

</div>
</div>
<a class="anchor" id="a93893abbaa41d3b57d9aaf4499fc2e93"></a><!-- doxytag: member="app_osplookup.c::OSP_INTSTR_SIZE" ref="a93893abbaa41d3b57d9aaf4499fc2e93" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_INTSTR_SIZE&nbsp;&nbsp;&nbsp;((unsigned int)16)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00056">56</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l01255">ospauth_exec()</a>, and <a class="el" href="app__osplookup_8c_source.html#l01657">ospfinished_exec()</a>.</p>

</div>
</div>
<a class="anchor" id="a693603e5e4556641af06c8ebec1dffc5"></a><!-- doxytag: member="app_osplookup.c::OSP_INVALID_HANDLE" ref="a693603e5e4556641af06c8ebec1dffc5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_INVALID_HANDLE&nbsp;&nbsp;&nbsp;((int)-1)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00095">95</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00707">osp_auth()</a>, <a class="el" href="app__osplookup_8c_source.html#l00181">osp_create_provider()</a>, <a class="el" href="app__osplookup_8c_source.html#l00441">osp_create_transaction()</a>, <a class="el" href="app__osplookup_8c_source.html#l01192">osp_finish()</a>, <a class="el" href="app__osplookup_8c_source.html#l00856">osp_lookup()</a>, <a class="el" href="app__osplookup_8c_source.html#l01074">osp_next()</a>, <a class="el" href="app__osplookup_8c_source.html#l01657">ospfinished_exec()</a>, <a class="el" href="app__osplookup_8c_source.html#l01335">osplookup_exec()</a>, and <a class="el" href="app__osplookup_8c_source.html#l01503">ospnext_exec()</a>.</p>

</div>
</div>
<a class="anchor" id="adb174b635395f4dfa6aa18c620860ee9"></a><!-- doxytag: member="app_osplookup.c::OSP_LOCAL_VALIDATION" ref="adb174b635395f4dfa6aa18c620860ee9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_LOCAL_VALIDATION&nbsp;&nbsp;&nbsp;((int)1)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00115">115</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00181">osp_create_provider()</a>.</p>

</div>
</div>
<a class="anchor" id="a7e5aa3485d963d46940150952788067e"></a><!-- doxytag: member="app_osplookup.c::OSP_MAX_CERTS" ref="a7e5aa3485d963d46940150952788067e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_MAX_CERTS&nbsp;&nbsp;&nbsp;((unsigned int)10)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00099">99</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00181">osp_create_provider()</a>.</p>

</div>
</div>
<a class="anchor" id="ada8f79f9966042ba75e3b87f9032341d"></a><!-- doxytag: member="app_osplookup.c::OSP_MAX_MAXCONNECTIONS" ref="ada8f79f9966042ba75e3b87f9032341d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_MAX_MAXCONNECTIONS&nbsp;&nbsp;&nbsp;((unsigned int)1000)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00103">103</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00181">osp_create_provider()</a>.</p>

</div>
</div>
<a class="anchor" id="aed8af19a7b6dc236071e11d067d3222a"></a><!-- doxytag: member="app_osplookup.c::OSP_MAX_RETRYDELAY" ref="aed8af19a7b6dc236071e11d067d3222a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_MAX_RETRYDELAY&nbsp;&nbsp;&nbsp;((unsigned int)10)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00106">106</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00181">osp_create_provider()</a>.</p>

</div>
</div>
<a class="anchor" id="a345b7fdd7075bffae65d67aaf300fcb9"></a><!-- doxytag: member="app_osplookup.c::OSP_MAX_RETRYLIMIT" ref="a345b7fdd7075bffae65d67aaf300fcb9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_MAX_RETRYLIMIT&nbsp;&nbsp;&nbsp;((unsigned int)100)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00109">109</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00181">osp_create_provider()</a>.</p>

</div>
</div>
<a class="anchor" id="ac79664c1f67bbb4b4569b63f3221a037"></a><!-- doxytag: member="app_osplookup.c::OSP_MAX_SRVS" ref="ac79664c1f67bbb4b4569b63f3221a037" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_MAX_SRVS&nbsp;&nbsp;&nbsp;((unsigned int)10)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00100">100</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00181">osp_create_provider()</a>.</p>

</div>
</div>
<a class="anchor" id="ac7a3ff9d63c0e30ee94430056b2ac82c"></a><!-- doxytag: member="app_osplookup.c::OSP_MAX_TIMEOUT" ref="ac7a3ff9d63c0e30ee94430056b2ac82c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_MAX_TIMEOUT&nbsp;&nbsp;&nbsp;((unsigned int)10000)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00112">112</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00181">osp_create_provider()</a>.</p>

</div>
</div>
<a class="anchor" id="a5d5f1ef1746ee3004e581ffa21317f18"></a><!-- doxytag: member="app_osplookup.c::OSP_MIN_MAXCONNECTIONS" ref="a5d5f1ef1746ee3004e581ffa21317f18" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_MIN_MAXCONNECTIONS&nbsp;&nbsp;&nbsp;((unsigned int)1)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00102">102</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00181">osp_create_provider()</a>.</p>

</div>
</div>
<a class="anchor" id="aecc0ca5e6e73e6f92cc828c409801700"></a><!-- doxytag: member="app_osplookup.c::OSP_MIN_RETRYDELAY" ref="aecc0ca5e6e73e6f92cc828c409801700" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_MIN_RETRYDELAY&nbsp;&nbsp;&nbsp;((unsigned int)0)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00105">105</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00181">osp_create_provider()</a>.</p>

</div>
</div>
<a class="anchor" id="a258abbda51de2390bf0185bbbd4040ca"></a><!-- doxytag: member="app_osplookup.c::OSP_MIN_RETRYLIMIT" ref="a258abbda51de2390bf0185bbbd4040ca" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_MIN_RETRYLIMIT&nbsp;&nbsp;&nbsp;((unsigned int)0)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00108">108</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00181">osp_create_provider()</a>.</p>

</div>
</div>
<a class="anchor" id="a73d87c526fda549fef6b81a22da2090a"></a><!-- doxytag: member="app_osplookup.c::OSP_MIN_TIMEOUT" ref="a73d87c526fda549fef6b81a22da2090a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_MIN_TIMEOUT&nbsp;&nbsp;&nbsp;((unsigned int)200)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00111">111</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00181">osp_create_provider()</a>.</p>

</div>
</div>
<a class="anchor" id="ab83d2712bd3bfe3e2f3631f97307fd0c"></a><!-- doxytag: member="app_osplookup.c::OSP_NORSTR_SIZE" ref="ab83d2712bd3bfe3e2f3631f97307fd0c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_NORSTR_SIZE&nbsp;&nbsp;&nbsp;((unsigned int)256)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00057">57</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00707">osp_auth()</a>, <a class="el" href="app__osplookup_8c_source.html#l00856">osp_lookup()</a>, <a class="el" href="app__osplookup_8c_source.html#l01074">osp_next()</a>, and <a class="el" href="app__osplookup_8c_source.html#l00506">osp_validate_token()</a>.</p>

</div>
</div>
<a class="anchor" id="aece924ab64f6f37fb6b01b24816ecf7d"></a><!-- doxytag: member="app_osplookup.c::OSP_PROT_H323" ref="aece924ab64f6f37fb6b01b24816ecf7d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_PROT_H323&nbsp;&nbsp;&nbsp;((char*)&quot;H323&quot;)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00078">78</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00591">osp_check_destination()</a>, and <a class="el" href="app__osplookup_8c_source.html#l00181">osp_create_provider()</a>.</p>

</div>
</div>
<a class="anchor" id="a37c83ec0ffd2dadcd13ab875afa37025"></a><!-- doxytag: member="app_osplookup.c::OSP_PROT_IAX" ref="a37c83ec0ffd2dadcd13ab875afa37025" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_PROT_IAX&nbsp;&nbsp;&nbsp;((char*)&quot;IAX&quot;)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00080">80</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00591">osp_check_destination()</a>, and <a class="el" href="app__osplookup_8c_source.html#l00181">osp_create_provider()</a>.</p>

</div>
</div>
<a class="anchor" id="a97ded2bda6516df25b260682ac8952d8"></a><!-- doxytag: member="app_osplookup.c::OSP_PROT_OTHER" ref="a97ded2bda6516df25b260682ac8952d8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_PROT_OTHER&nbsp;&nbsp;&nbsp;((char*)&quot;OTHER&quot;)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00081">81</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00181">osp_create_provider()</a>.</p>

</div>
</div>
<a class="anchor" id="a2d59871d2b33932ab6cd5acca414c2dc"></a><!-- doxytag: member="app_osplookup.c::OSP_PROT_SIP" ref="a2d59871d2b33932ab6cd5acca414c2dc" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_PROT_SIP&nbsp;&nbsp;&nbsp;((char*)&quot;SIP&quot;)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00079">79</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00591">osp_check_destination()</a>, and <a class="el" href="app__osplookup_8c_source.html#l00181">osp_create_provider()</a>.</p>

</div>
</div>
<a class="anchor" id="a93310672c1358e732400908dc7a11ffd"></a><!-- doxytag: member="app_osplookup.c::OSP_SIP_HEADER" ref="a93310672c1358e732400908dc7a11ffd" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_SIP_HEADER&nbsp;&nbsp;&nbsp;((char*)&quot;P-OSP-Auth-Token: &quot;)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00092">92</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l01335">osplookup_exec()</a>, and <a class="el" href="app__osplookup_8c_source.html#l01503">ospnext_exec()</a>.</p>

</div>
</div>
<a class="anchor" id="aa3e4c2f6886beeb3167baea11338365b"></a><!-- doxytag: member="app_osplookup.c::OSP_SSL_LIFETIME" ref="aa3e4c2f6886beeb3167baea11338365b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_SSL_LIFETIME&nbsp;&nbsp;&nbsp;((unsigned int)300)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00116">116</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00181">osp_create_provider()</a>.</p>

</div>
</div>
<a class="anchor" id="a232b5abec331065cc0ab6381c5ac5ea1"></a><!-- doxytag: member="app_osplookup.c::OSP_TECH_H323" ref="a232b5abec331065cc0ab6381c5ac5ea1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_TECH_H323&nbsp;&nbsp;&nbsp;((char*)&quot;H323&quot;)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00087">87</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00591">osp_check_destination()</a>, <a class="el" href="app__osplookup_8c_source.html#l01335">osplookup_exec()</a>, and <a class="el" href="app__osplookup_8c_source.html#l01503">ospnext_exec()</a>.</p>

</div>
</div>
<a class="anchor" id="ab00665d0be85f5bdb470e104eb3659b4"></a><!-- doxytag: member="app_osplookup.c::OSP_TECH_IAX" ref="ab00665d0be85f5bdb470e104eb3659b4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_TECH_IAX&nbsp;&nbsp;&nbsp;((char*)&quot;IAX2&quot;)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00089">89</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00591">osp_check_destination()</a>, <a class="el" href="app__osplookup_8c_source.html#l01335">osplookup_exec()</a>, and <a class="el" href="app__osplookup_8c_source.html#l01503">ospnext_exec()</a>.</p>

</div>
</div>
<a class="anchor" id="a3bb2e8490ca2aae2ef00dd0666a0d637"></a><!-- doxytag: member="app_osplookup.c::OSP_TECH_SIP" ref="a3bb2e8490ca2aae2ef00dd0666a0d637" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_TECH_SIP&nbsp;&nbsp;&nbsp;((char*)&quot;SIP&quot;)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00088">88</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00591">osp_check_destination()</a>, <a class="el" href="app__osplookup_8c_source.html#l01335">osplookup_exec()</a>, and <a class="el" href="app__osplookup_8c_source.html#l01503">ospnext_exec()</a>.</p>

</div>
</div>
<a class="anchor" id="a12925f86405ccd7518a12b4828d4c0d3"></a><!-- doxytag: member="app_osplookup.c::OSP_TECHSTR_SIZE" ref="a12925f86405ccd7518a12b4828d4c0d3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_TECHSTR_SIZE&nbsp;&nbsp;&nbsp;((unsigned int)32)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00059">59</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

</div>
</div>
<a class="anchor" id="a6d56e8f42ac71c7e7cebd6d4e0aa6f78"></a><!-- doxytag: member="app_osplookup.c::OSP_TOKSTR_SIZE" ref="a6d56e8f42ac71c7e7cebd6d4e0aa6f78" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_TOKSTR_SIZE&nbsp;&nbsp;&nbsp;((unsigned int)4096)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00058">58</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00856">osp_lookup()</a>, <a class="el" href="app__osplookup_8c_source.html#l01074">osp_next()</a>, <a class="el" href="app__osplookup_8c_source.html#l00506">osp_validate_token()</a>, <a class="el" href="app__osplookup_8c_source.html#l01335">osplookup_exec()</a>, and <a class="el" href="app__osplookup_8c_source.html#l01503">ospnext_exec()</a>.</p>

</div>
</div>
<a class="anchor" id="a313b6d61db7200ce2361164899971931"></a><!-- doxytag: member="app_osplookup.c::OSP_UUID_SIZE" ref="a313b6d61db7200ce2361164899971931" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_UUID_SIZE&nbsp;&nbsp;&nbsp;((unsigned int)16)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00060">60</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00766">osp_create_uuid()</a>.</p>

</div>
</div>
<a class="anchor" id="a6a64dee4ca45cb275f994bfcd9ff7a01"></a><!-- doxytag: member="app_osplookup.c::OSP_UUIDSTR_SIZE" ref="a6a64dee4ca45cb275f994bfcd9ff7a01" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OSP_UUIDSTR_SIZE&nbsp;&nbsp;&nbsp;((unsigned int)36)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00061">61</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00794">osp_uuid2str()</a>.</p>

</div>
</div>
<hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="a973bb7ee8e420cae3117b3d08d395fcb"></a><!-- doxytag: member="app_osplookup.c::osp_authpolicy" ref="a973bb7ee8e420cae3117b3d08d395fcb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="app__osplookup_8c.html#a973bb7ee8e420cae3117b3d08d395fcb">osp_authpolicy</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a973bb7ee8e420cae3117b3d08d395fcbabdd97707a7a03ac645574bd924a77685"></a><!-- doxytag: member="OSP_AUTH_NO" ref="a973bb7ee8e420cae3117b3d08d395fcbabdd97707a7a03ac645574bd924a77685" args="" -->OSP_AUTH_NO</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a973bb7ee8e420cae3117b3d08d395fcba0d4b098bf4a527dd729e74819bb52b9c"></a><!-- doxytag: member="OSP_AUTH_YES" ref="a973bb7ee8e420cae3117b3d08d395fcba0d4b098bf4a527dd729e74819bb52b9c" args="" -->OSP_AUTH_YES</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a973bb7ee8e420cae3117b3d08d395fcba85ba776173c4770738603da1a8c2cebc"></a><!-- doxytag: member="OSP_AUTH_EXCLUSIVE" ref="a973bb7ee8e420cae3117b3d08d395fcba85ba776173c4770738603da1a8c2cebc" args="" -->OSP_AUTH_EXCLUSIVE</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00064">64</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00064"></a>00064                     {
<a name="l00065"></a>00065    <a class="code" href="app__osplookup_8c.html#a973bb7ee8e420cae3117b3d08d395fcbabdd97707a7a03ac645574bd924a77685">OSP_AUTH_NO</a>,      <span class="comment">/* Accept any call */</span>
<a name="l00066"></a>00066    <a class="code" href="app__osplookup_8c.html#a973bb7ee8e420cae3117b3d08d395fcba0d4b098bf4a527dd729e74819bb52b9c">OSP_AUTH_YES</a>,     <span class="comment">/* Accept call with valid OSP token or without OSP token */</span>
<a name="l00067"></a>00067    <a class="code" href="app__osplookup_8c.html#a973bb7ee8e420cae3117b3d08d395fcba85ba776173c4770738603da1a8c2cebc">OSP_AUTH_EXCLUSIVE</a>   <span class="comment">/* Only accept call with valid OSP token */</span>
<a name="l00068"></a>00068 };
</pre></div></p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="acf28e932014bd92c82c69ebbfca6921b"></a><!-- doxytag: member="app_osplookup.c::AST_MODULE_INFO" ref="acf28e932014bd92c82c69ebbfca6921b" args="(ASTERISK_GPL_KEY, AST_MODFLAG_DEFAULT,&quot;Open Settlement Protocol Applications&quot;,.load=load_module,.unload=unload_module,.reload=reload,)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">AST_MODULE_INFO </td>
          <td>(</td>
          <td class="paramtype">ASTERISK_GPL_KEY&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">AST_MODFLAG_DEFAULT&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&quot;Open Settlement Protocol Applications&quot;&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">.&nbsp;</td>
          <td class="paramname"> <em>load</em> = <code>load_module</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">.&nbsp;</td>
          <td class="paramname"> <em>unload</em> = <code>unload_module</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">.&nbsp;</td>
          <td class="paramname"> <em>reload</em> = <code>reload</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="abc5bac8644a07acc2c9fef322e8a0151"></a><!-- doxytag: member="app_osplookup.c::AST_MUTEX_DEFINE_STATIC" ref="abc5bac8644a07acc2c9fef322e8a0151" args="(osplock)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">AST_MUTEX_DEFINE_STATIC </td>
          <td>(</td>
          <td class="paramtype">osplock&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="af51938903a4cc1d253bfbf03b2a70d90"></a><!-- doxytag: member="app_osplookup.c::asterisk2osp" ref="af51938903a4cc1d253bfbf03b2a70d90" args="(int cause)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static OSPEFAILREASON asterisk2osp </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cause</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Convert Asterisk status to TC code. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>cause</em>&nbsp;</td><td>Asterisk hangup cause </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>OSP TC code </dd></dl>

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00690">690</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l01192">osp_finish()</a>, and <a class="el" href="app__osplookup_8c_source.html#l01074">osp_next()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00692"></a>00692 {
<a name="l00693"></a>00693    <span class="keywordflow">return</span> (OSPEFAILREASON)<a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a>;
<a name="l00694"></a>00694 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8c819d70b0fbac62fc53d35fb9918ffd"></a><!-- doxytag: member="app_osplookup.c::handle_cli_osp_show" ref="a8c819d70b0fbac62fc53d35fb9918ffd" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* handle_cli_osp_show </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l01863">1863</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8h_source.html#l00141">ast_cli_args::argv</a>, <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="app__osplookup_8c_source.html#l00138">osp_provider::authpolicy</a>, <a class="el" href="app__osplookup_8c_source.html#l00130">osp_provider::cacerts</a>, <a class="el" href="app__osplookup_8c_source.html#l00129">osp_provider::cacount</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="app__osplookup_8c_source.html#l00139">osp_provider::defaultprotocol</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, <a class="el" href="app__osplookup_8c_source.html#l00140">osp_provider::handle</a>, <a class="el" href="app__osplookup_8c_source.html#l00128">osp_provider::localcert</a>, <a class="el" href="app__osplookup_8c_source.html#l00133">osp_provider::maxconnections</a>, <a class="el" href="app__osplookup_8c_source.html#l00126">osp_provider::name</a>, <a class="el" href="app__osplookup_8c_source.html#l00141">osp_provider::next</a>, <a class="el" href="app__osplookup_8c_source.html#l00127">osp_provider::privatekey</a>, <a class="el" href="app__osplookup_8c_source.html#l00134">osp_provider::retrydelay</a>, <a class="el" href="app__osplookup_8c_source.html#l00135">osp_provider::retrylimit</a>, <a class="el" href="app__osplookup_8c_source.html#l00137">osp_provider::source</a>, <a class="el" href="app__osplookup_8c_source.html#l00131">osp_provider::spcount</a>, <a class="el" href="app__osplookup_8c_source.html#l00132">osp_provider::srvpoints</a>, <a class="el" href="app__osplookup_8c_source.html#l00136">osp_provider::timeout</a>, and <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01864"></a>01864 {
<a name="l01865"></a>01865    <span class="keywordtype">int</span> i;
<a name="l01866"></a>01866    <span class="keywordtype">int</span> found = 0;
<a name="l01867"></a>01867    <span class="keyword">struct </span><a class="code" href="structosp__provider.html">osp_provider</a>* p;
<a name="l01868"></a>01868    <span class="keyword">const</span> <span class="keywordtype">char</span>* provider = NULL;
<a name="l01869"></a>01869    <span class="keyword">const</span> <span class="keywordtype">char</span>* tokenalgo;
<a name="l01870"></a>01870 
<a name="l01871"></a>01871    <span class="keywordflow">switch</span> (cmd) {
<a name="l01872"></a>01872    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l01873"></a>01873       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;osp show&quot;</span>;
<a name="l01874"></a>01874       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l01875"></a>01875          <span class="stringliteral">&quot;Usage: osp show\n&quot;</span>
<a name="l01876"></a>01876          <span class="stringliteral">&quot;       Displays information on Open Settlement Protocol support\n&quot;</span>;
<a name="l01877"></a>01877       <span class="keywordflow">return</span> NULL;
<a name="l01878"></a>01878    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l01879"></a>01879       <span class="keywordflow">return</span> NULL;
<a name="l01880"></a>01880    }
<a name="l01881"></a>01881 
<a name="l01882"></a>01882    <span class="keywordflow">if</span> ((a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> &lt; 2) || (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> &gt; 3))
<a name="l01883"></a>01883       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l01884"></a>01884    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> &gt; 2) 
<a name="l01885"></a>01885       provider = a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[2];
<a name="l01886"></a>01886    <span class="keywordflow">if</span> (!provider) {
<a name="l01887"></a>01887       <span class="keywordflow">switch</span> (<a class="code" href="app__osplookup_8c.html#ab918a4031e5d25153fe54e91be1ac56e">osp_tokenformat</a>) {
<a name="l01888"></a>01888       <span class="keywordflow">case</span> TOKEN_ALGO_BOTH:
<a name="l01889"></a>01889          tokenalgo = <span class="stringliteral">&quot;Both&quot;</span>;
<a name="l01890"></a>01890          <span class="keywordflow">break</span>;
<a name="l01891"></a>01891       <span class="keywordflow">case</span> TOKEN_ALGO_UNSIGNED:
<a name="l01892"></a>01892          tokenalgo = <span class="stringliteral">&quot;Unsigned&quot;</span>;
<a name="l01893"></a>01893          <span class="keywordflow">break</span>;
<a name="l01894"></a>01894       <span class="keywordflow">case</span> TOKEN_ALGO_SIGNED:
<a name="l01895"></a>01895       <span class="keywordflow">default</span>:
<a name="l01896"></a>01896          tokenalgo = <span class="stringliteral">&quot;Signed&quot;</span>;
<a name="l01897"></a>01897          <span class="keywordflow">break</span>;
<a name="l01898"></a>01898       }
<a name="l01899"></a>01899       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;OSP: %s %s %s\n&quot;</span>,
<a name="l01900"></a>01900          <a class="code" href="app__osplookup_8c.html#a7b65a944814a9fe8b45330072c875e46">osp_initialized</a> ? <span class="stringliteral">&quot;Initialized&quot;</span> : <span class="stringliteral">&quot;Uninitialized&quot;</span>, <a class="code" href="app__osplookup_8c.html#a5ef0958fa463ae932e3e71ec39cd1337">osp_hardware</a> ? <span class="stringliteral">&quot;Accelerated&quot;</span> : <span class="stringliteral">&quot;Normal&quot;</span>, tokenalgo);
<a name="l01901"></a>01901    }
<a name="l01902"></a>01902 
<a name="l01903"></a>01903    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;osplock);
<a name="l01904"></a>01904    p = <a class="code" href="app__osplookup_8c.html#ac9590e73571584ed17bed31f03b87900">ospproviders</a>;
<a name="l01905"></a>01905    <span class="keywordflow">while</span>(p) {
<a name="l01906"></a>01906       <span class="keywordflow">if</span> (!provider || !strcasecmp(p-&gt;<a class="code" href="structosp__provider.html#ac475c259e73fbefdd58e2439b3f3beb8">name</a>, provider)) {
<a name="l01907"></a>01907          <span class="keywordflow">if</span> (found) {
<a name="l01908"></a>01908             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01909"></a>01909          }
<a name="l01910"></a>01910          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot; == OSP Provider &apos;%s&apos; == \n&quot;</span>, p-&gt;<a class="code" href="structosp__provider.html#ac475c259e73fbefdd58e2439b3f3beb8">name</a>);
<a name="l01911"></a>01911          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Local Private Key: %s\n&quot;</span>, p-&gt;<a class="code" href="structosp__provider.html#aa95813263e6669f4a71e85a7434ff44f">privatekey</a>);
<a name="l01912"></a>01912          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Local Certificate: %s\n&quot;</span>, p-&gt;<a class="code" href="structosp__provider.html#aa9a3e60cb8c376194f7560fb77f72209">localcert</a>);
<a name="l01913"></a>01913          <span class="keywordflow">for</span> (i = 0; i &lt; p-&gt;<a class="code" href="structosp__provider.html#a9cb4d699e54c65c7788b04f05a651854">cacount</a>; i++) {
<a name="l01914"></a>01914             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;CA Certificate %d:  %s\n&quot;</span>, i + 1, p-&gt;<a class="code" href="structosp__provider.html#aff0310e195ae63002674b3e82ce8957c">cacerts</a>[i]);
<a name="l01915"></a>01915          }
<a name="l01916"></a>01916          <span class="keywordflow">for</span> (i = 0; i &lt; p-&gt;<a class="code" href="structosp__provider.html#a1b0451cb98b8626ab4b6f7e3af8f1b94">spcount</a>; i++) {
<a name="l01917"></a>01917             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Service Point %d:   %s\n&quot;</span>, i + 1, p-&gt;<a class="code" href="structosp__provider.html#a8a67a5c7679f22062602451174227008">srvpoints</a>[i]);
<a name="l01918"></a>01918          }
<a name="l01919"></a>01919          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Max Connections:   %d\n&quot;</span>, p-&gt;<a class="code" href="structosp__provider.html#a6eaff88757b638bcb0ef258104e55421">maxconnections</a>);
<a name="l01920"></a>01920          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Retry Delay:       %d seconds\n&quot;</span>, p-&gt;<a class="code" href="structosp__provider.html#a9d15efab2b27a01e4bb614122f9f1085">retrydelay</a>);
<a name="l01921"></a>01921          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Retry Limit:       %d\n&quot;</span>, p-&gt;<a class="code" href="structosp__provider.html#a68c251e358f5e5a3116608cbb1e0d25e">retrylimit</a>);
<a name="l01922"></a>01922          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Timeout:           %d milliseconds\n&quot;</span>, p-&gt;<a class="code" href="structosp__provider.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a>);
<a name="l01923"></a>01923          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Source:            %s\n&quot;</span>, strlen(p-&gt;<a class="code" href="structosp__provider.html#aaf4b604d6f82f265bafb3f5810ffd0ef">source</a>) ? p-&gt;<a class="code" href="structosp__provider.html#aaf4b604d6f82f265bafb3f5810ffd0ef">source</a> : <span class="stringliteral">&quot;&lt;unspecified&gt;&quot;</span>);
<a name="l01924"></a>01924          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Auth Policy        %d\n&quot;</span>, p-&gt;<a class="code" href="structosp__provider.html#a635fd679943876b710e3c99e24907dc3">authpolicy</a>);
<a name="l01925"></a>01925          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Default protocol   %s\n&quot;</span>, p-&gt;<a class="code" href="structosp__provider.html#a474b7bd67014a3d0988377f2d6bd8115">defaultprotocol</a>);
<a name="l01926"></a>01926          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;OSP Handle:        %d\n&quot;</span>, p-&gt;<a class="code" href="structosp__provider.html#a62668053aefe0d5985c4ae7451db8486">handle</a>);
<a name="l01927"></a>01927          found++;
<a name="l01928"></a>01928       }
<a name="l01929"></a>01929       p = p-&gt;<a class="code" href="structosp__provider.html#a63a14d2d4363005a28ebcd7449452d43">next</a>;
<a name="l01930"></a>01930    }
<a name="l01931"></a>01931    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;osplock);
<a name="l01932"></a>01932 
<a name="l01933"></a>01933    <span class="keywordflow">if</span> (!found) {
<a name="l01934"></a>01934       <span class="keywordflow">if</span> (provider) {
<a name="l01935"></a>01935          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Unable to find OSP provider &apos;%s&apos;\n&quot;</span>, provider);
<a name="l01936"></a>01936       } <span class="keywordflow">else</span> {
<a name="l01937"></a>01937          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;No OSP providers configured\n&quot;</span>);
<a name="l01938"></a>01938       }
<a name="l01939"></a>01939    }
<a name="l01940"></a>01940    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l01941"></a>01941 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac3382bf6da54c56b37069bd76bbdf4f9"></a><!-- doxytag: member="app_osplookup.c::load_module" ref="ac3382bf6da54c56b37069bd76bbdf4f9" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int load_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l02005">2005</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>References <a class="el" href="cli_8c_source.html#l01927">ast_cli_register_multiple()</a>, <a class="el" href="module_8h_source.html#l00062">AST_MODULE_LOAD_DECLINE</a>, <a class="el" href="module_8h_source.html#l00390">ast_register_application</a>, <a class="el" href="app__osplookup_8c_source.html#l01772">osp_load()</a>, <a class="el" href="app__osplookup_8c_source.html#l01255">ospauth_exec()</a>, <a class="el" href="app__osplookup_8c_source.html#l01657">ospfinished_exec()</a>, <a class="el" href="app__osplookup_8c_source.html#l01335">osplookup_exec()</a>, and <a class="el" href="app__osplookup_8c_source.html#l01503">ospnext_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02006"></a>02006 {
<a name="l02007"></a>02007    <span class="keywordtype">int</span> res;
<a name="l02008"></a>02008 
<a name="l02009"></a>02009    <span class="keywordflow">if</span> (!<a class="code" href="app__osplookup_8c.html#abbf1e551f818049bd8744a6ece49a5ba">osp_load</a>(0))
<a name="l02010"></a>02010       <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;
<a name="l02011"></a>02011 
<a name="l02012"></a>02012    <a class="code" href="cli_8h.html#aadeef34f3106bb78aeb3414032ad7fb7" title="Register multiple commands.">ast_cli_register_multiple</a>(<a class="code" href="app__osplookup_8c.html#a10d006ccda399620ddcbdac150680853">cli_osp</a>, <span class="keyword">sizeof</span>(<a class="code" href="app__osplookup_8c.html#a10d006ccda399620ddcbdac150680853">cli_osp</a>) / <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a>));
<a name="l02013"></a>02013    res = <a class="code" href="module_8h.html#aa47a7223480d23a864cf83fef0f8585e" title="Register an application.">ast_register_application</a>(<a class="code" href="app__osplookup_8c.html#aee1c6fdb192d3bc745c949458f7de522">app1</a>, <a class="code" href="app__osplookup_8c.html#a30e6f7b8ac96cab586c505f27a05c023" title="OSP Application OSPAuth.">ospauth_exec</a>, <a class="code" href="app__osplookup_8c.html#ac303a7fc87983f994599152c93f791ae">synopsis1</a>, <a class="code" href="app__osplookup_8c.html#a2691a482b4359db931cef4398d6f28ee">descrip1</a>);
<a name="l02014"></a>02014    res |= <a class="code" href="module_8h.html#aa47a7223480d23a864cf83fef0f8585e" title="Register an application.">ast_register_application</a>(<a class="code" href="app__osplookup_8c.html#a226108d015a7b45044c5f4eb82ffaa1b">app2</a>, <a class="code" href="app__osplookup_8c.html#a4122506208193e0aa12724e0d8b39881" title="OSP Application OSPLookup.">osplookup_exec</a>, <a class="code" href="app__osplookup_8c.html#a6c27de8205a98c27461ee7eeb69dd48a">synopsis2</a>, <a class="code" href="app__osplookup_8c.html#a1ab5c89130218223dca8d1f8b57fb218">descrip2</a>);
<a name="l02015"></a>02015    res |= <a class="code" href="module_8h.html#aa47a7223480d23a864cf83fef0f8585e" title="Register an application.">ast_register_application</a>(<a class="code" href="app__osplookup_8c.html#a3044a87a73ac4a63321105ddc9a77692">app3</a>, <a class="code" href="app__osplookup_8c.html#a4dd57c9ab4ad09fd37eab55f2ed6859f" title="OSP Application OSPNext.">ospnext_exec</a>, <a class="code" href="app__osplookup_8c.html#a6bb971d5c56ec38f85ed6e9c0ff60d42">synopsis3</a>, <a class="code" href="app__osplookup_8c.html#a6a21c282600021fc9e5ca8fef5e2b18f">descrip3</a>);
<a name="l02016"></a>02016    res |= <a class="code" href="module_8h.html#aa47a7223480d23a864cf83fef0f8585e" title="Register an application.">ast_register_application</a>(<a class="code" href="app__osplookup_8c.html#a2f57c1b7cebdefada90f4dac8fd00fa6">app4</a>, <a class="code" href="app__osplookup_8c.html#a010b3b9e4bae42c2d0d0c751295121bc" title="OSP Application OSPFinish.">ospfinished_exec</a>, <a class="code" href="app__osplookup_8c.html#a9264bf933a240e13b35ae894365fe13c">synopsis4</a>, <a class="code" href="app__osplookup_8c.html#a2f7cb7b9188e1a2057a81e18292910e4">descrip4</a>);
<a name="l02017"></a>02017 
<a name="l02018"></a>02018    <span class="keywordflow">return</span> res;
<a name="l02019"></a>02019 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="accd86e4e5ad2335945459345e2052161"></a><!-- doxytag: member="app_osplookup.c::osp_auth" ref="accd86e4e5ad2335945459345e2052161" args="(const char *provider, int *transaction, const char *source, const char *calling, const char *called, const char *token, unsigned int *timelimit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osp_auth </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>provider</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>transaction</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>source</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>calling</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>called</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>token</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int *&nbsp;</td>
          <td class="paramname"> <em>timelimit</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>OSP Authentication function. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>provider</em>&nbsp;</td><td>OSP provider context name </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>transaction</em>&nbsp;</td><td>OSP transaction handle, output </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>source</em>&nbsp;</td><td>Source of inbound call </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>calling</em>&nbsp;</td><td>Calling <a class="el" href="structnumber.html" title="Number structure.">number</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>called</em>&nbsp;</td><td>Called <a class="el" href="structnumber.html" title="Number structure.">number</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>token</em>&nbsp;</td><td>OSP token, may be empty </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>timelimit</em>&nbsp;</td><td>Call duration limit, output </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>1 Authenricated, 0 Unauthenticated, -1 Error </dd></dl>

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00707">707</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="app__osplookup_8c_source.html#l00138">osp_provider::authpolicy</a>, <a class="el" href="app__osplookup_8c_source.html#l00067">OSP_AUTH_EXCLUSIVE</a>, <a class="el" href="app__osplookup_8c_source.html#l00065">OSP_AUTH_NO</a>, <a class="el" href="app__osplookup_8c_source.html#l00066">OSP_AUTH_YES</a>, <a class="el" href="app__osplookup_8c_source.html#l00441">osp_create_transaction()</a>, <a class="el" href="app__osplookup_8c_source.html#l00121">OSP_DEF_TIMELIMIT</a>, <a class="el" href="app__osplookup_8c_source.html#l00410">osp_get_provider()</a>, <a class="el" href="app__osplookup_8c_source.html#l00095">OSP_INVALID_HANDLE</a>, <a class="el" href="app__osplookup_8c_source.html#l00057">OSP_NORSTR_SIZE</a>, and <a class="el" href="app__osplookup_8c_source.html#l00506">osp_validate_token()</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l01255">ospauth_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00715"></a>00715 {
<a name="l00716"></a>00716    <span class="keywordtype">int</span> res;
<a name="l00717"></a>00717    <span class="keyword">struct </span><a class="code" href="structosp__provider.html">osp_provider</a>* p = NULL;
<a name="l00718"></a>00718    <span class="keywordtype">char</span> dest[<a class="code" href="app__osplookup_8c.html#ab83d2712bd3bfe3e2f3631f97307fd0c">OSP_NORSTR_SIZE</a>];
<a name="l00719"></a>00719 
<a name="l00720"></a>00720    *transaction = <a class="code" href="app__osplookup_8c.html#a693603e5e4556641af06c8ebec1dffc5">OSP_INVALID_HANDLE</a>;
<a name="l00721"></a>00721    *timelimit = <a class="code" href="app__osplookup_8c.html#aa216d244dea7f5d816cc35504c4390cc">OSP_DEF_TIMELIMIT</a>;
<a name="l00722"></a>00722 
<a name="l00723"></a>00723    <span class="keywordflow">if</span> ((res = <a class="code" href="app__osplookup_8c.html#af21fa85fa457a1235efc74c9e8d51bbb" title="Get OSP provider by name.">osp_get_provider</a>(provider, &amp;p)) &lt;= 0) {
<a name="l00724"></a>00724       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: Unabe to find OSP provider &apos;%s&apos;\n&quot;</span>, provider);
<a name="l00725"></a>00725       <span class="keywordflow">return</span> res;
<a name="l00726"></a>00726    }
<a name="l00727"></a>00727 
<a name="l00728"></a>00728    <span class="keywordflow">switch</span> (p-&gt;<a class="code" href="structosp__provider.html#a635fd679943876b710e3c99e24907dc3">authpolicy</a>) {
<a name="l00729"></a>00729    <span class="keywordflow">case</span> <a class="code" href="app__osplookup_8c.html#a973bb7ee8e420cae3117b3d08d395fcbabdd97707a7a03ac645574bd924a77685">OSP_AUTH_NO</a>:
<a name="l00730"></a>00730       res = 1;
<a name="l00731"></a>00731       <span class="keywordflow">break</span>;
<a name="l00732"></a>00732    <span class="keywordflow">case</span> <a class="code" href="app__osplookup_8c.html#a973bb7ee8e420cae3117b3d08d395fcba85ba776173c4770738603da1a8c2cebc">OSP_AUTH_EXCLUSIVE</a>:
<a name="l00733"></a>00733       <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(token)) {
<a name="l00734"></a>00734          res = 0;
<a name="l00735"></a>00735       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((res = <a class="code" href="app__osplookup_8c.html#aec704b16f5e3d6367e23b9cb3555d87a" title="Create OSP transaction handle.">osp_create_transaction</a>(provider, transaction, <span class="keyword">sizeof</span>(dest), dest)) &lt;= 0) {
<a name="l00736"></a>00736          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: Unable to generate transaction handle\n&quot;</span>);
<a name="l00737"></a>00737          *transaction = <a class="code" href="app__osplookup_8c.html#a693603e5e4556641af06c8ebec1dffc5">OSP_INVALID_HANDLE</a>;
<a name="l00738"></a>00738          res = 0;
<a name="l00739"></a>00739       } <span class="keywordflow">else</span> <span class="keywordflow">if</span>((res = <a class="code" href="app__osplookup_8c.html#a435ee8a469fe74baa978a41ed722bc25" title="Validate OSP token of inbound call.">osp_validate_token</a>(*transaction, <a class="code" href="structosp__provider.html#aaf4b604d6f82f265bafb3f5810ffd0ef">source</a>, dest, calling, called, token, timelimit)) &lt;= 0) {
<a name="l00740"></a>00740          OSPPTransactionRecordFailure(*transaction, OSPC_FAIL_CALL_REJECTED);
<a name="l00741"></a>00741       }
<a name="l00742"></a>00742       <span class="keywordflow">break</span>;
<a name="l00743"></a>00743    <span class="keywordflow">case</span> <a class="code" href="app__osplookup_8c.html#a973bb7ee8e420cae3117b3d08d395fcba0d4b098bf4a527dd729e74819bb52b9c">OSP_AUTH_YES</a>:
<a name="l00744"></a>00744    <span class="keywordflow">default</span>:
<a name="l00745"></a>00745       <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(token)) {
<a name="l00746"></a>00746          res = 1;
<a name="l00747"></a>00747       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((res = <a class="code" href="app__osplookup_8c.html#aec704b16f5e3d6367e23b9cb3555d87a" title="Create OSP transaction handle.">osp_create_transaction</a>(provider, transaction, <span class="keyword">sizeof</span>(dest), dest)) &lt;= 0) {
<a name="l00748"></a>00748          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: Unable to generate transaction handle\n&quot;</span>);
<a name="l00749"></a>00749          *transaction = <a class="code" href="app__osplookup_8c.html#a693603e5e4556641af06c8ebec1dffc5">OSP_INVALID_HANDLE</a>;
<a name="l00750"></a>00750          res = 0;
<a name="l00751"></a>00751       } <span class="keywordflow">else</span> <span class="keywordflow">if</span>((res = <a class="code" href="app__osplookup_8c.html#a435ee8a469fe74baa978a41ed722bc25" title="Validate OSP token of inbound call.">osp_validate_token</a>(*transaction, <a class="code" href="structosp__provider.html#aaf4b604d6f82f265bafb3f5810ffd0ef">source</a>, dest, calling, called, token, timelimit)) &lt;= 0) {
<a name="l00752"></a>00752          OSPPTransactionRecordFailure(*transaction, OSPC_FAIL_CALL_REJECTED);
<a name="l00753"></a>00753       }
<a name="l00754"></a>00754       <span class="keywordflow">break</span>;
<a name="l00755"></a>00755    }
<a name="l00756"></a>00756 
<a name="l00757"></a>00757    <span class="keywordflow">return</span> res;
<a name="l00758"></a>00758 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab1f3dd789f1e830e5e53204fe908a9d9"></a><!-- doxytag: member="app_osplookup.c::osp_check_destination" ref="ab1f3dd789f1e830e5e53204fe908a9d9" args="(struct osp_provider *provider, const char *called, const char *calling, char *destination, unsigned int tokenlen, const char *token, OSPEFAILREASON *reason, struct osp_result *result)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osp_check_destination </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structosp__provider.html">osp_provider</a> *&nbsp;</td>
          <td class="paramname"> <em>provider</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>called</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>calling</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>destination</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>tokenlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>token</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">OSPEFAILREASON *&nbsp;</td>
          <td class="paramname"> <em>reason</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structosp__result.html">osp_result</a> *&nbsp;</td>
          <td class="paramname"> <em>result</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Choose min duration limit. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>provider</em>&nbsp;</td><td>OSP provider </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>called</em>&nbsp;</td><td>Called <a class="el" href="structnumber.html" title="Number structure.">number</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>calling</em>&nbsp;</td><td>Calling <a class="el" href="structnumber.html" title="Number structure.">number</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>destination</em>&nbsp;</td><td>Destination IP in '[x.x.x.x]' format </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>tokenlen</em>&nbsp;</td><td>OSP token length </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>token</em>&nbsp;</td><td>OSP token </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>reason</em>&nbsp;</td><td>Failure reason, output </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>result</em>&nbsp;</td><td>OSP lookup results, in/output </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>1 Success, 0 Failed, -1 Error </dd></dl>

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00591">591</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>References <a class="el" href="utils_8c_source.html#l00342">ast_base64encode()</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="app__osplookup_8c_source.html#l00158">osp_result::called</a>, <a class="el" href="app__osplookup_8c_source.html#l00159">osp_result::calling</a>, <a class="el" href="app__osplookup_8c_source.html#l00139">osp_provider::defaultprotocol</a>, <a class="el" href="app__osplookup_8c_source.html#l00157">osp_result::dest</a>, <a class="el" href="devicestate_8c_source.html#l00199">enabled</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="app__osplookup_8c_source.html#l00161">osp_result::networkid</a>, <a class="el" href="app__osplookup_8c_source.html#l00078">OSP_PROT_H323</a>, <a class="el" href="app__osplookup_8c_source.html#l00080">OSP_PROT_IAX</a>, <a class="el" href="app__osplookup_8c_source.html#l00079">OSP_PROT_SIP</a>, <a class="el" href="app__osplookup_8c_source.html#l00087">OSP_TECH_H323</a>, <a class="el" href="app__osplookup_8c_source.html#l00089">OSP_TECH_IAX</a>, <a class="el" href="app__osplookup_8c_source.html#l00088">OSP_TECH_SIP</a>, <a class="el" href="app__osplookup_8c_source.html#l00153">osp_result::outhandle</a>, <a class="el" href="app__osplookup_8c_source.html#l00156">osp_result::tech</a>, and <a class="el" href="app__osplookup_8c_source.html#l00160">osp_result::token</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00856">osp_lookup()</a>, and <a class="el" href="app__osplookup_8c_source.html#l01074">osp_next()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00600"></a>00600 {
<a name="l00601"></a>00601    <span class="keywordtype">int</span> res;
<a name="l00602"></a>00602    OSPE_DEST_OSPENABLED <a class="code" href="devicestate_8c.html#a63be54a0beac1f5717217e1d9e629c71">enabled</a>;
<a name="l00603"></a>00603    OSPE_DEST_PROTOCOL protocol;
<a name="l00604"></a>00604    <span class="keywordtype">int</span> error;
<a name="l00605"></a>00605 
<a name="l00606"></a>00606    <span class="keywordflow">if</span> (strlen(destination) &lt;= 2) {
<a name="l00607"></a>00607       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: Wrong destination format &apos;%s&apos;\n&quot;</span>, destination);
<a name="l00608"></a>00608       *reason = OSPC_FAIL_NORMAL_UNSPECIFIED;
<a name="l00609"></a>00609       <span class="keywordflow">return</span> -1;
<a name="l00610"></a>00610    }
<a name="l00611"></a>00611 
<a name="l00612"></a>00612    <span class="keywordflow">if</span> ((error = OSPPTransactionIsDestOSPEnabled(result-&gt;<a class="code" href="structosp__result.html#a9510d026d1fc5261f447c25136359281">outhandle</a>, &amp;enabled)) != OSPC_ERR_NO_ERROR) {
<a name="l00613"></a>00613       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: Unable to get destination OSP version, error &apos;%d&apos;\n&quot;</span>, error);
<a name="l00614"></a>00614       *reason = OSPC_FAIL_NORMAL_UNSPECIFIED;
<a name="l00615"></a>00615       <span class="keywordflow">return</span> -1;
<a name="l00616"></a>00616    }
<a name="l00617"></a>00617 
<a name="l00618"></a>00618    <span class="keywordflow">if</span> (enabled == OSPC_DOSP_FALSE) {
<a name="l00619"></a>00619       result-&gt;<a class="code" href="structosp__result.html#ad8469d2c5b331a926d1e0dcfd1bd5a5d">token</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00620"></a>00620    } <span class="keywordflow">else</span> {
<a name="l00621"></a>00621       <a class="code" href="utils_8h.html#a555dad1bd5b23acf01cf08f1affab879" title="Encode data in base64.">ast_base64encode</a>(result-&gt;<a class="code" href="structosp__result.html#ad8469d2c5b331a926d1e0dcfd1bd5a5d">token</a>, (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)token, tokenlen, <span class="keyword">sizeof</span>(result-&gt;<a class="code" href="structosp__result.html#ad8469d2c5b331a926d1e0dcfd1bd5a5d">token</a>) - 1);
<a name="l00622"></a>00622    }
<a name="l00623"></a>00623 
<a name="l00624"></a>00624    <span class="keywordflow">if</span> ((error = OSPPTransactionGetDestNetworkId(result-&gt;<a class="code" href="structosp__result.html#a9510d026d1fc5261f447c25136359281">outhandle</a>, result-&gt;<a class="code" href="structosp__result.html#a2f7b2fe69e61746900b9fa83cd3013a9">networkid</a>)) != OSPC_ERR_NO_ERROR) {
<a name="l00625"></a>00625       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: Unable to get destination network ID, error &apos;%d&apos;\n&quot;</span>, error);
<a name="l00626"></a>00626       result-&gt;<a class="code" href="structosp__result.html#a2f7b2fe69e61746900b9fa83cd3013a9">networkid</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00627"></a>00627    }
<a name="l00628"></a>00628 
<a name="l00629"></a>00629    <span class="keywordflow">if</span> ((error = OSPPTransactionGetDestProtocol(result-&gt;<a class="code" href="structosp__result.html#a9510d026d1fc5261f447c25136359281">outhandle</a>, &amp;protocol)) != OSPC_ERR_NO_ERROR) {
<a name="l00630"></a>00630       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: Unable to get destination protocol, error &apos;%d&apos;\n&quot;</span>, error);
<a name="l00631"></a>00631       *reason = OSPC_FAIL_NORMAL_UNSPECIFIED;
<a name="l00632"></a>00632       result-&gt;<a class="code" href="structosp__result.html#ad8469d2c5b331a926d1e0dcfd1bd5a5d">token</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00633"></a>00633       result-&gt;<a class="code" href="structosp__result.html#a2f7b2fe69e61746900b9fa83cd3013a9">networkid</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00634"></a>00634       <span class="keywordflow">return</span> -1;
<a name="l00635"></a>00635    }
<a name="l00636"></a>00636 
<a name="l00637"></a>00637    res = 1;
<a name="l00638"></a>00638    <span class="comment">/* Strip leading and trailing brackets */</span>
<a name="l00639"></a>00639    destination[strlen(destination) - 1] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00640"></a>00640    <span class="keywordflow">switch</span>(protocol) {
<a name="l00641"></a>00641    <span class="keywordflow">case</span> OSPC_DPROT_Q931:
<a name="l00642"></a>00642       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: protocol &apos;%s&apos;\n&quot;</span>, <a class="code" href="app__osplookup_8c.html#aece924ab64f6f37fb6b01b24816ecf7d">OSP_PROT_H323</a>);
<a name="l00643"></a>00643       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(result-&gt;<a class="code" href="structosp__result.html#a1a93d2e18d4e533ca49d205d12f43b07">tech</a>, <a class="code" href="app__osplookup_8c.html#a232b5abec331065cc0ab6381c5ac5ea1">OSP_TECH_H323</a>, <span class="keyword">sizeof</span>(result-&gt;<a class="code" href="structosp__result.html#a1a93d2e18d4e533ca49d205d12f43b07">tech</a>));
<a name="l00644"></a>00644       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(result-&gt;<a class="code" href="structosp__result.html#aa1b0ddffe07f8bf8359636039bc67ce6">dest</a>, destination + 1, <span class="keyword">sizeof</span>(result-&gt;<a class="code" href="structosp__result.html#aa1b0ddffe07f8bf8359636039bc67ce6">dest</a>));
<a name="l00645"></a>00645       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(result-&gt;<a class="code" href="structosp__result.html#aebc71b334dd60e88992b18270584c55e">called</a>, called, <span class="keyword">sizeof</span>(result-&gt;<a class="code" href="structosp__result.html#aebc71b334dd60e88992b18270584c55e">called</a>));
<a name="l00646"></a>00646       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(result-&gt;<a class="code" href="structosp__result.html#ae7b4c361c1d2fe0c5f1b8a0fab365876">calling</a>, calling, <span class="keyword">sizeof</span>(result-&gt;<a class="code" href="structosp__result.html#ae7b4c361c1d2fe0c5f1b8a0fab365876">calling</a>));
<a name="l00647"></a>00647       <span class="keywordflow">break</span>;
<a name="l00648"></a>00648    <span class="keywordflow">case</span> OSPC_DPROT_SIP:
<a name="l00649"></a>00649       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: protocol &apos;%s&apos;\n&quot;</span>, <a class="code" href="app__osplookup_8c.html#a2d59871d2b33932ab6cd5acca414c2dc">OSP_PROT_SIP</a>);
<a name="l00650"></a>00650       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(result-&gt;<a class="code" href="structosp__result.html#a1a93d2e18d4e533ca49d205d12f43b07">tech</a>, <a class="code" href="app__osplookup_8c.html#a3bb2e8490ca2aae2ef00dd0666a0d637">OSP_TECH_SIP</a>, <span class="keyword">sizeof</span>(result-&gt;<a class="code" href="structosp__result.html#a1a93d2e18d4e533ca49d205d12f43b07">tech</a>));
<a name="l00651"></a>00651       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(result-&gt;<a class="code" href="structosp__result.html#aa1b0ddffe07f8bf8359636039bc67ce6">dest</a>, destination + 1, <span class="keyword">sizeof</span>(result-&gt;<a class="code" href="structosp__result.html#aa1b0ddffe07f8bf8359636039bc67ce6">dest</a>));
<a name="l00652"></a>00652       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(result-&gt;<a class="code" href="structosp__result.html#aebc71b334dd60e88992b18270584c55e">called</a>, called, <span class="keyword">sizeof</span>(result-&gt;<a class="code" href="structosp__result.html#aebc71b334dd60e88992b18270584c55e">called</a>));
<a name="l00653"></a>00653       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(result-&gt;<a class="code" href="structosp__result.html#ae7b4c361c1d2fe0c5f1b8a0fab365876">calling</a>, calling, <span class="keyword">sizeof</span>(result-&gt;<a class="code" href="structosp__result.html#ae7b4c361c1d2fe0c5f1b8a0fab365876">calling</a>));
<a name="l00654"></a>00654       <span class="keywordflow">break</span>;
<a name="l00655"></a>00655    <span class="keywordflow">case</span> OSPC_DPROT_IAX:
<a name="l00656"></a>00656       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: protocol &apos;%s&apos;\n&quot;</span>, <a class="code" href="app__osplookup_8c.html#a37c83ec0ffd2dadcd13ab875afa37025">OSP_PROT_IAX</a>);
<a name="l00657"></a>00657       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(result-&gt;<a class="code" href="structosp__result.html#a1a93d2e18d4e533ca49d205d12f43b07">tech</a>, <a class="code" href="app__osplookup_8c.html#ab00665d0be85f5bdb470e104eb3659b4">OSP_TECH_IAX</a>, <span class="keyword">sizeof</span>(result-&gt;<a class="code" href="structosp__result.html#a1a93d2e18d4e533ca49d205d12f43b07">tech</a>));
<a name="l00658"></a>00658       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(result-&gt;<a class="code" href="structosp__result.html#aa1b0ddffe07f8bf8359636039bc67ce6">dest</a>, destination + 1, <span class="keyword">sizeof</span>(result-&gt;<a class="code" href="structosp__result.html#aa1b0ddffe07f8bf8359636039bc67ce6">dest</a>));
<a name="l00659"></a>00659       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(result-&gt;<a class="code" href="structosp__result.html#aebc71b334dd60e88992b18270584c55e">called</a>, called, <span class="keyword">sizeof</span>(result-&gt;<a class="code" href="structosp__result.html#aebc71b334dd60e88992b18270584c55e">called</a>));
<a name="l00660"></a>00660       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(result-&gt;<a class="code" href="structosp__result.html#ae7b4c361c1d2fe0c5f1b8a0fab365876">calling</a>, calling, <span class="keyword">sizeof</span>(result-&gt;<a class="code" href="structosp__result.html#ae7b4c361c1d2fe0c5f1b8a0fab365876">calling</a>));
<a name="l00661"></a>00661       <span class="keywordflow">break</span>;
<a name="l00662"></a>00662    <span class="keywordflow">case</span> OSPC_DPROT_UNDEFINED:
<a name="l00663"></a>00663    <span class="keywordflow">case</span> OSPC_DPROT_UNKNOWN:
<a name="l00664"></a>00664       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: unknown/undefined protocol &apos;%d&apos;\n&quot;</span>, protocol);
<a name="l00665"></a>00665       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: use default protocol &apos;%s&apos;\n&quot;</span>, provider-&gt;<a class="code" href="structosp__provider.html#a474b7bd67014a3d0988377f2d6bd8115">defaultprotocol</a>);
<a name="l00666"></a>00666 
<a name="l00667"></a>00667       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(result-&gt;<a class="code" href="structosp__result.html#a1a93d2e18d4e533ca49d205d12f43b07">tech</a>, provider-&gt;<a class="code" href="structosp__provider.html#a474b7bd67014a3d0988377f2d6bd8115">defaultprotocol</a>, <span class="keyword">sizeof</span>(result-&gt;<a class="code" href="structosp__result.html#a1a93d2e18d4e533ca49d205d12f43b07">tech</a>));
<a name="l00668"></a>00668       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(result-&gt;<a class="code" href="structosp__result.html#aa1b0ddffe07f8bf8359636039bc67ce6">dest</a>, destination + 1, <span class="keyword">sizeof</span>(result-&gt;<a class="code" href="structosp__result.html#aa1b0ddffe07f8bf8359636039bc67ce6">dest</a>));
<a name="l00669"></a>00669       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(result-&gt;<a class="code" href="structosp__result.html#aebc71b334dd60e88992b18270584c55e">called</a>, called, <span class="keyword">sizeof</span>(result-&gt;<a class="code" href="structosp__result.html#aebc71b334dd60e88992b18270584c55e">called</a>));
<a name="l00670"></a>00670       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(result-&gt;<a class="code" href="structosp__result.html#ae7b4c361c1d2fe0c5f1b8a0fab365876">calling</a>, calling, <span class="keyword">sizeof</span>(result-&gt;<a class="code" href="structosp__result.html#ae7b4c361c1d2fe0c5f1b8a0fab365876">calling</a>));
<a name="l00671"></a>00671       <span class="keywordflow">break</span>;
<a name="l00672"></a>00672    <span class="keywordflow">case</span> OSPC_DPROT_LRQ:
<a name="l00673"></a>00673    <span class="keywordflow">default</span>:
<a name="l00674"></a>00674       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;OSP: unsupported protocol &apos;%d&apos;\n&quot;</span>, protocol);
<a name="l00675"></a>00675       *reason = OSPC_FAIL_PROTOCOL_ERROR;
<a name="l00676"></a>00676       result-&gt;<a class="code" href="structosp__result.html#ad8469d2c5b331a926d1e0dcfd1bd5a5d">token</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00677"></a>00677       result-&gt;<a class="code" href="structosp__result.html#a2f7b2fe69e61746900b9fa83cd3013a9">networkid</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00678"></a>00678       res = 0;
<a name="l00679"></a>00679       <span class="keywordflow">break</span>;
<a name="l00680"></a>00680    }
<a name="l00681"></a>00681 
<a name="l00682"></a>00682    <span class="keywordflow">return</span> res;
<a name="l00683"></a>00683 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="acad1656c35ed21d307a509194041383e"></a><!-- doxytag: member="app_osplookup.c::osp_choose_timelimit" ref="acad1656c35ed21d307a509194041383e" args="(unsigned int in, unsigned int out)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static unsigned int osp_choose_timelimit </td>
          <td>(</td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>out</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Choose min duration limit. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>in</em>&nbsp;</td><td>Inbound duration limit </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>out</em>&nbsp;</td><td>Outbound duration limit </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>min duration limit </dd></dl>

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00566">566</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>References <a class="el" href="app__osplookup_8c_source.html#l00121">OSP_DEF_TIMELIMIT</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00856">osp_lookup()</a>, and <a class="el" href="app__osplookup_8c_source.html#l01074">osp_next()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00569"></a>00569 {
<a name="l00570"></a>00570    <span class="keywordflow">if</span> (in == <a class="code" href="app__osplookup_8c.html#aa216d244dea7f5d816cc35504c4390cc">OSP_DEF_TIMELIMIT</a>) {
<a name="l00571"></a>00571       <span class="keywordflow">return</span> out;
<a name="l00572"></a>00572    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (out == <a class="code" href="app__osplookup_8c.html#aa216d244dea7f5d816cc35504c4390cc">OSP_DEF_TIMELIMIT</a>) {
<a name="l00573"></a>00573       <span class="keywordflow">return</span> in;
<a name="l00574"></a>00574    } <span class="keywordflow">else</span> {
<a name="l00575"></a>00575       <span class="keywordflow">return</span> in &lt; out ? in : out;
<a name="l00576"></a>00576    }
<a name="l00577"></a>00577 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa919e8f63ad9ab313b720151246ecc33"></a><!-- doxytag: member="app_osplookup.c::osp_convert_address" ref="aa919e8f63ad9ab313b720151246ecc33" args="(const char *src, char *dst, int buffersize)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void osp_convert_address </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>dst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>buffersize</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Convert address to "[x.x.x.x]" or "host.domain" format. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>src</em>&nbsp;</td><td>Source address string </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dst</em>&nbsp;</td><td>Destination address string </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>buffersize</em>&nbsp;</td><td>Size of dst buffer </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00481">481</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00856">osp_lookup()</a>, and <a class="el" href="app__osplookup_8c_source.html#l00506">osp_validate_token()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00485"></a>00485 {
<a name="l00486"></a>00486    <span class="keyword">struct </span>in_addr inp;
<a name="l00487"></a>00487 
<a name="l00488"></a>00488    <span class="keywordflow">if</span> (inet_aton(src, &amp;inp) != 0) {
<a name="l00489"></a>00489       snprintf(dst, buffersize, <span class="stringliteral">&quot;[%s]&quot;</span>, src);
<a name="l00490"></a>00490    } <span class="keywordflow">else</span> {
<a name="l00491"></a>00491       snprintf(dst, buffersize, <span class="stringliteral">&quot;%s&quot;</span>, src);
<a name="l00492"></a>00492    }
<a name="l00493"></a>00493 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae9f5a73f76d19b25d7666d4a3517d64a"></a><!-- doxytag: member="app_osplookup.c::osp_create_callid" ref="ae9f5a73f76d19b25d7666d4a3517d64a" args="(unsigned int type, struct osp_callid *callid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osp_create_callid </td>
          <td>(</td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structosp__callid.html">osp_callid</a> *&nbsp;</td>
          <td class="paramname"> <em>callid</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Create a call ID according to the type. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>type</em>&nbsp;</td><td>Call ID type </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>callid</em>&nbsp;</td><td>Call ID buffer </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>1 Created, 0 Not create, -1 Error </dd></dl>

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00819">819</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>References <a class="el" href="app__osplookup_8c_source.html#l00146">osp_callid::buf</a>, <a class="el" href="app__osplookup_8c_source.html#l00147">osp_callid::len</a>, <a class="el" href="app__osplookup_8c_source.html#l00072">OSP_CALLID_H323</a>, <a class="el" href="app__osplookup_8c_source.html#l00074">OSP_CALLID_IAX</a>, <a class="el" href="app__osplookup_8c_source.html#l00073">OSP_CALLID_SIP</a>, and <a class="el" href="app__osplookup_8c_source.html#l00766">osp_create_uuid()</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00856">osp_lookup()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00822"></a>00822 {
<a name="l00823"></a>00823    <span class="keywordtype">int</span> res;
<a name="l00824"></a>00824 
<a name="l00825"></a>00825    callid-&gt;<a class="code" href="structosp__callid.html#a77124bd5f7e31e6fffc19f335da0c23f">len</a> = <span class="keyword">sizeof</span>(callid-&gt;<a class="code" href="structosp__callid.html#af2f02dd4431344f38b58d78bee490fca">buf</a>);
<a name="l00826"></a>00826    <span class="keywordflow">switch</span> (<a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>) {
<a name="l00827"></a>00827    <span class="keywordflow">case</span> <a class="code" href="app__osplookup_8c.html#a25a1a9044e69c1b41d40f79d1216d4c3">OSP_CALLID_H323</a>:
<a name="l00828"></a>00828       res = <a class="code" href="app__osplookup_8c.html#a0eae4255384c0a3e0bc770a4ed6cddaa" title="Create a UUID.">osp_create_uuid</a>(callid-&gt;<a class="code" href="structosp__callid.html#af2f02dd4431344f38b58d78bee490fca">buf</a>, &amp;callid-&gt;<a class="code" href="structosp__callid.html#a77124bd5f7e31e6fffc19f335da0c23f">len</a>);
<a name="l00829"></a>00829       <span class="keywordflow">break</span>;
<a name="l00830"></a>00830    <span class="keywordflow">case</span> <a class="code" href="app__osplookup_8c.html#a1725c43ee772f3901c2bd542f9582ee1">OSP_CALLID_SIP</a>:
<a name="l00831"></a>00831    <span class="keywordflow">case</span> <a class="code" href="app__osplookup_8c.html#aa8a82820ad56cd5eb4b6baa00cf6f68a">OSP_CALLID_IAX</a>:
<a name="l00832"></a>00832       res = 0;
<a name="l00833"></a>00833    <span class="keywordflow">default</span>:
<a name="l00834"></a>00834       res = -1;
<a name="l00835"></a>00835       <span class="keywordflow">break</span>;
<a name="l00836"></a>00836    }
<a name="l00837"></a>00837 
<a name="l00838"></a>00838    <span class="keywordflow">if</span> ((res != 1) &amp;&amp; (callid-&gt;<a class="code" href="structosp__callid.html#a77124bd5f7e31e6fffc19f335da0c23f">len</a> != 0)) {
<a name="l00839"></a>00839       callid-&gt;<a class="code" href="structosp__callid.html#af2f02dd4431344f38b58d78bee490fca">buf</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00840"></a>00840       callid-&gt;<a class="code" href="structosp__callid.html#a77124bd5f7e31e6fffc19f335da0c23f">len</a> = 0;
<a name="l00841"></a>00841    }
<a name="l00842"></a>00842 
<a name="l00843"></a>00843    <span class="keywordflow">return</span> res;
<a name="l00844"></a>00844 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aec25444bf96fbb06219720b4403cb60b"></a><!-- doxytag: member="app_osplookup.c::osp_create_provider" ref="aec25444bf96fbb06219720b4403cb60b" args="(struct ast_config *cfg, const char *provider)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osp_create_provider </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__config.html">ast_config</a> *&nbsp;</td>
          <td class="paramname"> <em>cfg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>provider</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Create OSP provider handle according to configuration. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>cfg</em>&nbsp;</td><td>OSP configuration </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>provider</em>&nbsp;</td><td>OSP provider context name </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>1 Success, 0 Failed, -1 Error </dd></dl>

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00181">181</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="asterisk_8c_source.html#l00257">ast_config_AST_KEY_DIR</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="config_8c_source.html#l00411">ast_variable_browse()</a>, <a class="el" href="app__osplookup_8c_source.html#l00138">osp_provider::authpolicy</a>, <a class="el" href="app__osplookup_8c_source.html#l00130">osp_provider::cacerts</a>, <a class="el" href="app__osplookup_8c_source.html#l00129">osp_provider::cacount</a>, <a class="el" href="app__osplookup_8c_source.html#l00139">osp_provider::defaultprotocol</a>, <a class="el" href="app__osplookup_8c_source.html#l00140">osp_provider::handle</a>, <a class="el" href="config_8h_source.html#l00081">ast_variable::lineno</a>, <a class="el" href="app__osplookup_8c_source.html#l00128">osp_provider::localcert</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="app__osplookup_8c_source.html#l00133">osp_provider::maxconnections</a>, <a class="el" href="config_8h_source.html#l00075">ast_variable::name</a>, <a class="el" href="app__osplookup_8c_source.html#l00126">osp_provider::name</a>, <a class="el" href="app__osplookup_8c_source.html#l00141">osp_provider::next</a>, <a class="el" href="config_8h_source.html#l00077">ast_variable::next</a>, <a class="el" href="app__osplookup_8c_source.html#l00114">OSP_AUDIT_URL</a>, <a class="el" href="app__osplookup_8c_source.html#l00067">OSP_AUTH_EXCLUSIVE</a>, <a class="el" href="app__osplookup_8c_source.html#l00065">OSP_AUTH_NO</a>, <a class="el" href="app__osplookup_8c_source.html#l00066">OSP_AUTH_YES</a>, <a class="el" href="app__osplookup_8c_source.html#l00118">OSP_CUSTOMER_ID</a>, <a class="el" href="app__osplookup_8c_source.html#l00113">OSP_DEF_AUTHPOLICY</a>, <a class="el" href="app__osplookup_8c_source.html#l00101">OSP_DEF_MAXCONNECTIONS</a>, <a class="el" href="app__osplookup_8c_source.html#l00122">OSP_DEF_PROTOCOL</a>, <a class="el" href="app__osplookup_8c_source.html#l00104">OSP_DEF_RETRYDELAY</a>, <a class="el" href="app__osplookup_8c_source.html#l00107">OSP_DEF_RETRYLIMIT</a>, <a class="el" href="app__osplookup_8c_source.html#l00110">OSP_DEF_TIMEOUT</a>, <a class="el" href="app__osplookup_8c_source.html#l00119">OSP_DEVICE_ID</a>, <a class="el" href="app__osplookup_8c_source.html#l00117">OSP_HTTP_PERSISTENCE</a>, <a class="el" href="app__osplookup_8c_source.html#l00095">OSP_INVALID_HANDLE</a>, <a class="el" href="app__osplookup_8c_source.html#l00115">OSP_LOCAL_VALIDATION</a>, <a class="el" href="app__osplookup_8c_source.html#l00099">OSP_MAX_CERTS</a>, <a class="el" href="app__osplookup_8c_source.html#l00103">OSP_MAX_MAXCONNECTIONS</a>, <a class="el" href="app__osplookup_8c_source.html#l00106">OSP_MAX_RETRYDELAY</a>, <a class="el" href="app__osplookup_8c_source.html#l00109">OSP_MAX_RETRYLIMIT</a>, <a class="el" href="app__osplookup_8c_source.html#l00100">OSP_MAX_SRVS</a>, <a class="el" href="app__osplookup_8c_source.html#l00112">OSP_MAX_TIMEOUT</a>, <a class="el" href="app__osplookup_8c_source.html#l00102">OSP_MIN_MAXCONNECTIONS</a>, <a class="el" href="app__osplookup_8c_source.html#l00105">OSP_MIN_RETRYDELAY</a>, <a class="el" href="app__osplookup_8c_source.html#l00108">OSP_MIN_RETRYLIMIT</a>, <a class="el" href="app__osplookup_8c_source.html#l00111">OSP_MIN_TIMEOUT</a>, <a class="el" href="app__osplookup_8c_source.html#l00078">OSP_PROT_H323</a>, <a class="el" href="app__osplookup_8c_source.html#l00080">OSP_PROT_IAX</a>, <a class="el" href="app__osplookup_8c_source.html#l00081">OSP_PROT_OTHER</a>, <a class="el" href="app__osplookup_8c_source.html#l00079">OSP_PROT_SIP</a>, <a class="el" href="app__osplookup_8c_source.html#l00116">OSP_SSL_LIFETIME</a>, <a class="el" href="app__osplookup_8c_source.html#l00127">osp_provider::privatekey</a>, <a class="el" href="app__osplookup_8c_source.html#l00134">osp_provider::retrydelay</a>, <a class="el" href="app__osplookup_8c_source.html#l00135">osp_provider::retrylimit</a>, <a class="el" href="app__osplookup_8c_source.html#l00137">osp_provider::source</a>, <a class="el" href="app__osplookup_8c_source.html#l00131">osp_provider::spcount</a>, <a class="el" href="app__osplookup_8c_source.html#l00132">osp_provider::srvpoints</a>, <a class="el" href="app__osplookup_8c_source.html#l00136">osp_provider::timeout</a>, and <a class="el" href="config_8h_source.html#l00076">ast_variable::value</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l01772">osp_load()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00184"></a>00184 {
<a name="l00185"></a>00185    <span class="keywordtype">int</span> res = 0;
<a name="l00186"></a>00186    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a>* v;
<a name="l00187"></a>00187    <span class="keyword">struct </span><a class="code" href="structosp__provider.html">osp_provider</a>* p;
<a name="l00188"></a>00188    OSPTPRIVATEKEY <a class="code" href="structosp__provider.html#aa95813263e6669f4a71e85a7434ff44f">privatekey</a>;
<a name="l00189"></a>00189    OSPT_CERT <a class="code" href="structosp__provider.html#aa9a3e60cb8c376194f7560fb77f72209">localcert</a>;
<a name="l00190"></a>00190    OSPT_CERT <a class="code" href="structosp__provider.html#aff0310e195ae63002674b3e82ce8957c">cacerts</a>[<a class="code" href="app__osplookup_8c.html#a7e5aa3485d963d46940150952788067e">OSP_MAX_CERTS</a>];
<a name="l00191"></a>00191    <span class="keyword">const</span> OSPT_CERT* pcacerts[<a class="code" href="app__osplookup_8c.html#a7e5aa3485d963d46940150952788067e">OSP_MAX_CERTS</a>];
<a name="l00192"></a>00192    <span class="keyword">const</span> <span class="keywordtype">char</span>* psrvpoints[<a class="code" href="app__osplookup_8c.html#ac79664c1f67bbb4b4569b63f3221a037">OSP_MAX_SRVS</a>];
<a name="l00193"></a>00193    <span class="keywordtype">int</span> t, i, j, error = OSPC_ERR_NO_ERROR;
<a name="l00194"></a>00194 
<a name="l00195"></a>00195    <span class="keywordflow">if</span> (!(p = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*p)))) {
<a name="l00196"></a>00196       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Out of memory\n&quot;</span>);
<a name="l00197"></a>00197       <span class="keywordflow">return</span> -1;
<a name="l00198"></a>00198    }
<a name="l00199"></a>00199 
<a name="l00200"></a>00200    <span class="comment">/* ast_calloc has set 0 in p */</span>
<a name="l00201"></a>00201    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(p-&gt;<a class="code" href="structosp__provider.html#ac475c259e73fbefdd58e2439b3f3beb8">name</a>, provider, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structosp__provider.html#ac475c259e73fbefdd58e2439b3f3beb8">name</a>));
<a name="l00202"></a>00202    snprintf(p-&gt;<a class="code" href="structosp__provider.html#aa95813263e6669f4a71e85a7434ff44f">privatekey</a>, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structosp__provider.html#aa95813263e6669f4a71e85a7434ff44f">privatekey</a>), <span class="stringliteral">&quot;%s/%s-privatekey.pem&quot;</span>, <a class="code" href="paths_8h.html#a0334adace37c0e8de8ea89c8651336a2">ast_config_AST_KEY_DIR</a>, provider);
<a name="l00203"></a>00203    snprintf(p-&gt;<a class="code" href="structosp__provider.html#aa9a3e60cb8c376194f7560fb77f72209">localcert</a>, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structosp__provider.html#aa9a3e60cb8c376194f7560fb77f72209">localcert</a>), <span class="stringliteral">&quot;%s/%s-localcert.pem&quot;</span>, <a class="code" href="paths_8h.html#a0334adace37c0e8de8ea89c8651336a2">ast_config_AST_KEY_DIR</a>, provider);
<a name="l00204"></a>00204    snprintf(p-&gt;<a class="code" href="structosp__provider.html#aff0310e195ae63002674b3e82ce8957c">cacerts</a>[0], <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structosp__provider.html#aff0310e195ae63002674b3e82ce8957c">cacerts</a>[0]), <span class="stringliteral">&quot;%s/%s-cacert_0.pem&quot;</span>, <a class="code" href="paths_8h.html#a0334adace37c0e8de8ea89c8651336a2">ast_config_AST_KEY_DIR</a>, provider);
<a name="l00205"></a>00205    p-&gt;<a class="code" href="structosp__provider.html#a6eaff88757b638bcb0ef258104e55421">maxconnections</a> = <a class="code" href="app__osplookup_8c.html#a3bed836b5b31244a172edbd2349cc887">OSP_DEF_MAXCONNECTIONS</a>;
<a name="l00206"></a>00206    p-&gt;<a class="code" href="structosp__provider.html#a9d15efab2b27a01e4bb614122f9f1085">retrydelay</a> = <a class="code" href="app__osplookup_8c.html#a95dd1b545000ce7fc31a6dd3b53d3d2d">OSP_DEF_RETRYDELAY</a>;
<a name="l00207"></a>00207    p-&gt;<a class="code" href="structosp__provider.html#a68c251e358f5e5a3116608cbb1e0d25e">retrylimit</a> = <a class="code" href="app__osplookup_8c.html#ad36c654250d30dc9f04f066078652ffd">OSP_DEF_RETRYLIMIT</a>;
<a name="l00208"></a>00208    p-&gt;<a class="code" href="structosp__provider.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a> = <a class="code" href="app__osplookup_8c.html#af41fd1b7d5fe4fab7275c19e5be93faf">OSP_DEF_TIMEOUT</a>;
<a name="l00209"></a>00209    p-&gt;<a class="code" href="structosp__provider.html#a635fd679943876b710e3c99e24907dc3">authpolicy</a> = <a class="code" href="app__osplookup_8c.html#a6ac883183e1140c2f254abca99cae0a2">OSP_DEF_AUTHPOLICY</a>;
<a name="l00210"></a>00210    p-&gt;<a class="code" href="structosp__provider.html#a474b7bd67014a3d0988377f2d6bd8115">defaultprotocol</a> = <a class="code" href="app__osplookup_8c.html#ac9ea65ddfcb75c30bd9a976bb3ac61a7">OSP_DEF_PROTOCOL</a>;
<a name="l00211"></a>00211    p-&gt;<a class="code" href="structosp__provider.html#a62668053aefe0d5985c4ae7451db8486">handle</a> = <a class="code" href="app__osplookup_8c.html#a693603e5e4556641af06c8ebec1dffc5">OSP_INVALID_HANDLE</a>;
<a name="l00212"></a>00212 
<a name="l00213"></a>00213    v = <a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(cfg, provider);
<a name="l00214"></a>00214    <span class="keywordflow">while</span>(v) {
<a name="l00215"></a>00215       <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;privatekey&quot;</span>)) {
<a name="l00216"></a>00216          <span class="keywordflow">if</span> (v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>[0] == <span class="charliteral">&apos;/&apos;</span>) {
<a name="l00217"></a>00217             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(p-&gt;<a class="code" href="structosp__provider.html#aa95813263e6669f4a71e85a7434ff44f">privatekey</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structosp__provider.html#aa95813263e6669f4a71e85a7434ff44f">privatekey</a>));
<a name="l00218"></a>00218          } <span class="keywordflow">else</span> {
<a name="l00219"></a>00219             snprintf(p-&gt;<a class="code" href="structosp__provider.html#aa95813263e6669f4a71e85a7434ff44f">privatekey</a>, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structosp__provider.html#aa95813263e6669f4a71e85a7434ff44f">privatekey</a>), <span class="stringliteral">&quot;%s/%s&quot;</span>, <a class="code" href="paths_8h.html#a0334adace37c0e8de8ea89c8651336a2">ast_config_AST_KEY_DIR</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l00220"></a>00220          }
<a name="l00221"></a>00221          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: privatekey &apos;%s&apos;\n&quot;</span>, p-&gt;<a class="code" href="structosp__provider.html#aa95813263e6669f4a71e85a7434ff44f">privatekey</a>);
<a name="l00222"></a>00222       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;localcert&quot;</span>)) {
<a name="l00223"></a>00223          <span class="keywordflow">if</span> (v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>[0] == <span class="charliteral">&apos;/&apos;</span>) {
<a name="l00224"></a>00224             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(p-&gt;<a class="code" href="structosp__provider.html#aa9a3e60cb8c376194f7560fb77f72209">localcert</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structosp__provider.html#aa9a3e60cb8c376194f7560fb77f72209">localcert</a>));
<a name="l00225"></a>00225          } <span class="keywordflow">else</span> {
<a name="l00226"></a>00226             snprintf(p-&gt;<a class="code" href="structosp__provider.html#aa9a3e60cb8c376194f7560fb77f72209">localcert</a>, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structosp__provider.html#aa9a3e60cb8c376194f7560fb77f72209">localcert</a>), <span class="stringliteral">&quot;%s/%s&quot;</span>, <a class="code" href="paths_8h.html#a0334adace37c0e8de8ea89c8651336a2">ast_config_AST_KEY_DIR</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l00227"></a>00227          }
<a name="l00228"></a>00228          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: localcert &apos;%s&apos;\n&quot;</span>, p-&gt;<a class="code" href="structosp__provider.html#aa9a3e60cb8c376194f7560fb77f72209">localcert</a>);
<a name="l00229"></a>00229       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;cacert&quot;</span>)) {
<a name="l00230"></a>00230          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structosp__provider.html#a9cb4d699e54c65c7788b04f05a651854">cacount</a> &lt; <a class="code" href="app__osplookup_8c.html#a7e5aa3485d963d46940150952788067e">OSP_MAX_CERTS</a>) {
<a name="l00231"></a>00231             <span class="keywordflow">if</span> (v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>[0] == <span class="charliteral">&apos;/&apos;</span>) {
<a name="l00232"></a>00232                <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(p-&gt;<a class="code" href="structosp__provider.html#aff0310e195ae63002674b3e82ce8957c">cacerts</a>[p-&gt;<a class="code" href="structosp__provider.html#a9cb4d699e54c65c7788b04f05a651854">cacount</a>], v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structosp__provider.html#aff0310e195ae63002674b3e82ce8957c">cacerts</a>[0]));
<a name="l00233"></a>00233             } <span class="keywordflow">else</span> {
<a name="l00234"></a>00234                snprintf(p-&gt;<a class="code" href="structosp__provider.html#aff0310e195ae63002674b3e82ce8957c">cacerts</a>[p-&gt;<a class="code" href="structosp__provider.html#a9cb4d699e54c65c7788b04f05a651854">cacount</a>], <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structosp__provider.html#aff0310e195ae63002674b3e82ce8957c">cacerts</a>[0]), <span class="stringliteral">&quot;%s/%s&quot;</span>, <a class="code" href="paths_8h.html#a0334adace37c0e8de8ea89c8651336a2">ast_config_AST_KEY_DIR</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l00235"></a>00235             }
<a name="l00236"></a>00236             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: cacert[%d]: &apos;%s&apos;\n&quot;</span>, p-&gt;<a class="code" href="structosp__provider.html#a9cb4d699e54c65c7788b04f05a651854">cacount</a>, p-&gt;<a class="code" href="structosp__provider.html#aff0310e195ae63002674b3e82ce8957c">cacerts</a>[p-&gt;<a class="code" href="structosp__provider.html#a9cb4d699e54c65c7788b04f05a651854">cacount</a>]);
<a name="l00237"></a>00237             p-&gt;<a class="code" href="structosp__provider.html#a9cb4d699e54c65c7788b04f05a651854">cacount</a>++;
<a name="l00238"></a>00238          } <span class="keywordflow">else</span> {
<a name="l00239"></a>00239             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;OSP: Too many CA Certificates at line %d\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l00240"></a>00240          }
<a name="l00241"></a>00241       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;servicepoint&quot;</span>)) {
<a name="l00242"></a>00242          <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structosp__provider.html#a1b0451cb98b8626ab4b6f7e3af8f1b94">spcount</a> &lt; <a class="code" href="app__osplookup_8c.html#ac79664c1f67bbb4b4569b63f3221a037">OSP_MAX_SRVS</a>) {
<a name="l00243"></a>00243             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(p-&gt;<a class="code" href="structosp__provider.html#a8a67a5c7679f22062602451174227008">srvpoints</a>[p-&gt;<a class="code" href="structosp__provider.html#a1b0451cb98b8626ab4b6f7e3af8f1b94">spcount</a>], v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structosp__provider.html#a8a67a5c7679f22062602451174227008">srvpoints</a>[0]));
<a name="l00244"></a>00244             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: servicepoint[%d]: &apos;%s&apos;\n&quot;</span>, p-&gt;<a class="code" href="structosp__provider.html#a1b0451cb98b8626ab4b6f7e3af8f1b94">spcount</a>, p-&gt;<a class="code" href="structosp__provider.html#a8a67a5c7679f22062602451174227008">srvpoints</a>[p-&gt;<a class="code" href="structosp__provider.html#a1b0451cb98b8626ab4b6f7e3af8f1b94">spcount</a>]);
<a name="l00245"></a>00245             p-&gt;<a class="code" href="structosp__provider.html#a1b0451cb98b8626ab4b6f7e3af8f1b94">spcount</a>++;
<a name="l00246"></a>00246          } <span class="keywordflow">else</span> {
<a name="l00247"></a>00247             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;OSP: Too many Service Points at line %d\n&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l00248"></a>00248          }
<a name="l00249"></a>00249       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;maxconnections&quot;</span>)) {
<a name="l00250"></a>00250          <span class="keywordflow">if</span> ((sscanf(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;%30d&quot;</span>, &amp;t) == 1) &amp;&amp; (t &gt;= <a class="code" href="app__osplookup_8c.html#a5d5f1ef1746ee3004e581ffa21317f18">OSP_MIN_MAXCONNECTIONS</a>) &amp;&amp; (t &lt;= <a class="code" href="app__osplookup_8c.html#ada8f79f9966042ba75e3b87f9032341d">OSP_MAX_MAXCONNECTIONS</a>)) {
<a name="l00251"></a>00251             p-&gt;<a class="code" href="structosp__provider.html#a6eaff88757b638bcb0ef258104e55421">maxconnections</a> = t;
<a name="l00252"></a>00252             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: maxconnections &apos;%d&apos;\n&quot;</span>, t);
<a name="l00253"></a>00253          } <span class="keywordflow">else</span> {
<a name="l00254"></a>00254             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;OSP: maxconnections should be an integer from %d to %d, not &apos;%s&apos; at line %d\n&quot;</span>,
<a name="l00255"></a>00255                <a class="code" href="app__osplookup_8c.html#a5d5f1ef1746ee3004e581ffa21317f18">OSP_MIN_MAXCONNECTIONS</a>, <a class="code" href="app__osplookup_8c.html#ada8f79f9966042ba75e3b87f9032341d">OSP_MAX_MAXCONNECTIONS</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l00256"></a>00256          }
<a name="l00257"></a>00257       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;retrydelay&quot;</span>)) {
<a name="l00258"></a>00258          <span class="keywordflow">if</span> ((sscanf(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;%30d&quot;</span>, &amp;t) == 1) &amp;&amp; (t &gt;= <a class="code" href="app__osplookup_8c.html#aecc0ca5e6e73e6f92cc828c409801700">OSP_MIN_RETRYDELAY</a>) &amp;&amp; (t &lt;= <a class="code" href="app__osplookup_8c.html#aed8af19a7b6dc236071e11d067d3222a">OSP_MAX_RETRYDELAY</a>)) {
<a name="l00259"></a>00259             p-&gt;<a class="code" href="structosp__provider.html#a9d15efab2b27a01e4bb614122f9f1085">retrydelay</a> = t;
<a name="l00260"></a>00260             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: retrydelay &apos;%d&apos;\n&quot;</span>, t);
<a name="l00261"></a>00261          } <span class="keywordflow">else</span> {
<a name="l00262"></a>00262             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;OSP: retrydelay should be an integer from %d to %d, not &apos;%s&apos; at line %d\n&quot;</span>,
<a name="l00263"></a>00263                <a class="code" href="app__osplookup_8c.html#aecc0ca5e6e73e6f92cc828c409801700">OSP_MIN_RETRYDELAY</a>, <a class="code" href="app__osplookup_8c.html#aed8af19a7b6dc236071e11d067d3222a">OSP_MAX_RETRYDELAY</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l00264"></a>00264          }
<a name="l00265"></a>00265       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;retrylimit&quot;</span>)) {
<a name="l00266"></a>00266          <span class="keywordflow">if</span> ((sscanf(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;%30d&quot;</span>, &amp;t) == 1) &amp;&amp; (t &gt;= <a class="code" href="app__osplookup_8c.html#a258abbda51de2390bf0185bbbd4040ca">OSP_MIN_RETRYLIMIT</a>) &amp;&amp; (t &lt;= <a class="code" href="app__osplookup_8c.html#a345b7fdd7075bffae65d67aaf300fcb9">OSP_MAX_RETRYLIMIT</a>)) {
<a name="l00267"></a>00267             p-&gt;<a class="code" href="structosp__provider.html#a68c251e358f5e5a3116608cbb1e0d25e">retrylimit</a> = t;
<a name="l00268"></a>00268             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: retrylimit &apos;%d&apos;\n&quot;</span>, t);
<a name="l00269"></a>00269          } <span class="keywordflow">else</span> {
<a name="l00270"></a>00270             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;OSP: retrylimit should be an integer from %d to %d, not &apos;%s&apos; at line %d\n&quot;</span>,
<a name="l00271"></a>00271                <a class="code" href="app__osplookup_8c.html#a258abbda51de2390bf0185bbbd4040ca">OSP_MIN_RETRYLIMIT</a>, <a class="code" href="app__osplookup_8c.html#a345b7fdd7075bffae65d67aaf300fcb9">OSP_MAX_RETRYLIMIT</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l00272"></a>00272          }
<a name="l00273"></a>00273       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;timeout&quot;</span>)) {
<a name="l00274"></a>00274          <span class="keywordflow">if</span> ((sscanf(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;%30d&quot;</span>, &amp;t) == 1) &amp;&amp; (t &gt;= <a class="code" href="app__osplookup_8c.html#a73d87c526fda549fef6b81a22da2090a">OSP_MIN_TIMEOUT</a>) &amp;&amp; (t &lt;= <a class="code" href="app__osplookup_8c.html#ac7a3ff9d63c0e30ee94430056b2ac82c">OSP_MAX_TIMEOUT</a>)) {
<a name="l00275"></a>00275             p-&gt;<a class="code" href="structosp__provider.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a> = t;
<a name="l00276"></a>00276             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: timeout &apos;%d&apos;\n&quot;</span>, t);
<a name="l00277"></a>00277          } <span class="keywordflow">else</span> {
<a name="l00278"></a>00278             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;OSP: timeout should be an integer from %d to %d, not &apos;%s&apos; at line %d\n&quot;</span>,
<a name="l00279"></a>00279                <a class="code" href="app__osplookup_8c.html#a73d87c526fda549fef6b81a22da2090a">OSP_MIN_TIMEOUT</a>, <a class="code" href="app__osplookup_8c.html#ac7a3ff9d63c0e30ee94430056b2ac82c">OSP_MAX_TIMEOUT</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l00280"></a>00280          }
<a name="l00281"></a>00281       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;source&quot;</span>)) {
<a name="l00282"></a>00282          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(p-&gt;<a class="code" href="structosp__provider.html#aaf4b604d6f82f265bafb3f5810ffd0ef">source</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structosp__provider.html#aaf4b604d6f82f265bafb3f5810ffd0ef">source</a>));
<a name="l00283"></a>00283          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: source &apos;%s&apos;\n&quot;</span>, p-&gt;<a class="code" href="structosp__provider.html#aaf4b604d6f82f265bafb3f5810ffd0ef">source</a>);
<a name="l00284"></a>00284       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;authpolicy&quot;</span>)) {
<a name="l00285"></a>00285          <span class="keywordflow">if</span> ((sscanf(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;%30d&quot;</span>, &amp;t) == 1) &amp;&amp; ((t == <a class="code" href="app__osplookup_8c.html#a973bb7ee8e420cae3117b3d08d395fcbabdd97707a7a03ac645574bd924a77685">OSP_AUTH_NO</a>) || (t == <a class="code" href="app__osplookup_8c.html#a973bb7ee8e420cae3117b3d08d395fcba0d4b098bf4a527dd729e74819bb52b9c">OSP_AUTH_YES</a>) || (t == <a class="code" href="app__osplookup_8c.html#a973bb7ee8e420cae3117b3d08d395fcba85ba776173c4770738603da1a8c2cebc">OSP_AUTH_EXCLUSIVE</a>))) {
<a name="l00286"></a>00286             p-&gt;<a class="code" href="structosp__provider.html#a635fd679943876b710e3c99e24907dc3">authpolicy</a> = t;
<a name="l00287"></a>00287             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: authpolicy &apos;%d&apos;\n&quot;</span>, t);
<a name="l00288"></a>00288          } <span class="keywordflow">else</span> {
<a name="l00289"></a>00289             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;OSP: authpolicy should be %d, %d or %d, not &apos;%s&apos; at line %d\n&quot;</span>,
<a name="l00290"></a>00290                <a class="code" href="app__osplookup_8c.html#a973bb7ee8e420cae3117b3d08d395fcbabdd97707a7a03ac645574bd924a77685">OSP_AUTH_NO</a>, <a class="code" href="app__osplookup_8c.html#a973bb7ee8e420cae3117b3d08d395fcba0d4b098bf4a527dd729e74819bb52b9c">OSP_AUTH_YES</a>, <a class="code" href="app__osplookup_8c.html#a973bb7ee8e420cae3117b3d08d395fcba85ba776173c4770738603da1a8c2cebc">OSP_AUTH_EXCLUSIVE</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l00291"></a>00291          }
<a name="l00292"></a>00292       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;defaultprotocol&quot;</span>)) {
<a name="l00293"></a>00293          <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <a class="code" href="app__osplookup_8c.html#a2d59871d2b33932ab6cd5acca414c2dc">OSP_PROT_SIP</a>)) {
<a name="l00294"></a>00294             p-&gt;<a class="code" href="structosp__provider.html#a474b7bd67014a3d0988377f2d6bd8115">defaultprotocol</a> = <a class="code" href="app__osplookup_8c.html#a2d59871d2b33932ab6cd5acca414c2dc">OSP_PROT_SIP</a>;
<a name="l00295"></a>00295             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: default protocol &apos;%s&apos;\n&quot;</span>, p-&gt;<a class="code" href="structosp__provider.html#a474b7bd67014a3d0988377f2d6bd8115">defaultprotocol</a>);
<a name="l00296"></a>00296          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <a class="code" href="app__osplookup_8c.html#aece924ab64f6f37fb6b01b24816ecf7d">OSP_PROT_H323</a>)) {
<a name="l00297"></a>00297             p-&gt;<a class="code" href="structosp__provider.html#a474b7bd67014a3d0988377f2d6bd8115">defaultprotocol</a> = <a class="code" href="app__osplookup_8c.html#aece924ab64f6f37fb6b01b24816ecf7d">OSP_PROT_H323</a>;
<a name="l00298"></a>00298             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: default protocol &apos;%s&apos;\n&quot;</span>, p-&gt;<a class="code" href="structosp__provider.html#a474b7bd67014a3d0988377f2d6bd8115">defaultprotocol</a>);
<a name="l00299"></a>00299          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <a class="code" href="app__osplookup_8c.html#a37c83ec0ffd2dadcd13ab875afa37025">OSP_PROT_IAX</a>)) {
<a name="l00300"></a>00300             p-&gt;<a class="code" href="structosp__provider.html#a474b7bd67014a3d0988377f2d6bd8115">defaultprotocol</a> = <a class="code" href="app__osplookup_8c.html#a37c83ec0ffd2dadcd13ab875afa37025">OSP_PROT_IAX</a>;
<a name="l00301"></a>00301             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: default protocol &apos;%s&apos;\n&quot;</span>, p-&gt;<a class="code" href="structosp__provider.html#a474b7bd67014a3d0988377f2d6bd8115">defaultprotocol</a>);
<a name="l00302"></a>00302          } <span class="keywordflow">else</span> {
<a name="l00303"></a>00303             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;OSP: default protocol should be %s, %s, %s, or %s not &apos;%s&apos; at line %d\n&quot;</span>,
<a name="l00304"></a>00304                <a class="code" href="app__osplookup_8c.html#a2d59871d2b33932ab6cd5acca414c2dc">OSP_PROT_SIP</a>, <a class="code" href="app__osplookup_8c.html#aece924ab64f6f37fb6b01b24816ecf7d">OSP_PROT_H323</a>, <a class="code" href="app__osplookup_8c.html#a37c83ec0ffd2dadcd13ab875afa37025">OSP_PROT_IAX</a>, <a class="code" href="app__osplookup_8c.html#a97ded2bda6516df25b260682ac8952d8">OSP_PROT_OTHER</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, v-&gt;<a class="code" href="structast__variable.html#a501b314f49b3a9ff6e7be599d94686ee">lineno</a>);
<a name="l00305"></a>00305          }
<a name="l00306"></a>00306       }
<a name="l00307"></a>00307       v = v-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>;
<a name="l00308"></a>00308    }
<a name="l00309"></a>00309 
<a name="l00310"></a>00310    error = OSPPUtilLoadPEMPrivateKey((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)p-&gt;<a class="code" href="structosp__provider.html#aa95813263e6669f4a71e85a7434ff44f">privatekey</a>, &amp;privatekey);
<a name="l00311"></a>00311    <span class="keywordflow">if</span> (error != OSPC_ERR_NO_ERROR) {
<a name="l00312"></a>00312       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;OSP: Unable to load privatekey &apos;%s&apos;, error &apos;%d&apos;\n&quot;</span>, p-&gt;<a class="code" href="structosp__provider.html#aa95813263e6669f4a71e85a7434ff44f">privatekey</a>, error);
<a name="l00313"></a>00313       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(p);
<a name="l00314"></a>00314       <span class="keywordflow">return</span> 0;
<a name="l00315"></a>00315    }
<a name="l00316"></a>00316 
<a name="l00317"></a>00317    error = OSPPUtilLoadPEMCert((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)p-&gt;<a class="code" href="structosp__provider.html#aa9a3e60cb8c376194f7560fb77f72209">localcert</a>, &amp;localcert);
<a name="l00318"></a>00318    <span class="keywordflow">if</span> (error != OSPC_ERR_NO_ERROR) {
<a name="l00319"></a>00319       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;OSP: Unable to load localcert &apos;%s&apos;, error &apos;%d&apos;\n&quot;</span>, p-&gt;<a class="code" href="structosp__provider.html#aa9a3e60cb8c376194f7560fb77f72209">localcert</a>, error);
<a name="l00320"></a>00320       <span class="keywordflow">if</span> (privatekey.PrivateKeyData) {
<a name="l00321"></a>00321          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(privatekey.PrivateKeyData);
<a name="l00322"></a>00322       }
<a name="l00323"></a>00323       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(p);
<a name="l00324"></a>00324       <span class="keywordflow">return</span> 0;
<a name="l00325"></a>00325    }
<a name="l00326"></a>00326 
<a name="l00327"></a>00327    <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structosp__provider.html#a9cb4d699e54c65c7788b04f05a651854">cacount</a> &lt; 1) {
<a name="l00328"></a>00328       snprintf(p-&gt;<a class="code" href="structosp__provider.html#aff0310e195ae63002674b3e82ce8957c">cacerts</a>[p-&gt;<a class="code" href="structosp__provider.html#a9cb4d699e54c65c7788b04f05a651854">cacount</a>], <span class="keyword">sizeof</span>(p-&gt;<a class="code" href="structosp__provider.html#aff0310e195ae63002674b3e82ce8957c">cacerts</a>[0]), <span class="stringliteral">&quot;%s/%s-cacert.pem&quot;</span>, <a class="code" href="paths_8h.html#a0334adace37c0e8de8ea89c8651336a2">ast_config_AST_KEY_DIR</a>, provider);
<a name="l00329"></a>00329       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: cacert[%d]: &apos;%s&apos;\n&quot;</span>, p-&gt;<a class="code" href="structosp__provider.html#a9cb4d699e54c65c7788b04f05a651854">cacount</a>, p-&gt;<a class="code" href="structosp__provider.html#aff0310e195ae63002674b3e82ce8957c">cacerts</a>[p-&gt;<a class="code" href="structosp__provider.html#a9cb4d699e54c65c7788b04f05a651854">cacount</a>]);
<a name="l00330"></a>00330       p-&gt;<a class="code" href="structosp__provider.html#a9cb4d699e54c65c7788b04f05a651854">cacount</a>++;
<a name="l00331"></a>00331    }
<a name="l00332"></a>00332    <span class="keywordflow">for</span> (i = 0; i &lt; p-&gt;<a class="code" href="structosp__provider.html#a9cb4d699e54c65c7788b04f05a651854">cacount</a>; i++) {
<a name="l00333"></a>00333       error = OSPPUtilLoadPEMCert((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)p-&gt;<a class="code" href="structosp__provider.html#aff0310e195ae63002674b3e82ce8957c">cacerts</a>[i], &amp;cacerts[i]);
<a name="l00334"></a>00334       <span class="keywordflow">if</span> (error != OSPC_ERR_NO_ERROR) {
<a name="l00335"></a>00335          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;OSP: Unable to load cacert &apos;%s&apos;, error &apos;%d&apos;\n&quot;</span>, p-&gt;<a class="code" href="structosp__provider.html#aff0310e195ae63002674b3e82ce8957c">cacerts</a>[i], error);
<a name="l00336"></a>00336          <span class="keywordflow">for</span> (j = 0; j &lt; i; j++) {
<a name="l00337"></a>00337             <span class="keywordflow">if</span> (cacerts[j].CertData) {
<a name="l00338"></a>00338                <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(cacerts[j].CertData);
<a name="l00339"></a>00339             }
<a name="l00340"></a>00340          }
<a name="l00341"></a>00341          <span class="keywordflow">if</span> (localcert.CertData) {
<a name="l00342"></a>00342             <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(localcert.CertData);
<a name="l00343"></a>00343          }
<a name="l00344"></a>00344          <span class="keywordflow">if</span> (privatekey.PrivateKeyData) {
<a name="l00345"></a>00345             <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(privatekey.PrivateKeyData);
<a name="l00346"></a>00346          }
<a name="l00347"></a>00347          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(p);
<a name="l00348"></a>00348          <span class="keywordflow">return</span> 0;
<a name="l00349"></a>00349       }
<a name="l00350"></a>00350       pcacerts[i] = &amp;cacerts[i];
<a name="l00351"></a>00351    }
<a name="l00352"></a>00352 
<a name="l00353"></a>00353    <span class="keywordflow">for</span> (i = 0; i &lt; p-&gt;<a class="code" href="structosp__provider.html#a1b0451cb98b8626ab4b6f7e3af8f1b94">spcount</a>; i++) {
<a name="l00354"></a>00354       psrvpoints[i] = p-&gt;<a class="code" href="structosp__provider.html#a8a67a5c7679f22062602451174227008">srvpoints</a>[i];
<a name="l00355"></a>00355    }
<a name="l00356"></a>00356 
<a name="l00357"></a>00357    error = OSPPProviderNew(
<a name="l00358"></a>00358       p-&gt;<a class="code" href="structosp__provider.html#a1b0451cb98b8626ab4b6f7e3af8f1b94">spcount</a>,
<a name="l00359"></a>00359       psrvpoints,
<a name="l00360"></a>00360       NULL,
<a name="l00361"></a>00361       <a class="code" href="app__osplookup_8c.html#ac0bbc59083ee029dacfb9ff39944545c">OSP_AUDIT_URL</a>,
<a name="l00362"></a>00362       &amp;privatekey,
<a name="l00363"></a>00363       &amp;localcert,
<a name="l00364"></a>00364       p-&gt;<a class="code" href="structosp__provider.html#a9cb4d699e54c65c7788b04f05a651854">cacount</a>,
<a name="l00365"></a>00365       pcacerts,
<a name="l00366"></a>00366       <a class="code" href="app__osplookup_8c.html#adb174b635395f4dfa6aa18c620860ee9">OSP_LOCAL_VALIDATION</a>,
<a name="l00367"></a>00367       <a class="code" href="app__osplookup_8c.html#aa3e4c2f6886beeb3167baea11338365b">OSP_SSL_LIFETIME</a>,
<a name="l00368"></a>00368       p-&gt;<a class="code" href="structosp__provider.html#a6eaff88757b638bcb0ef258104e55421">maxconnections</a>,
<a name="l00369"></a>00369       <a class="code" href="app__osplookup_8c.html#a70ba2ad1a2c176493519a8401688f4a4">OSP_HTTP_PERSISTENCE</a>,
<a name="l00370"></a>00370       p-&gt;<a class="code" href="structosp__provider.html#a9d15efab2b27a01e4bb614122f9f1085">retrydelay</a>,
<a name="l00371"></a>00371       p-&gt;<a class="code" href="structosp__provider.html#a68c251e358f5e5a3116608cbb1e0d25e">retrylimit</a>,
<a name="l00372"></a>00372       p-&gt;<a class="code" href="structosp__provider.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a>,
<a name="l00373"></a>00373       <a class="code" href="app__osplookup_8c.html#adb4205a9cf5fb9fb31cb22b73d685e02">OSP_CUSTOMER_ID</a>,
<a name="l00374"></a>00374       <a class="code" href="app__osplookup_8c.html#ab886d2f17400b1c84a703f2a78703f71">OSP_DEVICE_ID</a>,
<a name="l00375"></a>00375       &amp;p-&gt;<a class="code" href="structosp__provider.html#a62668053aefe0d5985c4ae7451db8486">handle</a>);
<a name="l00376"></a>00376    <span class="keywordflow">if</span> (error != OSPC_ERR_NO_ERROR) {
<a name="l00377"></a>00377       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;OSP: Unable to create provider &apos;%s&apos;, error &apos;%d&apos;\n&quot;</span>, provider, error);
<a name="l00378"></a>00378       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(p);
<a name="l00379"></a>00379       res = -1;
<a name="l00380"></a>00380    } <span class="keywordflow">else</span> {
<a name="l00381"></a>00381       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: provider &apos;%s&apos;\n&quot;</span>, provider);
<a name="l00382"></a>00382       <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;osplock);
<a name="l00383"></a>00383       p-&gt;<a class="code" href="structosp__provider.html#a63a14d2d4363005a28ebcd7449452d43">next</a> = <a class="code" href="app__osplookup_8c.html#ac9590e73571584ed17bed31f03b87900">ospproviders</a>;
<a name="l00384"></a>00384       <a class="code" href="app__osplookup_8c.html#ac9590e73571584ed17bed31f03b87900">ospproviders</a> = p;
<a name="l00385"></a>00385       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;osplock);
<a name="l00386"></a>00386       res = 1;
<a name="l00387"></a>00387    }
<a name="l00388"></a>00388 
<a name="l00389"></a>00389    <span class="keywordflow">for</span> (i = 0; i &lt; p-&gt;<a class="code" href="structosp__provider.html#a9cb4d699e54c65c7788b04f05a651854">cacount</a>; i++) {
<a name="l00390"></a>00390       <span class="keywordflow">if</span> (cacerts[i].CertData) {
<a name="l00391"></a>00391          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(cacerts[i].CertData);
<a name="l00392"></a>00392       }
<a name="l00393"></a>00393    }
<a name="l00394"></a>00394    <span class="keywordflow">if</span> (localcert.CertData) {
<a name="l00395"></a>00395       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(localcert.CertData);
<a name="l00396"></a>00396    }
<a name="l00397"></a>00397    <span class="keywordflow">if</span> (privatekey.PrivateKeyData) {
<a name="l00398"></a>00398       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(privatekey.PrivateKeyData);
<a name="l00399"></a>00399    }
<a name="l00400"></a>00400 
<a name="l00401"></a>00401    <span class="keywordflow">return</span> res;
<a name="l00402"></a>00402 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aec704b16f5e3d6367e23b9cb3555d87a"></a><!-- doxytag: member="app_osplookup.c::osp_create_transaction" ref="aec704b16f5e3d6367e23b9cb3555d87a" args="(const char *provider, int *transaction, unsigned int sourcesize, char *source)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osp_create_transaction </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>provider</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>transaction</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>sourcesize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>source</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Create OSP transaction handle. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>provider</em>&nbsp;</td><td>OSP provider context name </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>transaction</em>&nbsp;</td><td>OSP transaction handle, output </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>sourcesize</em>&nbsp;</td><td>Size of source buffer, in/output </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>source</em>&nbsp;</td><td>Source of provider, output </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>1 Success, 0 Failed, -1 Error </dd></dl>

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00441">441</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>References <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="app__osplookup_8c_source.html#l00140">osp_provider::handle</a>, <a class="el" href="app__osplookup_8c_source.html#l00126">osp_provider::name</a>, <a class="el" href="app__osplookup_8c_source.html#l00141">osp_provider::next</a>, <a class="el" href="app__osplookup_8c_source.html#l00095">OSP_INVALID_HANDLE</a>, and <a class="el" href="app__osplookup_8c_source.html#l00137">osp_provider::source</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00707">osp_auth()</a>, and <a class="el" href="app__osplookup_8c_source.html#l00856">osp_lookup()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00446"></a>00446 {
<a name="l00447"></a>00447    <span class="keywordtype">int</span> res = 0;
<a name="l00448"></a>00448    <span class="keyword">struct </span><a class="code" href="structosp__provider.html">osp_provider</a>* p;
<a name="l00449"></a>00449    <span class="keywordtype">int</span> error;
<a name="l00450"></a>00450 
<a name="l00451"></a>00451    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;osplock);
<a name="l00452"></a>00452    p = <a class="code" href="app__osplookup_8c.html#ac9590e73571584ed17bed31f03b87900">ospproviders</a>;
<a name="l00453"></a>00453    <span class="keywordflow">while</span>(p) {
<a name="l00454"></a>00454       <span class="keywordflow">if</span> (!strcasecmp(p-&gt;<a class="code" href="structosp__provider.html#ac475c259e73fbefdd58e2439b3f3beb8">name</a>, provider)) {
<a name="l00455"></a>00455          error = OSPPTransactionNew(p-&gt;<a class="code" href="structosp__provider.html#a62668053aefe0d5985c4ae7451db8486">handle</a>, transaction);
<a name="l00456"></a>00456          <span class="keywordflow">if</span> (error == OSPC_ERR_NO_ERROR) {
<a name="l00457"></a>00457             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: transaction &apos;%d&apos;\n&quot;</span>, *transaction);
<a name="l00458"></a>00458             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="structosp__provider.html#aaf4b604d6f82f265bafb3f5810ffd0ef">source</a>, p-&gt;<a class="code" href="structosp__provider.html#aaf4b604d6f82f265bafb3f5810ffd0ef">source</a>, sourcesize);
<a name="l00459"></a>00459             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: source &apos;%s&apos;\n&quot;</span>, <a class="code" href="structosp__provider.html#aaf4b604d6f82f265bafb3f5810ffd0ef">source</a>);
<a name="l00460"></a>00460             res = 1;
<a name="l00461"></a>00461          } <span class="keywordflow">else</span> {
<a name="l00462"></a>00462             *transaction = <a class="code" href="app__osplookup_8c.html#a693603e5e4556641af06c8ebec1dffc5">OSP_INVALID_HANDLE</a>;
<a name="l00463"></a>00463             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: Unable to create transaction handle, error &apos;%d&apos;\n&quot;</span>, error);
<a name="l00464"></a>00464             res = -1;
<a name="l00465"></a>00465          }
<a name="l00466"></a>00466          <span class="keywordflow">break</span>;
<a name="l00467"></a>00467       }
<a name="l00468"></a>00468       p = p-&gt;<a class="code" href="structosp__provider.html#a63a14d2d4363005a28ebcd7449452d43">next</a>;
<a name="l00469"></a>00469    }
<a name="l00470"></a>00470    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;osplock);
<a name="l00471"></a>00471 
<a name="l00472"></a>00472    <span class="keywordflow">return</span> res;
<a name="l00473"></a>00473 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0eae4255384c0a3e0bc770a4ed6cddaa"></a><!-- doxytag: member="app_osplookup.c::osp_create_uuid" ref="a0eae4255384c0a3e0bc770a4ed6cddaa" args="(unsigned char *uuid, unsigned int *buffersize)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osp_create_uuid </td>
          <td>(</td>
          <td class="paramtype">unsigned char *&nbsp;</td>
          <td class="paramname"> <em>uuid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int *&nbsp;</td>
          <td class="paramname"> <em>buffersize</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Create a UUID. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>uuid</em>&nbsp;</td><td>UUID buffer </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>buffersize</em>&nbsp;</td><td>UUID buffer size </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>1 Created, -1 Error </dd></dl>

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00766">766</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>References <a class="el" href="utils_8c_source.html#l01401">ast_random()</a>, and <a class="el" href="app__osplookup_8c_source.html#l00060">OSP_UUID_SIZE</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00819">osp_create_callid()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00769"></a>00769 {
<a name="l00770"></a>00770    <span class="keywordtype">int</span> i, res;
<a name="l00771"></a>00771    <span class="keywordtype">long</span> <span class="keywordtype">int</span>* tmp;
<a name="l00772"></a>00772 
<a name="l00773"></a>00773    <span class="keywordflow">if</span> (*buffersize &gt;= <a class="code" href="app__osplookup_8c.html#a313b6d61db7200ce2361164899971931">OSP_UUID_SIZE</a>) {
<a name="l00774"></a>00774       tmp = (<span class="keywordtype">long</span> <span class="keywordtype">int</span>*)uuid;
<a name="l00775"></a>00775       <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="app__osplookup_8c.html#a313b6d61db7200ce2361164899971931">OSP_UUID_SIZE</a> / <span class="keyword">sizeof</span>(<span class="keywordtype">long</span> int); i++) {
<a name="l00776"></a>00776          tmp[i] = <a class="code" href="utils_8h.html#a7b4f10b070e95ba413e258a3e4b03c20">ast_random</a>();
<a name="l00777"></a>00777       }
<a name="l00778"></a>00778       *buffersize = <a class="code" href="app__osplookup_8c.html#a313b6d61db7200ce2361164899971931">OSP_UUID_SIZE</a>;
<a name="l00779"></a>00779       res = 1;
<a name="l00780"></a>00780    } <span class="keywordflow">else</span> {
<a name="l00781"></a>00781       res = -1;
<a name="l00782"></a>00782    }
<a name="l00783"></a>00783 
<a name="l00784"></a>00784    <span class="keywordflow">return</span> res;
<a name="l00785"></a>00785 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a88030927dfd5fa77661b8368cd6089e2"></a><!-- doxytag: member="app_osplookup.c::osp_finish" ref="a88030927dfd5fa77661b8368cd6089e2" args="(int handle, int recorded, int cause, time_t start, time_t connect, time_t end, unsigned int release)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osp_finish </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>recorded</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cause</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&nbsp;</td>
          <td class="paramname"> <em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&nbsp;</td>
          <td class="paramname"> <em>connect</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">time_t&nbsp;</td>
          <td class="paramname"> <em>end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>release</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>OSP Finish function. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>handle</em>&nbsp;</td><td>OSP in/outbound transaction handle </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>recorded</em>&nbsp;</td><td>If failure reason has been recorded </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>cause</em>&nbsp;</td><td>Asterisk hangup cause </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>start</em>&nbsp;</td><td>Call start time </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>connect</em>&nbsp;</td><td>Call connect time </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>end</em>&nbsp;</td><td>Call end time </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>release</em>&nbsp;</td><td>Who release first, 0 source, 1 destination </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>1 Success, 0 Failed, -1 Error </dd></dl>

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l01192">1192</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="app__osplookup_8c_source.html#l00690">asterisk2osp()</a>, <a class="el" href="chan__unistim_8c_source.html#l00183">dummy()</a>, and <a class="el" href="app__osplookup_8c_source.html#l00095">OSP_INVALID_HANDLE</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l01657">ospfinished_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01200"></a>01200 {
<a name="l01201"></a>01201    <span class="keywordtype">int</span> res;
<a name="l01202"></a>01202    OSPEFAILREASON reason;
<a name="l01203"></a>01203    time_t alert = 0;
<a name="l01204"></a>01204    <span class="keywordtype">unsigned</span> isPddInfoPresent = 0;
<a name="l01205"></a>01205    <span class="keywordtype">unsigned</span> pdd = 0;
<a name="l01206"></a>01206    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="chan__unistim_8c.html#abc0ce15d00b4bfb69266c5fd016dc88c">dummy</a> = 0;
<a name="l01207"></a>01207    <span class="keywordtype">int</span> error;
<a name="l01208"></a>01208 
<a name="l01209"></a>01209    <span class="keywordflow">if</span> (<a class="code" href="structosp__provider.html#a62668053aefe0d5985c4ae7451db8486">handle</a> == <a class="code" href="app__osplookup_8c.html#a693603e5e4556641af06c8ebec1dffc5">OSP_INVALID_HANDLE</a>) {
<a name="l01210"></a>01210       <span class="keywordflow">return</span> 0;
<a name="l01211"></a>01211    }
<a name="l01212"></a>01212 
<a name="l01213"></a>01213    <span class="keywordflow">if</span> (!recorded) {
<a name="l01214"></a>01214       reason = <a class="code" href="app__osplookup_8c.html#af51938903a4cc1d253bfbf03b2a70d90" title="Convert Asterisk status to TC code.">asterisk2osp</a>(<a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a>);
<a name="l01215"></a>01215       OSPPTransactionRecordFailure(<a class="code" href="structosp__provider.html#a62668053aefe0d5985c4ae7451db8486">handle</a>, reason);
<a name="l01216"></a>01216    }
<a name="l01217"></a>01217 
<a name="l01218"></a>01218    error = OSPPTransactionReportUsage(
<a name="l01219"></a>01219       <a class="code" href="structosp__provider.html#a62668053aefe0d5985c4ae7451db8486">handle</a>,
<a name="l01220"></a>01220       difftime(end, connect),
<a name="l01221"></a>01221       start,
<a name="l01222"></a>01222       end,
<a name="l01223"></a>01223       alert,
<a name="l01224"></a>01224       connect,
<a name="l01225"></a>01225       isPddInfoPresent,
<a name="l01226"></a>01226       pdd,
<a name="l01227"></a>01227       release,
<a name="l01228"></a>01228       NULL,
<a name="l01229"></a>01229       -1,
<a name="l01230"></a>01230       -1,
<a name="l01231"></a>01231       -1,
<a name="l01232"></a>01232       -1,
<a name="l01233"></a>01233       &amp;dummy,
<a name="l01234"></a>01234       NULL);
<a name="l01235"></a>01235    <span class="keywordflow">if</span> (error == OSPC_ERR_NO_ERROR) {
<a name="l01236"></a>01236       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: Usage reported\n&quot;</span>);
<a name="l01237"></a>01237       res = 1;
<a name="l01238"></a>01238    } <span class="keywordflow">else</span> {
<a name="l01239"></a>01239       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: Unable to report usage, error &apos;%d&apos;\n&quot;</span>, error);
<a name="l01240"></a>01240       res = -1;
<a name="l01241"></a>01241    }
<a name="l01242"></a>01242    OSPPTransactionDelete(<a class="code" href="structosp__provider.html#a62668053aefe0d5985c4ae7451db8486">handle</a>);
<a name="l01243"></a>01243 
<a name="l01244"></a>01244    <span class="keywordflow">return</span> res;
<a name="l01245"></a>01245 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af21fa85fa457a1235efc74c9e8d51bbb"></a><!-- doxytag: member="app_osplookup.c::osp_get_provider" ref="af21fa85fa457a1235efc74c9e8d51bbb" args="(const char *name, struct osp_provider **provider)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osp_get_provider </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structosp__provider.html">osp_provider</a> **&nbsp;</td>
          <td class="paramname"> <em>provider</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get OSP provider by name. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>OSP provider context name </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>provider</em>&nbsp;</td><td>OSP provider structure </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>1 Success, 0 Failed, -1 Error </dd></dl>

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00410">410</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="app__osplookup_8c_source.html#l00126">osp_provider::name</a>, and <a class="el" href="app__osplookup_8c_source.html#l00141">osp_provider::next</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00707">osp_auth()</a>, <a class="el" href="app__osplookup_8c_source.html#l00856">osp_lookup()</a>, and <a class="el" href="app__osplookup_8c_source.html#l01074">osp_next()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00413"></a>00413 {
<a name="l00414"></a>00414    <span class="keywordtype">int</span> res = 0;
<a name="l00415"></a>00415    <span class="keyword">struct </span><a class="code" href="structosp__provider.html">osp_provider</a>* p;
<a name="l00416"></a>00416 
<a name="l00417"></a>00417    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;osplock);
<a name="l00418"></a>00418    p = <a class="code" href="app__osplookup_8c.html#ac9590e73571584ed17bed31f03b87900">ospproviders</a>;
<a name="l00419"></a>00419    <span class="keywordflow">while</span>(p) {
<a name="l00420"></a>00420       <span class="keywordflow">if</span> (!strcasecmp(p-&gt;<a class="code" href="structosp__provider.html#ac475c259e73fbefdd58e2439b3f3beb8">name</a>, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>)) {
<a name="l00421"></a>00421          *provider = p;
<a name="l00422"></a>00422          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: find provider &apos;%s&apos;\n&quot;</span>, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l00423"></a>00423          res = 1;
<a name="l00424"></a>00424          <span class="keywordflow">break</span>;
<a name="l00425"></a>00425       }
<a name="l00426"></a>00426       p = p-&gt;<a class="code" href="structosp__provider.html#a63a14d2d4363005a28ebcd7449452d43">next</a>;
<a name="l00427"></a>00427    }
<a name="l00428"></a>00428    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;osplock);
<a name="l00429"></a>00429 
<a name="l00430"></a>00430    <span class="keywordflow">return</span> res;
<a name="l00431"></a>00431 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="abbf1e551f818049bd8744a6ece49a5ba"></a><!-- doxytag: member="app_osplookup.c::osp_load" ref="abbf1e551f818049bd8744a6ece49a5ba" args="(int reload)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osp_load </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>reload</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l01772">1772</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>References <a class="el" href="config_8c_source.html#l00613">ast_category_browse()</a>, <a class="el" href="config_8c_source.html#l00827">ast_config_destroy()</a>, <a class="el" href="config_8h_source.html#l00139">ast_config_load</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="utils_8c_source.html#l01311">ast_true()</a>, <a class="el" href="config_8c_source.html#l00435">ast_variable_retrieve()</a>, <a class="el" href="config_8h_source.html#l00043">CONFIG_FLAG_FILEUNCHANGED</a>, <a class="el" href="config_8h_source.html#l00050">CONFIG_STATUS_FILEINVALID</a>, <a class="el" href="config_8h_source.html#l00049">CONFIG_STATUS_FILEUNCHANGED</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="app__osplookup_8c_source.html#l00096">OSP_CONFIG_FILE</a>, <a class="el" href="app__osplookup_8c_source.html#l00181">osp_create_provider()</a>, <a class="el" href="app__osplookup_8c_source.html#l00097">OSP_GENERAL_CAT</a>, and <a class="el" href="app__osplookup_8c_source.html#l01837">osp_unload()</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l02005">load_module()</a>, and <a class="el" href="app__osplookup_8c_source.html#l02035">reload()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01773"></a>01773 {
<a name="l01774"></a>01774    <span class="keyword">const</span> <span class="keywordtype">char</span>* t;
<a name="l01775"></a>01775    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> v;
<a name="l01776"></a>01776    <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a>* cfg;
<a name="l01777"></a>01777    <span class="keyword">struct </span><a class="code" href="structast__flags.html" title="Structure used to handle boolean flags.">ast_flags</a> <a class="code" href="app__rpt_8c.html#a1f57f20c1f46890828791a4827fe8752">config_flags</a> = { <a class="code" href="app__osplookup_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a> ? <a class="code" href="config_8h.html#a2d5492e116eebd5075f247d21fb9db26afa887389dc380bbdcffb65fec379f037">CONFIG_FLAG_FILEUNCHANGED</a> : 0 };
<a name="l01778"></a>01778    <span class="keywordtype">int</span> error = OSPC_ERR_NO_ERROR;
<a name="l01779"></a>01779 
<a name="l01780"></a>01780    <span class="keywordflow">if</span> ((cfg = <a class="code" href="config_8h.html#a0a07ddd6bbcf44485e01c14c96109482">ast_config_load</a>(<a class="code" href="app__osplookup_8c.html#a3f0d992c57ee30bdaf32796741f827a8">OSP_CONFIG_FILE</a>, config_flags)) == <a class="code" href="config_8h.html#a846844eb2c4eb44554445936b3770711">CONFIG_STATUS_FILEUNCHANGED</a>) {
<a name="l01781"></a>01781       <span class="keywordflow">return</span> 0;
<a name="l01782"></a>01782    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cfg == <a class="code" href="config_8h.html#a8d1a63cdf2c7aff22a77b6e75d93b377">CONFIG_STATUS_FILEINVALID</a>) {
<a name="l01783"></a>01783       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Config file %s is in an invalid format.  Aborting.\n&quot;</span>, <a class="code" href="app__osplookup_8c.html#a3f0d992c57ee30bdaf32796741f827a8">OSP_CONFIG_FILE</a>);
<a name="l01784"></a>01784       <span class="keywordflow">return</span> 0;
<a name="l01785"></a>01785    }
<a name="l01786"></a>01786 
<a name="l01787"></a>01787    <span class="keywordflow">if</span> (cfg) {
<a name="l01788"></a>01788       <span class="keywordflow">if</span> (<a class="code" href="app__osplookup_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a>)
<a name="l01789"></a>01789          <a class="code" href="app__osplookup_8c.html#aeaa07e9dab5c74f1438507a11962f9f4">osp_unload</a>();
<a name="l01790"></a>01790 
<a name="l01791"></a>01791       t = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, <a class="code" href="app__osplookup_8c.html#a953047f54a6cca10a1546c6a9170df38">OSP_GENERAL_CAT</a>, <span class="stringliteral">&quot;accelerate&quot;</span>);
<a name="l01792"></a>01792       <span class="keywordflow">if</span> (t &amp;&amp; <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(t)) {
<a name="l01793"></a>01793          <span class="keywordflow">if</span> ((error = OSPPInit(1)) != OSPC_ERR_NO_ERROR) {
<a name="l01794"></a>01794             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;OSP: Unable to enable hardware accelleration\n&quot;</span>);
<a name="l01795"></a>01795             OSPPInit(0);
<a name="l01796"></a>01796          } <span class="keywordflow">else</span> {
<a name="l01797"></a>01797             <a class="code" href="app__osplookup_8c.html#a5ef0958fa463ae932e3e71ec39cd1337">osp_hardware</a> = 1;
<a name="l01798"></a>01798          }
<a name="l01799"></a>01799       } <span class="keywordflow">else</span> {
<a name="l01800"></a>01800          OSPPInit(0);
<a name="l01801"></a>01801       }
<a name="l01802"></a>01802       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: osp_hardware &apos;%d&apos;\n&quot;</span>, <a class="code" href="app__osplookup_8c.html#a5ef0958fa463ae932e3e71ec39cd1337">osp_hardware</a>);
<a name="l01803"></a>01803 
<a name="l01804"></a>01804       t = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, <a class="code" href="app__osplookup_8c.html#a953047f54a6cca10a1546c6a9170df38">OSP_GENERAL_CAT</a>, <span class="stringliteral">&quot;tokenformat&quot;</span>);
<a name="l01805"></a>01805       <span class="keywordflow">if</span> (t) {
<a name="l01806"></a>01806          <span class="keywordflow">if</span> ((sscanf(t, <span class="stringliteral">&quot;%30d&quot;</span>, &amp;v) == 1) &amp;&amp;
<a name="l01807"></a>01807             ((v == TOKEN_ALGO_SIGNED) || (v == TOKEN_ALGO_UNSIGNED) || (v == TOKEN_ALGO_BOTH)))
<a name="l01808"></a>01808          {
<a name="l01809"></a>01809             <a class="code" href="app__osplookup_8c.html#ab918a4031e5d25153fe54e91be1ac56e">osp_tokenformat</a> = v;
<a name="l01810"></a>01810          } <span class="keywordflow">else</span> {
<a name="l01811"></a>01811             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;tokenformat should be an integer from %d, %d or %d, not &apos;%s&apos;\n&quot;</span>,
<a name="l01812"></a>01812                TOKEN_ALGO_SIGNED, TOKEN_ALGO_UNSIGNED, TOKEN_ALGO_BOTH, t);
<a name="l01813"></a>01813          }
<a name="l01814"></a>01814       }
<a name="l01815"></a>01815       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: osp_tokenformat &apos;%d&apos;\n&quot;</span>, <a class="code" href="app__osplookup_8c.html#ab918a4031e5d25153fe54e91be1ac56e">osp_tokenformat</a>);
<a name="l01816"></a>01816 
<a name="l01817"></a>01817       t = <a class="code" href="config_8h.html#a611776300f941a63266cb220ac62b4db" title="Goes through categories.">ast_category_browse</a>(cfg, NULL);
<a name="l01818"></a>01818       <span class="keywordflow">while</span>(t) {
<a name="l01819"></a>01819          <span class="keywordflow">if</span> (strcasecmp(t, <a class="code" href="app__osplookup_8c.html#a953047f54a6cca10a1546c6a9170df38">OSP_GENERAL_CAT</a>)) {
<a name="l01820"></a>01820             <a class="code" href="app__osplookup_8c.html#aec25444bf96fbb06219720b4403cb60b" title="Create OSP provider handle according to configuration.">osp_create_provider</a>(cfg, t);
<a name="l01821"></a>01821          }
<a name="l01822"></a>01822          t = <a class="code" href="config_8h.html#a611776300f941a63266cb220ac62b4db" title="Goes through categories.">ast_category_browse</a>(cfg, t);
<a name="l01823"></a>01823       }
<a name="l01824"></a>01824 
<a name="l01825"></a>01825       <a class="code" href="app__osplookup_8c.html#a7b65a944814a9fe8b45330072c875e46">osp_initialized</a> = 1;
<a name="l01826"></a>01826 
<a name="l01827"></a>01827       <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(cfg);
<a name="l01828"></a>01828    } <span class="keywordflow">else</span> {
<a name="l01829"></a>01829       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;OSP: Unable to find configuration. OSP support disabled\n&quot;</span>);
<a name="l01830"></a>01830       <span class="keywordflow">return</span> 0;
<a name="l01831"></a>01831    }
<a name="l01832"></a>01832    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: osp_initialized &apos;%d&apos;\n&quot;</span>, <a class="code" href="app__osplookup_8c.html#a7b65a944814a9fe8b45330072c875e46">osp_initialized</a>);
<a name="l01833"></a>01833 
<a name="l01834"></a>01834    <span class="keywordflow">return</span> 1;
<a name="l01835"></a>01835 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab6ffa47e432ada0aa3bab8796cb7a574"></a><!-- doxytag: member="app_osplookup.c::osp_lookup" ref="ab6ffa47e432ada0aa3bab8796cb7a574" args="(const char *provider, const char *srcdev, const char *calling, const char *called, unsigned int callidtypes, struct osp_result *result)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osp_lookup </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>provider</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>srcdev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>calling</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>called</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>callidtypes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structosp__result.html">osp_result</a> *&nbsp;</td>
          <td class="paramname"> <em>result</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>OSP Lookup function. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>provider</em>&nbsp;</td><td>OSP provider context name </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>srcdev</em>&nbsp;</td><td>Source device of outbound call </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>calling</em>&nbsp;</td><td>Calling <a class="el" href="structnumber.html" title="Number structure.">number</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>called</em>&nbsp;</td><td>Called <a class="el" href="structnumber.html" title="Number structure.">number</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>callidtypes</em>&nbsp;</td><td>Call ID types </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>result</em>&nbsp;</td><td>Lookup results </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>1 Found , 0 No route, -1 Error </dd></dl>

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00856">856</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="app__osplookup_8c_source.html#l00146">osp_callid::buf</a>, <a class="el" href="app__osplookup_8c_source.html#l00158">osp_result::called</a>, <a class="el" href="app__osplookup_8c_source.html#l00159">osp_result::calling</a>, <a class="el" href="app__osplookup_8c_source.html#l00157">osp_result::dest</a>, <a class="el" href="chan__unistim_8c_source.html#l00183">dummy()</a>, <a class="el" href="app__osplookup_8c_source.html#l00152">osp_result::inhandle</a>, <a class="el" href="app__osplookup_8c_source.html#l00154">osp_result::intimelimit</a>, <a class="el" href="app__osplookup_8c_source.html#l00147">osp_callid::len</a>, <a class="el" href="app__osplookup_8c_source.html#l00161">osp_result::networkid</a>, <a class="el" href="app__osplookup_8c_source.html#l00162">osp_result::numresults</a>, <a class="el" href="app__osplookup_8c_source.html#l00075">OSP_CALLID_MAXNUM</a>, <a class="el" href="app__osplookup_8c_source.html#l00591">osp_check_destination()</a>, <a class="el" href="app__osplookup_8c_source.html#l00566">osp_choose_timelimit()</a>, <a class="el" href="app__osplookup_8c_source.html#l00481">osp_convert_address()</a>, <a class="el" href="app__osplookup_8c_source.html#l00819">osp_create_callid()</a>, <a class="el" href="app__osplookup_8c_source.html#l00441">osp_create_transaction()</a>, <a class="el" href="app__osplookup_8c_source.html#l00120">OSP_DEF_DESTINATIONS</a>, <a class="el" href="app__osplookup_8c_source.html#l00121">OSP_DEF_TIMELIMIT</a>, <a class="el" href="app__osplookup_8c_source.html#l00410">osp_get_provider()</a>, <a class="el" href="app__osplookup_8c_source.html#l00095">OSP_INVALID_HANDLE</a>, <a class="el" href="app__osplookup_8c_source.html#l00057">OSP_NORSTR_SIZE</a>, <a class="el" href="app__osplookup_8c_source.html#l00058">OSP_TOKSTR_SIZE</a>, <a class="el" href="app__osplookup_8c_source.html#l00163">osp_result::outcallid</a>, <a class="el" href="app__osplookup_8c_source.html#l00153">osp_result::outhandle</a>, <a class="el" href="app__osplookup_8c_source.html#l00155">osp_result::outtimelimit</a>, <a class="el" href="app__osplookup_8c_source.html#l00137">osp_provider::source</a>, <a class="el" href="app__osplookup_8c_source.html#l00156">osp_result::tech</a>, <a class="el" href="app__osplookup_8c_source.html#l00160">osp_result::token</a>, and <a class="el" href="evt_8c_source.html#l00071">type</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l01335">osplookup_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00863"></a>00863 {
<a name="l00864"></a>00864    <span class="keywordtype">int</span> res;
<a name="l00865"></a>00865    <span class="keyword">struct </span><a class="code" href="structosp__provider.html">osp_provider</a>* p = NULL;
<a name="l00866"></a>00866    <span class="keywordtype">char</span> <a class="code" href="structosp__provider.html#aaf4b604d6f82f265bafb3f5810ffd0ef">source</a>[<a class="code" href="app__osplookup_8c.html#ab83d2712bd3bfe3e2f3631f97307fd0c">OSP_NORSTR_SIZE</a>];
<a name="l00867"></a>00867    <span class="keywordtype">char</span> callingnum[<a class="code" href="app__osplookup_8c.html#ab83d2712bd3bfe3e2f3631f97307fd0c">OSP_NORSTR_SIZE</a>];
<a name="l00868"></a>00868    <span class="keywordtype">char</span> callednum[<a class="code" href="app__osplookup_8c.html#ab83d2712bd3bfe3e2f3631f97307fd0c">OSP_NORSTR_SIZE</a>];
<a name="l00869"></a>00869    <span class="keywordtype">char</span> destination[<a class="code" href="app__osplookup_8c.html#ab83d2712bd3bfe3e2f3631f97307fd0c">OSP_NORSTR_SIZE</a>];
<a name="l00870"></a>00870    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tokenlen;
<a name="l00871"></a>00871    <span class="keywordtype">char</span> token[<a class="code" href="app__osplookup_8c.html#a6d56e8f42ac71c7e7cebd6d4e0aa6f78">OSP_TOKSTR_SIZE</a>];
<a name="l00872"></a>00872    <span class="keywordtype">char</span> src[<a class="code" href="app__osplookup_8c.html#ab83d2712bd3bfe3e2f3631f97307fd0c">OSP_NORSTR_SIZE</a>];
<a name="l00873"></a>00873    <span class="keywordtype">char</span> dev[<a class="code" href="app__osplookup_8c.html#ab83d2712bd3bfe3e2f3631f97307fd0c">OSP_NORSTR_SIZE</a>];
<a name="l00874"></a>00874    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i, <a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>;
<a name="l00875"></a>00875    <span class="keyword">struct </span><a class="code" href="structosp__callid.html">osp_callid</a> callid;
<a name="l00876"></a>00876    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> callidnum;
<a name="l00877"></a>00877    OSPT_CALL_ID* callids[<a class="code" href="app__osplookup_8c.html#a5b374a60989e0a5e46b9e3d493e62533">OSP_CALLID_MAXNUM</a>];
<a name="l00878"></a>00878    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="chan__unistim_8c.html#abc0ce15d00b4bfb69266c5fd016dc88c">dummy</a> = 0;
<a name="l00879"></a>00879    OSPEFAILREASON reason;
<a name="l00880"></a>00880    <span class="keywordtype">int</span> error;
<a name="l00881"></a>00881 
<a name="l00882"></a>00882    result-&gt;<a class="code" href="structosp__result.html#a9510d026d1fc5261f447c25136359281">outhandle</a> = <a class="code" href="app__osplookup_8c.html#a693603e5e4556641af06c8ebec1dffc5">OSP_INVALID_HANDLE</a>;
<a name="l00883"></a>00883    result-&gt;<a class="code" href="structosp__result.html#a1a93d2e18d4e533ca49d205d12f43b07">tech</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00884"></a>00884    result-&gt;<a class="code" href="structosp__result.html#aa1b0ddffe07f8bf8359636039bc67ce6">dest</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00885"></a>00885    result-&gt;<a class="code" href="structosp__result.html#aebc71b334dd60e88992b18270584c55e">called</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00886"></a>00886    result-&gt;<a class="code" href="structosp__result.html#ae7b4c361c1d2fe0c5f1b8a0fab365876">calling</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00887"></a>00887    result-&gt;<a class="code" href="structosp__result.html#ad8469d2c5b331a926d1e0dcfd1bd5a5d">token</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00888"></a>00888    result-&gt;<a class="code" href="structosp__result.html#a2f7b2fe69e61746900b9fa83cd3013a9">networkid</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00889"></a>00889    result-&gt;<a class="code" href="structosp__result.html#a1d82d9e4992b32d67de1d608e14e40b5">numresults</a> = 0;
<a name="l00890"></a>00890    result-&gt;<a class="code" href="structosp__result.html#add3e2b56eb4cf1825b2f025088e2e3fb">outtimelimit</a> = <a class="code" href="app__osplookup_8c.html#aa216d244dea7f5d816cc35504c4390cc">OSP_DEF_TIMELIMIT</a>;
<a name="l00891"></a>00891 
<a name="l00892"></a>00892    <span class="keywordflow">if</span> ((res = <a class="code" href="app__osplookup_8c.html#af21fa85fa457a1235efc74c9e8d51bbb" title="Get OSP provider by name.">osp_get_provider</a>(provider, &amp;p)) &lt;= 0) {
<a name="l00893"></a>00893       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: Unabe to find OSP provider &apos;%s&apos;\n&quot;</span>, provider);
<a name="l00894"></a>00894       <span class="keywordflow">return</span> res;
<a name="l00895"></a>00895    }
<a name="l00896"></a>00896 
<a name="l00897"></a>00897    <span class="keywordflow">if</span> ((res = <a class="code" href="app__osplookup_8c.html#aec704b16f5e3d6367e23b9cb3555d87a" title="Create OSP transaction handle.">osp_create_transaction</a>(provider, &amp;result-&gt;<a class="code" href="structosp__result.html#a9510d026d1fc5261f447c25136359281">outhandle</a>, <span class="keyword">sizeof</span>(source), source)) &lt;= 0) {
<a name="l00898"></a>00898       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: Unable to generate transaction handle\n&quot;</span>);
<a name="l00899"></a>00899       result-&gt;<a class="code" href="structosp__result.html#a9510d026d1fc5261f447c25136359281">outhandle</a> = <a class="code" href="app__osplookup_8c.html#a693603e5e4556641af06c8ebec1dffc5">OSP_INVALID_HANDLE</a>;
<a name="l00900"></a>00900       <span class="keywordflow">if</span> (result-&gt;<a class="code" href="structosp__result.html#a388041f010d6c445bc6625dad76bc321">inhandle</a> != <a class="code" href="app__osplookup_8c.html#a693603e5e4556641af06c8ebec1dffc5">OSP_INVALID_HANDLE</a>) {
<a name="l00901"></a>00901          OSPPTransactionRecordFailure(result-&gt;<a class="code" href="structosp__result.html#a388041f010d6c445bc6625dad76bc321">inhandle</a>, OSPC_FAIL_NORMAL_UNSPECIFIED);
<a name="l00902"></a>00902       }
<a name="l00903"></a>00903       <span class="keywordflow">return</span> -1;
<a name="l00904"></a>00904    }
<a name="l00905"></a>00905 
<a name="l00906"></a>00906    callidnum = 0;
<a name="l00907"></a>00907    callids[0] = NULL;
<a name="l00908"></a>00908    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="app__osplookup_8c.html#a5b374a60989e0a5e46b9e3d493e62533">OSP_CALLID_MAXNUM</a>; i++) {
<a name="l00909"></a>00909       type = 1 &lt;&lt; i;
<a name="l00910"></a>00910       <span class="keywordflow">if</span> (callidtypes &amp; type) {
<a name="l00911"></a>00911          error = <a class="code" href="app__osplookup_8c.html#ae9f5a73f76d19b25d7666d4a3517d64a" title="Create a call ID according to the type.">osp_create_callid</a>(type, &amp;callid);
<a name="l00912"></a>00912          <span class="keywordflow">if</span> (error == 1) {
<a name="l00913"></a>00913             callids[callidnum] = OSPPCallIdNew(callid.len, callid.buf);
<a name="l00914"></a>00914             callidnum++;
<a name="l00915"></a>00915          }
<a name="l00916"></a>00916       }
<a name="l00917"></a>00917    }
<a name="l00918"></a>00918 
<a name="l00919"></a>00919    <a class="code" href="app__osplookup_8c.html#aa919e8f63ad9ab313b720151246ecc33" title="Convert address to &amp;quot;[x.x.x.x]&amp;quot; or &amp;quot;host.domain&amp;quot; format.">osp_convert_address</a>(source, src, <span class="keyword">sizeof</span>(src));
<a name="l00920"></a>00920    <a class="code" href="app__osplookup_8c.html#aa919e8f63ad9ab313b720151246ecc33" title="Convert address to &amp;quot;[x.x.x.x]&amp;quot; or &amp;quot;host.domain&amp;quot; format.">osp_convert_address</a>(srcdev, dev, <span class="keyword">sizeof</span>(dev));
<a name="l00921"></a>00921    result-&gt;<a class="code" href="structosp__result.html#a1d82d9e4992b32d67de1d608e14e40b5">numresults</a> = <a class="code" href="app__osplookup_8c.html#a34def455e4e0a05ad865940f8067b371">OSP_DEF_DESTINATIONS</a>;
<a name="l00922"></a>00922    error = OSPPTransactionRequestAuthorisation(
<a name="l00923"></a>00923       result-&gt;<a class="code" href="structosp__result.html#a9510d026d1fc5261f447c25136359281">outhandle</a>,
<a name="l00924"></a>00924       src,
<a name="l00925"></a>00925       dev,
<a name="l00926"></a>00926       calling ? calling : <span class="stringliteral">&quot;&quot;</span>,
<a name="l00927"></a>00927       OSPC_NFORMAT_E164,
<a name="l00928"></a>00928       called,
<a name="l00929"></a>00929       OSPC_NFORMAT_E164,
<a name="l00930"></a>00930       NULL,
<a name="l00931"></a>00931       callidnum,
<a name="l00932"></a>00932       callids,
<a name="l00933"></a>00933       NULL,
<a name="l00934"></a>00934       &amp;result-&gt;<a class="code" href="structosp__result.html#a1d82d9e4992b32d67de1d608e14e40b5">numresults</a>,
<a name="l00935"></a>00935       &amp;dummy,
<a name="l00936"></a>00936       NULL);
<a name="l00937"></a>00937 
<a name="l00938"></a>00938    <span class="keywordflow">for</span> (i = 0; i &lt; callidnum; i++) {
<a name="l00939"></a>00939       OSPPCallIdDelete(&amp;callids[i]);
<a name="l00940"></a>00940    }
<a name="l00941"></a>00941 
<a name="l00942"></a>00942    <span class="keywordflow">if</span> (error != OSPC_ERR_NO_ERROR) {
<a name="l00943"></a>00943       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: Unable to request authorization, error &apos;%d&apos;\n&quot;</span>, error);
<a name="l00944"></a>00944       result-&gt;<a class="code" href="structosp__result.html#a1d82d9e4992b32d67de1d608e14e40b5">numresults</a> = 0;
<a name="l00945"></a>00945       <span class="keywordflow">if</span> (result-&gt;<a class="code" href="structosp__result.html#a388041f010d6c445bc6625dad76bc321">inhandle</a> != <a class="code" href="app__osplookup_8c.html#a693603e5e4556641af06c8ebec1dffc5">OSP_INVALID_HANDLE</a>) {
<a name="l00946"></a>00946          OSPPTransactionRecordFailure(result-&gt;<a class="code" href="structosp__result.html#a388041f010d6c445bc6625dad76bc321">inhandle</a>, OSPC_FAIL_NORMAL_UNSPECIFIED);
<a name="l00947"></a>00947       }
<a name="l00948"></a>00948       <span class="keywordflow">return</span> -1;
<a name="l00949"></a>00949    }
<a name="l00950"></a>00950 
<a name="l00951"></a>00951    <span class="keywordflow">if</span> (!result-&gt;<a class="code" href="structosp__result.html#a1d82d9e4992b32d67de1d608e14e40b5">numresults</a>) {
<a name="l00952"></a>00952       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: No more destination\n&quot;</span>);
<a name="l00953"></a>00953       <span class="keywordflow">if</span> (result-&gt;<a class="code" href="structosp__result.html#a388041f010d6c445bc6625dad76bc321">inhandle</a> != <a class="code" href="app__osplookup_8c.html#a693603e5e4556641af06c8ebec1dffc5">OSP_INVALID_HANDLE</a>) {
<a name="l00954"></a>00954          OSPPTransactionRecordFailure(result-&gt;<a class="code" href="structosp__result.html#a388041f010d6c445bc6625dad76bc321">inhandle</a>, OSPC_FAIL_NO_ROUTE_TO_DEST);
<a name="l00955"></a>00955       }
<a name="l00956"></a>00956       <span class="keywordflow">return</span> 0;
<a name="l00957"></a>00957    }
<a name="l00958"></a>00958 
<a name="l00959"></a>00959    result-&gt;<a class="code" href="structosp__result.html#a1c4f969b78b88b37312e1b21bd759139">outcallid</a>.<a class="code" href="structosp__callid.html#a77124bd5f7e31e6fffc19f335da0c23f">len</a> = <span class="keyword">sizeof</span>(result-&gt;<a class="code" href="structosp__result.html#a1c4f969b78b88b37312e1b21bd759139">outcallid</a>.<a class="code" href="structosp__callid.html#af2f02dd4431344f38b58d78bee490fca">buf</a>);
<a name="l00960"></a>00960    tokenlen = <span class="keyword">sizeof</span>(token);
<a name="l00961"></a>00961    error = OSPPTransactionGetFirstDestination(
<a name="l00962"></a>00962       result-&gt;<a class="code" href="structosp__result.html#a9510d026d1fc5261f447c25136359281">outhandle</a>,
<a name="l00963"></a>00963       0,
<a name="l00964"></a>00964       NULL,
<a name="l00965"></a>00965       NULL,
<a name="l00966"></a>00966       &amp;result-&gt;<a class="code" href="structosp__result.html#add3e2b56eb4cf1825b2f025088e2e3fb">outtimelimit</a>,
<a name="l00967"></a>00967       &amp;result-&gt;<a class="code" href="structosp__result.html#a1c4f969b78b88b37312e1b21bd759139">outcallid</a>.<a class="code" href="structosp__callid.html#a77124bd5f7e31e6fffc19f335da0c23f">len</a>,
<a name="l00968"></a>00968       result-&gt;<a class="code" href="structosp__result.html#a1c4f969b78b88b37312e1b21bd759139">outcallid</a>.<a class="code" href="structosp__callid.html#af2f02dd4431344f38b58d78bee490fca">buf</a>,
<a name="l00969"></a>00969       <span class="keyword">sizeof</span>(callednum),
<a name="l00970"></a>00970       callednum,
<a name="l00971"></a>00971       <span class="keyword">sizeof</span>(callingnum),
<a name="l00972"></a>00972       callingnum,
<a name="l00973"></a>00973       <span class="keyword">sizeof</span>(destination),
<a name="l00974"></a>00974       destination,
<a name="l00975"></a>00975       0,
<a name="l00976"></a>00976       NULL,
<a name="l00977"></a>00977       &amp;tokenlen,
<a name="l00978"></a>00978       token);
<a name="l00979"></a>00979    <span class="keywordflow">if</span> (error != OSPC_ERR_NO_ERROR) {
<a name="l00980"></a>00980       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: Unable to get first route, error &apos;%d&apos;\n&quot;</span>, error);
<a name="l00981"></a>00981       result-&gt;<a class="code" href="structosp__result.html#a1d82d9e4992b32d67de1d608e14e40b5">numresults</a> = 0;
<a name="l00982"></a>00982       result-&gt;<a class="code" href="structosp__result.html#add3e2b56eb4cf1825b2f025088e2e3fb">outtimelimit</a> = <a class="code" href="app__osplookup_8c.html#aa216d244dea7f5d816cc35504c4390cc">OSP_DEF_TIMELIMIT</a>;
<a name="l00983"></a>00983       <span class="keywordflow">if</span> (result-&gt;<a class="code" href="structosp__result.html#a388041f010d6c445bc6625dad76bc321">inhandle</a> != <a class="code" href="app__osplookup_8c.html#a693603e5e4556641af06c8ebec1dffc5">OSP_INVALID_HANDLE</a>) {
<a name="l00984"></a>00984          OSPPTransactionRecordFailure(result-&gt;<a class="code" href="structosp__result.html#a388041f010d6c445bc6625dad76bc321">inhandle</a>, OSPC_FAIL_NO_ROUTE_TO_DEST);
<a name="l00985"></a>00985       }
<a name="l00986"></a>00986       <span class="keywordflow">return</span> -1;
<a name="l00987"></a>00987    }
<a name="l00988"></a>00988 
<a name="l00989"></a>00989    result-&gt;<a class="code" href="structosp__result.html#a1d82d9e4992b32d67de1d608e14e40b5">numresults</a>--;
<a name="l00990"></a>00990    result-&gt;<a class="code" href="structosp__result.html#add3e2b56eb4cf1825b2f025088e2e3fb">outtimelimit</a> = <a class="code" href="app__osplookup_8c.html#acad1656c35ed21d307a509194041383e" title="Choose min duration limit.">osp_choose_timelimit</a>(result-&gt;<a class="code" href="structosp__result.html#a63345dee69cafbcbc77a6966338e3c57">intimelimit</a>, result-&gt;<a class="code" href="structosp__result.html#add3e2b56eb4cf1825b2f025088e2e3fb">outtimelimit</a>);
<a name="l00991"></a>00991    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: outtimelimit &apos;%d&apos;\n&quot;</span>, result-&gt;<a class="code" href="structosp__result.html#add3e2b56eb4cf1825b2f025088e2e3fb">outtimelimit</a>);
<a name="l00992"></a>00992    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: called &apos;%s&apos;\n&quot;</span>, callednum);
<a name="l00993"></a>00993    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: calling &apos;%s&apos;\n&quot;</span>, callingnum);
<a name="l00994"></a>00994    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: destination &apos;%s&apos;\n&quot;</span>, destination);
<a name="l00995"></a>00995    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: token size &apos;%d&apos;\n&quot;</span>, tokenlen);
<a name="l00996"></a>00996 
<a name="l00997"></a>00997    <span class="keywordflow">if</span> ((res = <a class="code" href="app__osplookup_8c.html#ab1f3dd789f1e830e5e53204fe908a9d9" title="Choose min duration limit.">osp_check_destination</a>(p, callednum, callingnum, destination, tokenlen, token, &amp;reason, result)) &gt; 0) {
<a name="l00998"></a>00998       <span class="keywordflow">return</span> 1;
<a name="l00999"></a>00999    }
<a name="l01000"></a>01000 
<a name="l01001"></a>01001    <span class="keywordflow">if</span> (!result-&gt;<a class="code" href="structosp__result.html#a1d82d9e4992b32d67de1d608e14e40b5">numresults</a>) {
<a name="l01002"></a>01002       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: No more destination\n&quot;</span>);
<a name="l01003"></a>01003       result-&gt;<a class="code" href="structosp__result.html#add3e2b56eb4cf1825b2f025088e2e3fb">outtimelimit</a> = <a class="code" href="app__osplookup_8c.html#aa216d244dea7f5d816cc35504c4390cc">OSP_DEF_TIMELIMIT</a>;
<a name="l01004"></a>01004       OSPPTransactionRecordFailure(result-&gt;<a class="code" href="structosp__result.html#a9510d026d1fc5261f447c25136359281">outhandle</a>, reason);
<a name="l01005"></a>01005       <span class="keywordflow">if</span> (result-&gt;<a class="code" href="structosp__result.html#a388041f010d6c445bc6625dad76bc321">inhandle</a> != <a class="code" href="app__osplookup_8c.html#a693603e5e4556641af06c8ebec1dffc5">OSP_INVALID_HANDLE</a>) {
<a name="l01006"></a>01006          OSPPTransactionRecordFailure(result-&gt;<a class="code" href="structosp__result.html#a388041f010d6c445bc6625dad76bc321">inhandle</a>, OSPC_FAIL_NO_ROUTE_TO_DEST);
<a name="l01007"></a>01007       }
<a name="l01008"></a>01008       <span class="keywordflow">return</span> 0;
<a name="l01009"></a>01009    }
<a name="l01010"></a>01010 
<a name="l01011"></a>01011    <span class="keywordflow">while</span>(result-&gt;<a class="code" href="structosp__result.html#a1d82d9e4992b32d67de1d608e14e40b5">numresults</a>) {
<a name="l01012"></a>01012       result-&gt;<a class="code" href="structosp__result.html#a1c4f969b78b88b37312e1b21bd759139">outcallid</a>.<a class="code" href="structosp__callid.html#a77124bd5f7e31e6fffc19f335da0c23f">len</a> = <span class="keyword">sizeof</span>(result-&gt;<a class="code" href="structosp__result.html#a1c4f969b78b88b37312e1b21bd759139">outcallid</a>.<a class="code" href="structosp__callid.html#af2f02dd4431344f38b58d78bee490fca">buf</a>);
<a name="l01013"></a>01013       tokenlen = <span class="keyword">sizeof</span>(token);
<a name="l01014"></a>01014       error = OSPPTransactionGetNextDestination(
<a name="l01015"></a>01015          result-&gt;<a class="code" href="structosp__result.html#a9510d026d1fc5261f447c25136359281">outhandle</a>,
<a name="l01016"></a>01016          reason,
<a name="l01017"></a>01017          0,
<a name="l01018"></a>01018          NULL,
<a name="l01019"></a>01019          NULL,
<a name="l01020"></a>01020          &amp;result-&gt;<a class="code" href="structosp__result.html#add3e2b56eb4cf1825b2f025088e2e3fb">outtimelimit</a>,
<a name="l01021"></a>01021          &amp;result-&gt;<a class="code" href="structosp__result.html#a1c4f969b78b88b37312e1b21bd759139">outcallid</a>.<a class="code" href="structosp__callid.html#a77124bd5f7e31e6fffc19f335da0c23f">len</a>,
<a name="l01022"></a>01022          result-&gt;<a class="code" href="structosp__result.html#a1c4f969b78b88b37312e1b21bd759139">outcallid</a>.<a class="code" href="structosp__callid.html#af2f02dd4431344f38b58d78bee490fca">buf</a>,
<a name="l01023"></a>01023          <span class="keyword">sizeof</span>(callednum),
<a name="l01024"></a>01024          callednum,
<a name="l01025"></a>01025          <span class="keyword">sizeof</span>(callingnum),
<a name="l01026"></a>01026          callingnum,
<a name="l01027"></a>01027          <span class="keyword">sizeof</span>(destination),
<a name="l01028"></a>01028          destination,
<a name="l01029"></a>01029          0,
<a name="l01030"></a>01030          NULL,
<a name="l01031"></a>01031          &amp;tokenlen,
<a name="l01032"></a>01032          token);
<a name="l01033"></a>01033       <span class="keywordflow">if</span> (error == OSPC_ERR_NO_ERROR) {
<a name="l01034"></a>01034          result-&gt;<a class="code" href="structosp__result.html#a1d82d9e4992b32d67de1d608e14e40b5">numresults</a>--;
<a name="l01035"></a>01035          result-&gt;<a class="code" href="structosp__result.html#add3e2b56eb4cf1825b2f025088e2e3fb">outtimelimit</a> = <a class="code" href="app__osplookup_8c.html#acad1656c35ed21d307a509194041383e" title="Choose min duration limit.">osp_choose_timelimit</a>(result-&gt;<a class="code" href="structosp__result.html#a63345dee69cafbcbc77a6966338e3c57">intimelimit</a>, result-&gt;<a class="code" href="structosp__result.html#add3e2b56eb4cf1825b2f025088e2e3fb">outtimelimit</a>);
<a name="l01036"></a>01036          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: outtimelimit &apos;%d&apos;\n&quot;</span>, result-&gt;<a class="code" href="structosp__result.html#add3e2b56eb4cf1825b2f025088e2e3fb">outtimelimit</a>);
<a name="l01037"></a>01037          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: called &apos;%s&apos;\n&quot;</span>, callednum);
<a name="l01038"></a>01038          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: calling &apos;%s&apos;\n&quot;</span>, callingnum);
<a name="l01039"></a>01039          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: destination &apos;%s&apos;\n&quot;</span>, destination);
<a name="l01040"></a>01040          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: token size &apos;%d&apos;\n&quot;</span>, tokenlen);
<a name="l01041"></a>01041 
<a name="l01042"></a>01042          <span class="keywordflow">if</span> ((res = <a class="code" href="app__osplookup_8c.html#ab1f3dd789f1e830e5e53204fe908a9d9" title="Choose min duration limit.">osp_check_destination</a>(p, callednum, callingnum, destination, tokenlen, token, &amp;reason, result)) &gt; 0) {
<a name="l01043"></a>01043             <span class="keywordflow">break</span>;
<a name="l01044"></a>01044          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!result-&gt;<a class="code" href="structosp__result.html#a1d82d9e4992b32d67de1d608e14e40b5">numresults</a>) {
<a name="l01045"></a>01045             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: No more destination\n&quot;</span>);
<a name="l01046"></a>01046             OSPPTransactionRecordFailure(result-&gt;<a class="code" href="structosp__result.html#a9510d026d1fc5261f447c25136359281">outhandle</a>, reason);
<a name="l01047"></a>01047             <span class="keywordflow">if</span> (result-&gt;<a class="code" href="structosp__result.html#a388041f010d6c445bc6625dad76bc321">inhandle</a> != <a class="code" href="app__osplookup_8c.html#a693603e5e4556641af06c8ebec1dffc5">OSP_INVALID_HANDLE</a>) {
<a name="l01048"></a>01048                OSPPTransactionRecordFailure(result-&gt;<a class="code" href="structosp__result.html#a388041f010d6c445bc6625dad76bc321">inhandle</a>, OSPC_FAIL_NO_ROUTE_TO_DEST);
<a name="l01049"></a>01049             }
<a name="l01050"></a>01050             res = 0;
<a name="l01051"></a>01051             <span class="keywordflow">break</span>;
<a name="l01052"></a>01052          }
<a name="l01053"></a>01053       } <span class="keywordflow">else</span> {
<a name="l01054"></a>01054          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: Unable to get route, error &apos;%d&apos;\n&quot;</span>, error);
<a name="l01055"></a>01055          result-&gt;<a class="code" href="structosp__result.html#a1d82d9e4992b32d67de1d608e14e40b5">numresults</a> = 0;
<a name="l01056"></a>01056          result-&gt;<a class="code" href="structosp__result.html#add3e2b56eb4cf1825b2f025088e2e3fb">outtimelimit</a> = <a class="code" href="app__osplookup_8c.html#aa216d244dea7f5d816cc35504c4390cc">OSP_DEF_TIMELIMIT</a>;
<a name="l01057"></a>01057          <span class="keywordflow">if</span> (result-&gt;<a class="code" href="structosp__result.html#a388041f010d6c445bc6625dad76bc321">inhandle</a> != <a class="code" href="app__osplookup_8c.html#a693603e5e4556641af06c8ebec1dffc5">OSP_INVALID_HANDLE</a>) {
<a name="l01058"></a>01058             OSPPTransactionRecordFailure(result-&gt;<a class="code" href="structosp__result.html#a388041f010d6c445bc6625dad76bc321">inhandle</a>, OSPC_FAIL_NORMAL_UNSPECIFIED);
<a name="l01059"></a>01059          }
<a name="l01060"></a>01060          res = -1;
<a name="l01061"></a>01061          <span class="keywordflow">break</span>;
<a name="l01062"></a>01062       }
<a name="l01063"></a>01063    }
<a name="l01064"></a>01064    <span class="keywordflow">return</span> res;
<a name="l01065"></a>01065 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad3c73a7443561060d02520615232ff9e"></a><!-- doxytag: member="app_osplookup.c::osp_next" ref="ad3c73a7443561060d02520615232ff9e" args="(const char *provider, int cause, struct osp_result *result)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osp_next </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>provider</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cause</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structosp__result.html">osp_result</a> *&nbsp;</td>
          <td class="paramname"> <em>result</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>OSP Lookup Next function. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>provider</em>&nbsp;</td><td>OSP provider name </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>cause</em>&nbsp;</td><td>Asterisk hangup cuase </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>result</em>&nbsp;</td><td>Lookup results, in/output </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>1 Found , 0 No route, -1 Error </dd></dl>

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l01074">1074</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="app__osplookup_8c_source.html#l00690">asterisk2osp()</a>, <a class="el" href="app__osplookup_8c_source.html#l00146">osp_callid::buf</a>, <a class="el" href="app__osplookup_8c_source.html#l00158">osp_result::called</a>, <a class="el" href="app__osplookup_8c_source.html#l00159">osp_result::calling</a>, <a class="el" href="app__osplookup_8c_source.html#l00157">osp_result::dest</a>, <a class="el" href="app__osplookup_8c_source.html#l00152">osp_result::inhandle</a>, <a class="el" href="app__osplookup_8c_source.html#l00154">osp_result::intimelimit</a>, <a class="el" href="app__osplookup_8c_source.html#l00147">osp_callid::len</a>, <a class="el" href="app__osplookup_8c_source.html#l00161">osp_result::networkid</a>, <a class="el" href="app__osplookup_8c_source.html#l00162">osp_result::numresults</a>, <a class="el" href="app__osplookup_8c_source.html#l00591">osp_check_destination()</a>, <a class="el" href="app__osplookup_8c_source.html#l00566">osp_choose_timelimit()</a>, <a class="el" href="app__osplookup_8c_source.html#l00121">OSP_DEF_TIMELIMIT</a>, <a class="el" href="app__osplookup_8c_source.html#l00410">osp_get_provider()</a>, <a class="el" href="app__osplookup_8c_source.html#l00095">OSP_INVALID_HANDLE</a>, <a class="el" href="app__osplookup_8c_source.html#l00057">OSP_NORSTR_SIZE</a>, <a class="el" href="app__osplookup_8c_source.html#l00058">OSP_TOKSTR_SIZE</a>, <a class="el" href="app__osplookup_8c_source.html#l00163">osp_result::outcallid</a>, <a class="el" href="app__osplookup_8c_source.html#l00153">osp_result::outhandle</a>, <a class="el" href="app__osplookup_8c_source.html#l00155">osp_result::outtimelimit</a>, <a class="el" href="app__osplookup_8c_source.html#l00156">osp_result::tech</a>, and <a class="el" href="app__osplookup_8c_source.html#l00160">osp_result::token</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l01503">ospnext_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01078"></a>01078 {
<a name="l01079"></a>01079    <span class="keywordtype">int</span> res;
<a name="l01080"></a>01080    <span class="keyword">struct </span><a class="code" href="structosp__provider.html">osp_provider</a>* p = NULL;
<a name="l01081"></a>01081    <span class="keywordtype">char</span> callingnum[<a class="code" href="app__osplookup_8c.html#ab83d2712bd3bfe3e2f3631f97307fd0c">OSP_NORSTR_SIZE</a>];
<a name="l01082"></a>01082    <span class="keywordtype">char</span> callednum[<a class="code" href="app__osplookup_8c.html#ab83d2712bd3bfe3e2f3631f97307fd0c">OSP_NORSTR_SIZE</a>];
<a name="l01083"></a>01083    <span class="keywordtype">char</span> destination[<a class="code" href="app__osplookup_8c.html#ab83d2712bd3bfe3e2f3631f97307fd0c">OSP_NORSTR_SIZE</a>];
<a name="l01084"></a>01084    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tokenlen;
<a name="l01085"></a>01085    <span class="keywordtype">char</span> token[<a class="code" href="app__osplookup_8c.html#a6d56e8f42ac71c7e7cebd6d4e0aa6f78">OSP_TOKSTR_SIZE</a>];
<a name="l01086"></a>01086    OSPEFAILREASON reason;
<a name="l01087"></a>01087    <span class="keywordtype">int</span> error;
<a name="l01088"></a>01088 
<a name="l01089"></a>01089    result-&gt;<a class="code" href="structosp__result.html#a1a93d2e18d4e533ca49d205d12f43b07">tech</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01090"></a>01090    result-&gt;<a class="code" href="structosp__result.html#aa1b0ddffe07f8bf8359636039bc67ce6">dest</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01091"></a>01091    result-&gt;<a class="code" href="structosp__result.html#aebc71b334dd60e88992b18270584c55e">called</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01092"></a>01092    result-&gt;<a class="code" href="structosp__result.html#ae7b4c361c1d2fe0c5f1b8a0fab365876">calling</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01093"></a>01093    result-&gt;<a class="code" href="structosp__result.html#ad8469d2c5b331a926d1e0dcfd1bd5a5d">token</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01094"></a>01094    result-&gt;<a class="code" href="structosp__result.html#a2f7b2fe69e61746900b9fa83cd3013a9">networkid</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01095"></a>01095    result-&gt;<a class="code" href="structosp__result.html#add3e2b56eb4cf1825b2f025088e2e3fb">outtimelimit</a> = <a class="code" href="app__osplookup_8c.html#aa216d244dea7f5d816cc35504c4390cc">OSP_DEF_TIMELIMIT</a>;
<a name="l01096"></a>01096 
<a name="l01097"></a>01097    <span class="keywordflow">if</span> ((res = <a class="code" href="app__osplookup_8c.html#af21fa85fa457a1235efc74c9e8d51bbb" title="Get OSP provider by name.">osp_get_provider</a>(provider, &amp;p)) &lt;= 0) {
<a name="l01098"></a>01098       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: Unabe to find OSP provider &apos;%s&apos;\n&quot;</span>, provider);
<a name="l01099"></a>01099       <span class="keywordflow">return</span> res;
<a name="l01100"></a>01100    }
<a name="l01101"></a>01101 
<a name="l01102"></a>01102    <span class="keywordflow">if</span> (result-&gt;<a class="code" href="structosp__result.html#a9510d026d1fc5261f447c25136359281">outhandle</a> == <a class="code" href="app__osplookup_8c.html#a693603e5e4556641af06c8ebec1dffc5">OSP_INVALID_HANDLE</a>) {
<a name="l01103"></a>01103       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: Transaction handle undefined\n&quot;</span>);
<a name="l01104"></a>01104       result-&gt;<a class="code" href="structosp__result.html#a1d82d9e4992b32d67de1d608e14e40b5">numresults</a> = 0;
<a name="l01105"></a>01105       <span class="keywordflow">if</span> (result-&gt;<a class="code" href="structosp__result.html#a388041f010d6c445bc6625dad76bc321">inhandle</a> != <a class="code" href="app__osplookup_8c.html#a693603e5e4556641af06c8ebec1dffc5">OSP_INVALID_HANDLE</a>) {
<a name="l01106"></a>01106          OSPPTransactionRecordFailure(result-&gt;<a class="code" href="structosp__result.html#a388041f010d6c445bc6625dad76bc321">inhandle</a>, OSPC_FAIL_NORMAL_UNSPECIFIED);
<a name="l01107"></a>01107       }
<a name="l01108"></a>01108       <span class="keywordflow">return</span> -1;
<a name="l01109"></a>01109    }
<a name="l01110"></a>01110 
<a name="l01111"></a>01111    reason = <a class="code" href="app__osplookup_8c.html#af51938903a4cc1d253bfbf03b2a70d90" title="Convert Asterisk status to TC code.">asterisk2osp</a>(<a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a>);
<a name="l01112"></a>01112 
<a name="l01113"></a>01113    <span class="keywordflow">if</span> (!result-&gt;<a class="code" href="structosp__result.html#a1d82d9e4992b32d67de1d608e14e40b5">numresults</a>) {
<a name="l01114"></a>01114       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: No more destination\n&quot;</span>);
<a name="l01115"></a>01115       OSPPTransactionRecordFailure(result-&gt;<a class="code" href="structosp__result.html#a9510d026d1fc5261f447c25136359281">outhandle</a>, reason);
<a name="l01116"></a>01116       <span class="keywordflow">if</span> (result-&gt;<a class="code" href="structosp__result.html#a388041f010d6c445bc6625dad76bc321">inhandle</a> != <a class="code" href="app__osplookup_8c.html#a693603e5e4556641af06c8ebec1dffc5">OSP_INVALID_HANDLE</a>) {
<a name="l01117"></a>01117          OSPPTransactionRecordFailure(result-&gt;<a class="code" href="structosp__result.html#a388041f010d6c445bc6625dad76bc321">inhandle</a>, OSPC_FAIL_NO_ROUTE_TO_DEST);
<a name="l01118"></a>01118       }
<a name="l01119"></a>01119       <span class="keywordflow">return</span> 0;
<a name="l01120"></a>01120    }
<a name="l01121"></a>01121 
<a name="l01122"></a>01122    <span class="keywordflow">while</span>(result-&gt;<a class="code" href="structosp__result.html#a1d82d9e4992b32d67de1d608e14e40b5">numresults</a>) {
<a name="l01123"></a>01123       result-&gt;<a class="code" href="structosp__result.html#a1c4f969b78b88b37312e1b21bd759139">outcallid</a>.<a class="code" href="structosp__callid.html#a77124bd5f7e31e6fffc19f335da0c23f">len</a> = <span class="keyword">sizeof</span>(result-&gt;<a class="code" href="structosp__result.html#a1c4f969b78b88b37312e1b21bd759139">outcallid</a>.<a class="code" href="structosp__callid.html#af2f02dd4431344f38b58d78bee490fca">buf</a>);
<a name="l01124"></a>01124       tokenlen = <span class="keyword">sizeof</span>(token);
<a name="l01125"></a>01125       error = OSPPTransactionGetNextDestination(
<a name="l01126"></a>01126          result-&gt;<a class="code" href="structosp__result.html#a9510d026d1fc5261f447c25136359281">outhandle</a>,
<a name="l01127"></a>01127          reason,
<a name="l01128"></a>01128          0,
<a name="l01129"></a>01129          NULL,
<a name="l01130"></a>01130          NULL,
<a name="l01131"></a>01131          &amp;result-&gt;<a class="code" href="structosp__result.html#add3e2b56eb4cf1825b2f025088e2e3fb">outtimelimit</a>,
<a name="l01132"></a>01132          &amp;result-&gt;<a class="code" href="structosp__result.html#a1c4f969b78b88b37312e1b21bd759139">outcallid</a>.<a class="code" href="structosp__callid.html#a77124bd5f7e31e6fffc19f335da0c23f">len</a>,
<a name="l01133"></a>01133          result-&gt;<a class="code" href="structosp__result.html#a1c4f969b78b88b37312e1b21bd759139">outcallid</a>.<a class="code" href="structosp__callid.html#af2f02dd4431344f38b58d78bee490fca">buf</a>,
<a name="l01134"></a>01134          <span class="keyword">sizeof</span>(callednum),
<a name="l01135"></a>01135          callednum,
<a name="l01136"></a>01136          <span class="keyword">sizeof</span>(callingnum),
<a name="l01137"></a>01137          callingnum,
<a name="l01138"></a>01138          <span class="keyword">sizeof</span>(destination),
<a name="l01139"></a>01139          destination,
<a name="l01140"></a>01140          0,
<a name="l01141"></a>01141          NULL,
<a name="l01142"></a>01142          &amp;tokenlen,
<a name="l01143"></a>01143          token);
<a name="l01144"></a>01144       <span class="keywordflow">if</span> (error == OSPC_ERR_NO_ERROR) {
<a name="l01145"></a>01145          result-&gt;<a class="code" href="structosp__result.html#a1d82d9e4992b32d67de1d608e14e40b5">numresults</a>--;
<a name="l01146"></a>01146          result-&gt;<a class="code" href="structosp__result.html#add3e2b56eb4cf1825b2f025088e2e3fb">outtimelimit</a> = <a class="code" href="app__osplookup_8c.html#acad1656c35ed21d307a509194041383e" title="Choose min duration limit.">osp_choose_timelimit</a>(result-&gt;<a class="code" href="structosp__result.html#a63345dee69cafbcbc77a6966338e3c57">intimelimit</a>, result-&gt;<a class="code" href="structosp__result.html#add3e2b56eb4cf1825b2f025088e2e3fb">outtimelimit</a>);
<a name="l01147"></a>01147          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: outtimelimit &apos;%d&apos;\n&quot;</span>, result-&gt;<a class="code" href="structosp__result.html#add3e2b56eb4cf1825b2f025088e2e3fb">outtimelimit</a>);
<a name="l01148"></a>01148          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: called &apos;%s&apos;\n&quot;</span>, callednum);
<a name="l01149"></a>01149          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: calling &apos;%s&apos;\n&quot;</span>, callingnum);
<a name="l01150"></a>01150          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: destination &apos;%s&apos;\n&quot;</span>, destination);
<a name="l01151"></a>01151          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: token size &apos;%d&apos;\n&quot;</span>, tokenlen);
<a name="l01152"></a>01152 
<a name="l01153"></a>01153          <span class="keywordflow">if</span> ((res = <a class="code" href="app__osplookup_8c.html#ab1f3dd789f1e830e5e53204fe908a9d9" title="Choose min duration limit.">osp_check_destination</a>(p, callednum, callingnum, destination, tokenlen, token, &amp;reason, result)) &gt; 0) {
<a name="l01154"></a>01154             res = 1;
<a name="l01155"></a>01155             <span class="keywordflow">break</span>;
<a name="l01156"></a>01156          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!result-&gt;<a class="code" href="structosp__result.html#a1d82d9e4992b32d67de1d608e14e40b5">numresults</a>) {
<a name="l01157"></a>01157             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: No more destination\n&quot;</span>);
<a name="l01158"></a>01158             OSPPTransactionRecordFailure(result-&gt;<a class="code" href="structosp__result.html#a9510d026d1fc5261f447c25136359281">outhandle</a>, reason);
<a name="l01159"></a>01159             <span class="keywordflow">if</span> (result-&gt;<a class="code" href="structosp__result.html#a388041f010d6c445bc6625dad76bc321">inhandle</a> != <a class="code" href="app__osplookup_8c.html#a693603e5e4556641af06c8ebec1dffc5">OSP_INVALID_HANDLE</a>) {
<a name="l01160"></a>01160                OSPPTransactionRecordFailure(result-&gt;<a class="code" href="structosp__result.html#a388041f010d6c445bc6625dad76bc321">inhandle</a>, OSPC_FAIL_NO_ROUTE_TO_DEST);
<a name="l01161"></a>01161             }
<a name="l01162"></a>01162             res = 0;
<a name="l01163"></a>01163             <span class="keywordflow">break</span>;
<a name="l01164"></a>01164          }
<a name="l01165"></a>01165       } <span class="keywordflow">else</span> {
<a name="l01166"></a>01166          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: Unable to get route, error &apos;%d&apos;\n&quot;</span>, error);
<a name="l01167"></a>01167          result-&gt;<a class="code" href="structosp__result.html#ad8469d2c5b331a926d1e0dcfd1bd5a5d">token</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01168"></a>01168          result-&gt;<a class="code" href="structosp__result.html#a1d82d9e4992b32d67de1d608e14e40b5">numresults</a> = 0;
<a name="l01169"></a>01169          result-&gt;<a class="code" href="structosp__result.html#add3e2b56eb4cf1825b2f025088e2e3fb">outtimelimit</a> = <a class="code" href="app__osplookup_8c.html#aa216d244dea7f5d816cc35504c4390cc">OSP_DEF_TIMELIMIT</a>;
<a name="l01170"></a>01170          <span class="keywordflow">if</span> (result-&gt;<a class="code" href="structosp__result.html#a388041f010d6c445bc6625dad76bc321">inhandle</a> != <a class="code" href="app__osplookup_8c.html#a693603e5e4556641af06c8ebec1dffc5">OSP_INVALID_HANDLE</a>) {
<a name="l01171"></a>01171             OSPPTransactionRecordFailure(result-&gt;<a class="code" href="structosp__result.html#a388041f010d6c445bc6625dad76bc321">inhandle</a>, OSPC_FAIL_NORMAL_UNSPECIFIED);
<a name="l01172"></a>01172          }
<a name="l01173"></a>01173          res = -1;
<a name="l01174"></a>01174          <span class="keywordflow">break</span>;
<a name="l01175"></a>01175       }
<a name="l01176"></a>01176    }
<a name="l01177"></a>01177 
<a name="l01178"></a>01178    <span class="keywordflow">return</span> res;
<a name="l01179"></a>01179 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aeaa07e9dab5c74f1438507a11962f9f4"></a><!-- doxytag: member="app_osplookup.c::osp_unload" ref="aeaa07e9dab5c74f1438507a11962f9f4" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osp_unload </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l01837">1837</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="app__osplookup_8c_source.html#l00140">osp_provider::handle</a>, and <a class="el" href="app__osplookup_8c_source.html#l00141">osp_provider::next</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l01772">osp_load()</a>, and <a class="el" href="app__osplookup_8c_source.html#l02021">unload_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01838"></a>01838 {
<a name="l01839"></a>01839    <span class="keyword">struct </span><a class="code" href="structosp__provider.html">osp_provider</a>* p;
<a name="l01840"></a>01840    <span class="keyword">struct </span><a class="code" href="structosp__provider.html">osp_provider</a>* <a class="code" href="structosp__provider.html#a63a14d2d4363005a28ebcd7449452d43">next</a>;
<a name="l01841"></a>01841 
<a name="l01842"></a>01842    <span class="keywordflow">if</span> (<a class="code" href="app__osplookup_8c.html#a7b65a944814a9fe8b45330072c875e46">osp_initialized</a>) {
<a name="l01843"></a>01843       <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;osplock);
<a name="l01844"></a>01844       p = <a class="code" href="app__osplookup_8c.html#ac9590e73571584ed17bed31f03b87900">ospproviders</a>;
<a name="l01845"></a>01845       <span class="keywordflow">while</span>(p) {
<a name="l01846"></a>01846          next = p-&gt;<a class="code" href="structosp__provider.html#a63a14d2d4363005a28ebcd7449452d43">next</a>;
<a name="l01847"></a>01847          OSPPProviderDelete(p-&gt;<a class="code" href="structosp__provider.html#a62668053aefe0d5985c4ae7451db8486">handle</a>, 0);
<a name="l01848"></a>01848          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(p);
<a name="l01849"></a>01849          p = next;
<a name="l01850"></a>01850       }
<a name="l01851"></a>01851       <a class="code" href="app__osplookup_8c.html#ac9590e73571584ed17bed31f03b87900">ospproviders</a> = NULL;
<a name="l01852"></a>01852       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;osplock);
<a name="l01853"></a>01853 
<a name="l01854"></a>01854       OSPPCleanup();
<a name="l01855"></a>01855 
<a name="l01856"></a>01856       <a class="code" href="app__osplookup_8c.html#ab918a4031e5d25153fe54e91be1ac56e">osp_tokenformat</a> = TOKEN_ALGO_SIGNED;
<a name="l01857"></a>01857       <a class="code" href="app__osplookup_8c.html#a5ef0958fa463ae932e3e71ec39cd1337">osp_hardware</a> = 0;
<a name="l01858"></a>01858       <a class="code" href="app__osplookup_8c.html#a7b65a944814a9fe8b45330072c875e46">osp_initialized</a> = 0;
<a name="l01859"></a>01859    }
<a name="l01860"></a>01860    <span class="keywordflow">return</span> 0;
<a name="l01861"></a>01861 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2c7d2c2719f4021ede8420272bf5201d"></a><!-- doxytag: member="app_osplookup.c::osp_uuid2str" ref="a2c7d2c2719f4021ede8420272bf5201d" args="(unsigned char *uuid, char *buffer, unsigned int buffersize)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osp_uuid2str </td>
          <td>(</td>
          <td class="paramtype">unsigned char *&nbsp;</td>
          <td class="paramname"> <em>uuid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>buffersize</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>UUID to string. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>uuid</em>&nbsp;</td><td>UUID </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>buffer</em>&nbsp;</td><td>String buffer </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>buffersize</em>&nbsp;</td><td>String buffer size </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>1 Successed, -1 Error </dd></dl>

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00794">794</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>References <a class="el" href="app__osplookup_8c_source.html#l00061">OSP_UUIDSTR_SIZE</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l01335">osplookup_exec()</a>, and <a class="el" href="app__osplookup_8c_source.html#l01503">ospnext_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00798"></a>00798 {
<a name="l00799"></a>00799    <span class="keywordtype">int</span> res;
<a name="l00800"></a>00800 
<a name="l00801"></a>00801    <span class="keywordflow">if</span> (buffersize &gt; <a class="code" href="app__osplookup_8c.html#a6a64dee4ca45cb275f994bfcd9ff7a01">OSP_UUIDSTR_SIZE</a>) {
<a name="l00802"></a>00802       snprintf(buffer, buffersize, <span class="stringliteral">&quot;%02x%02x%02x%02x-%02x%02x-%02x%02x-%02x%02x-%02x%02x%02x%02x%02x%02x&quot;</span>,
<a name="l00803"></a>00803          uuid[0], uuid[1], uuid[2], uuid[3], uuid[4], uuid[5], uuid[6], uuid[7],
<a name="l00804"></a>00804          uuid[8], uuid[9], uuid[10], uuid[11], uuid[12], uuid[13], uuid[14], uuid[15]);
<a name="l00805"></a>00805       res = 1;
<a name="l00806"></a>00806    } <span class="keywordflow">else</span> {
<a name="l00807"></a>00807       res = -1;
<a name="l00808"></a>00808    }
<a name="l00809"></a>00809 
<a name="l00810"></a>00810    <span class="keywordflow">return</span> res;
<a name="l00811"></a>00811 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a435ee8a469fe74baa978a41ed722bc25"></a><!-- doxytag: member="app_osplookup.c::osp_validate_token" ref="a435ee8a469fe74baa978a41ed722bc25" args="(int transaction, const char *source, const char *destination, const char *calling, const char *called, const char *token, unsigned int *timelimit)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osp_validate_token </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>transaction</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>source</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>destination</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>calling</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>called</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>token</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int *&nbsp;</td>
          <td class="paramname"> <em>timelimit</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Validate OSP token of inbound call. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>transaction</em>&nbsp;</td><td>OSP transaction handle </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>source</em>&nbsp;</td><td>Source of inbound call </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>destination</em>&nbsp;</td><td>Destination of inbound call </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>calling</em>&nbsp;</td><td>Calling <a class="el" href="structnumber.html" title="Number structure.">number</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>called</em>&nbsp;</td><td>Called <a class="el" href="structnumber.html" title="Number structure.">number</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>token</em>&nbsp;</td><td>OSP token, may be empty </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>timelimit</em>&nbsp;</td><td>Call duration limit, output </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>1 Success, 0 Failed, -1 Error </dd></dl>

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00506">506</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>References <a class="el" href="utils_8c_source.html#l00264">ast_base64decode()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="chan__unistim_8c_source.html#l00183">dummy()</a>, <a class="el" href="app__osplookup_8c_source.html#l00481">osp_convert_address()</a>, <a class="el" href="app__osplookup_8c_source.html#l00057">OSP_NORSTR_SIZE</a>, and <a class="el" href="app__osplookup_8c_source.html#l00058">OSP_TOKSTR_SIZE</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l00707">osp_auth()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00514"></a>00514 {
<a name="l00515"></a>00515    <span class="keywordtype">int</span> res;
<a name="l00516"></a>00516    <span class="keywordtype">int</span> tokenlen;
<a name="l00517"></a>00517    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> tokenstr[<a class="code" href="app__osplookup_8c.html#a6d56e8f42ac71c7e7cebd6d4e0aa6f78">OSP_TOKSTR_SIZE</a>];
<a name="l00518"></a>00518    <span class="keywordtype">char</span> src[<a class="code" href="app__osplookup_8c.html#ab83d2712bd3bfe3e2f3631f97307fd0c">OSP_NORSTR_SIZE</a>];
<a name="l00519"></a>00519    <span class="keywordtype">char</span> dst[<a class="code" href="app__osplookup_8c.html#ab83d2712bd3bfe3e2f3631f97307fd0c">OSP_NORSTR_SIZE</a>];
<a name="l00520"></a>00520    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> authorised;
<a name="l00521"></a>00521    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="chan__unistim_8c.html#abc0ce15d00b4bfb69266c5fd016dc88c">dummy</a> = 0;
<a name="l00522"></a>00522    <span class="keywordtype">int</span> error;
<a name="l00523"></a>00523 
<a name="l00524"></a>00524    tokenlen = <a class="code" href="utils_8h.html#a1e7e06bd20719ecfd58b67f230780ffa" title="Decode data from base64.">ast_base64decode</a>(tokenstr, token, strlen(token));
<a name="l00525"></a>00525    <a class="code" href="app__osplookup_8c.html#aa919e8f63ad9ab313b720151246ecc33" title="Convert address to &amp;quot;[x.x.x.x]&amp;quot; or &amp;quot;host.domain&amp;quot; format.">osp_convert_address</a>(<a class="code" href="structosp__provider.html#aaf4b604d6f82f265bafb3f5810ffd0ef">source</a>, src, <span class="keyword">sizeof</span>(src));
<a name="l00526"></a>00526    <a class="code" href="app__osplookup_8c.html#aa919e8f63ad9ab313b720151246ecc33" title="Convert address to &amp;quot;[x.x.x.x]&amp;quot; or &amp;quot;host.domain&amp;quot; format.">osp_convert_address</a>(destination, dst, <span class="keyword">sizeof</span>(dst));
<a name="l00527"></a>00527    error = OSPPTransactionValidateAuthorisation(
<a name="l00528"></a>00528       transaction,
<a name="l00529"></a>00529       src,
<a name="l00530"></a>00530       dst,
<a name="l00531"></a>00531       NULL,
<a name="l00532"></a>00532       NULL,
<a name="l00533"></a>00533       calling ? calling : <span class="stringliteral">&quot;&quot;</span>,
<a name="l00534"></a>00534       OSPC_NFORMAT_E164,
<a name="l00535"></a>00535       called,
<a name="l00536"></a>00536       OSPC_NFORMAT_E164,
<a name="l00537"></a>00537       0,
<a name="l00538"></a>00538       NULL,
<a name="l00539"></a>00539       tokenlen,
<a name="l00540"></a>00540       (<span class="keywordtype">char</span>*)tokenstr,
<a name="l00541"></a>00541       &amp;authorised,
<a name="l00542"></a>00542       timelimit,
<a name="l00543"></a>00543       &amp;dummy,
<a name="l00544"></a>00544       NULL,
<a name="l00545"></a>00545       <a class="code" href="app__osplookup_8c.html#ab918a4031e5d25153fe54e91be1ac56e">osp_tokenformat</a>);
<a name="l00546"></a>00546    <span class="keywordflow">if</span> (error != OSPC_ERR_NO_ERROR) {
<a name="l00547"></a>00547       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: Unable to validate inbound token, error &apos;%d&apos;\n&quot;</span>, error);
<a name="l00548"></a>00548       res = -1;
<a name="l00549"></a>00549    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (authorised) {
<a name="l00550"></a>00550       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: Authorised\n&quot;</span>);
<a name="l00551"></a>00551       res = 1;
<a name="l00552"></a>00552    } <span class="keywordflow">else</span> {
<a name="l00553"></a>00553       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSP: Unauthorised\n&quot;</span>);
<a name="l00554"></a>00554       res = 0;
<a name="l00555"></a>00555    }
<a name="l00556"></a>00556 
<a name="l00557"></a>00557    <span class="keywordflow">return</span> res;
<a name="l00558"></a>00558 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a30e6f7b8ac96cab586c505f27a05c023"></a><!-- doxytag: member="app_osplookup.c::ospauth_exec" ref="a30e6f7b8ac96cab586c505f27a05c023" args="(struct ast_channel *chan, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ospauth_exec </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>OSP Application OSPAuth. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>Parameter </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 Success, -1 Failed </dd></dl>

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l01255">1255</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>References <a class="el" href="app_8h_source.html#l00338">AST_APP_ARG</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="app_8h_source.html#l00355">AST_DECLARE_APP_ARGS</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="astosp_8h_source.html#l00029">AST_OSP_ERROR</a>, <a class="el" href="astosp_8h_source.html#l00028">AST_OSP_FAILED</a>, <a class="el" href="astosp_8h_source.html#l00027">AST_OSP_SUCCESS</a>, <a class="el" href="app_8h_source.html#l00387">AST_STANDARD_APP_ARGS</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="chanvars_8c_source.html#l00065">ast_var_name()</a>, <a class="el" href="chanvars_8c_source.html#l00085">ast_var_value()</a>, <a class="el" href="channel_8h_source.html#l00444">ast_channel::cid</a>, <a class="el" href="channel_8h_source.html#l00203">ast_callerid::cid_num</a>, <a class="el" href="channel_8h_source.html#l00504">ast_channel::exten</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="app__osplookup_8c_source.html#l00707">osp_auth()</a>, <a class="el" href="app__osplookup_8c_source.html#l00098">OSP_DEF_PROVIDER</a>, <a class="el" href="app__osplookup_8c_source.html#l00121">OSP_DEF_TIMELIMIT</a>, <a class="el" href="app__osplookup_8c_source.html#l00056">OSP_INTSTR_SIZE</a>, <a class="el" href="pbx_8c_source.html#l09023">pbx_builtin_setvar_helper()</a>, <a class="el" href="app__jack_8c_source.html#l00141">status</a>, and <a class="el" href="channel_8h_source.html#l00446">ast_channel::varshead</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l02005">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01258"></a>01258 {
<a name="l01259"></a>01259    <span class="keywordtype">int</span> res;
<a name="l01260"></a>01260    <span class="keyword">const</span> <span class="keywordtype">char</span>* provider = <a class="code" href="app__osplookup_8c.html#af74db93429d82818224639f0097189b2">OSP_DEF_PROVIDER</a>;
<a name="l01261"></a>01261    <span class="keyword">struct </span>varshead* headp;
<a name="l01262"></a>01262    <span class="keyword">struct </span><a class="code" href="structast__var__t.html">ast_var_t</a>* current;
<a name="l01263"></a>01263    <span class="keyword">const</span> <span class="keywordtype">char</span>* source = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01264"></a>01264    <span class="keyword">const</span> <span class="keywordtype">char</span>* token = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01265"></a>01265    <span class="keywordtype">int</span> handle;
<a name="l01266"></a>01266    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> timelimit;
<a name="l01267"></a>01267    <span class="keywordtype">char</span> buffer[<a class="code" href="app__osplookup_8c.html#a93893abbaa41d3b57d9aaf4499fc2e93">OSP_INTSTR_SIZE</a>];
<a name="l01268"></a>01268    <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a>;
<a name="l01269"></a>01269    <span class="keywordtype">char</span>* tmp;
<a name="l01270"></a>01270 
<a name="l01271"></a>01271    <a class="code" href="app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2" title="Declare a structure to hold an application&amp;#39;s arguments.">AST_DECLARE_APP_ARGS</a>(args,
<a name="l01272"></a>01272       <a class="code" href="app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5" title="Define an application argument.">AST_APP_ARG</a>(provider);
<a name="l01273"></a>01273       <a class="code" href="app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5" title="Define an application argument.">AST_APP_ARG</a>(options);
<a name="l01274"></a>01274    );
<a name="l01275"></a>01275 
<a name="l01276"></a>01276    <span class="keywordflow">if</span> (!(tmp = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(data))) {
<a name="l01277"></a>01277       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Out of memory\n&quot;</span>);
<a name="l01278"></a>01278       <span class="keywordflow">return</span> -1;
<a name="l01279"></a>01279    }
<a name="l01280"></a>01280 
<a name="l01281"></a>01281    <a class="code" href="app_8h.html#ac08f7eb1eb9476b30987c73e1052ada8" title="Performs the &amp;#39;standard&amp;#39; argument separation process for an application.">AST_STANDARD_APP_ARGS</a>(args, tmp);
<a name="l01282"></a>01282 
<a name="l01283"></a>01283    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(args.provider)) {
<a name="l01284"></a>01284       provider = args.provider;
<a name="l01285"></a>01285    }
<a name="l01286"></a>01286    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPAuth: provider &apos;%s&apos;\n&quot;</span>, provider);
<a name="l01287"></a>01287 
<a name="l01288"></a>01288    headp = &amp;chan-&gt;<a class="code" href="structast__channel.html#a9ffb22045a8f14bef8f2137cd779ab25">varshead</a>;
<a name="l01289"></a>01289    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(headp, current, entries) {
<a name="l01290"></a>01290       <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="chanvars_8h.html#a356a31cd608ec07d3668dcd589be49d8">ast_var_name</a>(current), <span class="stringliteral">&quot;OSPPEERIP&quot;</span>)) {
<a name="l01291"></a>01291          source = <a class="code" href="chanvars_8h.html#a8e0081172db71c5021d20706c50d959c">ast_var_value</a>(current);
<a name="l01292"></a>01292       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="chanvars_8h.html#a356a31cd608ec07d3668dcd589be49d8">ast_var_name</a>(current), <span class="stringliteral">&quot;OSPINTOKEN&quot;</span>)) {
<a name="l01293"></a>01293          token = <a class="code" href="chanvars_8h.html#a8e0081172db71c5021d20706c50d959c">ast_var_value</a>(current);
<a name="l01294"></a>01294       }
<a name="l01295"></a>01295    }
<a name="l01296"></a>01296 
<a name="l01297"></a>01297    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPAuth: source &apos;%s&apos;\n&quot;</span>, source);
<a name="l01298"></a>01298    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPAuth: token size &apos;%zd&apos;\n&quot;</span>, strlen(token));
<a name="l01299"></a>01299 
<a name="l01300"></a>01300    <span class="keywordflow">if</span> ((res = <a class="code" href="app__osplookup_8c.html#accd86e4e5ad2335945459345e2052161" title="OSP Authentication function.">osp_auth</a>(provider, &amp;handle, source, chan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>, chan-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>, token, &amp;timelimit)) &gt; 0) {
<a name="l01301"></a>01301       status = <a class="code" href="astosp_8h.html#a4edfd60cd85aa2fe7e16c321ab22946e">AST_OSP_SUCCESS</a>;
<a name="l01302"></a>01302    } <span class="keywordflow">else</span> {
<a name="l01303"></a>01303       timelimit = <a class="code" href="app__osplookup_8c.html#aa216d244dea7f5d816cc35504c4390cc">OSP_DEF_TIMELIMIT</a>;
<a name="l01304"></a>01304       <span class="keywordflow">if</span> (!res) {
<a name="l01305"></a>01305          status = <a class="code" href="astosp_8h.html#a5c2ee32159a9e5470c8aaf6095c589d0">AST_OSP_FAILED</a>;
<a name="l01306"></a>01306       } <span class="keywordflow">else</span> {
<a name="l01307"></a>01307          status = <a class="code" href="astosp_8h.html#a6cc274d33a95b3491cafc75d6e9cd01b">AST_OSP_ERROR</a>;
<a name="l01308"></a>01308       }
<a name="l01309"></a>01309    }
<a name="l01310"></a>01310 
<a name="l01311"></a>01311    snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;%d&quot;</span>, handle);
<a name="l01312"></a>01312    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;OSPINHANDLE&quot;</span>, buffer);
<a name="l01313"></a>01313    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPAuth: OSPINHANDLE &apos;%s&apos;\n&quot;</span>, buffer);
<a name="l01314"></a>01314    snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;%d&quot;</span>, timelimit);
<a name="l01315"></a>01315    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;OSPINTIMELIMIT&quot;</span>, buffer);
<a name="l01316"></a>01316    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPAuth: OSPINTIMELIMIT &apos;%s&apos;\n&quot;</span>, buffer);
<a name="l01317"></a>01317    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;OSPAUTHSTATUS&quot;</span>, status);
<a name="l01318"></a>01318    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPAuth: %s\n&quot;</span>, status);
<a name="l01319"></a>01319 
<a name="l01320"></a>01320    <span class="keywordflow">if</span>(res &lt;= 0) {
<a name="l01321"></a>01321       res = -1;
<a name="l01322"></a>01322    } <span class="keywordflow">else</span> {
<a name="l01323"></a>01323       res = 0;
<a name="l01324"></a>01324    }
<a name="l01325"></a>01325 
<a name="l01326"></a>01326    <span class="keywordflow">return</span> res;
<a name="l01327"></a>01327 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a010b3b9e4bae42c2d0d0c751295121bc"></a><!-- doxytag: member="app_osplookup.c::ospfinished_exec" ref="a010b3b9e4bae42c2d0d0c751295121bc" args="(struct ast_channel *chan, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ospfinished_exec </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>OSP Application OSPFinish. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>Parameter </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 Success, -1 Failed </dd></dl>

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l01657">1657</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>References <a class="el" href="cdr_8h_source.html#l00089">ast_cdr::answer</a>, <a class="el" href="app_8h_source.html#l00338">AST_APP_ARG</a>, <a class="el" href="causes_8h_source.html#l00099">AST_CAUSE_NO_ROUTE_DESTINATION</a>, <a class="el" href="causes_8h_source.html#l00102">AST_CAUSE_NORMAL_CLEARING</a>, <a class="el" href="channel_8c_source.html#l00461">ast_check_hangup()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="app_8h_source.html#l00355">AST_DECLARE_APP_ARGS</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="astosp_8h_source.html#l00029">AST_OSP_ERROR</a>, <a class="el" href="astosp_8h_source.html#l00028">AST_OSP_FAILED</a>, <a class="el" href="astosp_8h_source.html#l00027">AST_OSP_SUCCESS</a>, <a class="el" href="app_8h_source.html#l00387">AST_STANDARD_APP_ARGS</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="chanvars_8c_source.html#l00065">ast_var_name()</a>, <a class="el" href="chanvars_8c_source.html#l00085">ast_var_value()</a>, <a class="el" href="channel_8c_source.html#l00136">cause</a>, <a class="el" href="channel_8h_source.html#l00422">ast_channel::cdr</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="app__osplookup_8c_source.html#l01192">osp_finish()</a>, <a class="el" href="app__osplookup_8c_source.html#l00056">OSP_INTSTR_SIZE</a>, <a class="el" href="app__osplookup_8c_source.html#l00095">OSP_INVALID_HANDLE</a>, <a class="el" href="pbx_8c_source.html#l09023">pbx_builtin_setvar_helper()</a>, <a class="el" href="cdr_8h_source.html#l00087">ast_cdr::start</a>, <a class="el" href="app__jack_8c_source.html#l00141">status</a>, and <a class="el" href="channel_8h_source.html#l00446">ast_channel::varshead</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l02005">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01660"></a>01660 {
<a name="l01661"></a>01661    <span class="keywordtype">int</span> res = 1;
<a name="l01662"></a>01662    <span class="keywordtype">int</span> <a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a> = 0;
<a name="l01663"></a>01663    <span class="keyword">struct </span>varshead* headp;
<a name="l01664"></a>01664    <span class="keyword">struct </span><a class="code" href="structast__var__t.html">ast_var_t</a>* current;
<a name="l01665"></a>01665    <span class="keywordtype">int</span> inhandle = <a class="code" href="app__osplookup_8c.html#a693603e5e4556641af06c8ebec1dffc5">OSP_INVALID_HANDLE</a>;
<a name="l01666"></a>01666    <span class="keywordtype">int</span> outhandle = <a class="code" href="app__osplookup_8c.html#a693603e5e4556641af06c8ebec1dffc5">OSP_INVALID_HANDLE</a>;
<a name="l01667"></a>01667    <span class="keywordtype">int</span> recorded = 0;
<a name="l01668"></a>01668    time_t start, connect, end;
<a name="l01669"></a>01669    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> release;
<a name="l01670"></a>01670    <span class="keywordtype">char</span> buffer[<a class="code" href="app__osplookup_8c.html#a93893abbaa41d3b57d9aaf4499fc2e93">OSP_INTSTR_SIZE</a>];
<a name="l01671"></a>01671    <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a>;
<a name="l01672"></a>01672    <span class="keywordtype">char</span>* tmp;
<a name="l01673"></a>01673 
<a name="l01674"></a>01674    <a class="code" href="app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2" title="Declare a structure to hold an application&amp;#39;s arguments.">AST_DECLARE_APP_ARGS</a>(args,
<a name="l01675"></a>01675       <a class="code" href="app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5" title="Define an application argument.">AST_APP_ARG</a>(cause);
<a name="l01676"></a>01676       <a class="code" href="app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5" title="Define an application argument.">AST_APP_ARG</a>(options);
<a name="l01677"></a>01677    );
<a name="l01678"></a>01678 
<a name="l01679"></a>01679    <span class="keywordflow">if</span> (!(tmp = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(data))) {
<a name="l01680"></a>01680       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Out of memory\n&quot;</span>);
<a name="l01681"></a>01681       <span class="keywordflow">return</span> -1;
<a name="l01682"></a>01682    }
<a name="l01683"></a>01683 
<a name="l01684"></a>01684    <a class="code" href="app_8h.html#ac08f7eb1eb9476b30987c73e1052ada8" title="Performs the &amp;#39;standard&amp;#39; argument separation process for an application.">AST_STANDARD_APP_ARGS</a>(args, tmp);
<a name="l01685"></a>01685 
<a name="l01686"></a>01686    headp = &amp;chan-&gt;<a class="code" href="structast__channel.html#a9ffb22045a8f14bef8f2137cd779ab25">varshead</a>;
<a name="l01687"></a>01687    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(headp, current, entries) {
<a name="l01688"></a>01688       <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="chanvars_8h.html#a356a31cd608ec07d3668dcd589be49d8">ast_var_name</a>(current), <span class="stringliteral">&quot;OSPINHANDLE&quot;</span>)) {
<a name="l01689"></a>01689          <span class="keywordflow">if</span> (sscanf(<a class="code" href="chanvars_8h.html#a8e0081172db71c5021d20706c50d959c">ast_var_value</a>(current), <span class="stringliteral">&quot;%30d&quot;</span>, &amp;inhandle) != 1) {
<a name="l01690"></a>01690             inhandle = <a class="code" href="app__osplookup_8c.html#a693603e5e4556641af06c8ebec1dffc5">OSP_INVALID_HANDLE</a>;
<a name="l01691"></a>01691          }
<a name="l01692"></a>01692       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="chanvars_8h.html#a356a31cd608ec07d3668dcd589be49d8">ast_var_name</a>(current), <span class="stringliteral">&quot;OSPOUTHANDLE&quot;</span>)) {
<a name="l01693"></a>01693          <span class="keywordflow">if</span> (sscanf(<a class="code" href="chanvars_8h.html#a8e0081172db71c5021d20706c50d959c">ast_var_value</a>(current), <span class="stringliteral">&quot;%30d&quot;</span>, &amp;outhandle) != 1) {
<a name="l01694"></a>01694             outhandle = <a class="code" href="app__osplookup_8c.html#a693603e5e4556641af06c8ebec1dffc5">OSP_INVALID_HANDLE</a>;
<a name="l01695"></a>01695          }
<a name="l01696"></a>01696       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!recorded &amp;&amp;
<a name="l01697"></a>01697          (!strcasecmp(<a class="code" href="chanvars_8h.html#a356a31cd608ec07d3668dcd589be49d8">ast_var_name</a>(current), <span class="stringliteral">&quot;OSPAUTHSTATUS&quot;</span>) ||
<a name="l01698"></a>01698          !strcasecmp(<a class="code" href="chanvars_8h.html#a356a31cd608ec07d3668dcd589be49d8">ast_var_name</a>(current), <span class="stringliteral">&quot;OSPLOOKUPSTATUS&quot;</span>) ||
<a name="l01699"></a>01699          !strcasecmp(<a class="code" href="chanvars_8h.html#a356a31cd608ec07d3668dcd589be49d8">ast_var_name</a>(current), <span class="stringliteral">&quot;OSPNEXTSTATUS&quot;</span>)))
<a name="l01700"></a>01700       {
<a name="l01701"></a>01701          <span class="keywordflow">if</span> (strcasecmp(<a class="code" href="chanvars_8h.html#a8e0081172db71c5021d20706c50d959c">ast_var_value</a>(current), <a class="code" href="astosp_8h.html#a4edfd60cd85aa2fe7e16c321ab22946e">AST_OSP_SUCCESS</a>)) {
<a name="l01702"></a>01702             recorded = 1;
<a name="l01703"></a>01703          }
<a name="l01704"></a>01704       }
<a name="l01705"></a>01705    }
<a name="l01706"></a>01706    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPFinish: OSPINHANDLE &apos;%d&apos;\n&quot;</span>, inhandle);
<a name="l01707"></a>01707    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPFinish: OSPOUTHANDLE &apos;%d&apos;\n&quot;</span>, outhandle);
<a name="l01708"></a>01708    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPFinish: recorded &apos;%d&apos;\n&quot;</span>, recorded);
<a name="l01709"></a>01709 
<a name="l01710"></a>01710    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(args.cause) &amp;&amp; sscanf(args.cause, <span class="stringliteral">&quot;%30d&quot;</span>, &amp;cause) != 1) {
<a name="l01711"></a>01711       cause = 0;
<a name="l01712"></a>01712    }
<a name="l01713"></a>01713    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPFinish: cause &apos;%d&apos;\n&quot;</span>, cause);
<a name="l01714"></a>01714 
<a name="l01715"></a>01715    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>) {
<a name="l01716"></a>01716       start = chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>-&gt;<a class="code" href="structast__cdr.html#ad80305b5e16da9c2675d5f057bd69386">start</a>.tv_sec;
<a name="l01717"></a>01717       connect = chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>-&gt;<a class="code" href="structast__cdr.html#a621c14aed7c59835c5bc93bc88e8f3d9">answer</a>.tv_sec;
<a name="l01718"></a>01718       <span class="keywordflow">if</span> (connect) {
<a name="l01719"></a>01719          end = time(NULL);
<a name="l01720"></a>01720       } <span class="keywordflow">else</span> {
<a name="l01721"></a>01721          end = connect;
<a name="l01722"></a>01722       }
<a name="l01723"></a>01723    } <span class="keywordflow">else</span> {
<a name="l01724"></a>01724       start = 0;
<a name="l01725"></a>01725       connect = 0;
<a name="l01726"></a>01726       end = 0;
<a name="l01727"></a>01727    }
<a name="l01728"></a>01728    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPFinish: start &apos;%ld&apos;\n&quot;</span>, start);
<a name="l01729"></a>01729    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPFinish: connect &apos;%ld&apos;\n&quot;</span>, connect);
<a name="l01730"></a>01730    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPFinish: end &apos;%ld&apos;\n&quot;</span>, end);
<a name="l01731"></a>01731 
<a name="l01732"></a>01732    release = <a class="code" href="channel_8h.html#a9c63fff1d736568d1ee332dd7ea502bd" title="Check to see if a channel is needing hang up.">ast_check_hangup</a>(chan) ? 0 : 1;
<a name="l01733"></a>01733 
<a name="l01734"></a>01734    <span class="keywordflow">if</span> (<a class="code" href="app__osplookup_8c.html#a88030927dfd5fa77661b8368cd6089e2" title="OSP Finish function.">osp_finish</a>(outhandle, recorded, cause, start, connect, end, release) &lt;= 0) {
<a name="l01735"></a>01735       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPFinish: Unable to report usage for outbound call\n&quot;</span>);
<a name="l01736"></a>01736    }
<a name="l01737"></a>01737    <span class="keywordflow">switch</span> (cause) {
<a name="l01738"></a>01738    <span class="keywordflow">case</span> <a class="code" href="causes_8h.html#af2235eb1c27925e4020ce286255d165f">AST_CAUSE_NORMAL_CLEARING</a>:
<a name="l01739"></a>01739       <span class="keywordflow">break</span>;
<a name="l01740"></a>01740    <span class="keywordflow">default</span>:
<a name="l01741"></a>01741       cause = <a class="code" href="causes_8h.html#ace4ceec464072bb9e269b6a52e7a6631">AST_CAUSE_NO_ROUTE_DESTINATION</a>;
<a name="l01742"></a>01742       <span class="keywordflow">break</span>;
<a name="l01743"></a>01743    }
<a name="l01744"></a>01744    <span class="keywordflow">if</span> (<a class="code" href="app__osplookup_8c.html#a88030927dfd5fa77661b8368cd6089e2" title="OSP Finish function.">osp_finish</a>(inhandle, recorded, cause, start, connect, end, release) &lt;= 0) {
<a name="l01745"></a>01745       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPFinish: Unable to report usage for inbound call\n&quot;</span>);
<a name="l01746"></a>01746    }
<a name="l01747"></a>01747    snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;%d&quot;</span>, <a class="code" href="app__osplookup_8c.html#a693603e5e4556641af06c8ebec1dffc5">OSP_INVALID_HANDLE</a>);
<a name="l01748"></a>01748    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;OSPOUTHANDLE&quot;</span>, buffer);
<a name="l01749"></a>01749    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;OSPINHANDLE&quot;</span>, buffer);
<a name="l01750"></a>01750 
<a name="l01751"></a>01751    <span class="keywordflow">if</span> (res &gt; 0) {
<a name="l01752"></a>01752       status = <a class="code" href="astosp_8h.html#a4edfd60cd85aa2fe7e16c321ab22946e">AST_OSP_SUCCESS</a>;
<a name="l01753"></a>01753    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!res) {
<a name="l01754"></a>01754       status = <a class="code" href="astosp_8h.html#a5c2ee32159a9e5470c8aaf6095c589d0">AST_OSP_FAILED</a>;
<a name="l01755"></a>01755    } <span class="keywordflow">else</span> {
<a name="l01756"></a>01756       status = <a class="code" href="astosp_8h.html#a6cc274d33a95b3491cafc75d6e9cd01b">AST_OSP_ERROR</a>;
<a name="l01757"></a>01757    }
<a name="l01758"></a>01758    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;OSPFINISHSTATUS&quot;</span>, status);
<a name="l01759"></a>01759 
<a name="l01760"></a>01760    <span class="keywordflow">if</span>(!res) {
<a name="l01761"></a>01761       res = -1;
<a name="l01762"></a>01762    } <span class="keywordflow">else</span> {
<a name="l01763"></a>01763       res = 0;
<a name="l01764"></a>01764    }
<a name="l01765"></a>01765 
<a name="l01766"></a>01766    <span class="keywordflow">return</span> res;
<a name="l01767"></a>01767 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4122506208193e0aa12724e0d8b39881"></a><!-- doxytag: member="app_osplookup.c::osplookup_exec" ref="a4122506208193e0aa12724e0d8b39881" args="(struct ast_channel *chan, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int osplookup_exec </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>OSP Application OSPLookup. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>Parameter </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 Success, -1 Failed </dd></dl>

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l01335">1335</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>References <a class="el" href="app_8h_source.html#l00338">AST_APP_ARG</a>, <a class="el" href="autoservice_8c_source.html#l00192">ast_autoservice_start()</a>, <a class="el" href="autoservice_8c_source.html#l00251">ast_autoservice_stop()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="app_8h_source.html#l00355">AST_DECLARE_APP_ARGS</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="astosp_8h_source.html#l00029">AST_OSP_ERROR</a>, <a class="el" href="astosp_8h_source.html#l00028">AST_OSP_FAILED</a>, <a class="el" href="astosp_8h_source.html#l00027">AST_OSP_SUCCESS</a>, <a class="el" href="app_8h_source.html#l00387">AST_STANDARD_APP_ARGS</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="chanvars_8c_source.html#l00065">ast_var_name()</a>, <a class="el" href="chanvars_8c_source.html#l00085">ast_var_value()</a>, <a class="el" href="app__osplookup_8c_source.html#l00146">osp_callid::buf</a>, <a class="el" href="app__osplookup_8c_source.html#l00158">osp_result::called</a>, <a class="el" href="app__osplookup_8c_source.html#l00159">osp_result::calling</a>, <a class="el" href="channel_8h_source.html#l00444">ast_channel::cid</a>, <a class="el" href="channel_8h_source.html#l00203">ast_callerid::cid_num</a>, <a class="el" href="app__osplookup_8c_source.html#l00157">osp_result::dest</a>, <a class="el" href="chan__alsa_8c_source.html#l00107">exten</a>, <a class="el" href="app__osplookup_8c_source.html#l00152">osp_result::inhandle</a>, <a class="el" href="app__osplookup_8c_source.html#l00154">osp_result::intimelimit</a>, <a class="el" href="app__osplookup_8c_source.html#l00147">osp_callid::len</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="app__osplookup_8c_source.html#l00161">osp_result::networkid</a>, <a class="el" href="app__osplookup_8c_source.html#l00162">osp_result::numresults</a>, <a class="el" href="app__osplookup_8c_source.html#l00072">OSP_CALLID_H323</a>, <a class="el" href="app__osplookup_8c_source.html#l00074">OSP_CALLID_IAX</a>, <a class="el" href="app__osplookup_8c_source.html#l00073">OSP_CALLID_SIP</a>, <a class="el" href="app__osplookup_8c_source.html#l00071">OSP_CALLID_UNDEFINED</a>, <a class="el" href="app__osplookup_8c_source.html#l00098">OSP_DEF_PROVIDER</a>, <a class="el" href="app__osplookup_8c_source.html#l00121">OSP_DEF_TIMELIMIT</a>, <a class="el" href="app__osplookup_8c_source.html#l00095">OSP_INVALID_HANDLE</a>, <a class="el" href="app__osplookup_8c_source.html#l00856">osp_lookup()</a>, <a class="el" href="app__osplookup_8c_source.html#l00092">OSP_SIP_HEADER</a>, <a class="el" href="app__osplookup_8c_source.html#l00087">OSP_TECH_H323</a>, <a class="el" href="app__osplookup_8c_source.html#l00089">OSP_TECH_IAX</a>, <a class="el" href="app__osplookup_8c_source.html#l00088">OSP_TECH_SIP</a>, <a class="el" href="app__osplookup_8c_source.html#l00058">OSP_TOKSTR_SIZE</a>, <a class="el" href="app__osplookup_8c_source.html#l00794">osp_uuid2str()</a>, <a class="el" href="app__osplookup_8c_source.html#l00163">osp_result::outcallid</a>, <a class="el" href="app__osplookup_8c_source.html#l00153">osp_result::outhandle</a>, <a class="el" href="app__osplookup_8c_source.html#l00155">osp_result::outtimelimit</a>, <a class="el" href="pbx_8c_source.html#l09023">pbx_builtin_setvar_helper()</a>, <a class="el" href="app__jack_8c_source.html#l00141">status</a>, <a class="el" href="app__osplookup_8c_source.html#l00156">osp_result::tech</a>, <a class="el" href="app__osplookup_8c_source.html#l00160">osp_result::token</a>, and <a class="el" href="channel_8h_source.html#l00446">ast_channel::varshead</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l02005">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01338"></a>01338 {
<a name="l01339"></a>01339    <span class="keywordtype">int</span> res, cres;
<a name="l01340"></a>01340    <span class="keyword">const</span> <span class="keywordtype">char</span>* provider = <a class="code" href="app__osplookup_8c.html#af74db93429d82818224639f0097189b2">OSP_DEF_PROVIDER</a>;
<a name="l01341"></a>01341    <span class="keyword">struct </span>varshead* headp;
<a name="l01342"></a>01342    <span class="keyword">struct </span><a class="code" href="structast__var__t.html">ast_var_t</a>* current;
<a name="l01343"></a>01343    <span class="keyword">const</span> <span class="keywordtype">char</span>* srcdev = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01344"></a>01344    <span class="keyword">const</span> <span class="keywordtype">char</span>* snetid = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01345"></a>01345    <span class="keywordtype">char</span> buffer[<a class="code" href="app__osplookup_8c.html#a6d56e8f42ac71c7e7cebd6d4e0aa6f78">OSP_TOKSTR_SIZE</a>];
<a name="l01346"></a>01346    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> callidtypes = <a class="code" href="app__osplookup_8c.html#adbc9aec0d1c7059d1b29858f4d43c30d">OSP_CALLID_UNDEFINED</a>;
<a name="l01347"></a>01347    <span class="keyword">struct </span><a class="code" href="structosp__result.html">osp_result</a> result;
<a name="l01348"></a>01348    <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a>;
<a name="l01349"></a>01349    <span class="keywordtype">char</span>* tmp;
<a name="l01350"></a>01350 
<a name="l01351"></a>01351    <a class="code" href="app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2" title="Declare a structure to hold an application&amp;#39;s arguments.">AST_DECLARE_APP_ARGS</a>(args,
<a name="l01352"></a>01352       <a class="code" href="app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5" title="Define an application argument.">AST_APP_ARG</a>(<a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>);
<a name="l01353"></a>01353       <a class="code" href="app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5" title="Define an application argument.">AST_APP_ARG</a>(provider);
<a name="l01354"></a>01354       <a class="code" href="app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5" title="Define an application argument.">AST_APP_ARG</a>(options);
<a name="l01355"></a>01355    );
<a name="l01356"></a>01356 
<a name="l01357"></a>01357    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(data)) {
<a name="l01358"></a>01358       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;OSPLookup: Arg required, OSPLookup(exten[|provider[|options]])\n&quot;</span>);
<a name="l01359"></a>01359       <span class="keywordflow">return</span> -1;
<a name="l01360"></a>01360    }
<a name="l01361"></a>01361 
<a name="l01362"></a>01362    <span class="keywordflow">if</span> (!(tmp = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(data))) {
<a name="l01363"></a>01363       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Out of memory\n&quot;</span>);
<a name="l01364"></a>01364       <span class="keywordflow">return</span> -1;
<a name="l01365"></a>01365    }
<a name="l01366"></a>01366 
<a name="l01367"></a>01367    <a class="code" href="app_8h.html#ac08f7eb1eb9476b30987c73e1052ada8" title="Performs the &amp;#39;standard&amp;#39; argument separation process for an application.">AST_STANDARD_APP_ARGS</a>(args, tmp);
<a name="l01368"></a>01368 
<a name="l01369"></a>01369    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPLookup: exten &apos;%s&apos;\n&quot;</span>, args.exten);
<a name="l01370"></a>01370 
<a name="l01371"></a>01371    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(args.provider)) {
<a name="l01372"></a>01372       provider = args.provider;
<a name="l01373"></a>01373    }
<a name="l01374"></a>01374    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPlookup: provider &apos;%s&apos;\n&quot;</span>, provider);
<a name="l01375"></a>01375 
<a name="l01376"></a>01376    <span class="keywordflow">if</span> (args.options) {
<a name="l01377"></a>01377       <span class="keywordflow">if</span> (strchr(args.options, <span class="charliteral">&apos;h&apos;</span>)) {
<a name="l01378"></a>01378          callidtypes |= <a class="code" href="app__osplookup_8c.html#a25a1a9044e69c1b41d40f79d1216d4c3">OSP_CALLID_H323</a>;
<a name="l01379"></a>01379       }
<a name="l01380"></a>01380       <span class="keywordflow">if</span> (strchr(args.options, <span class="charliteral">&apos;s&apos;</span>)) {
<a name="l01381"></a>01381          callidtypes |= <a class="code" href="app__osplookup_8c.html#a1725c43ee772f3901c2bd542f9582ee1">OSP_CALLID_SIP</a>;
<a name="l01382"></a>01382       }
<a name="l01383"></a>01383       <span class="keywordflow">if</span> (strchr(args.options, <span class="charliteral">&apos;i&apos;</span>)) {
<a name="l01384"></a>01384          callidtypes |= <a class="code" href="app__osplookup_8c.html#aa8a82820ad56cd5eb4b6baa00cf6f68a">OSP_CALLID_IAX</a>;
<a name="l01385"></a>01385       }
<a name="l01386"></a>01386    }
<a name="l01387"></a>01387    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPLookup: call id types &apos;%d&apos;\n&quot;</span>, callidtypes);
<a name="l01388"></a>01388 
<a name="l01389"></a>01389    result.inhandle = <a class="code" href="app__osplookup_8c.html#a693603e5e4556641af06c8ebec1dffc5">OSP_INVALID_HANDLE</a>;
<a name="l01390"></a>01390    result.intimelimit = <a class="code" href="app__osplookup_8c.html#aa216d244dea7f5d816cc35504c4390cc">OSP_DEF_TIMELIMIT</a>;
<a name="l01391"></a>01391 
<a name="l01392"></a>01392    headp = &amp;chan-&gt;<a class="code" href="structast__channel.html#a9ffb22045a8f14bef8f2137cd779ab25">varshead</a>;
<a name="l01393"></a>01393    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(headp, current, entries) {
<a name="l01394"></a>01394       <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="chanvars_8h.html#a356a31cd608ec07d3668dcd589be49d8">ast_var_name</a>(current), <span class="stringliteral">&quot;OSPINHANDLE&quot;</span>)) {
<a name="l01395"></a>01395          <span class="keywordflow">if</span> (sscanf(<a class="code" href="chanvars_8h.html#a8e0081172db71c5021d20706c50d959c">ast_var_value</a>(current), <span class="stringliteral">&quot;%30d&quot;</span>, &amp;result.inhandle) != 1) {
<a name="l01396"></a>01396             result.inhandle = <a class="code" href="app__osplookup_8c.html#a693603e5e4556641af06c8ebec1dffc5">OSP_INVALID_HANDLE</a>;
<a name="l01397"></a>01397          }
<a name="l01398"></a>01398       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="chanvars_8h.html#a356a31cd608ec07d3668dcd589be49d8">ast_var_name</a>(current), <span class="stringliteral">&quot;OSPINTIMELIMIT&quot;</span>)) {
<a name="l01399"></a>01399          <span class="keywordflow">if</span> (sscanf(<a class="code" href="chanvars_8h.html#a8e0081172db71c5021d20706c50d959c">ast_var_value</a>(current), <span class="stringliteral">&quot;%30d&quot;</span>, &amp;result.intimelimit) != 1) {
<a name="l01400"></a>01400             result.intimelimit = <a class="code" href="app__osplookup_8c.html#aa216d244dea7f5d816cc35504c4390cc">OSP_DEF_TIMELIMIT</a>;
<a name="l01401"></a>01401          }
<a name="l01402"></a>01402       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="chanvars_8h.html#a356a31cd608ec07d3668dcd589be49d8">ast_var_name</a>(current), <span class="stringliteral">&quot;OSPINNETWORKID&quot;</span>)) {
<a name="l01403"></a>01403          snetid = <a class="code" href="chanvars_8h.html#a8e0081172db71c5021d20706c50d959c">ast_var_value</a>(current);
<a name="l01404"></a>01404       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="chanvars_8h.html#a356a31cd608ec07d3668dcd589be49d8">ast_var_name</a>(current), <span class="stringliteral">&quot;OSPPEERIP&quot;</span>)) {
<a name="l01405"></a>01405          srcdev = <a class="code" href="chanvars_8h.html#a8e0081172db71c5021d20706c50d959c">ast_var_value</a>(current);
<a name="l01406"></a>01406       }
<a name="l01407"></a>01407    }
<a name="l01408"></a>01408    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPLookup: OSPINHANDLE &apos;%d&apos;\n&quot;</span>, result.inhandle);
<a name="l01409"></a>01409    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPLookup: OSPINTIMELIMIT &apos;%d&apos;\n&quot;</span>, result.intimelimit);
<a name="l01410"></a>01410    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPLookup: OSPINNETWORKID &apos;%s&apos;\n&quot;</span>, snetid);
<a name="l01411"></a>01411    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPLookup: source device &apos;%s&apos;\n&quot;</span>, srcdev);
<a name="l01412"></a>01412 
<a name="l01413"></a>01413    <span class="keywordflow">if</span> ((cres = <a class="code" href="channel_8h.html#a7a8f6a50f3db42cb40cad7cfbd1d54f9" title="Automatically service a channel for us...">ast_autoservice_start</a>(chan)) &lt; 0) {
<a name="l01414"></a>01414       <span class="keywordflow">return</span> -1;
<a name="l01415"></a>01415    }
<a name="l01416"></a>01416 
<a name="l01417"></a>01417    <span class="keywordflow">if</span> ((res = <a class="code" href="app__osplookup_8c.html#ab6ffa47e432ada0aa3bab8796cb7a574" title="OSP Lookup function.">osp_lookup</a>(provider, srcdev, chan-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>, args.exten, callidtypes, &amp;result)) &gt; 0) {
<a name="l01418"></a>01418       status = <a class="code" href="astosp_8h.html#a4edfd60cd85aa2fe7e16c321ab22946e">AST_OSP_SUCCESS</a>;
<a name="l01419"></a>01419    } <span class="keywordflow">else</span> {
<a name="l01420"></a>01420       result.tech[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01421"></a>01421       result.dest[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01422"></a>01422       result.called[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01423"></a>01423       result.calling[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01424"></a>01424       result.token[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01425"></a>01425       result.networkid[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01426"></a>01426       result.numresults = 0;
<a name="l01427"></a>01427       result.outtimelimit = <a class="code" href="app__osplookup_8c.html#aa216d244dea7f5d816cc35504c4390cc">OSP_DEF_TIMELIMIT</a>;
<a name="l01428"></a>01428       result.outcallid.buf[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01429"></a>01429       result.outcallid.len = 0;
<a name="l01430"></a>01430       <span class="keywordflow">if</span> (!res) {
<a name="l01431"></a>01431          status = <a class="code" href="astosp_8h.html#a5c2ee32159a9e5470c8aaf6095c589d0">AST_OSP_FAILED</a>;
<a name="l01432"></a>01432       } <span class="keywordflow">else</span> {
<a name="l01433"></a>01433          status = <a class="code" href="astosp_8h.html#a6cc274d33a95b3491cafc75d6e9cd01b">AST_OSP_ERROR</a>;
<a name="l01434"></a>01434       }
<a name="l01435"></a>01435    }
<a name="l01436"></a>01436 
<a name="l01437"></a>01437    snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;%d&quot;</span>, result.outhandle);
<a name="l01438"></a>01438    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;OSPOUTHANDLE&quot;</span>, buffer);
<a name="l01439"></a>01439    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPLookup: OSPOUTHANDLE &apos;%s&apos;\n&quot;</span>, buffer);
<a name="l01440"></a>01440    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;OSPTECH&quot;</span>, result.<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>);
<a name="l01441"></a>01441    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPLookup: OSPTECH &apos;%s&apos;\n&quot;</span>, result.tech);
<a name="l01442"></a>01442    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;OSPDEST&quot;</span>, result.dest);
<a name="l01443"></a>01443    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPLookup: OSPDEST &apos;%s&apos;\n&quot;</span>, result.dest);
<a name="l01444"></a>01444    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;OSPCALLED&quot;</span>, result.called);
<a name="l01445"></a>01445    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPLookup: OSPCALLED &apos;%s&apos;\n&quot;</span>, result.called);
<a name="l01446"></a>01446    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;OSPCALLING&quot;</span>, result.calling);
<a name="l01447"></a>01447    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPLookup: OSPCALLING &apos;%s&apos;\n&quot;</span>, result.calling);
<a name="l01448"></a>01448    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;OSPOUTTOKEN&quot;</span>, result.token);
<a name="l01449"></a>01449    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPLookup: OSPOUTTOKEN size &apos;%zd&apos;\n&quot;</span>, strlen(result.token));
<a name="l01450"></a>01450    snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;%d&quot;</span>, result.numresults);
<a name="l01451"></a>01451    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;OSPRESULTS&quot;</span>, buffer);
<a name="l01452"></a>01452    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPLookup: OSPRESULTS &apos;%s&apos;\n&quot;</span>, buffer);
<a name="l01453"></a>01453    snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;%d&quot;</span>, result.outtimelimit);
<a name="l01454"></a>01454    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;OSPOUTTIMELIMIT&quot;</span>, buffer);
<a name="l01455"></a>01455    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPLookup: OSPOUTTIMELIMIT &apos;%s&apos;\n&quot;</span>, buffer);
<a name="l01456"></a>01456    snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;%d&quot;</span>, callidtypes);
<a name="l01457"></a>01457    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;OSPOUTCALLIDTYPES&quot;</span>, buffer);
<a name="l01458"></a>01458    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPLookup: OSPOUTCALLIDTYPES &apos;%s&apos;\n&quot;</span>, buffer);
<a name="l01459"></a>01459    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;OSPLOOKUPSTATUS&quot;</span>, status);
<a name="l01460"></a>01460    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPLookup: %s\n&quot;</span>, status);
<a name="l01461"></a>01461 
<a name="l01462"></a>01462    <span class="keywordflow">if</span> (!strcasecmp(result.tech, <a class="code" href="app__osplookup_8c.html#a232b5abec331065cc0ab6381c5ac5ea1">OSP_TECH_H323</a>)) {
<a name="l01463"></a>01463       <span class="keywordflow">if</span> ((callidtypes &amp; <a class="code" href="app__osplookup_8c.html#a25a1a9044e69c1b41d40f79d1216d4c3">OSP_CALLID_H323</a>) &amp;&amp; (result.outcallid.len != 0)) {
<a name="l01464"></a>01464          <a class="code" href="app__osplookup_8c.html#a2c7d2c2719f4021ede8420272bf5201d" title="UUID to string.">osp_uuid2str</a>(result.outcallid.buf, buffer, <span class="keyword">sizeof</span>(buffer));
<a name="l01465"></a>01465       } <span class="keywordflow">else</span> {
<a name="l01466"></a>01466          buffer[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01467"></a>01467       }
<a name="l01468"></a>01468       <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;OSPOUTCALLID&quot;</span>, buffer);
<a name="l01469"></a>01469       snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;%s/%s@%s&quot;</span>, result.tech, result.called, result.dest);
<a name="l01470"></a>01470       <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;OSPDIALSTR&quot;</span>, buffer);
<a name="l01471"></a>01471    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(result.tech, <a class="code" href="app__osplookup_8c.html#a3bb2e8490ca2aae2ef00dd0666a0d637">OSP_TECH_SIP</a>)) {
<a name="l01472"></a>01472       snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;%s/%s@%s&quot;</span>, result.tech, result.called, result.dest);
<a name="l01473"></a>01473       <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;OSPDIALSTR&quot;</span>, buffer);
<a name="l01474"></a>01474       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(result.token)) {
<a name="l01475"></a>01475          snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;%s%s&quot;</span>, <a class="code" href="app__osplookup_8c.html#a93310672c1358e732400908dc7a11ffd">OSP_SIP_HEADER</a>, result.token);
<a name="l01476"></a>01476          <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;_SIPADDHEADER&quot;</span>, buffer);
<a name="l01477"></a>01477          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPLookup: SIPADDHEADER size &apos;%zd&apos;\n&quot;</span>, strlen(buffer));
<a name="l01478"></a>01478       }
<a name="l01479"></a>01479    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(result.tech, <a class="code" href="app__osplookup_8c.html#ab00665d0be85f5bdb470e104eb3659b4">OSP_TECH_IAX</a>)) {
<a name="l01480"></a>01480       snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;%s/%s/%s&quot;</span>, result.tech, result.dest, result.called);
<a name="l01481"></a>01481       <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;OSPDIALSTR&quot;</span>, buffer);
<a name="l01482"></a>01482    }
<a name="l01483"></a>01483 
<a name="l01484"></a>01484    <span class="keywordflow">if</span> ((cres = <a class="code" href="channel_8h.html#a08bde7d8cf72457fc8c519a4443b413b" title="Stop servicing a channel for us...">ast_autoservice_stop</a>(chan)) &lt; 0) {
<a name="l01485"></a>01485       <span class="keywordflow">return</span> -1;
<a name="l01486"></a>01486    }
<a name="l01487"></a>01487 
<a name="l01488"></a>01488    <span class="keywordflow">if</span>(res &lt;= 0) {
<a name="l01489"></a>01489       res = -1;
<a name="l01490"></a>01490    } <span class="keywordflow">else</span> {
<a name="l01491"></a>01491       res = 0;
<a name="l01492"></a>01492    }
<a name="l01493"></a>01493 
<a name="l01494"></a>01494    <span class="keywordflow">return</span> res;
<a name="l01495"></a>01495 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4dd57c9ab4ad09fd37eab55f2ed6859f"></a><!-- doxytag: member="app_osplookup.c::ospnext_exec" ref="a4dd57c9ab4ad09fd37eab55f2ed6859f" args="(struct ast_channel *chan, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ospnext_exec </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>OSP Application OSPNext. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>Parameter </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 Success, -1 Failed </dd></dl>

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l01503">1503</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>References <a class="el" href="app_8h_source.html#l00338">AST_APP_ARG</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="app_8h_source.html#l00355">AST_DECLARE_APP_ARGS</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="astosp_8h_source.html#l00029">AST_OSP_ERROR</a>, <a class="el" href="astosp_8h_source.html#l00028">AST_OSP_FAILED</a>, <a class="el" href="astosp_8h_source.html#l00027">AST_OSP_SUCCESS</a>, <a class="el" href="app_8h_source.html#l00387">AST_STANDARD_APP_ARGS</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="chanvars_8c_source.html#l00065">ast_var_name()</a>, <a class="el" href="chanvars_8c_source.html#l00085">ast_var_value()</a>, <a class="el" href="app__osplookup_8c_source.html#l00146">osp_callid::buf</a>, <a class="el" href="app__osplookup_8c_source.html#l00158">osp_result::called</a>, <a class="el" href="app__osplookup_8c_source.html#l00159">osp_result::calling</a>, <a class="el" href="channel_8c_source.html#l00136">cause</a>, <a class="el" href="app__osplookup_8c_source.html#l00157">osp_result::dest</a>, <a class="el" href="app__osplookup_8c_source.html#l00152">osp_result::inhandle</a>, <a class="el" href="app__osplookup_8c_source.html#l00154">osp_result::intimelimit</a>, <a class="el" href="app__osplookup_8c_source.html#l00147">osp_callid::len</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="app__osplookup_8c_source.html#l00161">osp_result::networkid</a>, <a class="el" href="app__osplookup_8c_source.html#l00162">osp_result::numresults</a>, <a class="el" href="app__osplookup_8c_source.html#l00072">OSP_CALLID_H323</a>, <a class="el" href="app__osplookup_8c_source.html#l00071">OSP_CALLID_UNDEFINED</a>, <a class="el" href="app__osplookup_8c_source.html#l00098">OSP_DEF_PROVIDER</a>, <a class="el" href="app__osplookup_8c_source.html#l00121">OSP_DEF_TIMELIMIT</a>, <a class="el" href="app__osplookup_8c_source.html#l00095">OSP_INVALID_HANDLE</a>, <a class="el" href="app__osplookup_8c_source.html#l01074">osp_next()</a>, <a class="el" href="app__osplookup_8c_source.html#l00092">OSP_SIP_HEADER</a>, <a class="el" href="app__osplookup_8c_source.html#l00087">OSP_TECH_H323</a>, <a class="el" href="app__osplookup_8c_source.html#l00089">OSP_TECH_IAX</a>, <a class="el" href="app__osplookup_8c_source.html#l00088">OSP_TECH_SIP</a>, <a class="el" href="app__osplookup_8c_source.html#l00058">OSP_TOKSTR_SIZE</a>, <a class="el" href="app__osplookup_8c_source.html#l00794">osp_uuid2str()</a>, <a class="el" href="app__osplookup_8c_source.html#l00163">osp_result::outcallid</a>, <a class="el" href="app__osplookup_8c_source.html#l00153">osp_result::outhandle</a>, <a class="el" href="app__osplookup_8c_source.html#l00155">osp_result::outtimelimit</a>, <a class="el" href="pbx_8c_source.html#l09023">pbx_builtin_setvar_helper()</a>, <a class="el" href="app__jack_8c_source.html#l00141">status</a>, <a class="el" href="app__osplookup_8c_source.html#l00156">osp_result::tech</a>, <a class="el" href="app__osplookup_8c_source.html#l00160">osp_result::token</a>, and <a class="el" href="channel_8h_source.html#l00446">ast_channel::varshead</a>.</p>

<p>Referenced by <a class="el" href="app__osplookup_8c_source.html#l02005">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01506"></a>01506 {
<a name="l01507"></a>01507    <span class="keywordtype">int</span> res;
<a name="l01508"></a>01508    <span class="keyword">const</span> <span class="keywordtype">char</span>* provider = <a class="code" href="app__osplookup_8c.html#af74db93429d82818224639f0097189b2">OSP_DEF_PROVIDER</a>;
<a name="l01509"></a>01509    <span class="keywordtype">int</span> <a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a> = 0;
<a name="l01510"></a>01510    <span class="keyword">struct </span>varshead* headp;
<a name="l01511"></a>01511    <span class="keyword">struct </span><a class="code" href="structast__var__t.html">ast_var_t</a>* current;
<a name="l01512"></a>01512    <span class="keyword">struct </span><a class="code" href="structosp__result.html">osp_result</a> result;
<a name="l01513"></a>01513    <span class="keywordtype">char</span> buffer[<a class="code" href="app__osplookup_8c.html#a6d56e8f42ac71c7e7cebd6d4e0aa6f78">OSP_TOKSTR_SIZE</a>];
<a name="l01514"></a>01514    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> callidtypes = <a class="code" href="app__osplookup_8c.html#adbc9aec0d1c7059d1b29858f4d43c30d">OSP_CALLID_UNDEFINED</a>;
<a name="l01515"></a>01515    <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a>;
<a name="l01516"></a>01516    <span class="keywordtype">char</span>* tmp;
<a name="l01517"></a>01517 
<a name="l01518"></a>01518    <a class="code" href="app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2" title="Declare a structure to hold an application&amp;#39;s arguments.">AST_DECLARE_APP_ARGS</a>(args,
<a name="l01519"></a>01519       <a class="code" href="app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5" title="Define an application argument.">AST_APP_ARG</a>(cause);
<a name="l01520"></a>01520       <a class="code" href="app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5" title="Define an application argument.">AST_APP_ARG</a>(provider);
<a name="l01521"></a>01521       <a class="code" href="app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5" title="Define an application argument.">AST_APP_ARG</a>(options);
<a name="l01522"></a>01522    );
<a name="l01523"></a>01523 
<a name="l01524"></a>01524    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(data)) {
<a name="l01525"></a>01525       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;OSPNext: Arg required, OSPNext(cause[|provider[|options]])\n&quot;</span>);
<a name="l01526"></a>01526       <span class="keywordflow">return</span> -1;
<a name="l01527"></a>01527    }
<a name="l01528"></a>01528 
<a name="l01529"></a>01529    <span class="keywordflow">if</span> (!(tmp = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(data))) {
<a name="l01530"></a>01530       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Out of memory\n&quot;</span>);
<a name="l01531"></a>01531       <span class="keywordflow">return</span> -1;
<a name="l01532"></a>01532    }
<a name="l01533"></a>01533 
<a name="l01534"></a>01534    <a class="code" href="app_8h.html#ac08f7eb1eb9476b30987c73e1052ada8" title="Performs the &amp;#39;standard&amp;#39; argument separation process for an application.">AST_STANDARD_APP_ARGS</a>(args, tmp);
<a name="l01535"></a>01535 
<a name="l01536"></a>01536    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(args.cause) &amp;&amp; sscanf(args.cause, <span class="stringliteral">&quot;%30d&quot;</span>, &amp;cause) != 1) {
<a name="l01537"></a>01537       cause = 0;
<a name="l01538"></a>01538    }
<a name="l01539"></a>01539    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPNext: cause &apos;%d&apos;\n&quot;</span>, cause);
<a name="l01540"></a>01540 
<a name="l01541"></a>01541    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(args.provider)) {
<a name="l01542"></a>01542       provider = args.provider;
<a name="l01543"></a>01543    }
<a name="l01544"></a>01544    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPlookup: provider &apos;%s&apos;\n&quot;</span>, provider);
<a name="l01545"></a>01545 
<a name="l01546"></a>01546    result.inhandle = <a class="code" href="app__osplookup_8c.html#a693603e5e4556641af06c8ebec1dffc5">OSP_INVALID_HANDLE</a>;
<a name="l01547"></a>01547    result.outhandle = <a class="code" href="app__osplookup_8c.html#a693603e5e4556641af06c8ebec1dffc5">OSP_INVALID_HANDLE</a>;
<a name="l01548"></a>01548    result.intimelimit = <a class="code" href="app__osplookup_8c.html#aa216d244dea7f5d816cc35504c4390cc">OSP_DEF_TIMELIMIT</a>;
<a name="l01549"></a>01549    result.numresults = 0;
<a name="l01550"></a>01550 
<a name="l01551"></a>01551    headp = &amp;chan-&gt;<a class="code" href="structast__channel.html#a9ffb22045a8f14bef8f2137cd779ab25">varshead</a>;
<a name="l01552"></a>01552    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(headp, current, entries) {
<a name="l01553"></a>01553       <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="chanvars_8h.html#a356a31cd608ec07d3668dcd589be49d8">ast_var_name</a>(current), <span class="stringliteral">&quot;OSPINHANDLE&quot;</span>)) {
<a name="l01554"></a>01554          <span class="keywordflow">if</span> (sscanf(<a class="code" href="chanvars_8h.html#a8e0081172db71c5021d20706c50d959c">ast_var_value</a>(current), <span class="stringliteral">&quot;%30d&quot;</span>, &amp;result.inhandle) != 1) {
<a name="l01555"></a>01555             result.inhandle = <a class="code" href="app__osplookup_8c.html#a693603e5e4556641af06c8ebec1dffc5">OSP_INVALID_HANDLE</a>;
<a name="l01556"></a>01556          }
<a name="l01557"></a>01557       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="chanvars_8h.html#a356a31cd608ec07d3668dcd589be49d8">ast_var_name</a>(current), <span class="stringliteral">&quot;OSPOUTHANDLE&quot;</span>)) {
<a name="l01558"></a>01558          <span class="keywordflow">if</span> (sscanf(<a class="code" href="chanvars_8h.html#a8e0081172db71c5021d20706c50d959c">ast_var_value</a>(current), <span class="stringliteral">&quot;%30d&quot;</span>, &amp;result.outhandle) != 1) {
<a name="l01559"></a>01559             result.outhandle = <a class="code" href="app__osplookup_8c.html#a693603e5e4556641af06c8ebec1dffc5">OSP_INVALID_HANDLE</a>;
<a name="l01560"></a>01560          }
<a name="l01561"></a>01561       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="chanvars_8h.html#a356a31cd608ec07d3668dcd589be49d8">ast_var_name</a>(current), <span class="stringliteral">&quot;OSPINTIMELIMIT&quot;</span>)) {
<a name="l01562"></a>01562          <span class="keywordflow">if</span> (sscanf(<a class="code" href="chanvars_8h.html#a8e0081172db71c5021d20706c50d959c">ast_var_value</a>(current), <span class="stringliteral">&quot;%30d&quot;</span>, &amp;result.intimelimit) != 1) {
<a name="l01563"></a>01563             result.intimelimit = <a class="code" href="app__osplookup_8c.html#aa216d244dea7f5d816cc35504c4390cc">OSP_DEF_TIMELIMIT</a>;
<a name="l01564"></a>01564          }
<a name="l01565"></a>01565       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="chanvars_8h.html#a356a31cd608ec07d3668dcd589be49d8">ast_var_name</a>(current), <span class="stringliteral">&quot;OSPOUTCALLIDTYPES&quot;</span>)) {
<a name="l01566"></a>01566          <span class="keywordflow">if</span> (sscanf(<a class="code" href="chanvars_8h.html#a8e0081172db71c5021d20706c50d959c">ast_var_value</a>(current), <span class="stringliteral">&quot;%30d&quot;</span>, &amp;callidtypes) != 1) {
<a name="l01567"></a>01567             callidtypes = <a class="code" href="app__osplookup_8c.html#adbc9aec0d1c7059d1b29858f4d43c30d">OSP_CALLID_UNDEFINED</a>;
<a name="l01568"></a>01568          }
<a name="l01569"></a>01569       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="chanvars_8h.html#a356a31cd608ec07d3668dcd589be49d8">ast_var_name</a>(current), <span class="stringliteral">&quot;OSPRESULTS&quot;</span>)) {
<a name="l01570"></a>01570          <span class="keywordflow">if</span> (sscanf(<a class="code" href="chanvars_8h.html#a8e0081172db71c5021d20706c50d959c">ast_var_value</a>(current), <span class="stringliteral">&quot;%30d&quot;</span>, &amp;result.numresults) != 1) {
<a name="l01571"></a>01571             result.numresults = 0;
<a name="l01572"></a>01572          }
<a name="l01573"></a>01573       }
<a name="l01574"></a>01574    }
<a name="l01575"></a>01575    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPNext: OSPINHANDLE &apos;%d&apos;\n&quot;</span>, result.inhandle);
<a name="l01576"></a>01576    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPNext: OSPOUTHANDLE &apos;%d&apos;\n&quot;</span>, result.outhandle);
<a name="l01577"></a>01577    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPNext: OSPINTIMELIMIT &apos;%d&apos;\n&quot;</span>, result.intimelimit);
<a name="l01578"></a>01578    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPNext: OSPOUTCALLIDTYPES &apos;%d&apos;\n&quot;</span>, callidtypes);
<a name="l01579"></a>01579    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPNext: OSPRESULTS &apos;%d&apos;\n&quot;</span>, result.numresults);
<a name="l01580"></a>01580 
<a name="l01581"></a>01581    <span class="keywordflow">if</span> ((res = <a class="code" href="app__osplookup_8c.html#ad3c73a7443561060d02520615232ff9e" title="OSP Lookup Next function.">osp_next</a>(provider, cause, &amp;result)) &gt; 0) {
<a name="l01582"></a>01582       status = <a class="code" href="astosp_8h.html#a4edfd60cd85aa2fe7e16c321ab22946e">AST_OSP_SUCCESS</a>;
<a name="l01583"></a>01583    } <span class="keywordflow">else</span> {
<a name="l01584"></a>01584       result.tech[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01585"></a>01585       result.dest[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01586"></a>01586       result.called[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01587"></a>01587       result.calling[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01588"></a>01588       result.token[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01589"></a>01589       result.networkid[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01590"></a>01590       result.numresults = 0;
<a name="l01591"></a>01591       result.outtimelimit = <a class="code" href="app__osplookup_8c.html#aa216d244dea7f5d816cc35504c4390cc">OSP_DEF_TIMELIMIT</a>;
<a name="l01592"></a>01592       result.outcallid.buf[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01593"></a>01593       result.outcallid.len = 0;
<a name="l01594"></a>01594       <span class="keywordflow">if</span> (!res) {
<a name="l01595"></a>01595          status = <a class="code" href="astosp_8h.html#a5c2ee32159a9e5470c8aaf6095c589d0">AST_OSP_FAILED</a>;
<a name="l01596"></a>01596       } <span class="keywordflow">else</span> {
<a name="l01597"></a>01597          status = <a class="code" href="astosp_8h.html#a6cc274d33a95b3491cafc75d6e9cd01b">AST_OSP_ERROR</a>;
<a name="l01598"></a>01598       }
<a name="l01599"></a>01599    }
<a name="l01600"></a>01600 
<a name="l01601"></a>01601    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;OSPTECH&quot;</span>, result.<a class="code" href="structast__channel.html#a0716a334727b22adf0290792bd80de10">tech</a>);
<a name="l01602"></a>01602    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPNext: OSPTECH &apos;%s&apos;\n&quot;</span>, result.tech);
<a name="l01603"></a>01603    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;OSPDEST&quot;</span>, result.dest);
<a name="l01604"></a>01604    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPNext: OSPDEST &apos;%s&apos;\n&quot;</span>, result.dest);
<a name="l01605"></a>01605    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;OSPCALLED&quot;</span>, result.called);
<a name="l01606"></a>01606    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPNext: OSPCALLED&apos;%s&apos;\n&quot;</span>, result.called);
<a name="l01607"></a>01607    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;OSPCALLING&quot;</span>, result.calling);
<a name="l01608"></a>01608    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPNext: OSPCALLING &apos;%s&apos;\n&quot;</span>, result.calling);
<a name="l01609"></a>01609    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;OSPOUTTOKEN&quot;</span>, result.token);
<a name="l01610"></a>01610    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPNext: OSPOUTTOKEN size &apos;%zd&apos;\n&quot;</span>, strlen(result.token));
<a name="l01611"></a>01611    snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;%d&quot;</span>, result.numresults);
<a name="l01612"></a>01612    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;OSPRESULTS&quot;</span>, buffer);
<a name="l01613"></a>01613    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPNext: OSPRESULTS &apos;%s&apos;\n&quot;</span>, buffer);
<a name="l01614"></a>01614    snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;%d&quot;</span>, result.outtimelimit);
<a name="l01615"></a>01615    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;OSPOUTTIMELIMIT&quot;</span>, buffer);
<a name="l01616"></a>01616    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPNext: OSPOUTTIMELIMIT &apos;%s&apos;\n&quot;</span>, buffer);
<a name="l01617"></a>01617    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;OSPNEXTSTATUS&quot;</span>, status);
<a name="l01618"></a>01618    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPNext: %s\n&quot;</span>, status);
<a name="l01619"></a>01619 
<a name="l01620"></a>01620    <span class="keywordflow">if</span> (!strcasecmp(result.tech, <a class="code" href="app__osplookup_8c.html#a232b5abec331065cc0ab6381c5ac5ea1">OSP_TECH_H323</a>)) {
<a name="l01621"></a>01621       <span class="keywordflow">if</span> ((callidtypes &amp; <a class="code" href="app__osplookup_8c.html#a25a1a9044e69c1b41d40f79d1216d4c3">OSP_CALLID_H323</a>) &amp;&amp; (result.outcallid.len != 0)) {
<a name="l01622"></a>01622          <a class="code" href="app__osplookup_8c.html#a2c7d2c2719f4021ede8420272bf5201d" title="UUID to string.">osp_uuid2str</a>(result.outcallid.buf, buffer, <span class="keyword">sizeof</span>(buffer));
<a name="l01623"></a>01623       } <span class="keywordflow">else</span> {
<a name="l01624"></a>01624          buffer[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01625"></a>01625       }
<a name="l01626"></a>01626       <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;OSPOUTCALLID&quot;</span>, buffer);
<a name="l01627"></a>01627       snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;%s/%s@%s&quot;</span>, result.tech, result.called, result.dest);
<a name="l01628"></a>01628       <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;OSPDIALSTR&quot;</span>, buffer);
<a name="l01629"></a>01629    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(result.tech, <a class="code" href="app__osplookup_8c.html#a3bb2e8490ca2aae2ef00dd0666a0d637">OSP_TECH_SIP</a>)) {
<a name="l01630"></a>01630       snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;%s/%s@%s&quot;</span>, result.tech, result.called, result.dest);
<a name="l01631"></a>01631       <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;OSPDIALSTR&quot;</span>, buffer);
<a name="l01632"></a>01632       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(result.token)) {
<a name="l01633"></a>01633          snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;%s%s&quot;</span>, <a class="code" href="app__osplookup_8c.html#a93310672c1358e732400908dc7a11ffd">OSP_SIP_HEADER</a>, result.token);
<a name="l01634"></a>01634          <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;_SIPADDHEADER&quot;</span>, buffer);
<a name="l01635"></a>01635          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;OSPLookup: SIPADDHEADER size &apos;%zd&apos;\n&quot;</span>, strlen(buffer));
<a name="l01636"></a>01636       }
<a name="l01637"></a>01637    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(result.tech, <a class="code" href="app__osplookup_8c.html#ab00665d0be85f5bdb470e104eb3659b4">OSP_TECH_IAX</a>)) {
<a name="l01638"></a>01638       snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;%s/%s/%s&quot;</span>, result.tech, result.dest, result.called);
<a name="l01639"></a>01639       <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;OSPDIALSTR&quot;</span>, buffer);
<a name="l01640"></a>01640    }
<a name="l01641"></a>01641 
<a name="l01642"></a>01642    <span class="keywordflow">if</span>(res &lt;= 0) {
<a name="l01643"></a>01643       res = -1;
<a name="l01644"></a>01644    } <span class="keywordflow">else</span> {
<a name="l01645"></a>01645       res = 0;
<a name="l01646"></a>01646    }
<a name="l01647"></a>01647 
<a name="l01648"></a>01648    <span class="keywordflow">return</span> res;
<a name="l01649"></a>01649 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad1982509765f4870f1f63412a53ea668"></a><!-- doxytag: member="app_osplookup.c::reload" ref="ad1982509765f4870f1f63412a53ea668" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int reload </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l02035">2035</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>References <a class="el" href="app__osplookup_8c_source.html#l01772">osp_load()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02036"></a>02036 {
<a name="l02037"></a>02037    <a class="code" href="app__osplookup_8c.html#abbf1e551f818049bd8744a6ece49a5ba">osp_load</a>(1);
<a name="l02038"></a>02038 
<a name="l02039"></a>02039    <span class="keywordflow">return</span> 0;
<a name="l02040"></a>02040 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad09fa931f468002152a3cc2d5ce25eae"></a><!-- doxytag: member="app_osplookup.c::unload_module" ref="ad09fa931f468002152a3cc2d5ce25eae" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int unload_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l02021">2021</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

<p>References <a class="el" href="cli_8c_source.html#l01937">ast_cli_unregister_multiple()</a>, <a class="el" href="pbx_8c_source.html#l06403">ast_unregister_application()</a>, and <a class="el" href="app__osplookup_8c_source.html#l01837">osp_unload()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l02022"></a>02022 {
<a name="l02023"></a>02023    <span class="keywordtype">int</span> res;
<a name="l02024"></a>02024 
<a name="l02025"></a>02025    res = <a class="code" href="module_8h.html#ad2ca15621101154f29748cf1dac3c3cf" title="Unregister an application.">ast_unregister_application</a>(<a class="code" href="app__osplookup_8c.html#a2f57c1b7cebdefada90f4dac8fd00fa6">app4</a>);
<a name="l02026"></a>02026    res |= <a class="code" href="module_8h.html#ad2ca15621101154f29748cf1dac3c3cf" title="Unregister an application.">ast_unregister_application</a>(<a class="code" href="app__osplookup_8c.html#a3044a87a73ac4a63321105ddc9a77692">app3</a>);
<a name="l02027"></a>02027    res |= <a class="code" href="module_8h.html#ad2ca15621101154f29748cf1dac3c3cf" title="Unregister an application.">ast_unregister_application</a>(<a class="code" href="app__osplookup_8c.html#a226108d015a7b45044c5f4eb82ffaa1b">app2</a>);
<a name="l02028"></a>02028    res |= <a class="code" href="module_8h.html#ad2ca15621101154f29748cf1dac3c3cf" title="Unregister an application.">ast_unregister_application</a>(<a class="code" href="app__osplookup_8c.html#aee1c6fdb192d3bc745c949458f7de522">app1</a>);
<a name="l02029"></a>02029    <a class="code" href="cli_8h.html#a56b6b59ee2eaa994597a5b0f4e9f9d09" title="Unregister multiple commands.">ast_cli_unregister_multiple</a>(<a class="code" href="app__osplookup_8c.html#a10d006ccda399620ddcbdac150680853">cli_osp</a>, <span class="keyword">sizeof</span>(<a class="code" href="app__osplookup_8c.html#a10d006ccda399620ddcbdac150680853">cli_osp</a>) / <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a>));
<a name="l02030"></a>02030    <a class="code" href="app__osplookup_8c.html#aeaa07e9dab5c74f1438507a11962f9f4">osp_unload</a>();
<a name="l02031"></a>02031 
<a name="l02032"></a>02032    <span class="keywordflow">return</span> res;
<a name="l02033"></a>02033 }
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="aee1c6fdb192d3bc745c949458f7de522"></a><!-- doxytag: member="app_osplookup.c::app1" ref="aee1c6fdb192d3bc745c949458f7de522" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="app__osplookup_8c.html#aee1c6fdb192d3bc745c949458f7de522">app1</a> = &quot;OSPAuth&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l01943">1943</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

</div>
</div>
<a class="anchor" id="a226108d015a7b45044c5f4eb82ffaa1b"></a><!-- doxytag: member="app_osplookup.c::app2" ref="a226108d015a7b45044c5f4eb82ffaa1b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="app__voicemail_8c.html#a481fef4b16e813bdf173274384491281">app2</a> = &quot;OSPLookup&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l01955">1955</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

</div>
</div>
<a class="anchor" id="a3044a87a73ac4a63321105ddc9a77692"></a><!-- doxytag: member="app_osplookup.c::app3" ref="a3044a87a73ac4a63321105ddc9a77692" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="chan__agent_8c.html#aad58282d90fddc0dcc234189388a6b01">app3</a> = &quot;OSPNext&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l01980">1980</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

</div>
</div>
<a class="anchor" id="a2f57c1b7cebdefada90f4dac8fd00fa6"></a><!-- doxytag: member="app_osplookup.c::app4" ref="a2f57c1b7cebdefada90f4dac8fd00fa6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="app__voicemail_8c.html#a7c76a62fa9a3feb78b315578d82e4a48">app4</a> = &quot;OSPFinish&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l01990">1990</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

</div>
</div>
<a class="anchor" id="a10d006ccda399620ddcbdac150680853"></a><!-- doxytag: member="app_osplookup.c::cli_osp" ref="a10d006ccda399620ddcbdac150680853" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> <a class="el" href="app__osplookup_8c.html#a10d006ccda399620ddcbdac150680853">cli_osp</a>[]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {

}
</pre></div>
<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l02001">2001</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

</div>
</div>
<a class="anchor" id="a2691a482b4359db931cef4398d6f28ee"></a><!-- doxytag: member="app_osplookup.c::descrip1" ref="a2691a482b4359db931cef4398d6f28ee" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="app__osplookup_8c.html#a2691a482b4359db931cef4398d6f28ee">descrip1</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l01945">1945</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

</div>
</div>
<a class="anchor" id="a1ab5c89130218223dca8d1f8b57fb218"></a><!-- doxytag: member="app_osplookup.c::descrip2" ref="a1ab5c89130218223dca8d1f8b57fb218" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="app__osplookup_8c.html#a1ab5c89130218223dca8d1f8b57fb218">descrip2</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l01957">1957</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

</div>
</div>
<a class="anchor" id="a6a21c282600021fc9e5ca8fef5e2b18f"></a><!-- doxytag: member="app_osplookup.c::descrip3" ref="a6a21c282600021fc9e5ca8fef5e2b18f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="app__osplookup_8c.html#a6a21c282600021fc9e5ca8fef5e2b18f">descrip3</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l01982">1982</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

</div>
</div>
<a class="anchor" id="a2f7cb7b9188e1a2057a81e18292910e4"></a><!-- doxytag: member="app_osplookup.c::descrip4" ref="a2f7cb7b9188e1a2057a81e18292910e4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="app__osplookup_8c.html#a2f7cb7b9188e1a2057a81e18292910e4">descrip4</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l01992">1992</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

</div>
</div>
<a class="anchor" id="a5ef0958fa463ae932e3e71ec39cd1337"></a><!-- doxytag: member="app_osplookup.c::osp_hardware" ref="a5ef0958fa463ae932e3e71ec39cd1337" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="app__osplookup_8c.html#a5ef0958fa463ae932e3e71ec39cd1337">osp_hardware</a> = 0<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00169">169</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

</div>
</div>
<a class="anchor" id="a7b65a944814a9fe8b45330072c875e46"></a><!-- doxytag: member="app_osplookup.c::osp_initialized" ref="a7b65a944814a9fe8b45330072c875e46" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="app__osplookup_8c.html#a7b65a944814a9fe8b45330072c875e46">osp_initialized</a> = 0<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00168">168</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

</div>
</div>
<a class="anchor" id="ab918a4031e5d25153fe54e91be1ac56e"></a><!-- doxytag: member="app_osplookup.c::osp_tokenformat" ref="ab918a4031e5d25153fe54e91be1ac56e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int <a class="el" href="app__osplookup_8c.html#ab918a4031e5d25153fe54e91be1ac56e">osp_tokenformat</a> = TOKEN_ALGO_SIGNED<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00171">171</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

</div>
</div>
<a class="anchor" id="ac9590e73571584ed17bed31f03b87900"></a><!-- doxytag: member="app_osplookup.c::ospproviders" ref="ac9590e73571584ed17bed31f03b87900" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structosp__provider.html">osp_provider</a>* <a class="el" href="app__osplookup_8c.html#ac9590e73571584ed17bed31f03b87900">ospproviders</a> = NULL<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l00170">170</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

</div>
</div>
<a class="anchor" id="ac303a7fc87983f994599152c93f791ae"></a><!-- doxytag: member="app_osplookup.c::synopsis1" ref="ac303a7fc87983f994599152c93f791ae" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="app__osplookup_8c.html#ac303a7fc87983f994599152c93f791ae">synopsis1</a> = &quot;OSP authentication&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l01944">1944</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

</div>
</div>
<a class="anchor" id="a6c27de8205a98c27461ee7eeb69dd48a"></a><!-- doxytag: member="app_osplookup.c::synopsis2" ref="a6c27de8205a98c27461ee7eeb69dd48a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="app__osplookup_8c.html#a6c27de8205a98c27461ee7eeb69dd48a">synopsis2</a> = &quot;Lookup destination by OSP&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l01956">1956</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

</div>
</div>
<a class="anchor" id="a6bb971d5c56ec38f85ed6e9c0ff60d42"></a><!-- doxytag: member="app_osplookup.c::synopsis3" ref="a6bb971d5c56ec38f85ed6e9c0ff60d42" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="app__osplookup_8c.html#a6bb971d5c56ec38f85ed6e9c0ff60d42">synopsis3</a> = &quot;Lookup next destination by OSP&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l01981">1981</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

</div>
</div>
<a class="anchor" id="a9264bf933a240e13b35ae894365fe13c"></a><!-- doxytag: member="app_osplookup.c::synopsis4" ref="a9264bf933a240e13b35ae894365fe13c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="app__osplookup_8c.html#a9264bf933a240e13b35ae894365fe13c">synopsis4</a> = &quot;Record OSP entry&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__osplookup_8c_source.html#l01991">1991</a> of file <a class="el" href="app__osplookup_8c_source.html">app_osplookup.c</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:19:03 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
