<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:23:16 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_318a70d4e812a718d9ecaeea98fff199.html">res</a>
  </div>
</div>
<div class="contents">
<h1>res_phoneprov.c File Reference</h1>
<p>Phone provisioning application for the asterisk internal http server.  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="asterisk_8h_source.html">asterisk.h</a>&quot;</code><br/>
<code>#include &lt;sys/ioctl.h&gt;</code><br/>
<code>#include &lt;sys/socket.h&gt;</code><br/>
<code>#include &lt;net/if.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="channel_8h_source.html">asterisk/channel.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="file_8h_source.html">asterisk/file.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="paths_8h_source.html">asterisk/paths.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="pbx_8h_source.html">asterisk/pbx.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="cli_8h_source.html">asterisk/cli.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="module_8h_source.html">asterisk/module.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="http_8h_source.html">asterisk/http.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="utils_8h_source.html">asterisk/utils.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="app_8h_source.html">asterisk/app.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="strings_8h_source.html">asterisk/strings.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="stringfields_8h_source.html">asterisk/stringfields.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="options_8h_source.html">asterisk/options.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="config_8h_source.html">asterisk/config.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="acl_8h_source.html">asterisk/acl.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="astobj2_8h_source.html">asterisk/astobj2.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="ast__version_8h_source.html">asterisk/ast_version.h</a>&quot;</code><br/>

<p><a href="res__phoneprov_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structextension.html">extension</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structhttp__route.html">http_route</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">structure to hold http routes (valid URIs, and the files they link to)  <a href="structhttp__route.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structphone__profile.html">phone_profile</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">structure to hold phone profiles read from phoneprov.conf  <a href="structphone__profile.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structphoneprov__file.html">phoneprov_file</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">structure to hold file data  <a href="structphoneprov__file.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structpp__variable__lookup.html">pp_variable_lookup</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Lookup table to translate between users.conf property names and variables for use in phoneprov templates.  <a href="structpp__variable__lookup.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structuser.html">user</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">structure to hold <a class="el" href="structusers.html" title="list of users found in the config file">users</a> read from users.conf  <a href="structuser.html#_details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#ac8dc47e3b39c930caed4bfd05b4ba805">FORMAT</a>&nbsp;&nbsp;&nbsp;&quot;%-40.40s  %-30.30s\n&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a12277aa03a4c963e247eb4670e6751c0">MAX_PROFILE_BUCKETS</a>&nbsp;&nbsp;&nbsp;17</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a0d556e8c0c8f8b8c66da39183bec2d72">MAX_ROUTE_BUCKETS</a>&nbsp;&nbsp;&nbsp;563</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a0093d2299b135a3be5d1e7775f2af02d">MAX_USER_BUCKETS</a>&nbsp;&nbsp;&nbsp;563</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#ae1761f6ffd7763505cd891d3314cd7e4">VAR_BUF_SIZE</a>&nbsp;&nbsp;&nbsp;4096</td></tr>
<tr><td colspan="2"><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#ad9f59295a8c67b6a4d07f7f6e141a20b">pp_variables</a> { <br/>
&nbsp;&nbsp;<a class="el" href="res__phoneprov_8c.html#ad9f59295a8c67b6a4d07f7f6e141a20ba61f5014b80cce0a1a069463c63ee0624">PP_MACADDRESS</a>, 
<a class="el" href="res__phoneprov_8c.html#ad9f59295a8c67b6a4d07f7f6e141a20bae1877e7a57f09eb150f0ed8b443770c5">PP_USERNAME</a>, 
<a class="el" href="res__phoneprov_8c.html#ad9f59295a8c67b6a4d07f7f6e141a20ba998f5a17d498eade16d01a125a65a3c1">PP_FULLNAME</a>, 
<a class="el" href="res__phoneprov_8c.html#ad9f59295a8c67b6a4d07f7f6e141a20bac5130f5369abd33d80246064ef8c8897">PP_SECRET</a>, 
<br/>
&nbsp;&nbsp;<a class="el" href="res__phoneprov_8c.html#ad9f59295a8c67b6a4d07f7f6e141a20baf22d50ddb88f8782a6401f3b597dde79">PP_LABEL</a>, 
<a class="el" href="res__phoneprov_8c.html#ad9f59295a8c67b6a4d07f7f6e141a20ba746b6c4d7070ab317f423a6900e2e95a">PP_CALLERID</a>, 
<a class="el" href="res__phoneprov_8c.html#ad9f59295a8c67b6a4d07f7f6e141a20ba770142b9e76e90ebb448780dffe6c72c">PP_TIMEZONE</a>, 
<a class="el" href="res__phoneprov_8c.html#ad9f59295a8c67b6a4d07f7f6e141a20ba340324250c96193036ebaf2d75d92fec">PP_LINENUMBER</a>, 
<br/>
&nbsp;&nbsp;<a class="el" href="res__phoneprov_8c.html#ad9f59295a8c67b6a4d07f7f6e141a20ba78622575d08cd751a176d8acab53e0be">PP_LINEKEYS</a>, 
<a class="el" href="res__phoneprov_8c.html#ad9f59295a8c67b6a4d07f7f6e141a20bac42f340f12b19ce4aa310aae8c93a54d">PP_VAR_LIST_LENGTH</a>
<br/>
 }</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a88b7c88fed6b80fd18f34f97757dfc04">__reg_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#afeab1257bd17282b95875499393a147a">__unreg_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#ad23b53289cf4121101c52233bacbacc0">add_user_extension</a> (struct <a class="el" href="structuser.html">user</a> *<a class="el" href="structuser.html">user</a>, struct <a class="el" href="structextension.html">extension</a> *<a class="el" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add an <a class="el" href="structextension.html">extension</a> to a <a class="el" href="structuser.html" title="structure to hold users read from users.conf">user</a> ordered by index/linenumber.  <a href="#ad23b53289cf4121101c52233bacbacc0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structextension.html">extension</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a8cff0bba26573fb649703e10df4c3997">build_extension</a> (struct <a class="el" href="structast__config.html">ast_config</a> *cfg, const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#aef718301835f2096a66d68122adee512">build_profile</a> (const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, struct <a class="el" href="structast__variable.html">ast_variable</a> *v)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Build a phone profile and add it to the list of phone profiles.  <a href="#aef718301835f2096a66d68122adee512"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a2db9c7589efbc4119490d418f27bf675">build_route</a> (struct <a class="el" href="structphoneprov__file.html">phoneprov_file</a> *pp_file, struct <a class="el" href="structuser.html">user</a> *<a class="el" href="structuser.html">user</a>, char *uri)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Build a route structure and add it to the list of available http routes.  <a href="#a2db9c7589efbc4119490d418f27bf675"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structuser.html">user</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#af95e27b49139d0b61207299a03cf8d87">build_user</a> (const char *mac, struct <a class="el" href="structphone__profile.html">phone_profile</a> *profile)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Build and return a <a class="el" href="structuser.html" title="structure to hold users read from users.conf">user</a> structure based on gathered config data.  <a href="#af95e27b49139d0b61207299a03cf8d87"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a624c63d6184a3f4c015f743eba369f12">build_user_routes</a> (struct <a class="el" href="structuser.html">user</a> *<a class="el" href="structuser.html">user</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add an http route for dynamic files attached to the profile of the <a class="el" href="structuser.html" title="structure to hold users read from users.conf">user</a>.  <a href="#a624c63d6184a3f4c015f743eba369f12"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structextension.html">extension</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a44b45903a5a6b50bcd11b446f7635ffc">delete_extension</a> (struct <a class="el" href="structextension.html">extension</a> *<a class="el" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a9a2102f5ce1bbef671a27b071df6d806">delete_file</a> (struct <a class="el" href="structphoneprov__file.html">phoneprov_file</a> *file)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a97d13891245936affb35e4dfadcb25e8">delete_profiles</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Delete all phone profiles, freeing their memory.  <a href="#a97d13891245936affb35e4dfadcb25e8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#aa2a1b5e37b1426df4284c132cd785ef7">delete_routes</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Delete all http routes, freeing their memory.  <a href="#aa2a1b5e37b1426df4284c132cd785ef7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#ace322a3e8008af8b872b72770e97fa85">delete_users</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Delete all <a class="el" href="structusers.html" title="list of users found in the config file">users</a>.  <a href="#ace322a3e8008af8b872b72770e97fa85"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structphone__profile.html">phone_profile</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a1d73305eda3292c4133efe4940a1f2e3">find_profile</a> (const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return a phone profile looked up by name.  <a href="#a1d73305eda3292c4133efe4940a1f2e3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structuser.html">user</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a9b8690d2eb6b2b070ee1faf3d0a1cb1f">find_user</a> (const char *macaddress)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return a <a class="el" href="structuser.html" title="structure to hold users read from users.conf">user</a> looked up by name.  <a href="#a9b8690d2eb6b2b070ee1faf3d0a1cb1f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a87d229b8abd3637a00aaa1377bbd3392">ftype2mtype</a> (const char *ftype)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return mime type based on <a class="el" href="structextension.html">extension</a>.  <a href="#a87d229b8abd3637a00aaa1377bbd3392"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a48654ad7e70178777fa21bd6f8b9b7ba">handle_show_routes</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">CLI command to list static and dynamic routes.  <a href="#a48654ad7e70178777fa21bd6f8b9b7ba"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a04c6ab3149590b7a80b7599645ce220c">load_file</a> (const char *filename, char **ret)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read a TEXT file into a string and return the length.  <a href="#a04c6ab3149590b7a80b7599645ce220c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a954fe3261258e2a0cf96cbbf598c2935">lookup_iface</a> (const char *iface, struct in_addr *address)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__str.html">ast_str</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a4bdf3ab552242e47cb7b4368f9b36af6">phoneprov_callback</a> (struct <a class="el" href="structast__tcptls__session__instance.html">ast_tcptls_session_instance</a> *ser, const struct <a class="el" href="structast__http__uri.html">ast_http_uri</a> *urih, const char *uri, enum <a class="el" href="http_8h.html#a16fb43ed7e6093a9dc96477ba37b80ef">ast_http_method</a> method, struct <a class="el" href="structast__variable.html">ast_variable</a> *vars, struct <a class="el" href="structast__variable.html">ast_variable</a> *headers, int *<a class="el" href="app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a>, char **title, int *contentlength)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Callback that is executed everytime an http request is received by this module.  <a href="#a4bdf3ab552242e47cb7b4368f9b36af6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#ade73760cade4016ab5bc94a97d29981f">pp_each_extension_exec</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *cmd, char *data, char *<a class="el" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, size_t len)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">A dialplan function that can be used to output a template for each <a class="el" href="structextension.html">extension</a> attached to a <a class="el" href="structuser.html" title="structure to hold users read from users.conf">user</a>.  <a href="#ade73760cade4016ab5bc94a97d29981f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#ad66a8c00702929d37cebc1c0932a78da">pp_each_user_exec</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *cmd, char *data, char *<a class="el" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, size_t len)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">A dialplan function that can be used to print a string for each phoneprov <a class="el" href="structuser.html" title="structure to hold users read from users.conf">user</a>.  <a href="#ad66a8c00702929d37cebc1c0932a78da"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#aebc1bffc0df046bcff4d2a0473ada3fd">profile_cmp_fn</a> (void *obj, void *arg, int flags)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a0c8d3191d4633ed3b4dad8750fa755d8">profile_destructor</a> (void *obj)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a1cb6ea28a5ce8cf589e43a5a3460b7ae">profile_hash_fn</a> (const void *obj, const int flags)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#ae71495d7e33581c0cf2f0cbb35e6c3af">route_destructor</a> (void *obj)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#aea36e776c24e08f24ce107158d178aa5">routes_cmp_fn</a> (void *obj, void *arg, int flags)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a700f9c2b8d1dae3755239792b7acf813">routes_hash_fn</a> (const void *obj, const int flags)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a6658fcbb66219eff8bf475a2092fa06d">set_config</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a4ad5268888c358048f6045a7dc135c4d">set_timezone_variables</a> (struct varshead *headp, const char *zone)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set all timezone-related variables based on a zone (i.e. America/New_York).  <a href="#a4ad5268888c358048f6045a7dc135c4d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structphone__profile.html">phone_profile</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a3e90ce2ee41dc4e5efb73411c455f73d">unref_profile</a> (struct <a class="el" href="structphone__profile.html">phone_profile</a> *prof)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structhttp__route.html">http_route</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a5ff17e8d1cc95b424aceff81e8f99ca6">unref_route</a> (struct <a class="el" href="structhttp__route.html">http_route</a> *route)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structuser.html">user</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a61177e129b4f8b4a11498f33773ccc1b">unref_user</a> (struct <a class="el" href="structuser.html">user</a> *<a class="el" href="structuser.html">user</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a6581f3b0ba4bf46395cc66968f9c4ff8">user_destructor</a> (void *obj)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Free all memory associated with a <a class="el" href="structuser.html" title="structure to hold users read from users.conf">user</a>.  <a href="#a6581f3b0ba4bf46395cc66968f9c4ff8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a14b35d5095ca99ff94af78bc1c32a5f3">users_cmp_fn</a> (void *obj, void *arg, int flags)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a4d703ea2245933e511f79e52c7c349aa">users_hash_fn</a> (const void *obj, const int flags)</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__module__info.html">ast_module_info</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a> = { .<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = AST_MODULE, .flags = AST_MODFLAG_GLOBAL_SYMBOLS , .<a class="el" href="callerid_8c.html#a68344fa88cf4e86b5079fd69a5c22d57">description</a> = &quot;HTTP Phone Provisioning&quot; , .key = &quot;This paragraph is copyright (c) 2006 by Digium, Inc. \In order for your module to load, it must return this \key via a function called \&quot;key\&quot;. Any code which \includes this paragraph must be licensed under the GNU \General Public License <a class="el" href="res__config__pgsql_8c.html#aad880fc4455c253781e8968f2239d56f">version</a> 2 or later (at your \option). In addition to Digium's general reservations \of rights, Digium expressly reserves the right to \allow other parties to license this paragraph under \different terms. Any use of Digium, Inc. trademarks or \logos (including \&quot;Asterisk\&quot; or \&quot;Digium\&quot;) without \express written <a class="el" href="structpermission.html">permission</a> of Digium, Inc. is prohibited.\n&quot; , .buildopt_sum = &quot;aefddfaffd51bc118c14a748e96eb9a0&quot; , .load = load_module, .unload = unload_module, .reload = reload, }</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct in_addr&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a1d084b82cb21102ba46ea60d3cd9c085">__ourip</a> = { .s_addr = 0x00000000, }</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">for use in lookup_iface  <a href="#a1d084b82cb21102ba46ea60d3cd9c085"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__module__info.html">ast_module_info</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#ae25b9f3970870610911f8850897e8ead">ast_module_info</a> = &amp;<a class="el" href="res__timing__timerfd_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a0b98d7043ca0b2bd43b0314237bc8587">global_default_profile</a> [80] = &quot;&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a87e6df5f528d302bdc2905048211c0ab">global_server</a> [80] = &quot;&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a1239e5c2af085094329f54fd64458de8">global_serverport</a> [6] = &quot;&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct varshead&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a99146593ce920142bad553c2180d0f17">global_variables</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">List of global variables currently available: VOICEMAIL_EXTEN, EXTENSION_LENGTH.  <a href="#a99146593ce920142bad553c2180d0f17"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="lock_8h.html#a2d9118a2a8939f115eea771bce3a52f2">ast_mutex_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#ac5e1d00d9d447cc961b9e31a34a96507">globals_lock</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structao2__container.html">ao2_container</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a942fc912551220a86dc49f2fb79b756a">http_routes</a></td></tr>
<tr><td class="memItemLeft" >struct {</td></tr>
<tr><td class="memItemLeft" >&nbsp;&nbsp;&nbsp;char *&nbsp;&nbsp;&nbsp;<a class="el" href="res__phoneprov_8c.html#a71ac783a3ca66bd546dc964f1dd0e0f0">ext</a></td></tr>
<tr><td class="memItemLeft" >&nbsp;&nbsp;&nbsp;char *&nbsp;&nbsp;&nbsp;<a class="el" href="res__phoneprov_8c.html#aff336343ef8b74fa572dd6e820a53580">mtype</a></td></tr>
<tr><td class="memItemLeft" valign="top">}&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a1fcea5c467a2309e3c4f2ca36c0dde06">mimetypes</a> []</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Extensions whose mime types we think we know.  <a href="#a1fcea5c467a2309e3c4f2ca36c0dde06"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__http__uri.html">ast_http_uri</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a9ada7959089cbf06e161d25b89590066">phoneprovuri</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a498b3e866e88c552efa0af7fe6a5b653">pp_cli</a> []</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__custom__function.html">ast_custom_function</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a4028ff03143c2036f9b6db585e3ba4ab">pp_each_extension_function</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__custom__function.html">ast_custom_function</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a4aba47037e53722c9cb9dd97917ac956">pp_each_user_function</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structpp__variable__lookup.html">pp_variable_lookup</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a7fb110e85f1fb61a98b5d8c756111fba">pp_variable_list</a> []</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Lookup table to translate between users.conf property names and variables for use in phoneprov templates.  <a href="#a7fb110e85f1fb61a98b5d8c756111fba"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structao2__container.html">ao2_container</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#aa1076cae3e9e8548ec08760e2cac64f8">profiles</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structao2__container.html">ao2_container</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__phoneprov_8c.html#a83dc8a4d62a5fdcd27ed6756cdaeb114">users</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Phone provisioning application for the asterisk internal http server. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Matthew Brooks &lt;<a href="mailto:mbrooks@digium.com">mbrooks@digium.com</a>&gt; </dd>
<dd>
Terry Wilson &lt;<a href="mailto:twilson@digium.com">twilson@digium.com</a>&gt; </dd></dl>

<p>Definition in file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="ac8dc47e3b39c930caed4bfd05b4ba805"></a><!-- doxytag: member="res_phoneprov.c::FORMAT" ref="ac8dc47e3b39c930caed4bfd05b4ba805" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define FORMAT&nbsp;&nbsp;&nbsp;&quot;%-40.40s  %-30.30s\n&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a12277aa03a4c963e247eb4670e6751c0"></a><!-- doxytag: member="res_phoneprov.c::MAX_PROFILE_BUCKETS" ref="a12277aa03a4c963e247eb4670e6751c0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_PROFILE_BUCKETS&nbsp;&nbsp;&nbsp;17</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00061">61</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>Referenced by <a class="el" href="res__phoneprov_8c_source.html#l01250">load_module()</a>.</p>

</div>
</div>
<a class="anchor" id="a0d556e8c0c8f8b8c66da39183bec2d72"></a><!-- doxytag: member="res_phoneprov.c::MAX_ROUTE_BUCKETS" ref="a0d556e8c0c8f8b8c66da39183bec2d72" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_ROUTE_BUCKETS&nbsp;&nbsp;&nbsp;563</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00062">62</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>Referenced by <a class="el" href="res__phoneprov_8c_source.html#l01250">load_module()</a>.</p>

</div>
</div>
<a class="anchor" id="a0093d2299b135a3be5d1e7775f2af02d"></a><!-- doxytag: member="res_phoneprov.c::MAX_USER_BUCKETS" ref="a0093d2299b135a3be5d1e7775f2af02d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_USER_BUCKETS&nbsp;&nbsp;&nbsp;563</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00063">63</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae1761f6ffd7763505cd891d3314cd7e4"></a><!-- doxytag: member="res_phoneprov.c::VAR_BUF_SIZE" ref="ae1761f6ffd7763505cd891d3314cd7e4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define VAR_BUF_SIZE&nbsp;&nbsp;&nbsp;4096</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00066">66</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

</div>
</div>
<hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="ad9f59295a8c67b6a4d07f7f6e141a20b"></a><!-- doxytag: member="res_phoneprov.c::pp_variables" ref="ad9f59295a8c67b6a4d07f7f6e141a20b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="res__phoneprov_8c.html#ad9f59295a8c67b6a4d07f7f6e141a20b">pp_variables</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="ad9f59295a8c67b6a4d07f7f6e141a20ba61f5014b80cce0a1a069463c63ee0624"></a><!-- doxytag: member="PP_MACADDRESS" ref="ad9f59295a8c67b6a4d07f7f6e141a20ba61f5014b80cce0a1a069463c63ee0624" args="" -->PP_MACADDRESS</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ad9f59295a8c67b6a4d07f7f6e141a20bae1877e7a57f09eb150f0ed8b443770c5"></a><!-- doxytag: member="PP_USERNAME" ref="ad9f59295a8c67b6a4d07f7f6e141a20bae1877e7a57f09eb150f0ed8b443770c5" args="" -->PP_USERNAME</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ad9f59295a8c67b6a4d07f7f6e141a20ba998f5a17d498eade16d01a125a65a3c1"></a><!-- doxytag: member="PP_FULLNAME" ref="ad9f59295a8c67b6a4d07f7f6e141a20ba998f5a17d498eade16d01a125a65a3c1" args="" -->PP_FULLNAME</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ad9f59295a8c67b6a4d07f7f6e141a20bac5130f5369abd33d80246064ef8c8897"></a><!-- doxytag: member="PP_SECRET" ref="ad9f59295a8c67b6a4d07f7f6e141a20bac5130f5369abd33d80246064ef8c8897" args="" -->PP_SECRET</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ad9f59295a8c67b6a4d07f7f6e141a20baf22d50ddb88f8782a6401f3b597dde79"></a><!-- doxytag: member="PP_LABEL" ref="ad9f59295a8c67b6a4d07f7f6e141a20baf22d50ddb88f8782a6401f3b597dde79" args="" -->PP_LABEL</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ad9f59295a8c67b6a4d07f7f6e141a20ba746b6c4d7070ab317f423a6900e2e95a"></a><!-- doxytag: member="PP_CALLERID" ref="ad9f59295a8c67b6a4d07f7f6e141a20ba746b6c4d7070ab317f423a6900e2e95a" args="" -->PP_CALLERID</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ad9f59295a8c67b6a4d07f7f6e141a20ba770142b9e76e90ebb448780dffe6c72c"></a><!-- doxytag: member="PP_TIMEZONE" ref="ad9f59295a8c67b6a4d07f7f6e141a20ba770142b9e76e90ebb448780dffe6c72c" args="" -->PP_TIMEZONE</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ad9f59295a8c67b6a4d07f7f6e141a20ba340324250c96193036ebaf2d75d92fec"></a><!-- doxytag: member="PP_LINENUMBER" ref="ad9f59295a8c67b6a4d07f7f6e141a20ba340324250c96193036ebaf2d75d92fec" args="" -->PP_LINENUMBER</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ad9f59295a8c67b6a4d07f7f6e141a20ba78622575d08cd751a176d8acab53e0be"></a><!-- doxytag: member="PP_LINEKEYS" ref="ad9f59295a8c67b6a4d07f7f6e141a20ba78622575d08cd751a176d8acab53e0be" args="" -->PP_LINEKEYS</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ad9f59295a8c67b6a4d07f7f6e141a20bac42f340f12b19ce4aa310aae8c93a54d"></a><!-- doxytag: member="PP_VAR_LIST_LENGTH" ref="ad9f59295a8c67b6a4d07f7f6e141a20bac42f340f12b19ce4aa310aae8c93a54d" args="" -->PP_VAR_LIST_LENGTH</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00073">73</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00073"></a>00073                   {
<a name="l00074"></a>00074    <a class="code" href="res__phoneprov_8c.html#ad9f59295a8c67b6a4d07f7f6e141a20ba61f5014b80cce0a1a069463c63ee0624">PP_MACADDRESS</a>,
<a name="l00075"></a>00075    <a class="code" href="res__phoneprov_8c.html#ad9f59295a8c67b6a4d07f7f6e141a20bae1877e7a57f09eb150f0ed8b443770c5">PP_USERNAME</a>,
<a name="l00076"></a>00076    <a class="code" href="res__phoneprov_8c.html#ad9f59295a8c67b6a4d07f7f6e141a20ba998f5a17d498eade16d01a125a65a3c1">PP_FULLNAME</a>,
<a name="l00077"></a>00077    <a class="code" href="res__phoneprov_8c.html#ad9f59295a8c67b6a4d07f7f6e141a20bac5130f5369abd33d80246064ef8c8897">PP_SECRET</a>,
<a name="l00078"></a>00078    <a class="code" href="res__phoneprov_8c.html#ad9f59295a8c67b6a4d07f7f6e141a20baf22d50ddb88f8782a6401f3b597dde79">PP_LABEL</a>,
<a name="l00079"></a>00079    <a class="code" href="res__phoneprov_8c.html#ad9f59295a8c67b6a4d07f7f6e141a20ba746b6c4d7070ab317f423a6900e2e95a">PP_CALLERID</a>,
<a name="l00080"></a>00080    <a class="code" href="res__phoneprov_8c.html#ad9f59295a8c67b6a4d07f7f6e141a20ba770142b9e76e90ebb448780dffe6c72c">PP_TIMEZONE</a>,
<a name="l00081"></a>00081    <a class="code" href="res__phoneprov_8c.html#ad9f59295a8c67b6a4d07f7f6e141a20ba340324250c96193036ebaf2d75d92fec">PP_LINENUMBER</a>,
<a name="l00082"></a>00082    <a class="code" href="res__phoneprov_8c.html#ad9f59295a8c67b6a4d07f7f6e141a20ba78622575d08cd751a176d8acab53e0be">PP_LINEKEYS</a>,
<a name="l00083"></a>00083    <a class="code" href="res__phoneprov_8c.html#ad9f59295a8c67b6a4d07f7f6e141a20bac42f340f12b19ce4aa310aae8c93a54d">PP_VAR_LIST_LENGTH</a>,  <span class="comment">/* This entry must always be the last in the list */</span>
<a name="l00084"></a>00084 };
</pre></div></p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a88b7c88fed6b80fd18f34f97757dfc04"></a><!-- doxytag: member="res_phoneprov.c::__reg_module" ref="a88b7c88fed6b80fd18f34f97757dfc04" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void __reg_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l01321">1321</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

</div>
</div>
<a class="anchor" id="afeab1257bd17282b95875499393a147a"></a><!-- doxytag: member="res_phoneprov.c::__unreg_module" ref="afeab1257bd17282b95875499393a147a" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void __unreg_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l01321">1321</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad23b53289cf4121101c52233bacbacc0"></a><!-- doxytag: member="res_phoneprov.c::add_user_extension" ref="ad23b53289cf4121101c52233bacbacc0" args="(struct user *user, struct extension *exten)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int add_user_extension </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structuser.html">user</a> *&nbsp;</td>
          <td class="paramname"> <em>user</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structextension.html">extension</a> *&nbsp;</td>
          <td class="paramname"> <em>exten</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add an <a class="el" href="structextension.html">extension</a> to a <a class="el" href="structuser.html" title="structure to hold users read from users.conf">user</a> ordered by index/linenumber. </p>

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00860">860</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00449">AST_LIST_EMPTY</a>, <a class="el" href="linkedlists_8h_source.html#l00583">AST_LIST_INSERT_BEFORE_CURRENT</a>, <a class="el" href="linkedlists_8h_source.html#l00695">AST_LIST_INSERT_HEAD</a>, <a class="el" href="linkedlists_8h_source.html#l00715">AST_LIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h_source.html#l00438">AST_LIST_NEXT</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00528">AST_LIST_TRAVERSE_SAFE_BEGIN</a>, <a class="el" href="linkedlists_8h_source.html#l00599">AST_LIST_TRAVERSE_SAFE_END</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="chanvars_8c_source.html#l00037">ast_var_assign()</a>, <a class="el" href="structuser.html#a33ffb23cb386d3228aa6164ded55c341">user::extensions</a>, <a class="el" href="res__phoneprov_8c_source.html#l00131">extension::headp</a>, <a class="el" href="res__phoneprov_8c_source.html#l00121">phone_profile::headp</a>, <a class="el" href="res__phoneprov_8c_source.html#l00130">extension::index</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="res__phoneprov_8c_source.html#l00139">user::macaddress</a>, <a class="el" href="chanvars_8h_source.html#l00031">ast_var_t::name</a>, <a class="el" href="pbx_8c_source.html#l03604">pbx_substitute_variables_varshead()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00140">user::profile</a>, <a class="el" href="chanvars_8h_source.html#l00030">ast_var_t::value</a>, <a class="el" href="ast__expr2f_8c_source.html#l00613">var</a>, and <a class="el" href="pbx_8c_source.html#l00729">VAR_BUF_SIZE</a>.</p>

<p>Referenced by <a class="el" href="res__phoneprov_8c_source.html#l00912">set_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00861"></a>00861 {
<a name="l00862"></a>00862    <span class="keyword">struct </span><a class="code" href="structast__var__t.html">ast_var_t</a> *<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>;
<a name="l00863"></a>00863 
<a name="l00864"></a>00864    <span class="comment">/* Append profile variables here, and substitute variables on profile</span>
<a name="l00865"></a>00865 <span class="comment">    * setvars, so that we can use user specific variables in them */</span>
<a name="l00866"></a>00866    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(user-&gt;<a class="code" href="structuser.html#a688799bff398633f247e35a105013ac3">profile</a>-&gt;<a class="code" href="structphone__profile.html#abaa13b11d884cceb9a8b2aed58a2cc11">headp</a>, var, entries) {
<a name="l00867"></a>00867       <span class="keywordtype">char</span> expand_buf[<a class="code" href="pbx_8c.html#ae1761f6ffd7763505cd891d3314cd7e4">VAR_BUF_SIZE</a>] = {0,};
<a name="l00868"></a>00868       <span class="keyword">struct </span><a class="code" href="structast__var__t.html">ast_var_t</a> *var2;
<a name="l00869"></a>00869 
<a name="l00870"></a>00870       <a class="code" href="pbx_8h.html#a2b3355625306d4b98ca8047cd2245459">pbx_substitute_variables_varshead</a>(exten-&gt;<a class="code" href="structextension.html#abaa13b11d884cceb9a8b2aed58a2cc11">headp</a>, var-&gt;<a class="code" href="structast__var__t.html#a4e9aec275e566b978a3ccb4e043d8c61">value</a>, expand_buf, <span class="keyword">sizeof</span>(expand_buf));
<a name="l00871"></a>00871       <span class="keywordflow">if</span> ((var2 = <a class="code" href="chanvars_8h.html#a8ea2b5a29fa275115c7ed27a593b727d">ast_var_assign</a>(var-&gt;<a class="code" href="structast__var__t.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>, expand_buf)))
<a name="l00872"></a>00872          <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(exten-&gt;<a class="code" href="structextension.html#abaa13b11d884cceb9a8b2aed58a2cc11">headp</a>, var2, entries);
<a name="l00873"></a>00873    }
<a name="l00874"></a>00874 
<a name="l00875"></a>00875    <span class="keywordflow">if</span> (<a class="code" href="linkedlists_8h.html#a4a1884cde93e53bef32ca85c194a1d05" title="Checks whether the specified list contains any entries.">AST_LIST_EMPTY</a>(&amp;user-&gt;<a class="code" href="structuser.html#a33ffb23cb386d3228aa6164ded55c341">extensions</a>)) {
<a name="l00876"></a>00876       <a class="code" href="linkedlists_8h.html#aa2ded2af046bb513f77056c27c083307" title="Inserts a list entry at the head of a list.">AST_LIST_INSERT_HEAD</a>(&amp;user-&gt;<a class="code" href="structuser.html#a33ffb23cb386d3228aa6164ded55c341">extensions</a>, exten, entry);
<a name="l00877"></a>00877    } <span class="keywordflow">else</span> {
<a name="l00878"></a>00878       <span class="keyword">struct </span><a class="code" href="structextension.html">extension</a> *exten_iter;
<a name="l00879"></a>00879 
<a name="l00880"></a>00880       <a class="code" href="linkedlists_8h.html#aa5be52067bf16bdc7e56ca19b5ba858d" title="Loops safely over (traverses) the entries in a list.">AST_LIST_TRAVERSE_SAFE_BEGIN</a>(&amp;user-&gt;<a class="code" href="structuser.html#a33ffb23cb386d3228aa6164ded55c341">extensions</a>, exten_iter, <a class="code" href="structextension.html#a27681bb9c1eff7bae46d2f35b10626b7">entry</a>) {
<a name="l00881"></a>00881          <span class="keywordflow">if</span> (exten-&gt;<a class="code" href="structextension.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> &lt; exten_iter-&gt;<a class="code" href="structextension.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>) {
<a name="l00882"></a>00882             <a class="code" href="linkedlists_8h.html#a83227c4f8c836f0452b607507c55752f" title="Inserts a list entry before the current entry during a traversal.">AST_LIST_INSERT_BEFORE_CURRENT</a>(exten, <a class="code" href="structextension.html#a27681bb9c1eff7bae46d2f35b10626b7">entry</a>);
<a name="l00883"></a>00883          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (exten-&gt;<a class="code" href="structextension.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> == exten_iter-&gt;<a class="code" href="structextension.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>) {
<a name="l00884"></a>00884             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Duplicate linenumber=%d for %s\n&quot;</span>, exten-&gt;<a class="code" href="structextension.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>, user-&gt;<a class="code" href="structuser.html#a43de8de44949a0033b3cbe2fbb3ae523">macaddress</a>);
<a name="l00885"></a>00885             <span class="keywordflow">return</span> -1;
<a name="l00886"></a>00886          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(exten_iter, <a class="code" href="structextension.html#a27681bb9c1eff7bae46d2f35b10626b7">entry</a>)) {
<a name="l00887"></a>00887             <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(&amp;user-&gt;<a class="code" href="structuser.html#a33ffb23cb386d3228aa6164ded55c341">extensions</a>, exten, <a class="code" href="structextension.html#a27681bb9c1eff7bae46d2f35b10626b7">entry</a>);
<a name="l00888"></a>00888          }
<a name="l00889"></a>00889       }
<a name="l00890"></a>00890       <a class="code" href="linkedlists_8h.html#a712c04b4493919a7052399cd30ee8fb9" title="Closes a safe loop traversal block.">AST_LIST_TRAVERSE_SAFE_END</a>;
<a name="l00891"></a>00891    }
<a name="l00892"></a>00892 
<a name="l00893"></a>00893    <span class="keywordflow">return</span> 0;
<a name="l00894"></a>00894 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8cff0bba26573fb649703e10df4c3997"></a><!-- doxytag: member="res_phoneprov.c::build_extension" ref="a8cff0bba26573fb649703e10df4c3997" args="(struct ast_config *cfg, const char *name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structextension.html">extension</a>* build_extension </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__config.html">ast_config</a> *&nbsp;</td>
          <td class="paramname"> <em>cfg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00709">709</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="linkedlists_8h_source.html#l00715">AST_LIST_INSERT_TAIL</a>, <a class="el" href="stringfields_8h_source.html#l00241">ast_string_field_init</a>, <a class="el" href="stringfields_8h_source.html#l00285">ast_string_field_set</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="chanvars_8c_source.html#l00037">ast_var_assign()</a>, <a class="el" href="config_8c_source.html#l00435">ast_variable_retrieve()</a>, <a class="el" href="chan__alsa_8c_source.html#l00107">exten</a>, <a class="el" href="res__phoneprov_8c_source.html#l00131">extension::headp</a>, <a class="el" href="res__phoneprov_8c_source.html#l00130">extension::index</a>, <a class="el" href="res__phoneprov_8c_source.html#l00129">extension::name</a>, <a class="el" href="res__phoneprov_8c_source.html#l00082">PP_LINEKEYS</a>, <a class="el" href="res__phoneprov_8c_source.html#l00081">PP_LINENUMBER</a>, <a class="el" href="res__phoneprov_8c_source.html#l00080">PP_TIMEZONE</a>, <a class="el" href="res__phoneprov_8c_source.html#l00075">PP_USERNAME</a>, <a class="el" href="res__phoneprov_8c_source.html#l00083">PP_VAR_LIST_LENGTH</a>, <a class="el" href="res__phoneprov_8c.html#a7fb110e85f1fb61a98b5d8c756111fba">pp_variable_list</a>, <a class="el" href="res__phoneprov_8c_source.html#l00344">set_timezone_variables()</a>, and <a class="el" href="ast__expr2f_8c_source.html#l00613">var</a>.</p>

<p>Referenced by <a class="el" href="res__phoneprov_8c_source.html#l00912">set_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00710"></a>00710 {
<a name="l00711"></a>00711    <span class="keyword">struct </span><a class="code" href="structextension.html">extension</a> *<a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>;
<a name="l00712"></a>00712    <span class="keyword">struct </span><a class="code" href="structast__var__t.html">ast_var_t</a> *<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>;
<a name="l00713"></a>00713    <span class="keyword">const</span> <span class="keywordtype">char</span> *tmp;
<a name="l00714"></a>00714    <span class="keywordtype">int</span> i;
<a name="l00715"></a>00715 
<a name="l00716"></a>00716    <span class="keywordflow">if</span> (!(exten = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*exten)))) {
<a name="l00717"></a>00717       <span class="keywordflow">return</span> NULL;
<a name="l00718"></a>00718    }
<a name="l00719"></a>00719 
<a name="l00720"></a>00720    <span class="keywordflow">if</span> (<a class="code" href="stringfields_8h.html#a871274fa4fd2687c7a44849a84df3665" title="Initialize a field pool and fields.">ast_string_field_init</a>(exten, 32)) {
<a name="l00721"></a>00721       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(exten);
<a name="l00722"></a>00722       exten = NULL;
<a name="l00723"></a>00723       <span class="keywordflow">return</span> NULL;
<a name="l00724"></a>00724    }
<a name="l00725"></a>00725 
<a name="l00726"></a>00726    <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(exten, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l00727"></a>00727 
<a name="l00728"></a>00728    <span class="keywordflow">if</span> (!(exten-&gt;<a class="code" href="structextension.html#abaa13b11d884cceb9a8b2aed58a2cc11">headp</a> = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*exten-&gt;<a class="code" href="structextension.html#abaa13b11d884cceb9a8b2aed58a2cc11">headp</a>)))) {
<a name="l00729"></a>00729       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(exten);
<a name="l00730"></a>00730       exten = NULL;
<a name="l00731"></a>00731       <span class="keywordflow">return</span> NULL;
<a name="l00732"></a>00732    }
<a name="l00733"></a>00733 
<a name="l00734"></a>00734    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="res__phoneprov_8c.html#ad9f59295a8c67b6a4d07f7f6e141a20bac42f340f12b19ce4aa310aae8c93a54d">PP_VAR_LIST_LENGTH</a>; i++) {
<a name="l00735"></a>00735       tmp = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <a class="code" href="res__phoneprov_8c.html#a7fb110e85f1fb61a98b5d8c756111fba" title="Lookup table to translate between users.conf property names and variables for use...">pp_variable_list</a>[i].user_var);
<a name="l00736"></a>00736 
<a name="l00737"></a>00737       <span class="comment">/* If we didn&apos;t get a USERNAME variable, set it to the user-&gt;name */</span>
<a name="l00738"></a>00738       <span class="keywordflow">if</span> (i == <a class="code" href="res__phoneprov_8c.html#ad9f59295a8c67b6a4d07f7f6e141a20bae1877e7a57f09eb150f0ed8b443770c5">PP_USERNAME</a> &amp;&amp; !tmp) {
<a name="l00739"></a>00739          <span class="keywordflow">if</span> ((var = <a class="code" href="chanvars_8h.html#a8ea2b5a29fa275115c7ed27a593b727d">ast_var_assign</a>(<a class="code" href="res__phoneprov_8c.html#a7fb110e85f1fb61a98b5d8c756111fba" title="Lookup table to translate between users.conf property names and variables for use...">pp_variable_list</a>[<a class="code" href="res__phoneprov_8c.html#ad9f59295a8c67b6a4d07f7f6e141a20bae1877e7a57f09eb150f0ed8b443770c5">PP_USERNAME</a>].template_var, exten-&gt;<a class="code" href="structextension.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>))) {
<a name="l00740"></a>00740             <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(exten-&gt;<a class="code" href="structextension.html#abaa13b11d884cceb9a8b2aed58a2cc11">headp</a>, var, entries);
<a name="l00741"></a>00741          }
<a name="l00742"></a>00742          <span class="keywordflow">continue</span>;
<a name="l00743"></a>00743       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i == <a class="code" href="res__phoneprov_8c.html#ad9f59295a8c67b6a4d07f7f6e141a20ba770142b9e76e90ebb448780dffe6c72c">PP_TIMEZONE</a>) {
<a name="l00744"></a>00744          <span class="comment">/* perfectly ok if tmp is NULL, will set variables based on server&apos;s time zone */</span>
<a name="l00745"></a>00745          <a class="code" href="res__phoneprov_8c.html#a4ad5268888c358048f6045a7dc135c4d" title="Set all timezone-related variables based on a zone (i.e. America/New_York).">set_timezone_variables</a>(exten-&gt;<a class="code" href="structextension.html#abaa13b11d884cceb9a8b2aed58a2cc11">headp</a>, tmp);
<a name="l00746"></a>00746       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i == <a class="code" href="res__phoneprov_8c.html#ad9f59295a8c67b6a4d07f7f6e141a20ba340324250c96193036ebaf2d75d92fec">PP_LINENUMBER</a>) {
<a name="l00747"></a>00747          <span class="keywordflow">if</span> (!tmp) {
<a name="l00748"></a>00748             tmp = <span class="stringliteral">&quot;1&quot;</span>;
<a name="l00749"></a>00749          }
<a name="l00750"></a>00750          exten-&gt;<a class="code" href="structextension.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> = atoi(tmp);
<a name="l00751"></a>00751       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i == <a class="code" href="res__phoneprov_8c.html#ad9f59295a8c67b6a4d07f7f6e141a20ba78622575d08cd751a176d8acab53e0be">PP_LINEKEYS</a>) {
<a name="l00752"></a>00752          <span class="keywordflow">if</span> (!tmp) {
<a name="l00753"></a>00753             tmp = <span class="stringliteral">&quot;1&quot;</span>;
<a name="l00754"></a>00754          }
<a name="l00755"></a>00755       }
<a name="l00756"></a>00756 
<a name="l00757"></a>00757       <span class="keywordflow">if</span> (tmp &amp;&amp; (var = <a class="code" href="chanvars_8h.html#a8ea2b5a29fa275115c7ed27a593b727d">ast_var_assign</a>(<a class="code" href="res__phoneprov_8c.html#a7fb110e85f1fb61a98b5d8c756111fba" title="Lookup table to translate between users.conf property names and variables for use...">pp_variable_list</a>[i].template_var, tmp))) {
<a name="l00758"></a>00758          <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(exten-&gt;<a class="code" href="structextension.html#abaa13b11d884cceb9a8b2aed58a2cc11">headp</a>, var, entries);
<a name="l00759"></a>00759       }
<a name="l00760"></a>00760    }
<a name="l00761"></a>00761 
<a name="l00762"></a>00762    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="res__phoneprov_8c.html#a87e6df5f528d302bdc2905048211c0ab">global_server</a>)) {
<a name="l00763"></a>00763       <span class="keywordflow">if</span> ((var = <a class="code" href="chanvars_8h.html#a8ea2b5a29fa275115c7ed27a593b727d">ast_var_assign</a>(<span class="stringliteral">&quot;SERVER&quot;</span>, <a class="code" href="res__phoneprov_8c.html#a87e6df5f528d302bdc2905048211c0ab">global_server</a>)))
<a name="l00764"></a>00764          <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(exten-&gt;<a class="code" href="structextension.html#abaa13b11d884cceb9a8b2aed58a2cc11">headp</a>, var, entries);
<a name="l00765"></a>00765    }
<a name="l00766"></a>00766 
<a name="l00767"></a>00767    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="res__phoneprov_8c.html#a1239e5c2af085094329f54fd64458de8">global_serverport</a>)) {
<a name="l00768"></a>00768       <span class="keywordflow">if</span> ((var = <a class="code" href="chanvars_8h.html#a8ea2b5a29fa275115c7ed27a593b727d">ast_var_assign</a>(<span class="stringliteral">&quot;SERVER_PORT&quot;</span>, <a class="code" href="res__phoneprov_8c.html#a1239e5c2af085094329f54fd64458de8">global_serverport</a>)))
<a name="l00769"></a>00769          <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(exten-&gt;<a class="code" href="structextension.html#abaa13b11d884cceb9a8b2aed58a2cc11">headp</a>, var, entries);
<a name="l00770"></a>00770    }
<a name="l00771"></a>00771 
<a name="l00772"></a>00772    <span class="keywordflow">return</span> exten;
<a name="l00773"></a>00773 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aef718301835f2096a66d68122adee512"></a><!-- doxytag: member="res_phoneprov.c::build_profile" ref="aef718301835f2096a66d68122adee512" args="(const char *name, struct ast_variable *v)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void build_profile </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__variable.html">ast_variable</a> *&nbsp;</td>
          <td class="paramname"> <em>v</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Build a phone profile and add it to the list of phone profiles. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>the name of the profile </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>v</em>&nbsp;</td><td><a class="el" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> from parsing phoneprov.conf </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00583">583</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00413">ao2_alloc</a>, <a class="el" href="astobj2_8h_source.html#l00782">ao2_link</a>, <a class="el" href="app_8h_source.html#l00338">AST_APP_ARG</a>, <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="app_8h_source.html#l00355">AST_DECLARE_APP_ARGS</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="linkedlists_8h_source.html#l00665">AST_LIST_HEAD_INIT_NOLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00715">AST_LIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="app_8h_source.html#l00402">AST_NONSTANDARD_APP_ARGS</a>, <a class="el" href="app_8h_source.html#l00387">AST_STANDARD_APP_ARGS</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="stringfields_8h_source.html#l00308">ast_string_field_build</a>, <a class="el" href="stringfields_8h_source.html#l00241">ast_string_field_init</a>, <a class="el" href="stringfields_8h_source.html#l00285">ast_string_field_set</a>, <a class="el" href="strings_8h_source.html#l00150">ast_strip()</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="chanvars_8c_source.html#l00037">ast_var_assign()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00556">build_route()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00120">phone_profile::default_mime_type</a>, <a class="el" href="structphone__profile.html#a25fc7f04be8b6ea66317503640ec8794">phone_profile::dynamic_files</a>, <a class="el" href="res__phoneprov_8c_source.html#l00110">phoneprov_file::format</a>, <a class="el" href="res__phoneprov_8c_source.html#l00180">ftype2mtype()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00176">global_variables</a>, <a class="el" href="res__phoneprov_8c_source.html#l00121">phone_profile::headp</a>, <a class="el" href="res__phoneprov_8c_source.html#l00110">phoneprov_file::mime_type</a>, <a class="el" href="chanvars_8h_source.html#l00031">ast_var_t::name</a>, <a class="el" href="config_8h_source.html#l00075">ast_variable::name</a>, <a class="el" href="config_8h_source.html#l00077">ast_variable::next</a>, <a class="el" href="res__phoneprov_8c_source.html#l00263">profile_destructor()</a>, <a class="el" href="strings_8h_source.html#l00072">S_OR</a>, <a class="el" href="structphone__profile.html#ad1504ea54c8a417d9e4fe829ad3cab7e">phone_profile::static_files</a>, <a class="el" href="res__phoneprov_8c_source.html#l00120">phone_profile::staticdir</a>, <a class="el" href="res__phoneprov_8c_source.html#l00226">unref_profile()</a>, <a class="el" href="chanvars_8h_source.html#l00030">ast_var_t::value</a>, <a class="el" href="config_8h_source.html#l00076">ast_variable::value</a>, and <a class="el" href="ast__expr2f_8c_source.html#l00613">var</a>.</p>

<p>Referenced by <a class="el" href="res__phoneprov_8c_source.html#l00912">set_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00584"></a>00584 {
<a name="l00585"></a>00585    <span class="keyword">struct </span><a class="code" href="structphone__profile.html" title="structure to hold phone profiles read from phoneprov.conf">phone_profile</a> *profile;
<a name="l00586"></a>00586    <span class="keyword">struct </span><a class="code" href="structast__var__t.html">ast_var_t</a> *<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>;
<a name="l00587"></a>00587 
<a name="l00588"></a>00588    <span class="keywordflow">if</span> (!(profile = <a class="code" href="astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*profile), <a class="code" href="res__phoneprov_8c.html#a0c8d3191d4633ed3b4dad8750fa755d8">profile_destructor</a>))) {
<a name="l00589"></a>00589       <span class="keywordflow">return</span>;
<a name="l00590"></a>00590    }
<a name="l00591"></a>00591 
<a name="l00592"></a>00592    <span class="keywordflow">if</span> (<a class="code" href="stringfields_8h.html#a871274fa4fd2687c7a44849a84df3665" title="Initialize a field pool and fields.">ast_string_field_init</a>(profile, 32)) {
<a name="l00593"></a>00593       profile = <a class="code" href="res__phoneprov_8c.html#a3e90ce2ee41dc4e5efb73411c455f73d">unref_profile</a>(profile);
<a name="l00594"></a>00594       <span class="keywordflow">return</span>;
<a name="l00595"></a>00595    }
<a name="l00596"></a>00596 
<a name="l00597"></a>00597    <span class="keywordflow">if</span> (!(profile-&gt;<a class="code" href="structphone__profile.html#abaa13b11d884cceb9a8b2aed58a2cc11">headp</a> = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*profile-&gt;<a class="code" href="structphone__profile.html#abaa13b11d884cceb9a8b2aed58a2cc11">headp</a>)))) {
<a name="l00598"></a>00598       profile = <a class="code" href="res__phoneprov_8c.html#a3e90ce2ee41dc4e5efb73411c455f73d">unref_profile</a>(profile);
<a name="l00599"></a>00599       <span class="keywordflow">return</span>;
<a name="l00600"></a>00600    }
<a name="l00601"></a>00601 
<a name="l00602"></a>00602    <a class="code" href="linkedlists_8h.html#a0d1f922e093ac18824a7863fe3f5fa27" title="Initializes a list head structure.">AST_LIST_HEAD_INIT_NOLOCK</a>(&amp;profile-&gt;<a class="code" href="structphone__profile.html#ad1504ea54c8a417d9e4fe829ad3cab7e">static_files</a>);
<a name="l00603"></a>00603    <a class="code" href="linkedlists_8h.html#a0d1f922e093ac18824a7863fe3f5fa27" title="Initializes a list head structure.">AST_LIST_HEAD_INIT_NOLOCK</a>(&amp;profile-&gt;<a class="code" href="structphone__profile.html#a25fc7f04be8b6ea66317503640ec8794">dynamic_files</a>);
<a name="l00604"></a>00604 
<a name="l00605"></a>00605    <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(profile, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l00606"></a>00606    <span class="keywordflow">for</span> (; v; v = v-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l00607"></a>00607       <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;mime_type&quot;</span>)) {
<a name="l00608"></a>00608          <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(profile, default_mime_type, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l00609"></a>00609       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;setvar&quot;</span>)) {
<a name="l00610"></a>00610          <span class="keyword">struct </span><a class="code" href="structast__var__t.html">ast_var_t</a> *variable;
<a name="l00611"></a>00611          <span class="keywordtype">char</span> *value_copy = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l00612"></a>00612 
<a name="l00613"></a>00613          <a class="code" href="app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2" title="Declare a structure to hold an application&amp;#39;s arguments.">AST_DECLARE_APP_ARGS</a>(args,
<a name="l00614"></a>00614             <a class="code" href="app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5" title="Define an application argument.">AST_APP_ARG</a>(varname);
<a name="l00615"></a>00615             <a class="code" href="app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5" title="Define an application argument.">AST_APP_ARG</a>(varval);
<a name="l00616"></a>00616          );
<a name="l00617"></a>00617 
<a name="l00618"></a>00618          <a class="code" href="app_8h.html#accfcb380df76a64251d88ef49c2dd4e3" title="Performs the &amp;#39;nonstandard&amp;#39; argument separation process for an application...">AST_NONSTANDARD_APP_ARGS</a>(args, value_copy, <span class="charliteral">&apos;=&apos;</span>);
<a name="l00619"></a>00619          <span class="keywordflow">do</span> {
<a name="l00620"></a>00620             <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(args.varname) || <a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(args.varval))
<a name="l00621"></a>00621                <span class="keywordflow">break</span>;
<a name="l00622"></a>00622             args.varname = <a class="code" href="strings_8h.html#aeb1c54e6e100c63176d8e22b0d5ca865" title="Strip leading/trailing whitespace from a string.">ast_strip</a>(args.varname);
<a name="l00623"></a>00623             args.varval = <a class="code" href="strings_8h.html#aeb1c54e6e100c63176d8e22b0d5ca865" title="Strip leading/trailing whitespace from a string.">ast_strip</a>(args.varval);
<a name="l00624"></a>00624             <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(args.varname) || <a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(args.varval))
<a name="l00625"></a>00625                <span class="keywordflow">break</span>;
<a name="l00626"></a>00626             <span class="keywordflow">if</span> ((variable = <a class="code" href="chanvars_8h.html#a8ea2b5a29fa275115c7ed27a593b727d">ast_var_assign</a>(args.varname, args.varval)))
<a name="l00627"></a>00627                <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(profile-&gt;<a class="code" href="structphone__profile.html#abaa13b11d884cceb9a8b2aed58a2cc11">headp</a>, variable, entries);
<a name="l00628"></a>00628          } <span class="keywordflow">while</span> (0);
<a name="l00629"></a>00629       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;staticdir&quot;</span>)) {
<a name="l00630"></a>00630          <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(profile, staticdir, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l00631"></a>00631       } <span class="keywordflow">else</span> {
<a name="l00632"></a>00632          <span class="keyword">struct </span><a class="code" href="structphoneprov__file.html" title="structure to hold file data">phoneprov_file</a> *pp_file;
<a name="l00633"></a>00633          <span class="keywordtype">char</span> *file_extension;
<a name="l00634"></a>00634          <span class="keywordtype">char</span> *value_copy = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l00635"></a>00635 
<a name="l00636"></a>00636          <a class="code" href="app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2" title="Declare a structure to hold an application&amp;#39;s arguments.">AST_DECLARE_APP_ARGS</a>(args,
<a name="l00637"></a>00637             <a class="code" href="app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5" title="Define an application argument.">AST_APP_ARG</a>(filename);
<a name="l00638"></a>00638             <a class="code" href="app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5" title="Define an application argument.">AST_APP_ARG</a>(mimetype);
<a name="l00639"></a>00639          );
<a name="l00640"></a>00640 
<a name="l00641"></a>00641          <span class="keywordflow">if</span> (!(pp_file = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*pp_file)))) {
<a name="l00642"></a>00642             profile = <a class="code" href="res__phoneprov_8c.html#a3e90ce2ee41dc4e5efb73411c455f73d">unref_profile</a>(profile);
<a name="l00643"></a>00643             <span class="keywordflow">return</span>;
<a name="l00644"></a>00644          }
<a name="l00645"></a>00645          <span class="keywordflow">if</span> (<a class="code" href="stringfields_8h.html#a871274fa4fd2687c7a44849a84df3665" title="Initialize a field pool and fields.">ast_string_field_init</a>(pp_file, 32)) {
<a name="l00646"></a>00646             <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(pp_file);
<a name="l00647"></a>00647             profile = <a class="code" href="res__phoneprov_8c.html#a3e90ce2ee41dc4e5efb73411c455f73d">unref_profile</a>(profile);
<a name="l00648"></a>00648             <span class="keywordflow">return</span>;
<a name="l00649"></a>00649          }
<a name="l00650"></a>00650 
<a name="l00651"></a>00651          <span class="keywordflow">if</span> ((file_extension = strrchr(pp_file-&gt;<a class="code" href="structphoneprov__file.html#ade9ff13c4e32588783cb9cdeb92b8d93">format</a>, <span class="charliteral">&apos;.&apos;</span>)))
<a name="l00652"></a>00652             file_extension++;
<a name="l00653"></a>00653 
<a name="l00654"></a>00654          <a class="code" href="app_8h.html#ac08f7eb1eb9476b30987c73e1052ada8" title="Performs the &amp;#39;standard&amp;#39; argument separation process for an application.">AST_STANDARD_APP_ARGS</a>(args, value_copy);
<a name="l00655"></a>00655 
<a name="l00656"></a>00656          <span class="comment">/* Mime type order of preference</span>
<a name="l00657"></a>00657 <span class="comment">          * 1) Specific mime-type defined for file in profile</span>
<a name="l00658"></a>00658 <span class="comment">          * 2) Mime determined by extension</span>
<a name="l00659"></a>00659 <span class="comment">          * 3) Default mime type specified in profile</span>
<a name="l00660"></a>00660 <span class="comment">          * 4) text/plain</span>
<a name="l00661"></a>00661 <span class="comment">          */</span>
<a name="l00662"></a>00662          <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(pp_file, <a class="code" href="structphoneprov__file.html#a1451e38b2748f8664868291254533673">mime_type</a>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(args.mimetype, (<a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(<a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(<a class="code" href="res__phoneprov_8c.html#a87d229b8abd3637a00aaa1377bbd3392" title="Return mime type based on extension.">ftype2mtype</a>(file_extension), profile-&gt;<a class="code" href="structphone__profile.html#a94850739cb978e2c60ff2af5c3217d76">default_mime_type</a>), <span class="stringliteral">&quot;text/plain&quot;</span>))));
<a name="l00663"></a>00663 
<a name="l00664"></a>00664          <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;static_file&quot;</span>)) {
<a name="l00665"></a>00665             <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(pp_file, <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>, args.filename);
<a name="l00666"></a>00666             <a class="code" href="stringfields_8h.html#a8b9f4347fc72720cc5cead952b54abe9" title="Set a field to a complex (built) value.">ast_string_field_build</a>(pp_file, <span class="keyword">template</span>, <span class="stringliteral">&quot;%s%s&quot;</span>, profile-&gt;<a class="code" href="structphone__profile.html#a36e7f9d92d20e40ac4aa87f7a35c359a">staticdir</a>, args.filename);
<a name="l00667"></a>00667             <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(&amp;profile-&gt;<a class="code" href="structphone__profile.html#ad1504ea54c8a417d9e4fe829ad3cab7e">static_files</a>, pp_file, <a class="code" href="structphoneprov__file.html#a3cb5ae061024852dc1c4a6cc30a46b72">entry</a>);
<a name="l00668"></a>00668             <span class="comment">/* Add a route for the static files, as their filenames won&apos;t change per-user */</span>
<a name="l00669"></a>00669             <a class="code" href="res__phoneprov_8c.html#a2db9c7589efbc4119490d418f27bf675" title="Build a route structure and add it to the list of available http routes.">build_route</a>(pp_file, NULL, NULL);
<a name="l00670"></a>00670          } <span class="keywordflow">else</span> {
<a name="l00671"></a>00671             <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(pp_file, <a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>, v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);
<a name="l00672"></a>00672             <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(pp_file, <span class="keyword">template</span>, args.filename);
<a name="l00673"></a>00673             <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(&amp;profile-&gt;<a class="code" href="structphone__profile.html#a25fc7f04be8b6ea66317503640ec8794">dynamic_files</a>, pp_file, <a class="code" href="structphoneprov__file.html#a3cb5ae061024852dc1c4a6cc30a46b72">entry</a>);
<a name="l00674"></a>00674          }
<a name="l00675"></a>00675       }
<a name="l00676"></a>00676    }
<a name="l00677"></a>00677 
<a name="l00678"></a>00678    <span class="comment">/* Append the global variables to the variables list for this profile.</span>
<a name="l00679"></a>00679 <span class="comment">    * This is for convenience later, when we need to provide a single</span>
<a name="l00680"></a>00680 <span class="comment">    * variable list for use in substitution. */</span>
<a name="l00681"></a>00681    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;<a class="code" href="res__phoneprov_8c.html#ac5e1d00d9d447cc961b9e31a34a96507">globals_lock</a>);
<a name="l00682"></a>00682    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="res__phoneprov_8c.html#a99146593ce920142bad553c2180d0f17" title="List of global variables currently available: VOICEMAIL_EXTEN, EXTENSION_LENGTH.">global_variables</a>, var, entries) {
<a name="l00683"></a>00683       <span class="keyword">struct </span><a class="code" href="structast__var__t.html">ast_var_t</a> *new_var;
<a name="l00684"></a>00684       <span class="keywordflow">if</span> ((new_var = <a class="code" href="chanvars_8h.html#a8ea2b5a29fa275115c7ed27a593b727d">ast_var_assign</a>(var-&gt;<a class="code" href="structast__var__t.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>, var-&gt;<a class="code" href="structast__var__t.html#a4e9aec275e566b978a3ccb4e043d8c61">value</a>))) {
<a name="l00685"></a>00685          <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(profile-&gt;<a class="code" href="structphone__profile.html#abaa13b11d884cceb9a8b2aed58a2cc11">headp</a>, new_var, entries);
<a name="l00686"></a>00686       }
<a name="l00687"></a>00687    }
<a name="l00688"></a>00688    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="res__phoneprov_8c.html#ac5e1d00d9d447cc961b9e31a34a96507">globals_lock</a>);
<a name="l00689"></a>00689 
<a name="l00690"></a>00690    <a class="code" href="astobj2_8h.html#a210544bdcc5afe0601d01d6e529c22d8">ao2_link</a>(<a class="code" href="res__phoneprov_8c.html#aa1076cae3e9e8548ec08760e2cac64f8">profiles</a>, profile);
<a name="l00691"></a>00691 
<a name="l00692"></a>00692    profile = <a class="code" href="res__phoneprov_8c.html#a3e90ce2ee41dc4e5efb73411c455f73d">unref_profile</a>(profile);
<a name="l00693"></a>00693 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2db9c7589efbc4119490d418f27bf675"></a><!-- doxytag: member="res_phoneprov.c::build_route" ref="a2db9c7589efbc4119490d418f27bf675" args="(struct phoneprov_file *pp_file, struct user *user, char *uri)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void build_route </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structphoneprov__file.html">phoneprov_file</a> *&nbsp;</td>
          <td class="paramname"> <em>pp_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structuser.html">user</a> *&nbsp;</td>
          <td class="paramname"> <em>user</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>uri</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Build a route structure and add it to the list of available http routes. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>pp_file</em>&nbsp;</td><td>File to link to the route </td></tr>
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structuser.html" title="structure to hold users read from users.conf">user</a></em>&nbsp;</td><td>User to link to the route (NULL means static route) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>uri</em>&nbsp;</td><td>URI of the route </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00556">556</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00413">ao2_alloc</a>, <a class="el" href="astobj2_8h_source.html#l00782">ao2_link</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="stringfields_8h_source.html#l00241">ast_string_field_init</a>, <a class="el" href="stringfields_8h_source.html#l00285">ast_string_field_set</a>, <a class="el" href="res__phoneprov_8c_source.html#l00149">http_route::file</a>, <a class="el" href="res__phoneprov_8c_source.html#l00110">phoneprov_file::format</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="res__phoneprov_8c_source.html#l00303">route_destructor()</a>, <a class="el" href="strings_8h_source.html#l00072">S_OR</a>, <a class="el" href="res__phoneprov_8c_source.html#l00282">unref_route()</a>, and <a class="el" href="res__phoneprov_8c_source.html#l00150">http_route::user</a>.</p>

<p>Referenced by <a class="el" href="res__phoneprov_8c_source.html#l00583">build_profile()</a>, and <a class="el" href="res__phoneprov_8c_source.html#l00897">build_user_routes()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00557"></a>00557 {
<a name="l00558"></a>00558    <span class="keyword">struct </span><a class="code" href="structhttp__route.html" title="structure to hold http routes (valid URIs, and the files they link to)">http_route</a> *route;
<a name="l00559"></a>00559 
<a name="l00560"></a>00560    <span class="keywordflow">if</span> (!(route = <a class="code" href="astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*route), <a class="code" href="res__phoneprov_8c.html#ae71495d7e33581c0cf2f0cbb35e6c3af">route_destructor</a>))) {
<a name="l00561"></a>00561       <span class="keywordflow">return</span>;
<a name="l00562"></a>00562    }
<a name="l00563"></a>00563 
<a name="l00564"></a>00564    <span class="keywordflow">if</span> (<a class="code" href="stringfields_8h.html#a871274fa4fd2687c7a44849a84df3665" title="Initialize a field pool and fields.">ast_string_field_init</a>(route, 32)) {
<a name="l00565"></a>00565       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Couldn&apos;t create string fields for %s\n&quot;</span>, pp_file-&gt;<a class="code" href="structphoneprov__file.html#ade9ff13c4e32588783cb9cdeb92b8d93">format</a>);
<a name="l00566"></a>00566       route = <a class="code" href="res__phoneprov_8c.html#a5ff17e8d1cc95b424aceff81e8f99ca6">unref_route</a>(route);
<a name="l00567"></a>00567       <span class="keywordflow">return</span>;
<a name="l00568"></a>00568    }
<a name="l00569"></a>00569 
<a name="l00570"></a>00570    <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(route, <a class="code" href="structhttp__route.html#a19ac71226fac09e87afe31acb4c99214">uri</a>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(<a class="code" href="structhttp__route.html#a19ac71226fac09e87afe31acb4c99214">uri</a>, pp_file-&gt;<a class="code" href="structphoneprov__file.html#ade9ff13c4e32588783cb9cdeb92b8d93">format</a>));
<a name="l00571"></a>00571    route-&gt;<a class="code" href="structhttp__route.html#a9071a284c9522ce89ae8c0d0544004e3">user</a> = user;
<a name="l00572"></a>00572    route-&gt;<a class="code" href="structhttp__route.html#a742f7871dc582416bad82b87a1794abf">file</a> = pp_file;
<a name="l00573"></a>00573 
<a name="l00574"></a>00574    <a class="code" href="astobj2_8h.html#a210544bdcc5afe0601d01d6e529c22d8">ao2_link</a>(<a class="code" href="res__phoneprov_8c.html#a942fc912551220a86dc49f2fb79b756a">http_routes</a>, route);
<a name="l00575"></a>00575 
<a name="l00576"></a>00576    route = <a class="code" href="res__phoneprov_8c.html#a5ff17e8d1cc95b424aceff81e8f99ca6">unref_route</a>(route);
<a name="l00577"></a>00577 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af95e27b49139d0b61207299a03cf8d87"></a><!-- doxytag: member="res_phoneprov.c::build_user" ref="af95e27b49139d0b61207299a03cf8d87" args="(const char *mac, struct phone_profile *profile)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structuser.html">user</a>* build_user </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>mac</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structphone__profile.html">phone_profile</a> *&nbsp;</td>
          <td class="paramname"> <em>profile</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Build and return a <a class="el" href="structuser.html" title="structure to hold users read from users.conf">user</a> structure based on gathered config data. </p>

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00838">838</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00413">ao2_alloc</a>, <a class="el" href="stringfields_8h_source.html#l00241">ast_string_field_init</a>, <a class="el" href="stringfields_8h_source.html#l00285">ast_string_field_set</a>, <a class="el" href="res__phoneprov_8c_source.html#l00139">user::macaddress</a>, <a class="el" href="res__phoneprov_8c_source.html#l00140">user::profile</a>, <a class="el" href="res__phoneprov_8c_source.html#l00226">unref_profile()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00775">unref_user()</a>, and <a class="el" href="res__phoneprov_8c_source.html#l00807">user_destructor()</a>.</p>

<p>Referenced by <a class="el" href="res__phoneprov_8c_source.html#l00912">set_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00839"></a>00839 {
<a name="l00840"></a>00840    <span class="keyword">struct </span><a class="code" href="structuser.html" title="structure to hold users read from users.conf">user</a> *<a class="code" href="structuser.html" title="structure to hold users read from users.conf">user</a>;
<a name="l00841"></a>00841 
<a name="l00842"></a>00842    <span class="keywordflow">if</span> (!(user = <a class="code" href="astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*user), <a class="code" href="res__phoneprov_8c.html#a6581f3b0ba4bf46395cc66968f9c4ff8" title="Free all memory associated with a user.">user_destructor</a>))) {
<a name="l00843"></a>00843       profile = <a class="code" href="res__phoneprov_8c.html#a3e90ce2ee41dc4e5efb73411c455f73d">unref_profile</a>(profile);
<a name="l00844"></a>00844       <span class="keywordflow">return</span> NULL;
<a name="l00845"></a>00845    }
<a name="l00846"></a>00846 
<a name="l00847"></a>00847    <span class="keywordflow">if</span> (<a class="code" href="stringfields_8h.html#a871274fa4fd2687c7a44849a84df3665" title="Initialize a field pool and fields.">ast_string_field_init</a>(user, 32)) {
<a name="l00848"></a>00848       profile = <a class="code" href="res__phoneprov_8c.html#a3e90ce2ee41dc4e5efb73411c455f73d">unref_profile</a>(profile);
<a name="l00849"></a>00849       user = <a class="code" href="res__phoneprov_8c.html#a61177e129b4f8b4a11498f33773ccc1b">unref_user</a>(user);
<a name="l00850"></a>00850       <span class="keywordflow">return</span> NULL;
<a name="l00851"></a>00851    }
<a name="l00852"></a>00852 
<a name="l00853"></a>00853    <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(user, <a class="code" href="structuser.html#a43de8de44949a0033b3cbe2fbb3ae523">macaddress</a>, mac);
<a name="l00854"></a>00854    user-&gt;<a class="code" href="structuser.html#a688799bff398633f247e35a105013ac3">profile</a> = profile; <span class="comment">/* already ref counted by find_profile */</span>
<a name="l00855"></a>00855 
<a name="l00856"></a>00856    <span class="keywordflow">return</span> user;
<a name="l00857"></a>00857 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a624c63d6184a3f4c015f743eba369f12"></a><!-- doxytag: member="res_phoneprov.c::build_user_routes" ref="a624c63d6184a3f4c015f743eba369f12" args="(struct user *user)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int build_user_routes </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structuser.html">user</a> *&nbsp;</td>
          <td class="paramname"> <em>user</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add an http route for dynamic files attached to the profile of the <a class="el" href="structuser.html" title="structure to hold users read from users.conf">user</a>. </p>

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00897">897</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00420">AST_LIST_FIRST</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="res__phoneprov_8c_source.html#l00556">build_route()</a>, <a class="el" href="structphone__profile.html#a25fc7f04be8b6ea66317503640ec8794">phone_profile::dynamic_files</a>, <a class="el" href="structuser.html#a33ffb23cb386d3228aa6164ded55c341">user::extensions</a>, <a class="el" href="res__phoneprov_8c_source.html#l00110">phoneprov_file::format</a>, <a class="el" href="pbx_8c_source.html#l03604">pbx_substitute_variables_varshead()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00140">user::profile</a>, and <a class="el" href="pbx_8c_source.html#l00729">VAR_BUF_SIZE</a>.</p>

<p>Referenced by <a class="el" href="res__phoneprov_8c_source.html#l00912">set_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00898"></a>00898 {
<a name="l00899"></a>00899    <span class="keyword">struct </span><a class="code" href="structphoneprov__file.html" title="structure to hold file data">phoneprov_file</a> *pp_file;
<a name="l00900"></a>00900 
<a name="l00901"></a>00901    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;user-&gt;<a class="code" href="structuser.html#a688799bff398633f247e35a105013ac3">profile</a>-&gt;<a class="code" href="structphone__profile.html#a25fc7f04be8b6ea66317503640ec8794">dynamic_files</a>, pp_file, <a class="code" href="structphoneprov__file.html#a3cb5ae061024852dc1c4a6cc30a46b72">entry</a>) {
<a name="l00902"></a>00902       <span class="keywordtype">char</span> expand_buf[<a class="code" href="pbx_8c.html#ae1761f6ffd7763505cd891d3314cd7e4">VAR_BUF_SIZE</a>] = { 0, };
<a name="l00903"></a>00903 
<a name="l00904"></a>00904       <a class="code" href="pbx_8h.html#a2b3355625306d4b98ca8047cd2245459">pbx_substitute_variables_varshead</a>(<a class="code" href="linkedlists_8h.html#adf1959c5c03a3a706da97ad2f49617e5" title="Returns the first entry contained in a list.">AST_LIST_FIRST</a>(&amp;user-&gt;<a class="code" href="structuser.html#a33ffb23cb386d3228aa6164ded55c341">extensions</a>)-&gt;headp, pp_file-&gt;<a class="code" href="structphoneprov__file.html#ade9ff13c4e32588783cb9cdeb92b8d93">format</a>, expand_buf, <span class="keyword">sizeof</span>(expand_buf));
<a name="l00905"></a>00905       <a class="code" href="res__phoneprov_8c.html#a2db9c7589efbc4119490d418f27bf675" title="Build a route structure and add it to the list of available http routes.">build_route</a>(pp_file, user, expand_buf);
<a name="l00906"></a>00906    }
<a name="l00907"></a>00907 
<a name="l00908"></a>00908    <span class="keywordflow">return</span> 0;
<a name="l00909"></a>00909 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a44b45903a5a6b50bcd11b446f7635ffc"></a><!-- doxytag: member="res_phoneprov.c::delete_extension" ref="a44b45903a5a6b50bcd11b446f7635ffc" args="(struct extension *exten)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structextension.html">extension</a>* delete_extension </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structextension.html">extension</a> *&nbsp;</td>
          <td class="paramname"> <em>exten</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00695">695</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="linkedlists_8h_source.html#l00817">AST_LIST_REMOVE_HEAD</a>, <a class="el" href="stringfields_8h_source.html#l00245">ast_string_field_free_memory</a>, <a class="el" href="chanvars_8c_source.html#l00059">ast_var_delete()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00131">extension::headp</a>, and <a class="el" href="ast__expr2f_8c_source.html#l00613">var</a>.</p>

<p>Referenced by <a class="el" href="res__phoneprov_8c_source.html#l00912">set_config()</a>, and <a class="el" href="res__phoneprov_8c_source.html#l00807">user_destructor()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00696"></a>00696 {
<a name="l00697"></a>00697    <span class="keyword">struct </span><a class="code" href="structast__var__t.html">ast_var_t</a> *<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>;
<a name="l00698"></a>00698    <span class="keywordflow">while</span> ((var = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(exten-&gt;<a class="code" href="structextension.html#abaa13b11d884cceb9a8b2aed58a2cc11">headp</a>, entries))) {
<a name="l00699"></a>00699       <a class="code" href="chanvars_8h.html#a52aaa758ed30031250c2d356b993c6d9">ast_var_delete</a>(var);
<a name="l00700"></a>00700    }
<a name="l00701"></a>00701    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(exten-&gt;<a class="code" href="structextension.html#abaa13b11d884cceb9a8b2aed58a2cc11">headp</a>);
<a name="l00702"></a>00702    <a class="code" href="stringfields_8h.html#abf60f862ae6a141d2f86a0f5e82792de" title="free all memory - to be called before destroying the object">ast_string_field_free_memory</a>(exten);
<a name="l00703"></a>00703 
<a name="l00704"></a>00704    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(exten);
<a name="l00705"></a>00705 
<a name="l00706"></a>00706    <span class="keywordflow">return</span> NULL;
<a name="l00707"></a>00707 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9a2102f5ce1bbef671a27b071df6d806"></a><!-- doxytag: member="res_phoneprov.c::delete_file" ref="a9a2102f5ce1bbef671a27b071df6d806" args="(struct phoneprov_file *file)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void delete_file </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structphoneprov__file.html">phoneprov_file</a> *&nbsp;</td>
          <td class="paramname"> <em>file</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00257">257</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>References <a class="el" href="stringfields_8h_source.html#l00245">ast_string_field_free_memory</a>, and <a class="el" href="astmm_8h_source.html#l00084">free</a>.</p>

<p>Referenced by <a class="el" href="res__phoneprov_8c_source.html#l00263">profile_destructor()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00258"></a>00258 {
<a name="l00259"></a>00259    <a class="code" href="stringfields_8h.html#abf60f862ae6a141d2f86a0f5e82792de" title="free all memory - to be called before destroying the object">ast_string_field_free_memory</a>(file);
<a name="l00260"></a>00260    <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(file);
<a name="l00261"></a>00261 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a97d13891245936affb35e4dfadcb25e8"></a><!-- doxytag: member="res_phoneprov.c::delete_profiles" ref="a97d13891245936affb35e4dfadcb25e8" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void delete_profiles </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Delete all phone profiles, freeing their memory. </p>

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l01074">1074</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>References <a class="el" href="astobj2_8c_source.html#l00795">ao2_iterator_destroy()</a>, <a class="el" href="astobj2_8c_source.html#l00780">ao2_iterator_init()</a>, <a class="el" href="astobj2_8h_source.html#l01120">ao2_iterator_next</a>, <a class="el" href="astobj2_8h_source.html#l00813">ao2_unlink</a>, and <a class="el" href="res__phoneprov_8c_source.html#l00226">unref_profile()</a>.</p>

<p>Referenced by <a class="el" href="res__phoneprov_8c_source.html#l01298">reload()</a>, and <a class="el" href="res__phoneprov_8c_source.html#l01271">unload_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01075"></a>01075 {
<a name="l01076"></a>01076    <span class="keyword">struct </span><a class="code" href="structao2__iterator.html" title="When we need to walk through a container, we use an ao2_iterator to keep track of...">ao2_iterator</a> i;
<a name="l01077"></a>01077    <span class="keyword">struct </span><a class="code" href="structphone__profile.html" title="structure to hold phone profiles read from phoneprov.conf">phone_profile</a> *profile;
<a name="l01078"></a>01078 
<a name="l01079"></a>01079    i = <a class="code" href="astobj2_8h.html#a288075de687152d297308ea1ea963edb" title="Create an iterator for a container.">ao2_iterator_init</a>(<a class="code" href="res__phoneprov_8c.html#aa1076cae3e9e8548ec08760e2cac64f8">profiles</a>, 0);
<a name="l01080"></a>01080    <span class="keywordflow">while</span> ((profile = <a class="code" href="astobj2_8h.html#a1cf2fe1aafd3cb9e613eb48535a37ad5">ao2_iterator_next</a>(&amp;i))) {
<a name="l01081"></a>01081       <a class="code" href="astobj2_8h.html#a1bd301bcff8b41c07adbecf93eb7dce7">ao2_unlink</a>(<a class="code" href="res__phoneprov_8c.html#aa1076cae3e9e8548ec08760e2cac64f8">profiles</a>, profile);
<a name="l01082"></a>01082       profile = <a class="code" href="res__phoneprov_8c.html#a3e90ce2ee41dc4e5efb73411c455f73d">unref_profile</a>(profile);
<a name="l01083"></a>01083    }
<a name="l01084"></a>01084    <a class="code" href="astobj2_8h.html#a62d5d9e9d0fa281168e6a08ef4a52450" title="Destroy a container iterator.">ao2_iterator_destroy</a>(&amp;i);
<a name="l01085"></a>01085 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa2a1b5e37b1426df4284c132cd785ef7"></a><!-- doxytag: member="res_phoneprov.c::delete_routes" ref="aa2a1b5e37b1426df4284c132cd785ef7" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void delete_routes </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Delete all http routes, freeing their memory. </p>

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l01060">1060</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>References <a class="el" href="astobj2_8c_source.html#l00795">ao2_iterator_destroy()</a>, <a class="el" href="astobj2_8c_source.html#l00780">ao2_iterator_init()</a>, <a class="el" href="astobj2_8h_source.html#l01120">ao2_iterator_next</a>, <a class="el" href="astobj2_8h_source.html#l00813">ao2_unlink</a>, and <a class="el" href="res__phoneprov_8c_source.html#l00282">unref_route()</a>.</p>

<p>Referenced by <a class="el" href="res__phoneprov_8c_source.html#l01298">reload()</a>, and <a class="el" href="res__phoneprov_8c_source.html#l01271">unload_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01061"></a>01061 {
<a name="l01062"></a>01062    <span class="keyword">struct </span><a class="code" href="structao2__iterator.html" title="When we need to walk through a container, we use an ao2_iterator to keep track of...">ao2_iterator</a> i;
<a name="l01063"></a>01063    <span class="keyword">struct </span><a class="code" href="structhttp__route.html" title="structure to hold http routes (valid URIs, and the files they link to)">http_route</a> *route;
<a name="l01064"></a>01064 
<a name="l01065"></a>01065    i = <a class="code" href="astobj2_8h.html#a288075de687152d297308ea1ea963edb" title="Create an iterator for a container.">ao2_iterator_init</a>(<a class="code" href="res__phoneprov_8c.html#a942fc912551220a86dc49f2fb79b756a">http_routes</a>, 0);
<a name="l01066"></a>01066    <span class="keywordflow">while</span> ((route = <a class="code" href="astobj2_8h.html#a1cf2fe1aafd3cb9e613eb48535a37ad5">ao2_iterator_next</a>(&amp;i))) {
<a name="l01067"></a>01067       <a class="code" href="astobj2_8h.html#a1bd301bcff8b41c07adbecf93eb7dce7">ao2_unlink</a>(<a class="code" href="res__phoneprov_8c.html#a942fc912551220a86dc49f2fb79b756a">http_routes</a>, route);
<a name="l01068"></a>01068       route = <a class="code" href="res__phoneprov_8c.html#a5ff17e8d1cc95b424aceff81e8f99ca6">unref_route</a>(route);
<a name="l01069"></a>01069    }
<a name="l01070"></a>01070    <a class="code" href="astobj2_8h.html#a62d5d9e9d0fa281168e6a08ef4a52450" title="Destroy a container iterator.">ao2_iterator_destroy</a>(&amp;i);
<a name="l01071"></a>01071 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ace322a3e8008af8b872b72770e97fa85"></a><!-- doxytag: member="res_phoneprov.c::delete_users" ref="ace322a3e8008af8b872b72770e97fa85" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void delete_users </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Delete all <a class="el" href="structusers.html" title="list of users found in the config file">users</a>. </p>

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00824">824</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>References <a class="el" href="astobj2_8c_source.html#l00795">ao2_iterator_destroy()</a>, <a class="el" href="astobj2_8c_source.html#l00780">ao2_iterator_init()</a>, <a class="el" href="astobj2_8h_source.html#l01120">ao2_iterator_next</a>, <a class="el" href="astobj2_8h_source.html#l00813">ao2_unlink</a>, and <a class="el" href="res__phoneprov_8c_source.html#l00775">unref_user()</a>.</p>

<p>Referenced by <a class="el" href="res__phoneprov_8c_source.html#l01298">reload()</a>, and <a class="el" href="res__phoneprov_8c_source.html#l01271">unload_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00825"></a>00825 {
<a name="l00826"></a>00826    <span class="keyword">struct </span><a class="code" href="structao2__iterator.html" title="When we need to walk through a container, we use an ao2_iterator to keep track of...">ao2_iterator</a> i;
<a name="l00827"></a>00827    <span class="keyword">struct </span><a class="code" href="structuser.html" title="structure to hold users read from users.conf">user</a> *<a class="code" href="structuser.html" title="structure to hold users read from users.conf">user</a>;
<a name="l00828"></a>00828 
<a name="l00829"></a>00829    i = <a class="code" href="astobj2_8h.html#a288075de687152d297308ea1ea963edb" title="Create an iterator for a container.">ao2_iterator_init</a>(<a class="code" href="structusers.html" title="list of users found in the config file">users</a>, 0);
<a name="l00830"></a>00830    <span class="keywordflow">while</span> ((user = <a class="code" href="astobj2_8h.html#a1cf2fe1aafd3cb9e613eb48535a37ad5">ao2_iterator_next</a>(&amp;i))) {
<a name="l00831"></a>00831       <a class="code" href="astobj2_8h.html#a1bd301bcff8b41c07adbecf93eb7dce7">ao2_unlink</a>(<a class="code" href="structusers.html" title="list of users found in the config file">users</a>, user);
<a name="l00832"></a>00832       user = <a class="code" href="res__phoneprov_8c.html#a61177e129b4f8b4a11498f33773ccc1b">unref_user</a>(user);
<a name="l00833"></a>00833    }
<a name="l00834"></a>00834    <a class="code" href="astobj2_8h.html#a62d5d9e9d0fa281168e6a08ef4a52450" title="Destroy a container iterator.">ao2_iterator_destroy</a>(&amp;i);
<a name="l00835"></a>00835 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1d73305eda3292c4133efe4940a1f2e3"></a><!-- doxytag: member="res_phoneprov.c::find_profile" ref="a1d73305eda3292c4133efe4940a1f2e3" args="(const char *name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structphone__profile.html">phone_profile</a>* find_profile </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Return a phone profile looked up by name. </p>

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00234">234</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00968">ao2_find</a>, <a class="el" href="res__phoneprov_8c_source.html#l00120">phone_profile::name</a>, and <a class="el" href="astobj2_8h_source.html#l00678">OBJ_POINTER</a>.</p>

<p>Referenced by <a class="el" href="res__phoneprov_8c_source.html#l00912">set_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00235"></a>00235 {
<a name="l00236"></a>00236    <span class="keyword">struct </span><a class="code" href="structphone__profile.html" title="structure to hold phone profiles read from phoneprov.conf">phone_profile</a> tmp = {
<a name="l00237"></a>00237       .name = <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>,
<a name="l00238"></a>00238    };
<a name="l00239"></a>00239 
<a name="l00240"></a>00240    <span class="keywordflow">return</span> <a class="code" href="astobj2_8h.html#a618587b42226725315b96db394b13673">ao2_find</a>(<a class="code" href="res__phoneprov_8c.html#aa1076cae3e9e8548ec08760e2cac64f8">profiles</a>, &amp;tmp, <a class="code" href="astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca32d49976aaebc093266f0b080f9c9a73">OBJ_POINTER</a>);
<a name="l00241"></a>00241 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9b8690d2eb6b2b070ee1faf3d0a1cb1f"></a><!-- doxytag: member="res_phoneprov.c::find_user" ref="a9b8690d2eb6b2b070ee1faf3d0a1cb1f" args="(const char *macaddress)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structuser.html">user</a>* find_user </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>macaddress</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Return a <a class="el" href="structuser.html" title="structure to hold users read from users.conf">user</a> looked up by name. </p>

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00783">783</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00968">ao2_find</a>, <a class="el" href="res__phoneprov_8c_source.html#l00139">user::macaddress</a>, and <a class="el" href="astobj2_8h_source.html#l00678">OBJ_POINTER</a>.</p>

<p>Referenced by <a class="el" href="res__phoneprov_8c_source.html#l01131">pp_each_extension_exec()</a>, and <a class="el" href="res__phoneprov_8c_source.html#l00912">set_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00784"></a>00784 {
<a name="l00785"></a>00785    <span class="keyword">struct </span><a class="code" href="structuser.html" title="structure to hold users read from users.conf">user</a> tmp = {
<a name="l00786"></a>00786       .macaddress = <a class="code" href="structuser.html#a43de8de44949a0033b3cbe2fbb3ae523">macaddress</a>,
<a name="l00787"></a>00787    };
<a name="l00788"></a>00788 
<a name="l00789"></a>00789    <span class="keywordflow">return</span> <a class="code" href="astobj2_8h.html#a618587b42226725315b96db394b13673">ao2_find</a>(<a class="code" href="structusers.html" title="list of users found in the config file">users</a>, &amp;tmp, <a class="code" href="astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca32d49976aaebc093266f0b080f9c9a73">OBJ_POINTER</a>);
<a name="l00790"></a>00790 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a87d229b8abd3637a00aaa1377bbd3392"></a><!-- doxytag: member="res_phoneprov.c::ftype2mtype" ref="a87d229b8abd3637a00aaa1377bbd3392" args="(const char *ftype)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* ftype2mtype </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>ftype</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Return mime type based on <a class="el" href="structextension.html">extension</a>. </p>

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00180">180</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="http_8c_source.html#l00097">ext</a>, <a class="el" href="res__phoneprov_8c.html#a1fcea5c467a2309e3c4f2ca36c0dde06">mimetypes</a>, and <a class="el" href="http_8c_source.html#l00098">mtype</a>.</p>

<p>Referenced by <a class="el" href="res__phoneprov_8c_source.html#l00583">build_profile()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00181"></a>00181 {
<a name="l00182"></a>00182    <span class="keywordtype">int</span> x;
<a name="l00183"></a>00183 
<a name="l00184"></a>00184    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(ftype))
<a name="l00185"></a>00185       <span class="keywordflow">return</span> NULL;
<a name="l00186"></a>00186 
<a name="l00187"></a>00187    <span class="keywordflow">for</span> (x = 0;x &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="res__phoneprov_8c.html#a1fcea5c467a2309e3c4f2ca36c0dde06" title="Extensions whose mime types we think we know.">mimetypes</a>);x++) {
<a name="l00188"></a>00188       <span class="keywordflow">if</span> (!strcasecmp(ftype, <a class="code" href="res__phoneprov_8c.html#a1fcea5c467a2309e3c4f2ca36c0dde06" title="Extensions whose mime types we think we know.">mimetypes</a>[x].<a class="code" href="http_8c.html#af9b32121c4ad80b0887a3d73fd24de5f">ext</a>))
<a name="l00189"></a>00189          <span class="keywordflow">return</span> <a class="code" href="res__phoneprov_8c.html#a1fcea5c467a2309e3c4f2ca36c0dde06" title="Extensions whose mime types we think we know.">mimetypes</a>[x].<a class="code" href="http_8c.html#a3189f2c804f88ece5a83d4772e11ff9e">mtype</a>;
<a name="l00190"></a>00190    }
<a name="l00191"></a>00191 
<a name="l00192"></a>00192    <span class="keywordflow">return</span> NULL;
<a name="l00193"></a>00193 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a48654ad7e70178777fa21bd6f8b9b7ba"></a><!-- doxytag: member="res_phoneprov.c::handle_show_routes" ref="a48654ad7e70178777fa21bd6f8b9b7ba" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* handle_show_routes </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>CLI command to list static and dynamic routes. </p>

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l01193">1193</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>References <a class="el" href="astobj2_8c_source.html#l00795">ao2_iterator_destroy()</a>, <a class="el" href="astobj2_8c_source.html#l00780">ao2_iterator_init()</a>, <a class="el" href="astobj2_8h_source.html#l01120">ao2_iterator_next</a>, <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, <a class="el" href="res__phoneprov_8c_source.html#l00149">http_route::file</a>, <a class="el" href="chan__dahdi_8c.html#ac8dc47e3b39c930caed4bfd05b4ba805">FORMAT</a>, <a class="el" href="res__phoneprov_8c_source.html#l00110">phoneprov_file::template</a>, <a class="el" href="res__phoneprov_8c_source.html#l00282">unref_route()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00148">http_route::uri</a>, <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>, and <a class="el" href="res__phoneprov_8c_source.html#l00150">http_route::user</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01194"></a>01194 {
<a name="l01195"></a>01195 <span class="preprocessor">#define FORMAT &quot;%-40.40s  %-30.30s\n&quot;</span>
<a name="l01196"></a>01196 <span class="preprocessor"></span>   <span class="keyword">struct </span><a class="code" href="structao2__iterator.html" title="When we need to walk through a container, we use an ao2_iterator to keep track of...">ao2_iterator</a> i;
<a name="l01197"></a>01197    <span class="keyword">struct </span><a class="code" href="structhttp__route.html" title="structure to hold http routes (valid URIs, and the files they link to)">http_route</a> *route;
<a name="l01198"></a>01198 
<a name="l01199"></a>01199    <span class="keywordflow">switch</span>(cmd) {
<a name="l01200"></a>01200    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l01201"></a>01201       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;phoneprov show routes&quot;</span>;
<a name="l01202"></a>01202       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l01203"></a>01203          <span class="stringliteral">&quot;Usage: phoneprov show routes\n&quot;</span>
<a name="l01204"></a>01204          <span class="stringliteral">&quot;       Lists all registered phoneprov http routes.\n&quot;</span>;
<a name="l01205"></a>01205       <span class="keywordflow">return</span> NULL;
<a name="l01206"></a>01206    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l01207"></a>01207       <span class="keywordflow">return</span> NULL;
<a name="l01208"></a>01208    }
<a name="l01209"></a>01209 
<a name="l01210"></a>01210    <span class="comment">/* This currently iterates over routes twice, but it is the only place I&apos;ve needed</span>
<a name="l01211"></a>01211 <span class="comment">    * to really separate static an dynamic routes, so I&apos;ve just left it this way. */</span>
<a name="l01212"></a>01212    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Static routes\n\n&quot;</span>);
<a name="l01213"></a>01213    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, FORMAT, <span class="stringliteral">&quot;Relative URI&quot;</span>, <span class="stringliteral">&quot;Physical location&quot;</span>);
<a name="l01214"></a>01214    i = <a class="code" href="astobj2_8h.html#a288075de687152d297308ea1ea963edb" title="Create an iterator for a container.">ao2_iterator_init</a>(<a class="code" href="res__phoneprov_8c.html#a942fc912551220a86dc49f2fb79b756a">http_routes</a>, 0);
<a name="l01215"></a>01215    <span class="keywordflow">while</span> ((route = <a class="code" href="astobj2_8h.html#a1cf2fe1aafd3cb9e613eb48535a37ad5">ao2_iterator_next</a>(&amp;i))) {
<a name="l01216"></a>01216       <span class="keywordflow">if</span> (!route-&gt;<a class="code" href="structhttp__route.html#a9071a284c9522ce89ae8c0d0544004e3">user</a>)
<a name="l01217"></a>01217          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, FORMAT, route-&gt;<a class="code" href="structhttp__route.html#a19ac71226fac09e87afe31acb4c99214">uri</a>, route-&gt;<a class="code" href="structhttp__route.html#a742f7871dc582416bad82b87a1794abf">file</a>-&gt;<a class="code" href="structphoneprov__file.html#a96ba7503bd59fb6022d77eb5d029f4ff">template</a>);
<a name="l01218"></a>01218       route = <a class="code" href="res__phoneprov_8c.html#a5ff17e8d1cc95b424aceff81e8f99ca6">unref_route</a>(route);
<a name="l01219"></a>01219    }
<a name="l01220"></a>01220    <a class="code" href="astobj2_8h.html#a62d5d9e9d0fa281168e6a08ef4a52450" title="Destroy a container iterator.">ao2_iterator_destroy</a>(&amp;i);
<a name="l01221"></a>01221 
<a name="l01222"></a>01222    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;\nDynamic routes\n\n&quot;</span>);
<a name="l01223"></a>01223    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, FORMAT, <span class="stringliteral">&quot;Relative URI&quot;</span>, <span class="stringliteral">&quot;Template&quot;</span>);
<a name="l01224"></a>01224 
<a name="l01225"></a>01225    i = <a class="code" href="astobj2_8h.html#a288075de687152d297308ea1ea963edb" title="Create an iterator for a container.">ao2_iterator_init</a>(<a class="code" href="res__phoneprov_8c.html#a942fc912551220a86dc49f2fb79b756a">http_routes</a>, 0);
<a name="l01226"></a>01226    <span class="keywordflow">while</span> ((route = <a class="code" href="astobj2_8h.html#a1cf2fe1aafd3cb9e613eb48535a37ad5">ao2_iterator_next</a>(&amp;i))) {
<a name="l01227"></a>01227       <span class="keywordflow">if</span> (route-&gt;<a class="code" href="structhttp__route.html#a9071a284c9522ce89ae8c0d0544004e3">user</a>)
<a name="l01228"></a>01228          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, FORMAT, route-&gt;<a class="code" href="structhttp__route.html#a19ac71226fac09e87afe31acb4c99214">uri</a>, route-&gt;<a class="code" href="structhttp__route.html#a742f7871dc582416bad82b87a1794abf">file</a>-&gt;<a class="code" href="structphoneprov__file.html#a96ba7503bd59fb6022d77eb5d029f4ff">template</a>);
<a name="l01229"></a>01229       route = <a class="code" href="res__phoneprov_8c.html#a5ff17e8d1cc95b424aceff81e8f99ca6">unref_route</a>(route);
<a name="l01230"></a>01230    }
<a name="l01231"></a>01231    <a class="code" href="astobj2_8h.html#a62d5d9e9d0fa281168e6a08ef4a52450" title="Destroy a container iterator.">ao2_iterator_destroy</a>(&amp;i);
<a name="l01232"></a>01232 
<a name="l01233"></a>01233    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l01234"></a>01234 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a04c6ab3149590b7a80b7599645ce220c"></a><!-- doxytag: member="res_phoneprov.c::load_file" ref="a04c6ab3149590b7a80b7599645ce220c" args="(const char *filename, char **ret)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int load_file </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>filename</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&nbsp;</td>
          <td class="paramname"> <em>ret</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Read a TEXT file into a string and return the length. </p>

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00311">311</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00081">ast_malloc</a>, <a class="el" href="format__g726_8c_source.html#l00177">f</a>, <a class="el" href="astmm_8h_source.html#l00084">free</a>, and <a class="el" href="func__strings_8c_source.html#l00821">len()</a>.</p>

<p>Referenced by <a class="el" href="res__phoneprov_8c_source.html#l00401">phoneprov_callback()</a>, and <a class="el" href="res__phoneprov_8c_source.html#l01131">pp_each_extension_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00312"></a>00312 {
<a name="l00313"></a>00313    <span class="keywordtype">int</span> <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> = 0;
<a name="l00314"></a>00314    FILE *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l00315"></a>00315 
<a name="l00316"></a>00316    <span class="keywordflow">if</span> (!(f = fopen(filename, <span class="stringliteral">&quot;r&quot;</span>))) {
<a name="l00317"></a>00317       *ret = NULL;
<a name="l00318"></a>00318       <span class="keywordflow">return</span> -1;
<a name="l00319"></a>00319    }
<a name="l00320"></a>00320 
<a name="l00321"></a>00321    fseek(f, 0, SEEK_END);
<a name="l00322"></a>00322    len = ftell(f);
<a name="l00323"></a>00323    fseek(f, 0, SEEK_SET);
<a name="l00324"></a>00324    <span class="keywordflow">if</span> (!(*ret = <a class="code" href="astmm_8h.html#a64a0e7a3ab511a3777ac56f5d43c628e">ast_malloc</a>(len + 1)))
<a name="l00325"></a>00325       <span class="keywordflow">return</span> -2;
<a name="l00326"></a>00326 
<a name="l00327"></a>00327    <span class="keywordflow">if</span> (len != fread(*ret, <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>), len, f)) {
<a name="l00328"></a>00328       <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(*ret);
<a name="l00329"></a>00329       *ret = NULL;
<a name="l00330"></a>00330       <span class="keywordflow">return</span> -3;
<a name="l00331"></a>00331    }
<a name="l00332"></a>00332 
<a name="l00333"></a>00333    fclose(f);
<a name="l00334"></a>00334 
<a name="l00335"></a>00335    (*ret)[len] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00336"></a>00336 
<a name="l00337"></a>00337    <span class="keywordflow">return</span> len;
<a name="l00338"></a>00338 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac3382bf6da54c56b37069bd76bbdf4f9"></a><!-- doxytag: member="res_phoneprov.c::load_module" ref="ac3382bf6da54c56b37069bd76bbdf4f9" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int load_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l01250">1250</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00727">ao2_container_alloc</a>, <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="cli_8c_source.html#l01927">ast_cli_register_multiple()</a>, <a class="el" href="pbx_8h_source.html#l01028">ast_custom_function_register</a>, <a class="el" href="http_8c_source.html#l00344">ast_http_uri_link()</a>, <a class="el" href="linkedlists_8h_source.html#l00665">AST_LIST_HEAD_INIT_NOLOCK</a>, <a class="el" href="lock_8h_source.html#l01692">ast_mutex_init()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00176">global_variables</a>, <a class="el" href="res__phoneprov_8c_source.html#l00061">MAX_PROFILE_BUCKETS</a>, <a class="el" href="res__phoneprov_8c_source.html#l00062">MAX_ROUTE_BUCKETS</a>, <a class="el" href="chan__iax2_8c_source.html#l00830">MAX_USER_BUCKETS</a>, <a class="el" href="res__phoneprov_8c_source.html#l00250">profile_cmp_fn()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00243">profile_hash_fn()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00296">routes_cmp_fn()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00289">routes_hash_fn()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00912">set_config()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00799">users_cmp_fn()</a>, and <a class="el" href="res__phoneprov_8c_source.html#l00792">users_hash_fn()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01251"></a>01251 {
<a name="l01252"></a>01252    <a class="code" href="res__phoneprov_8c.html#aa1076cae3e9e8548ec08760e2cac64f8">profiles</a> = <a class="code" href="astobj2_8h.html#a82534c91be59ec9a3d3318ec85ac5695">ao2_container_alloc</a>(<a class="code" href="res__phoneprov_8c.html#a12277aa03a4c963e247eb4670e6751c0">MAX_PROFILE_BUCKETS</a>, <a class="code" href="res__phoneprov_8c.html#a1cb6ea28a5ce8cf589e43a5a3460b7ae">profile_hash_fn</a>, <a class="code" href="res__phoneprov_8c.html#aebc1bffc0df046bcff4d2a0473ada3fd">profile_cmp_fn</a>);
<a name="l01253"></a>01253 
<a name="l01254"></a>01254    <a class="code" href="res__phoneprov_8c.html#a942fc912551220a86dc49f2fb79b756a">http_routes</a> = <a class="code" href="astobj2_8h.html#a82534c91be59ec9a3d3318ec85ac5695">ao2_container_alloc</a>(<a class="code" href="res__phoneprov_8c.html#a0d556e8c0c8f8b8c66da39183bec2d72">MAX_ROUTE_BUCKETS</a>, <a class="code" href="res__phoneprov_8c.html#a700f9c2b8d1dae3755239792b7acf813">routes_hash_fn</a>, <a class="code" href="res__phoneprov_8c.html#aea36e776c24e08f24ce107158d178aa5">routes_cmp_fn</a>);
<a name="l01255"></a>01255 
<a name="l01256"></a>01256    <a class="code" href="structusers.html" title="list of users found in the config file">users</a> = <a class="code" href="astobj2_8h.html#a82534c91be59ec9a3d3318ec85ac5695">ao2_container_alloc</a>(<a class="code" href="chan__iax2_8c.html#a0093d2299b135a3be5d1e7775f2af02d">MAX_USER_BUCKETS</a>, <a class="code" href="res__phoneprov_8c.html#a4d703ea2245933e511f79e52c7c349aa">users_hash_fn</a>, <a class="code" href="res__phoneprov_8c.html#a14b35d5095ca99ff94af78bc1c32a5f3">users_cmp_fn</a>);
<a name="l01257"></a>01257 
<a name="l01258"></a>01258    <a class="code" href="linkedlists_8h.html#a0d1f922e093ac18824a7863fe3f5fa27" title="Initializes a list head structure.">AST_LIST_HEAD_INIT_NOLOCK</a>(&amp;<a class="code" href="res__phoneprov_8c.html#a99146593ce920142bad553c2180d0f17" title="List of global variables currently available: VOICEMAIL_EXTEN, EXTENSION_LENGTH.">global_variables</a>);
<a name="l01259"></a>01259    <a class="code" href="lock_8h.html#a5dc895fe6e8c089175159fc22e33fc3b">ast_mutex_init</a>(&amp;<a class="code" href="res__phoneprov_8c.html#ac5e1d00d9d447cc961b9e31a34a96507">globals_lock</a>);
<a name="l01260"></a>01260 
<a name="l01261"></a>01261    <a class="code" href="pbx_8h.html#a8af0e93442a9e468425f63cc52b0ac7b" title="Register a custom function.">ast_custom_function_register</a>(&amp;<a class="code" href="res__phoneprov_8c.html#a4aba47037e53722c9cb9dd97917ac956">pp_each_user_function</a>);
<a name="l01262"></a>01262    <a class="code" href="pbx_8h.html#a8af0e93442a9e468425f63cc52b0ac7b" title="Register a custom function.">ast_custom_function_register</a>(&amp;<a class="code" href="res__phoneprov_8c.html#a4028ff03143c2036f9b6db585e3ba4ab">pp_each_extension_function</a>);
<a name="l01263"></a>01263    <a class="code" href="cli_8h.html#aadeef34f3106bb78aeb3414032ad7fb7" title="Register multiple commands.">ast_cli_register_multiple</a>(<a class="code" href="res__phoneprov_8c.html#a498b3e866e88c552efa0af7fe6a5b653">pp_cli</a>, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="res__phoneprov_8c.html#a498b3e866e88c552efa0af7fe6a5b653">pp_cli</a>));
<a name="l01264"></a>01264 
<a name="l01265"></a>01265    <a class="code" href="res__phoneprov_8c.html#a6658fcbb66219eff8bf475a2092fa06d">set_config</a>();
<a name="l01266"></a>01266    <a class="code" href="http_8h.html#ac99d56925cf94f8cf3ed0acac52e2d75" title="Register a URI handler.">ast_http_uri_link</a>(&amp;<a class="code" href="res__phoneprov_8c.html#a9ada7959089cbf06e161d25b89590066">phoneprovuri</a>);
<a name="l01267"></a>01267 
<a name="l01268"></a>01268    <span class="keywordflow">return</span> 0;
<a name="l01269"></a>01269 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a954fe3261258e2a0cf96cbbf598c2935"></a><!-- doxytag: member="res_phoneprov.c::lookup_iface" ref="a954fe3261258e2a0cf96cbbf598c2935" args="(const char *iface, struct in_addr *address)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int lookup_iface </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>iface</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct in_addr *&nbsp;</td>
          <td class="paramname"> <em>address</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00196">196</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>References <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, and <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>.</p>

<p>Referenced by <a class="el" href="res__phoneprov_8c_source.html#l00912">set_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00197"></a>00197 {
<a name="l00198"></a>00198    <span class="keywordtype">int</span> mysock, res = 0;
<a name="l00199"></a>00199    <span class="keyword">struct </span>ifreq ifr;
<a name="l00200"></a>00200    <span class="keyword">struct </span>sockaddr_in *sin;
<a name="l00201"></a>00201 
<a name="l00202"></a>00202    memset(&amp;ifr, 0, <span class="keyword">sizeof</span>(ifr));
<a name="l00203"></a>00203    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(ifr.ifr_name, iface, <span class="keyword">sizeof</span>(ifr.ifr_name));
<a name="l00204"></a>00204 
<a name="l00205"></a>00205    mysock = socket(PF_INET, SOCK_DGRAM, IPPROTO_IP);
<a name="l00206"></a>00206    <span class="keywordflow">if</span> (mysock &lt; 0) {
<a name="l00207"></a>00207       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to create socket: %s\n&quot;</span>, strerror(errno));
<a name="l00208"></a>00208       <span class="keywordflow">return</span> -1;
<a name="l00209"></a>00209    }
<a name="l00210"></a>00210 
<a name="l00211"></a>00211    res = ioctl(mysock, SIOCGIFADDR, &amp;ifr);
<a name="l00212"></a>00212 
<a name="l00213"></a>00213    close(mysock);
<a name="l00214"></a>00214 
<a name="l00215"></a>00215    <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l00216"></a>00216       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to get IP of %s: %s\n&quot;</span>, iface, strerror(errno));
<a name="l00217"></a>00217       memcpy(address, &amp;<a class="code" href="res__phoneprov_8c.html#a1d084b82cb21102ba46ea60d3cd9c085" title="for use in lookup_iface">__ourip</a>, <span class="keyword">sizeof</span>(<a class="code" href="res__phoneprov_8c.html#a1d084b82cb21102ba46ea60d3cd9c085" title="for use in lookup_iface">__ourip</a>));
<a name="l00218"></a>00218       <span class="keywordflow">return</span> -1;
<a name="l00219"></a>00219    } <span class="keywordflow">else</span> {
<a name="l00220"></a>00220       sin = (<span class="keyword">struct </span>sockaddr_in *)&amp;ifr.ifr_addr;
<a name="l00221"></a>00221       memcpy(address, &amp;sin-&gt;sin_addr, <span class="keyword">sizeof</span>(*address));
<a name="l00222"></a>00222       <span class="keywordflow">return</span> 0;
<a name="l00223"></a>00223    }
<a name="l00224"></a>00224 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4bdf3ab552242e47cb7b4368f9b36af6"></a><!-- doxytag: member="res_phoneprov.c::phoneprov_callback" ref="a4bdf3ab552242e47cb7b4368f9b36af6" args="(struct ast_tcptls_session_instance *ser, const struct ast_http_uri *urih, const char *uri, enum ast_http_method method, struct ast_variable *vars, struct ast_variable *headers, int *status, char **title, int *contentlength)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__str.html">ast_str</a>* phoneprov_callback </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__tcptls__session__instance.html">ast_tcptls_session_instance</a> *&nbsp;</td>
          <td class="paramname"> <em>ser</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structast__http__uri.html">ast_http_uri</a> *&nbsp;</td>
          <td class="paramname"> <em>urih</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>uri</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="http_8h.html#a16fb43ed7e6093a9dc96477ba37b80ef">ast_http_method</a>&nbsp;</td>
          <td class="paramname"> <em>method</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__variable.html">ast_variable</a> *&nbsp;</td>
          <td class="paramname"> <em>vars</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__variable.html">ast_variable</a> *&nbsp;</td>
          <td class="paramname"> <em>headers</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>status</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&nbsp;</td>
          <td class="paramname"> <em>title</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>contentlength</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Callback that is executed everytime an http request is received by this module. </p>

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00401">401</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00968">ao2_find</a>, <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="asterisk_8c_source.html#l00254">ast_config_AST_DATA_DIR</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="version_8c_source.html#l00014">ast_get_version()</a>, <a class="el" href="http_8c_source.html#l00309">ast_http_error()</a>, <a class="el" href="utils_8c_source.html#l00431">ast_inet_ntoa()</a>, <a class="el" href="linkedlists_8h_source.html#l00420">AST_LIST_FIRST</a>, <a class="el" href="linkedlists_8h_source.html#l00715">AST_LIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="localtime_8c_source.html#l01305">ast_localtime()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="strings_8h_source.html#l00846">ast_str_append()</a>, <a class="el" href="strings_8h_source.html#l00415">ast_str_create()</a>, <a class="el" href="localtime_8c_source.html#l01928">ast_strftime()</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="chanvars_8c_source.html#l00037">ast_var_assign()</a>, <a class="el" href="adsistub_8c_source.html#l00059">buf</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="structuser.html#a33ffb23cb386d3228aa6164ded55c341">user::extensions</a>, <a class="el" href="tcptls_8h_source.html#l00134">ast_tcptls_session_instance::f</a>, <a class="el" href="tcptls_8h_source.html#l00135">ast_tcptls_session_instance::fd</a>, <a class="el" href="res__phoneprov_8c_source.html#l00149">http_route::file</a>, <a class="el" href="ast__expr2f_8c_source.html#l00563">fwrite</a>, <a class="el" href="res__phoneprov_8c_source.html#l00131">extension::headp</a>, <a class="el" href="func__strings_8c_source.html#l00821">len()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00311">load_file()</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="res__phoneprov_8c_source.html#l00110">phoneprov_file::mime_type</a>, <a class="el" href="cdr__adaptive__odbc_8c_source.html#l00053">name</a>, <a class="el" href="astobj2_8h_source.html#l00678">OBJ_POINTER</a>, <a class="el" href="pbx_8c_source.html#l03604">pbx_substitute_variables_varshead()</a>, <a class="el" href="astmm_8h_source.html#l00096">strdup</a>, <a class="el" href="res__phoneprov_8c_source.html#l00110">phoneprov_file::template</a>, <a class="el" href="res__phoneprov_8c_source.html#l00282">unref_route()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00148">http_route::uri</a>, <a class="el" href="res__phoneprov_8c_source.html#l00150">http_route::user</a>, <a class="el" href="ast__expr2f_8c_source.html#l00613">var</a>, and <a class="el" href="pbx_8c_source.html#l00729">VAR_BUF_SIZE</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00402"></a>00402 {
<a name="l00403"></a>00403    <span class="keyword">struct </span><a class="code" href="structhttp__route.html" title="structure to hold http routes (valid URIs, and the files they link to)">http_route</a> *route;
<a name="l00404"></a>00404    <span class="keyword">struct </span><a class="code" href="structhttp__route.html" title="structure to hold http routes (valid URIs, and the files they link to)">http_route</a> search_route = {
<a name="l00405"></a>00405       .uri = <a class="code" href="structhttp__route.html#a19ac71226fac09e87afe31acb4c99214">uri</a>,
<a name="l00406"></a>00406    };
<a name="l00407"></a>00407    <span class="keyword">struct </span><a class="code" href="structast__str.html" title="The descriptor of a dynamic string XXX storage will be optimized later if needed...">ast_str</a> *result = <a class="code" href="strings_8h.html#a8ec37e4acb6ecb20eb6f6edd1141cd76" title="Create a malloc&amp;#39;ed dynamic length string.">ast_str_create</a>(512);
<a name="l00408"></a>00408    <span class="keywordtype">char</span> path[PATH_MAX];
<a name="l00409"></a>00409    <span class="keywordtype">char</span> *file = NULL;
<a name="l00410"></a>00410    <span class="keywordtype">int</span> <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>;
<a name="l00411"></a>00411    <span class="keywordtype">int</span> fd;
<a name="l00412"></a>00412    <span class="keywordtype">char</span> <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[256];
<a name="l00413"></a>00413    <span class="keyword">struct </span>timeval now = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l00414"></a>00414    <span class="keyword">struct </span><a class="code" href="structast__tm.html">ast_tm</a> tm;
<a name="l00415"></a>00415 
<a name="l00416"></a>00416    <span class="keywordflow">if</span> (!(route = <a class="code" href="astobj2_8h.html#a618587b42226725315b96db394b13673">ao2_find</a>(<a class="code" href="res__phoneprov_8c.html#a942fc912551220a86dc49f2fb79b756a">http_routes</a>, &amp;search_route, <a class="code" href="astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca32d49976aaebc093266f0b080f9c9a73">OBJ_POINTER</a>))) {
<a name="l00417"></a>00417       <span class="keywordflow">goto</span> out404;
<a name="l00418"></a>00418    }
<a name="l00419"></a>00419 
<a name="l00420"></a>00420    snprintf(path, <span class="keyword">sizeof</span>(path), <span class="stringliteral">&quot;%s/phoneprov/%s&quot;</span>, <a class="code" href="paths_8h.html#a63af4213b5b83f717398d8d62008a50d">ast_config_AST_DATA_DIR</a>, route-&gt;<a class="code" href="structhttp__route.html#a742f7871dc582416bad82b87a1794abf">file</a>-&gt;<a class="code" href="structphoneprov__file.html#a96ba7503bd59fb6022d77eb5d029f4ff">template</a>);
<a name="l00421"></a>00421 
<a name="l00422"></a>00422    <span class="keywordflow">if</span> (!route-&gt;<a class="code" href="structhttp__route.html#a9071a284c9522ce89ae8c0d0544004e3">user</a>) { <span class="comment">/* Static file */</span>
<a name="l00423"></a>00423 
<a name="l00424"></a>00424       fd = open(path, O_RDONLY);
<a name="l00425"></a>00425       <span class="keywordflow">if</span> (fd &lt; 0) {
<a name="l00426"></a>00426          <span class="keywordflow">goto</span> out500;
<a name="l00427"></a>00427       }
<a name="l00428"></a>00428 
<a name="l00429"></a>00429       len = lseek(fd, 0, SEEK_END);
<a name="l00430"></a>00430       lseek(fd, 0, SEEK_SET);
<a name="l00431"></a>00431       <span class="keywordflow">if</span> (len &lt; 0) {
<a name="l00432"></a>00432          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not load file: %s (%d)\n&quot;</span>, path, len);
<a name="l00433"></a>00433          close(fd);
<a name="l00434"></a>00434          <span class="keywordflow">goto</span> out500;
<a name="l00435"></a>00435       }
<a name="l00436"></a>00436 
<a name="l00437"></a>00437       <a class="code" href="localtime_8h.html#aa8e63928b14a347bd3973d680b885f93" title="Special version of strftime(3) that handles fractions of a second. Takes the same...">ast_strftime</a>(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;%a, %d %b %Y %H:%M:%S %Z&quot;</span>, <a class="code" href="localtime_8h.html#ae9fbda728350a9a5b9c09b29214d718e" title="Timezone-independent version of localtime_r(3).">ast_localtime</a>(&amp;now, &amp;tm, <span class="stringliteral">&quot;GMT&quot;</span>));
<a name="l00438"></a>00438       fprintf(ser-&gt;<a class="code" href="structast__tcptls__session__instance.html#a3efb0e1a16208deecbd84c15401f7cf8">f</a>, <span class="stringliteral">&quot;HTTP/1.1 200 OK\r\n&quot;</span>
<a name="l00439"></a>00439          <span class="stringliteral">&quot;Server: Asterisk/%s\r\n&quot;</span>
<a name="l00440"></a>00440          <span class="stringliteral">&quot;Date: %s\r\n&quot;</span>
<a name="l00441"></a>00441          <span class="stringliteral">&quot;Connection: close\r\n&quot;</span>
<a name="l00442"></a>00442          <span class="stringliteral">&quot;Cache-Control: no-cache, no-store\r\n&quot;</span>
<a name="l00443"></a>00443          <span class="stringliteral">&quot;Content-Length: %d\r\n&quot;</span>
<a name="l00444"></a>00444          <span class="stringliteral">&quot;Content-Type: %s\r\n\r\n&quot;</span>,
<a name="l00445"></a>00445          <a class="code" href="ast__version_8h.html#a7765c608aea948584928643ab3963b2a" title="Retrieve the Asterisk version string.">ast_get_version</a>(), buf, len, route-&gt;<a class="code" href="structhttp__route.html#a742f7871dc582416bad82b87a1794abf">file</a>-&gt;<a class="code" href="structphoneprov__file.html#a1451e38b2748f8664868291254533673">mime_type</a>);
<a name="l00446"></a>00446 
<a name="l00447"></a>00447       <span class="keywordflow">while</span> ((len = read(fd, buf, <span class="keyword">sizeof</span>(buf))) &gt; 0) {
<a name="l00448"></a>00448          <span class="keywordflow">if</span> (<a class="code" href="ast__expr2f_8c.html#a8541b986268a39ba1b07d9e912d31732">fwrite</a>(buf, 1, len, ser-&gt;<a class="code" href="structast__tcptls__session__instance.html#a3efb0e1a16208deecbd84c15401f7cf8">f</a>) != len) {
<a name="l00449"></a>00449             <span class="keywordflow">if</span> (errno != EPIPE) {
<a name="l00450"></a>00450                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;fwrite() failed: %s\n&quot;</span>, strerror(errno));
<a name="l00451"></a>00451             } <span class="keywordflow">else</span> {
<a name="l00452"></a>00452                <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(3, <span class="stringliteral">&quot;Requester closed the connection while downloading &apos;%s&apos;\n&quot;</span>, path);
<a name="l00453"></a>00453             }
<a name="l00454"></a>00454             <span class="keywordflow">break</span>;
<a name="l00455"></a>00455          }
<a name="l00456"></a>00456       }
<a name="l00457"></a>00457 
<a name="l00458"></a>00458       close(fd);
<a name="l00459"></a>00459       route = <a class="code" href="res__phoneprov_8c.html#a5ff17e8d1cc95b424aceff81e8f99ca6">unref_route</a>(route);
<a name="l00460"></a>00460       <span class="keywordflow">return</span> NULL;
<a name="l00461"></a>00461    } <span class="keywordflow">else</span> { <span class="comment">/* Dynamic file */</span>
<a name="l00462"></a>00462       <span class="keywordtype">int</span> bufsize;
<a name="l00463"></a>00463       <span class="keywordtype">char</span> *tmp;
<a name="l00464"></a>00464 
<a name="l00465"></a>00465       len = <a class="code" href="res__phoneprov_8c.html#a04c6ab3149590b7a80b7599645ce220c" title="Read a TEXT file into a string and return the length.">load_file</a>(path, &amp;file);
<a name="l00466"></a>00466       <span class="keywordflow">if</span> (len &lt; 0) {
<a name="l00467"></a>00467          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not load file: %s (%d)\n&quot;</span>, path, len);
<a name="l00468"></a>00468          <span class="keywordflow">if</span> (file) {
<a name="l00469"></a>00469             <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(file);
<a name="l00470"></a>00470          }
<a name="l00471"></a>00471 
<a name="l00472"></a>00472          <span class="keywordflow">goto</span> out500;
<a name="l00473"></a>00473       }
<a name="l00474"></a>00474 
<a name="l00475"></a>00475       <span class="keywordflow">if</span> (!file) {
<a name="l00476"></a>00476          <span class="keywordflow">goto</span> out500;
<a name="l00477"></a>00477       }
<a name="l00478"></a>00478 
<a name="l00479"></a>00479       <span class="comment">/* XXX This is a hack -- maybe sum length of all variables in route-&gt;user-&gt;headp and add that? */</span>
<a name="l00480"></a>00480       bufsize = len + <a class="code" href="pbx_8c.html#ae1761f6ffd7763505cd891d3314cd7e4">VAR_BUF_SIZE</a>;
<a name="l00481"></a>00481 
<a name="l00482"></a>00482       <span class="comment">/* malloc() instead of alloca() here, just in case the file is bigger than</span>
<a name="l00483"></a>00483 <span class="comment">       * we have enough stack space for. */</span>
<a name="l00484"></a>00484       <span class="keywordflow">if</span> (!(tmp = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, bufsize))) {
<a name="l00485"></a>00485          <span class="keywordflow">if</span> (file) {
<a name="l00486"></a>00486             <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(file);
<a name="l00487"></a>00487          }
<a name="l00488"></a>00488 
<a name="l00489"></a>00489          <span class="keywordflow">goto</span> out500;
<a name="l00490"></a>00490       }
<a name="l00491"></a>00491 
<a name="l00492"></a>00492       <span class="comment">/* Unless we are overridden by serveriface or serveraddr, we set the SERVER variable to</span>
<a name="l00493"></a>00493 <span class="comment">       * the IP address we are listening on that the phone contacted for this config file */</span>
<a name="l00494"></a>00494       <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="res__phoneprov_8c.html#a87e6df5f528d302bdc2905048211c0ab">global_server</a>)) {
<a name="l00495"></a>00495          <span class="keyword">union </span>{
<a name="l00496"></a>00496             <span class="keyword">struct </span>sockaddr sa;
<a name="l00497"></a>00497             <span class="keyword">struct </span>sockaddr_in sa_in;
<a name="l00498"></a>00498          } <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>;
<a name="l00499"></a>00499          socklen_t namelen = <span class="keyword">sizeof</span>(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>.sa);
<a name="l00500"></a>00500          <span class="keywordtype">int</span> res;
<a name="l00501"></a>00501 
<a name="l00502"></a>00502          <span class="keywordflow">if</span> ((res = getsockname(ser-&gt;<a class="code" href="structast__tcptls__session__instance.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, &amp;<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>.sa, &amp;namelen))) {
<a name="l00503"></a>00503             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not get server IP, breakage likely.\n&quot;</span>);
<a name="l00504"></a>00504          } <span class="keywordflow">else</span> {
<a name="l00505"></a>00505             <span class="keyword">struct </span><a class="code" href="structast__var__t.html">ast_var_t</a> *<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>;
<a name="l00506"></a>00506             <span class="keyword">struct </span><a class="code" href="structextension.html">extension</a> *exten_iter;
<a name="l00507"></a>00507 
<a name="l00508"></a>00508             <span class="keywordflow">if</span> ((var = <a class="code" href="chanvars_8h.html#a8ea2b5a29fa275115c7ed27a593b727d">ast_var_assign</a>(<span class="stringliteral">&quot;SERVER&quot;</span>, <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>.sa_in.sin_addr)))) {
<a name="l00509"></a>00509                <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;route-&gt;<a class="code" href="structhttp__route.html#a9071a284c9522ce89ae8c0d0544004e3">user</a>-&gt;<a class="code" href="structuser.html#a33ffb23cb386d3228aa6164ded55c341">extensions</a>, exten_iter, <a class="code" href="structextension.html#a27681bb9c1eff7bae46d2f35b10626b7">entry</a>) {
<a name="l00510"></a>00510                   <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(exten_iter-&gt;<a class="code" href="structextension.html#abaa13b11d884cceb9a8b2aed58a2cc11">headp</a>, var, entries);
<a name="l00511"></a>00511                }
<a name="l00512"></a>00512             }
<a name="l00513"></a>00513          }
<a name="l00514"></a>00514       }
<a name="l00515"></a>00515 
<a name="l00516"></a>00516       <a class="code" href="pbx_8h.html#a2b3355625306d4b98ca8047cd2245459">pbx_substitute_variables_varshead</a>(<a class="code" href="linkedlists_8h.html#adf1959c5c03a3a706da97ad2f49617e5" title="Returns the first entry contained in a list.">AST_LIST_FIRST</a>(&amp;route-&gt;<a class="code" href="structhttp__route.html#a9071a284c9522ce89ae8c0d0544004e3">user</a>-&gt;<a class="code" href="structuser.html#a33ffb23cb386d3228aa6164ded55c341">extensions</a>)-&gt;headp, file, tmp, bufsize);
<a name="l00517"></a>00517 
<a name="l00518"></a>00518       <span class="keywordflow">if</span> (file) {
<a name="l00519"></a>00519          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(file);
<a name="l00520"></a>00520       }
<a name="l00521"></a>00521 
<a name="l00522"></a>00522       <a class="code" href="strings_8h.html#a85cd5a8ef499e39d22b4bfeb8b9a64f7" title="Append to a thread local dynamic string.">ast_str_append</a>(&amp;result, 0,
<a name="l00523"></a>00523          <span class="stringliteral">&quot;Content-Type: %s\r\n&quot;</span>
<a name="l00524"></a>00524          <span class="stringliteral">&quot;Content-length: %d\r\n&quot;</span>
<a name="l00525"></a>00525          <span class="stringliteral">&quot;\r\n&quot;</span>
<a name="l00526"></a>00526          <span class="stringliteral">&quot;%s&quot;</span>, route-&gt;<a class="code" href="structhttp__route.html#a742f7871dc582416bad82b87a1794abf">file</a>-&gt;<a class="code" href="structphoneprov__file.html#a1451e38b2748f8664868291254533673">mime_type</a>, (<span class="keywordtype">int</span>) strlen(tmp), tmp);
<a name="l00527"></a>00527 
<a name="l00528"></a>00528       <span class="keywordflow">if</span> (tmp) {
<a name="l00529"></a>00529          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(tmp);
<a name="l00530"></a>00530       }
<a name="l00531"></a>00531 
<a name="l00532"></a>00532       route = <a class="code" href="res__phoneprov_8c.html#a5ff17e8d1cc95b424aceff81e8f99ca6">unref_route</a>(route);
<a name="l00533"></a>00533 
<a name="l00534"></a>00534       <span class="keywordflow">return</span> result;
<a name="l00535"></a>00535    }
<a name="l00536"></a>00536 
<a name="l00537"></a>00537 out404:
<a name="l00538"></a>00538    *<a class="code" href="app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a> = 404;
<a name="l00539"></a>00539    *title = <a class="code" href="astmm_8h.html#a33bc8f85636226ba23bf348f78352aef">strdup</a>(<span class="stringliteral">&quot;Not Found&quot;</span>);
<a name="l00540"></a>00540    *contentlength = 0;
<a name="l00541"></a>00541    <span class="keywordflow">return</span> <a class="code" href="http_8h.html#a934683361438de9f78b6c88a6a106b46" title="Return an ast_str malloc()&amp;#39;d string containing an HTTP error message.">ast_http_error</a>(404, <span class="stringliteral">&quot;Not Found&quot;</span>, NULL, <span class="stringliteral">&quot;The requested URL was not found on this server.&quot;</span>);
<a name="l00542"></a>00542 
<a name="l00543"></a>00543 out500:
<a name="l00544"></a>00544    route = <a class="code" href="res__phoneprov_8c.html#a5ff17e8d1cc95b424aceff81e8f99ca6">unref_route</a>(route);
<a name="l00545"></a>00545    *<a class="code" href="app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a> = 500;
<a name="l00546"></a>00546    *title = <a class="code" href="astmm_8h.html#a33bc8f85636226ba23bf348f78352aef">strdup</a>(<span class="stringliteral">&quot;Internal Server Error&quot;</span>);
<a name="l00547"></a>00547    *contentlength = 0;
<a name="l00548"></a>00548    <span class="keywordflow">return</span> <a class="code" href="http_8h.html#a934683361438de9f78b6c88a6a106b46" title="Return an ast_str malloc()&amp;#39;d string containing an HTTP error message.">ast_http_error</a>(500, <span class="stringliteral">&quot;Internal Error&quot;</span>, NULL, <span class="stringliteral">&quot;An internal error has occured.&quot;</span>);
<a name="l00549"></a>00549 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ade73760cade4016ab5bc94a97d29981f"></a><!-- doxytag: member="res_phoneprov.c::pp_each_extension_exec" ref="ade73760cade4016ab5bc94a97d29981f" args="(struct ast_channel *chan, const char *cmd, char *data, char *buf, size_t len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int pp_each_extension_exec </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>len</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>A dialplan function that can be used to output a template for each <a class="el" href="structextension.html">extension</a> attached to a <a class="el" href="structuser.html" title="structure to hold users read from users.conf">user</a>. </p>

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l01131">1131</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>References <a class="el" href="app_8h_source.html#l00338">AST_APP_ARG</a>, <a class="el" href="utils_8c_source.html#l01299">ast_build_string()</a>, <a class="el" href="asterisk_8c_source.html#l00254">ast_config_AST_DATA_DIR</a>, <a class="el" href="app_8h_source.html#l00355">AST_DECLARE_APP_ARGS</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="app_8h_source.html#l00387">AST_STANDARD_APP_ARGS</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="chan__alsa_8c_source.html#l00107">exten</a>, <a class="el" href="structuser.html#a33ffb23cb386d3228aa6164ded55c341">user::extensions</a>, <a class="el" href="res__phoneprov_8c_source.html#l00783">find_user()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00131">extension::headp</a>, <a class="el" href="res__phoneprov_8c_source.html#l00311">load_file()</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="pbx_8c_source.html#l03604">pbx_substitute_variables_varshead()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00775">unref_user()</a>, and <a class="el" href="pbx_8c_source.html#l00729">VAR_BUF_SIZE</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01132"></a>01132 {
<a name="l01133"></a>01133    <span class="keyword">struct </span><a class="code" href="structuser.html" title="structure to hold users read from users.conf">user</a> *<a class="code" href="structuser.html" title="structure to hold users read from users.conf">user</a>;
<a name="l01134"></a>01134    <span class="keyword">struct </span><a class="code" href="structextension.html">extension</a> *<a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>;
<a name="l01135"></a>01135    <span class="keywordtype">char</span> path[PATH_MAX];
<a name="l01136"></a>01136    <span class="keywordtype">char</span> *file;
<a name="l01137"></a>01137    <span class="keywordtype">int</span> filelen;
<a name="l01138"></a>01138    <a class="code" href="app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2" title="Declare a structure to hold an application&amp;#39;s arguments.">AST_DECLARE_APP_ARGS</a>(args,
<a name="l01139"></a>01139       <a class="code" href="app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5" title="Define an application argument.">AST_APP_ARG</a>(mac);
<a name="l01140"></a>01140       <a class="code" href="app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5" title="Define an application argument.">AST_APP_ARG</a>(<span class="keyword">template</span>);
<a name="l01141"></a>01141    );
<a name="l01142"></a>01142 
<a name="l01143"></a>01143    <a class="code" href="app_8h.html#ac08f7eb1eb9476b30987c73e1052ada8" title="Performs the &amp;#39;standard&amp;#39; argument separation process for an application.">AST_STANDARD_APP_ARGS</a>(args, data);
<a name="l01144"></a>01144 
<a name="l01145"></a>01145    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(args.mac) || <a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(args.template)) {
<a name="l01146"></a>01146       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;PP_EACH_EXTENSION requries both a macaddress and template filename.\n&quot;</span>);
<a name="l01147"></a>01147       <span class="keywordflow">return</span> 0;
<a name="l01148"></a>01148    }
<a name="l01149"></a>01149 
<a name="l01150"></a>01150    <span class="keywordflow">if</span> (!(user = <a class="code" href="res__phoneprov_8c.html#a9b8690d2eb6b2b070ee1faf3d0a1cb1f" title="Return a user looked up by name.">find_user</a>(args.mac))) {
<a name="l01151"></a>01151       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not find user with mac = &apos;%s&apos;\n&quot;</span>, args.mac);
<a name="l01152"></a>01152       <span class="keywordflow">return</span> 0;
<a name="l01153"></a>01153    }
<a name="l01154"></a>01154 
<a name="l01155"></a>01155    snprintf(path, <span class="keyword">sizeof</span>(path), <span class="stringliteral">&quot;%s/phoneprov/%s&quot;</span>, <a class="code" href="paths_8h.html#a63af4213b5b83f717398d8d62008a50d">ast_config_AST_DATA_DIR</a>, args.template);
<a name="l01156"></a>01156    filelen = <a class="code" href="res__phoneprov_8c.html#a04c6ab3149590b7a80b7599645ce220c" title="Read a TEXT file into a string and return the length.">load_file</a>(path, &amp;file);
<a name="l01157"></a>01157    <span class="keywordflow">if</span> (filelen &lt; 0) {
<a name="l01158"></a>01158       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not load file: %s (%d)\n&quot;</span>, path, filelen);
<a name="l01159"></a>01159       <span class="keywordflow">if</span> (file) {
<a name="l01160"></a>01160          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(file);
<a name="l01161"></a>01161       }
<a name="l01162"></a>01162       <span class="keywordflow">return</span> 0;
<a name="l01163"></a>01163    }
<a name="l01164"></a>01164 
<a name="l01165"></a>01165    <span class="keywordflow">if</span> (!file) {
<a name="l01166"></a>01166       <span class="keywordflow">return</span> 0;
<a name="l01167"></a>01167    }
<a name="l01168"></a>01168 
<a name="l01169"></a>01169    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;user-&gt;<a class="code" href="structuser.html#a33ffb23cb386d3228aa6164ded55c341">extensions</a>, exten, <a class="code" href="structextension.html#a27681bb9c1eff7bae46d2f35b10626b7">entry</a>) {
<a name="l01170"></a>01170       <span class="keywordtype">char</span> expand_buf[<a class="code" href="pbx_8c.html#ae1761f6ffd7763505cd891d3314cd7e4">VAR_BUF_SIZE</a>] = {0,};
<a name="l01171"></a>01171       <a class="code" href="pbx_8h.html#a2b3355625306d4b98ca8047cd2245459">pbx_substitute_variables_varshead</a>(exten-&gt;<a class="code" href="structextension.html#abaa13b11d884cceb9a8b2aed58a2cc11">headp</a>, file, expand_buf, <span class="keyword">sizeof</span>(expand_buf));
<a name="l01172"></a>01172       <a class="code" href="strings_8h.html#a603020160399d4876ec09fd299ebcaf9" title="Build a string in a buffer, designed to be called repeatedly.">ast_build_string</a>(&amp;<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, &amp;<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, <span class="stringliteral">&quot;%s&quot;</span>, expand_buf);
<a name="l01173"></a>01173    }
<a name="l01174"></a>01174 
<a name="l01175"></a>01175    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(file);
<a name="l01176"></a>01176 
<a name="l01177"></a>01177    user = <a class="code" href="res__phoneprov_8c.html#a61177e129b4f8b4a11498f33773ccc1b">unref_user</a>(user);
<a name="l01178"></a>01178 
<a name="l01179"></a>01179    <span class="keywordflow">return</span> 0;
<a name="l01180"></a>01180 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad66a8c00702929d37cebc1c0932a78da"></a><!-- doxytag: member="res_phoneprov.c::pp_each_user_exec" ref="ad66a8c00702929d37cebc1c0932a78da" args="(struct ast_channel *chan, const char *cmd, char *data, char *buf, size_t len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int pp_each_user_exec </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>len</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>A dialplan function that can be used to print a string for each phoneprov <a class="el" href="structuser.html" title="structure to hold users read from users.conf">user</a>. </p>

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l01088">1088</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>References <a class="el" href="astobj2_8c_source.html#l00795">ao2_iterator_destroy()</a>, <a class="el" href="astobj2_8c_source.html#l00780">ao2_iterator_init()</a>, <a class="el" href="astobj2_8h_source.html#l01120">ao2_iterator_next</a>, <a class="el" href="app_8h_source.html#l00338">AST_APP_ARG</a>, <a class="el" href="utils_8c_source.html#l01299">ast_build_string()</a>, <a class="el" href="app_8h_source.html#l00355">AST_DECLARE_APP_ARGS</a>, <a class="el" href="linkedlists_8h_source.html#l00420">AST_LIST_FIRST</a>, <a class="el" href="app_8h_source.html#l00387">AST_STANDARD_APP_ARGS</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="structuser.html#a33ffb23cb386d3228aa6164ded55c341">user::extensions</a>, <a class="el" href="res__phoneprov_8c_source.html#l00139">user::macaddress</a>, <a class="el" href="pbx_8c_source.html#l03604">pbx_substitute_variables_varshead()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00775">unref_user()</a>, and <a class="el" href="pbx_8c_source.html#l00729">VAR_BUF_SIZE</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01089"></a>01089 {
<a name="l01090"></a>01090    <span class="keywordtype">char</span> *tmp, expand_buf[<a class="code" href="pbx_8c.html#ae1761f6ffd7763505cd891d3314cd7e4">VAR_BUF_SIZE</a>] = {0,};
<a name="l01091"></a>01091    <span class="keyword">struct </span><a class="code" href="structao2__iterator.html" title="When we need to walk through a container, we use an ao2_iterator to keep track of...">ao2_iterator</a> i;
<a name="l01092"></a>01092    <span class="keyword">struct </span><a class="code" href="structuser.html" title="structure to hold users read from users.conf">user</a> *<a class="code" href="structuser.html" title="structure to hold users read from users.conf">user</a>;
<a name="l01093"></a>01093    <a class="code" href="app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2" title="Declare a structure to hold an application&amp;#39;s arguments.">AST_DECLARE_APP_ARGS</a>(args,
<a name="l01094"></a>01094       <a class="code" href="app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5" title="Define an application argument.">AST_APP_ARG</a>(<span class="keywordtype">string</span>);
<a name="l01095"></a>01095       <a class="code" href="app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5" title="Define an application argument.">AST_APP_ARG</a>(exclude_mac);
<a name="l01096"></a>01096    );
<a name="l01097"></a>01097    <a class="code" href="app_8h.html#ac08f7eb1eb9476b30987c73e1052ada8" title="Performs the &amp;#39;standard&amp;#39; argument separation process for an application.">AST_STANDARD_APP_ARGS</a>(args, data);
<a name="l01098"></a>01098 
<a name="l01099"></a>01099    <span class="comment">/* Fix data by turning %{ into ${ */</span>
<a name="l01100"></a>01100    <span class="keywordflow">while</span> ((tmp = strstr(args.string, <span class="stringliteral">&quot;%{&quot;</span>)))
<a name="l01101"></a>01101       *tmp = <span class="charliteral">&apos;$&apos;</span>;
<a name="l01102"></a>01102 
<a name="l01103"></a>01103    i = <a class="code" href="astobj2_8h.html#a288075de687152d297308ea1ea963edb" title="Create an iterator for a container.">ao2_iterator_init</a>(<a class="code" href="structusers.html" title="list of users found in the config file">users</a>, 0);
<a name="l01104"></a>01104    <span class="keywordflow">while</span> ((user = <a class="code" href="astobj2_8h.html#a1cf2fe1aafd3cb9e613eb48535a37ad5">ao2_iterator_next</a>(&amp;i))) {
<a name="l01105"></a>01105       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(args.exclude_mac) &amp;&amp; !strcasecmp(user-&gt;<a class="code" href="structuser.html#a43de8de44949a0033b3cbe2fbb3ae523">macaddress</a>, args.exclude_mac)) {
<a name="l01106"></a>01106          <span class="keywordflow">continue</span>;
<a name="l01107"></a>01107       }
<a name="l01108"></a>01108       <a class="code" href="pbx_8h.html#a2b3355625306d4b98ca8047cd2245459">pbx_substitute_variables_varshead</a>(<a class="code" href="linkedlists_8h.html#adf1959c5c03a3a706da97ad2f49617e5" title="Returns the first entry contained in a list.">AST_LIST_FIRST</a>(&amp;user-&gt;<a class="code" href="structuser.html#a33ffb23cb386d3228aa6164ded55c341">extensions</a>)-&gt;headp, args.string, expand_buf, <span class="keyword">sizeof</span>(expand_buf));
<a name="l01109"></a>01109       <a class="code" href="strings_8h.html#a603020160399d4876ec09fd299ebcaf9" title="Build a string in a buffer, designed to be called repeatedly.">ast_build_string</a>(&amp;<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, &amp;<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, <span class="stringliteral">&quot;%s&quot;</span>, expand_buf);
<a name="l01110"></a>01110       user = <a class="code" href="res__phoneprov_8c.html#a61177e129b4f8b4a11498f33773ccc1b">unref_user</a>(user);
<a name="l01111"></a>01111    }
<a name="l01112"></a>01112    <a class="code" href="astobj2_8h.html#a62d5d9e9d0fa281168e6a08ef4a52450" title="Destroy a container iterator.">ao2_iterator_destroy</a>(&amp;i);
<a name="l01113"></a>01113 
<a name="l01114"></a>01114    <span class="keywordflow">return</span> 0;
<a name="l01115"></a>01115 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aebc1bffc0df046bcff4d2a0473ada3fd"></a><!-- doxytag: member="res_phoneprov.c::profile_cmp_fn" ref="aebc1bffc0df046bcff4d2a0473ada3fd" args="(void *obj, void *arg, int flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int profile_cmp_fn </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>arg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00250">250</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00653">CMP_MATCH</a>, <a class="el" href="astobj2_8h_source.html#l00654">CMP_STOP</a>, and <a class="el" href="res__phoneprov_8c_source.html#l00120">phone_profile::name</a>.</p>

<p>Referenced by <a class="el" href="res__phoneprov_8c_source.html#l01250">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00251"></a>00251 {
<a name="l00252"></a>00252    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structphone__profile.html" title="structure to hold phone profiles read from phoneprov.conf">phone_profile</a> *profile1 = obj, *profile2 = arg;
<a name="l00253"></a>00253 
<a name="l00254"></a>00254    <span class="keywordflow">return</span> !strcasecmp(profile1-&gt;<a class="code" href="structphone__profile.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>, profile2-&gt;name) ? <a class="code" href="astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a> | <a class="code" href="astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df">CMP_STOP</a> : 0;
<a name="l00255"></a>00255 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0c8d3191d4633ed3b4dad8750fa755d8"></a><!-- doxytag: member="res_phoneprov.c::profile_destructor" ref="a0c8d3191d4633ed3b4dad8750fa755d8" args="(void *obj)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void profile_destructor </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>obj</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00263">263</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="linkedlists_8h_source.html#l00817">AST_LIST_REMOVE_HEAD</a>, <a class="el" href="stringfields_8h_source.html#l00245">ast_string_field_free_memory</a>, <a class="el" href="chanvars_8c_source.html#l00059">ast_var_delete()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00257">delete_file()</a>, <a class="el" href="structphone__profile.html#a25fc7f04be8b6ea66317503640ec8794">phone_profile::dynamic_files</a>, <a class="el" href="res__phoneprov_8c_source.html#l00121">phone_profile::headp</a>, <a class="el" href="structphone__profile.html#ad1504ea54c8a417d9e4fe829ad3cab7e">phone_profile::static_files</a>, and <a class="el" href="ast__expr2f_8c_source.html#l00613">var</a>.</p>

<p>Referenced by <a class="el" href="res__phoneprov_8c_source.html#l00583">build_profile()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00264"></a>00264 {
<a name="l00265"></a>00265    <span class="keyword">struct </span><a class="code" href="structphone__profile.html" title="structure to hold phone profiles read from phoneprov.conf">phone_profile</a> *profile = obj;
<a name="l00266"></a>00266    <span class="keyword">struct </span><a class="code" href="structphoneprov__file.html" title="structure to hold file data">phoneprov_file</a> *file;
<a name="l00267"></a>00267    <span class="keyword">struct </span><a class="code" href="structast__var__t.html">ast_var_t</a> *<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>;
<a name="l00268"></a>00268 
<a name="l00269"></a>00269    <span class="keywordflow">while</span> ((file = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;profile-&gt;<a class="code" href="structphone__profile.html#ad1504ea54c8a417d9e4fe829ad3cab7e">static_files</a>, entry)))
<a name="l00270"></a>00270       <a class="code" href="res__phoneprov_8c.html#a9a2102f5ce1bbef671a27b071df6d806">delete_file</a>(file);
<a name="l00271"></a>00271 
<a name="l00272"></a>00272    <span class="keywordflow">while</span> ((file = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;profile-&gt;<a class="code" href="structphone__profile.html#a25fc7f04be8b6ea66317503640ec8794">dynamic_files</a>, entry)))
<a name="l00273"></a>00273       <a class="code" href="res__phoneprov_8c.html#a9a2102f5ce1bbef671a27b071df6d806">delete_file</a>(file);
<a name="l00274"></a>00274 
<a name="l00275"></a>00275    <span class="keywordflow">while</span> ((var = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(profile-&gt;<a class="code" href="structphone__profile.html#abaa13b11d884cceb9a8b2aed58a2cc11">headp</a>, entries)))
<a name="l00276"></a>00276       <a class="code" href="chanvars_8h.html#a52aaa758ed30031250c2d356b993c6d9">ast_var_delete</a>(var);
<a name="l00277"></a>00277 
<a name="l00278"></a>00278    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(profile-&gt;<a class="code" href="structphone__profile.html#abaa13b11d884cceb9a8b2aed58a2cc11">headp</a>);
<a name="l00279"></a>00279    <a class="code" href="stringfields_8h.html#abf60f862ae6a141d2f86a0f5e82792de" title="free all memory - to be called before destroying the object">ast_string_field_free_memory</a>(profile);
<a name="l00280"></a>00280 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1cb6ea28a5ce8cf589e43a5a3460b7ae"></a><!-- doxytag: member="res_phoneprov.c::profile_hash_fn" ref="a1cb6ea28a5ce8cf589e43a5a3460b7ae" args="(const void *obj, const int flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int profile_hash_fn </td>
          <td>(</td>
          <td class="paramtype">const void *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00243">243</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>References <a class="el" href="strings_8h_source.html#l00896">ast_str_case_hash()</a>, and <a class="el" href="res__phoneprov_8c_source.html#l00120">phone_profile::name</a>.</p>

<p>Referenced by <a class="el" href="res__phoneprov_8c_source.html#l01250">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00244"></a>00244 {
<a name="l00245"></a>00245    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structphone__profile.html" title="structure to hold phone profiles read from phoneprov.conf">phone_profile</a> *profile = obj;
<a name="l00246"></a>00246 
<a name="l00247"></a>00247    <span class="keywordflow">return</span> <a class="code" href="strings_8h.html#ab08f8db2a7258e538a0da7417f58db58" title="Compute a hash value on a case-insensitive string.">ast_str_case_hash</a>(profile-&gt;<a class="code" href="structphone__profile.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);
<a name="l00248"></a>00248 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad1982509765f4870f1f63412a53ea668"></a><!-- doxytag: member="res_phoneprov.c::reload" ref="ad1982509765f4870f1f63412a53ea668" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int reload </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l01298">1298</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00817">AST_LIST_REMOVE_HEAD</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="chanvars_8c_source.html#l00059">ast_var_delete()</a>, <a class="el" href="res__phoneprov_8c_source.html#l01074">delete_profiles()</a>, <a class="el" href="res__phoneprov_8c_source.html#l01060">delete_routes()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00824">delete_users()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00176">global_variables</a>, <a class="el" href="res__phoneprov_8c_source.html#l00912">set_config()</a>, and <a class="el" href="ast__expr2f_8c_source.html#l00613">var</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01299"></a>01299 {
<a name="l01300"></a>01300    <span class="keyword">struct </span><a class="code" href="structast__var__t.html">ast_var_t</a> *<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>;
<a name="l01301"></a>01301 
<a name="l01302"></a>01302    <a class="code" href="res__phoneprov_8c.html#aa2a1b5e37b1426df4284c132cd785ef7" title="Delete all http routes, freeing their memory.">delete_routes</a>();
<a name="l01303"></a>01303    <a class="code" href="res__phoneprov_8c.html#ace322a3e8008af8b872b72770e97fa85" title="Delete all users.">delete_users</a>();
<a name="l01304"></a>01304    <a class="code" href="res__phoneprov_8c.html#a97d13891245936affb35e4dfadcb25e8" title="Delete all phone profiles, freeing their memory.">delete_profiles</a>();
<a name="l01305"></a>01305 
<a name="l01306"></a>01306    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;<a class="code" href="res__phoneprov_8c.html#ac5e1d00d9d447cc961b9e31a34a96507">globals_lock</a>);
<a name="l01307"></a>01307    <span class="keywordflow">while</span> ((var = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;<a class="code" href="res__phoneprov_8c.html#a99146593ce920142bad553c2180d0f17" title="List of global variables currently available: VOICEMAIL_EXTEN, EXTENSION_LENGTH.">global_variables</a>, entries))) {
<a name="l01308"></a>01308       <a class="code" href="chanvars_8h.html#a52aaa758ed30031250c2d356b993c6d9">ast_var_delete</a>(var);
<a name="l01309"></a>01309    }
<a name="l01310"></a>01310    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="res__phoneprov_8c.html#ac5e1d00d9d447cc961b9e31a34a96507">globals_lock</a>);
<a name="l01311"></a>01311 
<a name="l01312"></a>01312    <a class="code" href="res__phoneprov_8c.html#a6658fcbb66219eff8bf475a2092fa06d">set_config</a>();
<a name="l01313"></a>01313 
<a name="l01314"></a>01314    <span class="keywordflow">return</span> 0;
<a name="l01315"></a>01315 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae71495d7e33581c0cf2f0cbb35e6c3af"></a><!-- doxytag: member="res_phoneprov.c::route_destructor" ref="ae71495d7e33581c0cf2f0cbb35e6c3af" args="(void *obj)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void route_destructor </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>obj</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00303">303</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>References <a class="el" href="stringfields_8h_source.html#l00245">ast_string_field_free_memory</a>.</p>

<p>Referenced by <a class="el" href="res__phoneprov_8c_source.html#l00556">build_route()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00304"></a>00304 {
<a name="l00305"></a>00305    <span class="keyword">struct </span><a class="code" href="structhttp__route.html" title="structure to hold http routes (valid URIs, and the files they link to)">http_route</a> *route = obj;
<a name="l00306"></a>00306 
<a name="l00307"></a>00307    <a class="code" href="stringfields_8h.html#abf60f862ae6a141d2f86a0f5e82792de" title="free all memory - to be called before destroying the object">ast_string_field_free_memory</a>(route);
<a name="l00308"></a>00308 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aea36e776c24e08f24ce107158d178aa5"></a><!-- doxytag: member="res_phoneprov.c::routes_cmp_fn" ref="aea36e776c24e08f24ce107158d178aa5" args="(void *obj, void *arg, int flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int routes_cmp_fn </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>arg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00296">296</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00653">CMP_MATCH</a>, <a class="el" href="astobj2_8h_source.html#l00654">CMP_STOP</a>, and <a class="el" href="res__phoneprov_8c_source.html#l00148">http_route::uri</a>.</p>

<p>Referenced by <a class="el" href="res__phoneprov_8c_source.html#l01250">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00297"></a>00297 {
<a name="l00298"></a>00298    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structhttp__route.html" title="structure to hold http routes (valid URIs, and the files they link to)">http_route</a> *route1 = obj, *route2 = arg;
<a name="l00299"></a>00299 
<a name="l00300"></a>00300    <span class="keywordflow">return</span> !strcasecmp(route1-&gt;<a class="code" href="structhttp__route.html#a19ac71226fac09e87afe31acb4c99214">uri</a>, route2-&gt;uri) ? <a class="code" href="astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a> | <a class="code" href="astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df">CMP_STOP</a> : 0;
<a name="l00301"></a>00301 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a700f9c2b8d1dae3755239792b7acf813"></a><!-- doxytag: member="res_phoneprov.c::routes_hash_fn" ref="a700f9c2b8d1dae3755239792b7acf813" args="(const void *obj, const int flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int routes_hash_fn </td>
          <td>(</td>
          <td class="paramtype">const void *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00289">289</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>References <a class="el" href="strings_8h_source.html#l00896">ast_str_case_hash()</a>, and <a class="el" href="res__phoneprov_8c_source.html#l00148">http_route::uri</a>.</p>

<p>Referenced by <a class="el" href="res__phoneprov_8c_source.html#l01250">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00290"></a>00290 {
<a name="l00291"></a>00291    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structhttp__route.html" title="structure to hold http routes (valid URIs, and the files they link to)">http_route</a> *route = obj;
<a name="l00292"></a>00292 
<a name="l00293"></a>00293    <span class="keywordflow">return</span> <a class="code" href="strings_8h.html#ab08f8db2a7258e538a0da7417f58db58" title="Compute a hash value on a case-insensitive string.">ast_str_case_hash</a>(route-&gt;<a class="code" href="structhttp__route.html#a19ac71226fac09e87afe31acb4c99214">uri</a>);
<a name="l00294"></a>00294 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6658fcbb66219eff8bf475a2092fa06d"></a><!-- doxytag: member="res_phoneprov.c::set_config" ref="a6658fcbb66219eff8bf475a2092fa06d" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int set_config </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00912">912</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>References <a class="el" href="res__phoneprov_8c_source.html#l00860">add_user_extension()</a>, <a class="el" href="astobj2_8h_source.html#l00782">ao2_link</a>, <a class="el" href="config_8c_source.html#l00613">ast_category_browse()</a>, <a class="el" href="config_8c_source.html#l00827">ast_config_destroy()</a>, <a class="el" href="config_8h_source.html#l00139">ast_config_load</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="utils_8c_source.html#l00431">ast_inet_ntoa()</a>, <a class="el" href="linkedlists_8h_source.html#l00715">AST_LIST_INSERT_TAIL</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="utils_8c_source.html#l01311">ast_true()</a>, <a class="el" href="chanvars_8c_source.html#l00037">ast_var_assign()</a>, <a class="el" href="config_8c_source.html#l00411">ast_variable_browse()</a>, <a class="el" href="config_8c_source.html#l00435">ast_variable_retrieve()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00709">build_extension()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00583">build_profile()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00838">build_user()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00897">build_user_routes()</a>, <a class="el" href="config_8h_source.html#l00050">CONFIG_STATUS_FILEINVALID</a>, <a class="el" href="res__phoneprov_8c_source.html#l00695">delete_extension()</a>, <a class="el" href="chan__alsa_8c_source.html#l00107">exten</a>, <a class="el" href="res__phoneprov_8c_source.html#l00234">find_profile()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00783">find_user()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00176">global_variables</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="res__phoneprov_8c_source.html#l00196">lookup_iface()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00139">user::macaddress</a>, <a class="el" href="res__phoneprov_8c_source.html#l00129">extension::name</a>, <a class="el" href="config_8h_source.html#l00075">ast_variable::name</a>, <a class="el" href="config_8h_source.html#l00077">ast_variable::next</a>, <a class="el" href="strings_8h_source.html#l00072">S_OR</a>, <a class="el" href="res__phoneprov_8c_source.html#l00775">unref_user()</a>, <a class="el" href="config_8h_source.html#l00076">ast_variable::value</a>, and <a class="el" href="ast__expr2f_8c_source.html#l00613">var</a>.</p>

<p>Referenced by <a class="el" href="res__phoneprov_8c_source.html#l01250">load_module()</a>, and <a class="el" href="res__phoneprov_8c_source.html#l01298">reload()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00913"></a>00913 {
<a name="l00914"></a>00914    <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *cfg, *phoneprov_cfg;
<a name="l00915"></a>00915    <span class="keywordtype">char</span> *cat;
<a name="l00916"></a>00916    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *v;
<a name="l00917"></a>00917    <span class="keyword">struct </span><a class="code" href="structast__flags.html" title="Structure used to handle boolean flags.">ast_flags</a> <a class="code" href="app__rpt_8c.html#a1f57f20c1f46890828791a4827fe8752">config_flags</a> = { 0 };
<a name="l00918"></a>00918    <span class="keyword">struct </span><a class="code" href="structast__var__t.html">ast_var_t</a> *<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>;
<a name="l00919"></a>00919 
<a name="l00920"></a>00920    <span class="comment">/* Try to grab the port from sip.conf.  If we don&apos;t get it here, we&apos;ll set it</span>
<a name="l00921"></a>00921 <span class="comment">    * to whatever is set in phoneprov.conf or default to 5060 */</span>
<a name="l00922"></a>00922    <span class="keywordflow">if</span> ((cfg = <a class="code" href="config_8h.html#a0a07ddd6bbcf44485e01c14c96109482">ast_config_load</a>(<span class="stringliteral">&quot;sip.conf&quot;</span>, config_flags)) &amp;&amp; cfg != <a class="code" href="config_8h.html#a8d1a63cdf2c7aff22a77b6e75d93b377">CONFIG_STATUS_FILEINVALID</a>) {
<a name="l00923"></a>00923       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="res__phoneprov_8c.html#a1239e5c2af085094329f54fd64458de8">global_serverport</a>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(<a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;bindport&quot;</span>), <span class="stringliteral">&quot;5060&quot;</span>), <span class="keyword">sizeof</span>(<a class="code" href="res__phoneprov_8c.html#a1239e5c2af085094329f54fd64458de8">global_serverport</a>));
<a name="l00924"></a>00924       <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(cfg);
<a name="l00925"></a>00925    }
<a name="l00926"></a>00926 
<a name="l00927"></a>00927    <span class="keywordflow">if</span> (!(cfg = <a class="code" href="config_8h.html#a0a07ddd6bbcf44485e01c14c96109482">ast_config_load</a>(<span class="stringliteral">&quot;users.conf&quot;</span>, config_flags)) || cfg == <a class="code" href="config_8h.html#a8d1a63cdf2c7aff22a77b6e75d93b377">CONFIG_STATUS_FILEINVALID</a>) {
<a name="l00928"></a>00928       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to load users.conf\n&quot;</span>);
<a name="l00929"></a>00929       <span class="keywordflow">return</span> 0;
<a name="l00930"></a>00930    }
<a name="l00931"></a>00931 
<a name="l00932"></a>00932    <span class="comment">/* Go ahead and load global variables from users.conf so we can append to profiles */</span>
<a name="l00933"></a>00933    <span class="keywordflow">for</span> (v = <a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>); v; v = v-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l00934"></a>00934       <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;vmexten&quot;</span>)) {
<a name="l00935"></a>00935          <span class="keywordflow">if</span> ((var = <a class="code" href="chanvars_8h.html#a8ea2b5a29fa275115c7ed27a593b727d">ast_var_assign</a>(<span class="stringliteral">&quot;VOICEMAIL_EXTEN&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>))) {
<a name="l00936"></a>00936             <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;<a class="code" href="res__phoneprov_8c.html#ac5e1d00d9d447cc961b9e31a34a96507">globals_lock</a>);
<a name="l00937"></a>00937             <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(&amp;<a class="code" href="res__phoneprov_8c.html#a99146593ce920142bad553c2180d0f17" title="List of global variables currently available: VOICEMAIL_EXTEN, EXTENSION_LENGTH.">global_variables</a>, var, entries);
<a name="l00938"></a>00938             <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="res__phoneprov_8c.html#ac5e1d00d9d447cc961b9e31a34a96507">globals_lock</a>);
<a name="l00939"></a>00939          }
<a name="l00940"></a>00940       }
<a name="l00941"></a>00941       <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;localextenlength&quot;</span>)) {
<a name="l00942"></a>00942          <span class="keywordflow">if</span> ((var = <a class="code" href="chanvars_8h.html#a8ea2b5a29fa275115c7ed27a593b727d">ast_var_assign</a>(<span class="stringliteral">&quot;EXTENSION_LENGTH&quot;</span>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>)))
<a name="l00943"></a>00943             <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;<a class="code" href="res__phoneprov_8c.html#ac5e1d00d9d447cc961b9e31a34a96507">globals_lock</a>);
<a name="l00944"></a>00944             <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(&amp;<a class="code" href="res__phoneprov_8c.html#a99146593ce920142bad553c2180d0f17" title="List of global variables currently available: VOICEMAIL_EXTEN, EXTENSION_LENGTH.">global_variables</a>, var, entries);
<a name="l00945"></a>00945             <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="res__phoneprov_8c.html#ac5e1d00d9d447cc961b9e31a34a96507">globals_lock</a>);
<a name="l00946"></a>00946       }
<a name="l00947"></a>00947    }
<a name="l00948"></a>00948 
<a name="l00949"></a>00949    <span class="keywordflow">if</span> (!(phoneprov_cfg = <a class="code" href="config_8h.html#a0a07ddd6bbcf44485e01c14c96109482">ast_config_load</a>(<span class="stringliteral">&quot;phoneprov.conf&quot;</span>, config_flags)) || phoneprov_cfg == <a class="code" href="config_8h.html#a8d1a63cdf2c7aff22a77b6e75d93b377">CONFIG_STATUS_FILEINVALID</a>) {
<a name="l00950"></a>00950       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to load config phoneprov.conf\n&quot;</span>);
<a name="l00951"></a>00951       <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(cfg);
<a name="l00952"></a>00952       <span class="keywordflow">return</span> -1;
<a name="l00953"></a>00953    }
<a name="l00954"></a>00954 
<a name="l00955"></a>00955    cat = NULL;
<a name="l00956"></a>00956    <span class="keywordflow">while</span> ((cat = <a class="code" href="config_8h.html#a611776300f941a63266cb220ac62b4db" title="Goes through categories.">ast_category_browse</a>(phoneprov_cfg, cat))) {
<a name="l00957"></a>00957       <span class="keywordflow">if</span> (!strcasecmp(cat, <span class="stringliteral">&quot;general&quot;</span>)) {
<a name="l00958"></a>00958          <span class="keywordflow">for</span> (v = <a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(phoneprov_cfg, cat); v; v = v-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l00959"></a>00959             <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;serveraddr&quot;</span>))
<a name="l00960"></a>00960                <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="res__phoneprov_8c.html#a87e6df5f528d302bdc2905048211c0ab">global_server</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(<a class="code" href="res__phoneprov_8c.html#a87e6df5f528d302bdc2905048211c0ab">global_server</a>));
<a name="l00961"></a>00961             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;serveriface&quot;</span>)) {
<a name="l00962"></a>00962                <span class="keyword">struct </span>in_addr addr;
<a name="l00963"></a>00963                <a class="code" href="res__phoneprov_8c.html#a954fe3261258e2a0cf96cbbf598c2935">lookup_iface</a>(v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, &amp;addr);
<a name="l00964"></a>00964                <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="res__phoneprov_8c.html#a87e6df5f528d302bdc2905048211c0ab">global_server</a>, <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(addr), <span class="keyword">sizeof</span>(<a class="code" href="res__phoneprov_8c.html#a87e6df5f528d302bdc2905048211c0ab">global_server</a>));
<a name="l00965"></a>00965             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;serverport&quot;</span>))
<a name="l00966"></a>00966                <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="res__phoneprov_8c.html#a1239e5c2af085094329f54fd64458de8">global_serverport</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(<a class="code" href="res__phoneprov_8c.html#a1239e5c2af085094329f54fd64458de8">global_serverport</a>));
<a name="l00967"></a>00967             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;default_profile&quot;</span>))
<a name="l00968"></a>00968                <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="res__phoneprov_8c.html#a0b98d7043ca0b2bd43b0314237bc8587">global_default_profile</a>, v-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(<a class="code" href="res__phoneprov_8c.html#a0b98d7043ca0b2bd43b0314237bc8587">global_default_profile</a>));
<a name="l00969"></a>00969          }
<a name="l00970"></a>00970       } <span class="keywordflow">else</span>
<a name="l00971"></a>00971          <a class="code" href="res__phoneprov_8c.html#aef718301835f2096a66d68122adee512" title="Build a phone profile and add it to the list of phone profiles.">build_profile</a>(cat, <a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(phoneprov_cfg, cat));
<a name="l00972"></a>00972    }
<a name="l00973"></a>00973 
<a name="l00974"></a>00974    <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(phoneprov_cfg);
<a name="l00975"></a>00975 
<a name="l00976"></a>00976    cat = NULL;
<a name="l00977"></a>00977    <span class="keywordflow">while</span> ((cat = <a class="code" href="config_8h.html#a611776300f941a63266cb220ac62b4db" title="Goes through categories.">ast_category_browse</a>(cfg, cat))) {
<a name="l00978"></a>00978       <span class="keyword">const</span> <span class="keywordtype">char</span> *tmp, *mac;
<a name="l00979"></a>00979       <span class="keyword">struct </span><a class="code" href="structuser.html" title="structure to hold users read from users.conf">user</a> *<a class="code" href="structuser.html" title="structure to hold users read from users.conf">user</a>;
<a name="l00980"></a>00980       <span class="keyword">struct </span><a class="code" href="structphone__profile.html" title="structure to hold phone profiles read from phoneprov.conf">phone_profile</a> *profile;
<a name="l00981"></a>00981       <span class="keyword">struct </span><a class="code" href="structextension.html">extension</a> *<a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>;
<a name="l00982"></a>00982 
<a name="l00983"></a>00983       <span class="keywordflow">if</span> (!strcasecmp(cat, <span class="stringliteral">&quot;general&quot;</span>)) {
<a name="l00984"></a>00984          <span class="keywordflow">continue</span>;
<a name="l00985"></a>00985       }
<a name="l00986"></a>00986 
<a name="l00987"></a>00987       <span class="keywordflow">if</span> (!strcasecmp(cat, <span class="stringliteral">&quot;authentication&quot;</span>))
<a name="l00988"></a>00988          <span class="keywordflow">continue</span>;
<a name="l00989"></a>00989 
<a name="l00990"></a>00990       <span class="keywordflow">if</span> (!((tmp = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, cat, <span class="stringliteral">&quot;autoprov&quot;</span>)) &amp;&amp; <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(tmp)))
<a name="l00991"></a>00991          <span class="keywordflow">continue</span>;
<a name="l00992"></a>00992 
<a name="l00993"></a>00993       <span class="keywordflow">if</span> (!(mac = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, cat, <span class="stringliteral">&quot;macaddress&quot;</span>))) {
<a name="l00994"></a>00994          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;autoprov set for %s, but no mac address - skipping.\n&quot;</span>, cat);
<a name="l00995"></a>00995          <span class="keywordflow">continue</span>;
<a name="l00996"></a>00996       }
<a name="l00997"></a>00997 
<a name="l00998"></a>00998       tmp = <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(<a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(cfg, cat, <span class="stringliteral">&quot;profile&quot;</span>), <a class="code" href="res__phoneprov_8c.html#a0b98d7043ca0b2bd43b0314237bc8587">global_default_profile</a>);
<a name="l00999"></a>00999       <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(tmp)) {
<a name="l01000"></a>01000          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No profile for user [%s] with mac &apos;%s&apos; - skipping\n&quot;</span>, cat, mac);
<a name="l01001"></a>01001          <span class="keywordflow">continue</span>;
<a name="l01002"></a>01002       }
<a name="l01003"></a>01003 
<a name="l01004"></a>01004       <span class="keywordflow">if</span> (!(user = <a class="code" href="res__phoneprov_8c.html#a9b8690d2eb6b2b070ee1faf3d0a1cb1f" title="Return a user looked up by name.">find_user</a>(mac))) {
<a name="l01005"></a>01005          <span class="keywordflow">if</span> (!(profile = <a class="code" href="res__phoneprov_8c.html#a1d73305eda3292c4133efe4940a1f2e3" title="Return a phone profile looked up by name.">find_profile</a>(tmp))) {
<a name="l01006"></a>01006             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not look up profile &apos;%s&apos; - skipping.\n&quot;</span>, tmp);
<a name="l01007"></a>01007             <span class="keywordflow">continue</span>;
<a name="l01008"></a>01008          }
<a name="l01009"></a>01009 
<a name="l01010"></a>01010          <span class="keywordflow">if</span> (!(user = <a class="code" href="res__phoneprov_8c.html#af95e27b49139d0b61207299a03cf8d87" title="Build and return a user structure based on gathered config data.">build_user</a>(mac, profile))) {
<a name="l01011"></a>01011             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not create user for &apos;%s&apos; - skipping\n&quot;</span>, user-&gt;<a class="code" href="structuser.html#a43de8de44949a0033b3cbe2fbb3ae523">macaddress</a>);
<a name="l01012"></a>01012             <span class="keywordflow">continue</span>;
<a name="l01013"></a>01013          }
<a name="l01014"></a>01014 
<a name="l01015"></a>01015          <span class="keywordflow">if</span> (!(exten = <a class="code" href="res__phoneprov_8c.html#a8cff0bba26573fb649703e10df4c3997">build_extension</a>(cfg, cat))) {
<a name="l01016"></a>01016             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not create extension for %s - skipping\n&quot;</span>, user-&gt;<a class="code" href="structuser.html#a43de8de44949a0033b3cbe2fbb3ae523">macaddress</a>);
<a name="l01017"></a>01017             user = <a class="code" href="res__phoneprov_8c.html#a61177e129b4f8b4a11498f33773ccc1b">unref_user</a>(user);
<a name="l01018"></a>01018             <span class="keywordflow">continue</span>;
<a name="l01019"></a>01019          }
<a name="l01020"></a>01020 
<a name="l01021"></a>01021          <span class="keywordflow">if</span> (<a class="code" href="res__phoneprov_8c.html#ad23b53289cf4121101c52233bacbacc0" title="Add an extension to a user ordered by index/linenumber.">add_user_extension</a>(user, exten)) {
<a name="l01022"></a>01022             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not add extension &apos;%s&apos; to user &apos;%s&apos;\n&quot;</span>, exten-&gt;<a class="code" href="structextension.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>, user-&gt;<a class="code" href="structuser.html#a43de8de44949a0033b3cbe2fbb3ae523">macaddress</a>);
<a name="l01023"></a>01023             user = <a class="code" href="res__phoneprov_8c.html#a61177e129b4f8b4a11498f33773ccc1b">unref_user</a>(user);
<a name="l01024"></a>01024             exten = <a class="code" href="res__phoneprov_8c.html#a44b45903a5a6b50bcd11b446f7635ffc">delete_extension</a>(exten);
<a name="l01025"></a>01025             <span class="keywordflow">continue</span>;
<a name="l01026"></a>01026          }
<a name="l01027"></a>01027 
<a name="l01028"></a>01028          <span class="keywordflow">if</span> (<a class="code" href="res__phoneprov_8c.html#a624c63d6184a3f4c015f743eba369f12" title="Add an http route for dynamic files attached to the profile of the user.">build_user_routes</a>(user)) {
<a name="l01029"></a>01029             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not create http routes for %s - skipping\n&quot;</span>, user-&gt;<a class="code" href="structuser.html#a43de8de44949a0033b3cbe2fbb3ae523">macaddress</a>);
<a name="l01030"></a>01030             user = <a class="code" href="res__phoneprov_8c.html#a61177e129b4f8b4a11498f33773ccc1b">unref_user</a>(user);
<a name="l01031"></a>01031             <span class="keywordflow">continue</span>;
<a name="l01032"></a>01032          }
<a name="l01033"></a>01033 
<a name="l01034"></a>01034          <a class="code" href="astobj2_8h.html#a210544bdcc5afe0601d01d6e529c22d8">ao2_link</a>(<a class="code" href="structusers.html" title="list of users found in the config file">users</a>, user);
<a name="l01035"></a>01035          user = <a class="code" href="res__phoneprov_8c.html#a61177e129b4f8b4a11498f33773ccc1b">unref_user</a>(user);
<a name="l01036"></a>01036       } <span class="keywordflow">else</span> {
<a name="l01037"></a>01037          <span class="keywordflow">if</span> (!(exten = <a class="code" href="res__phoneprov_8c.html#a8cff0bba26573fb649703e10df4c3997">build_extension</a>(cfg, cat))) {
<a name="l01038"></a>01038             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not create extension for %s - skipping\n&quot;</span>, user-&gt;<a class="code" href="structuser.html#a43de8de44949a0033b3cbe2fbb3ae523">macaddress</a>);
<a name="l01039"></a>01039             user = <a class="code" href="res__phoneprov_8c.html#a61177e129b4f8b4a11498f33773ccc1b">unref_user</a>(user);
<a name="l01040"></a>01040             <span class="keywordflow">continue</span>;
<a name="l01041"></a>01041          }
<a name="l01042"></a>01042 
<a name="l01043"></a>01043          <span class="keywordflow">if</span> (<a class="code" href="res__phoneprov_8c.html#ad23b53289cf4121101c52233bacbacc0" title="Add an extension to a user ordered by index/linenumber.">add_user_extension</a>(user, exten)) {
<a name="l01044"></a>01044             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not add extension &apos;%s&apos; to user &apos;%s&apos;\n&quot;</span>, exten-&gt;<a class="code" href="structextension.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>, user-&gt;<a class="code" href="structuser.html#a43de8de44949a0033b3cbe2fbb3ae523">macaddress</a>);
<a name="l01045"></a>01045             user = <a class="code" href="res__phoneprov_8c.html#a61177e129b4f8b4a11498f33773ccc1b">unref_user</a>(user);
<a name="l01046"></a>01046             exten = <a class="code" href="res__phoneprov_8c.html#a44b45903a5a6b50bcd11b446f7635ffc">delete_extension</a>(exten);
<a name="l01047"></a>01047             <span class="keywordflow">continue</span>;
<a name="l01048"></a>01048          }
<a name="l01049"></a>01049 
<a name="l01050"></a>01050          user = <a class="code" href="res__phoneprov_8c.html#a61177e129b4f8b4a11498f33773ccc1b">unref_user</a>(user);
<a name="l01051"></a>01051       }
<a name="l01052"></a>01052    }
<a name="l01053"></a>01053 
<a name="l01054"></a>01054    <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(cfg);
<a name="l01055"></a>01055 
<a name="l01056"></a>01056    <span class="keywordflow">return</span> 0;
<a name="l01057"></a>01057 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4ad5268888c358048f6045a7dc135c4d"></a><!-- doxytag: member="res_phoneprov.c::set_timezone_variables" ref="a4ad5268888c358048f6045a7dc135c4d" args="(struct varshead *headp, const char *zone)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void set_timezone_variables </td>
          <td>(</td>
          <td class="paramtype">struct varshead *&nbsp;</td>
          <td class="paramname"> <em>headp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>zone</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set all timezone-related variables based on a zone (i.e. America/New_York). </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>headp</em>&nbsp;</td><td>pointer to list of <a class="el" href="structuser.html" title="structure to hold users read from users.conf">user</a> variables </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>zone</em>&nbsp;</td><td>A time zone. NULL sets variables based on timezone of the machine </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00344">344</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>References <a class="el" href="localtime_8c_source.html#l01320">ast_get_dst_info()</a>, <a class="el" href="linkedlists_8h_source.html#l00715">AST_LIST_INSERT_TAIL</a>, <a class="el" href="localtime_8c_source.html#l01305">ast_localtime()</a>, <a class="el" href="chanvars_8c_source.html#l00037">ast_var_assign()</a>, <a class="el" href="localtime_8h_source.html#l00030">ast_tm::tm_hour</a>, <a class="el" href="localtime_8h_source.html#l00031">ast_tm::tm_mday</a>, <a class="el" href="localtime_8h_source.html#l00032">ast_tm::tm_mon</a>, and <a class="el" href="ast__expr2f_8c_source.html#l00613">var</a>.</p>

<p>Referenced by <a class="el" href="res__phoneprov_8c_source.html#l00709">build_extension()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00345"></a>00345 {
<a name="l00346"></a>00346    time_t utc_time;
<a name="l00347"></a>00347    <span class="keywordtype">int</span> dstenable;
<a name="l00348"></a>00348    time_t dststart;
<a name="l00349"></a>00349    time_t dstend;
<a name="l00350"></a>00350    <span class="keyword">struct </span><a class="code" href="structast__tm.html">ast_tm</a> tm_info;
<a name="l00351"></a>00351    <span class="keywordtype">int</span> tzoffset;
<a name="l00352"></a>00352    <span class="keywordtype">char</span> buffer[21];
<a name="l00353"></a>00353    <span class="keyword">struct </span><a class="code" href="structast__var__t.html">ast_var_t</a> *<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>;
<a name="l00354"></a>00354    <span class="keyword">struct </span>timeval when;
<a name="l00355"></a>00355 
<a name="l00356"></a>00356    time(&amp;utc_time);
<a name="l00357"></a>00357    <a class="code" href="localtime_8h.html#aad52af6afe205a03aecf3fa6518dbdb0">ast_get_dst_info</a>(&amp;utc_time, &amp;dstenable, &amp;dststart, &amp;dstend, &amp;tzoffset, zone);
<a name="l00358"></a>00358    snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;%d&quot;</span>, tzoffset);
<a name="l00359"></a>00359    var = <a class="code" href="chanvars_8h.html#a8ea2b5a29fa275115c7ed27a593b727d">ast_var_assign</a>(<span class="stringliteral">&quot;TZOFFSET&quot;</span>, buffer);
<a name="l00360"></a>00360    <span class="keywordflow">if</span> (var)
<a name="l00361"></a>00361       <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(headp, var, entries);
<a name="l00362"></a>00362 
<a name="l00363"></a>00363    <span class="keywordflow">if</span> (!dstenable)
<a name="l00364"></a>00364       <span class="keywordflow">return</span>;
<a name="l00365"></a>00365 
<a name="l00366"></a>00366    <span class="keywordflow">if</span> ((var = <a class="code" href="chanvars_8h.html#a8ea2b5a29fa275115c7ed27a593b727d">ast_var_assign</a>(<span class="stringliteral">&quot;DST_ENABLE&quot;</span>, <span class="stringliteral">&quot;1&quot;</span>)))
<a name="l00367"></a>00367       <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(headp, var, entries);
<a name="l00368"></a>00368 
<a name="l00369"></a>00369    when.tv_sec = dststart;
<a name="l00370"></a>00370    <a class="code" href="localtime_8h.html#ae9fbda728350a9a5b9c09b29214d718e" title="Timezone-independent version of localtime_r(3).">ast_localtime</a>(&amp;when, &amp;tm_info, zone);
<a name="l00371"></a>00371 
<a name="l00372"></a>00372    snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;%d&quot;</span>, tm_info.tm_mon+1);
<a name="l00373"></a>00373    <span class="keywordflow">if</span> ((var = <a class="code" href="chanvars_8h.html#a8ea2b5a29fa275115c7ed27a593b727d">ast_var_assign</a>(<span class="stringliteral">&quot;DST_START_MONTH&quot;</span>, buffer)))
<a name="l00374"></a>00374       <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(headp, var, entries);
<a name="l00375"></a>00375 
<a name="l00376"></a>00376    snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;%d&quot;</span>, tm_info.tm_mday);
<a name="l00377"></a>00377    <span class="keywordflow">if</span> ((var = <a class="code" href="chanvars_8h.html#a8ea2b5a29fa275115c7ed27a593b727d">ast_var_assign</a>(<span class="stringliteral">&quot;DST_START_MDAY&quot;</span>, buffer)))
<a name="l00378"></a>00378       <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(headp, var, entries);
<a name="l00379"></a>00379 
<a name="l00380"></a>00380    snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;%d&quot;</span>, tm_info.tm_hour);
<a name="l00381"></a>00381    <span class="keywordflow">if</span> ((var = <a class="code" href="chanvars_8h.html#a8ea2b5a29fa275115c7ed27a593b727d">ast_var_assign</a>(<span class="stringliteral">&quot;DST_START_HOUR&quot;</span>, buffer)))
<a name="l00382"></a>00382       <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(headp, var, entries);
<a name="l00383"></a>00383 
<a name="l00384"></a>00384    when.tv_sec = dstend;
<a name="l00385"></a>00385    <a class="code" href="localtime_8h.html#ae9fbda728350a9a5b9c09b29214d718e" title="Timezone-independent version of localtime_r(3).">ast_localtime</a>(&amp;when, &amp;tm_info, zone);
<a name="l00386"></a>00386 
<a name="l00387"></a>00387    snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;%d&quot;</span>, tm_info.tm_mon + 1);
<a name="l00388"></a>00388    <span class="keywordflow">if</span> ((var = <a class="code" href="chanvars_8h.html#a8ea2b5a29fa275115c7ed27a593b727d">ast_var_assign</a>(<span class="stringliteral">&quot;DST_END_MONTH&quot;</span>, buffer)))
<a name="l00389"></a>00389       <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(headp, var, entries);
<a name="l00390"></a>00390 
<a name="l00391"></a>00391    snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;%d&quot;</span>, tm_info.tm_mday);
<a name="l00392"></a>00392    <span class="keywordflow">if</span> ((var = <a class="code" href="chanvars_8h.html#a8ea2b5a29fa275115c7ed27a593b727d">ast_var_assign</a>(<span class="stringliteral">&quot;DST_END_MDAY&quot;</span>, buffer)))
<a name="l00393"></a>00393       <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(headp, var, entries);
<a name="l00394"></a>00394 
<a name="l00395"></a>00395    snprintf(buffer, <span class="keyword">sizeof</span>(buffer), <span class="stringliteral">&quot;%d&quot;</span>, tm_info.tm_hour);
<a name="l00396"></a>00396    <span class="keywordflow">if</span> ((var = <a class="code" href="chanvars_8h.html#a8ea2b5a29fa275115c7ed27a593b727d">ast_var_assign</a>(<span class="stringliteral">&quot;DST_END_HOUR&quot;</span>, buffer)))
<a name="l00397"></a>00397       <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(headp, var, entries);
<a name="l00398"></a>00398 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad09fa931f468002152a3cc2d5ce25eae"></a><!-- doxytag: member="res_phoneprov.c::unload_module" ref="ad09fa931f468002152a3cc2d5ce25eae" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int unload_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l01271">1271</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00459">ao2_ref</a>, <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="cli_8c_source.html#l01937">ast_cli_unregister_multiple()</a>, <a class="el" href="pbx_8c_source.html#l03216">ast_custom_function_unregister()</a>, <a class="el" href="http_8c_source.html#l00380">ast_http_uri_unlink()</a>, <a class="el" href="linkedlists_8h_source.html#l00817">AST_LIST_REMOVE_HEAD</a>, <a class="el" href="lock_8h_source.html#l01712">ast_mutex_destroy()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="chanvars_8c_source.html#l00059">ast_var_delete()</a>, <a class="el" href="res__phoneprov_8c_source.html#l01074">delete_profiles()</a>, <a class="el" href="res__phoneprov_8c_source.html#l01060">delete_routes()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00824">delete_users()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00176">global_variables</a>, and <a class="el" href="ast__expr2f_8c_source.html#l00613">var</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01272"></a>01272 {
<a name="l01273"></a>01273    <span class="keyword">struct </span><a class="code" href="structast__var__t.html">ast_var_t</a> *<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>;
<a name="l01274"></a>01274 
<a name="l01275"></a>01275    <a class="code" href="http_8h.html#a33e436ed8aeb33287f1e6cb1c5288a14" title="Unregister a URI handler.">ast_http_uri_unlink</a>(&amp;<a class="code" href="res__phoneprov_8c.html#a9ada7959089cbf06e161d25b89590066">phoneprovuri</a>);
<a name="l01276"></a>01276    <a class="code" href="pbx_8h.html#a965977ea9a3144bc203e0ce7a64680a1" title="Unregister a custom function.">ast_custom_function_unregister</a>(&amp;<a class="code" href="res__phoneprov_8c.html#a4aba47037e53722c9cb9dd97917ac956">pp_each_user_function</a>);
<a name="l01277"></a>01277    <a class="code" href="pbx_8h.html#a965977ea9a3144bc203e0ce7a64680a1" title="Unregister a custom function.">ast_custom_function_unregister</a>(&amp;<a class="code" href="res__phoneprov_8c.html#a4028ff03143c2036f9b6db585e3ba4ab">pp_each_extension_function</a>);
<a name="l01278"></a>01278    <a class="code" href="cli_8h.html#a56b6b59ee2eaa994597a5b0f4e9f9d09" title="Unregister multiple commands.">ast_cli_unregister_multiple</a>(<a class="code" href="res__phoneprov_8c.html#a498b3e866e88c552efa0af7fe6a5b653">pp_cli</a>, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="res__phoneprov_8c.html#a498b3e866e88c552efa0af7fe6a5b653">pp_cli</a>));
<a name="l01279"></a>01279 
<a name="l01280"></a>01280    <a class="code" href="res__phoneprov_8c.html#aa2a1b5e37b1426df4284c132cd785ef7" title="Delete all http routes, freeing their memory.">delete_routes</a>();
<a name="l01281"></a>01281    <a class="code" href="res__phoneprov_8c.html#ace322a3e8008af8b872b72770e97fa85" title="Delete all users.">delete_users</a>();
<a name="l01282"></a>01282    <a class="code" href="res__phoneprov_8c.html#a97d13891245936affb35e4dfadcb25e8" title="Delete all phone profiles, freeing their memory.">delete_profiles</a>();
<a name="l01283"></a>01283    <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(<a class="code" href="res__phoneprov_8c.html#aa1076cae3e9e8548ec08760e2cac64f8">profiles</a>, -1);
<a name="l01284"></a>01284    <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(<a class="code" href="res__phoneprov_8c.html#a942fc912551220a86dc49f2fb79b756a">http_routes</a>, -1);
<a name="l01285"></a>01285    <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(<a class="code" href="structusers.html" title="list of users found in the config file">users</a>, -1);
<a name="l01286"></a>01286 
<a name="l01287"></a>01287    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;<a class="code" href="res__phoneprov_8c.html#ac5e1d00d9d447cc961b9e31a34a96507">globals_lock</a>);
<a name="l01288"></a>01288    <span class="keywordflow">while</span> ((var = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;<a class="code" href="res__phoneprov_8c.html#a99146593ce920142bad553c2180d0f17" title="List of global variables currently available: VOICEMAIL_EXTEN, EXTENSION_LENGTH.">global_variables</a>, entries))) {
<a name="l01289"></a>01289       <a class="code" href="chanvars_8h.html#a52aaa758ed30031250c2d356b993c6d9">ast_var_delete</a>(var);
<a name="l01290"></a>01290    }
<a name="l01291"></a>01291    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="res__phoneprov_8c.html#ac5e1d00d9d447cc961b9e31a34a96507">globals_lock</a>);
<a name="l01292"></a>01292 
<a name="l01293"></a>01293    <a class="code" href="lock_8h.html#ab237e70b569019bfb490ab0c3c09b8c5">ast_mutex_destroy</a>(&amp;<a class="code" href="res__phoneprov_8c.html#ac5e1d00d9d447cc961b9e31a34a96507">globals_lock</a>);
<a name="l01294"></a>01294 
<a name="l01295"></a>01295    <span class="keywordflow">return</span> 0;
<a name="l01296"></a>01296 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3e90ce2ee41dc4e5efb73411c455f73d"></a><!-- doxytag: member="res_phoneprov.c::unref_profile" ref="a3e90ce2ee41dc4e5efb73411c455f73d" args="(struct phone_profile *prof)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structphone__profile.html">phone_profile</a>* unref_profile </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structphone__profile.html">phone_profile</a> *&nbsp;</td>
          <td class="paramname"> <em>prof</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00226">226</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00459">ao2_ref</a>.</p>

<p>Referenced by <a class="el" href="res__phoneprov_8c_source.html#l00583">build_profile()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00838">build_user()</a>, <a class="el" href="res__phoneprov_8c_source.html#l01074">delete_profiles()</a>, and <a class="el" href="res__phoneprov_8c_source.html#l00807">user_destructor()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00227"></a>00227 {
<a name="l00228"></a>00228    <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(prof, -1);
<a name="l00229"></a>00229 
<a name="l00230"></a>00230    <span class="keywordflow">return</span> NULL;
<a name="l00231"></a>00231 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5ff17e8d1cc95b424aceff81e8f99ca6"></a><!-- doxytag: member="res_phoneprov.c::unref_route" ref="a5ff17e8d1cc95b424aceff81e8f99ca6" args="(struct http_route *route)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structhttp__route.html">http_route</a>* unref_route </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structhttp__route.html">http_route</a> *&nbsp;</td>
          <td class="paramname"> <em>route</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00282">282</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00459">ao2_ref</a>.</p>

<p>Referenced by <a class="el" href="res__phoneprov_8c_source.html#l00556">build_route()</a>, <a class="el" href="res__phoneprov_8c_source.html#l01060">delete_routes()</a>, <a class="el" href="res__phoneprov_8c_source.html#l01193">handle_show_routes()</a>, and <a class="el" href="res__phoneprov_8c_source.html#l00401">phoneprov_callback()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00283"></a>00283 {
<a name="l00284"></a>00284    <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(route, -1);
<a name="l00285"></a>00285 
<a name="l00286"></a>00286    <span class="keywordflow">return</span> NULL;
<a name="l00287"></a>00287 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a61177e129b4f8b4a11498f33773ccc1b"></a><!-- doxytag: member="res_phoneprov.c::unref_user" ref="a61177e129b4f8b4a11498f33773ccc1b" args="(struct user *user)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structuser.html">user</a>* unref_user </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structuser.html">user</a> *&nbsp;</td>
          <td class="paramname"> <em>user</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00775">775</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00459">ao2_ref</a>.</p>

<p>Referenced by <a class="el" href="res__phoneprov_8c_source.html#l00838">build_user()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00824">delete_users()</a>, <a class="el" href="res__phoneprov_8c_source.html#l01131">pp_each_extension_exec()</a>, <a class="el" href="res__phoneprov_8c_source.html#l01088">pp_each_user_exec()</a>, and <a class="el" href="res__phoneprov_8c_source.html#l00912">set_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00776"></a>00776 {
<a name="l00777"></a>00777    <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(user, -1);
<a name="l00778"></a>00778 
<a name="l00779"></a>00779    <span class="keywordflow">return</span> NULL;
<a name="l00780"></a>00780 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6581f3b0ba4bf46395cc66968f9c4ff8"></a><!-- doxytag: member="res_phoneprov.c::user_destructor" ref="a6581f3b0ba4bf46395cc66968f9c4ff8" args="(void *obj)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void user_destructor </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>obj</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Free all memory associated with a <a class="el" href="structuser.html" title="structure to hold users read from users.conf">user</a>. </p>

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00807">807</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00817">AST_LIST_REMOVE_HEAD</a>, <a class="el" href="stringfields_8h_source.html#l00245">ast_string_field_free_memory</a>, <a class="el" href="res__phoneprov_8c_source.html#l00695">delete_extension()</a>, <a class="el" href="chan__alsa_8c_source.html#l00107">exten</a>, <a class="el" href="structuser.html#a33ffb23cb386d3228aa6164ded55c341">user::extensions</a>, <a class="el" href="res__phoneprov_8c_source.html#l00140">user::profile</a>, and <a class="el" href="res__phoneprov_8c_source.html#l00226">unref_profile()</a>.</p>

<p>Referenced by <a class="el" href="res__phoneprov_8c_source.html#l00838">build_user()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00808"></a>00808 {
<a name="l00809"></a>00809    <span class="keyword">struct </span><a class="code" href="structuser.html" title="structure to hold users read from users.conf">user</a> *<a class="code" href="structuser.html" title="structure to hold users read from users.conf">user</a> = obj;
<a name="l00810"></a>00810    <span class="keyword">struct </span><a class="code" href="structextension.html">extension</a> *<a class="code" href="chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>;
<a name="l00811"></a>00811 
<a name="l00812"></a>00812    <span class="keywordflow">while</span> ((exten = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;user-&gt;<a class="code" href="structuser.html#a33ffb23cb386d3228aa6164ded55c341">extensions</a>, <a class="code" href="structextension.html#a27681bb9c1eff7bae46d2f35b10626b7">entry</a>))) {
<a name="l00813"></a>00813       exten = <a class="code" href="res__phoneprov_8c.html#a44b45903a5a6b50bcd11b446f7635ffc">delete_extension</a>(exten);
<a name="l00814"></a>00814    }
<a name="l00815"></a>00815 
<a name="l00816"></a>00816    <span class="keywordflow">if</span> (user-&gt;<a class="code" href="structuser.html#a688799bff398633f247e35a105013ac3">profile</a>) {
<a name="l00817"></a>00817       user-&gt;<a class="code" href="structuser.html#a688799bff398633f247e35a105013ac3">profile</a> = <a class="code" href="res__phoneprov_8c.html#a3e90ce2ee41dc4e5efb73411c455f73d">unref_profile</a>(user-&gt;<a class="code" href="structuser.html#a688799bff398633f247e35a105013ac3">profile</a>);
<a name="l00818"></a>00818    }
<a name="l00819"></a>00819 
<a name="l00820"></a>00820    <a class="code" href="stringfields_8h.html#abf60f862ae6a141d2f86a0f5e82792de" title="free all memory - to be called before destroying the object">ast_string_field_free_memory</a>(user);
<a name="l00821"></a>00821 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a14b35d5095ca99ff94af78bc1c32a5f3"></a><!-- doxytag: member="res_phoneprov.c::users_cmp_fn" ref="a14b35d5095ca99ff94af78bc1c32a5f3" args="(void *obj, void *arg, int flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int users_cmp_fn </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>arg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00799">799</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00653">CMP_MATCH</a>, <a class="el" href="astobj2_8h_source.html#l00654">CMP_STOP</a>, and <a class="el" href="res__phoneprov_8c_source.html#l00139">user::macaddress</a>.</p>

<p>Referenced by <a class="el" href="res__phoneprov_8c_source.html#l01250">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00800"></a>00800 {
<a name="l00801"></a>00801    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structuser.html" title="structure to hold users read from users.conf">user</a> *user1 = obj, *user2 = arg;
<a name="l00802"></a>00802 
<a name="l00803"></a>00803    <span class="keywordflow">return</span> !strcasecmp(user1-&gt;<a class="code" href="structuser.html#a43de8de44949a0033b3cbe2fbb3ae523">macaddress</a>, user2-&gt;macaddress) ? <a class="code" href="astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a> | <a class="code" href="astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df">CMP_STOP</a> : 0;
<a name="l00804"></a>00804 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4d703ea2245933e511f79e52c7c349aa"></a><!-- doxytag: member="res_phoneprov.c::users_hash_fn" ref="a4d703ea2245933e511f79e52c7c349aa" args="(const void *obj, const int flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int users_hash_fn </td>
          <td>(</td>
          <td class="paramtype">const void *&nbsp;</td>
          <td class="paramname"> <em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&nbsp;</td>
          <td class="paramname"> <em>flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00792">792</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>References <a class="el" href="strings_8h_source.html#l00896">ast_str_case_hash()</a>, and <a class="el" href="res__phoneprov_8c_source.html#l00139">user::macaddress</a>.</p>

<p>Referenced by <a class="el" href="res__phoneprov_8c_source.html#l01250">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00793"></a>00793 {
<a name="l00794"></a>00794    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structuser.html" title="structure to hold users read from users.conf">user</a> *<a class="code" href="structuser.html" title="structure to hold users read from users.conf">user</a> = obj;
<a name="l00795"></a>00795 
<a name="l00796"></a>00796    <span class="keywordflow">return</span> <a class="code" href="strings_8h.html#ab08f8db2a7258e538a0da7417f58db58" title="Compute a hash value on a case-insensitive string.">ast_str_case_hash</a>(user-&gt;<a class="code" href="structuser.html#a43de8de44949a0033b3cbe2fbb3ae523">macaddress</a>);
<a name="l00797"></a>00797 }
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="ab22f32016155f7f403e7178767163d7d"></a><!-- doxytag: member="res_phoneprov.c::__mod_info" ref="ab22f32016155f7f403e7178767163d7d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__module__info.html">ast_module_info</a> <a class="el" href="res__timing__timerfd_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a> = { .<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = AST_MODULE, .flags = AST_MODFLAG_GLOBAL_SYMBOLS , .<a class="el" href="callerid_8c.html#a68344fa88cf4e86b5079fd69a5c22d57">description</a> = &quot;HTTP Phone Provisioning&quot; , .key = &quot;This paragraph is copyright (c) 2006 by Digium, Inc. \In order for your module to load, it must return this \key via a function called \&quot;key\&quot;. Any code which \includes this paragraph must be licensed under the GNU \General Public License <a class="el" href="res__config__pgsql_8c.html#aad880fc4455c253781e8968f2239d56f">version</a> 2 or later (at your \option). In addition to Digium's general reservations \of rights, Digium expressly reserves the right to \allow other parties to license this paragraph under \different terms. Any use of Digium, Inc. trademarks or \logos (including \&quot;Asterisk\&quot; or \&quot;Digium\&quot;) without \express written <a class="el" href="structpermission.html">permission</a> of Digium, Inc. is prohibited.\n&quot; , .buildopt_sum = &quot;aefddfaffd51bc118c14a748e96eb9a0&quot; , .load = load_module, .unload = unload_module, .reload = reload, }<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l01321">1321</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

</div>
</div>
<a class="anchor" id="a1d084b82cb21102ba46ea60d3cd9c085"></a><!-- doxytag: member="res_phoneprov.c::__ourip" ref="a1d084b82cb21102ba46ea60d3cd9c085" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct in_addr <a class="el" href="res__phoneprov_8c.html#a1d084b82cb21102ba46ea60d3cd9c085">__ourip</a> = { .s_addr = 0x00000000, }<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>for use in lookup_iface </p>

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00069">69</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae25b9f3970870610911f8850897e8ead"></a><!-- doxytag: member="res_phoneprov.c::ast_module_info" ref="ae25b9f3970870610911f8850897e8ead" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__module__info.html">ast_module_info</a>* <a class="el" href="structast__module__info.html">ast_module_info</a> = &amp;<a class="el" href="res__timing__timerfd_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l01321">1321</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

</div>
</div>
<a class="anchor" id="a71ac783a3ca66bd546dc964f1dd0e0f0"></a><!-- doxytag: member="res_phoneprov.c::ext" ref="a71ac783a3ca66bd546dc964f1dd0e0f0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* <a class="el" href="res__phoneprov_8c.html#a71ac783a3ca66bd546dc964f1dd0e0f0">ext</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00160">160</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

</div>
</div>
<a class="anchor" id="a0b98d7043ca0b2bd43b0314237bc8587"></a><!-- doxytag: member="res_phoneprov.c::global_default_profile" ref="a0b98d7043ca0b2bd43b0314237bc8587" args="[80]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="res__phoneprov_8c.html#a0b98d7043ca0b2bd43b0314237bc8587">global_default_profile</a>[80] = &quot;&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Default profile to use if one isn't specified </p>

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00173">173</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

</div>
</div>
<a class="anchor" id="a87e6df5f528d302bdc2905048211c0ab"></a><!-- doxytag: member="res_phoneprov.c::global_server" ref="a87e6df5f528d302bdc2905048211c0ab" args="[80]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="res__phoneprov_8c.html#a87e6df5f528d302bdc2905048211c0ab">global_server</a>[80] = &quot;&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Server to substitute into templates </p>

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00171">171</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

</div>
</div>
<a class="anchor" id="a1239e5c2af085094329f54fd64458de8"></a><!-- doxytag: member="res_phoneprov.c::global_serverport" ref="a1239e5c2af085094329f54fd64458de8" args="[6]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="res__phoneprov_8c.html#a1239e5c2af085094329f54fd64458de8">global_serverport</a>[6] = &quot;&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Server port to substitute into templates </p>

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00172">172</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

</div>
</div>
<a class="anchor" id="a99146593ce920142bad553c2180d0f17"></a><!-- doxytag: member="res_phoneprov.c::global_variables" ref="a99146593ce920142bad553c2180d0f17" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct varshead <a class="el" href="res__phoneprov_8c.html#a99146593ce920142bad553c2180d0f17">global_variables</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>List of global variables currently available: VOICEMAIL_EXTEN, EXTENSION_LENGTH. </p>

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00176">176</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>Referenced by <a class="el" href="res__phoneprov_8c_source.html#l00583">build_profile()</a>, <a class="el" href="res__phoneprov_8c_source.html#l01250">load_module()</a>, <a class="el" href="res__phoneprov_8c_source.html#l01298">reload()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00912">set_config()</a>, and <a class="el" href="res__phoneprov_8c_source.html#l01271">unload_module()</a>.</p>

</div>
</div>
<a class="anchor" id="ac5e1d00d9d447cc961b9e31a34a96507"></a><!-- doxytag: member="res_phoneprov.c::globals_lock" ref="ac5e1d00d9d447cc961b9e31a34a96507" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="lock_8h.html#a2d9118a2a8939f115eea771bce3a52f2">ast_mutex_t</a> <a class="el" href="res__phoneprov_8c.html#ac5e1d00d9d447cc961b9e31a34a96507">globals_lock</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00177">177</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

<p>Referenced by <a class="el" href="chan__console_8c_source.html#l01384">load_config()</a>, and <a class="el" href="chan__console_8c_source.html#l01229">set_pvt_defaults()</a>.</p>

</div>
</div>
<a class="anchor" id="a942fc912551220a86dc49f2fb79b756a"></a><!-- doxytag: member="res_phoneprov.c::http_routes" ref="a942fc912551220a86dc49f2fb79b756a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structao2__container.html">ao2_container</a>* <a class="el" href="res__phoneprov_8c.html#a942fc912551220a86dc49f2fb79b756a">http_routes</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00155">155</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

</div>
</div>
<a class="anchor" id="a1fcea5c467a2309e3c4f2ca36c0dde06"></a><!-- doxytag: member="res_phoneprov.c::mimetypes" ref="a1fcea5c467a2309e3c4f2ca36c0dde06" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct { ... }   <a class="el" href="res__phoneprov_8c.html#a1fcea5c467a2309e3c4f2ca36c0dde06">mimetypes</a>[]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Extensions whose mime types we think we know. </p>

<p>Referenced by <a class="el" href="res__phoneprov_8c_source.html#l00180">ftype2mtype()</a>.</p>

</div>
</div>
<a class="anchor" id="aff336343ef8b74fa572dd6e820a53580"></a><!-- doxytag: member="res_phoneprov.c::mtype" ref="aff336343ef8b74fa572dd6e820a53580" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* <a class="el" href="res__phoneprov_8c.html#aff336343ef8b74fa572dd6e820a53580">mtype</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00161">161</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

</div>
</div>
<a class="anchor" id="a9ada7959089cbf06e161d25b89590066"></a><!-- doxytag: member="res_phoneprov.c::phoneprovuri" ref="a9ada7959089cbf06e161d25b89590066" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__http__uri.html">ast_http_uri</a> <a class="el" href="res__phoneprov_8c.html#a9ada7959089cbf06e161d25b89590066">phoneprovuri</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l01240">1240</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

</div>
</div>
<a class="anchor" id="a498b3e866e88c552efa0af7fe6a5b653"></a><!-- doxytag: member="res_phoneprov.c::pp_cli" ref="a498b3e866e88c552efa0af7fe6a5b653" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> <a class="el" href="res__phoneprov_8c.html#a498b3e866e88c552efa0af7fe6a5b653">pp_cli</a>[]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
   <a class="code" href="cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="res__phoneprov_8c.html#a48654ad7e70178777fa21bd6f8b9b7ba" title="CLI command to list static and dynamic routes.">handle_show_routes</a>, <span class="stringliteral">&quot;Show registered phoneprov http routes&quot;</span>),
}
</pre></div>
<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l01236">1236</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

</div>
</div>
<a class="anchor" id="a4028ff03143c2036f9b6db585e3ba4ab"></a><!-- doxytag: member="res_phoneprov.c::pp_each_extension_function" ref="a4028ff03143c2036f9b6db585e3ba4ab" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__custom__function.html">ast_custom_function</a> <a class="el" href="res__phoneprov_8c.html#a4028ff03143c2036f9b6db585e3ba4ab">pp_each_extension_function</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l01182">1182</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

</div>
</div>
<a class="anchor" id="a4aba47037e53722c9cb9dd97917ac956"></a><!-- doxytag: member="res_phoneprov.c::pp_each_user_function" ref="a4aba47037e53722c9cb9dd97917ac956" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__custom__function.html">ast_custom_function</a> <a class="el" href="res__phoneprov_8c.html#a4aba47037e53722c9cb9dd97917ac956">pp_each_user_function</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l01117">1117</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

</div>
</div>
<a class="anchor" id="a7fb110e85f1fb61a98b5d8c756111fba"></a><!-- doxytag: member="res_phoneprov.c::pp_variable_list" ref="a7fb110e85f1fb61a98b5d8c756111fba" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structpp__variable__lookup.html">pp_variable_lookup</a>  <a class="el" href="res__phoneprov_8c.html#a7fb110e85f1fb61a98b5d8c756111fba">pp_variable_list</a>[]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Lookup table to translate between users.conf property names and variables for use in phoneprov templates. </p>

<p>Referenced by <a class="el" href="res__phoneprov_8c_source.html#l00709">build_extension()</a>.</p>

</div>
</div>
<a class="anchor" id="aa1076cae3e9e8548ec08760e2cac64f8"></a><!-- doxytag: member="res_phoneprov.c::profiles" ref="aa1076cae3e9e8548ec08760e2cac64f8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structao2__container.html">ao2_container</a>* <a class="el" href="res__phoneprov_8c.html#aa1076cae3e9e8548ec08760e2cac64f8">profiles</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00154">154</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

</div>
</div>
<a class="anchor" id="a83dc8a4d62a5fdcd27ed6756cdaeb114"></a><!-- doxytag: member="res_phoneprov.c::users" ref="a83dc8a4d62a5fdcd27ed6756cdaeb114" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structao2__container.html">ao2_container</a>* <a class="el" href="structusers.html">users</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__phoneprov_8c_source.html#l00156">156</a> of file <a class="el" href="res__phoneprov_8c_source.html">res_phoneprov.c</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:23:17 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
