<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:23:30 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_1ab815038f534adda65c8b4ae4993449.html">include</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_16d825f1fa9ecca2e70b1a8d9256d0e6.html">asterisk</a>
  </div>
</div>
<div class="contents">
<h1>sched.h File Reference</h1>
<p>Scheduler Routines (derived from cheops).  
<a href="#_details">More...</a></p>

<p><a href="sched_8h_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__cb__names.html">ast_cb_names</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sched_8h.html#a8dd97314cf269a1f6387a7e04d3d9144">ast_sched_add_object</a>(obj, con, when, callback)&nbsp;&nbsp;&nbsp;ast_sched_add((con),(when),(callback), ASTOBJ_REF((obj)))</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Convenience macro for objects and reference (add).  <a href="#a8dd97314cf269a1f6387a7e04d3d9144"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sched_8h.html#a6a74d5602663e650bf5c5849d260a761">AST_SCHED_CB</a>(a)&nbsp;&nbsp;&nbsp;((<a class="el" href="sched_8h.html#a57358d80decb5b8ddde4d2e7f1919b87">ast_sched_cb</a>)(a))</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sched_8h.html#a25647782014f8dc012994efcd1b81d32">AST_SCHED_DEL</a>(<a class="el" href="structsched.html">sched</a>, <a class="el" href="res__ais_8c.html#a2465fd4497a7402ad72da7d6e03f9934">id</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">a loop construct to ensure that the scheduled task get deleted. The idea is that if we loop attempting to remove the scheduled task, then whatever callback had been running will complete and reinsert the task into the scheduler.  <a href="#a25647782014f8dc012994efcd1b81d32"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sched_8h.html#ab72eddb165b369a7b2963b2bc451548a">ast_sched_del_object</a>(obj, destructor, con, <a class="el" href="res__ais_8c.html#a2465fd4497a7402ad72da7d6e03f9934">id</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Convenience macro for objects and reference (del).  <a href="#ab72eddb165b369a7b2963b2bc451548a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sched_8h.html#aa7d804569b31559a8a70baa8f4b69828">AST_SCHED_DEL_SPINLOCK</a>(<a class="el" href="structsched.html">sched</a>, <a class="el" href="res__ais_8c.html#a2465fd4497a7402ad72da7d6e03f9934">id</a>, <a class="el" href="res__timing__pthread_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">schedule task to get deleted releasing the lock between attempts  <a href="#aa7d804569b31559a8a70baa8f4b69828"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sched_8h.html#a11e2d4283c11790a27a0f899dab00e93">AST_SCHED_DEL_UNREF</a>(<a class="el" href="structsched.html">sched</a>, <a class="el" href="res__ais_8c.html#a2465fd4497a7402ad72da7d6e03f9934">id</a>, refcall)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">schedule task to get deleted and call unref function  <a href="#a11e2d4283c11790a27a0f899dab00e93"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sched_8h.html#a3482be3590d695edd576355379040d62">AST_SCHED_REPLACE</a>(<a class="el" href="res__ais_8c.html#a2465fd4497a7402ad72da7d6e03f9934">id</a>, <a class="el" href="structsched.html">sched</a>, when, callback, data)&nbsp;&nbsp;&nbsp;AST_SCHED_REPLACE_VARIABLE(<a class="el" href="res__ais_8c.html#a2465fd4497a7402ad72da7d6e03f9934">id</a>, <a class="el" href="structsched.html">sched</a>, when, callback, data, 0)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sched_8h.html#a2a9174d10a79bd233b8498a11201f681">AST_SCHED_REPLACE_UNREF</a>(<a class="el" href="res__ais_8c.html#a2465fd4497a7402ad72da7d6e03f9934">id</a>, <a class="el" href="structsched.html">sched</a>, when, callback, data, unrefcall, addfailcall, refcall)&nbsp;&nbsp;&nbsp;AST_SCHED_REPLACE_VARIABLE_UNREF(<a class="el" href="res__ais_8c.html#a2465fd4497a7402ad72da7d6e03f9934">id</a>, <a class="el" href="structsched.html">sched</a>, when, callback, data, 0, unrefcall, addfailcall, refcall)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sched_8h.html#a8fa3e1748a3d4c853da0aac32c97b39b">AST_SCHED_REPLACE_VARIABLE</a>(<a class="el" href="res__ais_8c.html#a2465fd4497a7402ad72da7d6e03f9934">id</a>, <a class="el" href="structsched.html">sched</a>, when, callback, data, variable)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sched_8h.html#a5e19d067be27b20ccf96200834cf246d">AST_SCHED_REPLACE_VARIABLE_UNREF</a>(<a class="el" href="res__ais_8c.html#a2465fd4497a7402ad72da7d6e03f9934">id</a>, <a class="el" href="structsched.html">sched</a>, when, callback, data, variable, unrefcall, addfailcall, refcall)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sched_8h.html#a9b0b3840f944b8ac512d88f1f0f44a12">ast_sched_thread_del</a>(st, <a class="el" href="res__ais_8c.html#a2465fd4497a7402ad72da7d6e03f9934">id</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Delete a scheduler entry.  <a href="#a9b0b3840f944b8ac512d88f1f0f44a12"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sched_8h.html#a420efb88d10a08a78fe7713d529c6e54">SCHED_MAX_CACHE</a>&nbsp;&nbsp;&nbsp;128</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Max num of schedule structs.  <a href="#a420efb88d10a08a78fe7713d529c6e54"></a><br/></td></tr>
<tr><td colspan="2"><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef int(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sched_8h.html#a57358d80decb5b8ddde4d2e7f1919b87">ast_sched_cb</a> )(const void *data)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">callback for a cheops scheduler A cheops scheduler callback takes a pointer with callback data and  <a href="#a57358d80decb5b8ddde4d2e7f1919b87"></a><br/></td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sched_8h.html#a97176531282ac4e70aa107b2e8ee5543">ast_sched_add</a> (struct <a class="el" href="structsched__context.html">sched_context</a> *con, int when, <a class="el" href="sched_8h.html#a57358d80decb5b8ddde4d2e7f1919b87">ast_sched_cb</a> callback, const void *data) attribute_warn_unused_result</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Adds a scheduled event Schedule an event to take place at some point in the future. callback will be called with data as the argument, when milliseconds into the future (approximately) If callback returns 0, no further events will be re-scheduled.  <a href="#a97176531282ac4e70aa107b2e8ee5543"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sched_8h.html#a5d738bcc3c3d38165a59a17a35f6ca2c">ast_sched_add_variable</a> (struct <a class="el" href="structsched__context.html">sched_context</a> *con, int when, <a class="el" href="sched_8h.html#a57358d80decb5b8ddde4d2e7f1919b87">ast_sched_cb</a> callback, const void *data, int variable) attribute_warn_unused_result</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Schedule callback(data) to happen when ms into the future.  <a href="#a5d738bcc3c3d38165a59a17a35f6ca2c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sched_8h.html#ae7bd726b811accba953137fb35b6121d">ast_sched_del</a> (struct <a class="el" href="structsched__context.html">sched_context</a> *con, int <a class="el" href="res__ais_8c.html#a2465fd4497a7402ad72da7d6e03f9934">id</a>) attribute_warn_unused_result</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Deletes a scheduled event Remove this event from being run. A procedure should not remove its own event, but return 0 instead. In most cases, you should not call this routine directly, but use the <a class="el" href="sched_8h.html#a25647782014f8dc012994efcd1b81d32" title="a loop construct to ensure that the scheduled task get deleted. The idea is that...">AST_SCHED_DEL()</a> macro instead (especially if you don't intend to do something different when it returns failure).  <a href="#ae7bd726b811accba953137fb35b6121d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sched_8h.html#a1dc19b07e946576cf6521e693ec299c7">ast_sched_dump</a> (struct <a class="el" href="structsched__context.html">sched_context</a> *con)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Dumps the scheduler contents Debugging: Dump the contents of the scheduler to stderr.  <a href="#a1dc19b07e946576cf6521e693ec299c7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sched_8h.html#a99c2cadcc6e49247c6afa8d947bbfe8c">ast_sched_find_data</a> (struct <a class="el" href="structsched__context.html">sched_context</a> *con, int <a class="el" href="res__ais_8c.html#a2465fd4497a7402ad72da7d6e03f9934">id</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Find a <a class="el" href="structsched.html">sched</a> structure and return the data field associated with it.  <a href="#a99c2cadcc6e49247c6afa8d947bbfe8c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sched_8h.html#a7eab5d2605f049f8e9b2724a66151627">ast_sched_replace</a> (int old_id, struct <a class="el" href="structsched__context.html">sched_context</a> *con, int when, <a class="el" href="sched_8h.html#a57358d80decb5b8ddde4d2e7f1919b87">ast_sched_cb</a> callback, const void *data) attribute_warn_unused_result</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">replace a scheduler entry  <a href="#a7eab5d2605f049f8e9b2724a66151627"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sched_8h.html#aeaa1cb4e7793f162b6987014be7ac0f5">ast_sched_replace_variable</a> (int old_id, struct <a class="el" href="structsched__context.html">sched_context</a> *con, int when, <a class="el" href="sched_8h.html#a57358d80decb5b8ddde4d2e7f1919b87">ast_sched_cb</a> callback, const void *data, int variable) attribute_warn_unused_result</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">replace a scheduler entry  <a href="#aeaa1cb4e7793f162b6987014be7ac0f5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sched_8h.html#aaf6c34a7b6152bc3739394c27a871ba1">ast_sched_report</a> (struct <a class="el" href="structsched__context.html">sched_context</a> *con, struct <a class="el" href="structast__str.html">ast_str</a> **<a class="el" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, struct <a class="el" href="structast__cb__names.html">ast_cb_names</a> *cbnames)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Show statics on what it is in the schedule queue.  <a href="#aaf6c34a7b6152bc3739394c27a871ba1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sched_8h.html#a2867b39106061847a8508bf49e38f420">ast_sched_runq</a> (struct <a class="el" href="structsched__context.html">sched_context</a> *con)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Runs the queue.  <a href="#a2867b39106061847a8508bf49e38f420"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sched_8h.html#acc6eead923ec328dcee53559dd3b8b60">ast_sched_thread_add</a> (struct <a class="el" href="structast__sched__thread.html">ast_sched_thread</a> *st, int when, <a class="el" href="sched_8h.html#a57358d80decb5b8ddde4d2e7f1919b87">ast_sched_cb</a> cb, const void *data)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add a scheduler entry.  <a href="#acc6eead923ec328dcee53559dd3b8b60"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sched_8h.html#af845a75ffcb1f4877b3efc48aa9ea5ef">ast_sched_thread_add_variable</a> (struct <a class="el" href="structast__sched__thread.html">ast_sched_thread</a> *st, int when, <a class="el" href="sched_8h.html#a57358d80decb5b8ddde4d2e7f1919b87">ast_sched_cb</a> cb, const void *data, int variable)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add a variable reschedule time scheduler entry.  <a href="#af845a75ffcb1f4877b3efc48aa9ea5ef"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__sched__thread.html">ast_sched_thread</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sched_8h.html#a9bab503a0557af0b8a4fe04d06b69fb3">ast_sched_thread_create</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create a scheduler with a dedicated thread.  <a href="#a9bab503a0557af0b8a4fe04d06b69fb3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__sched__thread.html">ast_sched_thread</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sched_8h.html#a999272a0a148dae5131da23d78050797">ast_sched_thread_destroy</a> (struct <a class="el" href="structast__sched__thread.html">ast_sched_thread</a> *st)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Destroy a scheduler and its thread.  <a href="#a999272a0a148dae5131da23d78050797"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structsched__context.html">sched_context</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sched_8h.html#a2574d6d3ccdc66ecbc78501f237b59db">ast_sched_thread_get_context</a> (struct <a class="el" href="structast__sched__thread.html">ast_sched_thread</a> *st)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get the scheduler context for a given <a class="el" href="structast__sched__thread.html">ast_sched_thread</a>.  <a href="#a2574d6d3ccdc66ecbc78501f237b59db"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sched_8h.html#ab523defdc0b36cdf629eb81b7b5a20d6">ast_sched_thread_poke</a> (struct <a class="el" href="structast__sched__thread.html">ast_sched_thread</a> *st)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Force re-processing of the scheduler context.  <a href="#ab523defdc0b36cdf629eb81b7b5a20d6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sched_8h.html#a64797d66b6051095debfcdb7f790e605">ast_sched_wait</a> (struct <a class="el" href="structsched__context.html">sched_context</a> *con) attribute_warn_unused_result</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Determines <a class="el" href="structnumber.html" title="Number structure.">number</a> of seconds until the next outstanding event to take place Determine the <a class="el" href="structnumber.html" title="Number structure.">number</a> of seconds until the next outstanding event should take place, and return the <a class="el" href="structnumber.html" title="Number structure.">number</a> of milliseconds until it needs to be run. This value is perfect for passing to the poll call.  <a href="#a64797d66b6051095debfcdb7f790e605"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">long&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sched_8h.html#a7b21967a70222990d1d7267b950f9e66">ast_sched_when</a> (struct <a class="el" href="structsched__context.html">sched_context</a> *con, int <a class="el" href="res__ais_8c.html#a2465fd4497a7402ad72da7d6e03f9934">id</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns the <a class="el" href="structnumber.html" title="Number structure.">number</a> of seconds before an event takes place.  <a href="#a7b21967a70222990d1d7267b950f9e66"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structsched__context.html">sched_context</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sched_8h.html#ad4fd5c63d5d3dcc8e11bec644c601017">sched_context_create</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">New schedule context.  <a href="#ad4fd5c63d5d3dcc8e11bec644c601017"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="sched_8h.html#a7350994bcfd1be91874493dbe25faf0c">sched_context_destroy</a> (struct <a class="el" href="structsched__context.html">sched_context</a> *c)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">destroys a schedule context Destroys (free's) the given <a class="el" href="structsched__context.html">sched_context</a> structure  <a href="#a7350994bcfd1be91874493dbe25faf0c"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Scheduler Routines (derived from cheops). </p>

<p>Definition in file <a class="el" href="sched_8h_source.html">sched.h</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a8dd97314cf269a1f6387a7e04d3d9144"></a><!-- doxytag: member="sched.h::ast_sched_add_object" ref="a8dd97314cf269a1f6387a7e04d3d9144" args="(obj, con, when, callback)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ast_sched_add_object</td>
          <td>(</td>
          <td class="paramtype">obj, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">con, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">when, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">callback&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;ast_sched_add((con),(when),(callback), ASTOBJ_REF((obj)))</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Convenience macro for objects and reference (add). </p>

<p>Definition at line <a class="el" href="sched_8h_source.html#l00295">295</a> of file <a class="el" href="sched_8h_source.html">sched.h</a>.</p>

</div>
</div>
<a class="anchor" id="a6a74d5602663e650bf5c5849d260a761"></a><!-- doxytag: member="sched.h::AST_SCHED_CB" ref="a6a74d5602663e650bf5c5849d260a761" args="(a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_SCHED_CB</td>
          <td>(</td>
          <td class="paramtype">a&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;((<a class="el" href="sched_8h.html#a57358d80decb5b8ddde4d2e7f1919b87">ast_sched_cb</a>)(a))</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="sched_8h_source.html#l00161">161</a> of file <a class="el" href="sched_8h_source.html">sched.h</a>.</p>

</div>
</div>
<a class="anchor" id="a25647782014f8dc012994efcd1b81d32"></a><!-- doxytag: member="sched.h::AST_SCHED_DEL" ref="a25647782014f8dc012994efcd1b81d32" args="(sched, id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_SCHED_DEL</td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsched.html">sched</a>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="res__ais_8c.html#a2465fd4497a7402ad72da7d6e03f9934">id</a>&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>a loop construct to ensure that the scheduled task get deleted. The idea is that if we loop attempting to remove the scheduled task, then whatever callback had been running will complete and reinsert the task into the scheduler. </p>
<p>Since macro expansion essentially works like pass-by-name parameter passing, this macro will still work correctly even if the id of the task to delete changes. This holds as long as the name of the id which could change is passed to the macro and not a copy of the value of the id. </p>

<p>Definition at line <a class="el" href="sched_8h_source.html#l00051">51</a> of file <a class="el" href="sched_8h_source.html">sched.h</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l00443">__oh323_destroy()</a>, <a class="el" href="chan__h323_8c_source.html#l00332">__oh323_update_info()</a>, <a class="el" href="chan__sip_8c_source.html#l03853">__sip_reliable_xmit()</a>, <a class="el" href="chan__sip_8c_source.html#l04116">__sip_semi_ack()</a>, <a class="el" href="pbx__dundi_8c_source.html#l01992">ack_trans()</a>, <a class="el" href="file_8c_source.html#l00887">ast_closestream()</a>, <a class="el" href="rtp_8c_source.html#l03444">ast_rtcp_write_rr()</a>, <a class="el" href="rtp_8c_source.html#l03311">ast_rtcp_write_sr()</a>, <a class="el" href="rtp_8c_source.html#l03058">ast_rtp_destroy()</a>, <a class="el" href="rtp_8c_source.html#l02710">ast_rtp_stop()</a>, <a class="el" href="sched_8c_source.html#l00431">ast_sched_replace()</a>, <a class="el" href="sched_8c_source.html#l00387">ast_sched_replace_variable()</a>, <a class="el" href="chan__mgcp_8c_source.html#l03552">build_gateway()</a>, <a class="el" href="pbx__dundi_8c_source.html#l04371">build_peer()</a>, <a class="el" href="pbx__dundi_8c_source.html#l02947">destroy_packet()</a>, <a class="el" href="pbx__dundi_8c_source.html#l01981">destroy_packets()</a>, <a class="el" href="pbx__dundi_8c_source.html#l04153">destroy_peer()</a>, <a class="el" href="pbx__dundi_8c_source.html#l02956">destroy_trans()</a>, <a class="el" href="chan__sip_8c_source.html#l03161">dialog_unlink_all()</a>, <a class="el" href="dnsmgr_8c_source.html#l00244">dnsmgr_start_refresh()</a>, <a class="el" href="cdr_8c_source.html#l01396">do_reload()</a>, <a class="el" href="file_8c_source.html#l00290">filestream_destructor()</a>, <a class="el" href="pbx__dundi_8c_source.html#l01553">handle_command_response()</a>, <a class="el" href="chan__sip_8c_source.html#l20855">handle_request_cancel()</a>, <a class="el" href="chan__mgcp_8c_source.html#l03294">mgcpsock_read()</a>, <a class="el" href="chan__misdn_8c_source.html#l00833">misdn_tasks_remove()</a>, <a class="el" href="pbx__dundi_8c_source.html#l04324">qualify_peer()</a>, <a class="el" href="chan__h323_8c_source.html#l01827">receive_digit()</a>, <a class="el" href="chan__sip_8c_source.html#l05956">sip_hangup()</a>, <a class="el" href="chan__sip_8c_source.html#l05460">sip_registry_destroy()</a>, <a class="el" href="chan__sip_8c_source.html#l25628">sip_send_all_mwi_subscriptions()</a>, <a class="el" href="chan__sip_8c_source.html#l05484">sip_subscribe_mwi_destroy()</a>, and <a class="el" href="cdr_8c_source.html#l01222">submit_unscheduled_batch()</a>.</p>

</div>
</div>
<a class="anchor" id="ab72eddb165b369a7b2963b2bc451548a"></a><!-- doxytag: member="sched.h::ast_sched_del_object" ref="ab72eddb165b369a7b2963b2bc451548a" args="(obj, destructor, con, id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ast_sched_del_object</td>
          <td>(</td>
          <td class="paramtype">obj, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">destructor, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">con, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="res__ais_8c.html#a2465fd4497a7402ad72da7d6e03f9934">id</a>&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Convenience macro for objects and reference (del). </p>

<p>Definition at line <a class="el" href="sched_8h_source.html#l00301">301</a> of file <a class="el" href="sched_8h_source.html">sched.h</a>.</p>

</div>
</div>
<a class="anchor" id="aa7d804569b31559a8a70baa8f4b69828"></a><!-- doxytag: member="sched.h::AST_SCHED_DEL_SPINLOCK" ref="aa7d804569b31559a8a70baa8f4b69828" args="(sched, id, lock)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_SCHED_DEL_SPINLOCK</td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsched.html">sched</a>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="res__ais_8c.html#a2465fd4497a7402ad72da7d6e03f9934">id</a>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="res__timing__pthread_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>schedule task to get deleted releasing the lock between attempts </p>
<dl class="since"><dt><b>Since:</b></dt><dd>1.6.1 </dd></dl>

<p>Definition at line <a class="el" href="sched_8h_source.html#l00086">86</a> of file <a class="el" href="sched_8h_source.html">sched.h</a>.</p>

<p>Referenced by <a class="el" href="chan__iax2_8c_source.html#l01623">iax2_destroy_helper()</a>.</p>

</div>
</div>
<a class="anchor" id="a11e2d4283c11790a27a0f899dab00e93"></a><!-- doxytag: member="sched.h::AST_SCHED_DEL_UNREF" ref="a11e2d4283c11790a27a0f899dab00e93" args="(sched, id, refcall)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_SCHED_DEL_UNREF</td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsched.html">sched</a>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="res__ais_8c.html#a2465fd4497a7402ad72da7d6e03f9934">id</a>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">refcall&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>schedule task to get deleted and call unref function </p>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="sched_8h.html#a25647782014f8dc012994efcd1b81d32" title="a loop construct to ensure that the scheduled task get deleted. The idea is that...">AST_SCHED_DEL</a> </dd></dl>
<dl class="since"><dt><b>Since:</b></dt><dd>1.6.1 </dd></dl>

<p>Definition at line <a class="el" href="sched_8h_source.html#l00069">69</a> of file <a class="el" href="sched_8h_source.html">sched.h</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l05498">__sip_destroy()</a>, <a class="el" href="chan__sip_8c_source.html#l23690">build_peer()</a>, <a class="el" href="chan__sip_8c_source.html#l03161">dialog_unlink_all()</a>, <a class="el" href="chan__sip_8c_source.html#l21921">handle_request_do()</a>, <a class="el" href="chan__sip_8c_source.html#l17572">handle_response_invite()</a>, <a class="el" href="chan__sip_8c_source.html#l18054">handle_response_register()</a>, <a class="el" href="chan__sip_8c_source.html#l06424">interpret_t38_parameters()</a>, <a class="el" href="chan__sip_8c_source.html#l12222">parse_register_contact()</a>, <a class="el" href="chan__sip_8c_source.html#l24245">reload_config()</a>, <a class="el" href="chan__sip_8c_source.html#l22515">restart_session_timer()</a>, <a class="el" href="chan__sip_8c_source.html#l04197">send_response()</a>, <a class="el" href="chan__sip_8c_source.html#l05956">sip_hangup()</a>, <a class="el" href="chan__sip_8c_source.html#l22876">sip_poke_peer()</a>, <a class="el" href="chan__sip_8c_source.html#l15794">sip_unregister()</a>, <a class="el" href="chan__sip_8c_source.html#l22532">stop_session_timer()</a>, and <a class="el" href="chan__sip_8c_source.html#l04188">update_provisional_keepalive()</a>.</p>

</div>
</div>
<a class="anchor" id="a3482be3590d695edd576355379040d62"></a><!-- doxytag: member="sched.h::AST_SCHED_REPLACE" ref="a3482be3590d695edd576355379040d62" args="(id, sched, when, callback, data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_SCHED_REPLACE</td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="res__ais_8c.html#a2465fd4497a7402ad72da7d6e03f9934">id</a>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structsched.html">sched</a>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">when, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">callback, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">data&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;AST_SCHED_REPLACE_VARIABLE(<a class="el" href="res__ais_8c.html#a2465fd4497a7402ad72da7d6e03f9934">id</a>, <a class="el" href="structsched.html">sched</a>, when, callback, data, 0)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="sched_8h_source.html#l00113">113</a> of file <a class="el" href="sched_8h_source.html">sched.h</a>.</p>

</div>
</div>
<a class="anchor" id="a2a9174d10a79bd233b8498a11201f681"></a><!-- doxytag: member="sched.h::AST_SCHED_REPLACE_UNREF" ref="a2a9174d10a79bd233b8498a11201f681" args="(id, sched, when, callback, data, unrefcall, addfailcall, refcall)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_SCHED_REPLACE_UNREF</td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="res__ais_8c.html#a2465fd4497a7402ad72da7d6e03f9934">id</a>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structsched.html">sched</a>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">when, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">callback, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">data, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unrefcall, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">addfailcall, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">refcall&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;AST_SCHED_REPLACE_VARIABLE_UNREF(<a class="el" href="res__ais_8c.html#a2465fd4497a7402ad72da7d6e03f9934">id</a>, <a class="el" href="structsched.html">sched</a>, when, callback, data, 0, unrefcall, addfailcall, refcall)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="sched_8h_source.html#l00137">137</a> of file <a class="el" href="sched_8h_source.html">sched.h</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l18198">handle_response_peerpoke()</a>, <a class="el" href="chan__sip_8c_source.html#l18054">handle_response_register()</a>, <a class="el" href="chan__sip_8c_source.html#l04739">realtime_peer()</a>, <a class="el" href="chan__sip_8c_source.html#l12075">reg_source_db()</a>, <a class="el" href="chan__sip_8c_source.html#l05373">sip_call()</a>, <a class="el" href="chan__sip_8c_source.html#l25576">sip_poke_all_peers()</a>, <a class="el" href="chan__sip_8c_source.html#l22832">sip_poke_noanswer()</a>, <a class="el" href="chan__sip_8c_source.html#l22876">sip_poke_peer()</a>, <a class="el" href="chan__sip_8c_source.html#l25605">sip_send_all_registers()</a>, and <a class="el" href="chan__sip_8c_source.html#l11545">transmit_register()</a>.</p>

</div>
</div>
<a class="anchor" id="a8fa3e1748a3d4c853da0aac32c97b39b"></a><!-- doxytag: member="sched.h::AST_SCHED_REPLACE_VARIABLE" ref="a8fa3e1748a3d4c853da0aac32c97b39b" args="(id, sched, when, callback, data, variable)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_SCHED_REPLACE_VARIABLE</td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="res__ais_8c.html#a2465fd4497a7402ad72da7d6e03f9934">id</a>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structsched.html">sched</a>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">when, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">callback, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">data, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">variable&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="sched_8h_source.html#l00102">102</a> of file <a class="el" href="sched_8h_source.html">sched.h</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l03853">__sip_reliable_xmit()</a>.</p>

</div>
</div>
<a class="anchor" id="a5e19d067be27b20ccf96200834cf246d"></a><!-- doxytag: member="sched.h::AST_SCHED_REPLACE_VARIABLE_UNREF" ref="a5e19d067be27b20ccf96200834cf246d" args="(id, sched, when, callback, data, variable, unrefcall, addfailcall, refcall)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_SCHED_REPLACE_VARIABLE_UNREF</td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="res__ais_8c.html#a2465fd4497a7402ad72da7d6e03f9934">id</a>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structsched.html">sched</a>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">when, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">callback, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">data, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">variable, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unrefcall, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">addfailcall, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">refcall&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl class="note"><dt><b>Note:</b></dt><dd>Not currently used in the source? </dd></dl>
<dl class="since"><dt><b>Since:</b></dt><dd>1.6.1 </dd></dl>

<p>Definition at line <a class="el" href="sched_8h_source.html#l00120">120</a> of file <a class="el" href="sched_8h_source.html">sched.h</a>.</p>

</div>
</div>
<a class="anchor" id="a9b0b3840f944b8ac512d88f1f0f44a12"></a><!-- doxytag: member="sched.h::ast_sched_thread_del" ref="a9b0b3840f944b8ac512d88f1f0f44a12" args="(st, id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ast_sched_thread_del</td>
          <td>(</td>
          <td class="paramtype">st, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="res__ais_8c.html#a2465fd4497a7402ad72da7d6e03f9934">id</a>&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment">({ \
   <span class="keyword">struct </span><a class="code" href="structsched__context.html">sched_context</a> *__tmp_context = <a class="code" href="sched_8h.html#a2574d6d3ccdc66ecbc78501f237b59db" title="Get the scheduler context for a given ast_sched_thread.">ast_sched_thread_get_context</a>(st); \
   <a class="code" href="sched_8h.html#a25647782014f8dc012994efcd1b81d32" title="a loop construct to ensure that the scheduled task get deleted. The idea is that...">AST_SCHED_DEL</a>(__tmp_context, <span class="keywordtype">id</span>); \
})
</pre></div>
<p>Delete a scheduler entry. </p>
<p>This uses the AST_SCHED_DEL macro internally.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>st</em>&nbsp;</td><td>the handle to the scheduler and thread </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>id</em>&nbsp;</td><td>scheduler entry id to delete</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>non-zero</em>&nbsp;</td><td>failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="sched_8h_source.html#l00403">403</a> of file <a class="el" href="sched_8h_source.html">sched.h</a>.</p>

<p>Referenced by <a class="el" href="chan__iax2_8c_source.html#l11880">build_peer()</a>, <a class="el" href="chan__iax2_8c_source.html#l12414">delete_users()</a>, <a class="el" href="chan__iax2_8c_source.html#l01623">iax2_destroy_helper()</a>, <a class="el" href="chan__iax2_8c_source.html#l01650">iax2_frame_free()</a>, <a class="el" href="chan__iax2_8c_source.html#l11485">iax2_poke_peer()</a>, <a class="el" href="chan__iax2_8c_source.html#l01356">iax2_sched_replace()</a>, <a class="el" href="chan__iax2_8c_source.html#l01885">make_trunk()</a>, <a class="el" href="chan__iax2_8c_source.html#l04115">realtime_peer()</a>, <a class="el" href="chan__iax2_8c_source.html#l08297">reg_source_db()</a>, <a class="el" href="chan__iax2_8c_source.html#l03970">schedule_delivery()</a>, <a class="el" href="chan__iax2_8c_source.html#l09458">socket_process()</a>, <a class="el" href="chan__iax2_8c_source.html#l08235">unlink_peer()</a>, and <a class="el" href="chan__iax2_8c_source.html#l08346">update_registry()</a>.</p>

</div>
</div>
<a class="anchor" id="a420efb88d10a08a78fe7713d529c6e54"></a><!-- doxytag: member="sched.h::SCHED_MAX_CACHE" ref="a420efb88d10a08a78fe7713d529c6e54" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SCHED_MAX_CACHE&nbsp;&nbsp;&nbsp;128</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Max num of schedule structs. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>The max <a class="el" href="structnumber.html" title="Number structure.">number</a> of schedule structs to keep around for use. Undefine to disable schedule structure caching. (Only disable this on very low memory machines) </dd></dl>

<p>Definition at line <a class="el" href="sched_8h_source.html#l00037">37</a> of file <a class="el" href="sched_8h_source.html">sched.h</a>.</p>

<p>Referenced by <a class="el" href="sched_8c_source.html#l00307">sched_release()</a>.</p>

</div>
</div>
<hr/><h2>Typedef Documentation</h2>
<a class="anchor" id="a57358d80decb5b8ddde4d2e7f1919b87"></a><!-- doxytag: member="sched.h::ast_sched_cb" ref="a57358d80decb5b8ddde4d2e7f1919b87" args=")(const void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef int(* <a class="el" href="sched_8h.html#a57358d80decb5b8ddde4d2e7f1919b87">ast_sched_cb</a>)(const void *data)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>callback for a cheops scheduler A cheops scheduler callback takes a pointer with callback data and </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>returns a 0 if it should not be run again, or non-zero if it should be rescheduled to run again </dd></dl>

<p>Definition at line <a class="el" href="sched_8h_source.html#l00160">160</a> of file <a class="el" href="sched_8h_source.html">sched.h</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a97176531282ac4e70aa107b2e8ee5543"></a><!-- doxytag: member="sched.h::ast_sched_add" ref="a97176531282ac4e70aa107b2e8ee5543" args="(struct sched_context *con, int when, ast_sched_cb callback, const void *data) attribute_warn_unused_result" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_sched_add </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structsched__context.html">sched_context</a> *&nbsp;</td>
          <td class="paramname"> <em>con</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>when</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="sched_8h.html#a57358d80decb5b8ddde4d2e7f1919b87">ast_sched_cb</a>&nbsp;</td>
          <td class="paramname"> <em>callback</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Adds a scheduled event Schedule an event to take place at some point in the future. callback will be called with data as the argument, when milliseconds into the future (approximately) If callback returns 0, no further events will be re-scheduled. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>con</em>&nbsp;</td><td>Scheduler context to add </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>when</em>&nbsp;</td><td>how many milliseconds to wait for event to occur </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>callback</em>&nbsp;</td><td>function to call when the amount of time expires </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>data to pass to the callback </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns a schedule item ID on success, -1 on failure </dd></dl>

<p>Definition at line <a class="el" href="sched_8c_source.html#l00439">439</a> of file <a class="el" href="sched_8c_source.html">sched.c</a>.</p>

<p>References <a class="el" href="sched_8c_source.html#l00399">ast_sched_add_variable()</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l00332">__oh323_update_info()</a>, <a class="el" href="file_8c_source.html#l00735">ast_readaudio_callback()</a>, <a class="el" href="file_8c_source.html#l00799">ast_readvideo_callback()</a>, <a class="el" href="rtp_8c_source.html#l03609">ast_rtp_raw_write()</a>, <a class="el" href="rtp_8c_source.html#l01562">ast_rtp_read()</a>, <a class="el" href="sched_8c_source.html#l00431">ast_sched_replace()</a>, <a class="el" href="sched_8c_source.html#l00203">ast_sched_thread_add()</a>, <a class="el" href="pbx__dundi_8c_source.html#l04371">build_peer()</a>, <a class="el" href="pbx__dundi_8c_source.html#l04290">do_register()</a>, <a class="el" href="cdr_8c_source.html#l01396">do_reload()</a>, <a class="el" href="pbx__dundi_8c_source.html#l03166">dundi_discover()</a>, <a class="el" href="pbx__dundi_8c_source.html#l03256">dundi_query()</a>, <a class="el" href="pbx__dundi_8c_source.html#l03062">dundi_send()</a>, <a class="el" href="pbx__dundi_8c_source.html#l01553">handle_command_response()</a>, <a class="el" href="chan__sip_8c_source.html#l19641">handle_request_invite()</a>, <a class="el" href="chan__sip_8c_source.html#l17572">handle_response_invite()</a>, <a class="el" href="chan__sip_8c_source.html#l17936">handle_response_subscribe()</a>, <a class="el" href="chan__mgcp_8c_source.html#l00693">mgcp_postrequest()</a>, <a class="el" href="chan__sip_8c_source.html#l12222">parse_register_contact()</a>, <a class="el" href="pbx__dundi_8c_source.html#l04347">populate_addr()</a>, <a class="el" href="pbx__dundi_8c_source.html#l03190">precache_trans()</a>, <a class="el" href="pbx__dundi_8c_source.html#l04324">qualify_peer()</a>, <a class="el" href="chan__sip_8c_source.html#l21847">queue_request()</a>, <a class="el" href="chan__h323_8c_source.html#l01827">receive_digit()</a>, <a class="el" href="rtp_8c_source.html#l04882">rtp_red_init()</a>, <a class="el" href="chan__sip_8c_source.html#l03991">sip_scheddestroy()</a>, <a class="el" href="chan__sip_8c_source.html#l25628">sip_send_all_mwi_subscriptions()</a>, <a class="el" href="chan__sip_8c_source.html#l22549">start_session_timer()</a>, <a class="el" href="cdr_8c_source.html#l01213">submit_scheduled_batch()</a>, <a class="el" href="cdr_8c_source.html#l01222">submit_unscheduled_batch()</a>, <a class="el" href="chan__sip_8c_source.html#l11545">transmit_register()</a>, and <a class="el" href="chan__sip_8c_source.html#l04188">update_provisional_keepalive()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00440"></a>00440 {
<a name="l00441"></a>00441    <span class="keywordflow">return</span> <a class="code" href="sched_8h.html#a5d738bcc3c3d38165a59a17a35f6ca2c" title="Schedule callback(data) to happen when ms into the future.">ast_sched_add_variable</a>(con, when, callback, data, 0);
<a name="l00442"></a>00442 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5d738bcc3c3d38165a59a17a35f6ca2c"></a><!-- doxytag: member="sched.h::ast_sched_add_variable" ref="a5d738bcc3c3d38165a59a17a35f6ca2c" args="(struct sched_context *con, int when, ast_sched_cb callback, const void *data, int variable) attribute_warn_unused_result" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_sched_add_variable </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structsched__context.html">sched_context</a> *&nbsp;</td>
          <td class="paramname"> <em>con</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>when</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="sched_8h.html#a57358d80decb5b8ddde4d2e7f1919b87">ast_sched_cb</a>&nbsp;</td>
          <td class="paramname"> <em>callback</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>variable</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Schedule callback(data) to happen when ms into the future. </p>
<p>Adds a scheduled event with rescheduling support </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>con</em>&nbsp;</td><td>Scheduler context to add </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>when</em>&nbsp;</td><td>how many milliseconds to wait for event to occur </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>callback</em>&nbsp;</td><td>function to call when the amount of time expires </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>data to pass to the callback </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>variable</em>&nbsp;</td><td>If true, the result value of callback function will be used for rescheduling Schedule an event to take place at some point in the future. Callback will be called with data as the argument, when milliseconds into the future (approximately) If callback returns 0, no further events will be re-scheduled </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns a schedule item ID on success, -1 on failure </dd></dl>

<p>Definition at line <a class="el" href="sched_8c_source.html#l00399">399</a> of file <a class="el" href="sched_8c_source.html">sched.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="sched_8c_source.html#l00546">ast_sched_dump()</a>, <a class="el" href="time_8h_source.html#l00164">ast_tv()</a>, <a class="el" href="sched_8c_source.html#l00057">sched::callback</a>, <a class="el" href="sched_8c_source.html#l00056">sched::data</a>, <a class="el" href="chan__alsa_8c_source.html#l00070">DEBUG</a>, <a class="el" href="sched_8c_source.html#l00063">sched_context::eventcnt</a>, <a class="el" href="sched_8c_source.html#l00052">sched::id</a>, <a class="el" href="sched_8c_source.html#l00062">sched_context::lock</a>, <a class="el" href="asterisk_8c_source.html#l00175">option_debug</a>, <a class="el" href="sched_8c_source.html#l00054">sched::resched</a>, <a class="el" href="sched_8c_source.html#l00289">sched_alloc()</a>, <a class="el" href="sched_8c_source.html#l00307">sched_release()</a>, <a class="el" href="sched_8c_source.html#l00373">sched_settime()</a>, <a class="el" href="sched_8c_source.html#l00354">schedule()</a>, <a class="el" href="sched_8c_source.html#l00055">sched::variable</a>, and <a class="el" href="sched_8c_source.html#l00053">sched::when</a>.</p>

<p>Referenced by <a class="el" href="chan__misdn_8c_source.html#l00810">_misdn_tasks_add_variable()</a>, <a class="el" href="sched_8c_source.html#l00439">ast_sched_add()</a>, <a class="el" href="sched_8c_source.html#l00387">ast_sched_replace_variable()</a>, <a class="el" href="sched_8c_source.html#l00188">ast_sched_thread_add_variable()</a>, <a class="el" href="dnsmgr_8c_source.html#l00244">dnsmgr_start_refresh()</a>, and <a class="el" href="dnsmgr_8c_source.html#l00367">do_reload()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00400"></a>00400 {
<a name="l00401"></a>00401    <span class="keyword">struct </span><a class="code" href="structsched.html">sched</a> *tmp;
<a name="l00402"></a>00402    <span class="keywordtype">int</span> res = -1;
<a name="l00403"></a>00403 
<a name="l00404"></a>00404    <a class="code" href="chan__alsa_8c.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a>(<a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;ast_sched_add()\n&quot;</span>));
<a name="l00405"></a>00405 
<a name="l00406"></a>00406    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;con-&gt;<a class="code" href="structsched__context.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00407"></a>00407    <span class="keywordflow">if</span> ((tmp = <a class="code" href="sched_8c.html#a54d329927a7dfb0d74392861dba70b95">sched_alloc</a>(con))) {
<a name="l00408"></a>00408       tmp-&gt;<a class="code" href="structsched.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a> = con-&gt;<a class="code" href="structsched__context.html#a2d5621366e555704664f39180c7a758c">eventcnt</a>++;
<a name="l00409"></a>00409       tmp-&gt;<a class="code" href="structsched.html#ac58274e87a13e59fcd66d9de81261800">callback</a> = <a class="code" href="structsched.html#ac58274e87a13e59fcd66d9de81261800">callback</a>;
<a name="l00410"></a>00410       tmp-&gt;<a class="code" href="structsched.html#a0d49d74db4c035719c3867723cf7e779">data</a> = <a class="code" href="structsched.html#a0d49d74db4c035719c3867723cf7e779">data</a>;
<a name="l00411"></a>00411       tmp-&gt;<a class="code" href="structsched.html#a778ab73c44615a00697f70c5adcb058b">resched</a> = <a class="code" href="structsched.html#a9c0783ff5b989460d3d42460fd182f67">when</a>;
<a name="l00412"></a>00412       tmp-&gt;<a class="code" href="structsched.html#ac2bb0fc1fabbeabad94c3b726bd708bc">variable</a> = <a class="code" href="structsched.html#ac2bb0fc1fabbeabad94c3b726bd708bc">variable</a>;
<a name="l00413"></a>00413       tmp-&gt;<a class="code" href="structsched.html#a9c0783ff5b989460d3d42460fd182f67">when</a> = <a class="code" href="time_8h.html#af46dec59fc43982d018a757f7b499669" title="Returns a timeval from sec, usec.">ast_tv</a>(0, 0);
<a name="l00414"></a>00414       <span class="keywordflow">if</span> (<a class="code" href="sched_8c.html#a226ddd4876c91b5074611cc7506eb16e" title="given the last event *tv and the offset in milliseconds &amp;#39;when&amp;#39;, computes...">sched_settime</a>(&amp;tmp-&gt;<a class="code" href="structsched.html#a9c0783ff5b989460d3d42460fd182f67">when</a>, <a class="code" href="structsched.html#a9c0783ff5b989460d3d42460fd182f67">when</a>)) {
<a name="l00415"></a>00415          <a class="code" href="sched_8c.html#a2944cc9e3e6249855b3076bd8a9748ec">sched_release</a>(con, tmp);
<a name="l00416"></a>00416       } <span class="keywordflow">else</span> {
<a name="l00417"></a>00417          <a class="code" href="sched_8c.html#a26f43b83561fa47d1017bcef5e491f63" title="Take a sched structure and put it in the queue, such that the soonest event is first...">schedule</a>(con, tmp);
<a name="l00418"></a>00418          res = tmp-&gt;<a class="code" href="structsched.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a>;
<a name="l00419"></a>00419       }
<a name="l00420"></a>00420    }
<a name="l00421"></a>00421 <span class="preprocessor">#ifdef DUMP_SCHEDULER</span>
<a name="l00422"></a>00422 <span class="preprocessor"></span>   <span class="comment">/* Dump contents of the context while we have the lock so nothing gets screwed up by accident. */</span>
<a name="l00423"></a>00423    <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#ga40f8fb2e731031d99f732f515cec680f">option_debug</a>)
<a name="l00424"></a>00424       <a class="code" href="sched_8h.html#a1dc19b07e946576cf6521e693ec299c7" title="Dumps the scheduler contents Debugging: Dump the contents of the scheduler to stderr...">ast_sched_dump</a>(con);
<a name="l00425"></a>00425 <span class="preprocessor">#endif</span>
<a name="l00426"></a>00426 <span class="preprocessor"></span>   <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;con-&gt;<a class="code" href="structsched__context.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00427"></a>00427 
<a name="l00428"></a>00428    <span class="keywordflow">return</span> res;
<a name="l00429"></a>00429 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae7bd726b811accba953137fb35b6121d"></a><!-- doxytag: member="sched.h::ast_sched_del" ref="ae7bd726b811accba953137fb35b6121d" args="(struct sched_context *con, int id) attribute_warn_unused_result" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_sched_del </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structsched__context.html">sched_context</a> *&nbsp;</td>
          <td class="paramname"> <em>con</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>id</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Deletes a scheduled event Remove this event from being run. A procedure should not remove its own event, but return 0 instead. In most cases, you should not call this routine directly, but use the <a class="el" href="sched_8h.html#a25647782014f8dc012994efcd1b81d32" title="a loop construct to ensure that the scheduled task get deleted. The idea is that...">AST_SCHED_DEL()</a> macro instead (especially if you don't intend to do something different when it returns failure). </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>con</em>&nbsp;</td><td>scheduling context to delete item from </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>id</em>&nbsp;</td><td>ID of the scheduled item to delete </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns 0 on success, -1 on failure </dd></dl>

<p>Definition at line <a class="el" href="sched_8c_source.html#l00461">461</a> of file <a class="el" href="sched_8c_source.html">sched.c</a>.</p>

<p>References <a class="el" href="utils_8h_source.html#l00678">ast_assert</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="hashtab_8c_source.html#l00530">ast_hashtab_lookup()</a>, <a class="el" href="hashtab_8c_source.html#l00855">ast_hashtab_remove_this_object()</a>, <a class="el" href="heap_8c_source.html#l00275">ast_heap_remove()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="sched_8c_source.html#l00546">ast_sched_dump()</a>, <a class="el" href="chan__alsa_8c_source.html#l00070">DEBUG</a>, <a class="el" href="sched_8c_source.html#l00052">sched::id</a>, <a class="el" href="sched_8c_source.html#l00062">sched_context::lock</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="asterisk_8c_source.html#l00175">option_debug</a>, <a class="el" href="aesopt_8h_source.html#l00399">s</a>, <a class="el" href="sched_8c_source.html#l00067">sched_context::sched_heap</a>, <a class="el" href="sched_8c_source.html#l00307">sched_release()</a>, <a class="el" href="sched_8c_source.html#l00064">sched_context::schedcnt</a>, and <a class="el" href="sched_8c_source.html#l00066">sched_context::schedq_ht</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l04034">__sip_ack()</a>, and <a class="el" href="chan__sip_8c_source.html#l04017">sip_cancel_destroy()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00465"></a>00465 {
<a name="l00466"></a>00466    <span class="keyword">struct </span><a class="code" href="structsched.html">sched</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>, tmp = {
<a name="l00467"></a>00467       .id = <a class="code" href="app__queue_8c.html#acd1f0e9b4730ec60f62cb0806cb06ef1">id</a>,
<a name="l00468"></a>00468    };
<a name="l00469"></a>00469 
<a name="l00470"></a>00470    <a class="code" href="chan__alsa_8c.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a>(<a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;ast_sched_del(%d)\n&quot;</span>, <span class="keywordtype">id</span>));
<a name="l00471"></a>00471    
<a name="l00472"></a>00472    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;con-&gt;<a class="code" href="structsched__context.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00473"></a>00473    s = <a class="code" href="hashtab_8h.html#a78b1f7bc201afd020f6270378173bb79" title="Lookup this object in the hash table.">ast_hashtab_lookup</a>(con-&gt;<a class="code" href="structsched__context.html#a889c78832d62b9fa4c3b970d43c922b9">schedq_ht</a>, &amp;tmp);
<a name="l00474"></a>00474    <span class="keywordflow">if</span> (s) {
<a name="l00475"></a>00475       <span class="keywordflow">if</span> (!<a class="code" href="heap_8h.html#ac68d03b30bb0adc489ccd67a11873b59" title="Remove a specific element from a heap.">ast_heap_remove</a>(con-&gt;<a class="code" href="structsched__context.html#afb2936780a5abba63b413db727f6d566">sched_heap</a>, s)) {
<a name="l00476"></a>00476          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,<span class="stringliteral">&quot;sched entry %d not in the sched heap?\n&quot;</span>, s-&gt;<a class="code" href="structsched.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a>);
<a name="l00477"></a>00477       }
<a name="l00478"></a>00478 
<a name="l00479"></a>00479       <span class="keywordflow">if</span> (!<a class="code" href="hashtab_8h.html#a71bd19ff2f6fad1cf5e01f9b8cad6f66" title="Hash the object and then compare ptrs in bucket list instead of calling the compare...">ast_hashtab_remove_this_object</a>(con-&gt;<a class="code" href="structsched__context.html#a889c78832d62b9fa4c3b970d43c922b9">schedq_ht</a>, s)) {
<a name="l00480"></a>00480          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,<span class="stringliteral">&quot;Found sched entry %d, then couldn&apos;t remove it?\n&quot;</span>, s-&gt;<a class="code" href="structsched.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a>);
<a name="l00481"></a>00481       }
<a name="l00482"></a>00482 
<a name="l00483"></a>00483       con-&gt;<a class="code" href="structsched__context.html#a02920508d2e8cb1059d73491ef990421">schedcnt</a>--;
<a name="l00484"></a>00484 
<a name="l00485"></a>00485       <a class="code" href="sched_8c.html#a2944cc9e3e6249855b3076bd8a9748ec">sched_release</a>(con, s);
<a name="l00486"></a>00486    }
<a name="l00487"></a>00487    
<a name="l00488"></a>00488 <span class="preprocessor">#ifdef DUMP_SCHEDULER</span>
<a name="l00489"></a>00489 <span class="preprocessor"></span>   <span class="comment">/* Dump contents of the context while we have the lock so nothing gets screwed up by accident. */</span>
<a name="l00490"></a>00490    <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#ga40f8fb2e731031d99f732f515cec680f">option_debug</a>)
<a name="l00491"></a>00491       <a class="code" href="sched_8h.html#a1dc19b07e946576cf6521e693ec299c7" title="Dumps the scheduler contents Debugging: Dump the contents of the scheduler to stderr...">ast_sched_dump</a>(con);
<a name="l00492"></a>00492 <span class="preprocessor">#endif</span>
<a name="l00493"></a>00493 <span class="preprocessor"></span>   <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;con-&gt;<a class="code" href="structsched__context.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00494"></a>00494 
<a name="l00495"></a>00495    <span class="keywordflow">if</span> (!s) {
<a name="l00496"></a>00496       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Attempted to delete nonexistent schedule entry %d!\n&quot;</span>, <span class="keywordtype">id</span>);
<a name="l00497"></a>00497 <span class="preprocessor">#ifndef AST_DEVMODE</span>
<a name="l00498"></a>00498 <span class="preprocessor"></span>      <a class="code" href="utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(s != NULL);
<a name="l00499"></a>00499 <span class="preprocessor">#else</span>
<a name="l00500"></a>00500 <span class="preprocessor"></span>      _ast_assert(0, <span class="stringliteral">&quot;s != NULL&quot;</span>, file, line, function);
<a name="l00501"></a>00501 <span class="preprocessor">#endif</span>
<a name="l00502"></a>00502 <span class="preprocessor"></span>      <span class="keywordflow">return</span> -1;
<a name="l00503"></a>00503    }
<a name="l00504"></a>00504    
<a name="l00505"></a>00505    <span class="keywordflow">return</span> 0;
<a name="l00506"></a>00506 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1dc19b07e946576cf6521e693ec299c7"></a><!-- doxytag: member="sched.h::ast_sched_dump" ref="a1dc19b07e946576cf6521e693ec299c7" args="(struct sched_context *con)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_sched_dump </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structsched__context.html">sched_context</a> *&nbsp;</td>
          <td class="paramname"> <em>con</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Dumps the scheduler contents Debugging: Dump the contents of the scheduler to stderr. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>con</em>&nbsp;</td><td>Context to dump </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="sched_8c_source.html#l00546">546</a> of file <a class="el" href="sched_8c_source.html">sched.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="heap_8c_source.html#l00291">ast_heap_peek()</a>, <a class="el" href="heap_8c_source.html#l00300">ast_heap_size()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="utils_8c_source.html#l01379">ast_tvsub()</a>, <a class="el" href="sched_8c_source.html#l00063">sched_context::eventcnt</a>, <a class="el" href="sched_8c_source.html#l00065">sched_context::highwater</a>, <a class="el" href="sched_8c_source.html#l00062">sched_context::lock</a>, <a class="el" href="sched_8c_source.html#l00067">sched_context::sched_heap</a>, <a class="el" href="sched_8c_source.html#l00071">sched_context::schedccnt</a>, and <a class="el" href="sched_8c_source.html#l00064">sched_context::schedcnt</a>.</p>

<p>Referenced by <a class="el" href="sched_8c_source.html#l00399">ast_sched_add_variable()</a>, <a class="el" href="sched_8c_source.html#l00461">ast_sched_del()</a>, <a class="el" href="chan__sip_8c_source.html#l25641">sip_do_reload()</a>, and <a class="el" href="chan__sip_8c_source.html#l25834">unload_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00547"></a>00547 {
<a name="l00548"></a>00548    <span class="keyword">struct </span><a class="code" href="structsched.html">sched</a> *q;
<a name="l00549"></a>00549    <span class="keyword">struct </span>timeval when = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l00550"></a>00550    <span class="keywordtype">int</span> x;
<a name="l00551"></a>00551    <span class="keywordtype">size_t</span> heap_size;
<a name="l00552"></a>00552 <span class="preprocessor">#ifdef SCHED_MAX_CACHE</span>
<a name="l00553"></a>00553 <span class="preprocessor"></span>   <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Asterisk Schedule Dump (%d in Q, %d Total, %d Cache, %d high-water)\n&quot;</span>, con-&gt;<a class="code" href="structsched__context.html#a02920508d2e8cb1059d73491ef990421">schedcnt</a>, con-&gt;<a class="code" href="structsched__context.html#a2d5621366e555704664f39180c7a758c">eventcnt</a> - 1, con-&gt;<a class="code" href="structsched__context.html#a252186d8bb2e81ccf2c7f8456ae3b19c">schedccnt</a>, con-&gt;<a class="code" href="structsched__context.html#ac5028ea4f5c5ef2ef4d037ef54dd0942">highwater</a>);
<a name="l00554"></a>00554 <span class="preprocessor">#else</span>
<a name="l00555"></a>00555 <span class="preprocessor"></span>   <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Asterisk Schedule Dump (%d in Q, %d Total, %d high-water)\n&quot;</span>, con-&gt;<a class="code" href="structsched__context.html#a02920508d2e8cb1059d73491ef990421">schedcnt</a>, con-&gt;<a class="code" href="structsched__context.html#a2d5621366e555704664f39180c7a758c">eventcnt</a> - 1, con-&gt;<a class="code" href="structsched__context.html#ac5028ea4f5c5ef2ef4d037ef54dd0942">highwater</a>);
<a name="l00556"></a>00556 <span class="preprocessor">#endif</span>
<a name="l00557"></a>00557 <span class="preprocessor"></span>
<a name="l00558"></a>00558    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;=============================================================\n&quot;</span>);
<a name="l00559"></a>00559    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;|ID    Callback          Data              Time  (sec:ms)   |\n&quot;</span>);
<a name="l00560"></a>00560    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;+-----+-----------------+-----------------+-----------------+\n&quot;</span>);
<a name="l00561"></a>00561    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;con-&gt;<a class="code" href="structsched__context.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00562"></a>00562    heap_size = <a class="code" href="heap_8h.html#abb3efaa08e2b1e9423bbbd5e3d9d2acc" title="Get the current size of a heap.">ast_heap_size</a>(con-&gt;<a class="code" href="structsched__context.html#afb2936780a5abba63b413db727f6d566">sched_heap</a>);
<a name="l00563"></a>00563    <span class="keywordflow">for</span> (x = 1; x &lt;= heap_size; x++) {
<a name="l00564"></a>00564       <span class="keyword">struct </span>timeval delta;
<a name="l00565"></a>00565       q = <a class="code" href="heap_8h.html#aaa326b988236a0841d41cf2af8ec9b7e" title="Peek at an element on a heap.">ast_heap_peek</a>(con-&gt;<a class="code" href="structsched__context.html#afb2936780a5abba63b413db727f6d566">sched_heap</a>, x);
<a name="l00566"></a>00566       delta = <a class="code" href="time_8h.html#aa13b651c18bc6004cab21ac041d44dd8" title="Returns the difference of two timevals a - b.">ast_tvsub</a>(q-&gt;when, when);
<a name="l00567"></a>00567       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;|%.4d | %-15p | %-15p | %.6ld : %.6ld |\n&quot;</span>, 
<a name="l00568"></a>00568          q-&gt;id,
<a name="l00569"></a>00569          q-&gt;callback,
<a name="l00570"></a>00570          q-&gt;data,
<a name="l00571"></a>00571          (<span class="keywordtype">long</span>)delta.tv_sec,
<a name="l00572"></a>00572          (<span class="keywordtype">long</span> <span class="keywordtype">int</span>)delta.tv_usec);
<a name="l00573"></a>00573    }
<a name="l00574"></a>00574    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;con-&gt;<a class="code" href="structsched__context.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00575"></a>00575    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;=============================================================\n&quot;</span>);
<a name="l00576"></a>00576 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a99c2cadcc6e49247c6afa8d947bbfe8c"></a><!-- doxytag: member="sched.h::ast_sched_find_data" ref="a99c2cadcc6e49247c6afa8d947bbfe8c" args="(struct sched_context *con, int id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const void* ast_sched_find_data </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structsched__context.html">sched_context</a> *&nbsp;</td>
          <td class="paramname"> <em>con</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>id</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Find a <a class="el" href="structsched.html">sched</a> structure and return the data field associated with it. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>con</em>&nbsp;</td><td>scheduling context in which to search fro the matching id </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>id</em>&nbsp;</td><td>ID of the scheduled item to find </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>the data field from the matching <a class="el" href="structsched.html">sched</a> struct if found; else return NULL if not found. </dd></dl>
<dl class="since"><dt><b>Since:</b></dt><dd>1.6.1 </dd></dl>

<p>Definition at line <a class="el" href="sched_8c_source.html#l00444">444</a> of file <a class="el" href="sched_8c_source.html">sched.c</a>.</p>

<p>References <a class="el" href="hashtab_8c_source.html#l00530">ast_hashtab_lookup()</a>, <a class="el" href="sched_8c_source.html#l00056">sched::data</a>, <a class="el" href="sched_8c_source.html#l00052">sched::id</a>, and <a class="el" href="sched_8c_source.html#l00066">sched_context::schedq_ht</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00445"></a>00445 {
<a name="l00446"></a>00446    <span class="keyword">struct </span><a class="code" href="structsched.html">sched</a> tmp,*res;
<a name="l00447"></a>00447    tmp.id = <a class="code" href="app__queue_8c.html#acd1f0e9b4730ec60f62cb0806cb06ef1">id</a>;
<a name="l00448"></a>00448    res = <a class="code" href="hashtab_8h.html#a78b1f7bc201afd020f6270378173bb79" title="Lookup this object in the hash table.">ast_hashtab_lookup</a>(con-&gt;<a class="code" href="structsched__context.html#a889c78832d62b9fa4c3b970d43c922b9">schedq_ht</a>, &amp;tmp);
<a name="l00449"></a>00449    <span class="keywordflow">if</span> (res)
<a name="l00450"></a>00450       <span class="keywordflow">return</span> res-&gt;<a class="code" href="structsched.html#a0d49d74db4c035719c3867723cf7e779">data</a>;
<a name="l00451"></a>00451    <span class="keywordflow">return</span> NULL;
<a name="l00452"></a>00452 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7eab5d2605f049f8e9b2724a66151627"></a><!-- doxytag: member="sched.h::ast_sched_replace" ref="a7eab5d2605f049f8e9b2724a66151627" args="(int old_id, struct sched_context *con, int when, ast_sched_cb callback, const void *data) attribute_warn_unused_result" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_sched_replace </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>old_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structsched__context.html">sched_context</a> *&nbsp;</td>
          <td class="paramname"> <em>con</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>when</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="sched_8h.html#a57358d80decb5b8ddde4d2e7f1919b87">ast_sched_cb</a>&nbsp;</td>
          <td class="paramname"> <em>callback</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>replace a scheduler entry </p>
<dl class="deprecated"><dt><b><a class="el" href="deprecated.html#_deprecated000004">Deprecated:</a></b></dt><dd>You should use the <a class="el" href="sched_8h.html#a3482be3590d695edd576355379040d62">AST_SCHED_REPLACE()</a> macro instead.</dd></dl>
<p>This deletes the scheduler entry for old_id if it exists, and then calls ast_sched_add to create a new entry. A negative old_id will be ignored.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>failure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>otherwise,returns</em>&nbsp;</td><td>scheduled item ID </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="sched_8c_source.html#l00431">431</a> of file <a class="el" href="sched_8c_source.html">sched.c</a>.</p>

<p>References <a class="el" href="sched_8c_source.html#l00439">ast_sched_add()</a>, and <a class="el" href="sched_8h_source.html#l00051">AST_SCHED_DEL</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00432"></a>00432 {
<a name="l00433"></a>00433    <span class="keywordflow">if</span> (old_id &gt; -1) {
<a name="l00434"></a>00434       <a class="code" href="sched_8h.html#a25647782014f8dc012994efcd1b81d32" title="a loop construct to ensure that the scheduled task get deleted. The idea is that...">AST_SCHED_DEL</a>(con, old_id);
<a name="l00435"></a>00435    }
<a name="l00436"></a>00436    <span class="keywordflow">return</span> <a class="code" href="sched_8h.html#a97176531282ac4e70aa107b2e8ee5543" title="Adds a scheduled event Schedule an event to take place at some point in the future...">ast_sched_add</a>(con, <a class="code" href="structsched.html#a9c0783ff5b989460d3d42460fd182f67">when</a>, <a class="code" href="structsched.html#ac58274e87a13e59fcd66d9de81261800">callback</a>, <a class="code" href="structsched.html#a0d49d74db4c035719c3867723cf7e779">data</a>);
<a name="l00437"></a>00437 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aeaa1cb4e7793f162b6987014be7ac0f5"></a><!-- doxytag: member="sched.h::ast_sched_replace_variable" ref="aeaa1cb4e7793f162b6987014be7ac0f5" args="(int old_id, struct sched_context *con, int when, ast_sched_cb callback, const void *data, int variable) attribute_warn_unused_result" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_sched_replace_variable </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>old_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structsched__context.html">sched_context</a> *&nbsp;</td>
          <td class="paramname"> <em>con</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>when</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="sched_8h.html#a57358d80decb5b8ddde4d2e7f1919b87">ast_sched_cb</a>&nbsp;</td>
          <td class="paramname"> <em>callback</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>variable</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>replace a scheduler entry </p>
<dl class="deprecated"><dt><b><a class="el" href="deprecated.html#_deprecated000005">Deprecated:</a></b></dt><dd>You should use the <a class="el" href="sched_8h.html#a8fa3e1748a3d4c853da0aac32c97b39b">AST_SCHED_REPLACE_VARIABLE()</a> macro instead.</dd></dl>
<p>This deletes the scheduler entry for old_id if it exists, and then calls ast_sched_add to create a new entry. A negative old_id will be ignored.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>failure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>otherwise,returns</em>&nbsp;</td><td>scheduled item ID </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="sched_8c_source.html#l00387">387</a> of file <a class="el" href="sched_8c_source.html">sched.c</a>.</p>

<p>References <a class="el" href="sched_8c_source.html#l00399">ast_sched_add_variable()</a>, and <a class="el" href="sched_8h_source.html#l00051">AST_SCHED_DEL</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00388"></a>00388 {
<a name="l00389"></a>00389    <span class="comment">/* 0 means the schedule item is new; do not delete */</span>
<a name="l00390"></a>00390    <span class="keywordflow">if</span> (old_id &gt; 0) {
<a name="l00391"></a>00391       <a class="code" href="sched_8h.html#a25647782014f8dc012994efcd1b81d32" title="a loop construct to ensure that the scheduled task get deleted. The idea is that...">AST_SCHED_DEL</a>(con, old_id);
<a name="l00392"></a>00392    }
<a name="l00393"></a>00393    <span class="keywordflow">return</span> <a class="code" href="sched_8h.html#a5d738bcc3c3d38165a59a17a35f6ca2c" title="Schedule callback(data) to happen when ms into the future.">ast_sched_add_variable</a>(con, <a class="code" href="structsched.html#a9c0783ff5b989460d3d42460fd182f67">when</a>, <a class="code" href="structsched.html#ac58274e87a13e59fcd66d9de81261800">callback</a>, <a class="code" href="structsched.html#a0d49d74db4c035719c3867723cf7e779">data</a>, <a class="code" href="structsched.html#ac2bb0fc1fabbeabad94c3b726bd708bc">variable</a>);
<a name="l00394"></a>00394 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aaf6c34a7b6152bc3739394c27a871ba1"></a><!-- doxytag: member="sched.h::ast_sched_report" ref="aaf6c34a7b6152bc3739394c27a871ba1" args="(struct sched_context *con, struct ast_str **buf, struct ast_cb_names *cbnames)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_sched_report </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structsched__context.html">sched_context</a> *&nbsp;</td>
          <td class="paramname"> <em>con</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__str.html">ast_str</a> **&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cb__names.html">ast_cb_names</a> *&nbsp;</td>
          <td class="paramname"> <em>cbnames</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Show statics on what it is in the schedule queue. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>con</em>&nbsp;</td><td>Schedule context to check </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>buf</em>&nbsp;</td><td>dynamic string to store report </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>cbnames</em>&nbsp;</td><td>to check against </td></tr>
  </table>
  </dd>
</dl>
<dl class="since"><dt><b>Since:</b></dt><dd>1.6.1 </dd></dl>

<p>Definition at line <a class="el" href="sched_8c_source.html#l00508">508</a> of file <a class="el" href="sched_8c_source.html">sched.c</a>.</p>

<p>References <a class="el" href="heap_8c_source.html#l00291">ast_heap_peek()</a>, <a class="el" href="heap_8c_source.html#l00300">ast_heap_size()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="strings_8h_source.html#l00846">ast_str_append()</a>, <a class="el" href="strings_8h_source.html#l00825">ast_str_set()</a>, <a class="el" href="sched_8c_source.html#l00057">sched::callback</a>, <a class="el" href="sched_8h_source.html#l00166">ast_cb_names::cblist</a>, <a class="el" href="sched_8c_source.html#l00065">sched_context::highwater</a>, <a class="el" href="sched_8h_source.html#l00165">ast_cb_names::list</a>, <a class="el" href="sched_8c_source.html#l00062">sched_context::lock</a>, <a class="el" href="sched_8h_source.html#l00164">ast_cb_names::numassocs</a>, <a class="el" href="sched_8c_source.html#l00067">sched_context::sched_heap</a>, and <a class="el" href="sched_8c_source.html#l00064">sched_context::schedcnt</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l15705">sip_show_sched()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00509"></a>00509 {
<a name="l00510"></a>00510    <span class="keywordtype">int</span> i, x;
<a name="l00511"></a>00511    <span class="keyword">struct </span><a class="code" href="structsched.html">sched</a> *cur;
<a name="l00512"></a>00512    <span class="keywordtype">int</span> countlist[cbnames-&gt;<a class="code" href="structast__cb__names.html#add023ad2040e9f2ec08390700aa1b556">numassocs</a> + 1];
<a name="l00513"></a>00513    <span class="keywordtype">size_t</span> heap_size;
<a name="l00514"></a>00514    
<a name="l00515"></a>00515    memset(countlist, 0, <span class="keyword">sizeof</span>(countlist));
<a name="l00516"></a>00516    <a class="code" href="strings_8h.html#a4a3222f04f84c80a1d70f51e2dff00ea" title="Set a dynamic string using variable arguments.">ast_str_set</a>(buf, 0, <span class="stringliteral">&quot; Highwater = %d\n schedcnt = %d\n&quot;</span>, con-&gt;<a class="code" href="structsched__context.html#ac5028ea4f5c5ef2ef4d037ef54dd0942">highwater</a>, con-&gt;<a class="code" href="structsched__context.html#a02920508d2e8cb1059d73491ef990421">schedcnt</a>);
<a name="l00517"></a>00517 
<a name="l00518"></a>00518    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;con-&gt;<a class="code" href="structsched__context.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00519"></a>00519 
<a name="l00520"></a>00520    heap_size = <a class="code" href="heap_8h.html#abb3efaa08e2b1e9423bbbd5e3d9d2acc" title="Get the current size of a heap.">ast_heap_size</a>(con-&gt;<a class="code" href="structsched__context.html#afb2936780a5abba63b413db727f6d566">sched_heap</a>);
<a name="l00521"></a>00521    <span class="keywordflow">for</span> (x = 1; x &lt;= heap_size; x++) {
<a name="l00522"></a>00522       cur = <a class="code" href="heap_8h.html#aaa326b988236a0841d41cf2af8ec9b7e" title="Peek at an element on a heap.">ast_heap_peek</a>(con-&gt;<a class="code" href="structsched__context.html#afb2936780a5abba63b413db727f6d566">sched_heap</a>, x);
<a name="l00523"></a>00523       <span class="comment">/* match the callback to the cblist */</span>
<a name="l00524"></a>00524       <span class="keywordflow">for</span> (i = 0; i &lt; cbnames-&gt;<a class="code" href="structast__cb__names.html#add023ad2040e9f2ec08390700aa1b556">numassocs</a>; i++) {
<a name="l00525"></a>00525          <span class="keywordflow">if</span> (cur-&gt;<a class="code" href="structsched.html#ac58274e87a13e59fcd66d9de81261800">callback</a> == cbnames-&gt;<a class="code" href="structast__cb__names.html#af025691779591d8068d64284c296d552">cblist</a>[i]) {
<a name="l00526"></a>00526             <span class="keywordflow">break</span>;
<a name="l00527"></a>00527          }
<a name="l00528"></a>00528       }
<a name="l00529"></a>00529       <span class="keywordflow">if</span> (i &lt; cbnames-&gt;numassocs) {
<a name="l00530"></a>00530          countlist[i]++;
<a name="l00531"></a>00531       } <span class="keywordflow">else</span> {
<a name="l00532"></a>00532          countlist[cbnames-&gt;<a class="code" href="structast__cb__names.html#add023ad2040e9f2ec08390700aa1b556">numassocs</a>]++;
<a name="l00533"></a>00533       }
<a name="l00534"></a>00534    }
<a name="l00535"></a>00535 
<a name="l00536"></a>00536    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;con-&gt;<a class="code" href="structsched__context.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00537"></a>00537 
<a name="l00538"></a>00538    <span class="keywordflow">for</span> (i = 0; i &lt; cbnames-&gt;<a class="code" href="structast__cb__names.html#add023ad2040e9f2ec08390700aa1b556">numassocs</a>; i++) {
<a name="l00539"></a>00539       <a class="code" href="strings_8h.html#a85cd5a8ef499e39d22b4bfeb8b9a64f7" title="Append to a thread local dynamic string.">ast_str_append</a>(buf, 0, <span class="stringliteral">&quot;    %s : %d\n&quot;</span>, cbnames-&gt;<a class="code" href="structast__cb__names.html#a804ee4e1914df6e9534db1f6604f88ab">list</a>[i], countlist[i]);
<a name="l00540"></a>00540    }
<a name="l00541"></a>00541 
<a name="l00542"></a>00542    <a class="code" href="strings_8h.html#a85cd5a8ef499e39d22b4bfeb8b9a64f7" title="Append to a thread local dynamic string.">ast_str_append</a>(buf, 0, <span class="stringliteral">&quot;   &lt;unknown&gt; : %d\n&quot;</span>, countlist[cbnames-&gt;<a class="code" href="structast__cb__names.html#add023ad2040e9f2ec08390700aa1b556">numassocs</a>]);
<a name="l00543"></a>00543 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2867b39106061847a8508bf49e38f420"></a><!-- doxytag: member="sched.h::ast_sched_runq" ref="a2867b39106061847a8508bf49e38f420" args="(struct sched_context *con)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_sched_runq </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structsched__context.html">sched_context</a> *&nbsp;</td>
          <td class="paramname"> <em>con</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Runs the queue. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>con</em>&nbsp;</td><td>Scheduling context to run Run the queue, executing all callbacks which need to be performed at this time. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>con</em>&nbsp;</td><td>context to act upon </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns the <a class="el" href="structnumber.html" title="Number structure.">number</a> of events processed. </dd></dl>

<p>Definition at line <a class="el" href="sched_8c_source.html#l00581">581</a> of file <a class="el" href="sched_8c_source.html">sched.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="hashtab_8c_source.html#l00855">ast_hashtab_remove_this_object()</a>, <a class="el" href="heap_8c_source.html#l00291">ast_heap_peek()</a>, <a class="el" href="heap_8c_source.html#l00286">ast_heap_pop()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="time_8h_source.html#l00164">ast_tv()</a>, <a class="el" href="utils_8c_source.html#l01365">ast_tvadd()</a>, <a class="el" href="time_8h_source.html#l00119">ast_tvcmp()</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="sched_8c_source.html#l00057">sched::callback</a>, <a class="el" href="sched_8c_source.html#l00056">sched::data</a>, <a class="el" href="chan__alsa_8c_source.html#l00070">DEBUG</a>, <a class="el" href="sched_8c_source.html#l00052">sched::id</a>, <a class="el" href="sched_8c_source.html#l00062">sched_context::lock</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="sched_8c_source.html#l00054">sched::resched</a>, <a class="el" href="sched_8c_source.html#l00067">sched_context::sched_heap</a>, <a class="el" href="sched_8c_source.html#l00307">sched_release()</a>, <a class="el" href="sched_8c_source.html#l00373">sched_settime()</a>, <a class="el" href="sched_8c_source.html#l00064">sched_context::schedcnt</a>, <a class="el" href="sched_8c_source.html#l00066">sched_context::schedq_ht</a>, <a class="el" href="sched_8c_source.html#l00354">schedule()</a>, <a class="el" href="sched_8c_source.html#l00055">sched::variable</a>, and <a class="el" href="sched_8c_source.html#l00053">sched::when</a>.</p>

<p>Referenced by <a class="el" href="app__talkdetect_8c_source.html#l00076">background_detect_exec()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="cdr_8c_source.html#l01288">do_cdr()</a>, <a class="el" href="chan__h323_8c_source.html#l02529">do_monitor()</a>, <a class="el" href="dnsmgr_8c_source.html#l00205">do_refresh()</a>, <a class="el" href="res__agi_8c_source.html#l02137">handle_speechrecognize()</a>, <a class="el" href="chan__misdn_8c_source.html#l00748">misdn_tasks_thread_func()</a>, <a class="el" href="pbx__dundi_8c_source.html#l02166">network_thread()</a>, <a class="el" href="chan__mgcp_8c_source.html#l04076">reload_config()</a>, <a class="el" href="sched_8c_source.html#l00083">sched_run()</a>, <a class="el" href="app__speech__utils_8c_source.html#l00639">speech_background()</a>, <a class="el" href="app__followme_8c_source.html#l00509">wait_for_winner()</a>, and <a class="el" href="file_8c_source.html#l01168">waitstream_core()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00582"></a>00582 {
<a name="l00583"></a>00583    <span class="keyword">struct </span><a class="code" href="structsched.html">sched</a> *current;
<a name="l00584"></a>00584    <span class="keyword">struct </span>timeval when;
<a name="l00585"></a>00585    <span class="keywordtype">int</span> numevents;
<a name="l00586"></a>00586    <span class="keywordtype">int</span> res;
<a name="l00587"></a>00587 
<a name="l00588"></a>00588    <a class="code" href="chan__alsa_8c.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a>(<a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;ast_sched_runq()\n&quot;</span>));
<a name="l00589"></a>00589       
<a name="l00590"></a>00590    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;con-&gt;<a class="code" href="structsched__context.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00591"></a>00591 
<a name="l00592"></a>00592    <span class="keywordflow">for</span> (numevents = 0; (current = <a class="code" href="heap_8h.html#aaa326b988236a0841d41cf2af8ec9b7e" title="Peek at an element on a heap.">ast_heap_peek</a>(con-&gt;<a class="code" href="structsched__context.html#afb2936780a5abba63b413db727f6d566">sched_heap</a>, 1)); numevents++) {
<a name="l00593"></a>00593       <span class="comment">/* schedule all events which are going to expire within 1ms.</span>
<a name="l00594"></a>00594 <span class="comment">       * We only care about millisecond accuracy anyway, so this will</span>
<a name="l00595"></a>00595 <span class="comment">       * help us get more than one event at one time if they are very</span>
<a name="l00596"></a>00596 <span class="comment">       * close together.</span>
<a name="l00597"></a>00597 <span class="comment">       */</span>
<a name="l00598"></a>00598       when = <a class="code" href="time_8h.html#a97e1bb8fbd7a103212789e87e7ed6073" title="Returns the sum of two timevals a + b.">ast_tvadd</a>(<a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>(), <a class="code" href="time_8h.html#af46dec59fc43982d018a757f7b499669" title="Returns a timeval from sec, usec.">ast_tv</a>(0, 1000));
<a name="l00599"></a>00599       <span class="keywordflow">if</span> (<a class="code" href="time_8h.html#acc9e13e54ed18f92956c748a38f82430" title="Compres two struct timeval instances returning -1, 0, 1 if the first arg is smaller...">ast_tvcmp</a>(current-&gt;<a class="code" href="structsched.html#a9c0783ff5b989460d3d42460fd182f67">when</a>, when) != -1) {
<a name="l00600"></a>00600          <span class="keywordflow">break</span>;
<a name="l00601"></a>00601       }
<a name="l00602"></a>00602       
<a name="l00603"></a>00603       current = <a class="code" href="heap_8h.html#ad56625488a481df852f0b13d58b15a93" title="Pop the max element off of the heap.">ast_heap_pop</a>(con-&gt;<a class="code" href="structsched__context.html#afb2936780a5abba63b413db727f6d566">sched_heap</a>);
<a name="l00604"></a>00604 
<a name="l00605"></a>00605       <span class="keywordflow">if</span> (!<a class="code" href="hashtab_8h.html#a71bd19ff2f6fad1cf5e01f9b8cad6f66" title="Hash the object and then compare ptrs in bucket list instead of calling the compare...">ast_hashtab_remove_this_object</a>(con-&gt;<a class="code" href="structsched__context.html#a889c78832d62b9fa4c3b970d43c922b9">schedq_ht</a>, current)) {
<a name="l00606"></a>00606          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,<span class="stringliteral">&quot;Sched entry %d was in the schedq list but not in the hashtab???\n&quot;</span>, current-&gt;<a class="code" href="structsched.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a>);
<a name="l00607"></a>00607       }
<a name="l00608"></a>00608 
<a name="l00609"></a>00609       con-&gt;<a class="code" href="structsched__context.html#a02920508d2e8cb1059d73491ef990421">schedcnt</a>--;
<a name="l00610"></a>00610 
<a name="l00611"></a>00611       <span class="comment">/*</span>
<a name="l00612"></a>00612 <span class="comment">       * At this point, the schedule queue is still intact.  We</span>
<a name="l00613"></a>00613 <span class="comment">       * have removed the first event and the rest is still there,</span>
<a name="l00614"></a>00614 <span class="comment">       * so it&apos;s permissible for the callback to add new events, but</span>
<a name="l00615"></a>00615 <span class="comment">       * trying to delete itself won&apos;t work because it isn&apos;t in</span>
<a name="l00616"></a>00616 <span class="comment">       * the schedule queue.  If that&apos;s what it wants to do, it </span>
<a name="l00617"></a>00617 <span class="comment">       * should return 0.</span>
<a name="l00618"></a>00618 <span class="comment">       */</span>
<a name="l00619"></a>00619          
<a name="l00620"></a>00620       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;con-&gt;<a class="code" href="structsched__context.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00621"></a>00621       res = current-&gt;<a class="code" href="structsched.html#ac58274e87a13e59fcd66d9de81261800">callback</a>(current-&gt;<a class="code" href="structsched.html#a0d49d74db4c035719c3867723cf7e779">data</a>);
<a name="l00622"></a>00622       <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;con-&gt;<a class="code" href="structsched__context.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00623"></a>00623          
<a name="l00624"></a>00624       <span class="keywordflow">if</span> (res) {
<a name="l00625"></a>00625          <span class="comment">/*</span>
<a name="l00626"></a>00626 <span class="comment">          * If they return non-zero, we should schedule them to be</span>
<a name="l00627"></a>00627 <span class="comment">          * run again.</span>
<a name="l00628"></a>00628 <span class="comment">          */</span>
<a name="l00629"></a>00629          <span class="keywordflow">if</span> (<a class="code" href="sched_8c.html#a226ddd4876c91b5074611cc7506eb16e" title="given the last event *tv and the offset in milliseconds &amp;#39;when&amp;#39;, computes...">sched_settime</a>(&amp;current-&gt;<a class="code" href="structsched.html#a9c0783ff5b989460d3d42460fd182f67">when</a>, current-&gt;<a class="code" href="structsched.html#ac2bb0fc1fabbeabad94c3b726bd708bc">variable</a>? res : current-&gt;<a class="code" href="structsched.html#a778ab73c44615a00697f70c5adcb058b">resched</a>)) {
<a name="l00630"></a>00630             <a class="code" href="sched_8c.html#a2944cc9e3e6249855b3076bd8a9748ec">sched_release</a>(con, current);
<a name="l00631"></a>00631          } <span class="keywordflow">else</span> {
<a name="l00632"></a>00632             <a class="code" href="sched_8c.html#a26f43b83561fa47d1017bcef5e491f63" title="Take a sched structure and put it in the queue, such that the soonest event is first...">schedule</a>(con, current);
<a name="l00633"></a>00633          }
<a name="l00634"></a>00634       } <span class="keywordflow">else</span> {
<a name="l00635"></a>00635          <span class="comment">/* No longer needed, so release it */</span>
<a name="l00636"></a>00636          <a class="code" href="sched_8c.html#a2944cc9e3e6249855b3076bd8a9748ec">sched_release</a>(con, current);
<a name="l00637"></a>00637       }
<a name="l00638"></a>00638    }
<a name="l00639"></a>00639 
<a name="l00640"></a>00640    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;con-&gt;<a class="code" href="structsched__context.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00641"></a>00641    
<a name="l00642"></a>00642    <span class="keywordflow">return</span> numevents;
<a name="l00643"></a>00643 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="acc6eead923ec328dcee53559dd3b8b60"></a><!-- doxytag: member="sched.h::ast_sched_thread_add" ref="acc6eead923ec328dcee53559dd3b8b60" args="(struct ast_sched_thread *st, int when, ast_sched_cb cb, const void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_sched_thread_add </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__sched__thread.html">ast_sched_thread</a> *&nbsp;</td>
          <td class="paramname"> <em>st</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>when</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="sched_8h.html#a57358d80decb5b8ddde4d2e7f1919b87">ast_sched_cb</a>&nbsp;</td>
          <td class="paramname"> <em>cb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add a scheduler entry. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>st</em>&nbsp;</td><td>the handle to the scheduler and thread </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>when</em>&nbsp;</td><td>the <a class="el" href="structnumber.html" title="Number structure.">number</a> of ms in the future to run the task. A value &lt;= 0 is treated as "run now". </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>cb</em>&nbsp;</td><td>the function to call when the scheduled time arrives </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>the parameter to pass to the scheduler callback</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>Failure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>&gt;=0</em>&nbsp;</td><td>Sched ID of added task </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="sched_8c_source.html#l00203">203</a> of file <a class="el" href="sched_8c_source.html">sched.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l01734">ast_cond_signal()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="sched_8c_source.html#l00439">ast_sched_add()</a>, <a class="el" href="sched_8c_source.html#l00078">ast_sched_thread::cond</a>, <a class="el" href="sched_8c_source.html#l00079">ast_sched_thread::context</a>, and <a class="el" href="sched_8c_source.html#l00077">ast_sched_thread::lock</a>.</p>

<p>Referenced by <a class="el" href="chan__iax2_8c_source.html#l04970">iax2_hangup()</a>, <a class="el" href="chan__iax2_8c_source.html#l05088">iax2_key_rotate()</a>, <a class="el" href="chan__iax2_8c_source.html#l01364">iax2_sched_add()</a>, and <a class="el" href="chan__iax2_8c_source.html#l01356">iax2_sched_replace()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00205"></a>00205 {
<a name="l00206"></a>00206    <span class="keywordtype">int</span> res;
<a name="l00207"></a>00207 
<a name="l00208"></a>00208    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;st-&gt;<a class="code" href="structast__sched__thread.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00209"></a>00209    res = <a class="code" href="sched_8h.html#a97176531282ac4e70aa107b2e8ee5543" title="Adds a scheduled event Schedule an event to take place at some point in the future...">ast_sched_add</a>(st-&gt;<a class="code" href="structast__sched__thread.html#ad4b28f484c84455dbd24c6a03a8b6b6a">context</a>, when, cb, data);
<a name="l00210"></a>00210    <span class="keywordflow">if</span> (res != -1) {
<a name="l00211"></a>00211       <a class="code" href="lock_8h.html#a02a91e30acdea6d13208d23636d37c87">ast_cond_signal</a>(&amp;st-&gt;<a class="code" href="structast__sched__thread.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>);
<a name="l00212"></a>00212    }
<a name="l00213"></a>00213    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;st-&gt;<a class="code" href="structast__sched__thread.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00214"></a>00214 
<a name="l00215"></a>00215    <span class="keywordflow">return</span> res;
<a name="l00216"></a>00216 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af845a75ffcb1f4877b3efc48aa9ea5ef"></a><!-- doxytag: member="sched.h::ast_sched_thread_add_variable" ref="af845a75ffcb1f4877b3efc48aa9ea5ef" args="(struct ast_sched_thread *st, int when, ast_sched_cb cb, const void *data, int variable)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_sched_thread_add_variable </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__sched__thread.html">ast_sched_thread</a> *&nbsp;</td>
          <td class="paramname"> <em>st</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>when</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="sched_8h.html#a57358d80decb5b8ddde4d2e7f1919b87">ast_sched_cb</a>&nbsp;</td>
          <td class="paramname"> <em>cb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>variable</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add a variable reschedule time scheduler entry. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>st</em>&nbsp;</td><td>the handle to the scheduler and thread </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>when</em>&nbsp;</td><td>the <a class="el" href="structnumber.html" title="Number structure.">number</a> of ms in the future to run the task. A value &lt;= 0 is treated as "run now". </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>cb</em>&nbsp;</td><td>the function to call when the scheduled time arrives </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>the parameter to pass to the scheduler callback </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>variable</em>&nbsp;</td><td>If this value is non-zero, then the scheduler will use the return value of the scheduler as the amount of time in the future to run the task again. Normally, a return value of 0 means do not re-schedule, and non-zero means re-schedule using the time provided when the scheduler entry was first created.</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>Failure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>&gt;=0</em>&nbsp;</td><td>Sched ID of added task </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="sched_8c_source.html#l00188">188</a> of file <a class="el" href="sched_8c_source.html">sched.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l01734">ast_cond_signal()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="sched_8c_source.html#l00399">ast_sched_add_variable()</a>, <a class="el" href="sched_8c_source.html#l00078">ast_sched_thread::cond</a>, <a class="el" href="sched_8c_source.html#l00079">ast_sched_thread::context</a>, and <a class="el" href="sched_8c_source.html#l00077">ast_sched_thread::lock</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00190"></a>00190 {
<a name="l00191"></a>00191    <span class="keywordtype">int</span> res;
<a name="l00192"></a>00192 
<a name="l00193"></a>00193    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;st-&gt;<a class="code" href="structast__sched__thread.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00194"></a>00194    res = <a class="code" href="sched_8h.html#a5d738bcc3c3d38165a59a17a35f6ca2c" title="Schedule callback(data) to happen when ms into the future.">ast_sched_add_variable</a>(st-&gt;<a class="code" href="structast__sched__thread.html#ad4b28f484c84455dbd24c6a03a8b6b6a">context</a>, when, cb, data, variable);
<a name="l00195"></a>00195    <span class="keywordflow">if</span> (res != -1) {
<a name="l00196"></a>00196       <a class="code" href="lock_8h.html#a02a91e30acdea6d13208d23636d37c87">ast_cond_signal</a>(&amp;st-&gt;<a class="code" href="structast__sched__thread.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>);
<a name="l00197"></a>00197    }
<a name="l00198"></a>00198    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;st-&gt;<a class="code" href="structast__sched__thread.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00199"></a>00199 
<a name="l00200"></a>00200    <span class="keywordflow">return</span> res;
<a name="l00201"></a>00201 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9bab503a0557af0b8a4fe04d06b69fb3"></a><!-- doxytag: member="sched.h::ast_sched_thread_create" ref="a9bab503a0557af0b8a4fe04d06b69fb3" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__sched__thread.html">ast_sched_thread</a>* ast_sched_thread_create </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Create a scheduler with a dedicated thread. </p>
<p>This function should be used to allocate a scheduler context and a dedicated thread for processing scheduler entries. The thread is started immediately.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>NULL</em>&nbsp;</td><td>error </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>non-NULL</em>&nbsp;</td><td>a handle to the scheduler and its dedicated thread. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="sched_8c_source.html#l00160">160</a> of file <a class="el" href="sched_8c_source.html">sched.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="lock_8h_source.html#l01729">ast_cond_init()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01692">ast_mutex_init()</a>, <a class="el" href="utils_8h_source.html#l00384">ast_pthread_create_background</a>, <a class="el" href="lock_8h_source.html#l00082">AST_PTHREADT_NULL</a>, <a class="el" href="sched_8c_source.html#l00136">ast_sched_thread_destroy()</a>, <a class="el" href="sched_8c_source.html#l00078">ast_sched_thread::cond</a>, <a class="el" href="sched_8c_source.html#l00079">ast_sched_thread::context</a>, <a class="el" href="sched_8c_source.html#l00077">ast_sched_thread::lock</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="sched_8c_source.html#l00239">sched_context_create()</a>, <a class="el" href="sched_8c_source.html#l00083">sched_run()</a>, and <a class="el" href="sched_8c_source.html#l00076">ast_sched_thread::thread</a>.</p>

<p>Referenced by <a class="el" href="chan__iax2_8c_source.html#l13805">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00161"></a>00161 {
<a name="l00162"></a>00162    <span class="keyword">struct </span><a class="code" href="structast__sched__thread.html">ast_sched_thread</a> *st;
<a name="l00163"></a>00163 
<a name="l00164"></a>00164    <span class="keywordflow">if</span> (!(st = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*st)))) {
<a name="l00165"></a>00165       <span class="keywordflow">return</span> NULL;
<a name="l00166"></a>00166    }
<a name="l00167"></a>00167 
<a name="l00168"></a>00168    <a class="code" href="lock_8h.html#a5dc895fe6e8c089175159fc22e33fc3b">ast_mutex_init</a>(&amp;st-&gt;<a class="code" href="structast__sched__thread.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00169"></a>00169    <a class="code" href="lock_8h.html#a21f75f462115427718d78aa66cc61f9b">ast_cond_init</a>(&amp;st-&gt;<a class="code" href="structast__sched__thread.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>, NULL);
<a name="l00170"></a>00170 
<a name="l00171"></a>00171    st-&gt;<a class="code" href="structast__sched__thread.html#a01f75a9ad916f63a94e06a27635ba278">thread</a> = <a class="code" href="lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>;
<a name="l00172"></a>00172 
<a name="l00173"></a>00173    <span class="keywordflow">if</span> (!(st-&gt;<a class="code" href="structast__sched__thread.html#ad4b28f484c84455dbd24c6a03a8b6b6a">context</a> = <a class="code" href="sched_8h.html#ad4fd5c63d5d3dcc8e11bec644c601017" title="New schedule context.">sched_context_create</a>())) {
<a name="l00174"></a>00174       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to create scheduler\n&quot;</span>);
<a name="l00175"></a>00175       <a class="code" href="sched_8h.html#a999272a0a148dae5131da23d78050797" title="Destroy a scheduler and its thread.">ast_sched_thread_destroy</a>(st);
<a name="l00176"></a>00176       <span class="keywordflow">return</span> NULL;
<a name="l00177"></a>00177    }
<a name="l00178"></a>00178    
<a name="l00179"></a>00179    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a595e2f8aa398f4bd21e381c3211235fe">ast_pthread_create_background</a>(&amp;st-&gt;<a class="code" href="structast__sched__thread.html#a01f75a9ad916f63a94e06a27635ba278">thread</a>, NULL, <a class="code" href="sched_8c.html#a451b6df83f02452a51f3c5c637f2e514">sched_run</a>, st)) {
<a name="l00180"></a>00180       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to create scheduler thread\n&quot;</span>);
<a name="l00181"></a>00181       <a class="code" href="sched_8h.html#a999272a0a148dae5131da23d78050797" title="Destroy a scheduler and its thread.">ast_sched_thread_destroy</a>(st);
<a name="l00182"></a>00182       <span class="keywordflow">return</span> NULL;
<a name="l00183"></a>00183    }
<a name="l00184"></a>00184 
<a name="l00185"></a>00185    <span class="keywordflow">return</span> st;
<a name="l00186"></a>00186 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a999272a0a148dae5131da23d78050797"></a><!-- doxytag: member="sched.h::ast_sched_thread_destroy" ref="a999272a0a148dae5131da23d78050797" args="(struct ast_sched_thread *st)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__sched__thread.html">ast_sched_thread</a>* ast_sched_thread_destroy </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__sched__thread.html">ast_sched_thread</a> *&nbsp;</td>
          <td class="paramname"> <em>st</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Destroy a scheduler and its thread. </p>
<p>This function is used to destroy a scheduler context and the dedicated thread that was created for handling scheduler entries. Any entries in the scheduler that have not yet been processed will be thrown away. Once this function is called, the handle must not be used again.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>st</em>&nbsp;</td><td>the handle to the scheduler and thread</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>NULL for convenience </dd></dl>

<p>Definition at line <a class="el" href="sched_8c_source.html#l00136">136</a> of file <a class="el" href="sched_8c_source.html">sched.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l01744">ast_cond_destroy()</a>, <a class="el" href="lock_8h_source.html#l01734">ast_cond_signal()</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="lock_8h_source.html#l01712">ast_mutex_destroy()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="lock_8h_source.html#l00082">AST_PTHREADT_NULL</a>, <a class="el" href="sched_8c_source.html#l00078">ast_sched_thread::cond</a>, <a class="el" href="sched_8c_source.html#l00079">ast_sched_thread::context</a>, <a class="el" href="sched_8c_source.html#l00077">ast_sched_thread::lock</a>, <a class="el" href="sched_8c_source.html#l00260">sched_context_destroy()</a>, <a class="el" href="sched_8c_source.html#l00080">ast_sched_thread::stop</a>, and <a class="el" href="sched_8c_source.html#l00076">ast_sched_thread::thread</a>.</p>

<p>Referenced by <a class="el" href="chan__iax2_8c_source.html#l13611">__unload_module()</a>, <a class="el" href="sched_8c_source.html#l00160">ast_sched_thread_create()</a>, and <a class="el" href="chan__iax2_8c_source.html#l13805">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00137"></a>00137 {
<a name="l00138"></a>00138    <span class="keywordflow">if</span> (st-&gt;<a class="code" href="structast__sched__thread.html#a01f75a9ad916f63a94e06a27635ba278">thread</a> != <a class="code" href="lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>) {
<a name="l00139"></a>00139       <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;st-&gt;<a class="code" href="structast__sched__thread.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00140"></a>00140       st-&gt;<a class="code" href="structast__sched__thread.html#a111277a0849f92b793ed6aa1efe54462">stop</a> = 1;
<a name="l00141"></a>00141       <a class="code" href="lock_8h.html#a02a91e30acdea6d13208d23636d37c87">ast_cond_signal</a>(&amp;st-&gt;<a class="code" href="structast__sched__thread.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>);
<a name="l00142"></a>00142       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;st-&gt;<a class="code" href="structast__sched__thread.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00143"></a>00143       pthread_join(st-&gt;<a class="code" href="structast__sched__thread.html#a01f75a9ad916f63a94e06a27635ba278">thread</a>, NULL);
<a name="l00144"></a>00144       st-&gt;<a class="code" href="structast__sched__thread.html#a01f75a9ad916f63a94e06a27635ba278">thread</a> = <a class="code" href="lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>;
<a name="l00145"></a>00145    }
<a name="l00146"></a>00146 
<a name="l00147"></a>00147    <a class="code" href="lock_8h.html#ab237e70b569019bfb490ab0c3c09b8c5">ast_mutex_destroy</a>(&amp;st-&gt;<a class="code" href="structast__sched__thread.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00148"></a>00148    <a class="code" href="lock_8h.html#a7752bcadc38f1d7a7a8528c538569115">ast_cond_destroy</a>(&amp;st-&gt;<a class="code" href="structast__sched__thread.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>);
<a name="l00149"></a>00149 
<a name="l00150"></a>00150    <span class="keywordflow">if</span> (st-&gt;<a class="code" href="structast__sched__thread.html#ad4b28f484c84455dbd24c6a03a8b6b6a">context</a>) {
<a name="l00151"></a>00151       <a class="code" href="sched_8h.html#a7350994bcfd1be91874493dbe25faf0c" title="destroys a schedule context Destroys (free&amp;#39;s) the given sched_context structure...">sched_context_destroy</a>(st-&gt;<a class="code" href="structast__sched__thread.html#ad4b28f484c84455dbd24c6a03a8b6b6a">context</a>);
<a name="l00152"></a>00152       st-&gt;<a class="code" href="structast__sched__thread.html#ad4b28f484c84455dbd24c6a03a8b6b6a">context</a> = NULL;
<a name="l00153"></a>00153    }
<a name="l00154"></a>00154 
<a name="l00155"></a>00155    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(st);
<a name="l00156"></a>00156 
<a name="l00157"></a>00157    <span class="keywordflow">return</span> NULL;
<a name="l00158"></a>00158 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2574d6d3ccdc66ecbc78501f237b59db"></a><!-- doxytag: member="sched.h::ast_sched_thread_get_context" ref="a2574d6d3ccdc66ecbc78501f237b59db" args="(struct ast_sched_thread *st)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structsched__context.html">sched_context</a>* ast_sched_thread_get_context </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__sched__thread.html">ast_sched_thread</a> *&nbsp;</td>
          <td class="paramname"> <em>st</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get the scheduler context for a given <a class="el" href="structast__sched__thread.html">ast_sched_thread</a>. </p>
<p>This function should be used only when direct access to the scheduler context is required. Its use is discouraged unless necessary. The cases where this is currently required is when you want to take advantage of one of the AST_SCHED macros.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>st</em>&nbsp;</td><td>the handle to the scheduler and thread</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>the <a class="el" href="structsched__context.html">sched_context</a> associated with an <a class="el" href="structast__sched__thread.html">ast_sched_thread</a> </dd></dl>

<p>Definition at line <a class="el" href="sched_8c_source.html#l00131">131</a> of file <a class="el" href="sched_8c_source.html">sched.c</a>.</p>

<p>References <a class="el" href="sched_8c_source.html#l00079">ast_sched_thread::context</a>.</p>

<p>Referenced by <a class="el" href="chan__iax2_8c_source.html#l01623">iax2_destroy_helper()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00132"></a>00132 {
<a name="l00133"></a>00133    <span class="keywordflow">return</span> st-&gt;<a class="code" href="structast__sched__thread.html#ad4b28f484c84455dbd24c6a03a8b6b6a">context</a>;
<a name="l00134"></a>00134 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab523defdc0b36cdf629eb81b7b5a20d6"></a><!-- doxytag: member="sched.h::ast_sched_thread_poke" ref="ab523defdc0b36cdf629eb81b7b5a20d6" args="(struct ast_sched_thread *st)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_sched_thread_poke </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__sched__thread.html">ast_sched_thread</a> *&nbsp;</td>
          <td class="paramname"> <em>st</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Force re-processing of the scheduler context. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>st</em>&nbsp;</td><td>the handle to the scheduler and thread</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>nothing </dd></dl>

<p>Definition at line <a class="el" href="sched_8c_source.html#l00124">124</a> of file <a class="el" href="sched_8c_source.html">sched.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l01734">ast_cond_signal()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="sched_8c_source.html#l00078">ast_sched_thread::cond</a>, and <a class="el" href="sched_8c_source.html#l00077">ast_sched_thread::lock</a>.</p>

<p>Referenced by <a class="el" href="chan__iax2_8c_source.html#l04054">iax2_transmit()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00125"></a>00125 {
<a name="l00126"></a>00126    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;st-&gt;<a class="code" href="structast__sched__thread.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00127"></a>00127    <a class="code" href="lock_8h.html#a02a91e30acdea6d13208d23636d37c87">ast_cond_signal</a>(&amp;st-&gt;<a class="code" href="structast__sched__thread.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>);
<a name="l00128"></a>00128    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;st-&gt;<a class="code" href="structast__sched__thread.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00129"></a>00129 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a64797d66b6051095debfcdb7f790e605"></a><!-- doxytag: member="sched.h::ast_sched_wait" ref="a64797d66b6051095debfcdb7f790e605" args="(struct sched_context *con) attribute_warn_unused_result" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_sched_wait </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structsched__context.html">sched_context</a> *&nbsp;</td>
          <td class="paramname"> <em>con</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Determines <a class="el" href="structnumber.html" title="Number structure.">number</a> of seconds until the next outstanding event to take place Determine the <a class="el" href="structnumber.html" title="Number structure.">number</a> of seconds until the next outstanding event should take place, and return the <a class="el" href="structnumber.html" title="Number structure.">number</a> of milliseconds until it needs to be run. This value is perfect for passing to the poll call. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>con</em>&nbsp;</td><td>context to act upon </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns "-1" if there is nothing there are no scheduled events (and thus the poll should not timeout) </dd></dl>

<p>Definition at line <a class="el" href="sched_8c_source.html#l00327">327</a> of file <a class="el" href="sched_8c_source.html">sched.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="heap_8c_source.html#l00291">ast_heap_peek()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="time_8h_source.html#l00089">ast_tvdiff_ms()</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="chan__alsa_8c_source.html#l00070">DEBUG</a>, <a class="el" href="sched_8c_source.html#l00062">sched_context::lock</a>, <a class="el" href="aesopt_8h_source.html#l00399">s</a>, <a class="el" href="sched_8c_source.html#l00067">sched_context::sched_heap</a>, and <a class="el" href="sched_8c_source.html#l00053">sched::when</a>.</p>

<p>Referenced by <a class="el" href="app__talkdetect_8c_source.html#l00076">background_detect_exec()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="cdr_8c_source.html#l01288">do_cdr()</a>, <a class="el" href="chan__h323_8c_source.html#l02529">do_monitor()</a>, <a class="el" href="dnsmgr_8c_source.html#l00205">do_refresh()</a>, <a class="el" href="res__agi_8c_source.html#l02137">handle_speechrecognize()</a>, <a class="el" href="chan__misdn_8c_source.html#l00748">misdn_tasks_thread_func()</a>, <a class="el" href="pbx__dundi_8c_source.html#l02166">network_thread()</a>, <a class="el" href="sched_8c_source.html#l00083">sched_run()</a>, <a class="el" href="app__speech__utils_8c_source.html#l00639">speech_background()</a>, <a class="el" href="app__followme_8c_source.html#l00509">wait_for_winner()</a>, and <a class="el" href="file_8c_source.html#l01168">waitstream_core()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00328"></a>00328 {
<a name="l00329"></a>00329    <span class="keywordtype">int</span> ms;
<a name="l00330"></a>00330    <span class="keyword">struct </span><a class="code" href="structsched.html">sched</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>;
<a name="l00331"></a>00331 
<a name="l00332"></a>00332    <a class="code" href="chan__alsa_8c.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a>(<a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;ast_sched_wait()\n&quot;</span>));
<a name="l00333"></a>00333 
<a name="l00334"></a>00334    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;con-&gt;<a class="code" href="structsched__context.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00335"></a>00335    <span class="keywordflow">if</span> ((s = <a class="code" href="heap_8h.html#aaa326b988236a0841d41cf2af8ec9b7e" title="Peek at an element on a heap.">ast_heap_peek</a>(con-&gt;<a class="code" href="structsched__context.html#afb2936780a5abba63b413db727f6d566">sched_heap</a>, 1))) {
<a name="l00336"></a>00336       ms = <a class="code" href="time_8h.html#a74e35cffcd45ad6cd7c8587921e8a4c2" title="Computes the difference (in milliseconds) between two struct timeval instances.">ast_tvdiff_ms</a>(s-&gt;<a class="code" href="structsched.html#a9c0783ff5b989460d3d42460fd182f67">when</a>, <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>());
<a name="l00337"></a>00337       <span class="keywordflow">if</span> (ms &lt; 0) {
<a name="l00338"></a>00338          ms = 0;
<a name="l00339"></a>00339       }
<a name="l00340"></a>00340    } <span class="keywordflow">else</span> {
<a name="l00341"></a>00341       ms = -1;
<a name="l00342"></a>00342    }
<a name="l00343"></a>00343    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;con-&gt;<a class="code" href="structsched__context.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00344"></a>00344 
<a name="l00345"></a>00345    <span class="keywordflow">return</span> ms;
<a name="l00346"></a>00346 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7b21967a70222990d1d7267b950f9e66"></a><!-- doxytag: member="sched.h::ast_sched_when" ref="a7b21967a70222990d1d7267b950f9e66" args="(struct sched_context *con, int id)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">long ast_sched_when </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structsched__context.html">sched_context</a> *&nbsp;</td>
          <td class="paramname"> <em>con</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>id</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Returns the <a class="el" href="structnumber.html" title="Number structure.">number</a> of seconds before an event takes place. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>con</em>&nbsp;</td><td>Context to use </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>id</em>&nbsp;</td><td>Id to dump </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="sched_8c_source.html#l00645">645</a> of file <a class="el" href="sched_8c_source.html">sched.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="hashtab_8c_source.html#l00530">ast_hashtab_lookup()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="chan__alsa_8c_source.html#l00070">DEBUG</a>, <a class="el" href="sched_8c_source.html#l00052">sched::id</a>, <a class="el" href="sched_8c_source.html#l00062">sched_context::lock</a>, <a class="el" href="aesopt_8h_source.html#l00399">s</a>, <a class="el" href="sched_8c_source.html#l00066">sched_context::schedq_ht</a>, and <a class="el" href="sched_8c_source.html#l00053">sched::when</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l15349">_sip_show_peer()</a>, <a class="el" href="cdr_8c_source.html#l01314">handle_cli_status()</a>, and <a class="el" href="chan__sip_8c_source.html#l12222">parse_register_contact()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00646"></a>00646 {
<a name="l00647"></a>00647    <span class="keyword">struct </span><a class="code" href="structsched.html">sched</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>, tmp;
<a name="l00648"></a>00648    <span class="keywordtype">long</span> secs = -1;
<a name="l00649"></a>00649    <a class="code" href="chan__alsa_8c.html#ad72dbcf6d0153db1b8d8a58001feed83">DEBUG</a>(<a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;ast_sched_when()\n&quot;</span>));
<a name="l00650"></a>00650 
<a name="l00651"></a>00651    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;con-&gt;<a class="code" href="structsched__context.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00652"></a>00652    
<a name="l00653"></a>00653    <span class="comment">/* these next 2 lines replace a lookup loop */</span>
<a name="l00654"></a>00654    tmp.<a class="code" href="structsched.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a> = <a class="code" href="app__queue_8c.html#acd1f0e9b4730ec60f62cb0806cb06ef1">id</a>;
<a name="l00655"></a>00655    s = <a class="code" href="hashtab_8h.html#a78b1f7bc201afd020f6270378173bb79" title="Lookup this object in the hash table.">ast_hashtab_lookup</a>(con-&gt;<a class="code" href="structsched__context.html#a889c78832d62b9fa4c3b970d43c922b9">schedq_ht</a>, &amp;tmp);
<a name="l00656"></a>00656    
<a name="l00657"></a>00657    <span class="keywordflow">if</span> (s) {
<a name="l00658"></a>00658       <span class="keyword">struct </span>timeval now = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l00659"></a>00659       secs = s-&gt;<a class="code" href="structsched.html#a9c0783ff5b989460d3d42460fd182f67">when</a>.tv_sec - now.tv_sec;
<a name="l00660"></a>00660    }
<a name="l00661"></a>00661    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;con-&gt;<a class="code" href="structsched__context.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00662"></a>00662    
<a name="l00663"></a>00663    <span class="keywordflow">return</span> secs;
<a name="l00664"></a>00664 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad4fd5c63d5d3dcc8e11bec644c601017"></a><!-- doxytag: member="sched.h::sched_context_create" ref="ad4fd5c63d5d3dcc8e11bec644c601017" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structsched__context.html">sched_context</a>* sched_context_create </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>New schedule context. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>Create a scheduling context </dd></dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns a malloc'd <a class="el" href="structsched__context.html">sched_context</a> structure, NULL on failure </dd></dl>

<p>Definition at line <a class="el" href="sched_8c_source.html#l00239">239</a> of file <a class="el" href="sched_8c_source.html">sched.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="hashtab_8c_source.html#l00222">ast_hashtab_create()</a>, <a class="el" href="hashtab_8c_source.html#l00127">ast_hashtab_newsize_java()</a>, <a class="el" href="hashtab_8c_source.html#l00084">ast_hashtab_resize_java()</a>, <a class="el" href="heap_8c_source.html#l00114">ast_heap_create()</a>, <a class="el" href="lock_8h_source.html#l01692">ast_mutex_init()</a>, <a class="el" href="sched_8c_source.html#l00063">sched_context::eventcnt</a>, <a class="el" href="sched_8c_source.html#l00062">sched_context::lock</a>, <a class="el" href="sched_8c_source.html#l00220">sched_cmp()</a>, <a class="el" href="sched_8c_source.html#l00260">sched_context_destroy()</a>, <a class="el" href="sched_8c_source.html#l00227">sched_hash()</a>, <a class="el" href="sched_8c_source.html#l00067">sched_context::sched_heap</a>, <a class="el" href="sched_8c_source.html#l00234">sched_time_cmp()</a>, and <a class="el" href="sched_8c_source.html#l00066">sched_context::schedq_ht</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l00772">__ast_channel_alloc_ap()</a>, <a class="el" href="cdr_8c_source.html#l01522">ast_cdr_engine_init()</a>, <a class="el" href="sched_8c_source.html#l00160">ast_sched_thread_create()</a>, <a class="el" href="dnsmgr_8c_source.html#l00350">dnsmgr_init()</a>, <a class="el" href="chan__gtalk_8c_source.html#l02033">load_module()</a>, and <a class="el" href="chan__misdn_8c_source.html#l00774">misdn_tasks_init()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00240"></a>00240 {
<a name="l00241"></a>00241    <span class="keyword">struct </span><a class="code" href="structsched__context.html">sched_context</a> *tmp;
<a name="l00242"></a>00242 
<a name="l00243"></a>00243    <span class="keywordflow">if</span> (!(tmp = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*tmp))))
<a name="l00244"></a>00244       <span class="keywordflow">return</span> NULL;
<a name="l00245"></a>00245 
<a name="l00246"></a>00246    <a class="code" href="lock_8h.html#a5dc895fe6e8c089175159fc22e33fc3b">ast_mutex_init</a>(&amp;tmp-&gt;<a class="code" href="structsched__context.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00247"></a>00247    tmp-&gt;<a class="code" href="structsched__context.html#a2d5621366e555704664f39180c7a758c">eventcnt</a> = 1;
<a name="l00248"></a>00248 
<a name="l00249"></a>00249    tmp-&gt;<a class="code" href="structsched__context.html#a889c78832d62b9fa4c3b970d43c922b9">schedq_ht</a> = <a class="code" href="hashtab_8h.html#a85701d44df4ea1e746bde709a91a4192" title="Create the hashtable list.">ast_hashtab_create</a>(23, <a class="code" href="sched_8c.html#a87764d2d6766e3e1cf5fe28938d27b46">sched_cmp</a>, <a class="code" href="hashtab_8h.html#aef63906caa0b965e9c8d8561600038e9" title="Determines if a table resize should occur using the Java algorithm (if the table...">ast_hashtab_resize_java</a>, <a class="code" href="hashtab_8h.html#a743bfd52a8c9eb5d939ff5944758d846" title="Create a prime number roughly 2x the current table size.">ast_hashtab_newsize_java</a>, <a class="code" href="sched_8c.html#a0f6b1c11884d94b880c9a2ccc203a744">sched_hash</a>, 1);
<a name="l00250"></a>00250 
<a name="l00251"></a>00251    <span class="keywordflow">if</span> (!(tmp-&gt;<a class="code" href="structsched__context.html#afb2936780a5abba63b413db727f6d566">sched_heap</a> = <a class="code" href="heap_8h.html#a2b4b738c784e05941437ff369a399712" title="Create a max heap.">ast_heap_create</a>(8, <a class="code" href="sched_8c.html#ac4c5e482fd7096d522947c26eed4faf7">sched_time_cmp</a>,
<a name="l00252"></a>00252          offsetof(<span class="keyword">struct</span> <a class="code" href="structsched.html">sched</a>, __heap_index)))) {
<a name="l00253"></a>00253       <a class="code" href="sched_8h.html#a7350994bcfd1be91874493dbe25faf0c" title="destroys a schedule context Destroys (free&amp;#39;s) the given sched_context structure...">sched_context_destroy</a>(tmp);
<a name="l00254"></a>00254       <span class="keywordflow">return</span> NULL;
<a name="l00255"></a>00255    }
<a name="l00256"></a>00256 
<a name="l00257"></a>00257    <span class="keywordflow">return</span> tmp;
<a name="l00258"></a>00258 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7350994bcfd1be91874493dbe25faf0c"></a><!-- doxytag: member="sched.h::sched_context_destroy" ref="a7350994bcfd1be91874493dbe25faf0c" args="(struct sched_context *c)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sched_context_destroy </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structsched__context.html">sched_context</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>destroys a schedule context Destroys (free's) the given <a class="el" href="structsched__context.html">sched_context</a> structure </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>c</em>&nbsp;</td><td>Context to free </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns 0 on success, -1 on failure </dd></dl>

<p>Definition at line <a class="el" href="sched_8c_source.html#l00260">260</a> of file <a class="el" href="sched_8c_source.html">sched.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="hashtab_8c_source.html#l00384">ast_hashtab_destroy()</a>, <a class="el" href="heap_8c_source.html#l00159">ast_heap_destroy()</a>, <a class="el" href="heap_8c_source.html#l00286">ast_heap_pop()</a>, <a class="el" href="linkedlists_8h_source.html#l00817">AST_LIST_REMOVE_HEAD</a>, <a class="el" href="lock_8h_source.html#l01712">ast_mutex_destroy()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="sched_8c_source.html#l00062">sched_context::lock</a>, <a class="el" href="aesopt_8h_source.html#l00399">s</a>, <a class="el" href="sched_8c_source.html#l00067">sched_context::sched_heap</a>, <a class="el" href="structsched__context.html#ac9775231aaa6c316ae37c8ef472b054e">sched_context::schedc</a>, and <a class="el" href="sched_8c_source.html#l00066">sched_context::schedq_ht</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l00772">__ast_channel_alloc_ap()</a>, <a class="el" href="channel_8c_source.html#l01388">ast_channel_free()</a>, <a class="el" href="channel_8c_source.html#l01690">ast_hangup()</a>, <a class="el" href="sched_8c_source.html#l00136">ast_sched_thread_destroy()</a>, <a class="el" href="chan__h323_8c_source.html#l03222">load_module()</a>, <a class="el" href="chan__misdn_8c_source.html#l00793">misdn_tasks_destroy()</a>, <a class="el" href="sched_8c_source.html#l00239">sched_context_create()</a>, and <a class="el" href="chan__h323_8c_source.html#l03325">unload_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00261"></a>00261 {
<a name="l00262"></a>00262    <span class="keyword">struct </span><a class="code" href="structsched.html">sched</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>;
<a name="l00263"></a>00263 
<a name="l00264"></a>00264    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;con-&gt;lock);
<a name="l00265"></a>00265 
<a name="l00266"></a>00266 <span class="preprocessor">#ifdef SCHED_MAX_CACHE</span>
<a name="l00267"></a>00267 <span class="preprocessor"></span>   <span class="comment">/* Eliminate the cache */</span>
<a name="l00268"></a>00268    <span class="keywordflow">while</span> ((s = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;con-&gt;schedc, <a class="code" href="structsched.html#a3832d99bef2b6a52414eab3c956c94c6">list</a>)))
<a name="l00269"></a>00269       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(s);
<a name="l00270"></a>00270 <span class="preprocessor">#endif</span>
<a name="l00271"></a>00271 <span class="preprocessor"></span>
<a name="l00272"></a>00272    <span class="keywordflow">if</span> (con-&gt;sched_heap) {
<a name="l00273"></a>00273       <span class="keywordflow">while</span> ((s = <a class="code" href="heap_8h.html#ad56625488a481df852f0b13d58b15a93" title="Pop the max element off of the heap.">ast_heap_pop</a>(con-&gt;sched_heap))) {
<a name="l00274"></a>00274          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(s);
<a name="l00275"></a>00275       }
<a name="l00276"></a>00276       <a class="code" href="heap_8h.html#a66d0a4a9d9e08e704abc44c856407bb8" title="Destroy a max heap.">ast_heap_destroy</a>(con-&gt;sched_heap);
<a name="l00277"></a>00277       con-&gt;sched_heap = NULL;
<a name="l00278"></a>00278    }
<a name="l00279"></a>00279 
<a name="l00280"></a>00280    <a class="code" href="hashtab_8h.html#a6103589badf8d9440a0cece2802c4c3a" title="This func will free the hash table and all its memory.">ast_hashtab_destroy</a>(con-&gt;schedq_ht, NULL);
<a name="l00281"></a>00281    con-&gt;schedq_ht = NULL;
<a name="l00282"></a>00282    
<a name="l00283"></a>00283    <span class="comment">/* And the context */</span>
<a name="l00284"></a>00284    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;con-&gt;lock);
<a name="l00285"></a>00285    <a class="code" href="lock_8h.html#ab237e70b569019bfb490ab0c3c09b8c5">ast_mutex_destroy</a>(&amp;con-&gt;lock);
<a name="l00286"></a>00286    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(con);
<a name="l00287"></a>00287 }
</pre></div></p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:23:30 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
