<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:18:42 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_1ab815038f534adda65c8b4ae4993449.html">include</a>
  </div>
</div>
<div class="contents">
<h1>jitterbuf.h</h1><a href="jitterbuf_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * jitterbuf: an application-independent jitterbuffer</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * Copyrights:</span>
<a name="l00005"></a>00005 <span class="comment"> * Copyright (C) 2004-2005, Horizon Wimba, Inc.</span>
<a name="l00006"></a>00006 <span class="comment"> *</span>
<a name="l00007"></a>00007 <span class="comment"> * Contributors:</span>
<a name="l00008"></a>00008 <span class="comment"> * Steve Kann &lt;stevek@stevek.com&gt;</span>
<a name="l00009"></a>00009 <span class="comment"> *</span>
<a name="l00010"></a>00010 <span class="comment"> * This program is free software, distributed under the terms of</span>
<a name="l00011"></a>00011 <span class="comment"> * the GNU Lesser (Library) General Public License</span>
<a name="l00012"></a>00012 <span class="comment"> *</span>
<a name="l00013"></a>00013 <span class="comment"> * Copyright on this file is disclaimed to Digium for inclusion in Asterisk</span>
<a name="l00014"></a>00014 <span class="comment"> */</span>
<a name="l00015"></a>00015 <span class="comment"></span>
<a name="l00016"></a>00016 <span class="comment">/*! \file</span>
<a name="l00017"></a>00017 <span class="comment"> * \brief </span>
<a name="l00018"></a>00018 <span class="comment"> * jitterbuf: an application-independent jitterbuffer</span>
<a name="l00019"></a>00019 <span class="comment"> * \ref jitterbuf.c</span>
<a name="l00020"></a>00020 <span class="comment"> */</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="preprocessor">#ifndef _JITTERBUF_H_</span>
<a name="l00024"></a>00024 <span class="preprocessor"></span><span class="preprocessor">#define _JITTERBUF_H_</span>
<a name="l00025"></a>00025 <span class="preprocessor"></span>
<a name="l00026"></a>00026 <span class="preprocessor">#ifdef __cplusplus</span>
<a name="l00027"></a>00027 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> {
<a name="l00028"></a>00028 <span class="preprocessor">#endif</span>
<a name="l00029"></a>00029 <span class="preprocessor"></span><span class="comment"></span>
<a name="l00030"></a>00030 <span class="comment">/*! \name configuration constants */</span><span class="comment"></span>
<a name="l00031"></a>00031 <span class="comment">/*@{ */</span><span class="comment"></span>
<a name="l00032"></a>00032 <span class="comment">   /*! Number of historical timestamps to use in calculating jitter and drift */</span>
<a name="l00033"></a><a class="code" href="jitterbuf_8h.html#a9dc3051902032b0955fbd9d8965ac824">00033</a> <span class="preprocessor">#define JB_HISTORY_SZ      500   </span>
<a name="l00034"></a>00034 <span class="preprocessor"></span><span class="comment">   /*! what percentage of timestamps should we drop from the history when we examine it;</span>
<a name="l00035"></a>00035 <span class="comment">    * this might eventually be something made configurable */</span>
<a name="l00036"></a><a class="code" href="jitterbuf_8h.html#ac67629555c4de1f47f146669bab821cf">00036</a> <span class="preprocessor">#define JB_HISTORY_DROPPCT 3</span>
<a name="l00037"></a>00037 <span class="preprocessor"></span><span class="comment">   /*! the maximum droppct we can handle (say it was configurable). */</span>
<a name="l00038"></a><a class="code" href="jitterbuf_8h.html#a212c8dc3ed8bc5dd607396645c19ba9b">00038</a> <span class="preprocessor">#define JB_HISTORY_DROPPCT_MAX   4</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span><span class="comment">   /*! the size of the buffer we use to keep the top and botton timestamps for dropping */</span>
<a name="l00040"></a><a class="code" href="jitterbuf_8h.html#ac2d587e25cce0de796a6b8522b7b5e10">00040</a> <span class="preprocessor">#define JB_HISTORY_MAXBUF_SZ  JB_HISTORY_SZ * JB_HISTORY_DROPPCT_MAX / 100 </span>
<a name="l00041"></a>00041 <span class="preprocessor"></span><span class="comment">   /*! amount of additional jitterbuffer adjustment  */</span>
<a name="l00042"></a><a class="code" href="jitterbuf_8h.html#a17730bc1072071b7613d0f937cd9ad74">00042</a> <span class="preprocessor">#define JB_TARGET_EXTRA 40</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span><span class="comment">   /*! ms between growing and shrinking; may not be honored if jitterbuffer runs out of space */</span>
<a name="l00044"></a><a class="code" href="jitterbuf_8h.html#a5b69cdb660d614cbf51521bc8bc114c1">00044</a> <span class="preprocessor">#define JB_ADJUST_DELAY 40</span>
<a name="l00045"></a>00045 <span class="preprocessor"></span><span class="comment">/*@} */</span>
<a name="l00046"></a>00046 
<a name="l00047"></a><a class="code" href="jitterbuf_8h.html#ad8d0ce8a0ebfabfe77a56b17b2d154f5">00047</a> <span class="keyword">enum</span> <a class="code" href="jitterbuf_8h.html#ad8d0ce8a0ebfabfe77a56b17b2d154f5">jb_return_code</a> {
<a name="l00048"></a>00048    <span class="comment">/* return codes */</span>
<a name="l00049"></a><a class="code" href="jitterbuf_8h.html#ad8d0ce8a0ebfabfe77a56b17b2d154f5abcbf2631f2f32ca1af2a49ff82bebaec">00049</a>    <a class="code" href="jitterbuf_8h.html#ad8d0ce8a0ebfabfe77a56b17b2d154f5abcbf2631f2f32ca1af2a49ff82bebaec">JB_OK</a>,            <span class="comment">/* 0 */</span>
<a name="l00050"></a><a class="code" href="jitterbuf_8h.html#ad8d0ce8a0ebfabfe77a56b17b2d154f5a0abf1d52696752de6c37e8f57396f4a5">00050</a>    <a class="code" href="jitterbuf_8h.html#ad8d0ce8a0ebfabfe77a56b17b2d154f5a0abf1d52696752de6c37e8f57396f4a5">JB_EMPTY</a>,         <span class="comment">/* 1 */</span>
<a name="l00051"></a><a class="code" href="jitterbuf_8h.html#ad8d0ce8a0ebfabfe77a56b17b2d154f5ab70c5579075588aaade78deb3800c0a9">00051</a>    <a class="code" href="jitterbuf_8h.html#ad8d0ce8a0ebfabfe77a56b17b2d154f5ab70c5579075588aaade78deb3800c0a9">JB_NOFRAME</a>,       <span class="comment">/* 2 */</span>
<a name="l00052"></a><a class="code" href="jitterbuf_8h.html#ad8d0ce8a0ebfabfe77a56b17b2d154f5abaf74218828771bc4c562a6594dd218e">00052</a>    <a class="code" href="jitterbuf_8h.html#ad8d0ce8a0ebfabfe77a56b17b2d154f5abaf74218828771bc4c562a6594dd218e">JB_INTERP</a>,        <span class="comment">/* 3 */</span>
<a name="l00053"></a><a class="code" href="jitterbuf_8h.html#ad8d0ce8a0ebfabfe77a56b17b2d154f5a5807660dd8eaef6bea3e3347a91c93a6">00053</a>    <a class="code" href="jitterbuf_8h.html#ad8d0ce8a0ebfabfe77a56b17b2d154f5a5807660dd8eaef6bea3e3347a91c93a6">JB_DROP</a>,          <span class="comment">/* 4 */</span>
<a name="l00054"></a><a class="code" href="jitterbuf_8h.html#ad8d0ce8a0ebfabfe77a56b17b2d154f5a3ef27a58ff51c815b4c27e94f65cfdd2">00054</a>    <a class="code" href="jitterbuf_8h.html#ad8d0ce8a0ebfabfe77a56b17b2d154f5a3ef27a58ff51c815b4c27e94f65cfdd2">JB_SCHED</a>          <span class="comment">/* 5 */</span>
<a name="l00055"></a>00055 };
<a name="l00056"></a>00056 
<a name="l00057"></a><a class="code" href="jitterbuf_8h.html#a7e72da000f982634fda8319b82db8de5">00057</a> <span class="keyword">enum</span> <a class="code" href="jitterbuf_8h.html#a7e72da000f982634fda8319b82db8de5">jb_frame_type</a> {
<a name="l00058"></a>00058    <span class="comment">/* frame types */</span>
<a name="l00059"></a><a class="code" href="jitterbuf_8h.html#a7e72da000f982634fda8319b82db8de5a50fcc4e23186d417f90aa3f8582c70eb">00059</a>    <a class="code" href="jitterbuf_8h.html#a7e72da000f982634fda8319b82db8de5a50fcc4e23186d417f90aa3f8582c70eb">JB_TYPE_CONTROL</a>,  <span class="comment">/*!&lt; 0            */</span>
<a name="l00060"></a><a class="code" href="jitterbuf_8h.html#a7e72da000f982634fda8319b82db8de5ad5dc59855a16913d9c6bdda89bb8ea31">00060</a>    <a class="code" href="jitterbuf_8h.html#a7e72da000f982634fda8319b82db8de5ad5dc59855a16913d9c6bdda89bb8ea31">JB_TYPE_VOICE</a>,    <span class="comment">/*!&lt; 1            */</span>
<a name="l00061"></a><a class="code" href="jitterbuf_8h.html#a7e72da000f982634fda8319b82db8de5a1201e6bd467195a2347a6c75d34a7cc4">00061</a>    <a class="code" href="jitterbuf_8h.html#a7e72da000f982634fda8319b82db8de5a1201e6bd467195a2347a6c75d34a7cc4">JB_TYPE_VIDEO</a>,    <span class="comment">/*!&lt; 2 - reserved */</span>
<a name="l00062"></a><a class="code" href="jitterbuf_8h.html#a7e72da000f982634fda8319b82db8de5ab7844afd5de9edf071e06de0c65b707b">00062</a>    <a class="code" href="jitterbuf_8h.html#a7e72da000f982634fda8319b82db8de5ab7844afd5de9edf071e06de0c65b707b">JB_TYPE_SILENCE</a>   <span class="comment">/*!&lt; 3            */</span>
<a name="l00063"></a>00063 };
<a name="l00064"></a>00064 
<a name="l00065"></a><a class="code" href="structjb__conf.html">00065</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structjb__conf.html">jb_conf</a> {
<a name="l00066"></a>00066    <span class="comment">/* settings */</span>
<a name="l00067"></a><a class="code" href="structjb__conf.html#a560b79d26ead7b640d797181c9c3122c">00067</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__conf.html#a560b79d26ead7b640d797181c9c3122c">max_jitterbuf</a>;  <span class="comment">/*!&lt; defines a hard clamp to use in setting the jitter buffer delay */</span>
<a name="l00068"></a><a class="code" href="structjb__conf.html#ab5d708c3e3489b6fd1f92b19939c18e8">00068</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__conf.html#ab5d708c3e3489b6fd1f92b19939c18e8">resync_threshold</a>;  <span class="comment">/*!&lt; the jb will resync when delay increases to (2 * jitter) + this param */</span>
<a name="l00069"></a><a class="code" href="structjb__conf.html#af42f40eb2b87dd2147bd66357e99eff4">00069</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__conf.html#af42f40eb2b87dd2147bd66357e99eff4">max_contig_interp</a>; <span class="comment">/*!&lt; the max interp frames to return in a row */</span>
<a name="l00070"></a><a class="code" href="structjb__conf.html#a322d898485ffd6c3c07391f381903bdd">00070</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__conf.html#a322d898485ffd6c3c07391f381903bdd">target_extra</a> ;      <span class="comment">/*!&lt; amount of additional jitterbuffer adjustment, overrides JB_TARGET_EXTRA */</span>
<a name="l00071"></a>00071 } <a class="code" href="structjb__conf.html">jb_conf</a>;
<a name="l00072"></a>00072 
<a name="l00073"></a><a class="code" href="structjb__info.html">00073</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structjb__info.html">jb_info</a> {
<a name="l00074"></a><a class="code" href="structjb__info.html#a9473109a7fc3289f61f51fb2a9ee1a2c">00074</a>    <a class="code" href="structjb__conf.html">jb_conf</a> <a class="code" href="structjb__info.html#a9473109a7fc3289f61f51fb2a9ee1a2c">conf</a>;
<a name="l00075"></a>00075 
<a name="l00076"></a>00076    <span class="comment">/* statistics */</span>
<a name="l00077"></a><a class="code" href="structjb__info.html#a6b4cf44c3596e1c177e012e0a139b992">00077</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__info.html#a6b4cf44c3596e1c177e012e0a139b992">frames_in</a>;   <span class="comment">/*!&lt; number of frames input to the jitterbuffer.*/</span>
<a name="l00078"></a><a class="code" href="structjb__info.html#a1b7aae4a44d3fb7cf94b628faa68570e">00078</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__info.html#a1b7aae4a44d3fb7cf94b628faa68570e">frames_out</a>;     <span class="comment">/*!&lt; number of frames output from the jitterbuffer.*/</span>
<a name="l00079"></a><a class="code" href="structjb__info.html#ad00a4b212225088c87e90e9ddee1a47b">00079</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__info.html#ad00a4b212225088c87e90e9ddee1a47b">frames_late</a>;    <span class="comment">/*!&lt; number of frames which were too late, and dropped.*/</span>
<a name="l00080"></a><a class="code" href="structjb__info.html#aad59f039b77a1f7998a401966b6ec58d">00080</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__info.html#aad59f039b77a1f7998a401966b6ec58d">frames_lost</a>;    <span class="comment">/*!&lt; number of missing frames.*/</span>
<a name="l00081"></a><a class="code" href="structjb__info.html#ad46c17494e36cde0dda69873d2246614">00081</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__info.html#ad46c17494e36cde0dda69873d2246614">frames_dropped</a>;    <span class="comment">/*!&lt; number of frames dropped (shrinkage) */</span>
<a name="l00082"></a><a class="code" href="structjb__info.html#ac437d83ff5b3b72934f71acb20f608ca">00082</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__info.html#ac437d83ff5b3b72934f71acb20f608ca">frames_ooo</a>;  <span class="comment">/*!&lt; number of frames received out-of-order */</span>
<a name="l00083"></a><a class="code" href="structjb__info.html#a0af8659e11d9aedb77911245ffd5a5b4">00083</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__info.html#a0af8659e11d9aedb77911245ffd5a5b4">frames_cur</a>;  <span class="comment">/*!&lt; number of frames presently in jb, awaiting delivery.*/</span>
<a name="l00084"></a><a class="code" href="structjb__info.html#af22a222c07f645ad8b7eab0d4e7c4e9d">00084</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__info.html#af22a222c07f645ad8b7eab0d4e7c4e9d">jitter</a>;      <span class="comment">/*!&lt; jitter measured within current history interval*/</span>
<a name="l00085"></a><a class="code" href="structjb__info.html#a619cfe5e6bc1ed5a8c4d5601f9e159df">00085</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__info.html#a619cfe5e6bc1ed5a8c4d5601f9e159df">min</a>;      <span class="comment">/*!&lt; minimum lateness within current history interval */</span>
<a name="l00086"></a><a class="code" href="structjb__info.html#a67fec00dfad51ea05ccda5e0141a5169">00086</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__info.html#a67fec00dfad51ea05ccda5e0141a5169">current</a>;     <span class="comment">/*!&lt; the present jitterbuffer adjustment */</span>
<a name="l00087"></a><a class="code" href="structjb__info.html#a30c079f38fd808d70f29cd0d0c433f51">00087</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__info.html#a30c079f38fd808d70f29cd0d0c433f51">target</a>;      <span class="comment">/*!&lt; the target jitterbuffer adjustment */</span>
<a name="l00088"></a><a class="code" href="structjb__info.html#a6dfda2a3ff35f2859488b5639d88715e">00088</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__info.html#a6dfda2a3ff35f2859488b5639d88715e">losspct</a>;     <span class="comment">/*!&lt; recent lost frame percentage (* 1000) */</span>
<a name="l00089"></a><a class="code" href="structjb__info.html#ae1a11de077ce06513a902d8488385d47">00089</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__info.html#ae1a11de077ce06513a902d8488385d47">next_voice_ts</a>;  <span class="comment">/*!&lt; the ts of the next frame to be read from the jb - in receiver&apos;s time */</span>
<a name="l00090"></a><a class="code" href="structjb__info.html#ad98d5991900a7017490036fe5ebb2396">00090</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__info.html#ad98d5991900a7017490036fe5ebb2396">last_voice_ms</a>;  <span class="comment">/*!&lt; the duration of the last voice frame */</span>
<a name="l00091"></a><a class="code" href="structjb__info.html#a888d38ba07ae3ca79c6b76e05140794e">00091</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__info.html#a888d38ba07ae3ca79c6b76e05140794e">silence_begin_ts</a>;  <span class="comment">/*!&lt; the time of the last CNG frame, when in silence */</span>
<a name="l00092"></a><a class="code" href="structjb__info.html#ad879d1824febb52f8784a42e975e2071">00092</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__info.html#ad879d1824febb52f8784a42e975e2071">last_adjustment</a>;   <span class="comment">/*!&lt; the time of the last adjustment */</span>
<a name="l00093"></a><a class="code" href="structjb__info.html#a4c94a0a945423d05ad7082498624d5f6">00093</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__info.html#a4c94a0a945423d05ad7082498624d5f6">last_delay</a>;        <span class="comment">/*!&lt; the last now added to history */</span>
<a name="l00094"></a><a class="code" href="structjb__info.html#ad9b2792eaf44d42492a8392bdb114a37">00094</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__info.html#ad9b2792eaf44d42492a8392bdb114a37">cnt_delay_discont</a>; <span class="comment">/*!&lt; the count of discontinuous delays */</span>
<a name="l00095"></a><a class="code" href="structjb__info.html#a325d674197a0f11713c9aad58b0af9d7">00095</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__info.html#a325d674197a0f11713c9aad58b0af9d7">resync_offset</a>;     <span class="comment">/*!&lt; the amount to offset ts to support resyncs */</span>
<a name="l00096"></a><a class="code" href="structjb__info.html#a488db881a01af9b22e1c76d8d9248398">00096</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__info.html#a488db881a01af9b22e1c76d8d9248398">cnt_contig_interp</a>; <span class="comment">/*!&lt; the number of contiguous interp frames returned */</span>
<a name="l00097"></a>00097 } <a class="code" href="structjb__info.html">jb_info</a>;
<a name="l00098"></a>00098 
<a name="l00099"></a><a class="code" href="structjb__frame.html">00099</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structjb__frame.html">jb_frame</a> {
<a name="l00100"></a><a class="code" href="structjb__frame.html#a735984d41155bc1032e09bece8f8d66d">00100</a>    <span class="keywordtype">void</span> *<a class="code" href="structjb__frame.html#a735984d41155bc1032e09bece8f8d66d">data</a>;               <span class="comment">/* the frame data */</span>
<a name="l00101"></a><a class="code" href="structjb__frame.html#a1eb46dcb363821328c0d2a758549216b">00101</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__frame.html#a1eb46dcb363821328c0d2a758549216b">ts</a>;                  <span class="comment">/* the relative delivery time expected */</span>
<a name="l00102"></a><a class="code" href="structjb__frame.html#a035c5e34bb570292ece2908966467b0f">00102</a>    <span class="keywordtype">long</span> <a class="code" href="structjb__frame.html#a035c5e34bb570292ece2908966467b0f">ms</a>;                  <span class="comment">/* the time covered by this frame, in sec/8000 */</span>
<a name="l00103"></a><a class="code" href="structjb__frame.html#afcc96c20c76b0b3421affdf01600f545">00103</a>    <span class="keyword">enum</span> <a class="code" href="jitterbuf_8h.html#a7e72da000f982634fda8319b82db8de5">jb_frame_type</a> <a class="code" href="structjb__frame.html#afcc96c20c76b0b3421affdf01600f545">type</a>;  <span class="comment">/* the type of frame */</span>
<a name="l00104"></a><a class="code" href="structjb__frame.html#a270ed630495c3d453d342630569eb7c2">00104</a>    <span class="keyword">struct </span><a class="code" href="structjb__frame.html">jb_frame</a> *<a class="code" href="structjb__frame.html#a5c4983c998fadf3f76193fd24783bde7">next</a>, *<a class="code" href="structjb__frame.html#a270ed630495c3d453d342630569eb7c2">prev</a>;
<a name="l00105"></a>00105 } <a class="code" href="structjb__frame.html">jb_frame</a>;
<a name="l00106"></a>00106 
<a name="l00107"></a><a class="code" href="structjitterbuf.html">00107</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structjitterbuf.html">jitterbuf</a> {
<a name="l00108"></a><a class="code" href="structjitterbuf.html#afb95a482485b36fdc8722161454d567f">00108</a>    <a class="code" href="structjb__info.html">jb_info</a> <a class="code" href="structjitterbuf.html#afb95a482485b36fdc8722161454d567f">info</a>;
<a name="l00109"></a>00109 
<a name="l00110"></a>00110    <span class="comment">/* history */</span>
<a name="l00111"></a><a class="code" href="structjitterbuf.html#a3ed6c1592e71070ddb5e0d3b1a07c598">00111</a>    <span class="keywordtype">long</span> <a class="code" href="structjitterbuf.html#a3ed6c1592e71070ddb5e0d3b1a07c598">history</a>[<a class="code" href="jitterbuf_8h.html#a9dc3051902032b0955fbd9d8965ac824">JB_HISTORY_SZ</a>];        <span class="comment">/*!&lt; history */</span>
<a name="l00112"></a><a class="code" href="structjitterbuf.html#a481cc8fa35f9188a6ff52804a2b0e874">00112</a>    <span class="keywordtype">int</span>  <a class="code" href="structjitterbuf.html#a481cc8fa35f9188a6ff52804a2b0e874">hist_ptr</a>;          <span class="comment">/*!&lt; points to index in history for next entry */</span>
<a name="l00113"></a><a class="code" href="structjitterbuf.html#a6a195e7331ead143afbb823232f820bd">00113</a>    <span class="keywordtype">long</span> <a class="code" href="structjitterbuf.html#a6a195e7331ead143afbb823232f820bd">hist_maxbuf</a>[<a class="code" href="jitterbuf_8h.html#ac2d587e25cce0de796a6b8522b7b5e10">JB_HISTORY_MAXBUF_SZ</a>];   <span class="comment">/*!&lt; a sorted buffer of the max delays (highest first) */</span>
<a name="l00114"></a><a class="code" href="structjitterbuf.html#ab542ebd3d63993a0ab86521f9c44196f">00114</a>    <span class="keywordtype">long</span> <a class="code" href="structjitterbuf.html#ab542ebd3d63993a0ab86521f9c44196f">hist_minbuf</a>[<a class="code" href="jitterbuf_8h.html#ac2d587e25cce0de796a6b8522b7b5e10">JB_HISTORY_MAXBUF_SZ</a>];   <span class="comment">/*!&lt; a sorted buffer of the min delays (lowest first) */</span>
<a name="l00115"></a><a class="code" href="structjitterbuf.html#a157320fdf8cf1427e3b91f6562884d5a">00115</a>    <span class="keywordtype">int</span>  <a class="code" href="structjitterbuf.html#a157320fdf8cf1427e3b91f6562884d5a">hist_maxbuf_valid</a>;       <span class="comment">/*!&lt; are the &quot;maxbuf&quot;/minbuf valid? */</span>
<a name="l00116"></a><a class="code" href="structjitterbuf.html#aa109858435512697e48eef62e04f0c4a">00116</a>    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structjitterbuf.html#aa109858435512697e48eef62e04f0c4a">dropem</a>:1;                  <span class="comment">/*!&lt; flag to indicate dropping frames (overload) */</span>
<a name="l00117"></a>00117 
<a name="l00118"></a><a class="code" href="structjitterbuf.html#a4e4377c016656f816b5fd18c58c2c522">00118</a>    <a class="code" href="structjb__frame.html">jb_frame</a> *<a class="code" href="structjitterbuf.html#a4e4377c016656f816b5fd18c58c2c522">frames</a>;       <span class="comment">/*!&lt; queued frames */</span>
<a name="l00119"></a><a class="code" href="structjitterbuf.html#a495c27f4de72f6725afaa826daa6b7e1">00119</a>    <a class="code" href="structjb__frame.html">jb_frame</a> *<a class="code" href="structjitterbuf.html#a495c27f4de72f6725afaa826daa6b7e1">free</a>;      <span class="comment">/*!&lt; free frames (avoid malloc?) */</span>
<a name="l00120"></a>00120 } <a class="code" href="structjitterbuf.html">jitterbuf</a>;
<a name="l00121"></a>00121 
<a name="l00122"></a>00122 <span class="comment"></span>
<a name="l00123"></a>00123 <span class="comment">/*! \brief new jitterbuf */</span>
<a name="l00124"></a>00124 <a class="code" href="structjitterbuf.html">jitterbuf</a> *    <a class="code" href="jitterbuf_8h.html#a2fd56d2b8a06ad6b89cf67619f790911" title="new jitterbuf">jb_new</a>(<span class="keywordtype">void</span>);
<a name="l00125"></a>00125 <span class="comment"></span>
<a name="l00126"></a>00126 <span class="comment">/*! \brief destroy jitterbuf */</span>
<a name="l00127"></a>00127 <span class="keywordtype">void</span>        <a class="code" href="jitterbuf_8h.html#a2714537be23d6bb12425ba8542c4b1f7" title="destroy jitterbuf">jb_destroy</a>(<a class="code" href="structjitterbuf.html">jitterbuf</a> *jb);
<a name="l00128"></a>00128 <span class="comment"></span>
<a name="l00129"></a>00129 <span class="comment">/*! \brief reset jitterbuf</span>
<a name="l00130"></a>00130 <span class="comment"> * \note The jitterbuffer should be empty before you call this, otherwise</span>
<a name="l00131"></a>00131 <span class="comment"> * you will leak queued frames, and some internal structures */</span>
<a name="l00132"></a>00132 <span class="keywordtype">void</span>        <a class="code" href="jitterbuf_8h.html#a2c9efa9222ff9d7324a06c4a21b5ef72" title="reset jitterbuf">jb_reset</a>(<a class="code" href="structjitterbuf.html">jitterbuf</a> *jb);
<a name="l00133"></a>00133 <span class="comment"></span>
<a name="l00134"></a>00134 <span class="comment">/*!\brief  queue a frame </span>
<a name="l00135"></a>00135 <span class="comment"> * </span>
<a name="l00136"></a>00136 <span class="comment"> * data=frame data, timings (in ms): ms=length of frame (for voice), ts=ts (sender&apos;s time) </span>
<a name="l00137"></a>00137 <span class="comment"> * now=now (in receiver&apos;s time) return value is one of </span>
<a name="l00138"></a>00138 <span class="comment"> * JB_OK: Frame added. Last call to jb_next() still valid</span>
<a name="l00139"></a>00139 <span class="comment"> * JB_DROP: Drop this frame immediately</span>
<a name="l00140"></a>00140 <span class="comment"> * JB_SCHED: Frame added. Call jb_next() to get a new time for the next frame</span>
<a name="l00141"></a>00141 <span class="comment"> */</span>
<a name="l00142"></a>00142 <span class="keyword">enum</span> <a class="code" href="jitterbuf_8h.html#ad8d0ce8a0ebfabfe77a56b17b2d154f5">jb_return_code</a> <a class="code" href="jitterbuf_8h.html#a68bbac088e27e18441bd5b403f7f31d7" title="queue a frame">jb_put</a>(<a class="code" href="structjitterbuf.html">jitterbuf</a> *jb, <span class="keywordtype">void</span> *data, <span class="keyword">const</span> <span class="keyword">enum</span> <a class="code" href="jitterbuf_8h.html#a7e72da000f982634fda8319b82db8de5">jb_frame_type</a> <a class="code" href="evt_8c.html#a69e2889a94aeb9ac881abb82d3c22116">type</a>, <span class="keywordtype">long</span> ms, <span class="keywordtype">long</span> ts, <span class="keywordtype">long</span> now);
<a name="l00143"></a>00143 <span class="comment"></span>
<a name="l00144"></a>00144 <span class="comment">/*! \brief get a frame for time now (receiver&apos;s time)  return value is one of</span>
<a name="l00145"></a>00145 <span class="comment"> * JB_OK:  You&apos;ve got frame!</span>
<a name="l00146"></a>00146 <span class="comment"> * JB_DROP: Here&apos;s an audio frame you should just drop.  Ask me again for this time..</span>
<a name="l00147"></a>00147 <span class="comment"> * JB_NOFRAME: There&apos;s no frame scheduled for this time.</span>
<a name="l00148"></a>00148 <span class="comment"> * JB_INTERP: Please interpolate an interpl-length frame for this time (either we need to grow, or there was a lost frame) </span>
<a name="l00149"></a>00149 <span class="comment"> * JB_EMPTY: The jb is empty.</span>
<a name="l00150"></a>00150 <span class="comment"> */</span>
<a name="l00151"></a>00151 <span class="keyword">enum</span> <a class="code" href="jitterbuf_8h.html#ad8d0ce8a0ebfabfe77a56b17b2d154f5">jb_return_code</a> <a class="code" href="jitterbuf_8h.html#a37158045e8af38a69ab6d15ee51dc08e" title="get a frame for time now (receiver&amp;#39;s time) return value is one of JB_OK: You&amp;#39;ve...">jb_get</a>(<a class="code" href="structjitterbuf.html">jitterbuf</a> *jb, <a class="code" href="structjb__frame.html">jb_frame</a> *frame, <span class="keywordtype">long</span> now, <span class="keywordtype">long</span> interpl);
<a name="l00152"></a>00152 <span class="comment"></span>
<a name="l00153"></a>00153 <span class="comment">/*! \brief unconditionally get frames from jitterbuf until empty */</span>
<a name="l00154"></a>00154 <span class="keyword">enum</span> <a class="code" href="jitterbuf_8h.html#ad8d0ce8a0ebfabfe77a56b17b2d154f5">jb_return_code</a> <a class="code" href="jitterbuf_8h.html#aaca01cea1cbcba683ca6d5b0bc009666" title="unconditionally get frames from jitterbuf until empty">jb_getall</a>(<a class="code" href="structjitterbuf.html">jitterbuf</a> *jb, <a class="code" href="structjb__frame.html">jb_frame</a> *frameout);
<a name="l00155"></a>00155 <span class="comment"></span>
<a name="l00156"></a>00156 <span class="comment">/*! \brief when is the next frame due out, in receiver&apos;s time (0=EMPTY) </span>
<a name="l00157"></a>00157 <span class="comment"> * This value may change as frames are added (esp non-audio frames) */</span>
<a name="l00158"></a>00158 <span class="keywordtype">long</span>  <a class="code" href="jitterbuf_8h.html#a72883f3dc8328524ab3930122946e0a0" title="when is the next frame due out, in receiver&amp;#39;s time (0=EMPTY) This value may change...">jb_next</a>(<a class="code" href="structjitterbuf.html">jitterbuf</a> *jb);
<a name="l00159"></a>00159 <span class="comment"></span>
<a name="l00160"></a>00160 <span class="comment">/*! \brief get jitterbuf info: only &quot;statistics&quot; may be valid */</span>
<a name="l00161"></a>00161 <span class="keyword">enum</span> <a class="code" href="jitterbuf_8h.html#ad8d0ce8a0ebfabfe77a56b17b2d154f5">jb_return_code</a> <a class="code" href="jitterbuf_8h.html#aed5937e57dcecf58443eb130f9f02d31" title="get jitterbuf info: only &amp;quot;statistics&amp;quot; may be valid">jb_getinfo</a>(<a class="code" href="structjitterbuf.html">jitterbuf</a> *jb, <a class="code" href="structjb__info.html">jb_info</a> *stats);
<a name="l00162"></a>00162 <span class="comment"></span>
<a name="l00163"></a>00163 <span class="comment">/*! \brief set jitterbuf conf */</span>
<a name="l00164"></a>00164 <span class="keyword">enum</span> <a class="code" href="jitterbuf_8h.html#ad8d0ce8a0ebfabfe77a56b17b2d154f5">jb_return_code</a> <a class="code" href="jitterbuf_8h.html#a8ecded60181a9c1d1dae2fe05bddccf8" title="set jitterbuf conf">jb_setconf</a>(<a class="code" href="structjitterbuf.html">jitterbuf</a> *jb, <a class="code" href="structjb__conf.html">jb_conf</a> *conf);
<a name="l00165"></a>00165 
<a name="l00166"></a><a class="code" href="jitterbuf_8h.html#a799359320cd26f5d8940efeb58364e53">00166</a> <span class="keyword">typedef</span> <span class="keywordtype">void</span> __attribute__((<a class="code" href="cdr__custom_8c.html#a2177723f86d0a496f395614f4493cd7f">format</a>(printf, 1, 2))) (*jb_output_function_t)(<span class="keyword">const</span> <span class="keywordtype">char</span> *fmt, ...);
<a name="l00167"></a>00167 <span class="keywordtype">void</span> <a class="code" href="jitterbuf_8h.html#a5198ca5f2885b8b4a2579ba58e6f196f">jb_setoutput</a>(<a class="code" href="jitterbuf_8h.html#a799359320cd26f5d8940efeb58364e53">jb_output_function_t</a> err, <a class="code" href="jitterbuf_8h.html#a799359320cd26f5d8940efeb58364e53">jb_output_function_t</a> warn, <a class="code" href="jitterbuf_8h.html#a799359320cd26f5d8940efeb58364e53">jb_output_function_t</a> dbg);
<a name="l00168"></a>00168 
<a name="l00169"></a>00169 <span class="preprocessor">#ifdef __cplusplus</span>
<a name="l00170"></a>00170 <span class="preprocessor"></span>}
<a name="l00171"></a>00171 <span class="preprocessor">#endif</span>
<a name="l00172"></a>00172 <span class="preprocessor"></span>
<a name="l00173"></a>00173 
<a name="l00174"></a>00174 <span class="preprocessor">#endif</span>
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:18:42 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
