<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:19:41 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_1ab815038f534adda65c8b4ae4993449.html">include</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_16d825f1fa9ecca2e70b1a8d9256d0e6.html">asterisk</a>
  </div>
</div>
<div class="contents">
<h1>bridging.h File Reference</h1>
<p>Channel Bridging API.  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="bridging__features_8h_source.html">asterisk/bridging_features.h</a>&quot;</code><br/>

<p><a href="bridging_8h_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__bridge.html">ast_bridge</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Structure that contains information about a bridge.  <a href="structast__bridge.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__bridge__channel.html">ast_bridge_channel</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Structure that contains information regarding a channel in a bridge.  <a href="structast__bridge__channel.html#_details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8h.html#a815c9b3e933dfd4b8f523cf55caa5bbf">ast_bridge_capability</a> { <br/>
&nbsp;&nbsp;<a class="el" href="bridging_8h.html#a815c9b3e933dfd4b8f523cf55caa5bbfaf483c951b835fcc35da807b6a4b12509">AST_BRIDGE_CAPABILITY_1TO1MIX</a> =  (1 &lt;&lt; 1), 
<a class="el" href="bridging_8h.html#a815c9b3e933dfd4b8f523cf55caa5bbfabd40da8a498f3027c44dfa2e92d5f4ac">AST_BRIDGE_CAPABILITY_MULTIMIX</a> =  (1 &lt;&lt; 2), 
<a class="el" href="bridging_8h.html#a815c9b3e933dfd4b8f523cf55caa5bbfaec2d0fff3f4f8df0d9ef6b4d9be78380">AST_BRIDGE_CAPABILITY_NATIVE</a> =  (1 &lt;&lt; 3), 
<a class="el" href="bridging_8h.html#a815c9b3e933dfd4b8f523cf55caa5bbfa6a2f6021508eaa795c8405c5b753cf41">AST_BRIDGE_CAPABILITY_MULTITHREADED</a> =  (1 &lt;&lt; 4), 
<br/>
&nbsp;&nbsp;<a class="el" href="bridging_8h.html#a815c9b3e933dfd4b8f523cf55caa5bbfaa03170187c779ad77c3c724255140d56">AST_BRIDGE_CAPABILITY_THREAD</a> =  (1 &lt;&lt; 5), 
<a class="el" href="bridging_8h.html#a815c9b3e933dfd4b8f523cf55caa5bbfa3546e76c0fad9976d9be56843366da30">AST_BRIDGE_CAPABILITY_VIDEO</a> =  (1 &lt;&lt; 6), 
<a class="el" href="bridging_8h.html#a815c9b3e933dfd4b8f523cf55caa5bbfa908b692d29f07f7656070e988f564cbf">AST_BRIDGE_CAPABILITY_OPTIMIZE</a> =  (1 &lt;&lt; 7)
<br/>
 }</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p>Capabilities for a bridge technology. </p>
 <a href="bridging_8h.html#a815c9b3e933dfd4b8f523cf55caa5bbf">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7">ast_bridge_channel_state</a> { <br/>
&nbsp;&nbsp;<a class="el" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7a82e437d5aa10df5114a21ae794bce625">AST_BRIDGE_CHANNEL_STATE_WAIT</a> =  0, 
<a class="el" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7a70362e0b60c71e30a1166be6d13ac8a3">AST_BRIDGE_CHANNEL_STATE_END</a>, 
<a class="el" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7aeabb6e67917f26042d385634268af296">AST_BRIDGE_CHANNEL_STATE_HANGUP</a>, 
<a class="el" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7a0160065122a1729d07ed010b3369a49c">AST_BRIDGE_CHANNEL_STATE_DEPART</a>, 
<br/>
&nbsp;&nbsp;<a class="el" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7a35a97f491c00d69b863f3656af8b4d4f">AST_BRIDGE_CHANNEL_STATE_FEATURE</a>, 
<a class="el" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7a5242791d651ccb03b7426b626dca9dbd">AST_BRIDGE_CHANNEL_STATE_DTMF</a>
<br/>
 }</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p>State information about a bridged channel. </p>
 <a href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8h.html#a50d0751f7c671f1a6dc96dd6f8d756bf">ast_bridge_write_result</a> { <a class="el" href="bridging_8h.html#a50d0751f7c671f1a6dc96dd6f8d756bfa63d124c8c0501f317ddfdec8be02ce3d">AST_BRIDGE_WRITE_SUCCESS</a> =  0, 
<a class="el" href="bridging_8h.html#a50d0751f7c671f1a6dc96dd6f8d756bfa770ff44331d992b2f2c6d505277560f7">AST_BRIDGE_WRITE_FAILED</a>, 
<a class="el" href="bridging_8h.html#a50d0751f7c671f1a6dc96dd6f8d756bfac2940a91398ddf02398998cc89c00610">AST_BRIDGE_WRITE_UNSUPPORTED</a>
 }</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p>Return <a class="el" href="structvalues.html">values</a> for bridge technology write function. </p>
 <a href="bridging_8h.html#a50d0751f7c671f1a6dc96dd6f8d756bf">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8h.html#a03cde0e9535440a4f9f24ab921bea771">ast_bridge_change_state</a> (struct <a class="el" href="structast__bridge__channel.html">ast_bridge_channel</a> *bridge_channel, enum <a class="el" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7">ast_bridge_channel_state</a> new_state)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Change the <a class="el" href="structstate.html">state</a> of a bridged channel.  <a href="#a03cde0e9535440a4f9f24ab921bea771"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8h.html#a1ae174d74e40569be246998a5e661a84">ast_bridge_check</a> (int <a class="el" href="res__jabber_8c.html#aa7afd7ba4814dbf49b1867019891fd14">capabilities</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">See if it is possible to create a bridge.  <a href="#a1ae174d74e40569be246998a5e661a84"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8h.html#a2b432942317147cc6c42d1f0c0730393">ast_bridge_depart</a> (struct <a class="el" href="structast__bridge.html">ast_bridge</a> *bridge, struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Depart a channel from a bridge.  <a href="#a2b432942317147cc6c42d1f0c0730393"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8h.html#a523fcc8aa1338afe507a3de9db0b84c3">ast_bridge_destroy</a> (struct <a class="el" href="structast__bridge.html">ast_bridge</a> *bridge)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Destroy a bridge.  <a href="#a523fcc8aa1338afe507a3de9db0b84c3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8h.html#a25866ef7f32ed6b8f49bd4bf8a8721d7">ast_bridge_impart</a> (struct <a class="el" href="structast__bridge.html">ast_bridge</a> *bridge, struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structast__channel.html">ast_channel</a> *swap, struct <a class="el" href="structast__bridge__features.html">ast_bridge_features</a> *features)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Impart (non-blocking) a channel on a bridge.  <a href="#a25866ef7f32ed6b8f49bd4bf8a8721d7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7">ast_bridge_channel_state</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8h.html#adf7e5e313d2ed7e7b9dfd24891d38690">ast_bridge_join</a> (struct <a class="el" href="structast__bridge.html">ast_bridge</a> *bridge, struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, struct <a class="el" href="structast__channel.html">ast_channel</a> *swap, struct <a class="el" href="structast__bridge__features.html">ast_bridge_features</a> *features)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Join (blocking) a channel to a bridge.  <a href="#adf7e5e313d2ed7e7b9dfd24891d38690"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8h.html#a38e5df0378d15d71b0ec921608221041">ast_bridge_merge</a> (struct <a class="el" href="structast__bridge.html">ast_bridge</a> *bridge0, struct <a class="el" href="structast__bridge.html">ast_bridge</a> *bridge1)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Merge two bridges together.  <a href="#a38e5df0378d15d71b0ec921608221041"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__bridge.html">ast_bridge</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8h.html#ab9ac166bd85c7c76b5e13170d3a2f047">ast_bridge_new</a> (int <a class="el" href="res__jabber_8c.html#aa7afd7ba4814dbf49b1867019891fd14">capabilities</a>, int flags)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create a new bridge.  <a href="#ab9ac166bd85c7c76b5e13170d3a2f047"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8h.html#a66d6a521530f4fb208eb8ee33e257b6c">ast_bridge_remove</a> (struct <a class="el" href="structast__bridge.html">ast_bridge</a> *bridge, struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Remove a channel from a bridge.  <a href="#a66d6a521530f4fb208eb8ee33e257b6c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8h.html#a85bc0d4138ac2af7b207d8f1325f051a">ast_bridge_suspend</a> (struct <a class="el" href="structast__bridge.html">ast_bridge</a> *bridge, struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Suspend a channel temporarily from a bridge.  <a href="#a85bc0d4138ac2af7b207d8f1325f051a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="bridging_8h.html#aab4cd1153d39a6744eca6a84d5255820">ast_bridge_unsuspend</a> (struct <a class="el" href="structast__bridge.html">ast_bridge</a> *bridge, struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Unsuspend a channel from a bridge.  <a href="#aab4cd1153d39a6744eca6a84d5255820"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Channel Bridging API. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Joshua Colp &lt;<a href="mailto:jcolp@digium.com">jcolp@digium.com</a>&gt; <a class="el" href="AstBridging.html">Channel Bridging API</a> </dd></dl>

<p>Definition in file <a class="el" href="bridging_8h_source.html">bridging.h</a>.</p>
<hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="a815c9b3e933dfd4b8f523cf55caa5bbf"></a><!-- doxytag: member="bridging.h::ast_bridge_capability" ref="a815c9b3e933dfd4b8f523cf55caa5bbf" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="bridging_8h.html#a815c9b3e933dfd4b8f523cf55caa5bbf">ast_bridge_capability</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Capabilities for a bridge technology. </p>
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a815c9b3e933dfd4b8f523cf55caa5bbfaf483c951b835fcc35da807b6a4b12509"></a><!-- doxytag: member="AST_BRIDGE_CAPABILITY_1TO1MIX" ref="a815c9b3e933dfd4b8f523cf55caa5bbfaf483c951b835fcc35da807b6a4b12509" args="" -->AST_BRIDGE_CAPABILITY_1TO1MIX</em>&nbsp;</td><td>
<p>Bridge is only capable of mixing 2 <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a815c9b3e933dfd4b8f523cf55caa5bbfabd40da8a498f3027c44dfa2e92d5f4ac"></a><!-- doxytag: member="AST_BRIDGE_CAPABILITY_MULTIMIX" ref="a815c9b3e933dfd4b8f523cf55caa5bbfabd40da8a498f3027c44dfa2e92d5f4ac" args="" -->AST_BRIDGE_CAPABILITY_MULTIMIX</em>&nbsp;</td><td>
<p>Bridge is capable of mixing 2 or more <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a815c9b3e933dfd4b8f523cf55caa5bbfaec2d0fff3f4f8df0d9ef6b4d9be78380"></a><!-- doxytag: member="AST_BRIDGE_CAPABILITY_NATIVE" ref="a815c9b3e933dfd4b8f523cf55caa5bbfaec2d0fff3f4f8df0d9ef6b4d9be78380" args="" -->AST_BRIDGE_CAPABILITY_NATIVE</em>&nbsp;</td><td>
<p>Bridge should natively bridge two <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> if possible </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a815c9b3e933dfd4b8f523cf55caa5bbfa6a2f6021508eaa795c8405c5b753cf41"></a><!-- doxytag: member="AST_BRIDGE_CAPABILITY_MULTITHREADED" ref="a815c9b3e933dfd4b8f523cf55caa5bbfa6a2f6021508eaa795c8405c5b753cf41" args="" -->AST_BRIDGE_CAPABILITY_MULTITHREADED</em>&nbsp;</td><td>
<p>Bridge should run using the multithreaded model </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a815c9b3e933dfd4b8f523cf55caa5bbfaa03170187c779ad77c3c724255140d56"></a><!-- doxytag: member="AST_BRIDGE_CAPABILITY_THREAD" ref="a815c9b3e933dfd4b8f523cf55caa5bbfaa03170187c779ad77c3c724255140d56" args="" -->AST_BRIDGE_CAPABILITY_THREAD</em>&nbsp;</td><td>
<p>Bridge should run a central bridge thread </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a815c9b3e933dfd4b8f523cf55caa5bbfa3546e76c0fad9976d9be56843366da30"></a><!-- doxytag: member="AST_BRIDGE_CAPABILITY_VIDEO" ref="a815c9b3e933dfd4b8f523cf55caa5bbfa3546e76c0fad9976d9be56843366da30" args="" -->AST_BRIDGE_CAPABILITY_VIDEO</em>&nbsp;</td><td>
<p>Bridge technology can do video mixing (or something along those lines) </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a815c9b3e933dfd4b8f523cf55caa5bbfa908b692d29f07f7656070e988f564cbf"></a><!-- doxytag: member="AST_BRIDGE_CAPABILITY_OPTIMIZE" ref="a815c9b3e933dfd4b8f523cf55caa5bbfa908b692d29f07f7656070e988f564cbf" args="" -->AST_BRIDGE_CAPABILITY_OPTIMIZE</em>&nbsp;</td><td>
<p>Bridge technology can optimize things based on who is talking </p>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="bridging_8h_source.html#l00068">68</a> of file <a class="el" href="bridging_8h_source.html">bridging.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00068"></a>00068                            {<span class="comment"></span>
<a name="l00069"></a>00069 <span class="comment">   /*! Bridge is only capable of mixing 2 channels */</span>
<a name="l00070"></a>00070    <a class="code" href="bridging_8h.html#a815c9b3e933dfd4b8f523cf55caa5bbfaf483c951b835fcc35da807b6a4b12509">AST_BRIDGE_CAPABILITY_1TO1MIX</a> = (1 &lt;&lt; 1),<span class="comment"></span>
<a name="l00071"></a>00071 <span class="comment">   /*! Bridge is capable of mixing 2 or more channels */</span>
<a name="l00072"></a>00072    <a class="code" href="bridging_8h.html#a815c9b3e933dfd4b8f523cf55caa5bbfabd40da8a498f3027c44dfa2e92d5f4ac">AST_BRIDGE_CAPABILITY_MULTIMIX</a> = (1 &lt;&lt; 2),<span class="comment"></span>
<a name="l00073"></a>00073 <span class="comment">   /*! Bridge should natively bridge two channels if possible */</span>
<a name="l00074"></a>00074    <a class="code" href="bridging_8h.html#a815c9b3e933dfd4b8f523cf55caa5bbfaec2d0fff3f4f8df0d9ef6b4d9be78380">AST_BRIDGE_CAPABILITY_NATIVE</a> = (1 &lt;&lt; 3),<span class="comment"></span>
<a name="l00075"></a>00075 <span class="comment">   /*! Bridge should run using the multithreaded model */</span>
<a name="l00076"></a>00076    <a class="code" href="bridging_8h.html#a815c9b3e933dfd4b8f523cf55caa5bbfa6a2f6021508eaa795c8405c5b753cf41">AST_BRIDGE_CAPABILITY_MULTITHREADED</a> = (1 &lt;&lt; 4),<span class="comment"></span>
<a name="l00077"></a>00077 <span class="comment">   /*! Bridge should run a central bridge thread */</span>
<a name="l00078"></a>00078    <a class="code" href="bridging_8h.html#a815c9b3e933dfd4b8f523cf55caa5bbfaa03170187c779ad77c3c724255140d56">AST_BRIDGE_CAPABILITY_THREAD</a> = (1 &lt;&lt; 5),<span class="comment"></span>
<a name="l00079"></a>00079 <span class="comment">   /*! Bridge technology can do video mixing (or something along those lines) */</span>
<a name="l00080"></a>00080    <a class="code" href="bridging_8h.html#a815c9b3e933dfd4b8f523cf55caa5bbfa3546e76c0fad9976d9be56843366da30">AST_BRIDGE_CAPABILITY_VIDEO</a> = (1 &lt;&lt; 6),<span class="comment"></span>
<a name="l00081"></a>00081 <span class="comment">   /*! Bridge technology can optimize things based on who is talking */</span>
<a name="l00082"></a>00082    <a class="code" href="bridging_8h.html#a815c9b3e933dfd4b8f523cf55caa5bbfa908b692d29f07f7656070e988f564cbf">AST_BRIDGE_CAPABILITY_OPTIMIZE</a> = (1 &lt;&lt; 7),
<a name="l00083"></a>00083 };
</pre></div></p>

</div>
</div>
<a class="anchor" id="a78f46aa0abbe1f3bf98be03c884203a7"></a><!-- doxytag: member="bridging.h::ast_bridge_channel_state" ref="a78f46aa0abbe1f3bf98be03c884203a7" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7">ast_bridge_channel_state</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>State information about a bridged channel. </p>
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a78f46aa0abbe1f3bf98be03c884203a7a82e437d5aa10df5114a21ae794bce625"></a><!-- doxytag: member="AST_BRIDGE_CHANNEL_STATE_WAIT" ref="a78f46aa0abbe1f3bf98be03c884203a7a82e437d5aa10df5114a21ae794bce625" args="" -->AST_BRIDGE_CHANNEL_STATE_WAIT</em>&nbsp;</td><td>
<p>Waiting for a signal </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a78f46aa0abbe1f3bf98be03c884203a7a70362e0b60c71e30a1166be6d13ac8a3"></a><!-- doxytag: member="AST_BRIDGE_CHANNEL_STATE_END" ref="a78f46aa0abbe1f3bf98be03c884203a7a70362e0b60c71e30a1166be6d13ac8a3" args="" -->AST_BRIDGE_CHANNEL_STATE_END</em>&nbsp;</td><td>
<p>Bridged channel has ended itself (it has hung up) </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a78f46aa0abbe1f3bf98be03c884203a7aeabb6e67917f26042d385634268af296"></a><!-- doxytag: member="AST_BRIDGE_CHANNEL_STATE_HANGUP" ref="a78f46aa0abbe1f3bf98be03c884203a7aeabb6e67917f26042d385634268af296" args="" -->AST_BRIDGE_CHANNEL_STATE_HANGUP</em>&nbsp;</td><td>
<p>Bridged channel should be hung up </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a78f46aa0abbe1f3bf98be03c884203a7a0160065122a1729d07ed010b3369a49c"></a><!-- doxytag: member="AST_BRIDGE_CHANNEL_STATE_DEPART" ref="a78f46aa0abbe1f3bf98be03c884203a7a0160065122a1729d07ed010b3369a49c" args="" -->AST_BRIDGE_CHANNEL_STATE_DEPART</em>&nbsp;</td><td>
<p>Bridged channel should be removed from the bridge without being hung up </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a78f46aa0abbe1f3bf98be03c884203a7a35a97f491c00d69b863f3656af8b4d4f"></a><!-- doxytag: member="AST_BRIDGE_CHANNEL_STATE_FEATURE" ref="a78f46aa0abbe1f3bf98be03c884203a7a35a97f491c00d69b863f3656af8b4d4f" args="" -->AST_BRIDGE_CHANNEL_STATE_FEATURE</em>&nbsp;</td><td>
<p>Bridged channel is executing a feature hook </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a78f46aa0abbe1f3bf98be03c884203a7a5242791d651ccb03b7426b626dca9dbd"></a><!-- doxytag: member="AST_BRIDGE_CHANNEL_STATE_DTMF" ref="a78f46aa0abbe1f3bf98be03c884203a7a5242791d651ccb03b7426b626dca9dbd" args="" -->AST_BRIDGE_CHANNEL_STATE_DTMF</em>&nbsp;</td><td>
<p>Bridged channel is sending a DTMF stream out </p>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="bridging_8h_source.html#l00086">86</a> of file <a class="el" href="bridging_8h_source.html">bridging.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00086"></a>00086                               {<span class="comment"></span>
<a name="l00087"></a>00087 <span class="comment">   /*! Waiting for a signal */</span>
<a name="l00088"></a>00088    <a class="code" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7a82e437d5aa10df5114a21ae794bce625">AST_BRIDGE_CHANNEL_STATE_WAIT</a> = 0,<span class="comment"></span>
<a name="l00089"></a>00089 <span class="comment">   /*! Bridged channel has ended itself (it has hung up) */</span>
<a name="l00090"></a>00090    <a class="code" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7a70362e0b60c71e30a1166be6d13ac8a3">AST_BRIDGE_CHANNEL_STATE_END</a>,<span class="comment"></span>
<a name="l00091"></a>00091 <span class="comment">   /*! Bridged channel should be hung up */</span>
<a name="l00092"></a>00092    <a class="code" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7aeabb6e67917f26042d385634268af296">AST_BRIDGE_CHANNEL_STATE_HANGUP</a>,<span class="comment"></span>
<a name="l00093"></a>00093 <span class="comment">   /*! Bridged channel should be removed from the bridge without being hung up */</span>
<a name="l00094"></a>00094    <a class="code" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7a0160065122a1729d07ed010b3369a49c">AST_BRIDGE_CHANNEL_STATE_DEPART</a>,<span class="comment"></span>
<a name="l00095"></a>00095 <span class="comment">   /*! Bridged channel is executing a feature hook */</span>
<a name="l00096"></a>00096    <a class="code" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7a35a97f491c00d69b863f3656af8b4d4f">AST_BRIDGE_CHANNEL_STATE_FEATURE</a>,<span class="comment"></span>
<a name="l00097"></a>00097 <span class="comment">   /*! Bridged channel is sending a DTMF stream out */</span>
<a name="l00098"></a>00098    <a class="code" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7a5242791d651ccb03b7426b626dca9dbd">AST_BRIDGE_CHANNEL_STATE_DTMF</a>,
<a name="l00099"></a>00099 };
</pre></div></p>

</div>
</div>
<a class="anchor" id="a50d0751f7c671f1a6dc96dd6f8d756bf"></a><!-- doxytag: member="bridging.h::ast_bridge_write_result" ref="a50d0751f7c671f1a6dc96dd6f8d756bf" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="bridging_8h.html#a50d0751f7c671f1a6dc96dd6f8d756bf">ast_bridge_write_result</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Return <a class="el" href="structvalues.html">values</a> for bridge technology write function. </p>
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a50d0751f7c671f1a6dc96dd6f8d756bfa63d124c8c0501f317ddfdec8be02ce3d"></a><!-- doxytag: member="AST_BRIDGE_WRITE_SUCCESS" ref="a50d0751f7c671f1a6dc96dd6f8d756bfa63d124c8c0501f317ddfdec8be02ce3d" args="" -->AST_BRIDGE_WRITE_SUCCESS</em>&nbsp;</td><td>
<p>Bridge technology wrote out frame fine </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a50d0751f7c671f1a6dc96dd6f8d756bfa770ff44331d992b2f2c6d505277560f7"></a><!-- doxytag: member="AST_BRIDGE_WRITE_FAILED" ref="a50d0751f7c671f1a6dc96dd6f8d756bfa770ff44331d992b2f2c6d505277560f7" args="" -->AST_BRIDGE_WRITE_FAILED</em>&nbsp;</td><td>
<p>Bridge technology attempted to write out the frame but failed </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a50d0751f7c671f1a6dc96dd6f8d756bfac2940a91398ddf02398998cc89c00610"></a><!-- doxytag: member="AST_BRIDGE_WRITE_UNSUPPORTED" ref="a50d0751f7c671f1a6dc96dd6f8d756bfac2940a91398ddf02398998cc89c00610" args="" -->AST_BRIDGE_WRITE_UNSUPPORTED</em>&nbsp;</td><td>
<p>Bridge technology does not support writing out a frame of this type </p>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="bridging_8h_source.html#l00102">102</a> of file <a class="el" href="bridging_8h_source.html">bridging.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00102"></a>00102                              {<span class="comment"></span>
<a name="l00103"></a>00103 <span class="comment">   /*! Bridge technology wrote out frame fine */</span>
<a name="l00104"></a>00104    <a class="code" href="bridging_8h.html#a50d0751f7c671f1a6dc96dd6f8d756bfa63d124c8c0501f317ddfdec8be02ce3d">AST_BRIDGE_WRITE_SUCCESS</a> = 0,<span class="comment"></span>
<a name="l00105"></a>00105 <span class="comment">   /*! Bridge technology attempted to write out the frame but failed */</span>
<a name="l00106"></a>00106    <a class="code" href="bridging_8h.html#a50d0751f7c671f1a6dc96dd6f8d756bfa770ff44331d992b2f2c6d505277560f7">AST_BRIDGE_WRITE_FAILED</a>,<span class="comment"></span>
<a name="l00107"></a>00107 <span class="comment">   /*! Bridge technology does not support writing out a frame of this type */</span>
<a name="l00108"></a>00108    <a class="code" href="bridging_8h.html#a50d0751f7c671f1a6dc96dd6f8d756bfac2940a91398ddf02398998cc89c00610">AST_BRIDGE_WRITE_UNSUPPORTED</a>,
<a name="l00109"></a>00109 };
</pre></div></p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a03cde0e9535440a4f9f24ab921bea771"></a><!-- doxytag: member="bridging.h::ast_bridge_change_state" ref="a03cde0e9535440a4f9f24ab921bea771" args="(struct ast_bridge_channel *bridge_channel, enum ast_bridge_channel_state new_state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_bridge_change_state </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge__channel.html">ast_bridge_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge_channel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7">ast_bridge_channel_state</a>&nbsp;</td>
          <td class="paramname"> <em>new_state</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Change the <a class="el" href="structstate.html">state</a> of a bridged channel. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>bridge_channel</em>&nbsp;</td><td>Channel to change the <a class="el" href="structstate.html">state</a> on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>new_state</em>&nbsp;</td><td>The new <a class="el" href="structstate.html">state</a> to place the channel into</td></tr>
  </table>
  </dd>
</dl>
<p>Example usage:</p>
<div class="fragment"><pre class="fragment"> <a class="code" href="bridging_8h.html#a03cde0e9535440a4f9f24ab921bea771" title="Change the state of a bridged channel.">ast_bridge_change_state</a>(bridge_channel, <a class="code" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7a82e437d5aa10df5114a21ae794bce625">AST_BRIDGE_CHANNEL_STATE_WAIT</a>);
</pre></div><p>This places the channel pointed to by bridge_channel into the <a class="el" href="structstate.html">state</a> AST_BRIDGE_CHANNEL_STATE_WAIT.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>This API call is only meant to be used in feature hook callbacks to make sure the channel either hangs up or returns to the bridge. </dd></dl>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l00118">118</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l01734">ast_cond_signal()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="bridging_8h_source.html#l00121">ast_bridge_channel::cond</a>, <a class="el" href="bridging_8h_source.html#l00119">ast_bridge_channel::lock</a>, <a class="el" href="bridging_8h_source.html#l00123">ast_bridge_channel::state</a>, and <a class="el" href="bridging_8h_source.html#l00133">ast_bridge_channel::thread</a>.</p>

<p>Referenced by <a class="el" href="bridging_8c_source.html#l01064">ast_bridge_depart()</a>, <a class="el" href="bridging_8c_source.html#l00514">ast_bridge_destroy()</a>, <a class="el" href="bridging_8c_source.html#l01332">ast_bridge_dtmf_stream()</a>, <a class="el" href="bridging_8c_source.html#l00276">ast_bridge_handle_trip()</a>, <a class="el" href="bridging_8c_source.html#l01087">ast_bridge_remove()</a>, <a class="el" href="bridge__builtin__features_8c_source.html#l00131">attended_abort_transfer()</a>, <a class="el" href="bridge__builtin__features_8c_source.html#l00123">attended_threeway_transfer()</a>, <a class="el" href="bridging_8c_source.html#l00844">bridge_channel_dtmf_stream()</a>, <a class="el" href="bridging_8c_source.html#l00778">bridge_channel_feature()</a>, <a class="el" href="bridging_8c_source.html#l00860">bridge_channel_join()</a>, <a class="el" href="bridging_8c_source.html#l00218">bridge_check_dissolve()</a>, <a class="el" href="bridging_8c_source.html#l00241">bridge_handle_dtmf()</a>, <a class="el" href="bridge__builtin__features_8c_source.html#l00157">feature_attended_transfer()</a>, <a class="el" href="bridge__builtin__features_8c_source.html#l00095">feature_blind_transfer()</a>, and <a class="el" href="bridge__builtin__features_8c_source.html#l00233">feature_hangup()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00119"></a>00119 {
<a name="l00120"></a>00120    <span class="comment">/* Change the state on the bridge channel */</span>
<a name="l00121"></a>00121    bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a5a8dce45720cd4222feb34abbdaa2c40">state</a> = new_state;
<a name="l00122"></a>00122 
<a name="l00123"></a>00123    <span class="comment">/* Only poke the channel&apos;s thread if it is not us */</span>
<a name="l00124"></a>00124    <span class="keywordflow">if</span> (!pthread_equal(pthread_self(), bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a01f75a9ad916f63a94e06a27635ba278">thread</a>)) {
<a name="l00125"></a>00125       pthread_kill(bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a01f75a9ad916f63a94e06a27635ba278">thread</a>, SIGURG);
<a name="l00126"></a>00126       <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00127"></a>00127       <a class="code" href="lock_8h.html#a02a91e30acdea6d13208d23636d37c87">ast_cond_signal</a>(&amp;bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>);
<a name="l00128"></a>00128       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00129"></a>00129    }
<a name="l00130"></a>00130 
<a name="l00131"></a>00131    <span class="keywordflow">return</span>;
<a name="l00132"></a>00132 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1ae174d74e40569be246998a5e661a84"></a><!-- doxytag: member="bridging.h::ast_bridge_check" ref="a1ae174d74e40569be246998a5e661a84" args="(int capabilities)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_bridge_check </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>capabilities</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>See if it is possible to create a bridge. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>capabilities</em>&nbsp;</td><td>The capabilities that the bridge will use</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>1</em>&nbsp;</td><td>if possible </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if not possible</td></tr>
  </table>
  </dd>
</dl>
<p>Example usage:</p>
<div class="fragment"><pre class="fragment"> <span class="keywordtype">int</span> possible = <a class="code" href="bridging_8h.html#a1ae174d74e40569be246998a5e661a84" title="See if it is possible to create a bridge.">ast_bridge_check</a>(<a class="code" href="bridging_8h.html#a815c9b3e933dfd4b8f523cf55caa5bbfaf483c951b835fcc35da807b6a4b12509">AST_BRIDGE_CAPABILITY_1TO1MIX</a>);
</pre></div><p>This sees if it is possible to create a bridge capable of bridging two <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> together. </p>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l00501">501</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="loader_8c_source.html#l01171">ast_module_unref()</a>, <a class="el" href="bridging_8c_source.html#l00385">find_best_technology()</a>, and <a class="el" href="bridging__technology_8h_source.html#l00078">ast_bridge_technology::mod</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00502"></a>00502 {
<a name="l00503"></a>00503    <span class="keyword">struct </span><a class="code" href="structast__bridge__technology.html" title="Structure that is the essence of a bridge technology.">ast_bridge_technology</a> *bridge_technology = NULL;
<a name="l00504"></a>00504 
<a name="l00505"></a>00505    <span class="keywordflow">if</span> (!(bridge_technology = <a class="code" href="bridging_8c.html#a309ea60a7b664058b0f508c86079958e" title="Helper function used to find the &amp;quot;best&amp;quot; bridge technology given a specified...">find_best_technology</a>(<a class="code" href="res__jabber_8c.html#aa7afd7ba4814dbf49b1867019891fd14">capabilities</a>))) {
<a name="l00506"></a>00506       <span class="keywordflow">return</span> 0;
<a name="l00507"></a>00507    }
<a name="l00508"></a>00508 
<a name="l00509"></a>00509    <a class="code" href="module_8h.html#ac65fa15b16dbc563a2424af744ab003d">ast_module_unref</a>(bridge_technology-&gt;<a class="code" href="structast__bridge__technology.html#a782aff512368932b8d71b3633f88cb04">mod</a>);
<a name="l00510"></a>00510 
<a name="l00511"></a>00511    <span class="keywordflow">return</span> 1;
<a name="l00512"></a>00512 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2b432942317147cc6c42d1f0c0730393"></a><!-- doxytag: member="bridging.h::ast_bridge_depart" ref="a2b432942317147cc6c42d1f0c0730393" args="(struct ast_bridge *bridge, struct ast_channel *chan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_bridge_depart </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge.html">ast_bridge</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Depart a channel from a bridge. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>bridge</em>&nbsp;</td><td>Bridge to depart from </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel to depart</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure</td></tr>
  </table>
  </dd>
</dl>
<p>Example usage:</p>
<div class="fragment"><pre class="fragment"> <a class="code" href="bridging_8h.html#a2b432942317147cc6c42d1f0c0730393" title="Depart a channel from a bridge.">ast_bridge_depart</a>(bridge, <a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>);
</pre></div><p>This removes the channel pointed to by the chan pointer from the bridge pointed to by the bridge pointer and gives control to the calling thread. This does not hang up the channel.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>This API call can only be used on <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> that were added to the bridge using the ast_bridge_impart API call. </dd></dl>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l01064">1064</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="astobj2_8c_source.html#l00147">ao2_lock()</a>, <a class="el" href="astobj2_8c_source.html#l00169">ao2_unlock()</a>, <a class="el" href="bridging_8c_source.html#l00118">ast_bridge_change_state()</a>, <a class="el" href="bridging_8h_source.html#l00094">AST_BRIDGE_CHANNEL_STATE_DEPART</a>, <a class="el" href="bridging_8c_source.html#l00204">find_bridge_channel()</a>, <a class="el" href="bridging_8h_source.html#l00133">ast_bridge_channel::thread</a>, and <a class="el" href="app__meetme_8c_source.html#l00840">thread</a>.</p>

<p>Referenced by <a class="el" href="bridge__builtin__features_8c_source.html#l00157">feature_attended_transfer()</a>, and <a class="el" href="app__confbridge_8c_source.html#l00554">play_sound_file()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01065"></a>01065 {
<a name="l01066"></a>01066    <span class="keyword">struct </span><a class="code" href="structast__bridge__channel.html" title="Structure that contains information regarding a channel in a bridge.">ast_bridge_channel</a> *bridge_channel = NULL;
<a name="l01067"></a>01067    pthread_t <a class="code" href="app__meetme_8c.html#a01f75a9ad916f63a94e06a27635ba278">thread</a>;
<a name="l01068"></a>01068 
<a name="l01069"></a>01069    <a class="code" href="astobj2_8h.html#a3077056d07f6f9e348a54a743769bad5" title="Lock an object.">ao2_lock</a>(bridge);
<a name="l01070"></a>01070 
<a name="l01071"></a>01071    <span class="comment">/* Try to find the channel that we want to depart */</span>
<a name="l01072"></a>01072    <span class="keywordflow">if</span> (!(bridge_channel = <a class="code" href="bridging_8c.html#af76003eaee352a6e71c4411b99c87eb1" title="Helper function to find a bridge channel given a channel.">find_bridge_channel</a>(bridge, chan))) {
<a name="l01073"></a>01073       <a class="code" href="astobj2_8h.html#a379cc936a320f2179f7beb422dc15230" title="Unlock an object.">ao2_unlock</a>(bridge);
<a name="l01074"></a>01074       <span class="keywordflow">return</span> -1;
<a name="l01075"></a>01075    }
<a name="l01076"></a>01076 
<a name="l01077"></a>01077    <a class="code" href="bridging_8h.html#a03cde0e9535440a4f9f24ab921bea771" title="Change the state of a bridged channel.">ast_bridge_change_state</a>(bridge_channel, <a class="code" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7a0160065122a1729d07ed010b3369a49c">AST_BRIDGE_CHANNEL_STATE_DEPART</a>);
<a name="l01078"></a>01078    thread = bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a01f75a9ad916f63a94e06a27635ba278">thread</a>;
<a name="l01079"></a>01079 
<a name="l01080"></a>01080    <a class="code" href="astobj2_8h.html#a379cc936a320f2179f7beb422dc15230" title="Unlock an object.">ao2_unlock</a>(bridge);
<a name="l01081"></a>01081 
<a name="l01082"></a>01082    pthread_join(thread, NULL);
<a name="l01083"></a>01083 
<a name="l01084"></a>01084    <span class="keywordflow">return</span> 0;
<a name="l01085"></a>01085 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a523fcc8aa1338afe507a3de9db0b84c3"></a><!-- doxytag: member="bridging.h::ast_bridge_destroy" ref="a523fcc8aa1338afe507a3de9db0b84c3" args="(struct ast_bridge *bridge)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_bridge_destroy </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge.html">ast_bridge</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Destroy a bridge. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>bridge</em>&nbsp;</td><td>Bridge to destroy</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure</td></tr>
  </table>
  </dd>
</dl>
<p>Example usage:</p>
<div class="fragment"><pre class="fragment"> <a class="code" href="bridging_8h.html#a523fcc8aa1338afe507a3de9db0b84c3" title="Destroy a bridge.">ast_bridge_destroy</a>(bridge);
</pre></div><p>This destroys a bridge that was previously created using ast_bridge_new. </p>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l00514">514</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="astobj2_8c_source.html#l00147">ao2_lock()</a>, <a class="el" href="astobj2_8h_source.html#l00459">ao2_ref</a>, <a class="el" href="astobj2_8c_source.html#l00169">ao2_unlock()</a>, <a class="el" href="bridging_8c_source.html#l00118">ast_bridge_change_state()</a>, <a class="el" href="bridging_8h_source.html#l00090">AST_BRIDGE_CHANNEL_STATE_END</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="bridging_8c_source.html#l00135">bridge_poke()</a>, and <a class="el" href="bridging_8h_source.html#l00155">ast_bridge::stop</a>.</p>

<p>Referenced by <a class="el" href="bridging_8c_source.html#l00448">ast_bridge_new()</a>, <a class="el" href="app__confbridge_8c_source.html#l00364">destroy_conference_bridge()</a>, and <a class="el" href="bridge__builtin__features_8c_source.html#l00157">feature_attended_transfer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00515"></a>00515 {
<a name="l00516"></a>00516    <span class="keyword">struct </span><a class="code" href="structast__bridge__channel.html" title="Structure that contains information regarding a channel in a bridge.">ast_bridge_channel</a> *bridge_channel = NULL;
<a name="l00517"></a>00517 
<a name="l00518"></a>00518    <a class="code" href="astobj2_8h.html#a3077056d07f6f9e348a54a743769bad5" title="Lock an object.">ao2_lock</a>(bridge);
<a name="l00519"></a>00519 
<a name="l00520"></a>00520    bridge-&gt;<a class="code" href="structast__bridge.html#a111277a0849f92b793ed6aa1efe54462">stop</a> = 1;
<a name="l00521"></a>00521 
<a name="l00522"></a>00522    <a class="code" href="bridging_8c.html#a57c77ab33579cf3f1ddb054b758a826c" title="Helper function to poke the bridge thread.">bridge_poke</a>(bridge);
<a name="l00523"></a>00523 
<a name="l00524"></a>00524    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Telling all channels in bridge %p to end and leave the party\n&quot;</span>, bridge);
<a name="l00525"></a>00525 
<a name="l00526"></a>00526    <span class="comment">/* Drop every bridged channel, the last one will cause the bridge thread (if it exists) to exit */</span>
<a name="l00527"></a>00527    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;bridge-&gt;channels, bridge_channel, entry) {
<a name="l00528"></a>00528       <a class="code" href="bridging_8h.html#a03cde0e9535440a4f9f24ab921bea771" title="Change the state of a bridged channel.">ast_bridge_change_state</a>(bridge_channel, <a class="code" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7a70362e0b60c71e30a1166be6d13ac8a3">AST_BRIDGE_CHANNEL_STATE_END</a>);
<a name="l00529"></a>00529    }
<a name="l00530"></a>00530 
<a name="l00531"></a>00531    <a class="code" href="astobj2_8h.html#a379cc936a320f2179f7beb422dc15230" title="Unlock an object.">ao2_unlock</a>(bridge);
<a name="l00532"></a>00532 
<a name="l00533"></a>00533    <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(bridge, -1);
<a name="l00534"></a>00534 
<a name="l00535"></a>00535    <span class="keywordflow">return</span> 0;
<a name="l00536"></a>00536 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a25866ef7f32ed6b8f49bd4bf8a8721d7"></a><!-- doxytag: member="bridging.h::ast_bridge_impart" ref="a25866ef7f32ed6b8f49bd4bf8a8721d7" args="(struct ast_bridge *bridge, struct ast_channel *chan, struct ast_channel *swap, struct ast_bridge_features *features)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_bridge_impart </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge.html">ast_bridge</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>swap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__bridge__features.html">ast_bridge_features</a> *&nbsp;</td>
          <td class="paramname"> <em>features</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Impart (non-blocking) a channel on a bridge. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>bridge</em>&nbsp;</td><td>Bridge to impart on </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel to impart </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>swap</em>&nbsp;</td><td>Channel to swap out if swapping </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>features</em>&nbsp;</td><td>Bridge features structure</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure</td></tr>
  </table>
  </dd>
</dl>
<p>Example usage:</p>
<div class="fragment"><pre class="fragment"> <a class="code" href="bridging_8h.html#a25866ef7f32ed6b8f49bd4bf8a8721d7" title="Impart (non-blocking) a channel on a bridge.">ast_bridge_impart</a>(bridge, <a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, NULL, NULL);
</pre></div><p>This adds a channel pointed to by the chan pointer to the bridge pointed to by the bridge pointer. This function will return immediately and will not wait until the channel is no longer part of the bridge.</p>
<p>If this channel will be replacing another channel the other channel can be specified in the swap parameter. The other channel will be thrown out of the bridge in an atomic fashion.</p>
<p>If channel specific features are enabled a pointer to the features structure can be specified in the features parameter. </p>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l01030">1030</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00459">ao2_ref</a>, <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="lock_8h_source.html#l01744">ast_cond_destroy()</a>, <a class="el" href="lock_8h_source.html#l01729">ast_cond_init()</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="lock_8h_source.html#l01712">ast_mutex_destroy()</a>, <a class="el" href="lock_8h_source.html#l01692">ast_mutex_init()</a>, <a class="el" href="utils_8h_source.html#l00376">ast_pthread_create</a>, <a class="el" href="bridging_8h_source.html#l00129">ast_bridge_channel::bridge</a>, <a class="el" href="bridging_8c_source.html#l01008">bridge_channel_thread()</a>, <a class="el" href="bridging_8h_source.html#l00125">ast_bridge_channel::chan</a>, <a class="el" href="bridging_8h_source.html#l00121">ast_bridge_channel::cond</a>, <a class="el" href="bridging_8h_source.html#l00139">ast_bridge_channel::features</a>, <a class="el" href="bridging_8h_source.html#l00119">ast_bridge_channel::lock</a>, <a class="el" href="bridging_8h_source.html#l00127">ast_bridge_channel::swap</a>, and <a class="el" href="bridging_8h_source.html#l00133">ast_bridge_channel::thread</a>.</p>

<p>Referenced by <a class="el" href="chan__bridge_8c_source.html#l00120">bridge_call()</a>, <a class="el" href="bridge__builtin__features_8c_source.html#l00157">feature_attended_transfer()</a>, <a class="el" href="bridge__builtin__features_8c_source.html#l00095">feature_blind_transfer()</a>, and <a class="el" href="app__confbridge_8c_source.html#l00554">play_sound_file()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01031"></a>01031 {
<a name="l01032"></a>01032    <span class="keyword">struct </span><a class="code" href="structast__bridge__channel.html" title="Structure that contains information regarding a channel in a bridge.">ast_bridge_channel</a> *bridge_channel = NULL;
<a name="l01033"></a>01033 
<a name="l01034"></a>01034    <span class="comment">/* Try to allocate a structure for the bridge channel */</span>
<a name="l01035"></a>01035    <span class="keywordflow">if</span> (!(bridge_channel = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*bridge_channel)))) {
<a name="l01036"></a>01036       <span class="keywordflow">return</span> -1;
<a name="l01037"></a>01037    }
<a name="l01038"></a>01038 
<a name="l01039"></a>01039    <span class="comment">/* Setup various parameters */</span>
<a name="l01040"></a>01040    bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a84d1435c5b8d387806714ea7079304b7">chan</a> = chan;
<a name="l01041"></a>01041    bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a3bf3c4e34892d0033814ab5fec0e006f">swap</a> = swap;
<a name="l01042"></a>01042    bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a> = bridge;
<a name="l01043"></a>01043    bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a65633fdc6178dc8d9f754fda0166d16e">features</a> = features;
<a name="l01044"></a>01044 
<a name="l01045"></a>01045    <span class="comment">/* Initialize our mutex lock and condition */</span>
<a name="l01046"></a>01046    <a class="code" href="lock_8h.html#a5dc895fe6e8c089175159fc22e33fc3b">ast_mutex_init</a>(&amp;bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01047"></a>01047    <a class="code" href="lock_8h.html#a21f75f462115427718d78aa66cc61f9b">ast_cond_init</a>(&amp;bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>, NULL);
<a name="l01048"></a>01048 
<a name="l01049"></a>01049    <span class="comment">/* Bump up the reference count on the bridge, it&apos;ll get decremented later */</span>
<a name="l01050"></a>01050    <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(bridge, +1);
<a name="l01051"></a>01051 
<a name="l01052"></a>01052    <span class="comment">/* Actually create the thread that will handle the channel */</span>
<a name="l01053"></a>01053    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a4781fd54a4ca8c7f0f8a32a6cce503c0">ast_pthread_create</a>(&amp;bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a01f75a9ad916f63a94e06a27635ba278">thread</a>, NULL, <a class="code" href="bridging_8c.html#a47f049f2c263a70b056e02549ff7d561" title="Thread responsible for imparted bridged channels.">bridge_channel_thread</a>, bridge_channel)) {
<a name="l01054"></a>01054       <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(bridge, -1);
<a name="l01055"></a>01055       <a class="code" href="lock_8h.html#a7752bcadc38f1d7a7a8528c538569115">ast_cond_destroy</a>(&amp;bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>);
<a name="l01056"></a>01056       <a class="code" href="lock_8h.html#ab237e70b569019bfb490ab0c3c09b8c5">ast_mutex_destroy</a>(&amp;bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01057"></a>01057       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(bridge_channel);
<a name="l01058"></a>01058       <span class="keywordflow">return</span> -1;
<a name="l01059"></a>01059    }
<a name="l01060"></a>01060 
<a name="l01061"></a>01061    <span class="keywordflow">return</span> 0;
<a name="l01062"></a>01062 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="adf7e5e313d2ed7e7b9dfd24891d38690"></a><!-- doxytag: member="bridging.h::ast_bridge_join" ref="adf7e5e313d2ed7e7b9dfd24891d38690" args="(struct ast_bridge *bridge, struct ast_channel *chan, struct ast_channel *swap, struct ast_bridge_features *features)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7">ast_bridge_channel_state</a> ast_bridge_join </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge.html">ast_bridge</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>swap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__bridge__features.html">ast_bridge_features</a> *&nbsp;</td>
          <td class="paramname"> <em>features</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Join (blocking) a channel to a bridge. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>bridge</em>&nbsp;</td><td>Bridge to join </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel to join </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>swap</em>&nbsp;</td><td>Channel to swap out if swapping </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>features</em>&nbsp;</td><td>Bridge features structure</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structstate.html">state</a></em>&nbsp;</td><td>that channel exited the bridge with</td></tr>
  </table>
  </dd>
</dl>
<p>Example usage:</p>
<div class="fragment"><pre class="fragment"> <a class="code" href="bridging_8h.html#adf7e5e313d2ed7e7b9dfd24891d38690" title="Join (blocking) a channel to a bridge.">ast_bridge_join</a>(bridge, chan, NULL, NULL);
</pre></div><p>This adds a channel pointed to by the chan pointer to the bridge pointed to by the bridge pointer. This function will not return until the channel has been removed from the bridge, swapped out for another channel, or has hung up.</p>
<p>If this channel will be replacing another channel the other channel can be specified in the swap parameter. The other channel will be thrown out of the bridge in an atomic fashion.</p>
<p>If channel specific features are enabled a pointer to the features structure can be specified in the features parameter. </p>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l00980">980</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00459">ao2_ref</a>, <a class="el" href="lock_8h_source.html#l01744">ast_cond_destroy()</a>, <a class="el" href="lock_8h_source.html#l01729">ast_cond_init()</a>, <a class="el" href="lock_8h_source.html#l01712">ast_mutex_destroy()</a>, <a class="el" href="lock_8h_source.html#l01692">ast_mutex_init()</a>, <a class="el" href="bridging_8h_source.html#l00129">ast_bridge_channel::bridge</a>, <a class="el" href="channel_8h_source.html#l00498">ast_channel::bridge</a>, <a class="el" href="bridging_8c_source.html#l00860">bridge_channel_join()</a>, <a class="el" href="bridging_8h_source.html#l00125">ast_bridge_channel::chan</a>, <a class="el" href="bridging_8h_source.html#l00121">ast_bridge_channel::cond</a>, <a class="el" href="bridging_8h_source.html#l00167">ast_bridge::features</a>, and <a class="el" href="bridging_8h_source.html#l00119">ast_bridge_channel::lock</a>.</p>

<p>Referenced by <a class="el" href="app__confbridge_8c_source.html#l00687">confbridge_exec()</a>, and <a class="el" href="bridge__builtin__features_8c_source.html#l00157">feature_attended_transfer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00981"></a>00981 {
<a name="l00982"></a>00982    <span class="keyword">struct </span><a class="code" href="structast__bridge__channel.html" title="Structure that contains information regarding a channel in a bridge.">ast_bridge_channel</a> bridge_channel = {
<a name="l00983"></a>00983       .chan = chan,
<a name="l00984"></a>00984       .swap = swap,
<a name="l00985"></a>00985       .<a class="code" href="structast__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a> = bridge,
<a name="l00986"></a>00986       .<a class="code" href="structast__bridge.html#aa5f7287d4bbab0f62a1bae18af89171d">features</a> = features,
<a name="l00987"></a>00987    };
<a name="l00988"></a>00988    <span class="keyword">enum</span> <a class="code" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7" title="State information about a bridged channel.">ast_bridge_channel_state</a> <a class="code" href="structstate.html">state</a>;
<a name="l00989"></a>00989 
<a name="l00990"></a>00990    <span class="comment">/* Initialize various other elements of the bridge channel structure that we can&apos;t do above */</span>
<a name="l00991"></a>00991    <a class="code" href="lock_8h.html#a5dc895fe6e8c089175159fc22e33fc3b">ast_mutex_init</a>(&amp;bridge_channel.<a class="code" href="structast__bridge__channel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l00992"></a>00992    <a class="code" href="lock_8h.html#a21f75f462115427718d78aa66cc61f9b">ast_cond_init</a>(&amp;bridge_channel.<a class="code" href="structast__bridge__channel.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>, NULL);
<a name="l00993"></a>00993 
<a name="l00994"></a>00994    <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(bridge_channel.<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>, +1);
<a name="l00995"></a>00995 
<a name="l00996"></a>00996    state = <a class="code" href="bridging_8c.html#a63538fa2bdf0d9aa20742f12ee86bef1" title="Join a channel to a bridge and handle anything the bridge may want us to do.">bridge_channel_join</a>(&amp;bridge_channel);
<a name="l00997"></a>00997 
<a name="l00998"></a>00998    <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(bridge_channel.<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a>, -1);
<a name="l00999"></a>00999 
<a name="l01000"></a>01000    <span class="comment">/* Destroy some elements of the bridge channel structure above */</span>
<a name="l01001"></a>01001    <a class="code" href="lock_8h.html#ab237e70b569019bfb490ab0c3c09b8c5">ast_mutex_destroy</a>(&amp;bridge_channel.<a class="code" href="structast__bridge__channel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01002"></a>01002    <a class="code" href="lock_8h.html#a7752bcadc38f1d7a7a8528c538569115">ast_cond_destroy</a>(&amp;bridge_channel.<a class="code" href="structast__bridge__channel.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>);
<a name="l01003"></a>01003 
<a name="l01004"></a>01004    <span class="keywordflow">return</span> state;
<a name="l01005"></a>01005 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a38e5df0378d15d71b0ec921608221041"></a><!-- doxytag: member="bridging.h::ast_bridge_merge" ref="a38e5df0378d15d71b0ec921608221041" args="(struct ast_bridge *bridge0, struct ast_bridge *bridge1)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_bridge_merge </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge.html">ast_bridge</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__bridge.html">ast_bridge</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge1</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Merge two bridges together. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>bridge0</em>&nbsp;</td><td>First bridge </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>bridge1</em>&nbsp;</td><td>Second bridge</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure</td></tr>
  </table>
  </dd>
</dl>
<p>Example usage:</p>
<div class="fragment"><pre class="fragment"> <a class="code" href="bridging_8h.html#a38e5df0378d15d71b0ec921608221041" title="Merge two bridges together.">ast_bridge_merge</a>(bridge0, bridge1);
</pre></div><p>This merges the bridge pointed to by bridge1 with the bridge pointed to by bridge0. In reality all of the <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> in bridge1 are simply moved to bridge0.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>The second bridge specified is not destroyed when this operation is completed. </dd></dl>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l01106">1106</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="astobj2_8c_source.html#l00147">ao2_lock()</a>, <a class="el" href="astobj2_8h_source.html#l00459">ao2_ref</a>, <a class="el" href="astobj2_8c_source.html#l00169">ao2_unlock()</a>, <a class="el" href="bridging_8h_source.html#l00072">AST_BRIDGE_CAPABILITY_MULTIMIX</a>, <a class="el" href="bridging__features_8h_source.html#l00036">AST_BRIDGE_FLAG_SMART</a>, <a class="el" href="lock_8h_source.html#l01734">ast_cond_signal()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="linkedlists_8h_source.html#l00715">AST_LIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h_source.html#l00817">AST_LIST_REMOVE_HEAD</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="lock_8h_source.html#l00083">AST_PTHREADT_STOP</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="bridging_8h_source.html#l00129">ast_bridge_channel::bridge</a>, <a class="el" href="bridging_8c_source.html#l00149">bridge_array_add()</a>, <a class="el" href="bridging_8c_source.html#l00180">bridge_array_remove()</a>, <a class="el" href="bridging_8c_source.html#l00538">bridge_make_compatible()</a>, <a class="el" href="bridging__technology_8h_source.html#l00048">ast_bridge_technology::capabilities</a>, <a class="el" href="bridging_8h_source.html#l00125">ast_bridge_channel::chan</a>, <a class="el" href="bridging_8h_source.html#l00121">ast_bridge_channel::cond</a>, <a class="el" href="bridging_8h_source.html#l00159">ast_bridge::feature_flags</a>, <a class="el" href="structast__bridge__technology.html#a8b369fed84f7c637d98be4861971590b">ast_bridge_technology::join</a>, <a class="el" href="structast__bridge__technology.html#ae453b9a1154d7db567f2f11c6adc5bc1">ast_bridge_technology::leave</a>, <a class="el" href="bridging_8h_source.html#l00119">ast_bridge_channel::lock</a>, <a class="el" href="bridging__technology_8h_source.html#l00046">ast_bridge_technology::name</a>, <a class="el" href="bridging_8h_source.html#l00151">ast_bridge::num</a>, <a class="el" href="bridging_8c_source.html#l00585">smart_bridge_operation()</a>, <a class="el" href="bridging_8h_source.html#l00161">ast_bridge::technology</a>, <a class="el" href="bridging_8h_source.html#l00133">ast_bridge_channel::thread</a>, and <a class="el" href="bridging_8h_source.html#l00165">ast_bridge::thread</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01107"></a>01107 {
<a name="l01108"></a>01108    <span class="keyword">struct </span><a class="code" href="structast__bridge__channel.html" title="Structure that contains information regarding a channel in a bridge.">ast_bridge_channel</a> *bridge_channel = NULL;
<a name="l01109"></a>01109 
<a name="l01110"></a>01110    <a class="code" href="astobj2_8h.html#a3077056d07f6f9e348a54a743769bad5" title="Lock an object.">ao2_lock</a>(bridge0);
<a name="l01111"></a>01111    <a class="code" href="astobj2_8h.html#a3077056d07f6f9e348a54a743769bad5" title="Lock an object.">ao2_lock</a>(bridge1);
<a name="l01112"></a>01112 
<a name="l01113"></a>01113    <span class="comment">/* If the first bridge currently has 2 channels and is not capable of becoming a multimixing bridge we can not merge */</span>
<a name="l01114"></a>01114    <span class="keywordflow">if</span> ((bridge0-&gt;<a class="code" href="structast__bridge.html#a86cf672daa4e0ad11ad10efc894d19c8">num</a> + bridge1-&gt;<a class="code" href="structast__bridge.html#a86cf672daa4e0ad11ad10efc894d19c8">num</a>) &gt; 2 &amp;&amp; (!(bridge0-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a9461ee266923070466f95a76158f65cd">capabilities</a> &amp; <a class="code" href="bridging_8h.html#a815c9b3e933dfd4b8f523cf55caa5bbfabd40da8a498f3027c44dfa2e92d5f4ac">AST_BRIDGE_CAPABILITY_MULTIMIX</a>) &amp;&amp; !<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;bridge0-&gt;<a class="code" href="structast__bridge.html#af15c2e8b6df8ce0bf570af18aa890deb">feature_flags</a>, <a class="code" href="bridging__features_8h.html#a65c2644d2eadb31bcec0aaeb41cb3444a8f8162f42b84a7eba37bfb551c31743b">AST_BRIDGE_FLAG_SMART</a>))) {
<a name="l01115"></a>01115       <a class="code" href="astobj2_8h.html#a379cc936a320f2179f7beb422dc15230" title="Unlock an object.">ao2_unlock</a>(bridge1);
<a name="l01116"></a>01116       <a class="code" href="astobj2_8h.html#a379cc936a320f2179f7beb422dc15230" title="Unlock an object.">ao2_unlock</a>(bridge0);
<a name="l01117"></a>01117       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Can&apos;t merge bridge %p into bridge %p, multimix is needed and it could not be acquired.\n&quot;</span>, bridge1, bridge0);
<a name="l01118"></a>01118       <span class="keywordflow">return</span> -1;
<a name="l01119"></a>01119    }
<a name="l01120"></a>01120 
<a name="l01121"></a>01121    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Merging channels from bridge %p into bridge %p\n&quot;</span>, bridge1, bridge0);
<a name="l01122"></a>01122 
<a name="l01123"></a>01123    <span class="comment">/* Perform smart bridge operation on bridge we are merging into so it can change bridge technology if needed */</span>
<a name="l01124"></a>01124    <span class="keywordflow">if</span> (<a class="code" href="bridging_8c.html#a343a22dfa2196b0b3f6702a057ab07a4" title="Perform the smart bridge operation. Basically sees if a new bridge technology should...">smart_bridge_operation</a>(bridge0, NULL, bridge0-&gt;<a class="code" href="structast__bridge.html#a86cf672daa4e0ad11ad10efc894d19c8">num</a> + bridge1-&gt;<a class="code" href="structast__bridge.html#a86cf672daa4e0ad11ad10efc894d19c8">num</a>)) {
<a name="l01125"></a>01125       <a class="code" href="astobj2_8h.html#a379cc936a320f2179f7beb422dc15230" title="Unlock an object.">ao2_unlock</a>(bridge1);
<a name="l01126"></a>01126       <a class="code" href="astobj2_8h.html#a379cc936a320f2179f7beb422dc15230" title="Unlock an object.">ao2_unlock</a>(bridge0);
<a name="l01127"></a>01127       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Can&apos;t merge bridge %p into bridge %p, tried to perform smart bridge operation and failed.\n&quot;</span>, bridge1, bridge0);
<a name="l01128"></a>01128       <span class="keywordflow">return</span> -1;
<a name="l01129"></a>01129    }
<a name="l01130"></a>01130 
<a name="l01131"></a>01131    <span class="comment">/* If a thread is currently executing on bridge1 tell it to stop */</span>
<a name="l01132"></a>01132    <span class="keywordflow">if</span> (bridge1-&gt;<a class="code" href="structast__bridge.html#a01f75a9ad916f63a94e06a27635ba278">thread</a>) {
<a name="l01133"></a>01133       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Telling bridge thread on bridge %p to stop as it is being merged into %p\n&quot;</span>, bridge1, bridge0);
<a name="l01134"></a>01134       bridge1-&gt;<a class="code" href="structast__bridge.html#a01f75a9ad916f63a94e06a27635ba278">thread</a> = <a class="code" href="lock_8h.html#a873a83eb8196323194aac2bea23d794e">AST_PTHREADT_STOP</a>;
<a name="l01135"></a>01135    }
<a name="l01136"></a>01136 
<a name="l01137"></a>01137    <span class="comment">/* Move channels from bridge1 over to bridge0 */</span>
<a name="l01138"></a>01138    <span class="keywordflow">while</span> ((bridge_channel = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;bridge1-&gt;channels, entry))) {
<a name="l01139"></a>01139       <span class="comment">/* Tell the technology handling bridge1 that the bridge channel is leaving */</span>
<a name="l01140"></a>01140       <span class="keywordflow">if</span> (bridge1-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#ae453b9a1154d7db567f2f11c6adc5bc1">leave</a>) {
<a name="l01141"></a>01141          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Giving bridge technology %s notification that %p is leaving bridge %p\n&quot;</span>, bridge1-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, bridge_channel, bridge1);
<a name="l01142"></a>01142          <span class="keywordflow">if</span> (bridge1-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#ae453b9a1154d7db567f2f11c6adc5bc1">leave</a>(bridge1, bridge_channel)) {
<a name="l01143"></a>01143             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Bridge technology %s failed to allow %p to leave bridge %p\n&quot;</span>, bridge1-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, bridge_channel, bridge1);
<a name="l01144"></a>01144          }
<a name="l01145"></a>01145       }
<a name="l01146"></a>01146 
<a name="l01147"></a>01147       <span class="comment">/* Drop channel count and reference count on the bridge they are leaving */</span>
<a name="l01148"></a>01148       bridge1-&gt;<a class="code" href="structast__bridge.html#a86cf672daa4e0ad11ad10efc894d19c8">num</a>--;
<a name="l01149"></a>01149       <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(bridge1, -1);
<a name="l01150"></a>01150 
<a name="l01151"></a>01151       <a class="code" href="bridging_8c.html#a5ac27d55678ac62f4323954cea6adfb8" title="Helper function to remove a channel from the bridge array.">bridge_array_remove</a>(bridge1, bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a84d1435c5b8d387806714ea7079304b7">chan</a>);
<a name="l01152"></a>01152 
<a name="l01153"></a>01153       <span class="comment">/* Now add them into the bridge they are joining, increase channel count, and bump up reference count */</span>
<a name="l01154"></a>01154       bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a> = bridge0;
<a name="l01155"></a>01155       <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(&amp;bridge0-&gt;channels, bridge_channel, entry);
<a name="l01156"></a>01156       bridge0-&gt;<a class="code" href="structast__bridge.html#a86cf672daa4e0ad11ad10efc894d19c8">num</a>++;
<a name="l01157"></a>01157       <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(bridge0, +1);
<a name="l01158"></a>01158 
<a name="l01159"></a>01159       <a class="code" href="bridging_8c.html#af41fa7f06745400ef9a05e5ad821c951" title="Helper function to add a channel to the bridge array.">bridge_array_add</a>(bridge0, bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a84d1435c5b8d387806714ea7079304b7">chan</a>);
<a name="l01160"></a>01160 
<a name="l01161"></a>01161       <span class="comment">/* Make the channel compatible with the new bridge it is joining or else formats would go amuck */</span>
<a name="l01162"></a>01162       <a class="code" href="bridging_8c.html#ae87cc33842c5acf5477d40f83c7e6a24">bridge_make_compatible</a>(bridge0, bridge_channel);
<a name="l01163"></a>01163 
<a name="l01164"></a>01164       <span class="comment">/* Tell the technology handling bridge0 that the bridge channel is joining */</span>
<a name="l01165"></a>01165       <span class="keywordflow">if</span> (bridge0-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a8b369fed84f7c637d98be4861971590b">join</a>) {
<a name="l01166"></a>01166          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Giving bridge technology %s notification that %p is joining bridge %p\n&quot;</span>, bridge0-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, bridge_channel, bridge0);
<a name="l01167"></a>01167          <span class="keywordflow">if</span> (bridge0-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a8b369fed84f7c637d98be4861971590b">join</a>(bridge0, bridge_channel)) {
<a name="l01168"></a>01168             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Bridge technology %s failed to join %p to bridge %p\n&quot;</span>, bridge0-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, bridge_channel, bridge0);
<a name="l01169"></a>01169          }
<a name="l01170"></a>01170       }
<a name="l01171"></a>01171 
<a name="l01172"></a>01172       <span class="comment">/* Poke the bridge channel, this will cause it to wake up and execute the proper threading model for the new bridge it is in */</span>
<a name="l01173"></a>01173       pthread_kill(bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a01f75a9ad916f63a94e06a27635ba278">thread</a>, SIGURG);
<a name="l01174"></a>01174       <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01175"></a>01175       <a class="code" href="lock_8h.html#a02a91e30acdea6d13208d23636d37c87">ast_cond_signal</a>(&amp;bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>);
<a name="l01176"></a>01176       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;bridge_channel-&gt;<a class="code" href="structast__bridge__channel.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);
<a name="l01177"></a>01177    }
<a name="l01178"></a>01178 
<a name="l01179"></a>01179    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Merged channels from bridge %p into bridge %p\n&quot;</span>, bridge1, bridge0);
<a name="l01180"></a>01180 
<a name="l01181"></a>01181    <a class="code" href="astobj2_8h.html#a379cc936a320f2179f7beb422dc15230" title="Unlock an object.">ao2_unlock</a>(bridge1);
<a name="l01182"></a>01182    <a class="code" href="astobj2_8h.html#a379cc936a320f2179f7beb422dc15230" title="Unlock an object.">ao2_unlock</a>(bridge0);
<a name="l01183"></a>01183 
<a name="l01184"></a>01184    <span class="keywordflow">return</span> 0;
<a name="l01185"></a>01185 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab9ac166bd85c7c76b5e13170d3a2f047"></a><!-- doxytag: member="bridging.h::ast_bridge_new" ref="ab9ac166bd85c7c76b5e13170d3a2f047" args="(int capabilities, int flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__bridge.html">ast_bridge</a>* ast_bridge_new </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>capabilities</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Create a new bridge. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>capabilities</em>&nbsp;</td><td>The capabilities that we require to be used on the bridge </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>flags</em>&nbsp;</td><td>Flags that will alter the behavior of the bridge</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>a</em>&nbsp;</td><td>pointer to a new bridge on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>NULL</em>&nbsp;</td><td>on failure</td></tr>
  </table>
  </dd>
</dl>
<p>Example usage:</p>
<div class="fragment"><pre class="fragment"> <span class="keyword">struct </span><a class="code" href="structast__bridge.html" title="Structure that contains information about a bridge.">ast_bridge</a> *bridge;
 bridge = <a class="code" href="bridging_8h.html#ab9ac166bd85c7c76b5e13170d3a2f047" title="Create a new bridge.">ast_bridge_new</a>(<a class="code" href="bridging_8h.html#a815c9b3e933dfd4b8f523cf55caa5bbfaf483c951b835fcc35da807b6a4b12509">AST_BRIDGE_CAPABILITY_1TO1MIX</a>, <a class="code" href="bridging__features_8h.html#a65c2644d2eadb31bcec0aaeb41cb3444ae2c21ce82d946116c6488e97faedcd3d">AST_BRIDGE_FLAG_DISSOLVE</a>);
</pre></div><p>This creates a simple two party bridge that will be destroyed once one of the <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> hangs up. </p>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l00448">448</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="astobj2_8h_source.html#l00413">ao2_alloc</a>, <a class="el" href="astobj2_8h_source.html#l00459">ao2_ref</a>, <a class="el" href="bridging_8h_source.html#l00169">ast_bridge::array</a>, <a class="el" href="bridging_8h_source.html#l00173">ast_bridge::array_size</a>, <a class="el" href="bridging_8h_source.html#l00070">AST_BRIDGE_CAPABILITY_1TO1MIX</a>, <a class="el" href="bridging_8h_source.html#l00072">AST_BRIDGE_CAPABILITY_MULTIMIX</a>, <a class="el" href="bridging_8c_source.html#l00514">ast_bridge_destroy()</a>, <a class="el" href="bridging__features_8h_source.html#l00036">AST_BRIDGE_FLAG_SMART</a>, <a class="el" href="bridging_8c_source.html#l00448">ast_bridge_new()</a>, <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="lock_8h_source.html#l00082">AST_PTHREADT_NULL</a>, <a class="el" href="utils_8h_source.html#l00068">ast_set_flag</a>, <a class="el" href="bridging_8c_source.html#l00048">BRIDGE_ARRAY_START</a>, <a class="el" href="structast__bridge__technology.html#a4c02331d19c7cdb01704c544961130a1">ast_bridge_technology::create</a>, <a class="el" href="bridging_8c_source.html#l00420">destroy_bridge()</a>, <a class="el" href="bridging_8h_source.html#l00159">ast_bridge::feature_flags</a>, <a class="el" href="bridging_8c_source.html#l00385">find_best_technology()</a>, <a class="el" href="bridging__technology_8h_source.html#l00046">ast_bridge_technology::name</a>, <a class="el" href="bridging_8h_source.html#l00161">ast_bridge::technology</a>, and <a class="el" href="bridging_8h_source.html#l00165">ast_bridge::thread</a>.</p>

<p>Referenced by <a class="el" href="bridging_8c_source.html#l00448">ast_bridge_new()</a>, <a class="el" href="bridge__builtin__features_8c_source.html#l00157">feature_attended_transfer()</a>, and <a class="el" href="app__confbridge_8c_source.html#l00394">join_conference_bridge()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00449"></a>00449 {
<a name="l00450"></a>00450    <span class="keyword">struct </span><a class="code" href="structast__bridge.html" title="Structure that contains information about a bridge.">ast_bridge</a> *bridge = NULL;
<a name="l00451"></a>00451    <span class="keyword">struct </span><a class="code" href="structast__bridge__technology.html" title="Structure that is the essence of a bridge technology.">ast_bridge_technology</a> *bridge_technology = NULL;
<a name="l00452"></a>00452 
<a name="l00453"></a>00453    <span class="comment">/* If we need to be a smart bridge see if we can move between 1to1 and multimix bridges */</span>
<a name="l00454"></a>00454    <span class="keywordflow">if</span> (flags &amp; <a class="code" href="bridging__features_8h.html#a65c2644d2eadb31bcec0aaeb41cb3444a8f8162f42b84a7eba37bfb551c31743b">AST_BRIDGE_FLAG_SMART</a>) {
<a name="l00455"></a>00455       <span class="keyword">struct </span><a class="code" href="structast__bridge.html" title="Structure that contains information about a bridge.">ast_bridge</a> *other_bridge;
<a name="l00456"></a>00456 
<a name="l00457"></a>00457       <span class="keywordflow">if</span> (!(other_bridge = <a class="code" href="bridging_8h.html#ab9ac166bd85c7c76b5e13170d3a2f047" title="Create a new bridge.">ast_bridge_new</a>((<a class="code" href="res__jabber_8c.html#aa7afd7ba4814dbf49b1867019891fd14">capabilities</a> &amp; <a class="code" href="bridging_8h.html#a815c9b3e933dfd4b8f523cf55caa5bbfaf483c951b835fcc35da807b6a4b12509">AST_BRIDGE_CAPABILITY_1TO1MIX</a>) ? <a class="code" href="bridging_8h.html#a815c9b3e933dfd4b8f523cf55caa5bbfabd40da8a498f3027c44dfa2e92d5f4ac">AST_BRIDGE_CAPABILITY_MULTIMIX</a> : AST_BRIDGE_CAPABILITY_1TO1MIX, 0))) {
<a name="l00458"></a>00458          <span class="keywordflow">return</span> NULL;
<a name="l00459"></a>00459       }
<a name="l00460"></a>00460 
<a name="l00461"></a>00461       <a class="code" href="bridging_8h.html#a523fcc8aa1338afe507a3de9db0b84c3" title="Destroy a bridge.">ast_bridge_destroy</a>(other_bridge);
<a name="l00462"></a>00462    }
<a name="l00463"></a>00463 
<a name="l00464"></a>00464    <span class="comment">/* If capabilities were provided use our helper function to find the &quot;best&quot; bridge technology, otherwise we can</span>
<a name="l00465"></a>00465 <span class="comment">    * just look for the most basic capability needed, single 1to1 mixing. */</span>
<a name="l00466"></a>00466    bridge_technology = (<a class="code" href="res__jabber_8c.html#aa7afd7ba4814dbf49b1867019891fd14">capabilities</a> ? <a class="code" href="bridging_8c.html#a309ea60a7b664058b0f508c86079958e" title="Helper function used to find the &amp;quot;best&amp;quot; bridge technology given a specified...">find_best_technology</a>(<a class="code" href="res__jabber_8c.html#aa7afd7ba4814dbf49b1867019891fd14">capabilities</a>) : find_best_technology(<a class="code" href="bridging_8h.html#a815c9b3e933dfd4b8f523cf55caa5bbfaf483c951b835fcc35da807b6a4b12509">AST_BRIDGE_CAPABILITY_1TO1MIX</a>));
<a name="l00467"></a>00467 
<a name="l00468"></a>00468    <span class="comment">/* If no bridge technology was found we can&apos;t possibly do bridging so fail creation of the bridge */</span>
<a name="l00469"></a>00469    <span class="keywordflow">if</span> (!bridge_technology) {
<a name="l00470"></a>00470       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Failed to find a bridge technology to satisfy capabilities %d\n&quot;</span>, <a class="code" href="res__jabber_8c.html#aa7afd7ba4814dbf49b1867019891fd14">capabilities</a>);
<a name="l00471"></a>00471       <span class="keywordflow">return</span> NULL;
<a name="l00472"></a>00472    }
<a name="l00473"></a>00473 
<a name="l00474"></a>00474    <span class="comment">/* We have everything we need to create this bridge... so allocate the memory, link things together, and fire her up! */</span>
<a name="l00475"></a>00475    <span class="keywordflow">if</span> (!(bridge = <a class="code" href="astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*bridge), <a class="code" href="bridging_8c.html#a99f699e128b44c627baa3587d99a0661">destroy_bridge</a>))) {
<a name="l00476"></a>00476       <span class="keywordflow">return</span> NULL;
<a name="l00477"></a>00477    }
<a name="l00478"></a>00478 
<a name="l00479"></a>00479    bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a> = bridge_technology;
<a name="l00480"></a>00480    bridge-&gt;<a class="code" href="structast__bridge.html#a01f75a9ad916f63a94e06a27635ba278">thread</a> = <a class="code" href="lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>;
<a name="l00481"></a>00481 
<a name="l00482"></a>00482    <span class="comment">/* Create an array of pointers for the channels that will be joining us */</span>
<a name="l00483"></a>00483    bridge-&gt;<a class="code" href="structast__bridge.html#a740283531a557dc86a34a57ea220fb79">array</a> = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(<a class="code" href="bridging_8c.html#a19adb1771f07f8371b7ae604b54b4752">BRIDGE_ARRAY_START</a>, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a>*));
<a name="l00484"></a>00484    bridge-&gt;<a class="code" href="structast__bridge.html#ae79741378b1094486dc2671c8bc861ef">array_size</a> = <a class="code" href="bridging_8c.html#a19adb1771f07f8371b7ae604b54b4752">BRIDGE_ARRAY_START</a>;
<a name="l00485"></a>00485 
<a name="l00486"></a>00486    <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(&amp;bridge-&gt;<a class="code" href="structast__bridge.html#af15c2e8b6df8ce0bf570af18aa890deb">feature_flags</a>, flags);
<a name="l00487"></a>00487 
<a name="l00488"></a>00488    <span class="comment">/* Pass off the bridge to the technology to manipulate if needed */</span>
<a name="l00489"></a>00489    <span class="keywordflow">if</span> (bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a4c02331d19c7cdb01704c544961130a1">create</a>) {
<a name="l00490"></a>00490       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Giving bridge technology %s the bridge structure %p to setup\n&quot;</span>, bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, bridge);
<a name="l00491"></a>00491       <span class="keywordflow">if</span> (bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a4c02331d19c7cdb01704c544961130a1">create</a>(bridge)) {
<a name="l00492"></a>00492          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Bridge technology %s failed to setup bridge structure %p\n&quot;</span>, bridge-&gt;<a class="code" href="structast__bridge.html#aabb60a181a9e98fb31f8666fb4f5d0b8">technology</a>-&gt;<a class="code" href="structast__bridge__technology.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, bridge);
<a name="l00493"></a>00493          <a class="code" href="astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(bridge, -1);
<a name="l00494"></a>00494          bridge = NULL;
<a name="l00495"></a>00495       }
<a name="l00496"></a>00496    }
<a name="l00497"></a>00497 
<a name="l00498"></a>00498    <span class="keywordflow">return</span> bridge;
<a name="l00499"></a>00499 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a66d6a521530f4fb208eb8ee33e257b6c"></a><!-- doxytag: member="bridging.h::ast_bridge_remove" ref="a66d6a521530f4fb208eb8ee33e257b6c" args="(struct ast_bridge *bridge, struct ast_channel *chan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_bridge_remove </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge.html">ast_bridge</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Remove a channel from a bridge. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>bridge</em>&nbsp;</td><td>Bridge that the channel is to be removed from </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel to remove</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure</td></tr>
  </table>
  </dd>
</dl>
<p>Example usage:</p>
<div class="fragment"><pre class="fragment"> <a class="code" href="bridging_8h.html#a66d6a521530f4fb208eb8ee33e257b6c" title="Remove a channel from a bridge.">ast_bridge_remove</a>(bridge, <a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>);
</pre></div><p>This removes the channel pointed to by the chan pointer from the bridge pointed to by the bridge pointer and <a class="el" href="structrequests.html">requests</a> that it be hung up. Control over the channel will NOT be given to the calling thread.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>This API call can be used on <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> that were added to the bridge using both ast_bridge_join and ast_bridge_impart. </dd></dl>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l01087">1087</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="astobj2_8c_source.html#l00147">ao2_lock()</a>, <a class="el" href="astobj2_8c_source.html#l00169">ao2_unlock()</a>, <a class="el" href="bridging_8c_source.html#l00118">ast_bridge_change_state()</a>, <a class="el" href="bridging_8h_source.html#l00092">AST_BRIDGE_CHANNEL_STATE_HANGUP</a>, and <a class="el" href="bridging_8c_source.html#l00204">find_bridge_channel()</a>.</p>

<p>Referenced by <a class="el" href="app__confbridge_8c_source.html#l00607">menu_callback()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01088"></a>01088 {
<a name="l01089"></a>01089    <span class="keyword">struct </span><a class="code" href="structast__bridge__channel.html" title="Structure that contains information regarding a channel in a bridge.">ast_bridge_channel</a> *bridge_channel = NULL;
<a name="l01090"></a>01090 
<a name="l01091"></a>01091    <a class="code" href="astobj2_8h.html#a3077056d07f6f9e348a54a743769bad5" title="Lock an object.">ao2_lock</a>(bridge);
<a name="l01092"></a>01092 
<a name="l01093"></a>01093    <span class="comment">/* Try to find the channel that we want to remove */</span>
<a name="l01094"></a>01094    <span class="keywordflow">if</span> (!(bridge_channel = <a class="code" href="bridging_8c.html#af76003eaee352a6e71c4411b99c87eb1" title="Helper function to find a bridge channel given a channel.">find_bridge_channel</a>(bridge, chan))) {
<a name="l01095"></a>01095       <a class="code" href="astobj2_8h.html#a379cc936a320f2179f7beb422dc15230" title="Unlock an object.">ao2_unlock</a>(bridge);
<a name="l01096"></a>01096       <span class="keywordflow">return</span> -1;
<a name="l01097"></a>01097    }
<a name="l01098"></a>01098 
<a name="l01099"></a>01099    <a class="code" href="bridging_8h.html#a03cde0e9535440a4f9f24ab921bea771" title="Change the state of a bridged channel.">ast_bridge_change_state</a>(bridge_channel, <a class="code" href="bridging_8h.html#a78f46aa0abbe1f3bf98be03c884203a7aeabb6e67917f26042d385634268af296">AST_BRIDGE_CHANNEL_STATE_HANGUP</a>);
<a name="l01100"></a>01100 
<a name="l01101"></a>01101    <a class="code" href="astobj2_8h.html#a379cc936a320f2179f7beb422dc15230" title="Unlock an object.">ao2_unlock</a>(bridge);
<a name="l01102"></a>01102 
<a name="l01103"></a>01103    <span class="keywordflow">return</span> 0;
<a name="l01104"></a>01104 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a85bc0d4138ac2af7b207d8f1325f051a"></a><!-- doxytag: member="bridging.h::ast_bridge_suspend" ref="a85bc0d4138ac2af7b207d8f1325f051a" args="(struct ast_bridge *bridge, struct ast_channel *chan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_bridge_suspend </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge.html">ast_bridge</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Suspend a channel temporarily from a bridge. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>bridge</em>&nbsp;</td><td>Bridge to suspend the channel from </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel to suspend</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure</td></tr>
  </table>
  </dd>
</dl>
<p>Example usage:</p>
<div class="fragment"><pre class="fragment"> <a class="code" href="bridging_8h.html#a85bc0d4138ac2af7b207d8f1325f051a" title="Suspend a channel temporarily from a bridge.">ast_bridge_suspend</a>(bridge, chan);
</pre></div><p>This suspends the channel pointed to by chan from the bridge pointed to by bridge temporarily. Control of the channel is given to the calling thread. This differs from ast_bridge_depart as the channel will not be removed from the bridge.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>This API call can be used on <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> that were added to the bridge using both ast_bridge_join and ast_bridge_impart. </dd></dl>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l01187">1187</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="astobj2_8c_source.html#l00147">ao2_lock()</a>, <a class="el" href="astobj2_8c_source.html#l00169">ao2_unlock()</a>, <a class="el" href="bridging_8c_source.html#l00750">bridge_channel_suspend()</a>, and <a class="el" href="bridging_8c_source.html#l00204">find_bridge_channel()</a>.</p>

<p>Referenced by <a class="el" href="app__confbridge_8c_source.html#l00485">leave_conference_bridge()</a>, <a class="el" href="app__confbridge_8c_source.html#l00253">post_join_marked()</a>, and <a class="el" href="app__confbridge_8c_source.html#l00320">post_join_unmarked()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01188"></a>01188 {
<a name="l01189"></a>01189    <span class="keyword">struct </span><a class="code" href="structast__bridge__channel.html" title="Structure that contains information regarding a channel in a bridge.">ast_bridge_channel</a> *bridge_channel;
<a name="l01190"></a>01190 
<a name="l01191"></a>01191    <a class="code" href="astobj2_8h.html#a3077056d07f6f9e348a54a743769bad5" title="Lock an object.">ao2_lock</a>(bridge);
<a name="l01192"></a>01192 
<a name="l01193"></a>01193    <span class="keywordflow">if</span> (!(bridge_channel = <a class="code" href="bridging_8c.html#af76003eaee352a6e71c4411b99c87eb1" title="Helper function to find a bridge channel given a channel.">find_bridge_channel</a>(bridge, chan))) {
<a name="l01194"></a>01194       <a class="code" href="astobj2_8h.html#a379cc936a320f2179f7beb422dc15230" title="Unlock an object.">ao2_unlock</a>(bridge);
<a name="l01195"></a>01195       <span class="keywordflow">return</span> -1;
<a name="l01196"></a>01196    }
<a name="l01197"></a>01197 
<a name="l01198"></a>01198    <a class="code" href="bridging_8c.html#a3a1111dba6ca9870165bccb229348b01" title="Internal function that suspends a channel from a bridge.">bridge_channel_suspend</a>(bridge, bridge_channel);
<a name="l01199"></a>01199 
<a name="l01200"></a>01200    <a class="code" href="astobj2_8h.html#a379cc936a320f2179f7beb422dc15230" title="Unlock an object.">ao2_unlock</a>(bridge);
<a name="l01201"></a>01201 
<a name="l01202"></a>01202    <span class="keywordflow">return</span> 0;
<a name="l01203"></a>01203 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aab4cd1153d39a6744eca6a84d5255820"></a><!-- doxytag: member="bridging.h::ast_bridge_unsuspend" ref="aab4cd1153d39a6744eca6a84d5255820" args="(struct ast_bridge *bridge, struct ast_channel *chan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_bridge_unsuspend </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__bridge.html">ast_bridge</a> *&nbsp;</td>
          <td class="paramname"> <em>bridge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Unsuspend a channel from a bridge. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>bridge</em>&nbsp;</td><td>Bridge to unsuspend the channel from </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel to unsuspend</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure</td></tr>
  </table>
  </dd>
</dl>
<p>Example usage:</p>
<div class="fragment"><pre class="fragment"> <a class="code" href="bridging_8h.html#aab4cd1153d39a6744eca6a84d5255820" title="Unsuspend a channel from a bridge.">ast_bridge_unsuspend</a>(bridge, chan);
</pre></div><p>This unsuspends the channel pointed to by chan from the bridge pointed to by bridge. The bridge will go back to handling the channel once this function returns.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>You must not mess with the channel once this function returns. Doing so may result in bad things happening. </dd></dl>

<p>Definition at line <a class="el" href="bridging_8c_source.html#l01205">1205</a> of file <a class="el" href="bridging_8c_source.html">bridging.c</a>.</p>

<p>References <a class="el" href="astobj2_8c_source.html#l00147">ao2_lock()</a>, <a class="el" href="astobj2_8c_source.html#l00169">ao2_unlock()</a>, <a class="el" href="bridging_8c_source.html#l00764">bridge_channel_unsuspend()</a>, and <a class="el" href="bridging_8c_source.html#l00204">find_bridge_channel()</a>.</p>

<p>Referenced by <a class="el" href="app__confbridge_8c_source.html#l00485">leave_conference_bridge()</a>, <a class="el" href="app__confbridge_8c_source.html#l00253">post_join_marked()</a>, and <a class="el" href="app__confbridge_8c_source.html#l00320">post_join_unmarked()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01206"></a>01206 {
<a name="l01207"></a>01207    <span class="keyword">struct </span><a class="code" href="structast__bridge__channel.html" title="Structure that contains information regarding a channel in a bridge.">ast_bridge_channel</a> *bridge_channel;
<a name="l01208"></a>01208 
<a name="l01209"></a>01209    <a class="code" href="astobj2_8h.html#a3077056d07f6f9e348a54a743769bad5" title="Lock an object.">ao2_lock</a>(bridge);
<a name="l01210"></a>01210 
<a name="l01211"></a>01211    <span class="keywordflow">if</span> (!(bridge_channel = <a class="code" href="bridging_8c.html#af76003eaee352a6e71c4411b99c87eb1" title="Helper function to find a bridge channel given a channel.">find_bridge_channel</a>(bridge, chan))) {
<a name="l01212"></a>01212       <a class="code" href="astobj2_8h.html#a379cc936a320f2179f7beb422dc15230" title="Unlock an object.">ao2_unlock</a>(bridge);
<a name="l01213"></a>01213       <span class="keywordflow">return</span> -1;
<a name="l01214"></a>01214    }
<a name="l01215"></a>01215 
<a name="l01216"></a>01216    <a class="code" href="bridging_8c.html#a761e80878d0be1580c163dda4553dc37" title="Internal function that unsuspends a channel from a bridge.">bridge_channel_unsuspend</a>(bridge, bridge_channel);
<a name="l01217"></a>01217 
<a name="l01218"></a>01218    <a class="code" href="astobj2_8h.html#a379cc936a320f2179f7beb422dc15230" title="Unlock an object.">ao2_unlock</a>(bridge);
<a name="l01219"></a>01219 
<a name="l01220"></a>01220    <span class="keywordflow">return</span> 0;
<a name="l01221"></a>01221 }
</pre></div></p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:19:41 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
