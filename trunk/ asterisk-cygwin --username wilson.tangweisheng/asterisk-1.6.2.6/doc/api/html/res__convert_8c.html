<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:23:11 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_318a70d4e812a718d9ecaeea98fff199.html">res</a>
  </div>
</div>
<div class="contents">
<h1>res_convert.c File Reference</h1>
<p>file format conversion CLI command using Asterisk <a class="el" href="structformats.html">formats</a> and <a class="el" href="structtranslators.html" title="the list of translators">translators</a>  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="asterisk_8h_source.html">asterisk.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="channel_8h_source.html">asterisk/channel.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="module_8h_source.html">asterisk/module.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="cli_8h_source.html">asterisk/cli.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="file_8h_source.html">asterisk/file.h</a>&quot;</code><br/>

<p><a href="res__convert_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__convert_8c.html#a88b7c88fed6b80fd18f34f97757dfc04">__reg_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__convert_8c.html#afeab1257bd17282b95875499393a147a">__unreg_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__convert_8c.html#a32041ec3ae7a122cb5d0ec069744fc4d">handle_cli_file_convert</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Convert a file from one format to another.  <a href="#a32041ec3ae7a122cb5d0ec069744fc4d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__convert_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__convert_8c.html#a724d4590aed86063dcfbd8fa5a42a71b">split_ext</a> (char *filename, char **<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, char **<a class="el" href="res__phoneprov_8c.html#a71ac783a3ca66bd546dc964f1dd0e0f0">ext</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Split the filename to basename and <a class="el" href="structextension.html">extension</a>.  <a href="#a724d4590aed86063dcfbd8fa5a42a71b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__convert_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a> (void)</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__module__info.html">ast_module_info</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__convert_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a> = { .<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = AST_MODULE, .flags = AST_MODFLAG_DEFAULT , .<a class="el" href="callerid_8c.html#a68344fa88cf4e86b5079fd69a5c22d57">description</a> = &quot;File <a class="el" href="chan__alsa_8c.html#a98f5e70e98f6dc48e3c5ba316066d540">format</a> conversion CLI command&quot; , .key = &quot;This paragraph is copyright (c) 2006 by Digium, Inc. \In order for your module to load, it must return this \key via a function called \&quot;key\&quot;. Any code which \includes this paragraph must be licensed under the GNU \General Public License <a class="el" href="res__config__pgsql_8c.html#aad880fc4455c253781e8968f2239d56f">version</a> 2 or later (at your \option). In addition to Digium's general reservations \of rights, Digium expressly reserves the right to \allow other parties to license this paragraph under \different terms. Any use of Digium, Inc. trademarks or \logos (including \&quot;Asterisk\&quot; or \&quot;Digium\&quot;) without \express written <a class="el" href="structpermission.html">permission</a> of Digium, Inc. is prohibited.\n&quot; , .buildopt_sum = &quot;aefddfaffd51bc118c14a748e96eb9a0&quot; , .load = load_module, .unload = unload_module, }</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__module__info.html">ast_module_info</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__convert_8c.html#ae25b9f3970870610911f8850897e8ead">ast_module_info</a> = &amp;<a class="el" href="res__timing__timerfd_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__convert_8c.html#ac59345a61d252f1c3587239608474033">cli_convert</a> []</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>file format conversion CLI command using Asterisk <a class="el" href="structformats.html">formats</a> and <a class="el" href="structtranslators.html" title="the list of translators">translators</a> </p>
<dl class="author"><dt><b>Author:</b></dt><dd>redice li &lt;<a href="mailto:redice_li@yahoo.com">redice_li@yahoo.com</a>&gt; </dd>
<dd>
Russell Bryant &lt;<a href="mailto:russell@digium.com">russell@digium.com</a>&gt; </dd></dl>

<p>Definition in file <a class="el" href="res__convert_8c_source.html">res_convert.c</a>.</p>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a88b7c88fed6b80fd18f34f97757dfc04"></a><!-- doxytag: member="res_convert.c::__reg_module" ref="a88b7c88fed6b80fd18f34f97757dfc04" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void __reg_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__convert_8c_source.html#l00162">162</a> of file <a class="el" href="res__convert_8c_source.html">res_convert.c</a>.</p>

</div>
</div>
<a class="anchor" id="afeab1257bd17282b95875499393a147a"></a><!-- doxytag: member="res_convert.c::__unreg_module" ref="afeab1257bd17282b95875499393a147a" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void __unreg_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__convert_8c_source.html#l00162">162</a> of file <a class="el" href="res__convert_8c_source.html">res_convert.c</a>.</p>

</div>
</div>
<a class="anchor" id="a32041ec3ae7a122cb5d0ec069744fc4d"></a><!-- doxytag: member="res_convert.c::handle_cli_file_convert" ref="a32041ec3ae7a122cb5d0ec069744fc4d" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* handle_cli_file_convert </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Convert a file from one format to another. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>e</em>&nbsp;</td><td>CLI entry </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>cmd</em>&nbsp;</td><td>command <a class="el" href="structnumber.html" title="Number structure.">number</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>a</em>&nbsp;</td><td>list of cli arguments </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>CLI_SUCCESS</em>&nbsp;</td><td>on success. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>CLI_SHOWUSAGE</em>&nbsp;</td><td>or CLI_FAILURE on failure. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="res__convert_8c_source.html#l00062">62</a> of file <a class="el" href="res__convert_8c_source.html">res_convert.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8h_source.html#l00141">ast_cli_args::argv</a>, <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="file_8c_source.html#l00887">ast_closestream()</a>, <a class="el" href="asterisk_8h_source.html#l00036">AST_FILE_MODE</a>, <a class="el" href="file_8c_source.html#l00928">ast_filedelete()</a>, <a class="el" href="frame_8h_source.html#l00462">ast_frfree</a>, <a class="el" href="loader_8c_source.html#l01163">ast_module_ref()</a>, <a class="el" href="loader_8c_source.html#l01171">ast_module_unref()</a>, <a class="el" href="file_8c_source.html#l00985">ast_readfile()</a>, <a class="el" href="file_8c_source.html#l00720">ast_readframe()</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="time_8h_source.html#l00089">ast_tvdiff_ms()</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="file_8c_source.html#l01033">ast_writefile()</a>, <a class="el" href="file_8c_source.html#l00144">ast_writestream()</a>, <a class="el" href="cli_8h_source.html#l00045">CLI_FAILURE</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="format__g726_8c_source.html#l00177">f</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, <a class="el" href="res__convert_8c_source.html#l00039">split_ext()</a>, and <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00063"></a>00063 {
<a name="l00064"></a>00064    <span class="keywordtype">char</span> *ret = <a class="code" href="cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;
<a name="l00065"></a>00065    <span class="keyword">struct </span><a class="code" href="structast__filestream.html" title="This structure is allocated by file.c in one chunk, together with buf_size and desc_size...">ast_filestream</a> *fs_in = NULL, *fs_out = NULL;
<a name="l00066"></a>00066    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>;
<a name="l00067"></a>00067    <span class="keyword">struct </span>timeval start;
<a name="l00068"></a>00068    <span class="keywordtype">int</span> cost;
<a name="l00069"></a>00069    <span class="keywordtype">char</span> *file_in = NULL, *file_out = NULL;
<a name="l00070"></a>00070    <span class="keywordtype">char</span> *name_in, *ext_in, *name_out, *ext_out;
<a name="l00071"></a>00071 
<a name="l00072"></a>00072    <span class="keywordflow">switch</span> (cmd) {
<a name="l00073"></a>00073    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l00074"></a>00074       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;file convert&quot;</span>;
<a name="l00075"></a>00075       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l00076"></a>00076          <span class="stringliteral">&quot;Usage: file convert &lt;file_in&gt; &lt;file_out&gt;\n&quot;</span>
<a name="l00077"></a>00077          <span class="stringliteral">&quot;       Convert from file_in to file_out. If an absolute path\n&quot;</span>
<a name="l00078"></a>00078          <span class="stringliteral">&quot;       is not given, the default Asterisk sounds directory\n&quot;</span>
<a name="l00079"></a>00079          <span class="stringliteral">&quot;       will be used.\n\n&quot;</span>
<a name="l00080"></a>00080          <span class="stringliteral">&quot;       Example:\n&quot;</span>
<a name="l00081"></a>00081          <span class="stringliteral">&quot;           file convert tt-weasels.gsm tt-weasels.ulaw\n&quot;</span>;
<a name="l00082"></a>00082       <span class="keywordflow">return</span> NULL;
<a name="l00083"></a>00083    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l00084"></a>00084       <span class="keywordflow">return</span> NULL;
<a name="l00085"></a>00085    }
<a name="l00086"></a>00086    
<a name="l00087"></a>00087    <span class="comment">/* ugly, can be removed when CLI entries have ast_module pointers */</span>
<a name="l00088"></a>00088    <a class="code" href="module_8h.html#aa08fcee0b390e15532dd03803c8728c4">ast_module_ref</a>(<a class="code" href="structast__module__info.html">ast_module_info</a>-&gt;self);
<a name="l00089"></a>00089 
<a name="l00090"></a>00090    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> != 4 || <a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[2]) || <a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3])) {
<a name="l00091"></a>00091       ret = <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l00092"></a>00092       <span class="keywordflow">goto</span> fail_out; 
<a name="l00093"></a>00093    }
<a name="l00094"></a>00094 
<a name="l00095"></a>00095    file_in = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[2]);
<a name="l00096"></a>00096    file_out = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3]);
<a name="l00097"></a>00097 
<a name="l00098"></a>00098    <span class="keywordflow">if</span> (<a class="code" href="res__convert_8c.html#a724d4590aed86063dcfbd8fa5a42a71b" title="Split the filename to basename and extension.">split_ext</a>(file_in, &amp;name_in, &amp;ext_in)) {
<a name="l00099"></a>00099       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;&apos;%s&apos; is an invalid filename!\n&quot;</span>, a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[2]);
<a name="l00100"></a>00100       <span class="keywordflow">goto</span> fail_out;
<a name="l00101"></a>00101    }
<a name="l00102"></a>00102    <span class="keywordflow">if</span> (!(fs_in = <a class="code" href="file_8h.html#ad572060ea434390db3d1ccde4511dfcd" title="Starts reading from a file.">ast_readfile</a>(name_in, ext_in, NULL, O_RDONLY, 0, 0))) {
<a name="l00103"></a>00103       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Unable to open input file: %s\n&quot;</span>, a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[2]);
<a name="l00104"></a>00104       <span class="keywordflow">goto</span> fail_out;
<a name="l00105"></a>00105    }
<a name="l00106"></a>00106    
<a name="l00107"></a>00107    <span class="keywordflow">if</span> (<a class="code" href="res__convert_8c.html#a724d4590aed86063dcfbd8fa5a42a71b" title="Split the filename to basename and extension.">split_ext</a>(file_out, &amp;name_out, &amp;ext_out)) {
<a name="l00108"></a>00108       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;&apos;%s&apos; is an invalid filename!\n&quot;</span>, a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3]);
<a name="l00109"></a>00109       <span class="keywordflow">goto</span> fail_out;
<a name="l00110"></a>00110    }
<a name="l00111"></a>00111    <span class="keywordflow">if</span> (!(fs_out = <a class="code" href="file_8h.html#a964f8ef393c07609d7b9e02937faed52" title="Starts writing a file.">ast_writefile</a>(name_out, ext_out, NULL, O_CREAT|O_TRUNC|O_WRONLY, 0, <a class="code" href="asterisk_8h.html#aa6293b2dae52a2b470494df672a26c42">AST_FILE_MODE</a>))) {
<a name="l00112"></a>00112       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Unable to open output file: %s\n&quot;</span>, a-&gt;<a class="code" href="structast__cli__args.html#af2efa898e9eed6fe6715279cb1ec35b0">argv</a>[3]);
<a name="l00113"></a>00113       <span class="keywordflow">goto</span> fail_out;
<a name="l00114"></a>00114    }
<a name="l00115"></a>00115 
<a name="l00116"></a>00116    start = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l00117"></a>00117    
<a name="l00118"></a>00118    <span class="keywordflow">while</span> ((f = <a class="code" href="file_8h.html#a962bc31d7a953b0a0290c72b168d41a7" title="Read a frame from a filestream.">ast_readframe</a>(fs_in))) {
<a name="l00119"></a>00119       <span class="keywordflow">if</span> (<a class="code" href="file_8h.html#a3608386b919ef0949d2858cdeb02d12e" title="Writes a frame to a stream.">ast_writestream</a>(fs_out, f)) {
<a name="l00120"></a>00120          <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l00121"></a>00121          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Failed to convert %s.%s to %s.%s!\n&quot;</span>, name_in, ext_in, name_out, ext_out);
<a name="l00122"></a>00122          <span class="keywordflow">goto</span> fail_out;
<a name="l00123"></a>00123       }
<a name="l00124"></a>00124       <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);
<a name="l00125"></a>00125    }
<a name="l00126"></a>00126 
<a name="l00127"></a>00127    cost = <a class="code" href="time_8h.html#a74e35cffcd45ad6cd7c8587921e8a4c2" title="Computes the difference (in milliseconds) between two struct timeval instances.">ast_tvdiff_ms</a>(<a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>(), start);
<a name="l00128"></a>00128    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Converted %s.%s to %s.%s in %dms\n&quot;</span>, name_in, ext_in, name_out, ext_out, cost);
<a name="l00129"></a>00129    ret = <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l00130"></a>00130 
<a name="l00131"></a>00131 fail_out:
<a name="l00132"></a>00132    <span class="keywordflow">if</span> (fs_out) {
<a name="l00133"></a>00133       <a class="code" href="file_8h.html#ab53bd2c3c55d509790c7f7620aac6373" title="Closes a stream.">ast_closestream</a>(fs_out);
<a name="l00134"></a>00134       <span class="keywordflow">if</span> (ret != <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>)
<a name="l00135"></a>00135          <a class="code" href="file_8h.html#adb15d6efecc1a13b8835bee6d3562ddb" title="Deletes a file.">ast_filedelete</a>(name_out, ext_out);
<a name="l00136"></a>00136    }
<a name="l00137"></a>00137 
<a name="l00138"></a>00138    <span class="keywordflow">if</span> (fs_in) 
<a name="l00139"></a>00139       <a class="code" href="file_8h.html#ab53bd2c3c55d509790c7f7620aac6373" title="Closes a stream.">ast_closestream</a>(fs_in);
<a name="l00140"></a>00140 
<a name="l00141"></a>00141    <a class="code" href="module_8h.html#ac65fa15b16dbc563a2424af744ab003d">ast_module_unref</a>(<a class="code" href="structast__module__info.html">ast_module_info</a>-&gt;self);
<a name="l00142"></a>00142 
<a name="l00143"></a>00143    <span class="keywordflow">return</span> ret;
<a name="l00144"></a>00144 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac3382bf6da54c56b37069bd76bbdf4f9"></a><!-- doxytag: member="res_convert.c::load_module" ref="ac3382bf6da54c56b37069bd76bbdf4f9" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int load_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__convert_8c_source.html#l00156">156</a> of file <a class="el" href="res__convert_8c_source.html">res_convert.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="cli_8c_source.html#l01927">ast_cli_register_multiple()</a>, and <a class="el" href="module_8h_source.html#l00061">AST_MODULE_LOAD_SUCCESS</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00157"></a>00157 {
<a name="l00158"></a>00158    <a class="code" href="cli_8h.html#aadeef34f3106bb78aeb3414032ad7fb7" title="Register multiple commands.">ast_cli_register_multiple</a>(<a class="code" href="res__convert_8c.html#ac59345a61d252f1c3587239608474033">cli_convert</a>, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="res__convert_8c.html#ac59345a61d252f1c3587239608474033">cli_convert</a>));
<a name="l00159"></a>00159    <span class="keywordflow">return</span> <a class="code" href="module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a>;
<a name="l00160"></a>00160 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a724d4590aed86063dcfbd8fa5a42a71b"></a><!-- doxytag: member="res_convert.c::split_ext" ref="a724d4590aed86063dcfbd8fa5a42a71b" args="(char *filename, char **name, char **ext)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int split_ext </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>filename</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&nbsp;</td>
          <td class="paramname"> <em>ext</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Split the filename to basename and <a class="el" href="structextension.html">extension</a>. </p>

<p>Definition at line <a class="el" href="res__convert_8c_source.html#l00039">39</a> of file <a class="el" href="res__convert_8c_source.html">res_convert.c</a>.</p>

<p>References <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>.</p>

<p>Referenced by <a class="el" href="res__convert_8c_source.html#l00062">handle_cli_file_convert()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00040"></a>00040 {
<a name="l00041"></a>00041    *<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a> = *<a class="code" href="http_8c.html#af9b32121c4ad80b0887a3d73fd24de5f">ext</a> = filename;
<a name="l00042"></a>00042    
<a name="l00043"></a>00043    <span class="keywordflow">if</span> ((*<a class="code" href="http_8c.html#af9b32121c4ad80b0887a3d73fd24de5f">ext</a> = strrchr(filename, <span class="charliteral">&apos;.&apos;</span>))) {
<a name="l00044"></a>00044       **<a class="code" href="http_8c.html#af9b32121c4ad80b0887a3d73fd24de5f">ext</a> = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00045"></a>00045       (*ext)++;
<a name="l00046"></a>00046    }
<a name="l00047"></a>00047 
<a name="l00048"></a>00048    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(*<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>) || <a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(*<a class="code" href="http_8c.html#af9b32121c4ad80b0887a3d73fd24de5f">ext</a>))
<a name="l00049"></a>00049       <span class="keywordflow">return</span> -1;
<a name="l00050"></a>00050 
<a name="l00051"></a>00051    <span class="keywordflow">return</span> 0;
<a name="l00052"></a>00052 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad09fa931f468002152a3cc2d5ce25eae"></a><!-- doxytag: member="res_convert.c::unload_module" ref="ad09fa931f468002152a3cc2d5ce25eae" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int unload_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__convert_8c_source.html#l00150">150</a> of file <a class="el" href="res__convert_8c_source.html">res_convert.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, and <a class="el" href="cli_8c_source.html#l01937">ast_cli_unregister_multiple()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00151"></a>00151 {
<a name="l00152"></a>00152    <a class="code" href="cli_8h.html#a56b6b59ee2eaa994597a5b0f4e9f9d09" title="Unregister multiple commands.">ast_cli_unregister_multiple</a>(<a class="code" href="res__convert_8c.html#ac59345a61d252f1c3587239608474033">cli_convert</a>, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="res__convert_8c.html#ac59345a61d252f1c3587239608474033">cli_convert</a>));
<a name="l00153"></a>00153    <span class="keywordflow">return</span> 0;
<a name="l00154"></a>00154 }
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="ab22f32016155f7f403e7178767163d7d"></a><!-- doxytag: member="res_convert.c::__mod_info" ref="ab22f32016155f7f403e7178767163d7d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__module__info.html">ast_module_info</a> <a class="el" href="res__timing__timerfd_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a> = { .<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = AST_MODULE, .flags = AST_MODFLAG_DEFAULT , .<a class="el" href="callerid_8c.html#a68344fa88cf4e86b5079fd69a5c22d57">description</a> = &quot;File <a class="el" href="chan__alsa_8c.html#a98f5e70e98f6dc48e3c5ba316066d540">format</a> conversion CLI command&quot; , .key = &quot;This paragraph is copyright (c) 2006 by Digium, Inc. \In order for your module to load, it must return this \key via a function called \&quot;key\&quot;. Any code which \includes this paragraph must be licensed under the GNU \General Public License <a class="el" href="res__config__pgsql_8c.html#aad880fc4455c253781e8968f2239d56f">version</a> 2 or later (at your \option). In addition to Digium's general reservations \of rights, Digium expressly reserves the right to \allow other parties to license this paragraph under \different terms. Any use of Digium, Inc. trademarks or \logos (including \&quot;Asterisk\&quot; or \&quot;Digium\&quot;) without \express written <a class="el" href="structpermission.html">permission</a> of Digium, Inc. is prohibited.\n&quot; , .buildopt_sum = &quot;aefddfaffd51bc118c14a748e96eb9a0&quot; , .load = load_module, .unload = unload_module, }<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__convert_8c_source.html#l00162">162</a> of file <a class="el" href="res__convert_8c_source.html">res_convert.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae25b9f3970870610911f8850897e8ead"></a><!-- doxytag: member="res_convert.c::ast_module_info" ref="ae25b9f3970870610911f8850897e8ead" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__module__info.html">ast_module_info</a>* <a class="el" href="structast__module__info.html">ast_module_info</a> = &amp;<a class="el" href="res__timing__timerfd_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__convert_8c_source.html#l00162">162</a> of file <a class="el" href="res__convert_8c_source.html">res_convert.c</a>.</p>

</div>
</div>
<a class="anchor" id="ac59345a61d252f1c3587239608474033"></a><!-- doxytag: member="res_convert.c::cli_convert" ref="ac59345a61d252f1c3587239608474033" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> <a class="el" href="res__convert_8c.html#ac59345a61d252f1c3587239608474033">cli_convert</a>[]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
   <a class="code" href="cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="res__convert_8c.html#a32041ec3ae7a122cb5d0ec069744fc4d" title="Convert a file from one format to another.">handle_cli_file_convert</a>, <span class="stringliteral">&quot;Convert audio file&quot;</span>)
}
</pre></div>
<p>Definition at line <a class="el" href="res__convert_8c_source.html#l00146">146</a> of file <a class="el" href="res__convert_8c_source.html">res_convert.c</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:23:11 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
