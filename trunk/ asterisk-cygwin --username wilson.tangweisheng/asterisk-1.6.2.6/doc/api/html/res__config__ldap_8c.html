<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:23:09 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_318a70d4e812a718d9ecaeea98fff199.html">res</a>
  </div>
</div>
<div class="contents">
<h1>res_config_ldap.c File Reference</h1>
<p>ldap plugin for portable configuration engine (ARA)  
<a href="#_details">More...</a></p>
<code>#include &quot;lber.h&quot;</code><br/>
<code>#include &quot;<a class="el" href="asterisk_8h_source.html">asterisk.h</a>&quot;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;ctype.h&gt;</code><br/>
<code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;ldap.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="channel_8h_source.html">asterisk/channel.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="logger_8h_source.html">asterisk/logger.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="config_8h_source.html">asterisk/config.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="module_8h_source.html">asterisk/module.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="lock_8h_source.html">asterisk/lock.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="options_8h_source.html">asterisk/options.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="cli_8h_source.html">asterisk/cli.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="utils_8h_source.html">asterisk/utils.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="strings_8h_source.html">asterisk/strings.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="pbx_8h_source.html">asterisk/pbx.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="linkedlists_8h_source.html">asterisk/linkedlists.h</a>&quot;</code><br/>

<p><a href="res__config__ldap_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcategory__and__metric.html">category_and_metric</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structldap__table__config.html">ldap_table_config</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Table configuration.  <a href="structldap__table__config.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structtable__configs.html">table_configs</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Should be locked before using it.  <a href="structtable__configs.html#_details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#a316b7b96e4e4d444e5703a69e7574ff0">MAXRESULT</a>&nbsp;&nbsp;&nbsp;2048</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#af925dc82fd1722062dc8e2ff0f7aac61">RES_CONFIG_LDAP_CONF</a>&nbsp;&nbsp;&nbsp;&quot;res_ldap.conf&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#ac66cf6df04c515faa38696a5031c37fe">RES_CONFIG_LDAP_DEFAULT_BASEDN</a>&nbsp;&nbsp;&nbsp;&quot;asterisk&quot;</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#a88b7c88fed6b80fd18f34f97757dfc04">__reg_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#afeab1257bd17282b95875499393a147a">__unreg_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#a28fa55daf894a70a398e09f3ce39d3dc">append_var_and_value_to_filter</a> (struct <a class="el" href="structast__str.html">ast_str</a> **filter, struct <a class="el" href="structldap__table__config.html">ldap_table_config</a> *table_config, const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, const char *value)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Append a name=value filter string. The filter string can grow.  <a href="#a28fa55daf894a70a398e09f3ce39d3dc"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#a39941ba901b2a30cc6d044760545c6c3">cleaned_basedn</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *channel, const char *basedn)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">caller should free returned pointer  <a href="#a39941ba901b2a30cc6d044760545c6c3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#a64bed424bd720a8738da11c2e4afa54a">compare_categories</a> (const void *a, const void *b)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Sorting alogrithm for qsort to find the order of the variables <em>a</em> and <em>b</em>.  <a href="#a64bed424bd720a8738da11c2e4afa54a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__config.html">ast_config</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#acf13f6374254beee15ad80aa65511685">config_ldap</a> (const char *basedn, const char *table_name, const char *file, struct <a class="el" href="structast__config.html">ast_config</a> *cfg, struct <a class="el" href="structast__flags.html">ast_flags</a> <a class="el" href="app__rpt_8c.html#a1f57f20c1f46890828791a4827fe8752">config_flags</a>, const char *sugg_incl, const char *who_asked)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">See Asterisk doc.  <a href="#acf13f6374254beee15ad80aa65511685"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#a52dda9a11e8f46e1b735dad87d03f2cd">convert_attribute_name_from_ldap</a> (struct <a class="el" href="structldap__table__config.html">ldap_table_config</a> *table_config, const char *attribute_name)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Convert ldap attribute name to variable name - Should be locked before using it.  <a href="#a52dda9a11e8f46e1b735dad87d03f2cd"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#a76e2f0e009997a7eae49d0b7e8a16029">convert_attribute_name_to_ldap</a> (struct <a class="el" href="structldap__table__config.html">ldap_table_config</a> *table_config, const char *attribute_name)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Convert variable name to ldap attribute name - Should be locked before using it.  <a href="#a76e2f0e009997a7eae49d0b7e8a16029"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#a860e11270a1778347d12df4841bf7819">is_ldap_connect_error</a> (int err)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__variable.html">ast_variable</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#a6ec80581ef03e58f2c4cdf842dbad775">ldap_loadentry</a> (struct <a class="el" href="structldap__table__config.html">ldap_table_config</a> *table_config, const char *dn)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get LDAP entry by dn and return attributes as variables - Should be locked before using it This is used for setting the default <a class="el" href="structvalues.html">values</a> of an object(i.e., with accountBaseDN).  <a href="#a6ec80581ef03e58f2c4cdf842dbad775"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#a77f9d4c9f33d2f29e98c5c8cc09e9119">ldap_reconnect</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#ad096b7ca5e5115c828fb827c207e4770">ldap_table_config_add_attribute</a> (struct <a class="el" href="structldap__table__config.html">ldap_table_config</a> *table_config, const char *attribute_name, const char *attribute_value)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">add attribute to table config - Should be locked before using it  <a href="#ad096b7ca5e5115c828fb827c207e4770"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#af9f24c4cf29126b1832517b188aeb585">parse_config</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__variable.html">ast_variable</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#af453de1bba339d948f98c9e2b49eafdd">realtime_ldap</a> (const char *basedn, const char *table_name, va_list ap)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">See Asterisk doc.  <a href="#af453de1bba339d948f98c9e2b49eafdd"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__variable.html">ast_variable</a> **&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#a4c05d455f43aac9094ec3f01d52af8c2">realtime_ldap_base</a> (unsigned int *entries_count_ptr, const char *basedn, const char *table_name,...)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">same as realtime_ldap_base_ap but take variable arguments count list  <a href="#a4c05d455f43aac9094ec3f01d52af8c2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__variable.html">ast_variable</a> **&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#a3037ce503252b1b50de11873d1a2a6c2">realtime_ldap_base_ap</a> (unsigned int *entries_count_ptr, const char *basedn, const char *table_name, va_list ap)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">LDAP base function.  <a href="#a3037ce503252b1b50de11873d1a2a6c2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__variable.html">ast_variable</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#a8f096254a39794606157ea3b7c30428a">realtime_ldap_entry_to_var</a> (struct <a class="el" href="structldap__table__config.html">ldap_table_config</a> *table_config, LDAPMessage *ldap_entry)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get variables from ldap entry attributes - Should be locked before using it.  <a href="#a8f096254a39794606157ea3b7c30428a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__variable.html">ast_variable</a> **&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#a70f8af371712c0c864197041a9bbd876">realtime_ldap_result_to_vars</a> (struct <a class="el" href="structldap__table__config.html">ldap_table_config</a> *table_config, LDAPMessage *ldap_result_msg, unsigned int *entries_count_ptr)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get variables from ldap entry attributes - Should be locked before using it.  <a href="#a70f8af371712c0c864197041a9bbd876"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#ad51f9133e1f5e9260cb80c8fd38b60d7">realtime_ldap_status</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__config.html">ast_config</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#a03bfa1966598dbac9d32da0a3e7ed520">realtime_multi_ldap</a> (const char *basedn, const char *table_name, va_list ap)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">See Asterisk doc.  <a href="#a03bfa1966598dbac9d32da0a3e7ed520"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#a35abb75797a3e63bcaf26e917fb548fd">replace_string_in_string</a> (char *string, const char *search, const char *by)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Replace &lt;search&gt; by &lt;by&gt; in string. No check is done on string allocated size !  <a href="#a35abb75797a3e63bcaf26e917fb548fd"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#ac99a0cc028315173eafc14f1079a072b">semicolon_count_str</a> (const char *somestr)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">for the semicolon delimiter  <a href="#ac99a0cc028315173eafc14f1079a072b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#a71f707ac3e35d04940f4e4b357604b65">semicolon_count_var</a> (struct <a class="el" href="structast__variable.html">ast_variable</a> *var)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#a0ce420ebc55160125af52208e87b80ca">substituted</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *channel, const char *string)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">caller should free returned pointer  <a href="#a0ce420ebc55160125af52208e87b80ca"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structldap__table__config.html">ldap_table_config</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#a5d395421629c28b7bd00359041440917">table_config_for_table_name</a> (const char *table_name)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Find a table_config - Should be locked before using it.  <a href="#a5d395421629c28b7bd00359041440917"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structldap__table__config.html">ldap_table_config</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#a8c9c18709185dad2a12c74c00d95d180">table_config_new</a> (const char *table_name)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create a new table_config.  <a href="#a8c9c18709185dad2a12c74c00d95d180"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#a9155b18ff8ee6bb5b8b8bf7c32832ae1">table_configs_free</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Free table_config.  <a href="#a9155b18ff8ee6bb5b8b8bf7c32832ae1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#ae80c2182af15b4603f48d87fc3c7a6a2">update2_ldap</a> (const char *basedn, const char *table_name, va_list ap)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#aac84eea2c3a5f6dc1c8bf29833d2aadd">update_ldap</a> (const char *basedn, const char *table_name, const char *attribute, const char *lookup, va_list ap)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__variable.html">ast_variable</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#a9614b129f70fd9cfbaaf78b6d64b3b16">variable_named</a> (struct <a class="el" href="structast__variable.html">ast_variable</a> *var, const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Find variable by name.  <a href="#a9614b129f70fd9cfbaaf78b6d64b3b16"></a><br/></td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__module__info.html">ast_module_info</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a> = { .<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = AST_MODULE, .flags = AST_MODFLAG_GLOBAL_SYMBOLS , .<a class="el" href="callerid_8c.html#a68344fa88cf4e86b5079fd69a5c22d57">description</a> = &quot;LDAP realtime interface&quot; , .key = &quot;This paragraph is copyright (c) 2006 by Digium, Inc. \In order for your module to load, it must return this \key via a function called \&quot;key\&quot;. Any code which \includes this paragraph must be licensed under the GNU \General Public License <a class="el" href="res__config__pgsql_8c.html#aad880fc4455c253781e8968f2239d56f">version</a> 2 or later (at your \option). In addition to Digium's general reservations \of rights, Digium expressly reserves the right to \allow other parties to license this paragraph under \different terms. Any use of Digium, Inc. trademarks or \logos (including \&quot;Asterisk\&quot; or \&quot;Digium\&quot;) without \express written <a class="el" href="structpermission.html">permission</a> of Digium, Inc. is prohibited.\n&quot; , .buildopt_sum = &quot;aefddfaffd51bc118c14a748e96eb9a0&quot; , .load = load_module, .unload = unload_module, .reload = reload, }</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__module__info.html">ast_module_info</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#ae25b9f3970870610911f8850897e8ead">ast_module_info</a> = &amp;<a class="el" href="res__timing__timerfd_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#acfd19a5e5bb3f90e330bd660b743970f">base_distinguished_name</a> [512]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structldap__table__config.html">ldap_table_config</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#a3c846177aac9c60160bea626fbc3225d">base_table_config</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static time_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#ac4ae24c7b766713b82921c04d1a4b699">connect_time</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#a561b0b21a0287f6db417ce1211336f0f">ldap_cli</a> []</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__config__engine.html">ast_config_engine</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#a70367624d2d9a8df76df96ad482c1f01">ldap_engine</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="lock_8h.html#a2d9118a2a8939f115eea771bce3a52f2">ast_mutex_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#a55f48ee8d8b928c4d52e3d2182a17091">ldap_lock</a> = ((<a class="el" href="lock_8h.html#a2d9118a2a8939f115eea771bce3a52f2">ast_mutex_t</a>) PTHREAD_MUTEX_INITIALIZER )</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static LDAP *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#a68433c52f2199bd92a3c151b295de06e">pass</a> [50]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structldap__table__config.html">ldap_table_config</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#a4b7f6e04c04ac98ed68f7d62640d1d7b">static_table_config</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#a75e4590043edf35241d30fabe2eda546">url</a> [512]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#a930c15eddfe0826ff30e658c9d50b9b4">user</a> [512]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="res__config__ldap_8c.html#aad880fc4455c253781e8968f2239d56f">version</a> = 3</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>ldap plugin for portable configuration engine (ARA) </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Mark Spencer &lt;<a href="mailto:markster@digium.com">markster@digium.com</a>&gt; </dd>
<dd>
Manuel Guesdon </dd>
<dd>
Carl-Einar Thorner &lt;<a href="mailto:cthorner@voicerd.com">cthorner@voicerd.com</a>&gt; </dd>
<dd>
Russell Bryant &lt;<a href="mailto:russell@digium.com">russell@digium.com</a>&gt;</dd></dl>
<ul>
<li><a href="http://www.openldap.org">http://www.openldap.org</a> </li>
</ul>

<p>Definition in file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a316b7b96e4e4d444e5703a69e7574ff0"></a><!-- doxytag: member="res_config_ldap.c::MAXRESULT" ref="a316b7b96e4e4d444e5703a69e7574ff0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAXRESULT&nbsp;&nbsp;&nbsp;2048</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="af925dc82fd1722062dc8e2ff0f7aac61"></a><!-- doxytag: member="res_config_ldap.c::RES_CONFIG_LDAP_CONF" ref="af925dc82fd1722062dc8e2ff0f7aac61" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RES_CONFIG_LDAP_CONF&nbsp;&nbsp;&nbsp;&quot;res_ldap.conf&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l00061">61</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>Referenced by <a class="el" href="res__config__ldap_8c_source.html#l01015">config_ldap()</a>, and <a class="el" href="res__config__ldap_8c_source.html#l01577">parse_config()</a>.</p>

</div>
</div>
<a class="anchor" id="ac66cf6df04c515faa38696a5031c37fe"></a><!-- doxytag: member="res_config_ldap.c::RES_CONFIG_LDAP_DEFAULT_BASEDN" ref="ac66cf6df04c515faa38696a5031c37fe" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RES_CONFIG_LDAP_DEFAULT_BASEDN&nbsp;&nbsp;&nbsp;&quot;asterisk&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l00062">62</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>Referenced by <a class="el" href="res__config__ldap_8c_source.html#l01577">parse_config()</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a88b7c88fed6b80fd18f34f97757dfc04"></a><!-- doxytag: member="res_config_ldap.c::__reg_module" ref="a88b7c88fed6b80fd18f34f97757dfc04" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void __reg_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l01769">1769</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

</div>
</div>
<a class="anchor" id="afeab1257bd17282b95875499393a147a"></a><!-- doxytag: member="res_config_ldap.c::__unreg_module" ref="afeab1257bd17282b95875499393a147a" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void __unreg_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l01769">1769</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

</div>
</div>
<a class="anchor" id="a28fa55daf894a70a398e09f3ce39d3dc"></a><!-- doxytag: member="res_config_ldap.c::append_var_and_value_to_filter" ref="a28fa55daf894a70a398e09f3ce39d3dc" args="(struct ast_str **filter, struct ldap_table_config *table_config, const char *name, const char *value)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void append_var_and_value_to_filter </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__str.html">ast_str</a> **&nbsp;</td>
          <td class="paramname"> <em>filter</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structldap__table__config.html">ldap_table_config</a> *&nbsp;</td>
          <td class="paramname"> <em>table_config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>value</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Append a name=value filter string. The filter string can grow. </p>

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l00686">686</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="strings_8h_source.html#l00846">ast_str_append()</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="res__config__ldap_8c_source.html#l00218">convert_attribute_name_to_ldap()</a>, <a class="el" href="func__strings_8c_source.html#l00821">len()</a>, and <a class="el" href="res__config__ldap_8c_source.html#l00663">replace_string_in_string()</a>.</p>

<p>Referenced by <a class="el" href="res__config__ldap_8c_source.html#l00718">realtime_ldap_base_ap()</a>, <a class="el" href="res__config__ldap_8c_source.html#l01315">update2_ldap()</a>, and <a class="el" href="res__config__ldap_8c_source.html#l01128">update_ldap()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00689"></a>00689 {
<a name="l00690"></a>00690    <span class="keywordtype">char</span> *new_name = NULL;
<a name="l00691"></a>00691    <span class="keywordtype">char</span> *new_value = NULL;
<a name="l00692"></a>00692    <span class="keywordtype">char</span> *like_pos = strstr(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="stringliteral">&quot; LIKE&quot;</span>);
<a name="l00693"></a>00693 
<a name="l00694"></a>00694    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;name=&apos;%s&apos; value=&apos;%s&apos;\n&quot;</span>, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, value);
<a name="l00695"></a>00695 
<a name="l00696"></a>00696    <span class="keywordflow">if</span> (like_pos) {
<a name="l00697"></a>00697       <span class="keywordtype">int</span> <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> = like_pos - <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>;
<a name="l00698"></a>00698       name = new_name = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(name);
<a name="l00699"></a>00699       new_name[len] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00700"></a>00700       value = new_value = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(value);
<a name="l00701"></a>00701       <a class="code" href="res__config__ldap_8c.html#a35abb75797a3e63bcaf26e917fb548fd" title="Replace &amp;lt;search&amp;gt; by &amp;lt;by&amp;gt; in string. No check is done on string allocated...">replace_string_in_string</a>(new_value, <span class="stringliteral">&quot;\\_&quot;</span>, <span class="stringliteral">&quot;_&quot;</span>);
<a name="l00702"></a>00702       <a class="code" href="res__config__ldap_8c.html#a35abb75797a3e63bcaf26e917fb548fd" title="Replace &amp;lt;search&amp;gt; by &amp;lt;by&amp;gt; in string. No check is done on string allocated...">replace_string_in_string</a>(new_value, <span class="stringliteral">&quot;%&quot;</span>, <span class="stringliteral">&quot;*&quot;</span>);
<a name="l00703"></a>00703    }
<a name="l00704"></a>00704 
<a name="l00705"></a>00705    <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a> = <a class="code" href="res__config__ldap_8c.html#a76e2f0e009997a7eae49d0b7e8a16029" title="Convert variable name to ldap attribute name - Should be locked before using it.">convert_attribute_name_to_ldap</a>(table_config, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l00706"></a>00706 
<a name="l00707"></a>00707    <a class="code" href="strings_8h.html#a85cd5a8ef499e39d22b4bfeb8b9a64f7" title="Append to a thread local dynamic string.">ast_str_append</a>(filter, 0, <span class="stringliteral">&quot;(%s=%s)&quot;</span>, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, value);
<a name="l00708"></a>00708 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a39941ba901b2a30cc6d044760545c6c3"></a><!-- doxytag: member="res_config_ldap.c::cleaned_basedn" ref="a39941ba901b2a30cc6d044760545c6c3" args="(struct ast_channel *channel, const char *basedn)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* cleaned_basedn </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>channel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>basedn</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>caller should free returned pointer </p>

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l00636">636</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="func__strings_8c_source.html#l00821">len()</a>, and <a class="el" href="res__config__ldap_8c_source.html#l00621">substituted()</a>.</p>

<p>Referenced by <a class="el" href="res__config__ldap_8c_source.html#l00718">realtime_ldap_base_ap()</a>, <a class="el" href="res__config__ldap_8c_source.html#l01315">update2_ldap()</a>, and <a class="el" href="res__config__ldap_8c_source.html#l01128">update_ldap()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00637"></a>00637 {
<a name="l00638"></a>00638    <span class="keywordtype">char</span> *cbasedn = NULL;
<a name="l00639"></a>00639    <span class="keywordflow">if</span> (basedn) {
<a name="l00640"></a>00640       <span class="keywordtype">char</span> *p = NULL;
<a name="l00641"></a>00641       cbasedn = <a class="code" href="res__config__ldap_8c.html#a0ce420ebc55160125af52208e87b80ca" title="caller should free returned pointer">substituted</a>(channel, basedn);
<a name="l00642"></a>00642       <span class="keywordflow">if</span> (*cbasedn == <span class="charliteral">&apos;&quot;&apos;</span>) {
<a name="l00643"></a>00643          cbasedn++;
<a name="l00644"></a>00644          <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(cbasedn)) {
<a name="l00645"></a>00645             <span class="keywordtype">int</span> <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> = strlen(cbasedn);
<a name="l00646"></a>00646             <span class="keywordflow">if</span> (cbasedn[len - 1] == <span class="charliteral">&apos;&quot;&apos;</span>)
<a name="l00647"></a>00647                cbasedn[len - 1] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00648"></a>00648 
<a name="l00649"></a>00649          }
<a name="l00650"></a>00650       }
<a name="l00651"></a>00651       p = cbasedn;
<a name="l00652"></a>00652       <span class="keywordflow">while</span> (*p) {
<a name="l00653"></a>00653          <span class="keywordflow">if</span> (*p == <span class="charliteral">&apos;|&apos;</span>)
<a name="l00654"></a>00654             *p = <span class="charliteral">&apos;,&apos;</span>;
<a name="l00655"></a>00655          p++;
<a name="l00656"></a>00656       }
<a name="l00657"></a>00657    }
<a name="l00658"></a>00658    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;basedn: &apos;%s&apos; =&gt; &apos;%s&apos; \n&quot;</span>, basedn, cbasedn);
<a name="l00659"></a>00659    <span class="keywordflow">return</span> cbasedn;
<a name="l00660"></a>00660 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a64bed424bd720a8738da11c2e4afa54a"></a><!-- doxytag: member="res_config_ldap.c::compare_categories" ref="a64bed424bd720a8738da11c2e4afa54a" args="(const void *a, const void *b)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int compare_categories </td>
          <td>(</td>
          <td class="paramtype">const void *&nbsp;</td>
          <td class="paramname"> <em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&nbsp;</td>
          <td class="paramname"> <em>b</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Sorting alogrithm for qsort to find the order of the variables <em>a</em> and <em>b</em>. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>a</em>&nbsp;</td><td>pointer to <a class="el" href="structcategory__and__metric.html">category_and_metric</a> struct </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>b</em>&nbsp;</td><td>pointer to <a class="el" href="structcategory__and__metric.html">category_and_metric</a> struct</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>for if b is greater </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>zero for equal </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>1</em>&nbsp;</td><td>if a is greater </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l00987">987</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>References <a class="el" href="res__config__ldap_8c_source.html#l00080">category_and_metric::metric</a>, <a class="el" href="res__config__ldap_8c_source.html#l00079">category_and_metric::name</a>, and <a class="el" href="res__config__ldap_8c_source.html#l00083">category_and_metric::var_metric</a>.</p>

<p>Referenced by <a class="el" href="res__config__ldap_8c_source.html#l01015">config_ldap()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00988"></a>00988 {
<a name="l00989"></a>00989    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structcategory__and__metric.html">category_and_metric</a> *as = a;
<a name="l00990"></a>00990    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structcategory__and__metric.html">category_and_metric</a> *bs = b;
<a name="l00991"></a>00991 
<a name="l00992"></a>00992    <span class="keywordflow">if</span> (as-&gt;<a class="code" href="structcategory__and__metric.html#ab7103c08fa28b20499d3a68a29c7e0a8">metric</a> &lt; bs-&gt;<a class="code" href="structcategory__and__metric.html#ab7103c08fa28b20499d3a68a29c7e0a8">metric</a>)
<a name="l00993"></a>00993       <span class="keywordflow">return</span> -1;
<a name="l00994"></a>00994    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (as-&gt;<a class="code" href="structcategory__and__metric.html#ab7103c08fa28b20499d3a68a29c7e0a8">metric</a> &gt; bs-&gt;<a class="code" href="structcategory__and__metric.html#ab7103c08fa28b20499d3a68a29c7e0a8">metric</a>)
<a name="l00995"></a>00995       <span class="keywordflow">return</span> 1;
<a name="l00996"></a>00996    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (as-&gt;<a class="code" href="structcategory__and__metric.html#ab7103c08fa28b20499d3a68a29c7e0a8">metric</a> == bs-&gt;<a class="code" href="structcategory__and__metric.html#ab7103c08fa28b20499d3a68a29c7e0a8">metric</a> &amp;&amp; strcmp(as-&gt;<a class="code" href="structcategory__and__metric.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, bs-&gt;<a class="code" href="structcategory__and__metric.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>) != 0)
<a name="l00997"></a>00997       <span class="keywordflow">return</span> strcmp(as-&gt;<a class="code" href="structcategory__and__metric.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, bs-&gt;<a class="code" href="structcategory__and__metric.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);
<a name="l00998"></a>00998 
<a name="l00999"></a>00999    <span class="comment">/* if the metric and the category name is the same, we check the variable metric */</span>
<a name="l01000"></a>01000    <span class="keywordflow">if</span> (as-&gt;<a class="code" href="structcategory__and__metric.html#a60bfb3e3b7f7d767d1bb62af4d1c5185">var_metric</a> &lt; bs-&gt;<a class="code" href="structcategory__and__metric.html#a60bfb3e3b7f7d767d1bb62af4d1c5185">var_metric</a>)
<a name="l01001"></a>01001       <span class="keywordflow">return</span> -1;
<a name="l01002"></a>01002    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (as-&gt;<a class="code" href="structcategory__and__metric.html#a60bfb3e3b7f7d767d1bb62af4d1c5185">var_metric</a> &gt; bs-&gt;<a class="code" href="structcategory__and__metric.html#a60bfb3e3b7f7d767d1bb62af4d1c5185">var_metric</a>)
<a name="l01003"></a>01003       <span class="keywordflow">return</span> 1;
<a name="l01004"></a>01004 
<a name="l01005"></a>01005    <span class="keywordflow">return</span> 0;
<a name="l01006"></a>01006 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="acf13f6374254beee15ad80aa65511685"></a><!-- doxytag: member="res_config_ldap.c::config_ldap" ref="acf13f6374254beee15ad80aa65511685" args="(const char *basedn, const char *table_name, const char *file, struct ast_config *cfg, struct ast_flags config_flags, const char *sugg_incl, const char *who_asked)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__config.html">ast_config</a>* config_ldap </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>basedn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>table_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__config.html">ast_config</a> *&nbsp;</td>
          <td class="paramname"> <em>cfg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__flags.html">ast_flags</a>&nbsp;</td>
          <td class="paramname"> <em>config_flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>sugg_incl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>who_asked</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>See Asterisk doc. </p>
<p>This is for Static Realtime (again: I think...)</p>
<p>load the configuration stuff for the .conf files called on a reload </p>

<p><dl class="note"><dt><b>Note:</b></dt><dd>Since the items come back in random order, they need to be sorted first, and since the data could easily exceed stack size, this is allocated from the heap.</dd></dl>
</p>

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l01015">1015</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="config_8c_source.html#l00522">ast_category_append()</a>, <a class="el" href="config_8c_source.html#l00483">ast_category_new()</a>, <a class="el" href="config_8c_source.html#l02031">ast_config_internal_load()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="config_8c_source.html#l00348">ast_variable_append()</a>, <a class="el" href="config_8c_source.html#l00223">ast_variable_new()</a>, <a class="el" href="res__config__ldap_8c_source.html#l00987">compare_categories()</a>, <a class="el" href="astmm_8h_source.html#l00084">free</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="res__config__ldap_8c_source.html#l00080">category_and_metric::metric</a>, <a class="el" href="cdr__adaptive__odbc_8c_source.html#l00053">name</a>, <a class="el" href="res__config__ldap_8c_source.html#l00079">category_and_metric::name</a>, <a class="el" href="res__config__ldap_8c_source.html#l00890">realtime_ldap_base()</a>, <a class="el" href="res__config__ldap_8c_source.html#l00061">RES_CONFIG_LDAP_CONF</a>, <a class="el" href="config_8h_source.html#l00076">ast_variable::value</a>, <a class="el" href="res__config__ldap_8c_source.html#l00083">category_and_metric::var_metric</a>, <a class="el" href="res__config__ldap_8c_source.html#l00081">category_and_metric::variable_name</a>, <a class="el" href="res__config__ldap_8c_source.html#l00138">variable_named()</a>, and <a class="el" href="res__config__ldap_8c_source.html#l00082">category_and_metric::variable_value</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01017"></a>01017 {
<a name="l01018"></a>01018    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> vars_count = 0;
<a name="l01019"></a>01019    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> **vars;
<a name="l01020"></a>01020    <span class="keywordtype">int</span> i = 0;
<a name="l01021"></a>01021    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *new_v = NULL;
<a name="l01022"></a>01022    <span class="keyword">struct </span><a class="code" href="structast__category.html">ast_category</a> *cur_cat = NULL;
<a name="l01023"></a>01023    <span class="keyword">const</span> <span class="keywordtype">char</span> *last_category = NULL;
<a name="l01024"></a>01024    <span class="keywordtype">int</span> last_category_metric = 0;
<a name="l01025"></a>01025    <span class="keyword">struct </span><a class="code" href="structcategory__and__metric.html">category_and_metric</a> *categories;
<a name="l01026"></a>01026    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> **p;
<a name="l01027"></a>01027 
<a name="l01028"></a>01028    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="structast__variable.html#adf16cd437526a5c5e0e0af87745acbb8">file</a>) || !strcasecmp(<a class="code" href="structast__variable.html#adf16cd437526a5c5e0e0af87745acbb8">file</a>, <a class="code" href="res__config__ldap_8c.html#af925dc82fd1722062dc8e2ff0f7aac61">RES_CONFIG_LDAP_CONF</a>)) {
<a name="l01029"></a>01029       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Cannot configure myself.\n&quot;</span>);
<a name="l01030"></a>01030       <span class="keywordflow">return</span> NULL;
<a name="l01031"></a>01031    }
<a name="l01032"></a>01032 
<a name="l01033"></a>01033    vars = <a class="code" href="res__config__ldap_8c.html#a4c05d455f43aac9094ec3f01d52af8c2" title="same as realtime_ldap_base_ap but take variable arguments count list">realtime_ldap_base</a>(&amp;vars_count, basedn, table_name, <span class="stringliteral">&quot;filename&quot;</span>,
<a name="l01034"></a>01034             <a class="code" href="structast__variable.html#adf16cd437526a5c5e0e0af87745acbb8">file</a>, <span class="stringliteral">&quot;commented&quot;</span>, <span class="stringliteral">&quot;FALSE&quot;</span>, NULL);
<a name="l01035"></a>01035 
<a name="l01036"></a>01036    <span class="keywordflow">if</span> (!vars) {
<a name="l01037"></a>01037       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not find config &apos;%s&apos; in database.\n&quot;</span>, <a class="code" href="structast__variable.html#adf16cd437526a5c5e0e0af87745acbb8">file</a>);
<a name="l01038"></a>01038       <span class="keywordflow">return</span> NULL;
<a name="l01039"></a>01039    }
<a name="l01040"></a>01040 <span class="comment"></span>
<a name="l01041"></a>01041 <span class="comment">   /*!\note Since the items come back in random order, they need to be sorted</span>
<a name="l01042"></a>01042 <span class="comment">    * first, and since the data could easily exceed stack size, this is</span>
<a name="l01043"></a>01043 <span class="comment">    * allocated from the heap.</span>
<a name="l01044"></a>01044 <span class="comment">    */</span>
<a name="l01045"></a>01045    <span class="keywordflow">if</span> (!(categories = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(<span class="keyword">sizeof</span>(*categories), vars_count)))
<a name="l01046"></a>01046       <span class="keywordflow">return</span> NULL;
<a name="l01047"></a>01047 
<a name="l01048"></a>01048    <span class="keywordflow">for</span> (vars_count = 0, p = vars; *p; p++) {
<a name="l01049"></a>01049       <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *category = <a class="code" href="res__config__ldap_8c.html#a9614b129f70fd9cfbaaf78b6d64b3b16" title="Find variable by name.">variable_named</a>(*p, <span class="stringliteral">&quot;category&quot;</span>);
<a name="l01050"></a>01050       <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *cat_metric = <a class="code" href="res__config__ldap_8c.html#a9614b129f70fd9cfbaaf78b6d64b3b16" title="Find variable by name.">variable_named</a>(*p, <span class="stringliteral">&quot;cat_metric&quot;</span>);
<a name="l01051"></a>01051       <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *var_name = <a class="code" href="res__config__ldap_8c.html#a9614b129f70fd9cfbaaf78b6d64b3b16" title="Find variable by name.">variable_named</a>(*p, <span class="stringliteral">&quot;variable_name&quot;</span>);
<a name="l01052"></a>01052       <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *var_val = <a class="code" href="res__config__ldap_8c.html#a9614b129f70fd9cfbaaf78b6d64b3b16" title="Find variable by name.">variable_named</a>(*p, <span class="stringliteral">&quot;variable_value&quot;</span>);
<a name="l01053"></a>01053       <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *var_metric = <a class="code" href="res__config__ldap_8c.html#a9614b129f70fd9cfbaaf78b6d64b3b16" title="Find variable by name.">variable_named</a>(*p, <span class="stringliteral">&quot;var_metric&quot;</span>);
<a name="l01054"></a>01054       <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *dn = <a class="code" href="res__config__ldap_8c.html#a9614b129f70fd9cfbaaf78b6d64b3b16" title="Find variable by name.">variable_named</a>(*p, <span class="stringliteral">&quot;dn&quot;</span>);
<a name="l01055"></a>01055          
<a name="l01056"></a>01056       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;category: %s\n&quot;</span>, category-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l01057"></a>01057       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;var_name: %s\n&quot;</span>, var_name-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l01058"></a>01058       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;var_val: %s\n&quot;</span>, var_val-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l01059"></a>01059       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;cat_metric: %s\n&quot;</span>, cat_metric-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l01060"></a>01060 
<a name="l01061"></a>01061       <span class="keywordflow">if</span> (!category) {
<a name="l01062"></a>01062          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,
<a name="l01063"></a>01063                <span class="stringliteral">&quot;No category name in entry &apos;%s&apos;  for file &apos;%s&apos;.\n&quot;</span>,
<a name="l01064"></a>01064                (dn ? dn-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a> : <span class="stringliteral">&quot;?&quot;</span>), <a class="code" href="structast__variable.html#adf16cd437526a5c5e0e0af87745acbb8">file</a>);
<a name="l01065"></a>01065       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!cat_metric) {
<a name="l01066"></a>01066          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,
<a name="l01067"></a>01067                <span class="stringliteral">&quot;No category metric in entry &apos;%s&apos;(category: %s) for file &apos;%s&apos;.\n&quot;</span>,
<a name="l01068"></a>01068                (dn ? dn-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a> : <span class="stringliteral">&quot;?&quot;</span>), category-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <a class="code" href="structast__variable.html#adf16cd437526a5c5e0e0af87745acbb8">file</a>);
<a name="l01069"></a>01069       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!var_metric) {
<a name="l01070"></a>01070          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,
<a name="l01071"></a>01071                <span class="stringliteral">&quot;No variable metric in entry &apos;%s&apos;(category: %s) for file &apos;%s&apos;.\n&quot;</span>,
<a name="l01072"></a>01072                (dn ? dn-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a> : <span class="stringliteral">&quot;?&quot;</span>), category-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <a class="code" href="structast__variable.html#adf16cd437526a5c5e0e0af87745acbb8">file</a>);
<a name="l01073"></a>01073       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!var_name) {
<a name="l01074"></a>01074          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,
<a name="l01075"></a>01075                <span class="stringliteral">&quot;No variable name in entry &apos;%s&apos; (category: %s metric: %s) for file &apos;%s&apos;.\n&quot;</span>,
<a name="l01076"></a>01076                (dn ? dn-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a> : <span class="stringliteral">&quot;?&quot;</span>), category-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>,
<a name="l01077"></a>01077                cat_metric-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <a class="code" href="structast__variable.html#adf16cd437526a5c5e0e0af87745acbb8">file</a>);
<a name="l01078"></a>01078       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!var_val) {
<a name="l01079"></a>01079          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,
<a name="l01080"></a>01080                <span class="stringliteral">&quot;No variable value in entry &apos;%s&apos; (category: %s metric: %s variable: %s) for file &apos;%s&apos;.\n&quot;</span>,
<a name="l01081"></a>01081                (dn ? dn-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a> : <span class="stringliteral">&quot;?&quot;</span>), category-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>,
<a name="l01082"></a>01082                cat_metric-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, var_name-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <a class="code" href="structast__variable.html#adf16cd437526a5c5e0e0af87745acbb8">file</a>);
<a name="l01083"></a>01083       } <span class="keywordflow">else</span> {
<a name="l01084"></a>01084          categories[vars_count].<a class="code" href="structcategory__and__metric.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = category-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>;
<a name="l01085"></a>01085          categories[vars_count].<a class="code" href="structcategory__and__metric.html#ab7103c08fa28b20499d3a68a29c7e0a8">metric</a> = atoi(cat_metric-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l01086"></a>01086          categories[vars_count].<a class="code" href="structcategory__and__metric.html#ad64b9c44d2f0c258e7ae44062726d44f">variable_name</a> = var_name-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>;
<a name="l01087"></a>01087          categories[vars_count].<a class="code" href="structcategory__and__metric.html#aa7d8cfb2d819f417470adfbbf5e2c5e6">variable_value</a> = var_val-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>;
<a name="l01088"></a>01088          categories[vars_count].<a class="code" href="structcategory__and__metric.html#a60bfb3e3b7f7d767d1bb62af4d1c5185">var_metric</a> = atoi(var_metric-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l01089"></a>01089          vars_count++;
<a name="l01090"></a>01090       }
<a name="l01091"></a>01091    }
<a name="l01092"></a>01092 
<a name="l01093"></a>01093    qsort(categories, vars_count, <span class="keyword">sizeof</span>(*categories), <a class="code" href="res__config__ldap_8c.html#a64bed424bd720a8738da11c2e4afa54a" title="Sorting alogrithm for qsort to find the order of the variables a and b.">compare_categories</a>);
<a name="l01094"></a>01094 
<a name="l01095"></a>01095    <span class="keywordflow">for</span> (i = 0; i &lt; vars_count; i++) {
<a name="l01096"></a>01096       <span class="keywordflow">if</span> (!strcmp(categories[i].variable_name, <span class="stringliteral">&quot;#include&quot;</span>)) {
<a name="l01097"></a>01097          <span class="keyword">struct </span><a class="code" href="structast__flags.html" title="Structure used to handle boolean flags.">ast_flags</a> <a class="code" href="structast__flags.html#ac92588540e8c1d014a08cd8a45462b19">flags</a> = { 0 };
<a name="l01098"></a>01098          <span class="keywordflow">if</span> (!<a class="code" href="config_8h.html#a721d5cd60abda2bdd96838336dc09669">ast_config_internal_load</a>(categories[i].variable_value, cfg, flags, <span class="stringliteral">&quot;&quot;</span>, who_asked))
<a name="l01099"></a>01099             <span class="keywordflow">break</span>;
<a name="l01100"></a>01100          <span class="keywordflow">continue</span>;
<a name="l01101"></a>01101       }
<a name="l01102"></a>01102 
<a name="l01103"></a>01103       <span class="keywordflow">if</span> (!last_category || strcmp(last_category, categories[i].<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>) ||
<a name="l01104"></a>01104          last_category_metric != categories[i].metric) {
<a name="l01105"></a>01105          cur_cat = <a class="code" href="config_8h.html#affebac76d69639677b677037d9871e29" title="Create a category structure.">ast_category_new</a>(categories[i].name, table_name, -1);
<a name="l01106"></a>01106          <span class="keywordflow">if</span> (!cur_cat)
<a name="l01107"></a>01107             <span class="keywordflow">break</span>;
<a name="l01108"></a>01108          last_category = categories[i].<a class="code" href="structcategory__and__metric.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>;
<a name="l01109"></a>01109          last_category_metric = categories[i].<a class="code" href="structcategory__and__metric.html#ab7103c08fa28b20499d3a68a29c7e0a8">metric</a>;
<a name="l01110"></a>01110          <a class="code" href="config_8h.html#ab7b56ec66b058952423f313752c734e7">ast_category_append</a>(cfg, cur_cat);
<a name="l01111"></a>01111       }
<a name="l01112"></a>01112 
<a name="l01113"></a>01113       <span class="keywordflow">if</span> (!(new_v = <a class="code" href="config_8h.html#a08e94d96f459e7301a74daf32035423b">ast_variable_new</a>(categories[i].variable_name, categories[i].variable_value, table_name)))
<a name="l01114"></a>01114          <span class="keywordflow">break</span>;
<a name="l01115"></a>01115 
<a name="l01116"></a>01116       <a class="code" href="config_8h.html#a132ddbd39dd9d26395c410f7647f76db">ast_variable_append</a>(cur_cat, new_v);
<a name="l01117"></a>01117    }
<a name="l01118"></a>01118 
<a name="l01119"></a>01119    <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(vars);
<a name="l01120"></a>01120    <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(categories);
<a name="l01121"></a>01121 
<a name="l01122"></a>01122    <span class="keywordflow">return</span> cfg;
<a name="l01123"></a>01123 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a52dda9a11e8f46e1b735dad87d03f2cd"></a><!-- doxytag: member="res_config_ldap.c::convert_attribute_name_from_ldap" ref="a52dda9a11e8f46e1b735dad87d03f2cd" args="(struct ldap_table_config *table_config, const char *attribute_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static const char* convert_attribute_name_from_ldap </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structldap__table__config.html">ldap_table_config</a> *&nbsp;</td>
          <td class="paramname"> <em>table_config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>attribute_name</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Convert ldap attribute name to variable name - Should be locked before using it. </p>

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l00241">241</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="res__config__ldap_8c_source.html#l00090">ldap_table_config::attributes</a>, <a class="el" href="res__config__ldap_8c_source.html#l00098">base_table_config</a>, <a class="el" href="config_8h_source.html#l00075">ast_variable::name</a>, <a class="el" href="config_8h_source.html#l00077">ast_variable::next</a>, and <a class="el" href="config_8h_source.html#l00076">ast_variable::value</a>.</p>

<p>Referenced by <a class="el" href="res__config__ldap_8c_source.html#l00266">realtime_ldap_entry_to_var()</a>, and <a class="el" href="res__config__ldap_8c_source.html#l00349">realtime_ldap_result_to_vars()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00243"></a>00243 {
<a name="l00244"></a>00244    <span class="keywordtype">int</span> i = 0;
<a name="l00245"></a>00245    <span class="keyword">struct </span><a class="code" href="structldap__table__config.html" title="Table configuration.">ldap_table_config</a> *configs[] = { table_config, <a class="code" href="res__config__ldap_8c.html#a3c846177aac9c60160bea626fbc3225d">base_table_config</a> };
<a name="l00246"></a>00246 
<a name="l00247"></a>00247    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(configs); i++) {
<a name="l00248"></a>00248       <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *attribute;
<a name="l00249"></a>00249 
<a name="l00250"></a>00250       <span class="keywordflow">if</span> (!configs[i])
<a name="l00251"></a>00251          <span class="keywordflow">continue</span>;
<a name="l00252"></a>00252 
<a name="l00253"></a>00253       attribute = configs[i]-&gt;<a class="code" href="structldap__table__config.html#a4018e41e295dac80f9fad6ca95ec3a0d">attributes</a>;
<a name="l00254"></a>00254       <span class="keywordflow">for</span> (; attribute; attribute = attribute-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l00255"></a>00255          <span class="keywordflow">if</span> (strcasecmp(attribute_name, attribute-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>) == 0)
<a name="l00256"></a>00256             <span class="keywordflow">return</span> attribute-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>;
<a name="l00257"></a>00257       }
<a name="l00258"></a>00258    }
<a name="l00259"></a>00259 
<a name="l00260"></a>00260    <span class="keywordflow">return</span> attribute_name;
<a name="l00261"></a>00261 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a76e2f0e009997a7eae49d0b7e8a16029"></a><!-- doxytag: member="res_config_ldap.c::convert_attribute_name_to_ldap" ref="a76e2f0e009997a7eae49d0b7e8a16029" args="(struct ldap_table_config *table_config, const char *attribute_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static const char* convert_attribute_name_to_ldap </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structldap__table__config.html">ldap_table_config</a> *&nbsp;</td>
          <td class="paramname"> <em>table_config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>attribute_name</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Convert variable name to ldap attribute name - Should be locked before using it. </p>

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l00218">218</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="res__config__ldap_8c_source.html#l00090">ldap_table_config::attributes</a>, <a class="el" href="res__config__ldap_8c_source.html#l00098">base_table_config</a>, <a class="el" href="config_8h_source.html#l00075">ast_variable::name</a>, <a class="el" href="config_8h_source.html#l00077">ast_variable::next</a>, and <a class="el" href="config_8h_source.html#l00076">ast_variable::value</a>.</p>

<p>Referenced by <a class="el" href="res__config__ldap_8c_source.html#l00686">append_var_and_value_to_filter()</a>, <a class="el" href="res__config__ldap_8c_source.html#l01315">update2_ldap()</a>, and <a class="el" href="res__config__ldap_8c_source.html#l01128">update_ldap()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00220"></a>00220 {
<a name="l00221"></a>00221    <span class="keywordtype">int</span> i = 0;
<a name="l00222"></a>00222    <span class="keyword">struct </span><a class="code" href="structldap__table__config.html" title="Table configuration.">ldap_table_config</a> *configs[] = { table_config, <a class="code" href="res__config__ldap_8c.html#a3c846177aac9c60160bea626fbc3225d">base_table_config</a> };
<a name="l00223"></a>00223 
<a name="l00224"></a>00224    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(configs); i++) {
<a name="l00225"></a>00225       <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *attribute;
<a name="l00226"></a>00226 
<a name="l00227"></a>00227       <span class="keywordflow">if</span> (!configs[i])
<a name="l00228"></a>00228          <span class="keywordflow">continue</span>;
<a name="l00229"></a>00229 
<a name="l00230"></a>00230       attribute = configs[i]-&gt;<a class="code" href="structldap__table__config.html#a4018e41e295dac80f9fad6ca95ec3a0d">attributes</a>;
<a name="l00231"></a>00231       <span class="keywordflow">for</span> (; attribute; attribute = attribute-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l00232"></a>00232          <span class="keywordflow">if</span> (!strcasecmp(attribute_name, attribute-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>))
<a name="l00233"></a>00233             <span class="keywordflow">return</span> attribute-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>;
<a name="l00234"></a>00234       }
<a name="l00235"></a>00235    }
<a name="l00236"></a>00236 
<a name="l00237"></a>00237    <span class="keywordflow">return</span> attribute_name;
<a name="l00238"></a>00238 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a860e11270a1778347d12df4841bf7819"></a><!-- doxytag: member="res_config_ldap.c::is_ldap_connect_error" ref="a860e11270a1778347d12df4841bf7819" args="(int err)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int is_ldap_connect_error </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>err</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l00535">535</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>Referenced by <a class="el" href="res__config__ldap_8c_source.html#l00544">ldap_loadentry()</a>, <a class="el" href="res__config__ldap_8c_source.html#l00718">realtime_ldap_base_ap()</a>, <a class="el" href="res__config__ldap_8c_source.html#l01315">update2_ldap()</a>, and <a class="el" href="res__config__ldap_8c_source.html#l01128">update_ldap()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00536"></a>00536 {
<a name="l00537"></a>00537    <span class="keywordflow">return</span> (err == LDAP_SERVER_DOWN
<a name="l00538"></a>00538          || err == LDAP_TIMEOUT || err == LDAP_CONNECT_ERROR);
<a name="l00539"></a>00539 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6ec80581ef03e58f2c4cdf842dbad775"></a><!-- doxytag: member="res_config_ldap.c::ldap_loadentry" ref="a6ec80581ef03e58f2c4cdf842dbad775" args="(struct ldap_table_config *table_config, const char *dn)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__variable.html">ast_variable</a>* ldap_loadentry </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structldap__table__config.html">ldap_table_config</a> *&nbsp;</td>
          <td class="paramname"> <em>table_config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>dn</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get LDAP entry by dn and return attributes as variables - Should be locked before using it This is used for setting the default <a class="el" href="structvalues.html">values</a> of an object(i.e., with accountBaseDN). </p>

<p><p>&lt; not using this </p>
</p>

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l00544">544</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="astmm_8h_source.html#l00093">ast_realloc</a>, <a class="el" href="config_8c_source.html#l00397">ast_variables_destroy()</a>, <a class="el" href="res__config__ldap_8c_source.html#l00535">is_ldap_connect_error()</a>, <a class="el" href="res__config__ldap_8c_source.html#l00064">ldap_lock</a>, <a class="el" href="res__config__ldap_8c_source.html#l01670">ldap_reconnect()</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="res__config__ldap_8c_source.html#l00349">realtime_ldap_result_to_vars()</a>, and <a class="el" href="ast__expr2f_8c_source.html#l00613">var</a>.</p>

<p>Referenced by <a class="el" href="res__config__ldap_8c_source.html#l00718">realtime_ldap_base_ap()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00546"></a>00546 {
<a name="l00547"></a>00547    <span class="keywordflow">if</span> (!table_config) {
<a name="l00548"></a>00548       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;No table config\n&quot;</span>);
<a name="l00549"></a>00549       <span class="keywordflow">return</span> NULL;
<a name="l00550"></a>00550    } <span class="keywordflow">else</span> {
<a name="l00551"></a>00551       <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> **vars = NULL;
<a name="l00552"></a>00552       <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a> = NULL;
<a name="l00553"></a>00553       <span class="keywordtype">int</span> result = -1;
<a name="l00554"></a>00554       LDAPMessage *ldap_result_msg = NULL;
<a name="l00555"></a>00555       <span class="keywordtype">int</span> tries = 0;
<a name="l00556"></a>00556 
<a name="l00557"></a>00557       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;ldap_loadentry dn=%s\n&quot;</span>, dn);
<a name="l00558"></a>00558 
<a name="l00559"></a>00559       <span class="keywordflow">do</span> {
<a name="l00560"></a>00560          result = ldap_search_ext_s(<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>, dn, LDAP_SCOPE_BASE,
<a name="l00561"></a>00561                   <span class="stringliteral">&quot;(objectclass=*)&quot;</span>, NULL, 0, NULL, NULL, NULL, LDAP_NO_LIMIT, &amp;ldap_result_msg);
<a name="l00562"></a>00562          <span class="keywordflow">if</span> (result != LDAP_SUCCESS &amp;&amp; <a class="code" href="res__config__ldap_8c.html#a860e11270a1778347d12df4841bf7819">is_ldap_connect_error</a>(result)) {
<a name="l00563"></a>00563             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,
<a name="l00564"></a>00564                <span class="stringliteral">&quot;Failed to query database. Try %d/3\n&quot;</span>,
<a name="l00565"></a>00565                tries + 1);
<a name="l00566"></a>00566             tries++;
<a name="l00567"></a>00567             <span class="keywordflow">if</span> (tries &lt; 3) {
<a name="l00568"></a>00568                usleep(500000L * tries);
<a name="l00569"></a>00569                <span class="keywordflow">if</span> (<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>) {
<a name="l00570"></a>00570                   ldap_unbind_ext_s(<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>, NULL, NULL);
<a name="l00571"></a>00571                   <a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a> = NULL;
<a name="l00572"></a>00572                }
<a name="l00573"></a>00573                <span class="keywordflow">if</span> (!<a class="code" href="res__config__ldap_8c.html#a77f9d4c9f33d2f29e98c5c8cc09e9119">ldap_reconnect</a>())
<a name="l00574"></a>00574                   <span class="keywordflow">break</span>;
<a name="l00575"></a>00575             }
<a name="l00576"></a>00576          }
<a name="l00577"></a>00577       } <span class="keywordflow">while</span> (result != LDAP_SUCCESS &amp;&amp; tries &lt; 3 &amp;&amp; <a class="code" href="res__config__ldap_8c.html#a860e11270a1778347d12df4841bf7819">is_ldap_connect_error</a>(result));
<a name="l00578"></a>00578 
<a name="l00579"></a>00579       <span class="keywordflow">if</span> (result != LDAP_SUCCESS) {
<a name="l00580"></a>00580          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,
<a name="l00581"></a>00581                <span class="stringliteral">&quot;Failed to query database. Check debug for more info.\n&quot;</span>);
<a name="l00582"></a>00582          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;dn=%s\n&quot;</span>, dn);
<a name="l00583"></a>00583          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;Query Failed because: %s\n&quot;</span>,
<a name="l00584"></a>00584             ldap_err2string(result));
<a name="l00585"></a>00585          <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="res__config__ldap_8c.html#a55f48ee8d8b928c4d52e3d2182a17091">ldap_lock</a>);
<a name="l00586"></a>00586          <span class="keywordflow">return</span> NULL;
<a name="l00587"></a>00587       } <span class="keywordflow">else</span> {
<a name="l00588"></a>00588          <span class="keywordtype">int</span> num_entry = 0;
<a name="l00589"></a>00589          <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *entries_count_ptr = NULL; <span class="comment">/*!&lt; not using this */</span>
<a name="l00590"></a>00590          <span class="keywordflow">if</span> ((num_entry = ldap_count_entries(<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>, ldap_result_msg)) &gt; 0) {
<a name="l00591"></a>00591             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(3, <span class="stringliteral">&quot;num_entry: %d\n&quot;</span>, num_entry);
<a name="l00592"></a>00592 
<a name="l00593"></a>00593             vars = <a class="code" href="res__config__ldap_8c.html#a70f8af371712c0c864197041a9bbd876" title="Get variables from ldap entry attributes - Should be locked before using it.">realtime_ldap_result_to_vars</a>(table_config, ldap_result_msg, entries_count_ptr);
<a name="l00594"></a>00594             <span class="keywordflow">if</span> (num_entry &gt; 1)
<a name="l00595"></a>00595                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;More than one entry for dn=%s. Take only 1st one\n&quot;</span>, dn);
<a name="l00596"></a>00596          } <span class="keywordflow">else</span> {
<a name="l00597"></a>00597             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;Could not find any entry dn=%s.\n&quot;</span>, dn);
<a name="l00598"></a>00598          }
<a name="l00599"></a>00599       }
<a name="l00600"></a>00600       ldap_msgfree(ldap_result_msg);
<a name="l00601"></a>00601 
<a name="l00602"></a>00602       <span class="comment">/* Chopping \a vars down to one variable */</span>
<a name="l00603"></a>00603       <span class="keywordflow">if</span> (vars != NULL) {
<a name="l00604"></a>00604          <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> **p = vars;
<a name="l00605"></a>00605          p++;
<a name="l00606"></a>00606          var = *p;
<a name="l00607"></a>00607          <span class="keywordflow">while</span> (var) {
<a name="l00608"></a>00608             <a class="code" href="config_8h.html#ad3d8122172af6f13687a07840411d65d" title="Free variable list.">ast_variables_destroy</a>(var);
<a name="l00609"></a>00609             p++;
<a name="l00610"></a>00610          }
<a name="l00611"></a>00611          vars = <a class="code" href="astmm_8h.html#aa852314efa0cfeecee97ffc51b649734">ast_realloc</a>(vars, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *));
<a name="l00612"></a>00612       }
<a name="l00613"></a>00613 
<a name="l00614"></a>00614       var = *vars;
<a name="l00615"></a>00615 
<a name="l00616"></a>00616       <span class="keywordflow">return</span> var;
<a name="l00617"></a>00617    }
<a name="l00618"></a>00618 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a77f9d4c9f33d2f29e98c5c8cc09e9119"></a><!-- doxytag: member="res_config_ldap.c::ldap_reconnect" ref="a77f9d4c9f33d2f29e98c5c8cc09e9119" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int ldap_reconnect </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl class="note"><dt><b>Note:</b></dt><dd>ldap_lock should have been locked before calling this function. </dd></dl>

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l01670">1670</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, and <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>.</p>

<p>Referenced by <a class="el" href="res__config__ldap_8c_source.html#l00544">ldap_loadentry()</a>, <a class="el" href="res__config__ldap_8c_source.html#l01508">load_module()</a>, <a class="el" href="res__config__ldap_8c_source.html#l00718">realtime_ldap_base_ap()</a>, <a class="el" href="res__config__ldap_8c_source.html#l01550">reload()</a>, <a class="el" href="res__config__ldap_8c_source.html#l01315">update2_ldap()</a>, and <a class="el" href="res__config__ldap_8c_source.html#l01128">update_ldap()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01671"></a>01671 {
<a name="l01672"></a>01672    <span class="keywordtype">int</span> bind_result = 0;
<a name="l01673"></a>01673    <span class="keyword">struct </span>berval cred;
<a name="l01674"></a>01674 
<a name="l01675"></a>01675    <span class="keywordflow">if</span> (<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>) {
<a name="l01676"></a>01676       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;Everything seems fine.\n&quot;</span>);
<a name="l01677"></a>01677       <span class="keywordflow">return</span> 1;
<a name="l01678"></a>01678    }
<a name="l01679"></a>01679 
<a name="l01680"></a>01680    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="res__config__ldap_8c.html#a75e4590043edf35241d30fabe2eda546">url</a>)) {
<a name="l01681"></a>01681       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Not enough parameters to connect to ldap database\n&quot;</span>);
<a name="l01682"></a>01682       <span class="keywordflow">return</span> 0;
<a name="l01683"></a>01683    }
<a name="l01684"></a>01684 
<a name="l01685"></a>01685    <span class="keywordflow">if</span> (LDAP_SUCCESS != ldap_initialize(&amp;<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>, <a class="code" href="res__config__ldap_8c.html#a75e4590043edf35241d30fabe2eda546">url</a>)) {
<a name="l01686"></a>01686       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to init ldap connection to &apos;%s&apos;. Check debug for more info.\n&quot;</span>, <a class="code" href="res__config__ldap_8c.html#a75e4590043edf35241d30fabe2eda546">url</a>);
<a name="l01687"></a>01687       <span class="keywordflow">return</span> 0;
<a name="l01688"></a>01688    }
<a name="l01689"></a>01689 
<a name="l01690"></a>01690    <span class="keywordflow">if</span> (LDAP_OPT_SUCCESS != ldap_set_option(<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>, LDAP_OPT_PROTOCOL_VERSION, &amp;<a class="code" href="res__config__ldap_8c.html#aad880fc4455c253781e8968f2239d56f">version</a>)) {
<a name="l01691"></a>01691       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to set LDAP protocol version to %d, falling back to default.\n&quot;</span>, <a class="code" href="res__config__ldap_8c.html#aad880fc4455c253781e8968f2239d56f">version</a>);
<a name="l01692"></a>01692    }
<a name="l01693"></a>01693 
<a name="l01694"></a>01694    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="structuser.html" title="structure to hold users read from users.conf">user</a>)) {
<a name="l01695"></a>01695       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;bind to &apos;%s&apos; as user &apos;%s&apos;\n&quot;</span>, <a class="code" href="res__config__ldap_8c.html#a75e4590043edf35241d30fabe2eda546">url</a>, <a class="code" href="structuser.html" title="structure to hold users read from users.conf">user</a>);
<a name="l01696"></a>01696       cred.bv_val = (<span class="keywordtype">char</span> *) <a class="code" href="res__config__ldap_8c.html#a68433c52f2199bd92a3c151b295de06e">pass</a>;
<a name="l01697"></a>01697       cred.bv_len = strlen(<a class="code" href="res__config__ldap_8c.html#a68433c52f2199bd92a3c151b295de06e">pass</a>);
<a name="l01698"></a>01698       bind_result = ldap_sasl_bind_s(<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>, <a class="code" href="structuser.html" title="structure to hold users read from users.conf">user</a>, LDAP_SASL_SIMPLE, &amp;cred, NULL, NULL, NULL);
<a name="l01699"></a>01699    } <span class="keywordflow">else</span> {
<a name="l01700"></a>01700       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;bind %s anonymously\n&quot;</span>, <a class="code" href="res__config__ldap_8c.html#a75e4590043edf35241d30fabe2eda546">url</a>);
<a name="l01701"></a>01701       cred.bv_val = NULL;
<a name="l01702"></a>01702       cred.bv_len = 0;
<a name="l01703"></a>01703       bind_result = ldap_sasl_bind_s(<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>, NULL, LDAP_SASL_SIMPLE, &amp;cred, NULL, NULL, NULL);
<a name="l01704"></a>01704    }
<a name="l01705"></a>01705    <span class="keywordflow">if</span> (bind_result == LDAP_SUCCESS) {
<a name="l01706"></a>01706       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;Successfully connected to database.\n&quot;</span>);
<a name="l01707"></a>01707       <a class="code" href="res__config__ldap_8c.html#ac4ae24c7b766713b82921c04d1a4b699">connect_time</a> = time(NULL);
<a name="l01708"></a>01708       <span class="keywordflow">return</span> 1;
<a name="l01709"></a>01709    } <span class="keywordflow">else</span> {
<a name="l01710"></a>01710       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;bind failed: %s\n&quot;</span>, ldap_err2string(bind_result));
<a name="l01711"></a>01711       ldap_unbind_ext_s(<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>, NULL, NULL);
<a name="l01712"></a>01712       <a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a> = NULL;
<a name="l01713"></a>01713       <span class="keywordflow">return</span> 0;
<a name="l01714"></a>01714    }
<a name="l01715"></a>01715 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad096b7ca5e5115c828fb827c207e4770"></a><!-- doxytag: member="res_config_ldap.c::ldap_table_config_add_attribute" ref="ad096b7ca5e5115c828fb827c207e4770" args="(struct ldap_table_config *table_config, const char *attribute_name, const char *attribute_value)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void ldap_table_config_add_attribute </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structldap__table__config.html">ldap_table_config</a> *&nbsp;</td>
          <td class="paramname"> <em>table_config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>attribute_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>attribute_value</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>add attribute to table config - Should be locked before using it </p>

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l00181">181</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>References <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="config_8c_source.html#l00223">ast_variable_new()</a>, <a class="el" href="res__config__ldap_8c_source.html#l00090">ldap_table_config::attributes</a>, <a class="el" href="config_8h_source.html#l00077">ast_variable::next</a>, <a class="el" href="res__config__ldap_8c_source.html#l00088">ldap_table_config::table_name</a>, and <a class="el" href="ast__expr2f_8c_source.html#l00613">var</a>.</p>

<p>Referenced by <a class="el" href="res__config__ldap_8c_source.html#l01577">parse_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00183"></a>00183 {
<a name="l00184"></a>00184    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>;
<a name="l00185"></a>00185 
<a name="l00186"></a>00186    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(attribute_name) || <a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(attribute_value))
<a name="l00187"></a>00187       <span class="keywordflow">return</span>;
<a name="l00188"></a>00188 
<a name="l00189"></a>00189    <span class="keywordflow">if</span> (!(var = <a class="code" href="config_8h.html#a08e94d96f459e7301a74daf32035423b">ast_variable_new</a>(attribute_name, attribute_value, table_config-&gt;<a class="code" href="structldap__table__config.html#ab013af67ba953d509575c86d9e65da44">table_name</a>)))
<a name="l00190"></a>00190       <span class="keywordflow">return</span>;
<a name="l00191"></a>00191 
<a name="l00192"></a>00192    <span class="keywordflow">if</span> (table_config-&gt;<a class="code" href="structldap__table__config.html#a4018e41e295dac80f9fad6ca95ec3a0d">attributes</a>)
<a name="l00193"></a>00193       var-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a> = table_config-&gt;<a class="code" href="structldap__table__config.html#a4018e41e295dac80f9fad6ca95ec3a0d">attributes</a>;
<a name="l00194"></a>00194    table_config-&gt;<a class="code" href="structldap__table__config.html#a4018e41e295dac80f9fad6ca95ec3a0d">attributes</a> = var;
<a name="l00195"></a>00195 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac3382bf6da54c56b37069bd76bbdf4f9"></a><!-- doxytag: member="res_config_ldap.c::load_module" ref="ac3382bf6da54c56b37069bd76bbdf4f9" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int load_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l01508">1508</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="cli_8c_source.html#l01927">ast_cli_register_multiple()</a>, <a class="el" href="config_8c_source.html#l01950">ast_config_engine_register()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="res__config__ldap_8c_source.html#l00101">ldap_cli</a>, <a class="el" href="res__config__ldap_8c_source.html#l01499">ldap_engine</a>, <a class="el" href="res__config__ldap_8c_source.html#l00064">ldap_lock</a>, <a class="el" href="res__config__ldap_8c_source.html#l01670">ldap_reconnect()</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, and <a class="el" href="res__config__ldap_8c_source.html#l01577">parse_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01509"></a>01509 {
<a name="l01510"></a>01510    <span class="keywordflow">if</span> (<a class="code" href="res__config__ldap_8c.html#af9f24c4cf29126b1832517b188aeb585">parse_config</a>() &lt; 0) {
<a name="l01511"></a>01511       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Cannot load LDAP RealTime driver.\n&quot;</span>);
<a name="l01512"></a>01512       <span class="keywordflow">return</span> 0;
<a name="l01513"></a>01513    }
<a name="l01514"></a>01514 
<a name="l01515"></a>01515    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;<a class="code" href="res__config__ldap_8c.html#a55f48ee8d8b928c4d52e3d2182a17091">ldap_lock</a>);
<a name="l01516"></a>01516 
<a name="l01517"></a>01517    <span class="keywordflow">if</span> (!<a class="code" href="res__config__ldap_8c.html#a77f9d4c9f33d2f29e98c5c8cc09e9119">ldap_reconnect</a>()) 
<a name="l01518"></a>01518       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Couldn&apos;t establish connection. Check debug.\n&quot;</span>);
<a name="l01519"></a>01519 
<a name="l01520"></a>01520    <a class="code" href="config_8h.html#af15c271e1708b251fc938b30baba18f1" title="Register config engine.">ast_config_engine_register</a>(&amp;<a class="code" href="res__config__ldap_8c.html#a70367624d2d9a8df76df96ad482c1f01">ldap_engine</a>);
<a name="l01521"></a>01521    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;LDAP RealTime driver loaded.\n&quot;</span>);
<a name="l01522"></a>01522    <a class="code" href="cli_8h.html#aadeef34f3106bb78aeb3414032ad7fb7" title="Register multiple commands.">ast_cli_register_multiple</a>(<a class="code" href="res__config__ldap_8c.html#a561b0b21a0287f6db417ce1211336f0f">ldap_cli</a>, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="res__config__ldap_8c.html#a561b0b21a0287f6db417ce1211336f0f">ldap_cli</a>));
<a name="l01523"></a>01523 
<a name="l01524"></a>01524    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="res__config__ldap_8c.html#a55f48ee8d8b928c4d52e3d2182a17091">ldap_lock</a>);
<a name="l01525"></a>01525 
<a name="l01526"></a>01526    <span class="keywordflow">return</span> 0;
<a name="l01527"></a>01527 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af9f24c4cf29126b1832517b188aeb585"></a><!-- doxytag: member="res_config_ldap.c::parse_config" ref="af9f24c4cf29126b1832517b188aeb585" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int parse_config </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><p>&lt; using the [config] context for Static RealTime </p>
</p>

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l01577">1577</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>References <a class="el" href="res__config__ldap_8c_source.html#l00089">ldap_table_config::additional_filter</a>, <a class="el" href="config_8c_source.html#l00613">ast_category_browse()</a>, <a class="el" href="config_8c_source.html#l00827">ast_config_destroy()</a>, <a class="el" href="config_8h_source.html#l00139">ast_config_load</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="linkedlists_8h_source.html#l00695">AST_LIST_INSERT_HEAD</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="config_8c_source.html#l00411">ast_variable_browse()</a>, <a class="el" href="config_8c_source.html#l00435">ast_variable_retrieve()</a>, <a class="el" href="res__config__ldap_8c_source.html#l00098">base_table_config</a>, <a class="el" href="cdr__csv_8c_source.html#l00054">config</a>, <a class="el" href="config_8h_source.html#l00050">CONFIG_STATUS_FILEINVALID</a>, <a class="el" href="config_8h_source.html#l00048">CONFIG_STATUS_FILEMISSING</a>, <a class="el" href="structldap__table__config.html#a08bd9e7a7d85b79f53c0973c5c3a0406">ldap_table_config::entry</a>, <a class="el" href="res__config__ldap_8c_source.html#l00181">ldap_table_config_add_attribute()</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="config_8h_source.html#l00075">ast_variable::name</a>, <a class="el" href="config_8h_source.html#l00077">ast_variable::next</a>, <a class="el" href="res__config__ldap_8c_source.html#l00061">RES_CONFIG_LDAP_CONF</a>, <a class="el" href="res__config__ldap_8c_source.html#l00062">RES_CONFIG_LDAP_DEFAULT_BASEDN</a>, <a class="el" href="aesopt_8h_source.html#l00399">s</a>, <a class="el" href="res__config__ldap_8c_source.html#l00099">static_table_config</a>, <a class="el" href="res__config__ldap_8c_source.html#l00125">table_config_for_table_name()</a>, <a class="el" href="res__config__ldap_8c_source.html#l00106">table_config_new()</a>, <a class="el" href="res__config__ldap_8c_source.html#l00199">table_configs_free()</a>, <a class="el" href="config_8h_source.html#l00076">ast_variable::value</a>, and <a class="el" href="ast__expr2f_8c_source.html#l00613">var</a>.</p>

<p>Referenced by <a class="el" href="res__config__ldap_8c_source.html#l01508">load_module()</a>, and <a class="el" href="res__config__ldap_8c_source.html#l01550">reload()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01578"></a>01578 {
<a name="l01579"></a>01579    <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *<a class="code" href="cdr__csv_8c.html#a74bb62276efdf39dd94048e007fca05b">config</a>;
<a name="l01580"></a>01580    <span class="keyword">struct </span><a class="code" href="structast__flags.html" title="Structure used to handle boolean flags.">ast_flags</a> <a class="code" href="app__rpt_8c.html#a1f57f20c1f46890828791a4827fe8752">config_flags</a> = {0};
<a name="l01581"></a>01581    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>, *host;
<a name="l01582"></a>01582    <span class="keywordtype">int</span> port;
<a name="l01583"></a>01583    <span class="keywordtype">char</span> *category_name = NULL;
<a name="l01584"></a>01584 
<a name="l01585"></a>01585    config = <a class="code" href="config_8h.html#a0a07ddd6bbcf44485e01c14c96109482">ast_config_load</a>(<a class="code" href="res__config__ldap_8c.html#af925dc82fd1722062dc8e2ff0f7aac61">RES_CONFIG_LDAP_CONF</a>, config_flags);
<a name="l01586"></a>01586    <span class="keywordflow">if</span> (config == <a class="code" href="config_8h.html#a39bacaabcacf47583204c7634e64a2a0">CONFIG_STATUS_FILEMISSING</a> || config == <a class="code" href="config_8h.html#a8d1a63cdf2c7aff22a77b6e75d93b377">CONFIG_STATUS_FILEINVALID</a>) {
<a name="l01587"></a>01587       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Cannot load configuration %s\n&quot;</span>, <a class="code" href="res__config__ldap_8c.html#af925dc82fd1722062dc8e2ff0f7aac61">RES_CONFIG_LDAP_CONF</a>);
<a name="l01588"></a>01588       <span class="keywordflow">return</span> -1;
<a name="l01589"></a>01589    }
<a name="l01590"></a>01590 
<a name="l01591"></a>01591    <span class="keywordflow">if</span> (!(s = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(config, <span class="stringliteral">&quot;_general&quot;</span>, <span class="stringliteral">&quot;user&quot;</span>))) {
<a name="l01592"></a>01592       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No directory user found, anonymous binding as default.\n&quot;</span>);
<a name="l01593"></a>01593       <a class="code" href="structuser.html" title="structure to hold users read from users.conf">user</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01594"></a>01594    } <span class="keywordflow">else</span> 
<a name="l01595"></a>01595       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="structuser.html" title="structure to hold users read from users.conf">user</a>, s, <span class="keyword">sizeof</span>(<a class="code" href="structuser.html" title="structure to hold users read from users.conf">user</a>));
<a name="l01596"></a>01596 
<a name="l01597"></a>01597    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="structuser.html" title="structure to hold users read from users.conf">user</a>)) {
<a name="l01598"></a>01598       <span class="keywordflow">if</span> (!(s = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(config, <span class="stringliteral">&quot;_general&quot;</span>, <span class="stringliteral">&quot;pass&quot;</span>))) {
<a name="l01599"></a>01599          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No directory password found, using &apos;asterisk&apos; as default.\n&quot;</span>);
<a name="l01600"></a>01600          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="res__config__ldap_8c.html#a68433c52f2199bd92a3c151b295de06e">pass</a>, <span class="stringliteral">&quot;asterisk&quot;</span>, <span class="keyword">sizeof</span>(<a class="code" href="res__config__ldap_8c.html#a68433c52f2199bd92a3c151b295de06e">pass</a>));
<a name="l01601"></a>01601       } <span class="keywordflow">else</span> {
<a name="l01602"></a>01602          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="res__config__ldap_8c.html#a68433c52f2199bd92a3c151b295de06e">pass</a>, s, <span class="keyword">sizeof</span>(<a class="code" href="res__config__ldap_8c.html#a68433c52f2199bd92a3c151b295de06e">pass</a>));
<a name="l01603"></a>01603       }
<a name="l01604"></a>01604    }
<a name="l01605"></a>01605 
<a name="l01606"></a>01606    <span class="comment">/* URL is preferred, use host and port if not found */</span>
<a name="l01607"></a>01607    <span class="keywordflow">if</span> ((s = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(config, <span class="stringliteral">&quot;_general&quot;</span>, <span class="stringliteral">&quot;url&quot;</span>))) {
<a name="l01608"></a>01608       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="res__config__ldap_8c.html#a75e4590043edf35241d30fabe2eda546">url</a>, s, <span class="keyword">sizeof</span>(<a class="code" href="res__config__ldap_8c.html#a75e4590043edf35241d30fabe2eda546">url</a>));
<a name="l01609"></a>01609    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((host = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(config, <span class="stringliteral">&quot;_general&quot;</span>, <span class="stringliteral">&quot;host&quot;</span>))) {
<a name="l01610"></a>01610       <span class="keywordflow">if</span> (!(s = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(config, <span class="stringliteral">&quot;_general&quot;</span>, <span class="stringliteral">&quot;port&quot;</span>)) || sscanf(s, <span class="stringliteral">&quot;%5d&quot;</span>, &amp;port) != 1 || port &gt; 65535) {
<a name="l01611"></a>01611          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;No directory port found, using 389 as default.\n&quot;</span>);
<a name="l01612"></a>01612          port = 389;
<a name="l01613"></a>01613       }
<a name="l01614"></a>01614 
<a name="l01615"></a>01615       snprintf(<a class="code" href="res__config__ldap_8c.html#a75e4590043edf35241d30fabe2eda546">url</a>, <span class="keyword">sizeof</span>(<a class="code" href="res__config__ldap_8c.html#a75e4590043edf35241d30fabe2eda546">url</a>), <span class="stringliteral">&quot;ldap://%s:%d&quot;</span>, host, port);
<a name="l01616"></a>01616    } <span class="keywordflow">else</span> {
<a name="l01617"></a>01617       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;No directory URL or host found.\n&quot;</span>);
<a name="l01618"></a>01618       <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(config);
<a name="l01619"></a>01619       <span class="keywordflow">return</span> -1;
<a name="l01620"></a>01620    }
<a name="l01621"></a>01621 
<a name="l01622"></a>01622    <span class="keywordflow">if</span> (!(s = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(config, <span class="stringliteral">&quot;_general&quot;</span>, <span class="stringliteral">&quot;basedn&quot;</span>))) {
<a name="l01623"></a>01623       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;No LDAP base dn found, using &apos;%s&apos; as default.\n&quot;</span>, <a class="code" href="res__config__ldap_8c.html#ac66cf6df04c515faa38696a5031c37fe">RES_CONFIG_LDAP_DEFAULT_BASEDN</a>);
<a name="l01624"></a>01624       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="res__config__ldap_8c.html#acfd19a5e5bb3f90e330bd660b743970f">base_distinguished_name</a>, <a class="code" href="res__config__ldap_8c.html#ac66cf6df04c515faa38696a5031c37fe">RES_CONFIG_LDAP_DEFAULT_BASEDN</a>, <span class="keyword">sizeof</span>(<a class="code" href="res__config__ldap_8c.html#acfd19a5e5bb3f90e330bd660b743970f">base_distinguished_name</a>));
<a name="l01625"></a>01625    } <span class="keywordflow">else</span> 
<a name="l01626"></a>01626       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="res__config__ldap_8c.html#acfd19a5e5bb3f90e330bd660b743970f">base_distinguished_name</a>, s, <span class="keyword">sizeof</span>(<a class="code" href="res__config__ldap_8c.html#acfd19a5e5bb3f90e330bd660b743970f">base_distinguished_name</a>));
<a name="l01627"></a>01627 
<a name="l01628"></a>01628    <span class="keywordflow">if</span> (!(s = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(config, <span class="stringliteral">&quot;_general&quot;</span>, <span class="stringliteral">&quot;version&quot;</span>)) &amp;&amp; !(s = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(config, <span class="stringliteral">&quot;_general&quot;</span>, <span class="stringliteral">&quot;protocol&quot;</span>))) {
<a name="l01629"></a>01629       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;No explicit LDAP version found, using 3 as default.\n&quot;</span>);
<a name="l01630"></a>01630       <a class="code" href="res__config__ldap_8c.html#aad880fc4455c253781e8968f2239d56f">version</a> = 3;
<a name="l01631"></a>01631    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sscanf(s, <span class="stringliteral">&quot;%30d&quot;</span>, &amp;<a class="code" href="res__config__ldap_8c.html#aad880fc4455c253781e8968f2239d56f">version</a>) != 1 || version &lt; 1 || version &gt; 6) {
<a name="l01632"></a>01632       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid LDAP version &apos;%s&apos;, using 3 as default.\n&quot;</span>, s);
<a name="l01633"></a>01633       <a class="code" href="res__config__ldap_8c.html#aad880fc4455c253781e8968f2239d56f">version</a> = 3;
<a name="l01634"></a>01634    }
<a name="l01635"></a>01635 
<a name="l01636"></a>01636    <a class="code" href="res__config__ldap_8c.html#a9155b18ff8ee6bb5b8b8bf7c32832ae1" title="Free table_config.">table_configs_free</a>();
<a name="l01637"></a>01637 
<a name="l01638"></a>01638    <span class="keywordflow">while</span> ((category_name = <a class="code" href="config_8h.html#a611776300f941a63266cb220ac62b4db" title="Goes through categories.">ast_category_browse</a>(config, category_name))) {
<a name="l01639"></a>01639       <span class="keywordtype">int</span> is_general = (strcasecmp(category_name, <span class="stringliteral">&quot;_general&quot;</span>) == 0);
<a name="l01640"></a>01640       <span class="keywordtype">int</span> is_config = (strcasecmp(category_name, <span class="stringliteral">&quot;config&quot;</span>) == 0); <span class="comment">/*!&lt; using the [config] context for Static RealTime */</span>
<a name="l01641"></a>01641       <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a> = <a class="code" href="config_8h.html#a935ccfa153100ddd320c8918bd6e941b" title="Goes through variables Somewhat similar in intent as the ast_category_browse. List...">ast_variable_browse</a>(config, category_name);
<a name="l01642"></a>01642       
<a name="l01643"></a>01643       <span class="keywordflow">if</span> (var) {
<a name="l01644"></a>01644          <span class="keyword">struct </span><a class="code" href="structldap__table__config.html" title="Table configuration.">ldap_table_config</a> *table_config =
<a name="l01645"></a>01645             <a class="code" href="res__config__ldap_8c.html#a5d395421629c28b7bd00359041440917" title="Find a table_config - Should be locked before using it.">table_config_for_table_name</a>(category_name);
<a name="l01646"></a>01646          <span class="keywordflow">if</span> (!table_config) {
<a name="l01647"></a>01647             table_config = <a class="code" href="res__config__ldap_8c.html#a8c9c18709185dad2a12c74c00d95d180" title="Create a new table_config.">table_config_new</a>(category_name);
<a name="l01648"></a>01648             <a class="code" href="linkedlists_8h.html#aa2ded2af046bb513f77056c27c083307" title="Inserts a list entry at the head of a list.">AST_LIST_INSERT_HEAD</a>(&amp;<a class="code" href="structtable__configs.html" title="Should be locked before using it.">table_configs</a>, table_config, <a class="code" href="structldap__table__config.html#a08bd9e7a7d85b79f53c0973c5c3a0406">entry</a>);
<a name="l01649"></a>01649             <span class="keywordflow">if</span> (is_general)
<a name="l01650"></a>01650                <a class="code" href="res__config__ldap_8c.html#a3c846177aac9c60160bea626fbc3225d">base_table_config</a> = table_config;
<a name="l01651"></a>01651             <span class="keywordflow">if</span> (is_config)
<a name="l01652"></a>01652                <a class="code" href="res__config__ldap_8c.html#a4b7f6e04c04ac98ed68f7d62640d1d7b">static_table_config</a> = table_config;
<a name="l01653"></a>01653          }
<a name="l01654"></a>01654          <span class="keywordflow">for</span> (; var; var = var-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l01655"></a>01655             <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;additionalFilter&quot;</span>)) {
<a name="l01656"></a>01656                table_config-&gt;<a class="code" href="structldap__table__config.html#aa6f8c05d7d124316fedcde5a15a5e0d6">additional_filter</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(var-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l01657"></a>01657             } <span class="keywordflow">else</span> {
<a name="l01658"></a>01658                <a class="code" href="res__config__ldap_8c.html#ad096b7ca5e5115c828fb827c207e4770" title="add attribute to table config - Should be locked before using it">ldap_table_config_add_attribute</a>(table_config, var-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, var-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l01659"></a>01659             }
<a name="l01660"></a>01660          }
<a name="l01661"></a>01661       }
<a name="l01662"></a>01662    }
<a name="l01663"></a>01663 
<a name="l01664"></a>01664    <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(config);
<a name="l01665"></a>01665 
<a name="l01666"></a>01666    <span class="keywordflow">return</span> 1;
<a name="l01667"></a>01667 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af453de1bba339d948f98c9e2b49eafdd"></a><!-- doxytag: member="res_config_ldap.c::realtime_ldap" ref="af453de1bba339d948f98c9e2b49eafdd" args="(const char *basedn, const char *table_name, va_list ap)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__variable.html">ast_variable</a>* realtime_ldap </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>basedn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>table_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">va_list&nbsp;</td>
          <td class="paramname"> <em>ap</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>See Asterisk doc. </p>
<p>For Realtime Dynamic(i.e., switch, queues, and directory) -- I think </p>

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l00907">907</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00084">free</a>, <a class="el" href="config_8h_source.html#l00077">ast_variable::next</a>, <a class="el" href="res__config__ldap_8c_source.html#l00718">realtime_ldap_base_ap()</a>, and <a class="el" href="ast__expr2f_8c_source.html#l00613">var</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00909"></a>00909 {
<a name="l00910"></a>00910    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> **vars = <a class="code" href="res__config__ldap_8c.html#a3037ce503252b1b50de11873d1a2a6c2" title="LDAP base function.">realtime_ldap_base_ap</a>(NULL, basedn, table_name, ap);
<a name="l00911"></a>00911    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a> = NULL;
<a name="l00912"></a>00912 
<a name="l00913"></a>00913    <span class="keywordflow">if</span> (vars) {
<a name="l00914"></a>00914       <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *last_var = NULL;
<a name="l00915"></a>00915       <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> **p = vars;
<a name="l00916"></a>00916       <span class="keywordflow">while</span> (*p) {
<a name="l00917"></a>00917          <span class="keywordflow">if</span> (last_var) {
<a name="l00918"></a>00918             <span class="keywordflow">while</span> (last_var-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>)
<a name="l00919"></a>00919                last_var = last_var-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>;
<a name="l00920"></a>00920             last_var-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a> = *p;
<a name="l00921"></a>00921          } <span class="keywordflow">else</span> {
<a name="l00922"></a>00922             var = *p;
<a name="l00923"></a>00923             last_var = var;
<a name="l00924"></a>00924          }
<a name="l00925"></a>00925          p++;
<a name="l00926"></a>00926       }
<a name="l00927"></a>00927       <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(vars);
<a name="l00928"></a>00928    }
<a name="l00929"></a>00929    <span class="keywordflow">return</span> var;
<a name="l00930"></a>00930 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4c05d455f43aac9094ec3f01d52af8c2"></a><!-- doxytag: member="res_config_ldap.c::realtime_ldap_base" ref="a4c05d455f43aac9094ec3f01d52af8c2" args="(unsigned int *entries_count_ptr, const char *basedn, const char *table_name,...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__variable.html">ast_variable</a>** realtime_ldap_base </td>
          <td>(</td>
          <td class="paramtype">unsigned int *&nbsp;</td>
          <td class="paramname"> <em>entries_count_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>basedn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>table_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>...</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>same as realtime_ldap_base_ap but take variable arguments count list </p>

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l00890">890</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>References <a class="el" href="res__config__ldap_8c_source.html#l00718">realtime_ldap_base_ap()</a>.</p>

<p>Referenced by <a class="el" href="res__config__ldap_8c_source.html#l01015">config_ldap()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00892"></a>00892 {
<a name="l00893"></a>00893    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> **vars = NULL;
<a name="l00894"></a>00894    va_list ap;
<a name="l00895"></a>00895 
<a name="l00896"></a>00896    va_start(ap, table_name);
<a name="l00897"></a>00897    vars = <a class="code" href="res__config__ldap_8c.html#a3037ce503252b1b50de11873d1a2a6c2" title="LDAP base function.">realtime_ldap_base_ap</a>(entries_count_ptr, basedn, table_name, ap);
<a name="l00898"></a>00898    va_end(ap);
<a name="l00899"></a>00899 
<a name="l00900"></a>00900    <span class="keywordflow">return</span> vars;
<a name="l00901"></a>00901 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3037ce503252b1b50de11873d1a2a6c2"></a><!-- doxytag: member="res_config_ldap.c::realtime_ldap_base_ap" ref="a3037ce503252b1b50de11873d1a2a6c2" args="(unsigned int *entries_count_ptr, const char *basedn, const char *table_name, va_list ap)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__variable.html">ast_variable</a>** realtime_ldap_base_ap </td>
          <td>(</td>
          <td class="paramtype">unsigned int *&nbsp;</td>
          <td class="paramname"> <em>entries_count_ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>basedn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>table_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">va_list&nbsp;</td>
          <td class="paramname"> <em>ap</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>LDAP base function. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>a null terminated array of <a class="el" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> (one per entry) or NULL if no entry is found or if an error occured caller should free the returned array and ast_variables </dd></dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>entries_count_ptr</em>&nbsp;</td><td>is a pointer to found entries count (can be NULL) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>basedn</em>&nbsp;</td><td>is the base DN </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>table_name</em>&nbsp;</td><td>is the table_name (used dor attribute convertion and additional filter) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ap</em>&nbsp;</td><td>contains null terminated list of pairs name/value </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l00718">718</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>References <a class="el" href="res__config__ldap_8c_source.html#l00089">ldap_table_config::additional_filter</a>, <a class="el" href="res__config__ldap_8c_source.html#l00686">append_var_and_value_to_filter()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="strings_8h_source.html#l00846">ast_str_append()</a>, <a class="el" href="strings_8h_source.html#l00488">ast_str_buffer()</a>, <a class="el" href="strings_8h_source.html#l00415">ast_str_create()</a>, <a class="el" href="config_8c_source.html#l00397">ast_variables_destroy()</a>, <a class="el" href="res__config__ldap_8c_source.html#l00098">base_table_config</a>, <a class="el" href="res__config__ldap_8c_source.html#l00636">cleaned_basedn()</a>, <a class="el" href="func__strings_8c_source.html#l00427">filter()</a>, <a class="el" href="res__config__ldap_8c_source.html#l00535">is_ldap_connect_error()</a>, <a class="el" href="res__config__ldap_8c_source.html#l00544">ldap_loadentry()</a>, <a class="el" href="res__config__ldap_8c_source.html#l00064">ldap_lock</a>, <a class="el" href="res__config__ldap_8c_source.html#l01670">ldap_reconnect()</a>, <a class="el" href="logger_8h_source.html#l00119">LOG_DEBUG</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="config_8h_source.html#l00075">ast_variable::name</a>, <a class="el" href="config_8h_source.html#l00077">ast_variable::next</a>, <a class="el" href="res__config__ldap_8c_source.html#l00092">ldap_table_config::next</a>, <a class="el" href="res__config__ldap_8c_source.html#l00349">realtime_ldap_result_to_vars()</a>, <a class="el" href="res__config__ldap_8c_source.html#l00125">table_config_for_table_name()</a>, and <a class="el" href="config_8h_source.html#l00076">ast_variable::value</a>.</p>

<p>Referenced by <a class="el" href="res__config__ldap_8c_source.html#l00907">realtime_ldap()</a>, <a class="el" href="res__config__ldap_8c_source.html#l00890">realtime_ldap_base()</a>, and <a class="el" href="res__config__ldap_8c_source.html#l00939">realtime_multi_ldap()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00720"></a>00720 {
<a name="l00721"></a>00721    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> **vars = NULL;
<a name="l00722"></a>00722    <span class="keyword">const</span> <span class="keywordtype">char</span> *newparam = NULL;
<a name="l00723"></a>00723    <span class="keyword">const</span> <span class="keywordtype">char</span> *newval = NULL;
<a name="l00724"></a>00724    <span class="keyword">struct </span><a class="code" href="structldap__table__config.html" title="Table configuration.">ldap_table_config</a> *table_config = NULL;
<a name="l00725"></a>00725    <span class="keywordtype">char</span> *clean_basedn = <a class="code" href="res__config__ldap_8c.html#a39941ba901b2a30cc6d044760545c6c3" title="caller should free returned pointer">cleaned_basedn</a>(NULL, basedn);
<a name="l00726"></a>00726    <span class="keyword">struct </span><a class="code" href="structast__str.html" title="The descriptor of a dynamic string XXX storage will be optimized later if needed...">ast_str</a> *<a class="code" href="func__strings_8c.html#af2deb3c7b0d3bdd442bb9ada5fda3d17">filter</a> = NULL;
<a name="l00727"></a>00727    <span class="keywordtype">int</span> tries = 0;
<a name="l00728"></a>00728    <span class="keywordtype">int</span> result = 0;
<a name="l00729"></a>00729    LDAPMessage *ldap_result_msg = NULL;
<a name="l00730"></a>00730 
<a name="l00731"></a>00731    <span class="keywordflow">if</span> (!table_name) {
<a name="l00732"></a>00732       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No table_name specified.\n&quot;</span>);
<a name="l00733"></a>00733       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(clean_basedn);
<a name="l00734"></a>00734       <span class="keywordflow">return</span> NULL;
<a name="l00735"></a>00735    } 
<a name="l00736"></a>00736 
<a name="l00737"></a>00737    <span class="keywordflow">if</span> (!(filter = <a class="code" href="strings_8h.html#a8ec37e4acb6ecb20eb6f6edd1141cd76" title="Create a malloc&amp;#39;ed dynamic length string.">ast_str_create</a>(80))) {
<a name="l00738"></a>00738       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(clean_basedn);
<a name="l00739"></a>00739       <span class="keywordflow">return</span> NULL;
<a name="l00740"></a>00740    }
<a name="l00741"></a>00741 
<a name="l00742"></a>00742    <span class="comment">/* Get the first parameter and first value in our list of passed paramater/value pairs  */</span>
<a name="l00743"></a>00743    newparam = va_arg(ap, <span class="keyword">const</span> <span class="keywordtype">char</span> *);
<a name="l00744"></a>00744    newval = va_arg(ap, <span class="keyword">const</span> <span class="keywordtype">char</span> *);
<a name="l00745"></a>00745 
<a name="l00746"></a>00746    <span class="keywordflow">if</span> (!newparam || !newval) {
<a name="l00747"></a>00747       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Realtime retrieval requires at least 1 parameter&quot;</span>
<a name="l00748"></a>00748          <span class="stringliteral">&quot; and 1 value to search on.\n&quot;</span>);
<a name="l00749"></a>00749       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(filter);
<a name="l00750"></a>00750       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(clean_basedn);
<a name="l00751"></a>00751       <span class="keywordflow">return</span> NULL;
<a name="l00752"></a>00752    }
<a name="l00753"></a>00753 
<a name="l00754"></a>00754    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;<a class="code" href="res__config__ldap_8c.html#a55f48ee8d8b928c4d52e3d2182a17091">ldap_lock</a>);
<a name="l00755"></a>00755 
<a name="l00756"></a>00756    <span class="comment">/* We now have our complete statement; Lets connect to the server and execute it.  */</span>
<a name="l00757"></a>00757    <span class="keywordflow">if</span> (!<a class="code" href="res__config__ldap_8c.html#a77f9d4c9f33d2f29e98c5c8cc09e9119">ldap_reconnect</a>()) {
<a name="l00758"></a>00758       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="res__config__ldap_8c.html#a55f48ee8d8b928c4d52e3d2182a17091">ldap_lock</a>);
<a name="l00759"></a>00759       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(filter);
<a name="l00760"></a>00760       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(clean_basedn);
<a name="l00761"></a>00761       <span class="keywordflow">return</span> NULL;
<a name="l00762"></a>00762    }
<a name="l00763"></a>00763 
<a name="l00764"></a>00764    table_config = <a class="code" href="res__config__ldap_8c.html#a5d395421629c28b7bd00359041440917" title="Find a table_config - Should be locked before using it.">table_config_for_table_name</a>(table_name);
<a name="l00765"></a>00765    <span class="keywordflow">if</span> (!table_config) {
<a name="l00766"></a>00766       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No table named &apos;%s&apos;.\n&quot;</span>, table_name);
<a name="l00767"></a>00767       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="res__config__ldap_8c.html#a55f48ee8d8b928c4d52e3d2182a17091">ldap_lock</a>);
<a name="l00768"></a>00768       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(filter);
<a name="l00769"></a>00769       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(clean_basedn);
<a name="l00770"></a>00770       <span class="keywordflow">return</span> NULL;
<a name="l00771"></a>00771    }
<a name="l00772"></a>00772 
<a name="l00773"></a>00773    <a class="code" href="strings_8h.html#a85cd5a8ef499e39d22b4bfeb8b9a64f7" title="Append to a thread local dynamic string.">ast_str_append</a>(&amp;filter, 0, <span class="stringliteral">&quot;(&amp;&quot;</span>);
<a name="l00774"></a>00774 
<a name="l00775"></a>00775    <span class="keywordflow">if</span> (table_config &amp;&amp; table_config-&gt;<a class="code" href="structldap__table__config.html#aa6f8c05d7d124316fedcde5a15a5e0d6">additional_filter</a>)
<a name="l00776"></a>00776       <a class="code" href="strings_8h.html#a85cd5a8ef499e39d22b4bfeb8b9a64f7" title="Append to a thread local dynamic string.">ast_str_append</a>(&amp;filter, 0, <span class="stringliteral">&quot;%s&quot;</span>, table_config-&gt;<a class="code" href="structldap__table__config.html#aa6f8c05d7d124316fedcde5a15a5e0d6">additional_filter</a>);
<a name="l00777"></a>00777    <span class="keywordflow">if</span> (table_config != <a class="code" href="res__config__ldap_8c.html#a3c846177aac9c60160bea626fbc3225d">base_table_config</a> &amp;&amp; <a class="code" href="res__config__ldap_8c.html#a3c846177aac9c60160bea626fbc3225d">base_table_config</a> &amp;&amp; 
<a name="l00778"></a>00778       <a class="code" href="res__config__ldap_8c.html#a3c846177aac9c60160bea626fbc3225d">base_table_config</a>-&gt;<a class="code" href="structldap__table__config.html#aa6f8c05d7d124316fedcde5a15a5e0d6">additional_filter</a>) {
<a name="l00779"></a>00779       <a class="code" href="strings_8h.html#a85cd5a8ef499e39d22b4bfeb8b9a64f7" title="Append to a thread local dynamic string.">ast_str_append</a>(&amp;filter, 0, <span class="stringliteral">&quot;%s&quot;</span>, <a class="code" href="res__config__ldap_8c.html#a3c846177aac9c60160bea626fbc3225d">base_table_config</a>-&gt;<a class="code" href="structldap__table__config.html#aa6f8c05d7d124316fedcde5a15a5e0d6">additional_filter</a>);
<a name="l00780"></a>00780    }
<a name="l00781"></a>00781 
<a name="l00782"></a>00782    <span class="comment">/* Create the first part of the query using the first parameter/value pairs we just extracted */</span>
<a name="l00783"></a>00783    <span class="comment">/*   If there is only 1 set, then we have our query. Otherwise, loop thru the list and concat */</span>
<a name="l00784"></a>00784 
<a name="l00785"></a>00785    <a class="code" href="res__config__ldap_8c.html#a28fa55daf894a70a398e09f3ce39d3dc" title="Append a name=value filter string. The filter string can grow.">append_var_and_value_to_filter</a>(&amp;filter, table_config, newparam, newval);
<a name="l00786"></a>00786    <span class="keywordflow">while</span> ((newparam = va_arg(ap, <span class="keyword">const</span> <span class="keywordtype">char</span> *))) {
<a name="l00787"></a>00787       newval = va_arg(ap, <span class="keyword">const</span> <span class="keywordtype">char</span> *);
<a name="l00788"></a>00788       <a class="code" href="res__config__ldap_8c.html#a28fa55daf894a70a398e09f3ce39d3dc" title="Append a name=value filter string. The filter string can grow.">append_var_and_value_to_filter</a>(&amp;filter, table_config, newparam, newval);
<a name="l00789"></a>00789    }
<a name="l00790"></a>00790    <a class="code" href="strings_8h.html#a85cd5a8ef499e39d22b4bfeb8b9a64f7" title="Append to a thread local dynamic string.">ast_str_append</a>(&amp;filter, 0, <span class="stringliteral">&quot;)&quot;</span>);
<a name="l00791"></a>00791 
<a name="l00792"></a>00792    <span class="keywordflow">do</span> {
<a name="l00793"></a>00793       <span class="comment">/* freeing ldap_result further down */</span>
<a name="l00794"></a>00794       result = ldap_search_ext_s(<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>, clean_basedn,
<a name="l00795"></a>00795               LDAP_SCOPE_SUBTREE, <a class="code" href="strings_8h.html#a053bdfc229997a75f112bdd7b995e00b" title="Returns the string buffer within the ast_str buf.">ast_str_buffer</a>(filter), NULL, 0, NULL, NULL, NULL, LDAP_NO_LIMIT,
<a name="l00796"></a>00796               &amp;ldap_result_msg);
<a name="l00797"></a>00797       <span class="keywordflow">if</span> (result != LDAP_SUCCESS &amp;&amp; <a class="code" href="res__config__ldap_8c.html#a860e11270a1778347d12df4841bf7819">is_ldap_connect_error</a>(result)) {
<a name="l00798"></a>00798          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;Failed to query database. Try %d/10\n&quot;</span>,
<a name="l00799"></a>00799             tries + 1);
<a name="l00800"></a>00800          <span class="keywordflow">if</span> (++tries &lt; 10) {
<a name="l00801"></a>00801             usleep(1);
<a name="l00802"></a>00802             <span class="keywordflow">if</span> (<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>) {
<a name="l00803"></a>00803                ldap_unbind_ext_s(<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>, NULL, NULL);
<a name="l00804"></a>00804                <a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a> = NULL;
<a name="l00805"></a>00805             }
<a name="l00806"></a>00806             <span class="keywordflow">if</span> (!<a class="code" href="res__config__ldap_8c.html#a77f9d4c9f33d2f29e98c5c8cc09e9119">ldap_reconnect</a>())
<a name="l00807"></a>00807                <span class="keywordflow">break</span>;
<a name="l00808"></a>00808          }
<a name="l00809"></a>00809       }
<a name="l00810"></a>00810    } <span class="keywordflow">while</span> (result != LDAP_SUCCESS &amp;&amp; tries &lt; 10 &amp;&amp; <a class="code" href="res__config__ldap_8c.html#a860e11270a1778347d12df4841bf7819">is_ldap_connect_error</a>(result));
<a name="l00811"></a>00811 
<a name="l00812"></a>00812    <span class="keywordflow">if</span> (result != LDAP_SUCCESS) {
<a name="l00813"></a>00813       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to query database. Check debug for more info.\n&quot;</span>);
<a name="l00814"></a>00814       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Query: %s\n&quot;</span>, <a class="code" href="strings_8h.html#a053bdfc229997a75f112bdd7b995e00b" title="Returns the string buffer within the ast_str buf.">ast_str_buffer</a>(filter));
<a name="l00815"></a>00815       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Query Failed because: %s\n&quot;</span>, ldap_err2string(result));
<a name="l00816"></a>00816    } <span class="keywordflow">else</span> {
<a name="l00817"></a>00817       <span class="comment">/* this is where we create the variables from the search result </span>
<a name="l00818"></a>00818 <span class="comment">       * freeing this \a vars outside this function */</span>
<a name="l00819"></a>00819       <span class="keywordflow">if</span> (ldap_count_entries(<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>, ldap_result_msg) &gt; 0) {
<a name="l00820"></a>00820          <span class="comment">/* is this a static var or some other? they are handled different for delimited values */</span>
<a name="l00821"></a>00821          vars = <a class="code" href="res__config__ldap_8c.html#a70f8af371712c0c864197041a9bbd876" title="Get variables from ldap entry attributes - Should be locked before using it.">realtime_ldap_result_to_vars</a>(table_config, ldap_result_msg, entries_count_ptr);
<a name="l00822"></a>00822       } <span class="keywordflow">else</span> {
<a name="l00823"></a>00823          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Could not find any entry matching %s in base dn %s.\n&quot;</span>,
<a name="l00824"></a>00824             <a class="code" href="strings_8h.html#a053bdfc229997a75f112bdd7b995e00b" title="Returns the string buffer within the ast_str buf.">ast_str_buffer</a>(filter), clean_basedn);
<a name="l00825"></a>00825       }
<a name="l00826"></a>00826 
<a name="l00827"></a>00827       ldap_msgfree(ldap_result_msg);
<a name="l00828"></a>00828 
<a name="l00829"></a>00829       <span class="comment">/* TODO: get the default variables from the accountBaseDN, not implemented with delimited values */</span>
<a name="l00830"></a>00830       <span class="keywordflow">if</span> (vars) {
<a name="l00831"></a>00831          <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> **p = vars;
<a name="l00832"></a>00832          <span class="keywordflow">while</span> (*p) {
<a name="l00833"></a>00833             <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *append_var = NULL;
<a name="l00834"></a>00834             <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *tmp = *p;
<a name="l00835"></a>00835             <span class="keywordflow">while</span> (tmp) {
<a name="l00836"></a>00836                <span class="keywordflow">if</span> (strcasecmp(tmp-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;accountBaseDN&quot;</span>) == 0) {
<a name="l00837"></a>00837                   <span class="comment">/* Get the variable to compare with for the defaults */</span>
<a name="l00838"></a>00838                   <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *base_var = <a class="code" href="res__config__ldap_8c.html#a6ec80581ef03e58f2c4cdf842dbad775" title="Get LDAP entry by dn and return attributes as variables - Should be locked before...">ldap_loadentry</a>(table_config, tmp-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l00839"></a>00839                   
<a name="l00840"></a>00840                   <span class="keywordflow">while</span> (base_var) {
<a name="l00841"></a>00841                      <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a> = base_var-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>;
<a name="l00842"></a>00842                      <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *test_var = *p;
<a name="l00843"></a>00843                      <span class="keywordtype">int</span> base_var_found = 0;
<a name="l00844"></a>00844 
<a name="l00845"></a>00845                      <span class="comment">/* run throught the default values and fill it inn if it is missing */</span>
<a name="l00846"></a>00846                      <span class="keywordflow">while</span> (test_var) {
<a name="l00847"></a>00847                         <span class="keywordflow">if</span> (strcasecmp(test_var-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, base_var-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>) == 0) {
<a name="l00848"></a>00848                            base_var_found = 1;
<a name="l00849"></a>00849                            <span class="keywordflow">break</span>;
<a name="l00850"></a>00850                         } <span class="keywordflow">else</span>
<a name="l00851"></a>00851                            test_var = test_var-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>;
<a name="l00852"></a>00852                      }
<a name="l00853"></a>00853                      <span class="keywordflow">if</span> (base_var_found) {
<a name="l00854"></a>00854                         base_var-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a> = NULL;
<a name="l00855"></a>00855                         <a class="code" href="config_8h.html#ad3d8122172af6f13687a07840411d65d" title="Free variable list.">ast_variables_destroy</a>(base_var);
<a name="l00856"></a>00856                         base_var = next;
<a name="l00857"></a>00857                      } <span class="keywordflow">else</span> {
<a name="l00858"></a>00858                         <span class="keywordflow">if</span> (append_var)
<a name="l00859"></a>00859                            base_var-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a> = append_var;
<a name="l00860"></a>00860                         <span class="keywordflow">else</span>
<a name="l00861"></a>00861                            base_var-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a> = NULL;
<a name="l00862"></a>00862                         append_var = base_var;
<a name="l00863"></a>00863                         base_var = next;
<a name="l00864"></a>00864                      }
<a name="l00865"></a>00865                   }
<a name="l00866"></a>00866                }
<a name="l00867"></a>00867                <span class="keywordflow">if</span> (!tmp-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a> &amp;&amp; append_var) {
<a name="l00868"></a>00868                   tmp-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a> = append_var;
<a name="l00869"></a>00869                   tmp = NULL;
<a name="l00870"></a>00870                } <span class="keywordflow">else</span>
<a name="l00871"></a>00871                   tmp = tmp-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>;
<a name="l00872"></a>00872             }
<a name="l00873"></a>00873             p++;
<a name="l00874"></a>00874          }
<a name="l00875"></a>00875       }
<a name="l00876"></a>00876    }
<a name="l00877"></a>00877 
<a name="l00878"></a>00878    <span class="keywordflow">if</span> (filter)
<a name="l00879"></a>00879       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(filter);
<a name="l00880"></a>00880 
<a name="l00881"></a>00881    <span class="keywordflow">if</span> (clean_basedn)
<a name="l00882"></a>00882       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(clean_basedn);
<a name="l00883"></a>00883 
<a name="l00884"></a>00884    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="res__config__ldap_8c.html#a55f48ee8d8b928c4d52e3d2182a17091">ldap_lock</a>);
<a name="l00885"></a>00885 
<a name="l00886"></a>00886    <span class="keywordflow">return</span> vars;
<a name="l00887"></a>00887 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8f096254a39794606157ea3b7c30428a"></a><!-- doxytag: member="res_config_ldap.c::realtime_ldap_entry_to_var" ref="a8f096254a39794606157ea3b7c30428a" args="(struct ldap_table_config *table_config, LDAPMessage *ldap_entry)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__variable.html">ast_variable</a>* realtime_ldap_entry_to_var </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structldap__table__config.html">ldap_table_config</a> *&nbsp;</td>
          <td class="paramname"> <em>table_config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LDAPMessage *&nbsp;</td>
          <td class="paramname"> <em>ldap_entry</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get variables from ldap entry attributes - Should be locked before using it. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>a linked list of <a class="el" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> variables. </dd></dl>

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l00266">266</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="config_8c_source.html#l00223">ast_variable_new()</a>, <a class="el" href="res__config__ldap_8c_source.html#l00241">convert_attribute_name_from_ldap()</a>, <a class="el" href="config_8h_source.html#l00077">ast_variable::next</a>, <a class="el" href="res__config__ldap_8c_source.html#l00088">ldap_table_config::table_name</a>, and <a class="el" href="ast__expr2f_8c_source.html#l00613">var</a>.</p>

<p>Referenced by <a class="el" href="res__config__ldap_8c_source.html#l00349">realtime_ldap_result_to_vars()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00268"></a>00268 {
<a name="l00269"></a>00269    BerElement *ber = NULL;
<a name="l00270"></a>00270    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a> = NULL;
<a name="l00271"></a>00271    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *prev = NULL;
<a name="l00272"></a>00272    <span class="keywordtype">int</span> is_delimited = 0;
<a name="l00273"></a>00273    <span class="keywordtype">int</span> i = 0;
<a name="l00274"></a>00274    <span class="keywordtype">char</span> *ldap_attribute_name;
<a name="l00275"></a>00275    <span class="keyword">struct </span>berval *value;
<a name="l00276"></a>00276    <span class="keywordtype">int</span> pos = 0;
<a name="l00277"></a>00277 
<a name="l00278"></a>00278    ldap_attribute_name = ldap_first_attribute(<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>, ldap_entry, &amp;ber);
<a name="l00279"></a>00279 
<a name="l00280"></a>00280    <span class="keywordflow">while</span> (ldap_attribute_name) {
<a name="l00281"></a>00281       <span class="keyword">struct </span>berval **<a class="code" href="structvalues.html">values</a> = NULL;
<a name="l00282"></a>00282       <span class="keyword">const</span> <span class="keywordtype">char</span> *attribute_name = <a class="code" href="res__config__ldap_8c.html#a52dda9a11e8f46e1b735dad87d03f2cd" title="Convert ldap attribute name to variable name - Should be locked before using it.">convert_attribute_name_from_ldap</a>(table_config, ldap_attribute_name);
<a name="l00283"></a>00283       <span class="keywordtype">int</span> is_realmed_password_attribute = strcasecmp(attribute_name, <span class="stringliteral">&quot;md5secret&quot;</span>) == 0;
<a name="l00284"></a>00284 
<a name="l00285"></a>00285       values = ldap_get_values_len(<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>, ldap_entry, ldap_attribute_name); <span class="comment">/* these are freed at the end */</span>
<a name="l00286"></a>00286       <span class="keywordflow">if</span> (values) {
<a name="l00287"></a>00287          <span class="keyword">struct </span>berval **v;
<a name="l00288"></a>00288          <span class="keywordtype">char</span> *valptr;
<a name="l00289"></a>00289 
<a name="l00290"></a>00290          <span class="keywordflow">for</span> (v = values; *v; v++) {
<a name="l00291"></a>00291             value = *v;
<a name="l00292"></a>00292             valptr = value-&gt;bv_val;
<a name="l00293"></a>00293             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;LINE(%d) attribute_name: %s LDAP value: %s\n&quot;</span>, __LINE__, attribute_name, valptr);
<a name="l00294"></a>00294             <span class="keywordflow">if</span> (is_realmed_password_attribute) {
<a name="l00295"></a>00295                <span class="keywordflow">if</span> (!strncasecmp(valptr, <span class="stringliteral">&quot;{md5}&quot;</span>, 5)) {
<a name="l00296"></a>00296                   valptr += 5;
<a name="l00297"></a>00297                } <span class="keywordflow">else</span> {
<a name="l00298"></a>00298                   valptr = NULL;
<a name="l00299"></a>00299                }
<a name="l00300"></a>00300                <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;md5: %s\n&quot;</span>, valptr);
<a name="l00301"></a>00301             }
<a name="l00302"></a>00302             <span class="keywordflow">if</span> (valptr) {
<a name="l00303"></a>00303                <span class="comment">/* ok, so looping through all delimited values except the last one (not, last character is not delimited...) */</span>
<a name="l00304"></a>00304                <span class="keywordflow">if</span> (is_delimited) {
<a name="l00305"></a>00305                   i = 0;
<a name="l00306"></a>00306                   pos = 0;
<a name="l00307"></a>00307                   <span class="keywordflow">while</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(valptr + i)) {
<a name="l00308"></a>00308                      <span class="keywordflow">if</span> (valptr[i] == <span class="charliteral">&apos;;&apos;</span>){
<a name="l00309"></a>00309                         valptr[i] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00310"></a>00310                         <span class="keywordflow">if</span> (prev) {
<a name="l00311"></a>00311                            prev-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a> = <a class="code" href="config_8h.html#a08e94d96f459e7301a74daf32035423b">ast_variable_new</a>(attribute_name, &amp;valptr[pos], table_config-&gt;<a class="code" href="structldap__table__config.html#ab013af67ba953d509575c86d9e65da44">table_name</a>);
<a name="l00312"></a>00312                            <span class="keywordflow">if</span> (prev-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l00313"></a>00313                               prev = prev-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>;
<a name="l00314"></a>00314                            }
<a name="l00315"></a>00315                         } <span class="keywordflow">else</span> {
<a name="l00316"></a>00316                            prev = var = <a class="code" href="config_8h.html#a08e94d96f459e7301a74daf32035423b">ast_variable_new</a>(attribute_name, &amp;valptr[pos], table_config-&gt;<a class="code" href="structldap__table__config.html#ab013af67ba953d509575c86d9e65da44">table_name</a>);
<a name="l00317"></a>00317                         }
<a name="l00318"></a>00318                         pos = i + 1;
<a name="l00319"></a>00319                      }
<a name="l00320"></a>00320                      i++;
<a name="l00321"></a>00321                   }
<a name="l00322"></a>00322                }
<a name="l00323"></a>00323                <span class="comment">/* for the last delimited value or if the value is not delimited: */</span>
<a name="l00324"></a>00324                <span class="keywordflow">if</span> (prev) {
<a name="l00325"></a>00325                   prev-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a> = <a class="code" href="config_8h.html#a08e94d96f459e7301a74daf32035423b">ast_variable_new</a>(attribute_name, &amp;valptr[pos], table_config-&gt;<a class="code" href="structldap__table__config.html#ab013af67ba953d509575c86d9e65da44">table_name</a>);
<a name="l00326"></a>00326                   <span class="keywordflow">if</span> (prev-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l00327"></a>00327                      prev = prev-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>;
<a name="l00328"></a>00328                   }
<a name="l00329"></a>00329                } <span class="keywordflow">else</span> {
<a name="l00330"></a>00330                   prev = var = <a class="code" href="config_8h.html#a08e94d96f459e7301a74daf32035423b">ast_variable_new</a>(attribute_name, &amp;valptr[pos], table_config-&gt;<a class="code" href="structldap__table__config.html#ab013af67ba953d509575c86d9e65da44">table_name</a>);
<a name="l00331"></a>00331                }
<a name="l00332"></a>00332             }
<a name="l00333"></a>00333          }
<a name="l00334"></a>00334          ldap_value_free_len(values);
<a name="l00335"></a>00335       }
<a name="l00336"></a>00336       ldap_attribute_name = ldap_next_attribute(<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>, ldap_entry, ber);
<a name="l00337"></a>00337    }
<a name="l00338"></a>00338    <span class="comment">//ber_free(ber, 0);</span>
<a name="l00339"></a>00339 
<a name="l00340"></a>00340    <span class="keywordflow">return</span> var;
<a name="l00341"></a>00341 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a70f8af371712c0c864197041a9bbd876"></a><!-- doxytag: member="res_config_ldap.c::realtime_ldap_result_to_vars" ref="a70f8af371712c0c864197041a9bbd876" args="(struct ldap_table_config *table_config, LDAPMessage *ldap_result_msg, unsigned int *entries_count_ptr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__variable.html">ast_variable</a>** realtime_ldap_result_to_vars </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structldap__table__config.html">ldap_table_config</a> *&nbsp;</td>
          <td class="paramname"> <em>table_config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">LDAPMessage *&nbsp;</td>
          <td class="paramname"> <em>ldap_result_msg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int *&nbsp;</td>
          <td class="paramname"> <em>entries_count_ptr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get variables from ldap entry attributes - Should be locked before using it. </p>
<p>The results are freed outside this function so is the <em>vars</em> array.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd><em>vars</em> - an array of <a class="el" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> variables terminated with a null. </dd></dl>

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l00349">349</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="config_8c_source.html#l00223">ast_variable_new()</a>, <a class="el" href="config_8c_source.html#l00397">ast_variables_destroy()</a>, <a class="el" href="res__config__ldap_8c_source.html#l00241">convert_attribute_name_from_ldap()</a>, <a class="el" href="astmm_8h_source.html#l00084">free</a>, <a class="el" href="config_8h_source.html#l00077">ast_variable::next</a>, <a class="el" href="asterisk_8c_source.html#l00175">option_debug</a>, <a class="el" href="res__config__ldap_8c_source.html#l00266">realtime_ldap_entry_to_var()</a>, <a class="el" href="res__config__ldap_8c_source.html#l00153">semicolon_count_str()</a>, <a class="el" href="res__config__ldap_8c_source.html#l00168">semicolon_count_var()</a>, <a class="el" href="res__config__ldap_8c_source.html#l00099">static_table_config</a>, <a class="el" href="res__config__ldap_8c_source.html#l00088">ldap_table_config::table_name</a>, <a class="el" href="config_8h_source.html#l00076">ast_variable::value</a>, <a class="el" href="ast__expr2f_8c_source.html#l00613">var</a>, and <a class="el" href="res__config__ldap_8c_source.html#l00138">variable_named()</a>.</p>

<p>Referenced by <a class="el" href="res__config__ldap_8c_source.html#l00544">ldap_loadentry()</a>, and <a class="el" href="res__config__ldap_8c_source.html#l00718">realtime_ldap_base_ap()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00351"></a>00351 {
<a name="l00352"></a>00352    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> **vars;
<a name="l00353"></a>00353    <span class="keywordtype">int</span> i = 0;
<a name="l00354"></a>00354    <span class="keywordtype">int</span> tot_count = 0;
<a name="l00355"></a>00355    <span class="keywordtype">int</span> entry_index = 0;
<a name="l00356"></a>00356    LDAPMessage *ldap_entry = NULL;
<a name="l00357"></a>00357    BerElement *ber = NULL;
<a name="l00358"></a>00358    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a> = NULL;
<a name="l00359"></a>00359    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *prev = NULL;
<a name="l00360"></a>00360    <span class="keywordtype">int</span> is_delimited = 0;
<a name="l00361"></a>00361    <span class="keywordtype">char</span> *delim_value = NULL;
<a name="l00362"></a>00362    <span class="keywordtype">int</span> delim_tot_count = 0;
<a name="l00363"></a>00363    <span class="keywordtype">int</span> delim_count = 0;
<a name="l00364"></a>00364 
<a name="l00365"></a>00365    <span class="comment">/* First find the total count */</span>
<a name="l00366"></a>00366    ldap_entry = ldap_first_entry(<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>, ldap_result_msg);
<a name="l00367"></a>00367 
<a name="l00368"></a>00368    <span class="keywordflow">for</span> (tot_count = 0; ldap_entry; tot_count++){ 
<a name="l00369"></a>00369       <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *tmp = <a class="code" href="res__config__ldap_8c.html#a8f096254a39794606157ea3b7c30428a" title="Get variables from ldap entry attributes - Should be locked before using it.">realtime_ldap_entry_to_var</a>(table_config, ldap_entry);
<a name="l00370"></a>00370       tot_count += <a class="code" href="res__config__ldap_8c.html#a71f707ac3e35d04940f4e4b357604b65">semicolon_count_var</a>(tmp);
<a name="l00371"></a>00371       ldap_entry = ldap_next_entry(<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>, ldap_entry);
<a name="l00372"></a>00372       <a class="code" href="config_8h.html#ad3d8122172af6f13687a07840411d65d" title="Free variable list.">ast_variables_destroy</a>(tmp);
<a name="l00373"></a>00373    }
<a name="l00374"></a>00374 
<a name="l00375"></a>00375    <span class="keywordflow">if</span> (entries_count_ptr)
<a name="l00376"></a>00376       *entries_count_ptr = tot_count;
<a name="l00377"></a>00377    <span class="comment">/* Now that we have the total count we allocate space and create the variables</span>
<a name="l00378"></a>00378 <span class="comment">    * Remember that each element in vars is a linked list that points to realtime variable.</span>
<a name="l00379"></a>00379 <span class="comment">    * If the we are dealing with a static realtime variable we create a new element in the \a vars array for each delimited</span>
<a name="l00380"></a>00380 <span class="comment">    * value in \a variable_value; otherwise, we keep \a vars static and increase the length of the linked list of variables in the array element.</span>
<a name="l00381"></a>00381 <span class="comment">    * This memory must be freed outside of this function. */</span>
<a name="l00382"></a>00382    vars = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *), tot_count + 1);
<a name="l00383"></a>00383 
<a name="l00384"></a>00384    ldap_entry = ldap_first_entry(<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>, ldap_result_msg);
<a name="l00385"></a>00385 
<a name="l00386"></a>00386    i = 0;
<a name="l00387"></a>00387 
<a name="l00388"></a>00388    <span class="comment">/* For each static realtime variable we may create several entries in the \a vars array if it&apos;s delimited */</span>
<a name="l00389"></a>00389    <span class="keywordflow">for</span> (entry_index = 0; ldap_entry; ) { 
<a name="l00390"></a>00390       <span class="keywordtype">int</span> pos = 0;
<a name="l00391"></a>00391       delim_value = NULL;
<a name="l00392"></a>00392       delim_tot_count = 0;
<a name="l00393"></a>00393       delim_count = 0;
<a name="l00394"></a>00394       
<a name="l00395"></a>00395       <span class="keywordflow">do</span> { <span class="comment">/* while delim_count */</span>
<a name="l00396"></a>00396 
<a name="l00397"></a>00397          <span class="comment">/* Starting new static var */</span>
<a name="l00398"></a>00398          <span class="keywordtype">char</span> *ldap_attribute_name = ldap_first_attribute(<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>, ldap_entry, &amp;ber);
<a name="l00399"></a>00399          <span class="keyword">struct </span>berval *value;
<a name="l00400"></a>00400          <span class="keywordflow">while</span> (ldap_attribute_name) {
<a name="l00401"></a>00401          
<a name="l00402"></a>00402             <span class="keyword">const</span> <span class="keywordtype">char</span> *attribute_name =
<a name="l00403"></a>00403                <a class="code" href="res__config__ldap_8c.html#a52dda9a11e8f46e1b735dad87d03f2cd" title="Convert ldap attribute name to variable name - Should be locked before using it.">convert_attribute_name_from_ldap</a>(table_config, ldap_attribute_name);
<a name="l00404"></a>00404             <span class="keywordtype">int</span> is_realmed_password_attribute = strcasecmp(attribute_name, <span class="stringliteral">&quot;md5secret&quot;</span>) == 0;
<a name="l00405"></a>00405             <span class="keyword">struct </span>berval **<a class="code" href="structvalues.html">values</a> = NULL;
<a name="l00406"></a>00406 
<a name="l00407"></a>00407             values = ldap_get_values_len(<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>, ldap_entry, ldap_attribute_name);
<a name="l00408"></a>00408             <span class="keywordflow">if</span> (values) {
<a name="l00409"></a>00409                <span class="keyword">struct </span>berval **v;
<a name="l00410"></a>00410                <span class="keywordtype">char</span> *valptr;
<a name="l00411"></a>00411 
<a name="l00412"></a>00412                <span class="keywordflow">for</span> (v = values; *v; v++) {
<a name="l00413"></a>00413                   value = *v;
<a name="l00414"></a>00414                   valptr = value-&gt;bv_val;
<a name="l00415"></a>00415                   <span class="keywordflow">if</span> (is_realmed_password_attribute) {
<a name="l00416"></a>00416                      <span class="keywordflow">if</span> (strncasecmp(valptr, <span class="stringliteral">&quot;{md5}&quot;</span>, 5) == 0) {
<a name="l00417"></a>00417                         valptr += 5;
<a name="l00418"></a>00418                      } <span class="keywordflow">else</span> {
<a name="l00419"></a>00419                         valptr = NULL;
<a name="l00420"></a>00420                      }
<a name="l00421"></a>00421                      <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;md5: %s\n&quot;</span>, valptr);
<a name="l00422"></a>00422                   }
<a name="l00423"></a>00423                   <span class="keywordflow">if</span> (valptr) {
<a name="l00424"></a>00424                      <span class="keywordflow">if</span> (delim_value == NULL 
<a name="l00425"></a>00425                         &amp;&amp; !is_realmed_password_attribute 
<a name="l00426"></a>00426                         &amp;&amp; (<a class="code" href="res__config__ldap_8c.html#a4b7f6e04c04ac98ed68f7d62640d1d7b">static_table_config</a> != table_config || strcmp(attribute_name, <span class="stringliteral">&quot;variable_value&quot;</span>) == 0)) {
<a name="l00427"></a>00427 
<a name="l00428"></a>00428                         delim_value = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(valptr);
<a name="l00429"></a>00429 
<a name="l00430"></a>00430                         <span class="keywordflow">if</span> ((delim_tot_count = <a class="code" href="res__config__ldap_8c.html#ac99a0cc028315173eafc14f1079a072b" title="for the semicolon delimiter">semicolon_count_str</a>(delim_value)) &gt; 0) {
<a name="l00431"></a>00431                            <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(4, <span class="stringliteral">&quot;LINE(%d) is delimited %d times: %s\n&quot;</span>, __LINE__, delim_tot_count, delim_value);
<a name="l00432"></a>00432                            is_delimited = 1;
<a name="l00433"></a>00433                         }
<a name="l00434"></a>00434                      }
<a name="l00435"></a>00435 
<a name="l00436"></a>00436                      <span class="keywordflow">if</span> (is_delimited != 0 
<a name="l00437"></a>00437                         &amp;&amp; !is_realmed_password_attribute 
<a name="l00438"></a>00438                         &amp;&amp; (<a class="code" href="res__config__ldap_8c.html#a4b7f6e04c04ac98ed68f7d62640d1d7b">static_table_config</a> != table_config || strcmp(attribute_name, <span class="stringliteral">&quot;variable_value&quot;</span>) == 0) ) {
<a name="l00439"></a>00439                         <span class="comment">/* for non-Static RealTime, first */</span>
<a name="l00440"></a>00440 
<a name="l00441"></a>00441                         <span class="keywordflow">for</span> (i = pos; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(valptr + i); i++) {
<a name="l00442"></a>00442                            <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(4, <span class="stringliteral">&quot;LINE(%d) DELIM pos: %d i: %d\n&quot;</span>, __LINE__, pos, i);
<a name="l00443"></a>00443                            <span class="keywordflow">if</span> (delim_value[i] == <span class="charliteral">&apos;;&apos;</span>) {
<a name="l00444"></a>00444                               delim_value[i] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00445"></a>00445 
<a name="l00446"></a>00446                               <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;LINE(%d) DELIM - attribute_name: %s value: %s pos: %d\n&quot;</span>, __LINE__, attribute_name, &amp;delim_value[pos], pos);
<a name="l00447"></a>00447                      
<a name="l00448"></a>00448                               <span class="keywordflow">if</span> (prev) {
<a name="l00449"></a>00449                                  prev-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a> = <a class="code" href="config_8h.html#a08e94d96f459e7301a74daf32035423b">ast_variable_new</a>(attribute_name, &amp;delim_value[pos], table_config-&gt;<a class="code" href="structldap__table__config.html#ab013af67ba953d509575c86d9e65da44">table_name</a>);
<a name="l00450"></a>00450                                  <span class="keywordflow">if</span> (prev-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l00451"></a>00451                                     prev = prev-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>;
<a name="l00452"></a>00452                                  }
<a name="l00453"></a>00453                               } <span class="keywordflow">else</span> {
<a name="l00454"></a>00454                                  prev = var = <a class="code" href="config_8h.html#a08e94d96f459e7301a74daf32035423b">ast_variable_new</a>(attribute_name, &amp;delim_value[pos], table_config-&gt;<a class="code" href="structldap__table__config.html#ab013af67ba953d509575c86d9e65da44">table_name</a>);
<a name="l00455"></a>00455                               }
<a name="l00456"></a>00456                               pos = i + 1;
<a name="l00457"></a>00457 
<a name="l00458"></a>00458                               <span class="keywordflow">if</span> (<a class="code" href="res__config__ldap_8c.html#a4b7f6e04c04ac98ed68f7d62640d1d7b">static_table_config</a> == table_config) {
<a name="l00459"></a>00459                                  <span class="keywordflow">break</span>;
<a name="l00460"></a>00460                               }
<a name="l00461"></a>00461                            }
<a name="l00462"></a>00462                         }
<a name="l00463"></a>00463                         <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(valptr + i)) {
<a name="l00464"></a>00464                            <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(4, <span class="stringliteral">&quot;LINE(%d) DELIM pos: %d i: %d delim_count: %d\n&quot;</span>, __LINE__, pos, i, delim_count);
<a name="l00465"></a>00465                            <span class="comment">/* Last delimited value */</span>
<a name="l00466"></a>00466                            <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(4, <span class="stringliteral">&quot;LINE(%d) DELIM - attribute_name: %s value: %s pos: %d\n&quot;</span>, __LINE__, attribute_name, &amp;delim_value[pos], pos);
<a name="l00467"></a>00467                            <span class="keywordflow">if</span> (prev) {
<a name="l00468"></a>00468                               prev-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a> = <a class="code" href="config_8h.html#a08e94d96f459e7301a74daf32035423b">ast_variable_new</a>(attribute_name, &amp;delim_value[pos], table_config-&gt;<a class="code" href="structldap__table__config.html#ab013af67ba953d509575c86d9e65da44">table_name</a>);
<a name="l00469"></a>00469                               <span class="keywordflow">if</span> (prev-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l00470"></a>00470                                  prev = prev-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>;
<a name="l00471"></a>00471                               }
<a name="l00472"></a>00472                            } <span class="keywordflow">else</span> {
<a name="l00473"></a>00473                               prev = var = <a class="code" href="config_8h.html#a08e94d96f459e7301a74daf32035423b">ast_variable_new</a>(attribute_name, &amp;delim_value[pos], table_config-&gt;<a class="code" href="structldap__table__config.html#ab013af67ba953d509575c86d9e65da44">table_name</a>);
<a name="l00474"></a>00474                            }
<a name="l00475"></a>00475                            <span class="comment">/* Remembering to free memory */</span>
<a name="l00476"></a>00476                            is_delimited = 0;
<a name="l00477"></a>00477                            pos = 0;
<a name="l00478"></a>00478                         }
<a name="l00479"></a>00479                         <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(delim_value);
<a name="l00480"></a>00480                         delim_value = NULL;
<a name="l00481"></a>00481                         
<a name="l00482"></a>00482                         <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(4, <span class="stringliteral">&quot;LINE(%d) DELIM pos: %d i: %d\n&quot;</span>, __LINE__, pos, i);
<a name="l00483"></a>00483                      } <span class="keywordflow">else</span> {
<a name="l00484"></a>00484                         <span class="comment">/* not delimited */</span>
<a name="l00485"></a>00485                         <span class="keywordflow">if</span> (delim_value) {
<a name="l00486"></a>00486                            <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(delim_value);
<a name="l00487"></a>00487                            delim_value = NULL;
<a name="l00488"></a>00488                         }
<a name="l00489"></a>00489                         <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;LINE(%d) attribute_name: %s value: %s\n&quot;</span>, __LINE__, attribute_name, valptr);
<a name="l00490"></a>00490 
<a name="l00491"></a>00491                         <span class="keywordflow">if</span> (prev) {
<a name="l00492"></a>00492                            prev-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a> = <a class="code" href="config_8h.html#a08e94d96f459e7301a74daf32035423b">ast_variable_new</a>(attribute_name, valptr, table_config-&gt;<a class="code" href="structldap__table__config.html#ab013af67ba953d509575c86d9e65da44">table_name</a>);
<a name="l00493"></a>00493                            <span class="keywordflow">if</span> (prev-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l00494"></a>00494                               prev = prev-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>;
<a name="l00495"></a>00495                            }
<a name="l00496"></a>00496                         } <span class="keywordflow">else</span> {
<a name="l00497"></a>00497                            prev = var = <a class="code" href="config_8h.html#a08e94d96f459e7301a74daf32035423b">ast_variable_new</a>(attribute_name, valptr, table_config-&gt;<a class="code" href="structldap__table__config.html#ab013af67ba953d509575c86d9e65da44">table_name</a>);
<a name="l00498"></a>00498                         }
<a name="l00499"></a>00499                      }
<a name="l00500"></a>00500                   }
<a name="l00501"></a>00501                } <span class="comment">/*!&lt; for (v = values; *v; v++) */</span>
<a name="l00502"></a>00502                ldap_value_free_len(values);
<a name="l00503"></a>00503             }<span class="comment">/*!&lt; if (values) */</span>
<a name="l00504"></a>00504             ldap_attribute_name = ldap_next_attribute(<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>, ldap_entry, ber);
<a name="l00505"></a>00505          } <span class="comment">/*!&lt; while (ldap_attribute_name) */</span>
<a name="l00506"></a>00506          <span class="comment">//ber_free(ber, 0);</span>
<a name="l00507"></a>00507          <span class="keywordflow">if</span> (<a class="code" href="res__config__ldap_8c.html#a4b7f6e04c04ac98ed68f7d62640d1d7b">static_table_config</a> == table_config) {
<a name="l00508"></a>00508             <span class="keywordflow">if</span> (<a class="code" href="group__main__options.html#ga40f8fb2e731031d99f732f515cec680f">option_debug</a> &gt; 2) {
<a name="l00509"></a>00509                <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *tmpdebug = <a class="code" href="res__config__ldap_8c.html#a9614b129f70fd9cfbaaf78b6d64b3b16" title="Find variable by name.">variable_named</a>(var, <span class="stringliteral">&quot;variable_name&quot;</span>);
<a name="l00510"></a>00510                <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *tmpdebug2 = <a class="code" href="res__config__ldap_8c.html#a9614b129f70fd9cfbaaf78b6d64b3b16" title="Find variable by name.">variable_named</a>(var, <span class="stringliteral">&quot;variable_value&quot;</span>);
<a name="l00511"></a>00511                <span class="keywordflow">if</span> (tmpdebug &amp;&amp; tmpdebug2) {
<a name="l00512"></a>00512                   <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(3, <span class="stringliteral">&quot;LINE(%d) Added to vars - %s = %s\n&quot;</span>, __LINE__, tmpdebug-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, tmpdebug2-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l00513"></a>00513                }
<a name="l00514"></a>00514             }
<a name="l00515"></a>00515             vars[entry_index++] = var;
<a name="l00516"></a>00516             prev = NULL;
<a name="l00517"></a>00517          }
<a name="l00518"></a>00518 
<a name="l00519"></a>00519          delim_count++;
<a name="l00520"></a>00520       } <span class="keywordflow">while</span> (delim_count &lt;= delim_tot_count &amp;&amp; <a class="code" href="res__config__ldap_8c.html#a4b7f6e04c04ac98ed68f7d62640d1d7b">static_table_config</a> == table_config);
<a name="l00521"></a>00521 
<a name="l00522"></a>00522       <span class="keywordflow">if</span> (<a class="code" href="res__config__ldap_8c.html#a4b7f6e04c04ac98ed68f7d62640d1d7b">static_table_config</a> != table_config) {
<a name="l00523"></a>00523          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(3, <span class="stringliteral">&quot;LINE(%d) Added to vars - non static\n&quot;</span>, __LINE__);
<a name="l00524"></a>00524             
<a name="l00525"></a>00525          vars[entry_index++] = var;
<a name="l00526"></a>00526          prev = NULL;
<a name="l00527"></a>00527       }
<a name="l00528"></a>00528       ldap_entry = ldap_next_entry(<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>, ldap_entry);
<a name="l00529"></a>00529    } <span class="comment">/*!&lt; end for loop over ldap_entry */</span>
<a name="l00530"></a>00530 
<a name="l00531"></a>00531    <span class="keywordflow">return</span> vars;
<a name="l00532"></a>00532 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad51f9133e1f5e9260cb80c8fd38b60d7"></a><!-- doxytag: member="res_config_ldap.c::realtime_ldap_status" ref="ad51f9133e1f5e9260cb80c8fd38b60d7" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char * realtime_ldap_status </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l01717">1717</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>References <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="cli_8h_source.html#l00045">CLI_FAILURE</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, <a class="el" href="app__jack_8c_source.html#l00141">status</a>, and <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01718"></a>01718 {
<a name="l01719"></a>01719    <span class="keywordtype">char</span> <a class="code" href="app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a>[256], credentials[100] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l01720"></a>01720    <span class="keywordtype">int</span> ctimesec = time(NULL) - <a class="code" href="res__config__ldap_8c.html#ac4ae24c7b766713b82921c04d1a4b699">connect_time</a>;
<a name="l01721"></a>01721 
<a name="l01722"></a>01722    <span class="keywordflow">switch</span> (cmd) {
<a name="l01723"></a>01723    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l01724"></a>01724       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;realtime show ldap status&quot;</span>;
<a name="l01725"></a>01725       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
<a name="l01726"></a>01726          <span class="stringliteral">&quot;Usage: realtime show ldap status\n&quot;</span>
<a name="l01727"></a>01727          <span class="stringliteral">&quot;               Shows connection information for the LDAP RealTime driver\n&quot;</span>;
<a name="l01728"></a>01728       <span class="keywordflow">return</span> NULL;
<a name="l01729"></a>01729    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l01730"></a>01730       <span class="keywordflow">return</span> NULL;
<a name="l01731"></a>01731    }
<a name="l01732"></a>01732 
<a name="l01733"></a>01733    <span class="keywordflow">if</span> (!<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>)
<a name="l01734"></a>01734       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;
<a name="l01735"></a>01735 
<a name="l01736"></a>01736    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="res__config__ldap_8c.html#a75e4590043edf35241d30fabe2eda546">url</a>)) 
<a name="l01737"></a>01737       snprintf(status, <span class="keyword">sizeof</span>(status), <span class="stringliteral">&quot;Connected to &apos;%s&apos;, baseDN %s&quot;</span>, <a class="code" href="res__config__ldap_8c.html#a75e4590043edf35241d30fabe2eda546">url</a>, <a class="code" href="res__config__ldap_8c.html#acfd19a5e5bb3f90e330bd660b743970f">base_distinguished_name</a>);
<a name="l01738"></a>01738 
<a name="l01739"></a>01739    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="structuser.html" title="structure to hold users read from users.conf">user</a>))
<a name="l01740"></a>01740       snprintf(credentials, <span class="keyword">sizeof</span>(credentials), <span class="stringliteral">&quot; with username %s&quot;</span>, <a class="code" href="structuser.html" title="structure to hold users read from users.conf">user</a>);
<a name="l01741"></a>01741 
<a name="l01742"></a>01742    <span class="keywordflow">if</span> (ctimesec &gt; 31536000) {
<a name="l01743"></a>01743       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;%s%s for %d years, %d days, %d hours, %d minutes, %d seconds.\n&quot;</span>,
<a name="l01744"></a>01744             status, credentials, ctimesec / 31536000,
<a name="l01745"></a>01745             (ctimesec % 31536000) / 86400, (ctimesec % 86400) / 3600,
<a name="l01746"></a>01746             (ctimesec % 3600) / 60, ctimesec % 60);
<a name="l01747"></a>01747    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ctimesec &gt; 86400) {
<a name="l01748"></a>01748       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;%s%s for %d days, %d hours, %d minutes, %d seconds.\n&quot;</span>,
<a name="l01749"></a>01749             status, credentials, ctimesec / 86400, (ctimesec % 86400) / 3600,
<a name="l01750"></a>01750             (ctimesec % 3600) / 60, ctimesec % 60);
<a name="l01751"></a>01751    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ctimesec &gt; 3600) {
<a name="l01752"></a>01752       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;%s%s for %d hours, %d minutes, %d seconds.\n&quot;</span>,
<a name="l01753"></a>01753             status, credentials, ctimesec / 3600, (ctimesec % 3600) / 60,
<a name="l01754"></a>01754             ctimesec % 60);
<a name="l01755"></a>01755    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ctimesec &gt; 60) {
<a name="l01756"></a>01756       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;%s%s for %d minutes, %d seconds.\n&quot;</span>, status, credentials,
<a name="l01757"></a>01757                ctimesec / 60, ctimesec % 60);
<a name="l01758"></a>01758    } <span class="keywordflow">else</span> {
<a name="l01759"></a>01759       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;%s%s for %d seconds.\n&quot;</span>, status, credentials, ctimesec);
<a name="l01760"></a>01760    }
<a name="l01761"></a>01761 
<a name="l01762"></a>01762    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l01763"></a>01763 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a03bfa1966598dbac9d32da0a3e7ed520"></a><!-- doxytag: member="res_config_ldap.c::realtime_multi_ldap" ref="a03bfa1966598dbac9d32da0a3e7ed520" args="(const char *basedn, const char *table_name, va_list ap)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__config.html">ast_config</a>* realtime_multi_ldap </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>basedn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>table_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">va_list&nbsp;</td>
          <td class="paramname"> <em>ap</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>See Asterisk doc. </p>
<p>this function will be called for the switch statment if no match is found with the realtime_ldap function(i.e. it is a failover); however, the ast_load_realtime wil match on wildcharacters also depending on what the mode is set to this is an area of asterisk that could do with a lot of modification I think this function returns Realtime dynamic objects </p>

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l00939">939</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>References <a class="el" href="config_8c_source.html#l00522">ast_category_append()</a>, <a class="el" href="config_8c_source.html#l00483">ast_category_new()</a>, <a class="el" href="config_8c_source.html#l00673">ast_config_new()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="config_8c_source.html#l00348">ast_variable_append()</a>, <a class="el" href="astmm_8h_source.html#l00084">free</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="config_8h_source.html#l00077">ast_variable::next</a>, <a class="el" href="res__config__ldap_8c_source.html#l00092">ldap_table_config::next</a>, <a class="el" href="res__config__ldap_8c_source.html#l00718">realtime_ldap_base_ap()</a>, and <a class="el" href="ast__expr2f_8c_source.html#l00613">var</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00941"></a>00941 {
<a name="l00942"></a>00942    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> **vars =
<a name="l00943"></a>00943       <a class="code" href="res__config__ldap_8c.html#a3037ce503252b1b50de11873d1a2a6c2" title="LDAP base function.">realtime_ldap_base_ap</a>(NULL, basedn, table_name, ap);
<a name="l00944"></a>00944    <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *cfg = NULL;
<a name="l00945"></a>00945 
<a name="l00946"></a>00946    <span class="keywordflow">if</span> (vars) {
<a name="l00947"></a>00947       cfg = <a class="code" href="config_8h.html#a45e1a284d7d84c4b4a316764fbb887fb" title="Create a new base configuration structure.">ast_config_new</a>();
<a name="l00948"></a>00948       <span class="keywordflow">if</span> (!cfg) {
<a name="l00949"></a>00949          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to create a config!\n&quot;</span>);
<a name="l00950"></a>00950       } <span class="keywordflow">else</span> {
<a name="l00951"></a>00951          <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> **p = vars;
<a name="l00952"></a>00952 
<a name="l00953"></a>00953          <span class="keywordflow">while</span> (*p) {
<a name="l00954"></a>00954             <span class="keyword">struct </span><a class="code" href="structast__category.html">ast_category</a> *cat = NULL;
<a name="l00955"></a>00955             cat = <a class="code" href="config_8h.html#affebac76d69639677b677037d9871e29" title="Create a category structure.">ast_category_new</a>(<span class="stringliteral">&quot;&quot;</span>, table_name, -1);
<a name="l00956"></a>00956             <span class="keywordflow">if</span> (!cat) {
<a name="l00957"></a>00957                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to create a new category!\n&quot;</span>);
<a name="l00958"></a>00958                <span class="keywordflow">break</span>;
<a name="l00959"></a>00959             } <span class="keywordflow">else</span> {
<a name="l00960"></a>00960                <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a> = *p;
<a name="l00961"></a>00961                <span class="keywordflow">while</span> (var) {
<a name="l00962"></a>00962                   <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a> = var-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>;
<a name="l00963"></a>00963                   var-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a> = NULL;
<a name="l00964"></a>00964                   <a class="code" href="config_8h.html#a132ddbd39dd9d26395c410f7647f76db">ast_variable_append</a>(cat, var);
<a name="l00965"></a>00965                   var = next;
<a name="l00966"></a>00966                }
<a name="l00967"></a>00967             }
<a name="l00968"></a>00968             <a class="code" href="config_8h.html#ab7b56ec66b058952423f313752c734e7">ast_category_append</a>(cfg, cat);
<a name="l00969"></a>00969             p++;
<a name="l00970"></a>00970          }
<a name="l00971"></a>00971       }
<a name="l00972"></a>00972       <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(vars);
<a name="l00973"></a>00973    }
<a name="l00974"></a>00974    <span class="keywordflow">return</span> cfg;
<a name="l00975"></a>00975 
<a name="l00976"></a>00976 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad1982509765f4870f1f63412a53ea668"></a><!-- doxytag: member="res_config_ldap.c::reload" ref="ad1982509765f4870f1f63412a53ea668" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int reload </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l01550">1550</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="res__config__ldap_8c_source.html#l00064">ldap_lock</a>, <a class="el" href="res__config__ldap_8c_source.html#l01670">ldap_reconnect()</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, and <a class="el" href="res__config__ldap_8c_source.html#l01577">parse_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01551"></a>01551 {
<a name="l01552"></a>01552    <span class="comment">/* Aquire control before doing anything to the module itself. */</span>
<a name="l01553"></a>01553    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;<a class="code" href="res__config__ldap_8c.html#a55f48ee8d8b928c4d52e3d2182a17091">ldap_lock</a>);
<a name="l01554"></a>01554 
<a name="l01555"></a>01555    <span class="keywordflow">if</span> (<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>) {
<a name="l01556"></a>01556       ldap_unbind_ext_s(<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>, NULL, NULL);
<a name="l01557"></a>01557       <a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a> = NULL;
<a name="l01558"></a>01558    }
<a name="l01559"></a>01559 
<a name="l01560"></a>01560    <span class="keywordflow">if</span> (<a class="code" href="res__config__ldap_8c.html#af9f24c4cf29126b1832517b188aeb585">parse_config</a>() &lt; 0) {
<a name="l01561"></a>01561       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Cannot reload LDAP RealTime driver.\n&quot;</span>);
<a name="l01562"></a>01562       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="res__config__ldap_8c.html#a55f48ee8d8b928c4d52e3d2182a17091">ldap_lock</a>);
<a name="l01563"></a>01563       <span class="keywordflow">return</span> 0;
<a name="l01564"></a>01564    }     
<a name="l01565"></a>01565 
<a name="l01566"></a>01566    <span class="keywordflow">if</span> (!<a class="code" href="res__config__ldap_8c.html#a77f9d4c9f33d2f29e98c5c8cc09e9119">ldap_reconnect</a>()) 
<a name="l01567"></a>01567       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Couldn&apos;t establish connection. Check debug.\n&quot;</span>);
<a name="l01568"></a>01568 
<a name="l01569"></a>01569    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;LDAP RealTime reloaded.\n&quot;</span>);
<a name="l01570"></a>01570 
<a name="l01571"></a>01571    <span class="comment">/* Done reloading. Release lock so others can now use driver. */</span>
<a name="l01572"></a>01572    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="res__config__ldap_8c.html#a55f48ee8d8b928c4d52e3d2182a17091">ldap_lock</a>);
<a name="l01573"></a>01573 
<a name="l01574"></a>01574    <span class="keywordflow">return</span> 0;
<a name="l01575"></a>01575 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a35abb75797a3e63bcaf26e917fb548fd"></a><!-- doxytag: member="res_config_ldap.c::replace_string_in_string" ref="a35abb75797a3e63bcaf26e917fb548fd" args="(char *string, const char *search, const char *by)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int replace_string_in_string </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>string</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>search</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>by</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Replace &lt;search&gt; by &lt;by&gt; in string. No check is done on string allocated size ! </p>

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l00663">663</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>Referenced by <a class="el" href="res__config__ldap_8c_source.html#l00686">append_var_and_value_to_filter()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00664"></a>00664 {
<a name="l00665"></a>00665    <span class="keywordtype">int</span> search_len = strlen(search);
<a name="l00666"></a>00666    <span class="keywordtype">int</span> by_len = strlen(by);
<a name="l00667"></a>00667    <span class="keywordtype">int</span> replaced = 0;
<a name="l00668"></a>00668    <span class="keywordtype">char</span> *p = strstr(<span class="keywordtype">string</span>, search);
<a name="l00669"></a>00669    <span class="keywordflow">if</span> (p) {
<a name="l00670"></a>00670       replaced = 1;
<a name="l00671"></a>00671       <span class="keywordflow">while</span> (p) {
<a name="l00672"></a>00672          <span class="keywordflow">if</span> (by_len == search_len)
<a name="l00673"></a>00673             memcpy(p, by, by_len);
<a name="l00674"></a>00674          <span class="keywordflow">else</span> {
<a name="l00675"></a>00675             memmove(p + by_len, p + search_len,
<a name="l00676"></a>00676                   strlen(p + search_len) + 1);
<a name="l00677"></a>00677             memcpy(p, by, by_len);
<a name="l00678"></a>00678          }
<a name="l00679"></a>00679          p = strstr(p + by_len, search);
<a name="l00680"></a>00680       }
<a name="l00681"></a>00681    }
<a name="l00682"></a>00682    <span class="keywordflow">return</span> replaced;
<a name="l00683"></a>00683 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac99a0cc028315173eafc14f1079a072b"></a><!-- doxytag: member="res_config_ldap.c::semicolon_count_str" ref="ac99a0cc028315173eafc14f1079a072b" args="(const char *somestr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int semicolon_count_str </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>somestr</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>for the semicolon delimiter </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>somestr</em>&nbsp;</td><td>- pointer to a string</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd><a class="el" href="structnumber.html" title="Number structure.">number</a> of occurances of the delimiter(semicolon) </dd></dl>

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l00153">153</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>Referenced by <a class="el" href="res__config__ldap_8c_source.html#l00349">realtime_ldap_result_to_vars()</a>, and <a class="el" href="res__config__ldap_8c_source.html#l00168">semicolon_count_var()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00154"></a>00154 {
<a name="l00155"></a>00155    <span class="keywordtype">int</span> count = 0;
<a name="l00156"></a>00156 
<a name="l00157"></a>00157    <span class="keywordflow">for</span> (; *somestr; somestr++) {
<a name="l00158"></a>00158       <span class="keywordflow">if</span> (*somestr == <span class="charliteral">&apos;;&apos;</span>)
<a name="l00159"></a>00159          count++;
<a name="l00160"></a>00160    }
<a name="l00161"></a>00161 
<a name="l00162"></a>00162    <span class="keywordflow">return</span> count;
<a name="l00163"></a>00163 } 
</pre></div></p>

</div>
</div>
<a class="anchor" id="a71f707ac3e35d04940f4e4b357604b65"></a><!-- doxytag: member="res_config_ldap.c::semicolon_count_var" ref="a71f707ac3e35d04940f4e4b357604b65" args="(struct ast_variable *var)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int semicolon_count_var </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__variable.html">ast_variable</a> *&nbsp;</td>
          <td class="paramname"> <em>var</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l00168">168</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="res__config__ldap_8c_source.html#l00153">semicolon_count_str()</a>, <a class="el" href="config_8h_source.html#l00076">ast_variable::value</a>, and <a class="el" href="res__config__ldap_8c_source.html#l00138">variable_named()</a>.</p>

<p>Referenced by <a class="el" href="res__config__ldap_8c_source.html#l00349">realtime_ldap_result_to_vars()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00169"></a>00169 {
<a name="l00170"></a>00170    <span class="keyword">struct </span><a class="code" href="structast__variable.html" title="Structure for variables, used for configurations and for channel variables.">ast_variable</a> *var_value = <a class="code" href="res__config__ldap_8c.html#a9614b129f70fd9cfbaaf78b6d64b3b16" title="Find variable by name.">variable_named</a>(var, <span class="stringliteral">&quot;variable_value&quot;</span>);
<a name="l00171"></a>00171 
<a name="l00172"></a>00172    <span class="keywordflow">if</span> (!var_value)
<a name="l00173"></a>00173       <span class="keywordflow">return</span> 0;
<a name="l00174"></a>00174 
<a name="l00175"></a>00175    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;LINE(%d) semicolon_count_var: %s\n&quot;</span>, __LINE__, var_value-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l00176"></a>00176 
<a name="l00177"></a>00177    <span class="keywordflow">return</span> <a class="code" href="res__config__ldap_8c.html#ac99a0cc028315173eafc14f1079a072b" title="for the semicolon delimiter">semicolon_count_str</a>(var_value-&gt;<a class="code" href="structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);
<a name="l00178"></a>00178 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0ce420ebc55160125af52208e87b80ca"></a><!-- doxytag: member="res_config_ldap.c::substituted" ref="a0ce420ebc55160125af52208e87b80ca" args="(struct ast_channel *channel, const char *string)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* substituted </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>channel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>string</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>caller should free returned pointer </p>

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l00621">621</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="app__exec_8c_source.html#l00114">MAXRESULT</a>, and <a class="el" href="pbx_8c_source.html#l03598">pbx_substitute_variables_helper()</a>.</p>

<p>Referenced by <a class="el" href="res__config__ldap_8c_source.html#l00636">cleaned_basedn()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00622"></a>00622 {
<a name="l00623"></a>00623 <span class="preprocessor">#define MAXRESULT 2048</span>
<a name="l00624"></a>00624 <span class="preprocessor"></span>   <span class="keywordtype">char</span> *ret_string = NULL;
<a name="l00625"></a>00625 
<a name="l00626"></a>00626    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<span class="keywordtype">string</span>)) {
<a name="l00627"></a>00627       ret_string = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <a class="code" href="app__exec_8c.html#a316b7b96e4e4d444e5703a69e7574ff0">MAXRESULT</a>);
<a name="l00628"></a>00628       <a class="code" href="pbx_8h.html#a3eac2009888ce9c4a108e882d02cb04d">pbx_substitute_variables_helper</a>(channel, <span class="keywordtype">string</span>, ret_string, <a class="code" href="app__exec_8c.html#a316b7b96e4e4d444e5703a69e7574ff0">MAXRESULT</a> - 1);
<a name="l00629"></a>00629    }
<a name="l00630"></a>00630    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;substituted: string: &apos;%s&apos; =&gt; &apos;%s&apos; \n&quot;</span>,
<a name="l00631"></a>00631       <span class="keywordtype">string</span>, ret_string);
<a name="l00632"></a>00632    <span class="keywordflow">return</span> ret_string;
<a name="l00633"></a>00633 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5d395421629c28b7bd00359041440917"></a><!-- doxytag: member="res_config_ldap.c::table_config_for_table_name" ref="a5d395421629c28b7bd00359041440917" args="(const char *table_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structldap__table__config.html">ldap_table_config</a>* table_config_for_table_name </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>table_name</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Find a table_config - Should be locked before using it. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>This function assumes ldap_lock to be locked. </dd></dl>

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l00125">125</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="structldap__table__config.html#a08bd9e7a7d85b79f53c0973c5c3a0406">ldap_table_config::entry</a>, and <a class="el" href="res__config__ldap_8c_source.html#l00088">ldap_table_config::table_name</a>.</p>

<p>Referenced by <a class="el" href="res__config__ldap_8c_source.html#l01577">parse_config()</a>, <a class="el" href="res__config__ldap_8c_source.html#l00718">realtime_ldap_base_ap()</a>, <a class="el" href="res__config__ldap_8c_source.html#l01315">update2_ldap()</a>, and <a class="el" href="res__config__ldap_8c_source.html#l01128">update_ldap()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00126"></a>00126 {
<a name="l00127"></a>00127    <span class="keyword">struct </span><a class="code" href="structldap__table__config.html" title="Table configuration.">ldap_table_config</a> *c = NULL;
<a name="l00128"></a>00128 
<a name="l00129"></a>00129    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="structtable__configs.html" title="Should be locked before using it.">table_configs</a>, c, <a class="code" href="structldap__table__config.html#a08bd9e7a7d85b79f53c0973c5c3a0406">entry</a>) {
<a name="l00130"></a>00130       <span class="keywordflow">if</span> (!strcmp(c-&gt;<a class="code" href="structldap__table__config.html#ab013af67ba953d509575c86d9e65da44">table_name</a>, <a class="code" href="structldap__table__config.html#ab013af67ba953d509575c86d9e65da44">table_name</a>))
<a name="l00131"></a>00131          <span class="keywordflow">break</span>;
<a name="l00132"></a>00132    }
<a name="l00133"></a>00133 
<a name="l00134"></a>00134    <span class="keywordflow">return</span> c;
<a name="l00135"></a>00135 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8c9c18709185dad2a12c74c00d95d180"></a><!-- doxytag: member="res_config_ldap.c::table_config_new" ref="a8c9c18709185dad2a12c74c00d95d180" args="(const char *table_name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structldap__table__config.html">ldap_table_config</a>* table_config_new </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>table_name</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Create a new table_config. </p>

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l00106">106</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="astmm_8h_source.html#l00084">free</a>, and <a class="el" href="res__config__ldap_8c_source.html#l00088">ldap_table_config::table_name</a>.</p>

<p>Referenced by <a class="el" href="res__config__ldap_8c_source.html#l01577">parse_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00107"></a>00107 {
<a name="l00108"></a>00108    <span class="keyword">struct </span><a class="code" href="structldap__table__config.html" title="Table configuration.">ldap_table_config</a> *p;
<a name="l00109"></a>00109 
<a name="l00110"></a>00110    <span class="keywordflow">if</span> (!(p = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*p))))
<a name="l00111"></a>00111       <span class="keywordflow">return</span> NULL;
<a name="l00112"></a>00112 
<a name="l00113"></a>00113    <span class="keywordflow">if</span> (<a class="code" href="structldap__table__config.html#ab013af67ba953d509575c86d9e65da44">table_name</a>) {
<a name="l00114"></a>00114       <span class="keywordflow">if</span> (!(p-&gt;<a class="code" href="structldap__table__config.html#ab013af67ba953d509575c86d9e65da44">table_name</a> = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(<a class="code" href="structldap__table__config.html#ab013af67ba953d509575c86d9e65da44">table_name</a>))) {
<a name="l00115"></a>00115          <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(p);
<a name="l00116"></a>00116          <span class="keywordflow">return</span> NULL;
<a name="l00117"></a>00117       }
<a name="l00118"></a>00118    }
<a name="l00119"></a>00119 
<a name="l00120"></a>00120    <span class="keywordflow">return</span> p;
<a name="l00121"></a>00121 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9155b18ff8ee6bb5b8b8bf7c32832ae1"></a><!-- doxytag: member="res_config_ldap.c::table_configs_free" ref="a9155b18ff8ee6bb5b8b8bf7c32832ae1" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void table_configs_free </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Free table_config. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>assumes ldap_lock to be locked </dd></dl>

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l00199">199</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>References <a class="el" href="res__config__ldap_8c_source.html#l00089">ldap_table_config::additional_filter</a>, <a class="el" href="linkedlists_8h_source.html#l00817">AST_LIST_REMOVE_HEAD</a>, <a class="el" href="config_8c_source.html#l00397">ast_variables_destroy()</a>, <a class="el" href="res__config__ldap_8c_source.html#l00090">ldap_table_config::attributes</a>, <a class="el" href="res__config__ldap_8c_source.html#l00098">base_table_config</a>, <a class="el" href="structldap__table__config.html#a08bd9e7a7d85b79f53c0973c5c3a0406">ldap_table_config::entry</a>, <a class="el" href="astmm_8h_source.html#l00084">free</a>, <a class="el" href="res__config__ldap_8c_source.html#l00099">static_table_config</a>, and <a class="el" href="res__config__ldap_8c_source.html#l00088">ldap_table_config::table_name</a>.</p>

<p>Referenced by <a class="el" href="res__config__ldap_8c_source.html#l01577">parse_config()</a>, and <a class="el" href="res__config__ldap_8c_source.html#l01529">unload_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00200"></a>00200 {
<a name="l00201"></a>00201    <span class="keyword">struct </span><a class="code" href="structldap__table__config.html" title="Table configuration.">ldap_table_config</a> *c;
<a name="l00202"></a>00202 
<a name="l00203"></a>00203    <span class="keywordflow">while</span> ((c = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;<a class="code" href="structtable__configs.html" title="Should be locked before using it.">table_configs</a>, <a class="code" href="structldap__table__config.html#a08bd9e7a7d85b79f53c0973c5c3a0406">entry</a>))) {
<a name="l00204"></a>00204       <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structldap__table__config.html#ab013af67ba953d509575c86d9e65da44">table_name</a>)
<a name="l00205"></a>00205          <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(c-&gt;<a class="code" href="structldap__table__config.html#ab013af67ba953d509575c86d9e65da44">table_name</a>);
<a name="l00206"></a>00206       <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structldap__table__config.html#aa6f8c05d7d124316fedcde5a15a5e0d6">additional_filter</a>)
<a name="l00207"></a>00207          <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(c-&gt;<a class="code" href="structldap__table__config.html#aa6f8c05d7d124316fedcde5a15a5e0d6">additional_filter</a>);
<a name="l00208"></a>00208       <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structldap__table__config.html#a4018e41e295dac80f9fad6ca95ec3a0d">attributes</a>)
<a name="l00209"></a>00209          <a class="code" href="config_8h.html#ad3d8122172af6f13687a07840411d65d" title="Free variable list.">ast_variables_destroy</a>(c-&gt;<a class="code" href="structldap__table__config.html#a4018e41e295dac80f9fad6ca95ec3a0d">attributes</a>);
<a name="l00210"></a>00210       <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(c);
<a name="l00211"></a>00211    }
<a name="l00212"></a>00212 
<a name="l00213"></a>00213    <a class="code" href="res__config__ldap_8c.html#a3c846177aac9c60160bea626fbc3225d">base_table_config</a> = NULL;
<a name="l00214"></a>00214    <a class="code" href="res__config__ldap_8c.html#a4b7f6e04c04ac98ed68f7d62640d1d7b">static_table_config</a> = NULL;
<a name="l00215"></a>00215 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad09fa931f468002152a3cc2d5ce25eae"></a><!-- doxytag: member="res_config_ldap.c::unload_module" ref="ad09fa931f468002152a3cc2d5ce25eae" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int unload_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l01529">1529</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="cli_8c_source.html#l01937">ast_cli_unregister_multiple()</a>, <a class="el" href="config_8c_source.html#l01969">ast_config_engine_deregister()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="res__config__ldap_8c_source.html#l00101">ldap_cli</a>, <a class="el" href="res__config__ldap_8c_source.html#l01499">ldap_engine</a>, <a class="el" href="res__config__ldap_8c_source.html#l00064">ldap_lock</a>, and <a class="el" href="res__config__ldap_8c_source.html#l00199">table_configs_free()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01530"></a>01530 {
<a name="l01531"></a>01531    <span class="comment">/* Aquire control before doing anything to the module itself. */</span>
<a name="l01532"></a>01532    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;<a class="code" href="res__config__ldap_8c.html#a55f48ee8d8b928c4d52e3d2182a17091">ldap_lock</a>);
<a name="l01533"></a>01533 
<a name="l01534"></a>01534    <a class="code" href="res__config__ldap_8c.html#a9155b18ff8ee6bb5b8b8bf7c32832ae1" title="Free table_config.">table_configs_free</a>();
<a name="l01535"></a>01535 
<a name="l01536"></a>01536    <span class="keywordflow">if</span> (<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>) {
<a name="l01537"></a>01537       ldap_unbind_ext_s(<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>, NULL, NULL);
<a name="l01538"></a>01538       <a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a> = NULL;
<a name="l01539"></a>01539    }
<a name="l01540"></a>01540    <a class="code" href="cli_8h.html#a56b6b59ee2eaa994597a5b0f4e9f9d09" title="Unregister multiple commands.">ast_cli_unregister_multiple</a>(<a class="code" href="res__config__ldap_8c.html#a561b0b21a0287f6db417ce1211336f0f">ldap_cli</a>, <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="res__config__ldap_8c.html#a561b0b21a0287f6db417ce1211336f0f">ldap_cli</a>));
<a name="l01541"></a>01541    <a class="code" href="config_8h.html#a7028ff4b11d7167ee4030b4d3e123d76" title="Deregister config engine.">ast_config_engine_deregister</a>(&amp;<a class="code" href="res__config__ldap_8c.html#a70367624d2d9a8df76df96ad482c1f01">ldap_engine</a>);
<a name="l01542"></a>01542    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(1, <span class="stringliteral">&quot;LDAP RealTime unloaded.\n&quot;</span>);
<a name="l01543"></a>01543 
<a name="l01544"></a>01544    <span class="comment">/* Unlock so something else can destroy the lock. */</span>
<a name="l01545"></a>01545    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="res__config__ldap_8c.html#a55f48ee8d8b928c4d52e3d2182a17091">ldap_lock</a>);
<a name="l01546"></a>01546 
<a name="l01547"></a>01547    <span class="keywordflow">return</span> 0;
<a name="l01548"></a>01548 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae80c2182af15b4603f48d87fc3c7a6a2"></a><!-- doxytag: member="res_config_ldap.c::update2_ldap" ref="ae80c2182af15b4603f48d87fc3c7a6a2" args="(const char *basedn, const char *table_name, va_list ap)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int update2_ldap </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>basedn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>table_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">va_list&nbsp;</td>
          <td class="paramname"> <em>ap</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l01315">1315</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>References <a class="el" href="res__config__ldap_8c_source.html#l00089">ldap_table_config::additional_filter</a>, <a class="el" href="res__config__ldap_8c_source.html#l00686">append_var_and_value_to_filter()</a>, <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="astmm_8h_source.html#l00093">ast_realloc</a>, <a class="el" href="strings_8h_source.html#l00846">ast_str_append()</a>, <a class="el" href="strings_8h_source.html#l00488">ast_str_buffer()</a>, <a class="el" href="strings_8h_source.html#l00415">ast_str_create()</a>, <a class="el" href="res__config__ldap_8c_source.html#l00098">base_table_config</a>, <a class="el" href="res__config__ldap_8c_source.html#l00636">cleaned_basedn()</a>, <a class="el" href="res__config__ldap_8c_source.html#l00218">convert_attribute_name_to_ldap()</a>, <a class="el" href="func__strings_8c_source.html#l00427">filter()</a>, <a class="el" href="astmm_8h_source.html#l00084">free</a>, <a class="el" href="res__config__ldap_8c_source.html#l00535">is_ldap_connect_error()</a>, <a class="el" href="res__config__ldap_8c_source.html#l00064">ldap_lock</a>, <a class="el" href="res__config__ldap_8c_source.html#l01670">ldap_reconnect()</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="asterisk_8c_source.html#l00175">option_debug</a>, and <a class="el" href="res__config__ldap_8c_source.html#l00125">table_config_for_table_name()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01316"></a>01316 {
<a name="l01317"></a>01317    <span class="keywordtype">int</span> error = 0;
<a name="l01318"></a>01318    LDAPMessage *ldap_entry = NULL;
<a name="l01319"></a>01319    LDAPMod **ldap_mods;
<a name="l01320"></a>01320    <span class="keyword">const</span> <span class="keywordtype">char</span> *newparam = NULL;
<a name="l01321"></a>01321    <span class="keyword">const</span> <span class="keywordtype">char</span> *newval = NULL;
<a name="l01322"></a>01322    <span class="keywordtype">char</span> *dn;
<a name="l01323"></a>01323    <span class="keywordtype">int</span> num_entries = 0;
<a name="l01324"></a>01324    <span class="keywordtype">int</span> i = 0;
<a name="l01325"></a>01325    <span class="keywordtype">int</span> mods_size = 0;
<a name="l01326"></a>01326    <span class="keywordtype">int</span> mod_exists = 0;
<a name="l01327"></a>01327    <span class="keyword">struct </span><a class="code" href="structldap__table__config.html" title="Table configuration.">ldap_table_config</a> *table_config = NULL;
<a name="l01328"></a>01328    <span class="keywordtype">char</span> *clean_basedn = NULL;
<a name="l01329"></a>01329    <span class="keyword">struct </span><a class="code" href="structast__str.html" title="The descriptor of a dynamic string XXX storage will be optimized later if needed...">ast_str</a> *<a class="code" href="func__strings_8c.html#af2deb3c7b0d3bdd442bb9ada5fda3d17">filter</a> = NULL;
<a name="l01330"></a>01330    <span class="keywordtype">int</span> tries = 0;
<a name="l01331"></a>01331    <span class="keywordtype">int</span> result = 0;
<a name="l01332"></a>01332    LDAPMessage *ldap_result_msg = NULL;
<a name="l01333"></a>01333 
<a name="l01334"></a>01334    <span class="keywordflow">if</span> (!table_name) {
<a name="l01335"></a>01335       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No table_name specified.\n&quot;</span>);
<a name="l01336"></a>01336       <span class="keywordflow">return</span> -1;
<a name="l01337"></a>01337    } 
<a name="l01338"></a>01338 
<a name="l01339"></a>01339    <span class="keywordflow">if</span> (!(filter = <a class="code" href="strings_8h.html#a8ec37e4acb6ecb20eb6f6edd1141cd76" title="Create a malloc&amp;#39;ed dynamic length string.">ast_str_create</a>(80)))
<a name="l01340"></a>01340       <span class="keywordflow">return</span> -1;
<a name="l01341"></a>01341 
<a name="l01342"></a>01342    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;<a class="code" href="res__config__ldap_8c.html#a55f48ee8d8b928c4d52e3d2182a17091">ldap_lock</a>);
<a name="l01343"></a>01343 
<a name="l01344"></a>01344    <span class="comment">/* We now have our complete statement; Lets connect to the server and execute it.  */</span>
<a name="l01345"></a>01345    <span class="keywordflow">if</span> (!<a class="code" href="res__config__ldap_8c.html#a77f9d4c9f33d2f29e98c5c8cc09e9119">ldap_reconnect</a>()) {
<a name="l01346"></a>01346       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="res__config__ldap_8c.html#a55f48ee8d8b928c4d52e3d2182a17091">ldap_lock</a>);
<a name="l01347"></a>01347       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(filter);
<a name="l01348"></a>01348       <span class="keywordflow">return</span> -1;
<a name="l01349"></a>01349    }
<a name="l01350"></a>01350 
<a name="l01351"></a>01351    table_config = <a class="code" href="res__config__ldap_8c.html#a5d395421629c28b7bd00359041440917" title="Find a table_config - Should be locked before using it.">table_config_for_table_name</a>(table_name);
<a name="l01352"></a>01352    <span class="keywordflow">if</span> (!table_config) {
<a name="l01353"></a>01353       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No table named &apos;%s&apos;.\n&quot;</span>, table_name);
<a name="l01354"></a>01354       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="res__config__ldap_8c.html#a55f48ee8d8b928c4d52e3d2182a17091">ldap_lock</a>);
<a name="l01355"></a>01355       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(filter);
<a name="l01356"></a>01356       <span class="keywordflow">return</span> -1;
<a name="l01357"></a>01357    }
<a name="l01358"></a>01358 
<a name="l01359"></a>01359    clean_basedn = <a class="code" href="res__config__ldap_8c.html#a39941ba901b2a30cc6d044760545c6c3" title="caller should free returned pointer">cleaned_basedn</a>(NULL, basedn);
<a name="l01360"></a>01360 
<a name="l01361"></a>01361    <span class="comment">/* Create the filter with the table additional filter and the parameter/value pairs we were given */</span>
<a name="l01362"></a>01362    <a class="code" href="strings_8h.html#a85cd5a8ef499e39d22b4bfeb8b9a64f7" title="Append to a thread local dynamic string.">ast_str_append</a>(&amp;filter, 0, <span class="stringliteral">&quot;(&amp;&quot;</span>);
<a name="l01363"></a>01363    <span class="keywordflow">if</span> (table_config &amp;&amp; table_config-&gt;<a class="code" href="structldap__table__config.html#aa6f8c05d7d124316fedcde5a15a5e0d6">additional_filter</a>) {
<a name="l01364"></a>01364       <a class="code" href="strings_8h.html#a85cd5a8ef499e39d22b4bfeb8b9a64f7" title="Append to a thread local dynamic string.">ast_str_append</a>(&amp;filter, 0, <span class="stringliteral">&quot;%s&quot;</span>, table_config-&gt;<a class="code" href="structldap__table__config.html#aa6f8c05d7d124316fedcde5a15a5e0d6">additional_filter</a>);
<a name="l01365"></a>01365    }
<a name="l01366"></a>01366    <span class="keywordflow">if</span> (table_config != <a class="code" href="res__config__ldap_8c.html#a3c846177aac9c60160bea626fbc3225d">base_table_config</a> &amp;&amp; <a class="code" href="res__config__ldap_8c.html#a3c846177aac9c60160bea626fbc3225d">base_table_config</a>
<a name="l01367"></a>01367       &amp;&amp; <a class="code" href="res__config__ldap_8c.html#a3c846177aac9c60160bea626fbc3225d">base_table_config</a>-&gt;<a class="code" href="structldap__table__config.html#aa6f8c05d7d124316fedcde5a15a5e0d6">additional_filter</a>) {
<a name="l01368"></a>01368       <a class="code" href="strings_8h.html#a85cd5a8ef499e39d22b4bfeb8b9a64f7" title="Append to a thread local dynamic string.">ast_str_append</a>(&amp;filter, 0, <span class="stringliteral">&quot;%s&quot;</span>, <a class="code" href="res__config__ldap_8c.html#a3c846177aac9c60160bea626fbc3225d">base_table_config</a>-&gt;<a class="code" href="structldap__table__config.html#aa6f8c05d7d124316fedcde5a15a5e0d6">additional_filter</a>);
<a name="l01369"></a>01369    }
<a name="l01370"></a>01370 
<a name="l01371"></a>01371    <span class="comment">/* Get multiple lookup keyfields and values */</span>
<a name="l01372"></a>01372    <span class="keywordflow">while</span> ((newparam = va_arg(ap, <span class="keyword">const</span> <span class="keywordtype">char</span> *))) {
<a name="l01373"></a>01373       newval = va_arg(ap, <span class="keyword">const</span> <span class="keywordtype">char</span> *);
<a name="l01374"></a>01374       <a class="code" href="res__config__ldap_8c.html#a28fa55daf894a70a398e09f3ce39d3dc" title="Append a name=value filter string. The filter string can grow.">append_var_and_value_to_filter</a>(&amp;filter, table_config, newparam, newval);
<a name="l01375"></a>01375    }
<a name="l01376"></a>01376    <a class="code" href="strings_8h.html#a85cd5a8ef499e39d22b4bfeb8b9a64f7" title="Append to a thread local dynamic string.">ast_str_append</a>(&amp;filter, 0, <span class="stringliteral">&quot;)&quot;</span>);
<a name="l01377"></a>01377 
<a name="l01378"></a>01378    <span class="comment">/* Create the modification array with the parameter/value pairs we were given, </span>
<a name="l01379"></a>01379 <span class="comment">    * if there are several parameters with the same name, we collect them into </span>
<a name="l01380"></a>01380 <span class="comment">    * one parameter/value pair and delimit them with a semicolon */</span>
<a name="l01381"></a>01381    newparam = va_arg(ap, <span class="keyword">const</span> <span class="keywordtype">char</span> *);
<a name="l01382"></a>01382    newparam = <a class="code" href="res__config__ldap_8c.html#a76e2f0e009997a7eae49d0b7e8a16029" title="Convert variable name to ldap attribute name - Should be locked before using it.">convert_attribute_name_to_ldap</a>(table_config, newparam);
<a name="l01383"></a>01383    newval = va_arg(ap, <span class="keyword">const</span> <span class="keywordtype">char</span> *);
<a name="l01384"></a>01384    <span class="keywordflow">if</span> (!newparam || !newval) {
<a name="l01385"></a>01385       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,
<a name="l01386"></a>01386             <span class="stringliteral">&quot;LINE(%d): need at least one parameter to modify.\n&quot;</span>, __LINE__);
<a name="l01387"></a>01387       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(filter);
<a name="l01388"></a>01388       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(clean_basedn);
<a name="l01389"></a>01389       <span class="keywordflow">return</span> -1;
<a name="l01390"></a>01390    }
<a name="l01391"></a>01391 
<a name="l01392"></a>01392    mods_size = 2; <span class="comment">/* one for the first param/value pair and one for the the terminating NULL */</span>
<a name="l01393"></a>01393    ldap_mods = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(<span class="keyword">sizeof</span>(LDAPMod *), mods_size);
<a name="l01394"></a>01394    ldap_mods[0] = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(LDAPMod));
<a name="l01395"></a>01395 
<a name="l01396"></a>01396    ldap_mods[0]-&gt;mod_op = LDAP_MOD_REPLACE;
<a name="l01397"></a>01397    ldap_mods[0]-&gt;mod_type = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>), strlen(newparam) + 1);
<a name="l01398"></a>01398    strcpy(ldap_mods[0]-&gt;mod_type, newparam);
<a name="l01399"></a>01399 
<a name="l01400"></a>01400    ldap_mods[0]-&gt;mod_values = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>), 2);
<a name="l01401"></a>01401    ldap_mods[0]-&gt;mod_values[0] = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>), strlen(newval) + 1);
<a name="l01402"></a>01402    strcpy(ldap_mods[0]-&gt;mod_values[0], newval);
<a name="l01403"></a>01403 
<a name="l01404"></a>01404    <span class="keywordflow">while</span> ((newparam = va_arg(ap, <span class="keyword">const</span> <span class="keywordtype">char</span> *))) {
<a name="l01405"></a>01405       newparam = <a class="code" href="res__config__ldap_8c.html#a76e2f0e009997a7eae49d0b7e8a16029" title="Convert variable name to ldap attribute name - Should be locked before using it.">convert_attribute_name_to_ldap</a>(table_config, newparam);
<a name="l01406"></a>01406       newval = va_arg(ap, <span class="keyword">const</span> <span class="keywordtype">char</span> *);
<a name="l01407"></a>01407       mod_exists = 0;
<a name="l01408"></a>01408 
<a name="l01409"></a>01409       <span class="keywordflow">for</span> (i = 0; i &lt; mods_size - 1; i++) {
<a name="l01410"></a>01410          <span class="keywordflow">if</span> (ldap_mods[i]&amp;&amp; !strcmp(ldap_mods[i]-&gt;mod_type, newparam)) {
<a name="l01411"></a>01411             <span class="comment">/* We have the parameter allready, adding the value as a semicolon delimited value */</span>
<a name="l01412"></a>01412             ldap_mods[i]-&gt;mod_values[0] = <a class="code" href="astmm_8h.html#aa852314efa0cfeecee97ffc51b649734">ast_realloc</a>(ldap_mods[i]-&gt;mod_values[0], <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>) * (strlen(ldap_mods[i]-&gt;mod_values[0]) + strlen(newval) + 2));
<a name="l01413"></a>01413             strcat(ldap_mods[i]-&gt;mod_values[0], <span class="stringliteral">&quot;;&quot;</span>);
<a name="l01414"></a>01414             strcat(ldap_mods[i]-&gt;mod_values[0], newval);
<a name="l01415"></a>01415             mod_exists = 1;   
<a name="l01416"></a>01416             <span class="keywordflow">break</span>;
<a name="l01417"></a>01417          }
<a name="l01418"></a>01418       }
<a name="l01419"></a>01419 
<a name="l01420"></a>01420       <span class="comment">/* create new mod */</span>
<a name="l01421"></a>01421       <span class="keywordflow">if</span> (!mod_exists) {
<a name="l01422"></a>01422          mods_size++;
<a name="l01423"></a>01423          ldap_mods = <a class="code" href="astmm_8h.html#aa852314efa0cfeecee97ffc51b649734">ast_realloc</a>(ldap_mods, <span class="keyword">sizeof</span>(LDAPMod *) * mods_size);
<a name="l01424"></a>01424          ldap_mods[mods_size - 1] = NULL;
<a name="l01425"></a>01425          ldap_mods[mods_size - 2] = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(LDAPMod));
<a name="l01426"></a>01426 
<a name="l01427"></a>01427          ldap_mods[mods_size - 2]-&gt;mod_op = LDAP_MOD_REPLACE;
<a name="l01428"></a>01428 
<a name="l01429"></a>01429          ldap_mods[mods_size - 2]-&gt;mod_type = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>), strlen(newparam) + 1);
<a name="l01430"></a>01430          strcpy(ldap_mods[mods_size - 2]-&gt;mod_type, newparam);
<a name="l01431"></a>01431 
<a name="l01432"></a>01432          ldap_mods[mods_size - 2]-&gt;mod_values = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span> *), 2);
<a name="l01433"></a>01433          ldap_mods[mods_size - 2]-&gt;mod_values[0] = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>), strlen(newval) + 1);
<a name="l01434"></a>01434          strcpy(ldap_mods[mods_size - 2]-&gt;mod_values[0], newval);
<a name="l01435"></a>01435       }
<a name="l01436"></a>01436    }
<a name="l01437"></a>01437    <span class="comment">/* freeing ldap_mods further down */</span>
<a name="l01438"></a>01438 
<a name="l01439"></a>01439    <span class="keywordflow">do</span> {
<a name="l01440"></a>01440       <span class="comment">/* freeing ldap_result further down */</span>
<a name="l01441"></a>01441       result = ldap_search_ext_s(<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>, clean_basedn,
<a name="l01442"></a>01442               LDAP_SCOPE_SUBTREE, <a class="code" href="strings_8h.html#a053bdfc229997a75f112bdd7b995e00b" title="Returns the string buffer within the ast_str buf.">ast_str_buffer</a>(filter), NULL, 0, NULL, NULL, NULL, LDAP_NO_LIMIT,
<a name="l01443"></a>01443               &amp;ldap_result_msg);
<a name="l01444"></a>01444       <span class="keywordflow">if</span> (result != LDAP_SUCCESS &amp;&amp; <a class="code" href="res__config__ldap_8c.html#a860e11270a1778347d12df4841bf7819">is_ldap_connect_error</a>(result)) {
<a name="l01445"></a>01445          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to query database. Try %d/3\n&quot;</span>,
<a name="l01446"></a>01446             tries + 1);
<a name="l01447"></a>01447          tries++;
<a name="l01448"></a>01448          <span class="keywordflow">if</span> (tries &lt; 3) {
<a name="l01449"></a>01449             usleep(500000L * tries);
<a name="l01450"></a>01450             <span class="keywordflow">if</span> (<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>) {
<a name="l01451"></a>01451                ldap_unbind_ext_s(<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>, NULL, NULL);
<a name="l01452"></a>01452                <a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a> = NULL;
<a name="l01453"></a>01453             }
<a name="l01454"></a>01454             <span class="keywordflow">if</span> (!<a class="code" href="res__config__ldap_8c.html#a77f9d4c9f33d2f29e98c5c8cc09e9119">ldap_reconnect</a>())
<a name="l01455"></a>01455                <span class="keywordflow">break</span>;
<a name="l01456"></a>01456          }
<a name="l01457"></a>01457       }
<a name="l01458"></a>01458    } <span class="keywordflow">while</span> (result != LDAP_SUCCESS &amp;&amp; tries &lt; 3 &amp;&amp; <a class="code" href="res__config__ldap_8c.html#a860e11270a1778347d12df4841bf7819">is_ldap_connect_error</a>(result));
<a name="l01459"></a>01459 
<a name="l01460"></a>01460    <span class="keywordflow">if</span> (result != LDAP_SUCCESS) {
<a name="l01461"></a>01461       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to query directory. Check debug for more info.\n&quot;</span>);
<a name="l01462"></a>01462       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Query: %s\n&quot;</span>, <a class="code" href="strings_8h.html#a053bdfc229997a75f112bdd7b995e00b" title="Returns the string buffer within the ast_str buf.">ast_str_buffer</a>(filter));
<a name="l01463"></a>01463       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Query Failed because: %s\n&quot;</span>,
<a name="l01464"></a>01464          ldap_err2string(result));
<a name="l01465"></a>01465 
<a name="l01466"></a>01466       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="res__config__ldap_8c.html#a55f48ee8d8b928c4d52e3d2182a17091">ldap_lock</a>);
<a name="l01467"></a>01467       <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(filter);
<a name="l01468"></a>01468       <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(clean_basedn);
<a name="l01469"></a>01469       ldap_msgfree(ldap_result_msg);
<a name="l01470"></a>01470       ldap_mods_free(ldap_mods, 0);
<a name="l01471"></a>01471       <span class="keywordflow">return</span> -1;
<a name="l01472"></a>01472    }
<a name="l01473"></a>01473    <span class="comment">/* Ready to update */</span>
<a name="l01474"></a>01474    <span class="keywordflow">if</span> ((num_entries = ldap_count_entries(<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>, ldap_result_msg)) &gt; 0) {
<a name="l01475"></a>01475       <span class="keywordflow">for</span> (i = 0; <a class="code" href="group__main__options.html#ga40f8fb2e731031d99f732f515cec680f">option_debug</a> &gt; 2 &amp;&amp; i &lt; mods_size - 1; i++)
<a name="l01476"></a>01476          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(3, <span class="stringliteral">&quot;LINE(%d) %s=%s \n&quot;</span>, __LINE__, ldap_mods[i]-&gt;mod_type, ldap_mods[i]-&gt;mod_values[0]);
<a name="l01477"></a>01477 
<a name="l01478"></a>01478       ldap_entry = ldap_first_entry(<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>, ldap_result_msg);
<a name="l01479"></a>01479 
<a name="l01480"></a>01480       <span class="keywordflow">for</span> (i = 0; ldap_entry; i++) { 
<a name="l01481"></a>01481          dn = ldap_get_dn(<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>, ldap_entry);
<a name="l01482"></a>01482          <span class="keywordflow">if</span> ((error = ldap_modify_ext_s(<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>, dn, ldap_mods, NULL, NULL)) != LDAP_SUCCESS) 
<a name="l01483"></a>01483             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Couldn&apos;t modify dn:%s because %s&quot;</span>, dn, ldap_err2string(error));
<a name="l01484"></a>01484 
<a name="l01485"></a>01485          ldap_entry = ldap_next_entry(<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>, ldap_entry);
<a name="l01486"></a>01486       }
<a name="l01487"></a>01487    }
<a name="l01488"></a>01488 
<a name="l01489"></a>01489    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="res__config__ldap_8c.html#a55f48ee8d8b928c4d52e3d2182a17091">ldap_lock</a>);
<a name="l01490"></a>01490    <span class="keywordflow">if</span> (filter)
<a name="l01491"></a>01491       <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(filter);
<a name="l01492"></a>01492    <span class="keywordflow">if</span> (clean_basedn)
<a name="l01493"></a>01493       <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(clean_basedn);
<a name="l01494"></a>01494    ldap_msgfree(ldap_result_msg);
<a name="l01495"></a>01495    ldap_mods_free(ldap_mods, 0);
<a name="l01496"></a>01496    <span class="keywordflow">return</span> num_entries;
<a name="l01497"></a>01497 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aac84eea2c3a5f6dc1c8bf29833d2aadd"></a><!-- doxytag: member="res_config_ldap.c::update_ldap" ref="aac84eea2c3a5f6dc1c8bf29833d2aadd" args="(const char *basedn, const char *table_name, const char *attribute, const char *lookup, va_list ap)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int update_ldap </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>basedn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>table_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>attribute</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>lookup</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">va_list&nbsp;</td>
          <td class="paramname"> <em>ap</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l01128">1128</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>References <a class="el" href="res__config__ldap_8c_source.html#l00089">ldap_table_config::additional_filter</a>, <a class="el" href="res__config__ldap_8c_source.html#l00686">append_var_and_value_to_filter()</a>, <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="astmm_8h_source.html#l00093">ast_realloc</a>, <a class="el" href="strings_8h_source.html#l00846">ast_str_append()</a>, <a class="el" href="strings_8h_source.html#l00488">ast_str_buffer()</a>, <a class="el" href="strings_8h_source.html#l00415">ast_str_create()</a>, <a class="el" href="astmm_8h_source.html#l00099">ast_strdup</a>, <a class="el" href="res__config__ldap_8c_source.html#l00098">base_table_config</a>, <a class="el" href="res__config__ldap_8c_source.html#l00636">cleaned_basedn()</a>, <a class="el" href="res__config__ldap_8c_source.html#l00218">convert_attribute_name_to_ldap()</a>, <a class="el" href="func__strings_8c_source.html#l00427">filter()</a>, <a class="el" href="astmm_8h_source.html#l00084">free</a>, <a class="el" href="res__config__ldap_8c_source.html#l00535">is_ldap_connect_error()</a>, <a class="el" href="res__config__ldap_8c_source.html#l00064">ldap_lock</a>, <a class="el" href="res__config__ldap_8c_source.html#l01670">ldap_reconnect()</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="asterisk_8c_source.html#l00175">option_debug</a>, and <a class="el" href="res__config__ldap_8c_source.html#l00125">table_config_for_table_name()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01130"></a>01130 {
<a name="l01131"></a>01131    <span class="keywordtype">int</span> error = 0;
<a name="l01132"></a>01132    LDAPMessage *ldap_entry = NULL;
<a name="l01133"></a>01133    LDAPMod **ldap_mods;
<a name="l01134"></a>01134    <span class="keyword">const</span> <span class="keywordtype">char</span> *newparam = NULL;
<a name="l01135"></a>01135    <span class="keyword">const</span> <span class="keywordtype">char</span> *newval = NULL;
<a name="l01136"></a>01136    <span class="keywordtype">char</span> *dn;
<a name="l01137"></a>01137    <span class="keywordtype">int</span> num_entries = 0;
<a name="l01138"></a>01138    <span class="keywordtype">int</span> i = 0;
<a name="l01139"></a>01139    <span class="keywordtype">int</span> mods_size = 0;
<a name="l01140"></a>01140    <span class="keywordtype">int</span> mod_exists = 0;
<a name="l01141"></a>01141    <span class="keyword">struct </span><a class="code" href="structldap__table__config.html" title="Table configuration.">ldap_table_config</a> *table_config = NULL;
<a name="l01142"></a>01142    <span class="keywordtype">char</span> *clean_basedn = NULL;
<a name="l01143"></a>01143    <span class="keyword">struct </span><a class="code" href="structast__str.html" title="The descriptor of a dynamic string XXX storage will be optimized later if needed...">ast_str</a> *<a class="code" href="func__strings_8c.html#af2deb3c7b0d3bdd442bb9ada5fda3d17">filter</a> = NULL;
<a name="l01144"></a>01144    <span class="keywordtype">int</span> tries = 0;
<a name="l01145"></a>01145    <span class="keywordtype">int</span> result = 0;
<a name="l01146"></a>01146    LDAPMessage *ldap_result_msg = NULL;
<a name="l01147"></a>01147 
<a name="l01148"></a>01148    <span class="keywordflow">if</span> (!table_name) {
<a name="l01149"></a>01149       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No table_name specified.\n&quot;</span>);
<a name="l01150"></a>01150       <span class="keywordflow">return</span> -1;
<a name="l01151"></a>01151    } 
<a name="l01152"></a>01152 
<a name="l01153"></a>01153    <span class="keywordflow">if</span> (!(filter = <a class="code" href="strings_8h.html#a8ec37e4acb6ecb20eb6f6edd1141cd76" title="Create a malloc&amp;#39;ed dynamic length string.">ast_str_create</a>(80)))
<a name="l01154"></a>01154       <span class="keywordflow">return</span> -1;
<a name="l01155"></a>01155 
<a name="l01156"></a>01156    <span class="keywordflow">if</span> (!attribute || !lookup) {
<a name="l01157"></a>01157       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,
<a name="l01158"></a>01158             <span class="stringliteral">&quot;LINE(%d): search parameters are empty.\n&quot;</span>, __LINE__);
<a name="l01159"></a>01159       <span class="keywordflow">return</span> -1;
<a name="l01160"></a>01160    }
<a name="l01161"></a>01161    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;<a class="code" href="res__config__ldap_8c.html#a55f48ee8d8b928c4d52e3d2182a17091">ldap_lock</a>);
<a name="l01162"></a>01162 
<a name="l01163"></a>01163    <span class="comment">/* We now have our complete statement; Lets connect to the server and execute it.  */</span>
<a name="l01164"></a>01164    <span class="keywordflow">if</span> (!<a class="code" href="res__config__ldap_8c.html#a77f9d4c9f33d2f29e98c5c8cc09e9119">ldap_reconnect</a>()) {
<a name="l01165"></a>01165       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="res__config__ldap_8c.html#a55f48ee8d8b928c4d52e3d2182a17091">ldap_lock</a>);
<a name="l01166"></a>01166       <span class="keywordflow">return</span> -1;
<a name="l01167"></a>01167    }
<a name="l01168"></a>01168 
<a name="l01169"></a>01169    table_config = <a class="code" href="res__config__ldap_8c.html#a5d395421629c28b7bd00359041440917" title="Find a table_config - Should be locked before using it.">table_config_for_table_name</a>(table_name);
<a name="l01170"></a>01170    <span class="keywordflow">if</span> (!table_config) {
<a name="l01171"></a>01171       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No table named &apos;%s&apos;.\n&quot;</span>, table_name);
<a name="l01172"></a>01172       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="res__config__ldap_8c.html#a55f48ee8d8b928c4d52e3d2182a17091">ldap_lock</a>);
<a name="l01173"></a>01173       <span class="keywordflow">return</span> -1;
<a name="l01174"></a>01174    }
<a name="l01175"></a>01175 
<a name="l01176"></a>01176    clean_basedn = <a class="code" href="res__config__ldap_8c.html#a39941ba901b2a30cc6d044760545c6c3" title="caller should free returned pointer">cleaned_basedn</a>(NULL, basedn);
<a name="l01177"></a>01177 
<a name="l01178"></a>01178    <span class="comment">/* Create the filter with the table additional filter and the parameter/value pairs we were given */</span>
<a name="l01179"></a>01179    <a class="code" href="strings_8h.html#a85cd5a8ef499e39d22b4bfeb8b9a64f7" title="Append to a thread local dynamic string.">ast_str_append</a>(&amp;filter, 0, <span class="stringliteral">&quot;(&amp;&quot;</span>);
<a name="l01180"></a>01180    <span class="keywordflow">if</span> (table_config &amp;&amp; table_config-&gt;<a class="code" href="structldap__table__config.html#aa6f8c05d7d124316fedcde5a15a5e0d6">additional_filter</a>) {
<a name="l01181"></a>01181       <a class="code" href="strings_8h.html#a85cd5a8ef499e39d22b4bfeb8b9a64f7" title="Append to a thread local dynamic string.">ast_str_append</a>(&amp;filter, 0, <span class="stringliteral">&quot;%s&quot;</span>, table_config-&gt;<a class="code" href="structldap__table__config.html#aa6f8c05d7d124316fedcde5a15a5e0d6">additional_filter</a>);
<a name="l01182"></a>01182    }
<a name="l01183"></a>01183    <span class="keywordflow">if</span> (table_config != <a class="code" href="res__config__ldap_8c.html#a3c846177aac9c60160bea626fbc3225d">base_table_config</a> &amp;&amp; <a class="code" href="res__config__ldap_8c.html#a3c846177aac9c60160bea626fbc3225d">base_table_config</a>
<a name="l01184"></a>01184       &amp;&amp; <a class="code" href="res__config__ldap_8c.html#a3c846177aac9c60160bea626fbc3225d">base_table_config</a>-&gt;<a class="code" href="structldap__table__config.html#aa6f8c05d7d124316fedcde5a15a5e0d6">additional_filter</a>) {
<a name="l01185"></a>01185       <a class="code" href="strings_8h.html#a85cd5a8ef499e39d22b4bfeb8b9a64f7" title="Append to a thread local dynamic string.">ast_str_append</a>(&amp;filter, 0, <span class="stringliteral">&quot;%s&quot;</span>, <a class="code" href="res__config__ldap_8c.html#a3c846177aac9c60160bea626fbc3225d">base_table_config</a>-&gt;<a class="code" href="structldap__table__config.html#aa6f8c05d7d124316fedcde5a15a5e0d6">additional_filter</a>);
<a name="l01186"></a>01186    }
<a name="l01187"></a>01187    <a class="code" href="res__config__ldap_8c.html#a28fa55daf894a70a398e09f3ce39d3dc" title="Append a name=value filter string. The filter string can grow.">append_var_and_value_to_filter</a>(&amp;filter, table_config, attribute, lookup);
<a name="l01188"></a>01188    <a class="code" href="strings_8h.html#a85cd5a8ef499e39d22b4bfeb8b9a64f7" title="Append to a thread local dynamic string.">ast_str_append</a>(&amp;filter, 0, <span class="stringliteral">&quot;)&quot;</span>);
<a name="l01189"></a>01189 
<a name="l01190"></a>01190    <span class="comment">/* Create the modification array with the parameter/value pairs we were given, </span>
<a name="l01191"></a>01191 <span class="comment">    * if there are several parameters with the same name, we collect them into </span>
<a name="l01192"></a>01192 <span class="comment">    * one parameter/value pair and delimit them with a semicolon */</span>
<a name="l01193"></a>01193    newparam = va_arg(ap, <span class="keyword">const</span> <span class="keywordtype">char</span> *);
<a name="l01194"></a>01194    newparam = <a class="code" href="res__config__ldap_8c.html#a76e2f0e009997a7eae49d0b7e8a16029" title="Convert variable name to ldap attribute name - Should be locked before using it.">convert_attribute_name_to_ldap</a>(table_config, newparam);
<a name="l01195"></a>01195    newval = va_arg(ap, <span class="keyword">const</span> <span class="keywordtype">char</span> *);
<a name="l01196"></a>01196    <span class="keywordflow">if</span> (!newparam || !newval) {
<a name="l01197"></a>01197       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,
<a name="l01198"></a>01198             <span class="stringliteral">&quot;LINE(%d): need at least one parameter to modify.\n&quot;</span>, __LINE__);
<a name="l01199"></a>01199       <span class="keywordflow">return</span> -1;
<a name="l01200"></a>01200    }
<a name="l01201"></a>01201 
<a name="l01202"></a>01202    mods_size = 2; <span class="comment">/* one for the first param/value pair and one for the the terminating NULL */</span>
<a name="l01203"></a>01203    ldap_mods = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(<span class="keyword">sizeof</span>(LDAPMod *), mods_size);
<a name="l01204"></a>01204    ldap_mods[0] = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(LDAPMod));
<a name="l01205"></a>01205 
<a name="l01206"></a>01206    ldap_mods[0]-&gt;mod_op = LDAP_MOD_REPLACE;
<a name="l01207"></a>01207    ldap_mods[0]-&gt;mod_type = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(newparam);
<a name="l01208"></a>01208 
<a name="l01209"></a>01209    ldap_mods[0]-&gt;mod_values = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span> *), 2);
<a name="l01210"></a>01210    ldap_mods[0]-&gt;mod_values[0] = <a class="code" href="astmm_8h.html#a2ef2401ade6b4b773138a82c86c40903">ast_strdup</a>(newval);
<a name="l01211"></a>01211 
<a name="l01212"></a>01212    <span class="keywordflow">while</span> ((newparam = va_arg(ap, <span class="keyword">const</span> <span class="keywordtype">char</span> *))) {
<a name="l01213"></a>01213       newparam = <a class="code" href="res__config__ldap_8c.html#a76e2f0e009997a7eae49d0b7e8a16029" title="Convert variable name to ldap attribute name - Should be locked before using it.">convert_attribute_name_to_ldap</a>(table_config, newparam);
<a name="l01214"></a>01214       newval = va_arg(ap, <span class="keyword">const</span> <span class="keywordtype">char</span> *);
<a name="l01215"></a>01215       mod_exists = 0;
<a name="l01216"></a>01216 
<a name="l01217"></a>01217       <span class="keywordflow">for</span> (i = 0; i &lt; mods_size - 1; i++) {
<a name="l01218"></a>01218          <span class="keywordflow">if</span> (ldap_mods[i]&amp;&amp; !strcmp(ldap_mods[i]-&gt;mod_type, newparam)) {
<a name="l01219"></a>01219             <span class="comment">/* We have the parameter allready, adding the value as a semicolon delimited value */</span>
<a name="l01220"></a>01220             ldap_mods[i]-&gt;mod_values[0] = <a class="code" href="astmm_8h.html#aa852314efa0cfeecee97ffc51b649734">ast_realloc</a>(ldap_mods[i]-&gt;mod_values[0], <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>) * (strlen(ldap_mods[i]-&gt;mod_values[0]) + strlen(newval) + 2));
<a name="l01221"></a>01221             strcat(ldap_mods[i]-&gt;mod_values[0], <span class="stringliteral">&quot;;&quot;</span>);
<a name="l01222"></a>01222             strcat(ldap_mods[i]-&gt;mod_values[0], newval);
<a name="l01223"></a>01223             mod_exists = 1;   
<a name="l01224"></a>01224             <span class="keywordflow">break</span>;
<a name="l01225"></a>01225          }
<a name="l01226"></a>01226       }
<a name="l01227"></a>01227 
<a name="l01228"></a>01228       <span class="comment">/* create new mod */</span>
<a name="l01229"></a>01229       <span class="keywordflow">if</span> (!mod_exists) {
<a name="l01230"></a>01230          mods_size++;
<a name="l01231"></a>01231          ldap_mods = <a class="code" href="astmm_8h.html#aa852314efa0cfeecee97ffc51b649734">ast_realloc</a>(ldap_mods, <span class="keyword">sizeof</span>(LDAPMod *) * mods_size);
<a name="l01232"></a>01232          ldap_mods[mods_size - 1] = NULL;
<a name="l01233"></a>01233          
<a name="l01234"></a>01234          ldap_mods[mods_size - 2] = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(LDAPMod));
<a name="l01235"></a>01235 
<a name="l01236"></a>01236          ldap_mods[mods_size - 2]-&gt;mod_type = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>), strlen(newparam) + 1);
<a name="l01237"></a>01237          strcpy(ldap_mods[mods_size - 2]-&gt;mod_type, newparam);
<a name="l01238"></a>01238 
<a name="l01239"></a>01239          <span class="keywordflow">if</span> (strlen(newval) == 0) {
<a name="l01240"></a>01240             ldap_mods[mods_size - 2]-&gt;mod_op = LDAP_MOD_DELETE;
<a name="l01241"></a>01241          } <span class="keywordflow">else</span> {
<a name="l01242"></a>01242             ldap_mods[mods_size - 2]-&gt;mod_op = LDAP_MOD_REPLACE;
<a name="l01243"></a>01243 
<a name="l01244"></a>01244             ldap_mods[mods_size - 2]-&gt;mod_values = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span> *), 2);
<a name="l01245"></a>01245             ldap_mods[mods_size - 2]-&gt;mod_values[0] = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>), strlen(newval) + 1);
<a name="l01246"></a>01246             strcpy(ldap_mods[mods_size - 2]-&gt;mod_values[0], newval);
<a name="l01247"></a>01247          }
<a name="l01248"></a>01248       }
<a name="l01249"></a>01249    }
<a name="l01250"></a>01250    <span class="comment">/* freeing ldap_mods further down */</span>
<a name="l01251"></a>01251 
<a name="l01252"></a>01252    <span class="keywordflow">do</span> {
<a name="l01253"></a>01253       <span class="comment">/* freeing ldap_result further down */</span>
<a name="l01254"></a>01254       result = ldap_search_ext_s(<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>, clean_basedn,
<a name="l01255"></a>01255               LDAP_SCOPE_SUBTREE, <a class="code" href="strings_8h.html#a053bdfc229997a75f112bdd7b995e00b" title="Returns the string buffer within the ast_str buf.">ast_str_buffer</a>(filter), NULL, 0, NULL, NULL, NULL, LDAP_NO_LIMIT,
<a name="l01256"></a>01256               &amp;ldap_result_msg);
<a name="l01257"></a>01257       <span class="keywordflow">if</span> (result != LDAP_SUCCESS &amp;&amp; <a class="code" href="res__config__ldap_8c.html#a860e11270a1778347d12df4841bf7819">is_ldap_connect_error</a>(result)) {
<a name="l01258"></a>01258          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to query database. Try %d/3\n&quot;</span>,
<a name="l01259"></a>01259             tries + 1);
<a name="l01260"></a>01260          tries++;
<a name="l01261"></a>01261          <span class="keywordflow">if</span> (tries &lt; 3) {
<a name="l01262"></a>01262             usleep(500000L * tries);
<a name="l01263"></a>01263             <span class="keywordflow">if</span> (<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>) {
<a name="l01264"></a>01264                ldap_unbind_ext_s(<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>, NULL, NULL);
<a name="l01265"></a>01265                <a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a> = NULL;
<a name="l01266"></a>01266             }
<a name="l01267"></a>01267             <span class="keywordflow">if</span> (!<a class="code" href="res__config__ldap_8c.html#a77f9d4c9f33d2f29e98c5c8cc09e9119">ldap_reconnect</a>())
<a name="l01268"></a>01268                <span class="keywordflow">break</span>;
<a name="l01269"></a>01269          }
<a name="l01270"></a>01270       }
<a name="l01271"></a>01271    } <span class="keywordflow">while</span> (result != LDAP_SUCCESS &amp;&amp; tries &lt; 3 &amp;&amp; <a class="code" href="res__config__ldap_8c.html#a860e11270a1778347d12df4841bf7819">is_ldap_connect_error</a>(result));
<a name="l01272"></a>01272 
<a name="l01273"></a>01273    <span class="keywordflow">if</span> (result != LDAP_SUCCESS) {
<a name="l01274"></a>01274       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to query directory. Check debug for more info.\n&quot;</span>);
<a name="l01275"></a>01275       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Query: %s\n&quot;</span>, <a class="code" href="strings_8h.html#a053bdfc229997a75f112bdd7b995e00b" title="Returns the string buffer within the ast_str buf.">ast_str_buffer</a>(filter));
<a name="l01276"></a>01276       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Query Failed because: %s\n&quot;</span>,
<a name="l01277"></a>01277          ldap_err2string(result));
<a name="l01278"></a>01278 
<a name="l01279"></a>01279       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="res__config__ldap_8c.html#a55f48ee8d8b928c4d52e3d2182a17091">ldap_lock</a>);
<a name="l01280"></a>01280       <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(filter);
<a name="l01281"></a>01281       <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(clean_basedn);
<a name="l01282"></a>01282       ldap_msgfree(ldap_result_msg);
<a name="l01283"></a>01283       ldap_mods_free(ldap_mods, 0);
<a name="l01284"></a>01284       <span class="keywordflow">return</span> -1;
<a name="l01285"></a>01285    }
<a name="l01286"></a>01286    <span class="comment">/* Ready to update */</span>
<a name="l01287"></a>01287    <span class="keywordflow">if</span> ((num_entries = ldap_count_entries(<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>, ldap_result_msg)) &gt; 0) {
<a name="l01288"></a>01288       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(3, <span class="stringliteral">&quot;LINE(%d) Modifying %s=%s hits: %d\n&quot;</span>, __LINE__, attribute, lookup, num_entries);
<a name="l01289"></a>01289       <span class="keywordflow">for</span> (i = 0; <a class="code" href="group__main__options.html#ga40f8fb2e731031d99f732f515cec680f">option_debug</a> &gt; 2 &amp;&amp; i &lt; mods_size - 1; i++) {
<a name="l01290"></a>01290          <span class="keywordflow">if</span> (ldap_mods[i]-&gt;mod_op != LDAP_MOD_DELETE) {
<a name="l01291"></a>01291             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(3, <span class="stringliteral">&quot;LINE(%d) %s=%s \n&quot;</span>, __LINE__, ldap_mods[i]-&gt;mod_type, ldap_mods[i]-&gt;mod_values[0]);
<a name="l01292"></a>01292          } <span class="keywordflow">else</span> {
<a name="l01293"></a>01293             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(3, <span class="stringliteral">&quot;LINE(%d) deleting %s \n&quot;</span>, __LINE__, ldap_mods[i]-&gt;mod_type);
<a name="l01294"></a>01294          }
<a name="l01295"></a>01295       }
<a name="l01296"></a>01296       ldap_entry = ldap_first_entry(<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>, ldap_result_msg);
<a name="l01297"></a>01297 
<a name="l01298"></a>01298       <span class="keywordflow">for</span> (i = 0; ldap_entry; i++) { 
<a name="l01299"></a>01299          dn = ldap_get_dn(<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>, ldap_entry);
<a name="l01300"></a>01300          <span class="keywordflow">if</span> ((error = ldap_modify_ext_s(<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>, dn, ldap_mods, NULL, NULL)) != LDAP_SUCCESS) 
<a name="l01301"></a>01301             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Couldn&apos;t modify dn:%s because %s&quot;</span>, dn, ldap_err2string(error));
<a name="l01302"></a>01302 
<a name="l01303"></a>01303          ldap_entry = ldap_next_entry(<a class="code" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a>, ldap_entry);
<a name="l01304"></a>01304       }
<a name="l01305"></a>01305    }
<a name="l01306"></a>01306 
<a name="l01307"></a>01307    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="res__config__ldap_8c.html#a55f48ee8d8b928c4d52e3d2182a17091">ldap_lock</a>);
<a name="l01308"></a>01308    <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(filter);
<a name="l01309"></a>01309    <a class="code" href="astmm_8h.html#aa7157aa9480bb73f090dca36776419bf">free</a>(clean_basedn);
<a name="l01310"></a>01310    ldap_msgfree(ldap_result_msg);
<a name="l01311"></a>01311    ldap_mods_free(ldap_mods, 0);
<a name="l01312"></a>01312    <span class="keywordflow">return</span> num_entries;
<a name="l01313"></a>01313 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9614b129f70fd9cfbaaf78b6d64b3b16"></a><!-- doxytag: member="res_config_ldap.c::variable_named" ref="a9614b129f70fd9cfbaaf78b6d64b3b16" args="(struct ast_variable *var, const char *name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="structast__variable.html">ast_variable</a>* variable_named </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__variable.html">ast_variable</a> *&nbsp;</td>
          <td class="paramname"> <em>var</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static, read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Find variable by name. </p>

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l00138">138</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>References <a class="el" href="config_8h_source.html#l00075">ast_variable::name</a>, and <a class="el" href="config_8h_source.html#l00077">ast_variable::next</a>.</p>

<p>Referenced by <a class="el" href="res__config__ldap_8c_source.html#l01015">config_ldap()</a>, <a class="el" href="res__config__ldap_8c_source.html#l00349">realtime_ldap_result_to_vars()</a>, and <a class="el" href="res__config__ldap_8c_source.html#l00168">semicolon_count_var()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00139"></a>00139 {
<a name="l00140"></a>00140    <span class="keywordflow">for</span> (; var; var = var-&gt;<a class="code" href="structast__variable.html#a46f18867e3894852bc489a4cd9cfa516">next</a>) {
<a name="l00141"></a>00141       <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, var-&gt;<a class="code" href="structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>))
<a name="l00142"></a>00142          <span class="keywordflow">break</span>;
<a name="l00143"></a>00143    }
<a name="l00144"></a>00144 
<a name="l00145"></a>00145    <span class="keywordflow">return</span> var;
<a name="l00146"></a>00146 }
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="ab22f32016155f7f403e7178767163d7d"></a><!-- doxytag: member="res_config_ldap.c::__mod_info" ref="ab22f32016155f7f403e7178767163d7d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__module__info.html">ast_module_info</a> <a class="el" href="res__timing__timerfd_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a> = { .<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = AST_MODULE, .flags = AST_MODFLAG_GLOBAL_SYMBOLS , .<a class="el" href="callerid_8c.html#a68344fa88cf4e86b5079fd69a5c22d57">description</a> = &quot;LDAP realtime interface&quot; , .key = &quot;This paragraph is copyright (c) 2006 by Digium, Inc. \In order for your module to load, it must return this \key via a function called \&quot;key\&quot;. Any code which \includes this paragraph must be licensed under the GNU \General Public License <a class="el" href="res__config__pgsql_8c.html#aad880fc4455c253781e8968f2239d56f">version</a> 2 or later (at your \option). In addition to Digium's general reservations \of rights, Digium expressly reserves the right to \allow other parties to license this paragraph under \different terms. Any use of Digium, Inc. trademarks or \logos (including \&quot;Asterisk\&quot; or \&quot;Digium\&quot;) without \express written <a class="el" href="structpermission.html">permission</a> of Digium, Inc. is prohibited.\n&quot; , .buildopt_sum = &quot;aefddfaffd51bc118c14a748e96eb9a0&quot; , .load = load_module, .unload = unload_module, .reload = reload, }<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l01769">1769</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae25b9f3970870610911f8850897e8ead"></a><!-- doxytag: member="res_config_ldap.c::ast_module_info" ref="ae25b9f3970870610911f8850897e8ead" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__module__info.html">ast_module_info</a>* <a class="el" href="structast__module__info.html">ast_module_info</a> = &amp;<a class="el" href="res__timing__timerfd_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l01769">1769</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

</div>
</div>
<a class="anchor" id="acfd19a5e5bb3f90e330bd660b743970f"></a><!-- doxytag: member="res_config_ldap.c::base_distinguished_name" ref="acfd19a5e5bb3f90e330bd660b743970f" args="[512]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="res__config__ldap_8c.html#acfd19a5e5bb3f90e330bd660b743970f">base_distinguished_name</a>[512]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l00070">70</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

</div>
</div>
<a class="anchor" id="a3c846177aac9c60160bea626fbc3225d"></a><!-- doxytag: member="res_config_ldap.c::base_table_config" ref="a3c846177aac9c60160bea626fbc3225d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structldap__table__config.html">ldap_table_config</a>* <a class="el" href="res__config__ldap_8c.html#a3c846177aac9c60160bea626fbc3225d">base_table_config</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l00098">98</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>Referenced by <a class="el" href="res__config__ldap_8c_source.html#l00241">convert_attribute_name_from_ldap()</a>, <a class="el" href="res__config__ldap_8c_source.html#l00218">convert_attribute_name_to_ldap()</a>, <a class="el" href="res__config__ldap_8c_source.html#l01577">parse_config()</a>, <a class="el" href="res__config__ldap_8c_source.html#l00718">realtime_ldap_base_ap()</a>, <a class="el" href="res__config__ldap_8c_source.html#l00199">table_configs_free()</a>, <a class="el" href="res__config__ldap_8c_source.html#l01315">update2_ldap()</a>, and <a class="el" href="res__config__ldap_8c_source.html#l01128">update_ldap()</a>.</p>

</div>
</div>
<a class="anchor" id="ac4ae24c7b766713b82921c04d1a4b699"></a><!-- doxytag: member="res_config_ldap.c::connect_time" ref="ac4ae24c7b766713b82921c04d1a4b699" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">time_t <a class="el" href="res__config__pgsql_8c.html#ac4ae24c7b766713b82921c04d1a4b699">connect_time</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l00072">72</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

</div>
</div>
<a class="anchor" id="a561b0b21a0287f6db417ce1211336f0f"></a><!-- doxytag: member="res_config_ldap.c::ldap_cli" ref="a561b0b21a0287f6db417ce1211336f0f" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> <a class="el" href="res__config__ldap_8c.html#a561b0b21a0287f6db417ce1211336f0f">ldap_cli</a>[]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
   <a class="code" href="cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="res__config__ldap_8c.html#ad51f9133e1f5e9260cb80c8fd38b60d7">realtime_ldap_status</a>, <span class="stringliteral">&quot;Shows connection information for the LDAP RealTime driver&quot;</span>),
}
</pre></div>
<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l00101">101</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>Referenced by <a class="el" href="res__config__ldap_8c_source.html#l01508">load_module()</a>, and <a class="el" href="res__config__ldap_8c_source.html#l01529">unload_module()</a>.</p>

</div>
</div>
<a class="anchor" id="a70367624d2d9a8df76df96ad482c1f01"></a><!-- doxytag: member="res_config_ldap.c::ldap_engine" ref="a70367624d2d9a8df76df96ad482c1f01" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__config__engine.html">ast_config_engine</a> <a class="el" href="res__config__ldap_8c.html#a70367624d2d9a8df76df96ad482c1f01">ldap_engine</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l01499">1499</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>Referenced by <a class="el" href="res__config__ldap_8c_source.html#l01508">load_module()</a>, and <a class="el" href="res__config__ldap_8c_source.html#l01529">unload_module()</a>.</p>

</div>
</div>
<a class="anchor" id="a55f48ee8d8b928c4d52e3d2182a17091"></a><!-- doxytag: member="res_config_ldap.c::ldap_lock" ref="a55f48ee8d8b928c4d52e3d2182a17091" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="lock_8h.html#a2d9118a2a8939f115eea771bce3a52f2">ast_mutex_t</a> <a class="el" href="res__config__ldap_8c.html#a55f48ee8d8b928c4d52e3d2182a17091">ldap_lock</a> = ((<a class="el" href="lock_8h.html#a2d9118a2a8939f115eea771bce3a52f2">ast_mutex_t</a>) PTHREAD_MUTEX_INITIALIZER )<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l00064">64</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>Referenced by <a class="el" href="res__config__ldap_8c_source.html#l00544">ldap_loadentry()</a>, <a class="el" href="res__config__ldap_8c_source.html#l01508">load_module()</a>, <a class="el" href="res__config__ldap_8c_source.html#l00718">realtime_ldap_base_ap()</a>, <a class="el" href="res__config__ldap_8c_source.html#l01550">reload()</a>, <a class="el" href="res__config__ldap_8c_source.html#l01529">unload_module()</a>, <a class="el" href="res__config__ldap_8c_source.html#l01315">update2_ldap()</a>, and <a class="el" href="res__config__ldap_8c_source.html#l01128">update_ldap()</a>.</p>

</div>
</div>
<a class="anchor" id="a85f014c471fb55bc84c880601e5ff403"></a><!-- doxytag: member="res_config_ldap.c::ldapConn" ref="a85f014c471fb55bc84c880601e5ff403" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">LDAP* <a class="el" href="res__config__ldap_8c.html#a85f014c471fb55bc84c880601e5ff403">ldapConn</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l00066">66</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

</div>
</div>
<a class="anchor" id="a68433c52f2199bd92a3c151b295de06e"></a><!-- doxytag: member="res_config_ldap.c::pass" ref="a68433c52f2199bd92a3c151b295de06e" args="[50]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="res__config__ldap_8c.html#a68433c52f2199bd92a3c151b295de06e">pass</a>[50]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l00069">69</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>Referenced by <a class="el" href="dsp_8c_source.html#l00963">__ast_dsp_call_progress()</a>, <a class="el" href="chan__sip_8c_source.html#l06909">__get_header()</a>, <a class="el" href="pbx__gtkconsole_8c_source.html#l00277">add_mod()</a>, <a class="el" href="db_8c_source.html#l00091">ast_db_deltree()</a>, <a class="el" href="db_8c_source.html#l00473">ast_db_gettree()</a>, <a class="el" href="pbx__dundi_8c_source.html#l03450">build_transactions()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00773">gtalk_create_candidates()</a>, <a class="el" href="db_8c_source.html#l00350">handle_cli_database_show()</a>, <a class="el" href="db_8c_source.html#l00415">handle_cli_database_showkey()</a>, <a class="el" href="chan__jingle_8c_source.html#l00583">jingle_create_candidates()</a>, and <a class="el" href="chan__agent_8c_source.html#l01981">login_exec()</a>.</p>

</div>
</div>
<a class="anchor" id="a4b7f6e04c04ac98ed68f7d62640d1d7b"></a><!-- doxytag: member="res_config_ldap.c::static_table_config" ref="a4b7f6e04c04ac98ed68f7d62640d1d7b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structldap__table__config.html">ldap_table_config</a>* <a class="el" href="res__config__ldap_8c.html#a4b7f6e04c04ac98ed68f7d62640d1d7b">static_table_config</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l00099">99</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>Referenced by <a class="el" href="res__config__ldap_8c_source.html#l01577">parse_config()</a>, <a class="el" href="res__config__ldap_8c_source.html#l00349">realtime_ldap_result_to_vars()</a>, and <a class="el" href="res__config__ldap_8c_source.html#l00199">table_configs_free()</a>.</p>

</div>
</div>
<a class="anchor" id="a75e4590043edf35241d30fabe2eda546"></a><!-- doxytag: member="res_config_ldap.c::url" ref="a75e4590043edf35241d30fabe2eda546" args="[512]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="res__config__ldap_8c.html#a75e4590043edf35241d30fabe2eda546">url</a>[512]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l00067">67</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>Referenced by <a class="el" href="func__curl_8c_source.html#l00397">acf_curl_exec()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="app__queue_8c_source.html#l05031">queue_exec()</a>, <a class="el" href="chan__sip_8c_source.html#l09423">reqprep()</a>, <a class="el" href="chan__sip_8c_source.html#l09357">respprep()</a>, <a class="el" href="app__url_8c_source.html#l00093">sendurl_exec()</a>, and <a class="el" href="chan__sip_8c_source.html#l04476">sip_sendhtml()</a>.</p>

</div>
</div>
<a class="anchor" id="a930c15eddfe0826ff30e658c9d50b9b4"></a><!-- doxytag: member="res_config_ldap.c::user" ref="a930c15eddfe0826ff30e658c9d50b9b4" args="[512]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="structuser.html">user</a>[512]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l00068">68</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

</div>
</div>
<a class="anchor" id="aad880fc4455c253781e8968f2239d56f"></a><!-- doxytag: member="res_config_ldap.c::version" ref="aad880fc4455c253781e8968f2239d56f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="res__config__pgsql_8c.html#aad880fc4455c253781e8968f2239d56f">version</a> = 3<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="res__config__ldap_8c_source.html#l00071">71</a> of file <a class="el" href="res__config__ldap_8c_source.html">res_config_ldap.c</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l10016">add_sdp()</a>, <a class="el" href="res__jabber_8c_source.html#l01413">aji_dinfo_handler()</a>, <a class="el" href="asterisk_8c_source.html#l02784">ast_readconfig()</a>, <a class="el" href="asterisk_8c_source.html#l02595">ast_remotecontrol()</a>, <a class="el" href="rtp_8c_source.html#l01562">ast_rtp_read()</a>, <a class="el" href="agent_8c_source.html#l00756">ast_var_Version()</a>, <a class="el" href="chan__iax2_8c_source.html#l07197">check_access()</a>, <a class="el" href="cdr__pgsql_8c_source.html#l00362">config_module()</a>, <a class="el" href="manager_8c_source.html#l02885">manager_modulecheck()</a>, and <a class="el" href="chan__iax2_8c_source.html#l08346">update_registry()</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:23:10 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
