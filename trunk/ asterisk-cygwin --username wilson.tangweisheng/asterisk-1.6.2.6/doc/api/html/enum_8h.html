<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:22:01 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_1ab815038f534adda65c8b4ae4993449.html">include</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_16d825f1fa9ecca2e70b1a8d9256d0e6.html">asterisk</a>
  </div>
</div>
<div class="contents">
<h1>enum.h File Reference</h1>
<p>DNS and ENUM functions.  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="channel_8h_source.html">asterisk/channel.h</a>&quot;</code><br/>

<p><a href="enum_8h_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structenum__context.html">enum_context</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structenum__naptr__rr.html">enum_naptr_rr</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structnaptr.html">naptr</a></td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="enum_8h.html#a78f8028f7987a9cd7815482a6821eff0">ast_enum_init</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="enum_8h.html#a47d896ad80bdb2724afb0de74d47c614">ast_enum_reload</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="enum_8h.html#ace12d602d1d202d4ccd8b689f71d93cd">ast_get_enum</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *<a class="el" href="structnumber.html">number</a>, char *location, int maxloc, char *technology, int maxtech, char *suffix, char *options, unsigned int record, struct <a class="el" href="structenum__context.html">enum_context</a> **argcontext)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Lookup entry in ENUM.  <a href="#ace12d602d1d202d4ccd8b689f71d93cd"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="enum_8h.html#a2320a6addc8ea6dbc676f16ded1d325d">ast_get_txt</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *<a class="el" href="structnumber.html">number</a>, char *txt, int maxtxt, char *suffix)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Lookup DNS TXT record (used by app TXTCIDnum).  <a href="#a2320a6addc8ea6dbc676f16ded1d325d"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>DNS and ENUM functions. </p>

<p>Definition in file <a class="el" href="enum_8h_source.html">enum.h</a>.</p>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a78f8028f7987a9cd7815482a6821eff0"></a><!-- doxytag: member="enum.h::ast_enum_init" ref="a78f8028f7987a9cd7815482a6821eff0" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_enum_init </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="enum_8c_source.html#l00997">997</a> of file <a class="el" href="enum_8c_source.html">enum.c</a>.</p>

<p>References <a class="el" href="enum_8c_source.html#l00959">private_enum_init()</a>.</p>

<p>Referenced by <a class="el" href="asterisk_8c_source.html#l03095">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00998"></a>00998 {
<a name="l00999"></a>00999    <span class="keywordflow">return</span> <a class="code" href="enum_8c.html#a0865ccd46f3c83ea5c2818ec14e56425" title="Initialize the ENUM support subsystem.">private_enum_init</a>(0);
<a name="l01000"></a>01000 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a47d896ad80bdb2724afb0de74d47c614"></a><!-- doxytag: member="enum.h::ast_enum_reload" ref="a47d896ad80bdb2724afb0de74d47c614" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_enum_reload </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="enum_8c_source.html#l01002">1002</a> of file <a class="el" href="enum_8c_source.html">enum.c</a>.</p>

<p>References <a class="el" href="enum_8c_source.html#l00959">private_enum_init()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01003"></a>01003 {
<a name="l01004"></a>01004    <span class="keywordflow">return</span> <a class="code" href="enum_8c.html#a0865ccd46f3c83ea5c2818ec14e56425" title="Initialize the ENUM support subsystem.">private_enum_init</a>(1);
<a name="l01005"></a>01005 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ace12d602d1d202d4ccd8b689f71d93cd"></a><!-- doxytag: member="enum.h::ast_get_enum" ref="ace12d602d1d202d4ccd8b689f71d93cd" args="(struct ast_channel *chan, const char *number, char *location, int maxloc, char *technology, int maxtech, char *suffix, char *options, unsigned int record, struct enum_context **argcontext)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_get_enum </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>number</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>location</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>maxloc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>technology</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>maxtech</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>suffix</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>options</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>record</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structenum__context.html">enum_context</a> **&nbsp;</td>
          <td class="paramname"> <em>argcontext</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Lookup entry in ENUM. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel </td></tr>
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structnumber.html" title="Number structure.">number</a></em>&nbsp;</td><td>E164 <a class="el" href="structnumber.html" title="Number structure.">number</a> with or without the leading + </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>location</em>&nbsp;</td><td>Number returned (or SIP uri) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>maxloc</em>&nbsp;</td><td>Max length </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>technology</em>&nbsp;</td><td>Technology (from url scheme in response) You can set it to get particular answer RR, if there are many techs in DNS response, example: "sip" If you need any record, then set it to "ALL" string </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>maxtech</em>&nbsp;</td><td>Max length </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>suffix</em>&nbsp;</td><td>Zone suffix (WARNING: No defaults here any more) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>options</em>&nbsp;</td><td>Options 'c' - Count <a class="el" href="structnumber.html" title="Number structure.">number</a> of NAPTR RR <a class="el" href="structnumber.html" title="Number structure.">number</a> - Position of the requested RR in the answer list 'u' - Full URI return (does not strip URI scheme) 'i' - Infrastructure ENUM lookup 's' - ISN based lookup 'd' - Direct DNS query </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>record</em>&nbsp;</td><td>The position of required RR in the answer list </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>argcontext</em>&nbsp;</td><td>Argument for caching results into an <a class="el" href="structenum__context.html">enum_context</a> pointer (NULL is used for not caching) </td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>1</em>&nbsp;</td><td>if found </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>if not found </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on hangup </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="enum_8c_source.html#l00628">628</a> of file <a class="el" href="enum_8c_source.html">enum.c</a>.</p>

<p>References <a class="el" href="autoservice_8c_source.html#l00192">ast_autoservice_start()</a>, <a class="el" href="autoservice_8c_source.html#l00251">ast_autoservice_stop()</a>, <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="dns_8c_source.html#l00255">ast_search_dns()</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="time_8h_source.html#l00089">ast_tvdiff_ms()</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="enum_8c_source.html#l00320">blr_ebl()</a>, <a class="el" href="enum_8c_source.html#l00191">blr_txt()</a>, <a class="el" href="enum_8c_source.html#l00106">cclen()</a>, <a class="el" href="chan__alsa_8c_source.html#l00105">context</a>, <a class="el" href="enum_8h_source.html#l00049">enum_context::count</a>, <a class="el" href="enum_8h_source.html#l00041">enum_context::dst</a>, <a class="el" href="enum_8h_source.html#l00042">enum_context::dstlen</a>, <a class="el" href="enum_8c_source.html#l00595">enum_callback()</a>, <a class="el" href="enum_8c_source.html#l00091">enumlock</a>, <a class="el" href="enum_8c_source.html#l00083">ENUMLOOKUP_BLR_CC</a>, <a class="el" href="enum_8c_source.html#l00085">ENUMLOOKUP_BLR_EBL</a>, <a class="el" href="enum_8c_source.html#l00084">ENUMLOOKUP_BLR_TXT</a>, <a class="el" href="enum_8c_source.html#l00586">ENUMLOOKUP_OPTIONS_COUNT</a>, <a class="el" href="enum_8c_source.html#l00592">ENUMLOOKUP_OPTIONS_DIRECT</a>, <a class="el" href="enum_8c_source.html#l00590">ENUMLOOKUP_OPTIONS_IENUM</a>, <a class="el" href="enum_8c_source.html#l00588">ENUMLOOKUP_OPTIONS_ISN</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="enum_8h_source.html#l00034">enum_naptr_rr::naptr</a>, <a class="el" href="enum_8h_source.html#l00051">enum_context::naptr_rrs</a>, <a class="el" href="enum_8h_source.html#l00052">enum_context::naptr_rrs_count</a>, <a class="el" href="enum_8h_source.html#l00047">enum_context::naptrinput</a>, <a class="el" href="enum_8h_source.html#l00050">enum_context::options</a>, <a class="el" href="enum_8h_source.html#l00029">naptr::order</a>, <a class="el" href="enum_8h_source.html#l00048">enum_context::position</a>, <a class="el" href="enum_8h_source.html#l00030">naptr::pref</a>, <a class="el" href="enum_8h_source.html#l00035">enum_naptr_rr::result</a>, <a class="el" href="enum_8h_source.html#l00037">enum_naptr_rr::sort_pos</a>, <a class="el" href="enum_8h_source.html#l00036">enum_naptr_rr::tech</a>, <a class="el" href="enum_8h_source.html#l00043">enum_context::tech</a>, and <a class="el" href="enum_8h_source.html#l00044">enum_context::techlen</a>.</p>

<p>Referenced by <a class="el" href="func__enum_8c_source.html#l00251">enum_query_read()</a>, and <a class="el" href="func__enum_8c_source.html#l00154">function_enum()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00629"></a>00629 {
<a name="l00630"></a>00630    <span class="keyword">struct </span><a class="code" href="structenum__context.html">enum_context</a> *<a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>;
<a name="l00631"></a>00631    <span class="keywordtype">char</span> tmp[512];
<a name="l00632"></a>00632    <span class="keywordtype">char</span> <a class="code" href="structdomain.html" title="Domain data structure.">domain</a>[256];
<a name="l00633"></a>00633    <span class="keywordtype">char</span> left[128];
<a name="l00634"></a>00634    <span class="keywordtype">char</span> middle[128];
<a name="l00635"></a>00635    <span class="keywordtype">char</span> <a class="code" href="structenum__context.html#a4d469e97d6119219edc9215e90622397">naptrinput</a>[128];
<a name="l00636"></a>00636    <span class="keywordtype">char</span> apex[128] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00637"></a>00637    <span class="keywordtype">int</span> ret = -1;
<a name="l00638"></a>00638    <span class="comment">/* for ISN rewrite */</span>
<a name="l00639"></a>00639    <span class="keywordtype">char</span> *p1 = NULL;
<a name="l00640"></a>00640    <span class="keywordtype">char</span> *p2 = NULL;
<a name="l00641"></a>00641    <span class="keywordtype">char</span> *p3 = NULL;
<a name="l00642"></a>00642    <span class="keywordtype">int</span> k = 0;
<a name="l00643"></a>00643    <span class="keywordtype">int</span> i = 0;
<a name="l00644"></a>00644    <span class="keywordtype">int</span> z = 0;
<a name="l00645"></a>00645    <span class="keywordtype">int</span> spaceleft = 0;
<a name="l00646"></a>00646    <span class="keyword">struct </span>timeval time_start, time_end;
<a name="l00647"></a>00647  
<a name="l00648"></a>00648    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(suffix)) {
<a name="l00649"></a>00649       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;ast_get_enum need a suffix parameter now.\n&quot;</span>);
<a name="l00650"></a>00650       <span class="keywordflow">return</span> -1;
<a name="l00651"></a>00651    }
<a name="l00652"></a>00652 
<a name="l00653"></a>00653    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;ast_get_enum(num=&apos;%s&apos;, tech=&apos;%s&apos;, suffix=&apos;%s&apos;, options=&apos;%s&apos;, record=%d\n&quot;</span>, <a class="code" href="structnumber.html" title="Number structure.">number</a>, tech, suffix, options, record);
<a name="l00654"></a>00654 
<a name="l00655"></a>00655 <span class="comment">/*</span>
<a name="l00656"></a>00656 <span class="comment">  We don&apos;t need that any more, that &quot;n&quot; preceding the number has been replaced by a flag</span>
<a name="l00657"></a>00657 <span class="comment">  in the options paramter.</span>
<a name="l00658"></a>00658 <span class="comment">   ast_copy_string(naptrinput, number, sizeof(naptrinput));</span>
<a name="l00659"></a>00659 <span class="comment">*/</span>
<a name="l00660"></a>00660 <span class="comment">/*</span>
<a name="l00661"></a>00661 <span class="comment"> * The &quot;number&quot; parameter includes a leading &apos;+&apos; if it&apos;s a full E.164 number (and not ISN)</span>
<a name="l00662"></a>00662 <span class="comment"> * We need to preserve that as the regex inside NAPTRs expect the +.</span>
<a name="l00663"></a>00663 <span class="comment"> *</span>
<a name="l00664"></a>00664 <span class="comment"> * But for the domain generation, the &apos;+&apos; is a nuissance, so we get rid of it.</span>
<a name="l00665"></a>00665 <span class="comment">*/</span>
<a name="l00666"></a>00666    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(naptrinput, <a class="code" href="structnumber.html" title="Number structure.">number</a>[0] == <span class="charliteral">&apos;n&apos;</span> ? <a class="code" href="structnumber.html" title="Number structure.">number</a> + 1 : <a class="code" href="structnumber.html" title="Number structure.">number</a>, <span class="keyword">sizeof</span>(naptrinput));
<a name="l00667"></a>00667    <span class="keywordflow">if</span> (<a class="code" href="structnumber.html" title="Number structure.">number</a>[0] == <span class="charliteral">&apos;+&apos;</span>) {
<a name="l00668"></a>00668       <a class="code" href="structnumber.html" title="Number structure.">number</a>++;
<a name="l00669"></a>00669    }
<a name="l00670"></a>00670 
<a name="l00671"></a>00671    <span class="keywordflow">if</span> (!(context = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*context))))
<a name="l00672"></a>00672       <span class="keywordflow">return</span> -1;
<a name="l00673"></a>00673 
<a name="l00674"></a>00674    <span class="keywordflow">if</span>((p3 = strchr(naptrinput, <span class="charliteral">&apos;*&apos;</span>))) {
<a name="l00675"></a>00675       *p3=<span class="charliteral">&apos;\0&apos;</span>;      
<a name="l00676"></a>00676    }
<a name="l00677"></a>00677 
<a name="l00678"></a>00678    context-&gt;<a class="code" href="structenum__context.html#a4d469e97d6119219edc9215e90622397">naptrinput</a> = naptrinput;   <span class="comment">/* The number */</span>
<a name="l00679"></a>00679    context-&gt;<a class="code" href="structenum__context.html#a4f15ee8aa627692edfd6bdfe9a45fbf9">dst</a> = dst;        <span class="comment">/* Return string */</span>
<a name="l00680"></a>00680    context-&gt;<a class="code" href="structenum__context.html#a09933d827be564d0a0afebe6ffa00773">dstlen</a> = dstlen;
<a name="l00681"></a>00681    context-&gt;<a class="code" href="structenum__context.html#aeca41cda3ae501467b8637dbb685443b">tech</a> = tech;
<a name="l00682"></a>00682    context-&gt;<a class="code" href="structenum__context.html#a970f0bd322ba19ad9f14eaa6ecb1a814">techlen</a> = techlen;
<a name="l00683"></a>00683    context-&gt;<a class="code" href="structenum__context.html#a849fa981f121eb25a67e4e14392840ba">options</a> = 0;
<a name="l00684"></a>00684    context-&gt;<a class="code" href="structenum__context.html#a401e942526aac47cef94f478182486e7">position</a> = record &gt; 0 ? record : 1;
<a name="l00685"></a>00685    context-&gt;<a class="code" href="structenum__context.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a> = 0;
<a name="l00686"></a>00686    context-&gt;<a class="code" href="structenum__context.html#accaf620f3e890f0fbf1c86a605f65472">naptr_rrs</a> = NULL;
<a name="l00687"></a>00687    context-&gt;<a class="code" href="structenum__context.html#aa0068b75c25dfc2c01a7c2471978e0c4">naptr_rrs_count</a> = 0;
<a name="l00688"></a>00688 
<a name="l00689"></a>00689    <span class="comment">/*</span>
<a name="l00690"></a>00690 <span class="comment">    * Process options:</span>
<a name="l00691"></a>00691 <span class="comment">    *</span>
<a name="l00692"></a>00692 <span class="comment">    *    c  Return count, not URI</span>
<a name="l00693"></a>00693 <span class="comment">    *    i  Use infrastructure ENUM </span>
<a name="l00694"></a>00694 <span class="comment">    *    s  Do ISN transformation</span>
<a name="l00695"></a>00695 <span class="comment">    *    d  Direct DNS query: no reversing.</span>
<a name="l00696"></a>00696 <span class="comment">    *</span>
<a name="l00697"></a>00697 <span class="comment">    */</span>
<a name="l00698"></a>00698    <span class="keywordflow">if</span> (options != NULL) {
<a name="l00699"></a>00699       <span class="keywordflow">if</span> (strchr(options,<span class="charliteral">&apos;s&apos;</span>)) {
<a name="l00700"></a>00700          context-&gt;<a class="code" href="structenum__context.html#a849fa981f121eb25a67e4e14392840ba">options</a> |= <a class="code" href="enum_8c.html#ab63c80a29b183ad5b4f85fb5cdfcbf11">ENUMLOOKUP_OPTIONS_ISN</a>;
<a name="l00701"></a>00701       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strchr(options,<span class="charliteral">&apos;i&apos;</span>)) {
<a name="l00702"></a>00702          context-&gt;<a class="code" href="structenum__context.html#a849fa981f121eb25a67e4e14392840ba">options</a> |= <a class="code" href="enum_8c.html#acafdc00da9410652ffa46b5cc6653f90">ENUMLOOKUP_OPTIONS_IENUM</a>;
<a name="l00703"></a>00703       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strchr(options,<span class="charliteral">&apos;d&apos;</span>)) {
<a name="l00704"></a>00704          context-&gt;<a class="code" href="structenum__context.html#a849fa981f121eb25a67e4e14392840ba">options</a> |= <a class="code" href="enum_8c.html#adfc40e04d7adfed812da4647e65d683e">ENUMLOOKUP_OPTIONS_DIRECT</a>;
<a name="l00705"></a>00705       }
<a name="l00706"></a>00706       <span class="keywordflow">if</span> (strchr(options,<span class="charliteral">&apos;c&apos;</span>)) {
<a name="l00707"></a>00707          context-&gt;<a class="code" href="structenum__context.html#a849fa981f121eb25a67e4e14392840ba">options</a> |= <a class="code" href="enum_8c.html#a80568ff5362beeb0051699a8deaf1f1e">ENUMLOOKUP_OPTIONS_COUNT</a>;
<a name="l00708"></a>00708       }
<a name="l00709"></a>00709       <span class="keywordflow">if</span> (strchr(<a class="code" href="structnumber.html" title="Number structure.">number</a>,<span class="charliteral">&apos;*&apos;</span>)) {
<a name="l00710"></a>00710          context-&gt;<a class="code" href="structenum__context.html#a849fa981f121eb25a67e4e14392840ba">options</a> |= <a class="code" href="enum_8c.html#ab63c80a29b183ad5b4f85fb5cdfcbf11">ENUMLOOKUP_OPTIONS_ISN</a>;
<a name="l00711"></a>00711       }
<a name="l00712"></a>00712    }
<a name="l00713"></a>00713    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;ENUM options(%s): pos=%d, options=&apos;%d&apos;\n&quot;</span>, options, context-&gt;<a class="code" href="structenum__context.html#a401e942526aac47cef94f478182486e7">position</a>, context-&gt;<a class="code" href="structenum__context.html#a849fa981f121eb25a67e4e14392840ba">options</a>);
<a name="l00714"></a>00714    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;ast_get_enum(): n=&apos;%s&apos;, tech=&apos;%s&apos;, suffix=&apos;%s&apos;, options=&apos;%d&apos;, record=&apos;%d&apos;\n&quot;</span>,
<a name="l00715"></a>00715          <a class="code" href="structnumber.html" title="Number structure.">number</a>, tech, suffix, context-&gt;<a class="code" href="structenum__context.html#a849fa981f121eb25a67e4e14392840ba">options</a>, context-&gt;<a class="code" href="structenum__context.html#a401e942526aac47cef94f478182486e7">position</a>);
<a name="l00716"></a>00716 
<a name="l00717"></a>00717    <span class="comment">/*</span>
<a name="l00718"></a>00718 <span class="comment">    * This code does more than simple RFC3261 ENUM. All these rewriting </span>
<a name="l00719"></a>00719 <span class="comment">    * schemes have in common that they build the FQDN for the NAPTR lookup</span>
<a name="l00720"></a>00720 <span class="comment">    * by concatenating</span>
<a name="l00721"></a>00721 <span class="comment">    *    - a number which needs be flipped and &quot;.&quot;-seperated   (left)</span>
<a name="l00722"></a>00722 <span class="comment">    *    - some fixed string              (middle)</span>
<a name="l00723"></a>00723 <span class="comment">    *    - an Apex.                 (apex)</span>
<a name="l00724"></a>00724 <span class="comment">    *</span>
<a name="l00725"></a>00725 <span class="comment">    * The RFC3261 ENUM is: left=full number, middle=&quot;&quot;, apex=from args.</span>
<a name="l00726"></a>00726 <span class="comment">    * ISN:  number = &quot;middle*left&quot;, apex=from args</span>
<a name="l00727"></a>00727 <span class="comment">    * I-ENUM: EBL parameters build the split, can change apex</span>
<a name="l00728"></a>00728 <span class="comment">    * Direct: left=&quot;&quot;, middle=argument, apex=from args</span>
<a name="l00729"></a>00729 <span class="comment">    *</span>
<a name="l00730"></a>00730 <span class="comment">    */</span>
<a name="l00731"></a>00731 
<a name="l00732"></a>00732    <span class="comment">/* default: the whole number will be flipped, no middle domain component */</span>
<a name="l00733"></a>00733    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(left, <a class="code" href="structnumber.html" title="Number structure.">number</a>, <span class="keyword">sizeof</span>(left));
<a name="l00734"></a>00734    middle[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00735"></a>00735    <span class="comment">/*</span>
<a name="l00736"></a>00736 <span class="comment">    * I-ENUM can change the apex, thus we copy it </span>
<a name="l00737"></a>00737 <span class="comment">    */</span>
<a name="l00738"></a>00738    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(apex, suffix, <span class="keyword">sizeof</span>(apex));
<a name="l00739"></a>00739    <span class="comment">/* ISN rewrite */</span>
<a name="l00740"></a>00740    <span class="keywordflow">if</span> ((context-&gt;<a class="code" href="structenum__context.html#a849fa981f121eb25a67e4e14392840ba">options</a> &amp; <a class="code" href="enum_8c.html#ab63c80a29b183ad5b4f85fb5cdfcbf11">ENUMLOOKUP_OPTIONS_ISN</a>) &amp;&amp; (p1 = strchr(<a class="code" href="structnumber.html" title="Number structure.">number</a>, <span class="charliteral">&apos;*&apos;</span>))) {
<a name="l00741"></a>00741       *p1++ = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00742"></a>00742       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(left, <a class="code" href="structnumber.html" title="Number structure.">number</a>, <span class="keyword">sizeof</span>(left));
<a name="l00743"></a>00743       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(middle, p1, <span class="keyword">sizeof</span>(middle) - 1);
<a name="l00744"></a>00744       strcat(middle, <span class="stringliteral">&quot;.&quot;</span>);
<a name="l00745"></a>00745 
<a name="l00746"></a>00746       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;ISN ENUM: left=%s, middle=&apos;%s&apos;\n&quot;</span>, left, middle);
<a name="l00747"></a>00747    <span class="comment">/* Direct DNS lookup rewrite */</span>
<a name="l00748"></a>00748    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (context-&gt;<a class="code" href="structenum__context.html#a849fa981f121eb25a67e4e14392840ba">options</a> &amp; <a class="code" href="enum_8c.html#adfc40e04d7adfed812da4647e65d683e">ENUMLOOKUP_OPTIONS_DIRECT</a>) {
<a name="l00749"></a>00749       left[0] = 0; <span class="comment">/* nothing to flip around */</span>
<a name="l00750"></a>00750       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(middle, <a class="code" href="structnumber.html" title="Number structure.">number</a>, <span class="keyword">sizeof</span>(middle) - 1);
<a name="l00751"></a>00751       strcat(middle, <span class="stringliteral">&quot;.&quot;</span>);
<a name="l00752"></a>00752  
<a name="l00753"></a>00753       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;DIRECT ENUM:  middle=&apos;%s&apos;\n&quot;</span>, middle);
<a name="l00754"></a>00754    <span class="comment">/* Infrastructure ENUM rewrite */</span>
<a name="l00755"></a>00755    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (context-&gt;<a class="code" href="structenum__context.html#a849fa981f121eb25a67e4e14392840ba">options</a> &amp; <a class="code" href="enum_8c.html#acafdc00da9410652ffa46b5cc6653f90">ENUMLOOKUP_OPTIONS_IENUM</a>) {
<a name="l00756"></a>00756       <span class="keywordtype">int</span> sdl = 0;
<a name="l00757"></a>00757       <span class="keywordtype">char</span> cc[8];
<a name="l00758"></a>00758       <span class="keywordtype">char</span> sep[256], n_apex[256];
<a name="l00759"></a>00759       <span class="keywordtype">int</span> cc_len = <a class="code" href="enum_8c.html#aa2e89a9afd23d7f94e608e1474832091" title="Determine the length of a country code when given an E.164 string.">cclen</a>(<a class="code" href="structnumber.html" title="Number structure.">number</a>);
<a name="l00760"></a>00760       sdl = cc_len;
<a name="l00761"></a>00761       <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;<a class="code" href="enum_8c.html#ab5b4e17c6fe8b24534ed09383f512b06">enumlock</a>);
<a name="l00762"></a>00762       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(sep, <a class="code" href="enum_8c.html#a48dbbc896e14cd8cab443a8066ea1e8b">ienum_branchlabel</a>, <span class="keyword">sizeof</span>(sep)); <span class="comment">/* default */</span>
<a name="l00763"></a>00763       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="enum_8c.html#ab5b4e17c6fe8b24534ed09383f512b06">enumlock</a>);
<a name="l00764"></a>00764 
<a name="l00765"></a>00765       <span class="keywordflow">switch</span> (<a class="code" href="enum_8c.html#afe913060145c35f4046f5245b2534cf9">ebl_alg</a>) {
<a name="l00766"></a>00766       <span class="keywordflow">case</span> <a class="code" href="enum_8c.html#a8e005634423607f0e6b0217338a162eb">ENUMLOOKUP_BLR_EBL</a>:
<a name="l00767"></a>00767          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(cc, <a class="code" href="structnumber.html" title="Number structure.">number</a>, cc_len); <span class="comment">/* cclen() never returns more than 3 */</span>
<a name="l00768"></a>00768          sdl = <a class="code" href="enum_8c.html#a13d957694dbb782613d0050d80492766" title="Evaluate the I-ENUM branch as stored in an EBL record.">blr_ebl</a>(cc, suffix, sep, <span class="keyword">sizeof</span>(sep) - 1, n_apex, <span class="keyword">sizeof</span>(n_apex) - 1);
<a name="l00769"></a>00769 
<a name="l00770"></a>00770          <span class="keywordflow">if</span> (sdl &gt;= 0) {
<a name="l00771"></a>00771             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(apex, n_apex, <span class="keyword">sizeof</span>(apex));
<a name="l00772"></a>00772             <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;EBL ENUM: sep=%s, apex=&apos;%s&apos;\n&quot;</span>, sep, n_apex);
<a name="l00773"></a>00773          } <span class="keywordflow">else</span> {
<a name="l00774"></a>00774             sdl = cc_len;
<a name="l00775"></a>00775          }
<a name="l00776"></a>00776          <span class="keywordflow">break</span>;
<a name="l00777"></a>00777       <span class="keywordflow">case</span> <a class="code" href="enum_8c.html#a3f852d573c62b08575b25c76d5e837f6">ENUMLOOKUP_BLR_TXT</a>:
<a name="l00778"></a>00778          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(cc, <a class="code" href="structnumber.html" title="Number structure.">number</a>, cc_len); <span class="comment">/* cclen() never returns more than 3 */</span>
<a name="l00779"></a>00779          sdl = <a class="code" href="enum_8c.html#abb116596bc2ed451c606f1a45a16b3b2" title="Determine the branch location record as stored in a TXT record.">blr_txt</a>(cc, suffix);
<a name="l00780"></a>00780 
<a name="l00781"></a>00781          <span class="keywordflow">if</span> (sdl &lt; 0) 
<a name="l00782"></a>00782             sdl = cc_len;
<a name="l00783"></a>00783          <span class="keywordflow">break</span>;
<a name="l00784"></a>00784 
<a name="l00785"></a>00785       <span class="keywordflow">case</span> <a class="code" href="enum_8c.html#a4e7355b2e878225f47929cd3bb0276bc">ENUMLOOKUP_BLR_CC</a>: <span class="comment">/* BLR is at the country-code level */</span>
<a name="l00786"></a>00786       <span class="keywordflow">default</span>:
<a name="l00787"></a>00787          sdl = cc_len;
<a name="l00788"></a>00788          <span class="keywordflow">break</span>;
<a name="l00789"></a>00789       }
<a name="l00790"></a>00790 
<a name="l00791"></a>00791       <span class="keywordflow">if</span> (sdl &gt; strlen(<a class="code" href="structnumber.html" title="Number structure.">number</a>)) {   <span class="comment">/* Number too short for this sdl? */</span>
<a name="l00792"></a>00792          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;I-ENUM: subdomain location %d behind number %s\n&quot;</span>, sdl, <a class="code" href="structnumber.html" title="Number structure.">number</a>);
<a name="l00793"></a>00793          <span class="keywordflow">return</span> 0;
<a name="l00794"></a>00794       }
<a name="l00795"></a>00795       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(left, <a class="code" href="structnumber.html" title="Number structure.">number</a> + sdl, <span class="keyword">sizeof</span>(left));
<a name="l00796"></a>00796 
<a name="l00797"></a>00797       <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;<a class="code" href="enum_8c.html#ab5b4e17c6fe8b24534ed09383f512b06">enumlock</a>);
<a name="l00798"></a>00798       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(middle, sep, <span class="keyword">sizeof</span>(middle) - 1);
<a name="l00799"></a>00799       strcat(middle, <span class="stringliteral">&quot;.&quot;</span>);
<a name="l00800"></a>00800       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="enum_8c.html#ab5b4e17c6fe8b24534ed09383f512b06">enumlock</a>);
<a name="l00801"></a>00801 
<a name="l00802"></a>00802       <span class="comment">/* check the space we need for middle */</span>
<a name="l00803"></a>00803       <span class="keywordflow">if</span> ((sdl * 2 + strlen(middle) + 2) &gt; <span class="keyword">sizeof</span>(middle)) {
<a name="l00804"></a>00804          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;ast_get_enum: not enough space for I-ENUM rewrite.\n&quot;</span>);
<a name="l00805"></a>00805          <span class="keywordflow">return</span> -1;
<a name="l00806"></a>00806       }
<a name="l00807"></a>00807 
<a name="l00808"></a>00808       p1 = middle + strlen(middle);
<a name="l00809"></a>00809       <span class="keywordflow">for</span> (p2 = (<span class="keywordtype">char</span> *) <a class="code" href="structnumber.html" title="Number structure.">number</a> + sdl - 1; p2 &gt;= <a class="code" href="structnumber.html" title="Number structure.">number</a>; p2--) {
<a name="l00810"></a>00810          <span class="keywordflow">if</span> (isdigit(*p2)) {
<a name="l00811"></a>00811             *p1++ = *p2;
<a name="l00812"></a>00812             *p1++ = <span class="charliteral">&apos;.&apos;</span>;
<a name="l00813"></a>00813          }
<a name="l00814"></a>00814       }
<a name="l00815"></a>00815       *p1 = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00816"></a>00816 
<a name="l00817"></a>00817       <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;I-ENUM: cclen=%d, left=%s, middle=&apos;%s&apos;, apex=&apos;%s&apos;\n&quot;</span>, cc_len, left, middle, apex);
<a name="l00818"></a>00818    }
<a name="l00819"></a>00819 
<a name="l00820"></a>00820    <span class="keywordflow">if</span> (strlen(left) * 2 + 2 &gt; <span class="keyword">sizeof</span>(domain)) {
<a name="l00821"></a>00821       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;string to long in ast_get_enum\n&quot;</span>);
<a name="l00822"></a>00822       <span class="keywordflow">return</span> -1;
<a name="l00823"></a>00823    }
<a name="l00824"></a>00824 
<a name="l00825"></a>00825    <span class="comment">/* flip left into domain */</span>
<a name="l00826"></a>00826    p1 = domain;
<a name="l00827"></a>00827    <span class="keywordflow">for</span> (p2 = left + strlen(left); p2 &gt;= left; p2--) {
<a name="l00828"></a>00828       <span class="keywordflow">if</span> (isdigit(*p2)) {
<a name="l00829"></a>00829          *p1++ = *p2;
<a name="l00830"></a>00830          *p1++ = <span class="charliteral">&apos;.&apos;</span>;
<a name="l00831"></a>00831       }
<a name="l00832"></a>00832    }
<a name="l00833"></a>00833    *p1 = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00834"></a>00834 
<a name="l00835"></a>00835    <span class="keywordflow">if</span> (chan &amp;&amp; <a class="code" href="channel_8h.html#a7a8f6a50f3db42cb40cad7cfbd1d54f9" title="Automatically service a channel for us...">ast_autoservice_start</a>(chan) &lt; 0) {
<a name="l00836"></a>00836       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(context);
<a name="l00837"></a>00837       <span class="keywordflow">return</span> -1;
<a name="l00838"></a>00838    }
<a name="l00839"></a>00839 
<a name="l00840"></a>00840    spaceleft = <span class="keyword">sizeof</span>(tmp) - 2;
<a name="l00841"></a>00841    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(tmp, domain, spaceleft);
<a name="l00842"></a>00842    spaceleft -= strlen(domain);
<a name="l00843"></a>00843 
<a name="l00844"></a>00844    <span class="keywordflow">if</span> (*middle) {
<a name="l00845"></a>00845       strncat(tmp, middle, spaceleft);
<a name="l00846"></a>00846       spaceleft -= strlen(middle);
<a name="l00847"></a>00847    }
<a name="l00848"></a>00848 
<a name="l00849"></a>00849    strncat(tmp,apex,spaceleft);
<a name="l00850"></a>00850    time_start = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l00851"></a>00851    ret = <a class="code" href="dns_8h.html#abc8f5d3913800604e2dc0e00d24d3bec" title="Perform DNS lookup (used by DNS, enum and SRV lookups).">ast_search_dns</a>(context, tmp, C_IN, T_NAPTR, <a class="code" href="enum_8c.html#a9ba49a39ba5f3482aaf36940bd3596e1" title="Callback from ENUM lookup function.">enum_callback</a>);
<a name="l00852"></a>00852    time_end = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l00853"></a>00853 
<a name="l00854"></a>00854    <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;ast_get_enum() profiling: %s, %s, %d ms\n&quot;</span>, 
<a name="l00855"></a>00855          (ret == 0) ? <span class="stringliteral">&quot;OK&quot;</span> : <span class="stringliteral">&quot;FAIL&quot;</span>, tmp, <a class="code" href="time_8h.html#a74e35cffcd45ad6cd7c8587921e8a4c2" title="Computes the difference (in milliseconds) between two struct timeval instances.">ast_tvdiff_ms</a>(time_end, time_start));
<a name="l00856"></a>00856 
<a name="l00857"></a>00857    <span class="keywordflow">if</span> (ret &lt; 0) {
<a name="l00858"></a>00858       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;No such number found: %s (%s)\n&quot;</span>, tmp, strerror(errno));
<a name="l00859"></a>00859       strcpy(dst, <span class="stringliteral">&quot;0&quot;</span>);
<a name="l00860"></a>00860       ret = 0;
<a name="l00861"></a>00861    }
<a name="l00862"></a>00862 
<a name="l00863"></a>00863    <span class="keywordflow">if</span> (context-&gt;<a class="code" href="structenum__context.html#aa0068b75c25dfc2c01a7c2471978e0c4">naptr_rrs_count</a> &gt;= context-&gt;<a class="code" href="structenum__context.html#a401e942526aac47cef94f478182486e7">position</a> &amp;&amp; ! (context-&gt;<a class="code" href="structenum__context.html#a849fa981f121eb25a67e4e14392840ba">options</a> &amp; <a class="code" href="enum_8c.html#a80568ff5362beeb0051699a8deaf1f1e">ENUMLOOKUP_OPTIONS_COUNT</a>)) {
<a name="l00864"></a>00864       <span class="comment">/* sort array by NAPTR order/preference */</span>
<a name="l00865"></a>00865       <span class="keywordflow">for</span> (k = 0; k &lt; context-&gt;<a class="code" href="structenum__context.html#aa0068b75c25dfc2c01a7c2471978e0c4">naptr_rrs_count</a>; k++) {
<a name="l00866"></a>00866          <span class="keywordflow">for</span> (i = 0; i &lt; context-&gt;<a class="code" href="structenum__context.html#aa0068b75c25dfc2c01a7c2471978e0c4">naptr_rrs_count</a>; i++) {
<a name="l00867"></a>00867             <span class="comment">/* use order first and then preference to compare */</span>
<a name="l00868"></a>00868             <span class="keywordflow">if</span> ((ntohs(context-&gt;<a class="code" href="structenum__context.html#accaf620f3e890f0fbf1c86a605f65472">naptr_rrs</a>[k].<a class="code" href="structenum__naptr__rr.html#ae0f28558d5a1f46cb7f1b6dc3831f777">naptr</a>.<a class="code" href="structnaptr.html#a1236fced09ddfa5eb51667d641632420">order</a>) &lt; ntohs(context-&gt;<a class="code" href="structenum__context.html#accaf620f3e890f0fbf1c86a605f65472">naptr_rrs</a>[i].<a class="code" href="structenum__naptr__rr.html#ae0f28558d5a1f46cb7f1b6dc3831f777">naptr</a>.<a class="code" href="structnaptr.html#a1236fced09ddfa5eb51667d641632420">order</a>)
<a name="l00869"></a>00869                  &amp;&amp; context-&gt;<a class="code" href="structenum__context.html#accaf620f3e890f0fbf1c86a605f65472">naptr_rrs</a>[k].<a class="code" href="structenum__naptr__rr.html#af361f106e0a09ecd7f57c18d63ab969a">sort_pos</a> &gt; context-&gt;<a class="code" href="structenum__context.html#accaf620f3e890f0fbf1c86a605f65472">naptr_rrs</a>[i].<a class="code" href="structenum__naptr__rr.html#af361f106e0a09ecd7f57c18d63ab969a">sort_pos</a>)
<a name="l00870"></a>00870                  || (ntohs(context-&gt;<a class="code" href="structenum__context.html#accaf620f3e890f0fbf1c86a605f65472">naptr_rrs</a>[k].<a class="code" href="structenum__naptr__rr.html#ae0f28558d5a1f46cb7f1b6dc3831f777">naptr</a>.<a class="code" href="structnaptr.html#a1236fced09ddfa5eb51667d641632420">order</a>) &gt; ntohs(context-&gt;<a class="code" href="structenum__context.html#accaf620f3e890f0fbf1c86a605f65472">naptr_rrs</a>[i].<a class="code" href="structenum__naptr__rr.html#ae0f28558d5a1f46cb7f1b6dc3831f777">naptr</a>.<a class="code" href="structnaptr.html#a1236fced09ddfa5eb51667d641632420">order</a>)
<a name="l00871"></a>00871                  &amp;&amp; context-&gt;<a class="code" href="structenum__context.html#accaf620f3e890f0fbf1c86a605f65472">naptr_rrs</a>[k].<a class="code" href="structenum__naptr__rr.html#af361f106e0a09ecd7f57c18d63ab969a">sort_pos</a> &lt; context-&gt;<a class="code" href="structenum__context.html#accaf620f3e890f0fbf1c86a605f65472">naptr_rrs</a>[i].<a class="code" href="structenum__naptr__rr.html#af361f106e0a09ecd7f57c18d63ab969a">sort_pos</a>)) {
<a name="l00872"></a>00872                z = context-&gt;<a class="code" href="structenum__context.html#accaf620f3e890f0fbf1c86a605f65472">naptr_rrs</a>[k].<a class="code" href="structenum__naptr__rr.html#af361f106e0a09ecd7f57c18d63ab969a">sort_pos</a>;
<a name="l00873"></a>00873                context-&gt;<a class="code" href="structenum__context.html#accaf620f3e890f0fbf1c86a605f65472">naptr_rrs</a>[k].<a class="code" href="structenum__naptr__rr.html#af361f106e0a09ecd7f57c18d63ab969a">sort_pos</a> = context-&gt;<a class="code" href="structenum__context.html#accaf620f3e890f0fbf1c86a605f65472">naptr_rrs</a>[i].<a class="code" href="structenum__naptr__rr.html#af361f106e0a09ecd7f57c18d63ab969a">sort_pos</a>;
<a name="l00874"></a>00874                context-&gt;<a class="code" href="structenum__context.html#accaf620f3e890f0fbf1c86a605f65472">naptr_rrs</a>[i].<a class="code" href="structenum__naptr__rr.html#af361f106e0a09ecd7f57c18d63ab969a">sort_pos</a> = z;
<a name="l00875"></a>00875                <span class="keywordflow">continue</span>;
<a name="l00876"></a>00876             }
<a name="l00877"></a>00877             <span class="keywordflow">if</span> (ntohs(context-&gt;<a class="code" href="structenum__context.html#accaf620f3e890f0fbf1c86a605f65472">naptr_rrs</a>[k].<a class="code" href="structenum__naptr__rr.html#ae0f28558d5a1f46cb7f1b6dc3831f777">naptr</a>.<a class="code" href="structnaptr.html#a1236fced09ddfa5eb51667d641632420">order</a>) == ntohs(context-&gt;<a class="code" href="structenum__context.html#accaf620f3e890f0fbf1c86a605f65472">naptr_rrs</a>[i].<a class="code" href="structenum__naptr__rr.html#ae0f28558d5a1f46cb7f1b6dc3831f777">naptr</a>.<a class="code" href="structnaptr.html#a1236fced09ddfa5eb51667d641632420">order</a>)) {
<a name="l00878"></a>00878                <span class="keywordflow">if</span> ((ntohs(context-&gt;<a class="code" href="structenum__context.html#accaf620f3e890f0fbf1c86a605f65472">naptr_rrs</a>[k].<a class="code" href="structenum__naptr__rr.html#ae0f28558d5a1f46cb7f1b6dc3831f777">naptr</a>.<a class="code" href="structnaptr.html#af3c600e3fe56bb2df9789ddb9e305492">pref</a>) &lt; ntohs(context-&gt;<a class="code" href="structenum__context.html#accaf620f3e890f0fbf1c86a605f65472">naptr_rrs</a>[i].<a class="code" href="structenum__naptr__rr.html#ae0f28558d5a1f46cb7f1b6dc3831f777">naptr</a>.<a class="code" href="structnaptr.html#af3c600e3fe56bb2df9789ddb9e305492">pref</a>)
<a name="l00879"></a>00879                     &amp;&amp; context-&gt;<a class="code" href="structenum__context.html#accaf620f3e890f0fbf1c86a605f65472">naptr_rrs</a>[k].<a class="code" href="structenum__naptr__rr.html#af361f106e0a09ecd7f57c18d63ab969a">sort_pos</a> &gt; context-&gt;<a class="code" href="structenum__context.html#accaf620f3e890f0fbf1c86a605f65472">naptr_rrs</a>[i].<a class="code" href="structenum__naptr__rr.html#af361f106e0a09ecd7f57c18d63ab969a">sort_pos</a>)
<a name="l00880"></a>00880                     || (ntohs(context-&gt;<a class="code" href="structenum__context.html#accaf620f3e890f0fbf1c86a605f65472">naptr_rrs</a>[k].<a class="code" href="structenum__naptr__rr.html#ae0f28558d5a1f46cb7f1b6dc3831f777">naptr</a>.<a class="code" href="structnaptr.html#af3c600e3fe56bb2df9789ddb9e305492">pref</a>) &gt; ntohs(context-&gt;<a class="code" href="structenum__context.html#accaf620f3e890f0fbf1c86a605f65472">naptr_rrs</a>[i].<a class="code" href="structenum__naptr__rr.html#ae0f28558d5a1f46cb7f1b6dc3831f777">naptr</a>.<a class="code" href="structnaptr.html#af3c600e3fe56bb2df9789ddb9e305492">pref</a>)
<a name="l00881"></a>00881                     &amp;&amp; context-&gt;<a class="code" href="structenum__context.html#accaf620f3e890f0fbf1c86a605f65472">naptr_rrs</a>[k].<a class="code" href="structenum__naptr__rr.html#af361f106e0a09ecd7f57c18d63ab969a">sort_pos</a> &lt; context-&gt;<a class="code" href="structenum__context.html#accaf620f3e890f0fbf1c86a605f65472">naptr_rrs</a>[i].<a class="code" href="structenum__naptr__rr.html#af361f106e0a09ecd7f57c18d63ab969a">sort_pos</a>)) {
<a name="l00882"></a>00882                   z = context-&gt;<a class="code" href="structenum__context.html#accaf620f3e890f0fbf1c86a605f65472">naptr_rrs</a>[k].<a class="code" href="structenum__naptr__rr.html#af361f106e0a09ecd7f57c18d63ab969a">sort_pos</a>;
<a name="l00883"></a>00883                   context-&gt;<a class="code" href="structenum__context.html#accaf620f3e890f0fbf1c86a605f65472">naptr_rrs</a>[k].<a class="code" href="structenum__naptr__rr.html#af361f106e0a09ecd7f57c18d63ab969a">sort_pos</a> = context-&gt;<a class="code" href="structenum__context.html#accaf620f3e890f0fbf1c86a605f65472">naptr_rrs</a>[i].<a class="code" href="structenum__naptr__rr.html#af361f106e0a09ecd7f57c18d63ab969a">sort_pos</a>;
<a name="l00884"></a>00884                   context-&gt;<a class="code" href="structenum__context.html#accaf620f3e890f0fbf1c86a605f65472">naptr_rrs</a>[i].<a class="code" href="structenum__naptr__rr.html#af361f106e0a09ecd7f57c18d63ab969a">sort_pos</a> = z;
<a name="l00885"></a>00885                }
<a name="l00886"></a>00886             }
<a name="l00887"></a>00887          }
<a name="l00888"></a>00888       }
<a name="l00889"></a>00889       <span class="keywordflow">for</span> (k = 0; k &lt; context-&gt;<a class="code" href="structenum__context.html#aa0068b75c25dfc2c01a7c2471978e0c4">naptr_rrs_count</a>; k++) {
<a name="l00890"></a>00890          <span class="keywordflow">if</span> (context-&gt;<a class="code" href="structenum__context.html#accaf620f3e890f0fbf1c86a605f65472">naptr_rrs</a>[k].<a class="code" href="structenum__naptr__rr.html#af361f106e0a09ecd7f57c18d63ab969a">sort_pos</a> == context-&gt;<a class="code" href="structenum__context.html#a401e942526aac47cef94f478182486e7">position</a> - 1) {
<a name="l00891"></a>00891             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(context-&gt;<a class="code" href="structenum__context.html#a4f15ee8aa627692edfd6bdfe9a45fbf9">dst</a>, context-&gt;<a class="code" href="structenum__context.html#accaf620f3e890f0fbf1c86a605f65472">naptr_rrs</a>[k].<a class="code" href="structenum__naptr__rr.html#a179b70ad0fead86555368dc8edf9469e">result</a>, dstlen);
<a name="l00892"></a>00892             <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(context-&gt;<a class="code" href="structenum__context.html#aeca41cda3ae501467b8637dbb685443b">tech</a>, context-&gt;<a class="code" href="structenum__context.html#accaf620f3e890f0fbf1c86a605f65472">naptr_rrs</a>[k].<a class="code" href="structenum__naptr__rr.html#aeca41cda3ae501467b8637dbb685443b">tech</a>, techlen);
<a name="l00893"></a>00893             <span class="keywordflow">break</span>;
<a name="l00894"></a>00894          }
<a name="l00895"></a>00895       }
<a name="l00896"></a>00896    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!(context-&gt;<a class="code" href="structenum__context.html#a849fa981f121eb25a67e4e14392840ba">options</a> &amp; <a class="code" href="enum_8c.html#a80568ff5362beeb0051699a8deaf1f1e">ENUMLOOKUP_OPTIONS_COUNT</a>)) {
<a name="l00897"></a>00897       context-&gt;<a class="code" href="structenum__context.html#a4f15ee8aa627692edfd6bdfe9a45fbf9">dst</a>[0] = 0;
<a name="l00898"></a>00898    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((context-&gt;<a class="code" href="structenum__context.html#a849fa981f121eb25a67e4e14392840ba">options</a> &amp; <a class="code" href="enum_8c.html#a80568ff5362beeb0051699a8deaf1f1e">ENUMLOOKUP_OPTIONS_COUNT</a>)) {
<a name="l00899"></a>00899       snprintf(context-&gt;<a class="code" href="structenum__context.html#a4f15ee8aa627692edfd6bdfe9a45fbf9">dst</a>,context-&gt;<a class="code" href="structenum__context.html#a09933d827be564d0a0afebe6ffa00773">dstlen</a>,<span class="stringliteral">&quot;%d&quot;</span>,context-&gt;<a class="code" href="structenum__context.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a>);
<a name="l00900"></a>00900    }
<a name="l00901"></a>00901 
<a name="l00902"></a>00902    <span class="keywordflow">if</span> (chan)
<a name="l00903"></a>00903       ret |= <a class="code" href="channel_8h.html#a08bde7d8cf72457fc8c519a4443b413b" title="Stop servicing a channel for us...">ast_autoservice_stop</a>(chan);
<a name="l00904"></a>00904 
<a name="l00905"></a>00905    <span class="keywordflow">if</span> (!argcontext) {
<a name="l00906"></a>00906       <span class="keywordflow">for</span> (k = 0; k &lt; context-&gt;<a class="code" href="structenum__context.html#aa0068b75c25dfc2c01a7c2471978e0c4">naptr_rrs_count</a>; k++) {
<a name="l00907"></a>00907          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(context-&gt;<a class="code" href="structenum__context.html#accaf620f3e890f0fbf1c86a605f65472">naptr_rrs</a>[k].<a class="code" href="structenum__naptr__rr.html#a179b70ad0fead86555368dc8edf9469e">result</a>);
<a name="l00908"></a>00908          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(context-&gt;<a class="code" href="structenum__context.html#accaf620f3e890f0fbf1c86a605f65472">naptr_rrs</a>[k].<a class="code" href="structenum__naptr__rr.html#aeca41cda3ae501467b8637dbb685443b">tech</a>);
<a name="l00909"></a>00909       }
<a name="l00910"></a>00910       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(context-&gt;<a class="code" href="structenum__context.html#accaf620f3e890f0fbf1c86a605f65472">naptr_rrs</a>);
<a name="l00911"></a>00911       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(context);
<a name="l00912"></a>00912    } <span class="keywordflow">else</span>
<a name="l00913"></a>00913       *argcontext = context;
<a name="l00914"></a>00914 
<a name="l00915"></a>00915    <span class="keywordflow">return</span> ret;
<a name="l00916"></a>00916 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2320a6addc8ea6dbc676f16ded1d325d"></a><!-- doxytag: member="enum.h::ast_get_txt" ref="a2320a6addc8ea6dbc676f16ded1d325d" args="(struct ast_channel *chan, const char *number, char *txt, int maxtxt, char *suffix)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_get_txt </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>number</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>txt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>maxtxt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>suffix</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Lookup DNS TXT record (used by app TXTCIDnum). </p>
<p>Really has nothing to do with enum, but anyway... Actually, there is now an internet-draft which describes how callerID should be stored in ENUM domains: draft-ietf-enum-cnam-04.txt The algorithm implemented here will thus be obsolete soon.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel </td></tr>
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structnumber.html" title="Number structure.">number</a></em>&nbsp;</td><td>E164 <a class="el" href="structnumber.html" title="Number structure.">number</a> with or without the leading + </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>txt</em>&nbsp;</td><td>Text string (return value) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>maxtxt</em>&nbsp;</td><td>Max length of "txt" </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>suffix</em>&nbsp;</td><td>Zone suffix </td></tr>
  </table>
  </dd>
</dl>
<dl class="version"><dt><b>Version:</b></dt><dd>1.6.1 new suffix parameter to take into account caller ids that aren't in e164.arpa </dd>
<dd>
1.6.1 removed parameters location, maxloc, technology, maxtech as all the information is stored the txt string </dd></dl>

<p>Definition at line <a class="el" href="enum_8c_source.html#l00918">918</a> of file <a class="el" href="enum_8c_source.html">enum.c</a>.</p>

<p>References <a class="el" href="autoservice_8c_source.html#l00192">ast_autoservice_start()</a>, <a class="el" href="autoservice_8c_source.html#l00251">ast_autoservice_stop()</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, and <a class="el" href="enum_8c_source.html#l00136">txt_context::txt</a>.</p>

<p>Referenced by <a class="el" href="func__enum_8c_source.html#l00414">function_txtcidname()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00919"></a>00919 {
<a name="l00920"></a>00920    <span class="keyword">struct </span><a class="code" href="structtxt__context.html">txt_context</a> <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>;
<a name="l00921"></a>00921    <span class="keywordtype">char</span> tmp[259 + 512];
<a name="l00922"></a>00922    <span class="keywordtype">int</span> pos = strlen(<a class="code" href="structnumber.html" title="Number structure.">number</a>) - 1;
<a name="l00923"></a>00923    <span class="keywordtype">int</span> newpos = 0;
<a name="l00924"></a>00924    <span class="keywordtype">int</span> ret = -1;
<a name="l00925"></a>00925 
<a name="l00926"></a>00926    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(4, <span class="stringliteral">&quot;ast_get_txt: Number = &apos;%s&apos;, suffix = &apos;%s&apos;\n&quot;</span>, <a class="code" href="structnumber.html" title="Number structure.">number</a>, suffix);
<a name="l00927"></a>00927 
<a name="l00928"></a>00928    <span class="keywordflow">if</span> (chan &amp;&amp; <a class="code" href="channel_8h.html#a7a8f6a50f3db42cb40cad7cfbd1d54f9" title="Automatically service a channel for us...">ast_autoservice_start</a>(chan) &lt; 0) {
<a name="l00929"></a>00929       <span class="keywordflow">return</span> -1;
<a name="l00930"></a>00930    }
<a name="l00931"></a>00931  
<a name="l00932"></a>00932    <span class="keywordflow">if</span> (pos &gt; 128) {
<a name="l00933"></a>00933       pos = 128;
<a name="l00934"></a>00934    }
<a name="l00935"></a>00935 
<a name="l00936"></a>00936    <span class="keywordflow">while</span> (pos &gt;= 0) {
<a name="l00937"></a>00937       <span class="keywordflow">if</span> (isdigit(<a class="code" href="structnumber.html" title="Number structure.">number</a>[pos])) {
<a name="l00938"></a>00938          tmp[newpos++] = <a class="code" href="structnumber.html" title="Number structure.">number</a>[pos];
<a name="l00939"></a>00939          tmp[newpos++] = <span class="charliteral">&apos;.&apos;</span>;
<a name="l00940"></a>00940       }
<a name="l00941"></a>00941       pos--;
<a name="l00942"></a>00942    }
<a name="l00943"></a>00943 
<a name="l00944"></a>00944    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(&amp;tmp[newpos], suffix, <span class="keyword">sizeof</span>(tmp) - newpos);
<a name="l00945"></a>00945 
<a name="l00946"></a>00946    <span class="keywordflow">if</span> (ret &lt; 0) {
<a name="l00947"></a>00947       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;No such number found in ENUM: %s (%s)\n&quot;</span>, tmp, strerror(errno));
<a name="l00948"></a>00948       ret = 0;
<a name="l00949"></a>00949    } <span class="keywordflow">else</span> {
<a name="l00950"></a>00950       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="structtxt__context.html#acb36e435643b51ae1771f87bb67234f6">txt</a>, <a class="code" href="chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>.txt, <a class="code" href="structtxt__context.html#a44c4a1bb01729a965d38e3e59d601f93">txtlen</a>);
<a name="l00951"></a>00951    }
<a name="l00952"></a>00952    <span class="keywordflow">if</span> (chan) {
<a name="l00953"></a>00953       ret |= <a class="code" href="channel_8h.html#a08bde7d8cf72457fc8c519a4443b413b" title="Stop servicing a channel for us...">ast_autoservice_stop</a>(chan);
<a name="l00954"></a>00954    }
<a name="l00955"></a>00955    <span class="keywordflow">return</span> ret;
<a name="l00956"></a>00956 }
</pre></div></p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:22:01 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
