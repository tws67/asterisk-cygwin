<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:22:11 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_1ab815038f534adda65c8b4ae4993449.html">include</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_16d825f1fa9ecca2e70b1a8d9256d0e6.html">asterisk</a>
  </div>
</div>
<div class="contents">
<h1>http.h File Reference</h1>
<p>Support for Private Asterisk HTTP Servers.  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="config_8h_source.html">asterisk/config.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="tcptls_8h_source.html">asterisk/tcptls.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="linkedlists_8h_source.html">asterisk/linkedlists.h</a>&quot;</code><br/>

<p><a href="http_8h_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__http__uri.html">ast_http_uri</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Definition of a URI handler.  <a href="structast__http__uri.html#_details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structast__str.html">ast_str</a> *(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="http_8h.html#a22bab850a15df613383bff79b1307d6a">ast_http_callback</a> )(struct <a class="el" href="structast__tcptls__session__instance.html">ast_tcptls_session_instance</a> *ser, const struct <a class="el" href="structast__http__uri.html">ast_http_uri</a> *urih, const char *uri, enum <a class="el" href="http_8h.html#a16fb43ed7e6093a9dc96477ba37b80ef">ast_http_method</a> method, struct <a class="el" href="structast__variable.html">ast_variable</a> *params, struct <a class="el" href="structast__variable.html">ast_variable</a> *headers, int *<a class="el" href="app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a>, char **title, int *contentlength)</td></tr>
<tr><td colspan="2"><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="http_8h.html#a16fb43ed7e6093a9dc96477ba37b80ef">ast_http_method</a> { <a class="el" href="http_8h.html#a16fb43ed7e6093a9dc96477ba37b80efa74b1cb5c2ecb5e0bd9af5d46a7b78fd2">AST_HTTP_GET</a> =  0, 
<a class="el" href="http_8h.html#a16fb43ed7e6093a9dc96477ba37b80efa544b9492daf28b47937772ca54e31c80">AST_HTTP_POST</a>
 }</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p>HTTP Callbacks take the socket. </p>
 <a href="http_8h.html#a16fb43ed7e6093a9dc96477ba37b80ef">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__str.html">ast_str</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="http_8h.html#a934683361438de9f78b6c88a6a106b46">ast_http_error</a> (int <a class="el" href="app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a>, const char *title, const char *extra_header, const char *<a class="el" href="app__queue_8c.html#a5633b1433389cec21ade3811bbe9ca5b">text</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return an <a class="el" href="structast__str.html" title="The descriptor of a dynamic string XXX storage will be optimized later if needed...">ast_str</a> <a class="el" href="astmm_8h.html#ab8b25cd8f16d4a6552afe4e65c4f082d">malloc()</a>'d string containing an HTTP error <a class="el" href="structmessage.html">message</a>.  <a href="#a934683361438de9f78b6c88a6a106b46"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="http_8h.html#a0059c10f2538cfa09f9979d5fefd5638">ast_http_prefix</a> (char *<a class="el" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, int len)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return the current prefix.  <a href="#a0059c10f2538cfa09f9979d5fefd5638"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="http_8h.html#ac99d56925cf94f8cf3ed0acac52e2d75">ast_http_uri_link</a> (struct <a class="el" href="structast__http__uri.html">ast_http_uri</a> *urihandler)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Register a URI handler.  <a href="#ac99d56925cf94f8cf3ed0acac52e2d75"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="http_8h.html#a33e436ed8aeb33287f1e6cb1c5288a14">ast_http_uri_unlink</a> (struct <a class="el" href="structast__http__uri.html">ast_http_uri</a> *urihandler)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Unregister a URI handler.  <a href="#a33e436ed8aeb33287f1e6cb1c5288a14"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="http_8h.html#ae05bfd31702ddfd156bd1312ccbf2441">ast_http_uri_unlink_all_with_key</a> (const char *key)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Unregister all handlers with matching key.  <a href="#ae05bfd31702ddfd156bd1312ccbf2441"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Support for Private Asterisk HTTP Servers. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>Note: The Asterisk HTTP servers are extremely simple and minimal and only support the "GET" method.</dd></dl>
<dl class="author"><dt><b>Author:</b></dt><dd>Mark Spencer &lt;<a href="mailto:markster@digium.com">markster@digium.com</a>&gt;</dd></dl>
<dl class="note"><dt><b>Note:</b></dt><dd>In order to have TLS/SSL support, we need the openssl libraries. Still we can decide whether or not to use them by commenting in or out the DO_SSL macro. TLS/SSL support is basically implemented by reading from a config file (currently http.conf) the names of the certificate and cipher to use, and then run ssl_setup() to create an appropriate SSL_CTX (ssl_ctx) If we support multiple domains, presumably we need to read multiple certificates. When we are requested to open a TLS socket, we run make_file_from_fd() on the socket, to do the necessary setup. At the moment the context's name is hardwired in the function, but we can certainly make it into an extra parameter to the function. We declare most of ssl support variables unconditionally, because their <a class="el" href="structnumber.html" title="Number structure.">number</a> is small and this simplifies the code.</dd>
<dd>
: the ssl-support variables (ssl_ctx, do_ssl, certfile, cipher) and their setup should be moved to a more central place, e.g. asterisk.conf and the source files that processes it. Similarly, ssl_setup() should be run earlier in the startup process so modules have it available. </dd></dl>

<p>Definition in file <a class="el" href="http_8h_source.html">http.h</a>.</p>
<hr/><h2>Typedef Documentation</h2>
<a class="anchor" id="a22bab850a15df613383bff79b1307d6a"></a><!-- doxytag: member="http.h::ast_http_callback" ref="a22bab850a15df613383bff79b1307d6a" args=")(struct ast_tcptls_session_instance *ser, const struct ast_http_uri *urih, const char *uri, enum ast_http_method method, struct ast_variable *params, struct ast_variable *headers, int *status, char **title, int *contentlength)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structast__str.html">ast_str</a>*(* <a class="el" href="http_8h.html#a22bab850a15df613383bff79b1307d6a">ast_http_callback</a>)(struct <a class="el" href="structast__tcptls__session__instance.html">ast_tcptls_session_instance</a> *ser, const struct <a class="el" href="structast__http__uri.html">ast_http_uri</a> *urih, const char *uri, enum <a class="el" href="http_8h.html#a16fb43ed7e6093a9dc96477ba37b80ef">ast_http_method</a> method, struct <a class="el" href="structast__variable.html">ast_variable</a> *params, struct <a class="el" href="structast__variable.html">ast_variable</a> *headers, int *<a class="el" href="app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a>, char **title, int *contentlength)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="http_8h_source.html#l00075">75</a> of file <a class="el" href="http_8h_source.html">http.h</a>.</p>

</div>
</div>
<hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="a16fb43ed7e6093a9dc96477ba37b80ef"></a><!-- doxytag: member="http.h::ast_http_method" ref="a16fb43ed7e6093a9dc96477ba37b80ef" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="http_8h.html#a16fb43ed7e6093a9dc96477ba37b80ef">ast_http_method</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>HTTP Callbacks take the socket. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>The method and the path as arguments and should return the content, allocated with <a class="el" href="astmm_8h.html#ab8b25cd8f16d4a6552afe4e65c4f082d">malloc()</a>. Status should be changed to reflect the status of the request if it isn't 200 and title may be set to a <a class="el" href="astmm_8h.html#ab8b25cd8f16d4a6552afe4e65c4f082d">malloc()</a>'d string to an appropriate title for non-200 responses. Content length may also be specified. <div class="fragment"><pre class="fragment">
   The return value may include additional headers at the front and MUST include a blank
   line with \r\n to provide separation between user headers and content (even if no
   content is specified)
</pre></div> </dd></dl>
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a16fb43ed7e6093a9dc96477ba37b80efa74b1cb5c2ecb5e0bd9af5d46a7b78fd2"></a><!-- doxytag: member="AST_HTTP_GET" ref="a16fb43ed7e6093a9dc96477ba37b80efa74b1cb5c2ecb5e0bd9af5d46a7b78fd2" args="" -->AST_HTTP_GET</em>&nbsp;</td><td>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a16fb43ed7e6093a9dc96477ba37b80efa544b9492daf28b47937772ca54e31c80"></a><!-- doxytag: member="AST_HTTP_POST" ref="a16fb43ed7e6093a9dc96477ba37b80efa544b9492daf28b47937772ca54e31c80" args="" -->AST_HTTP_POST</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="http_8h_source.html#l00069">69</a> of file <a class="el" href="http_8h_source.html">http.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00069"></a>00069                      {
<a name="l00070"></a>00070    <a class="code" href="http_8h.html#a16fb43ed7e6093a9dc96477ba37b80efa74b1cb5c2ecb5e0bd9af5d46a7b78fd2">AST_HTTP_GET</a> = 0,
<a name="l00071"></a>00071    <a class="code" href="http_8h.html#a16fb43ed7e6093a9dc96477ba37b80efa544b9492daf28b47937772ca54e31c80">AST_HTTP_POST</a>,
<a name="l00072"></a>00072 };
</pre></div></p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a934683361438de9f78b6c88a6a106b46"></a><!-- doxytag: member="http.h::ast_http_error" ref="a934683361438de9f78b6c88a6a106b46" args="(int status, const char *title, const char *extra_header, const char *text)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__str.html">ast_str</a>* ast_http_error </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>status</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>title</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>extra_header</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>text</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Return an <a class="el" href="structast__str.html" title="The descriptor of a dynamic string XXX storage will be optimized later if needed...">ast_str</a> <a class="el" href="astmm_8h.html#ab8b25cd8f16d4a6552afe4e65c4f082d">malloc()</a>'d string containing an HTTP error <a class="el" href="structmessage.html">message</a>. </p>

<p>Definition at line <a class="el" href="http_8c_source.html#l00309">309</a> of file <a class="el" href="http_8c_source.html">http.c</a>.</p>

<p>References <a class="el" href="strings_8h_source.html#l00415">ast_str_create()</a>, and <a class="el" href="strings_8h_source.html#l00825">ast_str_set()</a>.</p>

<p>Referenced by <a class="el" href="manager_8c_source.html#l03804">generic_http_callback()</a>, <a class="el" href="http_8c_source.html#l00423">handle_uri()</a>, <a class="el" href="res__http__post_8c_source.html#l00296">http_post_callback()</a>, <a class="el" href="http_8c_source.html#l00659">httpd_helper_thread()</a>, <a class="el" href="res__phoneprov_8c_source.html#l00401">phoneprov_callback()</a>, and <a class="el" href="http_8c_source.html#l00154">static_callback()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00310"></a>00310 {
<a name="l00311"></a>00311    <span class="keyword">struct </span><a class="code" href="structast__str.html" title="The descriptor of a dynamic string XXX storage will be optimized later if needed...">ast_str</a> *out = <a class="code" href="strings_8h.html#a8ec37e4acb6ecb20eb6f6edd1141cd76" title="Create a malloc&amp;#39;ed dynamic length string.">ast_str_create</a>(512);
<a name="l00312"></a>00312 
<a name="l00313"></a>00313    <span class="keywordflow">if</span> (out == NULL) {
<a name="l00314"></a>00314       <span class="keywordflow">return</span> out;
<a name="l00315"></a>00315    }
<a name="l00316"></a>00316 
<a name="l00317"></a>00317    <a class="code" href="strings_8h.html#a4a3222f04f84c80a1d70f51e2dff00ea" title="Set a dynamic string using variable arguments.">ast_str_set</a>(&amp;out, 0,
<a name="l00318"></a>00318           <span class="stringliteral">&quot;Content-type: text/html\r\n&quot;</span>
<a name="l00319"></a>00319           <span class="stringliteral">&quot;%s&quot;</span>
<a name="l00320"></a>00320           <span class="stringliteral">&quot;\r\n&quot;</span>
<a name="l00321"></a>00321           <span class="stringliteral">&quot;&lt;!DOCTYPE HTML PUBLIC \&quot;-//IETF//DTD HTML 2.0//EN\&quot;&gt;\r\n&quot;</span>
<a name="l00322"></a>00322           <span class="stringliteral">&quot;&lt;html&gt;&lt;head&gt;\r\n&quot;</span>
<a name="l00323"></a>00323           <span class="stringliteral">&quot;&lt;title&gt;%d %s&lt;/title&gt;\r\n&quot;</span>
<a name="l00324"></a>00324           <span class="stringliteral">&quot;&lt;/head&gt;&lt;body&gt;\r\n&quot;</span>
<a name="l00325"></a>00325           <span class="stringliteral">&quot;&lt;h1&gt;%s&lt;/h1&gt;\r\n&quot;</span>
<a name="l00326"></a>00326           <span class="stringliteral">&quot;&lt;p&gt;%s&lt;/p&gt;\r\n&quot;</span>
<a name="l00327"></a>00327           <span class="stringliteral">&quot;&lt;hr /&gt;\r\n&quot;</span>
<a name="l00328"></a>00328           <span class="stringliteral">&quot;&lt;address&gt;Asterisk Server&lt;/address&gt;\r\n&quot;</span>
<a name="l00329"></a>00329           <span class="stringliteral">&quot;&lt;/body&gt;&lt;/html&gt;\r\n&quot;</span>,
<a name="l00330"></a>00330           (extra_header ? extra_header : <span class="stringliteral">&quot;&quot;</span>), <a class="code" href="app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a>, title, title, <a class="code" href="app__queue_8c.html#a5633b1433389cec21ade3811bbe9ca5b">text</a>);
<a name="l00331"></a>00331 
<a name="l00332"></a>00332    <span class="keywordflow">return</span> out;
<a name="l00333"></a>00333 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0059c10f2538cfa09f9979d5fefd5638"></a><!-- doxytag: member="http.h::ast_http_prefix" ref="a0059c10f2538cfa09f9979d5fefd5638" args="(char *buf, int len)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_http_prefix </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>len</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Return the current prefix. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>buf[out]</em>&nbsp;</td><td>destination buffer for previous </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>len[in]</em>&nbsp;</td><td>length of prefix to copy </td></tr>
  </table>
  </dd>
</dl>
<dl class="since"><dt><b>Since:</b></dt><dd>1.6.1 </dd></dl>

<p>Definition at line <a class="el" href="http_8c_source.html#l00147">147</a> of file <a class="el" href="http_8c_source.html">http.c</a>.</p>

<p>References <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00148"></a>00148 {
<a name="l00149"></a>00149    <span class="keywordflow">if</span> (<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>) {
<a name="l00150"></a>00150       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, <a class="code" href="http_8c.html#a6f25bc812d09fedb86bf394c01061c56">prefix</a>, <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>);
<a name="l00151"></a>00151    }
<a name="l00152"></a>00152 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac99d56925cf94f8cf3ed0acac52e2d75"></a><!-- doxytag: member="http.h::ast_http_uri_link" ref="ac99d56925cf94f8cf3ed0acac52e2d75" args="(struct ast_http_uri *urihandler)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_http_uri_link </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__http__uri.html">ast_http_uri</a> *&nbsp;</td>
          <td class="paramname"> <em>urih</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Register a URI handler. </p>
<p>Register a URI handler.</p>
<p>They are sorted by length of the string, not alphabetically. Duplicate entries are not replaced, but the insertion order (using &lt;= and not just &lt;) makes sure that more recent insertions hide older ones. On a lookup, we just scan the list and stop at the first matching entry. </p>

<p>Definition at line <a class="el" href="http_8c_source.html#l00344">344</a> of file <a class="el" href="http_8c_source.html">http.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="linkedlists_8h_source.html#l00451">AST_RWLIST_EMPTY</a>, <a class="el" href="linkedlists_8h_source.html#l00422">AST_RWLIST_FIRST</a>, <a class="el" href="linkedlists_8h_source.html#l00686">AST_RWLIST_INSERT_AFTER</a>, <a class="el" href="linkedlists_8h_source.html#l00702">AST_RWLIST_INSERT_HEAD</a>, <a class="el" href="linkedlists_8h_source.html#l00725">AST_RWLIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h_source.html#l00440">AST_RWLIST_NEXT</a>, <a class="el" href="linkedlists_8h_source.html#l00493">AST_RWLIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, <a class="el" href="http_8h_source.html#l00080">ast_http_uri::description</a>, <a class="el" href="structhttp__uri__redirect.html#a09c38895cda29616adf65bdaeb13a36a">http_uri_redirect::entry</a>, <a class="el" href="func__strings_8c_source.html#l00821">len()</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="http_8h_source.html#l00087">ast_http_uri::supports_get</a>, <a class="el" href="http_8h_source.html#l00089">ast_http_uri::supports_post</a>, and <a class="el" href="http_8h_source.html#l00081">ast_http_uri::uri</a>.</p>

<p>Referenced by <a class="el" href="res__http__post_8c_source.html#l00408">__ast_http_post_load()</a>, <a class="el" href="manager_8c_source.html#l04061">__init_manager()</a>, <a class="el" href="http_8c_source.html#l01023">ast_http_init()</a>, and <a class="el" href="res__phoneprov_8c_source.html#l01250">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00345"></a>00345 {
<a name="l00346"></a>00346    <span class="keyword">struct </span><a class="code" href="structast__http__uri.html" title="Definition of a URI handler.">ast_http_uri</a> *<a class="code" href="structast__http__uri.html#a69ec24fb2d0a5f5e532deb9adaab81d6">uri</a>;
<a name="l00347"></a>00347    <span class="keywordtype">int</span> <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> = strlen(urih-&gt;<a class="code" href="structast__http__uri.html#a69ec24fb2d0a5f5e532deb9adaab81d6">uri</a>);
<a name="l00348"></a>00348 
<a name="l00349"></a>00349    <span class="keywordflow">if</span> (!(urih-&gt;<a class="code" href="structast__http__uri.html#aefc8e8b7c3d28c7cf42196597cb4c281">supports_get</a> || urih-&gt;<a class="code" href="structast__http__uri.html#a79428a579d69a59c104cf74df85577dd">supports_post</a>)) {
<a name="l00350"></a>00350       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;URI handler does not provide either GET or POST method: %s (%s)\n&quot;</span>, urih-&gt;<a class="code" href="structast__http__uri.html#a69ec24fb2d0a5f5e532deb9adaab81d6">uri</a>, urih-&gt;<a class="code" href="structast__http__uri.html#a68344fa88cf4e86b5079fd69a5c22d57">description</a>);
<a name="l00351"></a>00351       <span class="keywordflow">return</span> -1;
<a name="l00352"></a>00352    }
<a name="l00353"></a>00353 
<a name="l00354"></a>00354    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structuris.html">uris</a>);
<a name="l00355"></a>00355 
<a name="l00356"></a>00356    <span class="keywordflow">if</span> (<a class="code" href="linkedlists_8h.html#a0044f6572f50a89049b3b5272e51b0e7">AST_RWLIST_EMPTY</a>(&amp;<a class="code" href="structuris.html">uris</a>) || strlen(<a class="code" href="linkedlists_8h.html#a64835fe6d570951b2a0404799c3d116f">AST_RWLIST_FIRST</a>(&amp;<a class="code" href="structuris.html">uris</a>)-&gt;uri) &lt;= len) {
<a name="l00357"></a>00357       <a class="code" href="linkedlists_8h.html#aacc5f6b7c25e361d11d40137fd55a8e8">AST_RWLIST_INSERT_HEAD</a>(&amp;<a class="code" href="structuris.html">uris</a>, urih, entry);
<a name="l00358"></a>00358       <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structuris.html">uris</a>);
<a name="l00359"></a>00359 
<a name="l00360"></a>00360       <span class="keywordflow">return</span> 0;
<a name="l00361"></a>00361    }
<a name="l00362"></a>00362 
<a name="l00363"></a>00363    <a class="code" href="linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;<a class="code" href="structuris.html">uris</a>, uri, entry) {
<a name="l00364"></a>00364       <span class="keywordflow">if</span> (<a class="code" href="linkedlists_8h.html#a5c021d1e034a53d09360da4d95c76220">AST_RWLIST_NEXT</a>(uri, entry) &amp;&amp;
<a name="l00365"></a>00365           strlen(<a class="code" href="linkedlists_8h.html#a5c021d1e034a53d09360da4d95c76220">AST_RWLIST_NEXT</a>(uri, entry)-&gt;uri) &lt;= len) {
<a name="l00366"></a>00366          <a class="code" href="linkedlists_8h.html#a5937d72e8b39660a1b824af2042c0e9c">AST_RWLIST_INSERT_AFTER</a>(&amp;<a class="code" href="structuris.html">uris</a>, uri, urih, entry);
<a name="l00367"></a>00367          <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structuris.html">uris</a>); 
<a name="l00368"></a>00368 
<a name="l00369"></a>00369          <span class="keywordflow">return</span> 0;
<a name="l00370"></a>00370       }
<a name="l00371"></a>00371    }
<a name="l00372"></a>00372 
<a name="l00373"></a>00373    <a class="code" href="linkedlists_8h.html#aadda916488b2d151af4426e2f06ad332">AST_RWLIST_INSERT_TAIL</a>(&amp;<a class="code" href="structuris.html">uris</a>, urih, entry);
<a name="l00374"></a>00374 
<a name="l00375"></a>00375    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structuris.html">uris</a>);
<a name="l00376"></a>00376    
<a name="l00377"></a>00377    <span class="keywordflow">return</span> 0;
<a name="l00378"></a>00378 }  
</pre></div></p>

</div>
</div>
<a class="anchor" id="a33e436ed8aeb33287f1e6cb1c5288a14"></a><!-- doxytag: member="http.h::ast_http_uri_unlink" ref="a33e436ed8aeb33287f1e6cb1c5288a14" args="(struct ast_http_uri *urihandler)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_http_uri_unlink </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__http__uri.html">ast_http_uri</a> *&nbsp;</td>
          <td class="paramname"> <em>urihandler</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Unregister a URI handler. </p>

<p>Definition at line <a class="el" href="http_8c_source.html#l00380">380</a> of file <a class="el" href="http_8c_source.html">http.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00860">AST_RWLIST_REMOVE</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, and <a class="el" href="structhttp__uri__redirect.html#a09c38895cda29616adf65bdaeb13a36a">http_uri_redirect::entry</a>.</p>

<p>Referenced by <a class="el" href="manager_8c_source.html#l04061">__init_manager()</a>, and <a class="el" href="res__phoneprov_8c_source.html#l01271">unload_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00381"></a>00381 {
<a name="l00382"></a>00382    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structuris.html">uris</a>);
<a name="l00383"></a>00383    <a class="code" href="linkedlists_8h.html#a6091f0518f8b6f443fd9f5150f3ac407">AST_RWLIST_REMOVE</a>(&amp;<a class="code" href="structuris.html">uris</a>, urih, entry);
<a name="l00384"></a>00384    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structuris.html">uris</a>);
<a name="l00385"></a>00385 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae05bfd31702ddfd156bd1312ccbf2441"></a><!-- doxytag: member="http.h::ast_http_uri_unlink_all_with_key" ref="ae05bfd31702ddfd156bd1312ccbf2441" args="(const char *key)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_http_uri_unlink_all_with_key </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>key</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Unregister all handlers with matching key. </p>

<p>Definition at line <a class="el" href="http_8c_source.html#l00387">387</a> of file <a class="el" href="http_8c_source.html">http.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="linkedlists_8h_source.html#l00564">AST_RWLIST_REMOVE_CURRENT</a>, <a class="el" href="linkedlists_8h_source.html#l00541">AST_RWLIST_TRAVERSE_SAFE_BEGIN</a>, <a class="el" href="linkedlists_8h_source.html#l00601">AST_RWLIST_TRAVERSE_SAFE_END</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, <a class="el" href="http_8h_source.html#l00095">ast_http_uri::data</a>, <a class="el" href="http_8h_source.html#l00093">ast_http_uri::dmallocd</a>, <a class="el" href="structhttp__uri__redirect.html#a09c38895cda29616adf65bdaeb13a36a">http_uri_redirect::entry</a>, <a class="el" href="http_8h_source.html#l00097">ast_http_uri::key</a>, and <a class="el" href="http_8h_source.html#l00091">ast_http_uri::mallocd</a>.</p>

<p>Referenced by <a class="el" href="res__http__post_8c_source.html#l00408">__ast_http_post_load()</a>, and <a class="el" href="res__http__post_8c_source.html#l00467">unload_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00388"></a>00388 {
<a name="l00389"></a>00389    <span class="keyword">struct </span><a class="code" href="structast__http__uri.html" title="Definition of a URI handler.">ast_http_uri</a> *urih;
<a name="l00390"></a>00390    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structuris.html">uris</a>);
<a name="l00391"></a>00391    <a class="code" href="linkedlists_8h.html#a21be6da4b2146b04b4868c2be5cae750">AST_RWLIST_TRAVERSE_SAFE_BEGIN</a>(&amp;<a class="code" href="structuris.html">uris</a>, urih, entry) {
<a name="l00392"></a>00392       <span class="keywordflow">if</span> (!strcmp(urih-&gt;<a class="code" href="structast__http__uri.html#acd3d88da3c0e0313c3645ff34f62f542">key</a>, <a class="code" href="structast__http__uri.html#acd3d88da3c0e0313c3645ff34f62f542">key</a>)) {
<a name="l00393"></a>00393          <a class="code" href="linkedlists_8h.html#a02212548652c9eb0f3db38dc4e4bd285">AST_RWLIST_REMOVE_CURRENT</a>(entry);
<a name="l00394"></a>00394       }
<a name="l00395"></a>00395       <span class="keywordflow">if</span> (urih-&gt;<a class="code" href="structast__http__uri.html#a55ab2ed9aeff792462e0efe00685b7d6">dmallocd</a>) {
<a name="l00396"></a>00396          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(urih-&gt;<a class="code" href="structast__http__uri.html#a735984d41155bc1032e09bece8f8d66d">data</a>);
<a name="l00397"></a>00397       }
<a name="l00398"></a>00398       <span class="keywordflow">if</span> (urih-&gt;<a class="code" href="structast__http__uri.html#ae6cd4621862105820006f1c6ba56e427">mallocd</a>) {
<a name="l00399"></a>00399          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(urih);
<a name="l00400"></a>00400       }
<a name="l00401"></a>00401    }
<a name="l00402"></a>00402    <a class="code" href="linkedlists_8h.html#a6bf0e81cb6ef01532ddebaba68f6de28">AST_RWLIST_TRAVERSE_SAFE_END</a>;
<a name="l00403"></a>00403    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structuris.html">uris</a>);
<a name="l00404"></a>00404 }
</pre></div></p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:22:11 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
