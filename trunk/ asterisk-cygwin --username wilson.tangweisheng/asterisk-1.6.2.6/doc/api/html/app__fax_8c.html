<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:18:55 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_7739c4bd2a7c382676c2c912043775c7.html">apps</a>
  </div>
</div>
<div class="contents">
<h1>app_fax.c File Reference</h1><code>#include &quot;<a class="el" href="asterisk_8h_source.html">asterisk.h</a>&quot;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;inttypes.h&gt;</code><br/>
<code>#include &lt;pthread.h&gt;</code><br/>
<code>#include &lt;errno.h&gt;</code><br/>
<code>#include &lt;tiffio.h&gt;</code><br/>
<code>#include &lt;spandsp.h&gt;</code><br/>
<code>#include &lt;spandsp/version.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="lock_8h_source.html">asterisk/lock.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="file_8h_source.html">asterisk/file.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="logger_8h_source.html">asterisk/logger.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="channel_8h_source.html">asterisk/channel.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="pbx_8h_source.html">asterisk/pbx.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="app_8h_source.html">asterisk/app.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="dsp_8h_source.html">asterisk/dsp.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="module_8h_source.html">asterisk/module.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="manager_8h_source.html">asterisk/manager.h</a>&quot;</code><br/>

<p><a href="app__fax_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structfax__session.html">fax_session</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__fax_8c.html#a78f316da3a87bf72cb1647786b64bf0e">MAX_SAMPLES</a>&nbsp;&nbsp;&nbsp;240</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__fax_8c.html#a23665e111b77b1011b401043c91924a5">WATCHDOG_STATE_TIMEOUT</a>&nbsp;&nbsp;&nbsp;5 * 60</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__fax_8c.html#a834406a117d19c84a165748126372951">WATCHDOG_TOTAL_TIMEOUT</a>&nbsp;&nbsp;&nbsp;30 * 60</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__fax_8c.html#af0fa9c056b217c77457a504107f2960a">AST_MODULE_INFO</a> (ASTERISK_GPL_KEY, AST_MODFLAG_DEFAULT,&quot;Simple FAX Application&quot;,.load=load_module,.unload=unload_module,)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__fax_8c.html#a513d7f55172717d523c0ce2216c61f67">fax_generator_alloc</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, void *params)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__fax_8c.html#ac366389377300e1304735eb8859a8cb9">fax_generator_generate</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, void *data, int len, int samples)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__fax_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__fax_8c.html#a464dc08d1104ca9c0766e7f91b8598f7">phase_e_handler</a> (t30_state_t *<a class="el" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>, void *user_data, int result)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__fax_8c.html#a0a54e3e8178f6cc3e3c9aed004c743ba">rcvfax_exec</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__fax_8c.html#abd857f1c1668126b9c5479cf2d28788a">set_ecm</a> (t30_state_t *<a class="el" href="structstate.html">state</a>, int ecm)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__fax_8c.html#a5ccd70da6546046e2a0a33455a95c20f">set_file</a> (t30_state_t *<a class="el" href="structstate.html">state</a>, <a class="el" href="structfax__session.html">fax_session</a> *s)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__fax_8c.html#a9bea7e90763229cdc0bc011f11127c5f">set_local_info</a> (t30_state_t *<a class="el" href="structstate.html">state</a>, <a class="el" href="structfax__session.html">fax_session</a> *s)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__fax_8c.html#a4dff8975f6c904def4e616ef9c74a8d6">set_logging</a> (logging_state_t *<a class="el" href="structstate.html">state</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__fax_8c.html#a6888bbf8afdf43d7845c50990b2bf8cc">sndfax_exec</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__fax_8c.html#a7bb64d8d15c9e9428b42b75b51e90a72">span_message</a> (int level, const char *<a class="el" href="adsistub_8c.html#a0dee90db1d6eb30329bee1ae6cec036a">msg</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__fax_8c.html#a9fe2f00c97edb54d6768e15febed1193">t38_tx_packet_handler</a> (t38_core_state_t *s, void *user_data, const uint8_t *<a class="el" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, int len, int count)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__fax_8c.html#af5dd15804f2fe408c6e13842a3a25164">transmit</a> (<a class="el" href="structfax__session.html">fax_session</a> *s)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__fax_8c.html#accd2f41bc9751826377ab0d4c57e3063">transmit_audio</a> (<a class="el" href="structfax__session.html">fax_session</a> *s)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__fax_8c.html#aacf93c995c842fb9c1c3a60c1211b4bf">transmit_t38</a> (<a class="el" href="structfax__session.html">fax_session</a> *s)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__fax_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a> (void)</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__fax_8c.html#a0f3a52db8cfd1cc6ebd327fa6e24c8fb">app_rcvfax_name</a> = &quot;ReceiveFAX&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__fax_8c.html#a50df277dcef2198ebac8c57ec43ea107">app_sndfax_name</a> = &quot;SendFAX&quot;</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__generator.html">ast_generator</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="app__fax_8c.html#a36aeb2eb01afb248bad64a309d743636">generator</a></td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a78f316da3a87bf72cb1647786b64bf0e"></a><!-- doxytag: member="app_fax.c::MAX_SAMPLES" ref="a78f316da3a87bf72cb1647786b64bf0e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_SAMPLES&nbsp;&nbsp;&nbsp;240</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__fax_8c_source.html#l00147">147</a> of file <a class="el" href="app__fax_8c_source.html">app_fax.c</a>.</p>

<p>Referenced by <a class="el" href="app__fax_8c_source.html#l00324">fax_generator_generate()</a>.</p>

</div>
</div>
<a class="anchor" id="a23665e111b77b1011b401043c91924a5"></a><!-- doxytag: member="app_fax.c::WATCHDOG_STATE_TIMEOUT" ref="a23665e111b77b1011b401043c91924a5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define WATCHDOG_STATE_TIMEOUT&nbsp;&nbsp;&nbsp;5 * 60</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__fax_8c_source.html#l00156">156</a> of file <a class="el" href="app__fax_8c_source.html">app_fax.c</a>.</p>

<p>Referenced by <a class="el" href="app__fax_8c_source.html#l00362">transmit_audio()</a>, and <a class="el" href="app__fax_8c_source.html#l00599">transmit_t38()</a>.</p>

</div>
</div>
<a class="anchor" id="a834406a117d19c84a165748126372951"></a><!-- doxytag: member="app_fax.c::WATCHDOG_TOTAL_TIMEOUT" ref="a834406a117d19c84a165748126372951" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define WATCHDOG_TOTAL_TIMEOUT&nbsp;&nbsp;&nbsp;30 * 60</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__fax_8c_source.html#l00155">155</a> of file <a class="el" href="app__fax_8c_source.html">app_fax.c</a>.</p>

<p>Referenced by <a class="el" href="app__fax_8c_source.html#l00362">transmit_audio()</a>, and <a class="el" href="app__fax_8c_source.html#l00599">transmit_t38()</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="af0fa9c056b217c77457a504107f2960a"></a><!-- doxytag: member="app_fax.c::AST_MODULE_INFO" ref="af0fa9c056b217c77457a504107f2960a" args="(ASTERISK_GPL_KEY, AST_MODFLAG_DEFAULT,&quot;Simple FAX Application&quot;,.load=load_module,.unload=unload_module,)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">AST_MODULE_INFO </td>
          <td>(</td>
          <td class="paramtype">ASTERISK_GPL_KEY&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">AST_MODFLAG_DEFAULT&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&quot;Simple FAX Application&quot;&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">.&nbsp;</td>
          <td class="paramname"> <em>load</em> = <code>load_module</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">.&nbsp;</td>
          <td class="paramname"> <em>unload</em> = <code>unload_module</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a513d7f55172717d523c0ce2216c61f67"></a><!-- doxytag: member="app_fax.c::fax_generator_alloc" ref="a513d7f55172717d523c0ce2216c61f67" args="(struct ast_channel *chan, void *params)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void* fax_generator_alloc </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>params</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__fax_8c_source.html#l00319">319</a> of file <a class="el" href="app__fax_8c_source.html">app_fax.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00320"></a>00320 {
<a name="l00321"></a>00321    <span class="keywordflow">return</span> params;
<a name="l00322"></a>00322 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac366389377300e1304735eb8859a8cb9"></a><!-- doxytag: member="app_fax.c::fax_generator_generate" ref="ac366389377300e1304735eb8859a8cb9" args="(struct ast_channel *chan, void *data, int len, int samples)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int fax_generator_generate </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>samples</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__fax_8c_source.html#l00324">324</a> of file <a class="el" href="app__fax_8c_source.html">app_fax.c</a>.</p>

<p>References <a class="el" href="frame_8h_source.html#l00253">AST_FORMAT_SLINEAR</a>, <a class="el" href="frame_8h_source.html#l00182">AST_FRAME_SET_BUFFER</a>, <a class="el" href="frame_8h_source.html#l00101">AST_FRAME_VOICE</a>, <a class="el" href="frame_8h_source.html#l00203">AST_FRIENDLY_OFFSET</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8c_source.html#l03411">ast_write()</a>, <a class="el" href="adsistub_8c_source.html#l00059">buf</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="app__fax_8c_source.html#l00147">MAX_SAMPLES</a>, and <a class="el" href="frame_8h_source.html#l00149">ast_frame::samples</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00325"></a>00325 {
<a name="l00326"></a>00326    fax_state_t *fax = (fax_state_t*) data;
<a name="l00327"></a>00327    uint8_t buffer[<a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a> + <a class="code" href="app__fax_8c.html#a78f316da3a87bf72cb1647786b64bf0e">MAX_SAMPLES</a> * <span class="keyword">sizeof</span>(uint16_t)];
<a name="l00328"></a>00328    int16_t *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a> = (int16_t *) (buffer + <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>);
<a name="l00329"></a>00329     
<a name="l00330"></a>00330    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> outf = {
<a name="l00331"></a>00331       .frametype = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>,
<a name="l00332"></a>00332       .subclass = <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>,
<a name="l00333"></a>00333       .src = __FUNCTION__,
<a name="l00334"></a>00334    };
<a name="l00335"></a>00335 
<a name="l00336"></a>00336    <span class="keywordflow">if</span> (<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a> &gt; <a class="code" href="app__fax_8c.html#a78f316da3a87bf72cb1647786b64bf0e">MAX_SAMPLES</a>) {
<a name="l00337"></a>00337       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Only generating %d samples, where %d requested\n&quot;</span>, <a class="code" href="app__fax_8c.html#a78f316da3a87bf72cb1647786b64bf0e">MAX_SAMPLES</a>, <a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>);
<a name="l00338"></a>00338       <a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a> = <a class="code" href="app__fax_8c.html#a78f316da3a87bf72cb1647786b64bf0e">MAX_SAMPLES</a>;
<a name="l00339"></a>00339    }
<a name="l00340"></a>00340    
<a name="l00341"></a>00341    <span class="keywordflow">if</span> ((<a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> = fax_tx(fax, buf, <a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>)) &gt; 0) {
<a name="l00342"></a>00342       outf.<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a> = <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>;
<a name="l00343"></a>00343       <a class="code" href="frame_8h.html#ac8bc210573f6b9c55ef38662bddc4675">AST_FRAME_SET_BUFFER</a>(&amp;outf, buffer, <a class="code" href="frame_8h.html#ac8f7380b8620c80443286b44481f641c" title="Offset into a frame&amp;#39;s data buffer.">AST_FRIENDLY_OFFSET</a>, <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> * <span class="keyword">sizeof</span>(int16_t));
<a name="l00344"></a>00344 
<a name="l00345"></a>00345       <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a79c413d51b7135404d5cacf811649a61" title="Write a frame to a channel This function writes the given frame to the indicated...">ast_write</a>(chan, &amp;outf) &lt; 0) {
<a name="l00346"></a>00346          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to write frame to &apos;%s&apos;: %s\n&quot;</span>, chan-&gt;name, strerror(errno));
<a name="l00347"></a>00347          <span class="keywordflow">return</span> -1;
<a name="l00348"></a>00348       }
<a name="l00349"></a>00349    }
<a name="l00350"></a>00350 
<a name="l00351"></a>00351    <span class="keywordflow">return</span> 0;
<a name="l00352"></a>00352 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac3382bf6da54c56b37069bd76bbdf4f9"></a><!-- doxytag: member="app_fax.c::load_module" ref="ac3382bf6da54c56b37069bd76bbdf4f9" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int load_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__fax_8c_source.html#l00928">928</a> of file <a class="el" href="app__fax_8c_source.html">app_fax.c</a>.</p>

<p>References <a class="el" href="module_8h_source.html#l00406">ast_register_application_xml</a>, <a class="el" href="app__fax_8c_source.html#l00874">rcvfax_exec()</a>, and <a class="el" href="app__fax_8c_source.html#l00830">sndfax_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00929"></a>00929 {
<a name="l00930"></a>00930    <span class="keywordtype">int</span> res ;
<a name="l00931"></a>00931 
<a name="l00932"></a>00932    res = <a class="code" href="module_8h.html#afba4eb7a910b10969041ae4cd488729d" title="Register an application using XML documentation.">ast_register_application_xml</a>(<a class="code" href="app__fax_8c.html#a50df277dcef2198ebac8c57ec43ea107">app_sndfax_name</a>, <a class="code" href="app__fax_8c.html#a6888bbf8afdf43d7845c50990b2bf8cc">sndfax_exec</a>);
<a name="l00933"></a>00933    res |= <a class="code" href="module_8h.html#afba4eb7a910b10969041ae4cd488729d" title="Register an application using XML documentation.">ast_register_application_xml</a>(<a class="code" href="app__fax_8c.html#a0f3a52db8cfd1cc6ebd327fa6e24c8fb">app_rcvfax_name</a>, <a class="code" href="app__fax_8c.html#a0a54e3e8178f6cc3e3c9aed004c743ba">rcvfax_exec</a>);
<a name="l00934"></a>00934 
<a name="l00935"></a>00935    <span class="comment">/* The default SPAN message handler prints to stderr. It is something we do not want */</span>
<a name="l00936"></a>00936    span_set_message_handler(NULL);
<a name="l00937"></a>00937 
<a name="l00938"></a>00938    <span class="keywordflow">return</span> res;
<a name="l00939"></a>00939 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a464dc08d1104ca9c0766e7f91b8598f7"></a><!-- doxytag: member="app_fax.c::phase_e_handler" ref="a464dc08d1104ca9c0766e7f91b8598f7" args="(t30_state_t *f, void *user_data, int result)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void phase_e_handler </td>
          <td>(</td>
          <td class="paramtype">t30_state_t *&nbsp;</td>
          <td class="paramname"> <em>f</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>user_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>result</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__fax_8c_source.html#l00202">202</a> of file <a class="el" href="app__fax_8c_source.html">app_fax.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="adsistub_8c_source.html#l00059">buf</a>, <a class="el" href="app__fax_8c_source.html#l00159">fax_session::chan</a>, <a class="el" href="channel_8h_source.html#l00444">ast_channel::cid</a>, <a class="el" href="channel_8h_source.html#l00203">ast_callerid::cid_num</a>, <a class="el" href="app__fax_8c_source.html#l00161">fax_session::direction</a>, <a class="el" href="manager_8h_source.html#l00062">EVENT_FLAG_CALL</a>, <a class="el" href="channel_8h_source.html#l00504">ast_channel::exten</a>, <a class="el" href="app__fax_8c_source.html#l00163">fax_session::file_name</a>, <a class="el" href="app__fax_8c_source.html#l00165">fax_session::finished</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="manager_8h_source.html#l00181">manager_event</a>, <a class="el" href="pbx_8c_source.html#l09023">pbx_builtin_setvar_helper()</a>, <a class="el" href="aesopt_8h_source.html#l00399">s</a>, and <a class="el" href="strings_8h_source.html#l00072">S_OR</a>.</p>

<p>Referenced by <a class="el" href="app__fax_8c_source.html#l00362">transmit_audio()</a>, and <a class="el" href="app__fax_8c_source.html#l00599">transmit_t38()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00203"></a>00203 {
<a name="l00204"></a>00204    <span class="keyword">const</span> <span class="keywordtype">char</span> *local_ident;
<a name="l00205"></a>00205    <span class="keyword">const</span> <span class="keywordtype">char</span> *far_ident;
<a name="l00206"></a>00206    <span class="keywordtype">char</span> <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[20];
<a name="l00207"></a>00207    <a class="code" href="structfax__session.html">fax_session</a> *<a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a> = (<a class="code" href="structfax__session.html">fax_session</a> *) user_data;
<a name="l00208"></a>00208    t30_stats_t stat;
<a name="l00209"></a>00209    <span class="keywordtype">int</span> pages_transferred;
<a name="l00210"></a>00210 
<a name="l00211"></a>00211    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Fax phase E handler. result=%d\n&quot;</span>, result);
<a name="l00212"></a>00212 
<a name="l00213"></a>00213    t30_get_transfer_statistics(<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>, &amp;stat);
<a name="l00214"></a>00214 
<a name="l00215"></a>00215    s = (<a class="code" href="structfax__session.html">fax_session</a> *) user_data;
<a name="l00216"></a>00216 
<a name="l00217"></a>00217    <span class="keywordflow">if</span> (result != T30_ERR_OK) {
<a name="l00218"></a>00218       s-&gt;<a class="code" href="structfax__session.html#a45429b02ca394145850c27b9184f40d8">finished</a> = -1;
<a name="l00219"></a>00219 
<a name="l00220"></a>00220       <span class="comment">/* FAXSTATUS is already set to FAILED */</span>
<a name="l00221"></a>00221       <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, <span class="stringliteral">&quot;FAXERROR&quot;</span>, t30_completion_code_to_str(result));
<a name="l00222"></a>00222 
<a name="l00223"></a>00223       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Error transmitting fax. result=%d: %s.\n&quot;</span>, result, t30_completion_code_to_str(result));
<a name="l00224"></a>00224 
<a name="l00225"></a>00225       <span class="keywordflow">return</span>;
<a name="l00226"></a>00226    }
<a name="l00227"></a>00227    
<a name="l00228"></a>00228    s-&gt;<a class="code" href="structfax__session.html#a45429b02ca394145850c27b9184f40d8">finished</a> = 1; 
<a name="l00229"></a>00229    
<a name="l00230"></a>00230    local_ident = t30_get_tx_ident(<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>);
<a name="l00231"></a>00231    far_ident = t30_get_rx_ident(<a class="code" href="format__g726_8c.html#a6add0b75a88c25db4ccbf690acda6d7f">f</a>);
<a name="l00232"></a>00232    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, <span class="stringliteral">&quot;FAXSTATUS&quot;</span>, <span class="stringliteral">&quot;SUCCESS&quot;</span>); 
<a name="l00233"></a>00233    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, <span class="stringliteral">&quot;FAXERROR&quot;</span>, NULL); 
<a name="l00234"></a>00234    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, <span class="stringliteral">&quot;REMOTESTATIONID&quot;</span>, far_ident);
<a name="l00235"></a>00235 <span class="preprocessor">#if SPANDSP_RELEASE_DATE &gt;= 20090220</span>
<a name="l00236"></a>00236 <span class="preprocessor"></span>   pages_transferred = (s-&gt;<a class="code" href="structfax__session.html#a886d551d5381dc3e53f17825ffc51641">direction</a>) ? stat.pages_tx : stat.pages_rx;
<a name="l00237"></a>00237 #<span class="keywordflow">else</span>
<a name="l00238"></a>00238    pages_transferred = stat.pages_transferred;
<a name="l00239"></a>00239 #endif
<a name="l00240"></a>00240    snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;%d&quot;</span>, pages_transferred);
<a name="l00241"></a>00241    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, <span class="stringliteral">&quot;FAXPAGES&quot;</span>, buf);
<a name="l00242"></a>00242    snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;%d&quot;</span>, stat.y_resolution);
<a name="l00243"></a>00243    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, <span class="stringliteral">&quot;FAXRESOLUTION&quot;</span>, buf);
<a name="l00244"></a>00244    snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;%d&quot;</span>, stat.bit_rate);
<a name="l00245"></a>00245    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, <span class="stringliteral">&quot;FAXBITRATE&quot;</span>, buf); 
<a name="l00246"></a>00246    
<a name="l00247"></a>00247    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Fax transmitted successfully.\n&quot;</span>);
<a name="l00248"></a>00248    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;  Remote station ID: %s\n&quot;</span>, far_ident);
<a name="l00249"></a>00249    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;  Pages transferred: %d\n&quot;</span>, pages_transferred);
<a name="l00250"></a>00250    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;  Image resolution:  %d x %d\n&quot;</span>, stat.x_resolution, stat.y_resolution);
<a name="l00251"></a>00251    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;  Transfer Rate:     %d\n&quot;</span>, stat.bit_rate);
<a name="l00252"></a>00252    
<a name="l00253"></a>00253    <a class="code" href="manager_8h.html#a1ef0ee0044dbbeb4c3a5abc6c046b208" title="External routines may send asterisk manager events this way.">manager_event</a>(<a class="code" href="manager_8h.html#ab5db3cc603d7e798d61cb4cd94fbb4e2">EVENT_FLAG_CALL</a>,
<a name="l00254"></a>00254             s-&gt;<a class="code" href="structfax__session.html#a886d551d5381dc3e53f17825ffc51641">direction</a> ? <span class="stringliteral">&quot;FaxSent&quot;</span> : <span class="stringliteral">&quot;FaxReceived&quot;</span>, 
<a name="l00255"></a>00255             <span class="stringliteral">&quot;Channel: %s\r\n&quot;</span>
<a name="l00256"></a>00256             <span class="stringliteral">&quot;Exten: %s\r\n&quot;</span>
<a name="l00257"></a>00257             <span class="stringliteral">&quot;CallerID: %s\r\n&quot;</span>
<a name="l00258"></a>00258             <span class="stringliteral">&quot;RemoteStationID: %s\r\n&quot;</span>
<a name="l00259"></a>00259             <span class="stringliteral">&quot;LocalStationID: %s\r\n&quot;</span>
<a name="l00260"></a>00260             <span class="stringliteral">&quot;PagesTransferred: %d\r\n&quot;</span>
<a name="l00261"></a>00261             <span class="stringliteral">&quot;Resolution: %d\r\n&quot;</span>
<a name="l00262"></a>00262             <span class="stringliteral">&quot;TransferRate: %d\r\n&quot;</span>
<a name="l00263"></a>00263             <span class="stringliteral">&quot;FileName: %s\r\n&quot;</span>,
<a name="l00264"></a>00264             s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;name,
<a name="l00265"></a>00265             s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>,
<a name="l00266"></a>00266             <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>, <span class="stringliteral">&quot;&quot;</span>),
<a name="l00267"></a>00267             far_ident,
<a name="l00268"></a>00268             local_ident,
<a name="l00269"></a>00269             pages_transferred,
<a name="l00270"></a>00270             stat.y_resolution,
<a name="l00271"></a>00271             stat.bit_rate,
<a name="l00272"></a>00272             s-&gt;<a class="code" href="structfax__session.html#a8505c513bc640d1f69e5f76fb32b24a8">file_name</a>);
<a name="l00273"></a>00273 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0a54e3e8178f6cc3e3c9aed004c743ba"></a><!-- doxytag: member="app_fax.c::rcvfax_exec" ref="a0a54e3e8178f6cc3e3c9aed004c743ba" args="(struct ast_channel *chan, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int rcvfax_exec </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__fax_8c_source.html#l00874">874</a> of file <a class="el" href="app__fax_8c_source.html">app_fax.c</a>.</p>

<p>References <a class="el" href="app_8h_source.html#l00338">AST_APP_ARG</a>, <a class="el" href="app_8h_source.html#l00355">AST_DECLARE_APP_ARGS</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="app_8h_source.html#l00387">AST_STANDARD_APP_ARGS</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="app__fax_8c_source.html#l00162">fax_session::caller_mode</a>, <a class="el" href="app__fax_8c_source.html#l00159">fax_session::chan</a>, <a class="el" href="app__fax_8c_source.html#l00161">fax_session::direction</a>, <a class="el" href="app__minivm_8c_source.html#l00409">FALSE</a>, <a class="el" href="app__fax_8c_source.html#l00163">fax_session::file_name</a>, <a class="el" href="app__fax_8c_source.html#l00165">fax_session::finished</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="chan__mgcp_8c_source.html#l01737">parse()</a>, <a class="el" href="app__fax_8c_source.html#l00772">transmit()</a>, and <a class="el" href="app__minivm_8c_source.html#l00406">TRUE</a>.</p>

<p>Referenced by <a class="el" href="app__fax_8c_source.html#l00928">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00875"></a>00875 {
<a name="l00876"></a>00876    <span class="keywordtype">int</span> res = 0;
<a name="l00877"></a>00877    <span class="keywordtype">char</span> *<a class="code" href="chan__mgcp_8c.html#a2e006acff60d9b3d65d7d60f975d6747">parse</a>;
<a name="l00878"></a>00878    <a class="code" href="structfax__session.html">fax_session</a> session;
<a name="l00879"></a>00879 
<a name="l00880"></a>00880    <a class="code" href="app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2" title="Declare a structure to hold an application&amp;#39;s arguments.">AST_DECLARE_APP_ARGS</a>(args,
<a name="l00881"></a>00881       <a class="code" href="app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5" title="Define an application argument.">AST_APP_ARG</a>(file_name);
<a name="l00882"></a>00882       <a class="code" href="app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5" title="Define an application argument.">AST_APP_ARG</a>(options);
<a name="l00883"></a>00883    );
<a name="l00884"></a>00884 
<a name="l00885"></a>00885    <span class="keywordflow">if</span> (chan == NULL) {
<a name="l00886"></a>00886       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Fax channel is NULL. Giving up.\n&quot;</span>);
<a name="l00887"></a>00887       <span class="keywordflow">return</span> -1;
<a name="l00888"></a>00888    }
<a name="l00889"></a>00889 
<a name="l00890"></a>00890    <span class="comment">/* The next few lines of code parse out the filename and header from the input string */</span>
<a name="l00891"></a>00891    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>)) {
<a name="l00892"></a>00892       <span class="comment">/* No data implies no filename or anything is present */</span>
<a name="l00893"></a>00893       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;ReceiveFAX requires an argument (filename)\n&quot;</span>);
<a name="l00894"></a>00894       <span class="keywordflow">return</span> -1;
<a name="l00895"></a>00895    }
<a name="l00896"></a>00896 
<a name="l00897"></a>00897    parse = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>);
<a name="l00898"></a>00898    <a class="code" href="app_8h.html#ac08f7eb1eb9476b30987c73e1052ada8" title="Performs the &amp;#39;standard&amp;#39; argument separation process for an application.">AST_STANDARD_APP_ARGS</a>(args, parse);
<a name="l00899"></a>00899    
<a name="l00900"></a>00900    session.<a class="code" href="structfax__session.html#a318db77de0681ea150cb6941bb9e524d">caller_mode</a> = <a class="code" href="app__minivm_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00901"></a>00901 
<a name="l00902"></a>00902    <span class="keywordflow">if</span> (args.options) {
<a name="l00903"></a>00903       <span class="keywordflow">if</span> (strchr(args.options, <span class="charliteral">&apos;c&apos;</span>))
<a name="l00904"></a>00904          session.<a class="code" href="structfax__session.html#a318db77de0681ea150cb6941bb9e524d">caller_mode</a> = <a class="code" href="app__minivm_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00905"></a>00905    }
<a name="l00906"></a>00906 
<a name="l00907"></a>00907    <span class="comment">/* Done parsing */</span>
<a name="l00908"></a>00908    session.<a class="code" href="structfax__session.html#a886d551d5381dc3e53f17825ffc51641">direction</a> = 0;
<a name="l00909"></a>00909    session.<a class="code" href="structfax__session.html#a8505c513bc640d1f69e5f76fb32b24a8">file_name</a> = args.file_name;
<a name="l00910"></a>00910    session.<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a> = chan;
<a name="l00911"></a>00911    session.<a class="code" href="structfax__session.html#a45429b02ca394145850c27b9184f40d8">finished</a> = 0;
<a name="l00912"></a>00912 
<a name="l00913"></a>00913    res = <a class="code" href="app__fax_8c.html#af5dd15804f2fe408c6e13842a3a25164">transmit</a>(&amp;session);
<a name="l00914"></a>00914 
<a name="l00915"></a>00915    <span class="keywordflow">return</span> res;
<a name="l00916"></a>00916 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="abd857f1c1668126b9c5479cf2d28788a"></a><!-- doxytag: member="app_fax.c::set_ecm" ref="abd857f1c1668126b9c5479cf2d28788a" args="(t30_state_t *state, int ecm)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void set_ecm </td>
          <td>(</td>
          <td class="paramtype">t30_state_t *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>ecm</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__fax_8c_source.html#l00309">309</a> of file <a class="el" href="app__fax_8c_source.html">app_fax.c</a>.</p>

<p>Referenced by <a class="el" href="app__fax_8c_source.html#l00362">transmit_audio()</a>, and <a class="el" href="app__fax_8c_source.html#l00599">transmit_t38()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00310"></a>00310 {
<a name="l00311"></a>00311    t30_set_ecm_capability(<a class="code" href="structstate.html">state</a>, ecm);
<a name="l00312"></a>00312    t30_set_supported_compressions(<a class="code" href="structstate.html">state</a>, T30_SUPPORT_T4_1D_COMPRESSION | T30_SUPPORT_T4_2D_COMPRESSION | T30_SUPPORT_T6_COMPRESSION);
<a name="l00313"></a>00313 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5ccd70da6546046e2a0a33455a95c20f"></a><!-- doxytag: member="app_fax.c::set_file" ref="a5ccd70da6546046e2a0a33455a95c20f" args="(t30_state_t *state, fax_session *s)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void set_file </td>
          <td>(</td>
          <td class="paramtype">t30_state_t *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfax__session.html">fax_session</a> *&nbsp;</td>
          <td class="paramname"> <em>s</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__fax_8c_source.html#l00301">301</a> of file <a class="el" href="app__fax_8c_source.html">app_fax.c</a>.</p>

<p>References <a class="el" href="app__fax_8c_source.html#l00161">fax_session::direction</a>, and <a class="el" href="app__fax_8c_source.html#l00163">fax_session::file_name</a>.</p>

<p>Referenced by <a class="el" href="app__fax_8c_source.html#l00362">transmit_audio()</a>, and <a class="el" href="app__fax_8c_source.html#l00599">transmit_t38()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00302"></a>00302 {
<a name="l00303"></a>00303    <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structfax__session.html#a886d551d5381dc3e53f17825ffc51641">direction</a>)
<a name="l00304"></a>00304       t30_set_tx_file(<a class="code" href="structstate.html">state</a>, s-&gt;<a class="code" href="structfax__session.html#a8505c513bc640d1f69e5f76fb32b24a8">file_name</a>, -1, -1);
<a name="l00305"></a>00305    <span class="keywordflow">else</span>
<a name="l00306"></a>00306       t30_set_rx_file(<a class="code" href="structstate.html">state</a>, s-&gt;<a class="code" href="structfax__session.html#a8505c513bc640d1f69e5f76fb32b24a8">file_name</a>, -1);
<a name="l00307"></a>00307 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9bea7e90763229cdc0bc011f11127c5f"></a><!-- doxytag: member="app_fax.c::set_local_info" ref="a9bea7e90763229cdc0bc011f11127c5f" args="(t30_state_t *state, fax_session *s)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void set_local_info </td>
          <td>(</td>
          <td class="paramtype">t30_state_t *&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structfax__session.html">fax_session</a> *&nbsp;</td>
          <td class="paramname"> <em>s</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__fax_8c_source.html#l00288">288</a> of file <a class="el" href="app__fax_8c_source.html">app_fax.c</a>.</p>

<p>References <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="app__fax_8c_source.html#l00159">fax_session::chan</a>, and <a class="el" href="pbx_8c_source.html#l08951">pbx_builtin_getvar_helper()</a>.</p>

<p>Referenced by <a class="el" href="app__fax_8c_source.html#l00362">transmit_audio()</a>, and <a class="el" href="app__fax_8c_source.html#l00599">transmit_t38()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00289"></a>00289 {
<a name="l00290"></a>00290    <span class="keyword">const</span> <span class="keywordtype">char</span> *x;
<a name="l00291"></a>00291 
<a name="l00292"></a>00292    x = <a class="code" href="pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b" title="Return a pointer to the value of the corresponding channel variable.">pbx_builtin_getvar_helper</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, <span class="stringliteral">&quot;LOCALSTATIONID&quot;</span>);
<a name="l00293"></a>00293    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(x))
<a name="l00294"></a>00294       t30_set_tx_ident(<a class="code" href="structstate.html">state</a>, x);
<a name="l00295"></a>00295 
<a name="l00296"></a>00296    x = <a class="code" href="pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b" title="Return a pointer to the value of the corresponding channel variable.">pbx_builtin_getvar_helper</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, <span class="stringliteral">&quot;LOCALHEADERINFO&quot;</span>);
<a name="l00297"></a>00297    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(x))
<a name="l00298"></a>00298       t30_set_tx_page_header_info(<a class="code" href="structstate.html">state</a>, x);
<a name="l00299"></a>00299 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4dff8975f6c904def4e616ef9c74a8d6"></a><!-- doxytag: member="app_fax.c::set_logging" ref="a4dff8975f6c904def4e616ef9c74a8d6" args="(logging_state_t *state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int set_logging </td>
          <td>(</td>
          <td class="paramtype">logging_state_t *&nbsp;</td>
          <td class="paramname"> <em>state</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__fax_8c_source.html#l00278">278</a> of file <a class="el" href="app__fax_8c_source.html">app_fax.c</a>.</p>

<p>References <a class="el" href="asterisk_8c_source.html#l00175">option_debug</a>, and <a class="el" href="app__fax_8c_source.html#l00168">span_message()</a>.</p>

<p>Referenced by <a class="el" href="app__fax_8c_source.html#l00362">transmit_audio()</a>, and <a class="el" href="app__fax_8c_source.html#l00599">transmit_t38()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00279"></a>00279 {
<a name="l00280"></a>00280    <span class="keywordtype">int</span> level = SPAN_LOG_WARNING + <a class="code" href="group__main__options.html#ga40f8fb2e731031d99f732f515cec680f">option_debug</a>;
<a name="l00281"></a>00281 
<a name="l00282"></a>00282    span_log_set_message_handler(<a class="code" href="structstate.html">state</a>, <a class="code" href="app__fax_8c.html#a7bb64d8d15c9e9428b42b75b51e90a72">span_message</a>);
<a name="l00283"></a>00283    span_log_set_level(<a class="code" href="structstate.html">state</a>, SPAN_LOG_SHOW_SEVERITY | SPAN_LOG_SHOW_PROTOCOL | level); 
<a name="l00284"></a>00284 
<a name="l00285"></a>00285    <span class="keywordflow">return</span> 0;
<a name="l00286"></a>00286 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6888bbf8afdf43d7845c50990b2bf8cc"></a><!-- doxytag: member="app_fax.c::sndfax_exec" ref="a6888bbf8afdf43d7845c50990b2bf8cc" args="(struct ast_channel *chan, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int sndfax_exec </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__fax_8c_source.html#l00830">830</a> of file <a class="el" href="app__fax_8c_source.html">app_fax.c</a>.</p>

<p>References <a class="el" href="app_8h_source.html#l00338">AST_APP_ARG</a>, <a class="el" href="app_8h_source.html#l00355">AST_DECLARE_APP_ARGS</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="app_8h_source.html#l00387">AST_STANDARD_APP_ARGS</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="app__fax_8c_source.html#l00162">fax_session::caller_mode</a>, <a class="el" href="app__fax_8c_source.html#l00159">fax_session::chan</a>, <a class="el" href="app__fax_8c_source.html#l00161">fax_session::direction</a>, <a class="el" href="app__minivm_8c_source.html#l00409">FALSE</a>, <a class="el" href="app__fax_8c_source.html#l00163">fax_session::file_name</a>, <a class="el" href="app__fax_8c_source.html#l00165">fax_session::finished</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="chan__mgcp_8c_source.html#l01737">parse()</a>, <a class="el" href="app__fax_8c_source.html#l00772">transmit()</a>, and <a class="el" href="app__minivm_8c_source.html#l00406">TRUE</a>.</p>

<p>Referenced by <a class="el" href="app__fax_8c_source.html#l00928">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00831"></a>00831 {
<a name="l00832"></a>00832    <span class="keywordtype">int</span> res = 0;
<a name="l00833"></a>00833    <span class="keywordtype">char</span> *<a class="code" href="chan__mgcp_8c.html#a2e006acff60d9b3d65d7d60f975d6747">parse</a>;
<a name="l00834"></a>00834    <a class="code" href="structfax__session.html">fax_session</a> session = { 0, };
<a name="l00835"></a>00835 
<a name="l00836"></a>00836    <a class="code" href="app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2" title="Declare a structure to hold an application&amp;#39;s arguments.">AST_DECLARE_APP_ARGS</a>(args,
<a name="l00837"></a>00837       <a class="code" href="app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5" title="Define an application argument.">AST_APP_ARG</a>(file_name);
<a name="l00838"></a>00838       <a class="code" href="app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5" title="Define an application argument.">AST_APP_ARG</a>(options);
<a name="l00839"></a>00839    );
<a name="l00840"></a>00840 
<a name="l00841"></a>00841    <span class="keywordflow">if</span> (chan == NULL) {
<a name="l00842"></a>00842       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Fax channel is NULL. Giving up.\n&quot;</span>);
<a name="l00843"></a>00843       <span class="keywordflow">return</span> -1;
<a name="l00844"></a>00844    }
<a name="l00845"></a>00845 
<a name="l00846"></a>00846    <span class="comment">/* The next few lines of code parse out the filename and header from the input string */</span>
<a name="l00847"></a>00847    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>)) {
<a name="l00848"></a>00848       <span class="comment">/* No data implies no filename or anything is present */</span>
<a name="l00849"></a>00849       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;SendFAX requires an argument (filename)\n&quot;</span>);
<a name="l00850"></a>00850       <span class="keywordflow">return</span> -1;
<a name="l00851"></a>00851    }
<a name="l00852"></a>00852 
<a name="l00853"></a>00853    parse = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>);
<a name="l00854"></a>00854    <a class="code" href="app_8h.html#ac08f7eb1eb9476b30987c73e1052ada8" title="Performs the &amp;#39;standard&amp;#39; argument separation process for an application.">AST_STANDARD_APP_ARGS</a>(args, parse);
<a name="l00855"></a>00855    
<a name="l00856"></a>00856    session.<a class="code" href="structfax__session.html#a318db77de0681ea150cb6941bb9e524d">caller_mode</a> = <a class="code" href="app__minivm_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00857"></a>00857 
<a name="l00858"></a>00858    <span class="keywordflow">if</span> (args.options) {
<a name="l00859"></a>00859       <span class="keywordflow">if</span> (strchr(args.options, <span class="charliteral">&apos;a&apos;</span>))
<a name="l00860"></a>00860          session.<a class="code" href="structfax__session.html#a318db77de0681ea150cb6941bb9e524d">caller_mode</a> = <a class="code" href="app__minivm_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00861"></a>00861    }
<a name="l00862"></a>00862 
<a name="l00863"></a>00863    <span class="comment">/* Done parsing */</span>
<a name="l00864"></a>00864    session.<a class="code" href="structfax__session.html#a886d551d5381dc3e53f17825ffc51641">direction</a> = 1;
<a name="l00865"></a>00865    session.<a class="code" href="structfax__session.html#a8505c513bc640d1f69e5f76fb32b24a8">file_name</a> = args.file_name;
<a name="l00866"></a>00866    session.<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a> = chan;
<a name="l00867"></a>00867    session.<a class="code" href="structfax__session.html#a45429b02ca394145850c27b9184f40d8">finished</a> = 0;
<a name="l00868"></a>00868 
<a name="l00869"></a>00869    res = <a class="code" href="app__fax_8c.html#af5dd15804f2fe408c6e13842a3a25164">transmit</a>(&amp;session);
<a name="l00870"></a>00870 
<a name="l00871"></a>00871    <span class="keywordflow">return</span> res;
<a name="l00872"></a>00872 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7bb64d8d15c9e9428b42b75b51e90a72"></a><!-- doxytag: member="app_fax.c::span_message" ref="a7bb64d8d15c9e9428b42b75b51e90a72" args="(int level, const char *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void span_message </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__fax_8c_source.html#l00168">168</a> of file <a class="el" href="app__fax_8c_source.html">app_fax.c</a>.</p>

<p>References <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="logger_8h_source.html#l00119">LOG_DEBUG</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, and <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>.</p>

<p>Referenced by <a class="el" href="app__fax_8c_source.html#l00278">set_logging()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00169"></a>00169 {
<a name="l00170"></a>00170    <span class="keywordflow">if</span> (level == SPAN_LOG_ERROR) {
<a name="l00171"></a>00171       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;%s&quot;</span>, <a class="code" href="adsistub_8c.html#a0dee90db1d6eb30329bee1ae6cec036a">msg</a>);
<a name="l00172"></a>00172    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (level == SPAN_LOG_WARNING) {
<a name="l00173"></a>00173       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;%s&quot;</span>, <a class="code" href="adsistub_8c.html#a0dee90db1d6eb30329bee1ae6cec036a">msg</a>);
<a name="l00174"></a>00174    } <span class="keywordflow">else</span> {
<a name="l00175"></a>00175       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, <span class="stringliteral">&quot;%s&quot;</span>, <a class="code" href="adsistub_8c.html#a0dee90db1d6eb30329bee1ae6cec036a">msg</a>);
<a name="l00176"></a>00176    }
<a name="l00177"></a>00177 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9fe2f00c97edb54d6768e15febed1193"></a><!-- doxytag: member="app_fax.c::t38_tx_packet_handler" ref="a9fe2f00c97edb54d6768e15febed1193" args="(t38_core_state_t *s, void *user_data, const uint8_t *buf, int len, int count)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int t38_tx_packet_handler </td>
          <td>(</td>
          <td class="paramtype">t38_core_state_t *&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>user_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>count</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__fax_8c_source.html#l00179">179</a> of file <a class="el" href="app__fax_8c_source.html">app_fax.c</a>.</p>

<p>References <a class="el" href="frame_8h_source.html#l00120">AST_FRAME_MODEM</a>, <a class="el" href="frame_8h_source.html#l00182">AST_FRAME_SET_BUFFER</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="frame_8h_source.html#l00215">AST_MODEM_T38</a>, <a class="el" href="channel_8c_source.html#l03411">ast_write()</a>, <a class="el" href="adsistub_8c_source.html#l00049">chan</a>, <a class="el" href="private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, and <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>.</p>

<p>Referenced by <a class="el" href="app__fax_8c_source.html#l00599">transmit_t38()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00180"></a>00180 {
<a name="l00181"></a>00181    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a> = (<span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *) user_data;
<a name="l00182"></a>00182 
<a name="l00183"></a>00183    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> outf = {
<a name="l00184"></a>00184       .frametype = <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ad99b86353343f422bda01163898b2eea">AST_FRAME_MODEM</a>,
<a name="l00185"></a>00185       .subclass = <a class="code" href="frame_8h.html#a3a510e4e2673c6870ed5fe0f1eb53732">AST_MODEM_T38</a>,
<a name="l00186"></a>00186       .src = __FUNCTION__,
<a name="l00187"></a>00187    };
<a name="l00188"></a>00188 
<a name="l00189"></a>00189    <span class="comment">/* TODO: Asterisk does not provide means of resending the same packet multiple</span>
<a name="l00190"></a>00190 <span class="comment">     times so count is ignored at the moment */</span>
<a name="l00191"></a>00191 
<a name="l00192"></a>00192    <a class="code" href="frame_8h.html#ac8bc210573f6b9c55ef38662bddc4675">AST_FRAME_SET_BUFFER</a>(&amp;outf, <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, 0, <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>);
<a name="l00193"></a>00193 
<a name="l00194"></a>00194    <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a79c413d51b7135404d5cacf811649a61" title="Write a frame to a channel This function writes the given frame to the indicated...">ast_write</a>(chan, &amp;outf) &lt; 0) {
<a name="l00195"></a>00195       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to write frame to channel; %s\n&quot;</span>, strerror(errno));
<a name="l00196"></a>00196       <span class="keywordflow">return</span> -1;
<a name="l00197"></a>00197    }
<a name="l00198"></a>00198 
<a name="l00199"></a>00199    <span class="keywordflow">return</span> 0;
<a name="l00200"></a>00200 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af5dd15804f2fe408c6e13842a3a25164"></a><!-- doxytag: member="app_fax.c::transmit" ref="af5dd15804f2fe408c6e13842a3a25164" args="(fax_session *s)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int transmit </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfax__session.html">fax_session</a> *&nbsp;</td>
          <td class="paramname"> <em>s</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__fax_8c_source.html#l00772">772</a> of file <a class="el" href="app__fax_8c_source.html">app_fax.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00469">ast_channel::_state</a>, <a class="el" href="channel_8c_source.html#l01951">ast_answer()</a>, <a class="el" href="channel_8h_source.html#l01753">ast_channel_get_t38_state()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8h_source.html#l00365">AST_STATE_UP</a>, <a class="el" href="app__fax_8c_source.html#l00159">fax_session::chan</a>, <a class="el" href="app__fax_8c_source.html#l00165">fax_session::finished</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="pbx_8c_source.html#l09023">pbx_builtin_setvar_helper()</a>, <a class="el" href="channel_8h_source.html#l00381">T38_STATE_NEGOTIATED</a>, <a class="el" href="app__fax_8c_source.html#l00160">fax_session::t38state</a>, <a class="el" href="app__fax_8c_source.html#l00362">transmit_audio()</a>, and <a class="el" href="app__fax_8c_source.html#l00599">transmit_t38()</a>.</p>

<p>Referenced by <a class="el" href="app__fax_8c_source.html#l00874">rcvfax_exec()</a>, and <a class="el" href="app__fax_8c_source.html#l00830">sndfax_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00773"></a>00773 {
<a name="l00774"></a>00774    <span class="keywordtype">int</span> res = 0;
<a name="l00775"></a>00775 
<a name="l00776"></a>00776    <span class="comment">/* Clear all channel variables which to be set by the application.</span>
<a name="l00777"></a>00777 <span class="comment">      Pre-set status to error so in case of any problems we can just leave */</span>
<a name="l00778"></a>00778    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, <span class="stringliteral">&quot;FAXSTATUS&quot;</span>, <span class="stringliteral">&quot;FAILED&quot;</span>); 
<a name="l00779"></a>00779    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, <span class="stringliteral">&quot;FAXERROR&quot;</span>, <span class="stringliteral">&quot;Channel problems&quot;</span>); 
<a name="l00780"></a>00780 
<a name="l00781"></a>00781    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, <span class="stringliteral">&quot;FAXMODE&quot;</span>, NULL);
<a name="l00782"></a>00782    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, <span class="stringliteral">&quot;REMOTESTATIONID&quot;</span>, NULL);
<a name="l00783"></a>00783    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, <span class="stringliteral">&quot;FAXPAGES&quot;</span>, NULL);
<a name="l00784"></a>00784    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, <span class="stringliteral">&quot;FAXRESOLUTION&quot;</span>, NULL);
<a name="l00785"></a>00785    <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, <span class="stringliteral">&quot;FAXBITRATE&quot;</span>, NULL); 
<a name="l00786"></a>00786 
<a name="l00787"></a>00787    <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> != <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>) {
<a name="l00788"></a>00788       <span class="comment">/* Shouldn&apos;t need this, but checking to see if channel is already answered</span>
<a name="l00789"></a>00789 <span class="comment">       * Theoretically asterisk should already have answered before running the app */</span>
<a name="l00790"></a>00790       res = <a class="code" href="channel_8h.html#aec583a3e25358ee552a4f3df53914cd0" title="Answer a channel.">ast_answer</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>);
<a name="l00791"></a>00791       <span class="keywordflow">if</span> (res) {
<a name="l00792"></a>00792          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not answer channel &apos;%s&apos;\n&quot;</span>, s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;name);
<a name="l00793"></a>00793          <span class="keywordflow">return</span> res;
<a name="l00794"></a>00794       }
<a name="l00795"></a>00795    }
<a name="l00796"></a>00796 
<a name="l00797"></a>00797    s-&gt;<a class="code" href="structfax__session.html#ae20a83a921cd17657129bd97961506d4">t38state</a> = <a class="code" href="channel_8h.html#a1b22ea5302ef183fa68bc45bfb0659c9" title="Retrieves the current T38 state of a channel.">ast_channel_get_t38_state</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>);
<a name="l00798"></a>00798    <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structfax__session.html#ae20a83a921cd17657129bd97961506d4">t38state</a> != <a class="code" href="channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1af142c79721a025bd65edad812f0725e0">T38_STATE_NEGOTIATED</a>) {
<a name="l00799"></a>00799       <span class="comment">/* T38 is not negotiated on the channel yet. First start regular transmission. If it switches to T38, follow */</span>   
<a name="l00800"></a>00800       <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, <span class="stringliteral">&quot;FAXMODE&quot;</span>, <span class="stringliteral">&quot;audio&quot;</span>); 
<a name="l00801"></a>00801       res = <a class="code" href="app__fax_8c.html#accd2f41bc9751826377ab0d4c57e3063">transmit_audio</a>(s);
<a name="l00802"></a>00802       <span class="keywordflow">if</span> (res &gt; 0) {
<a name="l00803"></a>00803          <span class="comment">/* transmit_audio reports switchover to T38. Update t38state */</span>
<a name="l00804"></a>00804          s-&gt;<a class="code" href="structfax__session.html#ae20a83a921cd17657129bd97961506d4">t38state</a> = <a class="code" href="channel_8h.html#a1b22ea5302ef183fa68bc45bfb0659c9" title="Retrieves the current T38 state of a channel.">ast_channel_get_t38_state</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>);
<a name="l00805"></a>00805          <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structfax__session.html#ae20a83a921cd17657129bd97961506d4">t38state</a> != <a class="code" href="channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1af142c79721a025bd65edad812f0725e0">T38_STATE_NEGOTIATED</a>) {
<a name="l00806"></a>00806             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Audio loop reports T38 switchover but t38state != T38_STATE_NEGOTIATED\n&quot;</span>);
<a name="l00807"></a>00807          }
<a name="l00808"></a>00808       }
<a name="l00809"></a>00809    }
<a name="l00810"></a>00810 
<a name="l00811"></a>00811    <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structfax__session.html#ae20a83a921cd17657129bd97961506d4">t38state</a> == <a class="code" href="channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1af142c79721a025bd65edad812f0725e0">T38_STATE_NEGOTIATED</a>) {
<a name="l00812"></a>00812       <a class="code" href="pbx_8h.html#ac74f20f5a5f022a60fdf2db0dc84889c" title="Add a variable to the channel variable stack, removing the most recently set value...">pbx_builtin_setvar_helper</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, <span class="stringliteral">&quot;FAXMODE&quot;</span>, <span class="stringliteral">&quot;T38&quot;</span>); 
<a name="l00813"></a>00813       res = <a class="code" href="app__fax_8c.html#aacf93c995c842fb9c1c3a60c1211b4bf">transmit_t38</a>(s);
<a name="l00814"></a>00814    }
<a name="l00815"></a>00815 
<a name="l00816"></a>00816    <span class="keywordflow">if</span> (res) {
<a name="l00817"></a>00817       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Transmission error\n&quot;</span>);
<a name="l00818"></a>00818       res = -1;
<a name="l00819"></a>00819    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structfax__session.html#a45429b02ca394145850c27b9184f40d8">finished</a> &lt; 0) {
<a name="l00820"></a>00820       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Transmission failed\n&quot;</span>);
<a name="l00821"></a>00821    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structfax__session.html#a45429b02ca394145850c27b9184f40d8">finished</a> &gt; 0) {
<a name="l00822"></a>00822       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Transmission finished Ok\n&quot;</span>);
<a name="l00823"></a>00823    }
<a name="l00824"></a>00824 
<a name="l00825"></a>00825    <span class="keywordflow">return</span> res;
<a name="l00826"></a>00826 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="accd2f41bc9751826377ab0d4c57e3063"></a><!-- doxytag: member="app_fax.c::transmit_audio" ref="accd2f41bc9751826377ab0d4c57e3063" args="(fax_session *s)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int transmit_audio </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfax__session.html">fax_session</a> *&nbsp;</td>
          <td class="paramname"> <em>s</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__fax_8c_source.html#l00362">362</a> of file <a class="el" href="app__fax_8c_source.html">app_fax.c</a>.</p>

<p>References <a class="el" href="channel_8c_source.html#l02001">ast_activate_generator()</a>, <a class="el" href="channel_8h_source.html#l01753">ast_channel_get_t38_state()</a>, <a class="el" href="frame_8h_source.html#l00318">AST_CONTROL_T38_PARAMETERS</a>, <a class="el" href="channel_8c_source.html#l01956">ast_deactivate_generator()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="frame_8h_source.html#l00253">AST_FORMAT_SLINEAR</a>, <a class="el" href="frame_8h_source.html#l00105">AST_FRAME_CONTROL</a>, <a class="el" href="frame_8h_source.html#l00101">AST_FRAME_VOICE</a>, <a class="el" href="frame_8h_source.html#l00462">ast_frfree</a>, <a class="el" href="channel_8c_source.html#l03150">ast_indicate_data()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="channel_8c_source.html#l03100">ast_read()</a>, <a class="el" href="channel_8c_source.html#l03731">ast_set_read_format()</a>, <a class="el" href="channel_8c_source.html#l03737">ast_set_write_format()</a>, <a class="el" href="frame_8h_source.html#l00324">AST_T38_NEGOTIATED</a>, <a class="el" href="frame_8h_source.html#l00335">AST_T38_RATE_14400</a>, <a class="el" href="frame_8h_source.html#l00339">AST_T38_RATE_MANAGEMENT_TRANSFERRED_TCF</a>, <a class="el" href="frame_8h_source.html#l00326">AST_T38_REFUSED</a>, <a class="el" href="frame_8h_source.html#l00322">AST_T38_REQUEST_NEGOTIATE</a>, <a class="el" href="time_8h_source.html#l00056">ast_tvdiff_sec()</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="channel_8c_source.html#l02389">ast_waitfor()</a>, <a class="el" href="app__fax_8c_source.html#l00162">fax_session::caller_mode</a>, <a class="el" href="app__fax_8c_source.html#l00159">fax_session::chan</a>, <a class="el" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">ast_frame::data</a>, <a class="el" href="frame_8h_source.html#l00147">ast_frame::datalen</a>, <a class="el" href="app__minivm_8c_source.html#l00409">FALSE</a>, <a class="el" href="app__fax_8c_source.html#l00165">fax_session::finished</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="app__fax_8c_source.html#l00202">phase_e_handler()</a>, <a class="el" href="frame_8h_source.html#l00159">ast_frame::ptr</a>, <a class="el" href="channel_8h_source.html#l00483">ast_channel::readformat</a>, <a class="el" href="frame_8h_source.html#l00344">ast_control_t38_parameters::request_response</a>, <a class="el" href="frame_8h_source.html#l00149">ast_frame::samples</a>, <a class="el" href="app__fax_8c_source.html#l00309">set_ecm()</a>, <a class="el" href="app__fax_8c_source.html#l00301">set_file()</a>, <a class="el" href="app__fax_8c_source.html#l00288">set_local_info()</a>, <a class="el" href="app__fax_8c_source.html#l00278">set_logging()</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, <a class="el" href="channel_8h_source.html#l00381">T38_STATE_NEGOTIATED</a>, <a class="el" href="channel_8h_source.html#l00377">T38_STATE_UNAVAILABLE</a>, <a class="el" href="app__fax_8c_source.html#l00164">fax_session::t38parameters</a>, <a class="el" href="app__minivm_8c_source.html#l00406">TRUE</a>, <a class="el" href="frame_8h_source.html#l00345">ast_control_t38_parameters::version</a>, <a class="el" href="app__fax_8c_source.html#l00156">WATCHDOG_STATE_TIMEOUT</a>, <a class="el" href="app__fax_8c_source.html#l00155">WATCHDOG_TOTAL_TIMEOUT</a>, and <a class="el" href="channel_8h_source.html#l00484">ast_channel::writeformat</a>.</p>

<p>Referenced by <a class="el" href="app__fax_8c_source.html#l00772">transmit()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00363"></a>00363 {
<a name="l00364"></a>00364    <span class="keywordtype">int</span> res = -1;
<a name="l00365"></a>00365    <span class="keywordtype">int</span> original_read_fmt = <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>;
<a name="l00366"></a>00366    <span class="keywordtype">int</span> original_write_fmt = <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>;
<a name="l00367"></a>00367    fax_state_t fax;
<a name="l00368"></a>00368    t30_state_t *t30state;
<a name="l00369"></a>00369    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *inf = NULL;
<a name="l00370"></a>00370    <span class="keywordtype">int</span> last_state = 0;
<a name="l00371"></a>00371    <span class="keyword">struct </span>timeval now, start, <a class="code" href="structstate__change.html">state_change</a>;
<a name="l00372"></a>00372    <span class="keyword">enum</span> <a class="code" href="channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1" title="Possible T38 states on channels.">ast_t38_state</a> t38_state;
<a name="l00373"></a>00373    <span class="keyword">struct </span><a class="code" href="structast__control__t38__parameters.html">ast_control_t38_parameters</a> t38_parameters = { .version = 0,
<a name="l00374"></a>00374                           .max_ifp = 800,
<a name="l00375"></a>00375                           .rate = <a class="code" href="frame_8h.html#a8d9ee156e6e29222a8fc1383f2832b07a2956ffa9b3fdde7ffc800fbd6e6a5482">AST_T38_RATE_14400</a>,
<a name="l00376"></a>00376                           .rate_management = <a class="code" href="frame_8h.html#a9db3df106b7deebbee4c5106a880ec33abbb1b9b329ded73597a5c2eefe13a34c">AST_T38_RATE_MANAGEMENT_TRANSFERRED_TCF</a>,
<a name="l00377"></a>00377                           .fill_bit_removal = 1,
<a name="l00378"></a>00378 <span class="comment">/*</span>
<a name="l00379"></a>00379 <span class="comment"> * spandsp has API calls to support MMR and JBIG transcoding, but they aren&apos;t</span>
<a name="l00380"></a>00380 <span class="comment"> * implemented quite yet... so don&apos;t offer them to the remote endpoint</span>
<a name="l00381"></a>00381 <span class="comment"> *                        .transcoding_mmr = 1,</span>
<a name="l00382"></a>00382 <span class="comment"> *                        .transcoding_jbig = 1,</span>
<a name="l00383"></a>00383 <span class="comment">*/</span>
<a name="l00384"></a>00384    };
<a name="l00385"></a>00385 
<a name="l00386"></a>00386    <span class="comment">/* if in called party mode, try to use T.38 */</span>
<a name="l00387"></a>00387    <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structfax__session.html#a318db77de0681ea150cb6941bb9e524d">caller_mode</a> == <a class="code" href="app__minivm_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>) {
<a name="l00388"></a>00388       <span class="comment">/* check if we are already in T.38 mode (unlikely), or if we can request</span>
<a name="l00389"></a>00389 <span class="comment">       * a switch... if so, request it now and wait for the result, rather</span>
<a name="l00390"></a>00390 <span class="comment">       * than starting an audio FAX session that will have to be cancelled</span>
<a name="l00391"></a>00391 <span class="comment">       */</span>
<a name="l00392"></a>00392       <span class="keywordflow">if</span> ((t38_state = <a class="code" href="channel_8h.html#a1b22ea5302ef183fa68bc45bfb0659c9" title="Retrieves the current T38 state of a channel.">ast_channel_get_t38_state</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>)) == <a class="code" href="channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1af142c79721a025bd65edad812f0725e0">T38_STATE_NEGOTIATED</a>) {
<a name="l00393"></a>00393          <span class="keywordflow">return</span> 1;
<a name="l00394"></a>00394       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((t38_state != <a class="code" href="channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1a8bd9e539fb6a17b095fb24a75e0b4d21">T38_STATE_UNAVAILABLE</a>) &amp;&amp;
<a name="l00395"></a>00395             (t38_parameters.<a class="code" href="structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a> = <a class="code" href="frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bafdb1ca68d683c64301c4cf07463a9975">AST_T38_REQUEST_NEGOTIATE</a>,
<a name="l00396"></a>00396              (<a class="code" href="channel_8h.html#aa8c3522af1bc639cbd5b38f5fdf171fa" title="Indicates condition of channel, with payload.">ast_indicate_data</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a7334c9d27a6d70fe7c85b60b864788fc">AST_CONTROL_T38_PARAMETERS</a>, &amp;t38_parameters, <span class="keyword">sizeof</span>(t38_parameters)) == 0))) {
<a name="l00397"></a>00397          <span class="comment">/* wait up to five seconds for negotiation to complete */</span>
<a name="l00398"></a>00398          <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> timeout = 5000;
<a name="l00399"></a>00399          <span class="keywordtype">int</span> ms;
<a name="l00400"></a>00400          
<a name="l00401"></a>00401          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Negotiating T.38 for receive on %s\n&quot;</span>, s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;name);
<a name="l00402"></a>00402          <span class="keywordflow">while</span> (timeout &gt; 0) {
<a name="l00403"></a>00403             ms = <a class="code" href="channel_8h.html#a60e0bcaed001e8d5ed1ba0eb2644b3cc" title="Wait for input on a channel.">ast_waitfor</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, 1000);
<a name="l00404"></a>00404             <span class="keywordflow">if</span> (ms &lt; 0) {
<a name="l00405"></a>00405                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;something bad happened while channel &apos;%s&apos; was polling.\n&quot;</span>, s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;name);
<a name="l00406"></a>00406                <span class="keywordflow">return</span> -1;
<a name="l00407"></a>00407             }
<a name="l00408"></a>00408             <span class="keywordflow">if</span> (!ms) {
<a name="l00409"></a>00409                <span class="comment">/* nothing happened */</span>
<a name="l00410"></a>00410                <span class="keywordflow">if</span> (timeout &gt; 0) {
<a name="l00411"></a>00411                   timeout -= 1000;
<a name="l00412"></a>00412                   <span class="keywordflow">continue</span>;
<a name="l00413"></a>00413                } <span class="keywordflow">else</span> {
<a name="l00414"></a>00414                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;channel &apos;%s&apos; timed-out during the T.38 negotiation.\n&quot;</span>, s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;name);
<a name="l00415"></a>00415                   <span class="keywordflow">break</span>;
<a name="l00416"></a>00416                }
<a name="l00417"></a>00417             }
<a name="l00418"></a>00418             <span class="keywordflow">if</span> (!(inf = <a class="code" href="channel_8h.html#a7ef6737309dc9e8b6c4a7cb4800638b1" title="Reads a frame.">ast_read</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>))) {
<a name="l00419"></a>00419                <span class="keywordflow">return</span> -1;
<a name="l00420"></a>00420             }
<a name="l00421"></a>00421             <span class="keywordflow">if</span> ((inf-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>) &amp;&amp;
<a name="l00422"></a>00422                 (inf-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> == <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a7334c9d27a6d70fe7c85b60b864788fc">AST_CONTROL_T38_PARAMETERS</a>) &amp;&amp;
<a name="l00423"></a>00423                 (inf-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> == <span class="keyword">sizeof</span>(t38_parameters))) {
<a name="l00424"></a>00424                <span class="keyword">struct </span><a class="code" href="structast__control__t38__parameters.html">ast_control_t38_parameters</a> *parameters = inf-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>;
<a name="l00425"></a>00425                
<a name="l00426"></a>00426                <span class="keywordflow">switch</span> (parameters-&gt;<a class="code" href="structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a>) {
<a name="l00427"></a>00427                <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bad501e0d5fe272eaba466507a686a2df5">AST_T38_NEGOTIATED</a>:
<a name="l00428"></a>00428                   <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Negotiated T.38 for receive on %s\n&quot;</span>, s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;name);
<a name="l00429"></a>00429                   res = 1;
<a name="l00430"></a>00430                   <span class="keywordflow">break</span>;
<a name="l00431"></a>00431                <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4baa02b30f25621f20396d06f5ac8aa7a2e">AST_T38_REFUSED</a>:
<a name="l00432"></a>00432                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;channel &apos;%s&apos; refused to negotiate T.38\n&quot;</span>, s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;name);
<a name="l00433"></a>00433                   <span class="keywordflow">break</span>;
<a name="l00434"></a>00434                <span class="keywordflow">default</span>:
<a name="l00435"></a>00435                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;channel &apos;%s&apos; failed to negotiate T.38\n&quot;</span>, s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;name);
<a name="l00436"></a>00436                   <span class="keywordflow">break</span>;
<a name="l00437"></a>00437                }
<a name="l00438"></a>00438                <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(inf);
<a name="l00439"></a>00439                <span class="keywordflow">if</span> (res == 1) {
<a name="l00440"></a>00440                   <span class="keywordflow">return</span> 1;
<a name="l00441"></a>00441                } <span class="keywordflow">else</span> {
<a name="l00442"></a>00442                   <span class="keywordflow">break</span>;
<a name="l00443"></a>00443                }
<a name="l00444"></a>00444             }
<a name="l00445"></a>00445             <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(inf);
<a name="l00446"></a>00446          }
<a name="l00447"></a>00447       }
<a name="l00448"></a>00448    }
<a name="l00449"></a>00449 
<a name="l00450"></a>00450 <span class="preprocessor">#if SPANDSP_RELEASE_DATE &gt;= 20080725</span>
<a name="l00451"></a>00451 <span class="preprocessor"></span>        <span class="comment">/* for spandsp shaphots 0.0.6 and higher */</span>
<a name="l00452"></a>00452         t30state = &amp;fax.t30;
<a name="l00453"></a>00453 <span class="preprocessor">#else</span>
<a name="l00454"></a>00454 <span class="preprocessor"></span>        <span class="comment">/* for spandsp release 0.0.5 */</span>
<a name="l00455"></a>00455         t30state = &amp;fax.t30_state;
<a name="l00456"></a>00456 <span class="preprocessor">#endif</span>
<a name="l00457"></a>00457 <span class="preprocessor"></span>
<a name="l00458"></a>00458    original_read_fmt = s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#ab7786a0f5b9a9ebf83daed87be4f3868">readformat</a>;
<a name="l00459"></a>00459    <span class="keywordflow">if</span> (original_read_fmt != <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>) {
<a name="l00460"></a>00460       res = <a class="code" href="channel_8h.html#a72d53065c6bc2b6092fa41eefa03f1ad" title="Sets read format on channel chan Set read format for channel to whichever component...">ast_set_read_format</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>);
<a name="l00461"></a>00461       <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l00462"></a>00462          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to set to linear read mode, giving up\n&quot;</span>);
<a name="l00463"></a>00463          <span class="keywordflow">goto</span> done;
<a name="l00464"></a>00464       }
<a name="l00465"></a>00465    }
<a name="l00466"></a>00466 
<a name="l00467"></a>00467    original_write_fmt = s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;<a class="code" href="structast__channel.html#a00f5ce2ad53ff8523f8e46ea5aceba48">writeformat</a>;
<a name="l00468"></a>00468    <span class="keywordflow">if</span> (original_write_fmt != <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>) {
<a name="l00469"></a>00469       res = <a class="code" href="channel_8h.html#a978161a52d98fdaee374d1f6e1359544" title="Sets write format on channel chan Set write format for channel to whichever component...">ast_set_write_format</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>);
<a name="l00470"></a>00470       <span class="keywordflow">if</span> (res &lt; 0) {
<a name="l00471"></a>00471          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to set to linear write mode, giving up\n&quot;</span>);
<a name="l00472"></a>00472          <span class="keywordflow">goto</span> done;
<a name="l00473"></a>00473       }
<a name="l00474"></a>00474    }
<a name="l00475"></a>00475 
<a name="l00476"></a>00476    <span class="comment">/* Initialize T30 terminal */</span>
<a name="l00477"></a>00477    fax_init(&amp;fax, s-&gt;<a class="code" href="structfax__session.html#a318db77de0681ea150cb6941bb9e524d">caller_mode</a>);
<a name="l00478"></a>00478 
<a name="l00479"></a>00479    <span class="comment">/* Setup logging */</span>
<a name="l00480"></a>00480    <a class="code" href="app__fax_8c.html#a4dff8975f6c904def4e616ef9c74a8d6">set_logging</a>(&amp;fax.logging);
<a name="l00481"></a>00481    <a class="code" href="app__fax_8c.html#a4dff8975f6c904def4e616ef9c74a8d6">set_logging</a>(&amp;t30state-&gt;logging);
<a name="l00482"></a>00482 
<a name="l00483"></a>00483    <span class="comment">/* Configure terminal */</span>
<a name="l00484"></a>00484    <a class="code" href="app__fax_8c.html#a9bea7e90763229cdc0bc011f11127c5f">set_local_info</a>(t30state, s);
<a name="l00485"></a>00485    <a class="code" href="app__fax_8c.html#a5ccd70da6546046e2a0a33455a95c20f">set_file</a>(t30state, s);
<a name="l00486"></a>00486    <a class="code" href="app__fax_8c.html#abd857f1c1668126b9c5479cf2d28788a">set_ecm</a>(t30state, <a class="code" href="app__minivm_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l00487"></a>00487 
<a name="l00488"></a>00488    fax_set_transmit_on_idle(&amp;fax, <a class="code" href="app__minivm_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l00489"></a>00489 
<a name="l00490"></a>00490    t30_set_phase_e_handler(t30state, <a class="code" href="app__fax_8c.html#a464dc08d1104ca9c0766e7f91b8598f7">phase_e_handler</a>, s);
<a name="l00491"></a>00491 
<a name="l00492"></a>00492    start = <a class="code" href="structstate__change.html">state_change</a> = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l00493"></a>00493 
<a name="l00494"></a>00494    <a class="code" href="channel_8h.html#a12a58dda74a19f383f6b77cf7fa88b54">ast_activate_generator</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, &amp;<a class="code" href="app__fax_8c.html#a36aeb2eb01afb248bad64a309d743636">generator</a>, &amp;fax);
<a name="l00495"></a>00495 
<a name="l00496"></a>00496    <span class="keywordflow">while</span> (!s-&gt;<a class="code" href="structfax__session.html#a45429b02ca394145850c27b9184f40d8">finished</a>) {
<a name="l00497"></a>00497       inf = NULL;
<a name="l00498"></a>00498 
<a name="l00499"></a>00499       <span class="keywordflow">if</span> ((res = <a class="code" href="channel_8h.html#a60e0bcaed001e8d5ed1ba0eb2644b3cc" title="Wait for input on a channel.">ast_waitfor</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, 25)) &lt; 0) {
<a name="l00500"></a>00500          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Error waiting for a frame\n&quot;</span>);
<a name="l00501"></a>00501          <span class="keywordflow">break</span>;
<a name="l00502"></a>00502       }
<a name="l00503"></a>00503 
<a name="l00504"></a>00504       <span class="comment">/* Watchdog */</span>
<a name="l00505"></a>00505       now = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l00506"></a>00506       <span class="keywordflow">if</span> (<a class="code" href="time_8h.html#a3f55930df743fa0d76c353f2643e148b" title="Computes the difference (in seconds) between two struct timeval instances.">ast_tvdiff_sec</a>(now, start) &gt; <a class="code" href="app__fax_8c.html#a834406a117d19c84a165748126372951">WATCHDOG_TOTAL_TIMEOUT</a> || <a class="code" href="time_8h.html#a3f55930df743fa0d76c353f2643e148b" title="Computes the difference (in seconds) between two struct timeval instances.">ast_tvdiff_sec</a>(now, <a class="code" href="structstate__change.html">state_change</a>) &gt; <a class="code" href="app__fax_8c.html#a23665e111b77b1011b401043c91924a5">WATCHDOG_STATE_TIMEOUT</a>) {
<a name="l00507"></a>00507          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;It looks like we hung. Aborting.\n&quot;</span>);
<a name="l00508"></a>00508          res = -1;
<a name="l00509"></a>00509          <span class="keywordflow">break</span>;
<a name="l00510"></a>00510       }
<a name="l00511"></a>00511 
<a name="l00512"></a>00512       <span class="keywordflow">if</span> (!res) {
<a name="l00513"></a>00513          <span class="comment">/* There was timeout waiting for a frame. Loop around and wait again */</span>
<a name="l00514"></a>00514          <span class="keywordflow">continue</span>;
<a name="l00515"></a>00515       }
<a name="l00516"></a>00516 
<a name="l00517"></a>00517       <span class="comment">/* There is a frame available. Get it */</span>
<a name="l00518"></a>00518       res = 0;
<a name="l00519"></a>00519 
<a name="l00520"></a>00520       <span class="keywordflow">if</span> (!(inf = <a class="code" href="channel_8h.html#a7ef6737309dc9e8b6c4a7cb4800638b1" title="Reads a frame.">ast_read</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>))) {
<a name="l00521"></a>00521          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Channel hangup\n&quot;</span>);
<a name="l00522"></a>00522          res = -1;
<a name="l00523"></a>00523          <span class="keywordflow">break</span>;
<a name="l00524"></a>00524       }
<a name="l00525"></a>00525 
<a name="l00526"></a>00526       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(10, <span class="stringliteral">&quot;frame %d/%d, len=%d\n&quot;</span>, inf-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a>, inf-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>, inf-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>);
<a name="l00527"></a>00527 
<a name="l00528"></a>00528       <span class="comment">/* Check the frame type. Format also must be checked because there is a chance</span>
<a name="l00529"></a>00529 <span class="comment">         that a frame in old format was already queued before we set channel format</span>
<a name="l00530"></a>00530 <span class="comment">         to slinear so it will still be received by ast_read */</span>
<a name="l00531"></a>00531       <span class="keywordflow">if</span> (inf-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a> &amp;&amp; inf-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> == <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>) {
<a name="l00532"></a>00532          <span class="keywordflow">if</span> (fax_rx(&amp;fax, inf-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, inf-&gt;<a class="code" href="structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>) &lt; 0) {
<a name="l00533"></a>00533             <span class="comment">/* I know fax_rx never returns errors. The check here is for good style only */</span>
<a name="l00534"></a>00534             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;fax_rx returned error\n&quot;</span>);
<a name="l00535"></a>00535             res = -1;
<a name="l00536"></a>00536             <span class="keywordflow">break</span>;
<a name="l00537"></a>00537          }
<a name="l00538"></a>00538          <span class="keywordflow">if</span> (last_state != t30state-&gt;state) {
<a name="l00539"></a>00539             <a class="code" href="structstate__change.html">state_change</a> = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l00540"></a>00540             last_state = t30state-&gt;state;
<a name="l00541"></a>00541          }
<a name="l00542"></a>00542       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((inf-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>) &amp;&amp;
<a name="l00543"></a>00543             (inf-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> == <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a7334c9d27a6d70fe7c85b60b864788fc">AST_CONTROL_T38_PARAMETERS</a>)) {
<a name="l00544"></a>00544          <span class="keyword">struct </span><a class="code" href="structast__control__t38__parameters.html">ast_control_t38_parameters</a> *parameters = inf-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>;
<a name="l00545"></a>00545 
<a name="l00546"></a>00546          <span class="keywordflow">if</span> (parameters-&gt;<a class="code" href="structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a> == <a class="code" href="frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bad501e0d5fe272eaba466507a686a2df5">AST_T38_NEGOTIATED</a>) {
<a name="l00547"></a>00547             <span class="comment">/* T38 switchover completed */</span>
<a name="l00548"></a>00548             s-&gt;<a class="code" href="structfax__session.html#a66e004bf6c04b30b7ed23dba8b75c120">t38parameters</a> = *parameters;
<a name="l00549"></a>00549             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;T38 negotiated, finishing audio loop\n&quot;</span>);
<a name="l00550"></a>00550             res = 1;
<a name="l00551"></a>00551             <span class="keywordflow">break</span>;
<a name="l00552"></a>00552          } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (parameters-&gt;<a class="code" href="structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a> == <a class="code" href="frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bafdb1ca68d683c64301c4cf07463a9975">AST_T38_REQUEST_NEGOTIATE</a>) {
<a name="l00553"></a>00553             t38_parameters.<a class="code" href="structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a> = <a class="code" href="frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bad501e0d5fe272eaba466507a686a2df5">AST_T38_NEGOTIATED</a>;
<a name="l00554"></a>00554             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;T38 request received, accepting\n&quot;</span>);
<a name="l00555"></a>00555             <span class="comment">/* Complete T38 switchover */</span>
<a name="l00556"></a>00556             <a class="code" href="channel_8h.html#aa8c3522af1bc639cbd5b38f5fdf171fa" title="Indicates condition of channel, with payload.">ast_indicate_data</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a7334c9d27a6d70fe7c85b60b864788fc">AST_CONTROL_T38_PARAMETERS</a>, &amp;t38_parameters, <span class="keyword">sizeof</span>(t38_parameters));
<a name="l00557"></a>00557             <span class="comment">/* Do not break audio loop, wait until channel driver finally acks switchover</span>
<a name="l00558"></a>00558 <span class="comment">             * with AST_T38_NEGOTIATED</span>
<a name="l00559"></a>00559 <span class="comment">             */</span>
<a name="l00560"></a>00560          }
<a name="l00561"></a>00561       }
<a name="l00562"></a>00562 
<a name="l00563"></a>00563       <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(inf);
<a name="l00564"></a>00564       inf = NULL;
<a name="l00565"></a>00565    }
<a name="l00566"></a>00566 
<a name="l00567"></a>00567    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Loop finished, res=%d\n&quot;</span>, res);
<a name="l00568"></a>00568 
<a name="l00569"></a>00569    <span class="keywordflow">if</span> (inf)
<a name="l00570"></a>00570       <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(inf);
<a name="l00571"></a>00571 
<a name="l00572"></a>00572    <a class="code" href="channel_8h.html#a7160355005776732fba88cc020f4a45b">ast_deactivate_generator</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>);
<a name="l00573"></a>00573 
<a name="l00574"></a>00574    <span class="comment">/* If we are switching to T38, remove phase E handler. Otherwise it will be executed</span>
<a name="l00575"></a>00575 <span class="comment">      by t30_terminate, display diagnostics and set status variables although no transmittion</span>
<a name="l00576"></a>00576 <span class="comment">      has taken place yet. */</span>
<a name="l00577"></a>00577    <span class="keywordflow">if</span> (res &gt; 0) {
<a name="l00578"></a>00578       t30_set_phase_e_handler(t30state, NULL, NULL);
<a name="l00579"></a>00579    }
<a name="l00580"></a>00580 
<a name="l00581"></a>00581    t30_terminate(t30state);
<a name="l00582"></a>00582    fax_release(&amp;fax);
<a name="l00583"></a>00583 
<a name="l00584"></a>00584 done:
<a name="l00585"></a>00585    <span class="keywordflow">if</span> (original_write_fmt != <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>) {
<a name="l00586"></a>00586       <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a978161a52d98fdaee374d1f6e1359544" title="Sets write format on channel chan Set write format for channel to whichever component...">ast_set_write_format</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, original_write_fmt) &lt; 0)
<a name="l00587"></a>00587          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to restore write format on &apos;%s&apos;\n&quot;</span>, s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;name);
<a name="l00588"></a>00588    }
<a name="l00589"></a>00589 
<a name="l00590"></a>00590    <span class="keywordflow">if</span> (original_read_fmt != <a class="code" href="frame_8h.html#aa68ce7f14882005613a3e1fb0f4181b7">AST_FORMAT_SLINEAR</a>) {
<a name="l00591"></a>00591       <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#a72d53065c6bc2b6092fa41eefa03f1ad" title="Sets read format on channel chan Set read format for channel to whichever component...">ast_set_read_format</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, original_read_fmt) &lt; 0)
<a name="l00592"></a>00592          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to restore read format on &apos;%s&apos;\n&quot;</span>, s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;name);
<a name="l00593"></a>00593    }
<a name="l00594"></a>00594 
<a name="l00595"></a>00595    <span class="keywordflow">return</span> res;
<a name="l00596"></a>00596 
<a name="l00597"></a>00597 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aacf93c995c842fb9c1c3a60c1211b4bf"></a><!-- doxytag: member="app_fax.c::transmit_t38" ref="aacf93c995c842fb9c1c3a60c1211b4bf" args="(fax_session *s)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int transmit_t38 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structfax__session.html">fax_session</a> *&nbsp;</td>
          <td class="paramname"> <em>s</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__fax_8c_source.html#l00599">599</a> of file <a class="el" href="app__fax_8c_source.html">app_fax.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l01753">ast_channel_get_t38_state()</a>, <a class="el" href="frame_8h_source.html#l00318">AST_CONTROL_T38_PARAMETERS</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="frame_8h_source.html#l00105">AST_FRAME_CONTROL</a>, <a class="el" href="frame_8h_source.html#l00120">AST_FRAME_MODEM</a>, <a class="el" href="frame_8h_source.html#l00462">ast_frfree</a>, <a class="el" href="channel_8c_source.html#l03150">ast_indicate_data()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="frame_8h_source.html#l00215">AST_MODEM_T38</a>, <a class="el" href="channel_8c_source.html#l03100">ast_read()</a>, <a class="el" href="frame_8h_source.html#l00326">AST_T38_REFUSED</a>, <a class="el" href="frame_8h_source.html#l00323">AST_T38_REQUEST_TERMINATE</a>, <a class="el" href="frame_8h_source.html#l00325">AST_T38_TERMINATED</a>, <a class="el" href="time_8h_source.html#l00056">ast_tvdiff_sec()</a>, <a class="el" href="time_8h_source.html#l00070">ast_tvdiff_us()</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="channel_8c_source.html#l02389">ast_waitfor()</a>, <a class="el" href="app__fax_8c_source.html#l00162">fax_session::caller_mode</a>, <a class="el" href="app__fax_8c_source.html#l00159">fax_session::chan</a>, <a class="el" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">ast_frame::data</a>, <a class="el" href="frame_8h_source.html#l00147">ast_frame::datalen</a>, <a class="el" href="app__minivm_8c_source.html#l00409">FALSE</a>, <a class="el" href="frame_8h_source.html#l00349">ast_control_t38_parameters::fill_bit_removal</a>, <a class="el" href="app__fax_8c_source.html#l00165">fax_session::finished</a>, <a class="el" href="frame_8h_source.html#l00143">ast_frame::frametype</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="frame_8h_source.html#l00346">ast_control_t38_parameters::max_ifp</a>, <a class="el" href="app__fax_8c_source.html#l00202">phase_e_handler()</a>, <a class="el" href="frame_8h_source.html#l00159">ast_frame::ptr</a>, <a class="el" href="frame_8h_source.html#l00344">ast_control_t38_parameters::request_response</a>, <a class="el" href="frame_8h_source.html#l00171">ast_frame::seqno</a>, <a class="el" href="app__fax_8c_source.html#l00309">set_ecm()</a>, <a class="el" href="app__fax_8c_source.html#l00301">set_file()</a>, <a class="el" href="app__fax_8c_source.html#l00288">set_local_info()</a>, <a class="el" href="app__fax_8c_source.html#l00278">set_logging()</a>, <a class="el" href="frame_8h_source.html#l00145">ast_frame::subclass</a>, <a class="el" href="channel_8h_source.html#l00381">T38_STATE_NEGOTIATED</a>, <a class="el" href="app__fax_8c_source.html#l00179">t38_tx_packet_handler()</a>, <a class="el" href="app__fax_8c_source.html#l00164">fax_session::t38parameters</a>, <a class="el" href="frame_8h_source.html#l00351">ast_control_t38_parameters::transcoding_jbig</a>, <a class="el" href="frame_8h_source.html#l00350">ast_control_t38_parameters::transcoding_mmr</a>, <a class="el" href="app__minivm_8c_source.html#l00406">TRUE</a>, <a class="el" href="app__fax_8c_source.html#l00156">WATCHDOG_STATE_TIMEOUT</a>, and <a class="el" href="app__fax_8c_source.html#l00155">WATCHDOG_TOTAL_TIMEOUT</a>.</p>

<p>Referenced by <a class="el" href="app__fax_8c_source.html#l00772">transmit()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00600"></a>00600 {
<a name="l00601"></a>00601    <span class="keywordtype">int</span> res = 0;
<a name="l00602"></a>00602    t38_terminal_state_t t38;
<a name="l00603"></a>00603    <span class="keyword">struct </span><a class="code" href="structast__frame.html" title="Data structure associated with a single frame of data.">ast_frame</a> *inf = NULL;
<a name="l00604"></a>00604    <span class="keywordtype">int</span> last_state = 0;
<a name="l00605"></a>00605    <span class="keyword">struct </span>timeval now, start, <a class="code" href="structstate__change.html">state_change</a>, last_frame;
<a name="l00606"></a>00606    t30_state_t *t30state;
<a name="l00607"></a>00607    t38_core_state_t *<a class="code" href="chan__sip_8c.html#ada584ef2e7f77c8dfe0315d05fa49e1c" title="T38 States for a call.">t38state</a>;
<a name="l00608"></a>00608 
<a name="l00609"></a>00609 <span class="preprocessor">#if SPANDSP_RELEASE_DATE &gt;= 20080725</span>
<a name="l00610"></a>00610 <span class="preprocessor"></span>   <span class="comment">/* for spandsp shaphots 0.0.6 and higher */</span>
<a name="l00611"></a>00611    t30state = &amp;t38.t30;
<a name="l00612"></a>00612    t38state = &amp;t38.t38_fe.t38;
<a name="l00613"></a>00613 <span class="preprocessor">#else</span>
<a name="l00614"></a>00614 <span class="preprocessor"></span>   <span class="comment">/* for spandsp releases 0.0.5 */</span>
<a name="l00615"></a>00615    t30state = &amp;t38.t30_state;
<a name="l00616"></a>00616    t38state = &amp;t38.t38;
<a name="l00617"></a>00617 <span class="preprocessor">#endif</span>
<a name="l00618"></a>00618 <span class="preprocessor"></span>
<a name="l00619"></a>00619    <span class="comment">/* Initialize terminal */</span>
<a name="l00620"></a>00620    memset(&amp;t38, 0, <span class="keyword">sizeof</span>(t38));
<a name="l00621"></a>00621    <span class="keywordflow">if</span> (t38_terminal_init(&amp;t38, s-&gt;<a class="code" href="structfax__session.html#a318db77de0681ea150cb6941bb9e524d">caller_mode</a>, <a class="code" href="app__fax_8c.html#a9fe2f00c97edb54d6768e15febed1193">t38_tx_packet_handler</a>, s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>) == NULL) {
<a name="l00622"></a>00622       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to start T.38 termination.\n&quot;</span>);
<a name="l00623"></a>00623       res = -1;
<a name="l00624"></a>00624       <span class="keywordflow">goto</span> disable_t38;
<a name="l00625"></a>00625    }
<a name="l00626"></a>00626 
<a name="l00627"></a>00627    t38_set_max_datagram_size(t38state, s-&gt;<a class="code" href="structfax__session.html#a66e004bf6c04b30b7ed23dba8b75c120">t38parameters</a>.<a class="code" href="structast__control__t38__parameters.html#a7924cc45cde640e779a902c4aadaf180">max_ifp</a>);
<a name="l00628"></a>00628 
<a name="l00629"></a>00629    <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structfax__session.html#a66e004bf6c04b30b7ed23dba8b75c120">t38parameters</a>.<a class="code" href="structast__control__t38__parameters.html#addb721c952a7144f0a6a9ac5f621d2bc">fill_bit_removal</a>) {
<a name="l00630"></a>00630       t38_set_fill_bit_removal(t38state, <a class="code" href="app__minivm_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l00631"></a>00631    }
<a name="l00632"></a>00632    <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structfax__session.html#a66e004bf6c04b30b7ed23dba8b75c120">t38parameters</a>.<a class="code" href="structast__control__t38__parameters.html#ad2b3d53474db70e3ff2058da953b7b82">transcoding_mmr</a>) {
<a name="l00633"></a>00633       t38_set_mmr_transcoding(t38state, <a class="code" href="app__minivm_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l00634"></a>00634    }
<a name="l00635"></a>00635    <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structfax__session.html#a66e004bf6c04b30b7ed23dba8b75c120">t38parameters</a>.<a class="code" href="structast__control__t38__parameters.html#a07676322ec48c4872f9a208a6248d034">transcoding_jbig</a>) {
<a name="l00636"></a>00636       t38_set_jbig_transcoding(t38state, <a class="code" href="app__minivm_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l00637"></a>00637    }
<a name="l00638"></a>00638 
<a name="l00639"></a>00639    <span class="comment">/* Setup logging */</span>
<a name="l00640"></a>00640    <a class="code" href="app__fax_8c.html#a4dff8975f6c904def4e616ef9c74a8d6">set_logging</a>(&amp;t38.logging);
<a name="l00641"></a>00641    <a class="code" href="app__fax_8c.html#a4dff8975f6c904def4e616ef9c74a8d6">set_logging</a>(&amp;t30state-&gt;logging);
<a name="l00642"></a>00642    <a class="code" href="app__fax_8c.html#a4dff8975f6c904def4e616ef9c74a8d6">set_logging</a>(&amp;t38state-&gt;logging);
<a name="l00643"></a>00643 
<a name="l00644"></a>00644    <span class="comment">/* Configure terminal */</span>
<a name="l00645"></a>00645    <a class="code" href="app__fax_8c.html#a9bea7e90763229cdc0bc011f11127c5f">set_local_info</a>(t30state, s);
<a name="l00646"></a>00646    <a class="code" href="app__fax_8c.html#a5ccd70da6546046e2a0a33455a95c20f">set_file</a>(t30state, s);
<a name="l00647"></a>00647    <a class="code" href="app__fax_8c.html#abd857f1c1668126b9c5479cf2d28788a">set_ecm</a>(t30state, <a class="code" href="app__minivm_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l00648"></a>00648 
<a name="l00649"></a>00649    t30_set_phase_e_handler(t30state, <a class="code" href="app__fax_8c.html#a464dc08d1104ca9c0766e7f91b8598f7">phase_e_handler</a>, s);
<a name="l00650"></a>00650 
<a name="l00651"></a>00651    now = start = <a class="code" href="structstate__change.html">state_change</a> = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l00652"></a>00652 
<a name="l00653"></a>00653    <span class="keywordflow">while</span> (!s-&gt;<a class="code" href="structfax__session.html#a45429b02ca394145850c27b9184f40d8">finished</a>) {
<a name="l00654"></a>00654       inf = NULL;
<a name="l00655"></a>00655       <span class="keywordflow">if</span> ((res = <a class="code" href="channel_8h.html#a60e0bcaed001e8d5ed1ba0eb2644b3cc" title="Wait for input on a channel.">ast_waitfor</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, 20)) &lt; 0) {
<a name="l00656"></a>00656          <span class="keywordflow">break</span>;
<a name="l00657"></a>00657       }
<a name="l00658"></a>00658 
<a name="l00659"></a>00659       last_frame = now;
<a name="l00660"></a>00660       now = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l00661"></a>00661       <span class="comment">/* if nothing arrived, check the watchdog timers */</span>
<a name="l00662"></a>00662       <span class="keywordflow">if</span> (res == 0) {
<a name="l00663"></a>00663          <span class="keywordflow">if</span> (<a class="code" href="time_8h.html#a3f55930df743fa0d76c353f2643e148b" title="Computes the difference (in seconds) between two struct timeval instances.">ast_tvdiff_sec</a>(now, start) &gt; <a class="code" href="app__fax_8c.html#a834406a117d19c84a165748126372951">WATCHDOG_TOTAL_TIMEOUT</a> || <a class="code" href="time_8h.html#a3f55930df743fa0d76c353f2643e148b" title="Computes the difference (in seconds) between two struct timeval instances.">ast_tvdiff_sec</a>(now, <a class="code" href="structstate__change.html">state_change</a>) &gt; <a class="code" href="app__fax_8c.html#a23665e111b77b1011b401043c91924a5">WATCHDOG_STATE_TIMEOUT</a>) {
<a name="l00664"></a>00664             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;It looks like we hung. Aborting.\n&quot;</span>);
<a name="l00665"></a>00665             res = -1;
<a name="l00666"></a>00666             <span class="keywordflow">break</span>;
<a name="l00667"></a>00667          } <span class="keywordflow">else</span> {
<a name="l00668"></a>00668             <span class="comment">/* timers have not triggered, loop around to wait</span>
<a name="l00669"></a>00669 <span class="comment">             * again</span>
<a name="l00670"></a>00670 <span class="comment">             */</span>
<a name="l00671"></a>00671             t38_terminal_send_timeout(&amp;t38, <a class="code" href="time_8h.html#a140711bcdd1612c6baafc3e92c54caa1" title="Computes the difference (in microseconds) between two struct timeval instances.">ast_tvdiff_us</a>(now, last_frame) / (1000000 / 8000));
<a name="l00672"></a>00672             <span class="keywordflow">continue</span>;
<a name="l00673"></a>00673          }
<a name="l00674"></a>00674       }
<a name="l00675"></a>00675 
<a name="l00676"></a>00676       t38_terminal_send_timeout(&amp;t38, <a class="code" href="time_8h.html#a140711bcdd1612c6baafc3e92c54caa1" title="Computes the difference (in microseconds) between two struct timeval instances.">ast_tvdiff_us</a>(now, last_frame) / (1000000 / 8000));
<a name="l00677"></a>00677 
<a name="l00678"></a>00678       <span class="keywordflow">if</span> (!(inf = <a class="code" href="channel_8h.html#a7ef6737309dc9e8b6c4a7cb4800638b1" title="Reads a frame.">ast_read</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>))) {
<a name="l00679"></a>00679          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Channel hangup\n&quot;</span>);
<a name="l00680"></a>00680          res = -1;
<a name="l00681"></a>00681          <span class="keywordflow">break</span>;
<a name="l00682"></a>00682       }
<a name="l00683"></a>00683 
<a name="l00684"></a>00684       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(10, <span class="stringliteral">&quot;frame %d/%d, len=%d\n&quot;</span>, inf-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a>, inf-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>, inf-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>);
<a name="l00685"></a>00685 
<a name="l00686"></a>00686       <span class="keywordflow">if</span> (inf-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ad99b86353343f422bda01163898b2eea">AST_FRAME_MODEM</a> &amp;&amp; inf-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> == <a class="code" href="frame_8h.html#a3a510e4e2673c6870ed5fe0f1eb53732">AST_MODEM_T38</a>) {
<a name="l00687"></a>00687          t38_core_rx_ifp_packet(t38state, inf-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, inf-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>, inf-&gt;<a class="code" href="structast__frame.html#ab793262012344621455faf9266acbac2">seqno</a>);
<a name="l00688"></a>00688          <span class="keywordflow">if</span> (last_state != t30state-&gt;state) {
<a name="l00689"></a>00689             <a class="code" href="structstate__change.html">state_change</a> = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l00690"></a>00690             last_state = t30state-&gt;state;
<a name="l00691"></a>00691          }
<a name="l00692"></a>00692       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (inf-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a> &amp;&amp; inf-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> == <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a7334c9d27a6d70fe7c85b60b864788fc">AST_CONTROL_T38_PARAMETERS</a>) {
<a name="l00693"></a>00693          <span class="keyword">struct </span><a class="code" href="structast__control__t38__parameters.html">ast_control_t38_parameters</a> *parameters = inf-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>;
<a name="l00694"></a>00694          <span class="keywordflow">if</span> (parameters-&gt;<a class="code" href="structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a> == <a class="code" href="frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4ba9df578b4287c86673d7f40f9abcdc86f">AST_T38_TERMINATED</a>) {
<a name="l00695"></a>00695             <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;T38 down, finishing\n&quot;</span>);
<a name="l00696"></a>00696             <span class="keywordflow">break</span>;
<a name="l00697"></a>00697          }
<a name="l00698"></a>00698       }
<a name="l00699"></a>00699 
<a name="l00700"></a>00700       <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(inf);
<a name="l00701"></a>00701       inf = NULL;
<a name="l00702"></a>00702    }
<a name="l00703"></a>00703 
<a name="l00704"></a>00704    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Loop finished, res=%d\n&quot;</span>, res);
<a name="l00705"></a>00705 
<a name="l00706"></a>00706    <span class="keywordflow">if</span> (inf)
<a name="l00707"></a>00707       <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(inf);
<a name="l00708"></a>00708 
<a name="l00709"></a>00709    t30_terminate(t30state);
<a name="l00710"></a>00710    t38_terminal_release(&amp;t38);
<a name="l00711"></a>00711 
<a name="l00712"></a>00712 disable_t38:
<a name="l00713"></a>00713    <span class="comment">/* if we are not the caller, it&apos;s our job to shut down the T.38</span>
<a name="l00714"></a>00714 <span class="comment">    * session when the FAX transmisson is complete.</span>
<a name="l00715"></a>00715 <span class="comment">    */</span>
<a name="l00716"></a>00716    <span class="keywordflow">if</span> ((s-&gt;<a class="code" href="structfax__session.html#a318db77de0681ea150cb6941bb9e524d">caller_mode</a> == <a class="code" href="app__minivm_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>) &amp;&amp;
<a name="l00717"></a>00717        (<a class="code" href="channel_8h.html#a1b22ea5302ef183fa68bc45bfb0659c9" title="Retrieves the current T38 state of a channel.">ast_channel_get_t38_state</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>) == <a class="code" href="channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1af142c79721a025bd65edad812f0725e0">T38_STATE_NEGOTIATED</a>)) {
<a name="l00718"></a>00718       <span class="keyword">struct </span><a class="code" href="structast__control__t38__parameters.html">ast_control_t38_parameters</a> t38_parameters = { .request_response = <a class="code" href="frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bab75e46d3212a2a886143d874c78a1e3c">AST_T38_REQUEST_TERMINATE</a>, };
<a name="l00719"></a>00719 
<a name="l00720"></a>00720       <span class="keywordflow">if</span> (<a class="code" href="channel_8h.html#aa8c3522af1bc639cbd5b38f5fdf171fa" title="Indicates condition of channel, with payload.">ast_indicate_data</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a7334c9d27a6d70fe7c85b60b864788fc">AST_CONTROL_T38_PARAMETERS</a>, &amp;t38_parameters, <span class="keyword">sizeof</span>(t38_parameters)) == 0) {
<a name="l00721"></a>00721          <span class="comment">/* wait up to five seconds for negotiation to complete */</span>
<a name="l00722"></a>00722          <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> timeout = 5000;
<a name="l00723"></a>00723          <span class="keywordtype">int</span> ms;
<a name="l00724"></a>00724          
<a name="l00725"></a>00725          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Shutting down T.38 on %s\n&quot;</span>, s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;name);
<a name="l00726"></a>00726          <span class="keywordflow">while</span> (timeout &gt; 0) {
<a name="l00727"></a>00727             ms = <a class="code" href="channel_8h.html#a60e0bcaed001e8d5ed1ba0eb2644b3cc" title="Wait for input on a channel.">ast_waitfor</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, 1000);
<a name="l00728"></a>00728             <span class="keywordflow">if</span> (ms &lt; 0) {
<a name="l00729"></a>00729                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;something bad happened while channel &apos;%s&apos; was polling.\n&quot;</span>, s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;name);
<a name="l00730"></a>00730                <span class="keywordflow">return</span> -1;
<a name="l00731"></a>00731             }
<a name="l00732"></a>00732             <span class="keywordflow">if</span> (!ms) {
<a name="l00733"></a>00733                <span class="comment">/* nothing happened */</span>
<a name="l00734"></a>00734                <span class="keywordflow">if</span> (timeout &gt; 0) {
<a name="l00735"></a>00735                   timeout -= 1000;
<a name="l00736"></a>00736                   <span class="keywordflow">continue</span>;
<a name="l00737"></a>00737                } <span class="keywordflow">else</span> {
<a name="l00738"></a>00738                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;channel &apos;%s&apos; timed-out during the T.38 shutdown.\n&quot;</span>, s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;name);
<a name="l00739"></a>00739                   <span class="keywordflow">break</span>;
<a name="l00740"></a>00740                }
<a name="l00741"></a>00741             }
<a name="l00742"></a>00742             <span class="keywordflow">if</span> (!(inf = <a class="code" href="channel_8h.html#a7ef6737309dc9e8b6c4a7cb4800638b1" title="Reads a frame.">ast_read</a>(s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>))) {
<a name="l00743"></a>00743                <span class="keywordflow">return</span> -1;
<a name="l00744"></a>00744             }
<a name="l00745"></a>00745             <span class="keywordflow">if</span> ((inf-&gt;<a class="code" href="structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>) &amp;&amp;
<a name="l00746"></a>00746                 (inf-&gt;<a class="code" href="structast__frame.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> == <a class="code" href="frame_8h.html#aedda41918e992000fe921f8f7363b390a7334c9d27a6d70fe7c85b60b864788fc">AST_CONTROL_T38_PARAMETERS</a>) &amp;&amp;
<a name="l00747"></a>00747                 (inf-&gt;<a class="code" href="structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> == <span class="keyword">sizeof</span>(t38_parameters))) {
<a name="l00748"></a>00748                <span class="keyword">struct </span><a class="code" href="structast__control__t38__parameters.html">ast_control_t38_parameters</a> *parameters = inf-&gt;<a class="code" href="structast__frame.html#a7c81436eb90123aabf892413fc5bf849">data</a>.<a class="code" href="structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>;
<a name="l00749"></a>00749                
<a name="l00750"></a>00750                <span class="keywordflow">switch</span> (parameters-&gt;<a class="code" href="structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a>) {
<a name="l00751"></a>00751                <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4ba9df578b4287c86673d7f40f9abcdc86f">AST_T38_TERMINATED</a>:
<a name="l00752"></a>00752                   <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Shut down T.38 on %s\n&quot;</span>, s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;name);
<a name="l00753"></a>00753                   <span class="keywordflow">break</span>;
<a name="l00754"></a>00754                <span class="keywordflow">case</span> <a class="code" href="frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4baa02b30f25621f20396d06f5ac8aa7a2e">AST_T38_REFUSED</a>:
<a name="l00755"></a>00755                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;channel &apos;%s&apos; refused to disable T.38\n&quot;</span>, s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;name);
<a name="l00756"></a>00756                   <span class="keywordflow">break</span>;
<a name="l00757"></a>00757                <span class="keywordflow">default</span>:
<a name="l00758"></a>00758                   <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;channel &apos;%s&apos; failed to disable T.38\n&quot;</span>, s-&gt;<a class="code" href="structfax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>-&gt;name);
<a name="l00759"></a>00759                   <span class="keywordflow">break</span>;
<a name="l00760"></a>00760                }
<a name="l00761"></a>00761                <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(inf);
<a name="l00762"></a>00762                <span class="keywordflow">break</span>;
<a name="l00763"></a>00763             }
<a name="l00764"></a>00764             <a class="code" href="frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(inf);
<a name="l00765"></a>00765          }
<a name="l00766"></a>00766       }
<a name="l00767"></a>00767    }
<a name="l00768"></a>00768 
<a name="l00769"></a>00769    <span class="keywordflow">return</span> res;
<a name="l00770"></a>00770 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad09fa931f468002152a3cc2d5ce25eae"></a><!-- doxytag: member="app_fax.c::unload_module" ref="ad09fa931f468002152a3cc2d5ce25eae" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int unload_module </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__fax_8c_source.html#l00918">918</a> of file <a class="el" href="app__fax_8c_source.html">app_fax.c</a>.</p>

<p>References <a class="el" href="pbx_8c_source.html#l06403">ast_unregister_application()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00919"></a>00919 {
<a name="l00920"></a>00920    <span class="keywordtype">int</span> res;
<a name="l00921"></a>00921 
<a name="l00922"></a>00922    res = <a class="code" href="module_8h.html#ad2ca15621101154f29748cf1dac3c3cf" title="Unregister an application.">ast_unregister_application</a>(<a class="code" href="app__fax_8c.html#a50df277dcef2198ebac8c57ec43ea107">app_sndfax_name</a>); 
<a name="l00923"></a>00923    res |= <a class="code" href="module_8h.html#ad2ca15621101154f29748cf1dac3c3cf" title="Unregister an application.">ast_unregister_application</a>(<a class="code" href="app__fax_8c.html#a0f3a52db8cfd1cc6ebd327fa6e24c8fb">app_rcvfax_name</a>);   
<a name="l00924"></a>00924 
<a name="l00925"></a>00925    <span class="keywordflow">return</span> res;
<a name="l00926"></a>00926 }
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a0f3a52db8cfd1cc6ebd327fa6e24c8fb"></a><!-- doxytag: member="app_fax.c::app_rcvfax_name" ref="a0f3a52db8cfd1cc6ebd327fa6e24c8fb" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* <a class="el" href="app__fax_8c.html#a0f3a52db8cfd1cc6ebd327fa6e24c8fb">app_rcvfax_name</a> = &quot;ReceiveFAX&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__fax_8c_source.html#l00145">145</a> of file <a class="el" href="app__fax_8c_source.html">app_fax.c</a>.</p>

</div>
</div>
<a class="anchor" id="a50df277dcef2198ebac8c57ec43ea107"></a><!-- doxytag: member="app_fax.c::app_sndfax_name" ref="a50df277dcef2198ebac8c57ec43ea107" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* <a class="el" href="app__fax_8c.html#a50df277dcef2198ebac8c57ec43ea107">app_sndfax_name</a> = &quot;SendFAX&quot;<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="app__fax_8c_source.html#l00144">144</a> of file <a class="el" href="app__fax_8c_source.html">app_fax.c</a>.</p>

</div>
</div>
<a class="anchor" id="a36aeb2eb01afb248bad64a309d743636"></a><!-- doxytag: member="app_fax.c::generator" ref="a36aeb2eb01afb248bad64a309d743636" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__generator.html">ast_generator</a> <a class="el" href="app__fax_8c.html#a36aeb2eb01afb248bad64a309d743636">generator</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> {
   alloc:      <a class="code" href="app__fax_8c.html#a513d7f55172717d523c0ce2216c61f67">fax_generator_alloc</a>,
   generate:   <a class="code" href="app__fax_8c.html#ac366389377300e1304735eb8859a8cb9">fax_generator_generate</a>,
}
</pre></div>
<p>Definition at line <a class="el" href="app__fax_8c_source.html#l00354">354</a> of file <a class="el" href="app__fax_8c_source.html">app_fax.c</a>.</p>

<p>Referenced by <a class="el" href="res__clialiases_8c_source.html#l00080">cli_alias_passthrough()</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:18:56 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
