<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:19:42 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_afe38fc0ccf2e9eefca5d5c6b03503d9.html">main</a>
  </div>
</div>
<div class="contents">
<h1>cdr.c File Reference</h1>
<p>Call Detail Record API.  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="asterisk_8h_source.html">asterisk.h</a>&quot;</code><br/>
<code>#include &lt;signal.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="lock_8h_source.html">asterisk/lock.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="channel_8h_source.html">asterisk/channel.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="cdr_8h_source.html">asterisk/cdr.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="callerid_8h_source.html">asterisk/callerid.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="manager_8h_source.html">asterisk/manager.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="causes_8h_source.html">asterisk/causes.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="linkedlists_8h_source.html">asterisk/linkedlists.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="utils_8h_source.html">asterisk/utils.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="sched_8h_source.html">asterisk/sched.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="config_8h_source.html">asterisk/config.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="cli_8h_source.html">asterisk/cli.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="stringfields_8h_source.html">asterisk/stringfields.h</a>&quot;</code><br/>

<p><a href="cdr_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__cdr__batch.html">ast_cdr_batch</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__cdr__batch__item.html">ast_cdr_batch_item</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__cdr__beitem.html">ast_cdr_beitem</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structbe__list.html">be_list</a></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a7c6e22969cdb4bf720fdc2f0b65eaf5e">BATCH_SAFE_SHUTDOWN_DEFAULT</a>&nbsp;&nbsp;&nbsp;1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#ad79bf40ab0e985aca899df73fd0beada">BATCH_SCHEDULER_ONLY_DEFAULT</a>&nbsp;&nbsp;&nbsp;0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a3d16a049b1043323e8f286d8afae0f5f">BATCH_SIZE_DEFAULT</a>&nbsp;&nbsp;&nbsp;100</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a96cc252b1184015bf237bda67fd0fcd0">BATCH_TIME_DEFAULT</a>&nbsp;&nbsp;&nbsp;300</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__cdr.html">ast_cdr</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a29ba08b358224b4c820e5df826273b5b">ast_cdr_alloc</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Allocate a CDR record.  <a href="#a29ba08b358224b4c820e5df826273b5b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a5c2d2dee484a1ad9dbef128c11a2b693">ast_cdr_amaflags2int</a> (const char *flag)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Convert a string to a detail record AMA flag.  <a href="#a5c2d2dee484a1ad9dbef128c11a2b693"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#afec38ce5d72ac5bfda689d3a2c877012">ast_cdr_answer</a> (struct <a class="el" href="structast__cdr.html">ast_cdr</a> *cdr)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Answer a call.  <a href="#afec38ce5d72ac5bfda689d3a2c877012"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__cdr.html">ast_cdr</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a0a3ae8676893f50922e373323f4298fe">ast_cdr_append</a> (struct <a class="el" href="structast__cdr.html">ast_cdr</a> *cdr, struct <a class="el" href="structast__cdr.html">ast_cdr</a> *newcdr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#aa86055d8e9e2dba6d9cacd21785341ef">ast_cdr_appenduserfield</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *userfield)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Append to CDR <a class="el" href="structuser.html" title="structure to hold users read from users.conf">user</a> field for channel (stored in CDR).  <a href="#aa86055d8e9e2dba6d9cacd21785341ef"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a4df18ef44f74b2dce240ca02a9c22ddf">ast_cdr_busy</a> (struct <a class="el" href="structast__cdr.html">ast_cdr</a> *cdr)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Busy a call.  <a href="#a4df18ef44f74b2dce240ca02a9c22ddf"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#acb23e03edefb3a057b525707ad53d652">ast_cdr_copy_vars</a> (struct <a class="el" href="structast__cdr.html">ast_cdr</a> *to_cdr, struct <a class="el" href="structast__cdr.html">ast_cdr</a> *from_cdr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#aaac5bba86e430704119f70df937701f8">ast_cdr_detach</a> (struct <a class="el" href="structast__cdr.html">ast_cdr</a> *cdr)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Detaches the detail record for posting (and freeing) either now or at a later time in bulk with other records during batch mode operation.  <a href="#aaac5bba86e430704119f70df937701f8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a0a672ffbd29adf8622596a36ccb25e65">ast_cdr_discard</a> (struct <a class="el" href="structast__cdr.html">ast_cdr</a> *cdr)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">the same as a cdr_free call, only with no checks; just get rid of it  <a href="#a0a672ffbd29adf8622596a36ccb25e65"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a625074f8926198c57120460097d6afdf">ast_cdr_disp2str</a> (int disposition)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Disposition to a string.  <a href="#a625074f8926198c57120460097d6afdf"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a5468ad8b7a45f1f976728be1b23dde47">ast_cdr_disposition</a> (struct <a class="el" href="structast__cdr.html">ast_cdr</a> *cdr, int <a class="el" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Save the result of the call based on the AST_CAUSE_*.  <a href="#a5468ad8b7a45f1f976728be1b23dde47"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__cdr.html">ast_cdr</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a7e8acc90934bc4647dd675a251d9e6ab">ast_cdr_dup</a> (struct <a class="el" href="structast__cdr.html">ast_cdr</a> *cdr)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Duplicate a record.  <a href="#a7e8acc90934bc4647dd675a251d9e6ab"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a9884cbdaef20e9f266bc2220772bf52b">ast_cdr_end</a> (struct <a class="el" href="structast__cdr.html">ast_cdr</a> *cdr)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">End a call.  <a href="#a9884cbdaef20e9f266bc2220772bf52b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a6f39a1289d793c9d485fc02f18ce7757">ast_cdr_engine_init</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Load the configuration file cdr.conf and possibly start the CDR scheduling thread.  <a href="#a6f39a1289d793c9d485fc02f18ce7757"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a90fbfcfc99e82f966b5769ba0f08e61c">ast_cdr_engine_reload</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Reload the configuration file cdr.conf and start/stop CDR scheduling thread.  <a href="#a90fbfcfc99e82f966b5769ba0f08e61c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a5634f8ea707fb2fdf87abdd55a539764">ast_cdr_engine_term</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#acdce2d9d0af5180090b70149ce18e554">ast_cdr_failed</a> (struct <a class="el" href="structast__cdr.html">ast_cdr</a> *cdr)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Fail a call.  <a href="#acdce2d9d0af5180090b70149ce18e554"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#ad2282e11ef557755c3a23e386f42d1ba">ast_cdr_flags2str</a> (int flag)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a28b931d52c71271afd601186db95fec2">ast_cdr_free</a> (struct <a class="el" href="structast__cdr.html">ast_cdr</a> *cdr)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Free a CDR record.  <a href="#a28b931d52c71271afd601186db95fec2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a9a823bcb3824753f08351a8ed7a25b6f">ast_cdr_free_vars</a> (struct <a class="el" href="structast__cdr.html">ast_cdr</a> *cdr, int recur)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a7e49e9d173fdc79d0567337f96a648a1">ast_cdr_getvar</a> (struct <a class="el" href="structast__cdr.html">ast_cdr</a> *cdr, const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, char **ret, char *workspace, int workspacelen, int recur, int raw)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a1412f360c07eedbcc9c07e4b4d82c0f0">ast_cdr_getvar_internal</a> (struct <a class="el" href="structast__cdr.html">ast_cdr</a> *cdr, const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, int recur)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a90701b9d1c8300605e8065d03bccad9c">ast_cdr_init</a> (struct <a class="el" href="structast__cdr.html">ast_cdr</a> *cdr, struct <a class="el" href="structast__channel.html">ast_channel</a> *c)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize based on a channel.  <a href="#a90701b9d1c8300605e8065d03bccad9c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a3230b9156b0d5fd8b1bd5b91e8ead303">ast_cdr_isset_unanswered</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a7eb1ff8c700babda50fa4480cf7b4cf3">ast_cdr_merge</a> (struct <a class="el" href="structast__cdr.html">ast_cdr</a> *to, struct <a class="el" href="structast__cdr.html">ast_cdr</a> *from)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Move the non-null data from the "from" cdr to the "to" cdr.  <a href="#a7eb1ff8c700babda50fa4480cf7b4cf3"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a46d2f4a55a1be9b94fef1a87ac3f7fbb">ast_cdr_noanswer</a> (struct <a class="el" href="structast__cdr.html">ast_cdr</a> *cdr)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">A call wasn't answered.  <a href="#a46d2f4a55a1be9b94fef1a87ac3f7fbb"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#abdbcf7f728cbacea0b28bf9c51f99b92">ast_cdr_register</a> (const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, const char *<a class="el" href="channel_8c.html#a710bce51374aba96ab04912897666c35">desc</a>, <a class="el" href="cdr_8h.html#a8073f48d56dc9052d641a320ff20b04a">ast_cdrbe</a> be)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Register a CDR handling engine.  <a href="#abdbcf7f728cbacea0b28bf9c51f99b92"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#adb13319aaaac36b51cb9060ecaae5936">ast_cdr_reset</a> (struct <a class="el" href="structast__cdr.html">ast_cdr</a> *cdr, struct <a class="el" href="structast__flags.html">ast_flags</a> *_flags)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Reset the detail record, optionally posting it first.  <a href="#adb13319aaaac36b51cb9060ecaae5936"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a3e3762a7867ecfa87531598bb8050874">ast_cdr_serialize_variables</a> (struct <a class="el" href="structast__cdr.html">ast_cdr</a> *cdr, struct <a class="el" href="structast__str.html">ast_str</a> **<a class="el" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, char delim, char sep, int recur)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#af6bbc762c1482a5489a761733d785813">ast_cdr_setaccount</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *account)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set account code, will generate AMI event.  <a href="#af6bbc762c1482a5489a761733d785813"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#ad3b2de5366d17e05d07af1c3b9e79d0f">ast_cdr_setamaflags</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *flag)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set AMA flags for channel.  <a href="#ad3b2de5366d17e05d07af1c3b9e79d0f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a011ed5964e136bdd6996e25780f606f0">ast_cdr_setanswer</a> (struct <a class="el" href="structast__cdr.html">ast_cdr</a> *cdr, struct timeval t)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set the answer time for a call.  <a href="#a011ed5964e136bdd6996e25780f606f0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a877162d212a320e7daec6aa7f695e9a8">ast_cdr_setapp</a> (struct <a class="el" href="structast__cdr.html">ast_cdr</a> *cdr, const char *<a class="el" href="res__agi_8c.html#a9e5f57131367eff409b9e0bd7b31aa1a">app</a>, const char *data)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set the last executed application.  <a href="#a877162d212a320e7daec6aa7f695e9a8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#aadbc4ffa5235680927182f70f78df193">ast_cdr_setcid</a> (struct <a class="el" href="structast__cdr.html">ast_cdr</a> *cdr, struct <a class="el" href="structast__channel.html">ast_channel</a> *c)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize based on a channel.  <a href="#aadbc4ffa5235680927182f70f78df193"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a2dcb7d9f1762f0ca1523a62fdd17ab95">ast_cdr_setdestchan</a> (struct <a class="el" href="structast__cdr.html">ast_cdr</a> *cdr, const char *chann)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set the destination channel, if there was one.  <a href="#a2dcb7d9f1762f0ca1523a62fdd17ab95"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#aff06489c0d7a1832949aa8779a9536b5">ast_cdr_setdisposition</a> (struct <a class="el" href="structast__cdr.html">ast_cdr</a> *cdr, long int disposition)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set the disposition for a call.  <a href="#aff06489c0d7a1832949aa8779a9536b5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a6c3458fc19a7e9eb5bdcff22378b30a4">ast_cdr_setuserfield</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *<a class="el" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>, const char *userfield)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set CDR <a class="el" href="structuser.html" title="structure to hold users read from users.conf">user</a> field for channel (stored in CDR).  <a href="#a6c3458fc19a7e9eb5bdcff22378b30a4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#adb921d105e280e28efbfa46160bd9126">ast_cdr_setvar</a> (struct <a class="el" href="structast__cdr.html">ast_cdr</a> *cdr, const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, const char *value, int recur)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a82442ca100e6ee9ccaddc7d8c062fa4c">ast_cdr_specialized_reset</a> (struct <a class="el" href="structast__cdr.html">ast_cdr</a> *cdr, struct <a class="el" href="structast__flags.html">ast_flags</a> *_flags)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#af788ef701483a64b77656f272843bcd4">ast_cdr_start</a> (struct <a class="el" href="structast__cdr.html">ast_cdr</a> *cdr)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Start a call.  <a href="#af788ef701483a64b77656f272843bcd4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a576d4e4095247ebd55de2937b6f8263c">ast_cdr_submit_batch</a> (int do_shutdown)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Spawns (possibly) a new thread to submit a batch of CDRs to the backend <a class="el" href="structengines.html">engines</a>.  <a href="#a576d4e4095247ebd55de2937b6f8263c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a31a2a5a50d025225f13633c95f7bcd4d">ast_cdr_unregister</a> (const char *<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Unregister a CDR handling engine.  <a href="#a31a2a5a50d025225f13633c95f7bcd4d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a02e3ffcb969d44d6deee3edb3b6a51bd">ast_cdr_update</a> (struct <a class="el" href="structast__channel.html">ast_channel</a> *c)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a26ef22f050d742f08715473a63720bb5">cdr_get_tv</a> (struct timeval when, const char *fmt, char *<a class="el" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, int bufsize)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#aaae18c4315dcf269cbbf0d7cd8bb5b9b">cdr_merge_vars</a> (struct <a class="el" href="structast__cdr.html">ast_cdr</a> *to, struct <a class="el" href="structast__cdr.html">ast_cdr</a> *from)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#ac63585622856b623992ab8aeba1a59b0">check_cdr_enabled</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return TRUE if CDR subsystem is enabled.  <a href="#ac63585622856b623992ab8aeba1a59b0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#ab136d9ac92fdcacf14e91c2da770043f">check_post</a> (struct <a class="el" href="structast__cdr.html">ast_cdr</a> *cdr)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">print a warning if cdr already posted  <a href="#ab136d9ac92fdcacf14e91c2da770043f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#ac661a0b8ae11d5cf5cae1e6aa238496b">do_batch_backend_process</a> (void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a871988199d244a254ad19be2ab41d6e8">do_cdr</a> (void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a9024be7cdcbd31ce15acb957deb118cb">do_reload</a> (int reload)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a42f51bfd026479da84c974d890c5c673">handle_cli_status</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#ad4698622c0463583016f314fc86a108f">handle_cli_submit</a> (struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a8ba2f2526d5230859524407aad436361">init_batch</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#ad01956d63583675f04baf543336b7c94">post_cdr</a> (struct <a class="el" href="structast__cdr.html">ast_cdr</a> *cdr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a0165bd3137a70f31dcbe5fb47b5aee2a">reset_batch</a> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#af8a938a22715b2e6549f67efb4da5b14">set_one_cid</a> (struct <a class="el" href="structast__cdr.html">ast_cdr</a> *cdr, struct <a class="el" href="structast__channel.html">ast_channel</a> *c)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a8ba6c6273f321acb2b32dc754163e349">submit_scheduled_batch</a> (const void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a4c3dbfb3f4642138052d447a42753a61">submit_unscheduled_batch</a> (void)</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#aa9efa3b0987da203851c54efb6147ee0">ast_default_accountcode</a> [AST_MAX_ACCOUNT_CODE]</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a40d6ca75f86ae72a310c1cdceab8d345">ast_default_amaflags</a> = AST_CDR_DOCUMENTATION</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__cdr__batch.html">ast_cdr_batch</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#ac47f93001bc6fd919a5a4535f89c9ccd">batch</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a05c758689b70c64711a1789bff29f60c">batchmode</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a4ef34eb96cb5e9029153d7c36e3ce510">batchsafeshutdown</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a2884926c72604cd5790204ed221068a5">batchscheduleronly</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a4333e837bb5d4a34b4bbcbee3fa3f5b5">batchsize</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a60b61b5c8702c288d64ad7bda5cc4a9a">batchtime</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="lock_8h.html#a2d9118a2a8939f115eea771bce3a52f2">ast_mutex_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a3a3969758c60f80011874aadde9d09ca">cdr_batch_lock</a> = ((<a class="el" href="lock_8h.html#a2d9118a2a8939f115eea771bce3a52f2">ast_mutex_t</a>) PTHREAD_MUTEX_INITIALIZER )</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="lock_8h.html#ab134d98cdfe7de0f7a72b377c0765dc7">ast_cond_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a3350735a1fc58db7a559b16073a83a3c">cdr_pending_cond</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="lock_8h.html#a2d9118a2a8939f115eea771bce3a52f2">ast_mutex_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#acde84d468388579851a2de600c75a6e4">cdr_pending_lock</a> = ((<a class="el" href="lock_8h.html#a2d9118a2a8939f115eea771bce3a52f2">ast_mutex_t</a>) PTHREAD_MUTEX_INITIALIZER )</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a62566fff085d3e4fd5843a6b70413ee1">cdr_readonly_vars</a> []</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a4b8b0834379a5c8dd0deaa5161785419">cdr_sched</a> = -1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static pthread_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a1a28dc87e0a897d209ff16ca63bff690">cdr_thread</a> = AST_PTHREADT_NULL</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a2bfbc88e2118d426be7b9ed59d6cf14f">cli_status</a> = AST_CLI_DEFINE(handle_cli_status, &quot;Display the CDR <a class="el" href="app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a>&quot;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a3a189428ccf334b9693c4c4e7a2b94db">cli_submit</a> = AST_CLI_DEFINE(handle_cli_submit, &quot;Posts all pending batched CDR data&quot;)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a03e6cca0c879c0443efb431c30c14f76">enabled</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="structsched__context.html">sched_context</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#aea6233539fc73fc5303bf7525ec27e73">sched</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="cdr_8c.html#a4a1bce7c6dac29f74373744e946a7b9b">unanswered</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Call Detail Record API. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Mark Spencer &lt;<a href="mailto:markster@digium.com">markster@digium.com</a>&gt;</dd></dl>
<dl class="note"><dt><b>Note:</b></dt><dd>Includes code and algorithms from the Zapata library.</dd>
<dd>
We do a lot of checking here in the CDR code to try to be sure we don't ever let a CDR slip through our fingers somehow. If someone allocates a CDR, it must be completely handled normally or a WARNING shall be logged, so that we can best keep track of any escape condition where the CDR isn't properly generated and posted. </dd></dl>

<p>Definition in file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a7c6e22969cdb4bf720fdc2f0b65eaf5e"></a><!-- doxytag: member="cdr.c::BATCH_SAFE_SHUTDOWN_DEFAULT" ref="a7c6e22969cdb4bf720fdc2f0b65eaf5e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BATCH_SAFE_SHUTDOWN_DEFAULT&nbsp;&nbsp;&nbsp;1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00084">84</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l01396">do_reload()</a>.</p>

</div>
</div>
<a class="anchor" id="ad79bf40ab0e985aca899df73fd0beada"></a><!-- doxytag: member="cdr.c::BATCH_SCHEDULER_ONLY_DEFAULT" ref="ad79bf40ab0e985aca899df73fd0beada" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BATCH_SCHEDULER_ONLY_DEFAULT&nbsp;&nbsp;&nbsp;0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00083">83</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l01396">do_reload()</a>.</p>

</div>
</div>
<a class="anchor" id="a3d16a049b1043323e8f286d8afae0f5f"></a><!-- doxytag: member="cdr.c::BATCH_SIZE_DEFAULT" ref="a3d16a049b1043323e8f286d8afae0f5f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BATCH_SIZE_DEFAULT&nbsp;&nbsp;&nbsp;100</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00081">81</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l01396">do_reload()</a>.</p>

</div>
</div>
<a class="anchor" id="a96cc252b1184015bf237bda67fd0fcd0"></a><!-- doxytag: member="cdr.c::BATCH_TIME_DEFAULT" ref="a96cc252b1184015bf237bda67fd0fcd0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BATCH_TIME_DEFAULT&nbsp;&nbsp;&nbsp;300</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00082">82</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l01396">do_reload()</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a29ba08b358224b4c820e5df826273b5b"></a><!-- doxytag: member="cdr.c::ast_cdr_alloc" ref="a29ba08b358224b4c820e5df826273b5b" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__cdr.html">ast_cdr</a>* ast_cdr_alloc </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Allocate a CDR record. </p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>a</em>&nbsp;</td><td>malloc'd <a class="el" href="structast__cdr.html" title="Responsible for call detail data.">ast_cdr</a> structure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>NULL</em>&nbsp;</td><td>on error (malloc failure) </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00452">452</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, and <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>.</p>

<p>Referenced by <a class="el" href="chan__agent_8c_source.html#l00486">__agent_start_monitoring()</a>, <a class="el" href="channel_8c_source.html#l00772">__ast_channel_alloc_ap()</a>, <a class="el" href="channel_8c_source.html#l03851">__ast_request_and_dial()</a>, <a class="el" href="features_8c_source.html#l02441">ast_bridge_call()</a>, <a class="el" href="cdr_8c_source.html#l00168">ast_cdr_dup()</a>, <a class="el" href="features_8c_source.html#l01265">builtin_blindtransfer()</a>, <a class="el" href="app__followme_8c_source.html#l00468">clear_caller()</a>, <a class="el" href="app__followme_8c_source.html#l00777">findmeexec()</a>, and <a class="el" href="res__monitor_8c_source.html#l00495">start_monitor_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00453"></a>00453 {
<a name="l00454"></a>00454    <span class="keyword">struct </span><a class="code" href="structast__cdr.html" title="Responsible for call detail data.">ast_cdr</a> *x;
<a name="l00455"></a>00455    x = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*x));
<a name="l00456"></a>00456    <span class="keywordflow">if</span> (!x)
<a name="l00457"></a>00457       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,<span class="stringliteral">&quot;Allocation Failure for a CDR!\n&quot;</span>);
<a name="l00458"></a>00458    <span class="keywordflow">return</span> x;
<a name="l00459"></a>00459 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5c2d2dee484a1ad9dbef128c11a2b693"></a><!-- doxytag: member="cdr.c::ast_cdr_amaflags2int" ref="a5c2d2dee484a1ad9dbef128c11a2b693" args="(const char *flag)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_cdr_amaflags2int </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>flag</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Convert a string to a detail record AMA flag. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>flag</em>&nbsp;</td><td>string form of flag Converts the string form of the flag to the binary form. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>the binary form of the flag </dd></dl>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l01016">1016</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cdr_8h_source.html#l00057">AST_CDR_BILLING</a>, <a class="el" href="cdr_8h_source.html#l00058">AST_CDR_DOCUMENTATION</a>, and <a class="el" href="cdr_8h_source.html#l00056">AST_CDR_OMIT</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l00955">ast_cdr_setamaflags()</a>, <a class="el" href="chan__unistim_8c_source.html#l04998">build_device()</a>, <a class="el" href="chan__mgcp_8c_source.html#l03552">build_gateway()</a>, <a class="el" href="chan__sip_8c_source.html#l23690">build_peer()</a>, <a class="el" href="chan__h323_8c_source.html#l01360">build_user()</a>, <a class="el" href="chan__skinny_8c_source.html#l06537">config_parse_variables()</a>, <a class="el" href="chan__dahdi_8c_source.html#l16096">process_dahdi()</a>, and <a class="el" href="chan__iax2_8c_source.html#l12493">set_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01017"></a>01017 {
<a name="l01018"></a>01018    <span class="keywordflow">if</span> (!strcasecmp(flag, <span class="stringliteral">&quot;default&quot;</span>))
<a name="l01019"></a>01019       <span class="keywordflow">return</span> 0;
<a name="l01020"></a>01020    <span class="keywordflow">if</span> (!strcasecmp(flag, <span class="stringliteral">&quot;omit&quot;</span>))
<a name="l01021"></a>01021       <span class="keywordflow">return</span> <a class="code" href="cdr_8h.html#ae094e5111c8d95003a870f99fe29f9a5">AST_CDR_OMIT</a>;
<a name="l01022"></a>01022    <span class="keywordflow">if</span> (!strcasecmp(flag, <span class="stringliteral">&quot;billing&quot;</span>))
<a name="l01023"></a>01023       <span class="keywordflow">return</span> <a class="code" href="cdr_8h.html#a04adfa377bc7ec8f853d23de3b1c085b">AST_CDR_BILLING</a>;
<a name="l01024"></a>01024    <span class="keywordflow">if</span> (!strcasecmp(flag, <span class="stringliteral">&quot;documentation&quot;</span>))
<a name="l01025"></a>01025       <span class="keywordflow">return</span> <a class="code" href="cdr_8h.html#a91765929568fa1a9d035317aa084495f">AST_CDR_DOCUMENTATION</a>;
<a name="l01026"></a>01026    <span class="keywordflow">return</span> -1;
<a name="l01027"></a>01027 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="afec38ce5d72ac5bfda689d3a2c877012"></a><!-- doxytag: member="cdr.c::ast_cdr_answer" ref="afec38ce5d72ac5bfda689d3a2c877012" args="(struct ast_cdr *cdr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_cdr_answer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cdr.html">ast_cdr</a> *&nbsp;</td>
          <td class="paramname"> <em>cdr</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Answer a call. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>cdr</em>&nbsp;</td><td>the cdr you wish to associate with the call Starts all CDR stuff necessary for doing CDR when answering a call </td></tr>
  </table>
  </dd>
</dl>
<dl class="note"><dt><b>Note:</b></dt><dd>NULL argument is just fine. </dd></dl>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00687">687</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cdr_8h_source.html#l00089">ast_cdr::answer</a>, <a class="el" href="cdr_8h_source.html#l00051">AST_CDR_ANSWERED</a>, <a class="el" href="cdr_8h_source.html#l00038">AST_CDR_FLAG_ANSLOCKED</a>, <a class="el" href="cdr_8h_source.html#l00039">AST_CDR_FLAG_DONT_TOUCH</a>, <a class="el" href="cdr_8h_source.html#l00032">AST_CDR_FLAG_LOCKED</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="time_8h_source.html#l00099">ast_tvzero()</a>, <a class="el" href="cdr_8c_source.html#l00420">check_post()</a>, <a class="el" href="cdr_8h_source.html#l00097">ast_cdr::disposition</a>, and <a class="el" href="cdr_8h_source.html#l00113">ast_cdr::next</a>.</p>

<p>Referenced by <a class="el" href="features_8c_source.html#l02441">ast_bridge_call()</a>, and <a class="el" href="channel_8c_source.html#l01799">ast_raw_answer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00688"></a>00688 {
<a name="l00689"></a>00689 
<a name="l00690"></a>00690    <span class="keywordflow">for</span> (; cdr; cdr = cdr-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a>) {
<a name="l00691"></a>00691       <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(cdr, <a class="code" href="cdr_8h.html#ad483fcec295471cda6e9ebce6e0c4f24">AST_CDR_FLAG_ANSLOCKED</a>)) 
<a name="l00692"></a>00692          <span class="keywordflow">continue</span>;
<a name="l00693"></a>00693       <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(cdr, <a class="code" href="cdr_8h.html#aaeb04a47ad80222e66f13955fefad532">AST_CDR_FLAG_DONT_TOUCH</a>) &amp;&amp; <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(cdr, <a class="code" href="cdr_8h.html#ad19495bac7dec6a99190f93e21965da6">AST_CDR_FLAG_LOCKED</a>))
<a name="l00694"></a>00694          <span class="keywordflow">continue</span>;
<a name="l00695"></a>00695       <a class="code" href="cdr_8c.html#ab136d9ac92fdcacf14e91c2da770043f" title="print a warning if cdr already posted">check_post</a>(cdr);
<a name="l00696"></a>00696       <span class="keywordflow">if</span> (cdr-&gt;<a class="code" href="structast__cdr.html#a1f9669e5d9d64aa831cd9db2dd71534f">disposition</a> &lt; <a class="code" href="cdr_8h.html#ac7614ef6faaa8b913df85f229f0e037e">AST_CDR_ANSWERED</a>)
<a name="l00697"></a>00697          cdr-&gt;<a class="code" href="structast__cdr.html#a1f9669e5d9d64aa831cd9db2dd71534f">disposition</a> = <a class="code" href="cdr_8h.html#ac7614ef6faaa8b913df85f229f0e037e">AST_CDR_ANSWERED</a>;
<a name="l00698"></a>00698       <span class="keywordflow">if</span> (<a class="code" href="time_8h.html#a1b7c6177ea781fc11512de25805fc144" title="Returns true if the argument is 0,0.">ast_tvzero</a>(cdr-&gt;<a class="code" href="structast__cdr.html#a621c14aed7c59835c5bc93bc88e8f3d9">answer</a>))
<a name="l00699"></a>00699          cdr-&gt;<a class="code" href="structast__cdr.html#a621c14aed7c59835c5bc93bc88e8f3d9">answer</a> = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l00700"></a>00700    }
<a name="l00701"></a>00701 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0a3ae8676893f50922e373323f4298fe"></a><!-- doxytag: member="cdr.c::ast_cdr_append" ref="a0a3ae8676893f50922e373323f4298fe" args="(struct ast_cdr *cdr, struct ast_cdr *newcdr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__cdr.html">ast_cdr</a>* ast_cdr_append </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cdr.html">ast_cdr</a> *&nbsp;</td>
          <td class="paramname"> <em>cdr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cdr.html">ast_cdr</a> *&nbsp;</td>
          <td class="paramname"> <em>newcdr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cdr_8c_source.html#l01129">1129</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cdr_8h_source.html#l00113">ast_cdr::next</a>.</p>

<p>Referenced by <a class="el" href="app__forkcdr_8c_source.html#l00176">ast_cdr_fork()</a>, <a class="el" href="cdr_8c_source.html#l00496">ast_cdr_merge()</a>, and <a class="el" href="chan__unistim_8c_source.html#l01883">attempt_transfer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01130"></a>01130 {
<a name="l01131"></a>01131    <span class="keyword">struct </span><a class="code" href="structast__cdr.html" title="Responsible for call detail data.">ast_cdr</a> *ret;
<a name="l01132"></a>01132 
<a name="l01133"></a>01133    <span class="keywordflow">if</span> (cdr) {
<a name="l01134"></a>01134       ret = cdr;
<a name="l01135"></a>01135 
<a name="l01136"></a>01136       <span class="keywordflow">while</span> (cdr-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a>)
<a name="l01137"></a>01137          cdr = cdr-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a>;
<a name="l01138"></a>01138       cdr-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a> = newcdr;
<a name="l01139"></a>01139    } <span class="keywordflow">else</span> {
<a name="l01140"></a>01140       ret = newcdr;
<a name="l01141"></a>01141    }
<a name="l01142"></a>01142 
<a name="l01143"></a>01143    <span class="keywordflow">return</span> ret;
<a name="l01144"></a>01144 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa86055d8e9e2dba6d9cacd21785341ef"></a><!-- doxytag: member="cdr.c::ast_cdr_appenduserfield" ref="aa86055d8e9e2dba6d9cacd21785341ef" args="(struct ast_channel *chan, const char *userfield)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_cdr_appenduserfield </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>userfield</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Append to CDR <a class="el" href="structuser.html" title="structure to hold users read from users.conf">user</a> field for channel (stored in CDR). </p>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00982">982</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cdr_8h_source.html#l00032">AST_CDR_FLAG_LOCKED</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="channel_8h_source.html#l00422">ast_channel::cdr</a>, <a class="el" href="func__strings_8c_source.html#l00821">len()</a>, <a class="el" href="cdr_8h_source.html#l00113">ast_cdr::next</a>, and <a class="el" href="cdr_8h_source.html#l00108">ast_cdr::userfield</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00983"></a>00983 {
<a name="l00984"></a>00984    <span class="keyword">struct </span><a class="code" href="structast__cdr.html" title="Responsible for call detail data.">ast_cdr</a> *cdr = chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>;
<a name="l00985"></a>00985 
<a name="l00986"></a>00986    <span class="keywordflow">for</span> ( ; cdr ; cdr = cdr-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a>) {
<a name="l00987"></a>00987       <span class="keywordtype">int</span> <a class="code" href="func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> = strlen(cdr-&gt;<a class="code" href="structast__cdr.html#a2d480b13820a3a97582a1a138036aa25">userfield</a>);
<a name="l00988"></a>00988 
<a name="l00989"></a>00989       <span class="keywordflow">if</span> (!<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(cdr, <a class="code" href="cdr_8h.html#ad19495bac7dec6a99190f93e21965da6">AST_CDR_FLAG_LOCKED</a>))
<a name="l00990"></a>00990          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(cdr-&gt;<a class="code" href="structast__cdr.html#a2d480b13820a3a97582a1a138036aa25">userfield</a> + len, <a class="code" href="structast__cdr.html#a2d480b13820a3a97582a1a138036aa25">userfield</a>, <span class="keyword">sizeof</span>(cdr-&gt;<a class="code" href="structast__cdr.html#a2d480b13820a3a97582a1a138036aa25">userfield</a>) - len);
<a name="l00991"></a>00991    }
<a name="l00992"></a>00992 
<a name="l00993"></a>00993    <span class="keywordflow">return</span> 0;
<a name="l00994"></a>00994 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4df18ef44f74b2dce240ca02a9c22ddf"></a><!-- doxytag: member="cdr.c::ast_cdr_busy" ref="a4df18ef44f74b2dce240ca02a9c22ddf" args="(struct ast_cdr *cdr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_cdr_busy </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cdr.html">ast_cdr</a> *&nbsp;</td>
          <td class="paramname"> <em>cdr</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Busy a call. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>cdr</em>&nbsp;</td><td>the cdr you wish to associate with the call Marks the channel disposition as "BUSY" Will skip CDR's in chain with ANS_LOCK bit set. (see forkCDR() application. Returns nothing </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00703">703</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cdr_8h_source.html#l00050">AST_CDR_BUSY</a>, <a class="el" href="cdr_8h_source.html#l00032">AST_CDR_FLAG_LOCKED</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="cdr_8c_source.html#l00420">check_post()</a>, <a class="el" href="cdr_8h_source.html#l00097">ast_cdr::disposition</a>, and <a class="el" href="cdr_8h_source.html#l00113">ast_cdr::next</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l00746">ast_cdr_disposition()</a>, <a class="el" href="app__dial_8c_source.html#l00607">handle_cause()</a>, <a class="el" href="pbx_8c_source.html#l08474">pbx_builtin_busy()</a>, <a class="el" href="app__queue_8c_source.html#l02467">ring_entry()</a>, and <a class="el" href="app__queue_8c_source.html#l02845">wait_for_answer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00704"></a>00704 {
<a name="l00705"></a>00705 
<a name="l00706"></a>00706    <span class="keywordflow">for</span> (; cdr; cdr = cdr-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a>) {
<a name="l00707"></a>00707       <span class="keywordflow">if</span> (!<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(cdr, <a class="code" href="cdr_8h.html#ad19495bac7dec6a99190f93e21965da6">AST_CDR_FLAG_LOCKED</a>)) {
<a name="l00708"></a>00708          <a class="code" href="cdr_8c.html#ab136d9ac92fdcacf14e91c2da770043f" title="print a warning if cdr already posted">check_post</a>(cdr);
<a name="l00709"></a>00709          <span class="keywordflow">if</span> (cdr-&gt;<a class="code" href="structast__cdr.html#a1f9669e5d9d64aa831cd9db2dd71534f">disposition</a> &lt; <a class="code" href="cdr_8h.html#ae966b02bd2ee3ce2564497ae87a36c4c">AST_CDR_BUSY</a>)
<a name="l00710"></a>00710             cdr-&gt;<a class="code" href="structast__cdr.html#a1f9669e5d9d64aa831cd9db2dd71534f">disposition</a> = <a class="code" href="cdr_8h.html#ae966b02bd2ee3ce2564497ae87a36c4c">AST_CDR_BUSY</a>;
<a name="l00711"></a>00711       }
<a name="l00712"></a>00712    }
<a name="l00713"></a>00713 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="acb23e03edefb3a057b525707ad53d652"></a><!-- doxytag: member="cdr.c::ast_cdr_copy_vars" ref="acb23e03edefb3a057b525707ad53d652" args="(struct ast_cdr *to_cdr, struct ast_cdr *from_cdr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_cdr_copy_vars </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cdr.html">ast_cdr</a> *&nbsp;</td>
          <td class="paramname"> <em>to_cdr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cdr.html">ast_cdr</a> *&nbsp;</td>
          <td class="paramname"> <em>from_cdr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00336">336</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00695">AST_LIST_INSERT_HEAD</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="chanvars_8c_source.html#l00037">ast_var_assign()</a>, <a class="el" href="chanvars_8c_source.html#l00065">ast_var_name()</a>, <a class="el" href="chanvars_8c_source.html#l00085">ast_var_value()</a>, <a class="el" href="ast__expr2f_8c_source.html#l00613">var</a>, and <a class="el" href="cdr_8h_source.html#l00111">ast_cdr::varshead</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l00168">ast_cdr_dup()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00337"></a>00337 {
<a name="l00338"></a>00338    <span class="keyword">struct </span><a class="code" href="structast__var__t.html">ast_var_t</a> *variables, *newvariable = NULL;
<a name="l00339"></a>00339    <span class="keyword">struct </span>varshead *headpa, *headpb;
<a name="l00340"></a>00340    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>, *<a class="code" href="structval.html">val</a>;
<a name="l00341"></a>00341    <span class="keywordtype">int</span> x = 0;
<a name="l00342"></a>00342 
<a name="l00343"></a>00343    <span class="keywordflow">if</span> (!to_cdr || !from_cdr) <span class="comment">/* don&apos;t die if one of the pointers is null */</span>
<a name="l00344"></a>00344       <span class="keywordflow">return</span> 0;
<a name="l00345"></a>00345 
<a name="l00346"></a>00346    headpa = &amp;from_cdr-&gt;<a class="code" href="structast__cdr.html#a9ffb22045a8f14bef8f2137cd779ab25">varshead</a>;
<a name="l00347"></a>00347    headpb = &amp;to_cdr-&gt;<a class="code" href="structast__cdr.html#a9ffb22045a8f14bef8f2137cd779ab25">varshead</a>;
<a name="l00348"></a>00348 
<a name="l00349"></a>00349    <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(headpa,variables,entries) {
<a name="l00350"></a>00350       <span class="keywordflow">if</span> (variables &amp;&amp;
<a name="l00351"></a>00351           (var = <a class="code" href="chanvars_8h.html#a356a31cd608ec07d3668dcd589be49d8">ast_var_name</a>(variables)) &amp;&amp; (val = <a class="code" href="chanvars_8h.html#a8e0081172db71c5021d20706c50d959c">ast_var_value</a>(variables)) &amp;&amp;
<a name="l00352"></a>00352           !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(var) &amp;&amp; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(val)) {
<a name="l00353"></a>00353          newvariable = <a class="code" href="chanvars_8h.html#a8ea2b5a29fa275115c7ed27a593b727d">ast_var_assign</a>(var, val);
<a name="l00354"></a>00354          <a class="code" href="linkedlists_8h.html#aa2ded2af046bb513f77056c27c083307" title="Inserts a list entry at the head of a list.">AST_LIST_INSERT_HEAD</a>(headpb, newvariable, entries);
<a name="l00355"></a>00355          x++;
<a name="l00356"></a>00356       }
<a name="l00357"></a>00357    }
<a name="l00358"></a>00358 
<a name="l00359"></a>00359    <span class="keywordflow">return</span> x;
<a name="l00360"></a>00360 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aaac5bba86e430704119f70df937701f8"></a><!-- doxytag: member="cdr.c::ast_cdr_detach" ref="aaac5bba86e430704119f70df937701f8" args="(struct ast_cdr *cdr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_cdr_detach </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cdr.html">ast_cdr</a> *&nbsp;</td>
          <td class="paramname"> <em>cdr</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Detaches the detail record for posting (and freeing) either now or at a later time in bulk with other records during batch mode operation. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>cdr</em>&nbsp;</td><td>Which CDR to detach from the channel thread Prevents the channel thread from blocking on the CDR handling Returns nothing </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l01234">1234</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="cdr_8h_source.html#l00034">AST_CDR_FLAG_POST_DISABLED</a>, <a class="el" href="cdr_8c_source.html#l00428">ast_cdr_free()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="utils_8h_source.html#l00068">ast_set_flag</a>, <a class="el" href="cdr_8c.html#ac47f93001bc6fd919a5a4535f89c9ccd">batch</a>, <a class="el" href="cdr_8c_source.html#l00088">batchmode</a>, <a class="el" href="cdr_8c_source.html#l00089">batchsize</a>, <a class="el" href="cdr_8c_source.html#l00067">ast_cdr_batch_item::cdr</a>, <a class="el" href="cdr_8c_source.html#l00094">cdr_batch_lock</a>, <a class="el" href="cdr_8c_source.html#l00086">enabled</a>, <a class="el" href="cdr_8c_source.html#l00073">ast_cdr_batch::head</a>, <a class="el" href="cdr_8c_source.html#l01155">init_batch()</a>, <a class="el" href="cdr_8c_source.html#l00068">ast_cdr_batch_item::next</a>, <a class="el" href="cdr_8c_source.html#l01029">post_cdr()</a>, <a class="el" href="cdr_8c_source.html#l00072">ast_cdr_batch::size</a>, <a class="el" href="cdr_8c_source.html#l01222">submit_unscheduled_batch()</a>, and <a class="el" href="cdr_8c_source.html#l00074">ast_cdr_batch::tail</a>.</p>

<p>Referenced by <a class="el" href="features_8c_source.html#l02441">ast_bridge_call()</a>, <a class="el" href="cdr_8c_source.html#l01062">ast_cdr_reset()</a>, <a class="el" href="channel_8c_source.html#l01690">ast_hangup()</a>, and <a class="el" href="pbx_8c_source.html#l07914">ast_pbx_outgoing_cdr_failed()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01235"></a>01235 {
<a name="l01236"></a>01236    <span class="keyword">struct </span><a class="code" href="structast__cdr__batch__item.html">ast_cdr_batch_item</a> *newtail;
<a name="l01237"></a>01237    <span class="keywordtype">int</span> curr;
<a name="l01238"></a>01238 
<a name="l01239"></a>01239    <span class="keywordflow">if</span> (!cdr)
<a name="l01240"></a>01240       <span class="keywordflow">return</span>;
<a name="l01241"></a>01241 
<a name="l01242"></a>01242    <span class="comment">/* maybe they disabled CDR stuff completely, so just drop it */</span>
<a name="l01243"></a>01243    <span class="keywordflow">if</span> (!<a class="code" href="cdr_8c.html#a03e6cca0c879c0443efb431c30c14f76">enabled</a>) {
<a name="l01244"></a>01244       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Dropping CDR !\n&quot;</span>);
<a name="l01245"></a>01245       <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(cdr, <a class="code" href="cdr_8h.html#ad1c97f787a4ae3481dd9b48fef118572">AST_CDR_FLAG_POST_DISABLED</a>);
<a name="l01246"></a>01246       <a class="code" href="cdr_8h.html#a28b931d52c71271afd601186db95fec2" title="Free a CDR record.">ast_cdr_free</a>(cdr);
<a name="l01247"></a>01247       <span class="keywordflow">return</span>;
<a name="l01248"></a>01248    }
<a name="l01249"></a>01249 
<a name="l01250"></a>01250    <span class="comment">/* post stuff immediately if we are not in batch mode, this is legacy behaviour */</span>
<a name="l01251"></a>01251    <span class="keywordflow">if</span> (!<a class="code" href="cdr_8c.html#a05c758689b70c64711a1789bff29f60c">batchmode</a>) {
<a name="l01252"></a>01252       <a class="code" href="cdr_8c.html#ad01956d63583675f04baf543336b7c94">post_cdr</a>(cdr);
<a name="l01253"></a>01253       <a class="code" href="cdr_8h.html#a28b931d52c71271afd601186db95fec2" title="Free a CDR record.">ast_cdr_free</a>(cdr);
<a name="l01254"></a>01254       <span class="keywordflow">return</span>;
<a name="l01255"></a>01255    }
<a name="l01256"></a>01256 
<a name="l01257"></a>01257    <span class="comment">/* otherwise, each CDR gets put into a batch list (at the end) */</span>
<a name="l01258"></a>01258    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;CDR detaching from this thread\n&quot;</span>);
<a name="l01259"></a>01259 
<a name="l01260"></a>01260    <span class="comment">/* we&apos;ll need a new tail for every CDR */</span>
<a name="l01261"></a>01261    <span class="keywordflow">if</span> (!(newtail = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*newtail)))) {
<a name="l01262"></a>01262       <a class="code" href="cdr_8c.html#ad01956d63583675f04baf543336b7c94">post_cdr</a>(cdr);
<a name="l01263"></a>01263       <a class="code" href="cdr_8h.html#a28b931d52c71271afd601186db95fec2" title="Free a CDR record.">ast_cdr_free</a>(cdr);
<a name="l01264"></a>01264       <span class="keywordflow">return</span>;
<a name="l01265"></a>01265    }
<a name="l01266"></a>01266 
<a name="l01267"></a>01267    <span class="comment">/* don&apos;t traverse a whole list (just keep track of the tail) */</span>
<a name="l01268"></a>01268    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;<a class="code" href="cdr_8c.html#a3a3969758c60f80011874aadde9d09ca">cdr_batch_lock</a>);
<a name="l01269"></a>01269    <span class="keywordflow">if</span> (!<a class="code" href="cdr_8c.html#ac47f93001bc6fd919a5a4535f89c9ccd">batch</a>)
<a name="l01270"></a>01270       <a class="code" href="cdr_8c.html#a8ba2f2526d5230859524407aad436361">init_batch</a>();
<a name="l01271"></a>01271    <span class="keywordflow">if</span> (!<a class="code" href="cdr_8c.html#ac47f93001bc6fd919a5a4535f89c9ccd">batch</a>-&gt;<a class="code" href="structast__cdr__batch.html#aca71efae726094060905e37e306dd322">head</a>) {
<a name="l01272"></a>01272       <span class="comment">/* new batch is empty, so point the head at the new tail */</span>
<a name="l01273"></a>01273       <a class="code" href="cdr_8c.html#ac47f93001bc6fd919a5a4535f89c9ccd">batch</a>-&gt;<a class="code" href="structast__cdr__batch.html#aca71efae726094060905e37e306dd322">head</a> = newtail;
<a name="l01274"></a>01274    } <span class="keywordflow">else</span> {
<a name="l01275"></a>01275       <span class="comment">/* already got a batch with something in it, so just append a new tail */</span>
<a name="l01276"></a>01276       <a class="code" href="cdr_8c.html#ac47f93001bc6fd919a5a4535f89c9ccd">batch</a>-&gt;<a class="code" href="structast__cdr__batch.html#a374810230f45e60856c9704a4208db3a">tail</a>-&gt;<a class="code" href="structast__cdr__batch__item.html#ab2c99c077caefd3c06547dcca0878b97">next</a> = newtail;
<a name="l01277"></a>01277    }
<a name="l01278"></a>01278    newtail-&gt;<a class="code" href="structast__cdr__batch__item.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a> = cdr;
<a name="l01279"></a>01279    <a class="code" href="cdr_8c.html#ac47f93001bc6fd919a5a4535f89c9ccd">batch</a>-&gt;<a class="code" href="structast__cdr__batch.html#a374810230f45e60856c9704a4208db3a">tail</a> = newtail;
<a name="l01280"></a>01280    curr = <a class="code" href="cdr_8c.html#ac47f93001bc6fd919a5a4535f89c9ccd">batch</a>-&gt;<a class="code" href="structast__cdr__batch.html#a439227feff9d7f55384e8780cfc2eb82">size</a>++;
<a name="l01281"></a>01281    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="cdr_8c.html#a3a3969758c60f80011874aadde9d09ca">cdr_batch_lock</a>);
<a name="l01282"></a>01282 
<a name="l01283"></a>01283    <span class="comment">/* if we have enough stuff to post, then do it */</span>
<a name="l01284"></a>01284    <span class="keywordflow">if</span> (curr &gt;= (<a class="code" href="cdr_8c.html#a4333e837bb5d4a34b4bbcbee3fa3f5b5">batchsize</a> - 1))
<a name="l01285"></a>01285       <a class="code" href="cdr_8c.html#a4c3dbfb3f4642138052d447a42753a61">submit_unscheduled_batch</a>();
<a name="l01286"></a>01286 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0a672ffbd29adf8622596a36ccb25e65"></a><!-- doxytag: member="cdr.c::ast_cdr_discard" ref="a0a672ffbd29adf8622596a36ccb25e65" args="(struct ast_cdr *cdr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_cdr_discard </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cdr.html">ast_cdr</a> *&nbsp;</td>
          <td class="paramname"> <em>cdr</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>the same as a cdr_free call, only with no checks; just get rid of it </p>
<p>Discard and free a CDR record. </p>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00441">441</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cdr_8c_source.html#l00407">ast_cdr_free_vars()</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="cdr_8h_source.html#l00113">ast_cdr::next</a>, and <a class="el" href="cdr_8c_source.html#l00061">ast_cdr_beitem::next</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l07344">ast_async_goto()</a>, <a class="el" href="features_8c_source.html#l02441">ast_bridge_call()</a>, <a class="el" href="cdr_8c_source.html#l00496">ast_cdr_merge()</a>, and <a class="el" href="channel_8c_source.html#l01388">ast_channel_free()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00442"></a>00442 {
<a name="l00443"></a>00443    <span class="keywordflow">while</span> (cdr) {
<a name="l00444"></a>00444       <span class="keyword">struct </span><a class="code" href="structast__cdr.html" title="Responsible for call detail data.">ast_cdr</a> *<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a> = cdr-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a>;
<a name="l00445"></a>00445 
<a name="l00446"></a>00446       <a class="code" href="cdr_8h.html#a9a823bcb3824753f08351a8ed7a25b6f">ast_cdr_free_vars</a>(cdr, 0);
<a name="l00447"></a>00447       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(cdr);
<a name="l00448"></a>00448       cdr = next;
<a name="l00449"></a>00449    }
<a name="l00450"></a>00450 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a625074f8926198c57120460097d6afdf"></a><!-- doxytag: member="cdr.c::ast_cdr_disp2str" ref="a625074f8926198c57120460097d6afdf" args="(int disposition)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* ast_cdr_disp2str </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>disposition</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Disposition to a string. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>disposition</em>&nbsp;</td><td>input binary form Converts the binary form of a disposition to string form. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>a pointer to the string form </dd></dl>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00905">905</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cdr_8h_source.html#l00051">AST_CDR_ANSWERED</a>, <a class="el" href="cdr_8h_source.html#l00050">AST_CDR_BUSY</a>, <a class="el" href="cdr_8h_source.html#l00049">AST_CDR_FAILED</a>, <a class="el" href="cdr_8h_source.html#l00047">AST_CDR_NOANSWER</a>, and <a class="el" href="cdr_8h_source.html#l00048">AST_CDR_NULL</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l00219">ast_cdr_getvar()</a>, <a class="el" href="cdr__csv_8c_source.html#l00200">build_csv_record()</a>, <a class="el" href="cdr__radius_8c_source.html#l00090">build_radius_record()</a>, <a class="el" href="cdr__csv_8c_source.html#l00279">csv_log()</a>, <a class="el" href="cdr__odbc_8c_source.html#l00062">execute_cb()</a>, <a class="el" href="cdr__manager_8c_source.html#l00134">manager_log()</a>, and <a class="el" href="cdr__tds_8c_source.html#l00111">tds_log()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00906"></a>00906 {
<a name="l00907"></a>00907    <span class="keywordflow">switch</span> (<a class="code" href="structast__cdr.html#a1f9669e5d9d64aa831cd9db2dd71534f">disposition</a>) {
<a name="l00908"></a>00908    <span class="keywordflow">case</span> <a class="code" href="cdr_8h.html#af20894acc82ed87553fc81355890f152">AST_CDR_NULL</a>:
<a name="l00909"></a>00909       <span class="keywordflow">return</span> <span class="stringliteral">&quot;NO ANSWER&quot;</span>; <span class="comment">/* by default, for backward compatibility */</span>
<a name="l00910"></a>00910    <span class="keywordflow">case</span> <a class="code" href="cdr_8h.html#a2fcd4015b8151a5656489fcfe45409be">AST_CDR_NOANSWER</a>:
<a name="l00911"></a>00911       <span class="keywordflow">return</span> <span class="stringliteral">&quot;NO ANSWER&quot;</span>;
<a name="l00912"></a>00912    <span class="keywordflow">case</span> <a class="code" href="cdr_8h.html#aca4e8985f1977038cb5f536fbeec437b">AST_CDR_FAILED</a>:
<a name="l00913"></a>00913       <span class="keywordflow">return</span> <span class="stringliteral">&quot;FAILED&quot;</span>;     
<a name="l00914"></a>00914    <span class="keywordflow">case</span> <a class="code" href="cdr_8h.html#ae966b02bd2ee3ce2564497ae87a36c4c">AST_CDR_BUSY</a>:
<a name="l00915"></a>00915       <span class="keywordflow">return</span> <span class="stringliteral">&quot;BUSY&quot;</span>;    
<a name="l00916"></a>00916    <span class="keywordflow">case</span> <a class="code" href="cdr_8h.html#ac7614ef6faaa8b913df85f229f0e037e">AST_CDR_ANSWERED</a>:
<a name="l00917"></a>00917       <span class="keywordflow">return</span> <span class="stringliteral">&quot;ANSWERED&quot;</span>;
<a name="l00918"></a>00918    }
<a name="l00919"></a>00919    <span class="keywordflow">return</span> <span class="stringliteral">&quot;UNKNOWN&quot;</span>;
<a name="l00920"></a>00920 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5468ad8b7a45f1f976728be1b23dde47"></a><!-- doxytag: member="cdr.c::ast_cdr_disposition" ref="a5468ad8b7a45f1f976728be1b23dde47" args="(struct ast_cdr *cdr, int cause)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_cdr_disposition </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cdr.html">ast_cdr</a> *&nbsp;</td>
          <td class="paramname"> <em>cdr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cause</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Save the result of the call based on the AST_CAUSE_*. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>cdr</em>&nbsp;</td><td>the cdr you wish to associate with the call </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>cause</em>&nbsp;</td><td>the AST_CAUSE_* Returns nothing </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00746">746</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="causes_8h_source.html#l00147">AST_CAUSE_BUSY</a>, <a class="el" href="causes_8h_source.html#l00105">AST_CAUSE_NO_ANSWER</a>, <a class="el" href="causes_8h_source.html#l00149">AST_CAUSE_NORMAL</a>, <a class="el" href="cdr_8c_source.html#l00703">ast_cdr_busy()</a>, <a class="el" href="cdr_8c_source.html#l00727">ast_cdr_noanswer()</a>, and <a class="el" href="cdr_8h_source.html#l00113">ast_cdr::next</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l03851">__ast_request_and_dial()</a>, <a class="el" href="pbx_8c_source.html#l08106">ast_pbx_outgoing_app()</a>, <a class="el" href="pbx_8c_source.html#l07940">ast_pbx_outgoing_exten()</a>, <a class="el" href="app__followme_8c_source.html#l00468">clear_caller()</a>, and <a class="el" href="app__followme_8c_source.html#l00777">findmeexec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00747"></a>00747 {
<a name="l00748"></a>00748    <span class="keywordtype">int</span> res = 0;
<a name="l00749"></a>00749 
<a name="l00750"></a>00750    <span class="keywordflow">for</span> (; cdr; cdr = cdr-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a>) {
<a name="l00751"></a>00751       <span class="keywordflow">switch</span> (<a class="code" href="channel_8c.html#aa4d0ccb9d0904892652f2f258c5ad225">cause</a>) {  <span class="comment">/* handle all the non failure, busy cases, return 0 not to set disposition,</span>
<a name="l00752"></a>00752 <span class="comment">                     return -1 to set disposition to FAILED */</span>
<a name="l00753"></a>00753       <span class="keywordflow">case</span> <a class="code" href="causes_8h.html#ae009c193522491f7de7ea28b23f20868">AST_CAUSE_BUSY</a>:
<a name="l00754"></a>00754          <a class="code" href="cdr_8h.html#a4df18ef44f74b2dce240ca02a9c22ddf" title="Busy a call.">ast_cdr_busy</a>(cdr);
<a name="l00755"></a>00755          <span class="keywordflow">break</span>;
<a name="l00756"></a>00756       <span class="keywordflow">case</span> <a class="code" href="causes_8h.html#af03fc9fe2f0ecc69330e014aff8d0f73">AST_CAUSE_NO_ANSWER</a>:
<a name="l00757"></a>00757          <a class="code" href="cdr_8h.html#a46d2f4a55a1be9b94fef1a87ac3f7fbb" title="A call wasn&amp;#39;t answered.">ast_cdr_noanswer</a>(cdr);
<a name="l00758"></a>00758          <span class="keywordflow">break</span>;
<a name="l00759"></a>00759       <span class="keywordflow">case</span> <a class="code" href="causes_8h.html#a7858ab2ba4858d98e29f0ea54980313c">AST_CAUSE_NORMAL</a>:
<a name="l00760"></a>00760          <span class="keywordflow">break</span>;
<a name="l00761"></a>00761       <span class="keywordflow">default</span>:
<a name="l00762"></a>00762          res = -1;
<a name="l00763"></a>00763       }
<a name="l00764"></a>00764    }
<a name="l00765"></a>00765    <span class="keywordflow">return</span> res;
<a name="l00766"></a>00766 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7e8acc90934bc4647dd675a251d9e6ab"></a><!-- doxytag: member="cdr.c::ast_cdr_dup" ref="a7e8acc90934bc4647dd675a251d9e6ab" args="(struct ast_cdr *cdr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__cdr.html">ast_cdr</a>* ast_cdr_dup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cdr.html">ast_cdr</a> *&nbsp;</td>
          <td class="paramname"> <em>cdr</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Duplicate a record. </p>
<p>Duplicate a CDR record </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>Pointer to new CDR record </dd></dl>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00168">168</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cdr_8c_source.html#l00452">ast_cdr_alloc()</a>, <a class="el" href="cdr_8c_source.html#l00336">ast_cdr_copy_vars()</a>, <a class="el" href="cdr_8h_source.html#l00113">ast_cdr::next</a>, and <a class="el" href="cdr_8h_source.html#l00111">ast_cdr::varshead</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l07344">ast_async_goto()</a>, <a class="el" href="features_8c_source.html#l02441">ast_bridge_call()</a>, <a class="el" href="app__forkcdr_8c_source.html#l00176">ast_cdr_fork()</a>, <a class="el" href="cdr_8c_source.html#l00496">ast_cdr_merge()</a>, and <a class="el" href="cdr_8c_source.html#l01062">ast_cdr_reset()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00169"></a>00169 {
<a name="l00170"></a>00170    <span class="keyword">struct </span><a class="code" href="structast__cdr.html" title="Responsible for call detail data.">ast_cdr</a> *newcdr;
<a name="l00171"></a>00171    
<a name="l00172"></a>00172    <span class="keywordflow">if</span> (!cdr) <span class="comment">/* don&apos;t die if we get a null cdr pointer */</span>
<a name="l00173"></a>00173       <span class="keywordflow">return</span> NULL;
<a name="l00174"></a>00174    newcdr = <a class="code" href="cdr_8h.html#a29ba08b358224b4c820e5df826273b5b" title="Allocate a CDR record.">ast_cdr_alloc</a>();
<a name="l00175"></a>00175    <span class="keywordflow">if</span> (!newcdr)
<a name="l00176"></a>00176       <span class="keywordflow">return</span> NULL;
<a name="l00177"></a>00177 
<a name="l00178"></a>00178    memcpy(newcdr, cdr, <span class="keyword">sizeof</span>(*newcdr));
<a name="l00179"></a>00179    <span class="comment">/* The varshead is unusable, volatile even, after the memcpy so we take care of that here */</span>
<a name="l00180"></a>00180    memset(&amp;newcdr-&gt;<a class="code" href="structast__cdr.html#a9ffb22045a8f14bef8f2137cd779ab25">varshead</a>, 0, <span class="keyword">sizeof</span>(newcdr-&gt;<a class="code" href="structast__cdr.html#a9ffb22045a8f14bef8f2137cd779ab25">varshead</a>));
<a name="l00181"></a>00181    <a class="code" href="cdr_8h.html#acb23e03edefb3a057b525707ad53d652">ast_cdr_copy_vars</a>(newcdr, cdr);
<a name="l00182"></a>00182    newcdr-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a> = NULL;
<a name="l00183"></a>00183 
<a name="l00184"></a>00184    <span class="keywordflow">return</span> newcdr;
<a name="l00185"></a>00185 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9884cbdaef20e9f266bc2220772bf52b"></a><!-- doxytag: member="cdr.c::ast_cdr_end" ref="a9884cbdaef20e9f266bc2220772bf52b" args="(struct ast_cdr *cdr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_cdr_end </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cdr.html">ast_cdr</a> *&nbsp;</td>
          <td class="paramname"> <em>cdr</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>End a call. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>cdr</em>&nbsp;</td><td>the cdr you have associated the call with Registers the end of call time in the cdr structure. Returns nothing </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00879">879</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cdr_8h_source.html#l00089">ast_cdr::answer</a>, <a class="el" href="cdr_8h_source.html#l00051">AST_CDR_ANSWERED</a>, <a class="el" href="cdr_8h_source.html#l00049">AST_CDR_FAILED</a>, <a class="el" href="cdr_8h_source.html#l00039">AST_CDR_FLAG_DONT_TOUCH</a>, <a class="el" href="cdr_8h_source.html#l00032">AST_CDR_FLAG_LOCKED</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="options_8h_source.html#l00088">AST_OPT_FLAG_INITIATED_SECONDS</a>, <a class="el" href="asterisk_8c_source.html#l00171">ast_options</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="time_8h_source.html#l00099">ast_tvzero()</a>, <a class="el" href="cdr_8h_source.html#l00095">ast_cdr::billsec</a>, <a class="el" href="cdr_8h_source.html#l00079">ast_cdr::channel</a>, <a class="el" href="cdr_8c_source.html#l00420">check_post()</a>, <a class="el" href="cdr_8h_source.html#l00097">ast_cdr::disposition</a>, <a class="el" href="cdr_8h_source.html#l00093">ast_cdr::duration</a>, <a class="el" href="cdr_8h_source.html#l00091">ast_cdr::end</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="cdr_8h_source.html#l00113">ast_cdr::next</a>, <a class="el" href="strings_8h_source.html#l00072">S_OR</a>, and <a class="el" href="cdr_8h_source.html#l00087">ast_cdr::start</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l04214">__ast_pbx_run()</a>, <a class="el" href="channel_8c_source.html#l03851">__ast_request_and_dial()</a>, <a class="el" href="features_8c_source.html#l02441">ast_bridge_call()</a>, <a class="el" href="app__forkcdr_8c_source.html#l00176">ast_cdr_fork()</a>, <a class="el" href="cdr_8c_source.html#l01062">ast_cdr_reset()</a>, <a class="el" href="channel_8c_source.html#l01690">ast_hangup()</a>, <a class="el" href="pbx_8c_source.html#l07914">ast_pbx_outgoing_cdr_failed()</a>, <a class="el" href="app__followme_8c_source.html#l00468">clear_caller()</a>, and <a class="el" href="app__followme_8c_source.html#l00777">findmeexec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00880"></a>00880 {
<a name="l00881"></a>00881    <span class="keywordflow">for</span> ( ; cdr ; cdr = cdr-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a>) {
<a name="l00882"></a>00882       <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(cdr, <a class="code" href="cdr_8h.html#aaeb04a47ad80222e66f13955fefad532">AST_CDR_FLAG_DONT_TOUCH</a>) &amp;&amp; <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(cdr, <a class="code" href="cdr_8h.html#ad19495bac7dec6a99190f93e21965da6">AST_CDR_FLAG_LOCKED</a>))
<a name="l00883"></a>00883          <span class="keywordflow">continue</span>;
<a name="l00884"></a>00884       <a class="code" href="cdr_8c.html#ab136d9ac92fdcacf14e91c2da770043f" title="print a warning if cdr already posted">check_post</a>(cdr);
<a name="l00885"></a>00885       <span class="keywordflow">if</span> (<a class="code" href="time_8h.html#a1b7c6177ea781fc11512de25805fc144" title="Returns true if the argument is 0,0.">ast_tvzero</a>(cdr-&gt;<a class="code" href="structast__cdr.html#af5249cf68dff13dd1dcca5929f4f3a5b">end</a>))
<a name="l00886"></a>00886          cdr-&gt;<a class="code" href="structast__cdr.html#af5249cf68dff13dd1dcca5929f4f3a5b">end</a> = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l00887"></a>00887       <span class="keywordflow">if</span> (<a class="code" href="time_8h.html#a1b7c6177ea781fc11512de25805fc144" title="Returns true if the argument is 0,0.">ast_tvzero</a>(cdr-&gt;<a class="code" href="structast__cdr.html#ad80305b5e16da9c2675d5f057bd69386">start</a>)) {
<a name="l00888"></a>00888          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;CDR on channel &apos;%s&apos; has not started\n&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(cdr-&gt;<a class="code" href="structast__cdr.html#a6396dbd53fd6fedc1fc3ba2743f00eca">channel</a>, <span class="stringliteral">&quot;&lt;unknown&gt;&quot;</span>));
<a name="l00889"></a>00889          cdr-&gt;<a class="code" href="structast__cdr.html#a1f9669e5d9d64aa831cd9db2dd71534f">disposition</a> = <a class="code" href="cdr_8h.html#aca4e8985f1977038cb5f536fbeec437b">AST_CDR_FAILED</a>;
<a name="l00890"></a>00890       } <span class="keywordflow">else</span>
<a name="l00891"></a>00891          cdr-&gt;<a class="code" href="structast__cdr.html#a993dee0d19091c6d48fdeda230fd6be0">duration</a> = cdr-&gt;<a class="code" href="structast__cdr.html#af5249cf68dff13dd1dcca5929f4f3a5b">end</a>.tv_sec - cdr-&gt;<a class="code" href="structast__cdr.html#ad80305b5e16da9c2675d5f057bd69386">start</a>.tv_sec;
<a name="l00892"></a>00892       <span class="keywordflow">if</span> (<a class="code" href="time_8h.html#a1b7c6177ea781fc11512de25805fc144" title="Returns true if the argument is 0,0.">ast_tvzero</a>(cdr-&gt;<a class="code" href="structast__cdr.html#a621c14aed7c59835c5bc93bc88e8f3d9">answer</a>)) {
<a name="l00893"></a>00893          <span class="keywordflow">if</span> (cdr-&gt;<a class="code" href="structast__cdr.html#a1f9669e5d9d64aa831cd9db2dd71534f">disposition</a> == <a class="code" href="cdr_8h.html#ac7614ef6faaa8b913df85f229f0e037e">AST_CDR_ANSWERED</a>) {
<a name="l00894"></a>00894             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;CDR on channel &apos;%s&apos; has no answer time but is &apos;ANSWERED&apos;\n&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(cdr-&gt;<a class="code" href="structast__cdr.html#a6396dbd53fd6fedc1fc3ba2743f00eca">channel</a>, <span class="stringliteral">&quot;&lt;unknown&gt;&quot;</span>));
<a name="l00895"></a>00895             cdr-&gt;<a class="code" href="structast__cdr.html#a1f9669e5d9d64aa831cd9db2dd71534f">disposition</a> = <a class="code" href="cdr_8h.html#aca4e8985f1977038cb5f536fbeec437b">AST_CDR_FAILED</a>;
<a name="l00896"></a>00896          }
<a name="l00897"></a>00897       } <span class="keywordflow">else</span> {
<a name="l00898"></a>00898          cdr-&gt;<a class="code" href="structast__cdr.html#a4a98731fed2979292cd6042898671e8d">billsec</a> = cdr-&gt;<a class="code" href="structast__cdr.html#af5249cf68dff13dd1dcca5929f4f3a5b">end</a>.tv_sec - cdr-&gt;<a class="code" href="structast__cdr.html#a621c14aed7c59835c5bc93bc88e8f3d9">answer</a>.tv_sec;
<a name="l00899"></a>00899          <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;<a class="code" href="group__main__options.html#gaa5dba371db31dc4ebecdff7c929ff263">ast_options</a>, <a class="code" href="group__main__options.html#ggaf2588453b3a373a770741ad3ce353343a170c1a2006a7410c9bdc18d33c7860e5">AST_OPT_FLAG_INITIATED_SECONDS</a>))
<a name="l00900"></a>00900             cdr-&gt;<a class="code" href="structast__cdr.html#a4a98731fed2979292cd6042898671e8d">billsec</a> += cdr-&gt;<a class="code" href="structast__cdr.html#af5249cf68dff13dd1dcca5929f4f3a5b">end</a>.tv_usec &gt; cdr-&gt;<a class="code" href="structast__cdr.html#a621c14aed7c59835c5bc93bc88e8f3d9">answer</a>.tv_usec ? 1 : 0;
<a name="l00901"></a>00901       }
<a name="l00902"></a>00902    }
<a name="l00903"></a>00903 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6f39a1289d793c9d485fc02f18ce7757"></a><!-- doxytag: member="cdr.c::ast_cdr_engine_init" ref="a6f39a1289d793c9d485fc02f18ce7757" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_cdr_engine_init </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Load the configuration file cdr.conf and possibly start the CDR scheduling thread. </p>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l01522">1522</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cli_8c_source.html#l01919">ast_cli_register()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="cdr_8c_source.html#l00094">cdr_batch_lock</a>, <a class="el" href="cdr_8c_source.html#l01394">cli_status</a>, <a class="el" href="cdr_8c_source.html#l01396">do_reload()</a>, <a class="el" href="cdr_8c_source.html#l01155">init_batch()</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, and <a class="el" href="sched_8c_source.html#l00239">sched_context_create()</a>.</p>

<p>Referenced by <a class="el" href="asterisk_8c_source.html#l03095">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01523"></a>01523 {
<a name="l01524"></a>01524    <span class="keywordtype">int</span> res;
<a name="l01525"></a>01525 
<a name="l01526"></a>01526    <a class="code" href="structsched.html">sched</a> = <a class="code" href="sched_8h.html#ad4fd5c63d5d3dcc8e11bec644c601017" title="New schedule context.">sched_context_create</a>();
<a name="l01527"></a>01527    <span class="keywordflow">if</span> (!<a class="code" href="structsched.html">sched</a>) {
<a name="l01528"></a>01528       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to create schedule context.\n&quot;</span>);
<a name="l01529"></a>01529       <span class="keywordflow">return</span> -1;
<a name="l01530"></a>01530    }
<a name="l01531"></a>01531 
<a name="l01532"></a>01532    <a class="code" href="cli_8h.html#a0ca7e108aceb1cd488bb9e3ee26e4ebc" title="Registers a command or an array of commands.">ast_cli_register</a>(&amp;<a class="code" href="cdr_8c.html#a2bfbc88e2118d426be7b9ed59d6cf14f">cli_status</a>);
<a name="l01533"></a>01533 
<a name="l01534"></a>01534    res = <a class="code" href="cdr_8c.html#a9024be7cdcbd31ce15acb957deb118cb">do_reload</a>(0);
<a name="l01535"></a>01535    <span class="keywordflow">if</span> (res) {
<a name="l01536"></a>01536       <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;<a class="code" href="cdr_8c.html#a3a3969758c60f80011874aadde9d09ca">cdr_batch_lock</a>);
<a name="l01537"></a>01537       res = <a class="code" href="cdr_8c.html#a8ba2f2526d5230859524407aad436361">init_batch</a>();
<a name="l01538"></a>01538       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="cdr_8c.html#a3a3969758c60f80011874aadde9d09ca">cdr_batch_lock</a>);
<a name="l01539"></a>01539    }
<a name="l01540"></a>01540 
<a name="l01541"></a>01541    <span class="keywordflow">return</span> res;
<a name="l01542"></a>01542 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a90fbfcfc99e82f966b5769ba0f08e61c"></a><!-- doxytag: member="cdr.c::ast_cdr_engine_reload" ref="a90fbfcfc99e82f966b5769ba0f08e61c" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_cdr_engine_reload </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reload the configuration file cdr.conf and start/stop CDR scheduling thread. </p>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l01551">1551</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cdr_8c_source.html#l01396">do_reload()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01552"></a>01552 {
<a name="l01553"></a>01553    <span class="keywordflow">return</span> <a class="code" href="cdr_8c.html#a9024be7cdcbd31ce15acb957deb118cb">do_reload</a>(1);
<a name="l01554"></a>01554 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5634f8ea707fb2fdf87abdd55a539764"></a><!-- doxytag: member="cdr.c::ast_cdr_engine_term" ref="a5634f8ea707fb2fdf87abdd55a539764" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_cdr_engine_term </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Submit any remaining CDRs and prepare for shutdown </p>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l01546">1546</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cdr_8c_source.html#l01183">ast_cdr_submit_batch()</a>, and <a class="el" href="cdr_8c_source.html#l00092">batchsafeshutdown</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l01396">do_reload()</a>, and <a class="el" href="asterisk_8c_source.html#l01549">quit_handler()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01547"></a>01547 {
<a name="l01548"></a>01548    <a class="code" href="cdr_8h.html#a9c55c03296c35e451b5a9577ce1aed28" title="Spawns (possibly) a new thread to submit a batch of CDRs to the backend engines.">ast_cdr_submit_batch</a>(<a class="code" href="cdr_8c.html#a4ef34eb96cb5e9029153d7c36e3ce510">batchsafeshutdown</a>);
<a name="l01549"></a>01549 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="acdce2d9d0af5180090b70149ce18e554"></a><!-- doxytag: member="cdr.c::ast_cdr_failed" ref="acdce2d9d0af5180090b70149ce18e554" args="(struct ast_cdr *cdr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_cdr_failed </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cdr.html">ast_cdr</a> *&nbsp;</td>
          <td class="paramname"> <em>cdr</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Fail a call. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>cdr</em>&nbsp;</td><td>the cdr you wish to associate with the call Marks the channel disposition as "FAILED" Will skip CDR's in chain with ANS_LOCK bit set. (see forkCDR() application. Returns nothing </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00715">715</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cdr_8h_source.html#l00049">AST_CDR_FAILED</a>, <a class="el" href="cdr_8h_source.html#l00032">AST_CDR_FLAG_LOCKED</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="cdr_8c_source.html#l00420">check_post()</a>, <a class="el" href="cdr_8h_source.html#l00097">ast_cdr::disposition</a>, and <a class="el" href="cdr_8h_source.html#l00113">ast_cdr::next</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l03851">__ast_request_and_dial()</a>, <a class="el" href="pbx_8c_source.html#l08106">ast_pbx_outgoing_app()</a>, <a class="el" href="pbx_8c_source.html#l07914">ast_pbx_outgoing_cdr_failed()</a>, <a class="el" href="pbx_8c_source.html#l07940">ast_pbx_outgoing_exten()</a>, <a class="el" href="app__followme_8c_source.html#l00468">clear_caller()</a>, <a class="el" href="app__followme_8c_source.html#l00777">findmeexec()</a>, <a class="el" href="app__dial_8c_source.html#l00607">handle_cause()</a>, and <a class="el" href="app__queue_8c_source.html#l03569">try_calling()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00716"></a>00716 {
<a name="l00717"></a>00717    <span class="keywordflow">for</span> (; cdr; cdr = cdr-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a>) {
<a name="l00718"></a>00718       <a class="code" href="cdr_8c.html#ab136d9ac92fdcacf14e91c2da770043f" title="print a warning if cdr already posted">check_post</a>(cdr);
<a name="l00719"></a>00719       <span class="keywordflow">if</span> (!<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(cdr, <a class="code" href="cdr_8h.html#ad19495bac7dec6a99190f93e21965da6">AST_CDR_FLAG_LOCKED</a>)) {
<a name="l00720"></a>00720          <a class="code" href="cdr_8c.html#ab136d9ac92fdcacf14e91c2da770043f" title="print a warning if cdr already posted">check_post</a>(cdr);
<a name="l00721"></a>00721          <span class="keywordflow">if</span> (cdr-&gt;<a class="code" href="structast__cdr.html#a1f9669e5d9d64aa831cd9db2dd71534f">disposition</a> &lt; <a class="code" href="cdr_8h.html#aca4e8985f1977038cb5f536fbeec437b">AST_CDR_FAILED</a>)
<a name="l00722"></a>00722             cdr-&gt;<a class="code" href="structast__cdr.html#a1f9669e5d9d64aa831cd9db2dd71534f">disposition</a> = <a class="code" href="cdr_8h.html#aca4e8985f1977038cb5f536fbeec437b">AST_CDR_FAILED</a>;
<a name="l00723"></a>00723       }
<a name="l00724"></a>00724    }
<a name="l00725"></a>00725 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad2282e11ef557755c3a23e386f42d1ba"></a><!-- doxytag: member="cdr.c::ast_cdr_flags2str" ref="ad2282e11ef557755c3a23e386f42d1ba" args="(int flag)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* ast_cdr_flags2str </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>flag</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Converts AMA flag to printable string </p>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00923">923</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cdr_8h_source.html#l00057">AST_CDR_BILLING</a>, <a class="el" href="cdr_8h_source.html#l00058">AST_CDR_DOCUMENTATION</a>, and <a class="el" href="cdr_8h_source.html#l00056">AST_CDR_OMIT</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l15349">_sip_show_peer()</a>, <a class="el" href="chan__skinny_8c_source.html#l03337">_skinny_show_line()</a>, <a class="el" href="cdr_8c_source.html#l00219">ast_cdr_getvar()</a>, <a class="el" href="cdr__csv_8c_source.html#l00200">build_csv_record()</a>, <a class="el" href="cdr__radius_8c_source.html#l00090">build_radius_record()</a>, <a class="el" href="cdr__csv_8c_source.html#l00279">csv_log()</a>, <a class="el" href="cdr__manager_8c_source.html#l00134">manager_log()</a>, <a class="el" href="chan__sip_8c_source.html#l15630">sip_show_user()</a>, and <a class="el" href="cdr__tds_8c_source.html#l00111">tds_log()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00924"></a>00924 {
<a name="l00925"></a>00925    <span class="keywordflow">switch</span> (flag) {
<a name="l00926"></a>00926    <span class="keywordflow">case</span> <a class="code" href="cdr_8h.html#ae094e5111c8d95003a870f99fe29f9a5">AST_CDR_OMIT</a>:
<a name="l00927"></a>00927       <span class="keywordflow">return</span> <span class="stringliteral">&quot;OMIT&quot;</span>;
<a name="l00928"></a>00928    <span class="keywordflow">case</span> <a class="code" href="cdr_8h.html#a04adfa377bc7ec8f853d23de3b1c085b">AST_CDR_BILLING</a>:
<a name="l00929"></a>00929       <span class="keywordflow">return</span> <span class="stringliteral">&quot;BILLING&quot;</span>;
<a name="l00930"></a>00930    <span class="keywordflow">case</span> <a class="code" href="cdr_8h.html#a91765929568fa1a9d035317aa084495f">AST_CDR_DOCUMENTATION</a>:
<a name="l00931"></a>00931       <span class="keywordflow">return</span> <span class="stringliteral">&quot;DOCUMENTATION&quot;</span>;
<a name="l00932"></a>00932    }
<a name="l00933"></a>00933    <span class="keywordflow">return</span> <span class="stringliteral">&quot;Unknown&quot;</span>;
<a name="l00934"></a>00934 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a28b931d52c71271afd601186db95fec2"></a><!-- doxytag: member="cdr.c::ast_cdr_free" ref="a28b931d52c71271afd601186db95fec2" args="(struct ast_cdr *cdr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_cdr_free </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cdr.html">ast_cdr</a> *&nbsp;</td>
          <td class="paramname"> <em>cdr</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Free a CDR record. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>cdr</em>&nbsp;</td><td><a class="el" href="structast__cdr.html" title="Responsible for call detail data.">ast_cdr</a> structure to free Returns nothing </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00428">428</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cdr_8c_source.html#l00407">ast_cdr_free_vars()</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="cdr_8h_source.html#l00113">ast_cdr::next</a>, and <a class="el" href="cdr_8c_source.html#l00061">ast_cdr_beitem::next</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l01234">ast_cdr_detach()</a>, and <a class="el" href="cdr_8c_source.html#l01166">do_batch_backend_process()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00429"></a>00429 {
<a name="l00430"></a>00430 
<a name="l00431"></a>00431    <span class="keywordflow">while</span> (cdr) {
<a name="l00432"></a>00432       <span class="keyword">struct </span><a class="code" href="structast__cdr.html" title="Responsible for call detail data.">ast_cdr</a> *<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a> = cdr-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a>;
<a name="l00433"></a>00433 
<a name="l00434"></a>00434       <a class="code" href="cdr_8h.html#a9a823bcb3824753f08351a8ed7a25b6f">ast_cdr_free_vars</a>(cdr, 0);
<a name="l00435"></a>00435       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(cdr);
<a name="l00436"></a>00436       cdr = next;
<a name="l00437"></a>00437    }
<a name="l00438"></a>00438 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9a823bcb3824753f08351a8ed7a25b6f"></a><!-- doxytag: member="cdr.c::ast_cdr_free_vars" ref="a9a823bcb3824753f08351a8ed7a25b6f" args="(struct ast_cdr *cdr, int recur)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_cdr_free_vars </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cdr.html">ast_cdr</a> *&nbsp;</td>
          <td class="paramname"> <em>cdr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>recur</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00407">407</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00817">AST_LIST_REMOVE_HEAD</a>, <a class="el" href="chanvars_8c_source.html#l00059">ast_var_delete()</a>, <a class="el" href="cdr_8h_source.html#l00113">ast_cdr::next</a>, and <a class="el" href="cdr_8h_source.html#l00111">ast_cdr::varshead</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l00441">ast_cdr_discard()</a>, <a class="el" href="app__forkcdr_8c_source.html#l00176">ast_cdr_fork()</a>, <a class="el" href="cdr_8c_source.html#l00428">ast_cdr_free()</a>, and <a class="el" href="cdr_8c_source.html#l01062">ast_cdr_reset()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00408"></a>00408 {
<a name="l00409"></a>00409 
<a name="l00410"></a>00410    <span class="comment">/* clear variables */</span>
<a name="l00411"></a>00411    <span class="keywordflow">for</span> (; cdr; cdr = recur ? cdr-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a> : NULL) {
<a name="l00412"></a>00412       <span class="keyword">struct </span><a class="code" href="structast__var__t.html">ast_var_t</a> *vardata;
<a name="l00413"></a>00413       <span class="keyword">struct </span>varshead *headp = &amp;cdr-&gt;<a class="code" href="structast__cdr.html#a9ffb22045a8f14bef8f2137cd779ab25">varshead</a>;
<a name="l00414"></a>00414       <span class="keywordflow">while</span> ((vardata = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(headp, entries)))
<a name="l00415"></a>00415          <a class="code" href="chanvars_8h.html#a52aaa758ed30031250c2d356b993c6d9">ast_var_delete</a>(vardata);
<a name="l00416"></a>00416    }
<a name="l00417"></a>00417 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7e49e9d173fdc79d0567337f96a648a1"></a><!-- doxytag: member="cdr.c::ast_cdr_getvar" ref="a7e49e9d173fdc79d0567337f96a648a1" args="(struct ast_cdr *cdr, const char *name, char **ret, char *workspace, int workspacelen, int recur, int raw)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_cdr_getvar </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cdr.html">ast_cdr</a> *&nbsp;</td>
          <td class="paramname"> <em>cdr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&nbsp;</td>
          <td class="paramname"> <em>ret</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>workspace</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>workspacelen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>recur</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>raw</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>CDR channel variable retrieval </p>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00219">219</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cdr_8h_source.html#l00101">ast_cdr::accountcode</a>, <a class="el" href="cdr_8h_source.html#l00099">ast_cdr::amaflags</a>, <a class="el" href="cdr_8h_source.html#l00089">ast_cdr::answer</a>, <a class="el" href="cdr_8c_source.html#l00905">ast_cdr_disp2str()</a>, <a class="el" href="cdr_8c_source.html#l00923">ast_cdr_flags2str()</a>, <a class="el" href="cdr_8c_source.html#l00187">ast_cdr_getvar_internal()</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="time_8h_source.html#l00089">ast_tvdiff_ms()</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="cdr_8h_source.html#l00095">ast_cdr::billsec</a>, <a class="el" href="cdr_8c_source.html#l00204">cdr_get_tv()</a>, <a class="el" href="cdr_8h_source.html#l00079">ast_cdr::channel</a>, <a class="el" href="cdr_8h_source.html#l00071">ast_cdr::clid</a>, <a class="el" href="cdr_8h_source.html#l00077">ast_cdr::dcontext</a>, <a class="el" href="cdr_8h_source.html#l00097">ast_cdr::disposition</a>, <a class="el" href="cdr_8h_source.html#l00075">ast_cdr::dst</a>, <a class="el" href="cdr_8h_source.html#l00081">ast_cdr::dstchannel</a>, <a class="el" href="cdr_8h_source.html#l00093">ast_cdr::duration</a>, <a class="el" href="cdr_8h_source.html#l00091">ast_cdr::end</a>, <a class="el" href="cdr_8h_source.html#l00083">ast_cdr::lastapp</a>, <a class="el" href="cdr_8h_source.html#l00085">ast_cdr::lastdata</a>, <a class="el" href="cdr_8h_source.html#l00073">ast_cdr::src</a>, <a class="el" href="cdr_8h_source.html#l00087">ast_cdr::start</a>, <a class="el" href="cdr_8h_source.html#l00106">ast_cdr::uniqueid</a>, and <a class="el" href="cdr_8h_source.html#l00108">ast_cdr::userfield</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l00362">ast_cdr_serialize_variables()</a>, <a class="el" href="res__config__sqlite_8c_source.html#l00785">cdr_handler()</a>, <a class="el" href="func__cdr_8c_source.html#l00183">cdr_read()</a>, <a class="el" href="cdr__adaptive__odbc_8c_source.html#l00343">odbc_log()</a>, and <a class="el" href="cdr__pgsql_8c_source.html#l00103">pgsql_log()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00220"></a>00220 {
<a name="l00221"></a>00221    <span class="keyword">const</span> <span class="keywordtype">char</span> *fmt = <span class="stringliteral">&quot;%Y-%m-%d %T&quot;</span>;
<a name="l00222"></a>00222    <span class="keyword">const</span> <span class="keywordtype">char</span> *varbuf;
<a name="l00223"></a>00223 
<a name="l00224"></a>00224    <span class="keywordflow">if</span> (!cdr)  <span class="comment">/* don&apos;t die if the cdr is null */</span>
<a name="l00225"></a>00225       <span class="keywordflow">return</span>;
<a name="l00226"></a>00226 
<a name="l00227"></a>00227    *ret = NULL;
<a name="l00228"></a>00228    <span class="comment">/* special vars (the ones from the struct ast_cdr when requested by name) </span>
<a name="l00229"></a>00229 <span class="comment">      I&apos;d almost say we should convert all the stringed vals to vars */</span>
<a name="l00230"></a>00230 
<a name="l00231"></a>00231    <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="stringliteral">&quot;clid&quot;</span>))
<a name="l00232"></a>00232       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(workspace, cdr-&gt;<a class="code" href="structast__cdr.html#ab7fd8bddf0ce6987ae5e58fb64cfc9e2">clid</a>, workspacelen);
<a name="l00233"></a>00233    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="stringliteral">&quot;src&quot;</span>))
<a name="l00234"></a>00234       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(workspace, cdr-&gt;<a class="code" href="structast__cdr.html#aa8e4f370559b3fe698f36b3132467f94">src</a>, workspacelen);
<a name="l00235"></a>00235    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="stringliteral">&quot;dst&quot;</span>))
<a name="l00236"></a>00236       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(workspace, cdr-&gt;<a class="code" href="structast__cdr.html#ab30db746a1bf5c869a5dc9dbfaa864d4">dst</a>, workspacelen);
<a name="l00237"></a>00237    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="stringliteral">&quot;dcontext&quot;</span>))
<a name="l00238"></a>00238       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(workspace, cdr-&gt;<a class="code" href="structast__cdr.html#af27d556683a4a28e6564618bcf00bec1">dcontext</a>, workspacelen);
<a name="l00239"></a>00239    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="stringliteral">&quot;channel&quot;</span>))
<a name="l00240"></a>00240       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(workspace, cdr-&gt;<a class="code" href="structast__cdr.html#a6396dbd53fd6fedc1fc3ba2743f00eca">channel</a>, workspacelen);
<a name="l00241"></a>00241    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="stringliteral">&quot;dstchannel&quot;</span>))
<a name="l00242"></a>00242       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(workspace, cdr-&gt;<a class="code" href="structast__cdr.html#a0d43f7cac6179c7c4f9521f3138195b4">dstchannel</a>, workspacelen);
<a name="l00243"></a>00243    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="stringliteral">&quot;lastapp&quot;</span>))
<a name="l00244"></a>00244       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(workspace, cdr-&gt;<a class="code" href="structast__cdr.html#ae7697234189954ec7c6a81b4ab691b85">lastapp</a>, workspacelen);
<a name="l00245"></a>00245    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="stringliteral">&quot;lastdata&quot;</span>))
<a name="l00246"></a>00246       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(workspace, cdr-&gt;<a class="code" href="structast__cdr.html#a2176704f41b4368f2dfa94b64bfcfb6a">lastdata</a>, workspacelen);
<a name="l00247"></a>00247    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="stringliteral">&quot;start&quot;</span>))
<a name="l00248"></a>00248       <a class="code" href="cdr_8c.html#a26ef22f050d742f08715473a63720bb5">cdr_get_tv</a>(cdr-&gt;<a class="code" href="structast__cdr.html#ad80305b5e16da9c2675d5f057bd69386">start</a>, raw ? NULL : fmt, workspace, workspacelen);
<a name="l00249"></a>00249    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="stringliteral">&quot;answer&quot;</span>))
<a name="l00250"></a>00250       <a class="code" href="cdr_8c.html#a26ef22f050d742f08715473a63720bb5">cdr_get_tv</a>(cdr-&gt;<a class="code" href="structast__cdr.html#a621c14aed7c59835c5bc93bc88e8f3d9">answer</a>, raw ? NULL : fmt, workspace, workspacelen);
<a name="l00251"></a>00251    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="stringliteral">&quot;end&quot;</span>))
<a name="l00252"></a>00252       <a class="code" href="cdr_8c.html#a26ef22f050d742f08715473a63720bb5">cdr_get_tv</a>(cdr-&gt;<a class="code" href="structast__cdr.html#af5249cf68dff13dd1dcca5929f4f3a5b">end</a>, raw ? NULL : fmt, workspace, workspacelen);
<a name="l00253"></a>00253    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="stringliteral">&quot;duration&quot;</span>))
<a name="l00254"></a>00254       snprintf(workspace, workspacelen, <span class="stringliteral">&quot;%ld&quot;</span>, cdr-&gt;<a class="code" href="structast__cdr.html#a993dee0d19091c6d48fdeda230fd6be0">duration</a> ? cdr-&gt;<a class="code" href="structast__cdr.html#a993dee0d19091c6d48fdeda230fd6be0">duration</a> : (<span class="keywordtype">long</span>)<a class="code" href="time_8h.html#a74e35cffcd45ad6cd7c8587921e8a4c2" title="Computes the difference (in milliseconds) between two struct timeval instances.">ast_tvdiff_ms</a>(<a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>(), cdr-&gt;<a class="code" href="structast__cdr.html#ad80305b5e16da9c2675d5f057bd69386">start</a>) / 1000);
<a name="l00255"></a>00255    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="stringliteral">&quot;billsec&quot;</span>))
<a name="l00256"></a>00256       snprintf(workspace, workspacelen, <span class="stringliteral">&quot;%ld&quot;</span>, cdr-&gt;<a class="code" href="structast__cdr.html#a4a98731fed2979292cd6042898671e8d">billsec</a> || cdr-&gt;<a class="code" href="structast__cdr.html#a621c14aed7c59835c5bc93bc88e8f3d9">answer</a>.tv_sec == 0 ? cdr-&gt;<a class="code" href="structast__cdr.html#a4a98731fed2979292cd6042898671e8d">billsec</a> : (<span class="keywordtype">long</span>)<a class="code" href="time_8h.html#a74e35cffcd45ad6cd7c8587921e8a4c2" title="Computes the difference (in milliseconds) between two struct timeval instances.">ast_tvdiff_ms</a>(<a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>(), cdr-&gt;<a class="code" href="structast__cdr.html#a621c14aed7c59835c5bc93bc88e8f3d9">answer</a>) / 1000);
<a name="l00257"></a>00257    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="stringliteral">&quot;disposition&quot;</span>)) {
<a name="l00258"></a>00258       <span class="keywordflow">if</span> (raw) {
<a name="l00259"></a>00259          snprintf(workspace, workspacelen, <span class="stringliteral">&quot;%ld&quot;</span>, cdr-&gt;<a class="code" href="structast__cdr.html#a1f9669e5d9d64aa831cd9db2dd71534f">disposition</a>);
<a name="l00260"></a>00260       } <span class="keywordflow">else</span> {
<a name="l00261"></a>00261          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(workspace, <a class="code" href="cdr_8h.html#a625074f8926198c57120460097d6afdf" title="Disposition to a string.">ast_cdr_disp2str</a>(cdr-&gt;<a class="code" href="structast__cdr.html#a1f9669e5d9d64aa831cd9db2dd71534f">disposition</a>), workspacelen);
<a name="l00262"></a>00262       }
<a name="l00263"></a>00263    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="stringliteral">&quot;amaflags&quot;</span>)) {
<a name="l00264"></a>00264       <span class="keywordflow">if</span> (raw) {
<a name="l00265"></a>00265          snprintf(workspace, workspacelen, <span class="stringliteral">&quot;%ld&quot;</span>, cdr-&gt;<a class="code" href="structast__cdr.html#aa2112d5526f7d98a80d5da0abea1cc7d">amaflags</a>);
<a name="l00266"></a>00266       } <span class="keywordflow">else</span> {
<a name="l00267"></a>00267          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(workspace, <a class="code" href="cdr_8h.html#ac28b55abfc64e10c72d87078382a99ed">ast_cdr_flags2str</a>(cdr-&gt;<a class="code" href="structast__cdr.html#aa2112d5526f7d98a80d5da0abea1cc7d">amaflags</a>), workspacelen);
<a name="l00268"></a>00268       }
<a name="l00269"></a>00269    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="stringliteral">&quot;accountcode&quot;</span>))
<a name="l00270"></a>00270       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(workspace, cdr-&gt;<a class="code" href="structast__cdr.html#adfee50d07a98645d4d20b896ce03785a">accountcode</a>, workspacelen);
<a name="l00271"></a>00271    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="stringliteral">&quot;uniqueid&quot;</span>))
<a name="l00272"></a>00272       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(workspace, cdr-&gt;<a class="code" href="structast__cdr.html#aa7a934e4f070b98b9113d24737a40ec5">uniqueid</a>, workspacelen);
<a name="l00273"></a>00273    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="stringliteral">&quot;userfield&quot;</span>))
<a name="l00274"></a>00274       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(workspace, cdr-&gt;<a class="code" href="structast__cdr.html#a2d480b13820a3a97582a1a138036aa25">userfield</a>, workspacelen);
<a name="l00275"></a>00275    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((varbuf = <a class="code" href="cdr_8c.html#a1412f360c07eedbcc9c07e4b4d82c0f0">ast_cdr_getvar_internal</a>(cdr, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, recur)))
<a name="l00276"></a>00276       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(workspace, varbuf, workspacelen);
<a name="l00277"></a>00277    <span class="keywordflow">else</span>
<a name="l00278"></a>00278       workspace[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00279"></a>00279 
<a name="l00280"></a>00280    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(workspace))
<a name="l00281"></a>00281       *ret = workspace;
<a name="l00282"></a>00282 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1412f360c07eedbcc9c07e4b4d82c0f0"></a><!-- doxytag: member="cdr.c::ast_cdr_getvar_internal" ref="a1412f360c07eedbcc9c07e4b4d82c0f0" args="(struct ast_cdr *cdr, const char *name, int recur)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static const char* ast_cdr_getvar_internal </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cdr.html">ast_cdr</a> *&nbsp;</td>
          <td class="paramname"> <em>cdr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>recur</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00187">187</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="chanvars_8c_source.html#l00065">ast_var_name()</a>, <a class="el" href="chanvars_8c_source.html#l00085">ast_var_value()</a>, <a class="el" href="cdr_8h_source.html#l00113">ast_cdr::next</a>, and <a class="el" href="cdr_8h_source.html#l00111">ast_cdr::varshead</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l00219">ast_cdr_getvar()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00188"></a>00188 {
<a name="l00189"></a>00189    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>))
<a name="l00190"></a>00190       <span class="keywordflow">return</span> NULL;
<a name="l00191"></a>00191 
<a name="l00192"></a>00192    <span class="keywordflow">for</span> (; cdr; cdr = recur ? cdr-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a> : NULL) {
<a name="l00193"></a>00193       <span class="keyword">struct </span><a class="code" href="structast__var__t.html">ast_var_t</a> *variables;
<a name="l00194"></a>00194       <span class="keyword">struct </span>varshead *headp = &amp;cdr-&gt;<a class="code" href="structast__cdr.html#a9ffb22045a8f14bef8f2137cd779ab25">varshead</a>;
<a name="l00195"></a>00195       <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(headp, variables, entries) {
<a name="l00196"></a>00196          <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <a class="code" href="chanvars_8h.html#a356a31cd608ec07d3668dcd589be49d8">ast_var_name</a>(variables)))
<a name="l00197"></a>00197             <span class="keywordflow">return</span> <a class="code" href="chanvars_8h.html#a8e0081172db71c5021d20706c50d959c">ast_var_value</a>(variables);
<a name="l00198"></a>00198       }
<a name="l00199"></a>00199    }
<a name="l00200"></a>00200 
<a name="l00201"></a>00201    <span class="keywordflow">return</span> NULL;
<a name="l00202"></a>00202 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a90701b9d1c8300605e8065d03bccad9c"></a><!-- doxytag: member="cdr.c::ast_cdr_init" ref="a90701b9d1c8300605e8065d03bccad9c" args="(struct ast_cdr *cdr, struct ast_channel *c)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_cdr_init </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cdr.html">ast_cdr</a> *&nbsp;</td>
          <td class="paramname"> <em>cdr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize based on a channel. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>cdr</em>&nbsp;</td><td>Call Detail Record to use for channel </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel to bind CDR with Initializes a CDR and associates it with a particular channel </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 by default </dd></dl>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00844">844</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00469">ast_channel::_state</a>, <a class="el" href="cdr_8h_source.html#l00101">ast_cdr::accountcode</a>, <a class="el" href="channel_8h_source.html#l00473">ast_channel::amaflags</a>, <a class="el" href="cdr_8h_source.html#l00099">ast_cdr::amaflags</a>, <a class="el" href="cdr_8h_source.html#l00051">AST_CDR_ANSWERED</a>, <a class="el" href="cdr_8h_source.html#l00032">AST_CDR_FLAG_LOCKED</a>, <a class="el" href="cdr_8h_source.html#l00047">AST_CDR_NOANSWER</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="channel_8h_source.html#l00365">AST_STATE_UP</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="adsistub_8c_source.html#l00049">chan</a>, <a class="el" href="cdr_8h_source.html#l00079">ast_cdr::channel</a>, <a class="el" href="channel_8h_source.html#l00503">ast_channel::context</a>, <a class="el" href="cdr_8h_source.html#l00077">ast_cdr::dcontext</a>, <a class="el" href="cdr_8h_source.html#l00097">ast_cdr::disposition</a>, <a class="el" href="cdr_8h_source.html#l00075">ast_cdr::dst</a>, <a class="el" href="channel_8h_source.html#l00504">ast_channel::exten</a>, <a class="el" href="channel_8h_source.html#l00505">ast_channel::macrocontext</a>, <a class="el" href="channel_8h_source.html#l00506">ast_channel::macroexten</a>, <a class="el" href="cdr_8h_source.html#l00113">ast_cdr::next</a>, <a class="el" href="strings_8h_source.html#l00072">S_OR</a>, <a class="el" href="cdr_8c_source.html#l00815">set_one_cid()</a>, and <a class="el" href="cdr_8h_source.html#l00106">ast_cdr::uniqueid</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l00772">__ast_channel_alloc_ap()</a>, <a class="el" href="channel_8c_source.html#l03851">__ast_request_and_dial()</a>, <a class="el" href="pbx_8c_source.html#l07914">ast_pbx_outgoing_cdr_failed()</a>, <a class="el" href="features_8c_source.html#l01265">builtin_blindtransfer()</a>, <a class="el" href="app__followme_8c_source.html#l00468">clear_caller()</a>, and <a class="el" href="app__followme_8c_source.html#l00777">findmeexec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00845"></a>00845 {
<a name="l00846"></a>00846    <span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>;
<a name="l00847"></a>00847 
<a name="l00848"></a>00848    <span class="keywordflow">for</span> ( ; cdr ; cdr = cdr-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a>) {
<a name="l00849"></a>00849       <span class="keywordflow">if</span> (!<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(cdr, <a class="code" href="cdr_8h.html#ad19495bac7dec6a99190f93e21965da6">AST_CDR_FLAG_LOCKED</a>)) {
<a name="l00850"></a>00850          chan = <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(cdr-&gt;<a class="code" href="structast__cdr.html#a6396dbd53fd6fedc1fc3ba2743f00eca">channel</a>, <span class="stringliteral">&quot;&lt;unknown&gt;&quot;</span>);
<a name="l00851"></a>00851          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(cdr-&gt;<a class="code" href="structast__cdr.html#a6396dbd53fd6fedc1fc3ba2743f00eca">channel</a>, c-&gt;name, <span class="keyword">sizeof</span>(cdr-&gt;<a class="code" href="structast__cdr.html#a6396dbd53fd6fedc1fc3ba2743f00eca">channel</a>));
<a name="l00852"></a>00852          <a class="code" href="cdr_8c.html#af8a938a22715b2e6549f67efb4da5b14">set_one_cid</a>(cdr, c);
<a name="l00853"></a>00853 
<a name="l00854"></a>00854          cdr-&gt;<a class="code" href="structast__cdr.html#a1f9669e5d9d64aa831cd9db2dd71534f">disposition</a> = (c-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>) ?  <a class="code" href="cdr_8h.html#ac7614ef6faaa8b913df85f229f0e037e">AST_CDR_ANSWERED</a> : <a class="code" href="cdr_8h.html#a2fcd4015b8151a5656489fcfe45409be">AST_CDR_NOANSWER</a>;
<a name="l00855"></a>00855          cdr-&gt;<a class="code" href="structast__cdr.html#aa2112d5526f7d98a80d5da0abea1cc7d">amaflags</a> = c-&gt;<a class="code" href="structast__channel.html#ad2cfb0f821c065261382a9298bb5a16b">amaflags</a> ? c-&gt;<a class="code" href="structast__channel.html#ad2cfb0f821c065261382a9298bb5a16b">amaflags</a> :  <a class="code" href="cdr_8h.html#a40d6ca75f86ae72a310c1cdceab8d345">ast_default_amaflags</a>;
<a name="l00856"></a>00856          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(cdr-&gt;<a class="code" href="structast__cdr.html#adfee50d07a98645d4d20b896ce03785a">accountcode</a>, c-&gt;accountcode, <span class="keyword">sizeof</span>(cdr-&gt;<a class="code" href="structast__cdr.html#adfee50d07a98645d4d20b896ce03785a">accountcode</a>));
<a name="l00857"></a>00857          <span class="comment">/* Destination information */</span>
<a name="l00858"></a>00858          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(cdr-&gt;<a class="code" href="structast__cdr.html#ab30db746a1bf5c869a5dc9dbfaa864d4">dst</a>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(c-&gt;<a class="code" href="structast__channel.html#a582cff3075953f73ba96888167acf009">macroexten</a>,c-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>), <span class="keyword">sizeof</span>(cdr-&gt;<a class="code" href="structast__cdr.html#ab30db746a1bf5c869a5dc9dbfaa864d4">dst</a>));
<a name="l00859"></a>00859          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(cdr-&gt;<a class="code" href="structast__cdr.html#af27d556683a4a28e6564618bcf00bec1">dcontext</a>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(c-&gt;<a class="code" href="structast__channel.html#a0a602b0f10ece2644f247c3f6ff841e0">macrocontext</a>,c-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>), <span class="keyword">sizeof</span>(cdr-&gt;<a class="code" href="structast__cdr.html#af27d556683a4a28e6564618bcf00bec1">dcontext</a>));
<a name="l00860"></a>00860          <span class="comment">/* Unique call identifier */</span>
<a name="l00861"></a>00861          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(cdr-&gt;<a class="code" href="structast__cdr.html#aa7a934e4f070b98b9113d24737a40ec5">uniqueid</a>, c-&gt;uniqueid, <span class="keyword">sizeof</span>(cdr-&gt;<a class="code" href="structast__cdr.html#aa7a934e4f070b98b9113d24737a40ec5">uniqueid</a>));
<a name="l00862"></a>00862       }
<a name="l00863"></a>00863    }
<a name="l00864"></a>00864    <span class="keywordflow">return</span> 0;
<a name="l00865"></a>00865 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3230b9156b0d5fd8b1bd5b91e8ead303"></a><!-- doxytag: member="cdr.c::ast_cdr_isset_unanswered" ref="a3230b9156b0d5fd8b1bd5b91e8ead303" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_cdr_isset_unanswered </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00160">160</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cdr_8c_source.html#l00087">unanswered</a>.</p>

<p>Referenced by <a class="el" href="app__queue_8c_source.html#l02467">ring_entry()</a>, and <a class="el" href="app__queue_8c_source.html#l03569">try_calling()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00161"></a>00161 {
<a name="l00162"></a>00162    <span class="keywordflow">return</span> <a class="code" href="cdr_8c.html#a4a1bce7c6dac29f74373744e946a7b9b">unanswered</a>;
<a name="l00163"></a>00163 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7eb1ff8c700babda50fa4480cf7b4cf3"></a><!-- doxytag: member="cdr.c::ast_cdr_merge" ref="a7eb1ff8c700babda50fa4480cf7b4cf3" args="(struct ast_cdr *to, struct ast_cdr *from)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_cdr_merge </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cdr.html">ast_cdr</a> *&nbsp;</td>
          <td class="paramname"> <em>to</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cdr.html">ast_cdr</a> *&nbsp;</td>
          <td class="paramname"> <em>from</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Move the non-null data from the "from" cdr to the "to" cdr. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>to</em>&nbsp;</td><td>the cdr to get the goodies </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>from</em>&nbsp;</td><td>the cdr to give the goodies </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00496">496</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cdr_8h_source.html#l00101">ast_cdr::accountcode</a>, <a class="el" href="cdr_8h_source.html#l00099">ast_cdr::amaflags</a>, <a class="el" href="cdr_8h_source.html#l00089">ast_cdr::answer</a>, <a class="el" href="cdr_8c_source.html#l01129">ast_cdr_append()</a>, <a class="el" href="cdr_8c_source.html#l00441">ast_cdr_discard()</a>, <a class="el" href="cdr_8h_source.html#l00058">AST_CDR_DOCUMENTATION</a>, <a class="el" href="cdr_8c_source.html#l00168">ast_cdr_dup()</a>, <a class="el" href="cdr_8h_source.html#l00033">AST_CDR_FLAG_CHILD</a>, <a class="el" href="cdr_8h_source.html#l00030">AST_CDR_FLAG_KEEP_VARS</a>, <a class="el" href="cdr_8h_source.html#l00032">AST_CDR_FLAG_LOCKED</a>, <a class="el" href="cdr_8h_source.html#l00034">AST_CDR_FLAG_POST_DISABLED</a>, <a class="el" href="cdr_8h_source.html#l00031">AST_CDR_FLAG_POSTED</a>, <a class="el" href="cdr_8h_source.html#l00047">AST_CDR_NOANSWER</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="utils_8h_source.html#l00068">ast_set_flag</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="time_8h_source.html#l00164">ast_tv()</a>, <a class="el" href="time_8h_source.html#l00119">ast_tvcmp()</a>, <a class="el" href="time_8h_source.html#l00099">ast_tvzero()</a>, <a class="el" href="cdr_8h_source.html#l00095">ast_cdr::billsec</a>, <a class="el" href="cdr_8c_source.html#l00461">cdr_merge_vars()</a>, <a class="el" href="cdr_8h_source.html#l00079">ast_cdr::channel</a>, <a class="el" href="cdr_8h_source.html#l00071">ast_cdr::clid</a>, <a class="el" href="cdr_8h_source.html#l00077">ast_cdr::dcontext</a>, <a class="el" href="cdr_8h_source.html#l00097">ast_cdr::disposition</a>, <a class="el" href="cdr_8h_source.html#l00075">ast_cdr::dst</a>, <a class="el" href="cdr_8h_source.html#l00081">ast_cdr::dstchannel</a>, <a class="el" href="cdr_8h_source.html#l00093">ast_cdr::duration</a>, <a class="el" href="cdr_8h_source.html#l00091">ast_cdr::end</a>, <a class="el" href="cdr_8h_source.html#l00083">ast_cdr::lastapp</a>, <a class="el" href="cdr_8h_source.html#l00085">ast_cdr::lastdata</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="cdr_8h_source.html#l00113">ast_cdr::next</a>, <a class="el" href="cdr_8h_source.html#l00073">ast_cdr::src</a>, <a class="el" href="cdr_8h_source.html#l00087">ast_cdr::start</a>, and <a class="el" href="cdr_8h_source.html#l00108">ast_cdr::userfield</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00497"></a>00497 {
<a name="l00498"></a>00498    <span class="keyword">struct </span><a class="code" href="structast__cdr.html" title="Responsible for call detail data.">ast_cdr</a> *zcdr;
<a name="l00499"></a>00499    <span class="keyword">struct </span><a class="code" href="structast__cdr.html" title="Responsible for call detail data.">ast_cdr</a> *lto = NULL;
<a name="l00500"></a>00500    <span class="keyword">struct </span><a class="code" href="structast__cdr.html" title="Responsible for call detail data.">ast_cdr</a> *lfrom = NULL;
<a name="l00501"></a>00501    <span class="keywordtype">int</span> discard_from = 0;
<a name="l00502"></a>00502    
<a name="l00503"></a>00503    <span class="keywordflow">if</span> (!to || !from)
<a name="l00504"></a>00504       <span class="keywordflow">return</span>;
<a name="l00505"></a>00505 
<a name="l00506"></a>00506    <span class="comment">/* don&apos;t merge into locked CDR&apos;s -- it&apos;s bad business */</span>
<a name="l00507"></a>00507    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(to, <a class="code" href="cdr_8h.html#ad19495bac7dec6a99190f93e21965da6">AST_CDR_FLAG_LOCKED</a>)) {
<a name="l00508"></a>00508       zcdr = to; <span class="comment">/* safety valve? */</span>
<a name="l00509"></a>00509       <span class="keywordflow">while</span> (to-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a>) {
<a name="l00510"></a>00510          lto = to;
<a name="l00511"></a>00511          to = to-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a>;
<a name="l00512"></a>00512       }
<a name="l00513"></a>00513       
<a name="l00514"></a>00514       <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(to, <a class="code" href="cdr_8h.html#ad19495bac7dec6a99190f93e21965da6">AST_CDR_FLAG_LOCKED</a>)) {
<a name="l00515"></a>00515          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Merging into locked CDR... no choice.&quot;</span>);
<a name="l00516"></a>00516          to = zcdr; <span class="comment">/* safety-- if all there are is locked CDR&apos;s, then.... ?? */</span>
<a name="l00517"></a>00517          lto = NULL;
<a name="l00518"></a>00518       }
<a name="l00519"></a>00519    }
<a name="l00520"></a>00520 
<a name="l00521"></a>00521    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(from, <a class="code" href="cdr_8h.html#ad19495bac7dec6a99190f93e21965da6">AST_CDR_FLAG_LOCKED</a>)) {
<a name="l00522"></a>00522       <span class="keyword">struct </span><a class="code" href="structast__cdr.html" title="Responsible for call detail data.">ast_cdr</a> *llfrom = NULL;
<a name="l00523"></a>00523       discard_from = 1;
<a name="l00524"></a>00524       <span class="keywordflow">if</span> (lto) {
<a name="l00525"></a>00525          <span class="comment">/* insert the from stuff after lto */</span>
<a name="l00526"></a>00526          lto-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a> = from;
<a name="l00527"></a>00527          lfrom = from;
<a name="l00528"></a>00528          <span class="keywordflow">while</span> (lfrom &amp;&amp; lfrom-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a>) {
<a name="l00529"></a>00529             <span class="keywordflow">if</span> (!lfrom-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a>-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a>)
<a name="l00530"></a>00530                llfrom = lfrom;
<a name="l00531"></a>00531             lfrom = lfrom-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a>; 
<a name="l00532"></a>00532          }
<a name="l00533"></a>00533          <span class="comment">/* rip off the last entry and put a copy of the to at the end */</span>
<a name="l00534"></a>00534          llfrom-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a> = to;
<a name="l00535"></a>00535          from = lfrom;
<a name="l00536"></a>00536       } <span class="keywordflow">else</span> {
<a name="l00537"></a>00537          <span class="comment">/* save copy of the current *to cdr */</span>
<a name="l00538"></a>00538          <span class="keyword">struct </span><a class="code" href="structast__cdr.html" title="Responsible for call detail data.">ast_cdr</a> tcdr;
<a name="l00539"></a>00539          memcpy(&amp;tcdr, to, <span class="keyword">sizeof</span>(tcdr));
<a name="l00540"></a>00540          <span class="comment">/* copy in the locked from cdr */</span>
<a name="l00541"></a>00541          memcpy(to, from, <span class="keyword">sizeof</span>(*to));
<a name="l00542"></a>00542          lfrom = from;
<a name="l00543"></a>00543          <span class="keywordflow">while</span> (lfrom &amp;&amp; lfrom-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a>) {
<a name="l00544"></a>00544             <span class="keywordflow">if</span> (!lfrom-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a>-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a>)
<a name="l00545"></a>00545                llfrom = lfrom;
<a name="l00546"></a>00546             lfrom = lfrom-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a>; 
<a name="l00547"></a>00547          }
<a name="l00548"></a>00548          from-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a> = NULL;
<a name="l00549"></a>00549          <span class="comment">/* rip off the last entry and put a copy of the to at the end */</span>
<a name="l00550"></a>00550          <span class="keywordflow">if</span> (llfrom == from)
<a name="l00551"></a>00551             to = to-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a> = <a class="code" href="cdr_8h.html#a7e8acc90934bc4647dd675a251d9e6ab" title="Duplicate a record.">ast_cdr_dup</a>(&amp;tcdr);
<a name="l00552"></a>00552          <span class="keywordflow">else</span>
<a name="l00553"></a>00553             to = llfrom-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a> = <a class="code" href="cdr_8h.html#a7e8acc90934bc4647dd675a251d9e6ab" title="Duplicate a record.">ast_cdr_dup</a>(&amp;tcdr);
<a name="l00554"></a>00554          from = lfrom;
<a name="l00555"></a>00555       }
<a name="l00556"></a>00556    }
<a name="l00557"></a>00557    
<a name="l00558"></a>00558    <span class="keywordflow">if</span> (!<a class="code" href="time_8h.html#a1b7c6177ea781fc11512de25805fc144" title="Returns true if the argument is 0,0.">ast_tvzero</a>(from-&gt;<a class="code" href="structast__cdr.html#ad80305b5e16da9c2675d5f057bd69386">start</a>)) {
<a name="l00559"></a>00559       <span class="keywordflow">if</span> (!<a class="code" href="time_8h.html#a1b7c6177ea781fc11512de25805fc144" title="Returns true if the argument is 0,0.">ast_tvzero</a>(to-&gt;<a class="code" href="structast__cdr.html#ad80305b5e16da9c2675d5f057bd69386">start</a>)) {
<a name="l00560"></a>00560          <span class="keywordflow">if</span> (<a class="code" href="time_8h.html#acc9e13e54ed18f92956c748a38f82430" title="Compres two struct timeval instances returning -1, 0, 1 if the first arg is smaller...">ast_tvcmp</a>(to-&gt;<a class="code" href="structast__cdr.html#ad80305b5e16da9c2675d5f057bd69386">start</a>, from-&gt;<a class="code" href="structast__cdr.html#ad80305b5e16da9c2675d5f057bd69386">start</a>) &gt; 0 ) {
<a name="l00561"></a>00561             to-&gt;<a class="code" href="structast__cdr.html#ad80305b5e16da9c2675d5f057bd69386">start</a> = from-&gt;<a class="code" href="structast__cdr.html#ad80305b5e16da9c2675d5f057bd69386">start</a>; <span class="comment">/* use the earliest time */</span>
<a name="l00562"></a>00562             from-&gt;<a class="code" href="structast__cdr.html#ad80305b5e16da9c2675d5f057bd69386">start</a> = <a class="code" href="time_8h.html#af46dec59fc43982d018a757f7b499669" title="Returns a timeval from sec, usec.">ast_tv</a>(0,0); <span class="comment">/* we actively &quot;steal&quot; these values */</span>
<a name="l00563"></a>00563          }
<a name="l00564"></a>00564          <span class="comment">/* else nothing to do */</span>
<a name="l00565"></a>00565       } <span class="keywordflow">else</span> {
<a name="l00566"></a>00566          to-&gt;<a class="code" href="structast__cdr.html#ad80305b5e16da9c2675d5f057bd69386">start</a> = from-&gt;<a class="code" href="structast__cdr.html#ad80305b5e16da9c2675d5f057bd69386">start</a>;
<a name="l00567"></a>00567          from-&gt;<a class="code" href="structast__cdr.html#ad80305b5e16da9c2675d5f057bd69386">start</a> = <a class="code" href="time_8h.html#af46dec59fc43982d018a757f7b499669" title="Returns a timeval from sec, usec.">ast_tv</a>(0,0); <span class="comment">/* we actively &quot;steal&quot; these values */</span>
<a name="l00568"></a>00568       }
<a name="l00569"></a>00569    }
<a name="l00570"></a>00570    <span class="keywordflow">if</span> (!<a class="code" href="time_8h.html#a1b7c6177ea781fc11512de25805fc144" title="Returns true if the argument is 0,0.">ast_tvzero</a>(from-&gt;<a class="code" href="structast__cdr.html#a621c14aed7c59835c5bc93bc88e8f3d9">answer</a>)) {
<a name="l00571"></a>00571       <span class="keywordflow">if</span> (!<a class="code" href="time_8h.html#a1b7c6177ea781fc11512de25805fc144" title="Returns true if the argument is 0,0.">ast_tvzero</a>(to-&gt;<a class="code" href="structast__cdr.html#a621c14aed7c59835c5bc93bc88e8f3d9">answer</a>)) {
<a name="l00572"></a>00572          <span class="keywordflow">if</span> (<a class="code" href="time_8h.html#acc9e13e54ed18f92956c748a38f82430" title="Compres two struct timeval instances returning -1, 0, 1 if the first arg is smaller...">ast_tvcmp</a>(to-&gt;<a class="code" href="structast__cdr.html#a621c14aed7c59835c5bc93bc88e8f3d9">answer</a>, from-&gt;<a class="code" href="structast__cdr.html#a621c14aed7c59835c5bc93bc88e8f3d9">answer</a>) &gt; 0 ) {
<a name="l00573"></a>00573             to-&gt;<a class="code" href="structast__cdr.html#a621c14aed7c59835c5bc93bc88e8f3d9">answer</a> = from-&gt;<a class="code" href="structast__cdr.html#a621c14aed7c59835c5bc93bc88e8f3d9">answer</a>; <span class="comment">/* use the earliest time */</span>
<a name="l00574"></a>00574             from-&gt;<a class="code" href="structast__cdr.html#a621c14aed7c59835c5bc93bc88e8f3d9">answer</a> = <a class="code" href="time_8h.html#af46dec59fc43982d018a757f7b499669" title="Returns a timeval from sec, usec.">ast_tv</a>(0,0); <span class="comment">/* we actively &quot;steal&quot; these values */</span>
<a name="l00575"></a>00575          }
<a name="l00576"></a>00576          <span class="comment">/* we got the earliest answer time, so we&apos;ll settle for that? */</span>
<a name="l00577"></a>00577       } <span class="keywordflow">else</span> {
<a name="l00578"></a>00578          to-&gt;<a class="code" href="structast__cdr.html#a621c14aed7c59835c5bc93bc88e8f3d9">answer</a> = from-&gt;<a class="code" href="structast__cdr.html#a621c14aed7c59835c5bc93bc88e8f3d9">answer</a>;
<a name="l00579"></a>00579          from-&gt;<a class="code" href="structast__cdr.html#a621c14aed7c59835c5bc93bc88e8f3d9">answer</a> = <a class="code" href="time_8h.html#af46dec59fc43982d018a757f7b499669" title="Returns a timeval from sec, usec.">ast_tv</a>(0,0); <span class="comment">/* we actively &quot;steal&quot; these values */</span>
<a name="l00580"></a>00580       }
<a name="l00581"></a>00581    }
<a name="l00582"></a>00582    <span class="keywordflow">if</span> (!<a class="code" href="time_8h.html#a1b7c6177ea781fc11512de25805fc144" title="Returns true if the argument is 0,0.">ast_tvzero</a>(from-&gt;<a class="code" href="structast__cdr.html#af5249cf68dff13dd1dcca5929f4f3a5b">end</a>)) {
<a name="l00583"></a>00583       <span class="keywordflow">if</span> (!<a class="code" href="time_8h.html#a1b7c6177ea781fc11512de25805fc144" title="Returns true if the argument is 0,0.">ast_tvzero</a>(to-&gt;<a class="code" href="structast__cdr.html#af5249cf68dff13dd1dcca5929f4f3a5b">end</a>)) {
<a name="l00584"></a>00584          <span class="keywordflow">if</span> (<a class="code" href="time_8h.html#acc9e13e54ed18f92956c748a38f82430" title="Compres two struct timeval instances returning -1, 0, 1 if the first arg is smaller...">ast_tvcmp</a>(to-&gt;<a class="code" href="structast__cdr.html#af5249cf68dff13dd1dcca5929f4f3a5b">end</a>, from-&gt;<a class="code" href="structast__cdr.html#af5249cf68dff13dd1dcca5929f4f3a5b">end</a>) &lt; 0 ) {
<a name="l00585"></a>00585             to-&gt;<a class="code" href="structast__cdr.html#af5249cf68dff13dd1dcca5929f4f3a5b">end</a> = from-&gt;<a class="code" href="structast__cdr.html#af5249cf68dff13dd1dcca5929f4f3a5b">end</a>; <span class="comment">/* use the latest time */</span>
<a name="l00586"></a>00586             from-&gt;<a class="code" href="structast__cdr.html#af5249cf68dff13dd1dcca5929f4f3a5b">end</a> = <a class="code" href="time_8h.html#af46dec59fc43982d018a757f7b499669" title="Returns a timeval from sec, usec.">ast_tv</a>(0,0); <span class="comment">/* we actively &quot;steal&quot; these values */</span>
<a name="l00587"></a>00587             to-&gt;<a class="code" href="structast__cdr.html#a993dee0d19091c6d48fdeda230fd6be0">duration</a> = to-&gt;<a class="code" href="structast__cdr.html#af5249cf68dff13dd1dcca5929f4f3a5b">end</a>.tv_sec - to-&gt;<a class="code" href="structast__cdr.html#ad80305b5e16da9c2675d5f057bd69386">start</a>.tv_sec;  <span class="comment">/* don&apos;t forget to update the duration, billsec, when we set end */</span>
<a name="l00588"></a>00588             to-&gt;<a class="code" href="structast__cdr.html#a4a98731fed2979292cd6042898671e8d">billsec</a> = <a class="code" href="time_8h.html#a1b7c6177ea781fc11512de25805fc144" title="Returns true if the argument is 0,0.">ast_tvzero</a>(to-&gt;<a class="code" href="structast__cdr.html#a621c14aed7c59835c5bc93bc88e8f3d9">answer</a>) ? 0 : to-&gt;<a class="code" href="structast__cdr.html#af5249cf68dff13dd1dcca5929f4f3a5b">end</a>.tv_sec - to-&gt;<a class="code" href="structast__cdr.html#a621c14aed7c59835c5bc93bc88e8f3d9">answer</a>.tv_sec;
<a name="l00589"></a>00589          }
<a name="l00590"></a>00590          <span class="comment">/* else, nothing to do */</span>
<a name="l00591"></a>00591       } <span class="keywordflow">else</span> {
<a name="l00592"></a>00592          to-&gt;<a class="code" href="structast__cdr.html#af5249cf68dff13dd1dcca5929f4f3a5b">end</a> = from-&gt;<a class="code" href="structast__cdr.html#af5249cf68dff13dd1dcca5929f4f3a5b">end</a>;
<a name="l00593"></a>00593          from-&gt;<a class="code" href="structast__cdr.html#af5249cf68dff13dd1dcca5929f4f3a5b">end</a> = <a class="code" href="time_8h.html#af46dec59fc43982d018a757f7b499669" title="Returns a timeval from sec, usec.">ast_tv</a>(0,0); <span class="comment">/* we actively &quot;steal&quot; these values */</span>
<a name="l00594"></a>00594          to-&gt;<a class="code" href="structast__cdr.html#a993dee0d19091c6d48fdeda230fd6be0">duration</a> = to-&gt;<a class="code" href="structast__cdr.html#af5249cf68dff13dd1dcca5929f4f3a5b">end</a>.tv_sec - to-&gt;<a class="code" href="structast__cdr.html#ad80305b5e16da9c2675d5f057bd69386">start</a>.tv_sec;
<a name="l00595"></a>00595          to-&gt;<a class="code" href="structast__cdr.html#a4a98731fed2979292cd6042898671e8d">billsec</a> = <a class="code" href="time_8h.html#a1b7c6177ea781fc11512de25805fc144" title="Returns true if the argument is 0,0.">ast_tvzero</a>(to-&gt;<a class="code" href="structast__cdr.html#a621c14aed7c59835c5bc93bc88e8f3d9">answer</a>) ? 0 : to-&gt;<a class="code" href="structast__cdr.html#af5249cf68dff13dd1dcca5929f4f3a5b">end</a>.tv_sec - to-&gt;<a class="code" href="structast__cdr.html#a621c14aed7c59835c5bc93bc88e8f3d9">answer</a>.tv_sec;
<a name="l00596"></a>00596       }
<a name="l00597"></a>00597    }
<a name="l00598"></a>00598    <span class="keywordflow">if</span> (to-&gt;<a class="code" href="structast__cdr.html#a1f9669e5d9d64aa831cd9db2dd71534f">disposition</a> &lt; from-&gt;<a class="code" href="structast__cdr.html#a1f9669e5d9d64aa831cd9db2dd71534f">disposition</a>) {
<a name="l00599"></a>00599       to-&gt;<a class="code" href="structast__cdr.html#a1f9669e5d9d64aa831cd9db2dd71534f">disposition</a> = from-&gt;<a class="code" href="structast__cdr.html#a1f9669e5d9d64aa831cd9db2dd71534f">disposition</a>;
<a name="l00600"></a>00600       from-&gt;<a class="code" href="structast__cdr.html#a1f9669e5d9d64aa831cd9db2dd71534f">disposition</a> = <a class="code" href="cdr_8h.html#a2fcd4015b8151a5656489fcfe45409be">AST_CDR_NOANSWER</a>;
<a name="l00601"></a>00601    }
<a name="l00602"></a>00602    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(to-&gt;<a class="code" href="structast__cdr.html#ae7697234189954ec7c6a81b4ab691b85">lastapp</a>) &amp;&amp; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(from-&gt;<a class="code" href="structast__cdr.html#ae7697234189954ec7c6a81b4ab691b85">lastapp</a>)) {
<a name="l00603"></a>00603       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(to-&gt;<a class="code" href="structast__cdr.html#ae7697234189954ec7c6a81b4ab691b85">lastapp</a>, from-&gt;<a class="code" href="structast__cdr.html#ae7697234189954ec7c6a81b4ab691b85">lastapp</a>, <span class="keyword">sizeof</span>(to-&gt;<a class="code" href="structast__cdr.html#ae7697234189954ec7c6a81b4ab691b85">lastapp</a>));
<a name="l00604"></a>00604       from-&gt;<a class="code" href="structast__cdr.html#ae7697234189954ec7c6a81b4ab691b85">lastapp</a>[0] = 0; <span class="comment">/* theft */</span>
<a name="l00605"></a>00605    }
<a name="l00606"></a>00606    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(to-&gt;<a class="code" href="structast__cdr.html#a2176704f41b4368f2dfa94b64bfcfb6a">lastdata</a>) &amp;&amp; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(from-&gt;<a class="code" href="structast__cdr.html#a2176704f41b4368f2dfa94b64bfcfb6a">lastdata</a>)) {
<a name="l00607"></a>00607       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(to-&gt;<a class="code" href="structast__cdr.html#a2176704f41b4368f2dfa94b64bfcfb6a">lastdata</a>, from-&gt;<a class="code" href="structast__cdr.html#a2176704f41b4368f2dfa94b64bfcfb6a">lastdata</a>, <span class="keyword">sizeof</span>(to-&gt;<a class="code" href="structast__cdr.html#a2176704f41b4368f2dfa94b64bfcfb6a">lastdata</a>));
<a name="l00608"></a>00608       from-&gt;<a class="code" href="structast__cdr.html#a2176704f41b4368f2dfa94b64bfcfb6a">lastdata</a>[0] = 0; <span class="comment">/* theft */</span>
<a name="l00609"></a>00609    }
<a name="l00610"></a>00610    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(to-&gt;<a class="code" href="structast__cdr.html#af27d556683a4a28e6564618bcf00bec1">dcontext</a>) &amp;&amp; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(from-&gt;<a class="code" href="structast__cdr.html#af27d556683a4a28e6564618bcf00bec1">dcontext</a>)) {
<a name="l00611"></a>00611       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(to-&gt;<a class="code" href="structast__cdr.html#af27d556683a4a28e6564618bcf00bec1">dcontext</a>, from-&gt;<a class="code" href="structast__cdr.html#af27d556683a4a28e6564618bcf00bec1">dcontext</a>, <span class="keyword">sizeof</span>(to-&gt;<a class="code" href="structast__cdr.html#af27d556683a4a28e6564618bcf00bec1">dcontext</a>));
<a name="l00612"></a>00612       from-&gt;<a class="code" href="structast__cdr.html#af27d556683a4a28e6564618bcf00bec1">dcontext</a>[0] = 0; <span class="comment">/* theft */</span>
<a name="l00613"></a>00613    }
<a name="l00614"></a>00614    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(to-&gt;<a class="code" href="structast__cdr.html#a0d43f7cac6179c7c4f9521f3138195b4">dstchannel</a>) &amp;&amp; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(from-&gt;<a class="code" href="structast__cdr.html#a0d43f7cac6179c7c4f9521f3138195b4">dstchannel</a>)) {
<a name="l00615"></a>00615       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(to-&gt;<a class="code" href="structast__cdr.html#a0d43f7cac6179c7c4f9521f3138195b4">dstchannel</a>, from-&gt;<a class="code" href="structast__cdr.html#a0d43f7cac6179c7c4f9521f3138195b4">dstchannel</a>, <span class="keyword">sizeof</span>(to-&gt;<a class="code" href="structast__cdr.html#a0d43f7cac6179c7c4f9521f3138195b4">dstchannel</a>));
<a name="l00616"></a>00616       from-&gt;<a class="code" href="structast__cdr.html#a0d43f7cac6179c7c4f9521f3138195b4">dstchannel</a>[0] = 0; <span class="comment">/* theft */</span>
<a name="l00617"></a>00617    }
<a name="l00618"></a>00618    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(from-&gt;<a class="code" href="structast__cdr.html#a6396dbd53fd6fedc1fc3ba2743f00eca">channel</a>) &amp;&amp; (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(to-&gt;<a class="code" href="structast__cdr.html#a6396dbd53fd6fedc1fc3ba2743f00eca">channel</a>) || !strncasecmp(from-&gt;<a class="code" href="structast__cdr.html#a6396dbd53fd6fedc1fc3ba2743f00eca">channel</a>, <span class="stringliteral">&quot;Agent/&quot;</span>, 6))) {
<a name="l00619"></a>00619       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(to-&gt;<a class="code" href="structast__cdr.html#a6396dbd53fd6fedc1fc3ba2743f00eca">channel</a>, from-&gt;<a class="code" href="structast__cdr.html#a6396dbd53fd6fedc1fc3ba2743f00eca">channel</a>, <span class="keyword">sizeof</span>(to-&gt;<a class="code" href="structast__cdr.html#a6396dbd53fd6fedc1fc3ba2743f00eca">channel</a>));
<a name="l00620"></a>00620       from-&gt;<a class="code" href="structast__cdr.html#a6396dbd53fd6fedc1fc3ba2743f00eca">channel</a>[0] = 0; <span class="comment">/* theft */</span>
<a name="l00621"></a>00621    }
<a name="l00622"></a>00622    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(to-&gt;<a class="code" href="structast__cdr.html#aa8e4f370559b3fe698f36b3132467f94">src</a>) &amp;&amp; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(from-&gt;<a class="code" href="structast__cdr.html#aa8e4f370559b3fe698f36b3132467f94">src</a>)) {
<a name="l00623"></a>00623       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(to-&gt;<a class="code" href="structast__cdr.html#aa8e4f370559b3fe698f36b3132467f94">src</a>, from-&gt;<a class="code" href="structast__cdr.html#aa8e4f370559b3fe698f36b3132467f94">src</a>, <span class="keyword">sizeof</span>(to-&gt;<a class="code" href="structast__cdr.html#aa8e4f370559b3fe698f36b3132467f94">src</a>));
<a name="l00624"></a>00624       from-&gt;<a class="code" href="structast__cdr.html#aa8e4f370559b3fe698f36b3132467f94">src</a>[0] = 0; <span class="comment">/* theft */</span>
<a name="l00625"></a>00625    }
<a name="l00626"></a>00626    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(to-&gt;<a class="code" href="structast__cdr.html#ab7fd8bddf0ce6987ae5e58fb64cfc9e2">clid</a>) &amp;&amp; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(from-&gt;<a class="code" href="structast__cdr.html#ab7fd8bddf0ce6987ae5e58fb64cfc9e2">clid</a>)) {
<a name="l00627"></a>00627       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(to-&gt;<a class="code" href="structast__cdr.html#ab7fd8bddf0ce6987ae5e58fb64cfc9e2">clid</a>, from-&gt;<a class="code" href="structast__cdr.html#ab7fd8bddf0ce6987ae5e58fb64cfc9e2">clid</a>, <span class="keyword">sizeof</span>(to-&gt;<a class="code" href="structast__cdr.html#ab7fd8bddf0ce6987ae5e58fb64cfc9e2">clid</a>));
<a name="l00628"></a>00628       from-&gt;<a class="code" href="structast__cdr.html#ab7fd8bddf0ce6987ae5e58fb64cfc9e2">clid</a>[0] = 0; <span class="comment">/* theft */</span>
<a name="l00629"></a>00629    }
<a name="l00630"></a>00630    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(to-&gt;<a class="code" href="structast__cdr.html#ab30db746a1bf5c869a5dc9dbfaa864d4">dst</a>) &amp;&amp; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(from-&gt;<a class="code" href="structast__cdr.html#ab30db746a1bf5c869a5dc9dbfaa864d4">dst</a>)) {
<a name="l00631"></a>00631       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(to-&gt;<a class="code" href="structast__cdr.html#ab30db746a1bf5c869a5dc9dbfaa864d4">dst</a>, from-&gt;<a class="code" href="structast__cdr.html#ab30db746a1bf5c869a5dc9dbfaa864d4">dst</a>, <span class="keyword">sizeof</span>(to-&gt;<a class="code" href="structast__cdr.html#ab30db746a1bf5c869a5dc9dbfaa864d4">dst</a>));
<a name="l00632"></a>00632       from-&gt;<a class="code" href="structast__cdr.html#ab30db746a1bf5c869a5dc9dbfaa864d4">dst</a>[0] = 0; <span class="comment">/* theft */</span>
<a name="l00633"></a>00633    }
<a name="l00634"></a>00634    <span class="keywordflow">if</span> (!to-&gt;<a class="code" href="structast__cdr.html#aa2112d5526f7d98a80d5da0abea1cc7d">amaflags</a>)
<a name="l00635"></a>00635       to-&gt;<a class="code" href="structast__cdr.html#aa2112d5526f7d98a80d5da0abea1cc7d">amaflags</a> = <a class="code" href="cdr_8h.html#a91765929568fa1a9d035317aa084495f">AST_CDR_DOCUMENTATION</a>;
<a name="l00636"></a>00636    <span class="keywordflow">if</span> (!from-&gt;<a class="code" href="structast__cdr.html#aa2112d5526f7d98a80d5da0abea1cc7d">amaflags</a>)
<a name="l00637"></a>00637       from-&gt;<a class="code" href="structast__cdr.html#aa2112d5526f7d98a80d5da0abea1cc7d">amaflags</a> = <a class="code" href="cdr_8h.html#a91765929568fa1a9d035317aa084495f">AST_CDR_DOCUMENTATION</a>; <span class="comment">/* make sure both amaflags are set to something (DOC is default) */</span>
<a name="l00638"></a>00638    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(from, <a class="code" href="cdr_8h.html#ad19495bac7dec6a99190f93e21965da6">AST_CDR_FLAG_LOCKED</a>) || (to-&gt;<a class="code" href="structast__cdr.html#aa2112d5526f7d98a80d5da0abea1cc7d">amaflags</a> == <a class="code" href="cdr_8h.html#a91765929568fa1a9d035317aa084495f">AST_CDR_DOCUMENTATION</a> &amp;&amp; from-&gt;<a class="code" href="structast__cdr.html#aa2112d5526f7d98a80d5da0abea1cc7d">amaflags</a> != <a class="code" href="cdr_8h.html#a91765929568fa1a9d035317aa084495f">AST_CDR_DOCUMENTATION</a>)) {
<a name="l00639"></a>00639       to-&gt;<a class="code" href="structast__cdr.html#aa2112d5526f7d98a80d5da0abea1cc7d">amaflags</a> = from-&gt;<a class="code" href="structast__cdr.html#aa2112d5526f7d98a80d5da0abea1cc7d">amaflags</a>;
<a name="l00640"></a>00640    }
<a name="l00641"></a>00641    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(from, <a class="code" href="cdr_8h.html#ad19495bac7dec6a99190f93e21965da6">AST_CDR_FLAG_LOCKED</a>) || (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(to-&gt;<a class="code" href="structast__cdr.html#adfee50d07a98645d4d20b896ce03785a">accountcode</a>) &amp;&amp; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(from-&gt;<a class="code" href="structast__cdr.html#adfee50d07a98645d4d20b896ce03785a">accountcode</a>))) {
<a name="l00642"></a>00642       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(to-&gt;<a class="code" href="structast__cdr.html#adfee50d07a98645d4d20b896ce03785a">accountcode</a>, from-&gt;<a class="code" href="structast__cdr.html#adfee50d07a98645d4d20b896ce03785a">accountcode</a>, <span class="keyword">sizeof</span>(to-&gt;<a class="code" href="structast__cdr.html#adfee50d07a98645d4d20b896ce03785a">accountcode</a>));
<a name="l00643"></a>00643    }
<a name="l00644"></a>00644    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(from, <a class="code" href="cdr_8h.html#ad19495bac7dec6a99190f93e21965da6">AST_CDR_FLAG_LOCKED</a>) || (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(to-&gt;<a class="code" href="structast__cdr.html#a2d480b13820a3a97582a1a138036aa25">userfield</a>) &amp;&amp; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(from-&gt;<a class="code" href="structast__cdr.html#a2d480b13820a3a97582a1a138036aa25">userfield</a>))) {
<a name="l00645"></a>00645       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(to-&gt;<a class="code" href="structast__cdr.html#a2d480b13820a3a97582a1a138036aa25">userfield</a>, from-&gt;<a class="code" href="structast__cdr.html#a2d480b13820a3a97582a1a138036aa25">userfield</a>, <span class="keyword">sizeof</span>(to-&gt;<a class="code" href="structast__cdr.html#a2d480b13820a3a97582a1a138036aa25">userfield</a>));
<a name="l00646"></a>00646    }
<a name="l00647"></a>00647    <span class="comment">/* flags, varsead, ? */</span>
<a name="l00648"></a>00648    <a class="code" href="cdr_8c.html#aaae18c4315dcf269cbbf0d7cd8bb5b9b">cdr_merge_vars</a>(from, to);
<a name="l00649"></a>00649 
<a name="l00650"></a>00650    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(from, <a class="code" href="cdr_8h.html#a441ba62cb48c35234960641c94f2363b">AST_CDR_FLAG_KEEP_VARS</a>))
<a name="l00651"></a>00651       <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(to, <a class="code" href="cdr_8h.html#a441ba62cb48c35234960641c94f2363b">AST_CDR_FLAG_KEEP_VARS</a>);
<a name="l00652"></a>00652    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(from, <a class="code" href="cdr_8h.html#ab7d9caea71bea12314af4b117a35c3f9">AST_CDR_FLAG_POSTED</a>))
<a name="l00653"></a>00653       <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(to, <a class="code" href="cdr_8h.html#ab7d9caea71bea12314af4b117a35c3f9">AST_CDR_FLAG_POSTED</a>);
<a name="l00654"></a>00654    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(from, <a class="code" href="cdr_8h.html#ad19495bac7dec6a99190f93e21965da6">AST_CDR_FLAG_LOCKED</a>))
<a name="l00655"></a>00655       <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(to, <a class="code" href="cdr_8h.html#ad19495bac7dec6a99190f93e21965da6">AST_CDR_FLAG_LOCKED</a>);
<a name="l00656"></a>00656    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(from, <a class="code" href="cdr_8h.html#a6ddf2db5d7c9855e6fdd86179dd88fd9">AST_CDR_FLAG_CHILD</a>))
<a name="l00657"></a>00657       <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(to, <a class="code" href="cdr_8h.html#a6ddf2db5d7c9855e6fdd86179dd88fd9">AST_CDR_FLAG_CHILD</a>);
<a name="l00658"></a>00658    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(from, <a class="code" href="cdr_8h.html#ad1c97f787a4ae3481dd9b48fef118572">AST_CDR_FLAG_POST_DISABLED</a>))
<a name="l00659"></a>00659       <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(to, <a class="code" href="cdr_8h.html#ad1c97f787a4ae3481dd9b48fef118572">AST_CDR_FLAG_POST_DISABLED</a>);
<a name="l00660"></a>00660 
<a name="l00661"></a>00661    <span class="comment">/* last, but not least, we need to merge any forked CDRs to the &apos;to&apos; cdr */</span>
<a name="l00662"></a>00662    <span class="keywordflow">while</span> (from-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a>) {
<a name="l00663"></a>00663       <span class="comment">/* just rip &apos;em off the &apos;from&apos; and insert them on the &apos;to&apos; */</span>
<a name="l00664"></a>00664       zcdr = from-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a>;
<a name="l00665"></a>00665       from-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a> = zcdr-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a>;
<a name="l00666"></a>00666       zcdr-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a> = NULL;
<a name="l00667"></a>00667       <span class="comment">/* zcdr is now ripped from the current list; */</span>
<a name="l00668"></a>00668       <a class="code" href="cdr_8h.html#a0a3ae8676893f50922e373323f4298fe">ast_cdr_append</a>(to, zcdr);
<a name="l00669"></a>00669    }
<a name="l00670"></a>00670    <span class="keywordflow">if</span> (discard_from)
<a name="l00671"></a>00671       <a class="code" href="cdr_8h.html#a0a672ffbd29adf8622596a36ccb25e65" title="Discard and free a CDR record.">ast_cdr_discard</a>(from);
<a name="l00672"></a>00672 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a46d2f4a55a1be9b94fef1a87ac3f7fbb"></a><!-- doxytag: member="cdr.c::ast_cdr_noanswer" ref="a46d2f4a55a1be9b94fef1a87ac3f7fbb" args="(struct ast_cdr *cdr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_cdr_noanswer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cdr.html">ast_cdr</a> *&nbsp;</td>
          <td class="paramname"> <em>cdr</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>A call wasn't answered. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>cdr</em>&nbsp;</td><td>the cdr you wish to associate with the call Marks the channel disposition as "NO ANSWER" Will skip CDR's in chain with ANS_LOCK bit set. (see forkCDR() application. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00727">727</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cdr_8h_source.html#l00032">AST_CDR_FLAG_LOCKED</a>, <a class="el" href="cdr_8h_source.html#l00031">AST_CDR_FLAG_POSTED</a>, <a class="el" href="cdr_8h_source.html#l00047">AST_CDR_NOANSWER</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="adsistub_8c_source.html#l00049">chan</a>, <a class="el" href="cdr_8h_source.html#l00079">ast_cdr::channel</a>, <a class="el" href="cdr_8h_source.html#l00097">ast_cdr::disposition</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, and <a class="el" href="cdr_8h_source.html#l00113">ast_cdr::next</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l00746">ast_cdr_disposition()</a>, <a class="el" href="app__dial_8c_source.html#l00607">handle_cause()</a>, <a class="el" href="app__queue_8c_source.html#l05031">queue_exec()</a>, <a class="el" href="app__queue_8c_source.html#l03569">try_calling()</a>, and <a class="el" href="app__dial_8c_source.html#l00818">wait_for_answer()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00728"></a>00728 {
<a name="l00729"></a>00729    <span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>; 
<a name="l00730"></a>00730 
<a name="l00731"></a>00731    <span class="keywordflow">while</span> (cdr) {
<a name="l00732"></a>00732       <span class="keywordflow">if</span> (!<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(cdr, <a class="code" href="cdr_8h.html#ad19495bac7dec6a99190f93e21965da6">AST_CDR_FLAG_LOCKED</a>)) {
<a name="l00733"></a>00733          chan = !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(cdr-&gt;<a class="code" href="structast__cdr.html#a6396dbd53fd6fedc1fc3ba2743f00eca">channel</a>) ? cdr-&gt;<a class="code" href="structast__cdr.html#a6396dbd53fd6fedc1fc3ba2743f00eca">channel</a> : <span class="stringliteral">&quot;&lt;unknown&gt;&quot;</span>;
<a name="l00734"></a>00734          <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(cdr, <a class="code" href="cdr_8h.html#ab7d9caea71bea12314af4b117a35c3f9">AST_CDR_FLAG_POSTED</a>))
<a name="l00735"></a>00735             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;CDR on channel &apos;%s&apos; already posted\n&quot;</span>, chan);
<a name="l00736"></a>00736          <span class="keywordflow">if</span> (cdr-&gt;<a class="code" href="structast__cdr.html#a1f9669e5d9d64aa831cd9db2dd71534f">disposition</a> &lt; <a class="code" href="cdr_8h.html#a2fcd4015b8151a5656489fcfe45409be">AST_CDR_NOANSWER</a>)
<a name="l00737"></a>00737             cdr-&gt;<a class="code" href="structast__cdr.html#a1f9669e5d9d64aa831cd9db2dd71534f">disposition</a> = <a class="code" href="cdr_8h.html#a2fcd4015b8151a5656489fcfe45409be">AST_CDR_NOANSWER</a>;
<a name="l00738"></a>00738       }
<a name="l00739"></a>00739       cdr = cdr-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a>;
<a name="l00740"></a>00740    }
<a name="l00741"></a>00741 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="abdbcf7f728cbacea0b28bf9c51f99b92"></a><!-- doxytag: member="cdr.c::ast_cdr_register" ref="abdbcf7f728cbacea0b28bf9c51f99b92" args="(const char *name, const char *desc, ast_cdrbe be)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_cdr_register </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>desc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="cdr_8h.html#a8073f48d56dc9052d641a320ff20b04a">ast_cdrbe</a>&nbsp;</td>
          <td class="paramname"> <em>be</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Register a CDR handling engine. </p>
<p>Register a CDR driver. Each registered CDR driver generates a CDR </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 on success, -1 on failure </dd></dl>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00108">108</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="linkedlists_8h_source.html#l00702">AST_RWLIST_INSERT_HEAD</a>, <a class="el" href="linkedlists_8h_source.html#l00493">AST_RWLIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, <a class="el" href="cdr_8c_source.html#l00060">ast_cdr_beitem::be</a>, <a class="el" href="cdr_8c_source.html#l00059">ast_cdr_beitem::desc</a>, <a class="el" href="structast__cdr__beitem.html#af871bc67d8f811f5eb06dd7652cd6231">ast_cdr_beitem::list</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, and <a class="el" href="cdr_8c_source.html#l00058">ast_cdr_beitem::name</a>.</p>

<p>Referenced by <a class="el" href="cdr__pgsql_8c_source.html#l00362">config_module()</a>, <a class="el" href="cdr__manager_8c_source.html#l00055">load_config()</a>, <a class="el" href="cdr__adaptive__odbc_8c_source.html#l00699">load_module()</a>, <a class="el" href="cdr__odbc_8c_source.html#l00152">odbc_load_module()</a>, and <a class="el" href="cdr__adaptive__odbc_8c_source.html#l00684">unload_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00109"></a>00109 {
<a name="l00110"></a>00110    <span class="keyword">struct </span><a class="code" href="structast__cdr__beitem.html">ast_cdr_beitem</a> *i = NULL;
<a name="l00111"></a>00111 
<a name="l00112"></a>00112    <span class="keywordflow">if</span> (!<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>)
<a name="l00113"></a>00113       <span class="keywordflow">return</span> -1;
<a name="l00114"></a>00114 
<a name="l00115"></a>00115    <span class="keywordflow">if</span> (!<a class="code" href="structast__cdr__beitem.html#ac91a6afe8445130d877f8c6a175138de">be</a>) {
<a name="l00116"></a>00116       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;CDR engine &apos;%s&apos; lacks backend\n&quot;</span>, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l00117"></a>00117       <span class="keywordflow">return</span> -1;
<a name="l00118"></a>00118    }
<a name="l00119"></a>00119 
<a name="l00120"></a>00120    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structbe__list.html">be_list</a>);
<a name="l00121"></a>00121    <a class="code" href="linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;<a class="code" href="structbe__list.html">be_list</a>, i, <a class="code" href="structast__cdr__beitem.html#af871bc67d8f811f5eb06dd7652cd6231">list</a>) {
<a name="l00122"></a>00122       <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, i-&gt;<a class="code" href="structast__cdr__beitem.html#a9997d8ee2df51d18efed254a5aa016fd">name</a>)) {
<a name="l00123"></a>00123          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Already have a CDR backend called &apos;%s&apos;\n&quot;</span>, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l00124"></a>00124          <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structbe__list.html">be_list</a>);
<a name="l00125"></a>00125          <span class="keywordflow">return</span> -1;
<a name="l00126"></a>00126       }
<a name="l00127"></a>00127    }
<a name="l00128"></a>00128 
<a name="l00129"></a>00129    <span class="keywordflow">if</span> (!(i = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*i))))  
<a name="l00130"></a>00130       <span class="keywordflow">return</span> -1;
<a name="l00131"></a>00131 
<a name="l00132"></a>00132    i-&gt;<a class="code" href="structast__cdr__beitem.html#ac91a6afe8445130d877f8c6a175138de">be</a> = <a class="code" href="structast__cdr__beitem.html#ac91a6afe8445130d877f8c6a175138de">be</a>;
<a name="l00133"></a>00133    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(i-&gt;<a class="code" href="structast__cdr__beitem.html#a9997d8ee2df51d18efed254a5aa016fd">name</a>, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="keyword">sizeof</span>(i-&gt;<a class="code" href="structast__cdr__beitem.html#a9997d8ee2df51d18efed254a5aa016fd">name</a>));
<a name="l00134"></a>00134    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(i-&gt;<a class="code" href="structast__cdr__beitem.html#acedc9527b6888739004d0f25096af635">desc</a>, <a class="code" href="channel_8c.html#a710bce51374aba96ab04912897666c35">desc</a>, <span class="keyword">sizeof</span>(i-&gt;<a class="code" href="structast__cdr__beitem.html#acedc9527b6888739004d0f25096af635">desc</a>));
<a name="l00135"></a>00135 
<a name="l00136"></a>00136    <a class="code" href="linkedlists_8h.html#aacc5f6b7c25e361d11d40137fd55a8e8">AST_RWLIST_INSERT_HEAD</a>(&amp;<a class="code" href="structbe__list.html">be_list</a>, i, <a class="code" href="structast__cdr__beitem.html#af871bc67d8f811f5eb06dd7652cd6231">list</a>);
<a name="l00137"></a>00137    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structbe__list.html">be_list</a>);
<a name="l00138"></a>00138 
<a name="l00139"></a>00139    <span class="keywordflow">return</span> 0;
<a name="l00140"></a>00140 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="adb13319aaaac36b51cb9060ecaae5936"></a><!-- doxytag: member="cdr.c::ast_cdr_reset" ref="adb13319aaaac36b51cb9060ecaae5936" args="(struct ast_cdr *cdr, struct ast_flags *_flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_cdr_reset </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cdr.html">ast_cdr</a> *&nbsp;</td>
          <td class="paramname"> <em>cdr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__flags.html">ast_flags</a> *&nbsp;</td>
          <td class="paramname"> <em>flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reset the detail record, optionally posting it first. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>cdr</em>&nbsp;</td><td>which cdr to act upon </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>flags</em>&nbsp;</td><td>|AST_CDR_FLAG_POSTED whether or not to post the cdr first before resetting it |AST_CDR_FLAG_LOCKED whether or not to reset locked CDR's </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l01062">1062</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cdr_8h_source.html#l00089">ast_cdr::answer</a>, <a class="el" href="cdr_8c_source.html#l01234">ast_cdr_detach()</a>, <a class="el" href="cdr_8c_source.html#l00168">ast_cdr_dup()</a>, <a class="el" href="cdr_8c_source.html#l00879">ast_cdr_end()</a>, <a class="el" href="cdr_8h_source.html#l00030">AST_CDR_FLAG_KEEP_VARS</a>, <a class="el" href="cdr_8h_source.html#l00032">AST_CDR_FLAG_LOCKED</a>, <a class="el" href="cdr_8h_source.html#l00034">AST_CDR_FLAG_POST_DISABLED</a>, <a class="el" href="cdr_8h_source.html#l00040">AST_CDR_FLAG_POST_ENABLE</a>, <a class="el" href="cdr_8h_source.html#l00031">AST_CDR_FLAG_POSTED</a>, <a class="el" href="cdr_8c_source.html#l00407">ast_cdr_free_vars()</a>, <a class="el" href="cdr_8h_source.html#l00047">AST_CDR_NOANSWER</a>, <a class="el" href="cdr_8c_source.html#l00674">ast_cdr_start()</a>, <a class="el" href="utils_8h_source.html#l00075">ast_clear_flag</a>, <a class="el" href="utils_8h_source.html#l00082">ast_copy_flags</a>, <a class="el" href="utils_8h_source.html#l00194">AST_FLAGS_ALL</a>, <a class="el" href="utils_8h_source.html#l00068">ast_set_flag</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="cdr_8h_source.html#l00095">ast_cdr::billsec</a>, <a class="el" href="cdr_8h_source.html#l00097">ast_cdr::disposition</a>, <a class="el" href="cdr_8h_source.html#l00093">ast_cdr::duration</a>, <a class="el" href="cdr_8h_source.html#l00091">ast_cdr::end</a>, <a class="el" href="cdr_8h_source.html#l00113">ast_cdr::next</a>, and <a class="el" href="cdr_8h_source.html#l00087">ast_cdr::start</a>.</p>

<p>Referenced by <a class="el" href="app__forkcdr_8c_source.html#l00176">ast_cdr_fork()</a>, <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="app__disa_8c_source.html#l00143">disa_exec()</a>, and <a class="el" href="pbx_8c_source.html#l08566">pbx_builtin_resetcdr()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01063"></a>01063 {
<a name="l01064"></a>01064    <span class="keyword">struct </span><a class="code" href="structast__cdr.html" title="Responsible for call detail data.">ast_cdr</a> *duplicate;
<a name="l01065"></a>01065    <span class="keyword">struct </span><a class="code" href="structast__flags.html" title="Structure used to handle boolean flags.">ast_flags</a> <a class="code" href="structast__flags.html#ac92588540e8c1d014a08cd8a45462b19">flags</a> = { 0 };
<a name="l01066"></a>01066 
<a name="l01067"></a>01067    <span class="keywordflow">if</span> (_flags)
<a name="l01068"></a>01068       <a class="code" href="utils_8h.html#ab9da1c7265610eff83ed6146f104dc6f">ast_copy_flags</a>(&amp;flags, _flags, <a class="code" href="utils_8h.html#afb8683b4d96960d7a82a86a974a57599">AST_FLAGS_ALL</a>);
<a name="l01069"></a>01069 
<a name="l01070"></a>01070    <span class="keywordflow">for</span> ( ; cdr ; cdr = cdr-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a>) {
<a name="l01071"></a>01071       <span class="comment">/* Detach if post is requested */</span>
<a name="l01072"></a>01072       <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="cdr_8h.html#ad19495bac7dec6a99190f93e21965da6">AST_CDR_FLAG_LOCKED</a>) || !<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(cdr, <a class="code" href="cdr_8h.html#ad19495bac7dec6a99190f93e21965da6">AST_CDR_FLAG_LOCKED</a>)) {
<a name="l01073"></a>01073          <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="cdr_8h.html#ab7d9caea71bea12314af4b117a35c3f9">AST_CDR_FLAG_POSTED</a>)) {
<a name="l01074"></a>01074             <a class="code" href="cdr_8h.html#a9884cbdaef20e9f266bc2220772bf52b" title="End a call.">ast_cdr_end</a>(cdr);
<a name="l01075"></a>01075             <span class="keywordflow">if</span> ((duplicate = <a class="code" href="cdr_8h.html#a7e8acc90934bc4647dd675a251d9e6ab" title="Duplicate a record.">ast_cdr_dup</a>(cdr))) {
<a name="l01076"></a>01076                <a class="code" href="cdr_8h.html#aaac5bba86e430704119f70df937701f8" title="Detaches the detail record for posting (and freeing) either now or at a later time...">ast_cdr_detach</a>(duplicate);
<a name="l01077"></a>01077             }
<a name="l01078"></a>01078             <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(cdr, <a class="code" href="cdr_8h.html#ab7d9caea71bea12314af4b117a35c3f9">AST_CDR_FLAG_POSTED</a>);
<a name="l01079"></a>01079          }
<a name="l01080"></a>01080 
<a name="l01081"></a>01081          <span class="comment">/* enable CDR only */</span>
<a name="l01082"></a>01082          <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="cdr_8h.html#a171c14e04cc5b9f62279f8e8d5f0aaa1">AST_CDR_FLAG_POST_ENABLE</a>)) {
<a name="l01083"></a>01083             <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(cdr, <a class="code" href="cdr_8h.html#ad1c97f787a4ae3481dd9b48fef118572">AST_CDR_FLAG_POST_DISABLED</a>);
<a name="l01084"></a>01084             <span class="keywordflow">continue</span>;
<a name="l01085"></a>01085          }
<a name="l01086"></a>01086 
<a name="l01087"></a>01087          <span class="comment">/* clear variables */</span>
<a name="l01088"></a>01088          <span class="keywordflow">if</span> (!<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="cdr_8h.html#a441ba62cb48c35234960641c94f2363b">AST_CDR_FLAG_KEEP_VARS</a>)) {
<a name="l01089"></a>01089             <a class="code" href="cdr_8h.html#a9a823bcb3824753f08351a8ed7a25b6f">ast_cdr_free_vars</a>(cdr, 0);
<a name="l01090"></a>01090          }
<a name="l01091"></a>01091 
<a name="l01092"></a>01092          <span class="comment">/* Reset to initial state */</span>
<a name="l01093"></a>01093          <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(cdr, <a class="code" href="utils_8h.html#afb8683b4d96960d7a82a86a974a57599">AST_FLAGS_ALL</a>); 
<a name="l01094"></a>01094          memset(&amp;cdr-&gt;<a class="code" href="structast__cdr.html#ad80305b5e16da9c2675d5f057bd69386">start</a>, 0, <span class="keyword">sizeof</span>(cdr-&gt;<a class="code" href="structast__cdr.html#ad80305b5e16da9c2675d5f057bd69386">start</a>));
<a name="l01095"></a>01095          memset(&amp;cdr-&gt;<a class="code" href="structast__cdr.html#af5249cf68dff13dd1dcca5929f4f3a5b">end</a>, 0, <span class="keyword">sizeof</span>(cdr-&gt;<a class="code" href="structast__cdr.html#af5249cf68dff13dd1dcca5929f4f3a5b">end</a>));
<a name="l01096"></a>01096          memset(&amp;cdr-&gt;<a class="code" href="structast__cdr.html#a621c14aed7c59835c5bc93bc88e8f3d9">answer</a>, 0, <span class="keyword">sizeof</span>(cdr-&gt;<a class="code" href="structast__cdr.html#a621c14aed7c59835c5bc93bc88e8f3d9">answer</a>));
<a name="l01097"></a>01097          cdr-&gt;<a class="code" href="structast__cdr.html#a4a98731fed2979292cd6042898671e8d">billsec</a> = 0;
<a name="l01098"></a>01098          cdr-&gt;<a class="code" href="structast__cdr.html#a993dee0d19091c6d48fdeda230fd6be0">duration</a> = 0;
<a name="l01099"></a>01099          <a class="code" href="cdr_8h.html#af788ef701483a64b77656f272843bcd4" title="Start a call.">ast_cdr_start</a>(cdr);
<a name="l01100"></a>01100          cdr-&gt;<a class="code" href="structast__cdr.html#a1f9669e5d9d64aa831cd9db2dd71534f">disposition</a> = <a class="code" href="cdr_8h.html#a2fcd4015b8151a5656489fcfe45409be">AST_CDR_NOANSWER</a>;
<a name="l01101"></a>01101       }
<a name="l01102"></a>01102    }
<a name="l01103"></a>01103 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3e3762a7867ecfa87531598bb8050874"></a><!-- doxytag: member="cdr.c::ast_cdr_serialize_variables" ref="a3e3762a7867ecfa87531598bb8050874" args="(struct ast_cdr *cdr, struct ast_str **buf, char delim, char sep, int recur)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_cdr_serialize_variables </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cdr.html">ast_cdr</a> *&nbsp;</td>
          <td class="paramname"> <em>cdr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__str.html">ast_str</a> **&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>delim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&nbsp;</td>
          <td class="paramname"> <em>sep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>recur</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00362">362</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cdr_8c_source.html#l00219">ast_cdr_getvar()</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="strings_8h_source.html#l00846">ast_str_append()</a>, <a class="el" href="strings_8h_source.html#l00431">ast_str_reset()</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="chanvars_8c_source.html#l00065">ast_var_name()</a>, <a class="el" href="chanvars_8c_source.html#l00085">ast_var_value()</a>, <a class="el" href="cdr_8c_source.html#l00285">cdr_readonly_vars</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="cdr_8h_source.html#l00113">ast_cdr::next</a>, <a class="el" href="res__adsi_8c_source.html#l00893">total</a>, <a class="el" href="ast__expr2f_8c_source.html#l00613">var</a>, and <a class="el" href="cdr_8h_source.html#l00111">ast_cdr::varshead</a>.</p>

<p>Referenced by <a class="el" href="cli_8c_source.html#l01268">handle_showchan()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00363"></a>00363 {
<a name="l00364"></a>00364    <span class="keyword">struct </span><a class="code" href="structast__var__t.html">ast_var_t</a> *variables;
<a name="l00365"></a>00365    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>, *<a class="code" href="structval.html">val</a>;
<a name="l00366"></a>00366    <span class="keywordtype">char</span> *tmp;
<a name="l00367"></a>00367    <span class="keywordtype">char</span> workspace[256];
<a name="l00368"></a>00368    <span class="keywordtype">int</span> <a class="code" href="res__adsi_8c.html#ac7af894858cf396a219d632f40afdc8d">total</a> = 0, x = 0, i;
<a name="l00369"></a>00369 
<a name="l00370"></a>00370    <a class="code" href="strings_8h.html#a7820deea616cbb2e28f16d518de91c80" title="Reset the content of a dynamic string. Useful before a series of ast_str_append.">ast_str_reset</a>(*buf);
<a name="l00371"></a>00371 
<a name="l00372"></a>00372    <span class="keywordflow">for</span> (; cdr; cdr = recur ? cdr-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a> : NULL) {
<a name="l00373"></a>00373       <span class="keywordflow">if</span> (++x &gt; 1)
<a name="l00374"></a>00374          <a class="code" href="strings_8h.html#a85cd5a8ef499e39d22b4bfeb8b9a64f7" title="Append to a thread local dynamic string.">ast_str_append</a>(buf, 0, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00375"></a>00375 
<a name="l00376"></a>00376       <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(&amp;cdr-&gt;<a class="code" href="structast__cdr.html#a9ffb22045a8f14bef8f2137cd779ab25">varshead</a>, variables, entries) {
<a name="l00377"></a>00377          <span class="keywordflow">if</span> (variables &amp;&amp;
<a name="l00378"></a>00378              (var = <a class="code" href="chanvars_8h.html#a356a31cd608ec07d3668dcd589be49d8">ast_var_name</a>(variables)) &amp;&amp; (val = <a class="code" href="chanvars_8h.html#a8e0081172db71c5021d20706c50d959c">ast_var_value</a>(variables)) &amp;&amp;
<a name="l00379"></a>00379              !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(var) &amp;&amp; !<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(val)) {
<a name="l00380"></a>00380             <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a85cd5a8ef499e39d22b4bfeb8b9a64f7" title="Append to a thread local dynamic string.">ast_str_append</a>(buf, 0, <span class="stringliteral">&quot;level %d: %s%c%s%c&quot;</span>, x, var, delim, val, sep) &lt; 0) {
<a name="l00381"></a>00381                <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Data Buffer Size Exceeded!\n&quot;</span>);
<a name="l00382"></a>00382                <span class="keywordflow">break</span>;
<a name="l00383"></a>00383             } <span class="keywordflow">else</span>
<a name="l00384"></a>00384                total++;
<a name="l00385"></a>00385          } <span class="keywordflow">else</span> 
<a name="l00386"></a>00386             <span class="keywordflow">break</span>;
<a name="l00387"></a>00387       }
<a name="l00388"></a>00388 
<a name="l00389"></a>00389       <span class="keywordflow">for</span> (i = 0; <a class="code" href="cdr_8c.html#a62566fff085d3e4fd5843a6b70413ee1">cdr_readonly_vars</a>[i]; i++) {
<a name="l00390"></a>00390          workspace[0] = 0; <span class="comment">/* null out the workspace, because the cdr_get_tv() won&apos;t write anything if time is NULL, so you get old vals */</span>
<a name="l00391"></a>00391          <a class="code" href="cdr_8h.html#a7e49e9d173fdc79d0567337f96a648a1">ast_cdr_getvar</a>(cdr, <a class="code" href="cdr_8c.html#a62566fff085d3e4fd5843a6b70413ee1">cdr_readonly_vars</a>[i], &amp;tmp, workspace, <span class="keyword">sizeof</span>(workspace), 0, 0);
<a name="l00392"></a>00392          <span class="keywordflow">if</span> (!tmp)
<a name="l00393"></a>00393             <span class="keywordflow">continue</span>;
<a name="l00394"></a>00394          
<a name="l00395"></a>00395          <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a85cd5a8ef499e39d22b4bfeb8b9a64f7" title="Append to a thread local dynamic string.">ast_str_append</a>(buf, 0, <span class="stringliteral">&quot;level %d: %s%c%s%c&quot;</span>, x, <a class="code" href="cdr_8c.html#a62566fff085d3e4fd5843a6b70413ee1">cdr_readonly_vars</a>[i], delim, tmp, sep) &lt; 0) {
<a name="l00396"></a>00396             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Data Buffer Size Exceeded!\n&quot;</span>);
<a name="l00397"></a>00397             <span class="keywordflow">break</span>;
<a name="l00398"></a>00398          } <span class="keywordflow">else</span>
<a name="l00399"></a>00399             total++;
<a name="l00400"></a>00400       }
<a name="l00401"></a>00401    }
<a name="l00402"></a>00402 
<a name="l00403"></a>00403    <span class="keywordflow">return</span> total;
<a name="l00404"></a>00404 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af6bbc762c1482a5489a761733d785813"></a><!-- doxytag: member="cdr.c::ast_cdr_setaccount" ref="af6bbc762c1482a5489a761733d785813" args="(struct ast_channel *chan, const char *account)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_cdr_setaccount </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>account</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set account code, will generate AMI event. </p>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00936">936</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cdr_8h_source.html#l00101">ast_cdr::accountcode</a>, <a class="el" href="chan__iax2_8c_source.html#l00328">accountcode</a>, <a class="el" href="cdr_8h_source.html#l00032">AST_CDR_FLAG_LOCKED</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="stringfields_8h_source.html#l00285">ast_string_field_set</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="adsistub_8c_source.html#l00059">buf</a>, <a class="el" href="channel_8h_source.html#l00422">ast_channel::cdr</a>, <a class="el" href="manager_8h_source.html#l00062">EVENT_FLAG_CALL</a>, <a class="el" href="manager_8h_source.html#l00181">manager_event</a>, and <a class="el" href="cdr_8h_source.html#l00113">ast_cdr::next</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l03851">__ast_request_and_dial()</a>, <a class="el" href="features_8c_source.html#l02441">ast_bridge_call()</a>, <a class="el" href="channel_8c_source.html#l03779">ast_call_forward()</a>, <a class="el" href="pbx_8c_source.html#l08106">ast_pbx_outgoing_app()</a>, <a class="el" href="pbx_8c_source.html#l07940">ast_pbx_outgoing_exten()</a>, <a class="el" href="app__authenticate_8c_source.html#l00108">auth_exec()</a>, <a class="el" href="func__cdr_8c_source.html#l00220">cdr_write()</a>, and <a class="el" href="app__rpt_8c_source.html#l05280">rpt_call()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00937"></a>00937 {
<a name="l00938"></a>00938    <span class="keyword">struct </span><a class="code" href="structast__cdr.html" title="Responsible for call detail data.">ast_cdr</a> *cdr = chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>;
<a name="l00939"></a>00939    <span class="keywordtype">char</span> <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[BUFSIZ/2] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00940"></a>00940    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(chan-&gt;accountcode))
<a name="l00941"></a>00941       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(buf, chan-&gt;accountcode, <span class="keyword">sizeof</span>(buf));
<a name="l00942"></a>00942 
<a name="l00943"></a>00943    <a class="code" href="stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d" title="Set a field to a simple string value.">ast_string_field_set</a>(chan, <a class="code" href="chan__iax2_8c.html#adfee50d07a98645d4d20b896ce03785a">accountcode</a>, account);
<a name="l00944"></a>00944    <span class="keywordflow">for</span> ( ; cdr ; cdr = cdr-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a>) {
<a name="l00945"></a>00945       <span class="keywordflow">if</span> (!<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(cdr, <a class="code" href="cdr_8h.html#ad19495bac7dec6a99190f93e21965da6">AST_CDR_FLAG_LOCKED</a>)) {
<a name="l00946"></a>00946          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(cdr-&gt;<a class="code" href="structast__cdr.html#adfee50d07a98645d4d20b896ce03785a">accountcode</a>, chan-&gt;accountcode, <span class="keyword">sizeof</span>(cdr-&gt;<a class="code" href="structast__cdr.html#adfee50d07a98645d4d20b896ce03785a">accountcode</a>));
<a name="l00947"></a>00947       }
<a name="l00948"></a>00948    }
<a name="l00949"></a>00949 
<a name="l00950"></a>00950    <span class="comment">/* Signal change of account code to manager */</span>
<a name="l00951"></a>00951    <a class="code" href="manager_8h.html#a1ef0ee0044dbbeb4c3a5abc6c046b208" title="External routines may send asterisk manager events this way.">manager_event</a>(<a class="code" href="manager_8h.html#ab5db3cc603d7e798d61cb4cd94fbb4e2">EVENT_FLAG_CALL</a>, <span class="stringliteral">&quot;NewAccountCode&quot;</span>, <span class="stringliteral">&quot;Channel: %s\r\nUniqueid: %s\r\nAccountCode: %s\r\nOldAccountCode: %s\r\n&quot;</span>, chan-&gt;name, chan-&gt;uniqueid, chan-&gt;accountcode, buf);
<a name="l00952"></a>00952    <span class="keywordflow">return</span> 0;
<a name="l00953"></a>00953 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad3b2de5366d17e05d07af1c3b9e79d0f"></a><!-- doxytag: member="cdr.c::ast_cdr_setamaflags" ref="ad3b2de5366d17e05d07af1c3b9e79d0f" args="(struct ast_channel *chan, const char *flag)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_cdr_setamaflags </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>flag</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set AMA flags for channel. </p>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00955">955</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cdr_8h_source.html#l00099">ast_cdr::amaflags</a>, <a class="el" href="cdr_8c_source.html#l01016">ast_cdr_amaflags2int()</a>, <a class="el" href="cdr_8h_source.html#l00032">AST_CDR_FLAG_LOCKED</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="channel_8h_source.html#l00422">ast_channel::cdr</a>, and <a class="el" href="cdr_8h_source.html#l00113">ast_cdr::next</a>.</p>

<p>Referenced by <a class="el" href="func__cdr_8c_source.html#l00220">cdr_write()</a>, and <a class="el" href="pbx_8c_source.html#l08584">pbx_builtin_setamaflags()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00956"></a>00956 {
<a name="l00957"></a>00957    <span class="keyword">struct </span><a class="code" href="structast__cdr.html" title="Responsible for call detail data.">ast_cdr</a> *cdr;
<a name="l00958"></a>00958    <span class="keywordtype">int</span> newflag = <a class="code" href="cdr_8h.html#a5c2d2dee484a1ad9dbef128c11a2b693" title="Convert a string to a detail record AMA flag.">ast_cdr_amaflags2int</a>(flag);
<a name="l00959"></a>00959    <span class="keywordflow">if</span> (newflag) {
<a name="l00960"></a>00960       <span class="keywordflow">for</span> (cdr = chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>; cdr; cdr = cdr-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a>) {
<a name="l00961"></a>00961          <span class="keywordflow">if</span> (!<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(cdr, <a class="code" href="cdr_8h.html#ad19495bac7dec6a99190f93e21965da6">AST_CDR_FLAG_LOCKED</a>)) {
<a name="l00962"></a>00962             cdr-&gt;<a class="code" href="structast__cdr.html#aa2112d5526f7d98a80d5da0abea1cc7d">amaflags</a> = newflag;
<a name="l00963"></a>00963          }
<a name="l00964"></a>00964       }
<a name="l00965"></a>00965    }
<a name="l00966"></a>00966 
<a name="l00967"></a>00967    <span class="keywordflow">return</span> 0;
<a name="l00968"></a>00968 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a011ed5964e136bdd6996e25780f606f0"></a><!-- doxytag: member="cdr.c::ast_cdr_setanswer" ref="a011ed5964e136bdd6996e25780f606f0" args="(struct ast_cdr *cdr, struct timeval t)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_cdr_setanswer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cdr.html">ast_cdr</a> *&nbsp;</td>
          <td class="paramname"> <em>cdr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct timeval&nbsp;</td>
          <td class="paramname"> <em>t</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set the answer time for a call. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>cdr</em>&nbsp;</td><td>the cdr you wish to associate with the call </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>t</em>&nbsp;</td><td>the answer time Starts all CDR stuff necessary for doing CDR when answering a call NULL argument is just fine. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00790">790</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cdr_8h_source.html#l00089">ast_cdr::answer</a>, <a class="el" href="cdr_8h_source.html#l00038">AST_CDR_FLAG_ANSLOCKED</a>, <a class="el" href="cdr_8h_source.html#l00039">AST_CDR_FLAG_DONT_TOUCH</a>, <a class="el" href="cdr_8h_source.html#l00032">AST_CDR_FLAG_LOCKED</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="cdr_8c_source.html#l00420">check_post()</a>, and <a class="el" href="cdr_8h_source.html#l00113">ast_cdr::next</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00791"></a>00791 {
<a name="l00792"></a>00792 
<a name="l00793"></a>00793    <span class="keywordflow">for</span> (; cdr; cdr = cdr-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a>) {
<a name="l00794"></a>00794       <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(cdr, <a class="code" href="cdr_8h.html#ad483fcec295471cda6e9ebce6e0c4f24">AST_CDR_FLAG_ANSLOCKED</a>))
<a name="l00795"></a>00795          <span class="keywordflow">continue</span>;
<a name="l00796"></a>00796       <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(cdr, <a class="code" href="cdr_8h.html#aaeb04a47ad80222e66f13955fefad532">AST_CDR_FLAG_DONT_TOUCH</a>) &amp;&amp; <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(cdr, <a class="code" href="cdr_8h.html#ad19495bac7dec6a99190f93e21965da6">AST_CDR_FLAG_LOCKED</a>))
<a name="l00797"></a>00797          <span class="keywordflow">continue</span>;
<a name="l00798"></a>00798       <a class="code" href="cdr_8c.html#ab136d9ac92fdcacf14e91c2da770043f" title="print a warning if cdr already posted">check_post</a>(cdr);
<a name="l00799"></a>00799       cdr-&gt;<a class="code" href="structast__cdr.html#a621c14aed7c59835c5bc93bc88e8f3d9">answer</a> = t;
<a name="l00800"></a>00800    }
<a name="l00801"></a>00801 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a877162d212a320e7daec6aa7f695e9a8"></a><!-- doxytag: member="cdr.c::ast_cdr_setapp" ref="a877162d212a320e7daec6aa7f695e9a8" args="(struct ast_cdr *cdr, const char *app, const char *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_cdr_setapp </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cdr.html">ast_cdr</a> *&nbsp;</td>
          <td class="paramname"> <em>cdr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>app</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set the last executed application. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>cdr</em>&nbsp;</td><td>which cdr to act upon </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>app</em>&nbsp;</td><td>the name of the app you wish to change it to </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>data</em>&nbsp;</td><td>the data you want in the data field of app you set it to Changes the value of the last executed app Returns nothing </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00778">778</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cdr_8h_source.html#l00032">AST_CDR_FLAG_LOCKED</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="cdr_8c_source.html#l00420">check_post()</a>, <a class="el" href="cdr_8h_source.html#l00083">ast_cdr::lastapp</a>, <a class="el" href="cdr_8h_source.html#l00085">ast_cdr::lastdata</a>, <a class="el" href="cdr_8h_source.html#l00113">ast_cdr::next</a>, and <a class="el" href="strings_8h_source.html#l00072">S_OR</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l03851">__ast_request_and_dial()</a>, <a class="el" href="res__agi_8c_source.html#l02777">agi_handle_command()</a>, <a class="el" href="app__followme_8c_source.html#l00468">clear_caller()</a>, <a class="el" href="app__followme_8c_source.html#l00777">findmeexec()</a>, and <a class="el" href="pbx_8c_source.html#l01322">pbx_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00779"></a>00779 {
<a name="l00780"></a>00780 
<a name="l00781"></a>00781    <span class="keywordflow">for</span> (; cdr; cdr = cdr-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a>) {
<a name="l00782"></a>00782       <span class="keywordflow">if</span> (!<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(cdr, <a class="code" href="cdr_8h.html#ad19495bac7dec6a99190f93e21965da6">AST_CDR_FLAG_LOCKED</a>)) {
<a name="l00783"></a>00783          <a class="code" href="cdr_8c.html#ab136d9ac92fdcacf14e91c2da770043f" title="print a warning if cdr already posted">check_post</a>(cdr);
<a name="l00784"></a>00784          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(cdr-&gt;<a class="code" href="structast__cdr.html#ae7697234189954ec7c6a81b4ab691b85">lastapp</a>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(<a class="code" href="adsistub_8c.html#ad194d73de26c0d836555e029d245493d">app</a>, <span class="stringliteral">&quot;&quot;</span>), <span class="keyword">sizeof</span>(cdr-&gt;<a class="code" href="structast__cdr.html#ae7697234189954ec7c6a81b4ab691b85">lastapp</a>));
<a name="l00785"></a>00785          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(cdr-&gt;<a class="code" href="structast__cdr.html#a2176704f41b4368f2dfa94b64bfcfb6a">lastdata</a>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(data, <span class="stringliteral">&quot;&quot;</span>), <span class="keyword">sizeof</span>(cdr-&gt;<a class="code" href="structast__cdr.html#a2176704f41b4368f2dfa94b64bfcfb6a">lastdata</a>));
<a name="l00786"></a>00786       }
<a name="l00787"></a>00787    }
<a name="l00788"></a>00788 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aadbc4ffa5235680927182f70f78df193"></a><!-- doxytag: member="cdr.c::ast_cdr_setcid" ref="aadbc4ffa5235680927182f70f78df193" args="(struct ast_cdr *cdr, struct ast_channel *c)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_cdr_setcid </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cdr.html">ast_cdr</a> *&nbsp;</td>
          <td class="paramname"> <em>cdr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize based on a channel. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>cdr</em>&nbsp;</td><td>Call Detail Record to use for channel </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel to bind CDR with Initializes a CDR and associates it with a particular channel </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 by default </dd></dl>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00835">835</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cdr_8h_source.html#l00032">AST_CDR_FLAG_LOCKED</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="cdr_8h_source.html#l00113">ast_cdr::next</a>, and <a class="el" href="cdr_8c_source.html#l00815">set_one_cid()</a>.</p>

<p>Referenced by <a class="el" href="features_8c_source.html#l02441">ast_bridge_call()</a>, and <a class="el" href="func__callerid_8c_source.html#l00191">callerid_write()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00836"></a>00836 {
<a name="l00837"></a>00837    <span class="keywordflow">for</span> (; cdr; cdr = cdr-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a>) {
<a name="l00838"></a>00838       <span class="keywordflow">if</span> (!<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(cdr, <a class="code" href="cdr_8h.html#ad19495bac7dec6a99190f93e21965da6">AST_CDR_FLAG_LOCKED</a>))
<a name="l00839"></a>00839          <a class="code" href="cdr_8c.html#af8a938a22715b2e6549f67efb4da5b14">set_one_cid</a>(cdr, c);
<a name="l00840"></a>00840    }
<a name="l00841"></a>00841    <span class="keywordflow">return</span> 0;
<a name="l00842"></a>00842 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a2dcb7d9f1762f0ca1523a62fdd17ab95"></a><!-- doxytag: member="cdr.c::ast_cdr_setdestchan" ref="a2dcb7d9f1762f0ca1523a62fdd17ab95" args="(struct ast_cdr *cdr, const char *chann)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_cdr_setdestchan </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cdr.html">ast_cdr</a> *&nbsp;</td>
          <td class="paramname"> <em>cdr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set the destination channel, if there was one. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>cdr</em>&nbsp;</td><td>Which cdr it's applied to </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>chan</em>&nbsp;</td><td>Channel to which dest will be Sets the destination channel the CDR is applied to Returns nothing </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00768">768</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cdr_8h_source.html#l00032">AST_CDR_FLAG_LOCKED</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="cdr_8c_source.html#l00420">check_post()</a>, <a class="el" href="cdr_8h_source.html#l00081">ast_cdr::dstchannel</a>, and <a class="el" href="cdr_8h_source.html#l00113">ast_cdr::next</a>.</p>

<p>Referenced by <a class="el" href="app__dial_8c_source.html#l01515">dial_exec_full()</a>, <a class="el" href="features_8c_source.html#l03335">park_exec_full()</a>, <a class="el" href="app__queue_8c_source.html#l02467">ring_entry()</a>, and <a class="el" href="app__queue_8c_source.html#l03569">try_calling()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00769"></a>00769 {
<a name="l00770"></a>00770    <span class="keywordflow">for</span> (; cdr; cdr = cdr-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a>) {
<a name="l00771"></a>00771       <span class="keywordflow">if</span> (!<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(cdr, <a class="code" href="cdr_8h.html#ad19495bac7dec6a99190f93e21965da6">AST_CDR_FLAG_LOCKED</a>)) {
<a name="l00772"></a>00772          <a class="code" href="cdr_8c.html#ab136d9ac92fdcacf14e91c2da770043f" title="print a warning if cdr already posted">check_post</a>(cdr);
<a name="l00773"></a>00773          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(cdr-&gt;<a class="code" href="structast__cdr.html#a0d43f7cac6179c7c4f9521f3138195b4">dstchannel</a>, chann, <span class="keyword">sizeof</span>(cdr-&gt;<a class="code" href="structast__cdr.html#a0d43f7cac6179c7c4f9521f3138195b4">dstchannel</a>));
<a name="l00774"></a>00774       }
<a name="l00775"></a>00775    }
<a name="l00776"></a>00776 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aff06489c0d7a1832949aa8779a9536b5"></a><!-- doxytag: member="cdr.c::ast_cdr_setdisposition" ref="aff06489c0d7a1832949aa8779a9536b5" args="(struct ast_cdr *cdr, long int disposition)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_cdr_setdisposition </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cdr.html">ast_cdr</a> *&nbsp;</td>
          <td class="paramname"> <em>cdr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long int&nbsp;</td>
          <td class="paramname"> <em>disposition</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set the disposition for a call. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>cdr</em>&nbsp;</td><td>the cdr you wish to associate with the call </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>disposition</em>&nbsp;</td><td>the new disposition Set the disposition on a call. NULL argument is just fine. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00803">803</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cdr_8h_source.html#l00032">AST_CDR_FLAG_LOCKED</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="cdr_8c_source.html#l00420">check_post()</a>, <a class="el" href="cdr_8h_source.html#l00097">ast_cdr::disposition</a>, and <a class="el" href="cdr_8h_source.html#l00113">ast_cdr::next</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00804"></a>00804 {
<a name="l00805"></a>00805 
<a name="l00806"></a>00806    <span class="keywordflow">for</span> (; cdr; cdr = cdr-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a>) {
<a name="l00807"></a>00807       <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(cdr, <a class="code" href="cdr_8h.html#ad19495bac7dec6a99190f93e21965da6">AST_CDR_FLAG_LOCKED</a>))
<a name="l00808"></a>00808          <span class="keywordflow">continue</span>;
<a name="l00809"></a>00809       <a class="code" href="cdr_8c.html#ab136d9ac92fdcacf14e91c2da770043f" title="print a warning if cdr already posted">check_post</a>(cdr);
<a name="l00810"></a>00810       cdr-&gt;<a class="code" href="structast__cdr.html#a1f9669e5d9d64aa831cd9db2dd71534f">disposition</a> = <a class="code" href="structast__cdr.html#a1f9669e5d9d64aa831cd9db2dd71534f">disposition</a>;
<a name="l00811"></a>00811    }
<a name="l00812"></a>00812 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6c3458fc19a7e9eb5bdcff22378b30a4"></a><!-- doxytag: member="cdr.c::ast_cdr_setuserfield" ref="a6c3458fc19a7e9eb5bdcff22378b30a4" args="(struct ast_channel *chan, const char *userfield)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_cdr_setuserfield </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>userfield</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set CDR <a class="el" href="structuser.html" title="structure to hold users read from users.conf">user</a> field for channel (stored in CDR). </p>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00970">970</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cdr_8h_source.html#l00032">AST_CDR_FLAG_LOCKED</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="channel_8h_source.html#l00422">ast_channel::cdr</a>, <a class="el" href="cdr_8h_source.html#l00113">ast_cdr::next</a>, and <a class="el" href="cdr_8h_source.html#l00108">ast_cdr::userfield</a>.</p>

<p>Referenced by <a class="el" href="chan__agent_8c_source.html#l00486">__agent_start_monitoring()</a>, <a class="el" href="func__cdr_8c_source.html#l00220">cdr_write()</a>, <a class="el" href="chan__sip_8c_source.html#l16615">handle_request_info()</a>, and <a class="el" href="res__monitor_8c_source.html#l00495">start_monitor_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00971"></a>00971 {
<a name="l00972"></a>00972    <span class="keyword">struct </span><a class="code" href="structast__cdr.html" title="Responsible for call detail data.">ast_cdr</a> *cdr = chan-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>;
<a name="l00973"></a>00973 
<a name="l00974"></a>00974    <span class="keywordflow">for</span> ( ; cdr ; cdr = cdr-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a>) {
<a name="l00975"></a>00975       <span class="keywordflow">if</span> (!<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(cdr, <a class="code" href="cdr_8h.html#ad19495bac7dec6a99190f93e21965da6">AST_CDR_FLAG_LOCKED</a>)) 
<a name="l00976"></a>00976          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(cdr-&gt;<a class="code" href="structast__cdr.html#a2d480b13820a3a97582a1a138036aa25">userfield</a>, <a class="code" href="structast__cdr.html#a2d480b13820a3a97582a1a138036aa25">userfield</a>, <span class="keyword">sizeof</span>(cdr-&gt;<a class="code" href="structast__cdr.html#a2d480b13820a3a97582a1a138036aa25">userfield</a>));
<a name="l00977"></a>00977    }
<a name="l00978"></a>00978 
<a name="l00979"></a>00979    <span class="keywordflow">return</span> 0;
<a name="l00980"></a>00980 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="adb921d105e280e28efbfa46160bd9126"></a><!-- doxytag: member="cdr.c::ast_cdr_setvar" ref="adb921d105e280e28efbfa46160bd9126" args="(struct ast_cdr *cdr, const char *name, const char *value, int recur)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_cdr_setvar </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cdr.html">ast_cdr</a> *&nbsp;</td>
          <td class="paramname"> <em>cdr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>recur</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Set a CDR channel variable </p>
<dl class="note"><dt><b>Note:</b></dt><dd>You can't set the CDR variables that belong to the actual CDR record, like "billsec". </dd></dl>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00292">292</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cdr_8h_source.html#l00039">AST_CDR_FLAG_DONT_TOUCH</a>, <a class="el" href="cdr_8h_source.html#l00032">AST_CDR_FLAG_LOCKED</a>, <a class="el" href="linkedlists_8h_source.html#l00695">AST_LIST_INSERT_HEAD</a>, <a class="el" href="linkedlists_8h_source.html#l00553">AST_LIST_REMOVE_CURRENT</a>, <a class="el" href="linkedlists_8h_source.html#l00528">AST_LIST_TRAVERSE_SAFE_BEGIN</a>, <a class="el" href="linkedlists_8h_source.html#l00599">AST_LIST_TRAVERSE_SAFE_END</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="chanvars_8c_source.html#l00037">ast_var_assign()</a>, <a class="el" href="chanvars_8c_source.html#l00059">ast_var_delete()</a>, <a class="el" href="chanvars_8c_source.html#l00065">ast_var_name()</a>, <a class="el" href="cdr_8c_source.html#l00285">cdr_readonly_vars</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="cdr_8h_source.html#l00113">ast_cdr::next</a>, and <a class="el" href="cdr_8h_source.html#l00111">ast_cdr::varshead</a>.</p>

<p>Referenced by <a class="el" href="app__forkcdr_8c_source.html#l00176">ast_cdr_fork()</a>, <a class="el" href="func__cdr_8c_source.html#l00220">cdr_write()</a>, and <a class="el" href="cdr_8c_source.html#l00815">set_one_cid()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00293"></a>00293 {
<a name="l00294"></a>00294    <span class="keyword">struct </span><a class="code" href="structast__var__t.html">ast_var_t</a> *newvariable;
<a name="l00295"></a>00295    <span class="keyword">struct </span>varshead *headp;
<a name="l00296"></a>00296    <span class="keywordtype">int</span> x;
<a name="l00297"></a>00297    
<a name="l00298"></a>00298    <span class="keywordflow">if</span> (!cdr)  <span class="comment">/* don&apos;t die if the cdr is null */</span>
<a name="l00299"></a>00299       <span class="keywordflow">return</span> -1;
<a name="l00300"></a>00300    
<a name="l00301"></a>00301    <span class="keywordflow">for</span> (x = 0; <a class="code" href="cdr_8c.html#a62566fff085d3e4fd5843a6b70413ee1">cdr_readonly_vars</a>[x]; x++) {
<a name="l00302"></a>00302       <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, <a class="code" href="cdr_8c.html#a62566fff085d3e4fd5843a6b70413ee1">cdr_readonly_vars</a>[x])) {
<a name="l00303"></a>00303          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Attempt to set the &apos;%s&apos; read-only variable!.\n&quot;</span>, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l00304"></a>00304          <span class="keywordflow">return</span> -1;
<a name="l00305"></a>00305       }
<a name="l00306"></a>00306    }
<a name="l00307"></a>00307 
<a name="l00308"></a>00308    <span class="keywordflow">if</span> (!cdr) {
<a name="l00309"></a>00309       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Attempt to set a variable on a nonexistent CDR record.\n&quot;</span>);
<a name="l00310"></a>00310       <span class="keywordflow">return</span> -1;
<a name="l00311"></a>00311    }
<a name="l00312"></a>00312 
<a name="l00313"></a>00313    <span class="keywordflow">for</span> (; cdr; cdr = recur ? cdr-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a> : NULL) {
<a name="l00314"></a>00314       <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(cdr, <a class="code" href="cdr_8h.html#aaeb04a47ad80222e66f13955fefad532">AST_CDR_FLAG_DONT_TOUCH</a>) &amp;&amp; <a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(cdr, <a class="code" href="cdr_8h.html#ad19495bac7dec6a99190f93e21965da6">AST_CDR_FLAG_LOCKED</a>))
<a name="l00315"></a>00315          <span class="keywordflow">continue</span>;
<a name="l00316"></a>00316       headp = &amp;cdr-&gt;<a class="code" href="structast__cdr.html#a9ffb22045a8f14bef8f2137cd779ab25">varshead</a>;
<a name="l00317"></a>00317       <a class="code" href="linkedlists_8h.html#aa5be52067bf16bdc7e56ca19b5ba858d" title="Loops safely over (traverses) the entries in a list.">AST_LIST_TRAVERSE_SAFE_BEGIN</a>(headp, newvariable, entries) {
<a name="l00318"></a>00318          <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="chanvars_8h.html#a356a31cd608ec07d3668dcd589be49d8">ast_var_name</a>(newvariable), <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>)) {
<a name="l00319"></a>00319             <span class="comment">/* there is already such a variable, delete it */</span>
<a name="l00320"></a>00320             <a class="code" href="linkedlists_8h.html#aa8ac496fa9c717d5afb99a02e1e2760c" title="Removes the current entry from a list during a traversal.">AST_LIST_REMOVE_CURRENT</a>(entries);
<a name="l00321"></a>00321             <a class="code" href="chanvars_8h.html#a52aaa758ed30031250c2d356b993c6d9">ast_var_delete</a>(newvariable);
<a name="l00322"></a>00322             <span class="keywordflow">break</span>;
<a name="l00323"></a>00323          }
<a name="l00324"></a>00324       }
<a name="l00325"></a>00325       <a class="code" href="linkedlists_8h.html#a712c04b4493919a7052399cd30ee8fb9" title="Closes a safe loop traversal block.">AST_LIST_TRAVERSE_SAFE_END</a>;
<a name="l00326"></a>00326       
<a name="l00327"></a>00327       <span class="keywordflow">if</span> (value) {
<a name="l00328"></a>00328          newvariable = <a class="code" href="chanvars_8h.html#a8ea2b5a29fa275115c7ed27a593b727d">ast_var_assign</a>(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, value);
<a name="l00329"></a>00329          <a class="code" href="linkedlists_8h.html#aa2ded2af046bb513f77056c27c083307" title="Inserts a list entry at the head of a list.">AST_LIST_INSERT_HEAD</a>(headp, newvariable, entries);
<a name="l00330"></a>00330       }
<a name="l00331"></a>00331    }
<a name="l00332"></a>00332 
<a name="l00333"></a>00333    <span class="keywordflow">return</span> 0;
<a name="l00334"></a>00334 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a82442ca100e6ee9ccaddc7d8c062fa4c"></a><!-- doxytag: member="cdr.c::ast_cdr_specialized_reset" ref="a82442ca100e6ee9ccaddc7d8c062fa4c" args="(struct ast_cdr *cdr, struct ast_flags *_flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_cdr_specialized_reset </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cdr.html">ast_cdr</a> *&nbsp;</td>
          <td class="paramname"> <em>cdr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__flags.html">ast_flags</a> *&nbsp;</td>
          <td class="paramname"> <em>flags</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Reset the detail record times, flags</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>cdr</em>&nbsp;</td><td>which cdr to act upon </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>flags</em>&nbsp;</td><td>|AST_CDR_FLAG_POSTED whether or not to post the cdr first before resetting it |AST_CDR_FLAG_LOCKED whether or not to reset locked CDR's </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l01105">1105</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cdr_8h_source.html#l00089">ast_cdr::answer</a>, <a class="el" href="cdr_8h_source.html#l00034">AST_CDR_FLAG_POST_DISABLED</a>, <a class="el" href="cdr_8h_source.html#l00048">AST_CDR_NULL</a>, <a class="el" href="cdr_8c_source.html#l00674">ast_cdr_start()</a>, <a class="el" href="utils_8h_source.html#l00075">ast_clear_flag</a>, <a class="el" href="utils_8h_source.html#l00082">ast_copy_flags</a>, <a class="el" href="utils_8h_source.html#l00194">AST_FLAGS_ALL</a>, <a class="el" href="utils_8h_source.html#l00068">ast_set_flag</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="cdr_8h_source.html#l00095">ast_cdr::billsec</a>, <a class="el" href="cdr_8h_source.html#l00097">ast_cdr::disposition</a>, <a class="el" href="cdr_8h_source.html#l00093">ast_cdr::duration</a>, <a class="el" href="cdr_8h_source.html#l00091">ast_cdr::end</a>, and <a class="el" href="cdr_8h_source.html#l00087">ast_cdr::start</a>.</p>

<p>Referenced by <a class="el" href="features_8c_source.html#l02441">ast_bridge_call()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01106"></a>01106 {
<a name="l01107"></a>01107    <span class="keyword">struct </span><a class="code" href="structast__flags.html" title="Structure used to handle boolean flags.">ast_flags</a> <a class="code" href="structast__flags.html#ac92588540e8c1d014a08cd8a45462b19">flags</a> = { 0 };
<a name="l01108"></a>01108 
<a name="l01109"></a>01109    <span class="keywordflow">if</span> (_flags)
<a name="l01110"></a>01110       <a class="code" href="utils_8h.html#ab9da1c7265610eff83ed6146f104dc6f">ast_copy_flags</a>(&amp;flags, _flags, <a class="code" href="utils_8h.html#afb8683b4d96960d7a82a86a974a57599">AST_FLAGS_ALL</a>);
<a name="l01111"></a>01111    
<a name="l01112"></a>01112    <span class="comment">/* Reset to initial state */</span>
<a name="l01113"></a>01113    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(cdr, <a class="code" href="cdr_8h.html#ad1c97f787a4ae3481dd9b48fef118572">AST_CDR_FLAG_POST_DISABLED</a>)) { <span class="comment">/* But do NOT lose the NoCDR() setting */</span>
<a name="l01114"></a>01114       <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(cdr, <a class="code" href="utils_8h.html#afb8683b4d96960d7a82a86a974a57599">AST_FLAGS_ALL</a>); 
<a name="l01115"></a>01115       <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(cdr, <a class="code" href="cdr_8h.html#ad1c97f787a4ae3481dd9b48fef118572">AST_CDR_FLAG_POST_DISABLED</a>);
<a name="l01116"></a>01116    } <span class="keywordflow">else</span> {
<a name="l01117"></a>01117       <a class="code" href="utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(cdr, <a class="code" href="utils_8h.html#afb8683b4d96960d7a82a86a974a57599">AST_FLAGS_ALL</a>); 
<a name="l01118"></a>01118    }
<a name="l01119"></a>01119    
<a name="l01120"></a>01120    memset(&amp;cdr-&gt;<a class="code" href="structast__cdr.html#ad80305b5e16da9c2675d5f057bd69386">start</a>, 0, <span class="keyword">sizeof</span>(cdr-&gt;<a class="code" href="structast__cdr.html#ad80305b5e16da9c2675d5f057bd69386">start</a>));
<a name="l01121"></a>01121    memset(&amp;cdr-&gt;<a class="code" href="structast__cdr.html#af5249cf68dff13dd1dcca5929f4f3a5b">end</a>, 0, <span class="keyword">sizeof</span>(cdr-&gt;<a class="code" href="structast__cdr.html#af5249cf68dff13dd1dcca5929f4f3a5b">end</a>));
<a name="l01122"></a>01122    memset(&amp;cdr-&gt;<a class="code" href="structast__cdr.html#a621c14aed7c59835c5bc93bc88e8f3d9">answer</a>, 0, <span class="keyword">sizeof</span>(cdr-&gt;<a class="code" href="structast__cdr.html#a621c14aed7c59835c5bc93bc88e8f3d9">answer</a>));
<a name="l01123"></a>01123    cdr-&gt;<a class="code" href="structast__cdr.html#a4a98731fed2979292cd6042898671e8d">billsec</a> = 0;
<a name="l01124"></a>01124    cdr-&gt;<a class="code" href="structast__cdr.html#a993dee0d19091c6d48fdeda230fd6be0">duration</a> = 0;
<a name="l01125"></a>01125    <a class="code" href="cdr_8h.html#af788ef701483a64b77656f272843bcd4" title="Start a call.">ast_cdr_start</a>(cdr);
<a name="l01126"></a>01126    cdr-&gt;<a class="code" href="structast__cdr.html#a1f9669e5d9d64aa831cd9db2dd71534f">disposition</a> = <a class="code" href="cdr_8h.html#af20894acc82ed87553fc81355890f152">AST_CDR_NULL</a>;
<a name="l01127"></a>01127 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af788ef701483a64b77656f272843bcd4"></a><!-- doxytag: member="cdr.c::ast_cdr_start" ref="af788ef701483a64b77656f272843bcd4" args="(struct ast_cdr *cdr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_cdr_start </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cdr.html">ast_cdr</a> *&nbsp;</td>
          <td class="paramname"> <em>cdr</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Start a call. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>cdr</em>&nbsp;</td><td>the cdr you wish to associate with the call Starts all CDR stuff necessary for monitoring a call Returns nothing </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00674">674</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cdr_8h_source.html#l00032">AST_CDR_FLAG_LOCKED</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="adsistub_8c_source.html#l00049">chan</a>, <a class="el" href="cdr_8h_source.html#l00079">ast_cdr::channel</a>, <a class="el" href="cdr_8c_source.html#l00420">check_post()</a>, <a class="el" href="cdr_8h_source.html#l00113">ast_cdr::next</a>, <a class="el" href="strings_8h_source.html#l00072">S_OR</a>, and <a class="el" href="cdr_8h_source.html#l00087">ast_cdr::start</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l00772">__ast_channel_alloc_ap()</a>, <a class="el" href="channel_8c_source.html#l03851">__ast_request_and_dial()</a>, <a class="el" href="features_8c_source.html#l02441">ast_bridge_call()</a>, <a class="el" href="cdr_8c_source.html#l01062">ast_cdr_reset()</a>, <a class="el" href="cdr_8c_source.html#l01105">ast_cdr_specialized_reset()</a>, <a class="el" href="pbx_8c_source.html#l07914">ast_pbx_outgoing_cdr_failed()</a>, <a class="el" href="features_8c_source.html#l01265">builtin_blindtransfer()</a>, <a class="el" href="app__followme_8c_source.html#l00468">clear_caller()</a>, and <a class="el" href="app__followme_8c_source.html#l00777">findmeexec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00675"></a>00675 {
<a name="l00676"></a>00676    <span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>; 
<a name="l00677"></a>00677 
<a name="l00678"></a>00678    <span class="keywordflow">for</span> (; cdr; cdr = cdr-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a>) {
<a name="l00679"></a>00679       <span class="keywordflow">if</span> (!<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(cdr, <a class="code" href="cdr_8h.html#ad19495bac7dec6a99190f93e21965da6">AST_CDR_FLAG_LOCKED</a>)) {
<a name="l00680"></a>00680          chan = <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(cdr-&gt;<a class="code" href="structast__cdr.html#a6396dbd53fd6fedc1fc3ba2743f00eca">channel</a>, <span class="stringliteral">&quot;&lt;unknown&gt;&quot;</span>);
<a name="l00681"></a>00681          <a class="code" href="cdr_8c.html#ab136d9ac92fdcacf14e91c2da770043f" title="print a warning if cdr already posted">check_post</a>(cdr);
<a name="l00682"></a>00682          cdr-&gt;<a class="code" href="structast__cdr.html#ad80305b5e16da9c2675d5f057bd69386">start</a> = <a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>();
<a name="l00683"></a>00683       }
<a name="l00684"></a>00684    }
<a name="l00685"></a>00685 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a576d4e4095247ebd55de2937b6f8263c"></a><!-- doxytag: member="cdr.c::ast_cdr_submit_batch" ref="a576d4e4095247ebd55de2937b6f8263c" args="(int do_shutdown)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_cdr_submit_batch </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>shutdown</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Spawns (possibly) a new thread to submit a batch of CDRs to the backend <a class="el" href="structengines.html">engines</a>. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>shutdown</em>&nbsp;</td><td>Whether or not we are shutting down Blocks the asterisk shutdown procedures until the CDR data is submitted. Returns nothing </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l01183">1183</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="utils_8h_source.html#l00389">ast_pthread_create_detached_background</a>, <a class="el" href="lock_8h_source.html#l00082">AST_PTHREADT_NULL</a>, <a class="el" href="cdr_8c.html#ac47f93001bc6fd919a5a4535f89c9ccd">batch</a>, <a class="el" href="cdr_8c_source.html#l00091">batchscheduleronly</a>, <a class="el" href="cdr_8c_source.html#l00094">cdr_batch_lock</a>, <a class="el" href="cdr_8c_source.html#l01166">do_batch_backend_process()</a>, <a class="el" href="cdr_8c_source.html#l00073">ast_cdr_batch::head</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, and <a class="el" href="cdr_8c_source.html#l01147">reset_batch()</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l01546">ast_cdr_engine_term()</a>, and <a class="el" href="cdr_8c_source.html#l01213">submit_scheduled_batch()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01184"></a>01184 {
<a name="l01185"></a>01185    <span class="keyword">struct </span><a class="code" href="structast__cdr__batch__item.html">ast_cdr_batch_item</a> *oldbatchitems = NULL;
<a name="l01186"></a>01186    pthread_t batch_post_thread = <a class="code" href="lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>;
<a name="l01187"></a>01187 
<a name="l01188"></a>01188    <span class="comment">/* if there&apos;s no batch, or no CDRs in the batch, then there&apos;s nothing to do */</span>
<a name="l01189"></a>01189    <span class="keywordflow">if</span> (!<a class="code" href="cdr_8c.html#ac47f93001bc6fd919a5a4535f89c9ccd">batch</a> || !<a class="code" href="cdr_8c.html#ac47f93001bc6fd919a5a4535f89c9ccd">batch</a>-&gt;<a class="code" href="structast__cdr__batch.html#aca71efae726094060905e37e306dd322">head</a>)
<a name="l01190"></a>01190       <span class="keywordflow">return</span>;
<a name="l01191"></a>01191 
<a name="l01192"></a>01192    <span class="comment">/* move the old CDRs aside, and prepare a new CDR batch */</span>
<a name="l01193"></a>01193    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;<a class="code" href="cdr_8c.html#a3a3969758c60f80011874aadde9d09ca">cdr_batch_lock</a>);
<a name="l01194"></a>01194    oldbatchitems = <a class="code" href="cdr_8c.html#ac47f93001bc6fd919a5a4535f89c9ccd">batch</a>-&gt;<a class="code" href="structast__cdr__batch.html#aca71efae726094060905e37e306dd322">head</a>;
<a name="l01195"></a>01195    <a class="code" href="cdr_8c.html#a0165bd3137a70f31dcbe5fb47b5aee2a">reset_batch</a>();
<a name="l01196"></a>01196    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="cdr_8c.html#a3a3969758c60f80011874aadde9d09ca">cdr_batch_lock</a>);
<a name="l01197"></a>01197 
<a name="l01198"></a>01198    <span class="comment">/* if configured, spawn a new thread to post these CDRs,</span>
<a name="l01199"></a>01199 <span class="comment">      also try to save as much as possible if we are shutting down safely */</span>
<a name="l01200"></a>01200    <span class="keywordflow">if</span> (<a class="code" href="cdr_8c.html#a2884926c72604cd5790204ed221068a5">batchscheduleronly</a> || do_shutdown) {
<a name="l01201"></a>01201       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;CDR single-threaded batch processing begins now\n&quot;</span>);
<a name="l01202"></a>01202       <a class="code" href="cdr_8c.html#ac661a0b8ae11d5cf5cae1e6aa238496b">do_batch_backend_process</a>(oldbatchitems);
<a name="l01203"></a>01203    } <span class="keywordflow">else</span> {
<a name="l01204"></a>01204       <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#aa73be876e3a4024b91ce2e09d8b945d1">ast_pthread_create_detached_background</a>(&amp;batch_post_thread, NULL, <a class="code" href="cdr_8c.html#ac661a0b8ae11d5cf5cae1e6aa238496b">do_batch_backend_process</a>, oldbatchitems)) {
<a name="l01205"></a>01205          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;CDR processing thread could not detach, now trying in this thread\n&quot;</span>);
<a name="l01206"></a>01206          <a class="code" href="cdr_8c.html#ac661a0b8ae11d5cf5cae1e6aa238496b">do_batch_backend_process</a>(oldbatchitems);
<a name="l01207"></a>01207       } <span class="keywordflow">else</span> {
<a name="l01208"></a>01208          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;CDR multi-threaded batch processing begins now\n&quot;</span>);
<a name="l01209"></a>01209       }
<a name="l01210"></a>01210    }
<a name="l01211"></a>01211 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a31a2a5a50d025225f13633c95f7bcd4d"></a><!-- doxytag: member="cdr.c::ast_cdr_unregister" ref="a31a2a5a50d025225f13633c95f7bcd4d" args="(const char *name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_cdr_unregister </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>name</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Unregister a CDR handling engine. </p>
<p>unregister a CDR driver </p>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00143">143</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="linkedlists_8h_source.html#l00564">AST_RWLIST_REMOVE_CURRENT</a>, <a class="el" href="linkedlists_8h_source.html#l00541">AST_RWLIST_TRAVERSE_SAFE_BEGIN</a>, <a class="el" href="linkedlists_8h_source.html#l00601">AST_RWLIST_TRAVERSE_SAFE_END</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, <a class="el" href="logger_8h_source.html#l00220">ast_verb</a>, <a class="el" href="structast__cdr__beitem.html#af871bc67d8f811f5eb06dd7652cd6231">ast_cdr_beitem::list</a>, and <a class="el" href="cdr_8c_source.html#l00058">ast_cdr_beitem::name</a>.</p>

<p>Referenced by <a class="el" href="cdr__manager_8c_source.html#l00055">load_config()</a>, <a class="el" href="cdr__csv_8c_source.html#l00339">reload()</a>, <a class="el" href="cdr__tds_8c_source.html#l00385">tds_unload_module()</a>, and <a class="el" href="cdr__adaptive__odbc_8c_source.html#l00684">unload_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00144"></a>00144 {
<a name="l00145"></a>00145    <span class="keyword">struct </span><a class="code" href="structast__cdr__beitem.html">ast_cdr_beitem</a> *i = NULL;
<a name="l00146"></a>00146 
<a name="l00147"></a>00147    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structbe__list.html">be_list</a>);
<a name="l00148"></a>00148    <a class="code" href="linkedlists_8h.html#a21be6da4b2146b04b4868c2be5cae750">AST_RWLIST_TRAVERSE_SAFE_BEGIN</a>(&amp;<a class="code" href="structbe__list.html">be_list</a>, i, <a class="code" href="structast__cdr__beitem.html#af871bc67d8f811f5eb06dd7652cd6231">list</a>) {
<a name="l00149"></a>00149       <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>, i-&gt;<a class="code" href="structast__cdr__beitem.html#a9997d8ee2df51d18efed254a5aa016fd">name</a>)) {
<a name="l00150"></a>00150          <a class="code" href="linkedlists_8h.html#a02212548652c9eb0f3db38dc4e4bd285">AST_RWLIST_REMOVE_CURRENT</a>(<a class="code" href="structast__cdr__beitem.html#af871bc67d8f811f5eb06dd7652cd6231">list</a>);
<a name="l00151"></a>00151          <a class="code" href="logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Unregistered &apos;%s&apos; CDR backend\n&quot;</span>, <a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>);
<a name="l00152"></a>00152          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(i);
<a name="l00153"></a>00153          <span class="keywordflow">break</span>;
<a name="l00154"></a>00154       }
<a name="l00155"></a>00155    }
<a name="l00156"></a>00156    <a class="code" href="linkedlists_8h.html#a6bf0e81cb6ef01532ddebaba68f6de28">AST_RWLIST_TRAVERSE_SAFE_END</a>;
<a name="l00157"></a>00157    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structbe__list.html">be_list</a>);
<a name="l00158"></a>00158 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a02e3ffcb969d44d6deee3edb3b6a51bd"></a><!-- doxytag: member="cdr.c::ast_cdr_update" ref="a02e3ffcb969d44d6deee3edb3b6a51bd" args="(struct ast_channel *c)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_cdr_update </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>chan</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Update CDR on a channel </p>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00996">996</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cdr_8h_source.html#l00101">ast_cdr::accountcode</a>, <a class="el" href="cdr_8h_source.html#l00032">AST_CDR_FLAG_LOCKED</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="channel_8h_source.html#l00422">ast_channel::cdr</a>, <a class="el" href="channel_8h_source.html#l00503">ast_channel::context</a>, <a class="el" href="cdr_8h_source.html#l00077">ast_cdr::dcontext</a>, <a class="el" href="cdr_8h_source.html#l00075">ast_cdr::dst</a>, <a class="el" href="channel_8h_source.html#l00504">ast_channel::exten</a>, <a class="el" href="channel_8h_source.html#l00505">ast_channel::macrocontext</a>, <a class="el" href="channel_8h_source.html#l00506">ast_channel::macroexten</a>, <a class="el" href="cdr_8h_source.html#l00113">ast_cdr::next</a>, <a class="el" href="strings_8h_source.html#l00072">S_OR</a>, and <a class="el" href="cdr_8c_source.html#l00815">set_one_cid()</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l04214">__ast_pbx_run()</a>, <a class="el" href="channel_8c_source.html#l03851">__ast_request_and_dial()</a>, <a class="el" href="features_8c_source.html#l02441">ast_bridge_call()</a>, <a class="el" href="chan__misdn_8c_source.html#l04379">cb_events()</a>, <a class="el" href="app__followme_8c_source.html#l00468">clear_caller()</a>, <a class="el" href="app__followme_8c_source.html#l00777">findmeexec()</a>, and <a class="el" href="chan__local_8c_source.html#l00518">local_call()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00997"></a>00997 {
<a name="l00998"></a>00998    <span class="keyword">struct </span><a class="code" href="structast__cdr.html" title="Responsible for call detail data.">ast_cdr</a> *cdr = c-&gt;<a class="code" href="structast__channel.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>;
<a name="l00999"></a>00999 
<a name="l01000"></a>01000    <span class="keywordflow">for</span> ( ; cdr ; cdr = cdr-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a>) {
<a name="l01001"></a>01001       <span class="keywordflow">if</span> (!<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(cdr, <a class="code" href="cdr_8h.html#ad19495bac7dec6a99190f93e21965da6">AST_CDR_FLAG_LOCKED</a>)) {
<a name="l01002"></a>01002          <a class="code" href="cdr_8c.html#af8a938a22715b2e6549f67efb4da5b14">set_one_cid</a>(cdr, c);
<a name="l01003"></a>01003 
<a name="l01004"></a>01004          <span class="comment">/* Copy account code et-al */</span> 
<a name="l01005"></a>01005          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(cdr-&gt;<a class="code" href="structast__cdr.html#adfee50d07a98645d4d20b896ce03785a">accountcode</a>, c-&gt;accountcode, <span class="keyword">sizeof</span>(cdr-&gt;<a class="code" href="structast__cdr.html#adfee50d07a98645d4d20b896ce03785a">accountcode</a>));
<a name="l01006"></a>01006          
<a name="l01007"></a>01007          <span class="comment">/* Destination information */</span> <span class="comment">/* XXX privilege macro* ? */</span>
<a name="l01008"></a>01008          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(cdr-&gt;<a class="code" href="structast__cdr.html#ab30db746a1bf5c869a5dc9dbfaa864d4">dst</a>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(c-&gt;<a class="code" href="structast__channel.html#a582cff3075953f73ba96888167acf009">macroexten</a>, c-&gt;<a class="code" href="structast__channel.html#a78d4847658b695383d849efd12399b38">exten</a>), <span class="keyword">sizeof</span>(cdr-&gt;<a class="code" href="structast__cdr.html#ab30db746a1bf5c869a5dc9dbfaa864d4">dst</a>));
<a name="l01009"></a>01009          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(cdr-&gt;<a class="code" href="structast__cdr.html#af27d556683a4a28e6564618bcf00bec1">dcontext</a>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(c-&gt;<a class="code" href="structast__channel.html#a0a602b0f10ece2644f247c3f6ff841e0">macrocontext</a>, c-&gt;<a class="code" href="structast__channel.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>), <span class="keyword">sizeof</span>(cdr-&gt;<a class="code" href="structast__cdr.html#af27d556683a4a28e6564618bcf00bec1">dcontext</a>));
<a name="l01010"></a>01010       }
<a name="l01011"></a>01011    }
<a name="l01012"></a>01012 
<a name="l01013"></a>01013    <span class="keywordflow">return</span> 0;
<a name="l01014"></a>01014 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a26ef22f050d742f08715473a63720bb5"></a><!-- doxytag: member="cdr.c::cdr_get_tv" ref="a26ef22f050d742f08715473a63720bb5" args="(struct timeval when, const char *fmt, char *buf, int bufsize)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void cdr_get_tv </td>
          <td>(</td>
          <td class="paramtype">struct timeval&nbsp;</td>
          <td class="paramname"> <em>when</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>bufsize</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00204">204</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="localtime_8c_source.html#l01305">ast_localtime()</a>, and <a class="el" href="localtime_8c_source.html#l01928">ast_strftime()</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l00219">ast_cdr_getvar()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00205"></a>00205 {
<a name="l00206"></a>00206    <span class="keywordflow">if</span> (fmt == NULL) {   <span class="comment">/* raw mode */</span>
<a name="l00207"></a>00207       snprintf(<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, bufsize, <span class="stringliteral">&quot;%ld.%06ld&quot;</span>, (<span class="keywordtype">long</span>)when.tv_sec, (<span class="keywordtype">long</span>)when.tv_usec);
<a name="l00208"></a>00208    } <span class="keywordflow">else</span> {
<a name="l00209"></a>00209       <span class="keywordflow">if</span> (when.tv_sec) {
<a name="l00210"></a>00210          <span class="keyword">struct </span><a class="code" href="structast__tm.html">ast_tm</a> tm;
<a name="l00211"></a>00211          
<a name="l00212"></a>00212          <a class="code" href="localtime_8h.html#ae9fbda728350a9a5b9c09b29214d718e" title="Timezone-independent version of localtime_r(3).">ast_localtime</a>(&amp;when, &amp;tm, NULL);
<a name="l00213"></a>00213          <a class="code" href="localtime_8h.html#aa8e63928b14a347bd3973d680b885f93" title="Special version of strftime(3) that handles fractions of a second. Takes the same...">ast_strftime</a>(<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>, bufsize, fmt, &amp;tm);
<a name="l00214"></a>00214       }
<a name="l00215"></a>00215    }
<a name="l00216"></a>00216 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aaae18c4315dcf269cbbf0d7cd8bb5b9b"></a><!-- doxytag: member="cdr.c::cdr_merge_vars" ref="aaae18c4315dcf269cbbf0d7cd8bb5b9b" args="(struct ast_cdr *to, struct ast_cdr *from)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void cdr_merge_vars </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cdr.html">ast_cdr</a> *&nbsp;</td>
          <td class="paramname"> <em>to</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cdr.html">ast_cdr</a> *&nbsp;</td>
          <td class="paramname"> <em>from</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00461">461</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="linkedlists_8h_source.html#l00566">AST_LIST_MOVE_CURRENT</a>, <a class="el" href="linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00528">AST_LIST_TRAVERSE_SAFE_BEGIN</a>, <a class="el" href="linkedlists_8h_source.html#l00599">AST_LIST_TRAVERSE_SAFE_END</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="chanvars_8c_source.html#l00065">ast_var_name()</a>, <a class="el" href="chanvars_8c_source.html#l00085">ast_var_value()</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, and <a class="el" href="cdr_8h_source.html#l00111">ast_cdr::varshead</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l00496">ast_cdr_merge()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00462"></a>00462 {
<a name="l00463"></a>00463    <span class="keyword">struct </span><a class="code" href="structast__var__t.html">ast_var_t</a> *variablesfrom,*variablesto;
<a name="l00464"></a>00464    <span class="keyword">struct </span>varshead *headpfrom = &amp;to-&gt;<a class="code" href="structast__cdr.html#a9ffb22045a8f14bef8f2137cd779ab25">varshead</a>;
<a name="l00465"></a>00465    <span class="keyword">struct </span>varshead *headpto = &amp;from-&gt;<a class="code" href="structast__cdr.html#a9ffb22045a8f14bef8f2137cd779ab25">varshead</a>;
<a name="l00466"></a>00466    <a class="code" href="linkedlists_8h.html#aa5be52067bf16bdc7e56ca19b5ba858d" title="Loops safely over (traverses) the entries in a list.">AST_LIST_TRAVERSE_SAFE_BEGIN</a>(headpfrom, variablesfrom, entries) {
<a name="l00467"></a>00467       <span class="comment">/* for every var in from, stick it in to */</span>
<a name="l00468"></a>00468       <span class="keyword">const</span> <span class="keywordtype">char</span> *fromvarname, *fromvarval;
<a name="l00469"></a>00469       <span class="keyword">const</span> <span class="keywordtype">char</span> *tovarname = NULL, *tovarval = NULL;
<a name="l00470"></a>00470       fromvarname = <a class="code" href="chanvars_8h.html#a356a31cd608ec07d3668dcd589be49d8">ast_var_name</a>(variablesfrom);
<a name="l00471"></a>00471       fromvarval = <a class="code" href="chanvars_8h.html#a8e0081172db71c5021d20706c50d959c">ast_var_value</a>(variablesfrom);
<a name="l00472"></a>00472       tovarname = 0;
<a name="l00473"></a>00473 
<a name="l00474"></a>00474       <span class="comment">/* now, quick see if that var is in the &apos;to&apos; cdr already */</span>
<a name="l00475"></a>00475       <a class="code" href="linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef" title="Loops over (traverses) the entries in a list.">AST_LIST_TRAVERSE</a>(headpto, variablesto, entries) {
<a name="l00476"></a>00476 
<a name="l00477"></a>00477          <span class="comment">/* now, quick see if that var is in the &apos;to&apos; cdr already */</span>
<a name="l00478"></a>00478          <span class="keywordflow">if</span> ( strcasecmp(fromvarname, <a class="code" href="chanvars_8h.html#a356a31cd608ec07d3668dcd589be49d8">ast_var_name</a>(variablesto)) == 0 ) {
<a name="l00479"></a>00479             tovarname = <a class="code" href="chanvars_8h.html#a356a31cd608ec07d3668dcd589be49d8">ast_var_name</a>(variablesto);
<a name="l00480"></a>00480             tovarval = <a class="code" href="chanvars_8h.html#a8e0081172db71c5021d20706c50d959c">ast_var_value</a>(variablesto);
<a name="l00481"></a>00481             <span class="keywordflow">break</span>;
<a name="l00482"></a>00482          }
<a name="l00483"></a>00483       }
<a name="l00484"></a>00484       <span class="keywordflow">if</span> (tovarname &amp;&amp; strcasecmp(fromvarval,tovarval) != 0) {  <span class="comment">/* this message here to see how irritating the userbase finds it */</span>
<a name="l00485"></a>00485          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Merging CDR&apos;s: variable %s value %s dropped in favor of value %s\n&quot;</span>, tovarname, fromvarval, tovarval);
<a name="l00486"></a>00486          <span class="keywordflow">continue</span>;
<a name="l00487"></a>00487       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tovarname &amp;&amp; strcasecmp(fromvarval,tovarval) == 0) <span class="comment">/* if they are the same, the job is done */</span>
<a name="l00488"></a>00488          <span class="keywordflow">continue</span>;
<a name="l00489"></a>00489 
<a name="l00490"></a>00490       <span class="comment">/* rip this var out of the from cdr, and stick it in the to cdr */</span>
<a name="l00491"></a>00491       <a class="code" href="linkedlists_8h.html#a8e6f4898b3dd6430077785901605b375">AST_LIST_MOVE_CURRENT</a>(headpto, entries);
<a name="l00492"></a>00492    }
<a name="l00493"></a>00493    <a class="code" href="linkedlists_8h.html#a712c04b4493919a7052399cd30ee8fb9" title="Closes a safe loop traversal block.">AST_LIST_TRAVERSE_SAFE_END</a>;
<a name="l00494"></a>00494 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac63585622856b623992ab8aeba1a59b0"></a><!-- doxytag: member="cdr.c::check_cdr_enabled" ref="ac63585622856b623992ab8aeba1a59b0" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int check_cdr_enabled </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Return TRUE if CDR subsystem is enabled. </p>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00100">100</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cdr_8c_source.html#l00086">enabled</a>.</p>

<p>Referenced by <a class="el" href="manager_8c_source.html#l02709">action_coresettings()</a>, and <a class="el" href="asterisk_8c_source.html#l00413">handle_show_settings()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00101"></a>00101 {
<a name="l00102"></a>00102    <span class="keywordflow">return</span> <a class="code" href="cdr_8c.html#a03e6cca0c879c0443efb431c30c14f76">enabled</a>;
<a name="l00103"></a>00103 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab136d9ac92fdcacf14e91c2da770043f"></a><!-- doxytag: member="cdr.c::check_post" ref="ab136d9ac92fdcacf14e91c2da770043f" args="(struct ast_cdr *cdr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void check_post </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cdr.html">ast_cdr</a> *&nbsp;</td>
          <td class="paramname"> <em>cdr</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>print a warning if cdr already posted </p>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00420">420</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cdr_8h_source.html#l00031">AST_CDR_FLAG_POSTED</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="cdr_8h_source.html#l00079">ast_cdr::channel</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, and <a class="el" href="strings_8h_source.html#l00072">S_OR</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l00687">ast_cdr_answer()</a>, <a class="el" href="cdr_8c_source.html#l00703">ast_cdr_busy()</a>, <a class="el" href="cdr_8c_source.html#l00879">ast_cdr_end()</a>, <a class="el" href="cdr_8c_source.html#l00715">ast_cdr_failed()</a>, <a class="el" href="cdr_8c_source.html#l00790">ast_cdr_setanswer()</a>, <a class="el" href="cdr_8c_source.html#l00778">ast_cdr_setapp()</a>, <a class="el" href="cdr_8c_source.html#l00768">ast_cdr_setdestchan()</a>, <a class="el" href="cdr_8c_source.html#l00803">ast_cdr_setdisposition()</a>, <a class="el" href="cdr_8c_source.html#l00674">ast_cdr_start()</a>, and <a class="el" href="cdr_8c_source.html#l01029">post_cdr()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00421"></a>00421 {
<a name="l00422"></a>00422    <span class="keywordflow">if</span> (!cdr)
<a name="l00423"></a>00423       <span class="keywordflow">return</span>;
<a name="l00424"></a>00424    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(cdr, <a class="code" href="cdr_8h.html#ab7d9caea71bea12314af4b117a35c3f9">AST_CDR_FLAG_POSTED</a>))
<a name="l00425"></a>00425       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;CDR on channel &apos;%s&apos; already posted\n&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(cdr-&gt;<a class="code" href="structast__cdr.html#a6396dbd53fd6fedc1fc3ba2743f00eca">channel</a>, <span class="stringliteral">&quot;&lt;unknown&gt;&quot;</span>));
<a name="l00426"></a>00426 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac661a0b8ae11d5cf5cae1e6aa238496b"></a><!-- doxytag: member="cdr.c::do_batch_backend_process" ref="ac661a0b8ae11d5cf5cae1e6aa238496b" args="(void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void* do_batch_backend_process </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cdr_8c_source.html#l01166">1166</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cdr_8c_source.html#l00428">ast_cdr_free()</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="cdr_8c_source.html#l00067">ast_cdr_batch_item::cdr</a>, <a class="el" href="cdr_8c_source.html#l00068">ast_cdr_batch_item::next</a>, and <a class="el" href="cdr_8c_source.html#l01029">post_cdr()</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l01183">ast_cdr_submit_batch()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01167"></a>01167 {
<a name="l01168"></a>01168    <span class="keyword">struct </span><a class="code" href="structast__cdr__batch__item.html">ast_cdr_batch_item</a> *processeditem;
<a name="l01169"></a>01169    <span class="keyword">struct </span><a class="code" href="structast__cdr__batch__item.html">ast_cdr_batch_item</a> *batchitem = data;
<a name="l01170"></a>01170 
<a name="l01171"></a>01171    <span class="comment">/* Push each CDR into storage mechanism(s) and free all the memory */</span>
<a name="l01172"></a>01172    <span class="keywordflow">while</span> (batchitem) {
<a name="l01173"></a>01173       <a class="code" href="cdr_8c.html#ad01956d63583675f04baf543336b7c94">post_cdr</a>(batchitem-&gt;<a class="code" href="structast__cdr__batch__item.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>);
<a name="l01174"></a>01174       <a class="code" href="cdr_8h.html#a28b931d52c71271afd601186db95fec2" title="Free a CDR record.">ast_cdr_free</a>(batchitem-&gt;<a class="code" href="structast__cdr__batch__item.html#a0b6fbd632bcf2e09017a0b82c2ed41ff">cdr</a>);
<a name="l01175"></a>01175       processeditem = batchitem;
<a name="l01176"></a>01176       batchitem = batchitem-&gt;<a class="code" href="structast__cdr__batch__item.html#ab2c99c077caefd3c06547dcca0878b97">next</a>;
<a name="l01177"></a>01177       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(processeditem);
<a name="l01178"></a>01178    }
<a name="l01179"></a>01179 
<a name="l01180"></a>01180    <span class="keywordflow">return</span> NULL;
<a name="l01181"></a>01181 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a871988199d244a254ad19be2ab41d6e8"></a><!-- doxytag: member="cdr.c::do_cdr" ref="a871988199d244a254ad19be2ab41d6e8" args="(void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void* do_cdr </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cdr_8c_source.html#l01288">1288</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l01754">ast_cond_timedwait()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="time_8h_source.html#l00176">ast_samp2tv()</a>, <a class="el" href="sched_8c_source.html#l00581">ast_sched_runq()</a>, <a class="el" href="sched_8c_source.html#l00327">ast_sched_wait()</a>, <a class="el" href="utils_8c_source.html#l01365">ast_tvadd()</a>, <a class="el" href="time_8h_source.html#l00141">ast_tvnow()</a>, <a class="el" href="cdr_8c_source.html#l00098">cdr_pending_cond</a>, and <a class="el" href="cdr_8c_source.html#l00097">cdr_pending_lock</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l01396">do_reload()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01289"></a>01289 {
<a name="l01290"></a>01290    <span class="keyword">struct </span>timespec timeout;
<a name="l01291"></a>01291    <span class="keywordtype">int</span> schedms;
<a name="l01292"></a>01292    <span class="keywordtype">int</span> numevents = 0;
<a name="l01293"></a>01293 
<a name="l01294"></a>01294    <span class="keywordflow">for</span> (;;) {
<a name="l01295"></a>01295       <span class="keyword">struct </span>timeval now;
<a name="l01296"></a>01296       schedms = <a class="code" href="sched_8h.html#a64797d66b6051095debfcdb7f790e605" title="Determines number of seconds until the next outstanding event to take place Determine...">ast_sched_wait</a>(<a class="code" href="structsched.html">sched</a>);
<a name="l01297"></a>01297       <span class="comment">/* this shouldn&apos;t happen, but provide a 1 second default just in case */</span>
<a name="l01298"></a>01298       <span class="keywordflow">if</span> (schedms &lt;= 0)
<a name="l01299"></a>01299          schedms = 1000;
<a name="l01300"></a>01300       now = <a class="code" href="time_8h.html#a97e1bb8fbd7a103212789e87e7ed6073" title="Returns the sum of two timevals a + b.">ast_tvadd</a>(<a class="code" href="time_8h.html#abd5ba75c20787bcc479809c53b58406e" title="Returns current timeval. Meant to replace calls to gettimeofday().">ast_tvnow</a>(), <a class="code" href="time_8h.html#a147d132412d7188c1dcebf25b8d31c0c" title="Returns a timeval corresponding to the duration of n samples at rate r. Useful to...">ast_samp2tv</a>(schedms, 1000));
<a name="l01301"></a>01301       timeout.tv_sec = now.tv_sec;
<a name="l01302"></a>01302       timeout.tv_nsec = now.tv_usec * 1000;
<a name="l01303"></a>01303       <span class="comment">/* prevent stuff from clobbering cdr_pending_cond, then wait on signals sent to it until the timeout expires */</span>
<a name="l01304"></a>01304       <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;<a class="code" href="cdr_8c.html#acde84d468388579851a2de600c75a6e4">cdr_pending_lock</a>);
<a name="l01305"></a>01305       <a class="code" href="lock_8h.html#aa6fec4bba2b7190b94a1a4c7b6c541a4">ast_cond_timedwait</a>(&amp;<a class="code" href="cdr_8c.html#a3350735a1fc58db7a559b16073a83a3c">cdr_pending_cond</a>, &amp;<a class="code" href="cdr_8c.html#acde84d468388579851a2de600c75a6e4">cdr_pending_lock</a>, &amp;timeout);
<a name="l01306"></a>01306       numevents = <a class="code" href="sched_8h.html#a2867b39106061847a8508bf49e38f420" title="Runs the queue.">ast_sched_runq</a>(<a class="code" href="structsched.html">sched</a>);
<a name="l01307"></a>01307       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="cdr_8c.html#acde84d468388579851a2de600c75a6e4">cdr_pending_lock</a>);
<a name="l01308"></a>01308       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(2, <span class="stringliteral">&quot;Processed %d scheduled CDR batches from the run queue\n&quot;</span>, numevents);
<a name="l01309"></a>01309    }
<a name="l01310"></a>01310 
<a name="l01311"></a>01311    <span class="keywordflow">return</span> NULL;
<a name="l01312"></a>01312 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9024be7cdcbd31ce15acb957deb118cb"></a><!-- doxytag: member="cdr.c::do_reload" ref="a9024be7cdcbd31ce15acb957deb118cb" args="(int reload)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int do_reload </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>reload</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cdr_8c_source.html#l01396">1396</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cdr_8c_source.html#l01546">ast_cdr_engine_term()</a>, <a class="el" href="cli_8c_source.html#l01919">ast_cli_register()</a>, <a class="el" href="cli_8c_source.html#l01913">ast_cli_unregister()</a>, <a class="el" href="lock_8h_source.html#l01744">ast_cond_destroy()</a>, <a class="el" href="lock_8h_source.html#l01729">ast_cond_init()</a>, <a class="el" href="config_8c_source.html#l00827">ast_config_destroy()</a>, <a class="el" href="config_8c_source.html#l02071">ast_config_load2()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="options_8h_source.html#l00074">AST_OPT_FLAG_END_CDR_BEFORE_H_EXTEN</a>, <a class="el" href="options_8h_source.html#l00088">AST_OPT_FLAG_INITIATED_SECONDS</a>, <a class="el" href="asterisk_8c_source.html#l00171">ast_options</a>, <a class="el" href="utils_8h_source.html#l00384">ast_pthread_create_background</a>, <a class="el" href="lock_8h_source.html#l00082">AST_PTHREADT_NULL</a>, <a class="el" href="asterisk_8c_source.html#l00914">ast_register_atexit()</a>, <a class="el" href="sched_8c_source.html#l00439">ast_sched_add()</a>, <a class="el" href="sched_8h_source.html#l00051">AST_SCHED_DEL</a>, <a class="el" href="utils_8h_source.html#l00092">ast_set2_flag</a>, <a class="el" href="utils_8c_source.html#l01311">ast_true()</a>, <a class="el" href="asterisk_8c_source.html#l00932">ast_unregister_atexit()</a>, <a class="el" href="config_8c_source.html#l00435">ast_variable_retrieve()</a>, <a class="el" href="cdr_8c_source.html#l00084">BATCH_SAFE_SHUTDOWN_DEFAULT</a>, <a class="el" href="cdr_8c_source.html#l00083">BATCH_SCHEDULER_ONLY_DEFAULT</a>, <a class="el" href="cdr_8c_source.html#l00081">BATCH_SIZE_DEFAULT</a>, <a class="el" href="cdr_8c_source.html#l00082">BATCH_TIME_DEFAULT</a>, <a class="el" href="cdr_8c_source.html#l00088">batchmode</a>, <a class="el" href="cdr_8c_source.html#l00092">batchsafeshutdown</a>, <a class="el" href="cdr_8c_source.html#l00091">batchscheduleronly</a>, <a class="el" href="cdr_8c_source.html#l00089">batchsize</a>, <a class="el" href="cdr_8c_source.html#l00090">batchtime</a>, <a class="el" href="cdr_8c_source.html#l00094">cdr_batch_lock</a>, <a class="el" href="cdr_8c_source.html#l00098">cdr_pending_cond</a>, <a class="el" href="cdr_8c_source.html#l00078">cdr_sched</a>, <a class="el" href="cdr_8c_source.html#l00079">cdr_thread</a>, <a class="el" href="cdr_8c_source.html#l01393">cli_submit</a>, <a class="el" href="cdr__csv_8c_source.html#l00054">config</a>, <a class="el" href="config_8h_source.html#l00043">CONFIG_FLAG_FILEUNCHANGED</a>, <a class="el" href="config_8h_source.html#l00050">CONFIG_STATUS_FILEINVALID</a>, <a class="el" href="config_8h_source.html#l00048">CONFIG_STATUS_FILEMISSING</a>, <a class="el" href="config_8h_source.html#l00049">CONFIG_STATUS_FILEUNCHANGED</a>, <a class="el" href="cdr_8c_source.html#l01288">do_cdr()</a>, <a class="el" href="cdr_8c_source.html#l00086">enabled</a>, <a class="el" href="manager_8h_source.html#l00061">EVENT_FLAG_SYSTEM</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00141">LOG_NOTICE</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="manager_8h_source.html#l00181">manager_event</a>, <a class="el" href="cdr_8c_source.html#l01213">submit_scheduled_batch()</a>, and <a class="el" href="cdr_8c_source.html#l00087">unanswered</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l01522">ast_cdr_engine_init()</a>, and <a class="el" href="cdr_8c_source.html#l01551">ast_cdr_engine_reload()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01397"></a>01397 {
<a name="l01398"></a>01398    <span class="keyword">struct </span><a class="code" href="structast__config.html">ast_config</a> *<a class="code" href="cdr__csv_8c.html#a74bb62276efdf39dd94048e007fca05b">config</a>;
<a name="l01399"></a>01399    <span class="keyword">const</span> <span class="keywordtype">char</span> *enabled_value;
<a name="l01400"></a>01400    <span class="keyword">const</span> <span class="keywordtype">char</span> *unanswered_value;
<a name="l01401"></a>01401    <span class="keyword">const</span> <span class="keywordtype">char</span> *batched_value;
<a name="l01402"></a>01402    <span class="keyword">const</span> <span class="keywordtype">char</span> *scheduleronly_value;
<a name="l01403"></a>01403    <span class="keyword">const</span> <span class="keywordtype">char</span> *batchsafeshutdown_value;
<a name="l01404"></a>01404    <span class="keyword">const</span> <span class="keywordtype">char</span> *size_value;
<a name="l01405"></a>01405    <span class="keyword">const</span> <span class="keywordtype">char</span> *time_value;
<a name="l01406"></a>01406    <span class="keyword">const</span> <span class="keywordtype">char</span> *end_before_h_value;
<a name="l01407"></a>01407    <span class="keyword">const</span> <span class="keywordtype">char</span> *initiatedseconds_value;
<a name="l01408"></a>01408    <span class="keywordtype">int</span> cfg_size;
<a name="l01409"></a>01409    <span class="keywordtype">int</span> cfg_time;
<a name="l01410"></a>01410    <span class="keywordtype">int</span> was_enabled;
<a name="l01411"></a>01411    <span class="keywordtype">int</span> was_batchmode;
<a name="l01412"></a>01412    <span class="keywordtype">int</span> res=0;
<a name="l01413"></a>01413    <span class="keyword">struct </span><a class="code" href="structast__flags.html" title="Structure used to handle boolean flags.">ast_flags</a> <a class="code" href="app__rpt_8c.html#a1f57f20c1f46890828791a4827fe8752">config_flags</a> = { <a class="code" href="app__amd_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a> ? <a class="code" href="config_8h.html#a2d5492e116eebd5075f247d21fb9db26afa887389dc380bbdcffb65fec379f037">CONFIG_FLAG_FILEUNCHANGED</a> : 0 };
<a name="l01414"></a>01414 
<a name="l01415"></a>01415    <span class="keywordflow">if</span> ((config = <a class="code" href="config_8h.html#aab3eac8fa82a86a93c074deb7b77dbc9" title="Load a config file.">ast_config_load2</a>(<span class="stringliteral">&quot;cdr.conf&quot;</span>, <span class="stringliteral">&quot;cdr&quot;</span>, config_flags)) == <a class="code" href="config_8h.html#a846844eb2c4eb44554445936b3770711">CONFIG_STATUS_FILEUNCHANGED</a>)
<a name="l01416"></a>01416       <span class="keywordflow">return</span> 0;
<a name="l01417"></a>01417    <span class="keywordflow">if</span> (config == <a class="code" href="config_8h.html#a39bacaabcacf47583204c7634e64a2a0">CONFIG_STATUS_FILEMISSING</a> || config == <a class="code" href="config_8h.html#a846844eb2c4eb44554445936b3770711">CONFIG_STATUS_FILEUNCHANGED</a> || config == <a class="code" href="config_8h.html#a8d1a63cdf2c7aff22a77b6e75d93b377">CONFIG_STATUS_FILEINVALID</a>) {
<a name="l01418"></a>01418       <span class="keywordflow">return</span> 0;
<a name="l01419"></a>01419    }
<a name="l01420"></a>01420 
<a name="l01421"></a>01421    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;<a class="code" href="cdr_8c.html#a3a3969758c60f80011874aadde9d09ca">cdr_batch_lock</a>);
<a name="l01422"></a>01422 
<a name="l01423"></a>01423    <a class="code" href="cdr_8c.html#a4333e837bb5d4a34b4bbcbee3fa3f5b5">batchsize</a> = <a class="code" href="cdr_8c.html#a3d16a049b1043323e8f286d8afae0f5f">BATCH_SIZE_DEFAULT</a>;
<a name="l01424"></a>01424    <a class="code" href="cdr_8c.html#a60b61b5c8702c288d64ad7bda5cc4a9a">batchtime</a> = <a class="code" href="cdr_8c.html#a96cc252b1184015bf237bda67fd0fcd0">BATCH_TIME_DEFAULT</a>;
<a name="l01425"></a>01425    <a class="code" href="cdr_8c.html#a2884926c72604cd5790204ed221068a5">batchscheduleronly</a> = <a class="code" href="cdr_8c.html#ad79bf40ab0e985aca899df73fd0beada">BATCH_SCHEDULER_ONLY_DEFAULT</a>;
<a name="l01426"></a>01426    <a class="code" href="cdr_8c.html#a4ef34eb96cb5e9029153d7c36e3ce510">batchsafeshutdown</a> = <a class="code" href="cdr_8c.html#a7c6e22969cdb4bf720fdc2f0b65eaf5e">BATCH_SAFE_SHUTDOWN_DEFAULT</a>;
<a name="l01427"></a>01427    was_enabled = <a class="code" href="cdr_8c.html#a03e6cca0c879c0443efb431c30c14f76">enabled</a>;
<a name="l01428"></a>01428    was_batchmode = <a class="code" href="cdr_8c.html#a05c758689b70c64711a1789bff29f60c">batchmode</a>;
<a name="l01429"></a>01429    <a class="code" href="cdr_8c.html#a03e6cca0c879c0443efb431c30c14f76">enabled</a> = 1;
<a name="l01430"></a>01430    <a class="code" href="cdr_8c.html#a05c758689b70c64711a1789bff29f60c">batchmode</a> = 0;
<a name="l01431"></a>01431 
<a name="l01432"></a>01432    <span class="comment">/* don&apos;t run the next scheduled CDR posting while reloading */</span>
<a name="l01433"></a>01433    <a class="code" href="sched_8h.html#a25647782014f8dc012994efcd1b81d32" title="a loop construct to ensure that the scheduled task get deleted. The idea is that...">AST_SCHED_DEL</a>(<a class="code" href="structsched.html">sched</a>, <a class="code" href="cdr_8c.html#a4b8b0834379a5c8dd0deaa5161785419">cdr_sched</a>);
<a name="l01434"></a>01434 
<a name="l01435"></a>01435    <span class="keywordflow">if</span> (config) {
<a name="l01436"></a>01436       <span class="keywordflow">if</span> ((enabled_value = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(config, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;enable&quot;</span>))) {
<a name="l01437"></a>01437          <a class="code" href="cdr_8c.html#a03e6cca0c879c0443efb431c30c14f76">enabled</a> = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(enabled_value);
<a name="l01438"></a>01438       }
<a name="l01439"></a>01439       <span class="keywordflow">if</span> ((unanswered_value = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(config, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;unanswered&quot;</span>))) {
<a name="l01440"></a>01440          <a class="code" href="cdr_8c.html#a4a1bce7c6dac29f74373744e946a7b9b">unanswered</a> = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(unanswered_value);
<a name="l01441"></a>01441       }
<a name="l01442"></a>01442       <span class="keywordflow">if</span> ((batched_value = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(config, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;batch&quot;</span>))) {
<a name="l01443"></a>01443          <a class="code" href="cdr_8c.html#a05c758689b70c64711a1789bff29f60c">batchmode</a> = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(batched_value);
<a name="l01444"></a>01444       }
<a name="l01445"></a>01445       <span class="keywordflow">if</span> ((scheduleronly_value = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(config, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;scheduleronly&quot;</span>))) {
<a name="l01446"></a>01446          <a class="code" href="cdr_8c.html#a2884926c72604cd5790204ed221068a5">batchscheduleronly</a> = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(scheduleronly_value);
<a name="l01447"></a>01447       }
<a name="l01448"></a>01448       <span class="keywordflow">if</span> ((batchsafeshutdown_value = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(config, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;safeshutdown&quot;</span>))) {
<a name="l01449"></a>01449          <a class="code" href="cdr_8c.html#a4ef34eb96cb5e9029153d7c36e3ce510">batchsafeshutdown</a> = <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(batchsafeshutdown_value);
<a name="l01450"></a>01450       }
<a name="l01451"></a>01451       <span class="keywordflow">if</span> ((size_value = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(config, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;size&quot;</span>))) {
<a name="l01452"></a>01452          <span class="keywordflow">if</span> (sscanf(size_value, <span class="stringliteral">&quot;%30d&quot;</span>, &amp;cfg_size) &lt; 1)
<a name="l01453"></a>01453             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to convert &apos;%s&apos; to a numeric value.\n&quot;</span>, size_value);
<a name="l01454"></a>01454          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cfg_size &lt; 0)
<a name="l01455"></a>01455             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid maximum batch size &apos;%d&apos; specified, using default\n&quot;</span>, cfg_size);
<a name="l01456"></a>01456          <span class="keywordflow">else</span>
<a name="l01457"></a>01457             <a class="code" href="cdr_8c.html#a4333e837bb5d4a34b4bbcbee3fa3f5b5">batchsize</a> = cfg_size;
<a name="l01458"></a>01458       }
<a name="l01459"></a>01459       <span class="keywordflow">if</span> ((time_value = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(config, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;time&quot;</span>))) {
<a name="l01460"></a>01460          <span class="keywordflow">if</span> (sscanf(time_value, <span class="stringliteral">&quot;%30d&quot;</span>, &amp;cfg_time) &lt; 1)
<a name="l01461"></a>01461             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to convert &apos;%s&apos; to a numeric value.\n&quot;</span>, time_value);
<a name="l01462"></a>01462          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cfg_time &lt; 0)
<a name="l01463"></a>01463             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid maximum batch time &apos;%d&apos; specified, using default\n&quot;</span>, cfg_time);
<a name="l01464"></a>01464          <span class="keywordflow">else</span>
<a name="l01465"></a>01465             <a class="code" href="cdr_8c.html#a60b61b5c8702c288d64ad7bda5cc4a9a">batchtime</a> = cfg_time;
<a name="l01466"></a>01466       }
<a name="l01467"></a>01467       <span class="keywordflow">if</span> ((end_before_h_value = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(config, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;endbeforehexten&quot;</span>)))
<a name="l01468"></a>01468          <a class="code" href="utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>(&amp;<a class="code" href="group__main__options.html#gaa5dba371db31dc4ebecdff7c929ff263">ast_options</a>, <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(end_before_h_value), <a class="code" href="group__main__options.html#ggaf2588453b3a373a770741ad3ce353343abf0a2735133de955b2e2531c92cbb77d">AST_OPT_FLAG_END_CDR_BEFORE_H_EXTEN</a>);
<a name="l01469"></a>01469       <span class="keywordflow">if</span> ((initiatedseconds_value = <a class="code" href="config_8h.html#ab87fa38c79226e5a0105ad9d2e2e9ae5" title="Gets a variable.">ast_variable_retrieve</a>(config, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;initiatedseconds&quot;</span>)))
<a name="l01470"></a>01470          <a class="code" href="utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>(&amp;<a class="code" href="group__main__options.html#gaa5dba371db31dc4ebecdff7c929ff263">ast_options</a>, <a class="code" href="strings_8h.html#a387a69b3871ca31061566a73f45d20f4" title="Make sure something is true. Determine if a string containing a boolean value is...">ast_true</a>(initiatedseconds_value), <a class="code" href="group__main__options.html#ggaf2588453b3a373a770741ad3ce353343a170c1a2006a7410c9bdc18d33c7860e5">AST_OPT_FLAG_INITIATED_SECONDS</a>);
<a name="l01471"></a>01471    }
<a name="l01472"></a>01472 
<a name="l01473"></a>01473    <span class="keywordflow">if</span> (<a class="code" href="cdr_8c.html#a03e6cca0c879c0443efb431c30c14f76">enabled</a> &amp;&amp; !<a class="code" href="cdr_8c.html#a05c758689b70c64711a1789bff29f60c">batchmode</a>) {
<a name="l01474"></a>01474       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;CDR simple logging enabled.\n&quot;</span>);
<a name="l01475"></a>01475    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="cdr_8c.html#a03e6cca0c879c0443efb431c30c14f76">enabled</a> &amp;&amp; <a class="code" href="cdr_8c.html#a05c758689b70c64711a1789bff29f60c">batchmode</a>) {
<a name="l01476"></a>01476       <a class="code" href="cdr_8c.html#a4b8b0834379a5c8dd0deaa5161785419">cdr_sched</a> = <a class="code" href="sched_8h.html#a97176531282ac4e70aa107b2e8ee5543" title="Adds a scheduled event Schedule an event to take place at some point in the future...">ast_sched_add</a>(<a class="code" href="structsched.html">sched</a>, <a class="code" href="cdr_8c.html#a60b61b5c8702c288d64ad7bda5cc4a9a">batchtime</a> * 1000, <a class="code" href="cdr_8c.html#a8ba6c6273f321acb2b32dc754163e349">submit_scheduled_batch</a>, NULL);
<a name="l01477"></a>01477       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;CDR batch mode logging enabled, first of either size %d or time %d seconds.\n&quot;</span>, <a class="code" href="cdr_8c.html#a4333e837bb5d4a34b4bbcbee3fa3f5b5">batchsize</a>, <a class="code" href="cdr_8c.html#a60b61b5c8702c288d64ad7bda5cc4a9a">batchtime</a>);
<a name="l01478"></a>01478    } <span class="keywordflow">else</span> {
<a name="l01479"></a>01479       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;CDR logging disabled, data will be lost.\n&quot;</span>);
<a name="l01480"></a>01480    }
<a name="l01481"></a>01481 
<a name="l01482"></a>01482    <span class="comment">/* if this reload enabled the CDR batch mode, create the background thread</span>
<a name="l01483"></a>01483 <span class="comment">      if it does not exist */</span>
<a name="l01484"></a>01484    <span class="keywordflow">if</span> (<a class="code" href="cdr_8c.html#a03e6cca0c879c0443efb431c30c14f76">enabled</a> &amp;&amp; <a class="code" href="cdr_8c.html#a05c758689b70c64711a1789bff29f60c">batchmode</a> &amp;&amp; (!was_enabled || !was_batchmode) &amp;&amp; (<a class="code" href="cdr_8c.html#a1a28dc87e0a897d209ff16ca63bff690">cdr_thread</a> == <a class="code" href="lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>)) {
<a name="l01485"></a>01485       <a class="code" href="lock_8h.html#a21f75f462115427718d78aa66cc61f9b">ast_cond_init</a>(&amp;<a class="code" href="cdr_8c.html#a3350735a1fc58db7a559b16073a83a3c">cdr_pending_cond</a>, NULL);
<a name="l01486"></a>01486       <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a595e2f8aa398f4bd21e381c3211235fe">ast_pthread_create_background</a>(&amp;<a class="code" href="cdr_8c.html#a1a28dc87e0a897d209ff16ca63bff690">cdr_thread</a>, NULL, <a class="code" href="cdr_8c.html#a871988199d244a254ad19be2ab41d6e8">do_cdr</a>, NULL) &lt; 0) {
<a name="l01487"></a>01487          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to start CDR thread.\n&quot;</span>);
<a name="l01488"></a>01488          <a class="code" href="sched_8h.html#a25647782014f8dc012994efcd1b81d32" title="a loop construct to ensure that the scheduled task get deleted. The idea is that...">AST_SCHED_DEL</a>(<a class="code" href="structsched.html">sched</a>, <a class="code" href="cdr_8c.html#a4b8b0834379a5c8dd0deaa5161785419">cdr_sched</a>);
<a name="l01489"></a>01489       } <span class="keywordflow">else</span> {
<a name="l01490"></a>01490          <a class="code" href="cli_8h.html#a0ca7e108aceb1cd488bb9e3ee26e4ebc" title="Registers a command or an array of commands.">ast_cli_register</a>(&amp;<a class="code" href="cdr_8c.html#a3a189428ccf334b9693c4c4e7a2b94db">cli_submit</a>);
<a name="l01491"></a>01491          <a class="code" href="asterisk_8h.html#a9b09e95876dfecb9a8573819da0b255e" title="Register a function to be executed before Asterisk exits.">ast_register_atexit</a>(<a class="code" href="cdr_8h.html#a5634f8ea707fb2fdf87abdd55a539764">ast_cdr_engine_term</a>);
<a name="l01492"></a>01492          res = 0;
<a name="l01493"></a>01493       }
<a name="l01494"></a>01494    <span class="comment">/* if this reload disabled the CDR and/or batch mode and there is a background thread,</span>
<a name="l01495"></a>01495 <span class="comment">      kill it */</span>
<a name="l01496"></a>01496    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (((!<a class="code" href="cdr_8c.html#a03e6cca0c879c0443efb431c30c14f76">enabled</a> &amp;&amp; was_enabled) || (!<a class="code" href="cdr_8c.html#a05c758689b70c64711a1789bff29f60c">batchmode</a> &amp;&amp; was_batchmode)) &amp;&amp; (<a class="code" href="cdr_8c.html#a1a28dc87e0a897d209ff16ca63bff690">cdr_thread</a> != <a class="code" href="lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>)) {
<a name="l01497"></a>01497       <span class="comment">/* wake up the thread so it will exit */</span>
<a name="l01498"></a>01498       pthread_cancel(<a class="code" href="cdr_8c.html#a1a28dc87e0a897d209ff16ca63bff690">cdr_thread</a>);
<a name="l01499"></a>01499       pthread_kill(<a class="code" href="cdr_8c.html#a1a28dc87e0a897d209ff16ca63bff690">cdr_thread</a>, SIGURG);
<a name="l01500"></a>01500       pthread_join(<a class="code" href="cdr_8c.html#a1a28dc87e0a897d209ff16ca63bff690">cdr_thread</a>, NULL);
<a name="l01501"></a>01501       <a class="code" href="cdr_8c.html#a1a28dc87e0a897d209ff16ca63bff690">cdr_thread</a> = <a class="code" href="lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>;
<a name="l01502"></a>01502       <a class="code" href="lock_8h.html#a7752bcadc38f1d7a7a8528c538569115">ast_cond_destroy</a>(&amp;<a class="code" href="cdr_8c.html#a3350735a1fc58db7a559b16073a83a3c">cdr_pending_cond</a>);
<a name="l01503"></a>01503       <a class="code" href="cli_8h.html#a3189e6720486808603d13f5d2b58daf4" title="Unregisters a command or an array of commands.">ast_cli_unregister</a>(&amp;<a class="code" href="cdr_8c.html#a3a189428ccf334b9693c4c4e7a2b94db">cli_submit</a>);
<a name="l01504"></a>01504       <a class="code" href="asterisk_8h.html#a7f60f486e8e4a322ae5132d791a94bcc" title="Unregister a function registered with ast_register_atexit().">ast_unregister_atexit</a>(<a class="code" href="cdr_8h.html#a5634f8ea707fb2fdf87abdd55a539764">ast_cdr_engine_term</a>);
<a name="l01505"></a>01505       res = 0;
<a name="l01506"></a>01506       <span class="comment">/* if leaving batch mode, then post the CDRs in the batch,</span>
<a name="l01507"></a>01507 <span class="comment">         and don&apos;t reschedule, since we are stopping CDR logging */</span>
<a name="l01508"></a>01508       <span class="keywordflow">if</span> (!<a class="code" href="cdr_8c.html#a05c758689b70c64711a1789bff29f60c">batchmode</a> &amp;&amp; was_batchmode) {
<a name="l01509"></a>01509          <a class="code" href="cdr_8h.html#a5634f8ea707fb2fdf87abdd55a539764">ast_cdr_engine_term</a>();
<a name="l01510"></a>01510       }
<a name="l01511"></a>01511    } <span class="keywordflow">else</span> {
<a name="l01512"></a>01512       res = 0;
<a name="l01513"></a>01513    }
<a name="l01514"></a>01514 
<a name="l01515"></a>01515    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="cdr_8c.html#a3a3969758c60f80011874aadde9d09ca">cdr_batch_lock</a>);
<a name="l01516"></a>01516    <a class="code" href="config_8h.html#a710f0b2a897849572b77dd0854b8dc03" title="Destroys a config.">ast_config_destroy</a>(config);
<a name="l01517"></a>01517    <a class="code" href="manager_8h.html#a1ef0ee0044dbbeb4c3a5abc6c046b208" title="External routines may send asterisk manager events this way.">manager_event</a>(<a class="code" href="manager_8h.html#a420f0f755e1c3378b45ca7f6f0669ffa">EVENT_FLAG_SYSTEM</a>, <span class="stringliteral">&quot;Reload&quot;</span>, <span class="stringliteral">&quot;Module: CDR\r\nMessage: CDR subsystem reload requested\r\n&quot;</span>);
<a name="l01518"></a>01518 
<a name="l01519"></a>01519    <span class="keywordflow">return</span> res;
<a name="l01520"></a>01520 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a42f51bfd026479da84c974d890c5c673"></a><!-- doxytag: member="cdr.c::handle_cli_status" ref="a42f51bfd026479da84c974d890c5c673" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* handle_cli_status </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cdr_8c_source.html#l01314">1314</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="linkedlists_8h_source.html#l00451">AST_RWLIST_EMPTY</a>, <a class="el" href="linkedlists_8h_source.html#l00077">AST_RWLIST_RDLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00493">AST_RWLIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="sched_8c_source.html#l00645">ast_sched_when()</a>, <a class="el" href="cdr_8c.html#ac47f93001bc6fd919a5a4535f89c9ccd">batch</a>, <a class="el" href="cdr_8c_source.html#l00088">batchmode</a>, <a class="el" href="cdr_8c_source.html#l00092">batchsafeshutdown</a>, <a class="el" href="cdr_8c_source.html#l00091">batchscheduleronly</a>, <a class="el" href="cdr_8c_source.html#l00089">batchsize</a>, <a class="el" href="cdr_8c_source.html#l00090">batchtime</a>, <a class="el" href="cdr_8c_source.html#l00078">cdr_sched</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="cdr_8c_source.html#l00086">enabled</a>, <a class="el" href="cli_8h_source.html#l00058">ESS</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, <a class="el" href="structast__cdr__beitem.html#af871bc67d8f811f5eb06dd7652cd6231">ast_cdr_beitem::list</a>, <a class="el" href="cdr_8c_source.html#l00058">ast_cdr_beitem::name</a>, <a class="el" href="cdr_8c_source.html#l00072">ast_cdr_batch::size</a>, <a class="el" href="cdr_8c_source.html#l00087">unanswered</a>, and <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01315"></a>01315 {
<a name="l01316"></a>01316    <span class="keyword">struct </span><a class="code" href="structast__cdr__beitem.html">ast_cdr_beitem</a> *beitem=NULL;
<a name="l01317"></a>01317    <span class="keywordtype">int</span> cnt=0;
<a name="l01318"></a>01318    <span class="keywordtype">long</span> nextbatchtime=0;
<a name="l01319"></a>01319 
<a name="l01320"></a>01320    <span class="keywordflow">switch</span> (cmd) {
<a name="l01321"></a>01321    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l01322"></a>01322       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;cdr show status&quot;</span>;
<a name="l01323"></a>01323       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> = 
<a name="l01324"></a>01324          <span class="stringliteral">&quot;Usage: cdr show status\n&quot;</span>
<a name="l01325"></a>01325          <span class="stringliteral">&quot;  Displays the Call Detail Record engine system status.\n&quot;</span>;
<a name="l01326"></a>01326       <span class="keywordflow">return</span> NULL;
<a name="l01327"></a>01327    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l01328"></a>01328       <span class="keywordflow">return</span> NULL;
<a name="l01329"></a>01329    }
<a name="l01330"></a>01330 
<a name="l01331"></a>01331    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> &gt; 3)
<a name="l01332"></a>01332       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l01333"></a>01333 
<a name="l01334"></a>01334    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01335"></a>01335    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Call Detail Record (CDR) settings\n&quot;</span>);
<a name="l01336"></a>01336    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;----------------------------------\n&quot;</span>);
<a name="l01337"></a>01337    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;  Logging:                    %s\n&quot;</span>, <a class="code" href="cdr_8c.html#a03e6cca0c879c0443efb431c30c14f76">enabled</a> ? <span class="stringliteral">&quot;Enabled&quot;</span> : <span class="stringliteral">&quot;Disabled&quot;</span>);
<a name="l01338"></a>01338    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;  Mode:                       %s\n&quot;</span>, <a class="code" href="cdr_8c.html#a05c758689b70c64711a1789bff29f60c">batchmode</a> ? <span class="stringliteral">&quot;Batch&quot;</span> : <span class="stringliteral">&quot;Simple&quot;</span>);
<a name="l01339"></a>01339    <span class="keywordflow">if</span> (<a class="code" href="cdr_8c.html#a03e6cca0c879c0443efb431c30c14f76">enabled</a>) {
<a name="l01340"></a>01340       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;  Log unanswered calls:       %s\n\n&quot;</span>, <a class="code" href="cdr_8c.html#a4a1bce7c6dac29f74373744e946a7b9b">unanswered</a> ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>);
<a name="l01341"></a>01341       <span class="keywordflow">if</span> (<a class="code" href="cdr_8c.html#a05c758689b70c64711a1789bff29f60c">batchmode</a>) {
<a name="l01342"></a>01342          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;* Batch Mode Settings\n&quot;</span>);
<a name="l01343"></a>01343          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;  -------------------\n&quot;</span>);
<a name="l01344"></a>01344          <span class="keywordflow">if</span> (<a class="code" href="cdr_8c.html#ac47f93001bc6fd919a5a4535f89c9ccd">batch</a>)
<a name="l01345"></a>01345             cnt = <a class="code" href="cdr_8c.html#ac47f93001bc6fd919a5a4535f89c9ccd">batch</a>-&gt;<a class="code" href="structast__cdr__batch.html#a439227feff9d7f55384e8780cfc2eb82">size</a>;
<a name="l01346"></a>01346          <span class="keywordflow">if</span> (<a class="code" href="cdr_8c.html#a4b8b0834379a5c8dd0deaa5161785419">cdr_sched</a> &gt; -1)
<a name="l01347"></a>01347             nextbatchtime = <a class="code" href="sched_8h.html#a7b21967a70222990d1d7267b950f9e66" title="Returns the number of seconds before an event takes place.">ast_sched_when</a>(<a class="code" href="structsched.html">sched</a>, <a class="code" href="cdr_8c.html#a4b8b0834379a5c8dd0deaa5161785419">cdr_sched</a>);
<a name="l01348"></a>01348          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;  Safe shutdown:              %s\n&quot;</span>, <a class="code" href="cdr_8c.html#a4ef34eb96cb5e9029153d7c36e3ce510">batchsafeshutdown</a> ? <span class="stringliteral">&quot;Enabled&quot;</span> : <span class="stringliteral">&quot;Disabled&quot;</span>);
<a name="l01349"></a>01349          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;  Threading model:            %s\n&quot;</span>, <a class="code" href="cdr_8c.html#a2884926c72604cd5790204ed221068a5">batchscheduleronly</a> ? <span class="stringliteral">&quot;Scheduler only&quot;</span> : <span class="stringliteral">&quot;Scheduler plus separate threads&quot;</span>);
<a name="l01350"></a>01350          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;  Current batch size:         %d record%s\n&quot;</span>, cnt, <a class="code" href="cli_8h.html#aa09c07179fe1c89f52bb28bc126d26f2">ESS</a>(cnt));
<a name="l01351"></a>01351          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;  Maximum batch size:         %d record%s\n&quot;</span>, <a class="code" href="cdr_8c.html#a4333e837bb5d4a34b4bbcbee3fa3f5b5">batchsize</a>, <a class="code" href="cli_8h.html#aa09c07179fe1c89f52bb28bc126d26f2">ESS</a>(<a class="code" href="cdr_8c.html#a4333e837bb5d4a34b4bbcbee3fa3f5b5">batchsize</a>));
<a name="l01352"></a>01352          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;  Maximum batch time:         %d second%s\n&quot;</span>, <a class="code" href="cdr_8c.html#a60b61b5c8702c288d64ad7bda5cc4a9a">batchtime</a>, <a class="code" href="cli_8h.html#aa09c07179fe1c89f52bb28bc126d26f2">ESS</a>(<a class="code" href="cdr_8c.html#a60b61b5c8702c288d64ad7bda5cc4a9a">batchtime</a>));
<a name="l01353"></a>01353          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;  Next batch processing time: %ld second%s\n\n&quot;</span>, nextbatchtime, <a class="code" href="cli_8h.html#aa09c07179fe1c89f52bb28bc126d26f2">ESS</a>(nextbatchtime));
<a name="l01354"></a>01354       }
<a name="l01355"></a>01355       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;* Registered Backends\n&quot;</span>);
<a name="l01356"></a>01356       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;  -------------------\n&quot;</span>);
<a name="l01357"></a>01357       <a class="code" href="linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc" title="Read locks a list.">AST_RWLIST_RDLOCK</a>(&amp;<a class="code" href="structbe__list.html">be_list</a>);
<a name="l01358"></a>01358       <span class="keywordflow">if</span> (<a class="code" href="linkedlists_8h.html#a0044f6572f50a89049b3b5272e51b0e7">AST_RWLIST_EMPTY</a>(&amp;<a class="code" href="structbe__list.html">be_list</a>)) {
<a name="l01359"></a>01359          <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;    (none)\n&quot;</span>);
<a name="l01360"></a>01360       } <span class="keywordflow">else</span> {
<a name="l01361"></a>01361          <a class="code" href="linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;<a class="code" href="structbe__list.html">be_list</a>, beitem, <a class="code" href="structast__cdr__beitem.html#af871bc67d8f811f5eb06dd7652cd6231">list</a>) {
<a name="l01362"></a>01362             <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;    %s\n&quot;</span>, beitem-&gt;<a class="code" href="structast__cdr__beitem.html#a9997d8ee2df51d18efed254a5aa016fd">name</a>);
<a name="l01363"></a>01363          }
<a name="l01364"></a>01364       }
<a name="l01365"></a>01365       <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structbe__list.html">be_list</a>);
<a name="l01366"></a>01366       <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01367"></a>01367    }
<a name="l01368"></a>01368 
<a name="l01369"></a>01369    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l01370"></a>01370 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad4698622c0463583016f314fc86a108f"></a><!-- doxytag: member="cdr.c::handle_cli_submit" ref="ad4698622c0463583016f314fc86a108f" args="(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* handle_cli_submit </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> *&nbsp;</td>
          <td class="paramname"> <em>e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *&nbsp;</td>
          <td class="paramname"> <em>a</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cdr_8c_source.html#l01372">1372</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cli_8h_source.html#l00140">ast_cli_args::argc</a>, <a class="el" href="cli_8c_source.html#l00100">ast_cli()</a>, <a class="el" href="cli_8h_source.html#l00133">CLI_GENERATE</a>, <a class="el" href="cli_8h_source.html#l00132">CLI_INIT</a>, <a class="el" href="cli_8h_source.html#l00044">CLI_SHOWUSAGE</a>, <a class="el" href="cli_8h_source.html#l00043">CLI_SUCCESS</a>, <a class="el" href="cli_8h_source.html#l00168">ast_cli_entry::command</a>, <a class="el" href="cli_8h_source.html#l00139">ast_cli_args::fd</a>, <a class="el" href="cdr_8c_source.html#l01222">submit_unscheduled_batch()</a>, and <a class="el" href="cli_8h_source.html#l00159">ast_cli_entry::usage</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01373"></a>01373 {
<a name="l01374"></a>01374    <span class="keywordflow">switch</span> (cmd) {
<a name="l01375"></a>01375    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
<a name="l01376"></a>01376       e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;cdr submit&quot;</span>;
<a name="l01377"></a>01377       e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> = 
<a name="l01378"></a>01378          <span class="stringliteral">&quot;Usage: cdr submit\n&quot;</span>
<a name="l01379"></a>01379          <span class="stringliteral">&quot;       Posts all pending batched CDR data to the configured CDR backend engine modules.\n&quot;</span>;
<a name="l01380"></a>01380       <span class="keywordflow">return</span> NULL;
<a name="l01381"></a>01381    <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
<a name="l01382"></a>01382       <span class="keywordflow">return</span> NULL;
<a name="l01383"></a>01383    }
<a name="l01384"></a>01384    <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> &gt; 2)
<a name="l01385"></a>01385       <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
<a name="l01386"></a>01386 
<a name="l01387"></a>01387    <a class="code" href="cdr_8c.html#a4c3dbfb3f4642138052d447a42753a61">submit_unscheduled_batch</a>();
<a name="l01388"></a>01388    <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;Submitted CDRs to backend engines for processing.  This may take a while.\n&quot;</span>);
<a name="l01389"></a>01389 
<a name="l01390"></a>01390    <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
<a name="l01391"></a>01391 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8ba2f2526d5230859524407aad436361"></a><!-- doxytag: member="cdr.c::init_batch" ref="a8ba2f2526d5230859524407aad436361" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int init_batch </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl class="note"><dt><b>Note:</b></dt><dd>Don't call without cdr_batch_lock </dd></dl>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l01155">1155</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00081">ast_malloc</a>, <a class="el" href="cdr_8c.html#ac47f93001bc6fd919a5a4535f89c9ccd">batch</a>, and <a class="el" href="cdr_8c_source.html#l01147">reset_batch()</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l01234">ast_cdr_detach()</a>, and <a class="el" href="cdr_8c_source.html#l01522">ast_cdr_engine_init()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01156"></a>01156 {
<a name="l01157"></a>01157    <span class="comment">/* This is the single meta-batch used to keep track of all CDRs during the entire life of the program */</span>
<a name="l01158"></a>01158    <span class="keywordflow">if</span> (!(<a class="code" href="cdr_8c.html#ac47f93001bc6fd919a5a4535f89c9ccd">batch</a> = <a class="code" href="astmm_8h.html#a64a0e7a3ab511a3777ac56f5d43c628e">ast_malloc</a>(<span class="keyword">sizeof</span>(*<a class="code" href="cdr_8c.html#ac47f93001bc6fd919a5a4535f89c9ccd">batch</a>))))
<a name="l01159"></a>01159       <span class="keywordflow">return</span> -1;
<a name="l01160"></a>01160 
<a name="l01161"></a>01161    <a class="code" href="cdr_8c.html#a0165bd3137a70f31dcbe5fb47b5aee2a">reset_batch</a>();
<a name="l01162"></a>01162 
<a name="l01163"></a>01163    <span class="keywordflow">return</span> 0;
<a name="l01164"></a>01164 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad01956d63583675f04baf543336b7c94"></a><!-- doxytag: member="cdr.c::post_cdr" ref="ad01956d63583675f04baf543336b7c94" args="(struct ast_cdr *cdr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void post_cdr </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cdr.html">ast_cdr</a> *&nbsp;</td>
          <td class="paramname"> <em>cdr</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cdr_8c_source.html#l01029">1029</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cdr_8h_source.html#l00051">AST_CDR_ANSWERED</a>, <a class="el" href="cdr_8h_source.html#l00041">AST_CDR_FLAG_DIALED</a>, <a class="el" href="cdr_8h_source.html#l00042">AST_CDR_FLAG_ORIGINATED</a>, <a class="el" href="cdr_8h_source.html#l00034">AST_CDR_FLAG_POST_DISABLED</a>, <a class="el" href="cdr_8h_source.html#l00031">AST_CDR_FLAG_POSTED</a>, <a class="el" href="linkedlists_8h_source.html#l00077">AST_RWLIST_RDLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00493">AST_RWLIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="utils_8h_source.html#l00068">ast_set_flag</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="utils_8h_source.html#l00061">ast_test_flag</a>, <a class="el" href="cdr_8c_source.html#l00060">ast_cdr_beitem::be</a>, <a class="el" href="adsistub_8c_source.html#l00049">chan</a>, <a class="el" href="cdr_8h_source.html#l00079">ast_cdr::channel</a>, <a class="el" href="cdr_8c_source.html#l00420">check_post()</a>, <a class="el" href="cdr_8h_source.html#l00097">ast_cdr::disposition</a>, <a class="el" href="cdr_8h_source.html#l00081">ast_cdr::dstchannel</a>, <a class="el" href="structast__cdr__beitem.html#af871bc67d8f811f5eb06dd7652cd6231">ast_cdr_beitem::list</a>, <a class="el" href="cdr_8h_source.html#l00113">ast_cdr::next</a>, <a class="el" href="strings_8h_source.html#l00072">S_OR</a>, and <a class="el" href="cdr_8c_source.html#l00087">unanswered</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l01234">ast_cdr_detach()</a>, and <a class="el" href="cdr_8c_source.html#l01166">do_batch_backend_process()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01030"></a>01030 {
<a name="l01031"></a>01031    <span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>;
<a name="l01032"></a>01032    <span class="keyword">struct </span><a class="code" href="structast__cdr__beitem.html">ast_cdr_beitem</a> *i;
<a name="l01033"></a>01033 
<a name="l01034"></a>01034    <span class="keywordflow">for</span> ( ; cdr ; cdr = cdr-&gt;<a class="code" href="structast__cdr.html#a8098d02138e27b57d184b260b6669eed">next</a>) {
<a name="l01035"></a>01035       <span class="keywordflow">if</span> (!<a class="code" href="cdr_8c.html#a4a1bce7c6dac29f74373744e946a7b9b">unanswered</a> &amp;&amp; cdr-&gt;<a class="code" href="structast__cdr.html#a1f9669e5d9d64aa831cd9db2dd71534f">disposition</a> &lt; <a class="code" href="cdr_8h.html#ac7614ef6faaa8b913df85f229f0e037e">AST_CDR_ANSWERED</a> &amp;&amp; (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(cdr-&gt;<a class="code" href="structast__cdr.html#a6396dbd53fd6fedc1fc3ba2743f00eca">channel</a>) || <a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(cdr-&gt;<a class="code" href="structast__cdr.html#a0d43f7cac6179c7c4f9521f3138195b4">dstchannel</a>))) {
<a name="l01036"></a>01036          <span class="comment">/* For people, who don&apos;t want to see unanswered single-channel events */</span>
<a name="l01037"></a>01037          <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(cdr, <a class="code" href="cdr_8h.html#ad1c97f787a4ae3481dd9b48fef118572">AST_CDR_FLAG_POST_DISABLED</a>);
<a name="l01038"></a>01038          <span class="keywordflow">continue</span>;
<a name="l01039"></a>01039       }
<a name="l01040"></a>01040 
<a name="l01041"></a>01041       <span class="comment">/* don&apos;t post CDRs that are for dialed channels unless those</span>
<a name="l01042"></a>01042 <span class="comment">       * channels were originated from asterisk (pbx_spool, manager,</span>
<a name="l01043"></a>01043 <span class="comment">       * cli) */</span>
<a name="l01044"></a>01044       <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(cdr, <a class="code" href="cdr_8h.html#ad4e369ddb958ec8d383da42ff9e5fd72">AST_CDR_FLAG_DIALED</a>) &amp;&amp; !<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(cdr, <a class="code" href="cdr_8h.html#aa5bbf08b38c9dc55648f8134be251e1d">AST_CDR_FLAG_ORIGINATED</a>)) {
<a name="l01045"></a>01045          <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(cdr, <a class="code" href="cdr_8h.html#ad1c97f787a4ae3481dd9b48fef118572">AST_CDR_FLAG_POST_DISABLED</a>);
<a name="l01046"></a>01046          <span class="keywordflow">continue</span>;
<a name="l01047"></a>01047       }
<a name="l01048"></a>01048 
<a name="l01049"></a>01049       chan = <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(cdr-&gt;<a class="code" href="structast__cdr.html#a6396dbd53fd6fedc1fc3ba2743f00eca">channel</a>, <span class="stringliteral">&quot;&lt;unknown&gt;&quot;</span>);
<a name="l01050"></a>01050       <a class="code" href="cdr_8c.html#ab136d9ac92fdcacf14e91c2da770043f" title="print a warning if cdr already posted">check_post</a>(cdr);
<a name="l01051"></a>01051       <a class="code" href="utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(cdr, <a class="code" href="cdr_8h.html#ab7d9caea71bea12314af4b117a35c3f9">AST_CDR_FLAG_POSTED</a>);
<a name="l01052"></a>01052       <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(cdr, <a class="code" href="cdr_8h.html#ad1c97f787a4ae3481dd9b48fef118572">AST_CDR_FLAG_POST_DISABLED</a>))
<a name="l01053"></a>01053          <span class="keywordflow">continue</span>;
<a name="l01054"></a>01054       <a class="code" href="linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc" title="Read locks a list.">AST_RWLIST_RDLOCK</a>(&amp;<a class="code" href="structbe__list.html">be_list</a>);
<a name="l01055"></a>01055       <a class="code" href="linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;<a class="code" href="structbe__list.html">be_list</a>, i, <a class="code" href="structast__cdr__beitem.html#af871bc67d8f811f5eb06dd7652cd6231">list</a>) {
<a name="l01056"></a>01056          i-&gt;<a class="code" href="structast__cdr__beitem.html#ac91a6afe8445130d877f8c6a175138de">be</a>(cdr);
<a name="l01057"></a>01057       }
<a name="l01058"></a>01058       <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structbe__list.html">be_list</a>);
<a name="l01059"></a>01059    }
<a name="l01060"></a>01060 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0165bd3137a70f31dcbe5fb47b5aee2a"></a><!-- doxytag: member="cdr.c::reset_batch" ref="a0165bd3137a70f31dcbe5fb47b5aee2a" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void reset_batch </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl class="note"><dt><b>Note:</b></dt><dd>Don't call without cdr_batch_lock </dd></dl>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l01147">1147</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cdr_8c.html#ac47f93001bc6fd919a5a4535f89c9ccd">batch</a>, <a class="el" href="cdr_8c_source.html#l00073">ast_cdr_batch::head</a>, <a class="el" href="cdr_8c_source.html#l00072">ast_cdr_batch::size</a>, and <a class="el" href="cdr_8c_source.html#l00074">ast_cdr_batch::tail</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l01183">ast_cdr_submit_batch()</a>, and <a class="el" href="cdr_8c_source.html#l01155">init_batch()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01148"></a>01148 {
<a name="l01149"></a>01149    <a class="code" href="cdr_8c.html#ac47f93001bc6fd919a5a4535f89c9ccd">batch</a>-&gt;<a class="code" href="structast__cdr__batch.html#a439227feff9d7f55384e8780cfc2eb82">size</a> = 0;
<a name="l01150"></a>01150    <a class="code" href="cdr_8c.html#ac47f93001bc6fd919a5a4535f89c9ccd">batch</a>-&gt;<a class="code" href="structast__cdr__batch.html#aca71efae726094060905e37e306dd322">head</a> = NULL;
<a name="l01151"></a>01151    <a class="code" href="cdr_8c.html#ac47f93001bc6fd919a5a4535f89c9ccd">batch</a>-&gt;<a class="code" href="structast__cdr__batch.html#a374810230f45e60856c9704a4208db3a">tail</a> = NULL;
<a name="l01152"></a>01152 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af8a938a22715b2e6549f67efb4da5b14"></a><!-- doxytag: member="cdr.c::set_one_cid" ref="af8a938a22715b2e6549f67efb4da5b14" args="(struct ast_cdr *cdr, struct ast_channel *c)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void set_one_cid </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__cdr.html">ast_cdr</a> *&nbsp;</td>
          <td class="paramname"> <em>cdr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__channel.html">ast_channel</a> *&nbsp;</td>
          <td class="paramname"> <em>c</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00815">815</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cdr_8c_source.html#l00292">ast_cdr_setvar()</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="channel_8h_source.html#l00444">ast_channel::cid</a>, <a class="el" href="channel_8h_source.html#l00205">ast_callerid::cid_ani</a>, <a class="el" href="channel_8h_source.html#l00202">ast_callerid::cid_dnid</a>, <a class="el" href="channel_8h_source.html#l00204">ast_callerid::cid_name</a>, <a class="el" href="channel_8h_source.html#l00203">ast_callerid::cid_num</a>, <a class="el" href="cdr_8h_source.html#l00071">ast_cdr::clid</a>, <a class="el" href="adsistub_8c_source.html#l00077">num</a>, <a class="el" href="strings_8h_source.html#l00072">S_OR</a>, and <a class="el" href="cdr_8h_source.html#l00073">ast_cdr::src</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l00844">ast_cdr_init()</a>, <a class="el" href="cdr_8c_source.html#l00835">ast_cdr_setcid()</a>, and <a class="el" href="cdr_8c_source.html#l00996">ast_cdr_update()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00816"></a>00816 {
<a name="l00817"></a>00817    <span class="comment">/* Grab source from ANI or normal Caller*ID */</span>
<a name="l00818"></a>00818    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#af6fc584548091f45267cfaf7066119bd">num</a> = <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(c-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#a7bb8ad258e687da69d6933ab48320df7">cid_ani</a>, c-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ac8e0930b3408bc3745d3d841c520fe2f">cid_num</a>);
<a name="l00819"></a>00819    <span class="keywordflow">if</span> (!cdr)
<a name="l00820"></a>00820       <span class="keywordflow">return</span>;
<a name="l00821"></a>00821    <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(c-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ab2461abe6e234fe4f763b0a2179184b5">cid_name</a>)) {
<a name="l00822"></a>00822       <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(num)) <span class="comment">/* both name and number */</span>
<a name="l00823"></a>00823          snprintf(cdr-&gt;<a class="code" href="structast__cdr.html#ab7fd8bddf0ce6987ae5e58fb64cfc9e2">clid</a>, <span class="keyword">sizeof</span>(cdr-&gt;<a class="code" href="structast__cdr.html#ab7fd8bddf0ce6987ae5e58fb64cfc9e2">clid</a>), <span class="stringliteral">&quot;\&quot;%s\&quot; &lt;%s&gt;&quot;</span>, c-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ab2461abe6e234fe4f763b0a2179184b5">cid_name</a>, num);
<a name="l00824"></a>00824       <span class="keywordflow">else</span>           <span class="comment">/* only name */</span>
<a name="l00825"></a>00825          <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(cdr-&gt;<a class="code" href="structast__cdr.html#ab7fd8bddf0ce6987ae5e58fb64cfc9e2">clid</a>, c-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#ab2461abe6e234fe4f763b0a2179184b5">cid_name</a>, <span class="keyword">sizeof</span>(cdr-&gt;<a class="code" href="structast__cdr.html#ab7fd8bddf0ce6987ae5e58fb64cfc9e2">clid</a>));
<a name="l00826"></a>00826    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(num)) { <span class="comment">/* only number */</span>
<a name="l00827"></a>00827       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(cdr-&gt;<a class="code" href="structast__cdr.html#ab7fd8bddf0ce6987ae5e58fb64cfc9e2">clid</a>, num, <span class="keyword">sizeof</span>(cdr-&gt;<a class="code" href="structast__cdr.html#ab7fd8bddf0ce6987ae5e58fb64cfc9e2">clid</a>));
<a name="l00828"></a>00828    } <span class="keywordflow">else</span> {          <span class="comment">/* nothing known */</span>
<a name="l00829"></a>00829       cdr-&gt;<a class="code" href="structast__cdr.html#ab7fd8bddf0ce6987ae5e58fb64cfc9e2">clid</a>[0] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00830"></a>00830    }
<a name="l00831"></a>00831    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(cdr-&gt;<a class="code" href="structast__cdr.html#aa8e4f370559b3fe698f36b3132467f94">src</a>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(num, <span class="stringliteral">&quot;&quot;</span>), <span class="keyword">sizeof</span>(cdr-&gt;<a class="code" href="structast__cdr.html#aa8e4f370559b3fe698f36b3132467f94">src</a>));
<a name="l00832"></a>00832    <a class="code" href="cdr_8h.html#adb921d105e280e28efbfa46160bd9126">ast_cdr_setvar</a>(cdr, <span class="stringliteral">&quot;dnid&quot;</span>, <a class="code" href="strings_8h.html#a2faaa16929951bfd2802b7829a100ba2" title="returns the equivalent of logic or for strings: first one if not empty, otherwise...">S_OR</a>(c-&gt;<a class="code" href="structast__channel.html#ad7a6835087355f91c8a8236e9a2ef23f">cid</a>.<a class="code" href="structast__callerid.html#aa54ab157f47ac529034d524781e2a7e2">cid_dnid</a>, <span class="stringliteral">&quot;&quot;</span>), 0);
<a name="l00833"></a>00833 
<a name="l00834"></a>00834 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8ba6c6273f321acb2b32dc754163e349"></a><!-- doxytag: member="cdr.c::submit_scheduled_batch" ref="a8ba6c6273f321acb2b32dc754163e349" args="(const void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int submit_scheduled_batch </td>
          <td>(</td>
          <td class="paramtype">const void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cdr_8c_source.html#l01213">1213</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="cdr_8c_source.html#l01183">ast_cdr_submit_batch()</a>, <a class="el" href="sched_8c_source.html#l00439">ast_sched_add()</a>, <a class="el" href="cdr_8c_source.html#l00090">batchtime</a>, and <a class="el" href="cdr_8c_source.html#l00078">cdr_sched</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l01396">do_reload()</a>, and <a class="el" href="cdr_8c_source.html#l01222">submit_unscheduled_batch()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01214"></a>01214 {
<a name="l01215"></a>01215    <a class="code" href="cdr_8h.html#a9c55c03296c35e451b5a9577ce1aed28" title="Spawns (possibly) a new thread to submit a batch of CDRs to the backend engines.">ast_cdr_submit_batch</a>(0);
<a name="l01216"></a>01216    <span class="comment">/* manually reschedule from this point in time */</span>
<a name="l01217"></a>01217    <a class="code" href="cdr_8c.html#a4b8b0834379a5c8dd0deaa5161785419">cdr_sched</a> = <a class="code" href="sched_8h.html#a97176531282ac4e70aa107b2e8ee5543" title="Adds a scheduled event Schedule an event to take place at some point in the future...">ast_sched_add</a>(<a class="code" href="structsched.html">sched</a>, <a class="code" href="cdr_8c.html#a60b61b5c8702c288d64ad7bda5cc4a9a">batchtime</a> * 1000, <a class="code" href="cdr_8c.html#a8ba6c6273f321acb2b32dc754163e349">submit_scheduled_batch</a>, NULL);
<a name="l01218"></a>01218    <span class="comment">/* returning zero so the scheduler does not automatically reschedule */</span>
<a name="l01219"></a>01219    <span class="keywordflow">return</span> 0;
<a name="l01220"></a>01220 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4c3dbfb3f4642138052d447a42753a61"></a><!-- doxytag: member="cdr.c::submit_unscheduled_batch" ref="a4c3dbfb3f4642138052d447a42753a61" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void submit_unscheduled_batch </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cdr_8c_source.html#l01222">1222</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l01734">ast_cond_signal()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="sched_8c_source.html#l00439">ast_sched_add()</a>, <a class="el" href="sched_8h_source.html#l00051">AST_SCHED_DEL</a>, <a class="el" href="cdr_8c_source.html#l00098">cdr_pending_cond</a>, <a class="el" href="cdr_8c_source.html#l00097">cdr_pending_lock</a>, <a class="el" href="cdr_8c_source.html#l00078">cdr_sched</a>, and <a class="el" href="cdr_8c_source.html#l01213">submit_scheduled_batch()</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l01234">ast_cdr_detach()</a>, and <a class="el" href="cdr_8c_source.html#l01372">handle_cli_submit()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l01223"></a>01223 {
<a name="l01224"></a>01224    <span class="comment">/* this is okay since we are not being called from within the scheduler */</span>
<a name="l01225"></a>01225    <a class="code" href="sched_8h.html#a25647782014f8dc012994efcd1b81d32" title="a loop construct to ensure that the scheduled task get deleted. The idea is that...">AST_SCHED_DEL</a>(<a class="code" href="structsched.html">sched</a>, <a class="code" href="cdr_8c.html#a4b8b0834379a5c8dd0deaa5161785419">cdr_sched</a>);
<a name="l01226"></a>01226    <span class="comment">/* schedule the submission to occur ASAP (1 ms) */</span>
<a name="l01227"></a>01227    <a class="code" href="cdr_8c.html#a4b8b0834379a5c8dd0deaa5161785419">cdr_sched</a> = <a class="code" href="sched_8h.html#a97176531282ac4e70aa107b2e8ee5543" title="Adds a scheduled event Schedule an event to take place at some point in the future...">ast_sched_add</a>(<a class="code" href="structsched.html">sched</a>, 1, <a class="code" href="cdr_8c.html#a8ba6c6273f321acb2b32dc754163e349">submit_scheduled_batch</a>, NULL);
<a name="l01228"></a>01228    <span class="comment">/* signal the do_cdr thread to wakeup early and do some work (that lazy thread ;) */</span>
<a name="l01229"></a>01229    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;<a class="code" href="cdr_8c.html#acde84d468388579851a2de600c75a6e4">cdr_pending_lock</a>);
<a name="l01230"></a>01230    <a class="code" href="lock_8h.html#a02a91e30acdea6d13208d23636d37c87">ast_cond_signal</a>(&amp;<a class="code" href="cdr_8c.html#a3350735a1fc58db7a559b16073a83a3c">cdr_pending_cond</a>);
<a name="l01231"></a>01231    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="cdr_8c.html#acde84d468388579851a2de600c75a6e4">cdr_pending_lock</a>);
<a name="l01232"></a>01232 }
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="aa9efa3b0987da203851c54efb6147ee0"></a><!-- doxytag: member="cdr.c::ast_default_accountcode" ref="aa9efa3b0987da203851c54efb6147ee0" args="[AST_MAX_ACCOUNT_CODE]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="cdr_8c.html#aa9efa3b0987da203851c54efb6147ee0">ast_default_accountcode</a>[AST_MAX_ACCOUNT_CODE]</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00055">55</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l00772">__ast_channel_alloc_ap()</a>.</p>

</div>
</div>
<a class="anchor" id="a40d6ca75f86ae72a310c1cdceab8d345"></a><!-- doxytag: member="cdr.c::ast_default_amaflags" ref="a40d6ca75f86ae72a310c1cdceab8d345" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="cdr_8c.html#a40d6ca75f86ae72a310c1cdceab8d345">ast_default_amaflags</a> = AST_CDR_DOCUMENTATION</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Default AMA flag for billing records (CDR's) </p>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00054">54</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l00772">__ast_channel_alloc_ap()</a>, and <a class="el" href="features_8c_source.html#l02441">ast_bridge_call()</a>.</p>

</div>
</div>
<a class="anchor" id="ac47f93001bc6fd919a5a4535f89c9ccd"></a><!-- doxytag: member="cdr.c::batch" ref="ac47f93001bc6fd919a5a4535f89c9ccd" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__cdr__batch.html">ast_cdr_batch</a> * <a class="el" href="cdr_8c.html#ac47f93001bc6fd919a5a4535f89c9ccd">batch</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="cdr_8c_source.html#l01234">ast_cdr_detach()</a>, <a class="el" href="cdr_8c_source.html#l01183">ast_cdr_submit_batch()</a>, <a class="el" href="cdr_8c_source.html#l01314">handle_cli_status()</a>, <a class="el" href="cdr_8c_source.html#l01155">init_batch()</a>, and <a class="el" href="cdr_8c_source.html#l01147">reset_batch()</a>.</p>

</div>
</div>
<a class="anchor" id="a05c758689b70c64711a1789bff29f60c"></a><!-- doxytag: member="cdr.c::batchmode" ref="a05c758689b70c64711a1789bff29f60c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="cdr_8c.html#a05c758689b70c64711a1789bff29f60c">batchmode</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00088">88</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l01234">ast_cdr_detach()</a>, <a class="el" href="cdr_8c_source.html#l01396">do_reload()</a>, and <a class="el" href="cdr_8c_source.html#l01314">handle_cli_status()</a>.</p>

</div>
</div>
<a class="anchor" id="a4ef34eb96cb5e9029153d7c36e3ce510"></a><!-- doxytag: member="cdr.c::batchsafeshutdown" ref="a4ef34eb96cb5e9029153d7c36e3ce510" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="cdr_8c.html#a4ef34eb96cb5e9029153d7c36e3ce510">batchsafeshutdown</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00092">92</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l01546">ast_cdr_engine_term()</a>, <a class="el" href="cdr_8c_source.html#l01396">do_reload()</a>, and <a class="el" href="cdr_8c_source.html#l01314">handle_cli_status()</a>.</p>

</div>
</div>
<a class="anchor" id="a2884926c72604cd5790204ed221068a5"></a><!-- doxytag: member="cdr.c::batchscheduleronly" ref="a2884926c72604cd5790204ed221068a5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="cdr_8c.html#a2884926c72604cd5790204ed221068a5">batchscheduleronly</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00091">91</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l01183">ast_cdr_submit_batch()</a>, <a class="el" href="cdr_8c_source.html#l01396">do_reload()</a>, and <a class="el" href="cdr_8c_source.html#l01314">handle_cli_status()</a>.</p>

</div>
</div>
<a class="anchor" id="a4333e837bb5d4a34b4bbcbee3fa3f5b5"></a><!-- doxytag: member="cdr.c::batchsize" ref="a4333e837bb5d4a34b4bbcbee3fa3f5b5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="cdr_8c.html#a4333e837bb5d4a34b4bbcbee3fa3f5b5">batchsize</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00089">89</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l01234">ast_cdr_detach()</a>, <a class="el" href="cdr_8c_source.html#l01396">do_reload()</a>, and <a class="el" href="cdr_8c_source.html#l01314">handle_cli_status()</a>.</p>

</div>
</div>
<a class="anchor" id="a60b61b5c8702c288d64ad7bda5cc4a9a"></a><!-- doxytag: member="cdr.c::batchtime" ref="a60b61b5c8702c288d64ad7bda5cc4a9a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="cdr_8c.html#a60b61b5c8702c288d64ad7bda5cc4a9a">batchtime</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00090">90</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l01396">do_reload()</a>, <a class="el" href="cdr_8c_source.html#l01314">handle_cli_status()</a>, and <a class="el" href="cdr_8c_source.html#l01213">submit_scheduled_batch()</a>.</p>

</div>
</div>
<a class="anchor" id="a3a3969758c60f80011874aadde9d09ca"></a><!-- doxytag: member="cdr.c::cdr_batch_lock" ref="a3a3969758c60f80011874aadde9d09ca" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="lock_8h.html#a2d9118a2a8939f115eea771bce3a52f2">ast_mutex_t</a> <a class="el" href="cdr_8c.html#a3a3969758c60f80011874aadde9d09ca">cdr_batch_lock</a> = ((<a class="el" href="lock_8h.html#a2d9118a2a8939f115eea771bce3a52f2">ast_mutex_t</a>) PTHREAD_MUTEX_INITIALIZER )<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00094">94</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l01234">ast_cdr_detach()</a>, <a class="el" href="cdr_8c_source.html#l01522">ast_cdr_engine_init()</a>, <a class="el" href="cdr_8c_source.html#l01183">ast_cdr_submit_batch()</a>, and <a class="el" href="cdr_8c_source.html#l01396">do_reload()</a>.</p>

</div>
</div>
<a class="anchor" id="a3350735a1fc58db7a559b16073a83a3c"></a><!-- doxytag: member="cdr.c::cdr_pending_cond" ref="a3350735a1fc58db7a559b16073a83a3c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="lock_8h.html#ab134d98cdfe7de0f7a72b377c0765dc7">ast_cond_t</a> <a class="el" href="cdr_8c.html#a3350735a1fc58db7a559b16073a83a3c">cdr_pending_cond</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00098">98</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l01288">do_cdr()</a>, <a class="el" href="cdr_8c_source.html#l01396">do_reload()</a>, and <a class="el" href="cdr_8c_source.html#l01222">submit_unscheduled_batch()</a>.</p>

</div>
</div>
<a class="anchor" id="acde84d468388579851a2de600c75a6e4"></a><!-- doxytag: member="cdr.c::cdr_pending_lock" ref="acde84d468388579851a2de600c75a6e4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="lock_8h.html#a2d9118a2a8939f115eea771bce3a52f2">ast_mutex_t</a> <a class="el" href="cdr_8c.html#acde84d468388579851a2de600c75a6e4">cdr_pending_lock</a> = ((<a class="el" href="lock_8h.html#a2d9118a2a8939f115eea771bce3a52f2">ast_mutex_t</a>) PTHREAD_MUTEX_INITIALIZER )<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00097">97</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l01288">do_cdr()</a>, and <a class="el" href="cdr_8c_source.html#l01222">submit_unscheduled_batch()</a>.</p>

</div>
</div>
<a class="anchor" id="a62566fff085d3e4fd5843a6b70413ee1"></a><!-- doxytag: member="cdr.c::cdr_readonly_vars" ref="a62566fff085d3e4fd5843a6b70413ee1" args="[]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="cdr_8c.html#a62566fff085d3e4fd5843a6b70413ee1">cdr_readonly_vars</a>[]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Initial value:</b><div class="fragment"><pre class="fragment"> { <span class="stringliteral">&quot;clid&quot;</span>, <span class="stringliteral">&quot;src&quot;</span>, <span class="stringliteral">&quot;dst&quot;</span>, <span class="stringliteral">&quot;dcontext&quot;</span>, <span class="stringliteral">&quot;channel&quot;</span>, <span class="stringliteral">&quot;dstchannel&quot;</span>,
                <span class="stringliteral">&quot;lastapp&quot;</span>, <span class="stringliteral">&quot;lastdata&quot;</span>, <span class="stringliteral">&quot;start&quot;</span>, <span class="stringliteral">&quot;answer&quot;</span>, <span class="stringliteral">&quot;end&quot;</span>, <span class="stringliteral">&quot;duration&quot;</span>,
                <span class="stringliteral">&quot;billsec&quot;</span>, <span class="stringliteral">&quot;disposition&quot;</span>, <span class="stringliteral">&quot;amaflags&quot;</span>, <span class="stringliteral">&quot;accountcode&quot;</span>, <span class="stringliteral">&quot;uniqueid&quot;</span>,
                <span class="stringliteral">&quot;userfield&quot;</span>, NULL }
</pre></div>
<p>Definition at line <a class="el" href="cdr_8c_source.html#l00285">285</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l00362">ast_cdr_serialize_variables()</a>, and <a class="el" href="cdr_8c_source.html#l00292">ast_cdr_setvar()</a>.</p>

</div>
</div>
<a class="anchor" id="a4b8b0834379a5c8dd0deaa5161785419"></a><!-- doxytag: member="cdr.c::cdr_sched" ref="a4b8b0834379a5c8dd0deaa5161785419" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="cdr_8c.html#a4b8b0834379a5c8dd0deaa5161785419">cdr_sched</a> = -1<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00078">78</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l01396">do_reload()</a>, <a class="el" href="cdr_8c_source.html#l01314">handle_cli_status()</a>, <a class="el" href="cdr_8c_source.html#l01213">submit_scheduled_batch()</a>, and <a class="el" href="cdr_8c_source.html#l01222">submit_unscheduled_batch()</a>.</p>

</div>
</div>
<a class="anchor" id="a1a28dc87e0a897d209ff16ca63bff690"></a><!-- doxytag: member="cdr.c::cdr_thread" ref="a1a28dc87e0a897d209ff16ca63bff690" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_t <a class="el" href="cdr_8c.html#a1a28dc87e0a897d209ff16ca63bff690">cdr_thread</a> = AST_PTHREADT_NULL<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00079">79</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l01396">do_reload()</a>.</p>

</div>
</div>
<a class="anchor" id="a2bfbc88e2118d426be7b9ed59d6cf14f"></a><!-- doxytag: member="cdr.c::cli_status" ref="a2bfbc88e2118d426be7b9ed59d6cf14f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> <a class="el" href="res__config__sqlite_8c.html#a47b6b9c6ba9ec579e0cc93d497500db8">cli_status</a> = AST_CLI_DEFINE(handle_cli_status, &quot;Display the CDR <a class="el" href="app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a>&quot;)<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cdr_8c_source.html#l01394">1394</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l01522">ast_cdr_engine_init()</a>.</p>

</div>
</div>
<a class="anchor" id="a3a189428ccf334b9693c4c4e7a2b94db"></a><!-- doxytag: member="cdr.c::cli_submit" ref="a3a189428ccf334b9693c4c4e7a2b94db" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__cli__entry.html">ast_cli_entry</a> <a class="el" href="cdr_8c.html#a3a189428ccf334b9693c4c4e7a2b94db">cli_submit</a> = AST_CLI_DEFINE(handle_cli_submit, &quot;Posts all pending batched CDR data&quot;)<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cdr_8c_source.html#l01393">1393</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l01396">do_reload()</a>.</p>

</div>
</div>
<a class="anchor" id="a03e6cca0c879c0443efb431c30c14f76"></a><!-- doxytag: member="cdr.c::enabled" ref="a03e6cca0c879c0443efb431c30c14f76" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="dnsmgr_8c.html#a03e6cca0c879c0443efb431c30c14f76">enabled</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00086">86</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l01234">ast_cdr_detach()</a>, <a class="el" href="dnsmgr_8c_source.html#l00126">ast_dnsmgr_lookup()</a>, <a class="el" href="cdr_8c_source.html#l00100">check_cdr_enabled()</a>, <a class="el" href="cdr_8c_source.html#l01396">do_reload()</a>, <a class="el" href="dnsmgr_8c_source.html#l00273">handle_cli_refresh()</a>, and <a class="el" href="cdr_8c_source.html#l01314">handle_cli_status()</a>.</p>

</div>
</div>
<a class="anchor" id="aea6233539fc73fc5303bf7525ec27e73"></a><!-- doxytag: member="cdr.c::sched" ref="aea6233539fc73fc5303bf7525ec27e73" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structsched__context.html">sched_context</a>* <a class="el" href="structsched.html">sched</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00077">77</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

</div>
</div>
<a class="anchor" id="a4a1bce7c6dac29f74373744e946a7b9b"></a><!-- doxytag: member="cdr.c::unanswered" ref="a4a1bce7c6dac29f74373744e946a7b9b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="cdr_8c.html#a4a1bce7c6dac29f74373744e946a7b9b">unanswered</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Is the CDR subsystem enabled ? </p>

<p>Definition at line <a class="el" href="cdr_8c_source.html#l00087">87</a> of file <a class="el" href="cdr_8c_source.html">cdr.c</a>.</p>

<p>Referenced by <a class="el" href="cdr_8c_source.html#l00160">ast_cdr_isset_unanswered()</a>, <a class="el" href="cdr_8c_source.html#l01396">do_reload()</a>, <a class="el" href="cdr_8c_source.html#l01314">handle_cli_status()</a>, and <a class="el" href="cdr_8c_source.html#l01029">post_cdr()</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:19:43 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
