<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:23:35 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="CLI_command_API">CLI command API </a></h1><p>CLI commands are described by a struct <a class="el" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a> that contains all the components for their implementation.</p>
<p>In the "old-style" format, the record must contain:</p>
<ul>
<li>a NULL-terminated array of words constituting the command, e.g. { "set", "debug", "on", NULL },</li>
<li>a summary string (short) and a usage string (longer);</li>
<li>a handler which implements the command itself, invoked with a file descriptor and argc/argv as typed by the <a class="el" href="structuser.html" title="structure to hold users read from users.conf">user</a></li>
<li>a 'generator' function which, given a partial string, can generate legal completions for it. An example is</li>
</ul>
<p>int old_setdebug(int fd, int argc, char *argv[]); char *dbg_complete(const char *line, const char *word, int pos, int n);</p>
<p>{ { "set", "debug", "on", NULL }, do_setdebug, "Enable debugging", set_debug_usage, dbg_complete },</p>
<p>In the "new-style" format, all the above functionalities are implemented by a single function, and the arguments tell which output is required. The prototype is the following:</p>
<p>char *new_setdebug(const struct <a class="el" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a> *e, int cmd, struct <a class="el" href="structast__cli__args.html">ast_cli_args</a> *a);</p>
<p>... this is how we create the entry to register AST_CLI_DEFINE(new_setdebug, "short description") ...</p>
<p>To help the transition, we make the pointer to the struct <a class="el" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a> available to old-style handlers via argv[-1].</p>
<p>An example of new-style handler is the following</p>
<div class="fragment"><pre class="fragment"><span class="keyword">static</span> <span class="keywordtype">char</span> *test_new_cli(<span class="keyword">struct</span> <a class="code" href="structast__cli__entry.html" title="descriptor for a cli entry.">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="structast__cli__args.html">ast_cli_args</a> *a)
{
   <span class="keyword">static</span> <span class="keywordtype">char</span> *choices = { <span class="stringliteral">&quot;one&quot;</span>, <span class="stringliteral">&quot;two&quot;</span>, <span class="stringliteral">&quot;three&quot;</span>, NULL };

        <span class="keywordflow">switch</span> (cmd) {
        <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:
      e-&gt;<a class="code" href="structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;do this well&quot;</span>;
                e-&gt;<a class="code" href="structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =
         <span class="stringliteral">&quot;Usage: do this well &lt;arg&gt;\n&quot;</span>
         <span class="stringliteral">&quot;  typically multiline with body indented\n&quot;</span>;
      <span class="keywordflow">return</span> NULL;

        <span class="keywordflow">case</span> <a class="code" href="cli_8h.html#a1c31538430e3fbd1b13483cec8d38feea76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:
                <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#a1910d262855b71da353ed0d07a6c7823">pos</a> &gt; e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a>)
                        <span class="keywordflow">return</span> NULL;
         <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a7d198ac45b2d75bb30eb773582caf89f">ast_cli_complete</a>(a-&gt;<a class="code" href="structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">word</a>, choices, a-&gt;<a class="code" href="structast__cli__args.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>);

        <span class="keywordflow">default</span>:        
                <span class="comment">// we are guaranteed to be called with argc &gt;= e-&gt;args;</span>
                <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structast__cli__args.html#ad1447518f4372828b8435ae82e48499e">argc</a> &gt; e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a> + 1) <span class="comment">// we accept one extra argument</span>
                        <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;
                <a class="code" href="cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="structast__cli__args.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, <span class="stringliteral">&quot;done this well for %s\n&quot;</span>, e-&gt;<a class="code" href="structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6" title="This gets set in ast_cli_register().">args</a>[argc-1]);
                <span class="keywordflow">return</span> <a class="code" href="cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;
        }
}
</pre></div> </div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:23:35 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
