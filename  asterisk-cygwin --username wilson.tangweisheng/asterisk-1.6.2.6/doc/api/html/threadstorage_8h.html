<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:23:32 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_1ab815038f534adda65c8b4ae4993449.html">include</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_16d825f1fa9ecca2e70b1a8d9256d0e6.html">asterisk</a>
  </div>
</div>
<div class="contents">
<h1>threadstorage.h File Reference</h1>
<p>Definitions to aid in the use of thread local storage.  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="utils_8h_source.html">asterisk/utils.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="inline__api_8h_source.html">asterisk/inline_api.h</a>&quot;</code><br/>

<p><a href="threadstorage_8h_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__threadstorage.html">ast_threadstorage</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">data for a thread locally stored variable  <a href="structast__threadstorage.html#_details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="threadstorage_8h.html#a5545b888019b60e4ed16ba6a98e64133">AST_PTHREAD_ONCE_INIT</a>&nbsp;&nbsp;&nbsp;PTHREAD_ONCE_INIT</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="threadstorage_8h.html#ac268c0a8272ec11e73269392507fb1a6">AST_THREADSTORAGE</a>(<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)&nbsp;&nbsp;&nbsp;AST_THREADSTORAGE_CUSTOM_SCOPE(<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, NULL, ast_free_ptr, static)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Define a thread storage variable.  <a href="#ac268c0a8272ec11e73269392507fb1a6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="threadstorage_8h.html#a3fb5391416c5bf7a18d5f7f7b84c4b81">AST_THREADSTORAGE_CUSTOM</a>(a, b, c)&nbsp;&nbsp;&nbsp;AST_THREADSTORAGE_CUSTOM_SCOPE(a,b,c,static)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Define a thread storage variable, with custom initialization and cleanup.  <a href="#a3fb5391416c5bf7a18d5f7f7b84c4b81"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="threadstorage_8h.html#aab3853c526759ceaaf346c708c815df7">AST_THREADSTORAGE_CUSTOM_SCOPE</a>(<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, c_init, c_cleanup, scope)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="threadstorage_8h.html#af805e11a57bcee8656b8e65e7546379e">AST_THREADSTORAGE_EXTERNAL</a>(<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)&nbsp;&nbsp;&nbsp;extern struct <a class="el" href="structast__threadstorage.html">ast_threadstorage</a> <a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="threadstorage_8h.html#a4db23c8f7564d3d916d7934265ca474f">AST_THREADSTORAGE_PUBLIC</a>(<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)&nbsp;&nbsp;&nbsp;AST_THREADSTORAGE_CUSTOM_SCOPE(<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, NULL, ast_free_ptr,)</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="threadstorage_8h.html#a9153839e218c987b2ae47cbd39ac1ab5">ast_threadstorage_get</a> (struct <a class="el" href="structast__threadstorage.html">ast_threadstorage</a> *ts, size_t init_size)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Retrieve thread storage.  <a href="#a9153839e218c987b2ae47cbd39ac1ab5"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Definitions to aid in the use of thread local storage. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Russell Bryant &lt;<a href="mailto:russell@digium.com">russell@digium.com</a>&gt; <ul>
<li><a class="el" href="AstThreadStorage.html">The Asterisk Thread Storage API</a> </li>
</ul>
</dd></dl>

<p>Definition in file <a class="el" href="threadstorage_8h_source.html">threadstorage.h</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a5545b888019b60e4ed16ba6a98e64133"></a><!-- doxytag: member="threadstorage.h::AST_PTHREAD_ONCE_INIT" ref="a5545b888019b60e4ed16ba6a98e64133" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_PTHREAD_ONCE_INIT&nbsp;&nbsp;&nbsp;PTHREAD_ONCE_INIT</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="threadstorage_8h_source.html#l00109">109</a> of file <a class="el" href="threadstorage_8h_source.html">threadstorage.h</a>.</p>

</div>
</div>
<a class="anchor" id="ac268c0a8272ec11e73269392507fb1a6"></a><!-- doxytag: member="threadstorage.h::AST_THREADSTORAGE" ref="ac268c0a8272ec11e73269392507fb1a6" args="(name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_THREADSTORAGE</td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;AST_THREADSTORAGE_CUSTOM_SCOPE(<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, NULL, ast_free_ptr, static)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Define a thread storage variable. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>The name of the thread storage object</td></tr>
  </table>
  </dd>
</dl>
<p>This macro would be used to declare an instance of thread storage in a file.</p>
<p>Example usage: </p>
<div class="fragment"><pre class="fragment"> <a class="code" href="threadstorage_8h.html#ac268c0a8272ec11e73269392507fb1a6" title="Define a thread storage variable.">AST_THREADSTORAGE</a>(my_buf);
</pre></div> 
<p>Definition at line <a class="el" href="threadstorage_8h_source.html#l00081">81</a> of file <a class="el" href="threadstorage_8h_source.html">threadstorage.h</a>.</p>

</div>
</div>
<a class="anchor" id="a3fb5391416c5bf7a18d5f7f7b84c4b81"></a><!-- doxytag: member="threadstorage.h::AST_THREADSTORAGE_CUSTOM" ref="a3fb5391416c5bf7a18d5f7f7b84c4b81" args="(a, b, c)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_THREADSTORAGE_CUSTOM</td>
          <td>(</td>
          <td class="paramtype">a, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">b, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">c&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;AST_THREADSTORAGE_CUSTOM_SCOPE(a,b,c,static)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Define a thread storage variable, with custom initialization and cleanup. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>name</em>&nbsp;</td><td>The name of the thread storage object </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>init</em>&nbsp;</td><td>This is a custom function that will be called after each thread specific object is allocated, with the allocated block of memory passed as the argument. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>cleanup</em>&nbsp;</td><td>This is a custom function that will be called instead of ast_free when the thread goes away. Note that if this is used, it *MUST* call free on the allocated memory.</td></tr>
  </table>
  </dd>
</dl>
<p>Example usage: </p>
<div class="fragment"><pre class="fragment"> <a class="code" href="threadstorage_8h.html#a3fb5391416c5bf7a18d5f7f7b84c4b81" title="Define a thread storage variable, with custom initialization and cleanup.">AST_THREADSTORAGE_CUSTOM</a>(my_buf, my_init, my_cleanup);
</pre></div> 
<p>Definition at line <a class="el" href="threadstorage_8h_source.html#l00104">104</a> of file <a class="el" href="threadstorage_8h_source.html">threadstorage.h</a>.</p>

</div>
</div>
<a class="anchor" id="aab3853c526759ceaaf346c708c815df7"></a><!-- doxytag: member="threadstorage.h::AST_THREADSTORAGE_CUSTOM_SCOPE" ref="aab3853c526759ceaaf346c708c815df7" args="(name, c_init, c_cleanup, scope)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_THREADSTORAGE_CUSTOM_SCOPE</td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">c_init, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">c_cleanup, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">scope&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="threadstorage_8h_source.html#l00113">113</a> of file <a class="el" href="threadstorage_8h_source.html">threadstorage.h</a>.</p>

</div>
</div>
<a class="anchor" id="af805e11a57bcee8656b8e65e7546379e"></a><!-- doxytag: member="threadstorage.h::AST_THREADSTORAGE_EXTERNAL" ref="af805e11a57bcee8656b8e65e7546379e" args="(name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_THREADSTORAGE_EXTERNAL</td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;extern struct <a class="el" href="structast__threadstorage.html">ast_threadstorage</a> <a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="threadstorage_8h_source.html#l00085">85</a> of file <a class="el" href="threadstorage_8h_source.html">threadstorage.h</a>.</p>

</div>
</div>
<a class="anchor" id="a4db23c8f7564d3d916d7934265ca474f"></a><!-- doxytag: member="threadstorage.h::AST_THREADSTORAGE_PUBLIC" ref="a4db23c8f7564d3d916d7934265ca474f" args="(name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_THREADSTORAGE_PUBLIC</td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td>&nbsp;&nbsp;&nbsp;AST_THREADSTORAGE_CUSTOM_SCOPE(<a class="el" href="channel_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, NULL, ast_free_ptr,)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="threadstorage_8h_source.html#l00083">83</a> of file <a class="el" href="threadstorage_8h_source.html">threadstorage.h</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a9153839e218c987b2ae47cbd39ac1ab5"></a><!-- doxytag: member="threadstorage.h::ast_threadstorage_get" ref="a9153839e218c987b2ae47cbd39ac1ab5" args="(struct ast_threadstorage *ts, size_t init_size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__inline__ void * ast_threadstorage_get </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__threadstorage.html">ast_threadstorage</a> *&nbsp;</td>
          <td class="paramname"> <em>ts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>init_size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Retrieve thread storage. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>ts</em>&nbsp;</td><td>This is a pointer to the thread storage structure declared by using the AST_THREADSTORAGE macro. If declared with <a class="el" href="threadstorage_8h.html#ac268c0a8272ec11e73269392507fb1a6" title="Define a thread storage variable.">AST_THREADSTORAGE(my_buf)</a>, then this argument would be (&amp;my_buf). </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>init_size</em>&nbsp;</td><td>This is the amount of space to be allocated the first time this thread <a class="el" href="structrequests.html">requests</a> its data. Thus, this should be the size that the code accessing this thread storage is assuming the size to be.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>This function will return the thread local storage associated with the thread storage management variable passed as the first argument. The result will be NULL in the case of a memory allocation error.</dd></dl>
<p>Example usage: </p>
<div class="fragment"><pre class="fragment"> <a class="code" href="threadstorage_8h.html#ac268c0a8272ec11e73269392507fb1a6" title="Define a thread storage variable.">AST_THREADSTORAGE</a>(my_buf);
<span class="preprocessor"> #define MY_BUF_SIZE   128</span>
<span class="preprocessor"></span> ...
 <span class="keywordtype">void</span> my_func(<span class="keyword">const</span> <span class="keywordtype">char</span> *fmt, ...)
 {
      <span class="keywordtype">void</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>;

      <span class="keywordflow">if</span> (!(buf = <a class="code" href="threadstorage_8h.html#a9153839e218c987b2ae47cbd39ac1ab5" title="Retrieve thread storage.">ast_threadstorage_get</a>(&amp;my_buf, MY_BUF_SIZE)))
           <span class="keywordflow">return</span>;
      ...
 }
</pre></div> 
<p>Definition at line <a class="el" href="threadstorage_8h_source.html#l00191">191</a> of file <a class="el" href="threadstorage_8h_source.html">threadstorage.h</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="adsistub_8c_source.html#l00059">buf</a>, <a class="el" href="structast__threadstorage.html#a59f29d561815aa30f0c288c7e1614184">ast_threadstorage::custom_init</a>, <a class="el" href="astmm_8h_source.html#l00084">free</a>, <a class="el" href="threadstorage_8h_source.html#l00058">ast_threadstorage::key</a>, <a class="el" href="structast__threadstorage.html#a44525abbdeace3cc3564aa6575ce3912">ast_threadstorage::key_init</a>, and <a class="el" href="threadstorage_8h_source.html#l00057">ast_threadstorage::once</a>.</p>

<p>Referenced by <a class="el" href="frame_8c_source.html#l00333">__frame_free()</a>, <a class="el" href="func__curl_8c_source.html#l00397">acf_curl_exec()</a>, <a class="el" href="frame_8c_source.html#l00291">ast_frame_header_new()</a>, <a class="el" href="frame_8c_source.html#l00474">ast_frdup()</a>, <a class="el" href="utils_8c_source.html#l00431">ast_inet_ntoa()</a>, <a class="el" href="channel_8c_source.html#l00656">ast_state2str()</a>, <a class="el" href="chan__skinny_8c_source.html#l04052">control2str()</a>, <a class="el" href="chan__skinny_8c_source.html#l02838">device2str()</a>, <a class="el" href="utils_8c_source.html#l00933">dummy_start()</a>, <a class="el" href="iax2-parser_8c_source.html#l01168">iax_frame_free()</a>, <a class="el" href="iax2-parser_8c_source.html#l01110">iax_frame_new()</a>, <a class="el" href="chan__sip_8c_source.html#l08040">process_sdp()</a>, <a class="el" href="config_8c_source.html#l00922">process_text_line()</a>, and <a class="el" href="chan__sip_8c_source.html#l09600">transmit_response_using_temp()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00195"></a>00195 {
</pre></div></p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:23:32 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
