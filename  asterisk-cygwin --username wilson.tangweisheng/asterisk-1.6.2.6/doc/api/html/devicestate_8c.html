<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:21:58 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_afe38fc0ccf2e9eefca5d5c6b03503d9.html">main</a>
  </div>
</div>
<div class="contents">
<h1>devicestate.c File Reference</h1>
<p>Device <a class="el" href="structstate.html">state</a> management.  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="asterisk_8h_source.html">asterisk.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="__private_8h_source.html">asterisk/_private.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="channel_8h_source.html">asterisk/channel.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="utils_8h_source.html">asterisk/utils.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="lock_8h_source.html">asterisk/lock.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="linkedlists_8h_source.html">asterisk/linkedlists.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="devicestate_8h_source.html">asterisk/devicestate.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="pbx_8h_source.html">asterisk/pbx.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="app_8h_source.html">asterisk/app.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="event_8h_source.html">asterisk/event.h</a>&quot;</code><br/>

<p><a href="devicestate_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structchan2dev.html">chan2dev</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Mapping for channel states to device states.  <a href="structchan2dev.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structchange__collection.html">change_collection</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structdevstate__change.html">devstate_change</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structdevstate__prov.html">devstate_prov</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">A device <a class="el" href="structstate.html">state</a> provider (not a channel).  <a href="structdevstate__prov.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structdevstate__provs.html">devstate_provs</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">A list of providers.  <a href="structdevstate__provs.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structstate__change.html">state_change</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structstate__changes.html">state_changes</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The <a class="el" href="structstate.html">state</a> change queue. State changes are queued for processing by a separate thread.  <a href="structstate__changes.html#_details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8c.html#aaf8d2ae1c0e1c6413c3a70c4526ace9f">MAX_SERVERS</a>&nbsp;&nbsp;&nbsp;64</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8c.html#ad30dfe7cd43ef4cd64feed84656a856c">_ast_device_state</a> (const char *device, int check_cache)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Check device <a class="el" href="structstate.html">state</a> through channel specific function or generic function.  <a href="#ad30dfe7cd43ef4cd64feed84656a856c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8c.html#a4691aa279b25aa0cb167a75bc4caa76c">ast_device_state</a> (const char *device)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Asks a channel for device <a class="el" href="structstate.html">state</a>.  <a href="#a4691aa279b25aa0cb167a75bc4caa76c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8c.html#a0d1e5bc5582dc40fc828a8d7f45c8796">ast_device_state_changed</a> (const char *fmt,...)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Tells Asterisk the State for Device is changed. (Accept change notification, add it to change queue.).  <a href="#a0d1e5bc5582dc40fc828a8d7f45c8796"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8c.html#a660c973250fcf7b5f7a389e6fc36257b">ast_device_state_changed_literal</a> (const char *dev)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Tells Asterisk the State for Device is changed.  <a href="#a660c973250fcf7b5f7a389e6fc36257b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8c.html#a1613dc2954f81c1131ad5acd24c1e574">ast_device_state_engine_init</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize the device <a class="el" href="structstate.html">state</a> engine in separate thread.  <a href="#a1613dc2954f81c1131ad5acd24c1e574"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8c.html#a3bdc3375abe6eb1da81c1eb1df5618b6">ast_devstate2str</a> (enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a> devstate)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Find devicestate as text <a class="el" href="structmessage.html">message</a> for output.  <a href="#a3bdc3375abe6eb1da81c1eb1df5618b6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8c.html#a45534707838d05125f409430b371854a">ast_devstate_aggregate_add</a> (struct <a class="el" href="structast__devstate__aggregate.html">ast_devstate_aggregate</a> *agg, enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a> <a class="el" href="structstate.html">state</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add a device <a class="el" href="structstate.html">state</a> to the aggregate device <a class="el" href="structstate.html">state</a>.  <a href="#a45534707838d05125f409430b371854a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8c.html#a65ebe8f28497b09769ab9edeb4eb9b86">ast_devstate_aggregate_init</a> (struct <a class="el" href="structast__devstate__aggregate.html">ast_devstate_aggregate</a> *agg)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize aggregate device <a class="el" href="structstate.html">state</a>.  <a href="#a65ebe8f28497b09769ab9edeb4eb9b86"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8c.html#a852d7e936d4385c3bb903812de5d6403">ast_devstate_aggregate_result</a> (struct <a class="el" href="structast__devstate__aggregate.html">ast_devstate_aggregate</a> *agg)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get the aggregate device <a class="el" href="structstate.html">state</a> result.  <a href="#a852d7e936d4385c3bb903812de5d6403"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8c.html#ac91fd8b93a2095c18ab86bd61c19ae46">ast_devstate_changed</a> (enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a> <a class="el" href="structstate.html">state</a>, const char *fmt,...)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Tells Asterisk the State for Device is changed.  <a href="#ac91fd8b93a2095c18ab86bd61c19ae46"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8c.html#a0cc33ebff1ed76c113d17785814b5a47">ast_devstate_changed_literal</a> (enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a> <a class="el" href="structstate.html">state</a>, const char *device)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Tells Asterisk the State for Device is changed.  <a href="#a0cc33ebff1ed76c113d17785814b5a47"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8c.html#ae832fcc32c88962e73025ffeafe2961e">ast_devstate_prov_add</a> (const char *label, <a class="el" href="devicestate_8h.html#a93c7236225b5fd76d197b8e5afba2de5">ast_devstate_prov_cb_type</a> callback)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add device <a class="el" href="structstate.html">state</a> provider.  <a href="#ae832fcc32c88962e73025ffeafe2961e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8c.html#a1ab579ae15aaca64a904c3c41d8b8b01">ast_devstate_prov_del</a> (const char *label)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Remove device <a class="el" href="structstate.html">state</a> provider.  <a href="#a1ab579ae15aaca64a904c3c41d8b8b01"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8c.html#a3573a25e7e8a395fe8332f1b1ca42097">ast_devstate_str</a> (enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a> <a class="el" href="structstate.html">state</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Convert device <a class="el" href="structstate.html">state</a> to text string that is easier to parse.  <a href="#a3573a25e7e8a395fe8332f1b1ca42097"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8c.html#ae148e0b95218b57b0348ab53f2f82657">ast_devstate_val</a> (const char *<a class="el" href="structval.html">val</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Convert device <a class="el" href="structstate.html">state</a> from text to integer value.  <a href="#ae148e0b95218b57b0348ab53f2f82657"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8c.html#aab3f3dcda2662dc291fc4c17b9a602f4">ast_enable_distributed_devstate</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Enable distributed device <a class="el" href="structstate.html">state</a> processing.  <a href="#aab3f3dcda2662dc291fc4c17b9a602f4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8c.html#a9da9a09e65a9332176a523407ccac611">ast_parse_device_state</a> (const char *device)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Find out if device is active in a call or not.  <a href="#a9da9a09e65a9332176a523407ccac611"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8c.html#a8e0c5acc035f43741343b8ed2fcb14ea">ast_state_chan2dev</a> (enum <a class="el" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660">ast_channel_state</a> chanstate)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Convert channel <a class="el" href="structstate.html">state</a> to devicestate.  <a href="#a8e0c5acc035f43741343b8ed2fcb14ea"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8c.html#ad157407a4e75e687610159a1676d00db">destroy_devstate_change</a> (struct <a class="el" href="structdevstate__change.html">devstate_change</a> *sc)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8c.html#aa870d9317f745dbb62b491dcc32ec8d8">devstate2str</a> (enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a> devstate)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Convert device <a class="el" href="structstate.html">state</a> to text string for output.  <a href="#aa870d9317f745dbb62b491dcc32ec8d8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8c.html#ab22d051f46950c0eb53bbafd489357ec">devstate_cache_cb</a> (const struct <a class="el" href="structast__event.html">ast_event</a> *event, void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8c.html#a4dc83bd04a1b6182961ab99f96e720cf">devstate_cached</a> (const char *device)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8c.html#a6328f4d8f6d6b35b38f2acb39258cd2f">devstate_change_collector_cb</a> (const struct <a class="el" href="structast__event.html">ast_event</a> *event, void *data)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8c.html#a87e192ec02bfdad7363a0afd21163d97">devstate_event</a> (const char *device, enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a> <a class="el" href="structstate.html">state</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8c.html#ad9f83f8d47fb83b4ccff95cb88f43d2b">do_devstate_changes</a> (void *data)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Go through the dev <a class="el" href="structstate.html">state</a> change queue and update changes in the dev <a class="el" href="structstate.html">state</a> thread.  <a href="#ad9f83f8d47fb83b4ccff95cb88f43d2b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8c.html#accc5f57962e9a0e3bbf8d7c2046525f7">do_state_change</a> (const char *device)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8c.html#a7fbd14a6df5d1578371e19c4bb3de563">getproviderstate</a> (const char *provider, const char *address)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get provider device <a class="el" href="structstate.html">state</a>.  <a href="#a7fbd14a6df5d1578371e19c4bb3de563"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8c.html#a1d87ddbf9d7aa9d6aaf93690de3faa5d">handle_devstate_change</a> (struct <a class="el" href="structdevstate__change.html">devstate_change</a> *sc)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8c.html#a80b936b6f745e6913eb31c063aa851c5">process_collection</a> (const char *device, struct <a class="el" href="structchange__collection.html">change_collection</a> *collection)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8c.html#aba2b4557d1f67626534da2a47d3ad39e">run_devstate_collector</a> (void *data)</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="lock_8h.html#ab134d98cdfe7de0f7a72b377c0765dc7">ast_cond_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8c.html#aa33e22b03fb6e00eb7f27a34f0e630f1">change_pending</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Flag for the queue.  <a href="#aa33e22b03fb6e00eb7f27a34f0e630f1"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static pthread_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8c.html#a767b566dd113e1ee0de1634e07c5618d">change_thread</a> = AST_PTHREADT_NULL</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The device <a class="el" href="structstate.html">state</a> change notification thread.  <a href="#a767b566dd113e1ee0de1634e07c5618d"></a><br/></td></tr>
<tr><td class="memItemLeft" >struct {</td></tr>
<tr><td class="memItemLeft" >&nbsp;&nbsp;&nbsp;<a class="el" href="lock_8h.html#ab134d98cdfe7de0f7a72b377c0765dc7">ast_cond_t</a>&nbsp;&nbsp;&nbsp;<a class="el" href="devicestate_8c.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a></td></tr>
<tr><td class="memItemLeft" >&nbsp;&nbsp;&nbsp;struct {</td></tr>
<tr><td class="memItemLeft" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct <a class="el" href="structdevstate__change.html">devstate_change</a> *&nbsp;&nbsp;&nbsp;<a class="el" href="devicestate_8c.html#abd2135e6f8a41bc900933b1985d97165">first</a></td></tr>
<tr><td class="memItemLeft" >&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;struct <a class="el" href="structdevstate__change.html">devstate_change</a> *&nbsp;&nbsp;&nbsp;<a class="el" href="devicestate_8c.html#a43a8def62ee15449794285cbbc0f79af">last</a></td></tr>
<tr><td class="memItemLeft" valign="top">&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;<a class="el" href="devicestate_8c.html#a9eed9fde4b4fa69c3974af65cee78004">devstate_change_q</a></td></tr>
<tr><td class="memItemLeft" >&nbsp;&nbsp;&nbsp;unsigned int&nbsp;&nbsp;&nbsp;<a class="el" href="devicestate_8c.html#a63be54a0beac1f5717217e1d9e629c71">enabled</a>:1</td></tr>
<tr><td class="memItemLeft" >&nbsp;&nbsp;&nbsp;struct <a class="el" href="structast__event__sub.html">ast_event_sub</a> *&nbsp;&nbsp;&nbsp;<a class="el" href="devicestate_8c.html#a513dfcfff59f0204dab3a9b22ed3c6c0">event_sub</a></td></tr>
<tr><td class="memItemLeft" >&nbsp;&nbsp;&nbsp;<a class="el" href="lock_8h.html#a2d9118a2a8939f115eea771bce3a52f2">ast_mutex_t</a>&nbsp;&nbsp;&nbsp;<a class="el" href="devicestate_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a></td></tr>
<tr><td class="memItemLeft" >&nbsp;&nbsp;&nbsp;pthread_t&nbsp;&nbsp;&nbsp;<a class="el" href="devicestate_8c.html#a01f75a9ad916f63a94e06a27635ba278">thread</a></td></tr>
<tr><td class="memItemLeft" valign="top">}&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8c.html#a21d826fdbe789058ca74e83f4f052c37">devstate_collector</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8c.html#ac35aab157772024788c572a575a19703">devstatestring</a> [][2]</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Device <a class="el" href="structstate.html">state</a> strings for printing.  <a href="#ac35aab157772024788c572a575a19703"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Device <a class="el" href="structstate.html">state</a> management. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Mark Spencer &lt;<a href="mailto:markster@digium.com">markster@digium.com</a>&gt; </dd>
<dd>
Russell Bryant &lt;<a href="mailto:russell@digium.com">russell@digium.com</a>&gt;</dd></dl>
<ul>
<li><a class="el" href="AstExtState.html">Extension and device states in Asterisk</a> </li>
</ul>

<p>Definition in file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="aaf8d2ae1c0e1c6413c3a70c4526ace9f"></a><!-- doxytag: member="devicestate.c::MAX_SERVERS" ref="aaf8d2ae1c0e1c6413c3a70c4526ace9f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_SERVERS&nbsp;&nbsp;&nbsp;64</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00562">562</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>Referenced by <a class="el" href="devicestate_8c_source.html#l00568">devstate_cache_cb()</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ad30dfe7cd43ef4cd64feed84656a856c"></a><!-- doxytag: member="devicestate.c::_ast_device_state" ref="ad30dfe7cd43ef4cd64feed84656a856c" args="(const char *device, int check_cache)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a> _ast_device_state </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>device</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>check_cache</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Check device <a class="el" href="structstate.html">state</a> through channel specific function or generic function. </p>

<p><p>Channel driver that provides device <a class="el" href="structstate.html">state</a></p>
<p>Another provider of device <a class="el" href="structstate.html">state</a> </p>
</p>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00308">308</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="devicestate_8h_source.html#l00056">AST_DEVICE_INVALID</a>, <a class="el" href="devicestate_8h_source.html#l00052">AST_DEVICE_UNKNOWN</a>, <a class="el" href="channel_8c_source.html#l00609">ast_get_channel_tech()</a>, <a class="el" href="devicestate_8c_source.html#l00265">ast_parse_device_state()</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="adsistub_8c_source.html#l00059">buf</a>, <a class="el" href="structast__channel__tech.html#a3686404e825be25c25c6cff50970e1de">ast_channel_tech::devicestate</a>, <a class="el" href="devicestate_8c_source.html#l00288">devstate_cached()</a>, <a class="el" href="devicestate_8c_source.html#l00408">getproviderstate()</a>, and <a class="el" href="agi_2strcompat_8c_source.html#l00027">strsep()</a>.</p>

<p>Referenced by <a class="el" href="devicestate_8c_source.html#l00360">ast_device_state()</a>, and <a class="el" href="devicestate_8c_source.html#l00454">do_state_change()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00309"></a>00309 {
<a name="l00310"></a>00310    <span class="keywordtype">char</span> *<a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>;
<a name="l00311"></a>00311    <span class="keywordtype">char</span> *<a class="code" href="structnumber.html" title="Number structure.">number</a>;
<a name="l00312"></a>00312    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structast__channel__tech.html" title="Structure to describe a channel &amp;quot;technology&amp;quot;, ie a channel driver See for...">ast_channel_tech</a> *chan_tech;
<a name="l00313"></a>00313    <span class="keyword">enum</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee" title="Device States.">ast_device_state</a> res;<span class="comment"></span>
<a name="l00314"></a>00314 <span class="comment">   /*! \brief Channel driver that provides device state */</span>
<a name="l00315"></a>00315    <span class="keywordtype">char</span> *tech;<span class="comment"></span>
<a name="l00316"></a>00316 <span class="comment">   /*! \brief Another provider of device state */</span>
<a name="l00317"></a>00317    <span class="keywordtype">char</span> *provider = NULL;
<a name="l00318"></a>00318 
<a name="l00319"></a>00319    <span class="comment">/* If the last known state is cached, just return that */</span>
<a name="l00320"></a>00320    <span class="keywordflow">if</span> (check_cache) {
<a name="l00321"></a>00321       res = <a class="code" href="devicestate_8c.html#a4dc83bd04a1b6182961ab99f96e720cf">devstate_cached</a>(device);
<a name="l00322"></a>00322       <span class="keywordflow">if</span> (res != <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea41983b6678528bfcdf919b24d6e08d9a">AST_DEVICE_UNKNOWN</a>) {
<a name="l00323"></a>00323          <span class="keywordflow">return</span> res;
<a name="l00324"></a>00324       }
<a name="l00325"></a>00325    }
<a name="l00326"></a>00326 
<a name="l00327"></a>00327    buf = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(device);
<a name="l00328"></a>00328    tech = <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;buf, <span class="stringliteral">&quot;/&quot;</span>);
<a name="l00329"></a>00329    <span class="keywordflow">if</span> (!(number = buf)) {
<a name="l00330"></a>00330       <span class="keywordflow">if</span> (!(provider = <a class="code" href="agi_2strcompat_8c.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;tech, <span class="stringliteral">&quot;:&quot;</span>)))
<a name="l00331"></a>00331          <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea9c008e1d20858cbc3275c157e02ebc94">AST_DEVICE_INVALID</a>;
<a name="l00332"></a>00332       <span class="comment">/* We have a provider */</span>
<a name="l00333"></a>00333       number = tech;
<a name="l00334"></a>00334       tech = NULL;
<a name="l00335"></a>00335    }
<a name="l00336"></a>00336 
<a name="l00337"></a>00337    <span class="keywordflow">if</span> (provider)  {
<a name="l00338"></a>00338       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(3, <span class="stringliteral">&quot;Checking if I can find provider for \&quot;%s\&quot; - number: %s\n&quot;</span>, provider, number);
<a name="l00339"></a>00339       <span class="keywordflow">return</span> <a class="code" href="devicestate_8c.html#a7fbd14a6df5d1578371e19c4bb3de563" title="Get provider device state.">getproviderstate</a>(provider, number);
<a name="l00340"></a>00340    }
<a name="l00341"></a>00341 
<a name="l00342"></a>00342    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(4, <span class="stringliteral">&quot;No provider found, checking channel drivers for %s - %s\n&quot;</span>, tech, number);
<a name="l00343"></a>00343 
<a name="l00344"></a>00344    <span class="keywordflow">if</span> (!(chan_tech = <a class="code" href="channel_8h.html#a646e90d1a57effdd627779b93f21f4cf" title="Get a channel technology structure by name.">ast_get_channel_tech</a>(tech)))
<a name="l00345"></a>00345       <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea9c008e1d20858cbc3275c157e02ebc94">AST_DEVICE_INVALID</a>;
<a name="l00346"></a>00346 
<a name="l00347"></a>00347    <span class="keywordflow">if</span> (!(chan_tech-&gt;<a class="code" href="structast__channel__tech.html#a3686404e825be25c25c6cff50970e1de">devicestate</a>)) <span class="comment">/* Does the channel driver support device state notification? */</span>
<a name="l00348"></a>00348       <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#a9da9a09e65a9332176a523407ccac611" title="Search the Channels by Name.">ast_parse_device_state</a>(device); <span class="comment">/* No, try the generic function */</span>
<a name="l00349"></a>00349 
<a name="l00350"></a>00350    res = chan_tech-&gt;<a class="code" href="structast__channel__tech.html#a3686404e825be25c25c6cff50970e1de">devicestate</a>(number);
<a name="l00351"></a>00351 
<a name="l00352"></a>00352    <span class="keywordflow">if</span> (res != <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea41983b6678528bfcdf919b24d6e08d9a">AST_DEVICE_UNKNOWN</a>)
<a name="l00353"></a>00353       <span class="keywordflow">return</span> res;
<a name="l00354"></a>00354 
<a name="l00355"></a>00355    res = <a class="code" href="devicestate_8h.html#a9da9a09e65a9332176a523407ccac611" title="Search the Channels by Name.">ast_parse_device_state</a>(device);
<a name="l00356"></a>00356 
<a name="l00357"></a>00357    <span class="keywordflow">return</span> res;
<a name="l00358"></a>00358 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4691aa279b25aa0cb167a75bc4caa76c"></a><!-- doxytag: member="devicestate.c::ast_device_state" ref="a4691aa279b25aa0cb167a75bc4caa76c" args="(const char *device)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a> <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>device</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Asks a channel for device <a class="el" href="structstate.html">state</a>. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>device</em>&nbsp;</td><td>like a dial string</td></tr>
  </table>
  </dd>
</dl>
<p>Asks a channel for device <a class="el" href="structstate.html">state</a>, data is normally a <a class="el" href="structnumber.html" title="Number structure.">number</a> from a dial string used by the low level module Tries the channel device <a class="el" href="structstate.html">state</a> callback if not supported search in the active <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> list for the device.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>an</em>&nbsp;</td><td>AST_DEVICE_??? <a class="el" href="structstate.html">state</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00360">360</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="devicestate_8c_source.html#l00308">_ast_device_state()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00361"></a>00361 {
<a name="l00362"></a>00362    <span class="comment">/* This function is called from elsewhere in the code to find out the</span>
<a name="l00363"></a>00363 <span class="comment">    * current state of a device.  Check the cache, first. */</span>
<a name="l00364"></a>00364 
<a name="l00365"></a>00365    <span class="keywordflow">return</span> <a class="code" href="devicestate_8c.html#ad30dfe7cd43ef4cd64feed84656a856c" title="Check device state through channel specific function or generic function.">_ast_device_state</a>(device, 1);
<a name="l00366"></a>00366 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0d1e5bc5582dc40fc828a8d7f45c8796"></a><!-- doxytag: member="devicestate.c::ast_device_state_changed" ref="a0d1e5bc5582dc40fc828a8d7f45c8796" args="(const char *fmt,...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_device_state_changed </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>...</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Tells Asterisk the State for Device is changed. (Accept change notification, add it to change queue.). </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fmt</em>&nbsp;</td><td>device name like a dial string with format parameters</td></tr>
  </table>
  </dd>
</dl>
<p>Asterisk polls the new <a class="el" href="structextension.html">extension</a> states and calls the registered callbacks for the changed extensions</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure</td></tr>
  </table>
  </dd>
</dl>
<dl class="note"><dt><b>Note:</b></dt><dd>This is deprecated in favor of <a class="el" href="devicestate_8h.html#ac91fd8b93a2095c18ab86bd61c19ae46" title="Tells Asterisk the State for Device is changed.">ast_devstate_changed()</a> </dd></dl>
<dl class="version"><dt><b>Version:</b></dt><dd>1.6.1 deprecated </dd></dl>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00520">520</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="devicestate_8h_source.html#l00052">AST_DEVICE_UNKNOWN</a>, <a class="el" href="devicestate_8c_source.html#l00465">ast_devstate_changed_literal()</a>, <a class="el" href="channel_8h_source.html#l00134">AST_MAX_EXTENSION</a>, and <a class="el" href="adsistub_8c_source.html#l00059">buf</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00521"></a>00521 {
<a name="l00522"></a>00522    <span class="keywordtype">char</span> <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[<a class="code" href="channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a>];
<a name="l00523"></a>00523    va_list ap;
<a name="l00524"></a>00524 
<a name="l00525"></a>00525    va_start(ap, fmt);
<a name="l00526"></a>00526    vsnprintf(buf, <span class="keyword">sizeof</span>(buf), fmt, ap);
<a name="l00527"></a>00527    va_end(ap);
<a name="l00528"></a>00528 
<a name="l00529"></a>00529    <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#a0cc33ebff1ed76c113d17785814b5a47" title="Tells Asterisk the State for Device is changed.">ast_devstate_changed_literal</a>(<a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea41983b6678528bfcdf919b24d6e08d9a">AST_DEVICE_UNKNOWN</a>, buf);
<a name="l00530"></a>00530 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a660c973250fcf7b5f7a389e6fc36257b"></a><!-- doxytag: member="devicestate.c::ast_device_state_changed_literal" ref="a660c973250fcf7b5f7a389e6fc36257b" args="(const char *dev)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_device_state_changed_literal </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>device</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Tells Asterisk the State for Device is changed. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>device</em>&nbsp;</td><td>device name like a dial string</td></tr>
  </table>
  </dd>
</dl>
<p>Asterisk polls the new <a class="el" href="structextension.html">extension</a> states and calls the registered callbacks for the changed extensions</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure</td></tr>
  </table>
  </dd>
</dl>
<dl class="note"><dt><b>Note:</b></dt><dd>This is deprecated in favor of <a class="el" href="devicestate_8h.html#a0cc33ebff1ed76c113d17785814b5a47" title="Tells Asterisk the State for Device is changed.">ast_devstate_changed_literal()</a> </dd></dl>
<dl class="version"><dt><b>Version:</b></dt><dd>1.6.1 deprecated </dd></dl>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00503">503</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="devicestate_8h_source.html#l00052">AST_DEVICE_UNKNOWN</a>, and <a class="el" href="devicestate_8c_source.html#l00465">ast_devstate_changed_literal()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00504"></a>00504 {
<a name="l00505"></a>00505    <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#a0cc33ebff1ed76c113d17785814b5a47" title="Tells Asterisk the State for Device is changed.">ast_devstate_changed_literal</a>(<a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea41983b6678528bfcdf919b24d6e08d9a">AST_DEVICE_UNKNOWN</a>, dev);
<a name="l00506"></a>00506 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1613dc2954f81c1131ad5acd24c1e574"></a><!-- doxytag: member="devicestate.c::ast_device_state_engine_init" ref="a1613dc2954f81c1131ad5acd24c1e574" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_device_state_engine_init </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize the device <a class="el" href="structstate.html">state</a> engine in separate thread. </p>
<p>Provided by <a class="el" href="devicestate_8c.html" title="Device state management.">devicestate.c</a> </p>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00722">722</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l01729">ast_cond_init()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="utils_8h_source.html#l00384">ast_pthread_create_background</a>, <a class="el" href="devicestate_8c_source.html#l00181">change_thread</a>, <a class="el" href="devicestate_8c_source.html#l00533">do_devstate_changes()</a>, and <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>.</p>

<p>Referenced by <a class="el" href="asterisk_8c_source.html#l03095">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00723"></a>00723 {
<a name="l00724"></a>00724    <a class="code" href="lock_8h.html#a21f75f462115427718d78aa66cc61f9b">ast_cond_init</a>(&amp;<a class="code" href="devicestate_8c.html#aa33e22b03fb6e00eb7f27a34f0e630f1" title="Flag for the queue.">change_pending</a>, NULL);
<a name="l00725"></a>00725    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a595e2f8aa398f4bd21e381c3211235fe">ast_pthread_create_background</a>(&amp;<a class="code" href="devicestate_8c.html#a767b566dd113e1ee0de1634e07c5618d" title="The device state change notification thread.">change_thread</a>, NULL, <a class="code" href="devicestate_8c.html#ad9f83f8d47fb83b4ccff95cb88f43d2b" title="Go through the dev state change queue and update changes in the dev state thread...">do_devstate_changes</a>, NULL) &lt; 0) {
<a name="l00726"></a>00726       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to start device state change thread.\n&quot;</span>);
<a name="l00727"></a>00727       <span class="keywordflow">return</span> -1;
<a name="l00728"></a>00728    }
<a name="l00729"></a>00729 
<a name="l00730"></a>00730    <span class="keywordflow">return</span> 0;
<a name="l00731"></a>00731 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3bdc3375abe6eb1da81c1eb1df5618b6"></a><!-- doxytag: member="devicestate.c::ast_devstate2str" ref="a3bdc3375abe6eb1da81c1eb1df5618b6" args="(enum ast_device_state devstate)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* ast_devstate2str </td>
          <td>(</td>
          <td class="paramtype">enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a>&nbsp;</td>
          <td class="paramname"> <em>devstate</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Find devicestate as text <a class="el" href="structmessage.html">message</a> for output. </p>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00209">209</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>Referenced by <a class="el" href="app__queue_8c_source.html#l06083">__queues_show()</a>, <a class="el" href="devicestate_8c_source.html#l00454">do_state_change()</a>, <a class="el" href="app__queue_8c_source.html#l01046">handle_statechange()</a>, <a class="el" href="features_8c_source.html#l00510">notify_metermaids()</a>, <a class="el" href="app__page_8c_source.html#l00121">page_exec()</a>, and <a class="el" href="devicestate_8c_source.html#l00593">process_collection()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00210"></a>00210 {
<a name="l00211"></a>00211    <span class="keywordflow">return</span> <a class="code" href="devicestate_8c.html#ac35aab157772024788c572a575a19703" title="Device state strings for printing.">devstatestring</a>[devstate][0];
<a name="l00212"></a>00212 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a45534707838d05125f409430b371854a"></a><!-- doxytag: member="devicestate.c::ast_devstate_aggregate_add" ref="a45534707838d05125f409430b371854a" args="(struct ast_devstate_aggregate *agg, enum ast_device_state state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_devstate_aggregate_add </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__devstate__aggregate.html">ast_devstate_aggregate</a> *&nbsp;</td>
          <td class="paramname"> <em>agg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a>&nbsp;</td>
          <td class="paramname"> <em>state</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add a device <a class="el" href="structstate.html">state</a> to the aggregate device <a class="el" href="structstate.html">state</a>. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>agg</em>&nbsp;</td><td>the <a class="el" href="structstate.html">state</a> object </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em><a class="el" href="structstate.html">state</a></em>&nbsp;</td><td>the <a class="el" href="structstate.html">state</a> to add</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>nothing </dd></dl>
<dl class="since"><dt><b>Since:</b></dt><dd>1.6.1 </dd></dl>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00743">743</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="devicestate_8h_source.html#l00259">ast_devstate_aggregate::all_busy</a>, <a class="el" href="devicestate_8h_source.html#l00260">ast_devstate_aggregate::all_free</a>, <a class="el" href="devicestate_8h_source.html#l00258">ast_devstate_aggregate::all_unavail</a>, <a class="el" href="devicestate_8h_source.html#l00257">ast_devstate_aggregate::all_unknown</a>, <a class="el" href="devicestate_8h_source.html#l00055">AST_DEVICE_BUSY</a>, <a class="el" href="devicestate_8h_source.html#l00054">AST_DEVICE_INUSE</a>, <a class="el" href="devicestate_8h_source.html#l00056">AST_DEVICE_INVALID</a>, <a class="el" href="devicestate_8h_source.html#l00053">AST_DEVICE_NOT_INUSE</a>, <a class="el" href="devicestate_8h_source.html#l00060">AST_DEVICE_ONHOLD</a>, <a class="el" href="devicestate_8h_source.html#l00058">AST_DEVICE_RINGING</a>, <a class="el" href="devicestate_8h_source.html#l00059">AST_DEVICE_RINGINUSE</a>, <a class="el" href="devicestate_8h_source.html#l00061">AST_DEVICE_TOTAL</a>, <a class="el" href="devicestate_8h_source.html#l00057">AST_DEVICE_UNAVAILABLE</a>, <a class="el" href="devicestate_8h_source.html#l00052">AST_DEVICE_UNKNOWN</a>, <a class="el" href="devicestate_8h_source.html#l00262">ast_devstate_aggregate::busy</a>, <a class="el" href="devicestate_8h_source.html#l00263">ast_devstate_aggregate::in_use</a>, <a class="el" href="devicestate_8h_source.html#l00261">ast_devstate_aggregate::on_hold</a>, and <a class="el" href="devicestate_8h_source.html#l00264">ast_devstate_aggregate::ring</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l03797">ast_extension_state2()</a>, and <a class="el" href="devicestate_8c_source.html#l00593">process_collection()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00744"></a>00744 {
<a name="l00745"></a>00745    <span class="keywordflow">switch</span> (<a class="code" href="structstate.html">state</a>) {
<a name="l00746"></a>00746    <span class="keywordflow">case</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeadee91fc4886ffc7b4efb8459cef48fe2">AST_DEVICE_NOT_INUSE</a>:
<a name="l00747"></a>00747       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a89222ce0f74e56a855e1be89537fdb02">all_unknown</a> = 0;
<a name="l00748"></a>00748       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#aec50b9db1640cefa9c219d63e1b7ade4">all_unavail</a> = 0;
<a name="l00749"></a>00749       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#af7df3d089a03d0acb4e8e18c28d58700">all_busy</a> = 0;
<a name="l00750"></a>00750       <span class="keywordflow">break</span>;
<a name="l00751"></a>00751    <span class="keywordflow">case</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea23aa227468c09b5ebd0fb01b4c895190">AST_DEVICE_INUSE</a>:
<a name="l00752"></a>00752       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#ae90f2e4a448082950b7e1e7a7a508464">in_use</a> = 1;
<a name="l00753"></a>00753       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#aec50b9db1640cefa9c219d63e1b7ade4">all_unavail</a> = 0;
<a name="l00754"></a>00754       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a7dcbb2425e6da769d44603778432db0f">all_free</a> = 0;
<a name="l00755"></a>00755       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a89222ce0f74e56a855e1be89537fdb02">all_unknown</a> = 0;
<a name="l00756"></a>00756       <span class="keywordflow">break</span>;
<a name="l00757"></a>00757    <span class="keywordflow">case</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea76d91d5d654cfa3edafb2afbe3e09b46">AST_DEVICE_RINGING</a>:
<a name="l00758"></a>00758       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a055700e8ae7f31029bebd7a4353cf04b">ring</a> = 1;
<a name="l00759"></a>00759       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#aec50b9db1640cefa9c219d63e1b7ade4">all_unavail</a> = 0;
<a name="l00760"></a>00760       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a7dcbb2425e6da769d44603778432db0f">all_free</a> = 0;
<a name="l00761"></a>00761       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a89222ce0f74e56a855e1be89537fdb02">all_unknown</a> = 0;
<a name="l00762"></a>00762       <span class="keywordflow">break</span>;
<a name="l00763"></a>00763    <span class="keywordflow">case</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea17b87dfa3f4de5909b401017e229091d">AST_DEVICE_RINGINUSE</a>:
<a name="l00764"></a>00764       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#ae90f2e4a448082950b7e1e7a7a508464">in_use</a> = 1;
<a name="l00765"></a>00765       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a055700e8ae7f31029bebd7a4353cf04b">ring</a> = 1;
<a name="l00766"></a>00766       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#aec50b9db1640cefa9c219d63e1b7ade4">all_unavail</a> = 0;
<a name="l00767"></a>00767       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a7dcbb2425e6da769d44603778432db0f">all_free</a> = 0;
<a name="l00768"></a>00768       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a89222ce0f74e56a855e1be89537fdb02">all_unknown</a> = 0;
<a name="l00769"></a>00769       <span class="keywordflow">break</span>;
<a name="l00770"></a>00770    <span class="keywordflow">case</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea6b7416bea92d3bc5ee8e36f0a484cdc1">AST_DEVICE_ONHOLD</a>:
<a name="l00771"></a>00771       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a89222ce0f74e56a855e1be89537fdb02">all_unknown</a> = 0;
<a name="l00772"></a>00772       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#aec50b9db1640cefa9c219d63e1b7ade4">all_unavail</a> = 0;
<a name="l00773"></a>00773       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a7dcbb2425e6da769d44603778432db0f">all_free</a> = 0;
<a name="l00774"></a>00774       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#adbb5ea13ff67a0f65a71edddb0eef433">on_hold</a> = 1;
<a name="l00775"></a>00775       <span class="keywordflow">break</span>;
<a name="l00776"></a>00776    <span class="keywordflow">case</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeab43afabf5bcd4ad1f531ad78c48ccb6f">AST_DEVICE_BUSY</a>:
<a name="l00777"></a>00777       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a89222ce0f74e56a855e1be89537fdb02">all_unknown</a> = 0;
<a name="l00778"></a>00778       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#aec50b9db1640cefa9c219d63e1b7ade4">all_unavail</a> = 0;
<a name="l00779"></a>00779       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a7dcbb2425e6da769d44603778432db0f">all_free</a> = 0;
<a name="l00780"></a>00780       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a062fb7f88f25f3a783a4f30f7174d1dc">busy</a> = 1;
<a name="l00781"></a>00781       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#ae90f2e4a448082950b7e1e7a7a508464">in_use</a> = 1;
<a name="l00782"></a>00782       <span class="keywordflow">break</span>;
<a name="l00783"></a>00783    <span class="keywordflow">case</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeafac147cbabf3ccb80e50e86027710549">AST_DEVICE_UNAVAILABLE</a>:
<a name="l00784"></a>00784       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a89222ce0f74e56a855e1be89537fdb02">all_unknown</a> = 0;
<a name="l00785"></a>00785    <span class="keywordflow">case</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea9c008e1d20858cbc3275c157e02ebc94">AST_DEVICE_INVALID</a>:
<a name="l00786"></a>00786       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#af7df3d089a03d0acb4e8e18c28d58700">all_busy</a> = 0;
<a name="l00787"></a>00787       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a7dcbb2425e6da769d44603778432db0f">all_free</a> = 0;
<a name="l00788"></a>00788       <span class="keywordflow">break</span>;
<a name="l00789"></a>00789    <span class="keywordflow">case</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea41983b6678528bfcdf919b24d6e08d9a">AST_DEVICE_UNKNOWN</a>:
<a name="l00790"></a>00790       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#af7df3d089a03d0acb4e8e18c28d58700">all_busy</a> = 0;
<a name="l00791"></a>00791       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a7dcbb2425e6da769d44603778432db0f">all_free</a> = 0;
<a name="l00792"></a>00792       <span class="keywordflow">break</span>;
<a name="l00793"></a>00793    <span class="keywordflow">case</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeaf790c1f212837af8d2db5193228102d7">AST_DEVICE_TOTAL</a>: <span class="comment">/* not a device state, included for completeness. */</span>
<a name="l00794"></a>00794       <span class="keywordflow">break</span>;
<a name="l00795"></a>00795    }
<a name="l00796"></a>00796 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a65ebe8f28497b09769ab9edeb4eb9b86"></a><!-- doxytag: member="devicestate.c::ast_devstate_aggregate_init" ref="a65ebe8f28497b09769ab9edeb4eb9b86" args="(struct ast_devstate_aggregate *agg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_devstate_aggregate_init </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__devstate__aggregate.html">ast_devstate_aggregate</a> *&nbsp;</td>
          <td class="paramname"> <em>agg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize aggregate device <a class="el" href="structstate.html">state</a>. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>agg</em>&nbsp;</td><td>the <a class="el" href="structstate.html">state</a> object</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>nothing </dd></dl>
<dl class="since"><dt><b>Since:</b></dt><dd>1.6.1 </dd></dl>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00733">733</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="devicestate_8h_source.html#l00259">ast_devstate_aggregate::all_busy</a>, <a class="el" href="devicestate_8h_source.html#l00260">ast_devstate_aggregate::all_free</a>, <a class="el" href="devicestate_8h_source.html#l00258">ast_devstate_aggregate::all_unavail</a>, and <a class="el" href="devicestate_8h_source.html#l00257">ast_devstate_aggregate::all_unknown</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l03797">ast_extension_state2()</a>, and <a class="el" href="devicestate_8c_source.html#l00593">process_collection()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00734"></a>00734 {
<a name="l00735"></a>00735    memset(agg, 0, <span class="keyword">sizeof</span>(*agg));
<a name="l00736"></a>00736 
<a name="l00737"></a>00737    agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a89222ce0f74e56a855e1be89537fdb02">all_unknown</a> = 1;
<a name="l00738"></a>00738    agg-&gt;<a class="code" href="structast__devstate__aggregate.html#aec50b9db1640cefa9c219d63e1b7ade4">all_unavail</a> = 1;
<a name="l00739"></a>00739    agg-&gt;<a class="code" href="structast__devstate__aggregate.html#af7df3d089a03d0acb4e8e18c28d58700">all_busy</a> = 1;
<a name="l00740"></a>00740    agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a7dcbb2425e6da769d44603778432db0f">all_free</a> = 1;
<a name="l00741"></a>00741 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a852d7e936d4385c3bb903812de5d6403"></a><!-- doxytag: member="devicestate.c::ast_devstate_aggregate_result" ref="a852d7e936d4385c3bb903812de5d6403" args="(struct ast_devstate_aggregate *agg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a> ast_devstate_aggregate_result </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__devstate__aggregate.html">ast_devstate_aggregate</a> *&nbsp;</td>
          <td class="paramname"> <em>agg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get the aggregate device <a class="el" href="structstate.html">state</a> result. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>agg</em>&nbsp;</td><td>the <a class="el" href="structstate.html">state</a> object</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>the aggregate device <a class="el" href="structstate.html">state</a> after adding some <a class="el" href="structnumber.html" title="Number structure.">number</a> of device states. </dd></dl>
<dl class="since"><dt><b>Since:</b></dt><dd>1.6.1 </dd></dl>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00799">799</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="devicestate_8h_source.html#l00259">ast_devstate_aggregate::all_busy</a>, <a class="el" href="devicestate_8h_source.html#l00260">ast_devstate_aggregate::all_free</a>, <a class="el" href="devicestate_8h_source.html#l00258">ast_devstate_aggregate::all_unavail</a>, <a class="el" href="devicestate_8h_source.html#l00257">ast_devstate_aggregate::all_unknown</a>, <a class="el" href="devicestate_8h_source.html#l00055">AST_DEVICE_BUSY</a>, <a class="el" href="devicestate_8h_source.html#l00054">AST_DEVICE_INUSE</a>, <a class="el" href="devicestate_8h_source.html#l00053">AST_DEVICE_NOT_INUSE</a>, <a class="el" href="devicestate_8h_source.html#l00060">AST_DEVICE_ONHOLD</a>, <a class="el" href="devicestate_8h_source.html#l00058">AST_DEVICE_RINGING</a>, <a class="el" href="devicestate_8h_source.html#l00059">AST_DEVICE_RINGINUSE</a>, <a class="el" href="devicestate_8h_source.html#l00057">AST_DEVICE_UNAVAILABLE</a>, <a class="el" href="devicestate_8h_source.html#l00052">AST_DEVICE_UNKNOWN</a>, <a class="el" href="devicestate_8h_source.html#l00262">ast_devstate_aggregate::busy</a>, <a class="el" href="devicestate_8h_source.html#l00263">ast_devstate_aggregate::in_use</a>, <a class="el" href="devicestate_8h_source.html#l00261">ast_devstate_aggregate::on_hold</a>, and <a class="el" href="devicestate_8h_source.html#l00264">ast_devstate_aggregate::ring</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l03797">ast_extension_state2()</a>, and <a class="el" href="devicestate_8c_source.html#l00593">process_collection()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00800"></a>00800 {
<a name="l00801"></a>00801    <span class="keywordflow">if</span> (agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a7dcbb2425e6da769d44603778432db0f">all_free</a>)
<a name="l00802"></a>00802       <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeadee91fc4886ffc7b4efb8459cef48fe2">AST_DEVICE_NOT_INUSE</a>;
<a name="l00803"></a>00803    <span class="keywordflow">if</span> ((agg-&gt;<a class="code" href="structast__devstate__aggregate.html#ae90f2e4a448082950b7e1e7a7a508464">in_use</a> || agg-&gt;<a class="code" href="structast__devstate__aggregate.html#adbb5ea13ff67a0f65a71edddb0eef433">on_hold</a>) &amp;&amp; agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a055700e8ae7f31029bebd7a4353cf04b">ring</a>)
<a name="l00804"></a>00804       <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea17b87dfa3f4de5909b401017e229091d">AST_DEVICE_RINGINUSE</a>;
<a name="l00805"></a>00805    <span class="keywordflow">if</span> (agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a055700e8ae7f31029bebd7a4353cf04b">ring</a>)
<a name="l00806"></a>00806       <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea76d91d5d654cfa3edafb2afbe3e09b46">AST_DEVICE_RINGING</a>;
<a name="l00807"></a>00807    <span class="keywordflow">if</span> (agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a062fb7f88f25f3a783a4f30f7174d1dc">busy</a>)
<a name="l00808"></a>00808       <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeab43afabf5bcd4ad1f531ad78c48ccb6f">AST_DEVICE_BUSY</a>;
<a name="l00809"></a>00809    <span class="keywordflow">if</span> (agg-&gt;<a class="code" href="structast__devstate__aggregate.html#ae90f2e4a448082950b7e1e7a7a508464">in_use</a>)
<a name="l00810"></a>00810       <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea23aa227468c09b5ebd0fb01b4c895190">AST_DEVICE_INUSE</a>;
<a name="l00811"></a>00811    <span class="keywordflow">if</span> (agg-&gt;<a class="code" href="structast__devstate__aggregate.html#adbb5ea13ff67a0f65a71edddb0eef433">on_hold</a>)
<a name="l00812"></a>00812       <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea6b7416bea92d3bc5ee8e36f0a484cdc1">AST_DEVICE_ONHOLD</a>;
<a name="l00813"></a>00813    <span class="keywordflow">if</span> (agg-&gt;<a class="code" href="structast__devstate__aggregate.html#af7df3d089a03d0acb4e8e18c28d58700">all_busy</a>)
<a name="l00814"></a>00814       <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeab43afabf5bcd4ad1f531ad78c48ccb6f">AST_DEVICE_BUSY</a>;
<a name="l00815"></a>00815    <span class="keywordflow">if</span> (agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a89222ce0f74e56a855e1be89537fdb02">all_unknown</a>)
<a name="l00816"></a>00816       <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea41983b6678528bfcdf919b24d6e08d9a">AST_DEVICE_UNKNOWN</a>;
<a name="l00817"></a>00817    <span class="keywordflow">if</span> (agg-&gt;<a class="code" href="structast__devstate__aggregate.html#aec50b9db1640cefa9c219d63e1b7ade4">all_unavail</a>)
<a name="l00818"></a>00818       <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeafac147cbabf3ccb80e50e86027710549">AST_DEVICE_UNAVAILABLE</a>;
<a name="l00819"></a>00819 
<a name="l00820"></a>00820    <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeadee91fc4886ffc7b4efb8459cef48fe2">AST_DEVICE_NOT_INUSE</a>;
<a name="l00821"></a>00821 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac91fd8b93a2095c18ab86bd61c19ae46"></a><!-- doxytag: member="devicestate.c::ast_devstate_changed" ref="ac91fd8b93a2095c18ab86bd61c19ae46" args="(enum ast_device_state state, const char *fmt,...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_devstate_changed </td>
          <td>(</td>
          <td class="paramtype">enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a>&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>...</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Tells Asterisk the State for Device is changed. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structstate.html">state</a></em>&nbsp;</td><td>the new <a class="el" href="structstate.html">state</a> of the device </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fmt</em>&nbsp;</td><td>device name like a dial string with format parameters</td></tr>
  </table>
  </dd>
</dl>
<p>The new <a class="el" href="structstate.html">state</a> of the device will be sent off to any subscribers of device states. It will also be stored in the internal event cache.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00508">508</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="devicestate_8c_source.html#l00465">ast_devstate_changed_literal()</a>, <a class="el" href="channel_8h_source.html#l00134">AST_MAX_EXTENSION</a>, and <a class="el" href="adsistub_8c_source.html#l00059">buf</a>.</p>

<p>Referenced by <a class="el" href="chan__iax2_8c_source.html#l08254">__expire_registry()</a>, <a class="el" href="chan__iax2_8c_source.html#l11441">__iax2_poke_noanswer()</a>, <a class="el" href="chan__agent_8c_source.html#l00770">agent_call()</a>, <a class="el" href="chan__agent_8c_source.html#l00893">agent_hangup()</a>, <a class="el" href="chan__agent_8c_source.html#l01645">agent_logoff_maintenance()</a>, <a class="el" href="chan__agent_8c_source.html#l00519">agent_read()</a>, <a class="el" href="app__meetme_8c_source.html#l01998">conf_run()</a>, <a class="el" href="func__devstate_8c_source.html#l00107">devstate_write()</a>, <a class="el" href="chan__sip_8c_source.html#l12018">expire_register()</a>, <a class="el" href="func__devstate_8c_source.html#l00235">handle_cli_devstate_change()</a>, <a class="el" href="chan__skinny_8c_source.html#l05045">handle_offhook_message()</a>, <a class="el" href="chan__skinny_8c_source.html#l05135">handle_onhook_message()</a>, <a class="el" href="chan__sip_8c_source.html#l18198">handle_response_peerpoke()</a>, <a class="el" href="chan__skinny_8c_source.html#l05662">handle_soft_key_event_message()</a>, <a class="el" href="chan__skinny_8c_source.html#l04699">handle_stimulus_message()</a>, <a class="el" href="func__devstate_8c_source.html#l00326">load_module()</a>, <a class="el" href="chan__agent_8c_source.html#l01981">login_exec()</a>, <a class="el" href="features_8c_source.html#l00510">notify_metermaids()</a>, <a class="el" href="chan__iax2_8c_source.html#l08297">reg_source_db()</a>, <a class="el" href="chan__iax2_8c_source.html#l07596">register_verify()</a>, <a class="el" href="chan__agent_8c_source.html#l02387">reload_agents()</a>, <a class="el" href="chan__sip_8c_source.html#l12751">sip_peer_hold()</a>, <a class="el" href="chan__sip_8c_source.html#l22832">sip_poke_noanswer()</a>, <a class="el" href="chan__skinny_8c_source.html#l01813">skinny_register()</a>, <a class="el" href="chan__skinny_8c_source.html#l01881">skinny_unregister()</a>, <a class="el" href="app__meetme_8c_source.html#l04641">sla_change_trunk_state()</a>, <a class="el" href="app__meetme_8c_source.html#l05149">sla_handle_hold_event()</a>, <a class="el" href="app__meetme_8c_source.html#l05601">sla_station_exec()</a>, <a class="el" href="chan__iax2_8c_source.html#l09458">socket_process()</a>, <a class="el" href="chan__sip_8c_source.html#l05634">update_call_counter()</a>, and <a class="el" href="chan__iax2_8c_source.html#l08346">update_registry()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00509"></a>00509 {
<a name="l00510"></a>00510    <span class="keywordtype">char</span> <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[<a class="code" href="channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a>];
<a name="l00511"></a>00511    va_list ap;
<a name="l00512"></a>00512 
<a name="l00513"></a>00513    va_start(ap, fmt);
<a name="l00514"></a>00514    vsnprintf(buf, <span class="keyword">sizeof</span>(buf), fmt, ap);
<a name="l00515"></a>00515    va_end(ap);
<a name="l00516"></a>00516 
<a name="l00517"></a>00517    <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#a0cc33ebff1ed76c113d17785814b5a47" title="Tells Asterisk the State for Device is changed.">ast_devstate_changed_literal</a>(<a class="code" href="structstate.html">state</a>, buf);
<a name="l00518"></a>00518 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0cc33ebff1ed76c113d17785814b5a47"></a><!-- doxytag: member="devicestate.c::ast_devstate_changed_literal" ref="a0cc33ebff1ed76c113d17785814b5a47" args="(enum ast_device_state state, const char *device)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_devstate_changed_literal </td>
          <td>(</td>
          <td class="paramtype">enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a>&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>device</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Tells Asterisk the State for Device is changed. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structstate.html">state</a></em>&nbsp;</td><td>the new <a class="el" href="structstate.html">state</a> of the device </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>device</em>&nbsp;</td><td>device name like a dial string with format parameters</td></tr>
  </table>
  </dd>
</dl>
<p>The new <a class="el" href="structstate.html">state</a> of the device will be sent off to any subscribers of device states. It will also be stored in the internal event cache.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00465">465</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="lock_8h_source.html#l01734">ast_cond_signal()</a>, <a class="el" href="devicestate_8h_source.html#l00052">AST_DEVICE_UNKNOWN</a>, <a class="el" href="linkedlists_8h_source.html#l00715">AST_LIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h_source.html#l00039">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00139">AST_LIST_UNLOCK</a>, <a class="el" href="devicestate_8c_source.html#l00181">change_thread</a>, <a class="el" href="devicestate_8c_source.html#l00173">state_change::device</a>, <a class="el" href="devicestate_8c_source.html#l00427">devstate_event()</a>, and <a class="el" href="devicestate_8c_source.html#l00454">do_state_change()</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l01388">ast_channel_free()</a>, <a class="el" href="devicestate_8c_source.html#l00520">ast_device_state_changed()</a>, <a class="el" href="devicestate_8c_source.html#l00503">ast_device_state_changed_literal()</a>, <a class="el" href="devicestate_8c_source.html#l00508">ast_devstate_changed()</a>, <a class="el" href="channel_8c_source.html#l04695">ast_setstate()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07417">dahdi_new()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00466"></a>00466 {
<a name="l00467"></a>00467    <span class="keyword">struct </span><a class="code" href="structstate__change.html">state_change</a> *change;
<a name="l00468"></a>00468 
<a name="l00469"></a>00469    <span class="comment">/* </span>
<a name="l00470"></a>00470 <span class="comment">    * If we know the state change (how nice of the caller of this function!)</span>
<a name="l00471"></a>00471 <span class="comment">    * then we can just generate a device state event. </span>
<a name="l00472"></a>00472 <span class="comment">    *</span>
<a name="l00473"></a>00473 <span class="comment">    * Otherwise, we do the following:</span>
<a name="l00474"></a>00474 <span class="comment">    *   - Queue an event up to another thread that the state has changed</span>
<a name="l00475"></a>00475 <span class="comment">    *   - In the processing thread, it calls the callback provided by the</span>
<a name="l00476"></a>00476 <span class="comment">    *     device state provider (which may or may not be a channel driver)</span>
<a name="l00477"></a>00477 <span class="comment">    *     to determine the state.</span>
<a name="l00478"></a>00478 <span class="comment">    *   - If the device state provider does not know the state, or this is</span>
<a name="l00479"></a>00479 <span class="comment">    *     for a channel and the channel driver does not implement a device</span>
<a name="l00480"></a>00480 <span class="comment">    *     state callback, then we will look through the channel list to</span>
<a name="l00481"></a>00481 <span class="comment">    *     see if we can determine a state based on active calls.</span>
<a name="l00482"></a>00482 <span class="comment">    *   - Once a state has been determined, a device state event is generated.</span>
<a name="l00483"></a>00483 <span class="comment">    */</span>
<a name="l00484"></a>00484 
<a name="l00485"></a>00485    <span class="keywordflow">if</span> (<a class="code" href="structstate.html">state</a> != <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea41983b6678528bfcdf919b24d6e08d9a">AST_DEVICE_UNKNOWN</a>) {
<a name="l00486"></a>00486       <a class="code" href="devicestate_8c.html#a87e192ec02bfdad7363a0afd21163d97">devstate_event</a>(<a class="code" href="structstate__change.html#ad4a4f6bb9638907e0d14b2d8b05c86a0">device</a>, <a class="code" href="structstate.html">state</a>);
<a name="l00487"></a>00487    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="devicestate_8c.html#a767b566dd113e1ee0de1634e07c5618d" title="The device state change notification thread.">change_thread</a> == <a class="code" href="lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a> || !(change = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*change) + strlen(<a class="code" href="structstate__change.html#ad4a4f6bb9638907e0d14b2d8b05c86a0">device</a>)))) {
<a name="l00488"></a>00488       <span class="comment">/* we could not allocate a change struct, or */</span>
<a name="l00489"></a>00489       <span class="comment">/* there is no background thread, so process the change now */</span>
<a name="l00490"></a>00490       <a class="code" href="devicestate_8c.html#accc5f57962e9a0e3bbf8d7c2046525f7">do_state_change</a>(<a class="code" href="structstate__change.html#ad4a4f6bb9638907e0d14b2d8b05c86a0">device</a>);
<a name="l00491"></a>00491    } <span class="keywordflow">else</span> {
<a name="l00492"></a>00492       <span class="comment">/* queue the change */</span>
<a name="l00493"></a>00493       strcpy(change-&gt;<a class="code" href="structstate__change.html#ad4a4f6bb9638907e0d14b2d8b05c86a0">device</a>, <a class="code" href="structstate__change.html#ad4a4f6bb9638907e0d14b2d8b05c86a0">device</a>);
<a name="l00494"></a>00494       <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;<a class="code" href="structstate__changes.html" title="The state change queue. State changes are queued for processing by a separate thread...">state_changes</a>);
<a name="l00495"></a>00495       <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(&amp;<a class="code" href="structstate__changes.html" title="The state change queue. State changes are queued for processing by a separate thread...">state_changes</a>, change, <a class="code" href="structstate__change.html#a443ba7b3c87e8b2c97bb8d454329b925">list</a>);
<a name="l00496"></a>00496       <a class="code" href="lock_8h.html#a02a91e30acdea6d13208d23636d37c87">ast_cond_signal</a>(&amp;<a class="code" href="devicestate_8c.html#aa33e22b03fb6e00eb7f27a34f0e630f1" title="Flag for the queue.">change_pending</a>);
<a name="l00497"></a>00497       <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="structstate__changes.html" title="The state change queue. State changes are queued for processing by a separate thread...">state_changes</a>);
<a name="l00498"></a>00498    }
<a name="l00499"></a>00499 
<a name="l00500"></a>00500    <span class="keywordflow">return</span> 1;
<a name="l00501"></a>00501 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae832fcc32c88962e73025ffeafe2961e"></a><!-- doxytag: member="devicestate.c::ast_devstate_prov_add" ref="ae832fcc32c88962e73025ffeafe2961e" args="(const char *label, ast_devstate_prov_cb_type callback)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_devstate_prov_add </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>label</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="devicestate_8h.html#a93c7236225b5fd76d197b8e5afba2de5">ast_devstate_prov_cb_type</a>&nbsp;</td>
          <td class="paramname"> <em>callback</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add device <a class="el" href="structstate.html">state</a> provider. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>label</em>&nbsp;</td><td>to use in hint, like label:object </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>callback</em>&nbsp;</td><td>Callback</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00369">369</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="linkedlists_8h_source.html#l00702">AST_RWLIST_INSERT_HEAD</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, <a class="el" href="devicestate_8c_source.html#l00164">devstate_prov::callback</a>, and <a class="el" href="devicestate_8c_source.html#l00163">devstate_prov::label</a>.</p>

<p>Referenced by <a class="el" href="features_8c_source.html#l04642">ast_features_init()</a>, and <a class="el" href="app__meetme_8c_source.html#l06461">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00370"></a>00370 {
<a name="l00371"></a>00371    <span class="keyword">struct </span><a class="code" href="structdevstate__prov.html" title="A device state provider (not a channel).">devstate_prov</a> *devprov;
<a name="l00372"></a>00372 
<a name="l00373"></a>00373    <span class="keywordflow">if</span> (!<a class="code" href="structdevstate__prov.html#a255429574a13fcf8e3deacdc16211d00">callback</a> || !(devprov = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*devprov))))
<a name="l00374"></a>00374       <span class="keywordflow">return</span> -1;
<a name="l00375"></a>00375 
<a name="l00376"></a>00376    devprov-&gt;<a class="code" href="structdevstate__prov.html#a255429574a13fcf8e3deacdc16211d00">callback</a> = <a class="code" href="structdevstate__prov.html#a255429574a13fcf8e3deacdc16211d00">callback</a>;
<a name="l00377"></a>00377    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(devprov-&gt;<a class="code" href="structdevstate__prov.html#a48e23fa2154347c433b24e799187ee4f">label</a>, <a class="code" href="structdevstate__prov.html#a48e23fa2154347c433b24e799187ee4f">label</a>, <span class="keyword">sizeof</span>(devprov-&gt;<a class="code" href="structdevstate__prov.html#a48e23fa2154347c433b24e799187ee4f">label</a>));
<a name="l00378"></a>00378 
<a name="l00379"></a>00379    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structdevstate__provs.html" title="A list of providers.">devstate_provs</a>);
<a name="l00380"></a>00380    <a class="code" href="linkedlists_8h.html#aacc5f6b7c25e361d11d40137fd55a8e8">AST_RWLIST_INSERT_HEAD</a>(&amp;<a class="code" href="structdevstate__provs.html" title="A list of providers.">devstate_provs</a>, devprov, <a class="code" href="structdevstate__prov.html#a6c499d1fde36b0bee0c362bd431a2108">list</a>);
<a name="l00381"></a>00381    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structdevstate__provs.html" title="A list of providers.">devstate_provs</a>);
<a name="l00382"></a>00382 
<a name="l00383"></a>00383    <span class="keywordflow">return</span> 0;
<a name="l00384"></a>00384 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1ab579ae15aaca64a904c3c41d8b8b01"></a><!-- doxytag: member="devicestate.c::ast_devstate_prov_del" ref="a1ab579ae15aaca64a904c3c41d8b8b01" args="(const char *label)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_devstate_prov_del </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>label</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Remove device <a class="el" href="structstate.html">state</a> provider. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>label</em>&nbsp;</td><td>to use in hint, like label:object</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00387">387</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="linkedlists_8h_source.html#l00564">AST_RWLIST_REMOVE_CURRENT</a>, <a class="el" href="linkedlists_8h_source.html#l00541">AST_RWLIST_TRAVERSE_SAFE_BEGIN</a>, <a class="el" href="linkedlists_8h_source.html#l00601">AST_RWLIST_TRAVERSE_SAFE_END</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, and <a class="el" href="devicestate_8c_source.html#l00163">devstate_prov::label</a>.</p>

<p>Referenced by <a class="el" href="app__meetme_8c_source.html#l06435">unload_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00388"></a>00388 {
<a name="l00389"></a>00389    <span class="keyword">struct </span><a class="code" href="structdevstate__prov.html" title="A device state provider (not a channel).">devstate_prov</a> *devcb;
<a name="l00390"></a>00390    <span class="keywordtype">int</span> res = -1;
<a name="l00391"></a>00391 
<a name="l00392"></a>00392    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structdevstate__provs.html" title="A list of providers.">devstate_provs</a>);
<a name="l00393"></a>00393    <a class="code" href="linkedlists_8h.html#a21be6da4b2146b04b4868c2be5cae750">AST_RWLIST_TRAVERSE_SAFE_BEGIN</a>(&amp;<a class="code" href="structdevstate__provs.html" title="A list of providers.">devstate_provs</a>, devcb, <a class="code" href="structdevstate__prov.html#a6c499d1fde36b0bee0c362bd431a2108">list</a>) {
<a name="l00394"></a>00394       <span class="keywordflow">if</span> (!strcasecmp(devcb-&gt;<a class="code" href="structdevstate__prov.html#a48e23fa2154347c433b24e799187ee4f">label</a>, <a class="code" href="structdevstate__prov.html#a48e23fa2154347c433b24e799187ee4f">label</a>)) {
<a name="l00395"></a>00395          <a class="code" href="linkedlists_8h.html#a02212548652c9eb0f3db38dc4e4bd285">AST_RWLIST_REMOVE_CURRENT</a>(<a class="code" href="structdevstate__prov.html#a6c499d1fde36b0bee0c362bd431a2108">list</a>);
<a name="l00396"></a>00396          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(devcb);
<a name="l00397"></a>00397          res = 0;
<a name="l00398"></a>00398          <span class="keywordflow">break</span>;
<a name="l00399"></a>00399       }
<a name="l00400"></a>00400    }
<a name="l00401"></a>00401    <a class="code" href="linkedlists_8h.html#a6bf0e81cb6ef01532ddebaba68f6de28">AST_RWLIST_TRAVERSE_SAFE_END</a>;
<a name="l00402"></a>00402    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structdevstate__provs.html" title="A list of providers.">devstate_provs</a>);
<a name="l00403"></a>00403 
<a name="l00404"></a>00404    <span class="keywordflow">return</span> res;
<a name="l00405"></a>00405 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a3573a25e7e8a395fe8332f1b1ca42097"></a><!-- doxytag: member="devicestate.c::ast_devstate_str" ref="a3573a25e7e8a395fe8332f1b1ca42097" args="(enum ast_device_state state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* ast_devstate_str </td>
          <td>(</td>
          <td class="paramtype">enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a>&nbsp;</td>
          <td class="paramname"> <em>devstate</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Convert device <a class="el" href="structstate.html">state</a> to text string that is easier to parse. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>devstate</em>&nbsp;</td><td>Current device <a class="el" href="structstate.html">state</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00233">233</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>Referenced by <a class="el" href="func__devstate_8c_source.html#l00100">devstate_read()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00234"></a>00234 {
<a name="l00235"></a>00235    <span class="keywordflow">return</span> <a class="code" href="devicestate_8c.html#ac35aab157772024788c572a575a19703" title="Device state strings for printing.">devstatestring</a>[<a class="code" href="structstate.html">state</a>][1];
<a name="l00236"></a>00236 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae148e0b95218b57b0348ab53f2f82657"></a><!-- doxytag: member="devicestate.c::ast_devstate_val" ref="ae148e0b95218b57b0348ab53f2f82657" args="(const char *val)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a> ast_devstate_val </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>val</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Convert device <a class="el" href="structstate.html">state</a> from text to integer value. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structval.html">val</a></em>&nbsp;</td><td>The text representing the device <a class="el" href="structstate.html">state</a>. Valid <a class="el" href="structvalues.html">values</a> are anything that comes after AST_DEVICE_ in one of the defined <a class="el" href="structvalues.html">values</a>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>The AST_DEVICE_ integer value </dd></dl>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00238">238</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="devicestate_8h_source.html#l00055">AST_DEVICE_BUSY</a>, <a class="el" href="devicestate_8h_source.html#l00054">AST_DEVICE_INUSE</a>, <a class="el" href="devicestate_8h_source.html#l00056">AST_DEVICE_INVALID</a>, <a class="el" href="devicestate_8h_source.html#l00053">AST_DEVICE_NOT_INUSE</a>, <a class="el" href="devicestate_8h_source.html#l00060">AST_DEVICE_ONHOLD</a>, <a class="el" href="devicestate_8h_source.html#l00058">AST_DEVICE_RINGING</a>, <a class="el" href="devicestate_8h_source.html#l00059">AST_DEVICE_RINGINUSE</a>, <a class="el" href="devicestate_8h_source.html#l00057">AST_DEVICE_UNAVAILABLE</a>, and <a class="el" href="devicestate_8h_source.html#l00052">AST_DEVICE_UNKNOWN</a>.</p>

<p>Referenced by <a class="el" href="func__devstate_8c_source.html#l00182">custom_devstate_callback()</a>, <a class="el" href="func__devstate_8c_source.html#l00107">devstate_write()</a>, <a class="el" href="func__devstate_8c_source.html#l00235">handle_cli_devstate_change()</a>, and <a class="el" href="func__devstate_8c_source.html#l00326">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00239"></a>00239 {
<a name="l00240"></a>00240    <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="structval.html">val</a>, <span class="stringliteral">&quot;NOT_INUSE&quot;</span>))
<a name="l00241"></a>00241       <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeadee91fc4886ffc7b4efb8459cef48fe2">AST_DEVICE_NOT_INUSE</a>;
<a name="l00242"></a>00242    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="structval.html">val</a>, <span class="stringliteral">&quot;INUSE&quot;</span>))
<a name="l00243"></a>00243       <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea23aa227468c09b5ebd0fb01b4c895190">AST_DEVICE_INUSE</a>;
<a name="l00244"></a>00244    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="structval.html">val</a>, <span class="stringliteral">&quot;BUSY&quot;</span>))
<a name="l00245"></a>00245       <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeab43afabf5bcd4ad1f531ad78c48ccb6f">AST_DEVICE_BUSY</a>;
<a name="l00246"></a>00246    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="structval.html">val</a>, <span class="stringliteral">&quot;INVALID&quot;</span>))
<a name="l00247"></a>00247       <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea9c008e1d20858cbc3275c157e02ebc94">AST_DEVICE_INVALID</a>;
<a name="l00248"></a>00248    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="structval.html">val</a>, <span class="stringliteral">&quot;UNAVAILABLE&quot;</span>))
<a name="l00249"></a>00249       <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeafac147cbabf3ccb80e50e86027710549">AST_DEVICE_UNAVAILABLE</a>;
<a name="l00250"></a>00250    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="structval.html">val</a>, <span class="stringliteral">&quot;RINGING&quot;</span>))
<a name="l00251"></a>00251       <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea76d91d5d654cfa3edafb2afbe3e09b46">AST_DEVICE_RINGING</a>;
<a name="l00252"></a>00252    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="structval.html">val</a>, <span class="stringliteral">&quot;RINGINUSE&quot;</span>))
<a name="l00253"></a>00253       <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea17b87dfa3f4de5909b401017e229091d">AST_DEVICE_RINGINUSE</a>;
<a name="l00254"></a>00254    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="structval.html">val</a>, <span class="stringliteral">&quot;ONHOLD&quot;</span>))
<a name="l00255"></a>00255       <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea6b7416bea92d3bc5ee8e36f0a484cdc1">AST_DEVICE_ONHOLD</a>;
<a name="l00256"></a>00256 
<a name="l00257"></a>00257    <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea41983b6678528bfcdf919b24d6e08d9a">AST_DEVICE_UNKNOWN</a>;
<a name="l00258"></a>00258 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aab3f3dcda2662dc291fc4c17b9a602f4"></a><!-- doxytag: member="devicestate.c::ast_enable_distributed_devstate" ref="aab3f3dcda2662dc291fc4c17b9a602f4" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_enable_distributed_devstate </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Enable distributed device <a class="el" href="structstate.html">state</a> processing. </p>
<p>By default, Asterisk assumes that device <a class="el" href="structstate.html">state</a> change events will only be originating from one instance. If a module gets loaded and configured such that multiple instances of Asterisk will be sharing device <a class="el" href="structstate.html">state</a>, this function should be called to enable distributed device <a class="el" href="structstate.html">state</a> processing. It is off by default to save on unnecessary processing.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00823">823</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l01729">ast_cond_init()</a>, <a class="el" href="event__defs_8h_source.html#l00050">AST_EVENT_DEVICE_STATE_CHANGE</a>, <a class="el" href="event__defs_8h_source.html#l00058">AST_EVENT_IE_END</a>, <a class="el" href="event_8c_source.html#l00680">ast_event_subscribe()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01692">ast_mutex_init()</a>, <a class="el" href="utils_8h_source.html#l00384">ast_pthread_create_background</a>, <a class="el" href="devicestate_8c_source.html#l00692">devstate_change_collector_cb()</a>, <a class="el" href="devicestate_8c.html#a21d826fdbe789058ca74e83f4f052c37">devstate_collector</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, and <a class="el" href="devicestate_8c_source.html#l00674">run_devstate_collector()</a>.</p>

<p>Referenced by <a class="el" href="evt_8c_source.html#l00300">add_publish_event()</a>, and <a class="el" href="evt_8c_source.html#l00362">add_subscribe_event()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00824"></a>00824 {
<a name="l00825"></a>00825    <span class="keywordflow">if</span> (<a class="code" href="devicestate_8c.html#a21d826fdbe789058ca74e83f4f052c37">devstate_collector</a>.enabled) {
<a name="l00826"></a>00826       <span class="keywordflow">return</span> 0;
<a name="l00827"></a>00827    }
<a name="l00828"></a>00828 
<a name="l00829"></a>00829    <a class="code" href="devicestate_8c.html#a21d826fdbe789058ca74e83f4f052c37">devstate_collector</a>.event_sub = <a class="code" href="event_8h.html#a517ac17630e7658463b66b309a6ce78f" title="Subscribe to events.">ast_event_subscribe</a>(<a class="code" href="event__defs_8h.html#a6fa079412d9d9c1cc539f6d71f37f79fa641bc805cee9b8829fa265e566df9d58">AST_EVENT_DEVICE_STATE_CHANGE</a>,
<a name="l00830"></a>00830       <a class="code" href="devicestate_8c.html#a6328f4d8f6d6b35b38f2acb39258cd2f">devstate_change_collector_cb</a>, NULL, <a class="code" href="event__defs_8h.html#a003673523d7fe265c6738a5a9e49c491a04c78c1362e97d548344c354001c151f">AST_EVENT_IE_END</a>);
<a name="l00831"></a>00831 
<a name="l00832"></a>00832    <span class="keywordflow">if</span> (!<a class="code" href="devicestate_8c.html#a21d826fdbe789058ca74e83f4f052c37">devstate_collector</a>.event_sub) {
<a name="l00833"></a>00833       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to create subscription for the device state change collector\n&quot;</span>);
<a name="l00834"></a>00834       <span class="keywordflow">return</span> -1;
<a name="l00835"></a>00835    }
<a name="l00836"></a>00836 
<a name="l00837"></a>00837    <a class="code" href="lock_8h.html#a5dc895fe6e8c089175159fc22e33fc3b">ast_mutex_init</a>(&amp;<a class="code" href="devicestate_8c.html#a21d826fdbe789058ca74e83f4f052c37">devstate_collector</a>.lock);
<a name="l00838"></a>00838    <a class="code" href="lock_8h.html#a21f75f462115427718d78aa66cc61f9b">ast_cond_init</a>(&amp;<a class="code" href="devicestate_8c.html#a21d826fdbe789058ca74e83f4f052c37">devstate_collector</a>.cond, NULL);
<a name="l00839"></a>00839    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a595e2f8aa398f4bd21e381c3211235fe">ast_pthread_create_background</a>(&amp;<a class="code" href="devicestate_8c.html#a21d826fdbe789058ca74e83f4f052c37">devstate_collector</a>.thread, NULL, <a class="code" href="devicestate_8c.html#aba2b4557d1f67626534da2a47d3ad39e">run_devstate_collector</a>, NULL) &lt; 0) {
<a name="l00840"></a>00840       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to start device state collector thread.\n&quot;</span>);
<a name="l00841"></a>00841       <span class="keywordflow">return</span> -1;
<a name="l00842"></a>00842    }
<a name="l00843"></a>00843 
<a name="l00844"></a>00844    <a class="code" href="devicestate_8c.html#a21d826fdbe789058ca74e83f4f052c37">devstate_collector</a>.enabled = 1;
<a name="l00845"></a>00845 
<a name="l00846"></a>00846    <span class="keywordflow">return</span> 0;
<a name="l00847"></a>00847 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9da9a09e65a9332176a523407ccac611"></a><!-- doxytag: member="devicestate.c::ast_parse_device_state" ref="a9da9a09e65a9332176a523407ccac611" args="(const char *device)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a> ast_parse_device_state </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>device</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Find out if device is active in a call or not. </p>
<p>Search the Channels by Name.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>find <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> with the device's name in it This function is only used for <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> that does not implement devicestate natively </dd></dl>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00265">265</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00469">ast_channel::_state</a>, <a class="el" href="channel_8h_source.html#l00136">AST_CHANNEL_NAME</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="devicestate_8h_source.html#l00054">AST_DEVICE_INUSE</a>, <a class="el" href="devicestate_8h_source.html#l00058">AST_DEVICE_RINGING</a>, <a class="el" href="devicestate_8h_source.html#l00052">AST_DEVICE_UNKNOWN</a>, <a class="el" href="channel_8c_source.html#l01284">ast_get_channel_by_name_prefix_locked()</a>, <a class="el" href="channel_8h_source.html#l00364">AST_STATE_RINGING</a>, <a class="el" href="adsistub_8c_source.html#l00049">chan</a>, and <a class="el" href="chan__iax2_8c_source.html#l01834">match()</a>.</p>

<p>Referenced by <a class="el" href="devicestate_8c_source.html#l00308">_ast_device_state()</a>, and <a class="el" href="app__chanisavail_8c_source.html#l00097">chanavail_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00266"></a>00266 {
<a name="l00267"></a>00267    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>;
<a name="l00268"></a>00268    <span class="keywordtype">char</span> <a class="code" href="chan__iax2_8c.html#aa27930d6214f6421994d6bef51efb7aa">match</a>[<a class="code" href="channel_8h.html#ab57c278099ea5f8d7cedbb41eba58b56">AST_CHANNEL_NAME</a>];
<a name="l00269"></a>00269    <span class="keyword">enum</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee" title="Device States.">ast_device_state</a> res;
<a name="l00270"></a>00270 
<a name="l00271"></a>00271    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(match, device, <span class="keyword">sizeof</span>(match)-1);
<a name="l00272"></a>00272    strcat(match, <span class="stringliteral">&quot;-&quot;</span>);
<a name="l00273"></a>00273    chan = <a class="code" href="channel_8h.html#a67239a95ab93867fb9da5a8b20281224" title="Get channel by name or uniqueid prefix (locks channel).">ast_get_channel_by_name_prefix_locked</a>(match, strlen(match));
<a name="l00274"></a>00274 
<a name="l00275"></a>00275    <span class="keywordflow">if</span> (!chan)
<a name="l00276"></a>00276       <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea41983b6678528bfcdf919b24d6e08d9a">AST_DEVICE_UNKNOWN</a>;
<a name="l00277"></a>00277 
<a name="l00278"></a>00278    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa">AST_STATE_RINGING</a>)
<a name="l00279"></a>00279       res = <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea76d91d5d654cfa3edafb2afbe3e09b46">AST_DEVICE_RINGING</a>;
<a name="l00280"></a>00280    <span class="keywordflow">else</span>
<a name="l00281"></a>00281       res = <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea23aa227468c09b5ebd0fb01b4c895190">AST_DEVICE_INUSE</a>;
<a name="l00282"></a>00282    
<a name="l00283"></a>00283    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l00284"></a>00284 
<a name="l00285"></a>00285    <span class="keywordflow">return</span> res;
<a name="l00286"></a>00286 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8e0c5acc035f43741343b8ed2fcb14ea"></a><!-- doxytag: member="devicestate.c::ast_state_chan2dev" ref="a8e0c5acc035f43741343b8ed2fcb14ea" args="(enum ast_channel_state chanstate)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a> ast_state_chan2dev </td>
          <td>(</td>
          <td class="paramtype">enum <a class="el" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660">ast_channel_state</a>&nbsp;</td>
          <td class="paramname"> <em>chanstate</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Convert channel <a class="el" href="structstate.html">state</a> to devicestate. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chanstate</em>&nbsp;</td><td>Current channel <a class="el" href="structstate.html">state</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="since"><dt><b>Since:</b></dt><dd>1.6.1 </dd></dl>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00220">220</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="devicestate_8h_source.html#l00052">AST_DEVICE_UNKNOWN</a>, and <a class="el" href="adsistub_8c_source.html#l00049">chan</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l07417">dahdi_new()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00221"></a>00221 {
<a name="l00222"></a>00222    <span class="keywordtype">int</span> i;
<a name="l00223"></a>00223    chanstate &amp;= 0xFFFF;
<a name="l00224"></a>00224    <span class="keywordflow">for</span> (i = 0; <a class="code" href="structchan2dev.html" title="Mapping for channel states to device states.">chan2dev</a>[i].chan != -100; i++) {
<a name="l00225"></a>00225       <span class="keywordflow">if</span> (<a class="code" href="structchan2dev.html" title="Mapping for channel states to device states.">chan2dev</a>[i].<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a> == chanstate) {
<a name="l00226"></a>00226          <span class="keywordflow">return</span> <a class="code" href="structchan2dev.html" title="Mapping for channel states to device states.">chan2dev</a>[i].dev;
<a name="l00227"></a>00227       }
<a name="l00228"></a>00228    }
<a name="l00229"></a>00229    <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea41983b6678528bfcdf919b24d6e08d9a">AST_DEVICE_UNKNOWN</a>;
<a name="l00230"></a>00230 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad157407a4e75e687610159a1676d00db"></a><!-- doxytag: member="devicestate.c::destroy_devstate_change" ref="ad157407a4e75e687610159a1676d00db" args="(struct devstate_change *sc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void destroy_devstate_change </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdevstate__change.html">devstate_change</a> *&nbsp;</td>
          <td class="paramname"> <em>sc</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00557">557</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>.</p>

<p>Referenced by <a class="el" href="devicestate_8c_source.html#l00674">run_devstate_collector()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00558"></a>00558 {
<a name="l00559"></a>00559    <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(sc);
<a name="l00560"></a>00560 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa870d9317f745dbb62b491dcc32ec8d8"></a><!-- doxytag: member="devicestate.c::devstate2str" ref="aa870d9317f745dbb62b491dcc32ec8d8" args="(enum ast_device_state devstate)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* devstate2str </td>
          <td>(</td>
          <td class="paramtype">enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a>&nbsp;</td>
          <td class="paramname"> <em>devstate</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Convert device <a class="el" href="structstate.html">state</a> to text string for output. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>devstate</em>&nbsp;</td><td>Current device <a class="el" href="structstate.html">state</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00215">215</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00216"></a>00216 {
<a name="l00217"></a>00217    <span class="keywordflow">return</span> <a class="code" href="devicestate_8c.html#ac35aab157772024788c572a575a19703" title="Device state strings for printing.">devstatestring</a>[devstate][0];
<a name="l00218"></a>00218 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab22d051f46950c0eb53bbafd489357ec"></a><!-- doxytag: member="devicestate.c::devstate_cache_cb" ref="ab22d051f46950c0eb53bbafd489357ec" args="(const struct ast_event *event, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void devstate_cache_cb </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structast__event.html">ast_event</a> *&nbsp;</td>
          <td class="paramname"> <em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00568">568</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="event_8c_source.html#l00839">ast_event_get_ie_raw()</a>, <a class="el" href="event_8c_source.html#l00812">ast_event_get_ie_uint()</a>, <a class="el" href="event__defs_8h_source.html#l00122">AST_EVENT_IE_EID</a>, <a class="el" href="event__defs_8h_source.html#l00109">AST_EVENT_IE_STATE</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="devicestate_8c_source.html#l00189">devstate_change::eid</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="devicestate_8c_source.html#l00562">MAX_SERVERS</a>, <a class="el" href="devicestate_8c_source.html#l00565">change_collection::num_states</a>, <a class="el" href="devicestate_8c_source.html#l00188">devstate_change::state</a>, and <a class="el" href="devicestate_8c_source.html#l00564">change_collection::states</a>.</p>

<p>Referenced by <a class="el" href="devicestate_8c_source.html#l00646">handle_devstate_change()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00569"></a>00569 {
<a name="l00570"></a>00570    <span class="keyword">struct </span><a class="code" href="structchange__collection.html">change_collection</a> *collection = data;
<a name="l00571"></a>00571    <span class="keywordtype">int</span> i;
<a name="l00572"></a>00572    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structast__eid.html" title="An Entity ID is essentially a MAC address, brief and unique.">ast_eid</a> *<a class="code" href="structast__eid.html#aaffcb04ac1b364a0788003f95715460b">eid</a>;
<a name="l00573"></a>00573 
<a name="l00574"></a>00574    <span class="keywordflow">if</span> (collection-&gt;<a class="code" href="structchange__collection.html#a5e034d2106494002b7f00bf09e9e6982">num_states</a> == <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(collection-&gt;<a class="code" href="structchange__collection.html#a3e7c6ab9bc81f5914ac435c09412615f">states</a>)) {
<a name="l00575"></a>00575       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;More per-server state values than we have room for (MAX_SERVERS is %d)\n&quot;</span>,
<a name="l00576"></a>00576          <a class="code" href="devicestate_8c.html#aaf8d2ae1c0e1c6413c3a70c4526ace9f">MAX_SERVERS</a>);
<a name="l00577"></a>00577       <span class="keywordflow">return</span>;
<a name="l00578"></a>00578    }
<a name="l00579"></a>00579 
<a name="l00580"></a>00580    <span class="keywordflow">if</span> (!(eid = <a class="code" href="event_8h.html#acaf805e5e914c76e884a5722efd2c0da" title="Get the value of an information element that has a raw payload.">ast_event_get_ie_raw</a>(event, <a class="code" href="event__defs_8h.html#a003673523d7fe265c6738a5a9e49c491a8e38c9805132c95123e80568ba508b17" title="Entity ID Used by All events Payload type: RAW This IE indicates which server the...">AST_EVENT_IE_EID</a>))) {
<a name="l00581"></a>00581       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Device state change event with no EID\n&quot;</span>);
<a name="l00582"></a>00582       <span class="keywordflow">return</span>;
<a name="l00583"></a>00583    }
<a name="l00584"></a>00584 
<a name="l00585"></a>00585    i = collection-&gt;<a class="code" href="structchange__collection.html#a5e034d2106494002b7f00bf09e9e6982">num_states</a>;
<a name="l00586"></a>00586 
<a name="l00587"></a>00587    collection-&gt;<a class="code" href="structchange__collection.html#a3e7c6ab9bc81f5914ac435c09412615f">states</a>[i].<a class="code" href="structdevstate__change.html#a1b0c7bd4d79798ef4e0ce23894c9aeb2">state</a> = <a class="code" href="event_8h.html#a317f6947b933acd0da82df6e9a4672e5" title="Get the value of an information element that has an integer payload.">ast_event_get_ie_uint</a>(event, <a class="code" href="event__defs_8h.html#a003673523d7fe265c6738a5a9e49c491a17f475640d923666e2c755e4985b61f8" title="Generic State IE Used by AST_EVENT_DEVICE_STATE_CHANGE Payload type: UINT The actual...">AST_EVENT_IE_STATE</a>);
<a name="l00588"></a>00588    collection-&gt;<a class="code" href="structchange__collection.html#a3e7c6ab9bc81f5914ac435c09412615f">states</a>[i].<a class="code" href="structdevstate__change.html#aa1d7e6e6eb6d297e62f2d79dbdfaafb4">eid</a> = *eid;
<a name="l00589"></a>00589 
<a name="l00590"></a>00590    collection-&gt;<a class="code" href="structchange__collection.html#a5e034d2106494002b7f00bf09e9e6982">num_states</a>++;
<a name="l00591"></a>00591 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4dc83bd04a1b6182961ab99f96e720cf"></a><!-- doxytag: member="devicestate.c::devstate_cached" ref="a4dc83bd04a1b6182961ab99f96e720cf" args="(const char *device)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a> devstate_cached </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>device</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00288">288</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="devicestate_8h_source.html#l00052">AST_DEVICE_UNKNOWN</a>, <a class="el" href="event_8c_source.html#l00963">ast_event_destroy()</a>, <a class="el" href="event__defs_8h_source.html#l00047">AST_EVENT_DEVICE_STATE</a>, <a class="el" href="event_8c_source.html#l00991">ast_event_get_cached()</a>, <a class="el" href="event_8c_source.html#l00812">ast_event_get_ie_uint()</a>, <a class="el" href="event__defs_8h_source.html#l00101">AST_EVENT_IE_DEVICE</a>, <a class="el" href="event__defs_8h_source.html#l00058">AST_EVENT_IE_END</a>, <a class="el" href="event__defs_8h_source.html#l00137">AST_EVENT_IE_PLTYPE_STR</a>, and <a class="el" href="event__defs_8h_source.html#l00109">AST_EVENT_IE_STATE</a>.</p>

<p>Referenced by <a class="el" href="devicestate_8c_source.html#l00308">_ast_device_state()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00289"></a>00289 {
<a name="l00290"></a>00290    <span class="keyword">enum</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee" title="Device States.">ast_device_state</a> res = <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea41983b6678528bfcdf919b24d6e08d9a">AST_DEVICE_UNKNOWN</a>;
<a name="l00291"></a>00291    <span class="keyword">struct </span><a class="code" href="structast__event.html" title="An event.">ast_event</a> *event;
<a name="l00292"></a>00292 
<a name="l00293"></a>00293    <span class="keyword">event</span> = <a class="code" href="event_8h.html#a419385710c135873656b047df8f72e7e" title="Retrieve an event from the cache.">ast_event_get_cached</a>(<a class="code" href="event__defs_8h.html#a6fa079412d9d9c1cc539f6d71f37f79fa8900374a138e7dbbc9da893f27923846">AST_EVENT_DEVICE_STATE</a>,
<a name="l00294"></a>00294       <a class="code" href="event__defs_8h.html#a003673523d7fe265c6738a5a9e49c491a675632af9f21fe7696772885593140e3" title="Device Name Used by AST_EVENT_DEVICE_STATE_CHANGE Payload type: STR.">AST_EVENT_IE_DEVICE</a>, <a class="code" href="event__defs_8h.html#a73dadfa1128d5e75107536e132e758c6ab82ac16f0791be2f8f918429a73430be">AST_EVENT_IE_PLTYPE_STR</a>, device,
<a name="l00295"></a>00295       <a class="code" href="event__defs_8h.html#a003673523d7fe265c6738a5a9e49c491a04c78c1362e97d548344c354001c151f">AST_EVENT_IE_END</a>);
<a name="l00296"></a>00296 
<a name="l00297"></a>00297    <span class="keywordflow">if</span> (!event)
<a name="l00298"></a>00298       <span class="keywordflow">return</span> res;
<a name="l00299"></a>00299 
<a name="l00300"></a>00300    res = <a class="code" href="event_8h.html#a317f6947b933acd0da82df6e9a4672e5" title="Get the value of an information element that has an integer payload.">ast_event_get_ie_uint</a>(event, <a class="code" href="event__defs_8h.html#a003673523d7fe265c6738a5a9e49c491a17f475640d923666e2c755e4985b61f8" title="Generic State IE Used by AST_EVENT_DEVICE_STATE_CHANGE Payload type: UINT The actual...">AST_EVENT_IE_STATE</a>);
<a name="l00301"></a>00301 
<a name="l00302"></a>00302    <a class="code" href="event_8h.html#a50b34e0161630dbbc0880a06eb78ad7a" title="Destroy an event.">ast_event_destroy</a>(event);
<a name="l00303"></a>00303 
<a name="l00304"></a>00304    <span class="keywordflow">return</span> res;
<a name="l00305"></a>00305 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6328f4d8f6d6b35b38f2acb39258cd2f"></a><!-- doxytag: member="devicestate.c::devstate_change_collector_cb" ref="a6328f4d8f6d6b35b38f2acb39258cd2f" args="(const struct ast_event *event, void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void devstate_change_collector_cb </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structast__event.html">ast_event</a> *&nbsp;</td>
          <td class="paramname"> <em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00692">692</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="lock_8h_source.html#l01734">ast_cond_signal()</a>, <a class="el" href="event_8c_source.html#l00839">ast_event_get_ie_raw()</a>, <a class="el" href="event_8c_source.html#l00830">ast_event_get_ie_str()</a>, <a class="el" href="event_8c_source.html#l00812">ast_event_get_ie_uint()</a>, <a class="el" href="event__defs_8h_source.html#l00101">AST_EVENT_IE_DEVICE</a>, <a class="el" href="event__defs_8h_source.html#l00122">AST_EVENT_IE_EID</a>, <a class="el" href="event__defs_8h_source.html#l00109">AST_EVENT_IE_STATE</a>, <a class="el" href="linkedlists_8h_source.html#l00715">AST_LIST_INSERT_TAIL</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="strings_8h_source.html#l00063">ast_strlen_zero()</a>, <a class="el" href="devicestate_8c_source.html#l00190">devstate_change::device</a>, <a class="el" href="devicestate_8c.html#a21d826fdbe789058ca74e83f4f052c37">devstate_collector</a>, <a class="el" href="devicestate_8c_source.html#l00189">devstate_change::eid</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, and <a class="el" href="devicestate_8c_source.html#l00188">devstate_change::state</a>.</p>

<p>Referenced by <a class="el" href="devicestate_8c_source.html#l00823">ast_enable_distributed_devstate()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00693"></a>00693 {
<a name="l00694"></a>00694    <span class="keyword">struct </span><a class="code" href="structdevstate__change.html">devstate_change</a> *sc;
<a name="l00695"></a>00695    <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structdevstate__change.html#ad4a4f6bb9638907e0d14b2d8b05c86a0">device</a>;
<a name="l00696"></a>00696    <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structast__eid.html" title="An Entity ID is essentially a MAC address, brief and unique.">ast_eid</a> *<a class="code" href="structast__eid.html#aaffcb04ac1b364a0788003f95715460b">eid</a>;
<a name="l00697"></a>00697    uint32_t <a class="code" href="structstate.html">state</a>;
<a name="l00698"></a>00698 
<a name="l00699"></a>00699    device = <a class="code" href="event_8h.html#a0cfdd21162f4795714da583c31477151" title="Get the value of an information element that has a string payload.">ast_event_get_ie_str</a>(event, <a class="code" href="event__defs_8h.html#a003673523d7fe265c6738a5a9e49c491a675632af9f21fe7696772885593140e3" title="Device Name Used by AST_EVENT_DEVICE_STATE_CHANGE Payload type: STR.">AST_EVENT_IE_DEVICE</a>);
<a name="l00700"></a>00700    eid = <a class="code" href="event_8h.html#acaf805e5e914c76e884a5722efd2c0da" title="Get the value of an information element that has a raw payload.">ast_event_get_ie_raw</a>(event, <a class="code" href="event__defs_8h.html#a003673523d7fe265c6738a5a9e49c491a8e38c9805132c95123e80568ba508b17" title="Entity ID Used by All events Payload type: RAW This IE indicates which server the...">AST_EVENT_IE_EID</a>);
<a name="l00701"></a>00701    state = <a class="code" href="event_8h.html#a317f6947b933acd0da82df6e9a4672e5" title="Get the value of an information element that has an integer payload.">ast_event_get_ie_uint</a>(event, <a class="code" href="event__defs_8h.html#a003673523d7fe265c6738a5a9e49c491a17f475640d923666e2c755e4985b61f8" title="Generic State IE Used by AST_EVENT_DEVICE_STATE_CHANGE Payload type: UINT The actual...">AST_EVENT_IE_STATE</a>);
<a name="l00702"></a>00702 
<a name="l00703"></a>00703    <span class="keywordflow">if</span> (<a class="code" href="strings_8h.html#a5c8aa5212ecb665fb072eac00c799da6">ast_strlen_zero</a>(device) || !eid) {
<a name="l00704"></a>00704       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Invalid device state change event received\n&quot;</span>);
<a name="l00705"></a>00705       <span class="keywordflow">return</span>;
<a name="l00706"></a>00706    }
<a name="l00707"></a>00707 
<a name="l00708"></a>00708    <span class="keywordflow">if</span> (!(sc = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*sc) + strlen(device))))
<a name="l00709"></a>00709       <span class="keywordflow">return</span>;
<a name="l00710"></a>00710 
<a name="l00711"></a>00711    strcpy(sc-&gt;<a class="code" href="structdevstate__change.html#ad4a4f6bb9638907e0d14b2d8b05c86a0">device</a>, device);
<a name="l00712"></a>00712    sc-&gt;<a class="code" href="structdevstate__change.html#aa1d7e6e6eb6d297e62f2d79dbdfaafb4">eid</a> = *eid;
<a name="l00713"></a>00713    sc-&gt;<a class="code" href="structdevstate__change.html#a1b0c7bd4d79798ef4e0ce23894c9aeb2">state</a> = state;
<a name="l00714"></a>00714 
<a name="l00715"></a>00715    <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;<a class="code" href="devicestate_8c.html#a21d826fdbe789058ca74e83f4f052c37">devstate_collector</a>.lock);
<a name="l00716"></a>00716    <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(&amp;<a class="code" href="devicestate_8c.html#a21d826fdbe789058ca74e83f4f052c37">devstate_collector</a>.devstate_change_q, sc, entry);
<a name="l00717"></a>00717    <a class="code" href="lock_8h.html#a02a91e30acdea6d13208d23636d37c87">ast_cond_signal</a>(&amp;<a class="code" href="devicestate_8c.html#a21d826fdbe789058ca74e83f4f052c37">devstate_collector</a>.cond);
<a name="l00718"></a>00718    <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="devicestate_8c.html#a21d826fdbe789058ca74e83f4f052c37">devstate_collector</a>.lock);
<a name="l00719"></a>00719 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a87e192ec02bfdad7363a0afd21163d97"></a><!-- doxytag: member="devicestate.c::devstate_event" ref="a87e192ec02bfdad7363a0afd21163d97" args="(const char *device, enum ast_device_state state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void devstate_event </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>device</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a>&nbsp;</td>
          <td class="paramname"> <em>state</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00427">427</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="event__defs_8h_source.html#l00047">AST_EVENT_DEVICE_STATE</a>, <a class="el" href="event__defs_8h_source.html#l00050">AST_EVENT_DEVICE_STATE_CHANGE</a>, <a class="el" href="event__defs_8h_source.html#l00101">AST_EVENT_IE_DEVICE</a>, <a class="el" href="event__defs_8h_source.html#l00058">AST_EVENT_IE_END</a>, <a class="el" href="event__defs_8h_source.html#l00137">AST_EVENT_IE_PLTYPE_STR</a>, <a class="el" href="event__defs_8h_source.html#l00135">AST_EVENT_IE_PLTYPE_UINT</a>, <a class="el" href="event__defs_8h_source.html#l00109">AST_EVENT_IE_STATE</a>, <a class="el" href="event_8c_source.html#l00897">ast_event_new()</a>, <a class="el" href="event_8c_source.html#l01094">ast_event_queue_and_cache()</a>, and <a class="el" href="devicestate_8c.html#a21d826fdbe789058ca74e83f4f052c37">devstate_collector</a>.</p>

<p>Referenced by <a class="el" href="devicestate_8c_source.html#l00465">ast_devstate_changed_literal()</a>, and <a class="el" href="devicestate_8c_source.html#l00454">do_state_change()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00428"></a>00428 {
<a name="l00429"></a>00429    <span class="keyword">struct </span><a class="code" href="structast__event.html" title="An event.">ast_event</a> *event;
<a name="l00430"></a>00430    <span class="keyword">enum</span> <a class="code" href="event__defs_8h.html#a6fa079412d9d9c1cc539f6d71f37f79f" title="Event types.">ast_event_type</a> event_type;
<a name="l00431"></a>00431 
<a name="l00432"></a>00432    <span class="keywordflow">if</span> (<a class="code" href="devicestate_8c.html#a21d826fdbe789058ca74e83f4f052c37">devstate_collector</a>.enabled) {
<a name="l00433"></a>00433       <span class="comment">/* Distributed device state is enabled, so this state change is a change</span>
<a name="l00434"></a>00434 <span class="comment">       * for a single server, not the real state. */</span>
<a name="l00435"></a>00435       event_type = <a class="code" href="event__defs_8h.html#a6fa079412d9d9c1cc539f6d71f37f79fa641bc805cee9b8829fa265e566df9d58">AST_EVENT_DEVICE_STATE_CHANGE</a>;
<a name="l00436"></a>00436    } <span class="keywordflow">else</span> {
<a name="l00437"></a>00437       event_type = <a class="code" href="event__defs_8h.html#a6fa079412d9d9c1cc539f6d71f37f79fa8900374a138e7dbbc9da893f27923846">AST_EVENT_DEVICE_STATE</a>;
<a name="l00438"></a>00438    }
<a name="l00439"></a>00439 
<a name="l00440"></a>00440    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(3, <span class="stringliteral">&quot;device &apos;%s&apos; state &apos;%d&apos;\n&quot;</span>, device, <a class="code" href="structstate.html">state</a>);
<a name="l00441"></a>00441 
<a name="l00442"></a>00442    <span class="keywordflow">if</span> (!(event = <a class="code" href="event_8h.html#afb4a2a00de28bb0733037060da8c4bac" title="Create a new event.">ast_event_new</a>(event_type,
<a name="l00443"></a>00443          <a class="code" href="event__defs_8h.html#a003673523d7fe265c6738a5a9e49c491a675632af9f21fe7696772885593140e3" title="Device Name Used by AST_EVENT_DEVICE_STATE_CHANGE Payload type: STR.">AST_EVENT_IE_DEVICE</a>, <a class="code" href="event__defs_8h.html#a73dadfa1128d5e75107536e132e758c6ab82ac16f0791be2f8f918429a73430be">AST_EVENT_IE_PLTYPE_STR</a>, device,
<a name="l00444"></a>00444          <a class="code" href="event__defs_8h.html#a003673523d7fe265c6738a5a9e49c491a17f475640d923666e2c755e4985b61f8" title="Generic State IE Used by AST_EVENT_DEVICE_STATE_CHANGE Payload type: UINT The actual...">AST_EVENT_IE_STATE</a>, <a class="code" href="event__defs_8h.html#a73dadfa1128d5e75107536e132e758c6a4647cbfacd475cb5067f9f9906107641">AST_EVENT_IE_PLTYPE_UINT</a>, <a class="code" href="structstate.html">state</a>,
<a name="l00445"></a>00445          <a class="code" href="event__defs_8h.html#a003673523d7fe265c6738a5a9e49c491a04c78c1362e97d548344c354001c151f">AST_EVENT_IE_END</a>))) {
<a name="l00446"></a>00446       <span class="keywordflow">return</span>;
<a name="l00447"></a>00447    }
<a name="l00448"></a>00448 
<a name="l00449"></a>00449    <a class="code" href="event_8h.html#a5ef4e1053ab8a91ebdcf4dd6ad1c81c4" title="Queue and cache an event.">ast_event_queue_and_cache</a>(event);
<a name="l00450"></a>00450 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad9f83f8d47fb83b4ccff95cb88f43d2b"></a><!-- doxytag: member="devicestate.c::do_devstate_changes" ref="ad9f83f8d47fb83b4ccff95cb88f43d2b" args="(void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void* do_devstate_changes </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Go through the dev <a class="el" href="structstate.html">state</a> change queue and update changes in the dev <a class="el" href="structstate.html">state</a> thread. </p>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00533">533</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l01749">ast_cond_wait()</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="linkedlists_8h_source.html#l00449">AST_LIST_EMPTY</a>, <a class="el" href="linkedlists_8h_source.html#l00420">AST_LIST_FIRST</a>, <a class="el" href="linkedlists_8h_source.html#l00665">AST_LIST_HEAD_INIT_NOLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00039">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00438">AST_LIST_NEXT</a>, <a class="el" href="linkedlists_8h_source.html#l00139">AST_LIST_UNLOCK</a>, <a class="el" href="devicestate_8c_source.html#l00173">state_change::device</a>, <a class="el" href="devicestate_8c_source.html#l00454">do_state_change()</a>, and <a class="el" href="devicestate_8c_source.html#l00165">devstate_prov::next</a>.</p>

<p>Referenced by <a class="el" href="devicestate_8c_source.html#l00722">ast_device_state_engine_init()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00534"></a>00534 {
<a name="l00535"></a>00535    <span class="keyword">struct </span><a class="code" href="structstate__change.html">state_change</a> *<a class="code" href="structstate__change.html#aa8bbe16f456f8afd0bbed2c8b4f75715">next</a>, *current;
<a name="l00536"></a>00536 
<a name="l00537"></a>00537    <span class="keywordflow">for</span> (;;) {
<a name="l00538"></a>00538       <span class="comment">/* This basically pops off any state change entries, resets the list back to NULL, unlocks, and processes each state change */</span>
<a name="l00539"></a>00539       <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;<a class="code" href="structstate__changes.html" title="The state change queue. State changes are queued for processing by a separate thread...">state_changes</a>);
<a name="l00540"></a>00540       <span class="keywordflow">if</span> (<a class="code" href="linkedlists_8h.html#a4a1884cde93e53bef32ca85c194a1d05" title="Checks whether the specified list contains any entries.">AST_LIST_EMPTY</a>(&amp;<a class="code" href="structstate__changes.html" title="The state change queue. State changes are queued for processing by a separate thread...">state_changes</a>))
<a name="l00541"></a>00541          <a class="code" href="lock_8h.html#ae454b1ebfb5f5e9948876d470865d9dc">ast_cond_wait</a>(&amp;<a class="code" href="devicestate_8c.html#aa33e22b03fb6e00eb7f27a34f0e630f1" title="Flag for the queue.">change_pending</a>, &amp;<a class="code" href="structstate__changes.html" title="The state change queue. State changes are queued for processing by a separate thread...">state_changes</a>.lock);
<a name="l00542"></a>00542       next = <a class="code" href="linkedlists_8h.html#adf1959c5c03a3a706da97ad2f49617e5" title="Returns the first entry contained in a list.">AST_LIST_FIRST</a>(&amp;<a class="code" href="structstate__changes.html" title="The state change queue. State changes are queued for processing by a separate thread...">state_changes</a>);
<a name="l00543"></a>00543       <a class="code" href="linkedlists_8h.html#a0d1f922e093ac18824a7863fe3f5fa27" title="Initializes a list head structure.">AST_LIST_HEAD_INIT_NOLOCK</a>(&amp;<a class="code" href="structstate__changes.html" title="The state change queue. State changes are queued for processing by a separate thread...">state_changes</a>);
<a name="l00544"></a>00544       <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="structstate__changes.html" title="The state change queue. State changes are queued for processing by a separate thread...">state_changes</a>);
<a name="l00545"></a>00545 
<a name="l00546"></a>00546       <span class="comment">/* Process each state change */</span>
<a name="l00547"></a>00547       <span class="keywordflow">while</span> ((current = next)) {
<a name="l00548"></a>00548          next = <a class="code" href="linkedlists_8h.html#ae234825bcb65b88c0554b995ff1b8ba6" title="Returns the next entry in the list after the given entry.">AST_LIST_NEXT</a>(current, <a class="code" href="structstate__change.html#a443ba7b3c87e8b2c97bb8d454329b925">list</a>);
<a name="l00549"></a>00549          <a class="code" href="devicestate_8c.html#accc5f57962e9a0e3bbf8d7c2046525f7">do_state_change</a>(current-&gt;<a class="code" href="structstate__change.html#ad4a4f6bb9638907e0d14b2d8b05c86a0">device</a>);
<a name="l00550"></a>00550          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(current);
<a name="l00551"></a>00551       }
<a name="l00552"></a>00552    }
<a name="l00553"></a>00553 
<a name="l00554"></a>00554    <span class="keywordflow">return</span> NULL;
<a name="l00555"></a>00555 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="accc5f57962e9a0e3bbf8d7c2046525f7"></a><!-- doxytag: member="devicestate.c::do_state_change" ref="accc5f57962e9a0e3bbf8d7c2046525f7" args="(const char *device)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void do_state_change </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>device</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Called by the <a class="el" href="structstate.html">state</a> change thread to find out what the <a class="el" href="structstate.html">state</a> is, and then to queue up the <a class="el" href="structstate.html">state</a> change event </p>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00454">454</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="devicestate_8c_source.html#l00308">_ast_device_state()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="devicestate_8c_source.html#l00209">ast_devstate2str()</a>, and <a class="el" href="devicestate_8c_source.html#l00427">devstate_event()</a>.</p>

<p>Referenced by <a class="el" href="devicestate_8c_source.html#l00465">ast_devstate_changed_literal()</a>, and <a class="el" href="devicestate_8c_source.html#l00533">do_devstate_changes()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00455"></a>00455 {
<a name="l00456"></a>00456    <span class="keyword">enum</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee" title="Device States.">ast_device_state</a> <a class="code" href="structstate.html">state</a>;
<a name="l00457"></a>00457 
<a name="l00458"></a>00458    state = <a class="code" href="devicestate_8c.html#ad30dfe7cd43ef4cd64feed84656a856c" title="Check device state through channel specific function or generic function.">_ast_device_state</a>(<a class="code" href="structstate__change.html#ad4a4f6bb9638907e0d14b2d8b05c86a0">device</a>, 0);
<a name="l00459"></a>00459 
<a name="l00460"></a>00460    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(3, <span class="stringliteral">&quot;Changing state for %s - state %d (%s)\n&quot;</span>, <a class="code" href="structstate__change.html#ad4a4f6bb9638907e0d14b2d8b05c86a0">device</a>, state, <a class="code" href="devicestate_8h.html#ac3a57910a6eb04d12d793fe3df796b8e" title="Find devicestate as text message for output.">ast_devstate2str</a>(state));
<a name="l00461"></a>00461 
<a name="l00462"></a>00462    <a class="code" href="devicestate_8c.html#a87e192ec02bfdad7363a0afd21163d97">devstate_event</a>(<a class="code" href="structstate__change.html#ad4a4f6bb9638907e0d14b2d8b05c86a0">device</a>, state);
<a name="l00463"></a>00463 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a7fbd14a6df5d1578371e19c4bb3de563"></a><!-- doxytag: member="devicestate.c::getproviderstate" ref="a7fbd14a6df5d1578371e19c4bb3de563" args="(const char *provider, const char *address)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static int getproviderstate </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>provider</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>address</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get provider device <a class="el" href="structstate.html">state</a>. </p>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00408">408</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="devicestate_8h_source.html#l00056">AST_DEVICE_INVALID</a>, <a class="el" href="linkedlists_8h_source.html#l00077">AST_RWLIST_RDLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00493">AST_RWLIST_TRAVERSE</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="devicestate_8c_source.html#l00164">devstate_prov::callback</a>, and <a class="el" href="devicestate_8c_source.html#l00163">devstate_prov::label</a>.</p>

<p>Referenced by <a class="el" href="devicestate_8c_source.html#l00308">_ast_device_state()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00409"></a>00409 {
<a name="l00410"></a>00410    <span class="keyword">struct </span><a class="code" href="structdevstate__prov.html" title="A device state provider (not a channel).">devstate_prov</a> *devprov;
<a name="l00411"></a>00411    <span class="keywordtype">int</span> res = <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea9c008e1d20858cbc3275c157e02ebc94">AST_DEVICE_INVALID</a>;
<a name="l00412"></a>00412 
<a name="l00413"></a>00413    <a class="code" href="linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc" title="Read locks a list.">AST_RWLIST_RDLOCK</a>(&amp;<a class="code" href="structdevstate__provs.html" title="A list of providers.">devstate_provs</a>);
<a name="l00414"></a>00414    <a class="code" href="linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;<a class="code" href="structdevstate__provs.html" title="A list of providers.">devstate_provs</a>, devprov, <a class="code" href="structdevstate__prov.html#a6c499d1fde36b0bee0c362bd431a2108">list</a>) {
<a name="l00415"></a>00415       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(5, <span class="stringliteral">&quot;Checking provider %s with %s\n&quot;</span>, devprov-&gt;<a class="code" href="structdevstate__prov.html#a48e23fa2154347c433b24e799187ee4f">label</a>, provider);
<a name="l00416"></a>00416 
<a name="l00417"></a>00417       <span class="keywordflow">if</span> (!strcasecmp(devprov-&gt;<a class="code" href="structdevstate__prov.html#a48e23fa2154347c433b24e799187ee4f">label</a>, provider)) {
<a name="l00418"></a>00418          res = devprov-&gt;<a class="code" href="structdevstate__prov.html#a255429574a13fcf8e3deacdc16211d00">callback</a>(address);
<a name="l00419"></a>00419          <span class="keywordflow">break</span>;
<a name="l00420"></a>00420       }
<a name="l00421"></a>00421    }
<a name="l00422"></a>00422    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structdevstate__provs.html" title="A list of providers.">devstate_provs</a>);
<a name="l00423"></a>00423 
<a name="l00424"></a>00424    <span class="keywordflow">return</span> res;
<a name="l00425"></a>00425 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1d87ddbf9d7aa9d6aaf93690de3faa5d"></a><!-- doxytag: member="devicestate.c::handle_devstate_change" ref="a1d87ddbf9d7aa9d6aaf93690de3faa5d" args="(struct devstate_change *sc)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void handle_devstate_change </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structdevstate__change.html">devstate_change</a> *&nbsp;</td>
          <td class="paramname"> <em>sc</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00646">646</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="event__defs_8h_source.html#l00050">AST_EVENT_DEVICE_STATE_CHANGE</a>, <a class="el" href="event_8c_source.html#l00466">ast_event_dump_cache()</a>, <a class="el" href="event__defs_8h_source.html#l00101">AST_EVENT_IE_DEVICE</a>, <a class="el" href="event_8c_source.html#l00607">ast_event_sub_append_ie_str()</a>, <a class="el" href="event_8c_source.html#l00733">ast_event_sub_destroy()</a>, <a class="el" href="event_8c_source.html#l00547">ast_event_subscribe_new()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="devicestate_8c_source.html#l00190">devstate_change::device</a>, <a class="el" href="devicestate_8c_source.html#l00568">devstate_cache_cb()</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="devicestate_8c_source.html#l00565">change_collection::num_states</a>, and <a class="el" href="devicestate_8c_source.html#l00593">process_collection()</a>.</p>

<p>Referenced by <a class="el" href="devicestate_8c_source.html#l00674">run_devstate_collector()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00647"></a>00647 {
<a name="l00648"></a>00648    <span class="keyword">struct </span><a class="code" href="structast__event__sub.html" title="Event subscription.">ast_event_sub</a> *tmp_sub;
<a name="l00649"></a>00649    <span class="keyword">struct </span><a class="code" href="structchange__collection.html">change_collection</a> collection = {
<a name="l00650"></a>00650       .num_states = 0,
<a name="l00651"></a>00651    };
<a name="l00652"></a>00652 
<a name="l00653"></a>00653    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Processing device state change for &apos;%s&apos;\n&quot;</span>, sc-&gt;<a class="code" href="structdevstate__change.html#ad4a4f6bb9638907e0d14b2d8b05c86a0">device</a>);
<a name="l00654"></a>00654 
<a name="l00655"></a>00655    <span class="keywordflow">if</span> (!(tmp_sub = <a class="code" href="event_8h.html#abbf3a2d3f2ccc44cd6a8864e5b95600c" title="Allocate a subscription, but do not activate it.">ast_event_subscribe_new</a>(<a class="code" href="event__defs_8h.html#a6fa079412d9d9c1cc539f6d71f37f79fa641bc805cee9b8829fa265e566df9d58">AST_EVENT_DEVICE_STATE_CHANGE</a>, <a class="code" href="devicestate_8c.html#ab22d051f46950c0eb53bbafd489357ec">devstate_cache_cb</a>, &amp;collection))) {
<a name="l00656"></a>00656       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to create subscription\n&quot;</span>);
<a name="l00657"></a>00657       <span class="keywordflow">return</span>;
<a name="l00658"></a>00658    }
<a name="l00659"></a>00659 
<a name="l00660"></a>00660    <span class="keywordflow">if</span> (<a class="code" href="event_8h.html#a5f74d5a16df9f79c01741ebd6c00988c" title="Append a string parameter to a subscription.">ast_event_sub_append_ie_str</a>(tmp_sub, <a class="code" href="event__defs_8h.html#a003673523d7fe265c6738a5a9e49c491a675632af9f21fe7696772885593140e3" title="Device Name Used by AST_EVENT_DEVICE_STATE_CHANGE Payload type: STR.">AST_EVENT_IE_DEVICE</a>, sc-&gt;<a class="code" href="structdevstate__change.html#ad4a4f6bb9638907e0d14b2d8b05c86a0">device</a>)) {
<a name="l00661"></a>00661       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to append device IE\n&quot;</span>);
<a name="l00662"></a>00662       <a class="code" href="event_8h.html#a46f2b4218be0062cf49cfcf7b0b810f3" title="Destroy an allocated subscription.">ast_event_sub_destroy</a>(tmp_sub);
<a name="l00663"></a>00663       <span class="keywordflow">return</span>;
<a name="l00664"></a>00664    }
<a name="l00665"></a>00665 
<a name="l00666"></a>00666    <span class="comment">/* Populate the collection of device states from the cache */</span>
<a name="l00667"></a>00667    <a class="code" href="event_8h.html#a5bf46b1495a96ddf1de399a324795ddc" title="Dump the event cache for the subscriber.">ast_event_dump_cache</a>(tmp_sub);
<a name="l00668"></a>00668 
<a name="l00669"></a>00669    <a class="code" href="devicestate_8c.html#a80b936b6f745e6913eb31c063aa851c5">process_collection</a>(sc-&gt;<a class="code" href="structdevstate__change.html#ad4a4f6bb9638907e0d14b2d8b05c86a0">device</a>, &amp;collection);
<a name="l00670"></a>00670 
<a name="l00671"></a>00671    <a class="code" href="event_8h.html#a46f2b4218be0062cf49cfcf7b0b810f3" title="Destroy an allocated subscription.">ast_event_sub_destroy</a>(tmp_sub);
<a name="l00672"></a>00672 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a80b936b6f745e6913eb31c063aa851c5"></a><!-- doxytag: member="devicestate.c::process_collection" ref="a80b936b6f745e6913eb31c063aa851c5" args="(const char *device, struct change_collection *collection)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void process_collection </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>device</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structchange__collection.html">change_collection</a> *&nbsp;</td>
          <td class="paramname"> <em>collection</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00593">593</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="devicestate_8c_source.html#l00209">ast_devstate2str()</a>, <a class="el" href="devicestate_8c_source.html#l00743">ast_devstate_aggregate_add()</a>, <a class="el" href="devicestate_8c_source.html#l00733">ast_devstate_aggregate_init()</a>, <a class="el" href="devicestate_8c_source.html#l00799">ast_devstate_aggregate_result()</a>, <a class="el" href="event_8c_source.html#l00963">ast_event_destroy()</a>, <a class="el" href="event__defs_8h_source.html#l00047">AST_EVENT_DEVICE_STATE</a>, <a class="el" href="event_8c_source.html#l00991">ast_event_get_cached()</a>, <a class="el" href="event_8c_source.html#l00812">ast_event_get_ie_uint()</a>, <a class="el" href="event__defs_8h_source.html#l00101">AST_EVENT_IE_DEVICE</a>, <a class="el" href="event__defs_8h_source.html#l00058">AST_EVENT_IE_END</a>, <a class="el" href="event__defs_8h_source.html#l00137">AST_EVENT_IE_PLTYPE_STR</a>, <a class="el" href="event__defs_8h_source.html#l00135">AST_EVENT_IE_PLTYPE_UINT</a>, <a class="el" href="event__defs_8h_source.html#l00109">AST_EVENT_IE_STATE</a>, <a class="el" href="event_8c_source.html#l00897">ast_event_new()</a>, <a class="el" href="event_8c_source.html#l01094">ast_event_queue_and_cache()</a>, <a class="el" href="devicestate_8c_source.html#l00565">change_collection::num_states</a>, <a class="el" href="devicestate_8c_source.html#l00188">devstate_change::state</a>, and <a class="el" href="devicestate_8c_source.html#l00564">change_collection::states</a>.</p>

<p>Referenced by <a class="el" href="devicestate_8c_source.html#l00646">handle_devstate_change()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00594"></a>00594 {
<a name="l00595"></a>00595    <span class="keywordtype">int</span> i;
<a name="l00596"></a>00596    <span class="keyword">struct </span><a class="code" href="structast__devstate__aggregate.html" title="You shouldn&amp;#39;t care about the contents of this struct.">ast_devstate_aggregate</a> agg;
<a name="l00597"></a>00597    <span class="keyword">enum</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee" title="Device States.">ast_device_state</a> <a class="code" href="structstate.html">state</a>;
<a name="l00598"></a>00598    <span class="keyword">struct </span><a class="code" href="structast__event.html" title="An event.">ast_event</a> *event;
<a name="l00599"></a>00599 
<a name="l00600"></a>00600    <a class="code" href="devicestate_8h.html#a65ebe8f28497b09769ab9edeb4eb9b86" title="Initialize aggregate device state.">ast_devstate_aggregate_init</a>(&amp;agg);
<a name="l00601"></a>00601 
<a name="l00602"></a>00602    <span class="keywordflow">for</span> (i = 0; i &lt; collection-&gt;<a class="code" href="structchange__collection.html#a5e034d2106494002b7f00bf09e9e6982">num_states</a>; i++) {
<a name="l00603"></a>00603       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Adding per-server state of &apos;%s&apos; for &apos;%s&apos;\n&quot;</span>, 
<a name="l00604"></a>00604          <a class="code" href="devicestate_8h.html#ac3a57910a6eb04d12d793fe3df796b8e" title="Find devicestate as text message for output.">ast_devstate2str</a>(collection-&gt;<a class="code" href="structchange__collection.html#a3e7c6ab9bc81f5914ac435c09412615f">states</a>[i].<a class="code" href="structdevstate__change.html#a1b0c7bd4d79798ef4e0ce23894c9aeb2">state</a>), device);
<a name="l00605"></a>00605       <a class="code" href="devicestate_8h.html#a45534707838d05125f409430b371854a" title="Add a device state to the aggregate device state.">ast_devstate_aggregate_add</a>(&amp;agg, collection-&gt;<a class="code" href="structchange__collection.html#a3e7c6ab9bc81f5914ac435c09412615f">states</a>[i].<a class="code" href="structdevstate__change.html#a1b0c7bd4d79798ef4e0ce23894c9aeb2">state</a>);
<a name="l00606"></a>00606    }
<a name="l00607"></a>00607 
<a name="l00608"></a>00608    state = <a class="code" href="devicestate_8h.html#a852d7e936d4385c3bb903812de5d6403" title="Get the aggregate device state result.">ast_devstate_aggregate_result</a>(&amp;agg);
<a name="l00609"></a>00609 
<a name="l00610"></a>00610    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Aggregate devstate result is %d\n&quot;</span>, state);
<a name="l00611"></a>00611 
<a name="l00612"></a>00612    <span class="keyword">event</span> = <a class="code" href="event_8h.html#a419385710c135873656b047df8f72e7e" title="Retrieve an event from the cache.">ast_event_get_cached</a>(<a class="code" href="event__defs_8h.html#a6fa079412d9d9c1cc539f6d71f37f79fa8900374a138e7dbbc9da893f27923846">AST_EVENT_DEVICE_STATE</a>,
<a name="l00613"></a>00613       <a class="code" href="event__defs_8h.html#a003673523d7fe265c6738a5a9e49c491a675632af9f21fe7696772885593140e3" title="Device Name Used by AST_EVENT_DEVICE_STATE_CHANGE Payload type: STR.">AST_EVENT_IE_DEVICE</a>, <a class="code" href="event__defs_8h.html#a73dadfa1128d5e75107536e132e758c6ab82ac16f0791be2f8f918429a73430be">AST_EVENT_IE_PLTYPE_STR</a>, device,
<a name="l00614"></a>00614       <a class="code" href="event__defs_8h.html#a003673523d7fe265c6738a5a9e49c491a04c78c1362e97d548344c354001c151f">AST_EVENT_IE_END</a>);
<a name="l00615"></a>00615    
<a name="l00616"></a>00616    <span class="keywordflow">if</span> (event) {
<a name="l00617"></a>00617       <span class="keyword">enum</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee" title="Device States.">ast_device_state</a> old_state;
<a name="l00618"></a>00618 
<a name="l00619"></a>00619       old_state = <a class="code" href="event_8h.html#a317f6947b933acd0da82df6e9a4672e5" title="Get the value of an information element that has an integer payload.">ast_event_get_ie_uint</a>(event, <a class="code" href="event__defs_8h.html#a003673523d7fe265c6738a5a9e49c491a17f475640d923666e2c755e4985b61f8" title="Generic State IE Used by AST_EVENT_DEVICE_STATE_CHANGE Payload type: UINT The actual...">AST_EVENT_IE_STATE</a>);
<a name="l00620"></a>00620       
<a name="l00621"></a>00621       <a class="code" href="event_8h.html#a50b34e0161630dbbc0880a06eb78ad7a" title="Destroy an event.">ast_event_destroy</a>(event);
<a name="l00622"></a>00622 
<a name="l00623"></a>00623       <span class="keywordflow">if</span> (state == old_state) {
<a name="l00624"></a>00624          <span class="comment">/* No change since last reported device state */</span>
<a name="l00625"></a>00625          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Aggregate state for device &apos;%s&apos; has not changed from &apos;%s&apos;\n&quot;</span>,
<a name="l00626"></a>00626             device, <a class="code" href="devicestate_8h.html#ac3a57910a6eb04d12d793fe3df796b8e" title="Find devicestate as text message for output.">ast_devstate2str</a>(state));
<a name="l00627"></a>00627          <span class="keywordflow">return</span>;
<a name="l00628"></a>00628       }
<a name="l00629"></a>00629    }
<a name="l00630"></a>00630 
<a name="l00631"></a>00631    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;Aggregate state for device &apos;%s&apos; has changed to &apos;%s&apos;\n&quot;</span>,
<a name="l00632"></a>00632       device, <a class="code" href="devicestate_8h.html#ac3a57910a6eb04d12d793fe3df796b8e" title="Find devicestate as text message for output.">ast_devstate2str</a>(state));
<a name="l00633"></a>00633 
<a name="l00634"></a>00634    <span class="keyword">event</span> = <a class="code" href="event_8h.html#afb4a2a00de28bb0733037060da8c4bac" title="Create a new event.">ast_event_new</a>(<a class="code" href="event__defs_8h.html#a6fa079412d9d9c1cc539f6d71f37f79fa8900374a138e7dbbc9da893f27923846">AST_EVENT_DEVICE_STATE</a>,
<a name="l00635"></a>00635       <a class="code" href="event__defs_8h.html#a003673523d7fe265c6738a5a9e49c491a675632af9f21fe7696772885593140e3" title="Device Name Used by AST_EVENT_DEVICE_STATE_CHANGE Payload type: STR.">AST_EVENT_IE_DEVICE</a>, <a class="code" href="event__defs_8h.html#a73dadfa1128d5e75107536e132e758c6ab82ac16f0791be2f8f918429a73430be">AST_EVENT_IE_PLTYPE_STR</a>, device,
<a name="l00636"></a>00636       <a class="code" href="event__defs_8h.html#a003673523d7fe265c6738a5a9e49c491a17f475640d923666e2c755e4985b61f8" title="Generic State IE Used by AST_EVENT_DEVICE_STATE_CHANGE Payload type: UINT The actual...">AST_EVENT_IE_STATE</a>, <a class="code" href="event__defs_8h.html#a73dadfa1128d5e75107536e132e758c6a4647cbfacd475cb5067f9f9906107641">AST_EVENT_IE_PLTYPE_UINT</a>, state,
<a name="l00637"></a>00637       <a class="code" href="event__defs_8h.html#a003673523d7fe265c6738a5a9e49c491a04c78c1362e97d548344c354001c151f">AST_EVENT_IE_END</a>);
<a name="l00638"></a>00638 
<a name="l00639"></a>00639    <span class="keywordflow">if</span> (!event) {
<a name="l00640"></a>00640       <span class="keywordflow">return</span>;
<a name="l00641"></a>00641    }
<a name="l00642"></a>00642 
<a name="l00643"></a>00643    <a class="code" href="event_8h.html#a5ef4e1053ab8a91ebdcf4dd6ad1c81c4" title="Queue and cache an event.">ast_event_queue_and_cache</a>(event);
<a name="l00644"></a>00644 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aba2b4557d1f67626534da2a47d3ad39e"></a><!-- doxytag: member="devicestate.c::run_devstate_collector" ref="aba2b4557d1f67626534da2a47d3ad39e" args="(void *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void* run_devstate_collector </td>
          <td>(</td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>data</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00674">674</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l01749">ast_cond_wait()</a>, <a class="el" href="linkedlists_8h_source.html#l00817">AST_LIST_REMOVE_HEAD</a>, <a class="el" href="lock_8h_source.html#l01717">ast_mutex_lock()</a>, <a class="el" href="lock_8h_source.html#l01707">ast_mutex_unlock()</a>, <a class="el" href="devicestate_8c_source.html#l00557">destroy_devstate_change()</a>, <a class="el" href="devicestate_8c.html#a21d826fdbe789058ca74e83f4f052c37">devstate_collector</a>, and <a class="el" href="devicestate_8c_source.html#l00646">handle_devstate_change()</a>.</p>

<p>Referenced by <a class="el" href="devicestate_8c_source.html#l00823">ast_enable_distributed_devstate()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00675"></a>00675 {
<a name="l00676"></a>00676    <span class="keywordflow">for</span> (;;) {
<a name="l00677"></a>00677       <span class="keyword">struct </span><a class="code" href="structdevstate__change.html">devstate_change</a> *sc;
<a name="l00678"></a>00678 
<a name="l00679"></a>00679       <a class="code" href="lock_8h.html#ad941566de4050aa7358493af94d2ba4d">ast_mutex_lock</a>(&amp;<a class="code" href="devicestate_8c.html#a21d826fdbe789058ca74e83f4f052c37">devstate_collector</a>.lock);
<a name="l00680"></a>00680       <span class="keywordflow">while</span> (!(sc = <a class="code" href="linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989" title="Removes and returns the head entry from a list.">AST_LIST_REMOVE_HEAD</a>(&amp;<a class="code" href="devicestate_8c.html#a21d826fdbe789058ca74e83f4f052c37">devstate_collector</a>.devstate_change_q, <a class="code" href="structdevstate__change.html#a5606b730361b9c6ec4e58a6b4b89e02f">entry</a>)))
<a name="l00681"></a>00681          <a class="code" href="lock_8h.html#ae454b1ebfb5f5e9948876d470865d9dc">ast_cond_wait</a>(&amp;<a class="code" href="devicestate_8c.html#a21d826fdbe789058ca74e83f4f052c37">devstate_collector</a>.cond, &amp;<a class="code" href="devicestate_8c.html#a21d826fdbe789058ca74e83f4f052c37">devstate_collector</a>.lock);
<a name="l00682"></a>00682       <a class="code" href="lock_8h.html#aa9b39f0e22f44a7e7f587d4252e41a0b">ast_mutex_unlock</a>(&amp;<a class="code" href="devicestate_8c.html#a21d826fdbe789058ca74e83f4f052c37">devstate_collector</a>.lock);
<a name="l00683"></a>00683 
<a name="l00684"></a>00684       <a class="code" href="devicestate_8c.html#a1d87ddbf9d7aa9d6aaf93690de3faa5d">handle_devstate_change</a>(sc);
<a name="l00685"></a>00685 
<a name="l00686"></a>00686       <a class="code" href="devicestate_8c.html#ad157407a4e75e687610159a1676d00db">destroy_devstate_change</a>(sc);
<a name="l00687"></a>00687    }
<a name="l00688"></a>00688 
<a name="l00689"></a>00689    <span class="keywordflow">return</span> NULL;
<a name="l00690"></a>00690 }
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="aa33e22b03fb6e00eb7f27a34f0e630f1"></a><!-- doxytag: member="devicestate.c::change_pending" ref="aa33e22b03fb6e00eb7f27a34f0e630f1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="lock_8h.html#ab134d98cdfe7de0f7a72b377c0765dc7">ast_cond_t</a> <a class="el" href="devicestate_8c.html#aa33e22b03fb6e00eb7f27a34f0e630f1">change_pending</a><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Flag for the queue. </p>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00184">184</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

</div>
</div>
<a class="anchor" id="a767b566dd113e1ee0de1634e07c5618d"></a><!-- doxytag: member="devicestate.c::change_thread" ref="a767b566dd113e1ee0de1634e07c5618d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_t <a class="el" href="devicestate_8c.html#a767b566dd113e1ee0de1634e07c5618d">change_thread</a> = AST_PTHREADT_NULL<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The device <a class="el" href="structstate.html">state</a> change notification thread. </p>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00181">181</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>Referenced by <a class="el" href="devicestate_8c_source.html#l00722">ast_device_state_engine_init()</a>, and <a class="el" href="devicestate_8c_source.html#l00465">ast_devstate_changed_literal()</a>.</p>

</div>
</div>
<a class="anchor" id="a1c7181c39f99ee801943a0d0aa9872b9"></a><!-- doxytag: member="devicestate.c::cond" ref="a1c7181c39f99ee801943a0d0aa9872b9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="lock_8h.html#ab134d98cdfe7de0f7a72b377c0765dc7">ast_cond_t</a> <a class="el" href="res__timing__pthread_8c.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00196">196</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

</div>
</div>
<a class="anchor" id="a9eed9fde4b4fa69c3974af65cee78004"></a><!-- doxytag: member="devicestate.c::devstate_change_q" ref="a9eed9fde4b4fa69c3974af65cee78004" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct { ... }   <a class="el" href="devicestate_8c.html#a9eed9fde4b4fa69c3974af65cee78004">devstate_change_q</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a21d826fdbe789058ca74e83f4f052c37"></a><!-- doxytag: member="devicestate.c::devstate_collector" ref="a21d826fdbe789058ca74e83f4f052c37" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct { ... }   <a class="el" href="devicestate_8c.html#a21d826fdbe789058ca74e83f4f052c37">devstate_collector</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="devicestate_8c_source.html#l00823">ast_enable_distributed_devstate()</a>, <a class="el" href="devicestate_8c_source.html#l00692">devstate_change_collector_cb()</a>, <a class="el" href="devicestate_8c_source.html#l00427">devstate_event()</a>, and <a class="el" href="devicestate_8c_source.html#l00674">run_devstate_collector()</a>.</p>

</div>
</div>
<a class="anchor" id="ac35aab157772024788c572a575a19703"></a><!-- doxytag: member="devicestate.c::devstatestring" ref="ac35aab157772024788c572a575a19703" args="[][2]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="devicestate_8c.html#ac35aab157772024788c572a575a19703">devstatestring</a>[][2]<code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Device <a class="el" href="structstate.html">state</a> strings for printing. </p>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00131">131</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

</div>
</div>
<a class="anchor" id="a63be54a0beac1f5717217e1d9e629c71"></a><!-- doxytag: member="devicestate.c::enabled" ref="a63be54a0beac1f5717217e1d9e629c71" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int <a class="el" href="dnsmgr_8c.html#a03e6cca0c879c0443efb431c30c14f76">enabled</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00199">199</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>Referenced by <a class="el" href="http_8c_source.html#l00848">__ast_http_load()</a>, <a class="el" href="res__odbc_8c_source.html#l00730">load_odbc_config()</a>, and <a class="el" href="app__osplookup_8c_source.html#l00591">osp_check_destination()</a>.</p>

</div>
</div>
<a class="anchor" id="a513dfcfff59f0204dab3a9b22ed3c6c0"></a><!-- doxytag: member="devicestate.c::event_sub" ref="a513dfcfff59f0204dab3a9b22ed3c6c0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__event__sub.html">ast_event_sub</a>* <a class="el" href="devicestate_8c.html#a513dfcfff59f0204dab3a9b22ed3c6c0">event_sub</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00195">195</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>Referenced by <a class="el" href="event_8c_source.html#l00444">dump_cache_cb()</a>.</p>

</div>
</div>
<a class="anchor" id="abd2135e6f8a41bc900933b1985d97165"></a><!-- doxytag: member="devicestate.c::first" ref="abd2135e6f8a41bc900933b1985d97165" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structdevstate__change.html">devstate_change</a>* <a class="el" href="res__smdi_8c.html#af1c80cf45d32519afc2e859f8e5819a1">first</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00198">198</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>Referenced by <a class="el" href="file_8c_source.html#l01354">ast_format_str_reduce()</a>, <a class="el" href="channel_8c_source.html#l05567">ast_print_group()</a>, <a class="el" href="strings_8c_source.html#l00114">ast_str_substitute_variables()</a>, <a class="el" href="xmldoc_8c_source.html#l01318">ast_xmldoc_build_seealso()</a>, <a class="el" href="res__config__sqlite_8c_source.html#l00785">cdr_handler()</a>, <a class="el" href="pval_8c_source.html#l01224">check_goto()</a>, <a class="el" href="pbx_8c_source.html#l06539">context_merge()</a>, <a class="el" href="pval_8c_source.html#l03338">gen_prios()</a>, <a class="el" href="bridging_8c_source.html#l00325">generic_thread_loop()</a>, <a class="el" href="pval_8c_source.html#l01156">get_goto_target()</a>, <a class="el" href="vcodecs_8c_source.html#l00725">h261_encap()</a>, <a class="el" href="vcodecs_8c_source.html#l00571">h263_encap()</a>, <a class="el" href="vcodecs_8c_source.html#l00356">h263p_encap()</a>, <a class="el" href="vcodecs_8c_source.html#l00955">h264_encap()</a>, <a class="el" href="func__strings_8c_source.html#l00331">listfilter()</a>, <a class="el" href="app__jack_8c_source.html#l00169">log_jack_status()</a>, <a class="el" href="isdn__lib_8c_source.html#l04102">misdn_lib_init()</a>, <a class="el" href="vcodecs_8c_source.html#l00867">mpeg4_encap()</a>, <a class="el" href="bridge__multiplexed_8c_source.html#l00200">multiplexed_thread_function()</a>, <a class="el" href="cdr__adaptive__odbc_8c_source.html#l00343">odbc_log()</a>, <a class="el" href="cdr__pgsql_8c_source.html#l00103">pgsql_log()</a>, <a class="el" href="res__config__sqlite_8c_source.html#l01367">realtime_update2_handler()</a>, <a class="el" href="func__realtime_8c_source.html#l00233">realtimefield_read()</a>, <a class="el" href="res__config__curl_8c_source.html#l00278">update2_curl()</a>, <a class="el" href="res__config__pgsql_8c_source.html#l00714">update2_pgsql()</a>, <a class="el" href="res__config__odbc_8c_source.html#l00485">update2_prepare()</a>, <a class="el" href="xmldoc_8c_source.html#l00898">xmldoc_get_syntax_cmd()</a>, and <a class="el" href="xmldoc_8c_source.html#l00851">xmldoc_parse_cmd_enumlist()</a>.</p>

</div>
</div>
<a class="anchor" id="a43a8def62ee15449794285cbbc0f79af"></a><!-- doxytag: member="devicestate.c::last" ref="a43a8def62ee15449794285cbbc0f79af" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structdevstate__change.html">devstate_change</a>* <a class="el" href="res__smdi_8c.html#a9584356f2e9a2d4e36cdadce9c5df4a7">last</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00198">198</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>Referenced by <a class="el" href="astobj2_8c_source.html#l00603">__ao2_callback()</a>, <a class="el" href="pbx__gtkconsole_8c_source.html#l00100">__verboser()</a>, <a class="el" href="pval_8c_source.html#l04207">add_extensions()</a>, <a class="el" href="res__jabber_8c_source.html#l01604">aji_handle_presence()</a>, <a class="el" href="pbx__spool_8c_source.html#l00110">apply_outgoing()</a>, <a class="el" href="config_8c_source.html#l01969">ast_config_engine_deregister()</a>, <a class="el" href="db_8c_source.html#l00535">ast_db_freetree()</a>, <a class="el" href="db_8c_source.html#l00473">ast_db_gettree()</a>, <a class="el" href="res__config__odbc_8c_source.html#l00797">config_odbc()</a>, <a class="el" href="res__config__pgsql_8c_source.html#l01030">config_pgsql()</a>, <a class="el" href="chan__dahdi_8c_source.html#l09496">do_monitor()</a>, <a class="el" href="chan__gtalk_8c_source.html#l01116">gtalk_free_candidates()</a>, <a class="el" href="chan__jingle_8c_source.html#l00916">jingle_free_candidates()</a>, <a class="el" href="pbx__dundi_8c_source.html#l02110">load_password()</a>, <a class="el" href="app__rpt_8c_source.html#l01984">node_lookup()</a>, <a class="el" href="pbx__spool_8c_source.html#l00436">scan_thread()</a>, and <a class="el" href="chan__iax2_8c_source.html#l02853">try_firmware()</a>.</p>

</div>
</div>
<a class="anchor" id="adf04f66344e3fb0a6f6a69bf39d19902"></a><!-- doxytag: member="devicestate.c::lock" ref="adf04f66344e3fb0a6f6a69bf39d19902" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="lock_8h.html#a2d9118a2a8939f115eea771bce3a52f2">ast_mutex_t</a> <a class="el" href="res__timing__pthread_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00197">197</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

</div>
</div>
<a class="anchor" id="a01f75a9ad916f63a94e06a27635ba278"></a><!-- doxytag: member="devicestate.c::thread" ref="a01f75a9ad916f63a94e06a27635ba278" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pthread_t <a class="el" href="res__timing__pthread_8c.html#a01f75a9ad916f63a94e06a27635ba278">thread</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00194">194</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:21:58 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
