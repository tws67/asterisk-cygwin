<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:21:58 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_1ab815038f534adda65c8b4ae4993449.html">include</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_16d825f1fa9ecca2e70b1a8d9256d0e6.html">asterisk</a>
  </div>
</div>
<div class="contents">
<h1>devicestate.h File Reference</h1>
<p>Device <a class="el" href="structstate.html">state</a> management.  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="channel_8h_source.html">asterisk/channel.h</a>&quot;</code><br/>

<p><a href="devicestate_8h_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__devstate__aggregate.html">ast_devstate_aggregate</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">You shouldn't care about the contents of this struct.  <a href="structast__devstate__aggregate.html#_details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a> { <br/>
&nbsp;&nbsp;<a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea41983b6678528bfcdf919b24d6e08d9a">AST_DEVICE_UNKNOWN</a>, 
<a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeadee91fc4886ffc7b4efb8459cef48fe2">AST_DEVICE_NOT_INUSE</a>, 
<a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea23aa227468c09b5ebd0fb01b4c895190">AST_DEVICE_INUSE</a>, 
<a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeab43afabf5bcd4ad1f531ad78c48ccb6f">AST_DEVICE_BUSY</a>, 
<br/>
&nbsp;&nbsp;<a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea9c008e1d20858cbc3275c157e02ebc94">AST_DEVICE_INVALID</a>, 
<a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeafac147cbabf3ccb80e50e86027710549">AST_DEVICE_UNAVAILABLE</a>, 
<a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea76d91d5d654cfa3edafb2afbe3e09b46">AST_DEVICE_RINGING</a>, 
<a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea17b87dfa3f4de5909b401017e229091d">AST_DEVICE_RINGINUSE</a>, 
<br/>
&nbsp;&nbsp;<a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea6b7416bea92d3bc5ee8e36f0a484cdc1">AST_DEVICE_ONHOLD</a>, 
<a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeaf790c1f212837af8d2db5193228102d7">AST_DEVICE_TOTAL</a>
<br/>
 }</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p>Device States. </p>
 <a href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8h.html#a4691aa279b25aa0cb167a75bc4caa76c">ast_device_state</a> (const char *device)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Asks a channel for device <a class="el" href="structstate.html">state</a>.  <a href="#a4691aa279b25aa0cb167a75bc4caa76c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8h.html#a0d1e5bc5582dc40fc828a8d7f45c8796">ast_device_state_changed</a> (const char *fmt,...)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Tells Asterisk the State for Device is changed. (Accept change notification, add it to change queue.).  <a href="#a0d1e5bc5582dc40fc828a8d7f45c8796"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8h.html#a1c5845c2bf63a18da29eec8de9d50d18">ast_device_state_changed_literal</a> (const char *device)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Tells Asterisk the State for Device is changed.  <a href="#a1c5845c2bf63a18da29eec8de9d50d18"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8h.html#ac3a57910a6eb04d12d793fe3df796b8e">ast_devstate2str</a> (enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a> devstate) attribute_pure</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Find devicestate as text <a class="el" href="structmessage.html">message</a> for output.  <a href="#ac3a57910a6eb04d12d793fe3df796b8e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8h.html#a45534707838d05125f409430b371854a">ast_devstate_aggregate_add</a> (struct <a class="el" href="structast__devstate__aggregate.html">ast_devstate_aggregate</a> *agg, enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a> <a class="el" href="structstate.html">state</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add a device <a class="el" href="structstate.html">state</a> to the aggregate device <a class="el" href="structstate.html">state</a>.  <a href="#a45534707838d05125f409430b371854a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8h.html#a65ebe8f28497b09769ab9edeb4eb9b86">ast_devstate_aggregate_init</a> (struct <a class="el" href="structast__devstate__aggregate.html">ast_devstate_aggregate</a> *agg)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialize aggregate device <a class="el" href="structstate.html">state</a>.  <a href="#a65ebe8f28497b09769ab9edeb4eb9b86"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8h.html#a852d7e936d4385c3bb903812de5d6403">ast_devstate_aggregate_result</a> (struct <a class="el" href="structast__devstate__aggregate.html">ast_devstate_aggregate</a> *agg)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get the aggregate device <a class="el" href="structstate.html">state</a> result.  <a href="#a852d7e936d4385c3bb903812de5d6403"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8h.html#ac91fd8b93a2095c18ab86bd61c19ae46">ast_devstate_changed</a> (enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a> <a class="el" href="structstate.html">state</a>, const char *fmt,...)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Tells Asterisk the State for Device is changed.  <a href="#ac91fd8b93a2095c18ab86bd61c19ae46"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8h.html#a0cc33ebff1ed76c113d17785814b5a47">ast_devstate_changed_literal</a> (enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a> <a class="el" href="structstate.html">state</a>, const char *device)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Tells Asterisk the State for Device is changed.  <a href="#a0cc33ebff1ed76c113d17785814b5a47"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8h.html#ae832fcc32c88962e73025ffeafe2961e">ast_devstate_prov_add</a> (const char *label, <a class="el" href="devicestate_8h.html#a93c7236225b5fd76d197b8e5afba2de5">ast_devstate_prov_cb_type</a> callback)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add device <a class="el" href="structstate.html">state</a> provider.  <a href="#ae832fcc32c88962e73025ffeafe2961e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8h.html#a1ab579ae15aaca64a904c3c41d8b8b01">ast_devstate_prov_del</a> (const char *label)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Remove device <a class="el" href="structstate.html">state</a> provider.  <a href="#a1ab579ae15aaca64a904c3c41d8b8b01"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8h.html#a6190de57ac370315e51f2c46724d5b10">ast_devstate_str</a> (enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a> devstate) attribute_pure</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Convert device <a class="el" href="structstate.html">state</a> to text string that is easier to parse.  <a href="#a6190de57ac370315e51f2c46724d5b10"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8h.html#ae148e0b95218b57b0348ab53f2f82657">ast_devstate_val</a> (const char *<a class="el" href="structval.html">val</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Convert device <a class="el" href="structstate.html">state</a> from text to integer value.  <a href="#ae148e0b95218b57b0348ab53f2f82657"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8h.html#aab3f3dcda2662dc291fc4c17b9a602f4">ast_enable_distributed_devstate</a> (void)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Enable distributed device <a class="el" href="structstate.html">state</a> processing.  <a href="#aab3f3dcda2662dc291fc4c17b9a602f4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8h.html#a9da9a09e65a9332176a523407ccac611">ast_parse_device_state</a> (const char *device)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Search the Channels by Name.  <a href="#a9da9a09e65a9332176a523407ccac611"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8h.html#a8e0c5acc035f43741343b8ed2fcb14ea">ast_state_chan2dev</a> (enum <a class="el" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660">ast_channel_state</a> chanstate)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Convert channel <a class="el" href="structstate.html">state</a> to devicestate.  <a href="#a8e0c5acc035f43741343b8ed2fcb14ea"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8h.html#a753243b1af643942b39a7c7434dd902c">devstate2str</a> (enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a> devstate) attribute_pure</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Convert device <a class="el" href="structstate.html">state</a> to text string for output.  <a href="#a753243b1af643942b39a7c7434dd902c"></a><br/></td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a>(*&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="devicestate_8h.html#a93c7236225b5fd76d197b8e5afba2de5">ast_devstate_prov_cb_type</a> )(const char *data)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Devicestate provider call back.  <a href="#a93c7236225b5fd76d197b8e5afba2de5"></a><br/></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Device <a class="el" href="structstate.html">state</a> management. </p>
<p>To subscribe to device <a class="el" href="structstate.html">state</a> changes, use the generic ast_event_subscribe method. For an example, see <a class="el" href="app__queue_8c.html" title="True call queues with optional send URL on answer.">apps/app_queue.c</a>.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000060">Todo:</a></b></dt><dd>Currently, when the <a class="el" href="structstate.html">state</a> of a device changes, the device <a class="el" href="structstate.html">state</a> provider calls one of the functions defined here to queue an object to say that the <a class="el" href="structstate.html">state</a> of a device has changed. However, this does not include the new <a class="el" href="structstate.html">state</a>. Another thread processes these device <a class="el" href="structstate.html">state</a> change objects and calls the device <a class="el" href="structstate.html">state</a> provider's callback to figure out what the new <a class="el" href="structstate.html">state</a> is. It would make a lot more sense for the new <a class="el" href="structstate.html">state</a> to be included in the original function call that says the <a class="el" href="structstate.html">state</a> of a device has changed. However, it will take a lot of work to change this.</dd></dl>
<ul>
<li>See <a class="el" href="AstExtState.html">Extension and device states in Asterisk</a> </li>
</ul>

<p>Definition in file <a class="el" href="devicestate_8h_source.html">devicestate.h</a>.</p>
<hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="af72f8a5c0601e4c1f8a852749cd44eee"></a><!-- doxytag: member="devicestate.h::ast_device_state" ref="af72f8a5c0601e4c1f8a852749cd44eee" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Device States. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>The order of these states may not change because they are included in Asterisk events which may be transmitted across the network to other servers. </dd></dl>
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="af72f8a5c0601e4c1f8a852749cd44eeea41983b6678528bfcdf919b24d6e08d9a"></a><!-- doxytag: member="AST_DEVICE_UNKNOWN" ref="af72f8a5c0601e4c1f8a852749cd44eeea41983b6678528bfcdf919b24d6e08d9a" args="" -->AST_DEVICE_UNKNOWN</em>&nbsp;</td><td>
<p>Device is valid but channel didn't know <a class="el" href="structstate.html">state</a> </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af72f8a5c0601e4c1f8a852749cd44eeeadee91fc4886ffc7b4efb8459cef48fe2"></a><!-- doxytag: member="AST_DEVICE_NOT_INUSE" ref="af72f8a5c0601e4c1f8a852749cd44eeeadee91fc4886ffc7b4efb8459cef48fe2" args="" -->AST_DEVICE_NOT_INUSE</em>&nbsp;</td><td>
<p>Device is not used </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af72f8a5c0601e4c1f8a852749cd44eeea23aa227468c09b5ebd0fb01b4c895190"></a><!-- doxytag: member="AST_DEVICE_INUSE" ref="af72f8a5c0601e4c1f8a852749cd44eeea23aa227468c09b5ebd0fb01b4c895190" args="" -->AST_DEVICE_INUSE</em>&nbsp;</td><td>
<p>Device is in use </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af72f8a5c0601e4c1f8a852749cd44eeeab43afabf5bcd4ad1f531ad78c48ccb6f"></a><!-- doxytag: member="AST_DEVICE_BUSY" ref="af72f8a5c0601e4c1f8a852749cd44eeeab43afabf5bcd4ad1f531ad78c48ccb6f" args="" -->AST_DEVICE_BUSY</em>&nbsp;</td><td>
<p>Device is busy </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af72f8a5c0601e4c1f8a852749cd44eeea9c008e1d20858cbc3275c157e02ebc94"></a><!-- doxytag: member="AST_DEVICE_INVALID" ref="af72f8a5c0601e4c1f8a852749cd44eeea9c008e1d20858cbc3275c157e02ebc94" args="" -->AST_DEVICE_INVALID</em>&nbsp;</td><td>
<p>Device is invalid </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af72f8a5c0601e4c1f8a852749cd44eeeafac147cbabf3ccb80e50e86027710549"></a><!-- doxytag: member="AST_DEVICE_UNAVAILABLE" ref="af72f8a5c0601e4c1f8a852749cd44eeeafac147cbabf3ccb80e50e86027710549" args="" -->AST_DEVICE_UNAVAILABLE</em>&nbsp;</td><td>
<p>Device is unavailable </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af72f8a5c0601e4c1f8a852749cd44eeea76d91d5d654cfa3edafb2afbe3e09b46"></a><!-- doxytag: member="AST_DEVICE_RINGING" ref="af72f8a5c0601e4c1f8a852749cd44eeea76d91d5d654cfa3edafb2afbe3e09b46" args="" -->AST_DEVICE_RINGING</em>&nbsp;</td><td>
<p>Device is ringing </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af72f8a5c0601e4c1f8a852749cd44eeea17b87dfa3f4de5909b401017e229091d"></a><!-- doxytag: member="AST_DEVICE_RINGINUSE" ref="af72f8a5c0601e4c1f8a852749cd44eeea17b87dfa3f4de5909b401017e229091d" args="" -->AST_DEVICE_RINGINUSE</em>&nbsp;</td><td>
<p>Device is ringing *and* in use </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af72f8a5c0601e4c1f8a852749cd44eeea6b7416bea92d3bc5ee8e36f0a484cdc1"></a><!-- doxytag: member="AST_DEVICE_ONHOLD" ref="af72f8a5c0601e4c1f8a852749cd44eeea6b7416bea92d3bc5ee8e36f0a484cdc1" args="" -->AST_DEVICE_ONHOLD</em>&nbsp;</td><td>
<p>Device is on hold </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af72f8a5c0601e4c1f8a852749cd44eeeaf790c1f212837af8d2db5193228102d7"></a><!-- doxytag: member="AST_DEVICE_TOTAL" ref="af72f8a5c0601e4c1f8a852749cd44eeeaf790c1f212837af8d2db5193228102d7" args="" -->AST_DEVICE_TOTAL</em>&nbsp;</td><td>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="devicestate_8h_source.html#l00051">51</a> of file <a class="el" href="devicestate_8h_source.html">devicestate.h</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00051"></a>00051                       {
<a name="l00052"></a>00052    <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea41983b6678528bfcdf919b24d6e08d9a">AST_DEVICE_UNKNOWN</a>,      <span class="comment">/*!&lt; Device is valid but channel didn&apos;t know state */</span>
<a name="l00053"></a>00053    <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeadee91fc4886ffc7b4efb8459cef48fe2">AST_DEVICE_NOT_INUSE</a>,    <span class="comment">/*!&lt; Device is not used */</span>
<a name="l00054"></a>00054    <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea23aa227468c09b5ebd0fb01b4c895190">AST_DEVICE_INUSE</a>,        <span class="comment">/*!&lt; Device is in use */</span>
<a name="l00055"></a>00055    <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeab43afabf5bcd4ad1f531ad78c48ccb6f">AST_DEVICE_BUSY</a>,         <span class="comment">/*!&lt; Device is busy */</span>
<a name="l00056"></a>00056    <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea9c008e1d20858cbc3275c157e02ebc94">AST_DEVICE_INVALID</a>,      <span class="comment">/*!&lt; Device is invalid */</span>
<a name="l00057"></a>00057    <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeafac147cbabf3ccb80e50e86027710549">AST_DEVICE_UNAVAILABLE</a>,  <span class="comment">/*!&lt; Device is unavailable */</span>
<a name="l00058"></a>00058    <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea76d91d5d654cfa3edafb2afbe3e09b46">AST_DEVICE_RINGING</a>,      <span class="comment">/*!&lt; Device is ringing */</span>
<a name="l00059"></a>00059    <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea17b87dfa3f4de5909b401017e229091d">AST_DEVICE_RINGINUSE</a>,    <span class="comment">/*!&lt; Device is ringing *and* in use */</span>
<a name="l00060"></a>00060    <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea6b7416bea92d3bc5ee8e36f0a484cdc1">AST_DEVICE_ONHOLD</a>,       <span class="comment">/*!&lt; Device is on hold */</span>
<a name="l00061"></a>00061    <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeaf790c1f212837af8d2db5193228102d7">AST_DEVICE_TOTAL</a>,        <span class="comment">/*/ Total num of device states, used for testing */</span>
<a name="l00062"></a>00062 };
</pre></div></p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a4691aa279b25aa0cb167a75bc4caa76c"></a><!-- doxytag: member="devicestate.h::ast_device_state" ref="a4691aa279b25aa0cb167a75bc4caa76c" args="(const char *device)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a> <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a> </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>device</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Asks a channel for device <a class="el" href="structstate.html">state</a>. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>device</em>&nbsp;</td><td>like a dial string</td></tr>
  </table>
  </dd>
</dl>
<p>Asks a channel for device <a class="el" href="structstate.html">state</a>, data is normally a <a class="el" href="structnumber.html" title="Number structure.">number</a> from a dial string used by the low level module Tries the channel device <a class="el" href="structstate.html">state</a> callback if not supported search in the active <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> list for the device.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>an</em>&nbsp;</td><td>AST_DEVICE_??? <a class="el" href="structstate.html">state</a> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00360">360</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="devicestate_8c_source.html#l00308">_ast_device_state()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00361"></a>00361 {
<a name="l00362"></a>00362    <span class="comment">/* This function is called from elsewhere in the code to find out the</span>
<a name="l00363"></a>00363 <span class="comment">    * current state of a device.  Check the cache, first. */</span>
<a name="l00364"></a>00364 
<a name="l00365"></a>00365    <span class="keywordflow">return</span> <a class="code" href="devicestate_8c.html#ad30dfe7cd43ef4cd64feed84656a856c" title="Check device state through channel specific function or generic function.">_ast_device_state</a>(<a class="code" href="structdevstate__change.html#ad4a4f6bb9638907e0d14b2d8b05c86a0">device</a>, 1);
<a name="l00366"></a>00366 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0d1e5bc5582dc40fc828a8d7f45c8796"></a><!-- doxytag: member="devicestate.h::ast_device_state_changed" ref="a0d1e5bc5582dc40fc828a8d7f45c8796" args="(const char *fmt,...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_device_state_changed </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>...</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Tells Asterisk the State for Device is changed. (Accept change notification, add it to change queue.). </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>fmt</em>&nbsp;</td><td>device name like a dial string with format parameters</td></tr>
  </table>
  </dd>
</dl>
<p>Asterisk polls the new <a class="el" href="structextension.html">extension</a> states and calls the registered callbacks for the changed extensions</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure</td></tr>
  </table>
  </dd>
</dl>
<dl class="note"><dt><b>Note:</b></dt><dd>This is deprecated in favor of <a class="el" href="devicestate_8h.html#ac91fd8b93a2095c18ab86bd61c19ae46" title="Tells Asterisk the State for Device is changed.">ast_devstate_changed()</a> </dd></dl>
<dl class="version"><dt><b>Version:</b></dt><dd>1.6.1 deprecated </dd></dl>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00520">520</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="devicestate_8h_source.html#l00052">AST_DEVICE_UNKNOWN</a>, <a class="el" href="devicestate_8c_source.html#l00465">ast_devstate_changed_literal()</a>, <a class="el" href="channel_8h_source.html#l00134">AST_MAX_EXTENSION</a>, and <a class="el" href="adsistub_8c_source.html#l00059">buf</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00521"></a>00521 {
<a name="l00522"></a>00522    <span class="keywordtype">char</span> <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[<a class="code" href="channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a>];
<a name="l00523"></a>00523    va_list ap;
<a name="l00524"></a>00524 
<a name="l00525"></a>00525    va_start(ap, fmt);
<a name="l00526"></a>00526    vsnprintf(buf, <span class="keyword">sizeof</span>(buf), fmt, ap);
<a name="l00527"></a>00527    va_end(ap);
<a name="l00528"></a>00528 
<a name="l00529"></a>00529    <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#a0cc33ebff1ed76c113d17785814b5a47" title="Tells Asterisk the State for Device is changed.">ast_devstate_changed_literal</a>(<a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea41983b6678528bfcdf919b24d6e08d9a">AST_DEVICE_UNKNOWN</a>, buf);
<a name="l00530"></a>00530 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1c5845c2bf63a18da29eec8de9d50d18"></a><!-- doxytag: member="devicestate.h::ast_device_state_changed_literal" ref="a1c5845c2bf63a18da29eec8de9d50d18" args="(const char *device)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_device_state_changed_literal </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>device</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Tells Asterisk the State for Device is changed. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>device</em>&nbsp;</td><td>device name like a dial string</td></tr>
  </table>
  </dd>
</dl>
<p>Asterisk polls the new <a class="el" href="structextension.html">extension</a> states and calls the registered callbacks for the changed extensions</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure</td></tr>
  </table>
  </dd>
</dl>
<dl class="note"><dt><b>Note:</b></dt><dd>This is deprecated in favor of <a class="el" href="devicestate_8h.html#a0cc33ebff1ed76c113d17785814b5a47" title="Tells Asterisk the State for Device is changed.">ast_devstate_changed_literal()</a> </dd></dl>
<dl class="version"><dt><b>Version:</b></dt><dd>1.6.1 deprecated </dd></dl>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00503">503</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="devicestate_8h_source.html#l00052">AST_DEVICE_UNKNOWN</a>, and <a class="el" href="devicestate_8c_source.html#l00465">ast_devstate_changed_literal()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00504"></a>00504 {
<a name="l00505"></a>00505    <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#a0cc33ebff1ed76c113d17785814b5a47" title="Tells Asterisk the State for Device is changed.">ast_devstate_changed_literal</a>(<a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea41983b6678528bfcdf919b24d6e08d9a">AST_DEVICE_UNKNOWN</a>, dev);
<a name="l00506"></a>00506 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac3a57910a6eb04d12d793fe3df796b8e"></a><!-- doxytag: member="devicestate.h::ast_devstate2str" ref="ac3a57910a6eb04d12d793fe3df796b8e" args="(enum ast_device_state devstate) attribute_pure" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* ast_devstate2str </td>
          <td>(</td>
          <td class="paramtype">enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a>&nbsp;</td>
          <td class="paramname"> <em>devstate</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Find devicestate as text <a class="el" href="structmessage.html">message</a> for output. </p>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00209">209</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>Referenced by <a class="el" href="app__queue_8c_source.html#l06083">__queues_show()</a>, <a class="el" href="devicestate_8c_source.html#l00454">do_state_change()</a>, <a class="el" href="app__queue_8c_source.html#l01046">handle_statechange()</a>, <a class="el" href="features_8c_source.html#l00510">notify_metermaids()</a>, <a class="el" href="app__page_8c_source.html#l00121">page_exec()</a>, and <a class="el" href="devicestate_8c_source.html#l00593">process_collection()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00210"></a>00210 {
<a name="l00211"></a>00211    <span class="keywordflow">return</span> <a class="code" href="devicestate_8c.html#ac35aab157772024788c572a575a19703" title="Device state strings for printing.">devstatestring</a>[devstate][0];
<a name="l00212"></a>00212 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a45534707838d05125f409430b371854a"></a><!-- doxytag: member="devicestate.h::ast_devstate_aggregate_add" ref="a45534707838d05125f409430b371854a" args="(struct ast_devstate_aggregate *agg, enum ast_device_state state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_devstate_aggregate_add </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__devstate__aggregate.html">ast_devstate_aggregate</a> *&nbsp;</td>
          <td class="paramname"> <em>agg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a>&nbsp;</td>
          <td class="paramname"> <em>state</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add a device <a class="el" href="structstate.html">state</a> to the aggregate device <a class="el" href="structstate.html">state</a>. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>agg</em>&nbsp;</td><td>the <a class="el" href="structstate.html">state</a> object </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em><a class="el" href="structstate.html">state</a></em>&nbsp;</td><td>the <a class="el" href="structstate.html">state</a> to add</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>nothing </dd></dl>
<dl class="since"><dt><b>Since:</b></dt><dd>1.6.1 </dd></dl>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00743">743</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="devicestate_8h_source.html#l00259">ast_devstate_aggregate::all_busy</a>, <a class="el" href="devicestate_8h_source.html#l00260">ast_devstate_aggregate::all_free</a>, <a class="el" href="devicestate_8h_source.html#l00258">ast_devstate_aggregate::all_unavail</a>, <a class="el" href="devicestate_8h_source.html#l00257">ast_devstate_aggregate::all_unknown</a>, <a class="el" href="devicestate_8h_source.html#l00055">AST_DEVICE_BUSY</a>, <a class="el" href="devicestate_8h_source.html#l00054">AST_DEVICE_INUSE</a>, <a class="el" href="devicestate_8h_source.html#l00056">AST_DEVICE_INVALID</a>, <a class="el" href="devicestate_8h_source.html#l00053">AST_DEVICE_NOT_INUSE</a>, <a class="el" href="devicestate_8h_source.html#l00060">AST_DEVICE_ONHOLD</a>, <a class="el" href="devicestate_8h_source.html#l00058">AST_DEVICE_RINGING</a>, <a class="el" href="devicestate_8h_source.html#l00059">AST_DEVICE_RINGINUSE</a>, <a class="el" href="devicestate_8h_source.html#l00061">AST_DEVICE_TOTAL</a>, <a class="el" href="devicestate_8h_source.html#l00057">AST_DEVICE_UNAVAILABLE</a>, <a class="el" href="devicestate_8h_source.html#l00052">AST_DEVICE_UNKNOWN</a>, <a class="el" href="devicestate_8h_source.html#l00262">ast_devstate_aggregate::busy</a>, <a class="el" href="devicestate_8h_source.html#l00263">ast_devstate_aggregate::in_use</a>, <a class="el" href="devicestate_8h_source.html#l00261">ast_devstate_aggregate::on_hold</a>, and <a class="el" href="devicestate_8h_source.html#l00264">ast_devstate_aggregate::ring</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l03797">ast_extension_state2()</a>, and <a class="el" href="devicestate_8c_source.html#l00593">process_collection()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00744"></a>00744 {
<a name="l00745"></a>00745    <span class="keywordflow">switch</span> (<a class="code" href="structstate.html">state</a>) {
<a name="l00746"></a>00746    <span class="keywordflow">case</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeadee91fc4886ffc7b4efb8459cef48fe2">AST_DEVICE_NOT_INUSE</a>:
<a name="l00747"></a>00747       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a89222ce0f74e56a855e1be89537fdb02">all_unknown</a> = 0;
<a name="l00748"></a>00748       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#aec50b9db1640cefa9c219d63e1b7ade4">all_unavail</a> = 0;
<a name="l00749"></a>00749       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#af7df3d089a03d0acb4e8e18c28d58700">all_busy</a> = 0;
<a name="l00750"></a>00750       <span class="keywordflow">break</span>;
<a name="l00751"></a>00751    <span class="keywordflow">case</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea23aa227468c09b5ebd0fb01b4c895190">AST_DEVICE_INUSE</a>:
<a name="l00752"></a>00752       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#ae90f2e4a448082950b7e1e7a7a508464">in_use</a> = 1;
<a name="l00753"></a>00753       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#aec50b9db1640cefa9c219d63e1b7ade4">all_unavail</a> = 0;
<a name="l00754"></a>00754       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a7dcbb2425e6da769d44603778432db0f">all_free</a> = 0;
<a name="l00755"></a>00755       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a89222ce0f74e56a855e1be89537fdb02">all_unknown</a> = 0;
<a name="l00756"></a>00756       <span class="keywordflow">break</span>;
<a name="l00757"></a>00757    <span class="keywordflow">case</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea76d91d5d654cfa3edafb2afbe3e09b46">AST_DEVICE_RINGING</a>:
<a name="l00758"></a>00758       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a055700e8ae7f31029bebd7a4353cf04b">ring</a> = 1;
<a name="l00759"></a>00759       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#aec50b9db1640cefa9c219d63e1b7ade4">all_unavail</a> = 0;
<a name="l00760"></a>00760       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a7dcbb2425e6da769d44603778432db0f">all_free</a> = 0;
<a name="l00761"></a>00761       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a89222ce0f74e56a855e1be89537fdb02">all_unknown</a> = 0;
<a name="l00762"></a>00762       <span class="keywordflow">break</span>;
<a name="l00763"></a>00763    <span class="keywordflow">case</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea17b87dfa3f4de5909b401017e229091d">AST_DEVICE_RINGINUSE</a>:
<a name="l00764"></a>00764       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#ae90f2e4a448082950b7e1e7a7a508464">in_use</a> = 1;
<a name="l00765"></a>00765       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a055700e8ae7f31029bebd7a4353cf04b">ring</a> = 1;
<a name="l00766"></a>00766       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#aec50b9db1640cefa9c219d63e1b7ade4">all_unavail</a> = 0;
<a name="l00767"></a>00767       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a7dcbb2425e6da769d44603778432db0f">all_free</a> = 0;
<a name="l00768"></a>00768       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a89222ce0f74e56a855e1be89537fdb02">all_unknown</a> = 0;
<a name="l00769"></a>00769       <span class="keywordflow">break</span>;
<a name="l00770"></a>00770    <span class="keywordflow">case</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea6b7416bea92d3bc5ee8e36f0a484cdc1">AST_DEVICE_ONHOLD</a>:
<a name="l00771"></a>00771       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a89222ce0f74e56a855e1be89537fdb02">all_unknown</a> = 0;
<a name="l00772"></a>00772       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#aec50b9db1640cefa9c219d63e1b7ade4">all_unavail</a> = 0;
<a name="l00773"></a>00773       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a7dcbb2425e6da769d44603778432db0f">all_free</a> = 0;
<a name="l00774"></a>00774       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#adbb5ea13ff67a0f65a71edddb0eef433">on_hold</a> = 1;
<a name="l00775"></a>00775       <span class="keywordflow">break</span>;
<a name="l00776"></a>00776    <span class="keywordflow">case</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeab43afabf5bcd4ad1f531ad78c48ccb6f">AST_DEVICE_BUSY</a>:
<a name="l00777"></a>00777       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a89222ce0f74e56a855e1be89537fdb02">all_unknown</a> = 0;
<a name="l00778"></a>00778       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#aec50b9db1640cefa9c219d63e1b7ade4">all_unavail</a> = 0;
<a name="l00779"></a>00779       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a7dcbb2425e6da769d44603778432db0f">all_free</a> = 0;
<a name="l00780"></a>00780       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a062fb7f88f25f3a783a4f30f7174d1dc">busy</a> = 1;
<a name="l00781"></a>00781       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#ae90f2e4a448082950b7e1e7a7a508464">in_use</a> = 1;
<a name="l00782"></a>00782       <span class="keywordflow">break</span>;
<a name="l00783"></a>00783    <span class="keywordflow">case</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeafac147cbabf3ccb80e50e86027710549">AST_DEVICE_UNAVAILABLE</a>:
<a name="l00784"></a>00784       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a89222ce0f74e56a855e1be89537fdb02">all_unknown</a> = 0;
<a name="l00785"></a>00785    <span class="keywordflow">case</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea9c008e1d20858cbc3275c157e02ebc94">AST_DEVICE_INVALID</a>:
<a name="l00786"></a>00786       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#af7df3d089a03d0acb4e8e18c28d58700">all_busy</a> = 0;
<a name="l00787"></a>00787       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a7dcbb2425e6da769d44603778432db0f">all_free</a> = 0;
<a name="l00788"></a>00788       <span class="keywordflow">break</span>;
<a name="l00789"></a>00789    <span class="keywordflow">case</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea41983b6678528bfcdf919b24d6e08d9a">AST_DEVICE_UNKNOWN</a>:
<a name="l00790"></a>00790       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#af7df3d089a03d0acb4e8e18c28d58700">all_busy</a> = 0;
<a name="l00791"></a>00791       agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a7dcbb2425e6da769d44603778432db0f">all_free</a> = 0;
<a name="l00792"></a>00792       <span class="keywordflow">break</span>;
<a name="l00793"></a>00793    <span class="keywordflow">case</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeaf790c1f212837af8d2db5193228102d7">AST_DEVICE_TOTAL</a>: <span class="comment">/* not a device state, included for completeness. */</span>
<a name="l00794"></a>00794       <span class="keywordflow">break</span>;
<a name="l00795"></a>00795    }
<a name="l00796"></a>00796 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a65ebe8f28497b09769ab9edeb4eb9b86"></a><!-- doxytag: member="devicestate.h::ast_devstate_aggregate_init" ref="a65ebe8f28497b09769ab9edeb4eb9b86" args="(struct ast_devstate_aggregate *agg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_devstate_aggregate_init </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__devstate__aggregate.html">ast_devstate_aggregate</a> *&nbsp;</td>
          <td class="paramname"> <em>agg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize aggregate device <a class="el" href="structstate.html">state</a>. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>agg</em>&nbsp;</td><td>the <a class="el" href="structstate.html">state</a> object</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>nothing </dd></dl>
<dl class="since"><dt><b>Since:</b></dt><dd>1.6.1 </dd></dl>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00733">733</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="devicestate_8h_source.html#l00259">ast_devstate_aggregate::all_busy</a>, <a class="el" href="devicestate_8h_source.html#l00260">ast_devstate_aggregate::all_free</a>, <a class="el" href="devicestate_8h_source.html#l00258">ast_devstate_aggregate::all_unavail</a>, and <a class="el" href="devicestate_8h_source.html#l00257">ast_devstate_aggregate::all_unknown</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l03797">ast_extension_state2()</a>, and <a class="el" href="devicestate_8c_source.html#l00593">process_collection()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00734"></a>00734 {
<a name="l00735"></a>00735    memset(agg, 0, <span class="keyword">sizeof</span>(*agg));
<a name="l00736"></a>00736 
<a name="l00737"></a>00737    agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a89222ce0f74e56a855e1be89537fdb02">all_unknown</a> = 1;
<a name="l00738"></a>00738    agg-&gt;<a class="code" href="structast__devstate__aggregate.html#aec50b9db1640cefa9c219d63e1b7ade4">all_unavail</a> = 1;
<a name="l00739"></a>00739    agg-&gt;<a class="code" href="structast__devstate__aggregate.html#af7df3d089a03d0acb4e8e18c28d58700">all_busy</a> = 1;
<a name="l00740"></a>00740    agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a7dcbb2425e6da769d44603778432db0f">all_free</a> = 1;
<a name="l00741"></a>00741 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a852d7e936d4385c3bb903812de5d6403"></a><!-- doxytag: member="devicestate.h::ast_devstate_aggregate_result" ref="a852d7e936d4385c3bb903812de5d6403" args="(struct ast_devstate_aggregate *agg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a> ast_devstate_aggregate_result </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__devstate__aggregate.html">ast_devstate_aggregate</a> *&nbsp;</td>
          <td class="paramname"> <em>agg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Get the aggregate device <a class="el" href="structstate.html">state</a> result. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>agg</em>&nbsp;</td><td>the <a class="el" href="structstate.html">state</a> object</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>the aggregate device <a class="el" href="structstate.html">state</a> after adding some <a class="el" href="structnumber.html" title="Number structure.">number</a> of device states. </dd></dl>
<dl class="since"><dt><b>Since:</b></dt><dd>1.6.1 </dd></dl>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00799">799</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="devicestate_8h_source.html#l00259">ast_devstate_aggregate::all_busy</a>, <a class="el" href="devicestate_8h_source.html#l00260">ast_devstate_aggregate::all_free</a>, <a class="el" href="devicestate_8h_source.html#l00258">ast_devstate_aggregate::all_unavail</a>, <a class="el" href="devicestate_8h_source.html#l00257">ast_devstate_aggregate::all_unknown</a>, <a class="el" href="devicestate_8h_source.html#l00055">AST_DEVICE_BUSY</a>, <a class="el" href="devicestate_8h_source.html#l00054">AST_DEVICE_INUSE</a>, <a class="el" href="devicestate_8h_source.html#l00053">AST_DEVICE_NOT_INUSE</a>, <a class="el" href="devicestate_8h_source.html#l00060">AST_DEVICE_ONHOLD</a>, <a class="el" href="devicestate_8h_source.html#l00058">AST_DEVICE_RINGING</a>, <a class="el" href="devicestate_8h_source.html#l00059">AST_DEVICE_RINGINUSE</a>, <a class="el" href="devicestate_8h_source.html#l00057">AST_DEVICE_UNAVAILABLE</a>, <a class="el" href="devicestate_8h_source.html#l00052">AST_DEVICE_UNKNOWN</a>, <a class="el" href="devicestate_8h_source.html#l00262">ast_devstate_aggregate::busy</a>, <a class="el" href="devicestate_8h_source.html#l00263">ast_devstate_aggregate::in_use</a>, <a class="el" href="devicestate_8h_source.html#l00261">ast_devstate_aggregate::on_hold</a>, and <a class="el" href="devicestate_8h_source.html#l00264">ast_devstate_aggregate::ring</a>.</p>

<p>Referenced by <a class="el" href="pbx_8c_source.html#l03797">ast_extension_state2()</a>, and <a class="el" href="devicestate_8c_source.html#l00593">process_collection()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00800"></a>00800 {
<a name="l00801"></a>00801    <span class="keywordflow">if</span> (agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a7dcbb2425e6da769d44603778432db0f">all_free</a>)
<a name="l00802"></a>00802       <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeadee91fc4886ffc7b4efb8459cef48fe2">AST_DEVICE_NOT_INUSE</a>;
<a name="l00803"></a>00803    <span class="keywordflow">if</span> ((agg-&gt;<a class="code" href="structast__devstate__aggregate.html#ae90f2e4a448082950b7e1e7a7a508464">in_use</a> || agg-&gt;<a class="code" href="structast__devstate__aggregate.html#adbb5ea13ff67a0f65a71edddb0eef433">on_hold</a>) &amp;&amp; agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a055700e8ae7f31029bebd7a4353cf04b">ring</a>)
<a name="l00804"></a>00804       <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea17b87dfa3f4de5909b401017e229091d">AST_DEVICE_RINGINUSE</a>;
<a name="l00805"></a>00805    <span class="keywordflow">if</span> (agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a055700e8ae7f31029bebd7a4353cf04b">ring</a>)
<a name="l00806"></a>00806       <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea76d91d5d654cfa3edafb2afbe3e09b46">AST_DEVICE_RINGING</a>;
<a name="l00807"></a>00807    <span class="keywordflow">if</span> (agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a062fb7f88f25f3a783a4f30f7174d1dc">busy</a>)
<a name="l00808"></a>00808       <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeab43afabf5bcd4ad1f531ad78c48ccb6f">AST_DEVICE_BUSY</a>;
<a name="l00809"></a>00809    <span class="keywordflow">if</span> (agg-&gt;<a class="code" href="structast__devstate__aggregate.html#ae90f2e4a448082950b7e1e7a7a508464">in_use</a>)
<a name="l00810"></a>00810       <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea23aa227468c09b5ebd0fb01b4c895190">AST_DEVICE_INUSE</a>;
<a name="l00811"></a>00811    <span class="keywordflow">if</span> (agg-&gt;<a class="code" href="structast__devstate__aggregate.html#adbb5ea13ff67a0f65a71edddb0eef433">on_hold</a>)
<a name="l00812"></a>00812       <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea6b7416bea92d3bc5ee8e36f0a484cdc1">AST_DEVICE_ONHOLD</a>;
<a name="l00813"></a>00813    <span class="keywordflow">if</span> (agg-&gt;<a class="code" href="structast__devstate__aggregate.html#af7df3d089a03d0acb4e8e18c28d58700">all_busy</a>)
<a name="l00814"></a>00814       <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeab43afabf5bcd4ad1f531ad78c48ccb6f">AST_DEVICE_BUSY</a>;
<a name="l00815"></a>00815    <span class="keywordflow">if</span> (agg-&gt;<a class="code" href="structast__devstate__aggregate.html#a89222ce0f74e56a855e1be89537fdb02">all_unknown</a>)
<a name="l00816"></a>00816       <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea41983b6678528bfcdf919b24d6e08d9a">AST_DEVICE_UNKNOWN</a>;
<a name="l00817"></a>00817    <span class="keywordflow">if</span> (agg-&gt;<a class="code" href="structast__devstate__aggregate.html#aec50b9db1640cefa9c219d63e1b7ade4">all_unavail</a>)
<a name="l00818"></a>00818       <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeafac147cbabf3ccb80e50e86027710549">AST_DEVICE_UNAVAILABLE</a>;
<a name="l00819"></a>00819 
<a name="l00820"></a>00820    <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeadee91fc4886ffc7b4efb8459cef48fe2">AST_DEVICE_NOT_INUSE</a>;
<a name="l00821"></a>00821 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ac91fd8b93a2095c18ab86bd61c19ae46"></a><!-- doxytag: member="devicestate.h::ast_devstate_changed" ref="ac91fd8b93a2095c18ab86bd61c19ae46" args="(enum ast_device_state state, const char *fmt,...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_devstate_changed </td>
          <td>(</td>
          <td class="paramtype">enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a>&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>...</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Tells Asterisk the State for Device is changed. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structstate.html">state</a></em>&nbsp;</td><td>the new <a class="el" href="structstate.html">state</a> of the device </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>fmt</em>&nbsp;</td><td>device name like a dial string with format parameters</td></tr>
  </table>
  </dd>
</dl>
<p>The new <a class="el" href="structstate.html">state</a> of the device will be sent off to any subscribers of device states. It will also be stored in the internal event cache.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00508">508</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="devicestate_8c_source.html#l00465">ast_devstate_changed_literal()</a>, <a class="el" href="channel_8h_source.html#l00134">AST_MAX_EXTENSION</a>, and <a class="el" href="adsistub_8c_source.html#l00059">buf</a>.</p>

<p>Referenced by <a class="el" href="chan__iax2_8c_source.html#l08254">__expire_registry()</a>, <a class="el" href="chan__iax2_8c_source.html#l11441">__iax2_poke_noanswer()</a>, <a class="el" href="chan__agent_8c_source.html#l00770">agent_call()</a>, <a class="el" href="chan__agent_8c_source.html#l00893">agent_hangup()</a>, <a class="el" href="chan__agent_8c_source.html#l01645">agent_logoff_maintenance()</a>, <a class="el" href="chan__agent_8c_source.html#l00519">agent_read()</a>, <a class="el" href="app__meetme_8c_source.html#l01998">conf_run()</a>, <a class="el" href="func__devstate_8c_source.html#l00107">devstate_write()</a>, <a class="el" href="chan__sip_8c_source.html#l12018">expire_register()</a>, <a class="el" href="func__devstate_8c_source.html#l00235">handle_cli_devstate_change()</a>, <a class="el" href="chan__skinny_8c_source.html#l05045">handle_offhook_message()</a>, <a class="el" href="chan__skinny_8c_source.html#l05135">handle_onhook_message()</a>, <a class="el" href="chan__sip_8c_source.html#l18198">handle_response_peerpoke()</a>, <a class="el" href="chan__skinny_8c_source.html#l05662">handle_soft_key_event_message()</a>, <a class="el" href="chan__skinny_8c_source.html#l04699">handle_stimulus_message()</a>, <a class="el" href="func__devstate_8c_source.html#l00326">load_module()</a>, <a class="el" href="chan__agent_8c_source.html#l01981">login_exec()</a>, <a class="el" href="features_8c_source.html#l00510">notify_metermaids()</a>, <a class="el" href="chan__iax2_8c_source.html#l08297">reg_source_db()</a>, <a class="el" href="chan__iax2_8c_source.html#l07596">register_verify()</a>, <a class="el" href="chan__agent_8c_source.html#l02387">reload_agents()</a>, <a class="el" href="chan__sip_8c_source.html#l12751">sip_peer_hold()</a>, <a class="el" href="chan__sip_8c_source.html#l22832">sip_poke_noanswer()</a>, <a class="el" href="chan__skinny_8c_source.html#l01813">skinny_register()</a>, <a class="el" href="chan__skinny_8c_source.html#l01881">skinny_unregister()</a>, <a class="el" href="app__meetme_8c_source.html#l04641">sla_change_trunk_state()</a>, <a class="el" href="app__meetme_8c_source.html#l05149">sla_handle_hold_event()</a>, <a class="el" href="app__meetme_8c_source.html#l05601">sla_station_exec()</a>, <a class="el" href="chan__iax2_8c_source.html#l09458">socket_process()</a>, <a class="el" href="chan__sip_8c_source.html#l05634">update_call_counter()</a>, and <a class="el" href="chan__iax2_8c_source.html#l08346">update_registry()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00509"></a>00509 {
<a name="l00510"></a>00510    <span class="keywordtype">char</span> <a class="code" href="adsistub_8c.html#aa95cbf1d00929438101e64ee5a216d0c">buf</a>[<a class="code" href="channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a>];
<a name="l00511"></a>00511    va_list ap;
<a name="l00512"></a>00512 
<a name="l00513"></a>00513    va_start(ap, fmt);
<a name="l00514"></a>00514    vsnprintf(buf, <span class="keyword">sizeof</span>(buf), fmt, ap);
<a name="l00515"></a>00515    va_end(ap);
<a name="l00516"></a>00516 
<a name="l00517"></a>00517    <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#a0cc33ebff1ed76c113d17785814b5a47" title="Tells Asterisk the State for Device is changed.">ast_devstate_changed_literal</a>(<a class="code" href="structstate.html">state</a>, buf);
<a name="l00518"></a>00518 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0cc33ebff1ed76c113d17785814b5a47"></a><!-- doxytag: member="devicestate.h::ast_devstate_changed_literal" ref="a0cc33ebff1ed76c113d17785814b5a47" args="(enum ast_device_state state, const char *device)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_devstate_changed_literal </td>
          <td>(</td>
          <td class="paramtype">enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a>&nbsp;</td>
          <td class="paramname"> <em>state</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>device</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Tells Asterisk the State for Device is changed. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structstate.html">state</a></em>&nbsp;</td><td>the new <a class="el" href="structstate.html">state</a> of the device </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>device</em>&nbsp;</td><td>device name like a dial string with format parameters</td></tr>
  </table>
  </dd>
</dl>
<p>The new <a class="el" href="structstate.html">state</a> of the device will be sent off to any subscribers of device states. It will also be stored in the internal event cache.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00465">465</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="lock_8h_source.html#l01734">ast_cond_signal()</a>, <a class="el" href="devicestate_8h_source.html#l00052">AST_DEVICE_UNKNOWN</a>, <a class="el" href="linkedlists_8h_source.html#l00715">AST_LIST_INSERT_TAIL</a>, <a class="el" href="linkedlists_8h_source.html#l00039">AST_LIST_LOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00139">AST_LIST_UNLOCK</a>, <a class="el" href="devicestate_8c_source.html#l00181">change_thread</a>, <a class="el" href="devicestate_8c_source.html#l00173">state_change::device</a>, <a class="el" href="devicestate_8c_source.html#l00427">devstate_event()</a>, and <a class="el" href="devicestate_8c_source.html#l00454">do_state_change()</a>.</p>

<p>Referenced by <a class="el" href="channel_8c_source.html#l01388">ast_channel_free()</a>, <a class="el" href="devicestate_8c_source.html#l00520">ast_device_state_changed()</a>, <a class="el" href="devicestate_8c_source.html#l00503">ast_device_state_changed_literal()</a>, <a class="el" href="devicestate_8c_source.html#l00508">ast_devstate_changed()</a>, <a class="el" href="channel_8c_source.html#l04695">ast_setstate()</a>, and <a class="el" href="chan__dahdi_8c_source.html#l07417">dahdi_new()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00466"></a>00466 {
<a name="l00467"></a>00467    <span class="keyword">struct </span><a class="code" href="structstate__change.html">state_change</a> *change;
<a name="l00468"></a>00468 
<a name="l00469"></a>00469    <span class="comment">/* </span>
<a name="l00470"></a>00470 <span class="comment">    * If we know the state change (how nice of the caller of this function!)</span>
<a name="l00471"></a>00471 <span class="comment">    * then we can just generate a device state event. </span>
<a name="l00472"></a>00472 <span class="comment">    *</span>
<a name="l00473"></a>00473 <span class="comment">    * Otherwise, we do the following:</span>
<a name="l00474"></a>00474 <span class="comment">    *   - Queue an event up to another thread that the state has changed</span>
<a name="l00475"></a>00475 <span class="comment">    *   - In the processing thread, it calls the callback provided by the</span>
<a name="l00476"></a>00476 <span class="comment">    *     device state provider (which may or may not be a channel driver)</span>
<a name="l00477"></a>00477 <span class="comment">    *     to determine the state.</span>
<a name="l00478"></a>00478 <span class="comment">    *   - If the device state provider does not know the state, or this is</span>
<a name="l00479"></a>00479 <span class="comment">    *     for a channel and the channel driver does not implement a device</span>
<a name="l00480"></a>00480 <span class="comment">    *     state callback, then we will look through the channel list to</span>
<a name="l00481"></a>00481 <span class="comment">    *     see if we can determine a state based on active calls.</span>
<a name="l00482"></a>00482 <span class="comment">    *   - Once a state has been determined, a device state event is generated.</span>
<a name="l00483"></a>00483 <span class="comment">    */</span>
<a name="l00484"></a>00484 
<a name="l00485"></a>00485    <span class="keywordflow">if</span> (<a class="code" href="structstate.html">state</a> != <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea41983b6678528bfcdf919b24d6e08d9a">AST_DEVICE_UNKNOWN</a>) {
<a name="l00486"></a>00486       <a class="code" href="devicestate_8c.html#a87e192ec02bfdad7363a0afd21163d97">devstate_event</a>(<a class="code" href="structstate__change.html#ad4a4f6bb9638907e0d14b2d8b05c86a0">device</a>, <a class="code" href="structstate.html">state</a>);
<a name="l00487"></a>00487    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="devicestate_8c.html#a767b566dd113e1ee0de1634e07c5618d" title="The device state change notification thread.">change_thread</a> == <a class="code" href="lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a> || !(change = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*change) + strlen(<a class="code" href="structstate__change.html#ad4a4f6bb9638907e0d14b2d8b05c86a0">device</a>)))) {
<a name="l00488"></a>00488       <span class="comment">/* we could not allocate a change struct, or */</span>
<a name="l00489"></a>00489       <span class="comment">/* there is no background thread, so process the change now */</span>
<a name="l00490"></a>00490       <a class="code" href="devicestate_8c.html#accc5f57962e9a0e3bbf8d7c2046525f7">do_state_change</a>(<a class="code" href="structstate__change.html#ad4a4f6bb9638907e0d14b2d8b05c86a0">device</a>);
<a name="l00491"></a>00491    } <span class="keywordflow">else</span> {
<a name="l00492"></a>00492       <span class="comment">/* queue the change */</span>
<a name="l00493"></a>00493       strcpy(change-&gt;<a class="code" href="structstate__change.html#ad4a4f6bb9638907e0d14b2d8b05c86a0">device</a>, <a class="code" href="structstate__change.html#ad4a4f6bb9638907e0d14b2d8b05c86a0">device</a>);
<a name="l00494"></a>00494       <a class="code" href="linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40" title="Locks a list.">AST_LIST_LOCK</a>(&amp;<a class="code" href="structstate__changes.html" title="The state change queue. State changes are queued for processing by a separate thread...">state_changes</a>);
<a name="l00495"></a>00495       <a class="code" href="linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960" title="Appends a list entry to the tail of a list.">AST_LIST_INSERT_TAIL</a>(&amp;<a class="code" href="structstate__changes.html" title="The state change queue. State changes are queued for processing by a separate thread...">state_changes</a>, change, <a class="code" href="structstate__change.html#a443ba7b3c87e8b2c97bb8d454329b925">list</a>);
<a name="l00496"></a>00496       <a class="code" href="lock_8h.html#a02a91e30acdea6d13208d23636d37c87">ast_cond_signal</a>(&amp;<a class="code" href="devicestate_8c.html#aa33e22b03fb6e00eb7f27a34f0e630f1" title="Flag for the queue.">change_pending</a>);
<a name="l00497"></a>00497       <a class="code" href="linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01" title="Attempts to unlock a list.">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="structstate__changes.html" title="The state change queue. State changes are queued for processing by a separate thread...">state_changes</a>);
<a name="l00498"></a>00498    }
<a name="l00499"></a>00499 
<a name="l00500"></a>00500    <span class="keywordflow">return</span> 1;
<a name="l00501"></a>00501 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae832fcc32c88962e73025ffeafe2961e"></a><!-- doxytag: member="devicestate.h::ast_devstate_prov_add" ref="ae832fcc32c88962e73025ffeafe2961e" args="(const char *label, ast_devstate_prov_cb_type callback)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_devstate_prov_add </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>label</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="devicestate_8h.html#a93c7236225b5fd76d197b8e5afba2de5">ast_devstate_prov_cb_type</a>&nbsp;</td>
          <td class="paramname"> <em>callback</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Add device <a class="el" href="structstate.html">state</a> provider. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>label</em>&nbsp;</td><td>to use in hint, like label:object </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>callback</em>&nbsp;</td><td>Callback</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00369">369</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00072">ast_calloc</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="linkedlists_8h_source.html#l00702">AST_RWLIST_INSERT_HEAD</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, <a class="el" href="devicestate_8c_source.html#l00164">devstate_prov::callback</a>, and <a class="el" href="devicestate_8c_source.html#l00163">devstate_prov::label</a>.</p>

<p>Referenced by <a class="el" href="features_8c_source.html#l04642">ast_features_init()</a>, and <a class="el" href="app__meetme_8c_source.html#l06461">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00370"></a>00370 {
<a name="l00371"></a>00371    <span class="keyword">struct </span><a class="code" href="structdevstate__prov.html" title="A device state provider (not a channel).">devstate_prov</a> *devprov;
<a name="l00372"></a>00372 
<a name="l00373"></a>00373    <span class="keywordflow">if</span> (!<a class="code" href="structdevstate__prov.html#a255429574a13fcf8e3deacdc16211d00">callback</a> || !(devprov = <a class="code" href="astmm_8h.html#a1cb33b63d94fbbde94234b062249e015">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*devprov))))
<a name="l00374"></a>00374       <span class="keywordflow">return</span> -1;
<a name="l00375"></a>00375 
<a name="l00376"></a>00376    devprov-&gt;<a class="code" href="structdevstate__prov.html#a255429574a13fcf8e3deacdc16211d00">callback</a> = <a class="code" href="structdevstate__prov.html#a255429574a13fcf8e3deacdc16211d00">callback</a>;
<a name="l00377"></a>00377    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(devprov-&gt;<a class="code" href="structdevstate__prov.html#a48e23fa2154347c433b24e799187ee4f">label</a>, <a class="code" href="structdevstate__prov.html#a48e23fa2154347c433b24e799187ee4f">label</a>, <span class="keyword">sizeof</span>(devprov-&gt;<a class="code" href="structdevstate__prov.html#a48e23fa2154347c433b24e799187ee4f">label</a>));
<a name="l00378"></a>00378 
<a name="l00379"></a>00379    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structdevstate__provs.html" title="A list of providers.">devstate_provs</a>);
<a name="l00380"></a>00380    <a class="code" href="linkedlists_8h.html#aacc5f6b7c25e361d11d40137fd55a8e8">AST_RWLIST_INSERT_HEAD</a>(&amp;<a class="code" href="structdevstate__provs.html" title="A list of providers.">devstate_provs</a>, devprov, <a class="code" href="structdevstate__prov.html#a6c499d1fde36b0bee0c362bd431a2108">list</a>);
<a name="l00381"></a>00381    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structdevstate__provs.html" title="A list of providers.">devstate_provs</a>);
<a name="l00382"></a>00382 
<a name="l00383"></a>00383    <span class="keywordflow">return</span> 0;
<a name="l00384"></a>00384 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a1ab579ae15aaca64a904c3c41d8b8b01"></a><!-- doxytag: member="devicestate.h::ast_devstate_prov_del" ref="a1ab579ae15aaca64a904c3c41d8b8b01" args="(const char *label)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_devstate_prov_del </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>label</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Remove device <a class="el" href="structstate.html">state</a> provider. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>label</em>&nbsp;</td><td>to use in hint, like label:object</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00387">387</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="linkedlists_8h_source.html#l00564">AST_RWLIST_REMOVE_CURRENT</a>, <a class="el" href="linkedlists_8h_source.html#l00541">AST_RWLIST_TRAVERSE_SAFE_BEGIN</a>, <a class="el" href="linkedlists_8h_source.html#l00601">AST_RWLIST_TRAVERSE_SAFE_END</a>, <a class="el" href="linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="linkedlists_8h_source.html#l00051">AST_RWLIST_WRLOCK</a>, and <a class="el" href="devicestate_8c_source.html#l00163">devstate_prov::label</a>.</p>

<p>Referenced by <a class="el" href="app__meetme_8c_source.html#l06435">unload_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00388"></a>00388 {
<a name="l00389"></a>00389    <span class="keyword">struct </span><a class="code" href="structdevstate__prov.html" title="A device state provider (not a channel).">devstate_prov</a> *devcb;
<a name="l00390"></a>00390    <span class="keywordtype">int</span> res = -1;
<a name="l00391"></a>00391 
<a name="l00392"></a>00392    <a class="code" href="linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595" title="Write locks a list.">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="structdevstate__provs.html" title="A list of providers.">devstate_provs</a>);
<a name="l00393"></a>00393    <a class="code" href="linkedlists_8h.html#a21be6da4b2146b04b4868c2be5cae750">AST_RWLIST_TRAVERSE_SAFE_BEGIN</a>(&amp;<a class="code" href="structdevstate__provs.html" title="A list of providers.">devstate_provs</a>, devcb, <a class="code" href="structdevstate__prov.html#a6c499d1fde36b0bee0c362bd431a2108">list</a>) {
<a name="l00394"></a>00394       <span class="keywordflow">if</span> (!strcasecmp(devcb-&gt;<a class="code" href="structdevstate__prov.html#a48e23fa2154347c433b24e799187ee4f">label</a>, <a class="code" href="structdevstate__prov.html#a48e23fa2154347c433b24e799187ee4f">label</a>)) {
<a name="l00395"></a>00395          <a class="code" href="linkedlists_8h.html#a02212548652c9eb0f3db38dc4e4bd285">AST_RWLIST_REMOVE_CURRENT</a>(<a class="code" href="structdevstate__prov.html#a6c499d1fde36b0bee0c362bd431a2108">list</a>);
<a name="l00396"></a>00396          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(devcb);
<a name="l00397"></a>00397          res = 0;
<a name="l00398"></a>00398          <span class="keywordflow">break</span>;
<a name="l00399"></a>00399       }
<a name="l00400"></a>00400    }
<a name="l00401"></a>00401    <a class="code" href="linkedlists_8h.html#a6bf0e81cb6ef01532ddebaba68f6de28">AST_RWLIST_TRAVERSE_SAFE_END</a>;
<a name="l00402"></a>00402    <a class="code" href="linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138" title="Attempts to unlock a read/write based list.">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="structdevstate__provs.html" title="A list of providers.">devstate_provs</a>);
<a name="l00403"></a>00403 
<a name="l00404"></a>00404    <span class="keywordflow">return</span> res;
<a name="l00405"></a>00405 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6190de57ac370315e51f2c46724d5b10"></a><!-- doxytag: member="devicestate.h::ast_devstate_str" ref="a6190de57ac370315e51f2c46724d5b10" args="(enum ast_device_state devstate) attribute_pure" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* ast_devstate_str </td>
          <td>(</td>
          <td class="paramtype">enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a>&nbsp;</td>
          <td class="paramname"> <em>devstate</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Convert device <a class="el" href="structstate.html">state</a> to text string that is easier to parse. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>devstate</em>&nbsp;</td><td>Current device <a class="el" href="structstate.html">state</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00233">233</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>Referenced by <a class="el" href="func__devstate_8c_source.html#l00100">devstate_read()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00234"></a>00234 {
<a name="l00235"></a>00235    <span class="keywordflow">return</span> <a class="code" href="devicestate_8c.html#ac35aab157772024788c572a575a19703" title="Device state strings for printing.">devstatestring</a>[<a class="code" href="structstate.html">state</a>][1];
<a name="l00236"></a>00236 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae148e0b95218b57b0348ab53f2f82657"></a><!-- doxytag: member="devicestate.h::ast_devstate_val" ref="ae148e0b95218b57b0348ab53f2f82657" args="(const char *val)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a> ast_devstate_val </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>val</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Convert device <a class="el" href="structstate.html">state</a> from text to integer value. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em><a class="el" href="structval.html">val</a></em>&nbsp;</td><td>The text representing the device <a class="el" href="structstate.html">state</a>. Valid <a class="el" href="structvalues.html">values</a> are anything that comes after AST_DEVICE_ in one of the defined <a class="el" href="structvalues.html">values</a>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>The AST_DEVICE_ integer value </dd></dl>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00238">238</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="devicestate_8h_source.html#l00055">AST_DEVICE_BUSY</a>, <a class="el" href="devicestate_8h_source.html#l00054">AST_DEVICE_INUSE</a>, <a class="el" href="devicestate_8h_source.html#l00056">AST_DEVICE_INVALID</a>, <a class="el" href="devicestate_8h_source.html#l00053">AST_DEVICE_NOT_INUSE</a>, <a class="el" href="devicestate_8h_source.html#l00060">AST_DEVICE_ONHOLD</a>, <a class="el" href="devicestate_8h_source.html#l00058">AST_DEVICE_RINGING</a>, <a class="el" href="devicestate_8h_source.html#l00059">AST_DEVICE_RINGINUSE</a>, <a class="el" href="devicestate_8h_source.html#l00057">AST_DEVICE_UNAVAILABLE</a>, and <a class="el" href="devicestate_8h_source.html#l00052">AST_DEVICE_UNKNOWN</a>.</p>

<p>Referenced by <a class="el" href="func__devstate_8c_source.html#l00182">custom_devstate_callback()</a>, <a class="el" href="func__devstate_8c_source.html#l00107">devstate_write()</a>, <a class="el" href="func__devstate_8c_source.html#l00235">handle_cli_devstate_change()</a>, and <a class="el" href="func__devstate_8c_source.html#l00326">load_module()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00239"></a>00239 {
<a name="l00240"></a>00240    <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="structval.html">val</a>, <span class="stringliteral">&quot;NOT_INUSE&quot;</span>))
<a name="l00241"></a>00241       <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeadee91fc4886ffc7b4efb8459cef48fe2">AST_DEVICE_NOT_INUSE</a>;
<a name="l00242"></a>00242    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="structval.html">val</a>, <span class="stringliteral">&quot;INUSE&quot;</span>))
<a name="l00243"></a>00243       <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea23aa227468c09b5ebd0fb01b4c895190">AST_DEVICE_INUSE</a>;
<a name="l00244"></a>00244    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="structval.html">val</a>, <span class="stringliteral">&quot;BUSY&quot;</span>))
<a name="l00245"></a>00245       <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeab43afabf5bcd4ad1f531ad78c48ccb6f">AST_DEVICE_BUSY</a>;
<a name="l00246"></a>00246    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="structval.html">val</a>, <span class="stringliteral">&quot;INVALID&quot;</span>))
<a name="l00247"></a>00247       <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea9c008e1d20858cbc3275c157e02ebc94">AST_DEVICE_INVALID</a>;
<a name="l00248"></a>00248    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="structval.html">val</a>, <span class="stringliteral">&quot;UNAVAILABLE&quot;</span>))
<a name="l00249"></a>00249       <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeafac147cbabf3ccb80e50e86027710549">AST_DEVICE_UNAVAILABLE</a>;
<a name="l00250"></a>00250    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="structval.html">val</a>, <span class="stringliteral">&quot;RINGING&quot;</span>))
<a name="l00251"></a>00251       <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea76d91d5d654cfa3edafb2afbe3e09b46">AST_DEVICE_RINGING</a>;
<a name="l00252"></a>00252    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="structval.html">val</a>, <span class="stringliteral">&quot;RINGINUSE&quot;</span>))
<a name="l00253"></a>00253       <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea17b87dfa3f4de5909b401017e229091d">AST_DEVICE_RINGINUSE</a>;
<a name="l00254"></a>00254    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="structval.html">val</a>, <span class="stringliteral">&quot;ONHOLD&quot;</span>))
<a name="l00255"></a>00255       <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea6b7416bea92d3bc5ee8e36f0a484cdc1">AST_DEVICE_ONHOLD</a>;
<a name="l00256"></a>00256 
<a name="l00257"></a>00257    <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea41983b6678528bfcdf919b24d6e08d9a">AST_DEVICE_UNKNOWN</a>;
<a name="l00258"></a>00258 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aab3f3dcda2662dc291fc4c17b9a602f4"></a><!-- doxytag: member="devicestate.h::ast_enable_distributed_devstate" ref="aab3f3dcda2662dc291fc4c17b9a602f4" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_enable_distributed_devstate </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Enable distributed device <a class="el" href="structstate.html">state</a> processing. </p>
<p>By default, Asterisk assumes that device <a class="el" href="structstate.html">state</a> change events will only be originating from one instance. If a module gets loaded and configured such that multiple instances of Asterisk will be sharing device <a class="el" href="structstate.html">state</a>, this function should be called to enable distributed device <a class="el" href="structstate.html">state</a> processing. It is off by default to save on unnecessary processing.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00823">823</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="lock_8h_source.html#l01729">ast_cond_init()</a>, <a class="el" href="event__defs_8h_source.html#l00050">AST_EVENT_DEVICE_STATE_CHANGE</a>, <a class="el" href="event__defs_8h_source.html#l00058">AST_EVENT_IE_END</a>, <a class="el" href="event_8c_source.html#l00680">ast_event_subscribe()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="lock_8h_source.html#l01692">ast_mutex_init()</a>, <a class="el" href="utils_8h_source.html#l00384">ast_pthread_create_background</a>, <a class="el" href="devicestate_8c_source.html#l00692">devstate_change_collector_cb()</a>, <a class="el" href="devicestate_8c.html#a21d826fdbe789058ca74e83f4f052c37">devstate_collector</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, and <a class="el" href="devicestate_8c_source.html#l00674">run_devstate_collector()</a>.</p>

<p>Referenced by <a class="el" href="evt_8c_source.html#l00300">add_publish_event()</a>, and <a class="el" href="evt_8c_source.html#l00362">add_subscribe_event()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00824"></a>00824 {
<a name="l00825"></a>00825    <span class="keywordflow">if</span> (<a class="code" href="devicestate_8c.html#a21d826fdbe789058ca74e83f4f052c37">devstate_collector</a>.enabled) {
<a name="l00826"></a>00826       <span class="keywordflow">return</span> 0;
<a name="l00827"></a>00827    }
<a name="l00828"></a>00828 
<a name="l00829"></a>00829    <a class="code" href="devicestate_8c.html#a21d826fdbe789058ca74e83f4f052c37">devstate_collector</a>.event_sub = <a class="code" href="event_8h.html#a517ac17630e7658463b66b309a6ce78f" title="Subscribe to events.">ast_event_subscribe</a>(<a class="code" href="event__defs_8h.html#a6fa079412d9d9c1cc539f6d71f37f79fa641bc805cee9b8829fa265e566df9d58">AST_EVENT_DEVICE_STATE_CHANGE</a>,
<a name="l00830"></a>00830       <a class="code" href="devicestate_8c.html#a6328f4d8f6d6b35b38f2acb39258cd2f">devstate_change_collector_cb</a>, NULL, <a class="code" href="event__defs_8h.html#a003673523d7fe265c6738a5a9e49c491a04c78c1362e97d548344c354001c151f">AST_EVENT_IE_END</a>);
<a name="l00831"></a>00831 
<a name="l00832"></a>00832    <span class="keywordflow">if</span> (!<a class="code" href="devicestate_8c.html#a21d826fdbe789058ca74e83f4f052c37">devstate_collector</a>.event_sub) {
<a name="l00833"></a>00833       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to create subscription for the device state change collector\n&quot;</span>);
<a name="l00834"></a>00834       <span class="keywordflow">return</span> -1;
<a name="l00835"></a>00835    }
<a name="l00836"></a>00836 
<a name="l00837"></a>00837    <a class="code" href="lock_8h.html#a5dc895fe6e8c089175159fc22e33fc3b">ast_mutex_init</a>(&amp;<a class="code" href="devicestate_8c.html#a21d826fdbe789058ca74e83f4f052c37">devstate_collector</a>.lock);
<a name="l00838"></a>00838    <a class="code" href="lock_8h.html#a21f75f462115427718d78aa66cc61f9b">ast_cond_init</a>(&amp;<a class="code" href="devicestate_8c.html#a21d826fdbe789058ca74e83f4f052c37">devstate_collector</a>.cond, NULL);
<a name="l00839"></a>00839    <span class="keywordflow">if</span> (<a class="code" href="utils_8h.html#a595e2f8aa398f4bd21e381c3211235fe">ast_pthread_create_background</a>(&amp;<a class="code" href="devicestate_8c.html#a21d826fdbe789058ca74e83f4f052c37">devstate_collector</a>.thread, NULL, <a class="code" href="devicestate_8c.html#aba2b4557d1f67626534da2a47d3ad39e">run_devstate_collector</a>, NULL) &lt; 0) {
<a name="l00840"></a>00840       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to start device state collector thread.\n&quot;</span>);
<a name="l00841"></a>00841       <span class="keywordflow">return</span> -1;
<a name="l00842"></a>00842    }
<a name="l00843"></a>00843 
<a name="l00844"></a>00844    <a class="code" href="devicestate_8c.html#a21d826fdbe789058ca74e83f4f052c37">devstate_collector</a>.enabled = 1;
<a name="l00845"></a>00845 
<a name="l00846"></a>00846    <span class="keywordflow">return</span> 0;
<a name="l00847"></a>00847 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a9da9a09e65a9332176a523407ccac611"></a><!-- doxytag: member="devicestate.h::ast_parse_device_state" ref="a9da9a09e65a9332176a523407ccac611" args="(const char *device)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a> ast_parse_device_state </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>device</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Search the Channels by Name. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>device</em>&nbsp;</td><td>like a dial string</td></tr>
  </table>
  </dd>
</dl>
<p>Search the Device in active <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> by compare the channel name against the device name. Compared are only the first chars to the first '-' char.</p>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>AST_DEVICE_UNKNOWN</em>&nbsp;</td><td>if no channel found </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>AST_DEVICE_INUSE</em>&nbsp;</td><td>if a channel is found</td></tr>
  </table>
  </dd>
</dl>
<p>Search the Channels by Name.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>find <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> with the device's name in it This function is only used for <a class="el" href="structchannels.html" title="the list of channels we have. Note that the lock for this list is used for both the...">channels</a> that does not implement devicestate natively </dd></dl>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00265">265</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="channel_8h_source.html#l00469">ast_channel::_state</a>, <a class="el" href="channel_8h_source.html#l00136">AST_CHANNEL_NAME</a>, <a class="el" href="lock_8h_source.html#l02034">ast_channel_unlock</a>, <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="devicestate_8h_source.html#l00054">AST_DEVICE_INUSE</a>, <a class="el" href="devicestate_8h_source.html#l00058">AST_DEVICE_RINGING</a>, <a class="el" href="devicestate_8h_source.html#l00052">AST_DEVICE_UNKNOWN</a>, <a class="el" href="channel_8c_source.html#l01284">ast_get_channel_by_name_prefix_locked()</a>, <a class="el" href="channel_8h_source.html#l00364">AST_STATE_RINGING</a>, <a class="el" href="adsistub_8c_source.html#l00049">chan</a>, and <a class="el" href="chan__iax2_8c_source.html#l01834">match()</a>.</p>

<p>Referenced by <a class="el" href="devicestate_8c_source.html#l00308">_ast_device_state()</a>, and <a class="el" href="app__chanisavail_8c_source.html#l00097">chanavail_exec()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00266"></a>00266 {
<a name="l00267"></a>00267    <span class="keyword">struct </span><a class="code" href="structast__channel.html" title="Main Channel structure associated with a channel. This is the side of it mostly used...">ast_channel</a> *<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a>;
<a name="l00268"></a>00268    <span class="keywordtype">char</span> <a class="code" href="chan__iax2_8c.html#aa27930d6214f6421994d6bef51efb7aa">match</a>[<a class="code" href="channel_8h.html#ab57c278099ea5f8d7cedbb41eba58b56">AST_CHANNEL_NAME</a>];
<a name="l00269"></a>00269    <span class="keyword">enum</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee" title="Device States.">ast_device_state</a> res;
<a name="l00270"></a>00270 
<a name="l00271"></a>00271    <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(match, device, <span class="keyword">sizeof</span>(match)-1);
<a name="l00272"></a>00272    strcat(match, <span class="stringliteral">&quot;-&quot;</span>);
<a name="l00273"></a>00273    chan = <a class="code" href="channel_8h.html#a67239a95ab93867fb9da5a8b20281224" title="Get channel by name or uniqueid prefix (locks channel).">ast_get_channel_by_name_prefix_locked</a>(match, strlen(match));
<a name="l00274"></a>00274 
<a name="l00275"></a>00275    <span class="keywordflow">if</span> (!chan)
<a name="l00276"></a>00276       <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea41983b6678528bfcdf919b24d6e08d9a">AST_DEVICE_UNKNOWN</a>;
<a name="l00277"></a>00277 
<a name="l00278"></a>00278    <span class="keywordflow">if</span> (chan-&gt;<a class="code" href="structast__channel.html#abc7d0b575ffea0b65ce604e0e4c99d3d">_state</a> == <a class="code" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660a5bf03bd84f434acaeefdacb0096e1baa">AST_STATE_RINGING</a>)
<a name="l00279"></a>00279       res = <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea76d91d5d654cfa3edafb2afbe3e09b46">AST_DEVICE_RINGING</a>;
<a name="l00280"></a>00280    <span class="keywordflow">else</span>
<a name="l00281"></a>00281       res = <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea23aa227468c09b5ebd0fb01b4c895190">AST_DEVICE_INUSE</a>;
<a name="l00282"></a>00282    
<a name="l00283"></a>00283    <a class="code" href="lock_8h.html#a853c07107a1385c83c5d2a0ab7e01d79" title="Unlock a channel. If DEBUG_CHANNEL_LOCKS is defined in the Makefile, print relevant...">ast_channel_unlock</a>(chan);
<a name="l00284"></a>00284 
<a name="l00285"></a>00285    <span class="keywordflow">return</span> res;
<a name="l00286"></a>00286 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a8e0c5acc035f43741343b8ed2fcb14ea"></a><!-- doxytag: member="devicestate.h::ast_state_chan2dev" ref="a8e0c5acc035f43741343b8ed2fcb14ea" args="(enum ast_channel_state chanstate)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a> ast_state_chan2dev </td>
          <td>(</td>
          <td class="paramtype">enum <a class="el" href="channel_8h.html#a03585bc87e5bbd0f4d11bc789734c660">ast_channel_state</a>&nbsp;</td>
          <td class="paramname"> <em>chanstate</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Convert channel <a class="el" href="structstate.html">state</a> to devicestate. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>chanstate</em>&nbsp;</td><td>Current channel <a class="el" href="structstate.html">state</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="since"><dt><b>Since:</b></dt><dd>1.6.1 </dd></dl>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00220">220</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p>References <a class="el" href="devicestate_8h_source.html#l00052">AST_DEVICE_UNKNOWN</a>, and <a class="el" href="adsistub_8c_source.html#l00049">chan</a>.</p>

<p>Referenced by <a class="el" href="chan__dahdi_8c_source.html#l07417">dahdi_new()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00221"></a>00221 {
<a name="l00222"></a>00222    <span class="keywordtype">int</span> i;
<a name="l00223"></a>00223    chanstate &amp;= 0xFFFF;
<a name="l00224"></a>00224    <span class="keywordflow">for</span> (i = 0; <a class="code" href="structchan2dev.html" title="Mapping for channel states to device states.">chan2dev</a>[i].chan != -100; i++) {
<a name="l00225"></a>00225       <span class="keywordflow">if</span> (<a class="code" href="structchan2dev.html" title="Mapping for channel states to device states.">chan2dev</a>[i].<a class="code" href="adsistub_8c.html#a322af389d034b8f1282da0a853ffb921">chan</a> == chanstate) {
<a name="l00226"></a>00226          <span class="keywordflow">return</span> <a class="code" href="structchan2dev.html" title="Mapping for channel states to device states.">chan2dev</a>[i].dev;
<a name="l00227"></a>00227       }
<a name="l00228"></a>00228    }
<a name="l00229"></a>00229    <span class="keywordflow">return</span> <a class="code" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeea41983b6678528bfcdf919b24d6e08d9a">AST_DEVICE_UNKNOWN</a>;
<a name="l00230"></a>00230 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a753243b1af643942b39a7c7434dd902c"></a><!-- doxytag: member="devicestate.h::devstate2str" ref="a753243b1af643942b39a7c7434dd902c" args="(enum ast_device_state devstate) attribute_pure" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* devstate2str </td>
          <td>(</td>
          <td class="paramtype">enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a>&nbsp;</td>
          <td class="paramname"> <em>devstate</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Convert device <a class="el" href="structstate.html">state</a> to text string for output. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>devstate</em>&nbsp;</td><td>Current device <a class="el" href="structstate.html">state</a> </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="devicestate_8c_source.html#l00215">215</a> of file <a class="el" href="devicestate_8c_source.html">devicestate.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00216"></a>00216 {
<a name="l00217"></a>00217    <span class="keywordflow">return</span> <a class="code" href="devicestate_8c.html#ac35aab157772024788c572a575a19703" title="Device state strings for printing.">devstatestring</a>[devstate][0];
<a name="l00218"></a>00218 }
</pre></div></p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a93c7236225b5fd76d197b8e5afba2de5"></a><!-- doxytag: member="devicestate.h::ast_devstate_prov_cb_type" ref="a93c7236225b5fd76d197b8e5afba2de5" args=")(const char *data)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a>(* <a class="el" href="devicestate_8h.html#a93c7236225b5fd76d197b8e5afba2de5">ast_devstate_prov_cb_type</a>)(const char *data)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Devicestate provider call back. </p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:21:58 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
