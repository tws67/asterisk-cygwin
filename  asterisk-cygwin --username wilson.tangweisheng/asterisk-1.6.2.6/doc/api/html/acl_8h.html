<HTML>
    <HEAD>
      <TITLE>Asterisk.org: Developer Documentation (5 May 2010)</TITLE>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<div><font size="2" align="right">Wed May 5 15:18:50 2010</font></div>

<h2>Asterisk developer's documentation</h2>
<hr/>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_1ab815038f534adda65c8b4ae4993449.html">include</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_16d825f1fa9ecca2e70b1a8d9256d0e6.html">asterisk</a>
  </div>
</div>
<div class="contents">
<h1>acl.h File Reference</h1>
<p>Access Control of various sorts.  
<a href="#_details">More...</a></p>
<code>#include &quot;<a class="el" href="network_8h_source.html">asterisk/network.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="io_8h_source.html">asterisk/io.h</a>&quot;</code><br/>

<p><a href="acl_8h_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structast__ha.html">ast_ha</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">internal representation of acl entries In principle <a class="el" href="structuser.html" title="structure to hold users read from users.conf">user</a> applications would have no need for this, but there is sometimes a need to extract individual items, e.g. to print them, and rather than defining iterators to navigate the list, and an externally visible 'struct ast_ha_entry', at least in the short term it is more convenient to make the whole thing public and let <a class="el" href="structusers.html" title="list of users found in the config file">users</a> play with them.  <a href="structast__ha.html#_details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="acl_8h.html#a5fa037034b295e6ec822ecd78284232d">AST_SENSE_ALLOW</a>&nbsp;&nbsp;&nbsp;1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="acl_8h.html#aaf3944839d653d0f845ed392bde58308">AST_SENSE_DENY</a>&nbsp;&nbsp;&nbsp;0</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__ha.html">ast_ha</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="acl_8h.html#ae839a9c2465be4e9a560dda668a65b9b">ast_append_ha</a> (const char *sense, const char *stuff, struct <a class="el" href="structast__ha.html">ast_ha</a> *path, int *error)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Append ACL entry to host access list.  <a href="#ae839a9c2465be4e9a560dda668a65b9b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="acl_8h.html#aac0540803fb28e105697e917bd0f252b">ast_apply_ha</a> (struct <a class="el" href="structast__ha.html">ast_ha</a> *ha, struct sockaddr_in *sin)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Check IP address with host access list.  <a href="#aac0540803fb28e105697e917bd0f252b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="acl_8h.html#a61f6f79316a8f64be7bdac1a41183047">ast_copy_ha</a> (const struct <a class="el" href="structast__ha.html">ast_ha</a> *from, struct <a class="el" href="structast__ha.html">ast_ha</a> *to)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Copy ha structure.  <a href="#a61f6f79316a8f64be7bdac1a41183047"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structast__ha.html">ast_ha</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="acl_8h.html#abbe043434fef41fa18acb4062960b578">ast_duplicate_ha_list</a> (struct <a class="el" href="structast__ha.html">ast_ha</a> *original)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Copy host access list.  <a href="#abbe043434fef41fa18acb4062960b578"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="acl_8h.html#a4fbb9258573d41461c7389afbcbba377">ast_find_ourip</a> (struct in_addr *ourip, struct sockaddr_in <a class="el" href="chan__skinny_8c.html#a4ec29229510a2e3ea6ce34d520f06e90">bindaddr</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="acl_8h.html#a45dc427430b544afc0ef8e898b2c57bf">ast_free_ha</a> (struct <a class="el" href="structast__ha.html">ast_ha</a> *ha)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Free host access list.  <a href="#a45dc427430b544afc0ef8e898b2c57bf"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="acl_8h.html#af04bd435c082da93aec0cb6e0782788a">ast_get_ip</a> (struct sockaddr_in *sin, const char *value)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="acl_8h.html#afab7a25fb37c7e1a0dedef9c286a44a1">ast_get_ip_or_srv</a> (struct sockaddr_in *sin, const char *value, const char *<a class="el" href="adsistub_8c.html#ad61354ac038c6aaed26fded971a8843b">service</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="acl_8h.html#a5c782f0d9affd120e7270beca0636c9a">ast_ouraddrfor</a> (struct in_addr *them, struct in_addr *us)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="acl_8h.html#ad364a9241e15fc0dbec0ffcb88f64671">ast_str2cos</a> (const char *value, unsigned int *<a class="el" href="chan__unistim_8c.html#ae91dad65f553f7afebe4af507803bc7f">cos</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="acl_8h.html#a49d1eefe77636e2a63ad013afa0fc3b5">ast_str2tos</a> (const char *value, unsigned int *<a class="el" href="pbx__dundi_8c.html#a25a9305efab3b493ca2519562fcec3d5">tos</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="acl_8h.html#a18813aaabb1644f4083746b798a351a0">ast_tos2str</a> (unsigned int <a class="el" href="pbx__dundi_8c.html#a25a9305efab3b493ca2519562fcec3d5">tos</a>)</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Access Control of various sorts. </p>

<p>Definition in file <a class="el" href="acl_8h_source.html">acl.h</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a5fa037034b295e6ec822ecd78284232d"></a><!-- doxytag: member="acl.h::AST_SENSE_ALLOW" ref="a5fa037034b295e6ec822ecd78284232d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_SENSE_ALLOW&nbsp;&nbsp;&nbsp;1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="acl_8h_source.html#l00035">35</a> of file <a class="el" href="acl_8h_source.html">acl.h</a>.</p>

<p>Referenced by <a class="el" href="acl_8c_source.html#l00272">ast_append_ha()</a>, <a class="el" href="acl_8c_source.html#l00352">ast_apply_ha()</a>, <a class="el" href="chan__sip_8c_source.html#l03607">ast_sip_ouraddrfor()</a>, and <a class="el" href="chan__sip_8c_source.html#l12222">parse_register_contact()</a>.</p>

</div>
</div>
<a class="anchor" id="aaf3944839d653d0f845ed392bde58308"></a><!-- doxytag: member="acl.h::AST_SENSE_DENY" ref="aaf3944839d653d0f845ed392bde58308" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_SENSE_DENY&nbsp;&nbsp;&nbsp;0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="acl_8h_source.html#l00034">34</a> of file <a class="el" href="acl_8h_source.html">acl.h</a>.</p>

<p>Referenced by <a class="el" href="acl_8c_source.html#l00272">ast_append_ha()</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ae839a9c2465be4e9a560dda668a65b9b"></a><!-- doxytag: member="acl.h::ast_append_ha" ref="ae839a9c2465be4e9a560dda668a65b9b" args="(const char *sense, const char *stuff, struct ast_ha *path, int *error)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__ha.html">ast_ha</a>* ast_append_ha </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>sense</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>stuff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__ha.html">ast_ha</a> *&nbsp;</td>
          <td class="paramname"> <em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&nbsp;</td>
          <td class="paramname"> <em>error</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Append ACL entry to host access list. </p>

<p>Definition at line <a class="el" href="acl_8c_source.html#l00272">272</a> of file <a class="el" href="acl_8c_source.html">acl.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, <a class="el" href="utils_8c_source.html#l00431">ast_inet_ntoa()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="astmm_8h_source.html#l00081">ast_malloc</a>, <a class="el" href="acl_8h_source.html#l00035">AST_SENSE_ALLOW</a>, <a class="el" href="acl_8h_source.html#l00034">AST_SENSE_DENY</a>, <a class="el" href="utils_8h_source.html#l00616">ast_strdupa</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="acl_8h_source.html#l00049">ast_ha::netaddr</a>, <a class="el" href="acl_8h_source.html#l00050">ast_ha::netmask</a>, <a class="el" href="acl_8h_source.html#l00052">ast_ha::next</a>, and <a class="el" href="acl_8h_source.html#l00051">ast_ha::sense</a>.</p>

<p>Referenced by <a class="el" href="manager_8c_source.html#l04061">__init_manager()</a>, <a class="el" href="chan__iax2_8c_source.html#l02333">add_calltoken_ignore()</a>, <a class="el" href="chan__iax2_8c_source.html#l02278">build_callno_limits()</a>, <a class="el" href="chan__unistim_8c_source.html#l04998">build_device()</a>, <a class="el" href="chan__mgcp_8c_source.html#l03552">build_gateway()</a>, <a class="el" href="chan__h323_8c_source.html#l01478">build_peer()</a>, <a class="el" href="chan__h323_8c_source.html#l01360">build_user()</a>, <a class="el" href="chan__skinny_8c_source.html#l06537">config_parse_variables()</a>, and <a class="el" href="chan__sip_8c_source.html#l24245">reload_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00273"></a>00273 {
<a name="l00274"></a>00274    <span class="keyword">struct </span><a class="code" href="structast__ha.html" title="internal representation of acl entries In principle user applications would have...">ast_ha</a> *ha;
<a name="l00275"></a>00275    <span class="keywordtype">char</span> *nm;
<a name="l00276"></a>00276    <span class="keyword">struct </span><a class="code" href="structast__ha.html" title="internal representation of acl entries In principle user applications would have...">ast_ha</a> *prev = NULL;
<a name="l00277"></a>00277    <span class="keyword">struct </span><a class="code" href="structast__ha.html" title="internal representation of acl entries In principle user applications would have...">ast_ha</a> *ret;
<a name="l00278"></a>00278    <span class="keywordtype">int</span> x;
<a name="l00279"></a>00279    <span class="keywordtype">char</span> *tmp = <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(stuff);
<a name="l00280"></a>00280 
<a name="l00281"></a>00281    ret = path;
<a name="l00282"></a>00282    <span class="keywordflow">while</span> (path) {
<a name="l00283"></a>00283       prev = path;
<a name="l00284"></a>00284       path = path-&gt;<a class="code" href="structast__ha.html#a904bbec16face4bc9d13a8e8c7fbf764">next</a>;
<a name="l00285"></a>00285    }
<a name="l00286"></a>00286 
<a name="l00287"></a>00287    <span class="keywordflow">if</span> (!(ha = <a class="code" href="astmm_8h.html#a64a0e7a3ab511a3777ac56f5d43c628e">ast_malloc</a>(<span class="keyword">sizeof</span>(*ha)))) {
<a name="l00288"></a>00288       <span class="keywordflow">return</span> ret;
<a name="l00289"></a>00289    }
<a name="l00290"></a>00290 
<a name="l00291"></a>00291    <span class="keywordflow">if</span> (!(nm = strchr(tmp, <span class="charliteral">&apos;/&apos;</span>))) {
<a name="l00292"></a>00292       <span class="comment">/* assume /32. Yes, htonl does not do anything for this particular mask</span>
<a name="l00293"></a>00293 <span class="comment">         but we better use it to show we remember about byte order */</span>
<a name="l00294"></a>00294       ha-&gt;<a class="code" href="structast__ha.html#a7b83baecde62ac17306ac3cc5770c27a">netmask</a>.s_addr = htonl(0xFFFFFFFF);
<a name="l00295"></a>00295    } <span class="keywordflow">else</span> {
<a name="l00296"></a>00296       *nm = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00297"></a>00297       nm++;
<a name="l00298"></a>00298 
<a name="l00299"></a>00299       <span class="keywordflow">if</span> (!strchr(nm, <span class="charliteral">&apos;.&apos;</span>)) {
<a name="l00300"></a>00300          <span class="keywordflow">if</span> ((sscanf(nm, <span class="stringliteral">&quot;%30d&quot;</span>, &amp;x) == 1) &amp;&amp; (x &gt;= 0) &amp;&amp; (x &lt;= 32)) {
<a name="l00301"></a>00301             <span class="keywordflow">if</span> (x == 0) {
<a name="l00302"></a>00302                <span class="comment">/* This is special-cased to prevent unpredictable</span>
<a name="l00303"></a>00303 <span class="comment">                * behavior of shifting left 32 bits</span>
<a name="l00304"></a>00304 <span class="comment">                */</span>
<a name="l00305"></a>00305                ha-&gt;<a class="code" href="structast__ha.html#a7b83baecde62ac17306ac3cc5770c27a">netmask</a>.s_addr = 0;
<a name="l00306"></a>00306             } <span class="keywordflow">else</span> {
<a name="l00307"></a>00307                ha-&gt;<a class="code" href="structast__ha.html#a7b83baecde62ac17306ac3cc5770c27a">netmask</a>.s_addr = htonl(0xFFFFFFFF &lt;&lt; (32 - x));
<a name="l00308"></a>00308             }
<a name="l00309"></a>00309          } <span class="keywordflow">else</span> {
<a name="l00310"></a>00310             <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid CIDR in %s\n&quot;</span>, stuff);
<a name="l00311"></a>00311             <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(ha);
<a name="l00312"></a>00312             <span class="keywordflow">if</span> (error) {
<a name="l00313"></a>00313                *error = 1;
<a name="l00314"></a>00314             }
<a name="l00315"></a>00315             <span class="keywordflow">return</span> ret;
<a name="l00316"></a>00316          }
<a name="l00317"></a>00317       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!inet_aton(nm, &amp;ha-&gt;<a class="code" href="structast__ha.html#a7b83baecde62ac17306ac3cc5770c27a">netmask</a>)) {
<a name="l00318"></a>00318          <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid mask in %s\n&quot;</span>, stuff);
<a name="l00319"></a>00319          <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(ha);
<a name="l00320"></a>00320          <span class="keywordflow">if</span> (error) {
<a name="l00321"></a>00321             *error = 1;
<a name="l00322"></a>00322          }
<a name="l00323"></a>00323          <span class="keywordflow">return</span> ret;
<a name="l00324"></a>00324       }
<a name="l00325"></a>00325    }
<a name="l00326"></a>00326 
<a name="l00327"></a>00327    <span class="keywordflow">if</span> (!inet_aton(tmp, &amp;ha-&gt;<a class="code" href="structast__ha.html#a45df45150d4d7ca82a48dfbaa981120e">netaddr</a>)) {
<a name="l00328"></a>00328       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid IP address in %s\n&quot;</span>, stuff);
<a name="l00329"></a>00329       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(ha);
<a name="l00330"></a>00330       <span class="keywordflow">if</span> (error) {
<a name="l00331"></a>00331          *error = 1;
<a name="l00332"></a>00332       }
<a name="l00333"></a>00333       <span class="keywordflow">return</span> ret;
<a name="l00334"></a>00334    }
<a name="l00335"></a>00335 
<a name="l00336"></a>00336    ha-&gt;<a class="code" href="structast__ha.html#a45df45150d4d7ca82a48dfbaa981120e">netaddr</a>.s_addr &amp;= ha-&gt;<a class="code" href="structast__ha.html#a7b83baecde62ac17306ac3cc5770c27a">netmask</a>.s_addr;
<a name="l00337"></a>00337 
<a name="l00338"></a>00338    ha-&gt;<a class="code" href="structast__ha.html#a63824e330f67129ae657ddc1120c30f2">sense</a> = strncasecmp(<a class="code" href="structast__ha.html#a63824e330f67129ae657ddc1120c30f2">sense</a>, <span class="stringliteral">&quot;p&quot;</span>, 1) ? <a class="code" href="acl_8h.html#aaf3944839d653d0f845ed392bde58308">AST_SENSE_DENY</a> : <a class="code" href="acl_8h.html#a5fa037034b295e6ec822ecd78284232d">AST_SENSE_ALLOW</a>;
<a name="l00339"></a>00339 
<a name="l00340"></a>00340    ha-&gt;<a class="code" href="structast__ha.html#a904bbec16face4bc9d13a8e8c7fbf764">next</a> = NULL;
<a name="l00341"></a>00341    <span class="keywordflow">if</span> (prev) {
<a name="l00342"></a>00342       prev-&gt;<a class="code" href="structast__ha.html#a904bbec16face4bc9d13a8e8c7fbf764">next</a> = ha;
<a name="l00343"></a>00343    } <span class="keywordflow">else</span> {
<a name="l00344"></a>00344       ret = ha;
<a name="l00345"></a>00345    }
<a name="l00346"></a>00346 
<a name="l00347"></a>00347    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;%s/%s sense %d appended to acl for peer\n&quot;</span>, <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(<a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(ha-&gt;<a class="code" href="structast__ha.html#a45df45150d4d7ca82a48dfbaa981120e">netaddr</a>)), <a class="code" href="utils_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6" title="duplicate a string in memory from the stack">ast_strdupa</a>(<a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(ha-&gt;<a class="code" href="structast__ha.html#a7b83baecde62ac17306ac3cc5770c27a">netmask</a>)), ha-&gt;<a class="code" href="structast__ha.html#a63824e330f67129ae657ddc1120c30f2">sense</a>);
<a name="l00348"></a>00348 
<a name="l00349"></a>00349    <span class="keywordflow">return</span> ret;
<a name="l00350"></a>00350 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aac0540803fb28e105697e917bd0f252b"></a><!-- doxytag: member="acl.h::ast_apply_ha" ref="aac0540803fb28e105697e917bd0f252b" args="(struct ast_ha *ha, struct sockaddr_in *sin)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_apply_ha </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__ha.html">ast_ha</a> *&nbsp;</td>
          <td class="paramname"> <em>ha</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct sockaddr_in *&nbsp;</td>
          <td class="paramname"> <em>sin</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Check IP address with host access list. </p>

<p>Definition at line <a class="el" href="acl_8c_source.html#l00352">352</a> of file <a class="el" href="acl_8c_source.html">acl.c</a>.</p>

<p>References <a class="el" href="strings_8h_source.html#l00218">ast_copy_string()</a>, <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="utils_8c_source.html#l00431">ast_inet_ntoa()</a>, <a class="el" href="acl_8h_source.html#l00035">AST_SENSE_ALLOW</a>, <a class="el" href="acl_8h_source.html#l00049">ast_ha::netaddr</a>, <a class="el" href="acl_8h_source.html#l00050">ast_ha::netmask</a>, <a class="el" href="acl_8h_source.html#l00052">ast_ha::next</a>, and <a class="el" href="acl_8h_source.html#l00051">ast_ha::sense</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l03607">ast_sip_ouraddrfor()</a>, <a class="el" href="manager_8c_source.html#l01071">authenticate()</a>, <a class="el" href="chan__iax2_8c_source.html#l07197">check_access()</a>, <a class="el" href="chan__sip_8c_source.html#l13923">check_peer_ok()</a>, <a class="el" href="chan__sip_8c_source.html#l12222">parse_register_contact()</a>, <a class="el" href="chan__iax2_8c_source.html#l07596">register_verify()</a>, and <a class="el" href="chan__skinny_8c_source.html#l01813">skinny_register()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00353"></a>00353 {
<a name="l00354"></a>00354    <span class="comment">/* Start optimistic */</span>
<a name="l00355"></a>00355    <span class="keywordtype">int</span> res = <a class="code" href="acl_8h.html#a5fa037034b295e6ec822ecd78284232d">AST_SENSE_ALLOW</a>;
<a name="l00356"></a>00356    <span class="keywordflow">while</span> (ha) {
<a name="l00357"></a>00357 <span class="preprocessor">#if 0 </span><span class="comment">/* debugging code */</span>
<a name="l00358"></a>00358       <span class="keywordtype">char</span> iabuf[INET_ADDRSTRLEN];
<a name="l00359"></a>00359       <span class="keywordtype">char</span> iabuf2[INET_ADDRSTRLEN];
<a name="l00360"></a>00360       <span class="comment">/* DEBUG */</span>
<a name="l00361"></a>00361       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(iabuf, <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(sin-&gt;sin_addr), <span class="keyword">sizeof</span>(iabuf));
<a name="l00362"></a>00362       <a class="code" href="strings_8h.html#a17df4d252f3e2ecb230b526475ac4d93" title="Size-limited null-terminating string copy.">ast_copy_string</a>(iabuf2, <a class="code" href="network_8h.html#a5a735cb59e8a8ddd78078d396db7e106" title="thread-safe replacement for inet_ntoa().">ast_inet_ntoa</a>(ha-&gt;<a class="code" href="structast__ha.html#a45df45150d4d7ca82a48dfbaa981120e">netaddr</a>), <span class="keyword">sizeof</span>(iabuf2));
<a name="l00363"></a>00363       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(1, <span class="stringliteral">&quot;##### Testing %s with %s\n&quot;</span>, iabuf, iabuf2);
<a name="l00364"></a>00364 <span class="preprocessor">#endif</span>
<a name="l00365"></a>00365 <span class="preprocessor"></span>      <span class="comment">/* For each rule, if this address and the netmask = the net address</span>
<a name="l00366"></a>00366 <span class="comment">         apply the current rule */</span>
<a name="l00367"></a>00367       <span class="keywordflow">if</span> ((sin-&gt;sin_addr.s_addr &amp; ha-&gt;<a class="code" href="structast__ha.html#a7b83baecde62ac17306ac3cc5770c27a">netmask</a>.s_addr) == ha-&gt;<a class="code" href="structast__ha.html#a45df45150d4d7ca82a48dfbaa981120e">netaddr</a>.s_addr) {
<a name="l00368"></a>00368          res = ha-&gt;<a class="code" href="structast__ha.html#a63824e330f67129ae657ddc1120c30f2">sense</a>;
<a name="l00369"></a>00369       }
<a name="l00370"></a>00370       ha = ha-&gt;<a class="code" href="structast__ha.html#a904bbec16face4bc9d13a8e8c7fbf764">next</a>;
<a name="l00371"></a>00371    }
<a name="l00372"></a>00372    <span class="keywordflow">return</span> res;
<a name="l00373"></a>00373 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a61f6f79316a8f64be7bdac1a41183047"></a><!-- doxytag: member="acl.h::ast_copy_ha" ref="a61f6f79316a8f64be7bdac1a41183047" args="(const struct ast_ha *from, struct ast_ha *to)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_copy_ha </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structast__ha.html">ast_ha</a> *&nbsp;</td>
          <td class="paramname"> <em>from</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structast__ha.html">ast_ha</a> *&nbsp;</td>
          <td class="paramname"> <em>to</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Copy ha structure. </p>

<p>Definition at line <a class="el" href="acl_8c_source.html#l00228">228</a> of file <a class="el" href="acl_8c_source.html">acl.c</a>.</p>

<p>References <a class="el" href="acl_8h_source.html#l00049">ast_ha::netaddr</a>, <a class="el" href="acl_8h_source.html#l00050">ast_ha::netmask</a>, and <a class="el" href="acl_8h_source.html#l00051">ast_ha::sense</a>.</p>

<p>Referenced by <a class="el" href="chan__iax2_8c_source.html#l02333">add_calltoken_ignore()</a>, <a class="el" href="acl_8c_source.html#l00236">ast_duplicate_ha()</a>, and <a class="el" href="chan__iax2_8c_source.html#l02278">build_callno_limits()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00229"></a>00229 {
<a name="l00230"></a>00230    memcpy(&amp;to-&gt;<a class="code" href="structast__ha.html#a45df45150d4d7ca82a48dfbaa981120e">netaddr</a>, &amp;from-&gt;<a class="code" href="structast__ha.html#a45df45150d4d7ca82a48dfbaa981120e">netaddr</a>, <span class="keyword">sizeof</span>(from-&gt;<a class="code" href="structast__ha.html#a45df45150d4d7ca82a48dfbaa981120e">netaddr</a>));
<a name="l00231"></a>00231    memcpy(&amp;to-&gt;<a class="code" href="structast__ha.html#a7b83baecde62ac17306ac3cc5770c27a">netmask</a>, &amp;from-&gt;<a class="code" href="structast__ha.html#a7b83baecde62ac17306ac3cc5770c27a">netmask</a>, <span class="keyword">sizeof</span>(from-&gt;<a class="code" href="structast__ha.html#a7b83baecde62ac17306ac3cc5770c27a">netmask</a>));
<a name="l00232"></a>00232    to-&gt;<a class="code" href="structast__ha.html#a63824e330f67129ae657ddc1120c30f2">sense</a> = from-&gt;<a class="code" href="structast__ha.html#a63824e330f67129ae657ddc1120c30f2">sense</a>;
<a name="l00233"></a>00233 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="abbe043434fef41fa18acb4062960b578"></a><!-- doxytag: member="acl.h::ast_duplicate_ha_list" ref="abbe043434fef41fa18acb4062960b578" args="(struct ast_ha *original)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structast__ha.html">ast_ha</a>* ast_duplicate_ha_list </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__ha.html">ast_ha</a> *&nbsp;</td>
          <td class="paramname"> <em>original</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Copy host access list. </p>

<p>Definition at line <a class="el" href="acl_8c_source.html#l00250">250</a> of file <a class="el" href="acl_8c_source.html">acl.c</a>.</p>

<p>References <a class="el" href="acl_8c_source.html#l00236">ast_duplicate_ha()</a>, and <a class="el" href="acl_8h_source.html#l00052">ast_ha::next</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00251"></a>00251 {
<a name="l00252"></a>00252    <span class="keyword">struct </span><a class="code" href="structast__ha.html" title="internal representation of acl entries In principle user applications would have...">ast_ha</a> *start = original;
<a name="l00253"></a>00253    <span class="keyword">struct </span><a class="code" href="structast__ha.html" title="internal representation of acl entries In principle user applications would have...">ast_ha</a> *ret = NULL;
<a name="l00254"></a>00254    <span class="keyword">struct </span><a class="code" href="structast__ha.html" title="internal representation of acl entries In principle user applications would have...">ast_ha</a> *current, *prev = NULL;
<a name="l00255"></a>00255 
<a name="l00256"></a>00256    <span class="keywordflow">while</span> (start) {
<a name="l00257"></a>00257       current = <a class="code" href="acl_8c.html#a6d97cef1d0fcd04f8597a70bb315e216">ast_duplicate_ha</a>(start);  <span class="comment">/* Create copy of this object */</span>
<a name="l00258"></a>00258       <span class="keywordflow">if</span> (prev) {
<a name="l00259"></a>00259          prev-&gt;<a class="code" href="structast__ha.html#a904bbec16face4bc9d13a8e8c7fbf764">next</a> = current;           <span class="comment">/* Link previous to this object */</span>
<a name="l00260"></a>00260       }
<a name="l00261"></a>00261 
<a name="l00262"></a>00262       <span class="keywordflow">if</span> (!ret) {
<a name="l00263"></a>00263          ret = current;                  <span class="comment">/* Save starting point */</span>
<a name="l00264"></a>00264       }
<a name="l00265"></a>00265 
<a name="l00266"></a>00266       start = start-&gt;<a class="code" href="structast__ha.html#a904bbec16face4bc9d13a8e8c7fbf764">next</a>;                <span class="comment">/* Go to next object */</span>
<a name="l00267"></a>00267       prev = current;                     <span class="comment">/* Save pointer to this object */</span>
<a name="l00268"></a>00268    }
<a name="l00269"></a>00269    <span class="keywordflow">return</span> ret;                             <span class="comment">/* Return start of list */</span>
<a name="l00270"></a>00270 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4fbb9258573d41461c7389afbcbba377"></a><!-- doxytag: member="acl.h::ast_find_ourip" ref="a4fbb9258573d41461c7389afbcbba377" args="(struct in_addr *ourip, struct sockaddr_in bindaddr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_find_ourip </td>
          <td>(</td>
          <td class="paramtype">struct in_addr *&nbsp;</td>
          <td class="paramname"> <em>ourip</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct sockaddr_in&nbsp;</td>
          <td class="paramname"> <em>bindaddr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="acl_8c_source.html#l00511">511</a> of file <a class="el" href="acl_8c_source.html">acl.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="utils_8c_source.html#l00182">ast_gethostbyname()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="acl_8c_source.html#l00481">ast_ouraddrfor()</a>, <a class="el" href="acl_8c_source.html#l00115">get_local_address()</a>, <a class="el" href="chan__skinny_8c_source.html#l00982">hp</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, <a class="el" href="network_8h_source.html#l00069">MAXHOSTNAMELEN</a>, and <a class="el" href="chan__mgcp_8c_source.html#l00217">ourhost</a>.</p>

<p>Referenced by <a class="el" href="chan__h323_8c_source.html#l00951">__oh323_rtp_create()</a>, <a class="el" href="chan__gtalk_8c_source.html#l00773">gtalk_create_candidates()</a>, <a class="el" href="chan__jingle_8c_source.html#l00583">jingle_create_candidates()</a>, <a class="el" href="chan__gtalk_8c_source.html#l02033">load_module()</a>, and <a class="el" href="chan__sip_8c_source.html#l24245">reload_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00512"></a>00512 {
<a name="l00513"></a>00513    <span class="keywordtype">char</span> <a class="code" href="chan__mgcp_8c.html#a8d857a26518d3787a893c9ab433ddb4d">ourhost</a>[<a class="code" href="network_8h.html#afd80ecbe3170ca4fc85b65cda8659f82">MAXHOSTNAMELEN</a>] = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00514"></a>00514    <span class="keyword">struct </span><a class="code" href="structast__hostent.html">ast_hostent</a> <a class="code" href="chan__skinny_8c.html#a9e435aef83f14da6d3d5ec44f821558e">ahp</a>;
<a name="l00515"></a>00515    <span class="keyword">struct </span>hostent *<a class="code" href="chan__skinny_8c.html#aa0f575fa3882aa394cc287edba645a35">hp</a>;
<a name="l00516"></a>00516    <span class="keyword">struct </span>in_addr saddr;
<a name="l00517"></a>00517 
<a name="l00518"></a>00518    <span class="comment">/* just use the bind address if it is nonzero */</span>
<a name="l00519"></a>00519    <span class="keywordflow">if</span> (ntohl(<a class="code" href="chan__gtalk_8c.html#a4ec29229510a2e3ea6ce34d520f06e90">bindaddr</a>.sin_addr.s_addr)) {
<a name="l00520"></a>00520       memcpy(ourip, &amp;<a class="code" href="chan__gtalk_8c.html#a4ec29229510a2e3ea6ce34d520f06e90">bindaddr</a>.sin_addr, <span class="keyword">sizeof</span>(*ourip));
<a name="l00521"></a>00521       <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(3, <span class="stringliteral">&quot;Attached to given IP address\n&quot;</span>);
<a name="l00522"></a>00522       <span class="keywordflow">return</span> 0;
<a name="l00523"></a>00523    }
<a name="l00524"></a>00524    <span class="comment">/* try to use our hostname */</span>
<a name="l00525"></a>00525    <span class="keywordflow">if</span> (gethostname(ourhost, <span class="keyword">sizeof</span>(ourhost) - 1)) {
<a name="l00526"></a>00526       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to get hostname\n&quot;</span>);
<a name="l00527"></a>00527    } <span class="keywordflow">else</span> {
<a name="l00528"></a>00528       <span class="keywordflow">if</span> ((hp = <a class="code" href="utils_8h.html#ad3b63ee1041593219ef0765b28d70442" title="Thread-safe gethostbyname function to use in Asterisk.">ast_gethostbyname</a>(ourhost, &amp;<a class="code" href="chan__skinny_8c.html#a9e435aef83f14da6d3d5ec44f821558e">ahp</a>))) {
<a name="l00529"></a>00529          memcpy(ourip, hp-&gt;h_addr, <span class="keyword">sizeof</span>(*ourip));
<a name="l00530"></a>00530          <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(3, <span class="stringliteral">&quot;Found one IP address based on local hostname %s.\n&quot;</span>, ourhost);
<a name="l00531"></a>00531          <span class="keywordflow">return</span> 0;
<a name="l00532"></a>00532       }
<a name="l00533"></a>00533    }
<a name="l00534"></a>00534    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(3, <span class="stringliteral">&quot;Trying to check A.ROOT-SERVERS.NET and get our IP address for that connection\n&quot;</span>);
<a name="l00535"></a>00535    <span class="comment">/* A.ROOT-SERVERS.NET. */</span>
<a name="l00536"></a>00536    <span class="keywordflow">if</span> (inet_aton(<span class="stringliteral">&quot;198.41.0.4&quot;</span>, &amp;saddr) &amp;&amp; !<a class="code" href="acl_8h.html#a5c782f0d9affd120e7270beca0636c9a">ast_ouraddrfor</a>(&amp;saddr, ourip)) {
<a name="l00537"></a>00537       <span class="keywordflow">return</span> 0;
<a name="l00538"></a>00538    }
<a name="l00539"></a>00539    <span class="keywordflow">return</span> <a class="code" href="acl_8c.html#aba7855e57b6239b7b5408a5faaab793e">get_local_address</a>(ourip);
<a name="l00540"></a>00540 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a45dc427430b544afc0ef8e898b2c57bf"></a><!-- doxytag: member="acl.h::ast_free_ha" ref="a45dc427430b544afc0ef8e898b2c57bf" args="(struct ast_ha *ha)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_free_ha </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structast__ha.html">ast_ha</a> *&nbsp;</td>
          <td class="paramname"> <em>ha</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Free host access list. </p>

<p>Definition at line <a class="el" href="acl_8c_source.html#l00217">217</a> of file <a class="el" href="acl_8c_source.html">acl.c</a>.</p>

<p>References <a class="el" href="astmm_8h_source.html#l00087">ast_free</a>, and <a class="el" href="acl_8h_source.html#l00052">ast_ha::next</a>.</p>

<p>Referenced by <a class="el" href="manager_8c_source.html#l04061">__init_manager()</a>, <a class="el" href="chan__iax2_8c_source.html#l02333">add_calltoken_ignore()</a>, <a class="el" href="chan__iax2_8c_source.html#l02278">build_callno_limits()</a>, <a class="el" href="chan__h323_8c_source.html#l01478">build_peer()</a>, <a class="el" href="chan__h323_8c_source.html#l01360">build_user()</a>, <a class="el" href="chan__mgcp_8c_source.html#l04023">destroy_gateway()</a>, <a class="el" href="chan__h323_8c_source.html#l00294">oh323_destroy_peer()</a>, <a class="el" href="chan__h323_8c_source.html#l00286">oh323_destroy_user()</a>, <a class="el" href="chan__iax2_8c_source.html#l11855">peer_destructor()</a>, <a class="el" href="chan__sip_8c_source.html#l24245">reload_config()</a>, <a class="el" href="chan__sip_8c_source.html#l04649">sip_destroy_peer()</a>, <a class="el" href="chan__sip_8c_source.html#l25834">unload_module()</a>, and <a class="el" href="chan__iax2_8c_source.html#l12142">user_destructor()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00218"></a>00218 {
<a name="l00219"></a>00219    <span class="keyword">struct </span><a class="code" href="structast__ha.html" title="internal representation of acl entries In principle user applications would have...">ast_ha</a> *hal;
<a name="l00220"></a>00220    <span class="keywordflow">while</span> (ha) {
<a name="l00221"></a>00221       hal = ha;
<a name="l00222"></a>00222       ha = ha-&gt;<a class="code" href="structast__ha.html#a904bbec16face4bc9d13a8e8c7fbf764">next</a>;
<a name="l00223"></a>00223       <a class="code" href="astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(hal);
<a name="l00224"></a>00224    }
<a name="l00225"></a>00225 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af04bd435c082da93aec0cb6e0782788a"></a><!-- doxytag: member="acl.h::ast_get_ip" ref="af04bd435c082da93aec0cb6e0782788a" args="(struct sockaddr_in *sin, const char *value)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_get_ip </td>
          <td>(</td>
          <td class="paramtype">struct sockaddr_in *&nbsp;</td>
          <td class="paramname"> <em>sin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>value</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="acl_8c_source.html#l00476">476</a> of file <a class="el" href="acl_8c_source.html">acl.c</a>.</p>

<p>References <a class="el" href="acl_8c_source.html#l00375">ast_get_ip_or_srv()</a>.</p>

<p>Referenced by <a class="el" href="chan__mgcp_8c_source.html#l03552">build_gateway()</a>, <a class="el" href="chan__h323_8c_source.html#l01478">build_peer()</a>, <a class="el" href="chan__h323_8c_source.html#l01360">build_user()</a>, <a class="el" href="chan__skinny_8c_source.html#l06537">config_parse_variables()</a>, and <a class="el" href="chan__iax2_8c_source.html#l11783">peer_set_srcaddr()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00477"></a>00477 {
<a name="l00478"></a>00478    <span class="keywordflow">return</span> <a class="code" href="acl_8h.html#afab7a25fb37c7e1a0dedef9c286a44a1">ast_get_ip_or_srv</a>(sin, value, NULL);
<a name="l00479"></a>00479 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="afab7a25fb37c7e1a0dedef9c286a44a1"></a><!-- doxytag: member="acl.h::ast_get_ip_or_srv" ref="afab7a25fb37c7e1a0dedef9c286a44a1" args="(struct sockaddr_in *sin, const char *value, const char *service)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_get_ip_or_srv </td>
          <td>(</td>
          <td class="paramtype">struct sockaddr_in *&nbsp;</td>
          <td class="paramname"> <em>sin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>service</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="acl_8c_source.html#l00375">375</a> of file <a class="el" href="acl_8c_source.html">acl.c</a>.</p>

<p>References <a class="el" href="srv_8c_source.html#l00200">ast_get_srv()</a>, <a class="el" href="utils_8c_source.html#l00182">ast_gethostbyname()</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="chan__skinny_8c_source.html#l00982">hp</a>, and <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>.</p>

<p>Referenced by <a class="el" href="dnsmgr_8c_source.html#l00126">ast_dnsmgr_lookup()</a>, <a class="el" href="acl_8c_source.html#l00476">ast_get_ip()</a>, <a class="el" href="chan__iax2_8c_source.html#l04337">create_addr()</a>, <a class="el" href="dnsmgr_8c_source.html#l00156">dnsmgr_refresh()</a>, and <a class="el" href="chan__sip_8c_source.html#l03287">proxy_update()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00376"></a>00376 {
<a name="l00377"></a>00377    <span class="keyword">struct </span>hostent *<a class="code" href="chan__skinny_8c.html#aa0f575fa3882aa394cc287edba645a35">hp</a>;
<a name="l00378"></a>00378    <span class="keyword">struct </span><a class="code" href="structast__hostent.html">ast_hostent</a> <a class="code" href="chan__skinny_8c.html#a9e435aef83f14da6d3d5ec44f821558e">ahp</a>;
<a name="l00379"></a>00379    <span class="keywordtype">char</span> srv[256];
<a name="l00380"></a>00380    <span class="keywordtype">char</span> host[256];
<a name="l00381"></a>00381    <span class="keywordtype">int</span> tportno = ntohs(sin-&gt;sin_port);
<a name="l00382"></a>00382    <span class="keywordflow">if</span> (<a class="code" href="adsistub_8c.html#ad61354ac038c6aaed26fded971a8843b">service</a>) {
<a name="l00383"></a>00383       snprintf(srv, <span class="keyword">sizeof</span>(srv), <span class="stringliteral">&quot;%s.%s&quot;</span>, <a class="code" href="adsistub_8c.html#ad61354ac038c6aaed26fded971a8843b">service</a>, value);
<a name="l00384"></a>00384       <span class="keywordflow">if</span> (<a class="code" href="srv_8h.html#abb197cf8faead91d33666976c469bec2">ast_get_srv</a>(NULL, host, <span class="keyword">sizeof</span>(host), &amp;tportno, srv) &gt; 0) {
<a name="l00385"></a>00385          sin-&gt;sin_port = htons(tportno);
<a name="l00386"></a>00386          value = host;
<a name="l00387"></a>00387       }
<a name="l00388"></a>00388    }
<a name="l00389"></a>00389    <span class="keywordflow">if</span> ((hp = <a class="code" href="utils_8h.html#ad3b63ee1041593219ef0765b28d70442" title="Thread-safe gethostbyname function to use in Asterisk.">ast_gethostbyname</a>(value, &amp;<a class="code" href="chan__skinny_8c.html#a9e435aef83f14da6d3d5ec44f821558e">ahp</a>))) {
<a name="l00390"></a>00390       memcpy(&amp;sin-&gt;sin_addr, hp-&gt;h_addr, <span class="keyword">sizeof</span>(sin-&gt;sin_addr));
<a name="l00391"></a>00391    } <span class="keywordflow">else</span> {
<a name="l00392"></a>00392       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to lookup &apos;%s&apos;\n&quot;</span>, value);
<a name="l00393"></a>00393       <span class="keywordflow">return</span> -1;
<a name="l00394"></a>00394    }
<a name="l00395"></a>00395    <span class="keywordflow">return</span> 0;
<a name="l00396"></a>00396 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a5c782f0d9affd120e7270beca0636c9a"></a><!-- doxytag: member="acl.h::ast_ouraddrfor" ref="a5c782f0d9affd120e7270beca0636c9a" args="(struct in_addr *them, struct in_addr *us)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_ouraddrfor </td>
          <td>(</td>
          <td class="paramtype">struct in_addr *&nbsp;</td>
          <td class="paramname"> <em>them</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct in_addr *&nbsp;</td>
          <td class="paramname"> <em>us</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="acl_8c_source.html#l00481">481</a> of file <a class="el" href="acl_8c_source.html">acl.c</a>.</p>

<p>References <a class="el" href="logger_8h_source.html#l00213">ast_debug</a>, <a class="el" href="logger_8c_source.html#l01090">ast_log()</a>, <a class="el" href="logger_8h_source.html#l00163">LOG_ERROR</a>, <a class="el" href="logger_8h_source.html#l00152">LOG_WARNING</a>, and <a class="el" href="aesopt_8h_source.html#l00399">s</a>.</p>

<p>Referenced by <a class="el" href="acl_8c_source.html#l00511">ast_find_ourip()</a>, <a class="el" href="chan__sip_8c_source.html#l03607">ast_sip_ouraddrfor()</a>, <a class="el" href="chan__mgcp_8c_source.html#l03552">build_gateway()</a>, and <a class="el" href="chan__mgcp_8c_source.html#l01625">find_subchannel_and_lock()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00482"></a>00482 {
<a name="l00483"></a>00483    <span class="keywordtype">int</span> <a class="code" href="aesopt_8h.html#a20c782a91c883391b9bdf9e3176e447c">s</a>;
<a name="l00484"></a>00484    <span class="keyword">struct </span>sockaddr_in sin;
<a name="l00485"></a>00485    socklen_t slen;
<a name="l00486"></a>00486 
<a name="l00487"></a>00487    <span class="keywordflow">if</span> ((s = socket(PF_INET, SOCK_DGRAM, 0)) &lt; 0) {
<a name="l00488"></a>00488       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Cannot create socket\n&quot;</span>);
<a name="l00489"></a>00489       <span class="keywordflow">return</span> -1;
<a name="l00490"></a>00490    }
<a name="l00491"></a>00491    sin.sin_family = AF_INET;
<a name="l00492"></a>00492    sin.sin_port = htons(5060);
<a name="l00493"></a>00493    sin.sin_addr = *them;
<a name="l00494"></a>00494    <span class="keywordflow">if</span> (connect(s, (<span class="keyword">struct</span> sockaddr *)&amp;sin, <span class="keyword">sizeof</span>(sin))) {
<a name="l00495"></a>00495       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Cannot connect\n&quot;</span>);
<a name="l00496"></a>00496       close(s);
<a name="l00497"></a>00497       <span class="keywordflow">return</span> -1;
<a name="l00498"></a>00498    }
<a name="l00499"></a>00499    slen = <span class="keyword">sizeof</span>(sin);
<a name="l00500"></a>00500    <span class="keywordflow">if</span> (getsockname(s, (<span class="keyword">struct</span> sockaddr *)&amp;sin, &amp;slen)) {
<a name="l00501"></a>00501       <a class="code" href="logger_8h.html#a93dd824dff97fe84941d6d71b7a3710e" title="Used for sending a log message This is the standard logger function. Probably the...">ast_log</a>(<a class="code" href="logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Cannot get socket name\n&quot;</span>);
<a name="l00502"></a>00502       close(s);
<a name="l00503"></a>00503       <span class="keywordflow">return</span> -1;
<a name="l00504"></a>00504    }
<a name="l00505"></a>00505    close(s);
<a name="l00506"></a>00506    <a class="code" href="logger_8h.html#a3f248112c8d6ce7e3959aa723dade648" title="Log a DEBUG message.">ast_debug</a>(3, <span class="stringliteral">&quot;Found IP address for this socket\n&quot;</span>);
<a name="l00507"></a>00507    *us = sin.sin_addr;
<a name="l00508"></a>00508    <span class="keywordflow">return</span> 0;
<a name="l00509"></a>00509 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad364a9241e15fc0dbec0ffcb88f64671"></a><!-- doxytag: member="acl.h::ast_str2cos" ref="ad364a9241e15fc0dbec0ffcb88f64671" args="(const char *value, unsigned int *cos)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_str2cos </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int *&nbsp;</td>
          <td class="paramname"> <em>cos</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="acl_8c_source.html#l00429">429</a> of file <a class="el" href="acl_8c_source.html">acl.c</a>.</p>

<p>Referenced by <a class="el" href="chan__skinny_8c_source.html#l06537">config_parse_variables()</a>, <a class="el" href="chan__h323_8c_source.html#l02832">reload_config()</a>, and <a class="el" href="chan__iax2_8c_source.html#l12493">set_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00430"></a>00430 {
<a name="l00431"></a>00431    <span class="keywordtype">int</span> fval;
<a name="l00432"></a>00432 
<a name="l00433"></a>00433    <span class="keywordflow">if</span> (sscanf(value, <span class="stringliteral">&quot;%30d&quot;</span>, &amp;fval) == 1) {
<a name="l00434"></a>00434       <span class="keywordflow">if</span> (fval &lt; 8) {
<a name="l00435"></a>00435           *<a class="code" href="chan__h323_8c.html#ae91dad65f553f7afebe4af507803bc7f">cos</a> = fval;
<a name="l00436"></a>00436           <span class="keywordflow">return</span> 0;
<a name="l00437"></a>00437       }
<a name="l00438"></a>00438    }
<a name="l00439"></a>00439 
<a name="l00440"></a>00440    <span class="keywordflow">return</span> -1;
<a name="l00441"></a>00441 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a49d1eefe77636e2a63ad013afa0fc3b5"></a><!-- doxytag: member="acl.h::ast_str2tos" ref="a49d1eefe77636e2a63ad013afa0fc3b5" args="(const char *value, unsigned int *tos)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_str2tos </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int *&nbsp;</td>
          <td class="paramname"> <em>tos</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="acl_8c_source.html#l00443">443</a> of file <a class="el" href="acl_8c_source.html">acl.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="cdr__adaptive__odbc_8c_source.html#l00053">name</a>, and <a class="el" href="acl_8c_source.html#l00400">dscp_codepoint::space</a>.</p>

<p>Referenced by <a class="el" href="chan__skinny_8c_source.html#l06537">config_parse_variables()</a>, <a class="el" href="iax2-provision_8c_source.html#l00277">iax_template_parse()</a>, <a class="el" href="chan__h323_8c_source.html#l02832">reload_config()</a>, and <a class="el" href="chan__iax2_8c_source.html#l12493">set_config()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00444"></a>00444 {
<a name="l00445"></a>00445    <span class="keywordtype">int</span> fval;
<a name="l00446"></a>00446    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x;
<a name="l00447"></a>00447 
<a name="l00448"></a>00448    <span class="keywordflow">if</span> (sscanf(value, <span class="stringliteral">&quot;%30i&quot;</span>, &amp;fval) == 1) {
<a name="l00449"></a>00449       *<a class="code" href="chan__h323_8c.html#a25a9305efab3b493ca2519562fcec3d5">tos</a> = fval &amp; 0xFF;
<a name="l00450"></a>00450       <span class="keywordflow">return</span> 0;
<a name="l00451"></a>00451    }
<a name="l00452"></a>00452 
<a name="l00453"></a>00453    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="acl_8c.html#a2ae521765b2255f2c985c1567a40a3dd">dscp_pool1</a>); x++) {
<a name="l00454"></a>00454       <span class="keywordflow">if</span> (!strcasecmp(value, <a class="code" href="acl_8c.html#a2ae521765b2255f2c985c1567a40a3dd">dscp_pool1</a>[x].<a class="code" href="cdr__adaptive__odbc_8c.html#a5ac083a645d964373f022d03df4849c8">name</a>)) {
<a name="l00455"></a>00455          *<a class="code" href="chan__h323_8c.html#a25a9305efab3b493ca2519562fcec3d5">tos</a> = <a class="code" href="acl_8c.html#a2ae521765b2255f2c985c1567a40a3dd">dscp_pool1</a>[x].<a class="code" href="structdscp__codepoint.html#af041b9f420eaa4774ba9fa9e5820e468">space</a> &lt;&lt; 2;
<a name="l00456"></a>00456          <span class="keywordflow">return</span> 0;
<a name="l00457"></a>00457       }
<a name="l00458"></a>00458    }
<a name="l00459"></a>00459 
<a name="l00460"></a>00460    <span class="keywordflow">return</span> -1;
<a name="l00461"></a>00461 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a18813aaabb1644f4083746b798a351a0"></a><!-- doxytag: member="acl.h::ast_tos2str" ref="a18813aaabb1644f4083746b798a351a0" args="(unsigned int tos)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* ast_tos2str </td>
          <td>(</td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>tos</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="acl_8c_source.html#l00463">463</a> of file <a class="el" href="acl_8c_source.html">acl.c</a>.</p>

<p>References <a class="el" href="isdn__lib_8c_source.html#l00040">ARRAY_LEN</a>, <a class="el" href="acl_8c_source.html#l00399">dscp_codepoint::name</a>, and <a class="el" href="acl_8c_source.html#l00400">dscp_codepoint::space</a>.</p>

<p>Referenced by <a class="el" href="chan__sip_8c_source.html#l15919">sip_show_settings()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00464"></a>00464 {
<a name="l00465"></a>00465    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x;
<a name="l00466"></a>00466 
<a name="l00467"></a>00467    <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="acl_8c.html#a2ae521765b2255f2c985c1567a40a3dd">dscp_pool1</a>); x++) {
<a name="l00468"></a>00468       <span class="keywordflow">if</span> (<a class="code" href="acl_8c.html#a2ae521765b2255f2c985c1567a40a3dd">dscp_pool1</a>[x].space == (<a class="code" href="chan__h323_8c.html#a25a9305efab3b493ca2519562fcec3d5">tos</a> &gt;&gt; 2)) {
<a name="l00469"></a>00469          <span class="keywordflow">return</span> <a class="code" href="acl_8c.html#a2ae521765b2255f2c985c1567a40a3dd">dscp_pool1</a>[x].<a class="code" href="structdscp__codepoint.html#a5ac083a645d964373f022d03df4849c8">name</a>;
<a name="l00470"></a>00470       }
<a name="l00471"></a>00471    }
<a name="l00472"></a>00472 
<a name="l00473"></a>00473    <span class="keywordflow">return</span> <span class="stringliteral">&quot;unknown&quot;</span>;
<a name="l00474"></a>00474 }
</pre></div></p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Wed May 5 15:18:50 2010 for Asterisk - the Open Source PBX by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
